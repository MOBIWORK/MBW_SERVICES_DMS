import{W as Se,a as uy,a8 as fy,a9 as ll,_ as f0,aa as dg,ab as Rn,ac as Wa,ad as d0,ae as pg,af as mg,ag as gg,ah as xg,h as qa,K as I0,ai as Ou,aj as dy,ak as py,al as _g,am as my,an as gy,ao as gl,w as xy,ap as yg,aq as vg,ar as wg,as as Ha,at as Ui,au as so,av as bg,aw as p0,ax as _y,ay as yy,az as Up,aA as Tg,aB as Eg,aC as Vp,aD as vy,aE as wy,I as Sg,aF as by,aG as Ty,J as Ey,aH as $p,aI as jp,aJ as Gp,Q as oo,aK as Sy,aL as ky,aM as Cy,aN as Ay,aO as yu,L as Ke,R as lo,a0 as an,P as Ti,O as Ri,aP as vu,a2 as ts,a3 as F0,aQ as Iy,aR as Fy,aS as Py,N as m0,aT as My,aU as kg,aV as Dy,aW as Ly,aX as Ry,aY as Zf,$ as Oy,aZ as By,a7 as zy}from"./index-sApiNKv_.js";import{u as Ny}from"./useDebount-ldivosw-.js";import{t as Hp,g as Cg}from"./index--3FdvL55.js";import{T as Uy}from"./index-rD1zQrl_.js";import{i as Vy,M as g0}from"./index-4SJIgAoH.js";import{s as wu}from"./index-MmR2KqdB.js";import{a as $y,b as jy}from"./index.esm-L2ZefxDT.js";import{H as Gy}from"./header-page-Ut_4dZcM.js";import{T as Hy}from"./index-kSrzsB0L.js";var qy={percent:0,prefixCls:"rc-progress",strokeColor:"#2db7f5",strokeLinecap:"round",strokeWidth:1,trailColor:"#D9D9D9",trailWidth:1,gapPosition:"bottom"},Wy=function(){var n=Se.useRef([]),i=Se.useRef(null);return Se.useEffect(function(){var c=Date.now(),h=!1;n.current.forEach(function(m){if(m){h=!0;var x=m.style;x.transitionDuration=".3s, .3s, .3s, .06s",i.current&&c-i.current<100&&(x.transitionDuration="0s, 0s")}}),h&&(i.current=Date.now())}),n.current},qp=0,Zy=fy();function Xy(){var e;return Zy?(e=qp,qp+=1):e="TEST_OR_SSR",e}const Ky=function(e){var n=Se.useState(),i=uy(n,2),c=i[0],h=i[1];return Se.useEffect(function(){h("rc_progress_".concat(Xy()))},[]),e||c};var Wp=function(n){var i=n.bg,c=n.children;return Se.createElement("div",{style:{width:"100%",height:"100%",background:i}},c)};function Zp(e,n){return Object.keys(e).map(function(i){var c=parseFloat(i),h="".concat(Math.floor(c*n),"%");return"".concat(e[i]," ").concat(h)})}var Yy=Se.forwardRef(function(e,n){var i=e.prefixCls,c=e.color,h=e.gradientId,m=e.radius,x=e.style,o=e.ptg,S=e.strokeLinecap,b=e.strokeWidth,C=e.size,M=e.gapDegree,L=c&&ll(c)==="object",z=L?"#FFF":void 0,U=C/2,N=Se.createElement("circle",{className:"".concat(i,"-circle-path"),r:m,cx:U,cy:U,stroke:z,strokeLinecap:S,strokeWidth:b,opacity:o===0?0:1,style:x,ref:n});if(!L)return N;var G="".concat(h,"-conic"),ie=M?"".concat(180+M/2,"deg"):"0deg",pe=Zp(c,(360-M)/360),Y=Zp(c,1),me="conic-gradient(from ".concat(ie,", ").concat(pe.join(", "),")"),ve="linear-gradient(to ".concat(M?"bottom":"top",", ").concat(Y.join(", "),")");return Se.createElement(Se.Fragment,null,Se.createElement("mask",{id:G},N),Se.createElement("foreignObject",{x:0,y:0,width:C,height:C,mask:"url(#".concat(G,")")},Se.createElement(Wp,{bg:ve},Se.createElement(Wp,{bg:me}))))}),kc=100,Xf=function(n,i,c,h,m,x,o,S,b,C){var M=arguments.length>10&&arguments[10]!==void 0?arguments[10]:0,L=c/100*360*((360-x)/360),z=x===0?0:{bottom:0,top:180,left:90,right:-90}[o],U=(100-h)/100*i;b==="round"&&h!==100&&(U+=C/2,U>=i&&(U=i-.01));var N=kc/2;return{stroke:typeof S=="string"?S:void 0,strokeDasharray:"".concat(i,"px ").concat(n),strokeDashoffset:U+M,transform:"rotate(".concat(m+L+z,"deg)"),transformOrigin:"".concat(N,"px ").concat(N,"px"),transition:"stroke-dashoffset .3s ease 0s, stroke-dasharray .3s ease 0s, stroke .3s, stroke-width .06s ease .3s, opacity .3s ease 0s",fillOpacity:0}},Jy=["id","prefixCls","steps","strokeWidth","trailWidth","gapDegree","gapPosition","trailColor","strokeLinecap","style","className","strokeColor","percent"];function Xp(e){var n=e??[];return Array.isArray(n)?n:[n]}var Qy=function(n){var i=f0(f0({},qy),n),c=i.id,h=i.prefixCls,m=i.steps,x=i.strokeWidth,o=i.trailWidth,S=i.gapDegree,b=S===void 0?0:S,C=i.gapPosition,M=i.trailColor,L=i.strokeLinecap,z=i.style,U=i.className,N=i.strokeColor,G=i.percent,ie=dg(i,Jy),pe=kc/2,Y=Ky(c),me="".concat(Y,"-gradient"),ve=pe-x/2,we=Math.PI*2*ve,te=b>0?90+b/2:-90,Be=we*((360-b)/360),Ce=ll(m)==="object"?m:{count:m,space:2},Ue=Ce.count,$e=Ce.space,Re=Xp(G),st=Xp(N),pt=st.find(function(Dt){return Dt&&ll(Dt)==="object"}),ot=pt&&ll(pt)==="object",_t=ot?"butt":L,ft=Xf(we,Be,0,100,te,b,C,M,_t,x),ir=Wy(),qe=function(){var ue=0;return Re.map(function(be,Te){var Ae=st[Te]||st[st.length-1],Ye=Xf(we,Be,ue,be,te,b,C,Ae,_t,x);return ue+=be,Se.createElement(Yy,{key:Te,color:Ae,ptg:be,radius:ve,prefixCls:h,gradientId:me,style:Ye,strokeLinecap:_t,strokeWidth:x,gapDegree:b,ref:function(wt){ir[Te]=wt},size:kc})}).reverse()},$t=function(){var ue=Math.round(Ue*(Re[0]/100)),be=100/Ue,Te=0;return new Array(Ue).fill(null).map(function(Ae,Ye){var mt=Ye<=ue-1?st[0]:M,wt=mt&&ll(mt)==="object"?"url(#".concat(me,")"):void 0,ut=Xf(we,Be,Te,be,te,b,C,mt,"butt",x,$e);return Te+=(Be-ut.strokeDashoffset+$e)*100/Be,Se.createElement("circle",{key:Ye,className:"".concat(h,"-circle-path"),r:ve,cx:pe,cy:pe,stroke:wt,strokeWidth:x,opacity:1,style:ut,ref:function(Yt){ir[Ye]=Yt}})})};return Se.createElement("svg",Rn({className:Wa("".concat(h,"-circle"),U),viewBox:"0 0 ".concat(kc," ").concat(kc),style:z,id:c,role:"presentation"},ie),!Ue&&Se.createElement("circle",{className:"".concat(h,"-circle-trail"),r:ve,cx:pe,cy:pe,stroke:M,strokeLinecap:_t,strokeWidth:o||x,style:ft}),Ue?$t():qe())};function Ps(e){return!e||e<0?0:e>100?100:e}function bu(e){let{success:n,successPercent:i}=e,c=i;return n&&"progress"in n&&(c=n.progress),n&&"percent"in n&&(c=n.percent),c}const ev=e=>{let{percent:n,success:i,successPercent:c}=e;const h=Ps(bu({success:i,successPercent:c}));return[h,Ps(Ps(n)-h)]},tv=e=>{let{success:n={},strokeColor:i}=e;const{strokeColor:c}=n;return[c||d0.green,i||null]},Bu=(e,n,i)=>{var c,h,m,x;let o=-1,S=-1;if(n==="step"){const b=i.steps,C=i.strokeWidth;typeof e=="string"||typeof e>"u"?(o=e==="small"?2:14,S=C??8):typeof e=="number"?[o,S]=[e,e]:[o=14,S=8]=e,o*=b}else if(n==="line"){const b=i?.strokeWidth;typeof e=="string"||typeof e>"u"?S=b||(e==="small"?6:8):typeof e=="number"?[o,S]=[e,e]:[o=-1,S=8]=e}else(n==="circle"||n==="dashboard")&&(typeof e=="string"||typeof e>"u"?[o,S]=e==="small"?[60,60]:[120,120]:typeof e=="number"?[o,S]=[e,e]:(o=(h=(c=e[0])!==null&&c!==void 0?c:e[1])!==null&&h!==void 0?h:120,S=(x=(m=e[0])!==null&&m!==void 0?m:e[1])!==null&&x!==void 0?x:120));return[o,S]},rv=3,av=e=>rv/e*100,iv=e=>{const{prefixCls:n,trailColor:i=null,strokeLinecap:c="round",gapPosition:h,gapDegree:m,width:x=120,type:o,children:S,success:b,size:C=x}=e,[M,L]=Bu(C,"circle");let{strokeWidth:z}=e;z===void 0&&(z=Math.max(av(M),6));const U={width:M,height:L,fontSize:M*.15+6},N=Se.useMemo(()=>{if(m||m===0)return m;if(o==="dashboard")return 75},[m,o]),G=h||o==="dashboard"&&"bottom"||void 0,ie=Object.prototype.toString.call(e.strokeColor)==="[object Object]",pe=tv({success:b,strokeColor:e.strokeColor}),Y=Wa(`${n}-inner`,{[`${n}-circle-gradient`]:ie}),me=Se.createElement(Qy,{percent:ev(e),strokeWidth:z,trailWidth:z,strokeColor:pe,strokeLinecap:c,trailColor:i,prefixCls:n,gapDegree:N,gapPosition:G});return Se.createElement("div",{className:Y,style:U},M<=20?Se.createElement(pg,{title:S},Se.createElement("span",null,me)):Se.createElement(Se.Fragment,null,me,S))},nv=iv,Tu="--progress-line-stroke-color",Ag="--progress-percent",Kp=e=>{const n=e?"100%":"-100%";return new I0(`antProgress${e?"RTL":"LTR"}Active`,{"0%":{transform:`translateX(${n}) scaleX(0)`,opacity:.1},"20%":{transform:`translateX(${n}) scaleX(0)`,opacity:.5},to:{transform:"translateX(0) scaleX(1)",opacity:0}})},sv=e=>{const{componentCls:n,iconCls:i}=e;return{[n]:Object.assign(Object.assign({},xg(e)),{display:"inline-block","&-rtl":{direction:"rtl"},"&-line":{position:"relative",width:"100%",fontSize:e.fontSize,marginInlineEnd:e.marginXS,marginBottom:e.marginXS},[`${n}-outer`]:{display:"inline-block",width:"100%"},[`&${n}-show-info`]:{[`${n}-outer`]:{marginInlineEnd:`calc(-2em - ${qa(e.marginXS)})`,paddingInlineEnd:`calc(2em + ${qa(e.paddingXS)})`}},[`${n}-inner`]:{position:"relative",display:"inline-block",width:"100%",overflow:"hidden",verticalAlign:"middle",backgroundColor:e.remainingColor,borderRadius:e.lineBorderRadius},[`${n}-inner:not(${n}-circle-gradient)`]:{[`${n}-circle-path`]:{stroke:e.defaultColor}},[`${n}-success-bg, ${n}-bg`]:{position:"relative",background:e.defaultColor,borderRadius:e.lineBorderRadius,transition:`all ${e.motionDurationSlow} ${e.motionEaseInOutCirc}`},[`${n}-bg`]:{overflow:"hidden","&::after":{content:'""',background:{_multi_value_:!0,value:["inherit",`var(${Tu})`]},height:"100%",width:`calc(1 / var(${Ag}) * 100%)`,display:"block"}},[`${n}-success-bg`]:{position:"absolute",insetBlockStart:0,insetInlineStart:0,backgroundColor:e.colorSuccess},[`${n}-text`]:{display:"inline-block",width:"2em",marginInlineStart:e.marginXS,color:e.colorText,lineHeight:1,whiteSpace:"nowrap",textAlign:"start",verticalAlign:"middle",wordBreak:"normal",[i]:{fontSize:e.fontSize}},[`&${n}-status-active`]:{[`${n}-bg::before`]:{position:"absolute",inset:0,backgroundColor:e.colorBgContainer,borderRadius:e.lineBorderRadius,opacity:0,animationName:Kp(),animationDuration:e.progressActiveMotionDuration,animationTimingFunction:e.motionEaseOutQuint,animationIterationCount:"infinite",content:'""'}},[`&${n}-rtl${n}-status-active`]:{[`${n}-bg::before`]:{animationName:Kp(!0)}},[`&${n}-status-exception`]:{[`${n}-bg`]:{backgroundColor:e.colorError},[`${n}-text`]:{color:e.colorError}},[`&${n}-status-exception ${n}-inner:not(${n}-circle-gradient)`]:{[`${n}-circle-path`]:{stroke:e.colorError}},[`&${n}-status-success`]:{[`${n}-bg`]:{backgroundColor:e.colorSuccess},[`${n}-text`]:{color:e.colorSuccess}},[`&${n}-status-success ${n}-inner:not(${n}-circle-gradient)`]:{[`${n}-circle-path`]:{stroke:e.colorSuccess}}})}},ov=e=>{const{componentCls:n,iconCls:i}=e;return{[n]:{[`${n}-circle-trail`]:{stroke:e.remainingColor},[`&${n}-circle ${n}-inner`]:{position:"relative",lineHeight:1,backgroundColor:"transparent"},[`&${n}-circle ${n}-text`]:{position:"absolute",insetBlockStart:"50%",insetInlineStart:0,width:"100%",margin:0,padding:0,color:e.circleTextColor,fontSize:e.circleTextFontSize,lineHeight:1,whiteSpace:"normal",textAlign:"center",transform:"translateY(-50%)",[i]:{fontSize:e.circleIconFontSize}},[`${n}-circle&-status-exception`]:{[`${n}-text`]:{color:e.colorError}},[`${n}-circle&-status-success`]:{[`${n}-text`]:{color:e.colorSuccess}}},[`${n}-inline-circle`]:{lineHeight:1,[`${n}-inner`]:{verticalAlign:"bottom"}}}},lv=e=>{const{componentCls:n}=e;return{[n]:{[`${n}-steps`]:{display:"inline-block","&-outer":{display:"flex",flexDirection:"row",alignItems:"center"},"&-item":{flexShrink:0,minWidth:e.progressStepMinWidth,marginInlineEnd:e.progressStepMarginInlineEnd,backgroundColor:e.remainingColor,transition:`all ${e.motionDurationSlow}`,"&-active":{backgroundColor:e.defaultColor}}}}}},cv=e=>{const{componentCls:n,iconCls:i}=e;return{[n]:{[`${n}-small&-line, ${n}-small&-line ${n}-text ${i}`]:{fontSize:e.fontSizeSM}}}},hv=e=>({circleTextColor:e.colorText,defaultColor:e.colorInfo,remainingColor:e.colorFillSecondary,lineBorderRadius:100,circleTextFontSize:"1em",circleIconFontSize:`${e.fontSize/e.fontSizeSM}em`}),uv=mg("Progress",e=>{const n=e.calc(e.marginXXS).div(2).equal(),i=gg(e,{progressStepMarginInlineEnd:n,progressStepMinWidth:n,progressActiveMotionDuration:"2.4s"});return[sv(i),ov(i),lv(i),cv(i)]},hv);var fv=function(e,n){var i={};for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&n.indexOf(c)<0&&(i[c]=e[c]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var h=0,c=Object.getOwnPropertySymbols(e);h<c.length;h++)n.indexOf(c[h])<0&&Object.prototype.propertyIsEnumerable.call(e,c[h])&&(i[c[h]]=e[c[h]]);return i};const dv=e=>{let n=[];return Object.keys(e).forEach(i=>{const c=parseFloat(i.replace(/%/g,""));isNaN(c)||n.push({key:c,value:e[i]})}),n=n.sort((i,c)=>i.key-c.key),n.map(i=>{let{key:c,value:h}=i;return`${h} ${c}%`}).join(", ")},pv=(e,n)=>{const{from:i=d0.blue,to:c=d0.blue,direction:h=n==="rtl"?"to left":"to right"}=e,m=fv(e,["from","to","direction"]);if(Object.keys(m).length!==0){const o=dv(m),S=`linear-gradient(${h}, ${o})`;return{background:S,[Tu]:S}}const x=`linear-gradient(${h}, ${i}, ${c})`;return{background:x,[Tu]:x}},mv=e=>{const{prefixCls:n,direction:i,percent:c,size:h,strokeWidth:m,strokeColor:x,strokeLinecap:o="round",children:S,trailColor:b=null,success:C}=e,M=x&&typeof x!="string"?pv(x,i):{[Tu]:x,background:x},L=o==="square"||o==="butt"?0:void 0,z=h??[-1,m||(h==="small"?6:8)],[U,N]=Bu(z,"line",{strokeWidth:m}),G={backgroundColor:b||void 0,borderRadius:L},ie=Object.assign(Object.assign({width:`${Ps(c)}%`,height:N,borderRadius:L},M),{[Ag]:Ps(c)/100}),pe=bu(e),Y={width:`${Ps(pe)}%`,height:N,borderRadius:L,backgroundColor:C?.strokeColor},me={width:U<0?"100%":U,height:N};return Se.createElement(Se.Fragment,null,Se.createElement("div",{className:`${n}-outer`,style:me},Se.createElement("div",{className:`${n}-inner`,style:G},Se.createElement("div",{className:`${n}-bg`,style:ie}),pe!==void 0?Se.createElement("div",{className:`${n}-success-bg`,style:Y}):null)),S)},gv=mv,xv=e=>{const{size:n,steps:i,percent:c=0,strokeWidth:h=8,strokeColor:m,trailColor:x=null,prefixCls:o,children:S}=e,b=Math.round(i*(c/100)),M=n??[n==="small"?2:14,h],[L,z]=Bu(M,"step",{steps:i,strokeWidth:h}),U=L/i,N=new Array(i);for(let G=0;G<i;G++){const ie=Array.isArray(m)?m[G]:m;N[G]=Se.createElement("div",{key:G,className:Wa(`${o}-steps-item`,{[`${o}-steps-item-active`]:G<=b-1}),style:{backgroundColor:G<=b-1?ie:x,width:U,height:z}})}return Se.createElement("div",{className:`${o}-steps-outer`},N,S)},_v=xv;var yv=function(e,n){var i={};for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&n.indexOf(c)<0&&(i[c]=e[c]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var h=0,c=Object.getOwnPropertySymbols(e);h<c.length;h++)n.indexOf(c[h])<0&&Object.prototype.propertyIsEnumerable.call(e,c[h])&&(i[c[h]]=e[c[h]]);return i};const vv=["normal","exception","active","success"],wv=Se.forwardRef((e,n)=>{const{prefixCls:i,className:c,rootClassName:h,steps:m,strokeColor:x,percent:o=0,size:S="default",showInfo:b=!0,type:C="line",status:M,format:L,style:z}=e,U=yv(e,["prefixCls","className","rootClassName","steps","strokeColor","percent","size","showInfo","type","status","format","style"]),N=Se.useMemo(()=>{var st,pt;const ot=bu(e);return parseInt(ot!==void 0?(st=ot??0)===null||st===void 0?void 0:st.toString():(pt=o??0)===null||pt===void 0?void 0:pt.toString(),10)},[o,e.success,e.successPercent]),G=Se.useMemo(()=>!vv.includes(M)&&N>=100?"success":M||"normal",[M,N]),{getPrefixCls:ie,direction:pe,progress:Y}=Se.useContext(Ou),me=ie("progress",i),[ve,we,te]=uv(me),Be=Se.useMemo(()=>{if(!b)return null;const st=bu(e);let pt;const ot=L||(ft=>`${ft}%`),_t=C==="line";return L||G!=="exception"&&G!=="success"?pt=ot(Ps(o),Ps(st)):G==="exception"?pt=_t?Se.createElement(py,null):Se.createElement(_g,null):G==="success"&&(pt=_t?Se.createElement(my,null):Se.createElement(gy,null)),Se.createElement("span",{className:`${me}-text`,title:typeof pt=="string"?pt:void 0},pt)},[b,o,N,G,C,me,L]),Ce=Array.isArray(x)?x[0]:x,Ue=typeof x=="string"||Array.isArray(x)?x:void 0;let $e;C==="line"?$e=m?Se.createElement(_v,Object.assign({},e,{strokeColor:Ue,prefixCls:me,steps:m}),Be):Se.createElement(gv,Object.assign({},e,{strokeColor:Ce,prefixCls:me,direction:pe}),Be):(C==="circle"||C==="dashboard")&&($e=Se.createElement(nv,Object.assign({},e,{strokeColor:Ce,prefixCls:me,progressStatus:G}),Be));const Re=Wa(me,`${me}-status-${G}`,`${me}-${C==="dashboard"&&"circle"||m&&"steps"||C}`,{[`${me}-inline-circle`]:C==="circle"&&Bu(S,"circle")[0]<=20,[`${me}-show-info`]:b,[`${me}-${S}`]:typeof S=="string",[`${me}-rtl`]:pe==="rtl"},Y?.className,c,h,we,te);return ve(Se.createElement("div",Object.assign({ref:n,style:Object.assign(Object.assign({},Y?.style),z),className:Re,role:"progressbar","aria-valuenow":N},dy(U,["trailColor","strokeWidth","width","gapDegree","gapPosition","strokeLinecap","success","successPercent"])),$e))}),bv=wv;var Tv={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z"}}]},name:"delete",theme:"outlined"};const Ev=Tv;var Sv=function(n,i){return Se.createElement(gl,Rn({},n,{ref:i,icon:Ev}))};const Ig=Se.forwardRef(Sv),Kf=function(e,n){if(e&&n){var i=Array.isArray(n)?n:n.split(","),c=e.name||"",h=e.type||"",m=h.replace(/\/.*$/,"");return i.some(function(x){var o=x.trim();if(/^\*(\/\*)?$/.test(x))return!0;if(o.charAt(0)==="."){var S=c.toLowerCase(),b=o.toLowerCase(),C=[b];return(b===".jpg"||b===".jpeg")&&(C=[".jpg",".jpeg"]),C.some(function(M){return S.endsWith(M)})}return/\/\*$/.test(o)?m===o.replace(/\/.*$/,""):h===o?!0:/^\w+$/.test(o)?(xy(!1,"Upload takes an invalidate 'accept' type '".concat(o,"'.Skip for check.")),!0):!1})}return!0};function kv(e,n){var i="cannot ".concat(e.method," ").concat(e.action," ").concat(n.status,"'"),c=new Error(i);return c.status=n.status,c.method=e.method,c.url=e.action,c}function Yp(e){var n=e.responseText||e.response;if(!n)return n;try{return JSON.parse(n)}catch{return n}}function Cv(e){var n=new XMLHttpRequest;e.onProgress&&n.upload&&(n.upload.onprogress=function(m){m.total>0&&(m.percent=m.loaded/m.total*100),e.onProgress(m)});var i=new FormData;e.data&&Object.keys(e.data).forEach(function(h){var m=e.data[h];if(Array.isArray(m)){m.forEach(function(x){i.append("".concat(h,"[]"),x)});return}i.append(h,m)}),e.file instanceof Blob?i.append(e.filename,e.file,e.file.name):i.append(e.filename,e.file),n.onerror=function(m){e.onError(m)},n.onload=function(){return n.status<200||n.status>=300?e.onError(kv(e,n),Yp(n)):e.onSuccess(Yp(n),n)},n.open(e.method,e.action,!0),e.withCredentials&&"withCredentials"in n&&(n.withCredentials=!0);var c=e.headers||{};return c["X-Requested-With"]!==null&&n.setRequestHeader("X-Requested-With","XMLHttpRequest"),Object.keys(c).forEach(function(h){c[h]!==null&&n.setRequestHeader(h,c[h])}),n.send(i),{abort:function(){n.abort()}}}function Av(e,n){var i=e.createReader(),c=[];function h(){i.readEntries(function(m){var x=Array.prototype.slice.apply(m);c=c.concat(x);var o=!x.length;o?n(c):h()})}h()}var Iv=function(n,i,c){var h=function m(x,o){x&&(x.path=o||"",x.isFile?x.file(function(S){c(S)&&(x.fullPath&&!S.webkitRelativePath&&(Object.defineProperties(S,{webkitRelativePath:{writable:!0}}),S.webkitRelativePath=x.fullPath.replace(/^\//,""),Object.defineProperties(S,{webkitRelativePath:{writable:!1}})),i([S]))}):x.isDirectory&&Av(x,function(S){S.forEach(function(b){m(b,"".concat(o).concat(x.name,"/"))})}))};n.forEach(function(m){h(m.webkitGetAsEntry())})},Fv=+new Date,Pv=0;function Yf(){return"rc-upload-".concat(Fv,"-").concat(++Pv)}var Mv=["component","prefixCls","className","classNames","disabled","id","style","styles","multiple","accept","capture","children","directory","openFileDialogOnClick","onMouseEnter","onMouseLeave","hasControlInside"],Dv=function(e){yg(i,e);var n=vg(i);function i(){var c;wg(this,i);for(var h=arguments.length,m=new Array(h),x=0;x<h;x++)m[x]=arguments[x];return c=n.call.apply(n,[this].concat(m)),Ha(Ui(c),"state",{uid:Yf()}),Ha(Ui(c),"reqs",{}),Ha(Ui(c),"fileInput",void 0),Ha(Ui(c),"_isMounted",void 0),Ha(Ui(c),"onChange",function(o){var S=c.props,b=S.accept,C=S.directory,M=o.target.files,L=so(M).filter(function(z){return!C||Kf(z,b)});c.uploadFiles(L),c.reset()}),Ha(Ui(c),"onClick",function(o){var S=c.fileInput;if(S){var b=o.target,C=c.props.onClick;if(b&&b.tagName==="BUTTON"){var M=S.parentNode;M.focus(),b.blur()}S.click(),C&&C(o)}}),Ha(Ui(c),"onKeyDown",function(o){o.key==="Enter"&&c.onClick(o)}),Ha(Ui(c),"onFileDrop",function(o){var S=c.props.multiple;if(o.preventDefault(),o.type!=="dragover")if(c.props.directory)Iv(Array.prototype.slice.call(o.dataTransfer.items),c.uploadFiles,function(C){return Kf(C,c.props.accept)});else{var b=so(o.dataTransfer.files).filter(function(C){return Kf(C,c.props.accept)});S===!1&&(b=b.slice(0,1)),c.uploadFiles(b)}}),Ha(Ui(c),"uploadFiles",function(o){var S=so(o),b=S.map(function(C){return C.uid=Yf(),c.processFile(C,S)});Promise.all(b).then(function(C){var M=c.props.onBatchStart;M?.(C.map(function(L){var z=L.origin,U=L.parsedFile;return{file:z,parsedFile:U}})),C.filter(function(L){return L.parsedFile!==null}).forEach(function(L){c.post(L)})})}),Ha(Ui(c),"processFile",function(){var o=yy(Up().mark(function S(b,C){var M,L,z,U,N,G,ie,pe,Y;return Up().wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:if(M=c.props.beforeUpload,L=b,!M){ve.next=14;break}return ve.prev=3,ve.next=6,M(b,C);case 6:L=ve.sent,ve.next=12;break;case 9:ve.prev=9,ve.t0=ve.catch(3),L=!1;case 12:if(L!==!1){ve.next=14;break}return ve.abrupt("return",{origin:b,parsedFile:null,action:null,data:null});case 14:if(z=c.props.action,typeof z!="function"){ve.next=21;break}return ve.next=18,z(b);case 18:U=ve.sent,ve.next=22;break;case 21:U=z;case 22:if(N=c.props.data,typeof N!="function"){ve.next=29;break}return ve.next=26,N(b);case 26:G=ve.sent,ve.next=30;break;case 29:G=N;case 30:return ie=(ll(L)==="object"||typeof L=="string")&&L?L:b,ie instanceof File?pe=ie:pe=new File([ie],b.name,{type:b.type}),Y=pe,Y.uid=b.uid,ve.abrupt("return",{origin:b,data:G,parsedFile:Y,action:U});case 35:case"end":return ve.stop()}},S,null,[[3,9]])}));return function(S,b){return o.apply(this,arguments)}}()),Ha(Ui(c),"saveFileInput",function(o){c.fileInput=o}),c}return bg(i,[{key:"componentDidMount",value:function(){this._isMounted=!0}},{key:"componentWillUnmount",value:function(){this._isMounted=!1,this.abort()}},{key:"post",value:function(h){var m=this,x=h.data,o=h.origin,S=h.action,b=h.parsedFile;if(this._isMounted){var C=this.props,M=C.onStart,L=C.customRequest,z=C.name,U=C.headers,N=C.withCredentials,G=C.method,ie=o.uid,pe=L||Cv,Y={action:S,filename:z,data:x,file:b,headers:U,withCredentials:N,method:G||"post",onProgress:function(ve){var we=m.props.onProgress;we?.(ve,b)},onSuccess:function(ve,we){var te=m.props.onSuccess;te?.(ve,b,we),delete m.reqs[ie]},onError:function(ve,we){var te=m.props.onError;te?.(ve,we,b),delete m.reqs[ie]}};M(o),this.reqs[ie]=pe(Y)}}},{key:"reset",value:function(){this.setState({uid:Yf()})}},{key:"abort",value:function(h){var m=this.reqs;if(h){var x=h.uid?h.uid:h;m[x]&&m[x].abort&&m[x].abort(),delete m[x]}else Object.keys(m).forEach(function(o){m[o]&&m[o].abort&&m[o].abort(),delete m[o]})}},{key:"render",value:function(){var h,m=this.props,x=m.component,o=m.prefixCls,S=m.className,b=m.classNames,C=b===void 0?{}:b,M=m.disabled,L=m.id,z=m.style,U=m.styles,N=U===void 0?{}:U,G=m.multiple,ie=m.accept,pe=m.capture,Y=m.children,me=m.directory,ve=m.openFileDialogOnClick,we=m.onMouseEnter,te=m.onMouseLeave,Be=m.hasControlInside,Ce=dg(m,Mv),Ue=Wa((h={},Ha(h,o,!0),Ha(h,"".concat(o,"-disabled"),M),Ha(h,S,S),h)),$e=me?{directory:"directory",webkitdirectory:"webkitdirectory"}:{},Re=M?{}:{onClick:ve?this.onClick:function(){},onKeyDown:ve?this.onKeyDown:function(){},onMouseEnter:we,onMouseLeave:te,onDrop:this.onFileDrop,onDragOver:this.onFileDrop,tabIndex:Be?void 0:"0"};return p0.createElement(x,Rn({},Re,{className:Ue,role:Be?void 0:"button",style:z}),p0.createElement("input",Rn({},_y(Ce,{aria:!0,data:!0}),{id:L,disabled:M,type:"file",ref:this.saveFileInput,onClick:function(pt){return pt.stopPropagation()},key:this.state.uid,style:f0({display:"none"},N.input),className:C.input,accept:ie},$e,{multiple:G,onChange:this.onChange},pe!=null?{capture:pe}:{})),Y)}}]),i}(Se.Component);function Jf(){}var x0=function(e){yg(i,e);var n=vg(i);function i(){var c;wg(this,i);for(var h=arguments.length,m=new Array(h),x=0;x<h;x++)m[x]=arguments[x];return c=n.call.apply(n,[this].concat(m)),Ha(Ui(c),"uploader",void 0),Ha(Ui(c),"saveUploader",function(o){c.uploader=o}),c}return bg(i,[{key:"abort",value:function(h){this.uploader.abort(h)}},{key:"render",value:function(){return p0.createElement(Dv,Rn({},this.props,{ref:this.saveUploader}))}}]),i}(Se.Component);Ha(x0,"defaultProps",{component:"span",prefixCls:"rc-upload",data:{},headers:{},name:"file",multipart:!1,onStart:Jf,onError:Jf,onSuccess:Jf,multiple:!1,beforeUpload:null,customRequest:null,withCredentials:!1,openFileDialogOnClick:!0,hasControlInside:!1});const Lv=e=>{const{componentCls:n,iconCls:i}=e;return{[`${n}-wrapper`]:{[`${n}-drag`]:{position:"relative",width:"100%",height:"100%",textAlign:"center",background:e.colorFillAlter,border:`${qa(e.lineWidth)} dashed ${e.colorBorder}`,borderRadius:e.borderRadiusLG,cursor:"pointer",transition:`border-color ${e.motionDurationSlow}`,[n]:{padding:e.padding},[`${n}-btn`]:{display:"table",width:"100%",height:"100%",outline:"none",borderRadius:e.borderRadiusLG,"&:focus-visible":{outline:`${qa(e.lineWidthFocus)} solid ${e.colorPrimaryBorder}`}},[`${n}-drag-container`]:{display:"table-cell",verticalAlign:"middle"},[`
          &:not(${n}-disabled):hover,
          &-hover:not(${n}-disabled)
        `]:{borderColor:e.colorPrimaryHover},[`p${n}-drag-icon`]:{marginBottom:e.margin,[i]:{color:e.colorPrimary,fontSize:e.uploadThumbnailSize}},[`p${n}-text`]:{margin:`0 0 ${qa(e.marginXXS)}`,color:e.colorTextHeading,fontSize:e.fontSizeLG},[`p${n}-hint`]:{color:e.colorTextDescription,fontSize:e.fontSize},[`&${n}-disabled`]:{[`p${n}-drag-icon ${i},
            p${n}-text,
            p${n}-hint
          `]:{color:e.colorTextDisabled}}}}}},Rv=e=>{const{componentCls:n,antCls:i,iconCls:c,fontSize:h,lineHeight:m,calc:x}=e,o=`${n}-list-item`,S=`${o}-actions`,b=`${o}-action`,C=e.fontHeightSM;return{[`${n}-wrapper`]:{[`${n}-list`]:Object.assign(Object.assign({},Tg()),{lineHeight:e.lineHeight,[o]:{position:"relative",height:x(e.lineHeight).mul(h).equal(),marginTop:e.marginXS,fontSize:h,display:"flex",alignItems:"center",transition:`background-color ${e.motionDurationSlow}`,"&:hover":{backgroundColor:e.controlItemBgHover},[`${o}-name`]:Object.assign(Object.assign({},Eg),{padding:`0 ${qa(e.paddingXS)}`,lineHeight:m,flex:"auto",transition:`all ${e.motionDurationSlow}`}),[S]:{[b]:{opacity:0},[c]:{color:e.actionsColor,transition:`all ${e.motionDurationSlow}`},[`
              ${b}:focus-visible,
              &.picture ${b}
            `]:{opacity:1},[`${b}${i}-btn`]:{height:C,border:0,lineHeight:1}},[`${n}-icon ${c}`]:{color:e.colorTextDescription,fontSize:h},[`${o}-progress`]:{position:"absolute",bottom:e.calc(e.uploadProgressOffset).mul(-1).equal(),width:"100%",paddingInlineStart:x(h).add(e.paddingXS).equal(),fontSize:h,lineHeight:0,pointerEvents:"none","> div":{margin:0}}},[`${o}:hover ${b}`]:{opacity:1},[`${o}-error`]:{color:e.colorError,[`${o}-name, ${n}-icon ${c}`]:{color:e.colorError},[S]:{[`${c}, ${c}:hover`]:{color:e.colorError},[b]:{opacity:1}}},[`${n}-list-item-container`]:{transition:`opacity ${e.motionDurationSlow}, height ${e.motionDurationSlow}`,"&::before":{display:"table",width:0,height:0,content:'""'}}})}}},Jp=new I0("uploadAnimateInlineIn",{from:{width:0,height:0,margin:0,padding:0,opacity:0}}),Qp=new I0("uploadAnimateInlineOut",{to:{width:0,height:0,margin:0,padding:0,opacity:0}}),Ov=e=>{const{componentCls:n}=e,i=`${n}-animate-inline`;return[{[`${n}-wrapper`]:{[`${i}-appear, ${i}-enter, ${i}-leave`]:{animationDuration:e.motionDurationSlow,animationTimingFunction:e.motionEaseInOutCirc,animationFillMode:"forwards"},[`${i}-appear, ${i}-enter`]:{animationName:Jp},[`${i}-leave`]:{animationName:Qp}}},{[`${n}-wrapper`]:Vy(e)},Jp,Qp]},Bv=e=>{const{componentCls:n,iconCls:i,uploadThumbnailSize:c,uploadProgressOffset:h,calc:m}=e,x=`${n}-list`,o=`${x}-item`;return{[`${n}-wrapper`]:{[`
        ${x}${x}-picture,
        ${x}${x}-picture-card,
        ${x}${x}-picture-circle
      `]:{[o]:{position:"relative",height:m(c).add(m(e.lineWidth).mul(2)).add(m(e.paddingXS).mul(2)).equal(),padding:e.paddingXS,border:`${qa(e.lineWidth)} ${e.lineType} ${e.colorBorder}`,borderRadius:e.borderRadiusLG,"&:hover":{background:"transparent"},[`${o}-thumbnail`]:Object.assign(Object.assign({},Eg),{width:c,height:c,lineHeight:qa(m(c).add(e.paddingSM).equal()),textAlign:"center",flex:"none",[i]:{fontSize:e.fontSizeHeading2,color:e.colorPrimary},img:{display:"block",width:"100%",height:"100%",overflow:"hidden"}}),[`${o}-progress`]:{bottom:h,width:`calc(100% - ${qa(m(e.paddingSM).mul(2).equal())})`,marginTop:0,paddingInlineStart:m(c).add(e.paddingXS).equal()}},[`${o}-error`]:{borderColor:e.colorError,[`${o}-thumbnail ${i}`]:{[`svg path[fill='${Vp[0]}']`]:{fill:e.colorErrorBg},[`svg path[fill='${Vp.primary}']`]:{fill:e.colorError}}},[`${o}-uploading`]:{borderStyle:"dashed",[`${o}-name`]:{marginBottom:h}}},[`${x}${x}-picture-circle ${o}`]:{[`&, &::before, ${o}-thumbnail`]:{borderRadius:"50%"}}}}},zv=e=>{const{componentCls:n,iconCls:i,fontSizeLG:c,colorTextLightSolid:h,calc:m}=e,x=`${n}-list`,o=`${x}-item`,S=e.uploadPicCardSize;return{[`
      ${n}-wrapper${n}-picture-card-wrapper,
      ${n}-wrapper${n}-picture-circle-wrapper
    `]:Object.assign(Object.assign({},Tg()),{display:"inline-block",width:"100%",[`${n}${n}-select`]:{width:S,height:S,marginInlineEnd:e.marginXS,marginBottom:e.marginXS,textAlign:"center",verticalAlign:"top",backgroundColor:e.colorFillAlter,border:`${qa(e.lineWidth)} dashed ${e.colorBorder}`,borderRadius:e.borderRadiusLG,cursor:"pointer",transition:`border-color ${e.motionDurationSlow}`,[`> ${n}`]:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",textAlign:"center"},[`&:not(${n}-disabled):hover`]:{borderColor:e.colorPrimary}},[`${x}${x}-picture-card, ${x}${x}-picture-circle`]:{[`${x}-item-container`]:{display:"inline-block",width:S,height:S,marginBlock:`0 ${qa(e.marginXS)}`,marginInline:`0 ${qa(e.marginXS)}`,verticalAlign:"top"},"&::after":{display:"none"},[o]:{height:"100%",margin:0,"&::before":{position:"absolute",zIndex:1,width:`calc(100% - ${qa(m(e.paddingXS).mul(2).equal())})`,height:`calc(100% - ${qa(m(e.paddingXS).mul(2).equal())})`,backgroundColor:e.colorBgMask,opacity:0,transition:`all ${e.motionDurationSlow}`,content:'" "'}},[`${o}:hover`]:{[`&::before, ${o}-actions`]:{opacity:1}},[`${o}-actions`]:{position:"absolute",insetInlineStart:0,zIndex:10,width:"100%",whiteSpace:"nowrap",textAlign:"center",opacity:0,transition:`all ${e.motionDurationSlow}`,[`
            ${i}-eye,
            ${i}-download,
            ${i}-delete
          `]:{zIndex:10,width:c,margin:`0 ${qa(e.marginXXS)}`,fontSize:c,cursor:"pointer",transition:`all ${e.motionDurationSlow}`,color:h,"&:hover":{color:h},svg:{verticalAlign:"baseline"}}},[`${o}-thumbnail, ${o}-thumbnail img`]:{position:"static",display:"block",width:"100%",height:"100%",objectFit:"contain"},[`${o}-name`]:{display:"none",textAlign:"center"},[`${o}-file + ${o}-name`]:{position:"absolute",bottom:e.margin,display:"block",width:`calc(100% - ${qa(m(e.paddingXS).mul(2).equal())})`},[`${o}-uploading`]:{[`&${o}`]:{backgroundColor:e.colorFillAlter},[`&::before, ${i}-eye, ${i}-download, ${i}-delete`]:{display:"none"}},[`${o}-progress`]:{bottom:e.marginXL,width:`calc(100% - ${qa(m(e.paddingXS).mul(2).equal())})`,paddingInlineStart:0}}}),[`${n}-wrapper${n}-picture-circle-wrapper`]:{[`${n}${n}-select`]:{borderRadius:"50%"}}}},Nv=e=>{const{componentCls:n}=e;return{[`${n}-rtl`]:{direction:"rtl"}}},Uv=e=>{const{componentCls:n,colorTextDisabled:i}=e;return{[`${n}-wrapper`]:Object.assign(Object.assign({},xg(e)),{[n]:{outline:0,"input[type='file']":{cursor:"pointer"}},[`${n}-select`]:{display:"inline-block"},[`${n}-disabled`]:{color:i,cursor:"not-allowed"}})}},Vv=e=>({actionsColor:e.colorTextDescription}),$v=mg("Upload",e=>{const{fontSizeHeading3:n,fontHeight:i,lineWidth:c,controlHeightLG:h,calc:m}=e,x=gg(e,{uploadThumbnailSize:m(n).mul(2).equal(),uploadProgressOffset:m(m(i).div(2)).add(c).equal(),uploadPicCardSize:m(h).mul(2.55).equal()});return[Uv(x),Lv(x),Bv(x),zv(x),Rv(x),Ov(x),Nv(x),vy(x)]},Vv);var jv={icon:function(n,i){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M534 352V136H232v752h560V394H576a42 42 0 01-42-42z",fill:i}},{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM602 137.8L790.2 326H602V137.8zM792 888H232V136h302v216a42 42 0 0042 42h216v494z",fill:n}}]}},name:"file",theme:"twotone"};const Gv=jv;var Hv=function(n,i){return Se.createElement(gl,Rn({},n,{ref:i,icon:Gv}))};const qv=Se.forwardRef(Hv);var Wv={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M779.3 196.6c-94.2-94.2-247.6-94.2-341.7 0l-261 260.8c-1.7 1.7-2.6 4-2.6 6.4s.9 4.7 2.6 6.4l36.9 36.9a9 9 0 0012.7 0l261-260.8c32.4-32.4 75.5-50.2 121.3-50.2s88.9 17.8 121.2 50.2c32.4 32.4 50.2 75.5 50.2 121.2 0 45.8-17.8 88.8-50.2 121.2l-266 265.9-43.1 43.1c-40.3 40.3-105.8 40.3-146.1 0-19.5-19.5-30.2-45.4-30.2-73s10.7-53.5 30.2-73l263.9-263.8c6.7-6.6 15.5-10.3 24.9-10.3h.1c9.4 0 18.1 3.7 24.7 10.3 6.7 6.7 10.3 15.5 10.3 24.9 0 9.3-3.7 18.1-10.3 24.7L372.4 653c-1.7 1.7-2.6 4-2.6 6.4s.9 4.7 2.6 6.4l36.9 36.9a9 9 0 0012.7 0l215.6-215.6c19.9-19.9 30.8-46.3 30.8-74.4s-11-54.6-30.8-74.4c-41.1-41.1-107.9-41-149 0L463 364 224.8 602.1A172.22 172.22 0 00174 724.8c0 46.3 18.1 89.8 50.8 122.5 33.9 33.8 78.3 50.7 122.7 50.7 44.4 0 88.8-16.9 122.6-50.7l309.2-309C824.8 492.7 850 432 850 367.5c.1-64.6-25.1-125.3-70.7-170.9z"}}]},name:"paper-clip",theme:"outlined"};const Zv=Wv;var Xv=function(n,i){return Se.createElement(gl,Rn({},n,{ref:i,icon:Zv}))};const Kv=Se.forwardRef(Xv);var Yv={icon:function(n,i){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 632H136v-39.9l138.5-164.3 150.1 178L658.1 489 888 761.6V792zm0-129.8L664.2 396.8c-3.2-3.8-9-3.8-12.2 0L424.6 666.4l-144-170.7c-3.2-3.8-9-3.8-12.2 0L136 652.7V232h752v430.2z",fill:n}},{tag:"path",attrs:{d:"M424.6 765.8l-150.1-178L136 752.1V792h752v-30.4L658.1 489z",fill:i}},{tag:"path",attrs:{d:"M136 652.7l132.4-157c3.2-3.8 9-3.8 12.2 0l144 170.7L652 396.8c3.2-3.8 9-3.8 12.2 0L888 662.2V232H136v420.7zM304 280a88 88 0 110 176 88 88 0 010-176z",fill:i}},{tag:"path",attrs:{d:"M276 368a28 28 0 1056 0 28 28 0 10-56 0z",fill:i}},{tag:"path",attrs:{d:"M304 456a88 88 0 100-176 88 88 0 000 176zm0-116c15.5 0 28 12.5 28 28s-12.5 28-28 28-28-12.5-28-28 12.5-28 28-28z",fill:n}}]}},name:"picture",theme:"twotone"};const Jv=Yv;var Qv=function(n,i){return Se.createElement(gl,Rn({},n,{ref:i,icon:Jv}))};const e2=Se.forwardRef(Qv);function lu(e){return Object.assign(Object.assign({},e),{lastModified:e.lastModified,lastModifiedDate:e.lastModifiedDate,name:e.name,size:e.size,type:e.type,uid:e.uid,percent:0,originFileObj:e})}function cu(e,n){const i=so(n),c=i.findIndex(h=>{let{uid:m}=h;return m===e.uid});return c===-1?i.push(e):i[c]=e,i}function Qf(e,n){const i=e.uid!==void 0?"uid":"name";return n.filter(c=>c[i]===e[i])[0]}function t2(e,n){const i=e.uid!==void 0?"uid":"name",c=n.filter(h=>h[i]!==e[i]);return c.length===n.length?null:c}const r2=function(){const n=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:"").split("/"),c=n[n.length-1].split(/#|\?/)[0];return(/\.[^./\\]*$/.exec(c)||[""])[0]},Fg=e=>e.indexOf("image/")===0,a2=e=>{if(e.type&&!e.thumbUrl)return Fg(e.type);const n=e.thumbUrl||e.url||"",i=r2(n);return/^data:image\//.test(n)||/(webp|svg|png|gif|jpg|jpeg|jfif|bmp|dpg|ico|heic|heif)$/i.test(i)?!0:!(/^data:/.test(n)||i)},Ss=200;function i2(e){return new Promise(n=>{if(!e.type||!Fg(e.type)){n("");return}const i=document.createElement("canvas");i.width=Ss,i.height=Ss,i.style.cssText=`position: fixed; left: 0; top: 0; width: ${Ss}px; height: ${Ss}px; z-index: 9999; display: none;`,document.body.appendChild(i);const c=i.getContext("2d"),h=new Image;if(h.onload=()=>{const{width:m,height:x}=h;let o=Ss,S=Ss,b=0,C=0;m>x?(S=x*(Ss/m),C=-(S-o)/2):(o=m*(Ss/x),b=-(o-S)/2),c.drawImage(h,b,C,o,S);const M=i.toDataURL();document.body.removeChild(i),window.URL.revokeObjectURL(h.src),n(M)},h.crossOrigin="anonymous",e.type.startsWith("image/svg+xml")){const m=new FileReader;m.onload=()=>{m.result&&(h.src=m.result)},m.readAsDataURL(e)}else if(e.type.startsWith("image/gif")){const m=new FileReader;m.onload=()=>{m.result&&n(m.result)},m.readAsDataURL(e)}else h.src=window.URL.createObjectURL(e)})}var n2={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M505.7 661a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9h-74.1V168c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v338.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.8zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"download",theme:"outlined"};const s2=n2;var o2=function(n,i){return Se.createElement(gl,Rn({},n,{ref:i,icon:s2}))};const Pg=Se.forwardRef(o2),l2=Se.forwardRef((e,n)=>{let{prefixCls:i,className:c,style:h,locale:m,listType:x,file:o,items:S,progress:b,iconRender:C,actionIconRender:M,itemRender:L,isImgUrl:z,showPreviewIcon:U,showRemoveIcon:N,showDownloadIcon:G,previewIcon:ie,removeIcon:pe,downloadIcon:Y,onPreview:me,onDownload:ve,onClose:we}=e;var te,Be;const{status:Ce}=o,[Ue,$e]=Se.useState(Ce);Se.useEffect(()=>{Ce!=="removed"&&$e(Ce)},[Ce]);const[Re,st]=Se.useState(!1);Se.useEffect(()=>{const rt=setTimeout(()=>{st(!0)},300);return()=>{clearTimeout(rt)}},[]);const pt=C(o);let ot=Se.createElement("div",{className:`${i}-icon`},pt);if(x==="picture"||x==="picture-card"||x==="picture-circle")if(Ue==="uploading"||!o.thumbUrl&&!o.url){const rt=Wa(`${i}-list-item-thumbnail`,{[`${i}-list-item-file`]:Ue!=="uploading"});ot=Se.createElement("div",{className:rt},pt)}else{const rt=z?.(o)?Se.createElement("img",{src:o.thumbUrl||o.url,alt:o.name,className:`${i}-list-item-image`,crossOrigin:o.crossOrigin}):pt,Yt=Wa(`${i}-list-item-thumbnail`,{[`${i}-list-item-file`]:z&&!z(o)});ot=Se.createElement("a",{className:Yt,onClick:xe=>me(o,xe),href:o.url||o.thumbUrl,target:"_blank",rel:"noopener noreferrer"},rt)}const _t=Wa(`${i}-list-item`,`${i}-list-item-${Ue}`),ft=typeof o.linkProps=="string"?JSON.parse(o.linkProps):o.linkProps,ir=N?M((typeof pe=="function"?pe(o):pe)||Se.createElement(Ig,null),()=>we(o),i,m.removeFile,!0):null,qe=G&&Ue==="done"?M((typeof Y=="function"?Y(o):Y)||Se.createElement(Pg,null),()=>ve(o),i,m.downloadFile):null,$t=x!=="picture-card"&&x!=="picture-circle"&&Se.createElement("span",{key:"download-delete",className:Wa(`${i}-list-item-actions`,{picture:x==="picture"})},qe,ir),Dt=Wa(`${i}-list-item-name`),ue=o.url?[Se.createElement("a",Object.assign({key:"view",target:"_blank",rel:"noopener noreferrer",className:Dt,title:o.name},ft,{href:o.url,onClick:rt=>me(o,rt)}),o.name),$t]:[Se.createElement("span",{key:"view",className:Dt,onClick:rt=>me(o,rt),title:o.name},o.name),$t],be=U&&(o.url||o.thumbUrl)?Se.createElement("a",{href:o.url||o.thumbUrl,target:"_blank",rel:"noopener noreferrer",onClick:rt=>me(o,rt),title:m.previewFile},typeof ie=="function"?ie(o):ie||Se.createElement(wy,null)):null,Te=(x==="picture-card"||x==="picture-circle")&&Ue!=="uploading"&&Se.createElement("span",{className:`${i}-list-item-actions`},be,Ue==="done"&&qe,ir),{getPrefixCls:Ae}=Se.useContext(Ou),Ye=Ae(),mt=Se.createElement("div",{className:_t},ot,ue,Te,Re&&Se.createElement(Sg,{motionName:`${Ye}-fade`,visible:Ue==="uploading",motionDeadline:2e3},rt=>{let{className:Yt}=rt;const xe="percent"in o?Se.createElement(bv,Object.assign({},b,{type:"line",percent:o.percent,"aria-label":o["aria-label"],"aria-labelledby":o["aria-labelledby"]})):null;return Se.createElement("div",{className:Wa(`${i}-list-item-progress`,Yt)},xe)})),wt=o.response&&typeof o.response=="string"?o.response:((te=o.error)===null||te===void 0?void 0:te.statusText)||((Be=o.error)===null||Be===void 0?void 0:Be.message)||m.uploadError,ut=Ue==="error"?Se.createElement(pg,{title:wt,getPopupContainer:rt=>rt.parentNode},mt):mt;return Se.createElement("div",{className:Wa(`${i}-list-item-container`,c),style:h,ref:n},L?L(ut,o,S,{download:ve.bind(null,o),preview:me.bind(null,o),remove:we.bind(null,o)}):ut)}),c2=l2,h2=(e,n)=>{const{listType:i="text",previewFile:c=i2,onPreview:h,onDownload:m,onRemove:x,locale:o,iconRender:S,isImageUrl:b=a2,prefixCls:C,items:M=[],showPreviewIcon:L=!0,showRemoveIcon:z=!0,showDownloadIcon:U=!1,removeIcon:N,previewIcon:G,downloadIcon:ie,progress:pe={size:[-1,2],showInfo:!1},appendAction:Y,appendActionVisible:me=!0,itemRender:ve,disabled:we}=e,te=by(),[Be,Ce]=Se.useState(!1);Se.useEffect(()=>{i!=="picture"&&i!=="picture-card"&&i!=="picture-circle"||(M||[]).forEach(be=>{typeof document>"u"||typeof window>"u"||!window.FileReader||!window.File||!(be.originFileObj instanceof File||be.originFileObj instanceof Blob)||be.thumbUrl!==void 0||(be.thumbUrl="",c&&c(be.originFileObj).then(Te=>{be.thumbUrl=Te||"",te()}))})},[i,M,c]),Se.useEffect(()=>{Ce(!0)},[]);const Ue=(be,Te)=>{if(h)return Te?.preventDefault(),h(be)},$e=be=>{typeof m=="function"?m(be):be.url&&window.open(be.url)},Re=be=>{x?.(be)},st=be=>{if(S)return S(be,i);const Te=be.status==="uploading",Ae=b&&b(be)?Se.createElement(e2,null):Se.createElement(qv,null);let Ye=Te?Se.createElement(jp,null):Se.createElement(Kv,null);return i==="picture"?Ye=Te?Se.createElement(jp,null):Ae:(i==="picture-card"||i==="picture-circle")&&(Ye=Te?o.uploading:Ae),Ye},pt=(be,Te,Ae,Ye,mt)=>{const wt={type:"text",size:"small",title:Ye,onClick:ut=>{Te(),Gp(be)&&be.props.onClick&&be.props.onClick(ut)},className:`${Ae}-list-item-action`};if(mt&&(wt.disabled=we),Gp(be)){const ut=$p(be,Object.assign(Object.assign({},be.props),{onClick:()=>{}}));return Se.createElement(oo,Object.assign({},wt,{icon:ut}))}return Se.createElement(oo,Object.assign({},wt),Se.createElement("span",null,be))};Se.useImperativeHandle(n,()=>({handlePreview:Ue,handleDownload:$e}));const{getPrefixCls:ot}=Se.useContext(Ou),_t=ot("upload",C),ft=ot(),ir=Wa(`${_t}-list`,`${_t}-list-${i}`),qe=so(M.map(be=>({key:be.uid,file:be})));let Dt={motionDeadline:2e3,motionName:`${_t}-${i==="picture-card"||i==="picture-circle"?"animate-inline":"animate"}`,keys:qe,motionAppear:Be};const ue=Se.useMemo(()=>{const be=Object.assign({},Ty(ft));return delete be.onAppearEnd,delete be.onEnterEnd,delete be.onLeaveEnd,be},[ft]);return i!=="picture-card"&&i!=="picture-circle"&&(Dt=Object.assign(Object.assign({},ue),Dt)),Se.createElement("div",{className:ir},Se.createElement(Ey,Object.assign({},Dt,{component:!1}),be=>{let{key:Te,file:Ae,className:Ye,style:mt}=be;return Se.createElement(c2,{key:Te,locale:o,prefixCls:_t,className:Ye,style:mt,file:Ae,items:M,progress:pe,listType:i,isImgUrl:b,showPreviewIcon:L,showRemoveIcon:z,showDownloadIcon:U,removeIcon:N,previewIcon:G,downloadIcon:ie,iconRender:st,actionIconRender:pt,itemRender:ve,onPreview:Ue,onDownload:$e,onClose:Re})}),Y&&Se.createElement(Sg,Object.assign({},Dt,{visible:me,forceRender:!0}),be=>{let{className:Te,style:Ae}=be;return $p(Y,Ye=>({className:Wa(Ye.className,Te),style:Object.assign(Object.assign(Object.assign({},Ae),{pointerEvents:Te?"none":void 0}),Ye.style)}))}))},u2=Se.forwardRef(h2),f2=u2;var d2=function(e,n,i,c){function h(m){return m instanceof i?m:new i(function(x){x(m)})}return new(i||(i=Promise))(function(m,x){function o(C){try{b(c.next(C))}catch(M){x(M)}}function S(C){try{b(c.throw(C))}catch(M){x(M)}}function b(C){C.done?m(C.value):h(C.value).then(o,S)}b((c=c.apply(e,n||[])).next())})};const Cc=`__LIST_IGNORE_${Date.now()}__`,p2=(e,n)=>{const{fileList:i,defaultFileList:c,onRemove:h,showUploadList:m=!0,listType:x="text",onPreview:o,onDownload:S,onChange:b,onDrop:C,previewFile:M,disabled:L,locale:z,iconRender:U,isImageUrl:N,progress:G,prefixCls:ie,className:pe,type:Y="select",children:me,style:ve,itemRender:we,maxCount:te,data:Be={},multiple:Ce=!1,hasControlInside:Ue=!0,action:$e="",accept:Re="",supportServerRender:st=!0,rootClassName:pt}=e,ot=Se.useContext(Sy),_t=L??ot,[ft,ir]=ky(c||[],{value:i,postState:Mt=>Mt??[]}),[qe,$t]=Se.useState("drop"),Dt=Se.useRef(null);Se.useMemo(()=>{const Mt=Date.now();(i||[]).forEach((Ut,gr)=>{!Ut.uid&&!Object.isFrozen(Ut)&&(Ut.uid=`__AUTO__${Mt}_${gr}__`)})},[i]);const ue=(Mt,Ut,gr)=>{let tr=so(Ut),it=!1;te===1?tr=tr.slice(-1):te&&(it=tr.length>te,tr=tr.slice(0,te)),yu.flushSync(()=>{ir(tr)});const Nt={file:Mt,fileList:tr};gr&&(Nt.event=gr),(!it||tr.some(jt=>jt.uid===Mt.uid))&&yu.flushSync(()=>{b?.(Nt)})},be=(Mt,Ut)=>d2(void 0,void 0,void 0,function*(){const{beforeUpload:gr,transformFile:tr}=e;let it=Mt;if(gr){const Nt=yield gr(Mt,Ut);if(Nt===!1)return!1;if(delete Mt[Cc],Nt===Cc)return Object.defineProperty(Mt,Cc,{value:!0,configurable:!0}),!1;typeof Nt=="object"&&Nt&&(it=Nt)}return tr&&(it=yield tr(it)),it}),Te=Mt=>{const Ut=Mt.filter(it=>!it.file[Cc]);if(!Ut.length)return;const gr=Ut.map(it=>lu(it.file));let tr=so(ft);gr.forEach(it=>{tr=cu(it,tr)}),gr.forEach((it,Nt)=>{let jt=it;if(Ut[Nt].parsedFile)it.status="uploading";else{const{originFileObj:Lr}=it;let sa;try{sa=new File([Lr],Lr.name,{type:Lr.type})}catch{sa=new Blob([Lr],{type:Lr.type}),sa.name=Lr.name,sa.lastModifiedDate=new Date,sa.lastModified=new Date().getTime()}sa.uid=it.uid,jt=sa}ue(jt,tr)})},Ae=(Mt,Ut,gr)=>{try{typeof Mt=="string"&&(Mt=JSON.parse(Mt))}catch{}if(!Qf(Ut,ft))return;const tr=lu(Ut);tr.status="done",tr.percent=100,tr.response=Mt,tr.xhr=gr;const it=cu(tr,ft);ue(tr,it)},Ye=(Mt,Ut)=>{if(!Qf(Ut,ft))return;const gr=lu(Ut);gr.status="uploading",gr.percent=Mt.percent;const tr=cu(gr,ft);ue(gr,tr,Mt)},mt=(Mt,Ut,gr)=>{if(!Qf(gr,ft))return;const tr=lu(gr);tr.error=Mt,tr.response=Ut,tr.status="error";const it=cu(tr,ft);ue(tr,it)},wt=Mt=>{let Ut;Promise.resolve(typeof h=="function"?h(Mt):h).then(gr=>{var tr;if(gr===!1)return;const it=t2(Mt,ft);it&&(Ut=Object.assign(Object.assign({},Mt),{status:"removed"}),ft?.forEach(Nt=>{const jt=Ut.uid!==void 0?"uid":"name";Nt[jt]===Ut[jt]&&!Object.isFrozen(Nt)&&(Nt.status="removed")}),(tr=Dt.current)===null||tr===void 0||tr.abort(Ut),ue(Ut,it))})},ut=Mt=>{$t(Mt.type),Mt.type==="drop"&&C?.(Mt)};Se.useImperativeHandle(n,()=>({onBatchStart:Te,onSuccess:Ae,onProgress:Ye,onError:mt,fileList:ft,upload:Dt.current}));const{getPrefixCls:rt,direction:Yt,upload:xe}=Se.useContext(Ou),er=rt("upload",ie),Jt=Object.assign(Object.assign({onBatchStart:Te,onError:mt,onProgress:Ye,onSuccess:Ae},e),{data:Be,multiple:Ce,action:$e,accept:Re,supportServerRender:st,prefixCls:er,disabled:_t,beforeUpload:be,onChange:void 0,hasControlInside:Ue});delete Jt.className,delete Jt.style,(!me||_t)&&delete Jt.id;const mr=`${er}-wrapper`,[Zt,Et,wr]=$v(er,mr),[Wr]=Cy("Upload",Ay.Upload),{showRemoveIcon:Xe,showPreviewIcon:Fr,showDownloadIcon:na,removeIcon:ur,previewIcon:qt,downloadIcon:Zr}=typeof m=="boolean"?{}:m,Sa=typeof Xe>"u"?!_t:!!Xe,ua=(Mt,Ut)=>m?Se.createElement(f2,{prefixCls:er,listType:x,items:ft,previewFile:M,onPreview:o,onDownload:S,onRemove:wt,showRemoveIcon:Sa,showPreviewIcon:Fr,showDownloadIcon:na,removeIcon:ur,previewIcon:qt,downloadIcon:Zr,iconRender:U,locale:Object.assign(Object.assign({},Wr),z),isImageUrl:N,progress:G,appendAction:Mt,appendActionVisible:Ut,itemRender:we,disabled:_t}):Mt,zr=Wa(mr,pe,pt,Et,wr,xe?.className,{[`${er}-rtl`]:Yt==="rtl",[`${er}-picture-card-wrapper`]:x==="picture-card",[`${er}-picture-circle-wrapper`]:x==="picture-circle"}),fa=Object.assign(Object.assign({},xe?.style),ve);if(Y==="drag"){const Mt=Wa(Et,er,`${er}-drag`,{[`${er}-drag-uploading`]:ft.some(Ut=>Ut.status==="uploading"),[`${er}-drag-hover`]:qe==="dragover",[`${er}-disabled`]:_t,[`${er}-rtl`]:Yt==="rtl"});return Zt(Se.createElement("span",{className:zr},Se.createElement("div",{className:Mt,style:fa,onDrop:ut,onDragOver:ut,onDragLeave:ut},Se.createElement(x0,Object.assign({},Jt,{ref:Dt,className:`${er}-btn`}),Se.createElement("div",{className:`${er}-drag-container`},me))),ua()))}const Xt=Wa(er,`${er}-select`,{[`${er}-disabled`]:_t}),lt=(Mt=>Se.createElement("div",{className:Xt,style:Mt},Se.createElement(x0,Object.assign({},Jt,{ref:Dt}))))(me?void 0:{display:"none"});return Zt(x==="picture-card"||x==="picture-circle"?Se.createElement("span",{className:zr},ua(lt,!!me)):Se.createElement("span",{className:zr},lt,ua()))},m2=Se.forwardRef(p2),Mg=m2;var g2=function(e,n){var i={};for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&n.indexOf(c)<0&&(i[c]=e[c]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var h=0,c=Object.getOwnPropertySymbols(e);h<c.length;h++)n.indexOf(c[h])<0&&Object.prototype.propertyIsEnumerable.call(e,c[h])&&(i[c[h]]=e[c[h]]);return i};const x2=Se.forwardRef((e,n)=>{var{style:i,height:c,hasControlInside:h=!1}=e,m=g2(e,["style","height","hasControlInside"]);return Se.createElement(Mg,Object.assign({ref:n,hasControlInside:h},m,{type:"drag",style:Object.assign(Object.assign({},i),{height:c})}))}),_2=x2,P0=Mg;P0.Dragger=_2;P0.LIST_IGNORE=Cc;const y2=P0;var v2={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M885.2 446.3l-.2-.8-112.2-285.1c-5-16.1-19.9-27.2-36.8-27.2H281.2c-17 0-32.1 11.3-36.9 27.6L139.4 443l-.3.7-.2.8c-1.3 4.9-1.7 9.9-1 14.8-.1 1.6-.2 3.2-.2 4.8V830a60.9 60.9 0 0060.8 60.8h627.2c33.5 0 60.8-27.3 60.9-60.8V464.1c0-1.3 0-2.6-.1-3.7.4-4.9 0-9.6-1.3-14.1zm-295.8-43l-.3 15.7c-.8 44.9-31.8 75.1-77.1 75.1-22.1 0-41.1-7.1-54.8-20.6S436 441.2 435.6 419l-.3-15.7H229.5L309 210h399.2l81.7 193.3H589.4zm-375 76.8h157.3c24.3 57.1 76 90.8 140.4 90.8 33.7 0 65-9.4 90.3-27.2 22.2-15.6 39.5-37.4 50.7-63.6h156.5V814H214.4V480.1z"}}]},name:"inbox",theme:"outlined"};const w2=v2;var b2=function(n,i){return Se.createElement(gl,Rn({},n,{ref:i,icon:w2}))};const T2=Se.forwardRef(b2),E2=({size:e=20})=>Ke.jsx("svg",{width:e,height:e,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:Ke.jsx("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M11.0267 1.13334C11.5534 0.501676 12.5792 0.933342 12.4959 1.75168L11.9076 7.50001H16.6667C16.8251 7.50007 16.9801 7.54524 17.1137 7.63024C17.2473 7.71523 17.3539 7.83653 17.4211 7.97993C17.4882 8.12333 17.5132 8.2829 17.4929 8.43994C17.4726 8.59698 17.4081 8.74501 17.3067 8.86668L8.97339 18.8667C8.44672 19.4983 7.42089 19.0667 7.50422 18.2483L8.09255 12.5H3.33339C3.17504 12.4999 3.01999 12.4548 2.88639 12.3698C2.75279 12.2848 2.64617 12.1635 2.57902 12.0201C2.51187 11.8767 2.48696 11.7171 2.50721 11.5601C2.52747 11.403 2.59205 11.255 2.69339 11.1333L11.0267 1.13334Z",fill:"currentColor"})}),S2=({size:e=20})=>Ke.jsxs("svg",{width:e,height:e,viewBox:"0 0 28 28",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[Ke.jsx("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M9.83847 8.58794C10.1411 8.46187 10.4827 8.4689 10.7798 8.60732L15.0763 10.6088C15.6604 10.8809 15.9133 11.5749 15.6412 12.159C15.3691 12.7431 14.6751 12.996 14.091 12.7239L11.4888 11.5117L11.653 20.2421L15.7503 22.1045V15.7497C15.7503 15.1053 16.2727 14.583 16.917 14.583C17.5613 14.583 18.0837 15.1053 18.0837 15.7497V22.1663L22.7503 20.2219V13.4163C22.7503 12.772 23.2727 12.2497 23.917 12.2497C24.5613 12.2497 25.0837 12.772 25.0837 13.4163V20.9997C25.0837 21.4707 24.8005 21.8955 24.3657 22.0766L17.3657 24.9933C17.0666 25.1179 16.7292 25.1125 16.4342 24.9784L10.5003 22.2812L4.56643 24.9784C4.20532 25.1426 3.78555 25.112 3.45204 24.8972C3.11854 24.6825 2.91699 24.313 2.91699 23.9163V12.2497C2.91699 11.7787 3.20019 11.3539 3.63494 11.1728L9.83847 8.58794ZM9.31945 20.2549L9.15297 11.4013L5.25033 13.0275V22.1045L9.31945 20.2549Z",fill:"currentColor"}),Ke.jsx("path",{d:"M19.8337 8.61425C20.478 8.61425 21.0003 8.09192 21.0003 7.44759C21.0003 6.80326 20.478 6.28092 19.8337 6.28092C19.1893 6.28092 18.667 6.80326 18.667 7.44759C18.667 8.09192 19.1893 8.61425 19.8337 8.61425Z",fill:"currentColor"}),Ke.jsx("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M19.8337 2.33301C17.2197 2.33301 15.167 4.52385 15.167 7.1293C15.167 7.85019 15.4274 8.59094 15.7195 9.21916C16.0229 9.8717 16.4198 10.5259 16.8094 11.1056C17.5898 12.2664 18.4067 13.2245 18.579 13.4238L18.5825 13.4278C18.89 13.7803 19.3411 13.9997 19.8337 13.9997C20.3262 13.9997 20.7773 13.7803 21.0848 13.4278L21.0883 13.4238C21.2606 13.2245 22.0776 12.2664 22.8579 11.1056C23.2476 10.5259 23.6444 9.8717 23.9478 9.21916C24.2399 8.59094 24.5003 7.85019 24.5003 7.1293C24.5003 4.52385 22.4476 2.33301 19.8337 2.33301ZM17.5003 7.1293C17.5003 5.7318 18.5876 4.66634 19.8337 4.66634C21.0797 4.66634 22.167 5.7318 22.167 7.1293C22.167 7.33968 22.0764 7.70972 21.832 8.23544C21.5989 8.73683 21.2738 9.2797 20.9214 9.80382C20.5368 10.376 20.1392 10.8972 19.8337 11.2802C19.5281 10.8972 19.1305 10.376 18.7459 9.80382C18.3936 9.2797 18.0684 8.73683 17.8353 8.23544C17.5909 7.70972 17.5003 7.33968 17.5003 7.1293Z",fill:"currentColor"})]}),k2=({size:e=20,fill:n="#1877F2"})=>Ke.jsx("svg",{width:e,height:e,viewBox:"0 0 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:Ke.jsx("path",{d:"M23.1875 5.25H10.9375C10.6094 5.25 10.3314 5.36393 10.1035 5.5918C9.87565 5.81966 9.76172 6.09766 9.76172 6.42578C9.76172 6.73568 9.87565 7.00456 10.1035 7.23242C10.3314 7.46029 10.6094 7.57422 10.9375 7.57422H23.1875C23.4974 7.57422 23.7663 7.46029 23.9941 7.23242C24.222 7.00456 24.3359 6.73568 24.3359 6.42578C24.3359 6.09766 24.222 5.81966 23.9941 5.5918C23.7663 5.36393 23.4974 5.25 23.1875 5.25ZM23.1875 12.25H10.9375C10.6094 12.25 10.3314 12.3639 10.1035 12.5918C9.87565 12.8197 9.76172 13.0977 9.76172 13.4258C9.76172 13.7357 9.87565 14.0046 10.1035 14.2324C10.3314 14.4603 10.6094 14.5742 10.9375 14.5742H23.1875C23.4974 14.5742 23.7663 14.4603 23.9941 14.2324C24.222 14.0046 24.3359 13.7357 24.3359 13.4258C24.3359 13.0977 24.222 12.8197 23.9941 12.5918C23.7663 12.3639 23.4974 12.25 23.1875 12.25ZM23.1875 19.25H10.9375C10.6094 19.25 10.3314 19.3639 10.1035 19.5918C9.87565 19.8197 9.76172 20.0977 9.76172 20.4258C9.76172 20.7357 9.87565 21.0046 10.1035 21.2324C10.3314 21.4603 10.6094 21.5742 10.9375 21.5742H23.1875C23.4974 21.5742 23.7663 21.4603 23.9941 21.2324C24.222 21.0046 24.3359 20.7357 24.3359 20.4258C24.3359 20.0977 24.222 19.8197 23.9941 19.5918C23.7663 19.3639 23.4974 19.25 23.1875 19.25ZM5.25 18.6758C5.72396 18.6758 6.13411 18.8444 6.48047 19.1816C6.82682 19.5189 7 19.9336 7 20.4258C7 20.8997 6.82682 21.3099 6.48047 21.6562C6.13411 22.0026 5.72396 22.1758 5.25 22.1758C4.75781 22.1758 4.3431 22.0026 4.00586 21.6562C3.66862 21.3099 3.5 20.8997 3.5 20.4258C3.5 19.9336 3.66862 19.5189 4.00586 19.1816C4.3431 18.8444 4.75781 18.6758 5.25 18.6758ZM5.25 15.1758C4.75781 15.1758 4.3431 15.0026 4.00586 14.6562C3.66862 14.3099 3.5 13.8997 3.5 13.4258C3.5 12.9336 3.66862 12.5189 4.00586 12.1816C4.3431 11.8444 4.75781 11.6758 5.25 11.6758C5.72396 11.6758 6.13411 11.8444 6.48047 12.1816C6.82682 12.5189 7 12.9336 7 13.4258C7 13.8997 6.82682 14.3099 6.48047 14.6562C6.13411 15.0026 5.72396 15.1758 5.25 15.1758ZM5.25 8.17578C4.75781 8.17578 4.3431 8.0026 4.00586 7.65625C3.66862 7.3099 3.5 6.89974 3.5 6.42578C3.5 5.93359 3.66862 5.51888 4.00586 5.18164C4.3431 4.8444 4.75781 4.67578 5.25 4.67578C5.72396 4.67578 6.13411 4.8444 6.48047 5.18164C6.82682 5.51888 7 5.93359 7 6.42578C7 6.89974 6.82682 7.3099 6.48047 7.65625C6.13411 8.0026 5.72396 8.17578 5.25 8.17578Z",fill:"currentColor"})}),C2=({size:e=32})=>Ke.jsxs("svg",{width:e-1,height:e,viewBox:"0 0 31 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[Ke.jsx("ellipse",{cx:"15.5002",cy:"14.6668",rx:"5.16667",ry:"5.33333",fill:"white"}),Ke.jsx("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M4.77881 13.8369C4.77881 7.71569 9.45773 2.49951 15.5 2.49951C21.5423 2.49951 26.2212 7.71569 26.2212 13.8369C26.2212 15.6318 25.6013 17.3884 24.9844 18.7581C24.3325 20.2055 23.4909 21.6336 22.6828 22.8745C21.0637 25.3608 19.3742 27.4058 19.0124 27.8378L19.0103 27.8403L19.0032 27.8488L19.0013 27.851C18.1452 28.8639 16.8841 29.5005 15.5 29.5005C14.1159 29.5005 12.8548 28.8639 11.9987 27.851L11.9968 27.8487L11.9896 27.8402L11.9876 27.8378C11.6259 27.4058 9.93637 25.3608 8.31723 22.8745C7.50914 21.6336 6.66752 20.2055 6.0156 18.7581C5.39871 17.3884 4.77881 15.6318 4.77881 13.8369ZM15.5 13.4007C14.9114 13.4007 14.4343 13.8933 14.4343 14.5008C14.4343 15.1084 14.9114 15.6009 15.5 15.6009C16.0886 15.6009 16.5657 15.1084 16.5657 14.5008C16.5657 13.8933 16.0886 13.4007 15.5 13.4007ZM11.851 14.5008C11.851 12.4205 13.4847 10.7341 15.5 10.7341C17.5153 10.7341 19.1491 12.4205 19.1491 14.5008C19.1491 16.5811 17.5153 18.2676 15.5 18.2676C13.4847 18.2676 11.851 16.5811 11.851 14.5008Z",fill:"#22C55E"})]});function A2({des:e}){return Ke.jsxs("div",{className:"relative",children:[Ke.jsx("span",{className:"absolute whitespace-nowrap top-[-50%] bg-white block px-2 rounded-md -left-[50%] shadow-sm font-medium",children:e}),Ke.jsx(C2,{})]})}function e0({children:e,className:n}){return Ke.jsx(lo,{gutter:38,className:"mt-3 first:mt-0 "+n,children:e})}const I2=[{label:"Hot ng",value:"Active"},{label:"Kha",value:"Lock"}],F2=[{label:"Thm khch hng",value:"add"},{label:"Chn khch hng",value:"Choose"},{label:"Import khch hng",value:"Import"}],M0=[{title:"M khch hng",dataIndex:"customer_code",key:"customercode"},{title:"Tn khch hng",dataIndex:"customer_name",key:"customername"}],Dg=[{title:"a ch",dataIndex:"display_address",key:"display_address"},{title:"S in thoi",dataIndex:"phone_number",key:"phone_number"}],P2=[{label:"1",value:"1"},{label:"2",value:"2"},{label:"3",value:"3"},{label:"4",value:"4"}],M2={customer_type:"Loi khch hng",customer_group:"Nhm khch hng",city:"Tnh/Thnh ph",district:"Qun/huyn",ward:"Phng/x"},D2=[{label:"Khng gii hn ",value:null},{label:"Th 2",value:"Th 2"},{label:"Th 3",value:"Th 3"},{label:"Th 4",value:"Th 4"},{label:"Th 5",value:"Th 5"},{label:"Th 6",value:"Th 6"},{label:"Th 7",value:"Th 7"},{label:"Ch nht",value:"Ch nht"}];function L2({form:e}){console.log(e);const[n,i]=Se.useState("");let c=Ny(n);const[h,m]=Se.useState([]),[x,o]=Se.useState([]),[S,b]=Se.useState();return Se.useState(),Se.useEffect(()=>{(async()=>{let C=await an.get("/api/method/mbw_dms.api.router.get_team_sale");console.log("tree",Hp({data:C.result.map(M=>({title:M.name,value:M.name,...M})),keyValue:"value",parentField:"parent_sales_person"})),m(Hp({data:C.result.map(M=>({title:M.name,value:M.name,...M})),keyValue:"value",parentField:"parent_sales_person"}))})()},[]),Se.useEffect(()=>{(async()=>{let C=await an.get("/api/method/mbw_dms.api.router.get_sale_person",{params:{team_sale:S,key_search:c}}),{message:M}=C;o(M.map(L=>({value:L.employee_code,label:L.employee_name||L.employee_code})))})()},[S,c]),Ke.jsxs("div",{className:"p-4 pt-[43px] pb-[58px]",children:[Ke.jsxs(e0,{children:[Ke.jsx(Ti,{span:12,children:Ke.jsx(Ri,{label:"M tuyn",name:"channel_code",required:!0,children:Ke.jsx(vu,{})})}),Ke.jsx(Ti,{span:12,children:Ke.jsx(Ri,{label:"Tn tuyn",name:"channel_name",required:!0,children:Ke.jsx(vu,{})})})]}),Ke.jsxs(e0,{children:[Ke.jsx(Ti,{span:12,children:Ke.jsx(Ri,{label:"Team sale",name:"team_sale",required:!0,children:Ke.jsx(Uy,{showSearch:!0,treeData:h,onChange:C=>{b(C),e.setFieldsValue({employee:void 0})}})})}),Ke.jsx(Ti,{span:12,children:Ke.jsx(Ri,{label:"Nhn vin",name:"employee",required:!0,children:Ke.jsx(ts,{showSearch:!0,onSearch:i,options:x,allowClear:!0})})})]}),Ke.jsxs(e0,{children:[Ke.jsx(Ti,{span:12,children:Ke.jsx(Ri,{label:"Ngy i tuyn",name:"travel_date",required:!0,children:Ke.jsx(ts,{options:D2})})}),Ke.jsx(Ti,{span:12,children:Ke.jsx(Ri,{label:"Trng thi",name:"status",children:Ke.jsx(ts,{options:I2,defaultValue:"Active"})})})]})]})}function R2({data:e,handleData:n}){const i=[{title:"Stt",dataIndex:"stt",key:"stt",render:(c,h,m)=>m+1},...M0,...Dg,{title:"Tn sut",dataIndex:"frequency",key:"frequency",render:(c,h)=>Ke.jsx(ts,{mode:"multiple",options:P2,style:{width:"100%"},placeholder:"Chn tn sut",onChange:m=>{n(x=>x.map(o=>(o.customer_id==h.customer_id&&(o.frequency=m.toString().replaceAll(",",";")),o)))},defaultValue:c?c.split(";"):[]})},{title:"Hnh ng",dataIndex:"",key:"action",render:(c,h)=>Ke.jsx("div",{className:"flex justify-center",onClick:()=>{n(m=>[...m.filter(x=>x.customer_code!=h.customer_code)])},children:Ke.jsx(Ig,{})})}];return Ke.jsx("div",{className:"p-4",children:Ke.jsx(F0,{columns:i,dataSource:e,pagination:!1})})}const O2=Se.createContext(null);function B2(e,n){const i=Array.isArray(e)?e[0]:e?e.x:0,c=Array.isArray(e)?e[1]:e?e.y:0,h=Array.isArray(n)?n[0]:n?n.x:0,m=Array.isArray(n)?n[1]:n?n.y:0;return i===h&&c===m}function $i(e,n){if(e===n)return!0;if(!e||!n)return!1;if(Array.isArray(e)){if(!Array.isArray(n)||e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(!$i(e[i],n[i]))return!1;return!0}else if(Array.isArray(n))return!1;if(typeof e=="object"&&typeof n=="object"){const i=Object.keys(e),c=Object.keys(n);if(i.length!==c.length)return!1;for(const h of i)if(!n.hasOwnProperty(h)||!$i(e[h],n[h]))return!1;return!0}return!1}function z2(e){const n=e.clone();return n.pixelsToGLUnits=e.pixelsToGLUnits,n}function em(e,n){if(!e.getProjection)return;const i=e.getProjection(),c=n.getProjection();$i(i,c)||n.setProjection(i)}function tm(e){return{longitude:e.center.lng,latitude:e.center.lat,zoom:e.zoom,pitch:e.pitch,bearing:e.bearing,padding:e.padding}}function rm(e,n){const i=n.viewState||n;let c=!1;if("longitude"in i&&"latitude"in i){const h=e.center;e.center=new h.constructor(i.longitude,i.latitude),c=c||h!==e.center}if("zoom"in i){const h=e.zoom;e.zoom=i.zoom,c=c||h!==e.zoom}if("bearing"in i){const h=e.bearing;e.bearing=i.bearing,c=c||h!==e.bearing}if("pitch"in i){const h=e.pitch;e.pitch=i.pitch,c=c||h!==e.pitch}return i.padding&&!e.isPaddingEqual(i.padding)&&(c=!0,e.padding=i.padding),c}const N2=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function am(e){if(!e)return null;if(typeof e=="string"||("toJS"in e&&(e=e.toJS()),!e.layers))return e;const n={};for(const c of e.layers)n[c.id]=c;const i=e.layers.map(c=>{let h=null;"interactive"in c&&(h=Object.assign({},c),delete h.interactive);const m=n[c.ref];if(m){h=h||Object.assign({},c),delete h.ref;for(const x of N2)x in m&&(h[x]=m[x])}return h||c});return{...e,layers:i}}var im={};const nm={version:8,sources:{},layers:[]},sm={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},t0={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},om={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},U2=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],V2=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class dl{constructor(n,i,c){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=h=>{const m=this.props[om[h.type]];m?m(h):h.type==="error"&&console.error(h.error)},this._onPointerEvent=h=>{(h.type==="mousemove"||h.type==="mouseout")&&this._updateHover(h);const m=this.props[sm[h.type]];m&&(this.props.interactiveLayerIds&&h.type!=="mouseover"&&h.type!=="mouseout"&&(h.features=this._hoveredFeatures||this._queryRenderedFeatures(h.point)),m(h),delete h.features)},this._onCameraEvent=h=>{if(!this._internalUpdate){const m=this.props[t0[h.type]];m&&m(h)}h.type in this._deferredEvents&&(this._deferredEvents[h.type]=!1)},this._MapClass=n,this.props=i,this._initialize(c)}get map(){return this._map}get transform(){return this._renderTransform}setProps(n){const i=this.props;this.props=n;const c=this._updateSettings(n,i);c&&this._createShadowTransform(this._map);const h=this._updateSize(n),m=this._updateViewState(n,!0);this._updateStyle(n,i),this._updateStyleComponents(n,i),this._updateHandlers(n,i),(c||h||m&&!this._map.isMoving())&&this.redraw()}static reuse(n,i){const c=dl.savedMaps.pop();if(!c)return null;const h=c.map,m=h.getContainer();for(i.className=m.className;m.childNodes.length>0;)i.appendChild(m.childNodes[0]);h._container=i;const x=h._resizeObserver;x&&(x.disconnect(),x.observe(i)),c.setProps({...n,styleDiffing:!1}),h.resize();const{initialViewState:o}=n;return o&&(o.bounds?h.fitBounds(o.bounds,{...o.fitBoundsOptions,duration:0}):c._updateViewState(o,!1)),h.isStyleLoaded()?h.fire("load"):h.once("styledata",()=>h.fire("load")),h._update(),c}_initialize(n){const{props:i}=this,{mapStyle:c=nm}=i,h={...i,...i.initialViewState,accessToken:i.mapboxAccessToken||$2()||null,container:n,style:am(c)},m=h.initialViewState||h.viewState||h;if(Object.assign(h,{center:[m.longitude||0,m.latitude||0],zoom:m.zoom||0,pitch:m.pitch||0,bearing:m.bearing||0}),i.gl){const C=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=C,i.gl)}const x=new this._MapClass(h);m.padding&&x.setPadding(m.padding),i.cursor&&(x.getCanvas().style.cursor=i.cursor),this._createShadowTransform(x);const o=x._render;x._render=C=>{this._inRender=!0,o.call(x,C),this._inRender=!1};const S=x._renderTaskQueue.run;x._renderTaskQueue.run=C=>{S.call(x._renderTaskQueue,C),this._onBeforeRepaint()},x.on("render",()=>this._onAfterRepaint());const b=x.fire;x.fire=this._fireEvent.bind(this,b),x.on("resize",()=>{this._renderTransform.resize(x.transform.width,x.transform.height)}),x.on("styledata",()=>{this._updateStyleComponents(this.props,{}),em(x.transform,this._renderTransform)}),x.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const C in sm)x.on(C,this._onPointerEvent);for(const C in t0)x.on(C,this._onCameraEvent);for(const C in om)x.on(C,this._onEvent);this._map=x}recycle(){const i=this.map.getContainer().querySelector("[mapboxgl-children]");i?.remove(),dl.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const n=this._map;!this._inRender&&n.style&&(n._frame&&(n._frame.cancel(),n._frame=null),n._render())}_createShadowTransform(n){const i=z2(n.transform);n.painter.transform=i,this._renderTransform=i}_updateSize(n){const{viewState:i}=n;if(i){const c=this._map;if(i.width!==c.transform.width||i.height!==c.transform.height)return c.resize(),!0}return!1}_updateViewState(n,i){if(this._internalUpdate)return!1;const c=this._map,h=this._renderTransform,{zoom:m,pitch:x,bearing:o}=h,S=c.isMoving();S&&(h.cameraElevationReference="sea");const b=rm(h,{...tm(c.transform),...n});if(S&&(h.cameraElevationReference="ground"),b&&i){const C=this._deferredEvents;C.move=!0,C.zoom||(C.zoom=m!==h.zoom),C.rotate||(C.rotate=o!==h.bearing),C.pitch||(C.pitch=x!==h.pitch)}return S||rm(c.transform,n),b}_updateSettings(n,i){const c=this._map;let h=!1;for(const m of U2)if(m in n&&!$i(n[m],i[m])){h=!0;const x=c[`set${m[0].toUpperCase()}${m.slice(1)}`];x?.call(c,n[m])}return h}_updateStyle(n,i){if(n.cursor!==i.cursor&&(this._map.getCanvas().style.cursor=n.cursor||""),n.mapStyle!==i.mapStyle){const{mapStyle:c=nm,styleDiffing:h=!0}=n,m={diff:h};return"localIdeographFontFamily"in n&&(m.localIdeographFontFamily=n.localIdeographFontFamily),this._map.setStyle(am(c),m),!0}return!1}_updateStyleComponents(n,i){const c=this._map;let h=!1;return c.isStyleLoaded()&&("light"in n&&c.setLight&&!$i(n.light,i.light)&&(h=!0,c.setLight(n.light)),"fog"in n&&c.setFog&&!$i(n.fog,i.fog)&&(h=!0,c.setFog(n.fog)),"terrain"in n&&c.setTerrain&&!$i(n.terrain,i.terrain)&&(!n.terrain||c.getSource(n.terrain.source))&&(h=!0,c.setTerrain(n.terrain))),h}_updateHandlers(n,i){var c,h;const m=this._map;let x=!1;for(const o of V2){const S=(c=n[o])!==null&&c!==void 0?c:!0,b=(h=i[o])!==null&&h!==void 0?h:!0;$i(S,b)||(x=!0,S?m[o].enable(S):m[o].disable())}return x}_queryRenderedFeatures(n){const i=this._map,c=i.transform,{interactiveLayerIds:h=[]}=this.props;try{return i.transform=this._renderTransform,i.queryRenderedFeatures(n,{layers:h.filter(i.getLayer.bind(i))})}catch{return[]}finally{i.transform=c}}_updateHover(n){var i;const{props:c}=this;if(c.interactiveLayerIds&&(c.onMouseMove||c.onMouseEnter||c.onMouseLeave)){const m=n.type,x=((i=this._hoveredFeatures)===null||i===void 0?void 0:i.length)>0,o=this._queryRenderedFeatures(n.point),S=o.length>0;!S&&x&&(n.type="mouseleave",this._onPointerEvent(n)),this._hoveredFeatures=o,S&&!x&&(n.type="mouseenter",this._onPointerEvent(n)),n.type=m}else this._hoveredFeatures=null}_fireEvent(n,i,c){const h=this._map,m=h.transform,x=typeof i=="string"?i:i.type;return x==="move"&&this._updateViewState(this.props,!1),x in t0&&(typeof i=="object"&&(i.viewState=tm(m)),this._map.isMoving())?(h.transform=this._renderTransform,n.call(h,i,c),h.transform=m,h):(n.call(h,i,c),h)}_onBeforeRepaint(){const n=this._map;this._internalUpdate=!0;for(const c in this._deferredEvents)this._deferredEvents[c]&&n.fire(c);this._internalUpdate=!1;const i=this._map.transform;n.transform=this._renderTransform,this._onAfterRepaint=()=>{em(this._renderTransform,i),n.transform=i}}}dl.savedMaps=[];function $2(){let e=null;if(typeof location<"u"){const n=/access_token=([^&\/]*)/.exec(location.search);e=n&&n[1]}try{e=e||im.MapboxAccessToken}catch{}try{e=e||im.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return e}const j2=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function G2(e){if(!e)return null;const n=e.map,i={getMap:()=>n,getCenter:()=>e.transform.center,getZoom:()=>e.transform.zoom,getBearing:()=>e.transform.bearing,getPitch:()=>e.transform.pitch,getPadding:()=>e.transform.padding,getBounds:()=>e.transform.getBounds(),project:c=>{const h=n.transform;n.transform=e.transform;const m=n.project(c);return n.transform=h,m},unproject:c=>{const h=n.transform;n.transform=e.transform;const m=n.unproject(c);return n.transform=h,m},queryTerrainElevation:(c,h)=>{const m=n.transform;n.transform=e.transform;const x=n.queryTerrainElevation(c,h);return n.transform=m,x},queryRenderedFeatures:(c,h)=>{const m=n.transform;n.transform=e.transform;const x=n.queryRenderedFeatures(c,h);return n.transform=m,x}};for(const c of H2(n))!(c in i)&&!j2.includes(c)&&(i[c]=n[c].bind(n));return i}function H2(e){const n=new Set;let i=e;for(;i;){for(const c of Object.getOwnPropertyNames(i))c[0]!=="_"&&typeof e[c]=="function"&&c!=="fire"&&c!=="setEventedParent"&&n.add(c);i=Object.getPrototypeOf(i)}return Array.from(n)}const q2=typeof document<"u"?Se.useLayoutEffect:Se.useEffect,W2=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function Z2(e,n){for(const c of W2)c in n&&(e[c]=n[c]);const{RTLTextPlugin:i="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=n;i&&e.getRTLTextPluginStatus&&e.getRTLTextPluginStatus()==="unavailable"&&e.setRTLTextPlugin(i,c=>{c&&console.error(c)},!0)}const xl=Se.createContext(null);function X2(e,n,i){const c=Se.useContext(O2),[h,m]=Se.useState(null),x=Se.useRef(),{current:o}=Se.useRef({mapLib:null,map:null});Se.useEffect(()=>{const C=e.mapLib;let M=!0,L;return Promise.resolve(C||i).then(z=>{if(!M)return;if(!z)throw new Error("Invalid mapLib");const U="Map"in z?z:z.default;if(!U.Map)throw new Error("Invalid mapLib");if(Z2(U,e),!U.supported||U.supported(e))e.reuseMaps&&(L=dl.reuse(e,x.current)),L||(L=new dl(U.Map,e,x.current)),o.map=G2(L),o.mapLib=U,m(L),c?.onMapMount(o.map,e.id);else throw new Error("Map is not supported by this browser")}).catch(z=>{const{onError:U}=e;U?U({type:"error",target:null,originalEvent:null,error:z}):console.error(z)}),()=>{M=!1,L&&(c?.onMapUnmount(e.id),e.reuseMaps?L.recycle():L.destroy())}},[]),q2(()=>{h&&h.setProps(e)}),Se.useImperativeHandle(n,()=>o.map,[h]);const S=Se.useMemo(()=>({position:"relative",width:"100%",height:"100%",...e.style}),[e.style]),b={height:"100%"};return Se.createElement("div",{id:e.id,ref:x,style:S},h&&Se.createElement(xl.Provider,{value:o},Se.createElement("div",{"mapboxgl-children":"",style:b},e.children)))}const K2=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function mo(e,n){if(!e||!n)return;const i=e.style;for(const c in n){const h=n[c];Number.isFinite(h)&&!K2.test(c)?i[c]=`${h}px`:i[c]=h}}function Y2(e,n){const{map:i,mapLib:c}=Se.useContext(xl),h=Se.useRef({props:e});h.current.props=e;const m=Se.useMemo(()=>{let N=!1;Se.Children.forEach(e.children,pe=>{pe&&(N=!0)});const G={...e,element:N?document.createElement("div"):null},ie=new c.Marker(G);return ie.setLngLat([e.longitude,e.latitude]),ie.getElement().addEventListener("click",pe=>{var Y,me;(me=(Y=h.current.props).onClick)===null||me===void 0||me.call(Y,{type:"click",target:ie,originalEvent:pe})}),ie.on("dragstart",pe=>{var Y,me;const ve=pe;ve.lngLat=m.getLngLat(),(me=(Y=h.current.props).onDragStart)===null||me===void 0||me.call(Y,ve)}),ie.on("drag",pe=>{var Y,me;const ve=pe;ve.lngLat=m.getLngLat(),(me=(Y=h.current.props).onDrag)===null||me===void 0||me.call(Y,ve)}),ie.on("dragend",pe=>{var Y,me;const ve=pe;ve.lngLat=m.getLngLat(),(me=(Y=h.current.props).onDragEnd)===null||me===void 0||me.call(Y,ve)}),ie},[]);Se.useEffect(()=>(m.addTo(i.getMap()),()=>{m.remove()}),[]);const{longitude:x,latitude:o,offset:S,style:b,draggable:C=!1,popup:M=null,rotation:L=0,rotationAlignment:z="auto",pitchAlignment:U="auto"}=e;return Se.useEffect(()=>{mo(m.getElement(),b)},[b]),Se.useImperativeHandle(n,()=>m,[]),(m.getLngLat().lng!==x||m.getLngLat().lat!==o)&&m.setLngLat([x,o]),S&&!B2(m.getOffset(),S)&&m.setOffset(S),m.isDraggable()!==C&&m.setDraggable(C),m.getRotation()!==L&&m.setRotation(L),m.getRotationAlignment()!==z&&m.setRotationAlignment(z),m.getPitchAlignment()!==U&&m.setPitchAlignment(U),m.getPopup()!==M&&m.setPopup(M),yu.createPortal(e.children,m.getElement())}const J2=Se.memo(Se.forwardRef(Y2));function lm(e){return new Set(e?e.trim().split(/\s+/):[])}function Q2(e,n){const{map:i,mapLib:c}=Se.useContext(xl),h=Se.useMemo(()=>document.createElement("div"),[]),m=Se.useRef({props:e});m.current.props=e;const x=Se.useMemo(()=>{const o={...e},S=new c.Popup(o);return S.setLngLat([e.longitude,e.latitude]),S.once("open",b=>{var C,M;(M=(C=m.current.props).onOpen)===null||M===void 0||M.call(C,b)}),S},[]);if(Se.useEffect(()=>{const o=S=>{var b,C;(C=(b=m.current.props).onClose)===null||C===void 0||C.call(b,S)};return x.on("close",o),x.setDOMContent(h).addTo(i.getMap()),()=>{x.off("close",o),x.isOpen()&&x.remove()}},[]),Se.useEffect(()=>{mo(x.getElement(),e.style)},[e.style]),Se.useImperativeHandle(n,()=>x,[]),x.isOpen()&&((x.getLngLat().lng!==e.longitude||x.getLngLat().lat!==e.latitude)&&x.setLngLat([e.longitude,e.latitude]),e.offset&&!$i(x.options.offset,e.offset)&&x.setOffset(e.offset),(x.options.anchor!==e.anchor||x.options.maxWidth!==e.maxWidth)&&(x.options.anchor=e.anchor,x.setMaxWidth(e.maxWidth)),x.options.className!==e.className)){const o=lm(x.options.className),S=lm(e.className);for(const b of o)S.has(b)||x.removeClassName(b);for(const b of S)o.has(b)||x.addClassName(b);x.options.className=e.className}return yu.createPortal(e.children,h)}Se.memo(Se.forwardRef(Q2));function Xc(e,n,i,c){const h=Se.useContext(xl),m=Se.useMemo(()=>e(h),[]);return Se.useEffect(()=>{const x=c||i||n,o=typeof n=="function"&&typeof i=="function"?n:null,S=typeof i=="function"?i:typeof n=="function"?n:null,{map:b}=h;return b.hasControl(m)||(b.addControl(m,x?.position),o&&o(h)),()=>{S&&S(h),b.hasControl(m)&&b.removeControl(m)}},[]),m}function ew(e){const n=Xc(({mapLib:i})=>new i.AttributionControl(e),{position:e.position});return Se.useEffect(()=>{mo(n._container,e.style)},[e.style]),null}Se.memo(ew);function tw(e){const n=Xc(({mapLib:i})=>new i.FullscreenControl({container:e.containerId&&document.getElementById(e.containerId)}),{position:e.position});return Se.useEffect(()=>{mo(n._controlContainer,e.style)},[e.style]),null}Se.memo(tw);function rw(e,n){const i=Se.useRef({props:e}),c=Xc(({mapLib:h})=>{const m=new h.GeolocateControl(e),x=m._setupUI;return m._setupUI=o=>{m._container.hasChildNodes()||x(o)},m.on("geolocate",o=>{var S,b;(b=(S=i.current.props).onGeolocate)===null||b===void 0||b.call(S,o)}),m.on("error",o=>{var S,b;(b=(S=i.current.props).onError)===null||b===void 0||b.call(S,o)}),m.on("outofmaxbounds",o=>{var S,b;(b=(S=i.current.props).onOutOfMaxBounds)===null||b===void 0||b.call(S,o)}),m.on("trackuserlocationstart",o=>{var S,b;(b=(S=i.current.props).onTrackUserLocationStart)===null||b===void 0||b.call(S,o)}),m.on("trackuserlocationend",o=>{var S,b;(b=(S=i.current.props).onTrackUserLocationEnd)===null||b===void 0||b.call(S,o)}),m},{position:e.position});return i.current.props=e,Se.useImperativeHandle(n,()=>c,[]),Se.useEffect(()=>{mo(c._container,e.style)},[e.style]),null}Se.memo(Se.forwardRef(rw));function aw(e){const n=Xc(({mapLib:i})=>new i.NavigationControl(e),{position:e.position});return Se.useEffect(()=>{mo(n._container,e.style)},[e.style]),null}Se.memo(aw);function iw(e){const n=Xc(({mapLib:m})=>new m.ScaleControl(e),{position:e.position}),i=Se.useRef(e),c=i.current;i.current=e;const{style:h}=e;return e.maxWidth!==void 0&&e.maxWidth!==c.maxWidth&&(n.options.maxWidth=e.maxWidth),e.unit!==void 0&&e.unit!==c.unit&&n.setUnit(e.unit),Se.useEffect(()=>{mo(n._container,h)},[h]),null}Se.memo(iw);function Eu(e,n){if(!e)throw new Error(n)}function nw(e,n,i,c){if(Eu(i.id===c.id,"layer id changed"),Eu(i.type===c.type,"layer type changed"),i.type==="custom"||c.type==="custom")return;const{layout:h={},paint:m={},filter:x,minzoom:o,maxzoom:S,beforeId:b}=i;if(b!==c.beforeId&&e.moveLayer(n,b),h!==c.layout){const C=c.layout||{};for(const M in h)$i(h[M],C[M])||e.setLayoutProperty(n,M,h[M]);for(const M in C)h.hasOwnProperty(M)||e.setLayoutProperty(n,M,void 0)}if(m!==c.paint){const C=c.paint||{};for(const M in m)$i(m[M],C[M])||e.setPaintProperty(n,M,m[M]);for(const M in C)m.hasOwnProperty(M)||e.setPaintProperty(n,M,void 0)}$i(x,c.filter)||e.setFilter(n,x),(o!==c.minzoom||S!==c.maxzoom)&&e.setLayerZoomRange(n,o,S)}function sw(e,n,i){if(e.style&&e.style._loaded&&(!("source"in i)||e.getSource(i.source))){const c={...i,id:n};delete c.beforeId,e.addLayer(c,i.beforeId)}}let ow=0;function lw(e){const n=Se.useContext(xl).map.getMap(),i=Se.useRef(e),[,c]=Se.useState(0),h=Se.useMemo(()=>e.id||`jsx-layer-${ow++}`,[]);if(Se.useEffect(()=>{if(n){const x=()=>c(o=>o+1);return n.on("styledata",x),x(),()=>{n.off("styledata",x),n.style&&n.style._loaded&&n.getLayer(h)&&n.removeLayer(h)}}},[n]),n&&n.style&&n.getLayer(h))try{nw(n,h,e,i.current)}catch(x){console.warn(x)}else sw(n,h,e);return i.current=e,null}let cw=0;function hw(e,n,i){if(e.style&&e.style._loaded){const c={...i};return delete c.id,delete c.children,e.addSource(n,c),e.getSource(n)}return null}function uw(e,n,i){Eu(n.id===i.id,"source id changed"),Eu(n.type===i.type,"source type changed");let c="",h=0;for(const x in n)x!=="children"&&x!=="id"&&!$i(i[x],n[x])&&(c=x,h++);if(!h)return;const m=n.type;if(m==="geojson")e.setData(n.data);else if(m==="image")e.updateImage({url:n.url,coordinates:n.coordinates});else if("setCoordinates"in e&&h===1&&c==="coordinates")e.setCoordinates(n.coordinates);else if("setUrl"in e)switch(c){case"url":e.setUrl(n.url);break;case"tiles":e.setTiles(n.tiles);break}else console.warn(`Unable to update <Source> prop: ${c}`)}function fw(e){const n=Se.useContext(xl).map.getMap(),i=Se.useRef(e),[,c]=Se.useState(0),h=Se.useMemo(()=>e.id||`jsx-source-${cw++}`,[]);Se.useEffect(()=>{if(n){const x=()=>setTimeout(()=>c(o=>o+1),0);return n.on("styledata",x),x(),()=>{var o;if(n.off("styledata",x),n.style&&n.style._loaded&&n.getSource(h)){const S=(o=n.getStyle())===null||o===void 0?void 0:o.layers;if(S)for(const b of S)b.source===h&&n.removeLayer(b.id);n.removeSource(h)}}}},[n]);let m=n&&n.style&&n.getSource(h);return m?uw(m,e,i.current):m=hw(n,h,e),i.current=e,m&&Se.Children.map(e.children,x=>x&&Se.cloneElement(x,{source:h}))||null}const dw=Iy(()=>import("./mapbox-gl-olW7wZPc.js").then(e=>e.m),__vite__mapDeps([0,1,2])),pw=Se.forwardRef(function(n,i){return X2(n,i,dw)}),mw=J2,gw=lw,xw=fw;var Lg={exports:{}};(function(e,n){(function(i,c){e.exports=c()})(Fy,function(){var i,c,h;function m(o,S){if(!i)i=S;else if(!c)c=S;else{var b="var sharedChunk = {}; ("+i+")(sharedChunk); ("+c+")(sharedChunk);",C={};i(C),h=S(C),typeof window<"u"&&(h.workerUrl=window.URL.createObjectURL(new Blob([b],{type:"text/javascript"})))}}m(["exports"],function(o){function S(a,t,s,u){return new(s||(s=Promise))(function(d,_){function v(I){try{k(u.next(I))}catch(P){_(P)}}function w(I){try{k(u.throw(I))}catch(P){_(P)}}function k(I){var P;I.done?d(I.value):(P=I.value,P instanceof s?P:new s(function(O){O(P)})).then(v,w)}k((u=u.apply(a,t||[])).next())})}function b(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}typeof SuppressedError=="function"&&SuppressedError;var C=M;function M(a,t){this.x=a,this.y=t}M.prototype={clone:function(){return new M(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,t){return this.clone()._rotateAround(a,t)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var t=a.x-this.x,s=a.y-this.y;return t*t+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,t){return Math.atan2(this.x*t-this.y*a,this.x*a+this.y*t)},_matMult:function(a){var t=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=t,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var t=Math.cos(a),s=Math.sin(a),u=s*this.x+t*this.y;return this.x=t*this.x-s*this.y,this.y=u,this},_rotateAround:function(a,t){var s=Math.cos(a),u=Math.sin(a),d=t.y+u*(this.x-t.x)+s*(this.y-t.y);return this.x=t.x+s*(this.x-t.x)-u*(this.y-t.y),this.y=d,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},M.convert=function(a){return a instanceof M?a:Array.isArray(a)?new M(a[0],a[1]):a};var L=b(C),z=U;function U(a,t,s,u){this.cx=3*a,this.bx=3*(s-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(u-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=t,this.p2x=s,this.p2y=u}U.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,t){if(t===void 0&&(t=1e-6),a<0)return 0;if(a>1)return 1;for(var s=a,u=0;u<8;u++){var d=this.sampleCurveX(s)-a;if(Math.abs(d)<t)return s;var _=this.sampleCurveDerivativeX(s);if(Math.abs(_)<1e-6)break;s-=d/_}var v=0,w=1;for(s=a,u=0;u<20&&(d=this.sampleCurveX(s),!(Math.abs(d-a)<t));u++)a>d?v=s:w=s,s=.5*(w-v)+v;return s},solve:function(a,t){return this.sampleCurveY(this.solveCurveX(a,t))}};var N=b(z);let G,ie;function pe(){return G==null&&(G=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),G}function Y(){if(ie==null&&(ie=!1,pe())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let u=0;u<5*5;u++){const d=4*u;t.fillStyle=`rgb(${d},${d+1},${d+2})`,t.fillRect(u%5,Math.floor(u/5),1,1)}const s=t.getImageData(0,0,5,5).data;for(let u=0;u<5*5*4;u++)if(u%4!=3&&s[u]!==u){ie=!0;break}}}return ie||!1}function me(a,t,s,u){const d=new N(a,t,s,u);return function(_){return d.solve(_)}}const ve=me(.25,.1,.25,1);function we(a,t,s){return Math.min(s,Math.max(t,a))}function te(a,t,s){const u=s-t,d=((a-t)%u+u)%u+t;return d===t?s:d}function Be(a,...t){for(const s of t)for(const u in s)a[u]=s[u];return a}let Ce=1;function Ue(a,t,s){const u={};for(const d in a)u[d]=t.call(s||this,a[d],d,a);return u}function $e(a,t,s){const u={};for(const d in a)t.call(s||this,a[d],d,a)&&(u[d]=a[d]);return u}function Re(a){return Array.isArray(a)?a.map(Re):typeof a=="object"&&a?Ue(a,Re):a}const st={};function pt(a){st[a]||(typeof console<"u"&&console.warn(a),st[a]=!0)}function ot(a,t,s){return(s.y-a.y)*(t.x-a.x)>(t.y-a.y)*(s.x-a.x)}function _t(a){let t=0;for(let s,u,d=0,_=a.length,v=_-1;d<_;v=d++)s=a[d],u=a[v],t+=(u.x-s.x)*(s.y+u.y);return t}function ft(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let ir=null;function qe(a){return typeof ImageBitmap<"u"&&a instanceof ImageBitmap}const $t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Dt(a,t,s,u,d){return S(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const _=new VideoFrame(a,{timestamp:0});try{const v=_?.format;if(!v||!v.startsWith("BGR")&&!v.startsWith("RGB"))throw new Error(`Unrecognized format ${v}`);const w=v.startsWith("BGR"),k=new Uint8ClampedArray(u*d*4);if(yield _.copyTo(k,function(I,P,O,j,W){const Z=4*Math.max(-P,0),ne=(Math.max(0,O)-O)*j*4+Z,fe=4*j,ye=Math.max(0,P),Me=Math.max(0,O);return{rect:{x:ye,y:Me,width:Math.min(I.width,P+j)-ye,height:Math.min(I.height,O+W)-Me},layout:[{offset:ne,stride:fe}]}}(a,t,s,u,d)),w)for(let I=0;I<k.length;I+=4){const P=k[I];k[I]=k[I+2],k[I+2]=P}return k}finally{_.close()}})}let ue,be,Te,Ae;const Ye={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(a){const t=requestAnimationFrame(a);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(a,t=0){return this.getImageCanvasContext(a).getImageData(-t,-t,a.width+2*t,a.height+2*t)},getImageCanvasContext(a){const t=window.document.createElement("canvas"),s=t.getContext("2d",{willReadFrequently:!0});if(!s)throw new Error("failed to create canvas 2d context");return t.width=a.width,t.height=a.height,s.drawImage(a,0,0,a.width,a.height),s},resolveURL:a=>(Te||(Te=document.createElement("a")),Te.href=a,Te.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Ae==null&&(Ae=matchMedia("(prefers-reduced-motion: reduce)")),Ae.matches)}},mt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class wt extends Error{constructor(t,s,u,d){super(`AJAXError: ${s} (${t}): ${u}`),this.status=t,this.statusText=s,this.url=u,this.body=d}}const ut=ft()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,rt=a=>mt.REGISTERED_PROTOCOLS[a.substring(0,a.indexOf("://"))];function Yt(a,t){const s=new AbortController,u=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,cache:a.cache,referrer:ut(),signal:s.signal});let d=!1,_=!1;return a.type==="json"&&u.headers.set("Accept","application/json"),_||fetch(u).then(v=>v.ok?(w=>{(a.type==="arrayBuffer"||a.type==="image"?w.arrayBuffer():a.type==="json"?w.json():w.text()).then(k=>{_||(d=!0,t(null,k,w.headers.get("Cache-Control"),w.headers.get("Expires")))}).catch(k=>{_||t(new Error(k.message))})})(v):v.blob().then(w=>t(new wt(v.status,v.statusText,a.url,w)))).catch(v=>{v.code!==20&&t(new Error(v.message))}),{cancel:()=>{_=!0,d||s.abort()}}}const xe=function(a,t){if(/:\/\//.test(a.url)&&!/^https?:|^file:/.test(a.url)){if(ft()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,t);if(!ft())return(rt(a.url)||Yt)(a,t)}if(!(/^file:/.test(s=a.url)||/^file:/.test(ut())&&!/^\w+:/.test(s))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return Yt(a,t);if(ft()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,t,void 0,!0)}var s;return function(u,d){const _=new XMLHttpRequest;_.open(u.method||"GET",u.url,!0),u.type!=="arrayBuffer"&&u.type!=="image"||(_.responseType="arraybuffer");for(const v in u.headers)_.setRequestHeader(v,u.headers[v]);return u.type==="json"&&(_.responseType="text",_.setRequestHeader("Accept","application/json")),_.withCredentials=u.credentials==="include",_.onerror=()=>{d(new Error(_.statusText))},_.onload=()=>{if((_.status>=200&&_.status<300||_.status===0)&&_.response!==null){let v=_.response;if(u.type==="json")try{v=JSON.parse(_.response)}catch(w){return d(w)}d(null,v,_.getResponseHeader("Cache-Control"),_.getResponseHeader("Expires"))}else{const v=new Blob([_.response],{type:_.getResponseHeader("Content-Type")});d(new wt(_.status,_.statusText,u.url,v))}},_.send(u.body),{cancel:()=>_.abort()}}(a,t)},er=function(a,t){return xe(Be(a,{type:"arrayBuffer"}),t)};function Jt(a){if(!a||a.indexOf("://")<=0||a.indexOf("data:image/")===0||a.indexOf("blob:")===0)return!0;const t=new URL(a),s=window.location;return t.protocol===s.protocol&&t.host===s.host}function mr(a,t,s){s[a]&&s[a].indexOf(t)!==-1||(s[a]=s[a]||[],s[a].push(t))}function Zt(a,t,s){if(s&&s[a]){const u=s[a].indexOf(t);u!==-1&&s[a].splice(u,1)}}class Et{constructor(t,s={}){Be(this,s),this.type=t}}class wr extends Et{constructor(t,s={}){super("error",Be({error:t},s))}}class Wr{on(t,s){return this._listeners=this._listeners||{},mr(t,s,this._listeners),this}off(t,s){return Zt(t,s,this._listeners),Zt(t,s,this._oneTimeListeners),this}once(t,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},mr(t,s,this._oneTimeListeners),this):new Promise(u=>this.once(t,u))}fire(t,s){typeof t=="string"&&(t=new Et(t,s||{}));const u=t.type;if(this.listens(u)){t.target=this;const d=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const w of d)w.call(this,t);const _=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const w of _)Zt(u,w,this._oneTimeListeners),w.call(this,t);const v=this._eventedParent;v&&(Be(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),v.fire(t))}else t instanceof wr&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,s){return this._eventedParent=t,this._eventedParentData=s,this}}var Xe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Fr=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function na(a,t){const s={};for(const u in a)u!=="ref"&&(s[u]=a[u]);return Fr.forEach(u=>{u in t&&(s[u]=t[u])}),s}function ur(a,t){if(Array.isArray(a)){if(!Array.isArray(t)||a.length!==t.length)return!1;for(let s=0;s<a.length;s++)if(!ur(a[s],t[s]))return!1;return!0}if(typeof a=="object"&&a!==null&&t!==null){if(typeof t!="object"||Object.keys(a).length!==Object.keys(t).length)return!1;for(const s in a)if(!ur(a[s],t[s]))return!1;return!0}return a===t}const qt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Zr(a,t,s){s.push({command:qt.addSource,args:[a,t[a]]})}function Sa(a,t,s){t.push({command:qt.removeSource,args:[a]}),s[a]=!0}function ua(a,t,s,u){Sa(a,s,u),Zr(a,t,s)}function zr(a,t,s){let u;for(u in a[s])if(Object.prototype.hasOwnProperty.call(a[s],u)&&u!=="data"&&!ur(a[s][u],t[s][u]))return!1;for(u in t[s])if(Object.prototype.hasOwnProperty.call(t[s],u)&&u!=="data"&&!ur(a[s][u],t[s][u]))return!1;return!0}function fa(a,t,s,u,d,_){let v;for(v in t=t||{},a=a||{})Object.prototype.hasOwnProperty.call(a,v)&&(ur(a[v],t[v])||s.push({command:_,args:[u,v,t[v],d]}));for(v in t)Object.prototype.hasOwnProperty.call(t,v)&&!Object.prototype.hasOwnProperty.call(a,v)&&(ur(a[v],t[v])||s.push({command:_,args:[u,v,t[v],d]}))}function Xt(a){return a.id}function Sr(a,t){return a[t.id]=t,a}class lt{constructor(t,s,u,d){this.message=(t?`${t}: `:"")+u,d&&(this.identifier=d),s!=null&&s.__line__&&(this.line=s.__line__)}}function Mt(a,...t){for(const s of t)for(const u in s)a[u]=s[u];return a}class Ut extends Error{constructor(t,s){super(s),this.message=s,this.key=t}}class gr{constructor(t,s=[]){this.parent=t,this.bindings={};for(const[u,d]of s)this.bindings[u]=d}concat(t){return new gr(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const tr={kind:"null"},it={kind:"number"},Nt={kind:"string"},jt={kind:"boolean"},Lr={kind:"color"},sa={kind:"object"},Kt={kind:"value"},Ya={kind:"collator"},le={kind:"formatted"},V={kind:"padding"},H={kind:"resolvedImage"},ee={kind:"variableAnchorOffsetCollection"};function he(a,t){return{kind:"array",itemType:a,N:t}}function de(a){if(a.kind==="array"){const t=de(a.itemType);return typeof a.N=="number"?`array<${t}, ${a.N}>`:a.itemType.kind==="value"?"array":`array<${t}>`}return a.kind}const De=[tr,it,Nt,jt,Lr,le,sa,he(Kt),V,H,ee];function ke(a,t){if(t.kind==="error")return null;if(a.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!ke(a.itemType,t.itemType))&&(typeof a.N!="number"||a.N===t.N))return null}else{if(a.kind===t.kind)return null;if(a.kind==="value"){for(const s of De)if(!ke(s,t))return null}}return`Expected ${de(a)} but found ${de(t)} instead.`}function _e(a,t){return t.some(s=>s.kind===a.kind)}function Fe(a,t){return t.some(s=>s==="null"?a===null:s==="array"?Array.isArray(a):s==="object"?a&&!Array.isArray(a)&&typeof a=="object":s===typeof a)}function Je(a,t){return a.kind==="array"&&t.kind==="array"?a.itemType.kind===t.itemType.kind&&typeof a.N=="number":a.kind===t.kind}const Qe=.96422,B=.82521,J=4/29,K=6/29,X=3*K*K,Q=K*K*K,re=Math.PI/180,Ne=180/Math.PI;function Ze(a){return(a%=360)<0&&(a+=360),a}function Le([a,t,s,u]){let d,_;const v=je((.2225045*(a=ze(a))+.7168786*(t=ze(t))+.0606169*(s=ze(s)))/1);a===t&&t===s?d=_=v:(d=je((.4360747*a+.3850649*t+.1430804*s)/Qe),_=je((.0139322*a+.0971045*t+.7141733*s)/B));const w=116*v-16;return[w<0?0:w,500*(d-v),200*(v-_),u]}function ze(a){return a<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function je(a){return a>Q?Math.pow(a,1/3):a/X+J}function at([a,t,s,u]){let d=(a+16)/116,_=isNaN(t)?d:d+t/500,v=isNaN(s)?d:d-s/200;return d=1*St(d),_=Qe*St(_),v=B*St(v),[gt(3.1338561*_-1.6168667*d-.4906146*v),gt(-.9787684*_+1.9161415*d+.033454*v),gt(.0719453*_-.2289914*d+1.4052427*v),u]}function gt(a){return(a=a<=.00304?12.92*a:1.055*Math.pow(a,1/2.4)-.055)<0?0:a>1?1:a}function St(a){return a>K?a*a*a:X*(a-J)}function dt(a){return parseInt(a.padEnd(2,a),16)/255}function Ft(a,t){return Wt(t?a/100:a,0,1)}function Wt(a,t,s){return Math.min(Math.max(t,a),s)}function kr(a){return!a.some(Number.isNaN)}const Rr={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Qt{constructor(t,s,u,d=1,_=!0){this.r=t,this.g=s,this.b=u,this.a=d,_||(this.r*=d,this.g*=d,this.b*=d,d||this.overwriteGetter("rgb",[t,s,u,d]))}static parse(t){if(t instanceof Qt)return t;if(typeof t!="string")return;const s=function(u){if((u=u.toLowerCase().trim())==="transparent")return[0,0,0,0];const d=Rr[u];if(d){const[v,w,k]=d;return[v/255,w/255,k/255,1]}if(u.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(u)){const v=u.length<6?1:2;let w=1;return[dt(u.slice(w,w+=v)),dt(u.slice(w,w+=v)),dt(u.slice(w,w+=v)),dt(u.slice(w,w+v)||"ff")]}if(u.startsWith("rgb")){const v=u.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(v){const[w,k,I,P,O,j,W,Z,ne,fe,ye,Me]=v,Ee=[P||" ",W||" ",fe].join("");if(Ee==="  "||Ee==="  /"||Ee===",,"||Ee===",,,"){const Oe=[I,j,ne].join(""),Ge=Oe==="%%%"?100:Oe===""?255:0;if(Ge){const tt=[Wt(+k/Ge,0,1),Wt(+O/Ge,0,1),Wt(+Z/Ge,0,1),ye?Ft(+ye,Me):1];if(kr(tt))return tt}}return}}const _=u.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(_){const[v,w,k,I,P,O,j,W,Z]=_,ne=[k||" ",P||" ",j].join("");if(ne==="  "||ne==="  /"||ne===",,"||ne===",,,"){const fe=[+w,Wt(+I,0,100),Wt(+O,0,100),W?Ft(+W,Z):1];if(kr(fe))return function([ye,Me,Ee,Oe]){function Ge(tt){const At=(tt+ye/30)%12,Rt=Me*Math.min(Ee,1-Ee);return Ee-Rt*Math.max(-1,Math.min(At-3,9-At,1))}return ye=Ze(ye),Me/=100,Ee/=100,[Ge(0),Ge(8),Ge(4),Oe]}(fe)}}}(t);return s?new Qt(...s,!1):void 0}get rgb(){const{r:t,g:s,b:u,a:d}=this,_=d||1/0;return this.overwriteGetter("rgb",[t/_,s/_,u/_,d])}get hcl(){return this.overwriteGetter("hcl",function(t){const[s,u,d,_]=Le(t),v=Math.sqrt(u*u+d*d);return[Math.round(1e4*v)?Ze(Math.atan2(d,u)*Ne):NaN,v,s,_]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Le(this.rgb))}overwriteGetter(t,s){return Object.defineProperty(this,t,{value:s}),s}toString(){const[t,s,u,d]=this.rgb;return`rgba(${[t,s,u].map(_=>Math.round(255*_)).join(",")},${d})`}}Qt.black=new Qt(0,0,0,1),Qt.white=new Qt(1,1,1,1),Qt.transparent=new Qt(0,0,0,0),Qt.red=new Qt(1,0,0,1);class on{constructor(t,s,u){this.sensitivity=t?s?"variant":"case":s?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,s){return this.collator.compare(t,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Hi{constructor(t,s,u,d,_){this.text=t,this.image=s,this.scale=u,this.fontStack=d,this.textColor=_}}class Xr{constructor(t){this.sections=t}static fromString(t){return new Xr([new Hi(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof Xr?t:Xr.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class ta{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof ta)return t;if(typeof t=="number")return new ta([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const s of t)if(typeof s!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new ta(t)}}toString(){return JSON.stringify(this.values)}}const Os=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Kr{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Kr)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let s=0;s<t.length;s+=2){const u=t[s],d=t[s+1];if(typeof u!="string"||!Os.has(u)||!Array.isArray(d)||d.length!==2||typeof d[0]!="number"||typeof d[1]!="number")return}return new Kr(t)}}toString(){return JSON.stringify(this.values)}}class ka{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new ka({name:t,available:!1}):null}}function bo(a,t,s,u){return typeof a=="number"&&a>=0&&a<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof s=="number"&&s>=0&&s<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[a,t,s,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[a,t,s,u]:[a,t,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function os(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof Qt||a instanceof on||a instanceof Xr||a instanceof ta||a instanceof Kr||a instanceof ka)return!0;if(Array.isArray(a)){for(const t of a)if(!os(t))return!1;return!0}if(typeof a=="object"){for(const t in a)if(!os(a[t]))return!1;return!0}return!1}function Nr(a){if(a===null)return tr;if(typeof a=="string")return Nt;if(typeof a=="boolean")return jt;if(typeof a=="number")return it;if(a instanceof Qt)return Lr;if(a instanceof on)return Ya;if(a instanceof Xr)return le;if(a instanceof ta)return V;if(a instanceof Kr)return ee;if(a instanceof ka)return H;if(Array.isArray(a)){const t=a.length;let s;for(const u of a){const d=Nr(u);if(s){if(s===d)continue;s=Kt;break}s=d}return he(s||Kt,t)}return sa}function xr(a){const t=typeof a;return a===null?"":t==="string"||t==="number"||t==="boolean"?String(a):a instanceof Qt||a instanceof Xr||a instanceof ta||a instanceof Kr||a instanceof ka?a.toString():JSON.stringify(a)}class Nn{constructor(t,s){this.type=t,this.value=s}static parse(t,s){if(t.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!os(t[1]))return s.error("invalid value");const u=t[1];let d=Nr(u);const _=s.expectedType;return d.kind!=="array"||d.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(d=_),new Nn(d,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Gr{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const To={string:Nt,number:it,boolean:jt,object:sa};class Ai{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");let u,d=1;const _=t[0];if(_==="array"){let w,k;if(t.length>2){const I=t[1];if(typeof I!="string"||!(I in To)||I==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);w=To[I],d++}else w=Kt;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return s.error('The length argument to "array" must be a positive integer literal',2);k=t[2],d++}u=he(w,k)}else{if(!To[_])throw new Error(`Types doesn't contain name = ${_}`);u=To[_]}const v=[];for(;d<t.length;d++){const w=s.parse(t[d],d,Kt);if(!w)return null;v.push(w)}return new Ai(u,v)}evaluate(t){for(let s=0;s<this.args.length;s++){const u=this.args[s].evaluate(t);if(!ke(this.type,Nr(u)))return u;if(s===this.args.length-1)throw new Gr(`Expected value to be of type ${de(this.type)}, but found ${de(Nr(u))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const wl={"to-boolean":jt,"to-color":Lr,"to-number":it,"to-string":Nt};class En{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");const u=t[0];if(!wl[u])throw new Error(`Can't parse ${u} as it is not part of the known types`);if((u==="to-boolean"||u==="to-string")&&t.length!==2)return s.error("Expected one argument.");const d=wl[u],_=[];for(let v=1;v<t.length;v++){const w=s.parse(t[v],v,Kt);if(!w)return null;_.push(w)}return new En(d,_)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let s,u;for(const d of this.args){if(s=d.evaluate(t),u=null,s instanceof Qt)return s;if(typeof s=="string"){const _=t.parseColor(s);if(_)return _}else if(Array.isArray(s)&&(u=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:bo(s[0],s[1],s[2],s[3]),!u))return new Qt(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new Gr(u||`Could not parse color from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"padding":{let s;for(const u of this.args){s=u.evaluate(t);const d=ta.parse(s);if(d)return d}throw new Gr(`Could not parse padding from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"variableAnchorOffsetCollection":{let s;for(const u of this.args){s=u.evaluate(t);const d=Kr.parse(s);if(d)return d}throw new Gr(`Could not parse variableAnchorOffsetCollection from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"number":{let s=null;for(const u of this.args){if(s=u.evaluate(t),s===null)return 0;const d=Number(s);if(!isNaN(d))return d}throw new Gr(`Could not convert ${JSON.stringify(s)} to number.`)}case"formatted":return Xr.fromString(xr(this.args[0].evaluate(t)));case"resolvedImage":return ka.fromString(xr(this.args[0].evaluate(t)));default:return xr(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const rh=["Unknown","Point","LineString","Polygon"];class bl{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?rh[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let s=this._parseColorCache[t];return s||(s=this._parseColorCache[t]=Qt.parse(t)),s}}class Eo{constructor(t,s,u=[],d,_=new gr,v=[]){this.registry=t,this.path=u,this.key=u.map(w=>`[${w}]`).join(""),this.scope=_,this.errors=v,this.expectedType=d,this._isConstant=s}parse(t,s,u,d,_={}){return s?this.concat(s,u,d)._parse(t,_):this._parse(t,_)}_parse(t,s){function u(d,_,v){return v==="assert"?new Ai(_,[d]):v==="coerce"?new En(_,[d]):d}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const d=t[0];if(typeof d!="string")return this.error(`Expression name must be a string, but found ${typeof d} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const _=this.registry[d];if(_){let v=_.parse(t,this);if(!v)return null;if(this.expectedType){const w=this.expectedType,k=v.type;if(w.kind!=="string"&&w.kind!=="number"&&w.kind!=="boolean"&&w.kind!=="object"&&w.kind!=="array"||k.kind!=="value")if(w.kind!=="color"&&w.kind!=="formatted"&&w.kind!=="resolvedImage"||k.kind!=="value"&&k.kind!=="string")if(w.kind!=="padding"||k.kind!=="value"&&k.kind!=="number"&&k.kind!=="array")if(w.kind!=="variableAnchorOffsetCollection"||k.kind!=="value"&&k.kind!=="array"){if(this.checkSubtype(w,k))return null}else v=u(v,w,s.typeAnnotation||"coerce");else v=u(v,w,s.typeAnnotation||"coerce");else v=u(v,w,s.typeAnnotation||"coerce");else v=u(v,w,s.typeAnnotation||"assert")}if(!(v instanceof Nn)&&v.type.kind!=="resolvedImage"&&this._isConstant(v)){const w=new bl;try{v=new Nn(v.type,v.evaluate(w))}catch(k){return this.error(k.message),null}}return v}return this.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,s,u){const d=typeof t=="number"?this.path.concat(t):this.path,_=u?this.scope.concat(u):this.scope;return new Eo(this.registry,this._isConstant,d,s||null,_,this.errors)}error(t,...s){const u=`${this.key}${s.map(d=>`[${d}]`).join("")}`;this.errors.push(new Ut(u,t))}checkSubtype(t,s){const u=ke(t,s);return u&&this.error(u),u}}class So{constructor(t,s,u){this.type=Ya,this.locale=u,this.caseSensitive=t,this.diacriticSensitive=s}static parse(t,s){if(t.length!==2)return s.error("Expected one argument.");const u=t[1];if(typeof u!="object"||Array.isArray(u))return s.error("Collator options argument must be an object.");const d=s.parse(u["case-sensitive"]!==void 0&&u["case-sensitive"],1,jt);if(!d)return null;const _=s.parse(u["diacritic-sensitive"]!==void 0&&u["diacritic-sensitive"],1,jt);if(!_)return null;let v=null;return u.locale&&(v=s.parse(u.locale,1,Nt),!v)?null:new So(d,_,v)}evaluate(t){return new on(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}const Sn=8192;function Tl(a,t){a[0]=Math.min(a[0],t[0]),a[1]=Math.min(a[1],t[1]),a[2]=Math.max(a[2],t[0]),a[3]=Math.max(a[3],t[1])}function Bs(a,t){return!(a[0]<=t[0]||a[2]>=t[2]||a[1]<=t[1]||a[3]>=t[3])}function ah(a,t){const s=(180+a[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,d=Math.pow(2,t.z);return[Math.round(s*d*Sn),Math.round(u*d*Sn)]}function $u(a,t,s){const u=a[0]-t[0],d=a[1]-t[1],_=a[0]-s[0],v=a[1]-s[1];return u*v-_*d==0&&u*_<=0&&d*v<=0}function El(a,t){let s=!1;for(let v=0,w=t.length;v<w;v++){const k=t[v];for(let I=0,P=k.length;I<P-1;I++){if($u(a,k[I],k[I+1]))return!1;(d=k[I])[1]>(u=a)[1]!=(_=k[I+1])[1]>u[1]&&u[0]<(_[0]-d[0])*(u[1]-d[1])/(_[1]-d[1])+d[0]&&(s=!s)}}var u,d,_;return s}function Sl(a,t){for(let s=0;s<t.length;s++)if(El(a,t[s]))return!0;return!1}function ih(a,t,s,u){const d=u[0]-s[0],_=u[1]-s[1],v=(a[0]-s[0])*_-d*(a[1]-s[1]),w=(t[0]-s[0])*_-d*(t[1]-s[1]);return v>0&&w<0||v<0&&w>0}function ju(a,t,s){for(const I of s)for(let P=0;P<I.length-1;++P)if((w=[(v=I[P+1])[0]-(_=I[P])[0],v[1]-_[1]])[0]*(k=[(d=t)[0]-(u=a)[0],d[1]-u[1]])[1]-w[1]*k[0]!=0&&ih(u,d,_,v)&&ih(_,v,u,d))return!0;var u,d,_,v,w,k;return!1}function nh(a,t){for(let s=0;s<a.length;++s)if(!El(a[s],t))return!1;for(let s=0;s<a.length-1;++s)if(ju(a[s],a[s+1],t))return!1;return!0}function sh(a,t){for(let s=0;s<t.length;s++)if(nh(a,t[s]))return!0;return!1}function ko(a,t,s){const u=[];for(let d=0;d<a.length;d++){const _=[];for(let v=0;v<a[d].length;v++){const w=ah(a[d][v],s);Tl(t,w),_.push(w)}u.push(_)}return u}function oh(a,t,s){const u=[];for(let d=0;d<a.length;d++){const _=ko(a[d],t,s);u.push(_)}return u}function lh(a,t,s,u){if(a[0]<s[0]||a[0]>s[2]){const d=.5*u;let _=a[0]-s[0]>d?-u:s[0]-a[0]>d?u:0;_===0&&(_=a[0]-s[2]>d?-u:s[2]-a[0]>d?u:0),a[0]+=_}Tl(t,a)}function kl(a,t,s,u){const d=Math.pow(2,u.z)*Sn,_=[u.x*Sn,u.y*Sn],v=[];for(const w of a)for(const k of w){const I=[k.x+_[0],k.y+_[1]];lh(I,t,s,d),v.push(I)}return v}function Cl(a,t,s,u){const d=Math.pow(2,u.z)*Sn,_=[u.x*Sn,u.y*Sn],v=[];for(const k of a){const I=[];for(const P of k){const O=[P.x+_[0],P.y+_[1]];Tl(t,O),I.push(O)}v.push(I)}if(t[2]-t[0]<=d/2){(w=t)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const k of v)for(const I of k)lh(I,t,s,d)}var w;return v}class Un{constructor(t,s){this.type=jt,this.geojson=t,this.geometries=s}static parse(t,s){if(t.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(os(t[1])){const u=t[1];if(u.type==="FeatureCollection")for(let d=0;d<u.features.length;++d){const _=u.features[d].geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new Un(u,u.features[d].geometry)}else if(u.type==="Feature"){const d=u.geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new Un(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new Un(u,u)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(s,u){const d=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],v=s.canonicalID();if(u.type==="Polygon"){const w=ko(u.coordinates,_,v),k=kl(s.geometry(),d,_,v);if(!Bs(d,_))return!1;for(const I of k)if(!El(I,w))return!1}if(u.type==="MultiPolygon"){const w=oh(u.coordinates,_,v),k=kl(s.geometry(),d,_,v);if(!Bs(d,_))return!1;for(const I of k)if(!Sl(I,w))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(s,u){const d=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],v=s.canonicalID();if(u.type==="Polygon"){const w=ko(u.coordinates,_,v),k=Cl(s.geometry(),d,_,v);if(!Bs(d,_))return!1;for(const I of k)if(!nh(I,w))return!1}if(u.type==="MultiPolygon"){const w=oh(u.coordinates,_,v),k=Cl(s.geometry(),d,_,v);if(!Bs(d,_))return!1;for(const I of k)if(!sh(I,w))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Co{constructor(t,s){this.type=s.type,this.name=t,this.boundExpression=s}static parse(t,s){if(t.length!==2||typeof t[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const u=t[1];return s.scope.has(u)?new Co(u,s.scope.get(u)):s.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Ii{constructor(t,s,u,d){this.name=t,this.type=s,this._evaluate=u,this.args=d}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,s){const u=t[0],d=Ii.definitions[u];if(!d)return s.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const _=Array.isArray(d)?d[0]:d.type,v=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,w=v.filter(([I])=>!Array.isArray(I)||I.length===t.length-1);let k=null;for(const[I,P]of w){k=new Eo(s.registry,Ao,s.path,null,s.scope);const O=[];let j=!1;for(let W=1;W<t.length;W++){const Z=t[W],ne=Array.isArray(I)?I[W-1]:I.type,fe=k.parse(Z,1+O.length,ne);if(!fe){j=!0;break}O.push(fe)}if(!j)if(Array.isArray(I)&&I.length!==O.length)k.error(`Expected ${I.length} arguments, but found ${O.length} instead.`);else{for(let W=0;W<O.length;W++){const Z=Array.isArray(I)?I[W]:I.type,ne=O[W];k.concat(W+1).checkSubtype(Z,ne.type)}if(k.errors.length===0)return new Ii(u,_,P,O)}}if(w.length===1)s.errors.push(...k.errors);else{const I=(w.length?w:v).map(([O])=>{return j=O,Array.isArray(j)?`(${j.map(de).join(", ")})`:`(${de(j.type)}...)`;var j}).join(" | "),P=[];for(let O=1;O<t.length;O++){const j=s.parse(t[O],1+P.length);if(!j)return null;P.push(de(j.type))}s.error(`Expected arguments of type ${I}, but found (${P.join(", ")}) instead.`)}return null}static register(t,s){Ii.definitions=s;for(const u in s)t[u]=Ii}}function Ao(a){if(a instanceof Co)return Ao(a.boundExpression);if(a instanceof Ii&&a.name==="error"||a instanceof So||a instanceof Un)return!1;const t=a instanceof En||a instanceof Ai;let s=!0;return a.eachChild(u=>{s=t?s&&Ao(u):s&&u instanceof Nn}),!!s&&Io(a)&&Fo(a,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Io(a){if(a instanceof Ii&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof Un)return!1;let t=!0;return a.eachChild(s=>{t&&!Io(s)&&(t=!1)}),t}function zs(a){if(a instanceof Ii&&a.name==="feature-state")return!1;let t=!0;return a.eachChild(s=>{t&&!zs(s)&&(t=!1)}),t}function Fo(a,t){if(a instanceof Ii&&t.indexOf(a.name)>=0)return!1;let s=!0;return a.eachChild(u=>{s&&!Fo(u,t)&&(s=!1)}),s}function ls(a,t){const s=a.length-1;let u,d,_=0,v=s,w=0;for(;_<=v;)if(w=Math.floor((_+v)/2),u=a[w],d=a[w+1],u<=t){if(w===s||t<d)return w;_=w+1}else{if(!(u>t))throw new Gr("Input is not a number.");v=w-1}return 0}class kn{constructor(t,s,u){this.type=t,this.input=s,this.labels=[],this.outputs=[];for(const[d,_]of u)this.labels.push(d),this.outputs.push(_)}static parse(t,s){if(t.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return s.error("Expected an even number of arguments.");const u=s.parse(t[1],1,it);if(!u)return null;const d=[];let _=null;s.expectedType&&s.expectedType.kind!=="value"&&(_=s.expectedType);for(let v=1;v<t.length;v+=2){const w=v===1?-1/0:t[v],k=t[v+1],I=v,P=v+1;if(typeof w!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(d.length&&d[d.length-1][0]>=w)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',I);const O=s.parse(k,P,_);if(!O)return null;_=_||O.type,d.push([w,O])}return new kn(_,u,d)}evaluate(t){const s=this.labels,u=this.outputs;if(s.length===1)return u[0].evaluate(t);const d=this.input.evaluate(t);if(d<=s[0])return u[0].evaluate(t);const _=s.length;return d>=s[_-1]?u[_-1].evaluate(t):u[ls(s,d)].evaluate(t)}eachChild(t){t(this.input);for(const s of this.outputs)t(s)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function dr(a,t,s){return a+s*(t-a)}function Po(a,t,s){return a.map((u,d)=>dr(u,t[d],s))}const di={number:dr,color:function(a,t,s,u="rgb"){switch(u){case"rgb":{const[d,_,v,w]=Po(a.rgb,t.rgb,s);return new Qt(d,_,v,w,!1)}case"hcl":{const[d,_,v,w]=a.hcl,[k,I,P,O]=t.hcl;let j,W;if(isNaN(d)||isNaN(k))isNaN(d)?isNaN(k)?j=NaN:(j=k,v!==1&&v!==0||(W=I)):(j=d,P!==1&&P!==0||(W=_));else{let Me=k-d;k>d&&Me>180?Me-=360:k<d&&d-k>180&&(Me+=360),j=d+s*Me}const[Z,ne,fe,ye]=function([Me,Ee,Oe,Ge]){return Me=isNaN(Me)?0:Me*re,at([Oe,Math.cos(Me)*Ee,Math.sin(Me)*Ee,Ge])}([j,W??dr(_,I,s),dr(v,P,s),dr(w,O,s)]);return new Qt(Z,ne,fe,ye,!1)}case"lab":{const[d,_,v,w]=at(Po(a.lab,t.lab,s));return new Qt(d,_,v,w,!1)}}},array:Po,padding:function(a,t,s){return new ta(Po(a.values,t.values,s))},variableAnchorOffsetCollection:function(a,t,s){const u=a.values,d=t.values;if(u.length!==d.length)throw new Gr(`Cannot interpolate values of different length. from: ${a.toString()}, to: ${t.toString()}`);const _=[];for(let v=0;v<u.length;v+=2){if(u[v]!==d[v])throw new Gr(`Cannot interpolate values containing mismatched anchors. from[${v}]: ${u[v]}, to[${v}]: ${d[v]}`);_.push(u[v]);const[w,k]=u[v+1],[I,P]=d[v+1];_.push([dr(w,I,s),dr(k,P,s)])}return new Kr(_)}};class pi{constructor(t,s,u,d,_){this.type=t,this.operator=s,this.interpolation=u,this.input=d,this.labels=[],this.outputs=[];for(const[v,w]of _)this.labels.push(v),this.outputs.push(w)}static interpolationFactor(t,s,u,d){let _=0;if(t.name==="exponential")_=Al(s,t.base,u,d);else if(t.name==="linear")_=Al(s,1,u,d);else if(t.name==="cubic-bezier"){const v=t.controlPoints;_=new N(v[0],v[1],v[2],v[3]).solve(Al(s,1,u,d))}return _}static parse(t,s){let[u,d,_,...v]=t;if(!Array.isArray(d)||d.length===0)return s.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){const I=d[1];if(typeof I!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:I}}else{if(d[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(d[0])}`,1,0);{const I=d.slice(1);if(I.length!==4||I.some(P=>typeof P!="number"||P<0||P>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:I}}}if(t.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(_=s.parse(_,2,it),!_)return null;const w=[];let k=null;u==="interpolate-hcl"||u==="interpolate-lab"?k=Lr:s.expectedType&&s.expectedType.kind!=="value"&&(k=s.expectedType);for(let I=0;I<v.length;I+=2){const P=v[I],O=v[I+1],j=I+3,W=I+4;if(typeof P!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',j);if(w.length&&w[w.length-1][0]>=P)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',j);const Z=s.parse(O,W,k);if(!Z)return null;k=k||Z.type,w.push([P,Z])}return Je(k,it)||Je(k,Lr)||Je(k,V)||Je(k,ee)||Je(k,he(it))?new pi(k,u,d,_,w):s.error(`Type ${de(k)} is not interpolatable.`)}evaluate(t){const s=this.labels,u=this.outputs;if(s.length===1)return u[0].evaluate(t);const d=this.input.evaluate(t);if(d<=s[0])return u[0].evaluate(t);const _=s.length;if(d>=s[_-1])return u[_-1].evaluate(t);const v=ls(s,d),w=pi.interpolationFactor(this.interpolation,d,s[v],s[v+1]),k=u[v].evaluate(t),I=u[v+1].evaluate(t);switch(this.operator){case"interpolate":return di[this.type.kind](k,I,w);case"interpolate-hcl":return di.color(k,I,w,"hcl");case"interpolate-lab":return di.color(k,I,w,"lab")}}eachChild(t){t(this.input);for(const s of this.outputs)t(s)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Al(a,t,s,u){const d=u-s,_=a-s;return d===0?0:t===1?_/d:(Math.pow(t,_)-1)/(Math.pow(t,d)-1)}class Mo{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expectected at least one argument.");let u=null;const d=s.expectedType;d&&d.kind!=="value"&&(u=d);const _=[];for(const w of t.slice(1)){const k=s.parse(w,1+_.length,u,void 0,{typeAnnotation:"omit"});if(!k)return null;u=u||k.type,_.push(k)}if(!u)throw new Error("No output type");const v=d&&_.some(w=>ke(d,w.type));return new Mo(v?Kt:u,_)}evaluate(t){let s,u=null,d=0;for(const _ of this.args)if(d++,u=_.evaluate(t),u&&u instanceof ka&&!u.available&&(s||(s=u.name),u=null,d===this.args.length&&(u=s)),u!==null)break;return u}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}class Do{constructor(t,s){this.type=s.type,this.bindings=[].concat(t),this.result=s}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const s of this.bindings)t(s[1]);t(this.result)}static parse(t,s){if(t.length<4)return s.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const u=[];for(let _=1;_<t.length-1;_+=2){const v=t[_];if(typeof v!="string")return s.error(`Expected string, but found ${typeof v} instead.`,_);if(/[^a-zA-Z0-9_]/.test(v))return s.error("Variable names must contain only alphanumeric characters or '_'.",_);const w=s.parse(t[_+1],_+1);if(!w)return null;u.push([v,w])}const d=s.parse(t[t.length-1],t.length-1,s.expectedType,u);return d?new Do(u,d):null}outputDefined(){return this.result.outputDefined()}}class Il{constructor(t,s,u){this.type=t,this.index=s,this.input=u}static parse(t,s){if(t.length!==3)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const u=s.parse(t[1],1,it),d=s.parse(t[2],2,he(s.expectedType||Kt));return u&&d?new Il(d.type.itemType,u,d):null}evaluate(t){const s=this.index.evaluate(t),u=this.input.evaluate(t);if(s<0)throw new Gr(`Array index out of bounds: ${s} < 0.`);if(s>=u.length)throw new Gr(`Array index out of bounds: ${s} > ${u.length-1}.`);if(s!==Math.floor(s))throw new Gr(`Array index must be an integer, but found ${s} instead.`);return u[s]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class Fl{constructor(t,s){this.type=jt,this.needle=t,this.haystack=s}static parse(t,s){if(t.length!==3)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const u=s.parse(t[1],1,Kt),d=s.parse(t[2],2,Kt);return u&&d?_e(u.type,[jt,Nt,it,tr,Kt])?new Fl(u,d):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${de(u.type)} instead`):null}evaluate(t){const s=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!u)return!1;if(!Fe(s,["boolean","string","number","null"]))throw new Gr(`Expected first argument to be of type boolean, string, number or null, but found ${de(Nr(s))} instead.`);if(!Fe(u,["string","array"]))throw new Gr(`Expected second argument to be of type array or string, but found ${de(Nr(u))} instead.`);return u.indexOf(s)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class Lo{constructor(t,s,u){this.type=it,this.needle=t,this.haystack=s,this.fromIndex=u}static parse(t,s){if(t.length<=2||t.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const u=s.parse(t[1],1,Kt),d=s.parse(t[2],2,Kt);if(!u||!d)return null;if(!_e(u.type,[jt,Nt,it,tr,Kt]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${de(u.type)} instead`);if(t.length===4){const _=s.parse(t[3],3,it);return _?new Lo(u,d,_):null}return new Lo(u,d)}evaluate(t){const s=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!Fe(s,["boolean","string","number","null"]))throw new Gr(`Expected first argument to be of type boolean, string, number or null, but found ${de(Nr(s))} instead.`);if(!Fe(u,["string","array"]))throw new Gr(`Expected second argument to be of type array or string, but found ${de(Nr(u))} instead.`);if(this.fromIndex){const d=this.fromIndex.evaluate(t);return u.indexOf(s,d)}return u.indexOf(s)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class Pl{constructor(t,s,u,d,_,v){this.inputType=t,this.type=s,this.input=u,this.cases=d,this.outputs=_,this.otherwise=v}static parse(t,s){if(t.length<5)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return s.error("Expected an even number of arguments.");let u,d;s.expectedType&&s.expectedType.kind!=="value"&&(d=s.expectedType);const _={},v=[];for(let I=2;I<t.length-1;I+=2){let P=t[I];const O=t[I+1];Array.isArray(P)||(P=[P]);const j=s.concat(I);if(P.length===0)return j.error("Expected at least one branch label.");for(const Z of P){if(typeof Z!="number"&&typeof Z!="string")return j.error("Branch labels must be numbers or strings.");if(typeof Z=="number"&&Math.abs(Z)>Number.MAX_SAFE_INTEGER)return j.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Z=="number"&&Math.floor(Z)!==Z)return j.error("Numeric branch labels must be integer values.");if(u){if(j.checkSubtype(u,Nr(Z)))return null}else u=Nr(Z);if(_[String(Z)]!==void 0)return j.error("Branch labels must be unique.");_[String(Z)]=v.length}const W=s.parse(O,I,d);if(!W)return null;d=d||W.type,v.push(W)}const w=s.parse(t[1],1,Kt);if(!w)return null;const k=s.parse(t[t.length-1],t.length-1,d);return k?w.type.kind!=="value"&&s.concat(1).checkSubtype(u,w.type)?null:new Pl(u,d,w,_,v,k):null}evaluate(t){const s=this.input.evaluate(t);return(Nr(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class Ml{constructor(t,s,u){this.type=t,this.branches=s,this.otherwise=u}static parse(t,s){if(t.length<4)return s.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return s.error("Expected an odd number of arguments.");let u;s.expectedType&&s.expectedType.kind!=="value"&&(u=s.expectedType);const d=[];for(let v=1;v<t.length-1;v+=2){const w=s.parse(t[v],v,jt);if(!w)return null;const k=s.parse(t[v+1],v+1,u);if(!k)return null;d.push([w,k]),u=u||k.type}const _=s.parse(t[t.length-1],t.length-1,u);if(!_)return null;if(!u)throw new Error("Can't infer output type");return new Ml(u,d,_)}evaluate(t){for(const[s,u]of this.branches)if(s.evaluate(t))return u.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[s,u]of this.branches)t(s),t(u);t(this.otherwise)}outputDefined(){return this.branches.every(([t,s])=>s.outputDefined())&&this.otherwise.outputDefined()}}class Ro{constructor(t,s,u,d){this.type=t,this.input=s,this.beginIndex=u,this.endIndex=d}static parse(t,s){if(t.length<=2||t.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const u=s.parse(t[1],1,Kt),d=s.parse(t[2],2,it);if(!u||!d)return null;if(!_e(u.type,[he(Kt),Nt,Kt]))return s.error(`Expected first argument to be of type array or string, but found ${de(u.type)} instead`);if(t.length===4){const _=s.parse(t[3],3,it);return _?new Ro(u.type,u,d,_):null}return new Ro(u.type,u,d)}evaluate(t){const s=this.input.evaluate(t),u=this.beginIndex.evaluate(t);if(!Fe(s,["string","array"]))throw new Gr(`Expected first argument to be of type array or string, but found ${de(Nr(s))} instead.`);if(this.endIndex){const d=this.endIndex.evaluate(t);return s.slice(u,d)}return s.slice(u)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function ch(a,t){return a==="=="||a==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function hh(a,t,s,u){return u.compare(t,s)===0}function cs(a,t,s){const u=a!=="=="&&a!=="!=";return class Rg{constructor(_,v,w){this.type=jt,this.lhs=_,this.rhs=v,this.collator=w,this.hasUntypedArgument=_.type.kind==="value"||v.type.kind==="value"}static parse(_,v){if(_.length!==3&&_.length!==4)return v.error("Expected two or three arguments.");const w=_[0];let k=v.parse(_[1],1,Kt);if(!k)return null;if(!ch(w,k.type))return v.concat(1).error(`"${w}" comparisons are not supported for type '${de(k.type)}'.`);let I=v.parse(_[2],2,Kt);if(!I)return null;if(!ch(w,I.type))return v.concat(2).error(`"${w}" comparisons are not supported for type '${de(I.type)}'.`);if(k.type.kind!==I.type.kind&&k.type.kind!=="value"&&I.type.kind!=="value")return v.error(`Cannot compare types '${de(k.type)}' and '${de(I.type)}'.`);u&&(k.type.kind==="value"&&I.type.kind!=="value"?k=new Ai(I.type,[k]):k.type.kind!=="value"&&I.type.kind==="value"&&(I=new Ai(k.type,[I])));let P=null;if(_.length===4){if(k.type.kind!=="string"&&I.type.kind!=="string"&&k.type.kind!=="value"&&I.type.kind!=="value")return v.error("Cannot use collator to compare non-string types.");if(P=v.parse(_[3],3,Ya),!P)return null}return new Rg(k,I,P)}evaluate(_){const v=this.lhs.evaluate(_),w=this.rhs.evaluate(_);if(u&&this.hasUntypedArgument){const k=Nr(v),I=Nr(w);if(k.kind!==I.kind||k.kind!=="string"&&k.kind!=="number")throw new Gr(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${k.kind}, ${I.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const k=Nr(v),I=Nr(w);if(k.kind!=="string"||I.kind!=="string")return t(_,v,w)}return this.collator?s(_,v,w,this.collator.evaluate(_)):t(_,v,w)}eachChild(_){_(this.lhs),_(this.rhs),this.collator&&_(this.collator)}outputDefined(){return!0}}}const Gu=cs("==",function(a,t,s){return t===s},hh),Hu=cs("!=",function(a,t,s){return t!==s},function(a,t,s,u){return!hh(0,t,s,u)}),qu=cs("<",function(a,t,s){return t<s},function(a,t,s,u){return u.compare(t,s)<0}),Wu=cs(">",function(a,t,s){return t>s},function(a,t,s,u){return u.compare(t,s)>0}),Zu=cs("<=",function(a,t,s){return t<=s},function(a,t,s,u){return u.compare(t,s)<=0}),Xu=cs(">=",function(a,t,s){return t>=s},function(a,t,s,u){return u.compare(t,s)>=0});class Dl{constructor(t,s,u,d,_){this.type=Nt,this.number=t,this.locale=s,this.currency=u,this.minFractionDigits=d,this.maxFractionDigits=_}static parse(t,s){if(t.length!==3)return s.error("Expected two arguments.");const u=s.parse(t[1],1,it);if(!u)return null;const d=t[2];if(typeof d!="object"||Array.isArray(d))return s.error("NumberFormat options argument must be an object.");let _=null;if(d.locale&&(_=s.parse(d.locale,1,Nt),!_))return null;let v=null;if(d.currency&&(v=s.parse(d.currency,1,Nt),!v))return null;let w=null;if(d["min-fraction-digits"]&&(w=s.parse(d["min-fraction-digits"],1,it),!w))return null;let k=null;return d["max-fraction-digits"]&&(k=s.parse(d["max-fraction-digits"],1,it),!k)?null:new Dl(u,_,v,w,k)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Oo{constructor(t){this.type=le,this.sections=t}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");const u=t[1];if(!Array.isArray(u)&&typeof u=="object")return s.error("First argument must be an image or text section.");const d=[];let _=!1;for(let v=1;v<=t.length-1;++v){const w=t[v];if(_&&typeof w=="object"&&!Array.isArray(w)){_=!1;let k=null;if(w["font-scale"]&&(k=s.parse(w["font-scale"],1,it),!k))return null;let I=null;if(w["text-font"]&&(I=s.parse(w["text-font"],1,he(Nt)),!I))return null;let P=null;if(w["text-color"]&&(P=s.parse(w["text-color"],1,Lr),!P))return null;const O=d[d.length-1];O.scale=k,O.font=I,O.textColor=P}else{const k=s.parse(t[v],1,Kt);if(!k)return null;const I=k.type.kind;if(I!=="string"&&I!=="value"&&I!=="null"&&I!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,d.push({content:k,scale:null,font:null,textColor:null})}}return new Oo(d)}evaluate(t){return new Xr(this.sections.map(s=>{const u=s.content.evaluate(t);return Nr(u)===H?new Hi("",u,null,null,null):new Hi(xr(u),null,s.scale?s.scale.evaluate(t):null,s.font?s.font.evaluate(t).join(","):null,s.textColor?s.textColor.evaluate(t):null)}))}eachChild(t){for(const s of this.sections)t(s.content),s.scale&&t(s.scale),s.font&&t(s.font),s.textColor&&t(s.textColor)}outputDefined(){return!1}}class Ll{constructor(t){this.type=H,this.input=t}static parse(t,s){if(t.length!==2)return s.error("Expected two arguments.");const u=s.parse(t[1],1,Nt);return u?new Ll(u):s.error("No image name provided.")}evaluate(t){const s=this.input.evaluate(t),u=ka.fromString(s);return u&&t.availableImages&&(u.available=t.availableImages.indexOf(s)>-1),u}eachChild(t){t(this.input)}outputDefined(){return!1}}class Rl{constructor(t){this.type=it,this.input=t}static parse(t,s){if(t.length!==2)return s.error(`Expected 1 argument, but found ${t.length-1} instead.`);const u=s.parse(t[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${de(u.type)} instead.`):new Rl(u):null}evaluate(t){const s=this.input.evaluate(t);if(typeof s=="string"||Array.isArray(s))return s.length;throw new Gr(`Expected value to be of type string or array, but found ${de(Nr(s))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const hs={"==":Gu,"!=":Hu,">":Wu,"<":qu,">=":Xu,"<=":Zu,array:Ai,at:Il,boolean:Ai,case:Ml,coalesce:Mo,collator:So,format:Oo,image:Ll,in:Fl,"index-of":Lo,interpolate:pi,"interpolate-hcl":pi,"interpolate-lab":pi,length:Rl,let:Do,literal:Nn,match:Pl,number:Ai,"number-format":Dl,object:Ai,slice:Ro,step:kn,string:Ai,"to-boolean":En,"to-color":En,"to-number":En,"to-string":En,var:Co,within:Un};function uh(a,[t,s,u,d]){t=t.evaluate(a),s=s.evaluate(a),u=u.evaluate(a);const _=d?d.evaluate(a):1,v=bo(t,s,u,_);if(v)throw new Gr(v);return new Qt(t/255,s/255,u/255,_,!1)}function fh(a,t){return a in t}function Ol(a,t){const s=t[a];return s===void 0?null:s}function Vn(a){return{type:a}}function dh(a){return{result:"success",value:a}}function Cn(a){return{result:"error",value:a}}function us(a){return a["property-type"]==="data-driven"||a["property-type"]==="cross-faded-data-driven"}function ph(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function Bl(a){return!!a.expression&&a.expression.interpolated}function _r(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function Ur(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function Ku(a){return a}function pr(a,t){const s=t.type==="color",u=a.stops&&typeof a.stops[0][0]=="object",d=u||!(u||a.property!==void 0),_=a.type||(Bl(t)?"exponential":"interval");if(s||t.type==="padding"){const P=s?Qt.parse:ta.parse;(a=Mt({},a)).stops&&(a.stops=a.stops.map(O=>[O[0],P(O[1])])),a.default=P(a.default?a.default:t.default)}if(a.colorSpace&&(v=a.colorSpace)!=="rgb"&&v!=="hcl"&&v!=="lab")throw new Error(`Unknown color space: "${a.colorSpace}"`);var v;let w,k,I;if(_==="exponential")w=Ns;else if(_==="interval")w=Or;else if(_==="categorical"){w=Vr,k=Object.create(null);for(const P of a.stops)k[P[0]]=P[1];I=typeof a.stops[0][0]}else{if(_!=="identity")throw new Error(`Unknown function type "${_}"`);w=mh}if(u){const P={},O=[];for(let Z=0;Z<a.stops.length;Z++){const ne=a.stops[Z],fe=ne[0].zoom;P[fe]===void 0&&(P[fe]={zoom:fe,type:a.type,property:a.property,default:a.default,stops:[]},O.push(fe)),P[fe].stops.push([ne[0].value,ne[1]])}const j=[];for(const Z of O)j.push([P[Z].zoom,pr(P[Z],t)]);const W={name:"linear"};return{kind:"composite",interpolationType:W,interpolationFactor:pi.interpolationFactor.bind(void 0,W),zoomStops:j.map(Z=>Z[0]),evaluate:({zoom:Z},ne)=>Ns({stops:j,base:a.base},t,Z).evaluate(Z,ne)}}if(d){const P=_==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:P,interpolationFactor:pi.interpolationFactor.bind(void 0,P),zoomStops:a.stops.map(O=>O[0]),evaluate:({zoom:O})=>w(a,t,O,k,I)}}return{kind:"source",evaluate(P,O){const j=O&&O.properties?O.properties[a.property]:void 0;return j===void 0?$n(a.default,t.default):w(a,t,j,k,I)}}}function $n(a,t,s){return a!==void 0?a:t!==void 0?t:s!==void 0?s:void 0}function Vr(a,t,s,u,d){return $n(typeof s===d?u[s]:void 0,a.default,t.default)}function Or(a,t,s){if(_r(s)!=="number")return $n(a.default,t.default);const u=a.stops.length;if(u===1||s<=a.stops[0][0])return a.stops[0][1];if(s>=a.stops[u-1][0])return a.stops[u-1][1];const d=ls(a.stops.map(_=>_[0]),s);return a.stops[d][1]}function Ns(a,t,s){const u=a.base!==void 0?a.base:1;if(_r(s)!=="number")return $n(a.default,t.default);const d=a.stops.length;if(d===1||s<=a.stops[0][0])return a.stops[0][1];if(s>=a.stops[d-1][0])return a.stops[d-1][1];const _=ls(a.stops.map(P=>P[0]),s),v=function(P,O,j,W){const Z=W-j,ne=P-j;return Z===0?0:O===1?ne/Z:(Math.pow(O,ne)-1)/(Math.pow(O,Z)-1)}(s,u,a.stops[_][0],a.stops[_+1][0]),w=a.stops[_][1],k=a.stops[_+1][1],I=di[t.type]||Ku;return typeof w.evaluate=="function"?{evaluate(...P){const O=w.evaluate.apply(void 0,P),j=k.evaluate.apply(void 0,P);if(O!==void 0&&j!==void 0)return I(O,j,v,a.colorSpace)}}:I(w,k,v,a.colorSpace)}function mh(a,t,s){switch(t.type){case"color":s=Qt.parse(s);break;case"formatted":s=Xr.fromString(s.toString());break;case"resolvedImage":s=ka.fromString(s.toString());break;case"padding":s=ta.parse(s);break;default:_r(s)===t.type||t.type==="enum"&&t.values[s]||(s=void 0)}return $n(s,a.default,t.default)}Ii.register(hs,{error:[{kind:"error"},[Nt],(a,[t])=>{throw new Gr(t.evaluate(a))}],typeof:[Nt,[Kt],(a,[t])=>de(Nr(t.evaluate(a)))],"to-rgba":[he(it,4),[Lr],(a,[t])=>{const[s,u,d,_]=t.evaluate(a).rgb;return[255*s,255*u,255*d,_]}],rgb:[Lr,[it,it,it],uh],rgba:[Lr,[it,it,it,it],uh],has:{type:jt,overloads:[[[Nt],(a,[t])=>fh(t.evaluate(a),a.properties())],[[Nt,sa],(a,[t,s])=>fh(t.evaluate(a),s.evaluate(a))]]},get:{type:Kt,overloads:[[[Nt],(a,[t])=>Ol(t.evaluate(a),a.properties())],[[Nt,sa],(a,[t,s])=>Ol(t.evaluate(a),s.evaluate(a))]]},"feature-state":[Kt,[Nt],(a,[t])=>Ol(t.evaluate(a),a.featureState||{})],properties:[sa,[],a=>a.properties()],"geometry-type":[Nt,[],a=>a.geometryType()],id:[Kt,[],a=>a.id()],zoom:[it,[],a=>a.globals.zoom],"heatmap-density":[it,[],a=>a.globals.heatmapDensity||0],"line-progress":[it,[],a=>a.globals.lineProgress||0],accumulated:[Kt,[],a=>a.globals.accumulated===void 0?null:a.globals.accumulated],"+":[it,Vn(it),(a,t)=>{let s=0;for(const u of t)s+=u.evaluate(a);return s}],"*":[it,Vn(it),(a,t)=>{let s=1;for(const u of t)s*=u.evaluate(a);return s}],"-":{type:it,overloads:[[[it,it],(a,[t,s])=>t.evaluate(a)-s.evaluate(a)],[[it],(a,[t])=>-t.evaluate(a)]]},"/":[it,[it,it],(a,[t,s])=>t.evaluate(a)/s.evaluate(a)],"%":[it,[it,it],(a,[t,s])=>t.evaluate(a)%s.evaluate(a)],ln2:[it,[],()=>Math.LN2],pi:[it,[],()=>Math.PI],e:[it,[],()=>Math.E],"^":[it,[it,it],(a,[t,s])=>Math.pow(t.evaluate(a),s.evaluate(a))],sqrt:[it,[it],(a,[t])=>Math.sqrt(t.evaluate(a))],log10:[it,[it],(a,[t])=>Math.log(t.evaluate(a))/Math.LN10],ln:[it,[it],(a,[t])=>Math.log(t.evaluate(a))],log2:[it,[it],(a,[t])=>Math.log(t.evaluate(a))/Math.LN2],sin:[it,[it],(a,[t])=>Math.sin(t.evaluate(a))],cos:[it,[it],(a,[t])=>Math.cos(t.evaluate(a))],tan:[it,[it],(a,[t])=>Math.tan(t.evaluate(a))],asin:[it,[it],(a,[t])=>Math.asin(t.evaluate(a))],acos:[it,[it],(a,[t])=>Math.acos(t.evaluate(a))],atan:[it,[it],(a,[t])=>Math.atan(t.evaluate(a))],min:[it,Vn(it),(a,t)=>Math.min(...t.map(s=>s.evaluate(a)))],max:[it,Vn(it),(a,t)=>Math.max(...t.map(s=>s.evaluate(a)))],abs:[it,[it],(a,[t])=>Math.abs(t.evaluate(a))],round:[it,[it],(a,[t])=>{const s=t.evaluate(a);return s<0?-Math.round(-s):Math.round(s)}],floor:[it,[it],(a,[t])=>Math.floor(t.evaluate(a))],ceil:[it,[it],(a,[t])=>Math.ceil(t.evaluate(a))],"filter-==":[jt,[Nt,Kt],(a,[t,s])=>a.properties()[t.value]===s.value],"filter-id-==":[jt,[Kt],(a,[t])=>a.id()===t.value],"filter-type-==":[jt,[Nt],(a,[t])=>a.geometryType()===t.value],"filter-<":[jt,[Nt,Kt],(a,[t,s])=>{const u=a.properties()[t.value],d=s.value;return typeof u==typeof d&&u<d}],"filter-id-<":[jt,[Kt],(a,[t])=>{const s=a.id(),u=t.value;return typeof s==typeof u&&s<u}],"filter->":[jt,[Nt,Kt],(a,[t,s])=>{const u=a.properties()[t.value],d=s.value;return typeof u==typeof d&&u>d}],"filter-id->":[jt,[Kt],(a,[t])=>{const s=a.id(),u=t.value;return typeof s==typeof u&&s>u}],"filter-<=":[jt,[Nt,Kt],(a,[t,s])=>{const u=a.properties()[t.value],d=s.value;return typeof u==typeof d&&u<=d}],"filter-id-<=":[jt,[Kt],(a,[t])=>{const s=a.id(),u=t.value;return typeof s==typeof u&&s<=u}],"filter->=":[jt,[Nt,Kt],(a,[t,s])=>{const u=a.properties()[t.value],d=s.value;return typeof u==typeof d&&u>=d}],"filter-id->=":[jt,[Kt],(a,[t])=>{const s=a.id(),u=t.value;return typeof s==typeof u&&s>=u}],"filter-has":[jt,[Kt],(a,[t])=>t.value in a.properties()],"filter-has-id":[jt,[],a=>a.id()!==null&&a.id()!==void 0],"filter-type-in":[jt,[he(Nt)],(a,[t])=>t.value.indexOf(a.geometryType())>=0],"filter-id-in":[jt,[he(Kt)],(a,[t])=>t.value.indexOf(a.id())>=0],"filter-in-small":[jt,[Nt,he(Kt)],(a,[t,s])=>s.value.indexOf(a.properties()[t.value])>=0],"filter-in-large":[jt,[Nt,he(Kt)],(a,[t,s])=>function(u,d,_,v){for(;_<=v;){const w=_+v>>1;if(d[w]===u)return!0;d[w]>u?v=w-1:_=w+1}return!1}(a.properties()[t.value],s.value,0,s.value.length-1)],all:{type:jt,overloads:[[[jt,jt],(a,[t,s])=>t.evaluate(a)&&s.evaluate(a)],[Vn(jt),(a,t)=>{for(const s of t)if(!s.evaluate(a))return!1;return!0}]]},any:{type:jt,overloads:[[[jt,jt],(a,[t,s])=>t.evaluate(a)||s.evaluate(a)],[Vn(jt),(a,t)=>{for(const s of t)if(s.evaluate(a))return!0;return!1}]]},"!":[jt,[jt],(a,[t])=>!t.evaluate(a)],"is-supported-script":[jt,[Nt],(a,[t])=>{const s=a.globals&&a.globals.isSupportedScript;return!s||s(t.evaluate(a))}],upcase:[Nt,[Nt],(a,[t])=>t.evaluate(a).toUpperCase()],downcase:[Nt,[Nt],(a,[t])=>t.evaluate(a).toLowerCase()],concat:[Nt,Vn(Kt),(a,t)=>t.map(s=>xr(s.evaluate(a))).join("")],"resolved-locale":[Nt,[Ya],(a,[t])=>t.evaluate(a).resolvedLocale()]});class zl{constructor(t,s){var u;this.expression=t,this._warningHistory={},this._evaluator=new bl,this._defaultValue=s?(u=s).type==="color"&&Ur(u.default)?new Qt(0,0,0,0):u.type==="color"?Qt.parse(u.default)||null:u.type==="padding"?ta.parse(u.default)||null:u.type==="variableAnchorOffsetCollection"?Kr.parse(u.default)||null:u.default===void 0?null:u.default:null,this._enumValues=s&&s.type==="enum"?s.values:null}evaluateWithoutErrorHandling(t,s,u,d,_,v){return this._evaluator.globals=t,this._evaluator.feature=s,this._evaluator.featureState=u,this._evaluator.canonical=d,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=v,this.expression.evaluate(this._evaluator)}evaluate(t,s,u,d,_,v){this._evaluator.globals=t,this._evaluator.feature=s||null,this._evaluator.featureState=u||null,this._evaluator.canonical=d,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=v||null;try{const w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new Gr(`Expected value to be one of ${Object.keys(this._enumValues).map(k=>JSON.stringify(k)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function Bo(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in hs}function zo(a,t){const s=new Eo(hs,Ao,[],t?function(d){const _={color:Lr,string:Nt,number:it,enum:Nt,boolean:jt,formatted:le,padding:V,resolvedImage:H,variableAnchorOffsetCollection:ee};return d.type==="array"?he(_[d.value]||Kt,d.length):_[d.type]}(t):void 0),u=s.parse(a,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?dh(new zl(u,t)):Cn(s.errors)}class Nl{constructor(t,s){this.kind=t,this._styleExpression=s,this.isStateDependent=t!=="constant"&&!zs(s.expression)}evaluateWithoutErrorHandling(t,s,u,d,_,v){return this._styleExpression.evaluateWithoutErrorHandling(t,s,u,d,_,v)}evaluate(t,s,u,d,_,v){return this._styleExpression.evaluate(t,s,u,d,_,v)}}class No{constructor(t,s,u,d){this.kind=t,this.zoomStops=u,this._styleExpression=s,this.isStateDependent=t!=="camera"&&!zs(s.expression),this.interpolationType=d}evaluateWithoutErrorHandling(t,s,u,d,_,v){return this._styleExpression.evaluateWithoutErrorHandling(t,s,u,d,_,v)}evaluate(t,s,u,d,_,v){return this._styleExpression.evaluate(t,s,u,d,_,v)}interpolationFactor(t,s,u){return this.interpolationType?pi.interpolationFactor(this.interpolationType,t,s,u):0}}function Ul(a,t){const s=zo(a,t);if(s.result==="error")return s;const u=s.value.expression,d=Io(u);if(!d&&!us(t))return Cn([new Ut("","data expressions not supported")]);const _=Fo(u,["zoom"]);if(!_&&!ph(t))return Cn([new Ut("","zoom expressions not supported")]);const v=Vs(u);return v||_?v instanceof Ut?Cn([v]):v instanceof pi&&!Bl(t)?Cn([new Ut("",'"interpolate" expressions cannot be used with this property')]):dh(v?new No(d?"camera":"composite",s.value,v.labels,v instanceof pi?v.interpolation:void 0):new Nl(d?"constant":"source",s.value)):Cn([new Ut("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Us{constructor(t,s){this._parameters=t,this._specification=s,Mt(this,pr(this._parameters,this._specification))}static deserialize(t){return new Us(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Vs(a){let t=null;if(a instanceof Do)t=Vs(a.result);else if(a instanceof Mo){for(const s of a.args)if(t=Vs(s),t)break}else(a instanceof kn||a instanceof pi)&&a.input instanceof Ii&&a.input.name==="zoom"&&(t=a);return t instanceof Ut||a.eachChild(s=>{const u=Vs(s);u instanceof Ut?t=u:!t&&u?t=new Ut("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&u&&t!==u&&(t=new Ut("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function $s(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const t of a.slice(1))if(!$s(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const Yu={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Vl(a){if(a==null)return{filter:()=>!0,needGeometry:!1};$s(a)||(a=Uo(a));const t=zo(a,Yu);if(t.result==="error")throw new Error(t.value.map(s=>`${s.key}: ${s.message}`).join(", "));return{filter:(s,u,d)=>t.value.evaluate(s,u,{},d),needGeometry:gh(a)}}function Ju(a,t){return a<t?-1:a>t?1:0}function gh(a){if(!Array.isArray(a))return!1;if(a[0]==="within")return!0;for(let t=1;t<a.length;t++)if(gh(a[t]))return!0;return!1}function Uo(a){if(!a)return!0;const t=a[0];return a.length<=1?t!=="any":t==="=="?$l(a[1],a[2],"=="):t==="!="?js($l(a[1],a[2],"==")):t==="<"||t===">"||t==="<="||t===">="?$l(a[1],a[2],t):t==="any"?(s=a.slice(1),["any"].concat(s.map(Uo))):t==="all"?["all"].concat(a.slice(1).map(Uo)):t==="none"?["all"].concat(a.slice(1).map(Uo).map(js)):t==="in"?xh(a[1],a.slice(2)):t==="!in"?js(xh(a[1],a.slice(2))):t==="has"?_h(a[1]):t==="!has"?js(_h(a[1])):t!=="within"||a;var s}function $l(a,t,s){switch(a){case"$type":return[`filter-type-${s}`,t];case"$id":return[`filter-id-${s}`,t];default:return[`filter-${s}`,a,t]}}function xh(a,t){if(t.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(s=>typeof s!=typeof t[0])?["filter-in-large",a,["literal",t.sort(Ju)]]:["filter-in-small",a,["literal",t]]}}function _h(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function js(a){return["!",a]}function Vo(a){const t=typeof a;if(t==="number"||t==="boolean"||t==="string"||a==null)return JSON.stringify(a);if(Array.isArray(a)){let d="[";for(const _ of a)d+=`${Vo(_)},`;return`${d}]`}const s=Object.keys(a).sort();let u="{";for(let d=0;d<s.length;d++)u+=`${JSON.stringify(s[d])}:${Vo(a[s[d]])},`;return`${u}}`}function $o(a){let t="";for(const s of Fr)t+=`/${Vo(a[s])}`;return t}function yh(a){const t=a.value;return t?[new lt(a.key,t,"constants have been deprecated as of v8")]:[]}function Hr(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function jn(a){if(Array.isArray(a))return a.map(jn);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const t={};for(const s in a)t[s]=jn(a[s]);return t}return Hr(a)}function Ja(a){const t=a.key,s=a.value,u=a.valueSpec||{},d=a.objectElementValidators||{},_=a.style,v=a.styleSpec,w=a.validateSpec;let k=[];const I=_r(s);if(I!=="object")return[new lt(t,s,`object expected, ${I} found`)];for(const P in s){const O=P.split(".")[0],j=u[O]||u["*"];let W;if(d[O])W=d[O];else if(u[O])W=w;else if(d["*"])W=d["*"];else{if(!u["*"]){k.push(new lt(t,s[P],`unknown property "${P}"`));continue}W=w}k=k.concat(W({key:(t&&`${t}.`)+P,value:s[P],valueSpec:j,style:_,styleSpec:v,object:s,objectKey:P,validateSpec:w},s))}for(const P in u)d[P]||u[P].required&&u[P].default===void 0&&s[P]===void 0&&k.push(new lt(t,s,`missing required property "${P}"`));return k}function fs(a){const t=a.value,s=a.valueSpec,u=a.style,d=a.styleSpec,_=a.key,v=a.arrayElementValidator||a.validateSpec;if(_r(t)!=="array")return[new lt(_,t,`array expected, ${_r(t)} found`)];if(s.length&&t.length!==s.length)return[new lt(_,t,`array length ${s.length} expected, length ${t.length} found`)];if(s["min-length"]&&t.length<s["min-length"])return[new lt(_,t,`array length at least ${s["min-length"]} expected, length ${t.length} found`)];let w={type:s.value,values:s.values};d.$version<7&&(w.function=s.function),_r(s.value)==="object"&&(w=s.value);let k=[];for(let I=0;I<t.length;I++)k=k.concat(v({array:t,arrayIndex:I,value:t[I],valueSpec:w,validateSpec:a.validateSpec,style:u,styleSpec:d,key:`${_}[${I}]`}));return k}function Gs(a){const t=a.key,s=a.value,u=a.valueSpec;let d=_r(s);return d==="number"&&s!=s&&(d="NaN"),d!=="number"?[new lt(t,s,`number expected, ${d} found`)]:"minimum"in u&&s<u.minimum?[new lt(t,s,`${s} is less than the minimum value ${u.minimum}`)]:"maximum"in u&&s>u.maximum?[new lt(t,s,`${s} is greater than the maximum value ${u.maximum}`)]:[]}function jo(a){const t=a.valueSpec,s=Hr(a.value.type);let u,d,_,v={};const w=s!=="categorical"&&a.value.property===void 0,k=!w,I=_r(a.value.stops)==="array"&&_r(a.value.stops[0])==="array"&&_r(a.value.stops[0][0])==="object",P=Ja({key:a.key,value:a.value,valueSpec:a.styleSpec.function,validateSpec:a.validateSpec,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(W){if(s==="identity")return[new lt(W.key,W.value,'identity function may not have a "stops" property')];let Z=[];const ne=W.value;return Z=Z.concat(fs({key:W.key,value:ne,valueSpec:W.valueSpec,validateSpec:W.validateSpec,style:W.style,styleSpec:W.styleSpec,arrayElementValidator:O})),_r(ne)==="array"&&ne.length===0&&Z.push(new lt(W.key,ne,"array must have at least one stop")),Z},default:function(W){return W.validateSpec({key:W.key,value:W.value,valueSpec:t,validateSpec:W.validateSpec,style:W.style,styleSpec:W.styleSpec})}}});return s==="identity"&&w&&P.push(new lt(a.key,a.value,'missing required property "property"')),s==="identity"||a.value.stops||P.push(new lt(a.key,a.value,'missing required property "stops"')),s==="exponential"&&a.valueSpec.expression&&!Bl(a.valueSpec)&&P.push(new lt(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(k&&!us(a.valueSpec)?P.push(new lt(a.key,a.value,"property functions not supported")):w&&!ph(a.valueSpec)&&P.push(new lt(a.key,a.value,"zoom functions not supported"))),s!=="categorical"&&!I||a.value.property!==void 0||P.push(new lt(a.key,a.value,'"property" property is required')),P;function O(W){let Z=[];const ne=W.value,fe=W.key;if(_r(ne)!=="array")return[new lt(fe,ne,`array expected, ${_r(ne)} found`)];if(ne.length!==2)return[new lt(fe,ne,`array length 2 expected, length ${ne.length} found`)];if(I){if(_r(ne[0])!=="object")return[new lt(fe,ne,`object expected, ${_r(ne[0])} found`)];if(ne[0].zoom===void 0)return[new lt(fe,ne,"object stop key must have zoom")];if(ne[0].value===void 0)return[new lt(fe,ne,"object stop key must have value")];if(_&&_>Hr(ne[0].zoom))return[new lt(fe,ne[0].zoom,"stop zoom values must appear in ascending order")];Hr(ne[0].zoom)!==_&&(_=Hr(ne[0].zoom),d=void 0,v={}),Z=Z.concat(Ja({key:`${fe}[0]`,value:ne[0],valueSpec:{zoom:{}},validateSpec:W.validateSpec,style:W.style,styleSpec:W.styleSpec,objectElementValidators:{zoom:Gs,value:j}}))}else Z=Z.concat(j({key:`${fe}[0]`,value:ne[0],valueSpec:{},validateSpec:W.validateSpec,style:W.style,styleSpec:W.styleSpec},ne));return Bo(jn(ne[1]))?Z.concat([new lt(`${fe}[1]`,ne[1],"expressions are not allowed in function stops.")]):Z.concat(W.validateSpec({key:`${fe}[1]`,value:ne[1],valueSpec:t,validateSpec:W.validateSpec,style:W.style,styleSpec:W.styleSpec}))}function j(W,Z){const ne=_r(W.value),fe=Hr(W.value),ye=W.value!==null?W.value:Z;if(u){if(ne!==u)return[new lt(W.key,ye,`${ne} stop domain type must match previous stop domain type ${u}`)]}else u=ne;if(ne!=="number"&&ne!=="string"&&ne!=="boolean")return[new lt(W.key,ye,"stop domain value must be a number, string, or boolean")];if(ne!=="number"&&s!=="categorical"){let Me=`number expected, ${ne} found`;return us(t)&&s===void 0&&(Me+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new lt(W.key,ye,Me)]}return s!=="categorical"||ne!=="number"||isFinite(fe)&&Math.floor(fe)===fe?s!=="categorical"&&ne==="number"&&d!==void 0&&fe<d?[new lt(W.key,ye,"stop domain values must appear in ascending order")]:(d=fe,s==="categorical"&&fe in v?[new lt(W.key,ye,"stop domain values must be unique")]:(v[fe]=!0,[])):[new lt(W.key,ye,`integer expected, found ${fe}`)]}}function Gn(a){const t=(a.expressionContext==="property"?Ul:zo)(jn(a.value),a.valueSpec);if(t.result==="error")return t.value.map(u=>new lt(`${a.key}${u.key}`,a.value,u.message));const s=t.value.expression||t.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!s.outputDefined())return[new lt(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!zs(s))return[new lt(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter"&&!zs(s))return[new lt(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!Fo(s,["zoom","feature-state"]))return[new lt(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!Io(s))return[new lt(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Hs(a){const t=a.key,s=a.value,u=a.valueSpec,d=[];return Array.isArray(u.values)?u.values.indexOf(Hr(s))===-1&&d.push(new lt(t,s,`expected one of [${u.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(u.values).indexOf(Hr(s))===-1&&d.push(new lt(t,s,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(s)} found`)),d}function ds(a){return $s(jn(a.value))?Gn(Mt({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):vh(a)}function vh(a){const t=a.value,s=a.key;if(_r(t)!=="array")return[new lt(s,t,`array expected, ${_r(t)} found`)];const u=a.styleSpec;let d,_=[];if(t.length<1)return[new lt(s,t,"filter array must have at least 1 element")];switch(_=_.concat(Hs({key:`${s}[0]`,value:t[0],valueSpec:u.filter_operator,style:a.style,styleSpec:a.styleSpec})),Hr(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Hr(t[1])==="$type"&&_.push(new lt(s,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&_.push(new lt(s,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(d=_r(t[1]),d!=="string"&&_.push(new lt(`${s}[1]`,t[1],`string expected, ${d} found`)));for(let v=2;v<t.length;v++)d=_r(t[v]),Hr(t[1])==="$type"?_=_.concat(Hs({key:`${s}[${v}]`,value:t[v],valueSpec:u.geometry_type,style:a.style,styleSpec:a.styleSpec})):d!=="string"&&d!=="number"&&d!=="boolean"&&_.push(new lt(`${s}[${v}]`,t[v],`string, number, or boolean expected, ${d} found`));break;case"any":case"all":case"none":for(let v=1;v<t.length;v++)_=_.concat(vh({key:`${s}[${v}]`,value:t[v],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":d=_r(t[1]),t.length!==2?_.push(new lt(s,t,`filter array for "${t[0]}" operator must have 2 elements`)):d!=="string"&&_.push(new lt(`${s}[1]`,t[1],`string expected, ${d} found`));break;case"within":d=_r(t[1]),t.length!==2?_.push(new lt(s,t,`filter array for "${t[0]}" operator must have 2 elements`)):d!=="object"&&_.push(new lt(`${s}[1]`,t[1],`object expected, ${d} found`))}return _}function wh(a,t){const s=a.key,u=a.validateSpec,d=a.style,_=a.styleSpec,v=a.value,w=a.objectKey,k=_[`${t}_${a.layerType}`];if(!k)return[];const I=w.match(/^(.*)-transition$/);if(t==="paint"&&I&&k[I[1]]&&k[I[1]].transition)return u({key:s,value:v,valueSpec:_.transition,style:d,styleSpec:_});const P=a.valueSpec||k[w];if(!P)return[new lt(s,v,`unknown property "${w}"`)];let O;if(_r(v)==="string"&&us(P)&&!P.tokens&&(O=/^{([^}]+)}$/.exec(v)))return[new lt(s,v,`"${w}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(O[1])} }\`.`)];const j=[];return a.layerType==="symbol"&&(w==="text-field"&&d&&!d.glyphs&&j.push(new lt(s,v,'use of "text-field" requires a style "glyphs" property')),w==="text-font"&&Ur(jn(v))&&Hr(v.type)==="identity"&&j.push(new lt(s,v,'"text-font" does not support identity functions'))),j.concat(u({key:a.key,value:v,valueSpec:P,style:d,styleSpec:_,expressionContext:"property",propertyType:t,propertyKey:w}))}function bh(a){return wh(a,"paint")}function Th(a){return wh(a,"layout")}function Eh(a){let t=[];const s=a.value,u=a.key,d=a.style,_=a.styleSpec;s.type||s.ref||t.push(new lt(u,s,'either "type" or "ref" is required'));let v=Hr(s.type);const w=Hr(s.ref);if(s.id){const k=Hr(s.id);for(let I=0;I<a.arrayIndex;I++){const P=d.layers[I];Hr(P.id)===k&&t.push(new lt(u,s.id,`duplicate layer id "${s.id}", previously used at line ${P.id.__line__}`))}}if("ref"in s){let k;["type","source","source-layer","filter","layout"].forEach(I=>{I in s&&t.push(new lt(u,s[I],`"${I}" is prohibited for ref layers`))}),d.layers.forEach(I=>{Hr(I.id)===w&&(k=I)}),k?k.ref?t.push(new lt(u,s.ref,"ref cannot reference another ref layer")):v=Hr(k.type):t.push(new lt(u,s.ref,`ref layer "${w}" not found`))}else if(v!=="background")if(s.source){const k=d.sources&&d.sources[s.source],I=k&&Hr(k.type);k?I==="vector"&&v==="raster"?t.push(new lt(u,s.source,`layer "${s.id}" requires a raster source`)):I!=="raster-dem"&&v==="hillshade"?t.push(new lt(u,s.source,`layer "${s.id}" requires a raster-dem source`)):I==="raster"&&v!=="raster"?t.push(new lt(u,s.source,`layer "${s.id}" requires a vector source`)):I!=="vector"||s["source-layer"]?I==="raster-dem"&&v!=="hillshade"?t.push(new lt(u,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):v!=="line"||!s.paint||!s.paint["line-gradient"]||I==="geojson"&&k.lineMetrics||t.push(new lt(u,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new lt(u,s,`layer "${s.id}" must specify a "source-layer"`)):t.push(new lt(u,s.source,`source "${s.source}" not found`))}else t.push(new lt(u,s,'missing required property "source"'));return t=t.concat(Ja({key:u,value:s,valueSpec:_.layer,style:a.style,styleSpec:a.styleSpec,validateSpec:a.validateSpec,objectElementValidators:{"*":()=>[],type:()=>a.validateSpec({key:`${u}.type`,value:s.type,valueSpec:_.layer.type,style:a.style,styleSpec:a.styleSpec,validateSpec:a.validateSpec,object:s,objectKey:"type"}),filter:ds,layout:k=>Ja({layer:s,key:k.key,value:k.value,style:k.style,styleSpec:k.styleSpec,validateSpec:k.validateSpec,objectElementValidators:{"*":I=>Th(Mt({layerType:v},I))}}),paint:k=>Ja({layer:s,key:k.key,value:k.value,style:k.style,styleSpec:k.styleSpec,validateSpec:k.validateSpec,objectElementValidators:{"*":I=>bh(Mt({layerType:v},I))}})}})),t}function qi(a){const t=a.value,s=a.key,u=_r(t);return u!=="string"?[new lt(s,t,`string expected, ${u} found`)]:[]}const qs={promoteId:function({key:a,value:t}){if(_r(t)==="string")return qi({key:a,value:t});{const s=[];for(const u in t)s.push(...qi({key:`${a}.${u}`,value:t[u]}));return s}}};function mi(a){const t=a.value,s=a.key,u=a.styleSpec,d=a.style,_=a.validateSpec;if(!t.type)return[new lt(s,t,'"type" is required')];const v=Hr(t.type);let w;switch(v){case"vector":case"raster":return w=Ja({key:s,value:t,valueSpec:u[`source_${v.replace("-","_")}`],style:a.style,styleSpec:u,objectElementValidators:qs,validateSpec:_}),w;case"raster-dem":return w=function(k){var I;const P=(I=k.sourceName)!==null&&I!==void 0?I:"",O=k.value,j=k.styleSpec,W=j.source_raster_dem,Z=k.style;let ne=[];const fe=_r(O);if(O===void 0)return ne;if(fe!=="object")return ne.push(new lt("source_raster_dem",O,`object expected, ${fe} found`)),ne;const ye=Hr(O.encoding)==="custom",Me=["redFactor","greenFactor","blueFactor","baseShift"],Ee=k.value.encoding?`"${k.value.encoding}"`:"Default";for(const Oe in O)!ye&&Me.includes(Oe)?ne.push(new lt(Oe,O[Oe],`In "${P}": "${Oe}" is only valid when "encoding" is set to "custom". ${Ee} encoding found`)):W[Oe]?ne=ne.concat(k.validateSpec({key:Oe,value:O[Oe],valueSpec:W[Oe],validateSpec:k.validateSpec,style:Z,styleSpec:j})):ne.push(new lt(Oe,O[Oe],`unknown property "${Oe}"`));return ne}({sourceName:s,value:t,style:a.style,styleSpec:u,validateSpec:_}),w;case"geojson":if(w=Ja({key:s,value:t,valueSpec:u.source_geojson,style:d,styleSpec:u,validateSpec:_,objectElementValidators:qs}),t.cluster)for(const k in t.clusterProperties){const[I,P]=t.clusterProperties[k],O=typeof I=="string"?[I,["accumulated"],["get",k]]:I;w.push(...Gn({key:`${s}.${k}.map`,value:P,validateSpec:_,expressionContext:"cluster-map"})),w.push(...Gn({key:`${s}.${k}.reduce`,value:O,validateSpec:_,expressionContext:"cluster-reduce"}))}return w;case"video":return Ja({key:s,value:t,valueSpec:u.source_video,style:d,validateSpec:_,styleSpec:u});case"image":return Ja({key:s,value:t,valueSpec:u.source_image,style:d,validateSpec:_,styleSpec:u});case"canvas":return[new lt(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Hs({key:`${s}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:d,validateSpec:_,styleSpec:u})}}function Ws(a){const t=a.value,s=a.styleSpec,u=s.light,d=a.style;let _=[];const v=_r(t);if(t===void 0)return _;if(v!=="object")return _=_.concat([new lt("light",t,`object expected, ${v} found`)]),_;for(const w in t){const k=w.match(/^(.*)-transition$/);_=_.concat(k&&u[k[1]]&&u[k[1]].transition?a.validateSpec({key:w,value:t[w],valueSpec:s.transition,validateSpec:a.validateSpec,style:d,styleSpec:s}):u[w]?a.validateSpec({key:w,value:t[w],valueSpec:u[w],validateSpec:a.validateSpec,style:d,styleSpec:s}):[new lt(w,t[w],`unknown property "${w}"`)])}return _}function Sh(a){const t=a.value,s=a.styleSpec,u=s.terrain,d=a.style;let _=[];const v=_r(t);if(t===void 0)return _;if(v!=="object")return _=_.concat([new lt("terrain",t,`object expected, ${v} found`)]),_;for(const w in t)_=_.concat(u[w]?a.validateSpec({key:w,value:t[w],valueSpec:u[w],validateSpec:a.validateSpec,style:d,styleSpec:s}):[new lt(w,t[w],`unknown property "${w}"`)]);return _}function kh(a){let t=[];const s=a.value,u=a.key;if(Array.isArray(s)){const d=[],_=[];for(const v in s)s[v].id&&d.includes(s[v].id)&&t.push(new lt(u,s,`all the sprites' ids must be unique, but ${s[v].id} is duplicated`)),d.push(s[v].id),s[v].url&&_.includes(s[v].url)&&t.push(new lt(u,s,`all the sprites' URLs must be unique, but ${s[v].url} is duplicated`)),_.push(s[v].url),t=t.concat(Ja({key:`${u}[${v}]`,value:s[v],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:a.validateSpec}));return t}return qi({key:u,value:s})}const Ch={"*":()=>[],array:fs,boolean:function(a){const t=a.value,s=a.key,u=_r(t);return u!=="boolean"?[new lt(s,t,`boolean expected, ${u} found`)]:[]},number:Gs,color:function(a){const t=a.key,s=a.value,u=_r(s);return u!=="string"?[new lt(t,s,`color expected, ${u} found`)]:Qt.parse(String(s))?[]:[new lt(t,s,`color expected, "${s}" found`)]},constants:yh,enum:Hs,filter:ds,function:jo,layer:Eh,object:Ja,source:mi,light:Ws,terrain:Sh,string:qi,formatted:function(a){return qi(a).length===0?[]:Gn(a)},resolvedImage:function(a){return qi(a).length===0?[]:Gn(a)},padding:function(a){const t=a.key,s=a.value;if(_r(s)==="array"){if(s.length<1||s.length>4)return[new lt(t,s,`padding requires 1 to 4 values; ${s.length} values found`)];const u={type:"number"};let d=[];for(let _=0;_<s.length;_++)d=d.concat(a.validateSpec({key:`${t}[${_}]`,value:s[_],validateSpec:a.validateSpec,valueSpec:u}));return d}return Gs({key:t,value:s,valueSpec:{}})},variableAnchorOffsetCollection:function(a){const t=a.key,s=a.value,u=_r(s),d=a.styleSpec;if(u!=="array"||s.length<1||s.length%2!=0)return[new lt(t,s,"variableAnchorOffsetCollection requires a non-empty array of even length")];let _=[];for(let v=0;v<s.length;v+=2)_=_.concat(Hs({key:`${t}[${v}]`,value:s[v],valueSpec:d.layout_symbol["text-anchor"]})),_=_.concat(fs({key:`${t}[${v+1}]`,value:s[v+1],valueSpec:{length:2,value:"number"},validateSpec:a.validateSpec,style:a.style,styleSpec:d}));return _},sprite:kh};function ln(a){const t=a.value,s=a.valueSpec,u=a.styleSpec;return a.validateSpec=ln,s.expression&&Ur(Hr(t))?jo(a):s.expression&&Bo(jn(t))?Gn(a):s.type&&Ch[s.type]?Ch[s.type](a):Ja(Mt({},a,{valueSpec:s.type?u[s.type]:s}))}function Ah(a){const t=a.value,s=a.key,u=qi(a);return u.length||(t.indexOf("{fontstack}")===-1&&u.push(new lt(s,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&u.push(new lt(s,t,'"glyphs" url must include a "{range}" token'))),u}function Fi(a,t=Xe){let s=[];return s=s.concat(ln({key:"",value:a,valueSpec:t.$root,styleSpec:t,style:a,validateSpec:ln,objectElementValidators:{glyphs:Ah,"*":()=>[]}})),a.constants&&(s=s.concat(yh({key:"constants",value:a.constants,style:a,styleSpec:t,validateSpec:ln}))),Go(s)}function cn(a){return function(t){return a({...t,validateSpec:ln})}}function Go(a){return[].concat(a).sort((t,s)=>t.line-s.line)}function hn(a){return function(...t){return Go(a.apply(this,t))}}Fi.source=hn(cn(mi)),Fi.sprite=hn(cn(kh)),Fi.glyphs=hn(cn(Ah)),Fi.light=hn(cn(Ws)),Fi.terrain=hn(cn(Sh)),Fi.layer=hn(cn(Eh)),Fi.filter=hn(cn(ds)),Fi.paintProperty=hn(cn(bh)),Fi.layoutProperty=hn(cn(Th));const un=Fi,Qu=un.light,jl=un.paintProperty,Ih=un.layoutProperty;function Ho(a,t){let s=!1;if(t&&t.length)for(const u of t)a.fire(new wr(new Error(u.message))),s=!0;return s}class ps{constructor(t,s,u){const d=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const v=new Int32Array(this.arrayBuffer);t=v[0],this.d=(s=v[1])+2*(u=v[2]);for(let k=0;k<this.d*this.d;k++){const I=v[3+k],P=v[3+k+1];d.push(I===P?null:v.subarray(I,P))}const w=v[3+d.length+1];this.keys=v.subarray(v[3+d.length],w),this.bboxes=v.subarray(w),this.insert=this._insertReadonly}else{this.d=s+2*u;for(let v=0;v<this.d*this.d;v++)d.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=t,this.padding=u,this.scale=s/t,this.uid=0;const _=u/s*t;this.min=-_,this.max=t+_}insert(t,s,u,d,_){this._forEachCell(s,u,d,_,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(s),this.bboxes.push(u),this.bboxes.push(d),this.bboxes.push(_)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,s,u,d,_,v){this.cells[_].push(v)}query(t,s,u,d,_){const v=this.min,w=this.max;if(t<=v&&s<=v&&w<=u&&w<=d&&!_)return Array.prototype.slice.call(this.keys);{const k=[];return this._forEachCell(t,s,u,d,this._queryCell,k,{},_),k}}_queryCell(t,s,u,d,_,v,w,k){const I=this.cells[_];if(I!==null){const P=this.keys,O=this.bboxes;for(let j=0;j<I.length;j++){const W=I[j];if(w[W]===void 0){const Z=4*W;(k?k(O[Z+0],O[Z+1],O[Z+2],O[Z+3]):t<=O[Z+2]&&s<=O[Z+3]&&u>=O[Z+0]&&d>=O[Z+1])?(w[W]=!0,v.push(P[W])):w[W]=!1}}}}_forEachCell(t,s,u,d,_,v,w,k){const I=this._convertToCellCoord(t),P=this._convertToCellCoord(s),O=this._convertToCellCoord(u),j=this._convertToCellCoord(d);for(let W=I;W<=O;W++)for(let Z=P;Z<=j;Z++){const ne=this.d*Z+W;if((!k||k(this._convertFromCellCoord(W),this._convertFromCellCoord(Z),this._convertFromCellCoord(W+1),this._convertFromCellCoord(Z+1)))&&_.call(this,t,s,u,d,ne,v,w,k))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,s=3+this.cells.length+1+1;let u=0;for(let v=0;v<this.cells.length;v++)u+=this.cells[v].length;const d=new Int32Array(s+u+this.keys.length+this.bboxes.length);d[0]=this.extent,d[1]=this.n,d[2]=this.padding;let _=s;for(let v=0;v<t.length;v++){const w=t[v];d[3+v]=_,d.set(w,_),_+=w.length}return d[3+t.length]=_,d.set(this.keys,_),_+=this.keys.length,d[3+t.length+1]=_,d.set(this.bboxes,_),_+=this.bboxes.length,d.buffer}static serialize(t,s){const u=t.toArrayBuffer();return s&&s.push(u),{buffer:u}}static deserialize(t){return new ps(t.buffer)}}const fn={};function It(a,t,s={}){if(fn[a])throw new Error(`${a} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:a,writeable:!1}),fn[a]={klass:t,omit:s.omit||[],shallow:s.shallow||[]}}It("Object",Object),It("TransferableGridIndex",ps),It("Color",Qt),It("Error",Error),It("AJAXError",wt),It("ResolvedImage",ka),It("StylePropertyFunction",Us),It("StyleExpression",zl,{omit:["_evaluator"]}),It("ZoomDependentExpression",No),It("ZoomConstantExpression",Nl),It("CompoundExpression",Ii,{omit:["_evaluate"]});for(const a in hs)hs[a]._classRegistryKey||It(`Expression_${a}`,hs[a]);function qo(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function An(a,t){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||a instanceof Blob)return a;if(qo(a)||qe(a))return t&&t.push(a),a;if(ArrayBuffer.isView(a)){const s=a;return t&&t.push(s.buffer),s}if(a instanceof ImageData)return t&&t.push(a.data.buffer),a;if(Array.isArray(a)){const s=[];for(const u of a)s.push(An(u,t));return s}if(typeof a=="object"){const s=a.constructor,u=s._classRegistryKey;if(!u)throw new Error("can't serialize object of unregistered class");if(!fn[u])throw new Error(`${u} is not registered.`);const d=s.serialize?s.serialize(a,t):{};if(s.serialize){if(t&&d===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const _ in a){if(!a.hasOwnProperty(_)||fn[u].omit.indexOf(_)>=0)continue;const v=a[_];d[_]=fn[u].shallow.indexOf(_)>=0?v:An(v,t)}a instanceof Error&&(d.message=a.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(d.$name=u),d}throw new Error("can't serialize object of type "+typeof a)}function ms(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||a instanceof Blob||qo(a)||qe(a)||ArrayBuffer.isView(a)||a instanceof ImageData)return a;if(Array.isArray(a))return a.map(ms);if(typeof a=="object"){const t=a.$name||"Object";if(!fn[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:s}=fn[t];if(!s)throw new Error(`can't deserialize unregistered class ${t}`);if(s.deserialize)return s.deserialize(a);const u=Object.create(s.prototype);for(const d of Object.keys(a)){if(d==="$name")continue;const _=a[d];u[d]=fn[t].shallow.indexOf(d)>=0?_:ms(_)}return u}throw new Error("can't deserialize object of type "+typeof a)}class Fh{constructor(){this.first=!0}update(t,s){const u=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=u,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=u,!0):(this.lastFloorZoom>u?(this.lastIntegerZoom=u+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<u&&(this.lastIntegerZoom=u,this.lastIntegerZoomTime=s),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=u,!0))}}const Ct={"Latin-1 Supplement":a=>a>=128&&a<=255,Arabic:a=>a>=1536&&a<=1791,"Arabic Supplement":a=>a>=1872&&a<=1919,"Arabic Extended-A":a=>a>=2208&&a<=2303,"Hangul Jamo":a=>a>=4352&&a<=4607,"Unified Canadian Aboriginal Syllabics":a=>a>=5120&&a<=5759,Khmer:a=>a>=6016&&a<=6143,"Unified Canadian Aboriginal Syllabics Extended":a=>a>=6320&&a<=6399,"General Punctuation":a=>a>=8192&&a<=8303,"Letterlike Symbols":a=>a>=8448&&a<=8527,"Number Forms":a=>a>=8528&&a<=8591,"Miscellaneous Technical":a=>a>=8960&&a<=9215,"Control Pictures":a=>a>=9216&&a<=9279,"Optical Character Recognition":a=>a>=9280&&a<=9311,"Enclosed Alphanumerics":a=>a>=9312&&a<=9471,"Geometric Shapes":a=>a>=9632&&a<=9727,"Miscellaneous Symbols":a=>a>=9728&&a<=9983,"Miscellaneous Symbols and Arrows":a=>a>=11008&&a<=11263,"CJK Radicals Supplement":a=>a>=11904&&a<=12031,"Kangxi Radicals":a=>a>=12032&&a<=12255,"Ideographic Description Characters":a=>a>=12272&&a<=12287,"CJK Symbols and Punctuation":a=>a>=12288&&a<=12351,Hiragana:a=>a>=12352&&a<=12447,Katakana:a=>a>=12448&&a<=12543,Bopomofo:a=>a>=12544&&a<=12591,"Hangul Compatibility Jamo":a=>a>=12592&&a<=12687,Kanbun:a=>a>=12688&&a<=12703,"Bopomofo Extended":a=>a>=12704&&a<=12735,"CJK Strokes":a=>a>=12736&&a<=12783,"Katakana Phonetic Extensions":a=>a>=12784&&a<=12799,"Enclosed CJK Letters and Months":a=>a>=12800&&a<=13055,"CJK Compatibility":a=>a>=13056&&a<=13311,"CJK Unified Ideographs Extension A":a=>a>=13312&&a<=19903,"Yijing Hexagram Symbols":a=>a>=19904&&a<=19967,"CJK Unified Ideographs":a=>a>=19968&&a<=40959,"Yi Syllables":a=>a>=40960&&a<=42127,"Yi Radicals":a=>a>=42128&&a<=42191,"Hangul Jamo Extended-A":a=>a>=43360&&a<=43391,"Hangul Syllables":a=>a>=44032&&a<=55215,"Hangul Jamo Extended-B":a=>a>=55216&&a<=55295,"Private Use Area":a=>a>=57344&&a<=63743,"CJK Compatibility Ideographs":a=>a>=63744&&a<=64255,"Arabic Presentation Forms-A":a=>a>=64336&&a<=65023,"Vertical Forms":a=>a>=65040&&a<=65055,"CJK Compatibility Forms":a=>a>=65072&&a<=65103,"Small Form Variants":a=>a>=65104&&a<=65135,"Arabic Presentation Forms-B":a=>a>=65136&&a<=65279,"Halfwidth and Fullwidth Forms":a=>a>=65280&&a<=65519};function Gl(a){for(const t of a)if(ql(t.charCodeAt(0)))return!0;return!1}function Hl(a){for(const t of a)if(!ef(t.charCodeAt(0)))return!1;return!0}function ef(a){return!(Ct.Arabic(a)||Ct["Arabic Supplement"](a)||Ct["Arabic Extended-A"](a)||Ct["Arabic Presentation Forms-A"](a)||Ct["Arabic Presentation Forms-B"](a))}function ql(a){return!(a!==746&&a!==747&&(a<4352||!(Ct["Bopomofo Extended"](a)||Ct.Bopomofo(a)||Ct["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||Ct["CJK Compatibility Ideographs"](a)||Ct["CJK Compatibility"](a)||Ct["CJK Radicals Supplement"](a)||Ct["CJK Strokes"](a)||!(!Ct["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||Ct["CJK Unified Ideographs Extension A"](a)||Ct["CJK Unified Ideographs"](a)||Ct["Enclosed CJK Letters and Months"](a)||Ct["Hangul Compatibility Jamo"](a)||Ct["Hangul Jamo Extended-A"](a)||Ct["Hangul Jamo Extended-B"](a)||Ct["Hangul Jamo"](a)||Ct["Hangul Syllables"](a)||Ct.Hiragana(a)||Ct["Ideographic Description Characters"](a)||Ct.Kanbun(a)||Ct["Kangxi Radicals"](a)||Ct["Katakana Phonetic Extensions"](a)||Ct.Katakana(a)&&a!==12540||!(!Ct["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!Ct["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||Ct["Unified Canadian Aboriginal Syllabics"](a)||Ct["Unified Canadian Aboriginal Syllabics Extended"](a)||Ct["Vertical Forms"](a)||Ct["Yijing Hexagram Symbols"](a)||Ct["Yi Syllables"](a)||Ct["Yi Radicals"](a))))}function Ph(a){return!(ql(a)||function(t){return!!(Ct["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Ct["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Ct["Letterlike Symbols"](t)||Ct["Number Forms"](t)||Ct["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Ct["Control Pictures"](t)&&t!==9251||Ct["Optical Character Recognition"](t)||Ct["Enclosed Alphanumerics"](t)||Ct["Geometric Shapes"](t)||Ct["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Ct["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Ct["CJK Symbols and Punctuation"](t)||Ct.Katakana(t)||Ct["Private Use Area"](t)||Ct["CJK Compatibility Forms"](t)||Ct["Small Form Variants"](t)||Ct["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(a))}function Mh(a){return a>=1424&&a<=2303||Ct["Arabic Presentation Forms-A"](a)||Ct["Arabic Presentation Forms-B"](a)}function Dh(a,t){return!(!t&&Mh(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||Ct.Khmer(a))}function tf(a){for(const t of a)if(Mh(t.charCodeAt(0)))return!0;return!1}const Wl="deferred",Zl="loading",Xl="loaded";let Kl=null,Qa="unavailable",In=null;const Zs=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(Qa="error"),Kl&&Kl(a)};function Yl(){Xs.fire(new Et("pluginStateChange",{pluginStatus:Qa,pluginURL:In}))}const Xs=new Wr,Jl=function(){return Qa},Lh=function(){if(Qa!==Wl||!In)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Qa=Zl,Yl(),In&&er({url:In},a=>{a?Zs(a):(Qa=Xl,Yl())})},gi={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Qa===Xl||gi.applyArabicShaping!=null,isLoading:()=>Qa===Zl,setState(a){if(!ft())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Qa=a.pluginStatus,In=a.pluginURL},isParsed(){if(!ft())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return gi.applyArabicShaping!=null&&gi.processBidirectionalText!=null&&gi.processStyledBidirectionalText!=null},getPluginURL(){if(!ft())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return In}};class Pr{constructor(t,s){this.zoom=t,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Fh,this.transition={})}isSupportedScript(t){return function(s,u){for(const d of s)if(!Dh(d.charCodeAt(0),u))return!1;return!0}(t,gi.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,s=t-Math.floor(t),u=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*u}:{fromScale:.5,toScale:1,t:1-(1-u)*s}}}class Wo{constructor(t,s){this.property=t,this.value=s,this.expression=function(u,d){if(Ur(u))return new Us(u,d);if(Bo(u)){const _=Ul(u,d);if(_.result==="error")throw new Error(_.value.map(v=>`${v.key}: ${v.message}`).join(", "));return _.value}{let _=u;return d.type==="color"&&typeof u=="string"?_=Qt.parse(u):d.type!=="padding"||typeof u!="number"&&!Array.isArray(u)?d.type==="variableAnchorOffsetCollection"&&Array.isArray(u)&&(_=Kr.parse(u)):_=ta.parse(u),{kind:"constant",evaluate:()=>_}}}(s===void 0?t.specification.default:s,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,s,u){return this.property.possiblyEvaluate(this,t,s,u)}}class Ql{constructor(t){this.property=t,this.value=new Wo(t,void 0)}transitioned(t,s){return new Oh(this.property,this.value,s,Be({},t.transition,this.transition),t.now)}untransitioned(){return new Oh(this.property,this.value,null,{},0)}}class Rh{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return Re(this._values[t].value.value)}setValue(t,s){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Ql(this._values[t].property)),this._values[t].value=new Wo(this._values[t].property,s===null?void 0:Re(s))}getTransition(t){return Re(this._values[t].transition)}setTransition(t,s){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Ql(this._values[t].property)),this._values[t].transition=Re(s)||void 0}serialize(){const t={};for(const s of Object.keys(this._values)){const u=this.getValue(s);u!==void 0&&(t[s]=u);const d=this.getTransition(s);d!==void 0&&(t[`${s}-transition`]=d)}return t}transitioned(t,s){const u=new Bh(this._properties);for(const d of Object.keys(this._values))u._values[d]=this._values[d].transitioned(t,s._values[d]);return u}untransitioned(){const t=new Bh(this._properties);for(const s of Object.keys(this._values))t._values[s]=this._values[s].untransitioned();return t}}class Oh{constructor(t,s,u,d,_){this.property=t,this.value=s,this.begin=_+d.delay||0,this.end=this.begin+d.duration||0,t.specification.transition&&(d.delay||d.duration)&&(this.prior=u)}possiblyEvaluate(t,s,u){const d=t.now||0,_=this.value.possiblyEvaluate(t,s,u),v=this.prior;if(v){if(d>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(d<this.begin)return v.possiblyEvaluate(t,s,u);{const w=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(v.possiblyEvaluate(t,s,u),_,function(k){if(k<=0)return 0;if(k>=1)return 1;const I=k*k,P=I*k;return 4*(k<.5?P:3*(k-I)+P-.75)}(w))}}return _}}class Bh{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,s,u){const d=new Zo(this._properties);for(const _ of Object.keys(this._values))d._values[_]=this._values[_].possiblyEvaluate(t,s,u);return d}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class rf{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return Re(this._values[t].value)}setValue(t,s){this._values[t]=new Wo(this._values[t].property,s===null?void 0:Re(s))}serialize(){const t={};for(const s of Object.keys(this._values)){const u=this.getValue(s);u!==void 0&&(t[s]=u)}return t}possiblyEvaluate(t,s,u){const d=new Zo(this._properties);for(const _ of Object.keys(this._values))d._values[_]=this._values[_].possiblyEvaluate(t,s,u);return d}}class Na{constructor(t,s,u){this.property=t,this.value=s,this.parameters=u}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,s,u,d){return this.property.evaluate(this.value,this.parameters,t,s,u,d)}}class Zo{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class zt{constructor(t){this.specification=t}possiblyEvaluate(t,s){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(s)}interpolate(t,s,u){const d=di[this.specification.type];return d?d(t,s,u):t}}class Gt{constructor(t,s){this.specification=t,this.overrides=s}possiblyEvaluate(t,s,u,d){return new Na(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(s,null,{},u,d)}:t.expression,s)}interpolate(t,s,u){if(t.value.kind!=="constant"||s.value.kind!=="constant")return t;if(t.value.value===void 0||s.value.value===void 0)return new Na(this,{kind:"constant",value:void 0},t.parameters);const d=di[this.specification.type];if(d){const _=d(t.value.value,s.value.value,u);return new Na(this,{kind:"constant",value:_},t.parameters)}return t}evaluate(t,s,u,d,_,v){return t.kind==="constant"?t.value:t.evaluate(s,u,d,_,v)}}class Ks extends Gt{possiblyEvaluate(t,s,u,d){if(t.value===void 0)return new Na(this,{kind:"constant",value:void 0},s);if(t.expression.kind==="constant"){const _=t.expression.evaluate(s,null,{},u,d),v=t.property.specification.type==="resolvedImage"&&typeof _!="string"?_.name:_,w=this._calculate(v,v,v,s);return new Na(this,{kind:"constant",value:w},s)}if(t.expression.kind==="camera"){const _=this._calculate(t.expression.evaluate({zoom:s.zoom-1}),t.expression.evaluate({zoom:s.zoom}),t.expression.evaluate({zoom:s.zoom+1}),s);return new Na(this,{kind:"constant",value:_},s)}return new Na(this,t.expression,s)}evaluate(t,s,u,d,_,v){if(t.kind==="source"){const w=t.evaluate(s,u,d,_,v);return this._calculate(w,w,w,s)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(s.zoom)-1},u,d),t.evaluate({zoom:Math.floor(s.zoom)},u,d),t.evaluate({zoom:Math.floor(s.zoom)+1},u,d),s):t.value}_calculate(t,s,u,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:t,to:s}:{from:u,to:s}}interpolate(t){return t}}class ec{constructor(t){this.specification=t}possiblyEvaluate(t,s,u,d){if(t.value!==void 0){if(t.expression.kind==="constant"){const _=t.expression.evaluate(s,null,{},u,d);return this._calculate(_,_,_,s)}return this._calculate(t.expression.evaluate(new Pr(Math.floor(s.zoom-1),s)),t.expression.evaluate(new Pr(Math.floor(s.zoom),s)),t.expression.evaluate(new Pr(Math.floor(s.zoom+1),s)),s)}}_calculate(t,s,u,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:t,to:s}:{from:u,to:s}}interpolate(t){return t}}class tc{constructor(t){this.specification=t}possiblyEvaluate(t,s,u,d){return!!t.expression.evaluate(s,null,{},u,d)}interpolate(){return!1}}class ra{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const s in t){const u=t[s];u.specification.overridable&&this.overridableProperties.push(s);const d=this.defaultPropertyValues[s]=new Wo(u,void 0),_=this.defaultTransitionablePropertyValues[s]=new Ql(u);this.defaultTransitioningPropertyValues[s]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=d.possiblyEvaluate({})}}}It("DataDrivenProperty",Gt),It("DataConstantProperty",zt),It("CrossFadedDataDrivenProperty",Ks),It("CrossFadedProperty",ec),It("ColorRampProperty",tc);const rc="-transition";class Pi extends Wr{constructor(t,s){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),s.layout&&(this._unevaluatedLayout=new rf(s.layout)),s.paint)){this._transitionablePaint=new Rh(s.paint);for(const u in t.paint)this.setPaintProperty(u,t.paint[u],{validate:!1});for(const u in t.layout)this.setLayoutProperty(u,t.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Zo(s.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,s,u={}){s!=null&&this._validate(Ih,`layers.${this.id}.layout.${t}`,t,s,u)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,s):this.visibility=s)}getPaintProperty(t){return t.endsWith(rc)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,s,u={}){if(s!=null&&this._validate(jl,`layers.${this.id}.paint.${t}`,t,s,u))return!1;if(t.endsWith(rc))return this._transitionablePaint.setTransition(t.slice(0,-11),s||void 0),!1;{const d=this._transitionablePaint._values[t],_=d.property.specification["property-type"]==="cross-faded-data-driven",v=d.value.isDataDriven(),w=d.value;this._transitionablePaint.setValue(t,s),this._handleSpecialPaintPropertyUpdate(t);const k=this._transitionablePaint._values[t].value;return k.isDataDriven()||v||_||this._handleOverridablePaintPropertyUpdate(t,w,k)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,s,u){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,s){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,s)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),$e(t,(s,u)=>!(s===void 0||u==="layout"&&!Object.keys(s).length||u==="paint"&&!Object.keys(s).length))}_validate(t,s,u,d,_={}){return(!_||_.validate!==!1)&&Ho(this,t.call(un,{key:s,layerType:this.type,objectKey:u,value:d,styleSpec:Xe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const s=this.paint.get(t);if(s instanceof Na&&us(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}return!1}}const zh={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Hn{constructor(t,s){this._structArray=t,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class qr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,s){return t._trim(),s&&(t.isTransferred=!0,s.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const s=Object.create(this.prototype);return s.arrayBuffer=t.arrayBuffer,s.length=t.length,s.capacity=t.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function $r(a,t=1){let s=0,u=0;return{members:a.map(d=>{const _=zh[d.type].BYTES_PER_ELEMENT,v=s=gs(s,Math.max(t,_)),w=d.components||1;return u=Math.max(u,_),s+=_*w,{name:d.name,type:d.type,components:w,offset:v}}),size:gs(s,Math.max(u,t)),alignment:t}}function gs(a,t){return Math.ceil(a/t)*t}class Ys extends qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s){const u=this.length;return this.resize(u+1),this.emplace(u,t,s)}emplace(t,s,u){const d=2*t;return this.int16[d+0]=s,this.int16[d+1]=u,t}}Ys.prototype.bytesPerElement=4,It("StructArrayLayout2i4",Ys);class Js extends qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,u){const d=this.length;return this.resize(d+1),this.emplace(d,t,s,u)}emplace(t,s,u,d){const _=3*t;return this.int16[_+0]=s,this.int16[_+1]=u,this.int16[_+2]=d,t}}Js.prototype.bytesPerElement=6,It("StructArrayLayout3i6",Js);class qn extends qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,u,d){const _=this.length;return this.resize(_+1),this.emplace(_,t,s,u,d)}emplace(t,s,u,d,_){const v=4*t;return this.int16[v+0]=s,this.int16[v+1]=u,this.int16[v+2]=d,this.int16[v+3]=_,t}}qn.prototype.bytesPerElement=8,It("StructArrayLayout4i8",qn);class ac extends qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,u,d,_,v){const w=this.length;return this.resize(w+1),this.emplace(w,t,s,u,d,_,v)}emplace(t,s,u,d,_,v,w){const k=6*t;return this.int16[k+0]=s,this.int16[k+1]=u,this.int16[k+2]=d,this.int16[k+3]=_,this.int16[k+4]=v,this.int16[k+5]=w,t}}ac.prototype.bytesPerElement=12,It("StructArrayLayout2i4i12",ac);class ic extends qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,u,d,_,v){const w=this.length;return this.resize(w+1),this.emplace(w,t,s,u,d,_,v)}emplace(t,s,u,d,_,v,w){const k=4*t,I=8*t;return this.int16[k+0]=s,this.int16[k+1]=u,this.uint8[I+4]=d,this.uint8[I+5]=_,this.uint8[I+6]=v,this.uint8[I+7]=w,t}}ic.prototype.bytesPerElement=8,It("StructArrayLayout2i4ub8",ic);class xs extends qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s){const u=this.length;return this.resize(u+1),this.emplace(u,t,s)}emplace(t,s,u){const d=2*t;return this.float32[d+0]=s,this.float32[d+1]=u,t}}xs.prototype.bytesPerElement=8,It("StructArrayLayout2f8",xs);class nc extends qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,u,d,_,v,w,k,I,P){const O=this.length;return this.resize(O+1),this.emplace(O,t,s,u,d,_,v,w,k,I,P)}emplace(t,s,u,d,_,v,w,k,I,P,O){const j=10*t;return this.uint16[j+0]=s,this.uint16[j+1]=u,this.uint16[j+2]=d,this.uint16[j+3]=_,this.uint16[j+4]=v,this.uint16[j+5]=w,this.uint16[j+6]=k,this.uint16[j+7]=I,this.uint16[j+8]=P,this.uint16[j+9]=O,t}}nc.prototype.bytesPerElement=20,It("StructArrayLayout10ui20",nc);class sc extends qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,u,d,_,v,w,k,I,P,O,j){const W=this.length;return this.resize(W+1),this.emplace(W,t,s,u,d,_,v,w,k,I,P,O,j)}emplace(t,s,u,d,_,v,w,k,I,P,O,j,W){const Z=12*t;return this.int16[Z+0]=s,this.int16[Z+1]=u,this.int16[Z+2]=d,this.int16[Z+3]=_,this.uint16[Z+4]=v,this.uint16[Z+5]=w,this.uint16[Z+6]=k,this.uint16[Z+7]=I,this.int16[Z+8]=P,this.int16[Z+9]=O,this.int16[Z+10]=j,this.int16[Z+11]=W,t}}sc.prototype.bytesPerElement=24,It("StructArrayLayout4i4ui4i24",sc);class yr extends qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,u){const d=this.length;return this.resize(d+1),this.emplace(d,t,s,u)}emplace(t,s,u,d){const _=3*t;return this.float32[_+0]=s,this.float32[_+1]=u,this.float32[_+2]=d,t}}yr.prototype.bytesPerElement=12,It("StructArrayLayout3f12",yr);class g extends qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint32[1*t+0]=s,t}}g.prototype.bytesPerElement=4,It("StructArrayLayout1ul4",g);class r extends qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,u,d,_,v,w,k,I){const P=this.length;return this.resize(P+1),this.emplace(P,t,s,u,d,_,v,w,k,I)}emplace(t,s,u,d,_,v,w,k,I,P){const O=10*t,j=5*t;return this.int16[O+0]=s,this.int16[O+1]=u,this.int16[O+2]=d,this.int16[O+3]=_,this.int16[O+4]=v,this.int16[O+5]=w,this.uint32[j+3]=k,this.uint16[O+8]=I,this.uint16[O+9]=P,t}}r.prototype.bytesPerElement=20,It("StructArrayLayout6i1ul2ui20",r);class l extends qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,u,d,_,v){const w=this.length;return this.resize(w+1),this.emplace(w,t,s,u,d,_,v)}emplace(t,s,u,d,_,v,w){const k=6*t;return this.int16[k+0]=s,this.int16[k+1]=u,this.int16[k+2]=d,this.int16[k+3]=_,this.int16[k+4]=v,this.int16[k+5]=w,t}}l.prototype.bytesPerElement=12,It("StructArrayLayout2i2i2i12",l);class f extends qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,u,d,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,s,u,d,_)}emplace(t,s,u,d,_,v){const w=4*t,k=8*t;return this.float32[w+0]=s,this.float32[w+1]=u,this.float32[w+2]=d,this.int16[k+6]=_,this.int16[k+7]=v,t}}f.prototype.bytesPerElement=16,It("StructArrayLayout2f1f2i16",f);class p extends qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,u,d){const _=this.length;return this.resize(_+1),this.emplace(_,t,s,u,d)}emplace(t,s,u,d,_){const v=12*t,w=3*t;return this.uint8[v+0]=s,this.uint8[v+1]=u,this.float32[w+1]=d,this.float32[w+2]=_,t}}p.prototype.bytesPerElement=12,It("StructArrayLayout2ub2f12",p);class y extends qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,u){const d=this.length;return this.resize(d+1),this.emplace(d,t,s,u)}emplace(t,s,u,d){const _=3*t;return this.uint16[_+0]=s,this.uint16[_+1]=u,this.uint16[_+2]=d,t}}y.prototype.bytesPerElement=6,It("StructArrayLayout3ui6",y);class T extends qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,u,d,_,v,w,k,I,P,O,j,W,Z,ne,fe,ye){const Me=this.length;return this.resize(Me+1),this.emplace(Me,t,s,u,d,_,v,w,k,I,P,O,j,W,Z,ne,fe,ye)}emplace(t,s,u,d,_,v,w,k,I,P,O,j,W,Z,ne,fe,ye,Me){const Ee=24*t,Oe=12*t,Ge=48*t;return this.int16[Ee+0]=s,this.int16[Ee+1]=u,this.uint16[Ee+2]=d,this.uint16[Ee+3]=_,this.uint32[Oe+2]=v,this.uint32[Oe+3]=w,this.uint32[Oe+4]=k,this.uint16[Ee+10]=I,this.uint16[Ee+11]=P,this.uint16[Ee+12]=O,this.float32[Oe+7]=j,this.float32[Oe+8]=W,this.uint8[Ge+36]=Z,this.uint8[Ge+37]=ne,this.uint8[Ge+38]=fe,this.uint32[Oe+10]=ye,this.int16[Ee+22]=Me,t}}T.prototype.bytesPerElement=48,It("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",T);class E extends qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,u,d,_,v,w,k,I,P,O,j,W,Z,ne,fe,ye,Me,Ee,Oe,Ge,tt,At,Rt,kt,Tt,yt,Pt){const vt=this.length;return this.resize(vt+1),this.emplace(vt,t,s,u,d,_,v,w,k,I,P,O,j,W,Z,ne,fe,ye,Me,Ee,Oe,Ge,tt,At,Rt,kt,Tt,yt,Pt)}emplace(t,s,u,d,_,v,w,k,I,P,O,j,W,Z,ne,fe,ye,Me,Ee,Oe,Ge,tt,At,Rt,kt,Tt,yt,Pt,vt){const ht=32*t,Vt=16*t;return this.int16[ht+0]=s,this.int16[ht+1]=u,this.int16[ht+2]=d,this.int16[ht+3]=_,this.int16[ht+4]=v,this.int16[ht+5]=w,this.int16[ht+6]=k,this.int16[ht+7]=I,this.uint16[ht+8]=P,this.uint16[ht+9]=O,this.uint16[ht+10]=j,this.uint16[ht+11]=W,this.uint16[ht+12]=Z,this.uint16[ht+13]=ne,this.uint16[ht+14]=fe,this.uint16[ht+15]=ye,this.uint16[ht+16]=Me,this.uint16[ht+17]=Ee,this.uint16[ht+18]=Oe,this.uint16[ht+19]=Ge,this.uint16[ht+20]=tt,this.uint16[ht+21]=At,this.uint16[ht+22]=Rt,this.uint32[Vt+12]=kt,this.float32[Vt+13]=Tt,this.float32[Vt+14]=yt,this.uint16[ht+30]=Pt,this.uint16[ht+31]=vt,t}}E.prototype.bytesPerElement=64,It("StructArrayLayout8i15ui1ul2f2ui64",E);class A extends qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.float32[1*t+0]=s,t}}A.prototype.bytesPerElement=4,It("StructArrayLayout1f4",A);class F extends qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,u){const d=this.length;return this.resize(d+1),this.emplace(d,t,s,u)}emplace(t,s,u,d){const _=3*t;return this.uint16[6*t+0]=s,this.float32[_+1]=u,this.float32[_+2]=d,t}}F.prototype.bytesPerElement=12,It("StructArrayLayout1ui2f12",F);class D extends qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,u){const d=this.length;return this.resize(d+1),this.emplace(d,t,s,u)}emplace(t,s,u,d){const _=4*t;return this.uint32[2*t+0]=s,this.uint16[_+2]=u,this.uint16[_+3]=d,t}}D.prototype.bytesPerElement=8,It("StructArrayLayout1ul2ui8",D);class R extends qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s){const u=this.length;return this.resize(u+1),this.emplace(u,t,s)}emplace(t,s,u){const d=2*t;return this.uint16[d+0]=s,this.uint16[d+1]=u,t}}R.prototype.bytesPerElement=4,It("StructArrayLayout2ui4",R);class q extends qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint16[1*t+0]=s,t}}q.prototype.bytesPerElement=2,It("StructArrayLayout1ui2",q);class oe extends qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,u,d){const _=this.length;return this.resize(_+1),this.emplace(_,t,s,u,d)}emplace(t,s,u,d,_){const v=4*t;return this.float32[v+0]=s,this.float32[v+1]=u,this.float32[v+2]=d,this.float32[v+3]=_,t}}oe.prototype.bytesPerElement=16,It("StructArrayLayout4f16",oe);class se extends Hn{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new L(this.anchorPointX,this.anchorPointY)}}se.prototype.size=20;class ce extends r{get(t){return new se(this,t)}}It("CollisionBoxArray",ce);class ae extends Hn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}ae.prototype.size=48;class Ie extends T{get(t){return new ae(this,t)}}It("PlacedSymbolArray",Ie);class Ve extends Hn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Ve.prototype.size=64;class ge extends E{get(t){return new Ve(this,t)}}It("SymbolInstanceArray",ge);class Pe extends A{getoffsetX(t){return this.float32[1*t+0]}}It("GlyphOffsetArray",Pe);class He extends Js{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}It("SymbolLineVertexArray",He);class We extends Hn{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}We.prototype.size=12;class et extends F{get(t){return new We(this,t)}}It("TextAnchorOffsetArray",et);class ct extends Hn{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ct.prototype.size=8;class nt extends D{get(t){return new ct(this,t)}}It("FeatureIndexArray",nt);class xt extends Ys{}class Lt extends Ys{}class lr extends Ys{}class bt extends ac{}class Ht extends ic{}class Ot extends xs{}class Cr extends nc{}class or extends sc{}class ar extends yr{}class cr extends g{}class Yr extends l{}class Ir extends p{}class Ca extends y{}class da extends R{}const aa=$r([{name:"a_pos",components:2,type:"Int16"}],4),{members:xi}=aa;class Mr{constructor(t=[]){this.segments=t}prepareSegment(t,s,u,d){let _=this.segments[this.segments.length-1];return t>Mr.MAX_VERTEX_ARRAY_LENGTH&&pt(`Max vertices per segment is ${Mr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!_||_.vertexLength+t>Mr.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==d)&&(_={vertexOffset:s.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},d!==void 0&&(_.sortKey=d),this.segments.push(_)),_}get(){return this.segments}destroy(){for(const t of this.segments)for(const s in t.vaos)t.vaos[s].destroy()}static simpleSegment(t,s,u,d){return new Mr([{vertexOffset:t,primitiveOffset:s,vertexLength:u,primitiveLength:d,vaos:{},sortKey:0}])}}function Wi(a,t){return 256*(a=we(Math.floor(a),0,255))+we(Math.floor(t),0,255)}Mr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,It("SegmentVector",Mr);const Zi=$r([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Fn={exports:{}},Wn={exports:{}};Wn.exports=function(a,t){var s,u,d,_,v,w,k,I;for(u=a.length-(s=3&a.length),d=t,v=3432918353,w=461845907,I=0;I<u;)k=255&a.charCodeAt(I)|(255&a.charCodeAt(++I))<<8|(255&a.charCodeAt(++I))<<16|(255&a.charCodeAt(++I))<<24,++I,d=27492+(65535&(_=5*(65535&(d=(d^=k=(65535&(k=(k=(65535&k)*v+(((k>>>16)*v&65535)<<16)&4294967295)<<15|k>>>17))*w+(((k>>>16)*w&65535)<<16)&4294967295)<<13|d>>>19))+((5*(d>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(k=0,s){case 3:k^=(255&a.charCodeAt(I+2))<<16;case 2:k^=(255&a.charCodeAt(I+1))<<8;case 1:d^=k=(65535&(k=(k=(65535&(k^=255&a.charCodeAt(I)))*v+(((k>>>16)*v&65535)<<16)&4294967295)<<15|k>>>17))*w+(((k>>>16)*w&65535)<<16)&4294967295}return d^=a.length,d=2246822507*(65535&(d^=d>>>16))+((2246822507*(d>>>16)&65535)<<16)&4294967295,d=3266489909*(65535&(d^=d>>>13))+((3266489909*(d>>>16)&65535)<<16)&4294967295,(d^=d>>>16)>>>0};var _s=Wn.exports,Da={exports:{}};Da.exports=function(a,t){for(var s,u=a.length,d=t^u,_=0;u>=4;)s=1540483477*(65535&(s=255&a.charCodeAt(_)|(255&a.charCodeAt(++_))<<8|(255&a.charCodeAt(++_))<<16|(255&a.charCodeAt(++_))<<24))+((1540483477*(s>>>16)&65535)<<16),d=1540483477*(65535&d)+((1540483477*(d>>>16)&65535)<<16)^(s=1540483477*(65535&(s^=s>>>24))+((1540483477*(s>>>16)&65535)<<16)),u-=4,++_;switch(u){case 3:d^=(255&a.charCodeAt(_+2))<<16;case 2:d^=(255&a.charCodeAt(_+1))<<8;case 1:d=1540483477*(65535&(d^=255&a.charCodeAt(_)))+((1540483477*(d>>>16)&65535)<<16)}return d=1540483477*(65535&(d^=d>>>13))+((1540483477*(d>>>16)&65535)<<16),(d^=d>>>15)>>>0};var Aa=_s,Ua=Da.exports;Fn.exports=Aa,Fn.exports.murmur3=Aa,Fn.exports.murmur2=Ua;var Zn=b(Fn.exports);class Jr{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,s,u,d){this.ids.push(pa(t)),this.positions.push(s,u,d)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const s=pa(t);let u=0,d=this.ids.length-1;for(;u<d;){const v=u+d>>1;this.ids[v]>=s?d=v:u=v+1}const _=[];for(;this.ids[u]===s;)_.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return _}static serialize(t,s){const u=new Float64Array(t.ids),d=new Uint32Array(t.positions);return ei(u,d,0,u.length-1),s&&s.push(u.buffer,d.buffer),{ids:u,positions:d}}static deserialize(t){const s=new Jr;return s.ids=t.ids,s.positions=t.positions,s.indexed=!0,s}}function pa(a){const t=+a;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Zn(String(a))}function ei(a,t,s,u){for(;s<u;){const d=a[s+u>>1];let _=s-1,v=u+1;for(;;){do _++;while(a[_]<d);do v--;while(a[v]>d);if(_>=v)break;Qr(a,_,v),Qr(t,3*_,3*v),Qr(t,3*_+1,3*v+1),Qr(t,3*_+2,3*v+2)}v-s<u-v?(ei(a,t,s,v),s=v+1):(ei(a,t,v+1,u),u=v)}}function Qr(a,t,s){const u=a[t];a[t]=a[s],a[s]=u}It("FeaturePositionMap",Jr);class Xn{constructor(t,s){this.gl=t.gl,this.location=s}}class Xo extends Xn{constructor(t,s){super(t,s),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Nh extends Xn{constructor(t,s){super(t,s),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Uh extends Xn{constructor(t,s){super(t,s),this.current=Qt.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const af=new Float32Array(16);function oc(a){return[Wi(255*a.r,255*a.g),Wi(255*a.b,255*a.a)]}class Xi{constructor(t,s,u){this.value=t,this.uniformNames=s.map(d=>`u_${d}`),this.type=u}setUniform(t,s,u){t.set(u.constantOr(this.value))}getBinding(t,s,u){return this.type==="color"?new Uh(t,s):new Xo(t,s)}}class Kn{constructor(t,s){this.uniformNames=s.map(u=>`u_${u}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=s.tlbr,this.patternTo=t.tlbr}setUniform(t,s,u,d){const _=d==="u_pattern_to"?this.patternTo:d==="u_pattern_from"?this.patternFrom:d==="u_pixel_ratio_to"?this.pixelRatioTo:d==="u_pixel_ratio_from"?this.pixelRatioFrom:null;_&&t.set(_)}getBinding(t,s,u){return u.substr(0,9)==="u_pattern"?new Nh(t,s):new Xo(t,s)}}class Ki{constructor(t,s,u,d){this.expression=t,this.type=u,this.maxValue=0,this.paintVertexAttributes=s.map(_=>({name:`a_${_}`,type:"Float32",components:u==="color"?2:1,offset:0})),this.paintVertexArray=new d}populatePaintArray(t,s,u,d,_){const v=this.paintVertexArray.length,w=this.expression.evaluate(new Pr(0),s,{},d,[],_);this.paintVertexArray.resize(t),this._setPaintValue(v,t,w)}updatePaintArray(t,s,u,d){const _=this.expression.evaluate({zoom:0},u,d);this._setPaintValue(t,s,_)}_setPaintValue(t,s,u){if(this.type==="color"){const d=oc(u);for(let _=t;_<s;_++)this.paintVertexArray.emplace(_,d[0],d[1])}else{for(let d=t;d<s;d++)this.paintVertexArray.emplace(d,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Mi{constructor(t,s,u,d,_,v){this.expression=t,this.uniformNames=s.map(w=>`u_${w}_t`),this.type=u,this.useIntegerZoom=d,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=s.map(w=>({name:`a_${w}`,type:"Float32",components:u==="color"?4:2,offset:0})),this.paintVertexArray=new v}populatePaintArray(t,s,u,d,_){const v=this.expression.evaluate(new Pr(this.zoom),s,{},d,[],_),w=this.expression.evaluate(new Pr(this.zoom+1),s,{},d,[],_),k=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(k,t,v,w)}updatePaintArray(t,s,u,d){const _=this.expression.evaluate({zoom:this.zoom},u,d),v=this.expression.evaluate({zoom:this.zoom+1},u,d);this._setPaintValue(t,s,_,v)}_setPaintValue(t,s,u,d){if(this.type==="color"){const _=oc(u),v=oc(d);for(let w=t;w<s;w++)this.paintVertexArray.emplace(w,_[0],_[1],v[0],v[1])}else{for(let _=t;_<s;_++)this.paintVertexArray.emplace(_,u,d);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(d))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,s){const u=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,d=we(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);t.set(d)}getBinding(t,s,u){return new Xo(t,s)}}class Yi{constructor(t,s,u,d,_,v){this.expression=t,this.type=s,this.useIntegerZoom=u,this.zoom=d,this.layerId=v,this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(t,s,u){const d=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(d,t,s.patterns&&s.patterns[this.layerId],u)}updatePaintArray(t,s,u,d,_){this._setPaintValues(t,s,u.patterns&&u.patterns[this.layerId],_)}_setPaintValues(t,s,u,d){if(!d||!u)return;const{min:_,mid:v,max:w}=u,k=d[_],I=d[v],P=d[w];if(k&&I&&P)for(let O=t;O<s;O++)this.zoomInPaintVertexArray.emplace(O,I.tl[0],I.tl[1],I.br[0],I.br[1],k.tl[0],k.tl[1],k.br[0],k.br[1],I.pixelRatio,k.pixelRatio),this.zoomOutPaintVertexArray.emplace(O,I.tl[0],I.tl[1],I.br[0],I.br[1],P.tl[0],P.tl[1],P.br[0],P.br[1],I.pixelRatio,P.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Zi.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Zi.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class lc{constructor(t,s,u){this.binders={},this._buffers=[];const d=[];for(const _ in t.paint._values){if(!u(_))continue;const v=t.paint.get(_);if(!(v instanceof Na&&us(v.property.specification)))continue;const w=xx(_,t.type),k=v.value,I=v.property.specification.type,P=v.property.useIntegerZoom,O=v.property.specification["property-type"],j=O==="cross-faded"||O==="cross-faded-data-driven";if(k.kind==="constant")this.binders[_]=j?new Kn(k.value,w):new Xi(k.value,w,I),d.push(`/u_${_}`);else if(k.kind==="source"||j){const W=sd(_,I,"source");this.binders[_]=j?new Yi(k,I,P,s,W,t.id):new Ki(k,w,I,W),d.push(`/a_${_}`)}else{const W=sd(_,I,"composite");this.binders[_]=new Mi(k,w,I,P,s,W),d.push(`/z_${_}`)}}this.cacheKey=d.sort().join("")}getMaxValue(t){const s=this.binders[t];return s instanceof Ki||s instanceof Mi?s.maxValue:0}populatePaintArrays(t,s,u,d,_){for(const v in this.binders){const w=this.binders[v];(w instanceof Ki||w instanceof Mi||w instanceof Yi)&&w.populatePaintArray(t,s,u,d,_)}}setConstantPatternPositions(t,s){for(const u in this.binders){const d=this.binders[u];d instanceof Kn&&d.setConstantPatternPositions(t,s)}}updatePaintArrays(t,s,u,d,_){let v=!1;for(const w in t){const k=s.getPositions(w);for(const I of k){const P=u.feature(I.index);for(const O in this.binders){const j=this.binders[O];if((j instanceof Ki||j instanceof Mi||j instanceof Yi)&&j.expression.isStateDependent===!0){const W=d.paint.get(O);j.expression=W.value,j.updatePaintArray(I.start,I.end,P,t[w],_),v=!0}}}}return v}defines(){const t=[];for(const s in this.binders){const u=this.binders[s];(u instanceof Xi||u instanceof Kn)&&t.push(...u.uniformNames.map(d=>`#define HAS_UNIFORM_${d}`))}return t}getBinderAttributes(){const t=[];for(const s in this.binders){const u=this.binders[s];if(u instanceof Ki||u instanceof Mi)for(let d=0;d<u.paintVertexAttributes.length;d++)t.push(u.paintVertexAttributes[d].name);else if(u instanceof Yi)for(let d=0;d<Zi.members.length;d++)t.push(Zi.members[d].name)}return t}getBinderUniforms(){const t=[];for(const s in this.binders){const u=this.binders[s];if(u instanceof Xi||u instanceof Kn||u instanceof Mi)for(const d of u.uniformNames)t.push(d)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,s){const u=[];for(const d in this.binders){const _=this.binders[d];if(_ instanceof Xi||_ instanceof Kn||_ instanceof Mi){for(const v of _.uniformNames)if(s[v]){const w=_.getBinding(t,s[v],v);u.push({name:v,property:d,binding:w})}}}return u}setUniforms(t,s,u,d){for(const{name:_,property:v,binding:w}of s)this.binders[v].setUniform(w,d,u.get(v),_)}updatePaintBuffers(t){this._buffers=[];for(const s in this.binders){const u=this.binders[s];if(t&&u instanceof Yi){const d=t.fromScale===2?u.zoomInPaintVertexBuffer:u.zoomOutPaintVertexBuffer;d&&this._buffers.push(d)}else(u instanceof Ki||u instanceof Mi)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}}upload(t){for(const s in this.binders){const u=this.binders[s];(u instanceof Ki||u instanceof Mi||u instanceof Yi)&&u.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const s=this.binders[t];(s instanceof Ki||s instanceof Mi||s instanceof Yi)&&s.destroy()}}}class dn{constructor(t,s,u=()=>!0){this.programConfigurations={};for(const d of t)this.programConfigurations[d.id]=new lc(d,s,u);this.needsUpload=!1,this._featureMap=new Jr,this._bufferOffset=0}populatePaintArrays(t,s,u,d,_,v){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(t,s,d,_,v);s.id!==void 0&&this._featureMap.add(s.id,u,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,s,u,d){for(const _ of u)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(t,this._featureMap,s,_,d)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function xx(a,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[a]||[a.replace(`${t}-`,"").replace(/-/g,"_")]}function sd(a,t,s){const u={color:{source:xs,composite:oe},number:{source:A,composite:xs}},d=function(_){return{"line-pattern":{source:Cr,composite:Cr},"fill-pattern":{source:Cr,composite:Cr},"fill-extrusion-pattern":{source:Cr,composite:Cr}}[_]}(a);return d&&d[s]||u[t][s]}It("ConstantBinder",Xi),It("CrossFadedConstantBinder",Kn),It("SourceExpressionBinder",Ki),It("CrossFadedCompositeBinder",Yi),It("CompositeExpressionBinder",Mi),It("ProgramConfiguration",lc,{omit:["_buffers"]}),It("ProgramConfigurationSet",dn);const oa=8192,nf=Math.pow(2,14)-1,od=-nf-1;function Qs(a){const t=oa/a.extent,s=a.loadGeometry();for(let u=0;u<s.length;u++){const d=s[u];for(let _=0;_<d.length;_++){const v=d[_],w=Math.round(v.x*t),k=Math.round(v.y*t);v.x=we(w,od,nf),v.y=we(k,od,nf),(w<v.x||w>v.x+1||k<v.y||k>v.y+1)&&pt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return s}function eo(a,t){return{type:a.type,id:a.id,properties:a.properties,geometry:t?Qs(a):[]}}function Vh(a,t,s,u,d){a.emplaceBack(2*t+(u+1)/2,2*s+(d+1)/2)}class sf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Lt,this.indexArray=new Ca,this.segments=new Mr,this.programConfigurations=new dn(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,u){const d=this.layers[0],_=[];let v=null,w=!1;d.type==="circle"&&(v=d.layout.get("circle-sort-key"),w=!v.isConstant());for(const{feature:k,id:I,index:P,sourceLayerIndex:O}of t){const j=this.layers[0]._featureFilter.needGeometry,W=eo(k,j);if(!this.layers[0]._featureFilter.filter(new Pr(this.zoom),W,u))continue;const Z=w?v.evaluate(W,{},u):void 0,ne={id:I,properties:k.properties,type:k.type,sourceLayerIndex:O,index:P,geometry:j?W.geometry:Qs(k),patterns:{},sortKey:Z};_.push(ne)}w&&_.sort((k,I)=>k.sortKey-I.sortKey);for(const k of _){const{geometry:I,index:P,sourceLayerIndex:O}=k,j=t[P].feature;this.addFeature(k,I,P,u),s.featureIndex.insert(j,I,P,O,this.index)}}update(t,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,xi),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,s,u,d){for(const _ of s)for(const v of _){const w=v.x,k=v.y;if(w<0||w>=oa||k<0||k>=oa)continue;const I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),P=I.vertexLength;Vh(this.layoutVertexArray,w,k,-1,-1),Vh(this.layoutVertexArray,w,k,1,-1),Vh(this.layoutVertexArray,w,k,1,1),Vh(this.layoutVertexArray,w,k,-1,1),this.indexArray.emplaceBack(P,P+1,P+2),this.indexArray.emplaceBack(P,P+3,P+2),I.vertexLength+=4,I.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,{},d)}}function ld(a,t){for(let s=0;s<a.length;s++)if(Ko(t,a[s]))return!0;for(let s=0;s<t.length;s++)if(Ko(a,t[s]))return!0;return!!of(a,t)}function _x(a,t,s){return!!Ko(a,t)||!!lf(t,a,s)}function cd(a,t){if(a.length===1)return ud(t,a[0]);for(let s=0;s<t.length;s++){const u=t[s];for(let d=0;d<u.length;d++)if(Ko(a,u[d]))return!0}for(let s=0;s<a.length;s++)if(ud(t,a[s]))return!0;for(let s=0;s<t.length;s++)if(of(a,t[s]))return!0;return!1}function yx(a,t,s){if(a.length>1){if(of(a,t))return!0;for(let u=0;u<t.length;u++)if(lf(t[u],a,s))return!0}for(let u=0;u<a.length;u++)if(lf(a[u],t,s))return!0;return!1}function of(a,t){if(a.length===0||t.length===0)return!1;for(let s=0;s<a.length-1;s++){const u=a[s],d=a[s+1];for(let _=0;_<t.length-1;_++)if(vx(u,d,t[_],t[_+1]))return!0}return!1}function vx(a,t,s,u){return ot(a,s,u)!==ot(t,s,u)&&ot(a,t,s)!==ot(a,t,u)}function lf(a,t,s){const u=s*s;if(t.length===1)return a.distSqr(t[0])<u;for(let d=1;d<t.length;d++)if(hd(a,t[d-1],t[d])<u)return!0;return!1}function hd(a,t,s){const u=t.distSqr(s);if(u===0)return a.distSqr(t);const d=((a.x-t.x)*(s.x-t.x)+(a.y-t.y)*(s.y-t.y))/u;return a.distSqr(d<0?t:d>1?s:s.sub(t)._mult(d)._add(t))}function ud(a,t){let s,u,d,_=!1;for(let v=0;v<a.length;v++){s=a[v];for(let w=0,k=s.length-1;w<s.length;k=w++)u=s[w],d=s[k],u.y>t.y!=d.y>t.y&&t.x<(d.x-u.x)*(t.y-u.y)/(d.y-u.y)+u.x&&(_=!_)}return _}function Ko(a,t){let s=!1;for(let u=0,d=a.length-1;u<a.length;d=u++){const _=a[u],v=a[d];_.y>t.y!=v.y>t.y&&t.x<(v.x-_.x)*(t.y-_.y)/(v.y-_.y)+_.x&&(s=!s)}return s}function wx(a,t,s){const u=s[0],d=s[2];if(a.x<u.x&&t.x<u.x||a.x>d.x&&t.x>d.x||a.y<u.y&&t.y<u.y||a.y>d.y&&t.y>d.y)return!1;const _=ot(a,t,s[0]);return _!==ot(a,t,s[1])||_!==ot(a,t,s[2])||_!==ot(a,t,s[3])}function cc(a,t,s){const u=t.paint.get(a).value;return u.kind==="constant"?u.value:s.programConfigurations.get(t.id).getMaxValue(a)}function $h(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function jh(a,t,s,u,d){if(!t[0]&&!t[1])return a;const _=L.convert(t)._mult(d);s==="viewport"&&_._rotate(-u);const v=[];for(let w=0;w<a.length;w++)v.push(a[w].sub(_));return v}let fd,dd;It("CircleBucket",sf,{omit:["layers"]});var bx={get paint(){return dd=dd||new ra({"circle-radius":new Gt(Xe.paint_circle["circle-radius"]),"circle-color":new Gt(Xe.paint_circle["circle-color"]),"circle-blur":new Gt(Xe.paint_circle["circle-blur"]),"circle-opacity":new Gt(Xe.paint_circle["circle-opacity"]),"circle-translate":new zt(Xe.paint_circle["circle-translate"]),"circle-translate-anchor":new zt(Xe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new zt(Xe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new zt(Xe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Gt(Xe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Gt(Xe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Gt(Xe.paint_circle["circle-stroke-opacity"])})},get layout(){return fd=fd||new ra({"circle-sort-key":new Gt(Xe.layout_circle["circle-sort-key"])})}},ti=1e-6,Yo=typeof Float32Array<"u"?Float32Array:Array;function cf(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function pd(a,t,s){var u=t[0],d=t[1],_=t[2],v=t[3],w=t[4],k=t[5],I=t[6],P=t[7],O=t[8],j=t[9],W=t[10],Z=t[11],ne=t[12],fe=t[13],ye=t[14],Me=t[15],Ee=s[0],Oe=s[1],Ge=s[2],tt=s[3];return a[0]=Ee*u+Oe*w+Ge*O+tt*ne,a[1]=Ee*d+Oe*k+Ge*j+tt*fe,a[2]=Ee*_+Oe*I+Ge*W+tt*ye,a[3]=Ee*v+Oe*P+Ge*Z+tt*Me,a[4]=(Ee=s[4])*u+(Oe=s[5])*w+(Ge=s[6])*O+(tt=s[7])*ne,a[5]=Ee*d+Oe*k+Ge*j+tt*fe,a[6]=Ee*_+Oe*I+Ge*W+tt*ye,a[7]=Ee*v+Oe*P+Ge*Z+tt*Me,a[8]=(Ee=s[8])*u+(Oe=s[9])*w+(Ge=s[10])*O+(tt=s[11])*ne,a[9]=Ee*d+Oe*k+Ge*j+tt*fe,a[10]=Ee*_+Oe*I+Ge*W+tt*ye,a[11]=Ee*v+Oe*P+Ge*Z+tt*Me,a[12]=(Ee=s[12])*u+(Oe=s[13])*w+(Ge=s[14])*O+(tt=s[15])*ne,a[13]=Ee*d+Oe*k+Ge*j+tt*fe,a[14]=Ee*_+Oe*I+Ge*W+tt*ye,a[15]=Ee*v+Oe*P+Ge*Z+tt*Me,a}Math.hypot||(Math.hypot=function(){for(var a=0,t=arguments.length;t--;)a+=arguments[t]*arguments[t];return Math.sqrt(a)});var hc,Tx=pd;function Gh(a,t,s){var u=t[0],d=t[1],_=t[2],v=t[3];return a[0]=s[0]*u+s[4]*d+s[8]*_+s[12]*v,a[1]=s[1]*u+s[5]*d+s[9]*_+s[13]*v,a[2]=s[2]*u+s[6]*d+s[10]*_+s[14]*v,a[3]=s[3]*u+s[7]*d+s[11]*_+s[15]*v,a}hc=new Yo(4),Yo!=Float32Array&&(hc[0]=0,hc[1]=0,hc[2]=0,hc[3]=0);class Ex extends Pi{constructor(t){super(t,bx)}createBucket(t){return new sf(t)}queryRadius(t){const s=t;return cc("circle-radius",this,s)+cc("circle-stroke-width",this,s)+$h(this.paint.get("circle-translate"))}queryIntersectsFeature(t,s,u,d,_,v,w,k){const I=jh(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),v.angle,w),P=this.paint.get("circle-radius").evaluate(s,u)+this.paint.get("circle-stroke-width").evaluate(s,u),O=this.paint.get("circle-pitch-alignment")==="map",j=O?I:function(Z,ne){return Z.map(fe=>md(fe,ne))}(I,k),W=O?P*w:P;for(const Z of d)for(const ne of Z){const fe=O?ne:md(ne,k);let ye=W;const Me=Gh([],[ne.x,ne.y,0,1],k);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ye*=Me[3]/v.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ye*=v.cameraToCenterDistance/Me[3]),_x(j,fe,ye))return!0}return!1}}function md(a,t){const s=Gh([],[a.x,a.y,0,1],t);return new L(s[0]/s[3],s[1]/s[3])}class gd extends sf{}let xd;It("HeatmapBucket",gd,{omit:["layers"]});var Sx={get paint(){return xd=xd||new ra({"heatmap-radius":new Gt(Xe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Gt(Xe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new zt(Xe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new tc(Xe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new zt(Xe.paint_heatmap["heatmap-opacity"])})}};function hf(a,{width:t,height:s},u,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==t*s*u)throw new RangeError(`mismatched image size. expected: ${d.length} but got: ${t*s*u}`)}else d=new Uint8Array(t*s*u);return a.width=t,a.height=s,a.data=d,a}function _d(a,{width:t,height:s},u){if(t===a.width&&s===a.height)return;const d=hf({},{width:t,height:s},u);uf(a,d,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,t),height:Math.min(a.height,s)},u),a.width=t,a.height=s,a.data=d.data}function uf(a,t,s,u,d,_){if(d.width===0||d.height===0)return t;if(d.width>a.width||d.height>a.height||s.x>a.width-d.width||s.y>a.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>t.width||d.height>t.height||u.x>t.width-d.width||u.y>t.height-d.height)throw new RangeError("out of range destination coordinates for image copy");const v=a.data,w=t.data;if(v===w)throw new Error("srcData equals dstData, so image is already copied");for(let k=0;k<d.height;k++){const I=((s.y+k)*a.width+s.x)*_,P=((u.y+k)*t.width+u.x)*_;for(let O=0;O<d.width*_;O++)w[P+O]=v[I+O]}return t}class uc{constructor(t,s){hf(this,t,1,s)}resize(t){_d(this,t,1)}clone(){return new uc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,s,u,d,_){uf(t,s,u,d,_,1)}}class Oi{constructor(t,s){hf(this,t,4,s)}resize(t){_d(this,t,4)}replace(t,s){s?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Oi({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,s,u,d,_){uf(t,s,u,d,_,4)}}function yd(a){const t={},s=a.resolution||256,u=a.clips?a.clips.length:1,d=a.image||new Oi({width:s,height:u});if(Math.log(s)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${s}`);const _=(v,w,k)=>{t[a.evaluationKey]=k;const I=a.expression.evaluate(t);d.data[v+w+0]=Math.floor(255*I.r/I.a),d.data[v+w+1]=Math.floor(255*I.g/I.a),d.data[v+w+2]=Math.floor(255*I.b/I.a),d.data[v+w+3]=Math.floor(255*I.a)};if(a.clips)for(let v=0,w=0;v<u;++v,w+=4*s)for(let k=0,I=0;k<s;k++,I+=4){const P=k/(s-1),{start:O,end:j}=a.clips[v];_(w,I,O*(1-P)+j*P)}else for(let v=0,w=0;v<s;v++,w+=4)_(0,w,v/(s-1));return d}It("AlphaImage",uc),It("RGBAImage",Oi);class kx extends Pi{createBucket(t){return new gd(t)}constructor(t){super(t,Sx),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=yd({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let vd;var Cx={get paint(){return vd=vd||new ra({"hillshade-illumination-direction":new zt(Xe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new zt(Xe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new zt(Xe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new zt(Xe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new zt(Xe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new zt(Xe.paint_hillshade["hillshade-accent-color"])})}};class Ax extends Pi{constructor(t){super(t,Cx)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Ix=$r([{name:"a_pos",components:2,type:"Int16"}],4),{members:Fx}=Ix;var ff={exports:{}};function Hh(a,t,s){s=s||2;var u,d,_,v,w,k,I,P=t&&t.length,O=P?t[0]*s:a.length,j=wd(a,0,O,s,!0),W=[];if(!j||j.next===j.prev)return W;if(P&&(j=function(ne,fe,ye,Me){var Ee,Oe,Ge,tt=[];for(Ee=0,Oe=fe.length;Ee<Oe;Ee++)(Ge=wd(ne,fe[Ee]*Me,Ee<Oe-1?fe[Ee+1]*Me:ne.length,Me,!1))===Ge.next&&(Ge.steiner=!0),tt.push(zx(Ge));for(tt.sort(Rx),Ee=0;Ee<tt.length;Ee++)ye=Ox(tt[Ee],ye);return ye}(a,t,j,s)),a.length>80*s){u=_=a[0],d=v=a[1];for(var Z=s;Z<O;Z+=s)(w=a[Z])<u&&(u=w),(k=a[Z+1])<d&&(d=k),w>_&&(_=w),k>v&&(v=k);I=(I=Math.max(_-u,v-d))!==0?32767/I:0}return fc(j,W,s,u,d,I,0),W}function wd(a,t,s,u,d){var _,v;if(d===mf(a,t,s,u)>0)for(_=t;_<s;_+=u)v=Ed(_,a[_],a[_+1],v);else for(_=s-u;_>=t;_-=u)v=Ed(_,a[_],a[_+1],v);return v&&qh(v,v.next)&&(pc(v),v=v.next),v}function to(a,t){if(!a)return a;t||(t=a);var s,u=a;do if(s=!1,u.steiner||!qh(u,u.next)&&ia(u.prev,u,u.next)!==0)u=u.next;else{if(pc(u),(u=t=u.prev)===u.next)break;s=!0}while(s||u!==t);return t}function fc(a,t,s,u,d,_,v){if(a){!v&&_&&function(P,O,j,W){var Z=P;do Z.z===0&&(Z.z=df(Z.x,Z.y,O,j,W)),Z.prevZ=Z.prev,Z.nextZ=Z.next,Z=Z.next;while(Z!==P);Z.prevZ.nextZ=null,Z.prevZ=null,function(ne){var fe,ye,Me,Ee,Oe,Ge,tt,At,Rt=1;do{for(ye=ne,ne=null,Oe=null,Ge=0;ye;){for(Ge++,Me=ye,tt=0,fe=0;fe<Rt&&(tt++,Me=Me.nextZ);fe++);for(At=Rt;tt>0||At>0&&Me;)tt!==0&&(At===0||!Me||ye.z<=Me.z)?(Ee=ye,ye=ye.nextZ,tt--):(Ee=Me,Me=Me.nextZ,At--),Oe?Oe.nextZ=Ee:ne=Ee,Ee.prevZ=Oe,Oe=Ee;ye=Me}Oe.nextZ=null,Rt*=2}while(Ge>1)}(Z)}(a,u,d,_);for(var w,k,I=a;a.prev!==a.next;)if(w=a.prev,k=a.next,_?Mx(a,u,d,_):Px(a))t.push(w.i/s|0),t.push(a.i/s|0),t.push(k.i/s|0),pc(a),a=k.next,I=k.next;else if((a=k)===I){v?v===1?fc(a=Dx(to(a),t,s),t,s,u,d,_,2):v===2&&Lx(a,t,s,u,d,_):fc(to(a),t,s,u,d,_,1);break}}}function Px(a){var t=a.prev,s=a,u=a.next;if(ia(t,s,u)>=0)return!1;for(var d=t.x,_=s.x,v=u.x,w=t.y,k=s.y,I=u.y,P=d<_?d<v?d:v:_<v?_:v,O=w<k?w<I?w:I:k<I?k:I,j=d>_?d>v?d:v:_>v?_:v,W=w>k?w>I?w:I:k>I?k:I,Z=u.next;Z!==t;){if(Z.x>=P&&Z.x<=j&&Z.y>=O&&Z.y<=W&&Jo(d,w,_,k,v,I,Z.x,Z.y)&&ia(Z.prev,Z,Z.next)>=0)return!1;Z=Z.next}return!0}function Mx(a,t,s,u){var d=a.prev,_=a,v=a.next;if(ia(d,_,v)>=0)return!1;for(var w=d.x,k=_.x,I=v.x,P=d.y,O=_.y,j=v.y,W=w<k?w<I?w:I:k<I?k:I,Z=P<O?P<j?P:j:O<j?O:j,ne=w>k?w>I?w:I:k>I?k:I,fe=P>O?P>j?P:j:O>j?O:j,ye=df(W,Z,t,s,u),Me=df(ne,fe,t,s,u),Ee=a.prevZ,Oe=a.nextZ;Ee&&Ee.z>=ye&&Oe&&Oe.z<=Me;){if(Ee.x>=W&&Ee.x<=ne&&Ee.y>=Z&&Ee.y<=fe&&Ee!==d&&Ee!==v&&Jo(w,P,k,O,I,j,Ee.x,Ee.y)&&ia(Ee.prev,Ee,Ee.next)>=0||(Ee=Ee.prevZ,Oe.x>=W&&Oe.x<=ne&&Oe.y>=Z&&Oe.y<=fe&&Oe!==d&&Oe!==v&&Jo(w,P,k,O,I,j,Oe.x,Oe.y)&&ia(Oe.prev,Oe,Oe.next)>=0))return!1;Oe=Oe.nextZ}for(;Ee&&Ee.z>=ye;){if(Ee.x>=W&&Ee.x<=ne&&Ee.y>=Z&&Ee.y<=fe&&Ee!==d&&Ee!==v&&Jo(w,P,k,O,I,j,Ee.x,Ee.y)&&ia(Ee.prev,Ee,Ee.next)>=0)return!1;Ee=Ee.prevZ}for(;Oe&&Oe.z<=Me;){if(Oe.x>=W&&Oe.x<=ne&&Oe.y>=Z&&Oe.y<=fe&&Oe!==d&&Oe!==v&&Jo(w,P,k,O,I,j,Oe.x,Oe.y)&&ia(Oe.prev,Oe,Oe.next)>=0)return!1;Oe=Oe.nextZ}return!0}function Dx(a,t,s){var u=a;do{var d=u.prev,_=u.next.next;!qh(d,_)&&bd(d,u,u.next,_)&&dc(d,_)&&dc(_,d)&&(t.push(d.i/s|0),t.push(u.i/s|0),t.push(_.i/s|0),pc(u),pc(u.next),u=a=_),u=u.next}while(u!==a);return to(u)}function Lx(a,t,s,u,d,_){var v=a;do{for(var w=v.next.next;w!==v.prev;){if(v.i!==w.i&&Nx(v,w)){var k=Td(v,w);return v=to(v,v.next),k=to(k,k.next),fc(v,t,s,u,d,_,0),void fc(k,t,s,u,d,_,0)}w=w.next}v=v.next}while(v!==a)}function Rx(a,t){return a.x-t.x}function Ox(a,t){var s=function(d,_){var v,w=_,k=d.x,I=d.y,P=-1/0;do{if(I<=w.y&&I>=w.next.y&&w.next.y!==w.y){var O=w.x+(I-w.y)*(w.next.x-w.x)/(w.next.y-w.y);if(O<=k&&O>P&&(P=O,v=w.x<w.next.x?w:w.next,O===k))return v}w=w.next}while(w!==_);if(!v)return null;var j,W=v,Z=v.x,ne=v.y,fe=1/0;w=v;do k>=w.x&&w.x>=Z&&k!==w.x&&Jo(I<ne?k:P,I,Z,ne,I<ne?P:k,I,w.x,w.y)&&(j=Math.abs(I-w.y)/(k-w.x),dc(w,d)&&(j<fe||j===fe&&(w.x>v.x||w.x===v.x&&Bx(v,w)))&&(v=w,fe=j)),w=w.next;while(w!==W);return v}(a,t);if(!s)return t;var u=Td(s,a);return to(u,u.next),to(s,s.next)}function Bx(a,t){return ia(a.prev,a,t.prev)<0&&ia(t.next,a,a.next)<0}function df(a,t,s,u,d){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-s)*d|0)|a<<8))|a<<4))|a<<2))|a<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-u)*d|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function zx(a){var t=a,s=a;do(t.x<s.x||t.x===s.x&&t.y<s.y)&&(s=t),t=t.next;while(t!==a);return s}function Jo(a,t,s,u,d,_,v,w){return(d-v)*(t-w)>=(a-v)*(_-w)&&(a-v)*(u-w)>=(s-v)*(t-w)&&(s-v)*(_-w)>=(d-v)*(u-w)}function Nx(a,t){return a.next.i!==t.i&&a.prev.i!==t.i&&!function(s,u){var d=s;do{if(d.i!==s.i&&d.next.i!==s.i&&d.i!==u.i&&d.next.i!==u.i&&bd(d,d.next,s,u))return!0;d=d.next}while(d!==s);return!1}(a,t)&&(dc(a,t)&&dc(t,a)&&function(s,u){var d=s,_=!1,v=(s.x+u.x)/2,w=(s.y+u.y)/2;do d.y>w!=d.next.y>w&&d.next.y!==d.y&&v<(d.next.x-d.x)*(w-d.y)/(d.next.y-d.y)+d.x&&(_=!_),d=d.next;while(d!==s);return _}(a,t)&&(ia(a.prev,a,t.prev)||ia(a,t.prev,t))||qh(a,t)&&ia(a.prev,a,a.next)>0&&ia(t.prev,t,t.next)>0)}function ia(a,t,s){return(t.y-a.y)*(s.x-t.x)-(t.x-a.x)*(s.y-t.y)}function qh(a,t){return a.x===t.x&&a.y===t.y}function bd(a,t,s,u){var d=Zh(ia(a,t,s)),_=Zh(ia(a,t,u)),v=Zh(ia(s,u,a)),w=Zh(ia(s,u,t));return d!==_&&v!==w||!(d!==0||!Wh(a,s,t))||!(_!==0||!Wh(a,u,t))||!(v!==0||!Wh(s,a,u))||!(w!==0||!Wh(s,t,u))}function Wh(a,t,s){return t.x<=Math.max(a.x,s.x)&&t.x>=Math.min(a.x,s.x)&&t.y<=Math.max(a.y,s.y)&&t.y>=Math.min(a.y,s.y)}function Zh(a){return a>0?1:a<0?-1:0}function dc(a,t){return ia(a.prev,a,a.next)<0?ia(a,t,a.next)>=0&&ia(a,a.prev,t)>=0:ia(a,t,a.prev)<0||ia(a,a.next,t)<0}function Td(a,t){var s=new pf(a.i,a.x,a.y),u=new pf(t.i,t.x,t.y),d=a.next,_=t.prev;return a.next=t,t.prev=a,s.next=d,d.prev=s,u.next=s,s.prev=u,_.next=u,u.prev=_,u}function Ed(a,t,s,u){var d=new pf(a,t,s);return u?(d.next=u.next,d.prev=u,u.next.prev=d,u.next=d):(d.prev=d,d.next=d),d}function pc(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function pf(a,t,s){this.i=a,this.x=t,this.y=s,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function mf(a,t,s,u){for(var d=0,_=t,v=s-u;_<s;_+=u)d+=(a[v]-a[_])*(a[_+1]+a[v+1]),v=_;return d}ff.exports=Hh,ff.exports.default=Hh,Hh.deviation=function(a,t,s,u){var d=t&&t.length,_=Math.abs(mf(a,0,d?t[0]*s:a.length,s));if(d)for(var v=0,w=t.length;v<w;v++)_-=Math.abs(mf(a,t[v]*s,v<w-1?t[v+1]*s:a.length,s));var k=0;for(v=0;v<u.length;v+=3){var I=u[v]*s,P=u[v+1]*s,O=u[v+2]*s;k+=Math.abs((a[I]-a[O])*(a[P+1]-a[I+1])-(a[I]-a[P])*(a[O+1]-a[I+1]))}return _===0&&k===0?0:Math.abs((k-_)/_)},Hh.flatten=function(a){for(var t=a[0][0].length,s={vertices:[],holes:[],dimensions:t},u=0,d=0;d<a.length;d++){for(var _=0;_<a[d].length;_++)for(var v=0;v<t;v++)s.vertices.push(a[d][_][v]);d>0&&s.holes.push(u+=a[d-1].length)}return s};var Sd=b(ff.exports);function Ux(a,t,s,u,d){kd(a,t,s||0,u||a.length-1,d||Vx)}function kd(a,t,s,u,d){for(;u>s;){if(u-s>600){var _=u-s+1,v=t-s+1,w=Math.log(_),k=.5*Math.exp(2*w/3),I=.5*Math.sqrt(w*k*(_-k)/_)*(v-_/2<0?-1:1);kd(a,t,Math.max(s,Math.floor(t-v*k/_+I)),Math.min(u,Math.floor(t+(_-v)*k/_+I)),d)}var P=a[t],O=s,j=u;for(mc(a,s,t),d(a[u],P)>0&&mc(a,s,u);O<j;){for(mc(a,O,j),O++,j--;d(a[O],P)<0;)O++;for(;d(a[j],P)>0;)j--}d(a[s],P)===0?mc(a,s,j):mc(a,++j,u),j<=t&&(s=j+1),t<=j&&(u=j-1)}}function mc(a,t,s){var u=a[t];a[t]=a[s],a[s]=u}function Vx(a,t){return a<t?-1:a>t?1:0}function gf(a,t){const s=a.length;if(s<=1)return[a];const u=[];let d,_;for(let v=0;v<s;v++){const w=_t(a[v]);w!==0&&(a[v].area=Math.abs(w),_===void 0&&(_=w<0),_===w<0?(d&&u.push(d),d=[a[v]]):d.push(a[v]))}if(d&&u.push(d),t>1)for(let v=0;v<u.length;v++)u[v].length<=t||(Ux(u[v],t,1,u[v].length-1,$x),u[v]=u[v].slice(0,t));return u}function $x(a,t){return t.area-a.area}function xf(a,t,s){const u=s.patternDependencies;let d=!1;for(const _ of t){const v=_.paint.get(`${a}-pattern`);v.isConstant()||(d=!0);const w=v.constantOr(null);w&&(d=!0,u[w.to]=!0,u[w.from]=!0)}return d}function _f(a,t,s,u,d){const _=d.patternDependencies;for(const v of t){const w=v.paint.get(`${a}-pattern`).value;if(w.kind!=="constant"){let k=w.evaluate({zoom:u-1},s,{},d.availableImages),I=w.evaluate({zoom:u},s,{},d.availableImages),P=w.evaluate({zoom:u+1},s,{},d.availableImages);k=k&&k.name?k.name:k,I=I&&I.name?I.name:I,P=P&&P.name?P.name:P,_[k]=!0,_[I]=!0,_[P]=!0,s.patterns[v.id]={min:k,mid:I,max:P}}}return s}class yf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new lr,this.indexArray=new Ca,this.indexArray2=new da,this.programConfigurations=new dn(t.layers,t.zoom),this.segments=new Mr,this.segments2=new Mr,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,u){this.hasPattern=xf("fill",this.layers,s);const d=this.layers[0].layout.get("fill-sort-key"),_=!d.isConstant(),v=[];for(const{feature:w,id:k,index:I,sourceLayerIndex:P}of t){const O=this.layers[0]._featureFilter.needGeometry,j=eo(w,O);if(!this.layers[0]._featureFilter.filter(new Pr(this.zoom),j,u))continue;const W=_?d.evaluate(j,{},u,s.availableImages):void 0,Z={id:k,properties:w.properties,type:w.type,sourceLayerIndex:P,index:I,geometry:O?j.geometry:Qs(w),patterns:{},sortKey:W};v.push(Z)}_&&v.sort((w,k)=>w.sortKey-k.sortKey);for(const w of v){const{geometry:k,index:I,sourceLayerIndex:P}=w;if(this.hasPattern){const O=_f("fill",this.layers,w,this.zoom,s);this.patternFeatures.push(O)}else this.addFeature(w,k,I,u,{});s.featureIndex.insert(t[I].feature,k,I,P,this.index)}}update(t,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,u)}addFeatures(t,s,u){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,s,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Fx),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,s,u,d,_){for(const v of gf(s,500)){let w=0;for(const W of v)w+=W.length;const k=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),I=k.vertexLength,P=[],O=[];for(const W of v){if(W.length===0)continue;W!==v[0]&&O.push(P.length/2);const Z=this.segments2.prepareSegment(W.length,this.layoutVertexArray,this.indexArray2),ne=Z.vertexLength;this.layoutVertexArray.emplaceBack(W[0].x,W[0].y),this.indexArray2.emplaceBack(ne+W.length-1,ne),P.push(W[0].x),P.push(W[0].y);for(let fe=1;fe<W.length;fe++)this.layoutVertexArray.emplaceBack(W[fe].x,W[fe].y),this.indexArray2.emplaceBack(ne+fe-1,ne+fe),P.push(W[fe].x),P.push(W[fe].y);Z.vertexLength+=W.length,Z.primitiveLength+=W.length}const j=Sd(P,O);for(let W=0;W<j.length;W+=3)this.indexArray.emplaceBack(I+j[W],I+j[W+1],I+j[W+2]);k.vertexLength+=w,k.primitiveLength+=j.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,_,d)}}let Cd,Ad;It("FillBucket",yf,{omit:["layers","patternFeatures"]});var jx={get paint(){return Ad=Ad||new ra({"fill-antialias":new zt(Xe.paint_fill["fill-antialias"]),"fill-opacity":new Gt(Xe.paint_fill["fill-opacity"]),"fill-color":new Gt(Xe.paint_fill["fill-color"]),"fill-outline-color":new Gt(Xe.paint_fill["fill-outline-color"]),"fill-translate":new zt(Xe.paint_fill["fill-translate"]),"fill-translate-anchor":new zt(Xe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ks(Xe.paint_fill["fill-pattern"])})},get layout(){return Cd=Cd||new ra({"fill-sort-key":new Gt(Xe.layout_fill["fill-sort-key"])})}};class Gx extends Pi{constructor(t){super(t,jx)}recalculate(t,s){super.recalculate(t,s);const u=this.paint._values["fill-outline-color"];u.value.kind==="constant"&&u.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new yf(t)}queryRadius(){return $h(this.paint.get("fill-translate"))}queryIntersectsFeature(t,s,u,d,_,v,w){return cd(jh(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),v.angle,w),d)}isTileClipped(){return!0}}const Hx=$r([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),qx=$r([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Wx}=Hx;var ys={},Zx=C,Id=Qo;function Qo(a,t,s,u,d){this.properties={},this.extent=s,this.type=0,this._pbf=a,this._geometry=-1,this._keys=u,this._values=d,a.readFields(Xx,this,t)}function Xx(a,t,s){a==1?t.id=s.readVarint():a==2?function(u,d){for(var _=u.readVarint()+u.pos;u.pos<_;){var v=d._keys[u.readVarint()],w=d._values[u.readVarint()];d.properties[v]=w}}(s,t):a==3?t.type=s.readVarint():a==4&&(t._geometry=s.pos)}function Kx(a){for(var t,s,u=0,d=0,_=a.length,v=_-1;d<_;v=d++)u+=((s=a[v]).x-(t=a[d]).x)*(t.y+s.y);return u}Qo.types=["Unknown","Point","LineString","Polygon"],Qo.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var t,s=a.readVarint()+a.pos,u=1,d=0,_=0,v=0,w=[];a.pos<s;){if(d<=0){var k=a.readVarint();u=7&k,d=k>>3}if(d--,u===1||u===2)_+=a.readSVarint(),v+=a.readSVarint(),u===1&&(t&&w.push(t),t=[]),t.push(new Zx(_,v));else{if(u!==7)throw new Error("unknown command "+u);t&&t.push(t[0].clone())}}return t&&w.push(t),w},Qo.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var t=a.readVarint()+a.pos,s=1,u=0,d=0,_=0,v=1/0,w=-1/0,k=1/0,I=-1/0;a.pos<t;){if(u<=0){var P=a.readVarint();s=7&P,u=P>>3}if(u--,s===1||s===2)(d+=a.readSVarint())<v&&(v=d),d>w&&(w=d),(_+=a.readSVarint())<k&&(k=_),_>I&&(I=_);else if(s!==7)throw new Error("unknown command "+s)}return[v,k,w,I]},Qo.prototype.toGeoJSON=function(a,t,s){var u,d,_=this.extent*Math.pow(2,s),v=this.extent*a,w=this.extent*t,k=this.loadGeometry(),I=Qo.types[this.type];function P(W){for(var Z=0;Z<W.length;Z++){var ne=W[Z];W[Z]=[360*(ne.x+v)/_-180,360/Math.PI*Math.atan(Math.exp((180-360*(ne.y+w)/_)*Math.PI/180))-90]}}switch(this.type){case 1:var O=[];for(u=0;u<k.length;u++)O[u]=k[u][0];P(k=O);break;case 2:for(u=0;u<k.length;u++)P(k[u]);break;case 3:for(k=function(W){var Z=W.length;if(Z<=1)return[W];for(var ne,fe,ye=[],Me=0;Me<Z;Me++){var Ee=Kx(W[Me]);Ee!==0&&(fe===void 0&&(fe=Ee<0),fe===Ee<0?(ne&&ye.push(ne),ne=[W[Me]]):ne.push(W[Me]))}return ne&&ye.push(ne),ye}(k),u=0;u<k.length;u++)for(d=0;d<k[u].length;d++)P(k[u][d])}k.length===1?k=k[0]:I="Multi"+I;var j={type:"Feature",geometry:{type:I,coordinates:k},properties:this.properties};return"id"in this&&(j.id=this.id),j};var Yx=Id,Fd=Pd;function Pd(a,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(Jx,this,t),this.length=this._features.length}function Jx(a,t,s){a===15?t.version=s.readVarint():a===1?t.name=s.readString():a===5?t.extent=s.readVarint():a===2?t._features.push(s.pos):a===3?t._keys.push(s.readString()):a===4&&t._values.push(function(u){for(var d=null,_=u.readVarint()+u.pos;u.pos<_;){var v=u.readVarint()>>3;d=v===1?u.readString():v===2?u.readFloat():v===3?u.readDouble():v===4?u.readVarint64():v===5?u.readVarint():v===6?u.readSVarint():v===7?u.readBoolean():null}return d}(s))}Pd.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var t=this._pbf.readVarint()+this._pbf.pos;return new Yx(this._pbf,t,this.extent,this._keys,this._values)};var Qx=Fd;function e_(a,t,s){if(a===3){var u=new Qx(s,s.readVarint()+s.pos);u.length&&(t[u.name]=u)}}ys.VectorTile=function(a,t){this.layers=a.readFields(e_,{},t)},ys.VectorTileFeature=Id,ys.VectorTileLayer=Fd;const t_=ys.VectorTileFeature.types,vf=Math.pow(2,13);function gc(a,t,s,u,d,_,v,w){a.emplaceBack(t,s,2*Math.floor(u*vf)+v,d*vf*2,_*vf*2,Math.round(w))}class wf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new bt,this.centroidVertexArray=new xt,this.indexArray=new Ca,this.programConfigurations=new dn(t.layers,t.zoom),this.segments=new Mr,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,u){this.features=[],this.hasPattern=xf("fill-extrusion",this.layers,s);for(const{feature:d,id:_,index:v,sourceLayerIndex:w}of t){const k=this.layers[0]._featureFilter.needGeometry,I=eo(d,k);if(!this.layers[0]._featureFilter.filter(new Pr(this.zoom),I,u))continue;const P={id:_,sourceLayerIndex:w,index:v,geometry:k?I.geometry:Qs(d),properties:d.properties,type:d.type,patterns:{}};this.hasPattern?this.features.push(_f("fill-extrusion",this.layers,P,this.zoom,s)):this.addFeature(P,P.geometry,v,u,{}),s.featureIndex.insert(d,P.geometry,v,w,this.index,!0)}}addFeatures(t,s,u){for(const d of this.features){const{geometry:_}=d;this.addFeature(d,_,d.index,s,u)}}update(t,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,u)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Wx),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,qx.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,s,u,d,_){const v={x:0,y:0,vertexCount:0};for(const w of gf(s,500)){let k=0;for(const Z of w)k+=Z.length;let I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const Z of w){if(Z.length===0||a_(Z))continue;let ne=0;for(let fe=0;fe<Z.length;fe++){const ye=Z[fe];if(fe>=1){const Me=Z[fe-1];if(!r_(ye,Me)){I.vertexLength+4>Mr.MAX_VERTEX_ARRAY_LENGTH&&(I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Ee=ye.sub(Me)._perp()._unit(),Oe=Me.dist(ye);ne+Oe>32768&&(ne=0),gc(this.layoutVertexArray,ye.x,ye.y,Ee.x,Ee.y,0,0,ne),gc(this.layoutVertexArray,ye.x,ye.y,Ee.x,Ee.y,0,1,ne),v.x+=2*ye.x,v.y+=2*ye.y,v.vertexCount+=2,ne+=Oe,gc(this.layoutVertexArray,Me.x,Me.y,Ee.x,Ee.y,0,0,ne),gc(this.layoutVertexArray,Me.x,Me.y,Ee.x,Ee.y,0,1,ne),v.x+=2*Me.x,v.y+=2*Me.y,v.vertexCount+=2;const Ge=I.vertexLength;this.indexArray.emplaceBack(Ge,Ge+2,Ge+1),this.indexArray.emplaceBack(Ge+1,Ge+2,Ge+3),I.vertexLength+=4,I.primitiveLength+=2}}}}if(I.vertexLength+k>Mr.MAX_VERTEX_ARRAY_LENGTH&&(I=this.segments.prepareSegment(k,this.layoutVertexArray,this.indexArray)),t_[t.type]!=="Polygon")continue;const P=[],O=[],j=I.vertexLength;for(const Z of w)if(Z.length!==0){Z!==w[0]&&O.push(P.length/2);for(let ne=0;ne<Z.length;ne++){const fe=Z[ne];gc(this.layoutVertexArray,fe.x,fe.y,0,0,1,1,0),v.x+=fe.x,v.y+=fe.y,v.vertexCount+=1,P.push(fe.x),P.push(fe.y)}}const W=Sd(P,O);for(let Z=0;Z<W.length;Z+=3)this.indexArray.emplaceBack(j+W[Z],j+W[Z+2],j+W[Z+1]);I.primitiveLength+=W.length/3,I.vertexLength+=k}for(let w=0;w<v.vertexCount;w++)this.centroidVertexArray.emplaceBack(Math.floor(v.x/v.vertexCount),Math.floor(v.y/v.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,_,d)}}function r_(a,t){return a.x===t.x&&(a.x<0||a.x>oa)||a.y===t.y&&(a.y<0||a.y>oa)}function a_(a){return a.every(t=>t.x<0)||a.every(t=>t.x>oa)||a.every(t=>t.y<0)||a.every(t=>t.y>oa)}let Md;It("FillExtrusionBucket",wf,{omit:["layers","features"]});var i_={get paint(){return Md=Md||new ra({"fill-extrusion-opacity":new zt(Xe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Gt(Xe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new zt(Xe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new zt(Xe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ks(Xe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Gt(Xe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Gt(Xe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new zt(Xe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class n_ extends Pi{constructor(t){super(t,i_)}createBucket(t){return new wf(t)}queryRadius(){return $h(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,s,u,d,_,v,w,k){const I=jh(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),v.angle,w),P=this.paint.get("fill-extrusion-height").evaluate(s,u),O=this.paint.get("fill-extrusion-base").evaluate(s,u),j=function(Z,ne,fe,ye){const Me=[];for(const Ee of Z){const Oe=[Ee.x,Ee.y,0,1];Gh(Oe,Oe,ne),Me.push(new L(Oe[0]/Oe[3],Oe[1]/Oe[3]))}return Me}(I,k),W=function(Z,ne,fe,ye){const Me=[],Ee=[],Oe=ye[8]*ne,Ge=ye[9]*ne,tt=ye[10]*ne,At=ye[11]*ne,Rt=ye[8]*fe,kt=ye[9]*fe,Tt=ye[10]*fe,yt=ye[11]*fe;for(const Pt of Z){const vt=[],ht=[];for(const Vt of Pt){const Bt=Vt.x,nr=Vt.y,Dr=ye[0]*Bt+ye[4]*nr+ye[12],Br=ye[1]*Bt+ye[5]*nr+ye[13],ga=ye[2]*Bt+ye[6]*nr+ye[14],Di=ye[3]*Bt+ye[7]*nr+ye[15],ri=ga+tt,la=Di+At,Ia=Dr+Rt,Ra=Br+kt,ai=ga+Tt,ii=Di+yt,xa=new L((Dr+Oe)/la,(Br+Ge)/la);xa.z=ri/la,vt.push(xa);const _a=new L(Ia/ii,Ra/ii);_a.z=ai/ii,ht.push(_a)}Me.push(vt),Ee.push(ht)}return[Me,Ee]}(d,O,P,k);return function(Z,ne,fe){let ye=1/0;cd(fe,ne)&&(ye=Dd(fe,ne[0]));for(let Me=0;Me<ne.length;Me++){const Ee=ne[Me],Oe=Z[Me];for(let Ge=0;Ge<Ee.length-1;Ge++){const tt=Ee[Ge],At=[tt,Ee[Ge+1],Oe[Ge+1],Oe[Ge],tt];ld(fe,At)&&(ye=Math.min(ye,Dd(fe,At)))}}return ye!==1/0&&ye}(W[0],W[1],j)}}function xc(a,t){return a.x*t.x+a.y*t.y}function Dd(a,t){if(a.length===1){let s=0;const u=t[s++];let d;for(;!d||u.equals(d);)if(d=t[s++],!d)return 1/0;for(;s<t.length;s++){const _=t[s],v=a[0],w=d.sub(u),k=_.sub(u),I=v.sub(u),P=xc(w,w),O=xc(w,k),j=xc(k,k),W=xc(I,w),Z=xc(I,k),ne=P*j-O*O,fe=(j*W-O*Z)/ne,ye=(P*Z-O*W)/ne,Me=u.z*(1-fe-ye)+d.z*fe+_.z*ye;if(isFinite(Me))return Me}return 1/0}{let s=1/0;for(const u of t)s=Math.min(s,u.z);return s}}const s_=$r([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:o_}=s_,l_=$r([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:c_}=l_,h_=ys.VectorTileFeature.types,u_=Math.cos(Math.PI/180*37.5),Ld=Math.pow(2,14)/.5;class bf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new Ht,this.layoutVertexArray2=new Ot,this.indexArray=new Ca,this.programConfigurations=new dn(t.layers,t.zoom),this.segments=new Mr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,u){this.hasPattern=xf("line",this.layers,s);const d=this.layers[0].layout.get("line-sort-key"),_=!d.isConstant(),v=[];for(const{feature:w,id:k,index:I,sourceLayerIndex:P}of t){const O=this.layers[0]._featureFilter.needGeometry,j=eo(w,O);if(!this.layers[0]._featureFilter.filter(new Pr(this.zoom),j,u))continue;const W=_?d.evaluate(j,{},u):void 0,Z={id:k,properties:w.properties,type:w.type,sourceLayerIndex:P,index:I,geometry:O?j.geometry:Qs(w),patterns:{},sortKey:W};v.push(Z)}_&&v.sort((w,k)=>w.sortKey-k.sortKey);for(const w of v){const{geometry:k,index:I,sourceLayerIndex:P}=w;if(this.hasPattern){const O=_f("line",this.layers,w,this.zoom,s);this.patternFeatures.push(O)}else this.addFeature(w,k,I,u,{});s.featureIndex.insert(t[I].feature,k,I,P,this.index)}}update(t,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,u)}addFeatures(t,s,u){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,s,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,c_)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,o_),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,s,u,d,_){const v=this.layers[0].layout,w=v.get("line-join").evaluate(t,{}),k=v.get("line-cap"),I=v.get("line-miter-limit"),P=v.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const O of s)this.addLine(O,t,w,k,I,P);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,_,d)}addLine(t,s,u,d,_,v){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ye=0;ye<t.length-1;ye++)this.totalDistance+=t[ye].dist(t[ye+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const w=h_[s.type]==="Polygon";let k=t.length;for(;k>=2&&t[k-1].equals(t[k-2]);)k--;let I=0;for(;I<k-1&&t[I].equals(t[I+1]);)I++;if(k<(w?3:2))return;u==="bevel"&&(_=1.05);const P=this.overscaling<=16?15*oa/(512*this.overscaling):0,O=this.segments.prepareSegment(10*k,this.layoutVertexArray,this.indexArray);let j,W,Z,ne,fe;this.e1=this.e2=-1,w&&(j=t[k-2],fe=t[I].sub(j)._unit()._perp());for(let ye=I;ye<k;ye++){if(Z=ye===k-1?w?t[I+1]:void 0:t[ye+1],Z&&t[ye].equals(Z))continue;fe&&(ne=fe),j&&(W=j),j=t[ye],fe=Z?Z.sub(j)._unit()._perp():ne,ne=ne||fe;let Me=ne.add(fe);Me.x===0&&Me.y===0||Me._unit();const Ee=ne.x*fe.x+ne.y*fe.y,Oe=Me.x*fe.x+Me.y*fe.y,Ge=Oe!==0?1/Oe:1/0,tt=2*Math.sqrt(2-2*Oe),At=Oe<u_&&W&&Z,Rt=ne.x*fe.y-ne.y*fe.x>0;if(At&&ye>I){const yt=j.dist(W);if(yt>2*P){const Pt=j.sub(j.sub(W)._mult(P/yt)._round());this.updateDistance(W,Pt),this.addCurrentVertex(Pt,ne,0,0,O),W=Pt}}const kt=W&&Z;let Tt=kt?u:w?"butt":d;if(kt&&Tt==="round"&&(Ge<v?Tt="miter":Ge<=2&&(Tt="fakeround")),Tt==="miter"&&Ge>_&&(Tt="bevel"),Tt==="bevel"&&(Ge>2&&(Tt="flipbevel"),Ge<_&&(Tt="miter")),W&&this.updateDistance(W,j),Tt==="miter")Me._mult(Ge),this.addCurrentVertex(j,Me,0,0,O);else if(Tt==="flipbevel"){if(Ge>100)Me=fe.mult(-1);else{const yt=Ge*ne.add(fe).mag()/ne.sub(fe).mag();Me._perp()._mult(yt*(Rt?-1:1))}this.addCurrentVertex(j,Me,0,0,O),this.addCurrentVertex(j,Me.mult(-1),0,0,O)}else if(Tt==="bevel"||Tt==="fakeround"){const yt=-Math.sqrt(Ge*Ge-1),Pt=Rt?yt:0,vt=Rt?0:yt;if(W&&this.addCurrentVertex(j,ne,Pt,vt,O),Tt==="fakeround"){const ht=Math.round(180*tt/Math.PI/20);for(let Vt=1;Vt<ht;Vt++){let Bt=Vt/ht;if(Bt!==.5){const Dr=Bt-.5;Bt+=Bt*Dr*(Bt-1)*((1.0904+Ee*(Ee*(3.55645-1.43519*Ee)-3.2452))*Dr*Dr+(.848013+Ee*(.215638*Ee-1.06021)))}const nr=fe.sub(ne)._mult(Bt)._add(ne)._unit()._mult(Rt?-1:1);this.addHalfVertex(j,nr.x,nr.y,!1,Rt,0,O)}}Z&&this.addCurrentVertex(j,fe,-Pt,-vt,O)}else if(Tt==="butt")this.addCurrentVertex(j,Me,0,0,O);else if(Tt==="square"){const yt=W?1:-1;this.addCurrentVertex(j,Me,yt,yt,O)}else Tt==="round"&&(W&&(this.addCurrentVertex(j,ne,0,0,O),this.addCurrentVertex(j,ne,1,1,O,!0)),Z&&(this.addCurrentVertex(j,fe,-1,-1,O,!0),this.addCurrentVertex(j,fe,0,0,O)));if(At&&ye<k-1){const yt=j.dist(Z);if(yt>2*P){const Pt=j.add(Z.sub(j)._mult(P/yt)._round());this.updateDistance(j,Pt),this.addCurrentVertex(Pt,fe,0,0,O),j=Pt}}}}addCurrentVertex(t,s,u,d,_,v=!1){const w=s.y*d-s.x,k=-s.y-s.x*d;this.addHalfVertex(t,s.x+s.y*u,s.y-s.x*u,v,!1,u,_),this.addHalfVertex(t,w,k,v,!0,-d,_),this.distance>Ld/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,s,u,d,_,v))}addHalfVertex({x:t,y:s},u,d,_,v,w,k){const I=.5*(this.lineClips?this.scaledDistance*(Ld-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(_?1:0),(s<<1)+(v?1:0),Math.round(63*u)+128,Math.round(63*d)+128,1+(w===0?0:w<0?-1:1)|(63&I)<<2,I>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const P=k.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,P),k.primitiveLength++),v?this.e2=P:this.e1=P}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,s){this.distance+=t.dist(s),this.updateScaledDistance()}}let Rd,Od;It("LineBucket",bf,{omit:["layers","patternFeatures"]});var Bd={get paint(){return Od=Od||new ra({"line-opacity":new Gt(Xe.paint_line["line-opacity"]),"line-color":new Gt(Xe.paint_line["line-color"]),"line-translate":new zt(Xe.paint_line["line-translate"]),"line-translate-anchor":new zt(Xe.paint_line["line-translate-anchor"]),"line-width":new Gt(Xe.paint_line["line-width"]),"line-gap-width":new Gt(Xe.paint_line["line-gap-width"]),"line-offset":new Gt(Xe.paint_line["line-offset"]),"line-blur":new Gt(Xe.paint_line["line-blur"]),"line-dasharray":new ec(Xe.paint_line["line-dasharray"]),"line-pattern":new Ks(Xe.paint_line["line-pattern"]),"line-gradient":new tc(Xe.paint_line["line-gradient"])})},get layout(){return Rd=Rd||new ra({"line-cap":new zt(Xe.layout_line["line-cap"]),"line-join":new Gt(Xe.layout_line["line-join"]),"line-miter-limit":new zt(Xe.layout_line["line-miter-limit"]),"line-round-limit":new zt(Xe.layout_line["line-round-limit"]),"line-sort-key":new Gt(Xe.layout_line["line-sort-key"])})}};class f_ extends Gt{possiblyEvaluate(t,s){return s=new Pr(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,zoomHistory:s.zoomHistory,transition:s.transition}),super.possiblyEvaluate(t,s)}evaluate(t,s,u,d){return s=Be({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(t,s,u,d)}}let Xh;class d_ extends Pi{constructor(t){super(t,Bd),this.gradientVersion=0,Xh||(Xh=new f_(Bd.paint.properties["line-width"].specification),Xh.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const s=this.gradientExpression();this.stepInterpolant=!!function(u){return u._styleExpression!==void 0}(s)&&s._styleExpression.expression instanceof kn,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,s){super.recalculate(t,s),this.paint._values["line-floorwidth"]=Xh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new bf(t)}queryRadius(t){const s=t,u=zd(cc("line-width",this,s),cc("line-gap-width",this,s)),d=cc("line-offset",this,s);return u/2+Math.abs(d)+$h(this.paint.get("line-translate"))}queryIntersectsFeature(t,s,u,d,_,v,w){const k=jh(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),v.angle,w),I=w/2*zd(this.paint.get("line-width").evaluate(s,u),this.paint.get("line-gap-width").evaluate(s,u)),P=this.paint.get("line-offset").evaluate(s,u);return P&&(d=function(O,j){const W=[];for(let Z=0;Z<O.length;Z++){const ne=O[Z],fe=[];for(let ye=0;ye<ne.length;ye++){const Me=ne[ye-1],Ee=ne[ye],Oe=ne[ye+1],Ge=ye===0?new L(0,0):Ee.sub(Me)._unit()._perp(),tt=ye===ne.length-1?new L(0,0):Oe.sub(Ee)._unit()._perp(),At=Ge._add(tt)._unit(),Rt=At.x*tt.x+At.y*tt.y;Rt!==0&&At._mult(1/Rt),fe.push(At._mult(j)._add(Ee))}W.push(fe)}return W}(d,P*w)),function(O,j,W){for(let Z=0;Z<j.length;Z++){const ne=j[Z];if(O.length>=3){for(let fe=0;fe<ne.length;fe++)if(Ko(O,ne[fe]))return!0}if(yx(O,ne,W))return!0}return!1}(k,d,I)}isTileClipped(){return!0}}function zd(a,t){return t>0?t+2*a:a}const p_=$r([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),m_=$r([{name:"a_projected_pos",components:3,type:"Float32"}],4);$r([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const g_=$r([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);$r([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Nd=$r([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),x_=$r([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function __(a,t,s){return a.sections.forEach(u=>{u.text=function(d,_,v){const w=_.layout.get("text-transform").evaluate(v,{});return w==="uppercase"?d=d.toLocaleUpperCase():w==="lowercase"&&(d=d.toLocaleLowerCase()),gi.applyArabicShaping&&(d=gi.applyArabicShaping(d)),d}(u.text,t,s)}),a}$r([{name:"triangle",components:3,type:"Uint16"}]),$r([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),$r([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),$r([{type:"Float32",name:"offsetX"}]),$r([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),$r([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const _c={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var ma=24,Ud=Ar,Vd=function(a,t,s,u,d){var _,v,w=8*d-u-1,k=(1<<w)-1,I=k>>1,P=-7,O=s?d-1:0,j=s?-1:1,W=a[t+O];for(O+=j,_=W&(1<<-P)-1,W>>=-P,P+=w;P>0;_=256*_+a[t+O],O+=j,P-=8);for(v=_&(1<<-P)-1,_>>=-P,P+=u;P>0;v=256*v+a[t+O],O+=j,P-=8);if(_===0)_=1-I;else{if(_===k)return v?NaN:1/0*(W?-1:1);v+=Math.pow(2,u),_-=I}return(W?-1:1)*v*Math.pow(2,_-u)},$d=function(a,t,s,u,d,_){var v,w,k,I=8*_-d-1,P=(1<<I)-1,O=P>>1,j=d===23?Math.pow(2,-24)-Math.pow(2,-77):0,W=u?0:_-1,Z=u?1:-1,ne=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(w=isNaN(t)?1:0,v=P):(v=Math.floor(Math.log(t)/Math.LN2),t*(k=Math.pow(2,-v))<1&&(v--,k*=2),(t+=v+O>=1?j/k:j*Math.pow(2,1-O))*k>=2&&(v++,k/=2),v+O>=P?(w=0,v=P):v+O>=1?(w=(t*k-1)*Math.pow(2,d),v+=O):(w=t*Math.pow(2,O-1)*Math.pow(2,d),v=0));d>=8;a[s+W]=255&w,W+=Z,w/=256,d-=8);for(v=v<<d|w,I+=d;I>0;a[s+W]=255&v,W+=Z,v/=256,I-=8);a[s+W-Z]|=128*ne};function Ar(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}Ar.Varint=0,Ar.Fixed64=1,Ar.Bytes=2,Ar.Fixed32=5;var Tf=4294967296,jd=1/Tf,Gd=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Yn(a){return a.type===Ar.Bytes?a.readVarint()+a.pos:a.pos+1}function el(a,t,s){return s?4294967296*t+(a>>>0):4294967296*(t>>>0)+(a>>>0)}function Hd(a,t,s){var u=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));s.realloc(u);for(var d=s.pos-1;d>=a;d--)s.buf[d+u]=s.buf[d]}function y_(a,t){for(var s=0;s<a.length;s++)t.writeVarint(a[s])}function v_(a,t){for(var s=0;s<a.length;s++)t.writeSVarint(a[s])}function w_(a,t){for(var s=0;s<a.length;s++)t.writeFloat(a[s])}function b_(a,t){for(var s=0;s<a.length;s++)t.writeDouble(a[s])}function T_(a,t){for(var s=0;s<a.length;s++)t.writeBoolean(a[s])}function E_(a,t){for(var s=0;s<a.length;s++)t.writeFixed32(a[s])}function S_(a,t){for(var s=0;s<a.length;s++)t.writeSFixed32(a[s])}function k_(a,t){for(var s=0;s<a.length;s++)t.writeFixed64(a[s])}function C_(a,t){for(var s=0;s<a.length;s++)t.writeSFixed64(a[s])}function Kh(a,t){return(a[t]|a[t+1]<<8|a[t+2]<<16)+16777216*a[t+3]}function tl(a,t,s){a[s]=t,a[s+1]=t>>>8,a[s+2]=t>>>16,a[s+3]=t>>>24}function qd(a,t){return(a[t]|a[t+1]<<8|a[t+2]<<16)+(a[t+3]<<24)}Ar.prototype={destroy:function(){this.buf=null},readFields:function(a,t,s){for(s=s||this.length;this.pos<s;){var u=this.readVarint(),d=u>>3,_=this.pos;this.type=7&u,a(d,t,this),this.pos===_&&this.skip(u)}return t},readMessage:function(a,t){return this.readFields(a,t,this.readVarint()+this.pos)},readFixed32:function(){var a=Kh(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=qd(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=Kh(this.buf,this.pos)+Kh(this.buf,this.pos+4)*Tf;return this.pos+=8,a},readSFixed64:function(){var a=Kh(this.buf,this.pos)+qd(this.buf,this.pos+4)*Tf;return this.pos+=8,a},readFloat:function(){var a=Vd(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=Vd(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var t,s,u=this.buf;return t=127&(s=u[this.pos++]),s<128?t:(t|=(127&(s=u[this.pos++]))<<7,s<128?t:(t|=(127&(s=u[this.pos++]))<<14,s<128?t:(t|=(127&(s=u[this.pos++]))<<21,s<128?t:function(d,_,v){var w,k,I=v.buf;if(w=(112&(k=I[v.pos++]))>>4,k<128||(w|=(127&(k=I[v.pos++]))<<3,k<128)||(w|=(127&(k=I[v.pos++]))<<10,k<128)||(w|=(127&(k=I[v.pos++]))<<17,k<128)||(w|=(127&(k=I[v.pos++]))<<24,k<128)||(w|=(1&(k=I[v.pos++]))<<31,k<128))return el(d,w,_);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(s=u[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var a=this.readVarint()+this.pos,t=this.pos;return this.pos=a,a-t>=12&&Gd?function(s,u,d){return Gd.decode(s.subarray(u,d))}(this.buf,t,a):function(s,u,d){for(var _="",v=u;v<d;){var w,k,I,P=s[v],O=null,j=P>239?4:P>223?3:P>191?2:1;if(v+j>d)break;j===1?P<128&&(O=P):j===2?(192&(w=s[v+1]))==128&&(O=(31&P)<<6|63&w)<=127&&(O=null):j===3?(k=s[v+2],(192&(w=s[v+1]))==128&&(192&k)==128&&((O=(15&P)<<12|(63&w)<<6|63&k)<=2047||O>=55296&&O<=57343)&&(O=null)):j===4&&(k=s[v+2],I=s[v+3],(192&(w=s[v+1]))==128&&(192&k)==128&&(192&I)==128&&((O=(15&P)<<18|(63&w)<<12|(63&k)<<6|63&I)<=65535||O>=1114112)&&(O=null)),O===null?(O=65533,j=1):O>65535&&(O-=65536,_+=String.fromCharCode(O>>>10&1023|55296),O=56320|1023&O),_+=String.fromCharCode(O),v+=j}return _}(this.buf,t,a)},readBytes:function(){var a=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,a);return this.pos=a,t},readPackedVarint:function(a,t){if(this.type!==Ar.Bytes)return a.push(this.readVarint(t));var s=Yn(this);for(a=a||[];this.pos<s;)a.push(this.readVarint(t));return a},readPackedSVarint:function(a){if(this.type!==Ar.Bytes)return a.push(this.readSVarint());var t=Yn(this);for(a=a||[];this.pos<t;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==Ar.Bytes)return a.push(this.readBoolean());var t=Yn(this);for(a=a||[];this.pos<t;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==Ar.Bytes)return a.push(this.readFloat());var t=Yn(this);for(a=a||[];this.pos<t;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==Ar.Bytes)return a.push(this.readDouble());var t=Yn(this);for(a=a||[];this.pos<t;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==Ar.Bytes)return a.push(this.readFixed32());var t=Yn(this);for(a=a||[];this.pos<t;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==Ar.Bytes)return a.push(this.readSFixed32());var t=Yn(this);for(a=a||[];this.pos<t;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==Ar.Bytes)return a.push(this.readFixed64());var t=Yn(this);for(a=a||[];this.pos<t;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==Ar.Bytes)return a.push(this.readSFixed64());var t=Yn(this);for(a=a||[];this.pos<t;)a.push(this.readSFixed64());return a},skip:function(a){var t=7&a;if(t===Ar.Varint)for(;this.buf[this.pos++]>127;);else if(t===Ar.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Ar.Fixed32)this.pos+=4;else{if(t!==Ar.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(a,t){this.writeVarint(a<<3|t)},realloc:function(a){for(var t=this.length||16;t<this.pos+a;)t*=2;if(t!==this.length){var s=new Uint8Array(t);s.set(this.buf),this.buf=s,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),tl(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),tl(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),tl(this.buf,-1&a,this.pos),tl(this.buf,Math.floor(a*jd),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),tl(this.buf,-1&a,this.pos),tl(this.buf,Math.floor(a*jd),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(t,s){var u,d;if(t>=0?(u=t%4294967296|0,d=t/4294967296|0):(d=~(-t/4294967296),4294967295^(u=~(-t%4294967296))?u=u+1|0:(u=0,d=d+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),function(_,v,w){w.buf[w.pos++]=127&_|128,_>>>=7,w.buf[w.pos++]=127&_|128,_>>>=7,w.buf[w.pos++]=127&_|128,_>>>=7,w.buf[w.pos++]=127&_|128,w.buf[w.pos]=127&(_>>>=7)}(u,0,s),function(_,v){var w=(7&_)<<4;v.buf[v.pos++]|=w|((_>>>=3)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_)))))}(d,s)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(!!a)},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var t=this.pos;this.pos=function(u,d,_){for(var v,w,k=0;k<d.length;k++){if((v=d.charCodeAt(k))>55295&&v<57344){if(!w){v>56319||k+1===d.length?(u[_++]=239,u[_++]=191,u[_++]=189):w=v;continue}if(v<56320){u[_++]=239,u[_++]=191,u[_++]=189,w=v;continue}v=w-55296<<10|v-56320|65536,w=null}else w&&(u[_++]=239,u[_++]=191,u[_++]=189,w=null);v<128?u[_++]=v:(v<2048?u[_++]=v>>6|192:(v<65536?u[_++]=v>>12|224:(u[_++]=v>>18|240,u[_++]=v>>12&63|128),u[_++]=v>>6&63|128),u[_++]=63&v|128)}return _}(this.buf,a,this.pos);var s=this.pos-t;s>=128&&Hd(t,s,this),this.pos=t-1,this.writeVarint(s),this.pos+=s},writeFloat:function(a){this.realloc(4),$d(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),$d(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var t=a.length;this.writeVarint(t),this.realloc(t);for(var s=0;s<t;s++)this.buf[this.pos++]=a[s]},writeRawMessage:function(a,t){this.pos++;var s=this.pos;a(t,this);var u=this.pos-s;u>=128&&Hd(s,u,this),this.pos=s-1,this.writeVarint(u),this.pos+=u},writeMessage:function(a,t,s){this.writeTag(a,Ar.Bytes),this.writeRawMessage(t,s)},writePackedVarint:function(a,t){t.length&&this.writeMessage(a,y_,t)},writePackedSVarint:function(a,t){t.length&&this.writeMessage(a,v_,t)},writePackedBoolean:function(a,t){t.length&&this.writeMessage(a,T_,t)},writePackedFloat:function(a,t){t.length&&this.writeMessage(a,w_,t)},writePackedDouble:function(a,t){t.length&&this.writeMessage(a,b_,t)},writePackedFixed32:function(a,t){t.length&&this.writeMessage(a,E_,t)},writePackedSFixed32:function(a,t){t.length&&this.writeMessage(a,S_,t)},writePackedFixed64:function(a,t){t.length&&this.writeMessage(a,k_,t)},writePackedSFixed64:function(a,t){t.length&&this.writeMessage(a,C_,t)},writeBytesField:function(a,t){this.writeTag(a,Ar.Bytes),this.writeBytes(t)},writeFixed32Field:function(a,t){this.writeTag(a,Ar.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(a,t){this.writeTag(a,Ar.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(a,t){this.writeTag(a,Ar.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(a,t){this.writeTag(a,Ar.Fixed64),this.writeSFixed64(t)},writeVarintField:function(a,t){this.writeTag(a,Ar.Varint),this.writeVarint(t)},writeSVarintField:function(a,t){this.writeTag(a,Ar.Varint),this.writeSVarint(t)},writeStringField:function(a,t){this.writeTag(a,Ar.Bytes),this.writeString(t)},writeFloatField:function(a,t){this.writeTag(a,Ar.Fixed32),this.writeFloat(t)},writeDoubleField:function(a,t){this.writeTag(a,Ar.Fixed64),this.writeDouble(t)},writeBooleanField:function(a,t){this.writeVarintField(a,!!t)}};var Ef=b(Ud);const Sf=3;function A_(a,t,s){a===1&&s.readMessage(I_,t)}function I_(a,t,s){if(a===3){const{id:u,bitmap:d,width:_,height:v,left:w,top:k,advance:I}=s.readMessage(F_,{});t.push({id:u,bitmap:new uc({width:_+2*Sf,height:v+2*Sf},d),metrics:{width:_,height:v,left:w,top:k,advance:I}})}}function F_(a,t,s){a===1?t.id=s.readVarint():a===2?t.bitmap=s.readBytes():a===3?t.width=s.readVarint():a===4?t.height=s.readVarint():a===5?t.left=s.readSVarint():a===6?t.top=s.readSVarint():a===7&&(t.advance=s.readVarint())}const Wd=Sf;function Zd(a){let t=0,s=0;for(const v of a)t+=v.w*v.h,s=Math.max(s,v.w);a.sort((v,w)=>w.h-v.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),s),h:1/0}];let d=0,_=0;for(const v of a)for(let w=u.length-1;w>=0;w--){const k=u[w];if(!(v.w>k.w||v.h>k.h)){if(v.x=k.x,v.y=k.y,_=Math.max(_,v.y+v.h),d=Math.max(d,v.x+v.w),v.w===k.w&&v.h===k.h){const I=u.pop();w<u.length&&(u[w]=I)}else v.h===k.h?(k.x+=v.w,k.w-=v.w):v.w===k.w?(k.y+=v.h,k.h-=v.h):(u.push({x:k.x+v.w,y:k.y,w:k.w-v.w,h:v.h}),k.y+=v.h,k.h-=v.h);break}}return{w:d,h:_,fill:t/(d*_)||0}}const _i=1;class kf{constructor(t,{pixelRatio:s,version:u,stretchX:d,stretchY:_,content:v}){this.paddedRect=t,this.pixelRatio=s,this.stretchX=d,this.stretchY=_,this.content=v,this.version=u}get tl(){return[this.paddedRect.x+_i,this.paddedRect.y+_i]}get br(){return[this.paddedRect.x+this.paddedRect.w-_i,this.paddedRect.y+this.paddedRect.h-_i]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*_i)/this.pixelRatio,(this.paddedRect.h-2*_i)/this.pixelRatio]}}class Xd{constructor(t,s){const u={},d={};this.haveRenderCallbacks=[];const _=[];this.addImages(t,u,_),this.addImages(s,d,_);const{w:v,h:w}=Zd(_),k=new Oi({width:v||1,height:w||1});for(const I in t){const P=t[I],O=u[I].paddedRect;Oi.copy(P.data,k,{x:0,y:0},{x:O.x+_i,y:O.y+_i},P.data)}for(const I in s){const P=s[I],O=d[I].paddedRect,j=O.x+_i,W=O.y+_i,Z=P.data.width,ne=P.data.height;Oi.copy(P.data,k,{x:0,y:0},{x:j,y:W},P.data),Oi.copy(P.data,k,{x:0,y:ne-1},{x:j,y:W-1},{width:Z,height:1}),Oi.copy(P.data,k,{x:0,y:0},{x:j,y:W+ne},{width:Z,height:1}),Oi.copy(P.data,k,{x:Z-1,y:0},{x:j-1,y:W},{width:1,height:ne}),Oi.copy(P.data,k,{x:0,y:0},{x:j+Z,y:W},{width:1,height:ne})}this.image=k,this.iconPositions=u,this.patternPositions=d}addImages(t,s,u){for(const d in t){const _=t[d],v={x:0,y:0,w:_.data.width+2*_i,h:_.data.height+2*_i};u.push(v),s[d]=new kf(v,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(d)}}patchUpdatedImages(t,s){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const u in t.updatedImages)this.patchUpdatedImage(this.iconPositions[u],t.getImage(u),s),this.patchUpdatedImage(this.patternPositions[u],t.getImage(u),s)}patchUpdatedImage(t,s,u){if(!t||!s||t.version===s.version)return;t.version=s.version;const[d,_]=t.tl;u.update(s.data,void 0,{x:d,y:_})}}var vs;It("ImagePosition",kf),It("ImageAtlas",Xd),o.ai=void 0,(vs=o.ai||(o.ai={}))[vs.none=0]="none",vs[vs.horizontal=1]="horizontal",vs[vs.vertical=2]="vertical",vs[vs.horizontalOnly=3]="horizontalOnly";const yc=-17;class vc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,s){const u=new vc;return u.scale=t||1,u.fontStack=s,u}static forImage(t){const s=new vc;return s.imageName=t,s}}class rl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,s){const u=new rl;for(let d=0;d<t.sections.length;d++){const _=t.sections[d];_.image?u.addImageSection(_):u.addTextSection(_,s)}return u}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let s="";for(let u=0;u<t.length;u++){const d=t.charCodeAt(u+1)||null,_=t.charCodeAt(u-1)||null;s+=d&&Ph(d)&&!_c[t[u+1]]||_&&Ph(_)&&!_c[t[u-1]]||!_c[t[u]]?t[u]:_c[t[u]]}return s}(this.text)}trim(){let t=0;for(let u=0;u<this.text.length&&Jh[this.text.charCodeAt(u)];u++)t++;let s=this.text.length;for(let u=this.text.length-1;u>=0&&u>=t&&Jh[this.text.charCodeAt(u)];u--)s--;this.text=this.text.substring(t,s),this.sectionIndex=this.sectionIndex.slice(t,s)}substring(t,s){const u=new rl;return u.text=this.text.substring(t,s),u.sectionIndex=this.sectionIndex.slice(t,s),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,s)=>Math.max(t,this.sections[s].scale),0)}addTextSection(t,s){this.text+=t.text,this.sections.push(vc.forText(t.scale,t.fontStack||s));const u=this.sections.length-1;for(let d=0;d<t.text.length;++d)this.sectionIndex.push(u)}addImageSection(t){const s=t.image?t.image.name:"";if(s.length===0)return void pt("Can't add FormattedSection with an empty image.");const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(vc.forImage(s)),this.sectionIndex.push(this.sections.length-1)):pt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Yh(a,t,s,u,d,_,v,w,k,I,P,O,j,W,Z,ne){const fe=rl.fromFeature(a,d);let ye;O===o.ai.vertical&&fe.verticalizePunctuation();const{processBidirectionalText:Me,processStyledBidirectionalText:Ee}=gi;if(Me&&fe.sections.length===1){ye=[];const tt=Me(fe.toString(),Cf(fe,I,_,t,u,W,Z));for(const At of tt){const Rt=new rl;Rt.text=At,Rt.sections=fe.sections;for(let kt=0;kt<At.length;kt++)Rt.sectionIndex.push(0);ye.push(Rt)}}else if(Ee){ye=[];const tt=Ee(fe.text,fe.sectionIndex,Cf(fe,I,_,t,u,W,Z));for(const At of tt){const Rt=new rl;Rt.text=At[0],Rt.sectionIndex=At[1],Rt.sections=fe.sections,ye.push(Rt)}}else ye=function(tt,At){const Rt=[],kt=tt.text;let Tt=0;for(const yt of At)Rt.push(tt.substring(Tt,yt)),Tt=yt;return Tt<kt.length&&Rt.push(tt.substring(Tt,kt.length)),Rt}(fe,Cf(fe,I,_,t,u,W,Z));const Oe=[],Ge={positionedLines:Oe,text:fe.toString(),top:P[1],bottom:P[1],left:P[0],right:P[0],writingMode:O,iconsInText:!1,verticalizable:!1};return function(tt,At,Rt,kt,Tt,yt,Pt,vt,ht,Vt,Bt,nr){let Dr=0,Br=yc,ga=0,Di=0;const ri=vt==="right"?1:vt==="left"?0:.5;let la=0;for(const xa of Tt){xa.trim();const _a=xa.getMaxScale(),Va=(_a-1)*ma,ni={positionedGlyphs:[],lineOffset:0};tt.positionedLines[la]=ni;const $a=ni.positionedGlyphs;let yi=0;if(!xa.length()){Br+=yt,++la;continue}for(let ya=0;ya<xa.length();ya++){const fr=xa.getSection(ya),ja=xa.getSectionIndex(ya),Oa=xa.getCharCode(ya);let va=0,Ji=null,pn=null,mn=null,Jn=ma;const Qi=!(ht===o.ai.horizontal||!Bt&&!ql(Oa)||Bt&&(Jh[Oa]||(Ia=Oa,Ct.Arabic(Ia)||Ct["Arabic Supplement"](Ia)||Ct["Arabic Extended-A"](Ia)||Ct["Arabic Presentation Forms-A"](Ia)||Ct["Arabic Presentation Forms-B"](Ia))));if(fr.imageName){const zi=kt[fr.imageName];if(!zi)continue;mn=fr.imageName,tt.iconsInText=tt.iconsInText||!0,pn=zi.paddedRect;const wi=zi.displaySize;fr.scale=fr.scale*ma/nr,Ji={width:wi[0],height:wi[1],left:_i,top:-Wd,advance:Qi?wi[1]:wi[0]},va=Va+(ma-wi[1]*fr.scale),Jn=Ji.advance;const Qn=Qi?wi[0]*fr.scale-ma*_a:wi[1]*fr.scale-ma*_a;Qn>0&&Qn>yi&&(yi=Qn)}else{const zi=Rt[fr.fontStack],wi=zi&&zi[Oa];if(wi&&wi.rect)pn=wi.rect,Ji=wi.metrics;else{const Qn=At[fr.fontStack],Sc=Qn&&Qn[Oa];if(!Sc)continue;Ji=Sc.metrics}va=(_a-fr.scale)*ma}Qi?(tt.verticalizable=!0,$a.push({glyph:Oa,imageName:mn,x:Dr,y:Br+va,vertical:Qi,scale:fr.scale,fontStack:fr.fontStack,sectionIndex:ja,metrics:Ji,rect:pn}),Dr+=Jn*fr.scale+Vt):($a.push({glyph:Oa,imageName:mn,x:Dr,y:Br+va,vertical:Qi,scale:fr.scale,fontStack:fr.fontStack,sectionIndex:ja,metrics:Ji,rect:pn}),Dr+=Ji.advance*fr.scale+Vt)}$a.length!==0&&(ga=Math.max(Dr-Vt,ga),D_($a,0,$a.length-1,ri,yi)),Dr=0;const vi=yt*_a+yi;ni.lineOffset=Math.max(yi,Va),Br+=vi,Di=Math.max(vi,Di),++la}var Ia;const Ra=Br-yc,{horizontalAlign:ai,verticalAlign:ii}=Af(Pt);(function(xa,_a,Va,ni,$a,yi,vi,ya,fr){const ja=(_a-Va)*$a;let Oa=0;Oa=yi!==vi?-ya*ni-yc:(-ni*fr+.5)*vi;for(const va of xa)for(const Ji of va.positionedGlyphs)Ji.x+=ja,Ji.y+=Oa})(tt.positionedLines,ri,ai,ii,ga,Di,yt,Ra,Tt.length),tt.top+=-ii*Ra,tt.bottom=tt.top+Ra,tt.left+=-ai*ga,tt.right=tt.left+ga}(Ge,t,s,u,ye,v,w,k,O,I,j,ne),!function(tt){for(const At of tt)if(At.positionedGlyphs.length!==0)return!1;return!0}(Oe)&&Ge}const Jh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},P_={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Kd(a,t,s,u,d,_){if(t.imageName){const v=u[t.imageName];return v?v.displaySize[0]*t.scale*ma/_+d:0}{const v=s[t.fontStack],w=v&&v[a];return w?w.metrics.advance*t.scale+d:0}}function Yd(a,t,s,u){const d=Math.pow(a-t,2);return u?a<t?d/2:2*d:d+Math.abs(s)*s}function M_(a,t,s){let u=0;return a===10&&(u-=1e4),s&&(u+=150),a!==40&&a!==65288||(u+=50),t!==41&&t!==65289||(u+=50),u}function Jd(a,t,s,u,d,_){let v=null,w=Yd(t,s,d,_);for(const k of u){const I=Yd(t-k.x,s,d,_)+k.badness;I<=w&&(v=k,w=I)}return{index:a,x:t,priorBreak:v,badness:w}}function Qd(a){return a?Qd(a.priorBreak).concat(a.index):[]}function Cf(a,t,s,u,d,_,v){if(_!=="point")return[];if(!a)return[];const w=[],k=function(j,W,Z,ne,fe,ye){let Me=0;for(let Ee=0;Ee<j.length();Ee++){const Oe=j.getSection(Ee);Me+=Kd(j.getCharCode(Ee),Oe,ne,fe,W,ye)}return Me/Math.max(1,Math.ceil(Me/Z))}(a,t,s,u,d,v),I=a.text.indexOf("")>=0;let P=0;for(let j=0;j<a.length();j++){const W=a.getSection(j),Z=a.getCharCode(j);if(Jh[Z]||(P+=Kd(Z,W,u,d,t,v)),j<a.length()-1){const ne=!((O=Z)<11904||!(Ct["Bopomofo Extended"](O)||Ct.Bopomofo(O)||Ct["CJK Compatibility Forms"](O)||Ct["CJK Compatibility Ideographs"](O)||Ct["CJK Compatibility"](O)||Ct["CJK Radicals Supplement"](O)||Ct["CJK Strokes"](O)||Ct["CJK Symbols and Punctuation"](O)||Ct["CJK Unified Ideographs Extension A"](O)||Ct["CJK Unified Ideographs"](O)||Ct["Enclosed CJK Letters and Months"](O)||Ct["Halfwidth and Fullwidth Forms"](O)||Ct.Hiragana(O)||Ct["Ideographic Description Characters"](O)||Ct["Kangxi Radicals"](O)||Ct["Katakana Phonetic Extensions"](O)||Ct.Katakana(O)||Ct["Vertical Forms"](O)||Ct["Yi Radicals"](O)||Ct["Yi Syllables"](O)));(P_[Z]||ne||W.imageName)&&w.push(Jd(j+1,P,k,w,M_(Z,a.getCharCode(j+1),ne&&I),!1))}}var O;return Qd(Jd(a.length(),P,k,w,0,!0))}function Af(a){let t=.5,s=.5;switch(a){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:t,verticalAlign:s}}function D_(a,t,s,u,d){if(!u&&!d)return;const _=a[s],v=(a[s].x+_.metrics.advance*_.scale)*u;for(let w=t;w<=s;w++)a[w].x-=v,a[w].y+=d}function L_(a,t,s){const{horizontalAlign:u,verticalAlign:d}=Af(s),_=t[0]-a.displaySize[0]*u,v=t[1]-a.displaySize[1]*d;return{image:a,top:v,bottom:v+a.displaySize[1],left:_,right:_+a.displaySize[0]}}function ep(a,t,s,u,d,_){const v=a.image;let w;if(v.content){const fe=v.content,ye=v.pixelRatio||1;w=[fe[0]/ye,fe[1]/ye,v.displaySize[0]-fe[2]/ye,v.displaySize[1]-fe[3]/ye]}const k=t.left*_,I=t.right*_;let P,O,j,W;s==="width"||s==="both"?(W=d[0]+k-u[3],O=d[0]+I+u[1]):(W=d[0]+(k+I-v.displaySize[0])/2,O=W+v.displaySize[0]);const Z=t.top*_,ne=t.bottom*_;return s==="height"||s==="both"?(P=d[1]+Z-u[0],j=d[1]+ne+u[2]):(P=d[1]+(Z+ne-v.displaySize[1])/2,j=P+v.displaySize[1]),{image:v,top:P,right:O,bottom:j,left:W,collisionPadding:w}}const wc=255,Pn=128,ws=wc*Pn;function tp(a,t){const{expression:s}=t;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new Pr(a+1))};if(s.kind==="source")return{kind:"source"};{const{zoomStops:u,interpolationType:d}=s;let _=0;for(;_<u.length&&u[_]<=a;)_++;_=Math.max(0,_-1);let v=_;for(;v<u.length&&u[v]<a+1;)v++;v=Math.min(u.length-1,v);const w=u[_],k=u[v];return s.kind==="composite"?{kind:"composite",minZoom:w,maxZoom:k,interpolationType:d}:{kind:"camera",minZoom:w,maxZoom:k,minSize:s.evaluate(new Pr(w)),maxSize:s.evaluate(new Pr(k)),interpolationType:d}}}function If(a,t,s){let u="never";const d=a.get(t);return d?u=d:a.get(s)&&(u="always"),u}const R_=ys.VectorTileFeature.types,O_=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Qh(a,t,s,u,d,_,v,w,k,I,P,O,j){const W=w?Math.min(ws,Math.round(w[0])):0,Z=w?Math.min(ws,Math.round(w[1])):0;a.emplaceBack(t,s,Math.round(32*u),Math.round(32*d),_,v,(W<<1)+(k?1:0),Z,16*I,16*P,256*O,256*j)}function Ff(a,t,s){a.emplaceBack(t.x,t.y,s),a.emplaceBack(t.x,t.y,s),a.emplaceBack(t.x,t.y,s),a.emplaceBack(t.x,t.y,s)}function B_(a){for(const t of a.sections)if(tf(t.text))return!0;return!1}class Pf{constructor(t){this.layoutVertexArray=new or,this.indexArray=new Ca,this.programConfigurations=t,this.segments=new Mr,this.dynamicLayoutVertexArray=new ar,this.opacityVertexArray=new cr,this.hasVisibleVertices=!1,this.placedSymbolArray=new Ie}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,s,u,d){this.isEmpty()||(u&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,p_.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,m_.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,O_,!0),this.opacityVertexBuffer.itemSize=1),(u||d)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}It("SymbolBuffers",Pf);class Mf{constructor(t,s,u){this.layoutVertexArray=new t,this.layoutAttributes=s,this.indexArray=new u,this.segments=new Mr,this.collisionVertexArray=new Ir}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,g_.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}It("CollisionBuffers",Mf);class al{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(v=>v.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=cf([]),this.placementViewportMatrix=cf([]);const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=tp(this.zoom,s["text-size"]),this.iconSizeData=tp(this.zoom,s["icon-size"]);const u=this.layers[0].layout,d=u.get("symbol-sort-key"),_=u.get("symbol-z-order");this.canOverlap=If(u,"text-overlap","text-allow-overlap")!=="never"||If(u,"icon-overlap","icon-allow-overlap")!=="never"||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&!d.isConstant(),this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,u.get("symbol-placement")==="point"&&(this.writingModes=u.get("text-writing-mode").map(v=>o.ai[v])),this.stateDependentLayerIds=this.layers.filter(v=>v.isStateDependent()).map(v=>v.id),this.sourceID=t.sourceID}createArrays(){this.text=new Pf(new dn(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new Pf(new dn(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new Pe,this.lineVertexArray=new He,this.symbolInstances=new ge,this.textAnchorOffsets=new et}calculateGlyphDependencies(t,s,u,d,_){for(let v=0;v<t.length;v++)if(s[t.charCodeAt(v)]=!0,(u||d)&&_){const w=_c[t.charAt(v)];w&&(s[w.charCodeAt(0)]=!0)}}populate(t,s,u){const d=this.layers[0],_=d.layout,v=_.get("text-font"),w=_.get("text-field"),k=_.get("icon-image"),I=(w.value.kind!=="constant"||w.value.value instanceof Xr&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(v.value.kind!=="constant"||v.value.value.length>0),P=k.value.kind!=="constant"||!!k.value.value||Object.keys(k.parameters).length>0,O=_.get("symbol-sort-key");if(this.features=[],!I&&!P)return;const j=s.iconDependencies,W=s.glyphDependencies,Z=s.availableImages,ne=new Pr(this.zoom);for(const{feature:fe,id:ye,index:Me,sourceLayerIndex:Ee}of t){const Oe=d._featureFilter.needGeometry,Ge=eo(fe,Oe);if(!d._featureFilter.filter(ne,Ge,u))continue;let tt,At;if(Oe||(Ge.geometry=Qs(fe)),I){const kt=d.getValueAndResolveTokens("text-field",Ge,u,Z),Tt=Xr.factory(kt);B_(Tt)&&(this.hasRTLText=!0),(!this.hasRTLText||Jl()==="unavailable"||this.hasRTLText&&gi.isParsed())&&(tt=__(Tt,d,Ge))}if(P){const kt=d.getValueAndResolveTokens("icon-image",Ge,u,Z);At=kt instanceof ka?kt:ka.fromString(kt)}if(!tt&&!At)continue;const Rt=this.sortFeaturesByKey?O.evaluate(Ge,{},u):void 0;if(this.features.push({id:ye,text:tt,icon:At,index:Me,sourceLayerIndex:Ee,geometry:Ge.geometry,properties:fe.properties,type:R_[fe.type],sortKey:Rt}),At&&(j[At.name]=!0),tt){const kt=v.evaluate(Ge,{},u).join(","),Tt=_.get("text-rotation-alignment")!=="viewport"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(o.ai.vertical)>=0;for(const yt of tt.sections)if(yt.image)j[yt.image.name]=!0;else{const Pt=Gl(tt.toString()),vt=yt.fontStack||kt,ht=W[vt]=W[vt]||{};this.calculateGlyphDependencies(yt.text,ht,Tt,this.allowVerticalPlacement,Pt)}}}_.get("symbol-placement")==="line"&&(this.features=function(fe){const ye={},Me={},Ee=[];let Oe=0;function Ge(kt){Ee.push(fe[kt]),Oe++}function tt(kt,Tt,yt){const Pt=Me[kt];return delete Me[kt],Me[Tt]=Pt,Ee[Pt].geometry[0].pop(),Ee[Pt].geometry[0]=Ee[Pt].geometry[0].concat(yt[0]),Pt}function At(kt,Tt,yt){const Pt=ye[Tt];return delete ye[Tt],ye[kt]=Pt,Ee[Pt].geometry[0].shift(),Ee[Pt].geometry[0]=yt[0].concat(Ee[Pt].geometry[0]),Pt}function Rt(kt,Tt,yt){const Pt=yt?Tt[0][Tt[0].length-1]:Tt[0][0];return`${kt}:${Pt.x}:${Pt.y}`}for(let kt=0;kt<fe.length;kt++){const Tt=fe[kt],yt=Tt.geometry,Pt=Tt.text?Tt.text.toString():null;if(!Pt){Ge(kt);continue}const vt=Rt(Pt,yt),ht=Rt(Pt,yt,!0);if(vt in Me&&ht in ye&&Me[vt]!==ye[ht]){const Vt=At(vt,ht,yt),Bt=tt(vt,ht,Ee[Vt].geometry);delete ye[vt],delete Me[ht],Me[Rt(Pt,Ee[Bt].geometry,!0)]=Bt,Ee[Vt].geometry=null}else vt in Me?tt(vt,ht,yt):ht in ye?At(vt,ht,yt):(Ge(kt),ye[vt]=Oe-1,Me[ht]=Oe-1)}return Ee.filter(kt=>kt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((fe,ye)=>fe.sortKey-ye.sortKey)}update(t,s,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,s,this.layers,u),this.icon.programConfigurations.updatePaintArrays(t,s,this.layers,u))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,s){const u=this.lineVertexArray.length;if(t.segment!==void 0){let d=t.dist(s[t.segment+1]),_=t.dist(s[t.segment]);const v={};for(let w=t.segment+1;w<s.length;w++)v[w]={x:s[w].x,y:s[w].y,tileUnitDistanceFromAnchor:d},w<s.length-1&&(d+=s[w+1].dist(s[w]));for(let w=t.segment||0;w>=0;w--)v[w]={x:s[w].x,y:s[w].y,tileUnitDistanceFromAnchor:_},w>0&&(_+=s[w-1].dist(s[w]));for(let w=0;w<s.length;w++){const k=v[w];this.lineVertexArray.emplaceBack(k.x,k.y,k.tileUnitDistanceFromAnchor)}}return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(t,s,u,d,_,v,w,k,I,P,O,j){const W=t.indexArray,Z=t.layoutVertexArray,ne=t.segments.prepareSegment(4*s.length,Z,W,this.canOverlap?v.sortKey:void 0),fe=this.glyphOffsetArray.length,ye=ne.vertexLength,Me=this.allowVerticalPlacement&&w===o.ai.vertical?Math.PI/2:0,Ee=v.text&&v.text.sections;for(let Oe=0;Oe<s.length;Oe++){const{tl:Ge,tr:tt,bl:At,br:Rt,tex:kt,pixelOffsetTL:Tt,pixelOffsetBR:yt,minFontScaleX:Pt,minFontScaleY:vt,glyphOffset:ht,isSDF:Vt,sectionIndex:Bt}=s[Oe],nr=ne.vertexLength,Dr=ht[1];Qh(Z,k.x,k.y,Ge.x,Dr+Ge.y,kt.x,kt.y,u,Vt,Tt.x,Tt.y,Pt,vt),Qh(Z,k.x,k.y,tt.x,Dr+tt.y,kt.x+kt.w,kt.y,u,Vt,yt.x,Tt.y,Pt,vt),Qh(Z,k.x,k.y,At.x,Dr+At.y,kt.x,kt.y+kt.h,u,Vt,Tt.x,yt.y,Pt,vt),Qh(Z,k.x,k.y,Rt.x,Dr+Rt.y,kt.x+kt.w,kt.y+kt.h,u,Vt,yt.x,yt.y,Pt,vt),Ff(t.dynamicLayoutVertexArray,k,Me),W.emplaceBack(nr,nr+1,nr+2),W.emplaceBack(nr+1,nr+2,nr+3),ne.vertexLength+=4,ne.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ht[0]),Oe!==s.length-1&&Bt===s[Oe+1].sectionIndex||t.programConfigurations.populatePaintArrays(Z.length,v,v.index,{},j,Ee&&Ee[Bt])}t.placedSymbolArray.emplaceBack(k.x,k.y,fe,this.glyphOffsetArray.length-fe,ye,I,P,k.segment,u?u[0]:0,u?u[1]:0,d[0],d[1],w,0,!1,0,O)}_addCollisionDebugVertex(t,s,u,d,_,v){return s.emplaceBack(0,0),t.emplaceBack(u.x,u.y,d,_,Math.round(v.x),Math.round(v.y))}addCollisionDebugVertices(t,s,u,d,_,v,w){const k=_.segments.prepareSegment(4,_.layoutVertexArray,_.indexArray),I=k.vertexLength,P=_.layoutVertexArray,O=_.collisionVertexArray,j=w.anchorX,W=w.anchorY;this._addCollisionDebugVertex(P,O,v,j,W,new L(t,s)),this._addCollisionDebugVertex(P,O,v,j,W,new L(u,s)),this._addCollisionDebugVertex(P,O,v,j,W,new L(u,d)),this._addCollisionDebugVertex(P,O,v,j,W,new L(t,d)),k.vertexLength+=4;const Z=_.indexArray;Z.emplaceBack(I,I+1),Z.emplaceBack(I+1,I+2),Z.emplaceBack(I+2,I+3),Z.emplaceBack(I+3,I),k.primitiveLength+=4}addDebugCollisionBoxes(t,s,u,d){for(let _=t;_<s;_++){const v=this.collisionBoxArray.get(_);this.addCollisionDebugVertices(v.x1,v.y1,v.x2,v.y2,d?this.textCollisionBox:this.iconCollisionBox,v.anchorPoint,u)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Mf(Yr,Nd.members,da),this.iconCollisionBox=new Mf(Yr,Nd.members,da);for(let t=0;t<this.symbolInstances.length;t++){const s=this.symbolInstances.get(t);this.addDebugCollisionBoxes(s.textBoxStartIndex,s.textBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.iconBoxStartIndex,s.iconBoxEndIndex,s,!1),this.addDebugCollisionBoxes(s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s,!1)}}_deserializeCollisionBoxesForSymbol(t,s,u,d,_,v,w,k,I){const P={};for(let O=s;O<u;O++){const j=t.get(O);P.textBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},P.textFeatureIndex=j.featureIndex;break}for(let O=d;O<_;O++){const j=t.get(O);P.verticalTextBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},P.verticalTextFeatureIndex=j.featureIndex;break}for(let O=v;O<w;O++){const j=t.get(O);P.iconBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},P.iconFeatureIndex=j.featureIndex;break}for(let O=k;O<I;O++){const j=t.get(O);P.verticalIconBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},P.verticalIconFeatureIndex=j.featureIndex;break}return P}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const u=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,s){const u=t.placedSymbolArray.get(s),d=u.vertexStartIndex+4*u.numGlyphs;for(let _=u.vertexStartIndex;_<d;_+=4)t.indexArray.emplaceBack(_,_+1,_+2),t.indexArray.emplaceBack(_+1,_+2,_+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const s=Math.sin(t),u=Math.cos(t),d=[],_=[],v=[];for(let w=0;w<this.symbolInstances.length;++w){v.push(w);const k=this.symbolInstances.get(w);d.push(0|Math.round(s*k.anchorX+u*k.anchorY)),_.push(k.featureIndex)}return v.sort((w,k)=>d[w]-d[k]||_[k]-_[w]),v}addToSortKeyRanges(t,s){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===s?u.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const u=this.symbolInstances.get(s);this.featureSortOrder.push(u.featureIndex),[u.rightJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.leftJustifiedTextSymbolIndex].forEach((d,_,v)=>{d>=0&&v.indexOf(d)===_&&this.addIndicesForPlacedSymbol(this.text,d)}),u.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,u.verticalPlacedTextSymbolIndex),u.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.placedIconSymbolIndex),u.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let rp,ap;It("SymbolBucket",al,{omit:["layers","collisionBoxArray","features","compareText"]}),al.MAX_GLYPHS=65535,al.addDynamicAttributes=Ff;var Df={get paint(){return ap=ap||new ra({"icon-opacity":new Gt(Xe.paint_symbol["icon-opacity"]),"icon-color":new Gt(Xe.paint_symbol["icon-color"]),"icon-halo-color":new Gt(Xe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Gt(Xe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Gt(Xe.paint_symbol["icon-halo-blur"]),"icon-translate":new zt(Xe.paint_symbol["icon-translate"]),"icon-translate-anchor":new zt(Xe.paint_symbol["icon-translate-anchor"]),"text-opacity":new Gt(Xe.paint_symbol["text-opacity"]),"text-color":new Gt(Xe.paint_symbol["text-color"],{runtimeType:Lr,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new Gt(Xe.paint_symbol["text-halo-color"]),"text-halo-width":new Gt(Xe.paint_symbol["text-halo-width"]),"text-halo-blur":new Gt(Xe.paint_symbol["text-halo-blur"]),"text-translate":new zt(Xe.paint_symbol["text-translate"]),"text-translate-anchor":new zt(Xe.paint_symbol["text-translate-anchor"])})},get layout(){return rp=rp||new ra({"symbol-placement":new zt(Xe.layout_symbol["symbol-placement"]),"symbol-spacing":new zt(Xe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new zt(Xe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Gt(Xe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new zt(Xe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new zt(Xe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new zt(Xe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new zt(Xe.layout_symbol["icon-ignore-placement"]),"icon-optional":new zt(Xe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new zt(Xe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Gt(Xe.layout_symbol["icon-size"]),"icon-text-fit":new zt(Xe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new zt(Xe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Gt(Xe.layout_symbol["icon-image"]),"icon-rotate":new Gt(Xe.layout_symbol["icon-rotate"]),"icon-padding":new Gt(Xe.layout_symbol["icon-padding"]),"icon-keep-upright":new zt(Xe.layout_symbol["icon-keep-upright"]),"icon-offset":new Gt(Xe.layout_symbol["icon-offset"]),"icon-anchor":new Gt(Xe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new zt(Xe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new zt(Xe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new zt(Xe.layout_symbol["text-rotation-alignment"]),"text-field":new Gt(Xe.layout_symbol["text-field"]),"text-font":new Gt(Xe.layout_symbol["text-font"]),"text-size":new Gt(Xe.layout_symbol["text-size"]),"text-max-width":new Gt(Xe.layout_symbol["text-max-width"]),"text-line-height":new zt(Xe.layout_symbol["text-line-height"]),"text-letter-spacing":new Gt(Xe.layout_symbol["text-letter-spacing"]),"text-justify":new Gt(Xe.layout_symbol["text-justify"]),"text-radial-offset":new Gt(Xe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new zt(Xe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Gt(Xe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Gt(Xe.layout_symbol["text-anchor"]),"text-max-angle":new zt(Xe.layout_symbol["text-max-angle"]),"text-writing-mode":new zt(Xe.layout_symbol["text-writing-mode"]),"text-rotate":new Gt(Xe.layout_symbol["text-rotate"]),"text-padding":new zt(Xe.layout_symbol["text-padding"]),"text-keep-upright":new zt(Xe.layout_symbol["text-keep-upright"]),"text-transform":new Gt(Xe.layout_symbol["text-transform"]),"text-offset":new Gt(Xe.layout_symbol["text-offset"]),"text-allow-overlap":new zt(Xe.layout_symbol["text-allow-overlap"]),"text-overlap":new zt(Xe.layout_symbol["text-overlap"]),"text-ignore-placement":new zt(Xe.layout_symbol["text-ignore-placement"]),"text-optional":new zt(Xe.layout_symbol["text-optional"])})}};class ip{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:tr,this.defaultValue=t}evaluate(t){if(t.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(t.formattedSection))return s.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}It("FormatSectionOverride",ip,{omit:["defaultValue"]});class eu extends Pi{constructor(t){super(t,Df)}recalculate(t,s){if(super.recalculate(t,s),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const u=this.layout.get("text-writing-mode");if(u){const d=[];for(const _ of u)d.indexOf(_)<0&&d.push(_);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,s,u,d){const _=this.layout.get(t).evaluate(s,{},u,d),v=this._unevaluatedLayout._values[t];return v.isDataDriven()||Bo(v.value)||!_?_:function(w,k){return k.replace(/{([^{}]+)}/g,(I,P)=>w&&P in w?String(w[P]):"")}(s.properties,_)}createBucket(t){return new al(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of Df.paint.overridableProperties){if(!eu.hasPaintOverride(this.layout,t))continue;const s=this.paint.get(t),u=new ip(s),d=new zl(u,s.property.specification);let _=null;_=s.value.kind==="constant"||s.value.kind==="source"?new Nl("source",d):new No("composite",d,s.value.zoomStops),this.paint._values[t]=new Na(s.property,_,s.parameters)}}_handleOverridablePaintPropertyUpdate(t,s,u){return!(!this.layout||s.isDataDriven()||u.isDataDriven())&&eu.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,s){const u=t.get("text-field"),d=Df.paint.properties[s];let _=!1;const v=w=>{for(const k of w)if(d.overrides&&d.overrides.hasOverride(k))return void(_=!0)};if(u.value.kind==="constant"&&u.value.value instanceof Xr)v(u.value.value.sections);else if(u.value.kind==="source"){const w=I=>{_||(I instanceof Nn&&Nr(I.value)===le?v(I.value.sections):I instanceof Oo?v(I.sections):I.eachChild(w))},k=u.value;k._styleExpression&&w(k._styleExpression.expression)}return _}}let np;var z_={get paint(){return np=np||new ra({"background-color":new zt(Xe.paint_background["background-color"]),"background-pattern":new ec(Xe.paint_background["background-pattern"]),"background-opacity":new zt(Xe.paint_background["background-opacity"])})}};class N_ extends Pi{constructor(t){super(t,z_)}}let sp;var U_={get paint(){return sp=sp||new ra({"raster-opacity":new zt(Xe.paint_raster["raster-opacity"]),"raster-hue-rotate":new zt(Xe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new zt(Xe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new zt(Xe.paint_raster["raster-brightness-max"]),"raster-saturation":new zt(Xe.paint_raster["raster-saturation"]),"raster-contrast":new zt(Xe.paint_raster["raster-contrast"]),"raster-resampling":new zt(Xe.paint_raster["raster-resampling"]),"raster-fade-duration":new zt(Xe.paint_raster["raster-fade-duration"])})}};class V_ extends Pi{constructor(t){super(t,U_)}}class $_ extends Pi{constructor(t){super(t,{}),this.onAdd=s=>{this.implementation.onAdd&&this.implementation.onAdd(s,s.painter.context.gl)},this.onRemove=s=>{this.implementation.onRemove&&this.implementation.onRemove(s,s.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class j_{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Lf=63710088e-1;class bs{constructor(t,s){if(isNaN(t)||isNaN(s))throw new Error(`Invalid LngLat object: (${t}, ${s})`);if(this.lng=+t,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new bs(te(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const s=Math.PI/180,u=this.lat*s,d=t.lat*s,_=Math.sin(u)*Math.sin(d)+Math.cos(u)*Math.cos(d)*Math.cos((t.lng-this.lng)*s);return Lf*Math.acos(Math.min(_,1))}static convert(t){if(t instanceof bs)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new bs(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new bs(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const op=2*Math.PI*Lf;function lp(a){return op*Math.cos(a*Math.PI/180)}function cp(a){return(180+a)/360}function hp(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function up(a,t){return a/lp(t)}function fp(a){return 360*a-180}function Rf(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}class tu{constructor(t,s,u=0){this.x=+t,this.y=+s,this.z=+u}static fromLngLat(t,s=0){const u=bs.convert(t);return new tu(cp(u.lng),hp(u.lat),up(s,u.lat))}toLngLat(){return new bs(fp(this.x),Rf(this.y))}toAltitude(){return this.z*lp(Rf(this.y))}meterInMercatorCoordinateUnits(){return 1/op*(t=Rf(this.y),1/Math.cos(t*Math.PI/180));var t}}function dp(a,t,s){var u=2*Math.PI*6378137/256/Math.pow(2,s);return[a*u-2*Math.PI*6378137/2,t*u-2*Math.PI*6378137/2]}class Of{constructor(t,s,u){if(t<0||t>25||u<0||u>=Math.pow(2,t)||s<0||s>=Math.pow(2,t))throw new Error(`x=${s}, y=${u}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=s,this.y=u,this.key=bc(0,t,t,s,u)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,s,u){const d=(v=this.y,w=this.z,k=dp(256*(_=this.x),256*(v=Math.pow(2,w)-v-1),w),I=dp(256*(_+1),256*(v+1),w),k[0]+","+k[1]+","+I[0]+","+I[1]);var _,v,w,k,I;const P=function(O,j,W){let Z,ne="";for(let fe=O;fe>0;fe--)Z=1<<fe-1,ne+=(j&Z?1:0)+(W&Z?2:0);return ne}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(u==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,s>1?"@2x":"").replace(/{quadkey}/g,P).replace(/{bbox-epsg-3857}/g,d)}isChildOf(t){const s=this.z-t.z;return s>0&&t.x===this.x>>s&&t.y===this.y>>s}getTilePoint(t){const s=Math.pow(2,this.z);return new L((t.x*s-this.x)*oa,(t.y*s-this.y)*oa)}toString(){return`${this.z}/${this.x}/${this.y}`}}class pp{constructor(t,s){this.wrap=t,this.canonical=s,this.key=bc(t,s.z,s.z,s.x,s.y)}}class Bi{constructor(t,s,u,d,_){if(t<u)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${u}`);this.overscaledZ=t,this.wrap=s,this.canonical=new Of(u,+d,+_),this.key=bc(s,t,u,d,_)}clone(){return new Bi(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-t;return t>this.canonical.z?new Bi(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Bi(t,this.wrap,t,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(t,s){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const u=this.canonical.z-t;return t>this.canonical.z?bc(this.wrap*+s,t,this.canonical.z,this.canonical.x,this.canonical.y):bc(this.wrap*+s,t,t,this.canonical.x>>u,this.canonical.y>>u)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const s=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>s&&t.canonical.y===this.canonical.y>>s}children(t){if(this.overscaledZ>=t)return[new Bi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,u=2*this.canonical.x,d=2*this.canonical.y;return[new Bi(s,this.wrap,s,u,d),new Bi(s,this.wrap,s,u+1,d),new Bi(s,this.wrap,s,u,d+1),new Bi(s,this.wrap,s,u+1,d+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Bi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Bi(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new pp(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new tu(t.x-this.wrap,t.y))}}function bc(a,t,s,u,d){(a*=2)<0&&(a=-1*a-1);const _=1<<s;return(_*_*a+_*d+u).toString(36)+s.toString(36)+t.toString(36)}It("CanonicalTileID",Of),It("OverscaledTileID",Bi,{omit:["posMatrix"]});class mp{constructor(t,s,u,d=1,_=1,v=1,w=0){if(this.uid=t,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(u&&!["mapbox","terrarium","custom"].includes(u))return void pt(`"${u}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=s.height;const k=this.dim=s.height-2;switch(this.data=new Uint32Array(s.data.buffer),u){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=d,this.greenFactor=_,this.blueFactor=v,this.baseShift=w;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let I=0;I<k;I++)this.data[this._idx(-1,I)]=this.data[this._idx(0,I)],this.data[this._idx(k,I)]=this.data[this._idx(k-1,I)],this.data[this._idx(I,-1)]=this.data[this._idx(I,0)],this.data[this._idx(I,k)]=this.data[this._idx(I,k-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(k,-1)]=this.data[this._idx(k-1,0)],this.data[this._idx(-1,k)]=this.data[this._idx(0,k-1)],this.data[this._idx(k,k)]=this.data[this._idx(k-1,k-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let I=0;I<k;I++)for(let P=0;P<k;P++){const O=this.get(I,P);O>this.max&&(this.max=O),O<this.min&&(this.min=O)}}get(t,s){const u=new Uint8Array(this.data.buffer),d=4*this._idx(t,s);return this.unpack(u[d],u[d+1],u[d+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,s){if(t<-1||t>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(t+1)}unpack(t,s,u){return t*this.redFactor+s*this.greenFactor+u*this.blueFactor-this.baseShift}getPixels(){return new Oi({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,s,u){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let d=s*this.dim,_=s*this.dim+this.dim,v=u*this.dim,w=u*this.dim+this.dim;switch(s){case-1:d=_-1;break;case 1:_=d+1}switch(u){case-1:v=w-1;break;case 1:w=v+1}const k=-s*this.dim,I=-u*this.dim;for(let P=v;P<w;P++)for(let O=d;O<_;O++)this.data[this._idx(O,P)]=t.data[this._idx(O+k,P+I)]}}It("DEMData",mp);class gp{constructor(t){this._stringToNumber={},this._numberToString=[];for(let s=0;s<t.length;s++){const u=t[s];this._stringToNumber[u]=s,this._numberToString[s]=u}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class xp{constructor(t,s,u,d,_){this.type="Feature",this._vectorTileFeature=t,t._z=s,t._x=u,t._y=d,this.properties=t.properties,this.id=_}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const s in this)s!=="_geometry"&&s!=="_vectorTileFeature"&&(t[s]=this[s]);return t}}class _p{constructor(t,s){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new ps(oa,16,0),this.grid3D=new ps(oa,16,0),this.featureIndexArray=new nt,this.promoteId=s}insert(t,s,u,d,_,v){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,d,_);const k=v?this.grid3D:this.grid;for(let I=0;I<s.length;I++){const P=s[I],O=[1/0,1/0,-1/0,-1/0];for(let j=0;j<P.length;j++){const W=P[j];O[0]=Math.min(O[0],W.x),O[1]=Math.min(O[1],W.y),O[2]=Math.max(O[2],W.x),O[3]=Math.max(O[3],W.y)}O[0]<oa&&O[1]<oa&&O[2]>=0&&O[3]>=0&&k.insert(w,O[0],O[1],O[2],O[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new ys.VectorTile(new Ef(this.rawTileData)).layers,this.sourceLayerCoder=new gp(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,s,u,d){this.loadVTLayers();const _=t.params||{},v=oa/t.tileSize/t.scale,w=Vl(_.filter),k=t.queryGeometry,I=t.queryPadding*v,P=vp(k),O=this.grid.query(P.minX-I,P.minY-I,P.maxX+I,P.maxY+I),j=vp(t.cameraQueryGeometry),W=this.grid3D.query(j.minX-I,j.minY-I,j.maxX+I,j.maxY+I,(fe,ye,Me,Ee)=>function(Oe,Ge,tt,At,Rt){for(const Tt of Oe)if(Ge<=Tt.x&&tt<=Tt.y&&At>=Tt.x&&Rt>=Tt.y)return!0;const kt=[new L(Ge,tt),new L(Ge,Rt),new L(At,Rt),new L(At,tt)];if(Oe.length>2){for(const Tt of kt)if(Ko(Oe,Tt))return!0}for(let Tt=0;Tt<Oe.length-1;Tt++)if(wx(Oe[Tt],Oe[Tt+1],kt))return!0;return!1}(t.cameraQueryGeometry,fe-I,ye-I,Me+I,Ee+I));for(const fe of W)O.push(fe);O.sort(G_);const Z={};let ne;for(let fe=0;fe<O.length;fe++){const ye=O[fe];if(ye===ne)continue;ne=ye;const Me=this.featureIndexArray.get(ye);let Ee=null;this.loadMatchingFeature(Z,Me.bucketIndex,Me.sourceLayerIndex,Me.featureIndex,w,_.layers,_.availableImages,s,u,d,(Oe,Ge,tt)=>(Ee||(Ee=Qs(Oe)),Ge.queryIntersectsFeature(k,Oe,tt,Ee,this.z,t.transform,v,t.pixelPosMatrix)))}return Z}loadMatchingFeature(t,s,u,d,_,v,w,k,I,P,O){const j=this.bucketLayerIDs[s];if(v&&!function(fe,ye){for(let Me=0;Me<fe.length;Me++)if(ye.indexOf(fe[Me])>=0)return!0;return!1}(v,j))return;const W=this.sourceLayerCoder.decode(u),Z=this.vtLayers[W].feature(d);if(_.needGeometry){const fe=eo(Z,!0);if(!_.filter(new Pr(this.tileID.overscaledZ),fe,this.tileID.canonical))return}else if(!_.filter(new Pr(this.tileID.overscaledZ),Z))return;const ne=this.getId(Z,W);for(let fe=0;fe<j.length;fe++){const ye=j[fe];if(v&&v.indexOf(ye)<0)continue;const Me=k[ye];if(!Me)continue;let Ee={};ne&&P&&(Ee=P.getState(Me.sourceLayer||"_geojsonTileLayer",ne));const Oe=Be({},I[ye]);Oe.paint=yp(Oe.paint,Me.paint,Z,Ee,w),Oe.layout=yp(Oe.layout,Me.layout,Z,Ee,w);const Ge=!O||O(Z,Me,Ee);if(!Ge)continue;const tt=new xp(Z,this.z,this.x,this.y,ne);tt.layer=Oe;let At=t[ye];At===void 0&&(At=t[ye]=[]),At.push({featureIndex:d,feature:tt,intersectionZ:Ge})}}lookupSymbolFeatures(t,s,u,d,_,v,w,k){const I={};this.loadVTLayers();const P=Vl(_);for(const O of t)this.loadMatchingFeature(I,u,d,O,P,v,w,k,s);return I}hasLayer(t){for(const s of this.bucketLayerIDs)for(const u of s)if(t===u)return!0;return!1}getId(t,s){let u=t.id;return this.promoteId&&(u=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[s]],typeof u=="boolean"&&(u=Number(u))),u}}function yp(a,t,s,u,d){return Ue(a,(_,v)=>{const w=t instanceof Zo?t.get(v):null;return w&&w.evaluate?w.evaluate(s,u,d):w})}function vp(a){let t=1/0,s=1/0,u=-1/0,d=-1/0;for(const _ of a)t=Math.min(t,_.x),s=Math.min(s,_.y),u=Math.max(u,_.x),d=Math.max(d,_.y);return{minX:t,minY:s,maxX:u,maxY:d}}function G_(a,t){return t-a}function wp(a,t,s,u,d){const _=[];for(let v=0;v<a.length;v++){const w=a[v];let k;for(let I=0;I<w.length-1;I++){let P=w[I],O=w[I+1];P.x<t&&O.x<t||(P.x<t?P=new L(t,P.y+(t-P.x)/(O.x-P.x)*(O.y-P.y))._round():O.x<t&&(O=new L(t,P.y+(t-P.x)/(O.x-P.x)*(O.y-P.y))._round()),P.y<s&&O.y<s||(P.y<s?P=new L(P.x+(s-P.y)/(O.y-P.y)*(O.x-P.x),s)._round():O.y<s&&(O=new L(P.x+(s-P.y)/(O.y-P.y)*(O.x-P.x),s)._round()),P.x>=u&&O.x>=u||(P.x>=u?P=new L(u,P.y+(u-P.x)/(O.x-P.x)*(O.y-P.y))._round():O.x>=u&&(O=new L(u,P.y+(u-P.x)/(O.x-P.x)*(O.y-P.y))._round()),P.y>=d&&O.y>=d||(P.y>=d?P=new L(P.x+(d-P.y)/(O.y-P.y)*(O.x-P.x),d)._round():O.y>=d&&(O=new L(P.x+(d-P.y)/(O.y-P.y)*(O.x-P.x),d)._round()),k&&P.equals(k[k.length-1])||(k=[P],_.push(k)),k.push(O)))))}}return _}It("FeatureIndex",_p,{omit:["rawTileData","sourceLayerCoder"]});class Ts extends L{constructor(t,s,u,d){super(t,s),this.angle=u,d!==void 0&&(this.segment=d)}clone(){return new Ts(this.x,this.y,this.angle,this.segment)}}function bp(a,t,s,u,d){if(t.segment===void 0||s===0)return!0;let _=t,v=t.segment+1,w=0;for(;w>-s/2;){if(v--,v<0)return!1;w-=a[v].dist(_),_=a[v]}w+=a[v].dist(a[v+1]),v++;const k=[];let I=0;for(;w<s/2;){const P=a[v],O=a[v+1];if(!O)return!1;let j=a[v-1].angleTo(P)-P.angleTo(O);for(j=Math.abs((j+3*Math.PI)%(2*Math.PI)-Math.PI),k.push({distance:w,angleDelta:j}),I+=j;w-k[0].distance>u;)I-=k.shift().angleDelta;if(I>d)return!1;v++,w+=P.dist(O)}return!0}function Tp(a){let t=0;for(let s=0;s<a.length-1;s++)t+=a[s].dist(a[s+1]);return t}function Ep(a,t,s){return a?.6*t*s:0}function Sp(a,t){return Math.max(a?a.right-a.left:0,t?t.right-t.left:0)}function H_(a,t,s,u,d,_){const v=Ep(s,d,_),w=Sp(s,u)*_;let k=0;const I=Tp(a)/2;for(let P=0;P<a.length-1;P++){const O=a[P],j=a[P+1],W=O.dist(j);if(k+W>I){const Z=(I-k)/W,ne=di.number(O.x,j.x,Z),fe=di.number(O.y,j.y,Z),ye=new Ts(ne,fe,j.angleTo(O),P);return ye._round(),!v||bp(a,ye,w,v,t)?ye:void 0}k+=W}}function q_(a,t,s,u,d,_,v,w,k){const I=Ep(u,_,v),P=Sp(u,d),O=P*v,j=a[0].x===0||a[0].x===k||a[0].y===0||a[0].y===k;return t-O<t/4&&(t=O+t/4),kp(a,j?t/2*w%t:(P/2+2*_)*v*w%t,t,I,s,O,j,!1,k)}function kp(a,t,s,u,d,_,v,w,k){const I=_/2,P=Tp(a);let O=0,j=t-s,W=[];for(let Z=0;Z<a.length-1;Z++){const ne=a[Z],fe=a[Z+1],ye=ne.dist(fe),Me=fe.angleTo(ne);for(;j+s<O+ye;){j+=s;const Ee=(j-O)/ye,Oe=di.number(ne.x,fe.x,Ee),Ge=di.number(ne.y,fe.y,Ee);if(Oe>=0&&Oe<k&&Ge>=0&&Ge<k&&j-I>=0&&j+I<=P){const tt=new Ts(Oe,Ge,Me,Z);tt._round(),u&&!bp(a,tt,_,u,d)||W.push(tt)}}O+=ye}return w||W.length||v||(W=kp(a,O/2,s,u,d,_,v,!0,k)),W}It("Anchor",Ts);const il=_i;function Cp(a,t,s,u){const d=[],_=a.image,v=_.pixelRatio,w=_.paddedRect.w-2*il,k=_.paddedRect.h-2*il,I=a.right-a.left,P=a.bottom-a.top,O=_.stretchX||[[0,w]],j=_.stretchY||[[0,k]],W=(yt,Pt)=>yt+Pt[1]-Pt[0],Z=O.reduce(W,0),ne=j.reduce(W,0),fe=w-Z,ye=k-ne;let Me=0,Ee=Z,Oe=0,Ge=ne,tt=0,At=fe,Rt=0,kt=ye;if(_.content&&u){const yt=_.content;Me=ru(O,0,yt[0]),Oe=ru(j,0,yt[1]),Ee=ru(O,yt[0],yt[2]),Ge=ru(j,yt[1],yt[3]),tt=yt[0]-Me,Rt=yt[1]-Oe,At=yt[2]-yt[0]-Ee,kt=yt[3]-yt[1]-Ge}const Tt=(yt,Pt,vt,ht)=>{const Vt=au(yt.stretch-Me,Ee,I,a.left),Bt=iu(yt.fixed-tt,At,yt.stretch,Z),nr=au(Pt.stretch-Oe,Ge,P,a.top),Dr=iu(Pt.fixed-Rt,kt,Pt.stretch,ne),Br=au(vt.stretch-Me,Ee,I,a.left),ga=iu(vt.fixed-tt,At,vt.stretch,Z),Di=au(ht.stretch-Oe,Ge,P,a.top),ri=iu(ht.fixed-Rt,kt,ht.stretch,ne),la=new L(Vt,nr),Ia=new L(Br,nr),Ra=new L(Br,Di),ai=new L(Vt,Di),ii=new L(Bt/v,Dr/v),xa=new L(ga/v,ri/v),_a=t*Math.PI/180;if(_a){const $a=Math.sin(_a),yi=Math.cos(_a),vi=[yi,-$a,$a,yi];la._matMult(vi),Ia._matMult(vi),ai._matMult(vi),Ra._matMult(vi)}const Va=yt.stretch+yt.fixed,ni=Pt.stretch+Pt.fixed;return{tl:la,tr:Ia,bl:ai,br:Ra,tex:{x:_.paddedRect.x+il+Va,y:_.paddedRect.y+il+ni,w:vt.stretch+vt.fixed-Va,h:ht.stretch+ht.fixed-ni},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ii,pixelOffsetBR:xa,minFontScaleX:At/v/I,minFontScaleY:kt/v/P,isSDF:s}};if(u&&(_.stretchX||_.stretchY)){const yt=Ap(O,fe,Z),Pt=Ap(j,ye,ne);for(let vt=0;vt<yt.length-1;vt++){const ht=yt[vt],Vt=yt[vt+1];for(let Bt=0;Bt<Pt.length-1;Bt++)d.push(Tt(ht,Pt[Bt],Vt,Pt[Bt+1]))}}else d.push(Tt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:k+1}));return d}function ru(a,t,s){let u=0;for(const d of a)u+=Math.max(t,Math.min(s,d[1]))-Math.max(t,Math.min(s,d[0]));return u}function Ap(a,t,s){const u=[{fixed:-il,stretch:0}];for(const[d,_]of a){const v=u[u.length-1];u.push({fixed:d-v.stretch,stretch:v.stretch}),u.push({fixed:d-v.stretch,stretch:v.stretch+(_-d)})}return u.push({fixed:t+il,stretch:s}),u}function au(a,t,s,u){return a/t*s+u}function iu(a,t,s,u){return a-t*s/u}class nu{constructor(t,s,u,d,_,v,w,k,I,P){if(this.boxStartIndex=t.length,I){let O=v.top,j=v.bottom;const W=v.collisionPadding;W&&(O-=W[1],j+=W[3]);let Z=j-O;Z>0&&(Z=Math.max(10,Z),this.circleDiameter=Z)}else{let O=v.top*w-k[0],j=v.bottom*w+k[2],W=v.left*w-k[3],Z=v.right*w+k[1];const ne=v.collisionPadding;if(ne&&(W-=ne[0]*w,O-=ne[1]*w,Z+=ne[2]*w,j+=ne[3]*w),P){const fe=new L(W,O),ye=new L(Z,O),Me=new L(W,j),Ee=new L(Z,j),Oe=P*Math.PI/180;fe._rotate(Oe),ye._rotate(Oe),Me._rotate(Oe),Ee._rotate(Oe),W=Math.min(fe.x,ye.x,Me.x,Ee.x),Z=Math.max(fe.x,ye.x,Me.x,Ee.x),O=Math.min(fe.y,ye.y,Me.y,Ee.y),j=Math.max(fe.y,ye.y,Me.y,Ee.y)}t.emplaceBack(s.x,s.y,W,O,Z,j,u,d,_)}this.boxEndIndex=t.length}}class W_{constructor(t=[],s=Z_){if(this.data=t,this.length=this.data.length,this.compare=s,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const t=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:s,compare:u}=this,d=s[t];for(;t>0;){const _=t-1>>1,v=s[_];if(u(d,v)>=0)break;s[t]=v,t=_}s[t]=d}_down(t){const{data:s,compare:u}=this,d=this.length>>1,_=s[t];for(;t<d;){let v=1+(t<<1),w=s[v];const k=v+1;if(k<this.length&&u(s[k],w)<0&&(v=k,w=s[k]),u(w,_)>=0)break;s[t]=w,t=v}s[t]=_}}function Z_(a,t){return a<t?-1:a>t?1:0}function X_(a,t=1,s=!1){let u=1/0,d=1/0,_=-1/0,v=-1/0;const w=a[0];for(let W=0;W<w.length;W++){const Z=w[W];(!W||Z.x<u)&&(u=Z.x),(!W||Z.y<d)&&(d=Z.y),(!W||Z.x>_)&&(_=Z.x),(!W||Z.y>v)&&(v=Z.y)}const k=Math.min(_-u,v-d);let I=k/2;const P=new W_([],K_);if(k===0)return new L(u,d);for(let W=u;W<_;W+=k)for(let Z=d;Z<v;Z+=k)P.push(new nl(W+I,Z+I,I,a));let O=function(W){let Z=0,ne=0,fe=0;const ye=W[0];for(let Me=0,Ee=ye.length,Oe=Ee-1;Me<Ee;Oe=Me++){const Ge=ye[Me],tt=ye[Oe],At=Ge.x*tt.y-tt.x*Ge.y;ne+=(Ge.x+tt.x)*At,fe+=(Ge.y+tt.y)*At,Z+=3*At}return new nl(ne/Z,fe/Z,0,W)}(a),j=P.length;for(;P.length;){const W=P.pop();(W.d>O.d||!O.d)&&(O=W,s&&console.log("found best %d after %d probes",Math.round(1e4*W.d)/1e4,j)),W.max-O.d<=t||(I=W.h/2,P.push(new nl(W.p.x-I,W.p.y-I,I,a)),P.push(new nl(W.p.x+I,W.p.y-I,I,a)),P.push(new nl(W.p.x-I,W.p.y+I,I,a)),P.push(new nl(W.p.x+I,W.p.y+I,I,a)),j+=4)}return s&&(console.log(`num probes: ${j}`),console.log(`best distance: ${O.d}`)),O.p}function K_(a,t){return t.max-a.max}function nl(a,t,s,u){this.p=new L(a,t),this.h=s,this.d=function(d,_){let v=!1,w=1/0;for(let k=0;k<_.length;k++){const I=_[k];for(let P=0,O=I.length,j=O-1;P<O;j=P++){const W=I[P],Z=I[j];W.y>d.y!=Z.y>d.y&&d.x<(Z.x-W.x)*(d.y-W.y)/(Z.y-W.y)+W.x&&(v=!v),w=Math.min(w,hd(d,W,Z))}}return(v?1:-1)*Math.sqrt(w)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}var La;o.aq=void 0,(La=o.aq||(o.aq={}))[La.center=1]="center",La[La.left=2]="left",La[La.right=3]="right",La[La.top=4]="top",La[La.bottom=5]="bottom",La[La["top-left"]=6]="top-left",La[La["top-right"]=7]="top-right",La[La["bottom-left"]=8]="bottom-left",La[La["bottom-right"]=9]="bottom-right";const Es=7,Bf=Number.POSITIVE_INFINITY;function Ip(a,t){return t[1]!==Bf?function(s,u,d){let _=0,v=0;switch(u=Math.abs(u),d=Math.abs(d),s){case"top-right":case"top-left":case"top":v=d-Es;break;case"bottom-right":case"bottom-left":case"bottom":v=-d+Es}switch(s){case"top-right":case"bottom-right":case"right":_=-u;break;case"top-left":case"bottom-left":case"left":_=u}return[_,v]}(a,t[0],t[1]):function(s,u){let d=0,_=0;u<0&&(u=0);const v=u/Math.SQRT2;switch(s){case"top-right":case"top-left":_=v-Es;break;case"bottom-right":case"bottom-left":_=-v+Es;break;case"bottom":_=-u+Es;break;case"top":_=u-Es}switch(s){case"top-right":case"bottom-right":d=-v;break;case"top-left":case"bottom-left":d=v;break;case"left":d=u;break;case"right":d=-u}return[d,_]}(a,t[0])}function Fp(a,t,s){var u;const d=a.layout,_=(u=d.get("text-variable-anchor-offset"))===null||u===void 0?void 0:u.evaluate(t,{},s);if(_){const w=_.values,k=[];for(let I=0;I<w.length;I+=2){const P=k[I]=w[I],O=w[I+1].map(j=>j*ma);P.startsWith("top")?O[1]-=Es:P.startsWith("bottom")&&(O[1]+=Es),k[I+1]=O}return new Kr(k)}const v=d.get("text-variable-anchor");if(v){let w;w=a._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[d.get("text-radial-offset").evaluate(t,{},s)*ma,Bf]:d.get("text-offset").evaluate(t,{},s).map(I=>I*ma);const k=[];for(const I of v)k.push(I,Ip(I,w));return new Kr(k)}return null}function zf(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Y_(a,t,s,u,d,_,v,w,k,I,P){let O=_.textMaxSize.evaluate(t,{});O===void 0&&(O=v);const j=a.layers[0].layout,W=j.get("icon-offset").evaluate(t,{},P),Z=Mp(s.horizontal),ne=v/24,fe=a.tilePixelRatio*ne,ye=a.tilePixelRatio*O/24,Me=a.tilePixelRatio*w,Ee=a.tilePixelRatio*j.get("symbol-spacing"),Oe=j.get("text-padding")*a.tilePixelRatio,Ge=function(ht,Vt,Bt,nr=1){const Dr=ht.get("icon-padding").evaluate(Vt,{},Bt),Br=Dr&&Dr.values;return[Br[0]*nr,Br[1]*nr,Br[2]*nr,Br[3]*nr]}(j,t,P,a.tilePixelRatio),tt=j.get("text-max-angle")/180*Math.PI,At=j.get("text-rotation-alignment")!=="viewport"&&j.get("symbol-placement")!=="point",Rt=j.get("icon-rotation-alignment")==="map"&&j.get("symbol-placement")!=="point",kt=j.get("symbol-placement"),Tt=Ee/2,yt=j.get("icon-text-fit");let Pt;u&&yt!=="none"&&(a.allowVerticalPlacement&&s.vertical&&(Pt=ep(u,s.vertical,yt,j.get("icon-text-fit-padding"),W,ne)),Z&&(u=ep(u,Z,yt,j.get("icon-text-fit-padding"),W,ne)));const vt=(ht,Vt)=>{Vt.x<0||Vt.x>=oa||Vt.y<0||Vt.y>=oa||function(Bt,nr,Dr,Br,ga,Di,ri,la,Ia,Ra,ai,ii,xa,_a,Va,ni,$a,yi,vi,ya,fr,ja,Oa,va,Ji){const pn=Bt.addToLineVertexArray(nr,Dr);let mn,Jn,Qi,zi,wi=0,Qn=0,Sc=0,Op=0,qf=-1,Wf=-1;const es={};let Bp=Zn("");if(Bt.allowVerticalPlacement&&Br.vertical){const Ga=la.layout.get("text-rotate").evaluate(fr,{},va)+90;Qi=new nu(Ia,nr,Ra,ai,ii,Br.vertical,xa,_a,Va,Ga),ri&&(zi=new nu(Ia,nr,Ra,ai,ii,ri,$a,yi,Va,Ga))}if(ga){const Ga=la.layout.get("icon-rotate").evaluate(fr,{}),Ni=la.layout.get("icon-text-fit")!=="none",ro=Cp(ga,Ga,Oa,Ni),xn=ri?Cp(ri,Ga,Oa,Ni):void 0;Jn=new nu(Ia,nr,Ra,ai,ii,ga,$a,yi,!1,Ga),wi=4*ro.length;const ao=Bt.iconSizeData;let Mn=null;ao.kind==="source"?(Mn=[Pn*la.layout.get("icon-size").evaluate(fr,{})],Mn[0]>ws&&pt(`${Bt.layerIds[0]}: Value for "icon-size" is >= ${wc}. Reduce your "icon-size".`)):ao.kind==="composite"&&(Mn=[Pn*ja.compositeIconSizes[0].evaluate(fr,{},va),Pn*ja.compositeIconSizes[1].evaluate(fr,{},va)],(Mn[0]>ws||Mn[1]>ws)&&pt(`${Bt.layerIds[0]}: Value for "icon-size" is >= ${wc}. Reduce your "icon-size".`)),Bt.addSymbols(Bt.icon,ro,Mn,ya,vi,fr,o.ai.none,nr,pn.lineStartIndex,pn.lineLength,-1,va),qf=Bt.icon.placedSymbolArray.length-1,xn&&(Qn=4*xn.length,Bt.addSymbols(Bt.icon,xn,Mn,ya,vi,fr,o.ai.vertical,nr,pn.lineStartIndex,pn.lineLength,-1,va),Wf=Bt.icon.placedSymbolArray.length-1)}const zp=Object.keys(Br.horizontal);for(const Ga of zp){const Ni=Br.horizontal[Ga];if(!mn){Bp=Zn(Ni.text);const xn=la.layout.get("text-rotate").evaluate(fr,{},va);mn=new nu(Ia,nr,Ra,ai,ii,Ni,xa,_a,Va,xn)}const ro=Ni.positionedLines.length===1;if(Sc+=Pp(Bt,nr,Ni,Di,la,Va,fr,ni,pn,Br.vertical?o.ai.horizontal:o.ai.horizontalOnly,ro?zp:[Ga],es,qf,ja,va),ro)break}Br.vertical&&(Op+=Pp(Bt,nr,Br.vertical,Di,la,Va,fr,ni,pn,o.ai.vertical,["vertical"],es,Wf,ja,va));const ey=mn?mn.boxStartIndex:Bt.collisionBoxArray.length,ty=mn?mn.boxEndIndex:Bt.collisionBoxArray.length,ry=Qi?Qi.boxStartIndex:Bt.collisionBoxArray.length,ay=Qi?Qi.boxEndIndex:Bt.collisionBoxArray.length,iy=Jn?Jn.boxStartIndex:Bt.collisionBoxArray.length,ny=Jn?Jn.boxEndIndex:Bt.collisionBoxArray.length,sy=zi?zi.boxStartIndex:Bt.collisionBoxArray.length,oy=zi?zi.boxEndIndex:Bt.collisionBoxArray.length;let gn=-1;const ou=(Ga,Ni)=>Ga&&Ga.circleDiameter?Math.max(Ga.circleDiameter,Ni):Ni;gn=ou(mn,gn),gn=ou(Qi,gn),gn=ou(Jn,gn),gn=ou(zi,gn);const Np=gn>-1?1:0;Np&&(gn*=Ji/ma),Bt.glyphOffsetArray.length>=al.MAX_GLYPHS&&pt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),fr.sortKey!==void 0&&Bt.addToSortKeyRanges(Bt.symbolInstances.length,fr.sortKey);const ly=Fp(la,fr,va),[cy,hy]=function(Ga,Ni){const ro=Ga.length,xn=Ni?.values;if(xn?.length>0)for(let ao=0;ao<xn.length;ao+=2){const Mn=xn[ao+1];Ga.emplaceBack(o.aq[xn[ao]],Mn[0],Mn[1])}return[ro,Ga.length]}(Bt.textAnchorOffsets,ly);Bt.symbolInstances.emplaceBack(nr.x,nr.y,es.right>=0?es.right:-1,es.center>=0?es.center:-1,es.left>=0?es.left:-1,es.vertical||-1,qf,Wf,Bp,ey,ty,ry,ay,iy,ny,sy,oy,Ra,Sc,Op,wi,Qn,Np,0,xa,gn,cy,hy)}(a,Vt,ht,s,u,d,Pt,a.layers[0],a.collisionBoxArray,t.index,t.sourceLayerIndex,a.index,fe,[Oe,Oe,Oe,Oe],At,k,Me,Ge,Rt,W,t,_,I,P,v)};if(kt==="line")for(const ht of wp(t.geometry,0,0,oa,oa)){const Vt=q_(ht,Ee,tt,s.vertical||Z,u,24,ye,a.overscaling,oa);for(const Bt of Vt)Z&&J_(a,Z.text,Tt,Bt)||vt(ht,Bt)}else if(kt==="line-center"){for(const ht of t.geometry)if(ht.length>1){const Vt=H_(ht,tt,s.vertical||Z,u,24,ye);Vt&&vt(ht,Vt)}}else if(t.type==="Polygon")for(const ht of gf(t.geometry,0)){const Vt=X_(ht,16);vt(ht[0],new Ts(Vt.x,Vt.y,0))}else if(t.type==="LineString")for(const ht of t.geometry)vt(ht,new Ts(ht[0].x,ht[0].y,0));else if(t.type==="Point")for(const ht of t.geometry)for(const Vt of ht)vt([Vt],new Ts(Vt.x,Vt.y,0))}function Pp(a,t,s,u,d,_,v,w,k,I,P,O,j,W,Z){const ne=function(Me,Ee,Oe,Ge,tt,At,Rt,kt){const Tt=Ge.layout.get("text-rotate").evaluate(At,{})*Math.PI/180,yt=[];for(const Pt of Ee.positionedLines)for(const vt of Pt.positionedGlyphs){if(!vt.rect)continue;const ht=vt.rect||{};let Vt=Wd+1,Bt=!0,nr=1,Dr=0;const Br=(tt||kt)&&vt.vertical,ga=vt.metrics.advance*vt.scale/2;if(kt&&Ee.verticalizable&&(Dr=Pt.lineOffset/2-(vt.imageName?-(ma-vt.metrics.width*vt.scale)/2:(vt.scale-1)*ma)),vt.imageName){const ya=Rt[vt.imageName];Bt=ya.sdf,nr=ya.pixelRatio,Vt=_i/nr}const Di=tt?[vt.x+ga,vt.y]:[0,0];let ri=tt?[0,0]:[vt.x+ga+Oe[0],vt.y+Oe[1]-Dr],la=[0,0];Br&&(la=ri,ri=[0,0]);const Ia=vt.metrics.isDoubleResolution?2:1,Ra=(vt.metrics.left-Vt)*vt.scale-ga+ri[0],ai=(-vt.metrics.top-Vt)*vt.scale+ri[1],ii=Ra+ht.w/Ia*vt.scale/nr,xa=ai+ht.h/Ia*vt.scale/nr,_a=new L(Ra,ai),Va=new L(ii,ai),ni=new L(Ra,xa),$a=new L(ii,xa);if(Br){const ya=new L(-ga,ga-yc),fr=-Math.PI/2,ja=ma/2-ga,Oa=new L(5-yc-ja,-(vt.imageName?ja:0)),va=new L(...la);_a._rotateAround(fr,ya)._add(Oa)._add(va),Va._rotateAround(fr,ya)._add(Oa)._add(va),ni._rotateAround(fr,ya)._add(Oa)._add(va),$a._rotateAround(fr,ya)._add(Oa)._add(va)}if(Tt){const ya=Math.sin(Tt),fr=Math.cos(Tt),ja=[fr,-ya,ya,fr];_a._matMult(ja),Va._matMult(ja),ni._matMult(ja),$a._matMult(ja)}const yi=new L(0,0),vi=new L(0,0);yt.push({tl:_a,tr:Va,bl:ni,br:$a,tex:ht,writingMode:Ee.writingMode,glyphOffset:Di,sectionIndex:vt.sectionIndex,isSDF:Bt,pixelOffsetTL:yi,pixelOffsetBR:vi,minFontScaleX:0,minFontScaleY:0})}return yt}(0,s,w,d,_,v,u,a.allowVerticalPlacement),fe=a.textSizeData;let ye=null;fe.kind==="source"?(ye=[Pn*d.layout.get("text-size").evaluate(v,{})],ye[0]>ws&&pt(`${a.layerIds[0]}: Value for "text-size" is >= ${wc}. Reduce your "text-size".`)):fe.kind==="composite"&&(ye=[Pn*W.compositeTextSizes[0].evaluate(v,{},Z),Pn*W.compositeTextSizes[1].evaluate(v,{},Z)],(ye[0]>ws||ye[1]>ws)&&pt(`${a.layerIds[0]}: Value for "text-size" is >= ${wc}. Reduce your "text-size".`)),a.addSymbols(a.text,ne,ye,w,_,v,I,t,k.lineStartIndex,k.lineLength,j,Z);for(const Me of P)O[Me]=a.text.placedSymbolArray.length-1;return 4*ne.length}function Mp(a){for(const t in a)return a[t];return null}function J_(a,t,s,u){const d=a.compareText;if(t in d){const _=d[t];for(let v=_.length-1;v>=0;v--)if(u.dist(_[v])<s)return!0}else d[t]=[];return d[t].push(u),!1}const Dp=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Nf{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,u]=new Uint8Array(t,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");const d=u>>4;if(d!==1)throw new Error(`Got v${d} data when expected v1.`);const _=Dp[15&u];if(!_)throw new Error("Unrecognized array type.");const[v]=new Uint16Array(t,2,1),[w]=new Uint32Array(t,4,1);return new Nf(w,v,_,t)}constructor(t,s=64,u=Float64Array,d){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=u,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const _=Dp.indexOf(this.ArrayType),v=2*t*this.ArrayType.BYTES_PER_ELEMENT,w=t*this.IndexArrayType.BYTES_PER_ELEMENT,k=(8-w%8)%8;if(_<0)throw new Error(`Unexpected typed array class: ${u}.`);d&&d instanceof ArrayBuffer?(this.data=d,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+w+k,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+v+w+k),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+w+k,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+_]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=t)}add(t,s){const u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=t,this.coords[this._pos++]=s,u}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Uf(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,s,u,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:v,nodeSize:w}=this,k=[0,_.length-1,0],I=[];for(;k.length;){const P=k.pop()||0,O=k.pop()||0,j=k.pop()||0;if(O-j<=w){for(let fe=j;fe<=O;fe++){const ye=v[2*fe],Me=v[2*fe+1];ye>=t&&ye<=u&&Me>=s&&Me<=d&&I.push(_[fe])}continue}const W=j+O>>1,Z=v[2*W],ne=v[2*W+1];Z>=t&&Z<=u&&ne>=s&&ne<=d&&I.push(_[W]),(P===0?t<=Z:s<=ne)&&(k.push(j),k.push(W-1),k.push(1-P)),(P===0?u>=Z:d>=ne)&&(k.push(W+1),k.push(O),k.push(1-P))}return I}within(t,s,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:_,nodeSize:v}=this,w=[0,d.length-1,0],k=[],I=u*u;for(;w.length;){const P=w.pop()||0,O=w.pop()||0,j=w.pop()||0;if(O-j<=v){for(let fe=j;fe<=O;fe++)Rp(_[2*fe],_[2*fe+1],t,s)<=I&&k.push(d[fe]);continue}const W=j+O>>1,Z=_[2*W],ne=_[2*W+1];Rp(Z,ne,t,s)<=I&&k.push(d[W]),(P===0?t-u<=Z:s-u<=ne)&&(w.push(j),w.push(W-1),w.push(1-P)),(P===0?t+u>=Z:s+u>=ne)&&(w.push(W+1),w.push(O),w.push(1-P))}return k}}function Uf(a,t,s,u,d,_){if(d-u<=s)return;const v=u+d>>1;Lp(a,t,v,u,d,_),Uf(a,t,s,u,v-1,1-_),Uf(a,t,s,v+1,d,1-_)}function Lp(a,t,s,u,d,_){for(;d>u;){if(d-u>600){const I=d-u+1,P=s-u+1,O=Math.log(I),j=.5*Math.exp(2*O/3),W=.5*Math.sqrt(O*j*(I-j)/I)*(P-I/2<0?-1:1);Lp(a,t,s,Math.max(u,Math.floor(s-P*j/I+W)),Math.min(d,Math.floor(s+(I-P)*j/I+W)),_)}const v=t[2*s+_];let w=u,k=d;for(Tc(a,t,u,s),t[2*d+_]>v&&Tc(a,t,u,d);w<k;){for(Tc(a,t,w,k),w++,k--;t[2*w+_]<v;)w++;for(;t[2*k+_]>v;)k--}t[2*u+_]===v?Tc(a,t,u,k):(k++,Tc(a,t,k,d)),k<=s&&(u=k+1),s<=k&&(d=k-1)}}function Tc(a,t,s,u){Vf(a,s,u),Vf(t,2*s,2*u),Vf(t,2*s+1,2*u+1)}function Vf(a,t,s){const u=a[t];a[t]=a[s],a[s]=u}function Rp(a,t,s,u){const d=a-s,_=t-u;return d*d+_*_}var $f;o.bh=void 0,($f=o.bh||(o.bh={})).create="create",$f.load="load",$f.fullLoad="fullLoad";let su=null,Ec=[];const jf=1e3/60,Gf="loadTime",Hf="fullLoadTime",Q_={mark(a){performance.mark(a)},frame(a){const t=a;su!=null&&Ec.push(t-su),su=t},clearMetrics(){su=null,Ec=[],performance.clearMeasures(Gf),performance.clearMeasures(Hf);for(const a in o.bh)performance.clearMarks(o.bh[a])},getPerformanceMetrics(){performance.measure(Gf,o.bh.create,o.bh.load),performance.measure(Hf,o.bh.create,o.bh.fullLoad);const a=performance.getEntriesByName(Gf)[0].duration,t=performance.getEntriesByName(Hf)[0].duration,s=Ec.length,u=1/(Ec.reduce((_,v)=>_+v,0)/s/1e3),d=Ec.filter(_=>_>jf).reduce((_,v)=>_+(v-jf)/jf,0);return{loadTime:a,fullLoadTime:t,fps:u,percentDroppedFrames:d/(s+d)*100,totalFrames:s}}};o.$=function(a,t,s){var u,d,_,v,w,k,I,P,O,j,W,Z,ne=s[0],fe=s[1],ye=s[2];return t===a?(a[12]=t[0]*ne+t[4]*fe+t[8]*ye+t[12],a[13]=t[1]*ne+t[5]*fe+t[9]*ye+t[13],a[14]=t[2]*ne+t[6]*fe+t[10]*ye+t[14],a[15]=t[3]*ne+t[7]*fe+t[11]*ye+t[15]):(d=t[1],_=t[2],v=t[3],w=t[4],k=t[5],I=t[6],P=t[7],O=t[8],j=t[9],W=t[10],Z=t[11],a[0]=u=t[0],a[1]=d,a[2]=_,a[3]=v,a[4]=w,a[5]=k,a[6]=I,a[7]=P,a[8]=O,a[9]=j,a[10]=W,a[11]=Z,a[12]=u*ne+w*fe+O*ye+t[12],a[13]=d*ne+k*fe+j*ye+t[13],a[14]=_*ne+I*fe+W*ye+t[14],a[15]=v*ne+P*fe+Z*ye+t[15]),a},o.A=Yo,o.B=di,o.C=class{constructor(a,t,s){this.receive=u=>{const d=u.data,_=d.id;if(_&&(!d.targetMapId||this.mapId===d.targetMapId))if(d.type==="<cancel>"){delete this.tasks[_];const v=this.cancelCallbacks[_];delete this.cancelCallbacks[_],v&&v()}else ft()||d.mustQueue?(this.tasks[_]=d,this.taskQueue.push(_),this.invoker.trigger()):this.processTask(_,d)},this.process=()=>{if(!this.taskQueue.length)return;const u=this.taskQueue.shift(),d=this.tasks[u];delete this.tasks[u],this.taskQueue.length&&this.invoker.trigger(),d&&this.processTask(u,d)},this.target=a,this.parent=t,this.mapId=s,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new j_(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=ft()?a:window}send(a,t,s,u,d=!1){const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(this.callbacks[_]=s);const v=[],w={id:_,type:a,hasCallback:!!s,targetMapId:u,mustQueue:d,sourceMapId:this.mapId,data:An(t,v)};return this.target.postMessage(w,{transfer:v}),{cancel:()=>{s&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}processTask(a,t){if(t.type==="<response>"){const s=this.callbacks[a];delete this.callbacks[a],s&&(t.error?s(ms(t.error)):s(null,ms(t.data)))}else{let s=!1;const u=[],d=t.hasCallback?(w,k)=>{s=!0,delete this.cancelCallbacks[a];const I={id:a,type:"<response>",sourceMapId:this.mapId,error:w?An(w):null,data:An(k,u)};this.target.postMessage(I,{transfer:u})}:w=>{s=!0};let _=null;const v=ms(t.data);if(this.parent[t.type])_=this.parent[t.type](t.sourceMapId,v,d);else if("getWorkerSource"in this.parent){const w=t.type.split(".");_=this.parent.getWorkerSource(t.sourceMapId,w[0],v.source)[w[1]](v,d)}else d(new Error(`Could not find function ${t.type}`));!s&&_&&_.cancel&&(this.cancelCallbacks[a]=_.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.D=zt,o.E=Wr,o.F=function(a,t){const s={};for(let u=0;u<t.length;u++){const d=t[u];d in a&&(s[d]=a[d])}return s},o.G=cp,o.H=hp,o.I=kf,o.J=pe,o.K=Y,o.L=bs,o.M=Dt,o.N=oa,o.O=Bi,o.P=L,o.Q=$r,o.R=Oi,o.S=Mr,o.T=Rh,o.U=tu,o.V=class extends qn{},o.W=Of,o.X=function(a,t){const s=window.document.createElement("video");s.muted=!0,s.onloadstart=function(){t(null,s)};for(let u=0;u<a.length;u++){const d=window.document.createElement("source");Jt(a[u])||(s.crossOrigin="Anonymous"),d.src=a[u],s.appendChild(d)}return{cancel:()=>{}}},o.Y=lt,o.Z=function(){var a=new Yo(16);return Yo!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},o._=S,o.a=qe,o.a$=class extends q{},o.a0=function(a,t,s){var u=s[0],d=s[1],_=s[2];return a[0]=t[0]*u,a[1]=t[1]*u,a[2]=t[2]*u,a[3]=t[3]*u,a[4]=t[4]*d,a[5]=t[5]*d,a[6]=t[6]*d,a[7]=t[7]*d,a[8]=t[8]*_,a[9]=t[9]*_,a[10]=t[10]*_,a[11]=t[11]*_,a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15],a},o.a1=pd,o.a2=function(){return Ce++},o.a3=ce,o.a4=al,o.a5=function(){gi.isLoading()||gi.isLoaded()||Jl()!=="deferred"||Lh()},o.a6=Vl,o.a7=eo,o.a8=Pr,o.a9=xp,o.aA=Zs,o.aB=function(a){a=a.slice();const t=Object.create(null);for(let s=0;s<a.length;s++)t[a[s].id]=a[s];for(let s=0;s<a.length;s++)"ref"in a[s]&&(a[s]=na(a[s],t[a[s].ref]));return a},o.aC=function(a){if(a.type==="custom")return new $_(a);switch(a.type){case"background":return new N_(a);case"circle":return new Ex(a);case"fill":return new Gx(a);case"fill-extrusion":return new n_(a);case"heatmap":return new kx(a);case"hillshade":return new Ax(a);case"line":return new d_(a);case"raster":return new V_(a);case"symbol":return new eu(a)}},o.aD=Re,o.aE=function(a,t){if(!a)return[{command:qt.setStyle,args:[t]}];let s=[];try{if(!ur(a.version,t.version))return[{command:qt.setStyle,args:[t]}];ur(a.center,t.center)||s.push({command:qt.setCenter,args:[t.center]}),ur(a.zoom,t.zoom)||s.push({command:qt.setZoom,args:[t.zoom]}),ur(a.bearing,t.bearing)||s.push({command:qt.setBearing,args:[t.bearing]}),ur(a.pitch,t.pitch)||s.push({command:qt.setPitch,args:[t.pitch]}),ur(a.sprite,t.sprite)||s.push({command:qt.setSprite,args:[t.sprite]}),ur(a.glyphs,t.glyphs)||s.push({command:qt.setGlyphs,args:[t.glyphs]}),ur(a.transition,t.transition)||s.push({command:qt.setTransition,args:[t.transition]}),ur(a.light,t.light)||s.push({command:qt.setLight,args:[t.light]});const u={},d=[];(function(v,w,k,I){let P;for(P in w=w||{},v=v||{})Object.prototype.hasOwnProperty.call(v,P)&&(Object.prototype.hasOwnProperty.call(w,P)||Sa(P,k,I));for(P in w)Object.prototype.hasOwnProperty.call(w,P)&&(Object.prototype.hasOwnProperty.call(v,P)?ur(v[P],w[P])||(v[P].type==="geojson"&&w[P].type==="geojson"&&zr(v,w,P)?k.push({command:qt.setGeoJSONSourceData,args:[P,w[P].data]}):ua(P,w,k,I)):Zr(P,w,k))})(a.sources,t.sources,d,u);const _=[];a.layers&&a.layers.forEach(v=>{u[v.source]?s.push({command:qt.removeLayer,args:[v.id]}):_.push(v)}),s=s.concat(d),function(v,w,k){w=w||[];const I=(v=v||[]).map(Xt),P=w.map(Xt),O=v.reduce(Sr,{}),j=w.reduce(Sr,{}),W=I.slice(),Z=Object.create(null);let ne,fe,ye,Me,Ee,Oe,Ge;for(ne=0,fe=0;ne<I.length;ne++)ye=I[ne],Object.prototype.hasOwnProperty.call(j,ye)?fe++:(k.push({command:qt.removeLayer,args:[ye]}),W.splice(W.indexOf(ye,fe),1));for(ne=0,fe=0;ne<P.length;ne++)ye=P[P.length-1-ne],W[W.length-1-ne]!==ye&&(Object.prototype.hasOwnProperty.call(O,ye)?(k.push({command:qt.removeLayer,args:[ye]}),W.splice(W.lastIndexOf(ye,W.length-fe),1)):fe++,Oe=W[W.length-ne],k.push({command:qt.addLayer,args:[j[ye],Oe]}),W.splice(W.length-ne,0,ye),Z[ye]=!0);for(ne=0;ne<P.length;ne++)if(ye=P[ne],Me=O[ye],Ee=j[ye],!Z[ye]&&!ur(Me,Ee))if(ur(Me.source,Ee.source)&&ur(Me["source-layer"],Ee["source-layer"])&&ur(Me.type,Ee.type)){for(Ge in fa(Me.layout,Ee.layout,k,ye,null,qt.setLayoutProperty),fa(Me.paint,Ee.paint,k,ye,null,qt.setPaintProperty),ur(Me.filter,Ee.filter)||k.push({command:qt.setFilter,args:[ye,Ee.filter]}),ur(Me.minzoom,Ee.minzoom)&&ur(Me.maxzoom,Ee.maxzoom)||k.push({command:qt.setLayerZoomRange,args:[ye,Ee.minzoom,Ee.maxzoom]}),Me)Object.prototype.hasOwnProperty.call(Me,Ge)&&Ge!=="layout"&&Ge!=="paint"&&Ge!=="filter"&&Ge!=="metadata"&&Ge!=="minzoom"&&Ge!=="maxzoom"&&(Ge.indexOf("paint.")===0?fa(Me[Ge],Ee[Ge],k,ye,Ge.slice(6),qt.setPaintProperty):ur(Me[Ge],Ee[Ge])||k.push({command:qt.setLayerProperty,args:[ye,Ge,Ee[Ge]]}));for(Ge in Ee)Object.prototype.hasOwnProperty.call(Ee,Ge)&&!Object.prototype.hasOwnProperty.call(Me,Ge)&&Ge!=="layout"&&Ge!=="paint"&&Ge!=="filter"&&Ge!=="metadata"&&Ge!=="minzoom"&&Ge!=="maxzoom"&&(Ge.indexOf("paint.")===0?fa(Me[Ge],Ee[Ge],k,ye,Ge.slice(6),qt.setPaintProperty):ur(Me[Ge],Ee[Ge])||k.push({command:qt.setLayerProperty,args:[ye,Ge,Ee[Ge]]}))}else k.push({command:qt.removeLayer,args:[ye]}),Oe=W[W.lastIndexOf(ye)+1],k.push({command:qt.addLayer,args:[Ee,Oe]})}(_,t.layers,s)}catch(u){console.warn("Unable to compute style diff:",u),s=[{command:qt.setStyle,args:[t]}]}return s},o.aF=function(a){const t=[],s=a.id;return s===void 0&&t.push({message:`layers.${s}: missing required property "id"`}),a.render===void 0&&t.push({message:`layers.${s}: missing required method "render"`}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&t.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),t},o.aG=function a(t,s){if(Array.isArray(t)){if(!Array.isArray(s)||t.length!==s.length)return!1;for(let u=0;u<t.length;u++)if(!a(t[u],s[u]))return!1;return!0}if(typeof t=="object"&&t!==null&&s!==null){if(typeof s!="object"||Object.keys(t).length!==Object.keys(s).length)return!1;for(const u in t)if(!a(t[u],s[u]))return!1;return!0}return t===s},o.aH=Ue,o.aI=$e,o.aJ=Xs,o.aK=function(a){return a({pluginStatus:Qa,pluginURL:In}),Xs.on("pluginStateChange",a),a},o.aL=class extends Xn{constructor(a,t){super(a,t),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}},o.aM=Xo,o.aN=class extends Xn{constructor(a,t){super(a,t),this.current=af}set(a){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let t=1;t<16;t++)if(a[t]!==this.current[t]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}},o.aO=Nh,o.aP=class extends Xn{constructor(a,t){super(a,t),this.current=[0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2]))}},o.aQ=class extends Xn{constructor(a,t){super(a,t),this.current=[0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1]))}},o.aR=Uh,o.aS=function(a,t,s,u,d,_,v){var w=1/(t-s),k=1/(u-d),I=1/(_-v);return a[0]=-2*w,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*k,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*I,a[11]=0,a[12]=(t+s)*w,a[13]=(d+u)*k,a[14]=(v+_)*I,a[15]=1,a},o.aT=Qt,o.aU=Tx,o.aV=class extends f{},o.aW=x_,o.aX=class extends y{},o.aY=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},o.aZ=yd,o.a_=xt,o.aa=function(a){const t={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,u,d,_)=>{const v=d||_;return t[u]=!v||v.toLowerCase(),""}),t["max-age"]){const s=parseInt(t["max-age"],10);isNaN(s)?delete t["max-age"]:t["max-age"]=s}return t},o.ab=function(a,t){const s=[];for(const u in a)u in t||s.push(u);return s},o.ac=function(a){if(ir==null){const t=a.navigator?a.navigator.userAgent:null;ir=!!a.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return ir},o.ad=we,o.ae=function(a,t,s){var u=Math.sin(s),d=Math.cos(s),_=t[0],v=t[1],w=t[2],k=t[3],I=t[4],P=t[5],O=t[6],j=t[7];return t!==a&&(a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a[0]=_*d+I*u,a[1]=v*d+P*u,a[2]=w*d+O*u,a[3]=k*d+j*u,a[4]=I*d-_*u,a[5]=P*d-v*u,a[6]=O*d-w*u,a[7]=j*d-k*u,a},o.af=function(a){var t=new Yo(16);return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t[8]=a[8],t[9]=a[9],t[10]=a[10],t[11]=a[11],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15],t},o.ag=Gh,o.ah=function(a,t){let s=0,u=0;if(a.kind==="constant")u=a.layoutSize;else if(a.kind!=="source"){const{interpolationType:d,minZoom:_,maxZoom:v}=a,w=d?we(pi.interpolationFactor(d,t,_,v),0,1):0;a.kind==="camera"?u=di.number(a.minSize,a.maxSize,w):s=w}return{uSizeT:s,uSize:u}},o.aj=function(a,{uSize:t,uSizeT:s},{lowerSize:u,upperSize:d}){return a.kind==="source"?u/Pn:a.kind==="composite"?di.number(u/Pn,d/Pn,s):t},o.ak=Ff,o.al=function(a,t,s,u){const d=t.y-a.y,_=t.x-a.x,v=u.y-s.y,w=u.x-s.x,k=v*_-w*d;if(k===0)return null;const I=(w*(a.y-s.y)-v*(a.x-s.x))/k;return new L(a.x+I*_,a.y+I*d)},o.am=wp,o.an=ld,o.ao=cf,o.ap=ma,o.ar=If,o.as=function(a,t){var s=t[0],u=t[1],d=t[2],_=t[3],v=t[4],w=t[5],k=t[6],I=t[7],P=t[8],O=t[9],j=t[10],W=t[11],Z=t[12],ne=t[13],fe=t[14],ye=t[15],Me=s*w-u*v,Ee=s*k-d*v,Oe=s*I-_*v,Ge=u*k-d*w,tt=u*I-_*w,At=d*I-_*k,Rt=P*ne-O*Z,kt=P*fe-j*Z,Tt=P*ye-W*Z,yt=O*fe-j*ne,Pt=O*ye-W*ne,vt=j*ye-W*fe,ht=Me*vt-Ee*Pt+Oe*yt+Ge*Tt-tt*kt+At*Rt;return ht?(a[0]=(w*vt-k*Pt+I*yt)*(ht=1/ht),a[1]=(d*Pt-u*vt-_*yt)*ht,a[2]=(ne*At-fe*tt+ye*Ge)*ht,a[3]=(j*tt-O*At-W*Ge)*ht,a[4]=(k*Tt-v*vt-I*kt)*ht,a[5]=(s*vt-d*Tt+_*kt)*ht,a[6]=(fe*Oe-Z*At-ye*Ee)*ht,a[7]=(P*At-j*Oe+W*Ee)*ht,a[8]=(v*Pt-w*Tt+I*Rt)*ht,a[9]=(u*Tt-s*Pt-_*Rt)*ht,a[10]=(Z*tt-ne*Oe+ye*Me)*ht,a[11]=(O*Oe-P*tt-W*Me)*ht,a[12]=(w*kt-v*yt-k*Rt)*ht,a[13]=(s*yt-u*kt+d*Rt)*ht,a[14]=(ne*Ee-Z*Ge-fe*Me)*ht,a[15]=(P*Ge-O*Ee+j*Me)*ht,a):null},o.at=zf,o.au=Af,o.av=Nf,o.aw=function(){const a={},t=Xe.$version;for(const s in Xe.$root){const u=Xe.$root[s];if(u.required){let d=null;d=s==="version"?t:u.type==="array"?[]:{},d!=null&&(a[s]=d)}}return a},o.ax=qt,o.ay=Fh,o.az=ut,o.b=function(a,t){const s=new Blob([new Uint8Array(a)],{type:"image/png"});createImageBitmap(s).then(u=>{t(null,u)}).catch(u=>{t(new Error(`Could not load image because of ${u.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},o.b0=Ca,o.b1=function(a,t){var s=a[0],u=a[1],d=a[2],_=a[3],v=a[4],w=a[5],k=a[6],I=a[7],P=a[8],O=a[9],j=a[10],W=a[11],Z=a[12],ne=a[13],fe=a[14],ye=a[15],Me=t[0],Ee=t[1],Oe=t[2],Ge=t[3],tt=t[4],At=t[5],Rt=t[6],kt=t[7],Tt=t[8],yt=t[9],Pt=t[10],vt=t[11],ht=t[12],Vt=t[13],Bt=t[14],nr=t[15];return Math.abs(s-Me)<=ti*Math.max(1,Math.abs(s),Math.abs(Me))&&Math.abs(u-Ee)<=ti*Math.max(1,Math.abs(u),Math.abs(Ee))&&Math.abs(d-Oe)<=ti*Math.max(1,Math.abs(d),Math.abs(Oe))&&Math.abs(_-Ge)<=ti*Math.max(1,Math.abs(_),Math.abs(Ge))&&Math.abs(v-tt)<=ti*Math.max(1,Math.abs(v),Math.abs(tt))&&Math.abs(w-At)<=ti*Math.max(1,Math.abs(w),Math.abs(At))&&Math.abs(k-Rt)<=ti*Math.max(1,Math.abs(k),Math.abs(Rt))&&Math.abs(I-kt)<=ti*Math.max(1,Math.abs(I),Math.abs(kt))&&Math.abs(P-Tt)<=ti*Math.max(1,Math.abs(P),Math.abs(Tt))&&Math.abs(O-yt)<=ti*Math.max(1,Math.abs(O),Math.abs(yt))&&Math.abs(j-Pt)<=ti*Math.max(1,Math.abs(j),Math.abs(Pt))&&Math.abs(W-vt)<=ti*Math.max(1,Math.abs(W),Math.abs(vt))&&Math.abs(Z-ht)<=ti*Math.max(1,Math.abs(Z),Math.abs(ht))&&Math.abs(ne-Vt)<=ti*Math.max(1,Math.abs(ne),Math.abs(Vt))&&Math.abs(fe-Bt)<=ti*Math.max(1,Math.abs(fe),Math.abs(Bt))&&Math.abs(ye-nr)<=ti*Math.max(1,Math.abs(ye),Math.abs(nr))},o.b2=function(a,t){return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15],a},o.b3=function(a,t,s){return a[0]=t[0]*s[0],a[1]=t[1]*s[1],a[2]=t[2]*s[2],a[3]=t[3]*s[3],a},o.b4=function(a,t){return a[0]*t[0]+a[1]*t[1]+a[2]*t[2]+a[3]*t[3]},o.b5=te,o.b6=pp,o.b7=up,o.b8=function(a,t,s,u,d){var _,v=1/Math.tan(t/2);return a[0]=v/s,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=v,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,d!=null&&d!==1/0?(a[10]=(d+u)*(_=1/(u-d)),a[14]=2*d*u*_):(a[10]=-1,a[14]=-2*u),a},o.b9=function(a,t,s){var u=Math.sin(s),d=Math.cos(s),_=t[4],v=t[5],w=t[6],k=t[7],I=t[8],P=t[9],O=t[10],j=t[11];return t!==a&&(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a[4]=_*d+I*u,a[5]=v*d+P*u,a[6]=w*d+O*u,a[7]=k*d+j*u,a[8]=I*d-_*u,a[9]=P*d-v*u,a[10]=O*d-w*u,a[11]=j*d-k*u,a},o.bA=C,o.bB=Ud,o.bC=zo,o.bD=gi,o.ba=me,o.bb=ve,o.bc=function(a,t){return a[0]=t[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=t[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=t[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},o.bd=class extends Js{},o.be=Lf,o.bf=fp,o.bg=Q_,o.bi=wt,o.bj=function(a,t,s=!1){if(Qa===Wl||Qa===Zl||Qa===Xl)throw new Error("setRTLTextPlugin cannot be called multiple times.");In=Ye.resolveURL(a),Qa=Wl,Kl=t,Yl(),s||Lh()},o.bk=Jl,o.bl=function(a,t){const s={};for(let d=0;d<a.length;d++){const _=t&&t[a[d].id]||$o(a[d]);t&&(t[a[d].id]=_);let v=s[_];v||(v=s[_]=[]),v.push(a[d])}const u=[];for(const d in s)u.push(s[d]);return u},o.bm=It,o.bn=gp,o.bo=_p,o.bp=Xd,o.bq=function(a){a.bucket.createArrays(),a.bucket.tilePixelRatio=oa/(512*a.bucket.overscaling),a.bucket.compareText={},a.bucket.iconsNeedLinear=!1;const t=a.bucket.layers[0],s=t.layout,u=t._unevaluatedLayout._values,d={layoutIconSize:u["icon-size"].possiblyEvaluate(new Pr(a.bucket.zoom+1),a.canonical),layoutTextSize:u["text-size"].possiblyEvaluate(new Pr(a.bucket.zoom+1),a.canonical),textMaxSize:u["text-size"].possiblyEvaluate(new Pr(18))};if(a.bucket.textSizeData.kind==="composite"){const{minZoom:I,maxZoom:P}=a.bucket.textSizeData;d.compositeTextSizes=[u["text-size"].possiblyEvaluate(new Pr(I),a.canonical),u["text-size"].possiblyEvaluate(new Pr(P),a.canonical)]}if(a.bucket.iconSizeData.kind==="composite"){const{minZoom:I,maxZoom:P}=a.bucket.iconSizeData;d.compositeIconSizes=[u["icon-size"].possiblyEvaluate(new Pr(I),a.canonical),u["icon-size"].possiblyEvaluate(new Pr(P),a.canonical)]}const _=s.get("text-line-height")*ma,v=s.get("text-rotation-alignment")!=="viewport"&&s.get("symbol-placement")!=="point",w=s.get("text-keep-upright"),k=s.get("text-size");for(const I of a.bucket.features){const P=s.get("text-font").evaluate(I,{},a.canonical).join(","),O=k.evaluate(I,{},a.canonical),j=d.layoutTextSize.evaluate(I,{},a.canonical),W=d.layoutIconSize.evaluate(I,{},a.canonical),Z={horizontal:{},vertical:void 0},ne=I.text;let fe,ye=[0,0];if(ne){const Oe=ne.toString(),Ge=s.get("text-letter-spacing").evaluate(I,{},a.canonical)*ma,tt=Hl(Oe)?Ge:0,At=s.get("text-anchor").evaluate(I,{},a.canonical),Rt=Fp(t,I,a.canonical);if(!Rt){const vt=s.get("text-radial-offset").evaluate(I,{},a.canonical);ye=vt?Ip(At,[vt*ma,Bf]):s.get("text-offset").evaluate(I,{},a.canonical).map(ht=>ht*ma)}let kt=v?"center":s.get("text-justify").evaluate(I,{},a.canonical);const Tt=s.get("symbol-placement"),yt=Tt==="point"?s.get("text-max-width").evaluate(I,{},a.canonical)*ma:0,Pt=()=>{a.bucket.allowVerticalPlacement&&Gl(Oe)&&(Z.vertical=Yh(ne,a.glyphMap,a.glyphPositions,a.imagePositions,P,yt,_,At,"left",tt,ye,o.ai.vertical,!0,Tt,j,O))};if(!v&&Rt){const vt=new Set;if(kt==="auto")for(let Vt=0;Vt<Rt.values.length;Vt+=2)vt.add(zf(Rt.values[Vt]));else vt.add(kt);let ht=!1;for(const Vt of vt)if(!Z.horizontal[Vt])if(ht)Z.horizontal[Vt]=Z.horizontal[0];else{const Bt=Yh(ne,a.glyphMap,a.glyphPositions,a.imagePositions,P,yt,_,"center",Vt,tt,ye,o.ai.horizontal,!1,Tt,j,O);Bt&&(Z.horizontal[Vt]=Bt,ht=Bt.positionedLines.length===1)}Pt()}else{kt==="auto"&&(kt=zf(At));const vt=Yh(ne,a.glyphMap,a.glyphPositions,a.imagePositions,P,yt,_,At,kt,tt,ye,o.ai.horizontal,!1,Tt,j,O);vt&&(Z.horizontal[kt]=vt),Pt(),Gl(Oe)&&v&&w&&(Z.vertical=Yh(ne,a.glyphMap,a.glyphPositions,a.imagePositions,P,yt,_,At,kt,tt,ye,o.ai.vertical,!1,Tt,j,O))}}let Me=!1;if(I.icon&&I.icon.name){const Oe=a.imageMap[I.icon.name];Oe&&(fe=L_(a.imagePositions[I.icon.name],s.get("icon-offset").evaluate(I,{},a.canonical),s.get("icon-anchor").evaluate(I,{},a.canonical)),Me=!!Oe.sdf,a.bucket.sdfIcons===void 0?a.bucket.sdfIcons=Me:a.bucket.sdfIcons!==Me&&pt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Oe.pixelRatio!==a.bucket.pixelRatio||s.get("icon-rotate").constantOr(1)!==0)&&(a.bucket.iconsNeedLinear=!0))}const Ee=Mp(Z.horizontal)||Z.vertical;a.bucket.iconsInText=!!Ee&&Ee.iconsInText,(Ee||fe)&&Y_(a.bucket,I,Z,fe,a.imageMap,d,j,W,ye,Me,a.canonical)}a.showCollisionBoxes&&a.bucket.generateCollisionDebugBuffers()},o.br=bf,o.bs=yf,o.bt=wf,o.bu=class{constructor(a){this._marks={start:[a.url,"start"].join("#"),end:[a.url,"end"].join("#"),measure:a.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let a=performance.getEntriesByName(this._marks.measure);return a.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),a=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),a}},o.bv=Ef,o.bw=ys,o.bx=function(a,t,s,u,d){return S(this,void 0,void 0,function*(){if(Y())try{return yield Dt(a,t,s,u,d)}catch{}return function(_,v,w,k,I){const P=_.width,O=_.height;ue&&be||(ue=new OffscreenCanvas(P,O),be=ue.getContext("2d",{willReadFrequently:!0})),ue.width=P,ue.height=O,be.drawImage(_,0,0,P,O);const j=be.getImageData(v,w,k,I);return be.clearRect(0,0,P,O),j.data}(a,t,s,u,d)})},o.by=mp,o.bz=b,o.c=mt,o.d=function(a,t){const s=new Image;s.onload=()=>{t(null,s),URL.revokeObjectURL(s.src),s.onload=null,window.requestAnimationFrame(()=>{s.src=$t})},s.onerror=()=>t(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const u=new Blob([new Uint8Array(a)],{type:"image/png"});s.src=a.byteLength?URL.createObjectURL(u):$t},o.e=Be,o.f=function(a,t){return xe(Be(a,{type:"json"}),t)},o.g=rt,o.h=Ye,o.i=ft,o.j=wr,o.k=Et,o.l=er,o.m=xe,o.n=function(a){return new Ef(a).readFields(A_,[])},o.o=function(a,t,s){if(!a.length)return s(null,[]);let u=a.length;const d=new Array(a.length);let _=null;a.forEach((v,w)=>{t(v,(k,I)=>{k&&(_=k),d[w]=I,--u==0&&s(_,d)})})},o.p=Zd,o.q=uc,o.r=ra,o.s=Jt,o.t=Qu,o.u=Ct,o.v=Xe,o.w=pt,o.x=Ho,o.y=un,o.z=function([a,t,s]){return t+=90,t*=Math.PI/180,s*=Math.PI/180,{x:a*Math.cos(t)*Math.sin(s),y:a*Math.sin(t)*Math.sin(s),z:a*Math.cos(s)}}}),m(["./shared"],function(o){class S{constructor(V){this.keyCache={},V&&this.replace(V)}replace(V){this._layerConfigs={},this._layers={},this.update(V,[])}update(V,H){for(const he of V){this._layerConfigs[he.id]=he;const de=this._layers[he.id]=o.aC(he);de._featureFilter=o.a6(de.filter),this.keyCache[he.id]&&delete this.keyCache[he.id]}for(const he of H)delete this.keyCache[he],delete this._layerConfigs[he],delete this._layers[he];this.familiesBySource={};const ee=o.bl(Object.values(this._layerConfigs),this.keyCache);for(const he of ee){const de=he.map(Qe=>this._layers[Qe.id]),De=de[0];if(De.visibility==="none")continue;const ke=De.source||"";let _e=this.familiesBySource[ke];_e||(_e=this.familiesBySource[ke]={});const Fe=De.sourceLayer||"_geojsonTileLayer";let Je=_e[Fe];Je||(Je=_e[Fe]=[]),Je.push(de)}}}class b{constructor(V){const H={},ee=[];for(const ke in V){const _e=V[ke],Fe=H[ke]={};for(const Je in _e){const Qe=_e[+Je];if(!Qe||Qe.bitmap.width===0||Qe.bitmap.height===0)continue;const B={x:0,y:0,w:Qe.bitmap.width+2,h:Qe.bitmap.height+2};ee.push(B),Fe[Je]={rect:B,metrics:Qe.metrics}}}const{w:he,h:de}=o.p(ee),De=new o.q({width:he||1,height:de||1});for(const ke in V){const _e=V[ke];for(const Fe in _e){const Je=_e[+Fe];if(!Je||Je.bitmap.width===0||Je.bitmap.height===0)continue;const Qe=H[ke][Fe].rect;o.q.copy(Je.bitmap,De,{x:0,y:0},{x:Qe.x+1,y:Qe.y+1},Je.bitmap)}}this.image=De,this.positions=H}}o.bm("GlyphAtlas",b);class C{constructor(V){this.tileID=new o.O(V.tileID.overscaledZ,V.tileID.wrap,V.tileID.canonical.z,V.tileID.canonical.x,V.tileID.canonical.y),this.uid=V.uid,this.zoom=V.zoom,this.pixelRatio=V.pixelRatio,this.tileSize=V.tileSize,this.source=V.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=V.showCollisionBoxes,this.collectResourceTiming=!!V.collectResourceTiming,this.returnDependencies=!!V.returnDependencies,this.promoteId=V.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(V,H,ee,he,de){this.status="parsing",this.data=V,this.collisionBoxArray=new o.a3;const De=new o.bn(Object.keys(V.layers).sort()),ke=new o.bo(this.tileID,this.promoteId);ke.bucketLayerIDs=[];const _e={},Fe={featureIndex:ke,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ee},Je=H.familiesBySource[this.source];for(const Le in Je){const ze=V.layers[Le];if(!ze)continue;ze.version===1&&o.w(`Vector tile source "${this.source}" layer "${Le}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const je=De.encode(Le),at=[];for(let gt=0;gt<ze.length;gt++){const St=ze.feature(gt),dt=ke.getId(St,Le);at.push({feature:St,id:dt,index:gt,sourceLayerIndex:je})}for(const gt of Je[Le]){const St=gt[0];St.source!==this.source&&o.w(`layer.source = ${St.source} does not equal this.source = ${this.source}`),St.minzoom&&this.zoom<Math.floor(St.minzoom)||St.maxzoom&&this.zoom>=St.maxzoom||St.visibility!=="none"&&(M(gt,this.zoom,ee),(_e[St.id]=St.createBucket({index:ke.bucketLayerIDs.length,layers:gt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:je,sourceID:this.source})).populate(at,Fe,this.tileID.canonical),ke.bucketLayerIDs.push(gt.map(dt=>dt.id)))}}let Qe,B,J,K;const X=o.aH(Fe.glyphDependencies,Le=>Object.keys(Le).map(Number));this.inFlightDependencies.forEach(Le=>Le?.cancel()),this.inFlightDependencies=[];const Q=++this.dependencySentinel;Object.keys(X).length?this.inFlightDependencies.push(he.send("getGlyphs",{uid:this.uid,stacks:X,source:this.source,tileID:this.tileID,type:"glyphs"},(Le,ze)=>{Q===this.dependencySentinel&&(Qe||(Qe=Le,B=ze,Ze.call(this)))})):B={};const re=Object.keys(Fe.iconDependencies);re.length?this.inFlightDependencies.push(he.send("getImages",{icons:re,source:this.source,tileID:this.tileID,type:"icons"},(Le,ze)=>{Q===this.dependencySentinel&&(Qe||(Qe=Le,J=ze,Ze.call(this)))})):J={};const Ne=Object.keys(Fe.patternDependencies);function Ze(){if(Qe)return de(Qe);if(B&&J&&K){const Le=new b(B),ze=new o.bp(J,K);for(const je in _e){const at=_e[je];at instanceof o.a4?(M(at.layers,this.zoom,ee),o.bq({bucket:at,glyphMap:B,glyphPositions:Le.positions,imageMap:J,imagePositions:ze.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):at.hasPattern&&(at instanceof o.br||at instanceof o.bs||at instanceof o.bt)&&(M(at.layers,this.zoom,ee),at.addFeatures(Fe,this.tileID.canonical,ze.patternPositions))}this.status="done",de(null,{buckets:Object.values(_e).filter(je=>!je.isEmpty()),featureIndex:ke,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Le.image,imageAtlas:ze,glyphMap:this.returnDependencies?B:null,iconMap:this.returnDependencies?J:null,glyphPositions:this.returnDependencies?Le.positions:null})}}Ne.length?this.inFlightDependencies.push(he.send("getImages",{icons:Ne,source:this.source,tileID:this.tileID,type:"patterns"},(Le,ze)=>{Q===this.dependencySentinel&&(Qe||(Qe=Le,K=ze,Ze.call(this)))})):K={},Ze.call(this)}}function M(le,V,H){const ee=new o.a8(V);for(const he of le)he.recalculate(ee,H)}function L(le,V){const H=o.l(le.request,(ee,he,de,De)=>{if(ee)V(ee);else if(he)try{const ke=new o.bw.VectorTile(new o.bv(he));V(null,{vectorTile:ke,rawData:he,cacheControl:de,expires:De})}catch(ke){const _e=new Uint8Array(he);let Fe=`Unable to parse the tile at ${le.request.url}, `;Fe+=_e[0]===31&&_e[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ke.messge}`,V(new Error(Fe))}});return()=>{H.cancel(),V()}}class z{constructor(V,H,ee,he){this.actor=V,this.layerIndex=H,this.availableImages=ee,this.loadVectorData=he||L,this.fetching={},this.loading={},this.loaded={}}loadTile(V,H){const ee=V.uid;this.loading||(this.loading={});const he=!!(V&&V.request&&V.request.collectResourceTiming)&&new o.bu(V.request),de=this.loading[ee]=new C(V);de.abort=this.loadVectorData(V,(De,ke)=>{if(delete this.loading[ee],De||!ke)return de.status="done",this.loaded[ee]=de,H(De);const _e=ke.rawData,Fe={};ke.expires&&(Fe.expires=ke.expires),ke.cacheControl&&(Fe.cacheControl=ke.cacheControl);const Je={};if(he){const Qe=he.finish();Qe&&(Je.resourceTiming=JSON.parse(JSON.stringify(Qe)))}de.vectorTile=ke.vectorTile,de.parse(ke.vectorTile,this.layerIndex,this.availableImages,this.actor,(Qe,B)=>{if(delete this.fetching[ee],Qe||!B)return H(Qe);H(null,o.e({rawTileData:_e.slice(0)},B,Fe,Je))}),this.loaded=this.loaded||{},this.loaded[ee]=de,this.fetching[ee]={rawTileData:_e,cacheControl:Fe,resourceTiming:Je}})}reloadTile(V,H){const ee=this.loaded,he=V.uid;if(ee&&ee[he]){const de=ee[he];de.showCollisionBoxes=V.showCollisionBoxes,de.status==="parsing"?de.parse(de.vectorTile,this.layerIndex,this.availableImages,this.actor,(De,ke)=>{if(De||!ke)return H(De,ke);let _e;if(this.fetching[he]){const{rawTileData:Fe,cacheControl:Je,resourceTiming:Qe}=this.fetching[he];delete this.fetching[he],_e=o.e({rawTileData:Fe.slice(0)},ke,Je,Qe)}else _e=ke;H(null,_e)}):de.status==="done"&&(de.vectorTile?de.parse(de.vectorTile,this.layerIndex,this.availableImages,this.actor,H):H())}}abortTile(V,H){const ee=this.loading,he=V.uid;ee&&ee[he]&&ee[he].abort&&(ee[he].abort(),delete ee[he]),H()}removeTile(V,H){const ee=this.loaded,he=V.uid;ee&&ee[he]&&delete ee[he],H()}}class U{constructor(){this.loaded={}}loadTile(V,H){return o._(this,void 0,void 0,function*(){const{uid:ee,encoding:he,rawImageData:de,redFactor:De,greenFactor:ke,blueFactor:_e,baseShift:Fe}=V,Je=de.width+2,Qe=de.height+2,B=o.a(de)?new o.R({width:Je,height:Qe},yield o.bx(de,-1,-1,Je,Qe)):de,J=new o.by(ee,B,he,De,ke,_e,Fe);this.loaded=this.loaded||{},this.loaded[ee]=J,H(null,J)})}removeTile(V){const H=this.loaded,ee=V.uid;H&&H[ee]&&delete H[ee]}}function N(le,V){if(le.length!==0){G(le[0],V);for(var H=1;H<le.length;H++)G(le[H],!V)}}function G(le,V){for(var H=0,ee=0,he=0,de=le.length,De=de-1;he<de;De=he++){var ke=(le[he][0]-le[De][0])*(le[De][1]+le[he][1]),_e=H+ke;ee+=Math.abs(H)>=Math.abs(ke)?H-_e+ke:ke-_e+H,H=_e}H+ee>=0!=!!V&&le.reverse()}var ie=o.bz(function le(V,H){var ee,he=V&&V.type;if(he==="FeatureCollection")for(ee=0;ee<V.features.length;ee++)le(V.features[ee],H);else if(he==="GeometryCollection")for(ee=0;ee<V.geometries.length;ee++)le(V.geometries[ee],H);else if(he==="Feature")le(V.geometry,H);else if(he==="Polygon")N(V.coordinates,H);else if(he==="MultiPolygon")for(ee=0;ee<V.coordinates.length;ee++)N(V.coordinates[ee],H);return V});const pe=o.bw.VectorTileFeature.prototype.toGeoJSON;var Y={exports:{}},me=o.bA,ve=o.bw.VectorTileFeature,we=te;function te(le,V){this.options=V||{},this.features=le,this.length=le.length}function Be(le,V){this.id=typeof le.id=="number"?le.id:void 0,this.type=le.type,this.rawGeometry=le.type===1?[le.geometry]:le.geometry,this.properties=le.tags,this.extent=V||4096}te.prototype.feature=function(le){return new Be(this.features[le],this.options.extent)},Be.prototype.loadGeometry=function(){var le=this.rawGeometry;this.geometry=[];for(var V=0;V<le.length;V++){for(var H=le[V],ee=[],he=0;he<H.length;he++)ee.push(new me(H[he][0],H[he][1]));this.geometry.push(ee)}return this.geometry},Be.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var le=this.geometry,V=1/0,H=-1/0,ee=1/0,he=-1/0,de=0;de<le.length;de++)for(var De=le[de],ke=0;ke<De.length;ke++){var _e=De[ke];V=Math.min(V,_e.x),H=Math.max(H,_e.x),ee=Math.min(ee,_e.y),he=Math.max(he,_e.y)}return[V,ee,H,he]},Be.prototype.toGeoJSON=ve.prototype.toGeoJSON;var Ce=o.bB,Ue=we;function $e(le){var V=new Ce;return function(H,ee){for(var he in H.layers)ee.writeMessage(3,Re,H.layers[he])}(le,V),V.finish()}function Re(le,V){var H;V.writeVarintField(15,le.version||1),V.writeStringField(1,le.name||""),V.writeVarintField(5,le.extent||4096);var ee={keys:[],values:[],keycache:{},valuecache:{}};for(H=0;H<le.length;H++)ee.feature=le.feature(H),V.writeMessage(2,st,ee);var he=ee.keys;for(H=0;H<he.length;H++)V.writeStringField(3,he[H]);var de=ee.values;for(H=0;H<de.length;H++)V.writeMessage(4,ir,de[H])}function st(le,V){var H=le.feature;H.id!==void 0&&V.writeVarintField(1,H.id),V.writeMessage(2,pt,le),V.writeVarintField(3,H.type),V.writeMessage(4,ft,H)}function pt(le,V){var H=le.feature,ee=le.keys,he=le.values,de=le.keycache,De=le.valuecache;for(var ke in H.properties){var _e=H.properties[ke],Fe=de[ke];if(_e!==null){Fe===void 0&&(ee.push(ke),de[ke]=Fe=ee.length-1),V.writeVarint(Fe);var Je=typeof _e;Je!=="string"&&Je!=="boolean"&&Je!=="number"&&(_e=JSON.stringify(_e));var Qe=Je+":"+_e,B=De[Qe];B===void 0&&(he.push(_e),De[Qe]=B=he.length-1),V.writeVarint(B)}}}function ot(le,V){return(V<<3)+(7&le)}function _t(le){return le<<1^le>>31}function ft(le,V){for(var H=le.loadGeometry(),ee=le.type,he=0,de=0,De=H.length,ke=0;ke<De;ke++){var _e=H[ke],Fe=1;ee===1&&(Fe=_e.length),V.writeVarint(ot(1,Fe));for(var Je=ee===3?_e.length-1:_e.length,Qe=0;Qe<Je;Qe++){Qe===1&&ee!==1&&V.writeVarint(ot(2,Je-1));var B=_e[Qe].x-he,J=_e[Qe].y-de;V.writeVarint(_t(B)),V.writeVarint(_t(J)),he+=B,de+=J}ee===3&&V.writeVarint(ot(7,1))}}function ir(le,V){var H=typeof le;H==="string"?V.writeStringField(1,le):H==="boolean"?V.writeBooleanField(7,le):H==="number"&&(le%1!=0?V.writeDoubleField(3,le):le<0?V.writeSVarintField(6,le):V.writeVarintField(5,le))}Y.exports=$e,Y.exports.fromVectorTileJs=$e,Y.exports.fromGeojsonVt=function(le,V){V=V||{};var H={};for(var ee in le)H[ee]=new Ue(le[ee].features,V),H[ee].name=ee,H[ee].version=V.version,H[ee].extent=V.extent;return $e({layers:H})},Y.exports.GeoJSONWrapper=Ue;var qe=o.bz(Y.exports);const $t={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:le=>le},Dt=Math.fround||(ue=new Float32Array(1),le=>(ue[0]=+le,ue[0]));var ue;const be=3,Te=5,Ae=6;class Ye{constructor(V){this.options=Object.assign(Object.create($t),V),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(V){const{log:H,minZoom:ee,maxZoom:he}=this.options;H&&console.time("total time");const de=`prepare ${V.length} points`;H&&console.time(de),this.points=V;const De=[];for(let _e=0;_e<V.length;_e++){const Fe=V[_e];if(!Fe.geometry)continue;const[Je,Qe]=Fe.geometry.coordinates,B=Dt(ut(Je)),J=Dt(rt(Qe));De.push(B,J,1/0,_e,-1,1),this.options.reduce&&De.push(0)}let ke=this.trees[he+1]=this._createTree(De);H&&console.timeEnd(de);for(let _e=he;_e>=ee;_e--){const Fe=+Date.now();ke=this.trees[_e]=this._createTree(this._cluster(ke,_e)),H&&console.log("z%d: %d clusters in %dms",_e,ke.numItems,+Date.now()-Fe)}return H&&console.timeEnd("total time"),this}getClusters(V,H){let ee=((V[0]+180)%360+360)%360-180;const he=Math.max(-90,Math.min(90,V[1]));let de=V[2]===180?180:((V[2]+180)%360+360)%360-180;const De=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)ee=-180,de=180;else if(ee>de){const Qe=this.getClusters([ee,he,180,De],H),B=this.getClusters([-180,he,de,De],H);return Qe.concat(B)}const ke=this.trees[this._limitZoom(H)],_e=ke.range(ut(ee),rt(De),ut(de),rt(he)),Fe=ke.data,Je=[];for(const Qe of _e){const B=this.stride*Qe;Je.push(Fe[B+Te]>1?mt(Fe,B,this.clusterProps):this.points[Fe[B+be]])}return Je}getChildren(V){const H=this._getOriginId(V),ee=this._getOriginZoom(V),he="No cluster with the specified id.",de=this.trees[ee];if(!de)throw new Error(he);const De=de.data;if(H*this.stride>=De.length)throw new Error(he);const ke=this.options.radius/(this.options.extent*Math.pow(2,ee-1)),_e=de.within(De[H*this.stride],De[H*this.stride+1],ke),Fe=[];for(const Je of _e){const Qe=Je*this.stride;De[Qe+4]===V&&Fe.push(De[Qe+Te]>1?mt(De,Qe,this.clusterProps):this.points[De[Qe+be]])}if(Fe.length===0)throw new Error(he);return Fe}getLeaves(V,H,ee){const he=[];return this._appendLeaves(he,V,H=H||10,ee=ee||0,0),he}getTile(V,H,ee){const he=this.trees[this._limitZoom(V)],de=Math.pow(2,V),{extent:De,radius:ke}=this.options,_e=ke/De,Fe=(ee-_e)/de,Je=(ee+1+_e)/de,Qe={features:[]};return this._addTileFeatures(he.range((H-_e)/de,Fe,(H+1+_e)/de,Je),he.data,H,ee,de,Qe),H===0&&this._addTileFeatures(he.range(1-_e/de,Fe,1,Je),he.data,de,ee,de,Qe),H===de-1&&this._addTileFeatures(he.range(0,Fe,_e/de,Je),he.data,-1,ee,de,Qe),Qe.features.length?Qe:null}getClusterExpansionZoom(V){let H=this._getOriginZoom(V)-1;for(;H<=this.options.maxZoom;){const ee=this.getChildren(V);if(H++,ee.length!==1)break;V=ee[0].properties.cluster_id}return H}_appendLeaves(V,H,ee,he,de){const De=this.getChildren(H);for(const ke of De){const _e=ke.properties;if(_e&&_e.cluster?de+_e.point_count<=he?de+=_e.point_count:de=this._appendLeaves(V,_e.cluster_id,ee,he,de):de<he?de++:V.push(ke),V.length===ee)break}return de}_createTree(V){const H=new o.av(V.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ee=0;ee<V.length;ee+=this.stride)H.add(V[ee],V[ee+1]);return H.finish(),H.data=V,H}_addTileFeatures(V,H,ee,he,de,De){for(const ke of V){const _e=ke*this.stride,Fe=H[_e+Te]>1;let Je,Qe,B;if(Fe)Je=wt(H,_e,this.clusterProps),Qe=H[_e],B=H[_e+1];else{const X=this.points[H[_e+be]];Je=X.properties;const[Q,re]=X.geometry.coordinates;Qe=ut(Q),B=rt(re)}const J={type:1,geometry:[[Math.round(this.options.extent*(Qe*de-ee)),Math.round(this.options.extent*(B*de-he))]],tags:Je};let K;K=Fe||this.options.generateId?H[_e+be]:this.points[H[_e+be]].id,K!==void 0&&(J.id=K),De.features.push(J)}}_limitZoom(V){return Math.max(this.options.minZoom,Math.min(Math.floor(+V),this.options.maxZoom+1))}_cluster(V,H){const{radius:ee,extent:he,reduce:de,minPoints:De}=this.options,ke=ee/(he*Math.pow(2,H)),_e=V.data,Fe=[],Je=this.stride;for(let Qe=0;Qe<_e.length;Qe+=Je){if(_e[Qe+2]<=H)continue;_e[Qe+2]=H;const B=_e[Qe],J=_e[Qe+1],K=V.within(_e[Qe],_e[Qe+1],ke),X=_e[Qe+Te];let Q=X;for(const re of K){const Ne=re*Je;_e[Ne+2]>H&&(Q+=_e[Ne+Te])}if(Q>X&&Q>=De){let re,Ne=B*X,Ze=J*X,Le=-1;const ze=((Qe/Je|0)<<5)+(H+1)+this.points.length;for(const je of K){const at=je*Je;if(_e[at+2]<=H)continue;_e[at+2]=H;const gt=_e[at+Te];Ne+=_e[at]*gt,Ze+=_e[at+1]*gt,_e[at+4]=ze,de&&(re||(re=this._map(_e,Qe,!0),Le=this.clusterProps.length,this.clusterProps.push(re)),de(re,this._map(_e,at)))}_e[Qe+4]=ze,Fe.push(Ne/Q,Ze/Q,1/0,ze,-1,Q),de&&Fe.push(Le)}else{for(let re=0;re<Je;re++)Fe.push(_e[Qe+re]);if(Q>1)for(const re of K){const Ne=re*Je;if(!(_e[Ne+2]<=H)){_e[Ne+2]=H;for(let Ze=0;Ze<Je;Ze++)Fe.push(_e[Ne+Ze])}}}}return Fe}_getOriginId(V){return V-this.points.length>>5}_getOriginZoom(V){return(V-this.points.length)%32}_map(V,H,ee){if(V[H+Te]>1){const De=this.clusterProps[V[H+Ae]];return ee?Object.assign({},De):De}const he=this.points[V[H+be]].properties,de=this.options.map(he);return ee&&de===he?Object.assign({},de):de}}function mt(le,V,H){return{type:"Feature",id:le[V+be],properties:wt(le,V,H),geometry:{type:"Point",coordinates:[(ee=le[V],360*(ee-.5)),Yt(le[V+1])]}};var ee}function wt(le,V,H){const ee=le[V+Te],he=ee>=1e4?`${Math.round(ee/1e3)}k`:ee>=1e3?Math.round(ee/100)/10+"k":ee,de=le[V+Ae],De=de===-1?{}:Object.assign({},H[de]);return Object.assign(De,{cluster:!0,cluster_id:le[V+be],point_count:ee,point_count_abbreviated:he})}function ut(le){return le/360+.5}function rt(le){const V=Math.sin(le*Math.PI/180),H=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return H<0?0:H>1?1:H}function Yt(le){const V=(180-360*le)*Math.PI/180;return 360*Math.atan(Math.exp(V))/Math.PI-90}function xe(le,V,H,ee){for(var he,de=ee,De=H-V>>1,ke=H-V,_e=le[V],Fe=le[V+1],Je=le[H],Qe=le[H+1],B=V+3;B<H;B+=3){var J=er(le[B],le[B+1],_e,Fe,Je,Qe);if(J>de)he=B,de=J;else if(J===de){var K=Math.abs(B-De);K<ke&&(he=B,ke=K)}}de>ee&&(he-V>3&&xe(le,V,he,ee),le[he+2]=de,H-he>3&&xe(le,he,H,ee))}function er(le,V,H,ee,he,de){var De=he-H,ke=de-ee;if(De!==0||ke!==0){var _e=((le-H)*De+(V-ee)*ke)/(De*De+ke*ke);_e>1?(H=he,ee=de):_e>0&&(H+=De*_e,ee+=ke*_e)}return(De=le-H)*De+(ke=V-ee)*ke}function Jt(le,V,H,ee){var he={id:le===void 0?null:le,type:V,geometry:H,tags:ee,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(de){var De=de.geometry,ke=de.type;if(ke==="Point"||ke==="MultiPoint"||ke==="LineString")mr(de,De);else if(ke==="Polygon"||ke==="MultiLineString")for(var _e=0;_e<De.length;_e++)mr(de,De[_e]);else if(ke==="MultiPolygon")for(_e=0;_e<De.length;_e++)for(var Fe=0;Fe<De[_e].length;Fe++)mr(de,De[_e][Fe])}(he),he}function mr(le,V){for(var H=0;H<V.length;H+=3)le.minX=Math.min(le.minX,V[H]),le.minY=Math.min(le.minY,V[H+1]),le.maxX=Math.max(le.maxX,V[H]),le.maxY=Math.max(le.maxY,V[H+1])}function Zt(le,V,H,ee){if(V.geometry){var he=V.geometry.coordinates,de=V.geometry.type,De=Math.pow(H.tolerance/((1<<H.maxZoom)*H.extent),2),ke=[],_e=V.id;if(H.promoteId?_e=V.properties[H.promoteId]:H.generateId&&(_e=ee||0),de==="Point")Et(he,ke);else if(de==="MultiPoint")for(var Fe=0;Fe<he.length;Fe++)Et(he[Fe],ke);else if(de==="LineString")wr(he,ke,De,!1);else if(de==="MultiLineString"){if(H.lineMetrics){for(Fe=0;Fe<he.length;Fe++)wr(he[Fe],ke=[],De,!1),le.push(Jt(_e,"LineString",ke,V.properties));return}Wr(he,ke,De,!1)}else if(de==="Polygon")Wr(he,ke,De,!0);else{if(de!=="MultiPolygon"){if(de==="GeometryCollection"){for(Fe=0;Fe<V.geometry.geometries.length;Fe++)Zt(le,{id:_e,geometry:V.geometry.geometries[Fe],properties:V.properties},H,ee);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Fe=0;Fe<he.length;Fe++){var Je=[];Wr(he[Fe],Je,De,!0),ke.push(Je)}}le.push(Jt(_e,de,ke,V.properties))}}function Et(le,V){V.push(Xe(le[0])),V.push(Fr(le[1])),V.push(0)}function wr(le,V,H,ee){for(var he,de,De=0,ke=0;ke<le.length;ke++){var _e=Xe(le[ke][0]),Fe=Fr(le[ke][1]);V.push(_e),V.push(Fe),V.push(0),ke>0&&(De+=ee?(he*Fe-_e*de)/2:Math.sqrt(Math.pow(_e-he,2)+Math.pow(Fe-de,2))),he=_e,de=Fe}var Je=V.length-3;V[2]=1,xe(V,0,Je,H),V[Je+2]=1,V.size=Math.abs(De),V.start=0,V.end=V.size}function Wr(le,V,H,ee){for(var he=0;he<le.length;he++){var de=[];wr(le[he],de,H,ee),V.push(de)}}function Xe(le){return le/360+.5}function Fr(le){var V=Math.sin(le*Math.PI/180),H=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return H<0?0:H>1?1:H}function na(le,V,H,ee,he,de,De,ke){if(ee/=V,de>=(H/=V)&&De<ee)return le;if(De<H||de>=ee)return null;for(var _e=[],Fe=0;Fe<le.length;Fe++){var Je=le[Fe],Qe=Je.geometry,B=Je.type,J=he===0?Je.minX:Je.minY,K=he===0?Je.maxX:Je.maxY;if(J>=H&&K<ee)_e.push(Je);else if(!(K<H||J>=ee)){var X=[];if(B==="Point"||B==="MultiPoint")ur(Qe,X,H,ee,he);else if(B==="LineString")qt(Qe,X,H,ee,he,!1,ke.lineMetrics);else if(B==="MultiLineString")Sa(Qe,X,H,ee,he,!1);else if(B==="Polygon")Sa(Qe,X,H,ee,he,!0);else if(B==="MultiPolygon")for(var Q=0;Q<Qe.length;Q++){var re=[];Sa(Qe[Q],re,H,ee,he,!0),re.length&&X.push(re)}if(X.length){if(ke.lineMetrics&&B==="LineString"){for(Q=0;Q<X.length;Q++)_e.push(Jt(Je.id,B,X[Q],Je.tags));continue}B!=="LineString"&&B!=="MultiLineString"||(X.length===1?(B="LineString",X=X[0]):B="MultiLineString"),B!=="Point"&&B!=="MultiPoint"||(B=X.length===3?"Point":"MultiPoint"),_e.push(Jt(Je.id,B,X,Je.tags))}}}return _e.length?_e:null}function ur(le,V,H,ee,he){for(var de=0;de<le.length;de+=3){var De=le[de+he];De>=H&&De<=ee&&(V.push(le[de]),V.push(le[de+1]),V.push(le[de+2]))}}function qt(le,V,H,ee,he,de,De){for(var ke,_e,Fe=Zr(le),Je=he===0?zr:fa,Qe=le.start,B=0;B<le.length-3;B+=3){var J=le[B],K=le[B+1],X=le[B+2],Q=le[B+3],re=le[B+4],Ne=he===0?J:K,Ze=he===0?Q:re,Le=!1;De&&(ke=Math.sqrt(Math.pow(J-Q,2)+Math.pow(K-re,2))),Ne<H?Ze>H&&(_e=Je(Fe,J,K,Q,re,H),De&&(Fe.start=Qe+ke*_e)):Ne>ee?Ze<ee&&(_e=Je(Fe,J,K,Q,re,ee),De&&(Fe.start=Qe+ke*_e)):ua(Fe,J,K,X),Ze<H&&Ne>=H&&(_e=Je(Fe,J,K,Q,re,H),Le=!0),Ze>ee&&Ne<=ee&&(_e=Je(Fe,J,K,Q,re,ee),Le=!0),!de&&Le&&(De&&(Fe.end=Qe+ke*_e),V.push(Fe),Fe=Zr(le)),De&&(Qe+=ke)}var ze=le.length-3;J=le[ze],K=le[ze+1],X=le[ze+2],(Ne=he===0?J:K)>=H&&Ne<=ee&&ua(Fe,J,K,X),ze=Fe.length-3,de&&ze>=3&&(Fe[ze]!==Fe[0]||Fe[ze+1]!==Fe[1])&&ua(Fe,Fe[0],Fe[1],Fe[2]),Fe.length&&V.push(Fe)}function Zr(le){var V=[];return V.size=le.size,V.start=le.start,V.end=le.end,V}function Sa(le,V,H,ee,he,de){for(var De=0;De<le.length;De++)qt(le[De],V,H,ee,he,de,!1)}function ua(le,V,H,ee){le.push(V),le.push(H),le.push(ee)}function zr(le,V,H,ee,he,de){var De=(de-V)/(ee-V);return le.push(de),le.push(H+(he-H)*De),le.push(1),De}function fa(le,V,H,ee,he,de){var De=(de-H)/(he-H);return le.push(V+(ee-V)*De),le.push(de),le.push(1),De}function Xt(le,V){for(var H=[],ee=0;ee<le.length;ee++){var he,de=le[ee],De=de.type;if(De==="Point"||De==="MultiPoint"||De==="LineString")he=Sr(de.geometry,V);else if(De==="MultiLineString"||De==="Polygon"){he=[];for(var ke=0;ke<de.geometry.length;ke++)he.push(Sr(de.geometry[ke],V))}else if(De==="MultiPolygon")for(he=[],ke=0;ke<de.geometry.length;ke++){for(var _e=[],Fe=0;Fe<de.geometry[ke].length;Fe++)_e.push(Sr(de.geometry[ke][Fe],V));he.push(_e)}H.push(Jt(de.id,De,he,de.tags))}return H}function Sr(le,V){var H=[];H.size=le.size,le.start!==void 0&&(H.start=le.start,H.end=le.end);for(var ee=0;ee<le.length;ee+=3)H.push(le[ee]+V,le[ee+1],le[ee+2]);return H}function lt(le,V){if(le.transformed)return le;var H,ee,he,de=1<<le.z,De=le.x,ke=le.y;for(H=0;H<le.features.length;H++){var _e=le.features[H],Fe=_e.geometry,Je=_e.type;if(_e.geometry=[],Je===1)for(ee=0;ee<Fe.length;ee+=2)_e.geometry.push(Mt(Fe[ee],Fe[ee+1],V,de,De,ke));else for(ee=0;ee<Fe.length;ee++){var Qe=[];for(he=0;he<Fe[ee].length;he+=2)Qe.push(Mt(Fe[ee][he],Fe[ee][he+1],V,de,De,ke));_e.geometry.push(Qe)}}return le.transformed=!0,le}function Mt(le,V,H,ee,he,de){return[Math.round(H*(le*ee-he)),Math.round(H*(V*ee-de))]}function Ut(le,V,H,ee,he){for(var de=V===he.maxZoom?0:he.tolerance/((1<<V)*he.extent),De={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:H,y:ee,z:V,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ke=0;ke<le.length;ke++){De.numFeatures++,gr(De,le[ke],de,he);var _e=le[ke].minX,Fe=le[ke].minY,Je=le[ke].maxX,Qe=le[ke].maxY;_e<De.minX&&(De.minX=_e),Fe<De.minY&&(De.minY=Fe),Je>De.maxX&&(De.maxX=Je),Qe>De.maxY&&(De.maxY=Qe)}return De}function gr(le,V,H,ee){var he=V.geometry,de=V.type,De=[];if(de==="Point"||de==="MultiPoint")for(var ke=0;ke<he.length;ke+=3)De.push(he[ke]),De.push(he[ke+1]),le.numPoints++,le.numSimplified++;else if(de==="LineString")tr(De,he,le,H,!1,!1);else if(de==="MultiLineString"||de==="Polygon")for(ke=0;ke<he.length;ke++)tr(De,he[ke],le,H,de==="Polygon",ke===0);else if(de==="MultiPolygon")for(var _e=0;_e<he.length;_e++){var Fe=he[_e];for(ke=0;ke<Fe.length;ke++)tr(De,Fe[ke],le,H,!0,ke===0)}if(De.length){var Je=V.tags||null;if(de==="LineString"&&ee.lineMetrics){for(var Qe in Je={},V.tags)Je[Qe]=V.tags[Qe];Je.mapbox_clip_start=he.start/he.size,Je.mapbox_clip_end=he.end/he.size}var B={geometry:De,type:de==="Polygon"||de==="MultiPolygon"?3:de==="LineString"||de==="MultiLineString"?2:1,tags:Je};V.id!==null&&(B.id=V.id),le.features.push(B)}}function tr(le,V,H,ee,he,de){var De=ee*ee;if(ee>0&&V.size<(he?De:ee))H.numPoints+=V.length/3;else{for(var ke=[],_e=0;_e<V.length;_e+=3)(ee===0||V[_e+2]>De)&&(H.numSimplified++,ke.push(V[_e]),ke.push(V[_e+1])),H.numPoints++;he&&function(Fe,Je){for(var Qe=0,B=0,J=Fe.length,K=J-2;B<J;K=B,B+=2)Qe+=(Fe[B]-Fe[K])*(Fe[B+1]+Fe[K+1]);if(Qe>0===Je)for(B=0,J=Fe.length;B<J/2;B+=2){var X=Fe[B],Q=Fe[B+1];Fe[B]=Fe[J-2-B],Fe[B+1]=Fe[J-1-B],Fe[J-2-B]=X,Fe[J-1-B]=Q}}(ke,de),le.push(ke)}}function it(le,V){var H=(V=this.options=function(he,de){for(var De in de)he[De]=de[De];return he}(Object.create(this.options),V)).debug;if(H&&console.time("preprocess data"),V.maxZoom<0||V.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(V.promoteId&&V.generateId)throw new Error("promoteId and generateId cannot be used together.");var ee=function(he,de){var De=[];if(he.type==="FeatureCollection")for(var ke=0;ke<he.features.length;ke++)Zt(De,he.features[ke],de,ke);else Zt(De,he.type==="Feature"?he:{geometry:he},de);return De}(le,V);this.tiles={},this.tileCoords=[],H&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",V.indexMaxZoom,V.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ee=function(he,de){var De=de.buffer/de.extent,ke=he,_e=na(he,1,-1-De,De,0,-1,2,de),Fe=na(he,1,1-De,2+De,0,-1,2,de);return(_e||Fe)&&(ke=na(he,1,-De,1+De,0,-1,2,de)||[],_e&&(ke=Xt(_e,1).concat(ke)),Fe&&(ke=ke.concat(Xt(Fe,-1)))),ke}(ee,V),ee.length&&this.splitTile(ee,0,0,0),H&&(ee.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Nt(le,V,H){return 32*((1<<le)*H+V)+le}function jt(le,V){return V?le.properties[V]:le.id}function Lr(le,V){if(le==null)return!0;if(le.type==="Feature")return jt(le,V)!=null;if(le.type==="FeatureCollection"){const H=new Set;for(const ee of le.features){const he=jt(ee,V);if(he==null||H.has(he))return!1;H.add(he)}return!0}return!1}function sa(le,V){const H=new Map;if(le!=null)if(le.type==="Feature")H.set(jt(le,V),le);else for(const ee of le.features)H.set(jt(ee,V),ee);return H}it.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},it.prototype.splitTile=function(le,V,H,ee,he,de,De){for(var ke=[le,V,H,ee],_e=this.options,Fe=_e.debug;ke.length;){ee=ke.pop(),H=ke.pop(),V=ke.pop(),le=ke.pop();var Je=1<<V,Qe=Nt(V,H,ee),B=this.tiles[Qe];if(!B&&(Fe>1&&console.time("creation"),B=this.tiles[Qe]=Ut(le,V,H,ee,_e),this.tileCoords.push({z:V,x:H,y:ee}),Fe)){Fe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",V,H,ee,B.numFeatures,B.numPoints,B.numSimplified),console.timeEnd("creation"));var J="z"+V;this.stats[J]=(this.stats[J]||0)+1,this.total++}if(B.source=le,he){if(V===_e.maxZoom||V===he)continue;var K=1<<he-V;if(H!==Math.floor(de/K)||ee!==Math.floor(De/K))continue}else if(V===_e.indexMaxZoom||B.numPoints<=_e.indexMaxPoints)continue;if(B.source=null,le.length!==0){Fe>1&&console.time("clipping");var X,Q,re,Ne,Ze,Le,ze=.5*_e.buffer/_e.extent,je=.5-ze,at=.5+ze,gt=1+ze;X=Q=re=Ne=null,Ze=na(le,Je,H-ze,H+at,0,B.minX,B.maxX,_e),Le=na(le,Je,H+je,H+gt,0,B.minX,B.maxX,_e),le=null,Ze&&(X=na(Ze,Je,ee-ze,ee+at,1,B.minY,B.maxY,_e),Q=na(Ze,Je,ee+je,ee+gt,1,B.minY,B.maxY,_e),Ze=null),Le&&(re=na(Le,Je,ee-ze,ee+at,1,B.minY,B.maxY,_e),Ne=na(Le,Je,ee+je,ee+gt,1,B.minY,B.maxY,_e),Le=null),Fe>1&&console.timeEnd("clipping"),ke.push(X||[],V+1,2*H,2*ee),ke.push(Q||[],V+1,2*H,2*ee+1),ke.push(re||[],V+1,2*H+1,2*ee),ke.push(Ne||[],V+1,2*H+1,2*ee+1)}}},it.prototype.getTile=function(le,V,H){var ee=this.options,he=ee.extent,de=ee.debug;if(le<0||le>24)return null;var De=1<<le,ke=Nt(le,V=(V%De+De)%De,H);if(this.tiles[ke])return lt(this.tiles[ke],he);de>1&&console.log("drilling down to z%d-%d-%d",le,V,H);for(var _e,Fe=le,Je=V,Qe=H;!_e&&Fe>0;)Fe--,Je=Math.floor(Je/2),Qe=Math.floor(Qe/2),_e=this.tiles[Nt(Fe,Je,Qe)];return _e&&_e.source?(de>1&&console.log("found parent tile z%d-%d-%d",Fe,Je,Qe),de>1&&console.time("drilling down"),this.splitTile(_e.source,Fe,Je,Qe,le,V,H),de>1&&console.timeEnd("drilling down"),this.tiles[ke]?lt(this.tiles[ke],he):null):null};class Kt extends z{constructor(V,H,ee,he){super(V,H,ee),this._dataUpdateable=new Map,this.loadGeoJSON=(de,De)=>{const{promoteId:ke}=de;if(de.request)return o.f(de.request,(_e,Fe,Je,Qe)=>{this._dataUpdateable=Lr(Fe,ke)?sa(Fe,ke):void 0,De(_e,Fe,Je,Qe)});if(typeof de.data=="string")try{const _e=JSON.parse(de.data);this._dataUpdateable=Lr(_e,ke)?sa(_e,ke):void 0,De(null,_e)}catch{De(new Error(`Input data given to '${de.source}' is not a valid GeoJSON object.`))}else de.dataDiff?this._dataUpdateable?(function(_e,Fe,Je){var Qe,B,J,K;if(Fe.removeAll&&_e.clear(),Fe.remove)for(const X of Fe.remove)_e.delete(X);if(Fe.add)for(const X of Fe.add){const Q=jt(X,Je);Q!=null&&_e.set(Q,X)}if(Fe.update)for(const X of Fe.update){let Q=_e.get(X.id);if(Q==null)continue;const re=!X.removeAllProperties&&(((Qe=X.removeProperties)===null||Qe===void 0?void 0:Qe.length)>0||((B=X.addOrUpdateProperties)===null||B===void 0?void 0:B.length)>0);if((X.newGeometry||X.removeAllProperties||re)&&(Q=Object.assign({},Q),_e.set(X.id,Q),re&&(Q.properties=Object.assign({},Q.properties))),X.newGeometry&&(Q.geometry=X.newGeometry),X.removeAllProperties)Q.properties={};else if(((J=X.removeProperties)===null||J===void 0?void 0:J.length)>0)for(const Ne of X.removeProperties)Object.prototype.hasOwnProperty.call(Q.properties,Ne)&&delete Q.properties[Ne];if(((K=X.addOrUpdateProperties)===null||K===void 0?void 0:K.length)>0)for(const{key:Ne,value:Ze}of X.addOrUpdateProperties)Q.properties[Ne]=Ze}}(this._dataUpdateable,de.dataDiff,ke),De(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):De(new Error(`Cannot update existing geojson data in ${de.source}`)):De(new Error(`Input data given to '${de.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},this.loadVectorData=this.loadGeoJSONTile,he&&(this.loadGeoJSON=he)}loadGeoJSONTile(V,H){const ee=V.tileID.canonical;if(!this._geoJSONIndex)return H(null,null);const he=this._geoJSONIndex.getTile(ee.z,ee.x,ee.y);if(!he)return H(null,null);const de=new class{constructor(ke){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.N,this.length=ke.length,this._features=ke}feature(ke){return new class{constructor(_e){this._feature=_e,this.extent=o.N,this.type=_e.type,this.properties=_e.tags,"id"in _e&&!isNaN(_e.id)&&(this.id=parseInt(_e.id,10))}loadGeometry(){if(this._feature.type===1){const _e=[];for(const Fe of this._feature.geometry)_e.push([new o.P(Fe[0],Fe[1])]);return _e}{const _e=[];for(const Fe of this._feature.geometry){const Je=[];for(const Qe of Fe)Je.push(new o.P(Qe[0],Qe[1]));_e.push(Je)}return _e}}toGeoJSON(_e,Fe,Je){return pe.call(this,_e,Fe,Je)}}(this._features[ke])}}(he.features);let De=qe(de);De.byteOffset===0&&De.byteLength===De.buffer.byteLength||(De=new Uint8Array(De)),H(null,{vectorTile:de,rawData:De.buffer})}loadData(V,H){var ee;(ee=this._pendingRequest)===null||ee===void 0||ee.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const he=!!(V&&V.request&&V.request.collectResourceTiming)&&new o.bu(V.request);this._pendingCallback=H,this._pendingRequest=this.loadGeoJSON(V,(de,De)=>{if(delete this._pendingCallback,delete this._pendingRequest,de||!De)return H(de);if(typeof De!="object")return H(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`));{ie(De,!0);try{if(V.filter){const _e=o.bC(V.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(_e.result==="error")throw new Error(_e.value.map(Je=>`${Je.key}: ${Je.message}`).join(", "));De={type:"FeatureCollection",features:De.features.filter(Je=>_e.value.evaluate({zoom:0},Je))}}this._geoJSONIndex=V.cluster?new Ye(function({superclusterOptions:_e,clusterProperties:Fe}){if(!Fe||!_e)return _e;const Je={},Qe={},B={accumulated:null,zoom:0},J={properties:null},K=Object.keys(Fe);for(const X of K){const[Q,re]=Fe[X],Ne=o.bC(re),Ze=o.bC(typeof Q=="string"?[Q,["accumulated"],["get",X]]:Q);Je[X]=Ne.value,Qe[X]=Ze.value}return _e.map=X=>{J.properties=X;const Q={};for(const re of K)Q[re]=Je[re].evaluate(B,J);return Q},_e.reduce=(X,Q)=>{J.properties=Q;for(const re of K)B.accumulated=X[re],X[re]=Qe[re].evaluate(B,J)},_e}(V)).load(De.features):function(_e,Fe){return new it(_e,Fe)}(De,V.geojsonVtOptions)}catch(_e){return H(_e)}this.loaded={};const ke={};if(he){const _e=he.finish();_e&&(ke.resourceTiming={},ke.resourceTiming[V.source]=JSON.parse(JSON.stringify(_e)))}H(null,ke)}})}reloadTile(V,H){const ee=this.loaded;return ee&&ee[V.uid]?super.reloadTile(V,H):this.loadTile(V,H)}removeSource(V,H){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),H()}getClusterExpansionZoom(V,H){try{H(null,this._geoJSONIndex.getClusterExpansionZoom(V.clusterId))}catch(ee){H(ee)}}getClusterChildren(V,H){try{H(null,this._geoJSONIndex.getChildren(V.clusterId))}catch(ee){H(ee)}}getClusterLeaves(V,H){try{H(null,this._geoJSONIndex.getLeaves(V.clusterId,V.limit,V.offset))}catch(ee){H(ee)}}}class Ya{constructor(V){this.self=V,this.actor=new o.C(V,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:z,geojson:Kt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(H,ee)=>{if(this.workerSourceTypes[H])throw new Error(`Worker source with name "${H}" already registered.`);this.workerSourceTypes[H]=ee},this.self.registerRTLTextPlugin=H=>{if(o.bD.isParsed())throw new Error("RTL text plugin already registered.");o.bD.applyArabicShaping=H.applyArabicShaping,o.bD.processBidirectionalText=H.processBidirectionalText,o.bD.processStyledBidirectionalText=H.processStyledBidirectionalText}}setReferrer(V,H){this.referrer=H}setImages(V,H,ee){this.availableImages[V]=H;for(const he in this.workerSources[V]){const de=this.workerSources[V][he];for(const De in de)de[De].availableImages=H}ee()}setLayers(V,H,ee){this.getLayerIndex(V).replace(H),ee()}updateLayers(V,H,ee){this.getLayerIndex(V).update(H.layers,H.removedIds),ee()}loadTile(V,H,ee){this.getWorkerSource(V,H.type,H.source).loadTile(H,ee)}loadDEMTile(V,H,ee){this.getDEMWorkerSource(V,H.source).loadTile(H,ee)}reloadTile(V,H,ee){this.getWorkerSource(V,H.type,H.source).reloadTile(H,ee)}abortTile(V,H,ee){this.getWorkerSource(V,H.type,H.source).abortTile(H,ee)}removeTile(V,H,ee){this.getWorkerSource(V,H.type,H.source).removeTile(H,ee)}removeDEMTile(V,H){this.getDEMWorkerSource(V,H.source).removeTile(H)}removeSource(V,H,ee){if(!this.workerSources[V]||!this.workerSources[V][H.type]||!this.workerSources[V][H.type][H.source])return;const he=this.workerSources[V][H.type][H.source];delete this.workerSources[V][H.type][H.source],he.removeSource!==void 0?he.removeSource(H,ee):ee()}loadWorkerSource(V,H,ee){try{this.self.importScripts(H.url),ee()}catch(he){ee(he.toString())}}syncRTLPluginState(V,H,ee){try{o.bD.setState(H);const he=o.bD.getPluginURL();if(o.bD.isLoaded()&&!o.bD.isParsed()&&he!=null){this.self.importScripts(he);const de=o.bD.isParsed();ee(de?void 0:new Error(`RTL Text Plugin failed to import scripts from ${he}`),de)}}catch(he){ee(he.toString())}}getAvailableImages(V){let H=this.availableImages[V];return H||(H=[]),H}getLayerIndex(V){let H=this.layerIndexes[V];return H||(H=this.layerIndexes[V]=new S),H}getWorkerSource(V,H,ee){return this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][H]||(this.workerSources[V][H]={}),this.workerSources[V][H][ee]||(this.workerSources[V][H][ee]=new this.workerSourceTypes[H]({send:(he,de,De)=>{this.actor.send(he,de,De,V)}},this.getLayerIndex(V),this.getAvailableImages(V))),this.workerSources[V][H][ee]}getDEMWorkerSource(V,H){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][H]||(this.demWorkerSources[V][H]=new U),this.demWorkerSources[V][H]}}return o.i()&&(self.worker=new Ya(self)),Ya}),m(["./shared"],function(o){var S="3.6.2";class b{static testProp(r){if(!b.docStyle)return r[0];for(let l=0;l<r.length;l++)if(r[l]in b.docStyle)return r[l];return r[0]}static create(r,l,f){const p=window.document.createElement(r);return l!==void 0&&(p.className=l),f&&f.appendChild(p),p}static createNS(r,l){return window.document.createElementNS(r,l)}static disableDrag(){b.docStyle&&b.selectProp&&(b.userSelect=b.docStyle[b.selectProp],b.docStyle[b.selectProp]="none")}static enableDrag(){b.docStyle&&b.selectProp&&(b.docStyle[b.selectProp]=b.userSelect)}static setTransform(r,l){r.style[b.transformProp]=l}static addEventListener(r,l,f,p={}){r.addEventListener(l,f,"passive"in p?p:p.capture)}static removeEventListener(r,l,f,p={}){r.removeEventListener(l,f,"passive"in p?p:p.capture)}static suppressClickInternal(r){r.preventDefault(),r.stopPropagation(),window.removeEventListener("click",b.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",b.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",b.suppressClickInternal,!0)},0)}static mousePos(r,l){const f=r.getBoundingClientRect();return new o.P(l.clientX-f.left-r.clientLeft,l.clientY-f.top-r.clientTop)}static touchPos(r,l){const f=r.getBoundingClientRect(),p=[];for(let y=0;y<l.length;y++)p.push(new o.P(l[y].clientX-f.left-r.clientLeft,l[y].clientY-f.top-r.clientTop));return p}static mouseButton(r){return r.button}static remove(r){r.parentNode&&r.parentNode.removeChild(r)}}b.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,b.selectProp=b.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),b.transformProp=b.testProp(["transform","WebkitTransform"]);const C={supported:!1,testSupport:function(g){!z&&L&&(U?N(g):M=g)}};let M,L,z=!1,U=!1;function N(g){const r=g.createTexture();g.bindTexture(g.TEXTURE_2D,r);try{if(g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,L),g.isContextLost())return;C.supported=!0}catch{}g.deleteTexture(r),z=!0}var G,ie;typeof document<"u"&&(L=document.createElement("img"),L.onload=function(){M&&N(M),M=null,U=!0},L.onerror=function(){z=!0,M=null},L.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(g){let r,l,f,p;g.resetRequestQueue=()=>{r=[],l=0,f=0,p={}},g.addThrottleControl=F=>{const D=f++;return p[D]=F,D},g.removeThrottleControl=F=>{delete p[F],E()},g.getImage=(F,D,R=!0)=>{C.supported&&(F.headers||(F.headers={}),F.headers.accept="image/webp,*/*");const q={requestParameters:F,supportImageRefresh:R,callback:D,cancelled:!1,completed:!1,cancel:()=>{q.completed||q.cancelled||(q.cancelled=!0,q.innerRequest&&(q.innerRequest.cancel(),l--),E())}};return r.push(q),E(),q};const y=F=>{const{requestParameters:D,supportImageRefresh:R,callback:q}=F;return o.e(D,{type:"image"}),(R!==!1||o.i()||o.g(D.url)||D.headers&&!Object.keys(D.headers).reduce((oe,se)=>oe&&se==="accept",!0)?o.m:A)(D,(oe,se,ce,ae)=>{T(F,q,oe,se,ce,ae)})},T=(F,D,R,q,oe,se)=>{R?D(R):q instanceof HTMLImageElement||o.a(q)?D(null,q):q&&((ce,ae)=>{typeof createImageBitmap=="function"?o.b(ce,ae):o.d(ce,ae)})(q,(ce,ae)=>{ce!=null?D(ce):ae!=null&&D(null,ae,{cacheControl:oe,expires:se})}),F.cancelled||(F.completed=!0,l--,E())},E=()=>{const F=(()=>{const D=Object.keys(p);let R=!1;if(D.length>0){for(const q of D)if(R=p[q](),R)break}return R})()?o.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:o.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let D=l;D<F&&r.length>0;D++){const R=r.shift();if(R.cancelled){D--;continue}const q=y(R);l++,R.innerRequest=q}},A=(F,D)=>{const R=new Image,q=F.url;let oe=!1;const se=F.credentials;return se&&se==="include"?R.crossOrigin="use-credentials":(se&&se==="same-origin"||!o.s(q))&&(R.crossOrigin="anonymous"),R.fetchPriority="high",R.onload=()=>{D(null,R),R.onerror=R.onload=null},R.onerror=()=>{oe||D(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),R.onerror=R.onload=null},R.src=q,{cancel:()=>{oe=!0,R.src=""}}}}(G||(G={})),G.resetRequestQueue(),function(g){g.Glyphs="Glyphs",g.Image="Image",g.Source="Source",g.SpriteImage="SpriteImage",g.SpriteJSON="SpriteJSON",g.Style="Style",g.Tile="Tile",g.Unknown="Unknown"}(ie||(ie={}));class pe{constructor(r){this._transformRequestFn=r}transformRequest(r,l){return this._transformRequestFn&&this._transformRequestFn(r,l)||{url:r}}normalizeSpriteURL(r,l,f){const p=function(y){const T=y.match(Y);if(!T)throw new Error(`Unable to parse URL "${y}"`);return{protocol:T[1],authority:T[2],path:T[3]||"/",params:T[4]?T[4].split("&"):[]}}(r);return p.path+=`${l}${f}`,function(y){const T=y.params.length?`?${y.params.join("&")}`:"";return`${y.protocol}://${y.authority}${y.path}${T}`}(p)}setTransformRequest(r){this._transformRequestFn=r}}const Y=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function me(g){var r=new o.A(3);return r[0]=g[0],r[1]=g[1],r[2]=g[2],r}var ve,we=function(g,r,l){return g[0]=r[0]-l[0],g[1]=r[1]-l[1],g[2]=r[2]-l[2],g};ve=new o.A(3),o.A!=Float32Array&&(ve[0]=0,ve[1]=0,ve[2]=0);var te=function(g){var r=g[0],l=g[1];return r*r+l*l};function Be(g){const r=[];if(typeof g=="string")r.push({id:"default",url:g});else if(g&&g.length>0){const l=[];for(const{id:f,url:p}of g){const y=`${f}${p}`;l.indexOf(y)===-1&&(l.push(y),r.push({id:f,url:p}))}}return r}function Ce(g,r,l,f,p){if(f)return void g(f);if(p!==Object.values(r).length||p!==Object.values(l).length)return;const y={};for(const T in r){y[T]={};const E=o.h.getImageCanvasContext(l[T]),A=r[T];for(const F in A){const{width:D,height:R,x:q,y:oe,sdf:se,pixelRatio:ce,stretchX:ae,stretchY:Ie,content:Ve}=A[F];y[T][F]={data:null,pixelRatio:ce,sdf:se,stretchX:ae,stretchY:Ie,content:Ve,spriteData:{width:D,height:R,x:q,y:oe,context:E}}}}g(null,y)}(function(){var g=new o.A(2);o.A!=Float32Array&&(g[0]=0,g[1]=0)})();class Ue{constructor(r,l,f,p){this.context=r,this.format=f,this.texture=r.gl.createTexture(),this.update(l,p)}update(r,l,f){const{width:p,height:y}=r,T=!(this.size&&this.size[0]===p&&this.size[1]===y||f),{context:E}=this,{gl:A}=E;if(this.useMipmap=!!(l&&l.useMipmap),A.bindTexture(A.TEXTURE_2D,this.texture),E.pixelStoreUnpackFlipY.set(!1),E.pixelStoreUnpack.set(1),E.pixelStoreUnpackPremultiplyAlpha.set(this.format===A.RGBA&&(!l||l.premultiply!==!1)),T)this.size=[p,y],r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||o.a(r)?A.texImage2D(A.TEXTURE_2D,0,this.format,this.format,A.UNSIGNED_BYTE,r):A.texImage2D(A.TEXTURE_2D,0,this.format,p,y,0,this.format,A.UNSIGNED_BYTE,r.data);else{const{x:F,y:D}=f||{x:0,y:0};r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||o.a(r)?A.texSubImage2D(A.TEXTURE_2D,0,F,D,A.RGBA,A.UNSIGNED_BYTE,r):A.texSubImage2D(A.TEXTURE_2D,0,F,D,p,y,A.RGBA,A.UNSIGNED_BYTE,r.data)}this.useMipmap&&this.isSizePowerOfTwo()&&A.generateMipmap(A.TEXTURE_2D)}bind(r,l,f){const{context:p}=this,{gl:y}=p;y.bindTexture(y.TEXTURE_2D,this.texture),f!==y.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(f=y.LINEAR),r!==this.filter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,r),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,f||r),this.filter=r),l!==this.wrap&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,l),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,l),this.wrap=l)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}function $e(g){const{userImage:r}=g;return!!(r&&r.render&&r.render())&&(g.data.replace(new Uint8Array(r.data.buffer)),!0)}class Re extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(r){if(this.loaded!==r&&(this.loaded=r,r)){for(const{ids:l,callback:f}of this.requestors)this._notify(l,f);this.requestors=[]}}getImage(r){const l=this.images[r];if(l&&!l.data&&l.spriteData){const f=l.spriteData;l.data=new o.R({width:f.width,height:f.height},f.context.getImageData(f.x,f.y,f.width,f.height).data),l.spriteData=null}return l}addImage(r,l){if(this.images[r])throw new Error(`Image id ${r} already exist, use updateImage instead`);this._validate(r,l)&&(this.images[r]=l)}_validate(r,l){let f=!0;const p=l.data||l.spriteData;return this._validateStretch(l.stretchX,p&&p.width)||(this.fire(new o.j(new Error(`Image "${r}" has invalid "stretchX" value`))),f=!1),this._validateStretch(l.stretchY,p&&p.height)||(this.fire(new o.j(new Error(`Image "${r}" has invalid "stretchY" value`))),f=!1),this._validateContent(l.content,l)||(this.fire(new o.j(new Error(`Image "${r}" has invalid "content" value`))),f=!1),f}_validateStretch(r,l){if(!r)return!0;let f=0;for(const p of r){if(p[0]<f||p[1]<p[0]||l<p[1])return!1;f=p[1]}return!0}_validateContent(r,l){if(!r)return!0;if(r.length!==4)return!1;const f=l.spriteData,p=f&&f.width||l.data.width,y=f&&f.height||l.data.height;return!(r[0]<0||p<r[0]||r[1]<0||y<r[1]||r[2]<0||p<r[2]||r[3]<0||y<r[3]||r[2]<r[0]||r[3]<r[1])}updateImage(r,l,f=!0){const p=this.getImage(r);if(f&&(p.data.width!==l.data.width||p.data.height!==l.data.height))throw new Error(`size mismatch between old image (${p.data.width}x${p.data.height}) and new image (${l.data.width}x${l.data.height}).`);l.version=p.version+1,this.images[r]=l,this.updatedImages[r]=!0}removeImage(r){const l=this.images[r];delete this.images[r],delete this.patterns[r],l.userImage&&l.userImage.onRemove&&l.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(r,l){let f=!0;if(!this.isLoaded())for(const p of r)this.images[p]||(f=!1);this.isLoaded()||f?this._notify(r,l):this.requestors.push({ids:r,callback:l})}_notify(r,l){const f={};for(const p of r){let y=this.getImage(p);y||(this.fire(new o.k("styleimagemissing",{id:p})),y=this.getImage(p)),y?f[p]={data:y.data.clone(),pixelRatio:y.pixelRatio,sdf:y.sdf,version:y.version,stretchX:y.stretchX,stretchY:y.stretchY,content:y.content,hasRenderCallback:!!(y.userImage&&y.userImage.render)}:o.w(`Image "${p}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}l(null,f)}getPixelSize(){const{width:r,height:l}=this.atlasImage;return{width:r,height:l}}getPattern(r){const l=this.patterns[r],f=this.getImage(r);if(!f)return null;if(l&&l.position.version===f.version)return l.position;if(l)l.position.version=f.version;else{const p={w:f.data.width+2,h:f.data.height+2,x:0,y:0},y=new o.I(p,f);this.patterns[r]={bin:p,position:y}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){const l=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Ue(r,this.atlasImage,l.RGBA),this.atlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE)}_updatePatternAtlas(){const r=[];for(const y in this.patterns)r.push(this.patterns[y].bin);const{w:l,h:f}=o.p(r),p=this.atlasImage;p.resize({width:l||1,height:f||1});for(const y in this.patterns){const{bin:T}=this.patterns[y],E=T.x+1,A=T.y+1,F=this.getImage(y).data,D=F.width,R=F.height;o.R.copy(F,p,{x:0,y:0},{x:E,y:A},{width:D,height:R}),o.R.copy(F,p,{x:0,y:R-1},{x:E,y:A-1},{width:D,height:1}),o.R.copy(F,p,{x:0,y:0},{x:E,y:A+R},{width:D,height:1}),o.R.copy(F,p,{x:D-1,y:0},{x:E-1,y:A},{width:1,height:R}),o.R.copy(F,p,{x:0,y:0},{x:E+D,y:A},{width:1,height:R})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(r){for(const l of r){if(this.callbackDispatchedThisFrame[l])continue;this.callbackDispatchedThisFrame[l]=!0;const f=this.getImage(l);f||o.w(`Image with ID: "${l}" was not found`),$e(f)&&this.updateImage(l,f)}}}const st=1e20;function pt(g,r,l,f,p,y,T,E,A){for(let F=r;F<r+f;F++)ot(g,l*y+F,y,p,T,E,A);for(let F=l;F<l+p;F++)ot(g,F*y+r,1,f,T,E,A)}function ot(g,r,l,f,p,y,T){y[0]=0,T[0]=-st,T[1]=st,p[0]=g[r];for(let E=1,A=0,F=0;E<f;E++){p[E]=g[r+E*l];const D=E*E;do{const R=y[A];F=(p[E]-p[R]+D-R*R)/(E-R)/2}while(F<=T[A]&&--A>-1);A++,y[A]=E,T[A]=F,T[A+1]=st}for(let E=0,A=0;E<f;E++){for(;T[A+1]<E;)A++;const F=y[A],D=E-F;g[r+E*l]=p[F]+D*D}}class _t{constructor(r,l){this.requestManager=r,this.localIdeographFontFamily=l,this.entries={}}setURL(r){this.url=r}getGlyphs(r,l){const f=[];for(const p in r)for(const y of r[p])f.push({stack:p,id:y});o.o(f,({stack:p,id:y},T)=>{let E=this.entries[p];E||(E=this.entries[p]={glyphs:{},requests:{},ranges:{}});let A=E.glyphs[y];if(A!==void 0)return void T(null,{stack:p,id:y,glyph:A});if(A=this._tinySDF(E,p,y),A)return E.glyphs[y]=A,void T(null,{stack:p,id:y,glyph:A});const F=Math.floor(y/256);if(256*F>65535)return void T(new Error("glyphs > 65535 not supported"));if(E.ranges[F])return void T(null,{stack:p,id:y,glyph:A});if(!this.url)return void T(new Error("glyphsUrl is not set"));let D=E.requests[F];D||(D=E.requests[F]=[],_t.loadGlyphRange(p,F,this.url,this.requestManager,(R,q)=>{if(q){for(const oe in q)this._doesCharSupportLocalGlyph(+oe)||(E.glyphs[+oe]=q[+oe]);E.ranges[F]=!0}for(const oe of D)oe(R,q);delete E.requests[F]})),D.push((R,q)=>{R?T(R):q&&T(null,{stack:p,id:y,glyph:q[y]||null})})},(p,y)=>{if(p)l(p);else if(y){const T={};for(const{stack:E,id:A,glyph:F}of y)(T[E]||(T[E]={}))[A]=F&&{id:F.id,bitmap:F.bitmap.clone(),metrics:F.metrics};l(null,T)}})}_doesCharSupportLocalGlyph(r){return!!this.localIdeographFontFamily&&(o.u["CJK Unified Ideographs"](r)||o.u["Hangul Syllables"](r)||o.u.Hiragana(r)||o.u.Katakana(r))}_tinySDF(r,l,f){const p=this.localIdeographFontFamily;if(!p||!this._doesCharSupportLocalGlyph(f))return;let y=r.tinySDF;if(!y){let E="400";/bold/i.test(l)?E="900":/medium/i.test(l)?E="500":/light/i.test(l)&&(E="200"),y=r.tinySDF=new _t.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:p,fontWeight:E})}const T=y.draw(String.fromCharCode(f));return{id:f,bitmap:new o.q({width:T.width||60,height:T.height||60},T.data),metrics:{width:T.glyphWidth/2||24,height:T.glyphHeight/2||24,left:T.glyphLeft/2+.5||0,top:T.glyphTop/2-27.5||-8,advance:T.glyphAdvance/2||24,isDoubleResolution:!0}}}}_t.loadGlyphRange=function(g,r,l,f,p){const y=256*r,T=y+255,E=f.transformRequest(l.replace("{fontstack}",g).replace("{range}",`${y}-${T}`),ie.Glyphs);o.l(E,(A,F)=>{if(A)p(A);else if(F){const D={};for(const R of o.n(F))D[R.id]=R;p(null,D)}})},_t.TinySDF=class{constructor({fontSize:g=24,buffer:r=3,radius:l=8,cutoff:f=.25,fontFamily:p="sans-serif",fontWeight:y="normal",fontStyle:T="normal"}={}){this.buffer=r,this.cutoff=f,this.radius=l;const E=this.size=g+4*r,A=this._createCanvas(E),F=this.ctx=A.getContext("2d",{willReadFrequently:!0});F.font=`${T} ${y} ${g}px ${p}`,F.textBaseline="alphabetic",F.textAlign="left",F.fillStyle="black",this.gridOuter=new Float64Array(E*E),this.gridInner=new Float64Array(E*E),this.f=new Float64Array(E),this.z=new Float64Array(E+1),this.v=new Uint16Array(E)}_createCanvas(g){const r=document.createElement("canvas");return r.width=r.height=g,r}draw(g){const{width:r,actualBoundingBoxAscent:l,actualBoundingBoxDescent:f,actualBoundingBoxLeft:p,actualBoundingBoxRight:y}=this.ctx.measureText(g),T=Math.ceil(l),E=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(y-p))),A=Math.min(this.size-this.buffer,T+Math.ceil(f)),F=E+2*this.buffer,D=A+2*this.buffer,R=Math.max(F*D,0),q=new Uint8ClampedArray(R),oe={data:q,width:F,height:D,glyphWidth:E,glyphHeight:A,glyphTop:T,glyphLeft:0,glyphAdvance:r};if(E===0||A===0)return oe;const{ctx:se,buffer:ce,gridInner:ae,gridOuter:Ie}=this;se.clearRect(ce,ce,E,A),se.fillText(g,ce,ce+T);const Ve=se.getImageData(ce,ce,E,A);Ie.fill(st,0,R),ae.fill(0,0,R);for(let ge=0;ge<A;ge++)for(let Pe=0;Pe<E;Pe++){const He=Ve.data[4*(ge*E+Pe)+3]/255;if(He===0)continue;const We=(ge+ce)*F+Pe+ce;if(He===1)Ie[We]=0,ae[We]=st;else{const et=.5-He;Ie[We]=et>0?et*et:0,ae[We]=et<0?et*et:0}}pt(Ie,0,0,F,D,F,this.f,this.v,this.z),pt(ae,ce,ce,E,A,F,this.f,this.v,this.z);for(let ge=0;ge<R;ge++){const Pe=Math.sqrt(Ie[ge])-Math.sqrt(ae[ge]);q[ge]=Math.round(255-255*(Pe/this.radius+this.cutoff))}return oe}};class ft{constructor(){this.specification=o.v.light.position}possiblyEvaluate(r,l){return o.z(r.expression.evaluate(l))}interpolate(r,l,f){return{x:o.B.number(r.x,l.x,f),y:o.B.number(r.y,l.y,f),z:o.B.number(r.z,l.z,f)}}}let ir;class qe extends o.E{constructor(r){super(),ir=ir||new o.r({anchor:new o.D(o.v.light.anchor),position:new ft,color:new o.D(o.v.light.color),intensity:new o.D(o.v.light.intensity)}),this._transitionable=new o.T(ir),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,l={}){if(!this._validate(o.t,r,l))for(const f in r){const p=r[f];f.endsWith("-transition")?this._transitionable.setTransition(f.slice(0,-11),p):this._transitionable.setValue(f,p)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,l,f){return(!f||f.validate!==!1)&&o.x(this,r.call(o.y,o.e({value:l,style:{glyphs:!0,sprite:!0},styleSpec:o.v})))}}class $t{constructor(r,l){this.width=r,this.height=l,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(r,l){const f=r.join(",")+String(l);return this.dashEntry[f]||(this.dashEntry[f]=this.addDash(r,l)),this.dashEntry[f]}getDashRanges(r,l,f){const p=[];let y=r.length%2==1?-r[r.length-1]*f:0,T=r[0]*f,E=!0;p.push({left:y,right:T,isDash:E,zeroLength:r[0]===0});let A=r[0];for(let F=1;F<r.length;F++){E=!E;const D=r[F];y=A*f,A+=D,T=A*f,p.push({left:y,right:T,isDash:E,zeroLength:D===0})}return p}addRoundDash(r,l,f){const p=l/2;for(let y=-f;y<=f;y++){const T=this.width*(this.nextRow+f+y);let E=0,A=r[E];for(let F=0;F<this.width;F++){F/A.right>1&&(A=r[++E]);const D=Math.abs(F-A.left),R=Math.abs(F-A.right),q=Math.min(D,R);let oe;const se=y/f*(p+1);if(A.isDash){const ce=p-Math.abs(se);oe=Math.sqrt(q*q+ce*ce)}else oe=p-Math.sqrt(q*q+se*se);this.data[T+F]=Math.max(0,Math.min(255,oe+128))}}}addRegularDash(r){for(let E=r.length-1;E>=0;--E){const A=r[E],F=r[E+1];A.zeroLength?r.splice(E,1):F&&F.isDash===A.isDash&&(F.left=A.left,r.splice(E,1))}const l=r[0],f=r[r.length-1];l.isDash===f.isDash&&(l.left=f.left-this.width,f.right=l.right+this.width);const p=this.width*this.nextRow;let y=0,T=r[y];for(let E=0;E<this.width;E++){E/T.right>1&&(T=r[++y]);const A=Math.abs(E-T.left),F=Math.abs(E-T.right),D=Math.min(A,F);this.data[p+E]=Math.max(0,Math.min(255,(T.isDash?D:-D)+128))}}addDash(r,l){const f=l?7:0,p=2*f+1;if(this.nextRow+p>this.height)return o.w("LineAtlas out of space"),null;let y=0;for(let E=0;E<r.length;E++)y+=r[E];if(y!==0){const E=this.width/y,A=this.getDashRanges(r,this.width,E);l?this.addRoundDash(A,E,f):this.addRegularDash(A)}const T={y:(this.nextRow+f+.5)/this.height,height:2*f/this.height,width:y};return this.nextRow+=p,this.dirty=!0,T}bind(r){const l=r.gl;this.texture?(l.bindTexture(l.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,l.texSubImage2D(l.TEXTURE_2D,0,0,0,this.width,this.height,l.ALPHA,l.UNSIGNED_BYTE,this.data))):(this.texture=l.createTexture(),l.bindTexture(l.TEXTURE_2D,this.texture),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.REPEAT),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.REPEAT),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.LINEAR),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.LINEAR),l.texImage2D(l.TEXTURE_2D,0,l.ALPHA,this.width,this.height,0,l.ALPHA,l.UNSIGNED_BYTE,this.data))}}class Dt{constructor(r,l,f){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=f;const p=this.workerPool.acquire(f);for(let y=0;y<p.length;y++){const T=new o.C(p[y],l,f);T.name=`Worker ${y}`,this.actors.push(T)}if(!this.actors.length)throw new Error("No actors found")}broadcast(r,l,f){o.o(this.actors,(p,y)=>{p.send(r,l,y)},f=f||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(r=!0){this.actors.forEach(l=>{l.remove()}),this.actors=[],r&&this.workerPool.release(this.id)}}function ue(g,r,l){const f=function(p,y){if(p)return l(p);if(y){const T=o.F(o.e(y,g),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);y.vector_layers&&(T.vectorLayers=y.vector_layers,T.vectorLayerIds=T.vectorLayers.map(E=>E.id)),l(null,T)}};return g.url?o.f(r.transformRequest(g.url,ie.Source),f):o.h.frame(()=>f(null,g))}class be{constructor(r,l){r&&(l?this.setSouthWest(r).setNorthEast(l):Array.isArray(r)&&(r.length===4?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1])))}setNorthEast(r){return this._ne=r instanceof o.L?new o.L(r.lng,r.lat):o.L.convert(r),this}setSouthWest(r){return this._sw=r instanceof o.L?new o.L(r.lng,r.lat):o.L.convert(r),this}extend(r){const l=this._sw,f=this._ne;let p,y;if(r instanceof o.L)p=r,y=r;else{if(!(r instanceof be))return Array.isArray(r)?r.length===4||r.every(Array.isArray)?this.extend(be.convert(r)):this.extend(o.L.convert(r)):r&&("lng"in r||"lon"in r)&&"lat"in r?this.extend(o.L.convert(r)):this;if(p=r._sw,y=r._ne,!p||!y)return this}return l||f?(l.lng=Math.min(p.lng,l.lng),l.lat=Math.min(p.lat,l.lat),f.lng=Math.max(y.lng,f.lng),f.lat=Math.max(y.lat,f.lat)):(this._sw=new o.L(p.lng,p.lat),this._ne=new o.L(y.lng,y.lat)),this}getCenter(){return new o.L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new o.L(this.getWest(),this.getNorth())}getSouthEast(){return new o.L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:l,lat:f}=o.L.convert(r);let p=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&p}static convert(r){return r instanceof be?r:r&&new be(r)}static fromLngLat(r,l=0){const f=360*l/40075017,p=f/Math.cos(Math.PI/180*r.lat);return new be(new o.L(r.lng-p,r.lat-f),new o.L(r.lng+p,r.lat+f))}}class Te{constructor(r,l,f){this.bounds=be.convert(this.validateBounds(r)),this.minzoom=l||0,this.maxzoom=f||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const l=Math.pow(2,r.z),f=Math.floor(o.G(this.bounds.getWest())*l),p=Math.floor(o.H(this.bounds.getNorth())*l),y=Math.ceil(o.G(this.bounds.getEast())*l),T=Math.ceil(o.H(this.bounds.getSouth())*l);return r.x>=f&&r.x<y&&r.y>=p&&r.y<T}}class Ae extends o.E{constructor(r,l,f,p){if(super(),this.load=()=>{this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this._tileJSONRequest=ue(this._options,this.map._requestManager,(y,T)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),y?this.fire(new o.j(y)):T&&(o.e(this,T),T.bounds&&(this.tileBounds=new Te(T.bounds,this.minzoom,this.maxzoom)),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>o.e({},this._options),this.id=r,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.e(this,o.F(l,["url","scheme","tileSize","promoteId"])),this._options=o.e({type:"vector"},l),this._collectResourceTiming=l.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p)}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}setSourceProperty(r){this._tileJSONRequest&&this._tileJSONRequest.cancel(),r(),this.load()}setTiles(r){return this.setSourceProperty(()=>{this._options.tiles=r}),this}setUrl(r){return this.setSourceProperty(()=>{this.url=r,this._options.url=r}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(r,l){const f=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p={request:this.map._requestManager.transformRequest(f,ie.Tile),uid:r.uid,tileID:r.tileID,zoom:r.tileID.overscaledZ,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function y(T,E){return delete r.request,r.aborted?l(null):T&&T.status!==404?l(T):(E&&E.resourceTiming&&(r.resourceTiming=E.resourceTiming),this.map._refreshExpiredTiles&&E&&r.setExpiryData(E),r.loadVectorData(E,this.map.painter),l(null),void(r.reloadCallback&&(this.loadTile(r,r.reloadCallback),r.reloadCallback=null)))}p.request.collectResourceTiming=this._collectResourceTiming,r.actor&&r.state!=="expired"?r.state==="loading"?r.reloadCallback=l:r.request=r.actor.send("reloadTile",p,y.bind(this)):(r.actor=this.dispatcher.getActor(),r.request=r.actor.send("loadTile",p,y.bind(this)))}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id},void 0)}unloadTile(r){r.unloadVectorData(),r.actor&&r.actor.send("removeTile",{uid:r.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Ye extends o.E{constructor(r,l,f,p){super(),this.id=r,this.dispatcher=f,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.e({type:"raster"},l),o.e(this,o.F(l,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this._tileJSONRequest=ue(this._options,this.map._requestManager,(r,l)=>{this._tileJSONRequest=null,this._loaded=!0,r?this.fire(new o.j(r)):l&&(o.e(this,l),l.bounds&&(this.tileBounds=new Te(l.bounds,this.minzoom,this.maxzoom)),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}setSourceProperty(r){this._tileJSONRequest&&this._tileJSONRequest.cancel(),r(),this.load()}setTiles(r){return this.setSourceProperty(()=>{this._options.tiles=r}),this}serialize(){return o.e({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,l){const f=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);r.request=G.getImage(this.map._requestManager.transformRequest(f,ie.Tile),(p,y,T)=>{if(delete r.request,r.aborted)r.state="unloaded",l(null);else if(p)r.state="errored",l(p);else if(y){this.map._refreshExpiredTiles&&T&&r.setExpiryData(T);const E=this.map.painter.context,A=E.gl;r.texture=this.map.painter.getTileTexture(y.width),r.texture?r.texture.update(y,{useMipmap:!0}):(r.texture=new Ue(E,y,A.RGBA,{useMipmap:!0}),r.texture.bind(A.LINEAR,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),E.extTextureFilterAnisotropic&&A.texParameterf(A.TEXTURE_2D,E.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,E.extTextureFilterAnisotropicMax)),r.state="loaded",l(null)}},this.map._refreshExpiredTiles)}abortTile(r,l){r.request&&(r.request.cancel(),delete r.request),l()}unloadTile(r,l){r.texture&&this.map.painter.saveTileTexture(r.texture),l()}hasTransition(){return!1}}class mt extends Ye{constructor(r,l,f,p){super(r,l,f,p),this.type="raster-dem",this.maxzoom=22,this._options=o.e({type:"raster-dem"},l),this.encoding=l.encoding||"mapbox",this.redFactor=l.redFactor,this.greenFactor=l.greenFactor,this.blueFactor=l.blueFactor,this.baseShift=l.baseShift}loadTile(r,l){const f=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p=this.map._requestManager.transformRequest(f,ie.Tile);function y(T,E){T&&(r.state="errored",l(T)),E&&(r.dem=E,r.needsHillshadePrepare=!0,r.needsTerrainPrepare=!0,r.state="loaded",l(null))}r.neighboringTiles=this._getNeighboringTiles(r.tileID),r.request=G.getImage(p,(T,E,A)=>o._(this,void 0,void 0,function*(){if(delete r.request,r.aborted)r.state="unloaded",l(null);else if(T)r.state="errored",l(T);else if(E){this.map._refreshExpiredTiles&&r.setExpiryData(A);const F=o.a(E)&&o.J()?E:yield function(R){return o._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&o.K()){const q=R.width+2,oe=R.height+2;try{return new o.R({width:q,height:oe},yield o.M(R,-1,-1,q,oe))}catch{}}return o.h.getImageData(R,1)})}(E),D={uid:r.uid,coord:r.tileID,source:this.id,rawImageData:F,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};r.actor&&r.state!=="expired"||(r.actor=this.dispatcher.getActor(),r.actor.send("loadDEMTile",D,y))}}),this.map._refreshExpiredTiles)}_getNeighboringTiles(r){const l=r.canonical,f=Math.pow(2,l.z),p=(l.x-1+f)%f,y=l.x===0?r.wrap-1:r.wrap,T=(l.x+1+f)%f,E=l.x+1===f?r.wrap+1:r.wrap,A={};return A[new o.O(r.overscaledZ,y,l.z,p,l.y).key]={backfilled:!1},A[new o.O(r.overscaledZ,E,l.z,T,l.y).key]={backfilled:!1},l.y>0&&(A[new o.O(r.overscaledZ,y,l.z,p,l.y-1).key]={backfilled:!1},A[new o.O(r.overscaledZ,r.wrap,l.z,l.x,l.y-1).key]={backfilled:!1},A[new o.O(r.overscaledZ,E,l.z,T,l.y-1).key]={backfilled:!1}),l.y+1<f&&(A[new o.O(r.overscaledZ,y,l.z,p,l.y+1).key]={backfilled:!1},A[new o.O(r.overscaledZ,r.wrap,l.z,l.x,l.y+1).key]={backfilled:!1},A[new o.O(r.overscaledZ,E,l.z,T,l.y+1).key]={backfilled:!1}),A}unloadTile(r){r.demTexture&&this.map.painter.saveTileTexture(r.demTexture),r.fbo&&(r.fbo.destroy(),delete r.fbo),r.dem&&delete r.dem,delete r.neighboringTiles,r.state="unloaded",r.actor&&r.actor.send("removeDEMTile",{uid:r.uid,source:this.id})}}class wt extends o.E{constructor(r,l,f,p){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>o.e({},this._options,{type:this.type,data:this._data}),this.id=r,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=f.getActor(),this.setEventedParent(p),this._data=l.data,this._options=o.e({},l),this._collectResourceTiming=l.collectResourceTiming,l.maxzoom!==void 0&&(this.maxzoom=l.maxzoom),l.type&&(this.type=l.type),l.attribution&&(this.attribution=l.attribution),this.promoteId=l.promoteId;const y=o.N/this.tileSize;this.workerOptions=o.e({source:this.id,cluster:l.cluster||!1,geojsonVtOptions:{buffer:(l.buffer!==void 0?l.buffer:128)*y,tolerance:(l.tolerance!==void 0?l.tolerance:.375)*y,extent:o.N,maxZoom:this.maxzoom,lineMetrics:l.lineMetrics||!1,generateId:l.generateId||!1},superclusterOptions:{maxZoom:l.clusterMaxZoom!==void 0?l.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,l.clusterMinPoints||2),extent:o.N,radius:(l.clusterRadius||50)*y,log:!1,generateId:l.generateId||!1},clusterProperties:l.clusterProperties,filter:l.filter},l.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(r){this.map=r,this.load()}setData(r){return this._data=r,this._updateWorkerData(),this}updateData(r){return this._updateWorkerData(r),this}setClusterOptions(r){return this.workerOptions.cluster=r.cluster,r&&(r.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=r.clusterRadius),r.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=r.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(r,l){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:r,source:this.id},l),this}getClusterChildren(r,l){return this.actor.send("geojson.getClusterChildren",{clusterId:r,source:this.id},l),this}getClusterLeaves(r,l,f,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:r,limit:l,offset:f},p),this}_updateWorkerData(r){const l=o.e({},this.workerOptions);r?l.dataDiff=r:typeof this._data=="string"?(l.request=this.map._requestManager.transformRequest(o.h.resolveURL(this._data),ie.Source),l.request.collectResourceTiming=this._collectResourceTiming):l.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new o.k("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,l,(f,p)=>{if(this._pendingLoads--,this._removed||p&&p.abandoned)return void this.fire(new o.k("dataabort",{dataType:"source"}));let y=null;if(p&&p.resourceTiming&&p.resourceTiming[this.id]&&(y=p.resourceTiming[this.id].slice(0)),f)return void this.fire(new o.j(f));const T={dataType:"source"};this._collectResourceTiming&&y&&y.length>0&&o.e(T,{resourceTiming:y}),this.fire(new o.k("data",Object.assign(Object.assign({},T),{sourceDataType:"metadata"}))),this.fire(new o.k("data",Object.assign(Object.assign({},T),{sourceDataType:"content"})))})}loaded(){return this._pendingLoads===0}loadTile(r,l){const f=r.actor?"reloadTile":"loadTile";r.actor=this.actor;const p={type:this.type,uid:r.uid,tileID:r.tileID,zoom:r.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};r.request=this.actor.send(f,p,(y,T)=>(delete r.request,r.unloadVectorData(),r.aborted?l(null):y?l(y):(r.loadVectorData(T,this.map.painter,f==="reloadTile"),l(null))))}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.aborted=!0}unloadTile(r){r.unloadVectorData(),this.actor.send("removeTile",{uid:r.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var ut=o.Q([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class rt extends o.E{constructor(r,l,f,p){super(),this.load=(y,T)=>{this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=G.getImage(this.map._requestManager.transformRequest(this.url,ie.Image),(E,A)=>{this._request=null,this._loaded=!0,E?this.fire(new o.j(E)):A&&(this.image=A,y&&(this.coordinates=y),T&&T(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;const y=this.map.painter.context,T=y.gl;this.boundsBuffer||(this.boundsBuffer=y.createVertexBuffer(this._boundsArray,ut.members)),this.boundsSegments||(this.boundsSegments=o.S.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Ue(y,this.image,T.RGBA),this.texture.bind(T.LINEAR,T.CLAMP_TO_EDGE));let E=!1;for(const A in this.tiles){const F=this.tiles[A];F.state!=="loaded"&&(F.state="loaded",F.texture=this.texture,E=!0)}E&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=r,this.dispatcher=f,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(p),this.options=l}loaded(){return this._loaded}updateImage(r){return r.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=r.url,this.load(r.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(r){this.coordinates=r;const l=r.map(o.U.fromLngLat);this.tileID=function(p){let y=1/0,T=1/0,E=-1/0,A=-1/0;for(const q of p)y=Math.min(y,q.x),T=Math.min(T,q.y),E=Math.max(E,q.x),A=Math.max(A,q.y);const F=Math.max(E-y,A-T),D=Math.max(0,Math.floor(-Math.log(F)/Math.LN2)),R=Math.pow(2,D);return new o.W(D,Math.floor((y+E)/2*R),Math.floor((T+A)/2*R))}(l),this.minzoom=this.maxzoom=this.tileID.z;const f=l.map(p=>this.tileID.getTilePoint(p)._round());return this._boundsArray=new o.V,this._boundsArray.emplaceBack(f[0].x,f[0].y,0,0),this._boundsArray.emplaceBack(f[1].x,f[1].y,o.N,0),this._boundsArray.emplaceBack(f[3].x,f[3].y,0,o.N),this._boundsArray.emplaceBack(f[2].x,f[2].y,o.N,o.N),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(r,l){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},l(null)):(r.state="errored",l(null))}hasTransition(){return!1}}class Yt extends rt{constructor(r,l,f,p){super(r,l,f,p),this.load=()=>{this._loaded=!1;const y=this.options;this.urls=[];for(const T of y.urls)this.urls.push(this.map._requestManager.transformRequest(T,ie.Source).url);o.X(this.urls,(T,E)=>{this._loaded=!0,T?this.fire(new o.j(T)):E&&(this.video=E,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const y=this.map.painter.context,T=y.gl;this.boundsBuffer||(this.boundsBuffer=y.createVertexBuffer(this._boundsArray,ut.members)),this.boundsSegments||(this.boundsSegments=o.S.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(T.LINEAR,T.CLAMP_TO_EDGE),T.texSubImage2D(T.TEXTURE_2D,0,0,0,T.RGBA,T.UNSIGNED_BYTE,this.video)):(this.texture=new Ue(y,this.video,T.RGBA),this.texture.bind(T.LINEAR,T.CLAMP_TO_EDGE));let E=!1;for(const A in this.tiles){const F=this.tiles[A];F.state!=="loaded"&&(F.state="loaded",F.texture=this.texture,E=!0)}E&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=l}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(r){if(this.video){const l=this.video.seekable;r<l.start(0)||r>l.end(0)?this.fire(new o.j(new o.Y(`sources.${this.id}`,null,`Playback for this video can be set only between the ${l.start(0)} and ${l.end(0)}-second mark.`))):this.video.currentTime=r}}getVideo(){return this.video}onAdd(r){this.map||(this.map=r,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class xe extends rt{constructor(r,l,f,p){super(r,l,f,p),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let y=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,y=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,y=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const T=this.map.painter.context,E=T.gl;this.boundsBuffer||(this.boundsBuffer=T.createVertexBuffer(this._boundsArray,ut.members)),this.boundsSegments||(this.boundsSegments=o.S.simpleSegment(0,0,4,2)),this.texture?(y||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Ue(T,this.canvas,E.RGBA,{premultiply:!0});let A=!1;for(const F in this.tiles){const D=this.tiles[F];D.state!=="loaded"&&(D.state="loaded",D.texture=this.texture,A=!0)}A&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),l.coordinates?Array.isArray(l.coordinates)&&l.coordinates.length===4&&!l.coordinates.some(y=>!Array.isArray(y)||y.length!==2||y.some(T=>typeof T!="number"))||this.fire(new o.j(new o.Y(`sources.${r}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.j(new o.Y(`sources.${r}`,null,'missing required property "coordinates"'))),l.animate&&typeof l.animate!="boolean"&&this.fire(new o.j(new o.Y(`sources.${r}`,null,'optional "animate" property must be a boolean value'))),l.canvas?typeof l.canvas=="string"||l.canvas instanceof HTMLCanvasElement||this.fire(new o.j(new o.Y(`sources.${r}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.j(new o.Y(`sources.${r}`,null,'missing required property "canvas"'))),this.options=l,this.animate=l.animate===void 0||l.animate}getCanvas(){return this.canvas}onAdd(r){this.map=r,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const r of[this.canvas.width,this.canvas.height])if(isNaN(r)||r<=0)return!0;return!1}}const er={},Jt=g=>{switch(g){case"geojson":return wt;case"image":return rt;case"raster":return Ye;case"raster-dem":return mt;case"vector":return Ae;case"video":return Yt;case"canvas":return xe}return er[g]};function mr(g,r){const l=o.Z();return o.$(l,l,[1,1,0]),o.a0(l,l,[.5*g.width,.5*g.height,1]),o.a1(l,l,g.calculatePosMatrix(r.toUnwrapped()))}function Zt(g,r,l,f,p,y){const T=function(R,q,oe){if(R)for(const se of R){const ce=q[se];if(ce&&ce.source===oe&&ce.type==="fill-extrusion")return!0}else for(const se in q){const ce=q[se];if(ce.source===oe&&ce.type==="fill-extrusion")return!0}return!1}(p&&p.layers,r,g.id),E=y.maxPitchScaleFactor(),A=g.tilesIn(f,E,T);A.sort(Et);const F=[];for(const R of A)F.push({wrappedTileID:R.tileID.wrapped().key,queryResults:R.tile.queryRenderedFeatures(r,l,g._state,R.queryGeometry,R.cameraQueryGeometry,R.scale,p,y,E,mr(g.transform,R.tileID))});const D=function(R){const q={},oe={};for(const se of R){const ce=se.queryResults,ae=se.wrappedTileID,Ie=oe[ae]=oe[ae]||{};for(const Ve in ce){const ge=ce[Ve],Pe=Ie[Ve]=Ie[Ve]||{},He=q[Ve]=q[Ve]||[];for(const We of ge)Pe[We.featureIndex]||(Pe[We.featureIndex]=!0,He.push(We))}}return q}(F);for(const R in D)D[R].forEach(q=>{const oe=q.feature,se=g.getFeatureState(oe.layer["source-layer"],oe.id);oe.source=oe.layer.source,oe.layer["source-layer"]&&(oe.sourceLayer=oe.layer["source-layer"]),oe.state=se});return D}function Et(g,r){const l=g.tileID,f=r.tileID;return l.overscaledZ-f.overscaledZ||l.canonical.y-f.canonical.y||l.wrap-f.wrap||l.canonical.x-f.canonical.x}class wr{constructor(r,l){this.timeAdded=0,this.fadeEndTime=0,this.tileID=r,this.uid=o.a2(),this.uses=0,this.tileSize=l,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(r){const l=r+this.timeAdded;l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(r){this.demTexture&&r.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(r,l,f){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=function(p,y){const T={};if(!y)return T;for(const E of p){const A=E.layerIds.map(F=>y.getLayer(F)).filter(Boolean);if(A.length!==0){E.layers=A,E.stateDependentLayerIds&&(E.stateDependentLayers=E.stateDependentLayerIds.map(F=>A.filter(D=>D.id===F)[0]));for(const F of A)T[F.id]=E}}return T}(r.buckets,l.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const y=this.buckets[p];if(y instanceof o.a4){if(this.hasSymbolBuckets=!0,!f)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const y=this.buckets[p];if(y instanceof o.a4&&y.hasRTLText){this.hasRTLText=!0,o.a5();break}}this.queryPadding=0;for(const p in this.buckets){const y=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,l.style.getLayer(p).queryRadius(y))}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage)}else this.collisionBoxArray=new o.a3}unloadVectorData(){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(r){return this.buckets[r.id]}upload(r){for(const f in this.buckets){const p=this.buckets[f];p.uploadPending()&&p.upload(r)}const l=r.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Ue(r,this.imageAtlas.image,l.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Ue(r,this.glyphAtlasImage,l.ALPHA),this.glyphAtlasImage=null)}prepare(r){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture)}queryRenderedFeatures(r,l,f,p,y,T,E,A,F,D){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:p,cameraQueryGeometry:y,scale:T,tileSize:this.tileSize,pixelPosMatrix:D,transform:A,params:E,queryPadding:this.queryPadding*F},r,l,f):{}}querySourceFeatures(r,l){const f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;const p=f.loadVTLayers(),y=l&&l.sourceLayer?l.sourceLayer:"",T=p._geojsonTileLayer||p[y];if(!T)return;const E=o.a6(l&&l.filter),{z:A,x:F,y:D}=this.tileID.canonical,R={z:A,x:F,y:D};for(let q=0;q<T.length;q++){const oe=T.feature(q);if(E.needGeometry){const ae=o.a7(oe,!0);if(!E.filter(new o.a8(this.tileID.overscaledZ),ae,this.tileID.canonical))continue}else if(!E.filter(new o.a8(this.tileID.overscaledZ),oe))continue;const se=f.getId(oe,y),ce=new o.a9(oe,A,F,D,se);ce.tile=R,r.push(ce)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){const l=this.expirationTime;if(r.cacheControl){const f=o.aa(r.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const f=Date.now();let p=!1;if(this.expirationTime>f)p=!1;else if(l)if(this.expirationTime<l)p=!0;else{const y=this.expirationTime-l;y?this.expirationTime=f+Math.max(y,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(r,l){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(r).length===0)return;const f=this.latestFeatureIndex.loadVTLayers();for(const p in this.buckets){if(!l.style.hasLayer(p))continue;const y=this.buckets[p],T=y.layers[0].sourceLayer||"_geojsonTileLayer",E=f[T],A=r[T];if(!E||!A||Object.keys(A).length===0)continue;y.update(A,E,this.imageAtlas&&this.imageAtlas.patternPositions||{});const F=l&&l.style&&l.style.getLayer(p);F&&(this.queryPadding=Math.max(this.queryPadding,F.queryRadius(y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.h.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=o.h.now()+r}setDependencies(r,l){const f={};for(const p of l)f[p]=!0;this.dependencies[r]=f}hasDependency(r,l){for(const f of r){const p=this.dependencies[f];if(p){for(const y of l)if(p[y])return!0}}return!1}}class Wr{constructor(r,l){this.max=r,this.onRemove=l,this.reset()}reset(){for(const r in this.data)for(const l of this.data[r])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(r,l,f){const p=r.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);const y={value:l,timeout:void 0};if(f!==void 0&&(y.timeout=setTimeout(()=>{this.remove(r,y)},f)),this.data[p].push(y),this.order.push(p),this.order.length>this.max){const T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const l=this.data[r].shift();return l.timeout&&clearTimeout(l.timeout),this.data[r].length===0&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),l.value}getByKey(r){const l=this.data[r];return l?l[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,l){if(!this.has(r))return this;const f=r.wrapped().key,p=l===void 0?0:this.data[f].indexOf(l),y=this.data[f][p];return this.data[f].splice(p,1),y.timeout&&clearTimeout(y.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(y.value),this.order.splice(this.order.indexOf(f),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(r){const l=[];for(const f in this.data)for(const p of this.data[f])r(p.value)||l.push(p);for(const f of l)this.remove(f.value.tileID,f)}}class Xe{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,l,f){const p=String(l);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][p]=this.stateChanges[r][p]||{},o.e(this.stateChanges[r][p],f),this.deletedStates[r]===null){this.deletedStates[r]={};for(const y in this.state[r])y!==p&&(this.deletedStates[r][y]=null)}else if(this.deletedStates[r]&&this.deletedStates[r][p]===null){this.deletedStates[r][p]={};for(const y in this.state[r][p])f[y]||(this.deletedStates[r][p][y]=null)}else for(const y in f)this.deletedStates[r]&&this.deletedStates[r][p]&&this.deletedStates[r][p][y]===null&&delete this.deletedStates[r][p][y]}removeFeatureState(r,l,f){if(this.deletedStates[r]===null)return;const p=String(l);if(this.deletedStates[r]=this.deletedStates[r]||{},f&&l!==void 0)this.deletedStates[r][p]!==null&&(this.deletedStates[r][p]=this.deletedStates[r][p]||{},this.deletedStates[r][p][f]=null);else if(l!==void 0)if(this.stateChanges[r]&&this.stateChanges[r][p])for(f in this.deletedStates[r][p]={},this.stateChanges[r][p])this.deletedStates[r][p][f]=null;else this.deletedStates[r][p]=null;else this.deletedStates[r]=null}getState(r,l){const f=String(l),p=o.e({},(this.state[r]||{})[f],(this.stateChanges[r]||{})[f]);if(this.deletedStates[r]===null)return{};if(this.deletedStates[r]){const y=this.deletedStates[r][l];if(y===null)return{};for(const T in y)delete p[T]}return p}initializeTileState(r,l){r.setFeatureState(this.state,l)}coalesceChanges(r,l){const f={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const y={};for(const T in this.stateChanges[p])this.state[p][T]||(this.state[p][T]={}),o.e(this.state[p][T],this.stateChanges[p][T]),y[T]=this.state[p][T];f[p]=y}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const y={};if(this.deletedStates[p]===null)for(const T in this.state[p])y[T]={},this.state[p][T]={};else for(const T in this.deletedStates[p]){if(this.deletedStates[p][T]===null)this.state[p][T]={};else for(const E of Object.keys(this.deletedStates[p][T]))delete this.state[p][T][E];y[T]=this.state[p][T]}f[p]=f[p]||{},o.e(f[p],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0)for(const p in r)r[p].setFeatureState(f,l)}}class Fr extends o.E{constructor(r,l,f){super(),this.id=r,this.dispatcher=f,this.on("data",p=>{p.dataType==="source"&&p.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&p.dataType==="source"&&p.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((p,y,T,E)=>{const A=new(Jt(y.type))(p,y,T,E);if(A.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${A.id}`);return A})(r,l,f,this),this._tiles={},this._cache=new Wr(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Xe,this._didEmitContent=!1,this._updated=!1}onAdd(r){this.map=r,this._maxTileCacheSize=r?r._maxTileCacheSize:null,this._maxTileCacheZoomLevels=r?r._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(r)}onRemove(r){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(r)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const r in this._tiles){const l=this._tiles[r];if(l.state!=="loaded"&&l.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(r,l){return this._source.loadTile(r,l)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r,()=>{})}_abortTile(r){this._source.abortTile&&this._source.abortTile(r,()=>{}),this._source.fire(new o.k("dataabort",{tile:r,coord:r.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const l in this._tiles){const f=this._tiles[l];f.upload(r),f.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(r=>r.tileID).sort(na).map(r=>r.key)}getRenderableIds(r){const l=[];for(const f in this._tiles)this._isIdRenderable(f,r)&&l.push(this._tiles[f]);return r?l.sort((f,p)=>{const y=f.tileID,T=p.tileID,E=new o.P(y.canonical.x,y.canonical.y)._rotate(this.transform.angle),A=new o.P(T.canonical.x,T.canonical.y)._rotate(this.transform.angle);return y.overscaledZ-T.overscaledZ||A.y-E.y||A.x-E.x}).map(f=>f.tileID.key):l.map(f=>f.tileID).sort(na).map(f=>f.key)}hasRenderableParent(r){const l=this.findLoadedParent(r,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(r,l){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(l||!this._tiles[r].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)this._tiles[r].state!=="errored"&&this._reloadTile(r,"reloading")}}_reloadTile(r,l){const f=this._tiles[r];f&&(f.state!=="loading"&&(f.state=l),this._loadTile(f,this._tileLoaded.bind(this,f,r,l)))}_tileLoaded(r,l,f,p){if(p)return r.state="errored",void(p.status!==404?this._source.fire(new o.j(p,{tile:r})):this.update(this.transform,this.terrain));r.timeAdded=o.h.now(),f==="expired"&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(l,r),this.getSource().type==="raster-dem"&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),r.aborted||this._source.fire(new o.k("data",{dataType:"source",tile:r,coord:r.tileID}))}_backfillDEM(r){const l=this.getRenderableIds();for(let p=0;p<l.length;p++){const y=l[p];if(r.neighboringTiles&&r.neighboringTiles[y]){const T=this.getTileByID(y);f(r,T),f(T,r)}}function f(p,y){p.needsHillshadePrepare=!0,p.needsTerrainPrepare=!0;let T=y.tileID.canonical.x-p.tileID.canonical.x;const E=y.tileID.canonical.y-p.tileID.canonical.y,A=Math.pow(2,p.tileID.canonical.z),F=y.tileID.key;T===0&&E===0||Math.abs(E)>1||(Math.abs(T)>1&&(Math.abs(T+A)===1?T+=A:Math.abs(T-A)===1&&(T-=A)),y.dem&&p.dem&&(p.dem.backfillBorder(y.dem,T,E),p.neighboringTiles&&p.neighboringTiles[F]&&(p.neighboringTiles[F].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,l,f,p){for(const y in this._tiles){let T=this._tiles[y];if(p[y]||!T.hasData()||T.tileID.overscaledZ<=l||T.tileID.overscaledZ>f)continue;let E=T.tileID;for(;T&&T.tileID.overscaledZ>l+1;){const F=T.tileID.scaledTo(T.tileID.overscaledZ-1);T=this._tiles[F.key],T&&T.hasData()&&(E=F)}let A=E;for(;A.overscaledZ>l;)if(A=A.scaledTo(A.overscaledZ-1),r[A.key]){p[E.key]=E;break}}}findLoadedParent(r,l){if(r.key in this._loadedParentTiles){const f=this._loadedParentTiles[r.key];return f&&f.tileID.overscaledZ>=l?f:null}for(let f=r.overscaledZ-1;f>=l;f--){const p=r.scaledTo(f),y=this._getLoadedTile(p);if(y)return y}}_getLoadedTile(r){const l=this._tiles[r.key];return l&&l.hasData()?l:this._cache.getByKey(r.wrapped().key)}updateCacheSize(r){const l=Math.ceil(r.width/this._source.tileSize)+1,f=Math.ceil(r.height/this._source.tileSize)+1,p=Math.floor(l*f*(this._maxTileCacheZoomLevels===null?o.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._cache.setMaxSize(y)}handleWrapJump(r){const l=Math.round((r-(this._prevLng===void 0?r:this._prevLng))/360);if(this._prevLng=r,l){const f={};for(const p in this._tiles){const y=this._tiles[p];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+l),f[y.tileID.key]=y}this._tiles=f;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(p,this._tiles[p])}}update(r,l){if(this.transform=r,this.terrain=l,!this._sourceLoaded||this._paused)return;let f;this.updateCacheSize(r),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?f=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(D=>new o.O(D.canonical.z,D.wrap,D.canonical.z,D.canonical.x,D.canonical.y)):(f=r.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:l}),this._source.hasTile&&(f=f.filter(D=>this._source.hasTile(D)))):f=[];const p=r.coveringZoomLevel(this._source),y=Math.max(p-Fr.maxOverzooming,this._source.minzoom),T=Math.max(p+Fr.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const D={};for(const R of f)if(R.canonical.z>this._source.minzoom){const q=R.scaledTo(R.canonical.z-1);D[q.key]=q;const oe=R.scaledTo(Math.max(this._source.minzoom,Math.min(R.canonical.z,5)));D[oe.key]=oe}f=f.concat(Object.values(D))}const E=f.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,E&&this.fire(new o.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const A=this._updateRetainedTiles(f,p);if(ur(this._source.type)){const D={},R={},q=Object.keys(A),oe=o.h.now();for(const se of q){const ce=A[se],ae=this._tiles[se];if(!ae||ae.fadeEndTime!==0&&ae.fadeEndTime<=oe)continue;const Ie=this.findLoadedParent(ce,y);Ie&&(this._addTile(Ie.tileID),D[Ie.tileID.key]=Ie.tileID),R[se]=ce}this._retainLoadedChildren(R,p,T,A);for(const se in D)A[se]||(this._coveredTiles[se]=!0,A[se]=D[se]);if(l){const se={},ce={};for(const ae of f)this._tiles[ae.key].hasData()?se[ae.key]=ae:ce[ae.key]=ae;for(const ae in ce){const Ie=ce[ae].children(this._source.maxzoom);this._tiles[Ie[0].key]&&this._tiles[Ie[1].key]&&this._tiles[Ie[2].key]&&this._tiles[Ie[3].key]&&(se[Ie[0].key]=A[Ie[0].key]=Ie[0],se[Ie[1].key]=A[Ie[1].key]=Ie[1],se[Ie[2].key]=A[Ie[2].key]=Ie[2],se[Ie[3].key]=A[Ie[3].key]=Ie[3],delete ce[ae])}for(const ae in ce){const Ie=this.findLoadedParent(ce[ae],this._source.minzoom);if(Ie){se[Ie.tileID.key]=A[Ie.tileID.key]=Ie.tileID;for(const Ve in se)se[Ve].isChildOf(Ie.tileID)&&delete se[Ve]}}for(const ae in this._tiles)se[ae]||(this._coveredTiles[ae]=!0)}}for(const D in A)this._tiles[D].clearFadeHold();const F=o.ab(this._tiles,A);for(const D of F){const R=this._tiles[D];R.hasSymbolBuckets&&!R.holdingForFade()?R.setHoldDuration(this.map._fadeDuration):R.hasSymbolBuckets&&!R.symbolFadeFinished()||this._removeTile(D)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(r)}_updateRetainedTiles(r,l){const f={},p={},y=Math.max(l-Fr.maxOverzooming,this._source.minzoom),T=Math.max(l+Fr.maxUnderzooming,this._source.minzoom),E={};for(const A of r){const F=this._addTile(A);f[A.key]=A,F.hasData()||l<this._source.maxzoom&&(E[A.key]=A)}this._retainLoadedChildren(E,l,T,f);for(const A of r){let F=this._tiles[A.key];if(F.hasData())continue;if(l+1>this._source.maxzoom){const R=A.children(this._source.maxzoom)[0],q=this.getTile(R);if(q&&q.hasData()){f[R.key]=R;continue}}else{const R=A.children(this._source.maxzoom);if(f[R[0].key]&&f[R[1].key]&&f[R[2].key]&&f[R[3].key])continue}let D=F.wasRequested();for(let R=A.overscaledZ-1;R>=y;--R){const q=A.scaledTo(R);if(p[q.key])break;if(p[q.key]=!0,F=this.getTile(q),!F&&D&&(F=this._addTile(q)),F){const oe=F.hasData();if((D||oe)&&(f[q.key]=q),D=F.wasRequested(),oe)break}}}return f}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const l=[];let f,p=this._tiles[r].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){f=this._loadedParentTiles[p.key];break}l.push(p.key);const y=p.scaledTo(p.overscaledZ-1);if(f=this._getLoadedTile(y),f)break;p=y}for(const y of l)this._loadedParentTiles[y]=f}}_addTile(r){let l=this._tiles[r.key];if(l)return l;l=this._cache.getAndRemove(r),l&&(this._setTileReloadTimer(r.key,l),l.tileID=r,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,l)));const f=l;return l||(l=new wr(r,this._source.tileSize*r.overscaleFactor()),this._loadTile(l,this._tileLoaded.bind(this,l,r.key,l.state))),l.uses++,this._tiles[r.key]=l,f||this._source.fire(new o.k("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l}_setTileReloadTimer(r,l){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const f=l.getExpiryTimeout();f&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},f))}_removeTile(r){const l=this._tiles[r];l&&(l.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),l.uses>0||(l.hasData()&&l.state!=="reloading"?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(r);this._cache.reset()}tilesIn(r,l,f){const p=[],y=this.transform;if(!y)return p;const T=f?y.getCameraQueryGeometry(r):r,E=r.map(se=>y.pointCoordinate(se,this.terrain)),A=T.map(se=>y.pointCoordinate(se,this.terrain)),F=this.getIds();let D=1/0,R=1/0,q=-1/0,oe=-1/0;for(const se of A)D=Math.min(D,se.x),R=Math.min(R,se.y),q=Math.max(q,se.x),oe=Math.max(oe,se.y);for(let se=0;se<F.length;se++){const ce=this._tiles[F[se]];if(ce.holdingForFade())continue;const ae=ce.tileID,Ie=Math.pow(2,y.zoom-ce.tileID.overscaledZ),Ve=l*ce.queryPadding*o.N/ce.tileSize/Ie,ge=[ae.getTilePoint(new o.U(D,R)),ae.getTilePoint(new o.U(q,oe))];if(ge[0].x-Ve<o.N&&ge[0].y-Ve<o.N&&ge[1].x+Ve>=0&&ge[1].y+Ve>=0){const Pe=E.map(We=>ae.getTilePoint(We)),He=A.map(We=>ae.getTilePoint(We));p.push({tile:ce,tileID:ae,queryGeometry:Pe,cameraQueryGeometry:He,scale:Ie})}}return p}getVisibleCoordinates(r){const l=this.getRenderableIds(r).map(f=>this._tiles[f].tileID);for(const f of l)f.posMatrix=this.transform.calculatePosMatrix(f.toUnwrapped());return l}hasTransition(){if(this._source.hasTransition())return!0;if(ur(this._source.type)){const r=o.h.now();for(const l in this._tiles)if(this._tiles[l].fadeEndTime>=r)return!0}return!1}setFeatureState(r,l,f){this._state.updateState(r=r||"_geojsonTileLayer",l,f)}removeFeatureState(r,l,f){this._state.removeFeatureState(r=r||"_geojsonTileLayer",l,f)}getFeatureState(r,l){return this._state.getState(r=r||"_geojsonTileLayer",l)}setDependencies(r,l,f){const p=this._tiles[r];p&&p.setDependencies(l,f)}reloadTilesForDependencies(r,l){for(const f in this._tiles)this._tiles[f].hasDependency(r,l)&&this._reloadTile(f,"reloading");this._cache.filter(f=>!f.hasDependency(r,l))}}function na(g,r){const l=Math.abs(2*g.wrap)-+(g.wrap<0),f=Math.abs(2*r.wrap)-+(r.wrap<0);return g.overscaledZ-r.overscaledZ||f-l||r.canonical.y-g.canonical.y||r.canonical.x-g.canonical.x}function ur(g){return g==="raster"||g==="image"||g==="video"}Fr.maxOverzooming=10,Fr.maxUnderzooming=3;const qt="mapboxgl_preloaded_worker_pool";class Zr{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<Zr.workerCount;)this.workers.push(new Worker(o.c.WORKER_URL));return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],this.numActive()===0&&(this.workers.forEach(l=>{l.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[qt]}numActive(){return Object.keys(this.active).length}}const Sa=Math.floor(o.h.hardwareConcurrency/2);let ua;function zr(){return ua||(ua=new Zr),ua}Zr.workerCount=o.ac(globalThis)?Math.max(Math.min(Sa,3),1):1;class fa{constructor(r,l){this.reset(r,l)}reset(r,l){this.points=r||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=o.ad(r,0,1);let l=1,f=this._distances[l];const p=r*this.paddedLength+this.padding;for(;f<p&&l<this._distances.length;)f=this._distances[++l];const y=l-1,T=this._distances[y],E=f-T,A=E>0?(p-T)/E:0;return this.points[y].mult(1-A).add(this.points[l].mult(A))}}function Xt(g,r){let l=!0;return g==="always"||g!=="never"&&r!=="never"||(l=!1),l}class Sr{constructor(r,l,f){const p=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(r/f),this.yCellCount=Math.ceil(l/f);for(let T=0;T<this.xCellCount*this.yCellCount;T++)p.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=l,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,l,f,p,y){this._forEachCell(l,f,p,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(l),this.bboxes.push(f),this.bboxes.push(p),this.bboxes.push(y)}insertCircle(r,l,f,p){this._forEachCell(l-p,f-p,l+p,f+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(l),this.circles.push(f),this.circles.push(p)}_insertBoxCell(r,l,f,p,y,T){this.boxCells[y].push(T)}_insertCircleCell(r,l,f,p,y,T){this.circleCells[y].push(T)}_query(r,l,f,p,y,T,E){if(f<0||r>this.width||p<0||l>this.height)return[];const A=[];if(r<=0&&l<=0&&this.width<=f&&this.height<=p){if(y)return[{key:null,x1:r,y1:l,x2:f,y2:p}];for(let F=0;F<this.boxKeys.length;F++)A.push({key:this.boxKeys[F],x1:this.bboxes[4*F],y1:this.bboxes[4*F+1],x2:this.bboxes[4*F+2],y2:this.bboxes[4*F+3]});for(let F=0;F<this.circleKeys.length;F++){const D=this.circles[3*F],R=this.circles[3*F+1],q=this.circles[3*F+2];A.push({key:this.circleKeys[F],x1:D-q,y1:R-q,x2:D+q,y2:R+q})}}else this._forEachCell(r,l,f,p,this._queryCell,A,{hitTest:y,overlapMode:T,seenUids:{box:{},circle:{}}},E);return A}query(r,l,f,p){return this._query(r,l,f,p,!1,null)}hitTest(r,l,f,p,y,T){return this._query(r,l,f,p,!0,y,T).length>0}hitTestCircle(r,l,f,p,y){const T=r-f,E=r+f,A=l-f,F=l+f;if(E<0||T>this.width||F<0||A>this.height)return!1;const D=[];return this._forEachCell(T,A,E,F,this._queryCellCircle,D,{hitTest:!0,overlapMode:p,circle:{x:r,y:l,radius:f},seenUids:{box:{},circle:{}}},y),D.length>0}_queryCell(r,l,f,p,y,T,E,A){const{seenUids:F,hitTest:D,overlapMode:R}=E,q=this.boxCells[y];if(q!==null){const se=this.bboxes;for(const ce of q)if(!F.box[ce]){F.box[ce]=!0;const ae=4*ce,Ie=this.boxKeys[ce];if(r<=se[ae+2]&&l<=se[ae+3]&&f>=se[ae+0]&&p>=se[ae+1]&&(!A||A(Ie))&&(!D||!Xt(R,Ie.overlapMode))&&(T.push({key:Ie,x1:se[ae],y1:se[ae+1],x2:se[ae+2],y2:se[ae+3]}),D))return!0}}const oe=this.circleCells[y];if(oe!==null){const se=this.circles;for(const ce of oe)if(!F.circle[ce]){F.circle[ce]=!0;const ae=3*ce,Ie=this.circleKeys[ce];if(this._circleAndRectCollide(se[ae],se[ae+1],se[ae+2],r,l,f,p)&&(!A||A(Ie))&&(!D||!Xt(R,Ie.overlapMode))){const Ve=se[ae],ge=se[ae+1],Pe=se[ae+2];if(T.push({key:Ie,x1:Ve-Pe,y1:ge-Pe,x2:Ve+Pe,y2:ge+Pe}),D)return!0}}}return!1}_queryCellCircle(r,l,f,p,y,T,E,A){const{circle:F,seenUids:D,overlapMode:R}=E,q=this.boxCells[y];if(q!==null){const se=this.bboxes;for(const ce of q)if(!D.box[ce]){D.box[ce]=!0;const ae=4*ce,Ie=this.boxKeys[ce];if(this._circleAndRectCollide(F.x,F.y,F.radius,se[ae+0],se[ae+1],se[ae+2],se[ae+3])&&(!A||A(Ie))&&!Xt(R,Ie.overlapMode))return T.push(!0),!0}}const oe=this.circleCells[y];if(oe!==null){const se=this.circles;for(const ce of oe)if(!D.circle[ce]){D.circle[ce]=!0;const ae=3*ce,Ie=this.circleKeys[ce];if(this._circlesCollide(se[ae],se[ae+1],se[ae+2],F.x,F.y,F.radius)&&(!A||A(Ie))&&!Xt(R,Ie.overlapMode))return T.push(!0),!0}}}_forEachCell(r,l,f,p,y,T,E,A){const F=this._convertToXCellCoord(r),D=this._convertToYCellCoord(l),R=this._convertToXCellCoord(f),q=this._convertToYCellCoord(p);for(let oe=F;oe<=R;oe++)for(let se=D;se<=q;se++)if(y.call(this,r,l,f,p,this.xCellCount*se+oe,T,E,A))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,l,f,p,y,T){const E=p-r,A=y-l,F=f+T;return F*F>E*E+A*A}_circleAndRectCollide(r,l,f,p,y,T,E){const A=(T-p)/2,F=Math.abs(r-(p+A));if(F>A+f)return!1;const D=(E-y)/2,R=Math.abs(l-(y+D));if(R>D+f)return!1;if(F<=A||R<=D)return!0;const q=F-A,oe=R-D;return q*q+oe*oe<=f*f}}function lt(g,r,l,f,p){const y=o.Z();return r?(o.a0(y,y,[1/p,1/p,1]),l||o.ae(y,y,f.angle)):o.a1(y,f.labelPlaneMatrix,g),y}function Mt(g,r,l,f,p){if(r){const y=o.af(g);return o.a0(y,y,[p,p,1]),l||o.ae(y,y,-f.angle),y}return f.glCoordMatrix}function Ut(g,r,l){let f;l?(f=[g.x,g.y,l(g.x,g.y),1],o.ag(f,f,r)):(f=[g.x,g.y,0,1],he(f,f,r));const p=f[3];return{point:new o.P(f[0]/p,f[1]/p),signedDistanceFromCamera:p}}function gr(g,r){return .5+g/r*.5}function tr(g,r){const l=g[0]/g[3],f=g[1]/g[3];return l>=-r[0]&&l<=r[0]&&f>=-r[1]&&f<=r[1]}function it(g,r,l,f,p,y,T,E,A,F){const D=f?g.textSizeData:g.iconSizeData,R=o.ah(D,l.transform.zoom),q=[256/l.width*2+1,256/l.height*2+1],oe=f?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;oe.clear();const se=g.lineVertexArray,ce=f?g.text.placedSymbolArray:g.icon.placedSymbolArray,ae=l.transform.width/l.transform.height;let Ie=!1;for(let Ve=0;Ve<ce.length;Ve++){const ge=ce.get(Ve);if(ge.hidden||ge.writingMode===o.ai.vertical&&!Ie){ee(ge.numGlyphs,oe);continue}let Pe;if(Ie=!1,F?(Pe=[ge.anchorX,ge.anchorY,F(ge.anchorX,ge.anchorY),1],o.ag(Pe,Pe,r)):(Pe=[ge.anchorX,ge.anchorY,0,1],he(Pe,Pe,r)),!tr(Pe,q)){ee(ge.numGlyphs,oe);continue}const He=gr(l.transform.cameraToCenterDistance,Pe[3]),We=o.aj(D,R,ge),et=T?We/He:We*He,ct=new o.P(ge.anchorX,ge.anchorY),nt=Ut(ct,p,F).point,xt={projections:{},offsets:{}},Lt=Lr(ge,et,!1,E,r,p,y,g.glyphOffsetArray,se,oe,nt,ct,xt,ae,A,F);Ie=Lt.useVertical,(Lt.notEnoughRoom||Ie||Lt.needsFlipping&&Lr(ge,et,!0,E,r,p,y,g.glyphOffsetArray,se,oe,nt,ct,xt,ae,A,F).notEnoughRoom)&&ee(ge.numGlyphs,oe)}f?g.text.dynamicLayoutVertexBuffer.updateData(oe):g.icon.dynamicLayoutVertexBuffer.updateData(oe)}function Nt(g,r,l,f,p,y,T,E,A,F,D,R,q){const oe=E.glyphStartIndex+E.numGlyphs,se=E.lineStartIndex,ce=E.lineStartIndex+E.lineLength,ae=r.getoffsetX(E.glyphStartIndex),Ie=r.getoffsetX(oe-1),Ve=V(g*ae,l,f,p,y,T,E.segment,se,ce,A,F,D,R,q);if(!Ve)return null;const ge=V(g*Ie,l,f,p,y,T,E.segment,se,ce,A,F,D,R,q);return ge?{first:Ve,last:ge}:null}function jt(g,r,l,f){return g===o.ai.horizontal&&Math.abs(l.y-r.y)>Math.abs(l.x-r.x)*f?{useVertical:!0}:(g===o.ai.vertical?r.y<l.y:r.x>l.x)?{needsFlipping:!0}:null}function Lr(g,r,l,f,p,y,T,E,A,F,D,R,q,oe,se,ce){const ae=r/24,Ie=g.lineOffsetX*ae,Ve=g.lineOffsetY*ae;let ge;if(g.numGlyphs>1){const Pe=g.glyphStartIndex+g.numGlyphs,He=g.lineStartIndex,We=g.lineStartIndex+g.lineLength,et=Nt(ae,E,Ie,Ve,l,D,R,g,A,y,q,se,ce);if(!et)return{notEnoughRoom:!0};const ct=Ut(et.first.point,T,ce).point,nt=Ut(et.last.point,T,ce).point;if(f&&!l){const xt=jt(g.writingMode,ct,nt,oe);if(xt)return xt}ge=[et.first];for(let xt=g.glyphStartIndex+1;xt<Pe-1;xt++)ge.push(V(ae*E.getoffsetX(xt),Ie,Ve,l,D,R,g.segment,He,We,A,y,q,se,ce));ge.push(et.last)}else{if(f&&!l){const He=Ut(R,p,ce).point,We=g.lineStartIndex+g.segment+1,et=new o.P(A.getx(We),A.gety(We)),ct=Ut(et,p,ce),nt=ct.signedDistanceFromCamera>0?ct.point:sa(R,et,He,1,p,ce),xt=jt(g.writingMode,He,nt,oe);if(xt)return xt}const Pe=V(ae*E.getoffsetX(g.glyphStartIndex),Ie,Ve,l,D,R,g.segment,g.lineStartIndex,g.lineStartIndex+g.lineLength,A,y,q,se,ce);if(!Pe)return{notEnoughRoom:!0};ge=[Pe]}for(const Pe of ge)o.ak(F,Pe.point,Pe.angle);return{}}function sa(g,r,l,f,p,y){const T=Ut(g.add(g.sub(r)._unit()),p,y).point,E=l.sub(T);return l.add(E._mult(f/E.mag()))}function Kt(g,r){const{projectionCache:l,lineVertexArray:f,labelPlaneMatrix:p,tileAnchorPoint:y,distanceFromAnchor:T,getElevation:E,previousVertex:A,direction:F,absOffsetX:D}=r;if(l.projections[g])return l.projections[g];const R=new o.P(f.getx(g),f.gety(g)),q=Ut(R,p,E);if(q.signedDistanceFromCamera>0)return l.projections[g]=q.point,q.point;const oe=g-F;return sa(T===0?y:new o.P(f.getx(oe),f.gety(oe)),R,A,D-T+1,p,E)}function Ya(g,r,l){return g._unit()._perp()._mult(r*l)}function le(g,r,l,f,p,y,T,E){const{projectionCache:A,direction:F}=E;if(A.offsets[g])return A.offsets[g];const D=l.add(r);if(g+F<f||g+F>=p)return A.offsets[g]=D,D;const R=Kt(g+F,E),q=Ya(R.sub(l),T,F),oe=l.add(q),se=R.add(q);return A.offsets[g]=o.al(y,D,oe,se)||D,A.offsets[g]}function V(g,r,l,f,p,y,T,E,A,F,D,R,q,oe){const se=f?g-r:g+r;let ce=se>0?1:-1,ae=0;f&&(ce*=-1,ae=Math.PI),ce<0&&(ae+=Math.PI);let Ie,Ve,ge=ce>0?E+T:E+T+1,Pe=p,He=p,We=0,et=0;const ct=Math.abs(se),nt=[];let xt;for(;We+et<=ct;){if(ge+=ce,ge<E||ge>=A)return null;We+=et,He=Pe,Ve=Ie;const bt={projectionCache:R,lineVertexArray:F,labelPlaneMatrix:D,tileAnchorPoint:y,distanceFromAnchor:We,getElevation:oe,previousVertex:He,direction:ce,absOffsetX:ct};if(Pe=Kt(ge,bt),l===0)nt.push(He),xt=Pe.sub(He);else{let Ht;const Ot=Pe.sub(He);Ht=Ot.mag()===0?Ya(Kt(ge+ce,bt).sub(Pe),l,ce):Ya(Ot,l,ce),Ve||(Ve=He.add(Ht)),Ie=le(ge,Ht,Pe,E,A,Ve,l,bt),nt.push(Ve),xt=Ie.sub(Ve)}et=xt.mag()}const Lt=xt._mult((ct-We)/et)._add(Ve||He),lr=ae+Math.atan2(Pe.y-He.y,Pe.x-He.x);return nt.push(Lt),{point:Lt,angle:q?lr:0,path:nt}}const H=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ee(g,r){for(let l=0;l<g;l++){const f=r.length;r.resize(f+4),r.float32.set(H,3*f)}}function he(g,r,l){const f=r[0],p=r[1];return g[0]=l[0]*f+l[4]*p+l[12],g[1]=l[1]*f+l[5]*p+l[13],g[3]=l[3]*f+l[7]*p+l[15],g}const de=100;class De{constructor(r,l=new Sr(r.width+200,r.height+200,25),f=new Sr(r.width+200,r.height+200,25)){this.transform=r,this.grid=l,this.ignoredGrid=f,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+de,this.screenBottomBoundary=r.height+de,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(r,l,f,p,y,T){const E=this.projectAndGetPerspectiveRatio(p,r.anchorPointX,r.anchorPointY,T),A=f*E.perspectiveRatio,F=r.x1*A+E.point.x,D=r.y1*A+E.point.y,R=r.x2*A+E.point.x,q=r.y2*A+E.point.y;return!this.isInsideGrid(F,D,R,q)||l!=="always"&&this.grid.hitTest(F,D,R,q,l,y)||E.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[F,D,R,q],offscreen:this.isOffscreen(F,D,R,q)}}placeCollisionCircles(r,l,f,p,y,T,E,A,F,D,R,q,oe,se){const ce=[],ae=new o.P(l.anchorX,l.anchorY),Ie=Ut(ae,T,se),Ve=gr(this.transform.cameraToCenterDistance,Ie.signedDistanceFromCamera),ge=(D?y/Ve:y*Ve)/o.ap,Pe=Ut(ae,E,se).point,He=Nt(ge,p,l.lineOffsetX*ge,l.lineOffsetY*ge,!1,Pe,ae,l,f,E,{projections:{},offsets:{}},!1,se);let We=!1,et=!1,ct=!0;if(He){const nt=.5*q*Ve+oe,xt=new o.P(-100,-100),Lt=new o.P(this.screenRightBoundary,this.screenBottomBoundary),lr=new fa,bt=He.first,Ht=He.last;let Ot=[];for(let ar=bt.path.length-1;ar>=1;ar--)Ot.push(bt.path[ar]);for(let ar=1;ar<Ht.path.length;ar++)Ot.push(Ht.path[ar]);const Cr=2.5*nt;if(A){const ar=Ot.map(cr=>Ut(cr,A,se));Ot=ar.some(cr=>cr.signedDistanceFromCamera<=0)?[]:ar.map(cr=>cr.point)}let or=[];if(Ot.length>0){const ar=Ot[0].clone(),cr=Ot[0].clone();for(let Yr=1;Yr<Ot.length;Yr++)ar.x=Math.min(ar.x,Ot[Yr].x),ar.y=Math.min(ar.y,Ot[Yr].y),cr.x=Math.max(cr.x,Ot[Yr].x),cr.y=Math.max(cr.y,Ot[Yr].y);or=ar.x>=xt.x&&cr.x<=Lt.x&&ar.y>=xt.y&&cr.y<=Lt.y?[Ot]:cr.x<xt.x||ar.x>Lt.x||cr.y<xt.y||ar.y>Lt.y?[]:o.am([Ot],xt.x,xt.y,Lt.x,Lt.y)}for(const ar of or){lr.reset(ar,.25*nt);let cr=0;cr=lr.length<=.5*nt?1:Math.ceil(lr.paddedLength/Cr)+1;for(let Yr=0;Yr<cr;Yr++){const Ir=Yr/Math.max(cr-1,1),Ca=lr.lerp(Ir),da=Ca.x+de,aa=Ca.y+de;ce.push(da,aa,nt,0);const xi=da-nt,Mr=aa-nt,Wi=da+nt,Zi=aa+nt;if(ct=ct&&this.isOffscreen(xi,Mr,Wi,Zi),et=et||this.isInsideGrid(xi,Mr,Wi,Zi),r!=="always"&&this.grid.hitTestCircle(da,aa,nt,r,R)&&(We=!0,!F))return{circles:[],offscreen:!1,collisionDetected:We}}}}return{circles:!F&&We||!et||Ve<this.perspectiveRatioCutoff?[]:ce,offscreen:ct,collisionDetected:We}}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const l=[];let f=1/0,p=1/0,y=-1/0,T=-1/0;for(const D of r){const R=new o.P(D.x+de,D.y+de);f=Math.min(f,R.x),p=Math.min(p,R.y),y=Math.max(y,R.x),T=Math.max(T,R.y),l.push(R)}const E=this.grid.query(f,p,y,T).concat(this.ignoredGrid.query(f,p,y,T)),A={},F={};for(const D of E){const R=D.key;if(A[R.bucketInstanceId]===void 0&&(A[R.bucketInstanceId]={}),A[R.bucketInstanceId][R.featureIndex])continue;const q=[new o.P(D.x1,D.y1),new o.P(D.x2,D.y1),new o.P(D.x2,D.y2),new o.P(D.x1,D.y2)];o.an(l,q)&&(A[R.bucketInstanceId][R.featureIndex]=!0,F[R.bucketInstanceId]===void 0&&(F[R.bucketInstanceId]=[]),F[R.bucketInstanceId].push(R.featureIndex))}return F}insertCollisionBox(r,l,f,p,y,T){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:y,collisionGroupID:T,overlapMode:l},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,l,f,p,y,T){const E=f?this.ignoredGrid:this.grid,A={bucketInstanceId:p,featureIndex:y,collisionGroupID:T,overlapMode:l};for(let F=0;F<r.length;F+=4)E.insertCircle(A,r[F],r[F+1],r[F+2])}projectAndGetPerspectiveRatio(r,l,f,p){let y;return p?(y=[l,f,p(l,f),1],o.ag(y,y,r)):(y=[l,f,0,1],he(y,y,r)),{point:new o.P((y[0]/y[3]+1)/2*this.transform.width+de,(-y[1]/y[3]+1)/2*this.transform.height+de),perspectiveRatio:.5+this.transform.cameraToCenterDistance/y[3]*.5}}isOffscreen(r,l,f,p){return f<de||r>=this.screenRightBoundary||p<de||l>this.screenBottomBoundary}isInsideGrid(r,l,f,p){return f>=0&&r<this.gridRightBoundary&&p>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const r=o.ao([]);return o.$(r,r,[-100,-100,0]),r}}function ke(g,r,l){return r*(o.N/(g.tileSize*Math.pow(2,l-g.tileID.overscaledZ)))}class _e{constructor(r,l,f,p){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?l:-l))):p&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class Fe{constructor(r,l,f,p,y){this.text=new _e(r?r.text:null,l,f,y),this.icon=new _e(r?r.icon:null,l,p,y)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Je{constructor(r,l,f){this.text=r,this.icon=l,this.skipFade=f}}class Qe{constructor(){this.invProjMatrix=o.Z(),this.viewportMatrix=o.Z(),this.circles=[]}}class B{constructor(r,l,f,p,y){this.bucketInstanceId=r,this.featureIndex=l,this.sourceLayerIndex=f,this.bucketIndex=p,this.tileID=y}}class J{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const l=++this.maxGroupID;this.collisionGroups[r]={ID:l,predicate:f=>f.collisionGroupID===l}}return this.collisionGroups[r]}}function K(g,r,l,f,p){const{horizontalAlign:y,verticalAlign:T}=o.au(g);return new o.P(-(y-.5)*r+f[0]*p,-(T-.5)*l+f[1]*p)}function X(g,r,l,f,p,y){const{x1:T,x2:E,y1:A,y2:F,anchorPointX:D,anchorPointY:R}=g,q=new o.P(r,l);return f&&q._rotate(p?y:-y),{x1:T+q.x,y1:A+q.y,x2:E+q.x,y2:F+q.y,anchorPointX:D,anchorPointY:R}}class Q{constructor(r,l,f,p,y){this.transform=r.clone(),this.terrain=l,this.collisionIndex=new De(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new J(p),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,l,f,p){const y=f.getBucket(l),T=f.latestFeatureIndex;if(!y||!T||l.id!==y.layerIds[0])return;const E=f.collisionBoxArray,A=y.layers[0].layout,F=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),D=f.tileSize/o.N,R=this.transform.calculatePosMatrix(f.tileID.toUnwrapped()),q=A.get("text-pitch-alignment")==="map",oe=A.get("text-rotation-alignment")==="map",se=ke(f,1,this.transform.zoom),ce=lt(R,q,oe,this.transform,se);let ae=null;if(q){const Ve=Mt(R,q,oe,this.transform,se);ae=o.a1([],this.transform.labelPlaneMatrix,Ve)}this.retainedQueryData[y.bucketInstanceId]=new B(y.bucketInstanceId,T,y.sourceLayerIndex,y.index,f.tileID);const Ie={bucket:y,layout:A,posMatrix:R,textLabelPlaneMatrix:ce,labelToScreenMatrix:ae,scale:F,textPixelRatio:D,holdingForFade:f.holdingForFade(),collisionBoxArray:E,partiallyEvaluatedTextSize:o.ah(y.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(p)for(const Ve of y.sortKeyRanges){const{sortKey:ge,symbolInstanceStart:Pe,symbolInstanceEnd:He}=Ve;r.push({sortKey:ge,symbolInstanceStart:Pe,symbolInstanceEnd:He,parameters:Ie})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:Ie})}attemptAnchorPlacement(r,l,f,p,y,T,E,A,F,D,R,q,oe,se,ce,ae){const Ie=o.aq[r.textAnchor],Ve=[r.textOffset0,r.textOffset1],ge=K(Ie,f,p,Ve,y),Pe=this.collisionIndex.placeCollisionBox(X(l,ge.x,ge.y,T,E,this.transform.angle),R,A,F,D.predicate,ae);if((!ce||this.collisionIndex.placeCollisionBox(X(ce,ge.x,ge.y,T,E,this.transform.angle),R,A,F,D.predicate,ae).box.length!==0)&&Pe.box.length>0){let He;if(this.prevPlacement&&this.prevPlacement.variableOffsets[q.crossTileID]&&this.prevPlacement.placements[q.crossTileID]&&this.prevPlacement.placements[q.crossTileID].text&&(He=this.prevPlacement.variableOffsets[q.crossTileID].anchor),q.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[q.crossTileID]={textOffset:Ve,width:f,height:p,anchor:Ie,textBoxScale:y,prevAnchor:He},this.markUsedJustification(oe,Ie,q,se),oe.allowVerticalPlacement&&(this.markUsedOrientation(oe,se,q),this.placedOrientations[q.crossTileID]=se),{shift:ge,placedGlyphBoxes:Pe}}}placeLayerBucketPart(r,l,f){const{bucket:p,layout:y,posMatrix:T,textLabelPlaneMatrix:E,labelToScreenMatrix:A,textPixelRatio:F,holdingForFade:D,collisionBoxArray:R,partiallyEvaluatedTextSize:q,collisionGroup:oe}=r.parameters,se=y.get("text-optional"),ce=y.get("icon-optional"),ae=o.ar(y,"text-overlap","text-allow-overlap"),Ie=ae==="always",Ve=o.ar(y,"icon-overlap","icon-allow-overlap"),ge=Ve==="always",Pe=y.get("text-rotation-alignment")==="map",He=y.get("text-pitch-alignment")==="map",We=y.get("icon-text-fit")!=="none",et=y.get("symbol-z-order")==="viewport-y",ct=Ie&&(ge||!p.hasIconData()||ce),nt=ge&&(Ie||!p.hasTextData()||se);!p.collisionArrays&&R&&p.deserializeCollisionBoxes(R);const xt=this.retainedQueryData[p.bucketInstanceId].tileID,Lt=this.terrain?(bt,Ht)=>this.terrain.getElevation(xt,bt,Ht):null,lr=(bt,Ht)=>{var Ot,Cr;if(l[bt.crossTileID])return;if(D)return void(this.placements[bt.crossTileID]=new Je(!1,!1,!1));let or=!1,ar=!1,cr=!0,Yr=null,Ir={box:null,offscreen:null},Ca={box:null,offscreen:null},da=null,aa=null,xi=null,Mr=0,Wi=0,Zi=0;Ht.textFeatureIndex?Mr=Ht.textFeatureIndex:bt.useRuntimeCollisionCircles&&(Mr=bt.featureIndex),Ht.verticalTextFeatureIndex&&(Wi=Ht.verticalTextFeatureIndex);const Fn=Ht.textBox;if(Fn){const Da=Jr=>{let pa=o.ai.horizontal;if(p.allowVerticalPlacement&&!Jr&&this.prevPlacement){const ei=this.prevPlacement.placedOrientations[bt.crossTileID];ei&&(this.placedOrientations[bt.crossTileID]=ei,pa=ei,this.markUsedOrientation(p,pa,bt))}return pa},Aa=(Jr,pa)=>{if(p.allowVerticalPlacement&&bt.numVerticalGlyphVertices>0&&Ht.verticalTextBox){for(const ei of p.writingModes)if(ei===o.ai.vertical?(Ir=pa(),Ca=Ir):Ir=Jr(),Ir&&Ir.box&&Ir.box.length)break}else Ir=Jr()},Ua=bt.textAnchorOffsetStartIndex,Zn=bt.textAnchorOffsetEndIndex;if(Zn===Ua){const Jr=(pa,ei)=>{const Qr=this.collisionIndex.placeCollisionBox(pa,ae,F,T,oe.predicate,Lt);return Qr&&Qr.box&&Qr.box.length&&(this.markUsedOrientation(p,ei,bt),this.placedOrientations[bt.crossTileID]=ei),Qr};Aa(()=>Jr(Fn,o.ai.horizontal),()=>{const pa=Ht.verticalTextBox;return p.allowVerticalPlacement&&bt.numVerticalGlyphVertices>0&&pa?Jr(pa,o.ai.vertical):{box:null,offscreen:null}}),Da(Ir&&Ir.box&&Ir.box.length)}else{let Jr=o.aq[(Cr=(Ot=this.prevPlacement)===null||Ot===void 0?void 0:Ot.variableOffsets[bt.crossTileID])===null||Cr===void 0?void 0:Cr.anchor];const pa=(Qr,Xn,Xo)=>{const Nh=Qr.x2-Qr.x1,Uh=Qr.y2-Qr.y1,af=bt.textBoxScale,oc=We&&Ve==="never"?Xn:null;let Xi={box:[],offscreen:!1},Kn=ae==="never"?1:2,Ki="never";Jr&&Kn++;for(let Mi=0;Mi<Kn;Mi++){for(let Yi=Ua;Yi<Zn;Yi++){const lc=p.textAnchorOffsets.get(Yi);if(Jr&&lc.textAnchor!==Jr)continue;const dn=this.attemptAnchorPlacement(lc,Qr,Nh,Uh,af,Pe,He,F,T,oe,Ki,bt,p,Xo,oc,Lt);if(dn&&(Xi=dn.placedGlyphBoxes,Xi&&Xi.box&&Xi.box.length))return or=!0,Yr=dn.shift,Xi}Jr?Jr=null:Ki=ae}return Xi};Aa(()=>pa(Fn,Ht.iconBox,o.ai.horizontal),()=>{const Qr=Ht.verticalTextBox;return p.allowVerticalPlacement&&!(Ir&&Ir.box&&Ir.box.length)&&bt.numVerticalGlyphVertices>0&&Qr?pa(Qr,Ht.verticalIconBox,o.ai.vertical):{box:null,offscreen:null}}),Ir&&(or=Ir.box,cr=Ir.offscreen);const ei=Da(Ir&&Ir.box);if(!or&&this.prevPlacement){const Qr=this.prevPlacement.variableOffsets[bt.crossTileID];Qr&&(this.variableOffsets[bt.crossTileID]=Qr,this.markUsedJustification(p,Qr.anchor,bt,ei))}}}if(da=Ir,or=da&&da.box&&da.box.length>0,cr=da&&da.offscreen,bt.useRuntimeCollisionCircles){const Da=p.text.placedSymbolArray.get(bt.centerJustifiedTextSymbolIndex),Aa=o.aj(p.textSizeData,q,Da),Ua=y.get("text-padding");aa=this.collisionIndex.placeCollisionCircles(ae,Da,p.lineVertexArray,p.glyphOffsetArray,Aa,T,E,A,f,He,oe.predicate,bt.collisionCircleDiameter,Ua,Lt),aa.circles.length&&aa.collisionDetected&&!f&&o.w("Collisions detected, but collision boxes are not shown"),or=Ie||aa.circles.length>0&&!aa.collisionDetected,cr=cr&&aa.offscreen}if(Ht.iconFeatureIndex&&(Zi=Ht.iconFeatureIndex),Ht.iconBox){const Da=Aa=>{const Ua=We&&Yr?X(Aa,Yr.x,Yr.y,Pe,He,this.transform.angle):Aa;return this.collisionIndex.placeCollisionBox(Ua,Ve,F,T,oe.predicate,Lt)};Ca&&Ca.box&&Ca.box.length&&Ht.verticalIconBox?(xi=Da(Ht.verticalIconBox),ar=xi.box.length>0):(xi=Da(Ht.iconBox),ar=xi.box.length>0),cr=cr&&xi.offscreen}const Wn=se||bt.numHorizontalGlyphVertices===0&&bt.numVerticalGlyphVertices===0,_s=ce||bt.numIconVertices===0;if(Wn||_s?_s?Wn||(ar=ar&&or):or=ar&&or:ar=or=ar&&or,or&&da&&da.box&&this.collisionIndex.insertCollisionBox(da.box,ae,y.get("text-ignore-placement"),p.bucketInstanceId,Ca&&Ca.box&&Wi?Wi:Mr,oe.ID),ar&&xi&&this.collisionIndex.insertCollisionBox(xi.box,Ve,y.get("icon-ignore-placement"),p.bucketInstanceId,Zi,oe.ID),aa&&(or&&this.collisionIndex.insertCollisionCircles(aa.circles,ae,y.get("text-ignore-placement"),p.bucketInstanceId,Mr,oe.ID),f)){const Da=p.bucketInstanceId;let Aa=this.collisionCircleArrays[Da];Aa===void 0&&(Aa=this.collisionCircleArrays[Da]=new Qe);for(let Ua=0;Ua<aa.circles.length;Ua+=4)Aa.circles.push(aa.circles[Ua+0]),Aa.circles.push(aa.circles[Ua+1]),Aa.circles.push(aa.circles[Ua+2]),Aa.circles.push(aa.collisionDetected?1:0)}if(bt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(p.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[bt.crossTileID]=new Je(or||ct,ar||nt,cr||p.justReloaded),l[bt.crossTileID]=!0};if(et){if(r.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const bt=p.getSortedSymbolIndexes(this.transform.angle);for(let Ht=bt.length-1;Ht>=0;--Ht){const Ot=bt[Ht];lr(p.symbolInstances.get(Ot),p.collisionArrays[Ot])}}else for(let bt=r.symbolInstanceStart;bt<r.symbolInstanceEnd;bt++)lr(p.symbolInstances.get(bt),p.collisionArrays[bt]);if(f&&p.bucketInstanceId in this.collisionCircleArrays){const bt=this.collisionCircleArrays[p.bucketInstanceId];o.as(bt.invProjMatrix,T),bt.viewportMatrix=this.collisionIndex.getViewportMatrix()}p.justReloaded=!1}markUsedJustification(r,l,f,p){let y;y=p===o.ai.vertical?f.verticalPlacedTextSymbolIndex:{left:f.leftJustifiedTextSymbolIndex,center:f.centerJustifiedTextSymbolIndex,right:f.rightJustifiedTextSymbolIndex}[o.at(l)];const T=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex,f.verticalPlacedTextSymbolIndex];for(const E of T)E>=0&&(r.text.placedSymbolArray.get(E).crossTileID=y>=0&&E!==y?0:f.crossTileID)}markUsedOrientation(r,l,f){const p=l===o.ai.horizontal||l===o.ai.horizontalOnly?l:0,y=l===o.ai.vertical?l:0,T=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex];for(const E of T)r.text.placedSymbolArray.get(E).placedOrientation=p;f.verticalPlacedTextSymbolIndex&&(r.text.placedSymbolArray.get(f.verticalPlacedTextSymbolIndex).placedOrientation=y)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let f=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const p=l?l.symbolFadeChange(r):1,y=l?l.opacities:{},T=l?l.variableOffsets:{},E=l?l.placedOrientations:{};for(const A in this.placements){const F=this.placements[A],D=y[A];D?(this.opacities[A]=new Fe(D,p,F.text,F.icon),f=f||F.text!==D.text.placed||F.icon!==D.icon.placed):(this.opacities[A]=new Fe(null,p,F.text,F.icon,F.skipFade),f=f||F.text||F.icon)}for(const A in y){const F=y[A];if(!this.opacities[A]){const D=new Fe(F,p,!1,!1);D.isHidden()||(this.opacities[A]=D,f=f||F.text.placed||F.icon.placed)}}for(const A in T)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=T[A]);for(const A in E)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=E[A]);if(l&&l.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");f?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:r)}updateLayerOpacities(r,l){const f={};for(const p of l){const y=p.getBucket(r);y&&p.latestFeatureIndex&&r.id===y.layerIds[0]&&this.updateBucketOpacities(y,f,p.collisionBoxArray)}}updateBucketOpacities(r,l,f){r.hasTextData()&&(r.text.opacityVertexArray.clear(),r.text.hasVisibleVertices=!1),r.hasIconData()&&(r.icon.opacityVertexArray.clear(),r.icon.hasVisibleVertices=!1),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const p=r.layers[0],y=p.layout,T=new Fe(null,0,!1,!1,!0),E=y.get("text-allow-overlap"),A=y.get("icon-allow-overlap"),F=p._unevaluatedLayout.hasValue("text-variable-anchor")||p._unevaluatedLayout.hasValue("text-variable-anchor-offset"),D=y.get("text-rotation-alignment")==="map",R=y.get("text-pitch-alignment")==="map",q=y.get("icon-text-fit")!=="none",oe=new Fe(null,0,E&&(A||!r.hasIconData()||y.get("icon-optional")),A&&(E||!r.hasTextData()||y.get("text-optional")),!0);!r.collisionArrays&&f&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(f);const se=(ce,ae,Ie)=>{for(let Ve=0;Ve<ae/4;Ve++)ce.opacityVertexArray.emplaceBack(Ie);ce.hasVisibleVertices=ce.hasVisibleVertices||Ie!==dt};for(let ce=0;ce<r.symbolInstances.length;ce++){const ae=r.symbolInstances.get(ce),{numHorizontalGlyphVertices:Ie,numVerticalGlyphVertices:Ve,crossTileID:ge}=ae;let Pe=this.opacities[ge];l[ge]?Pe=T:Pe||(Pe=oe,this.opacities[ge]=Pe),l[ge]=!0;const He=ae.numIconVertices>0,We=this.placedOrientations[ae.crossTileID],et=We===o.ai.vertical,ct=We===o.ai.horizontal||We===o.ai.horizontalOnly;if(Ie>0||Ve>0){const nt=St(Pe.text);se(r.text,Ie,et?dt:nt),se(r.text,Ve,ct?dt:nt);const xt=Pe.text.isHidden();[ae.rightJustifiedTextSymbolIndex,ae.centerJustifiedTextSymbolIndex,ae.leftJustifiedTextSymbolIndex].forEach(bt=>{bt>=0&&(r.text.placedSymbolArray.get(bt).hidden=xt||et?1:0)}),ae.verticalPlacedTextSymbolIndex>=0&&(r.text.placedSymbolArray.get(ae.verticalPlacedTextSymbolIndex).hidden=xt||ct?1:0);const Lt=this.variableOffsets[ae.crossTileID];Lt&&this.markUsedJustification(r,Lt.anchor,ae,We);const lr=this.placedOrientations[ae.crossTileID];lr&&(this.markUsedJustification(r,"left",ae,lr),this.markUsedOrientation(r,lr,ae))}if(He){const nt=St(Pe.icon),xt=!(q&&ae.verticalPlacedIconSymbolIndex&&et);ae.placedIconSymbolIndex>=0&&(se(r.icon,ae.numIconVertices,xt?nt:dt),r.icon.placedSymbolArray.get(ae.placedIconSymbolIndex).hidden=Pe.icon.isHidden()),ae.verticalPlacedIconSymbolIndex>=0&&(se(r.icon,ae.numVerticalIconVertices,xt?dt:nt),r.icon.placedSymbolArray.get(ae.verticalPlacedIconSymbolIndex).hidden=Pe.icon.isHidden())}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const nt=r.collisionArrays[ce];if(nt){let xt=new o.P(0,0);if(nt.textBox||nt.verticalTextBox){let lr=!0;if(F){const bt=this.variableOffsets[ge];bt?(xt=K(bt.anchor,bt.width,bt.height,bt.textOffset,bt.textBoxScale),D&&xt._rotate(R?this.transform.angle:-this.transform.angle)):lr=!1}nt.textBox&&re(r.textCollisionBox.collisionVertexArray,Pe.text.placed,!lr||et,xt.x,xt.y),nt.verticalTextBox&&re(r.textCollisionBox.collisionVertexArray,Pe.text.placed,!lr||ct,xt.x,xt.y)}const Lt=!!(!ct&&nt.verticalIconBox);nt.iconBox&&re(r.iconCollisionBox.collisionVertexArray,Pe.icon.placed,Lt,q?xt.x:0,q?xt.y:0),nt.verticalIconBox&&re(r.iconCollisionBox.collisionVertexArray,Pe.icon.placed,!Lt,q?xt.x:0,q?xt.y:0)}}}if(r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.text.opacityVertexArray.length!==r.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${r.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${r.text.layoutVertexArray.length}) / 4`);if(r.icon.opacityVertexArray.length!==r.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${r.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${r.icon.layoutVertexArray.length}) / 4`);if(r.bucketInstanceId in this.collisionCircleArrays){const ce=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=ce.invProjMatrix,r.placementViewportMatrix=ce.viewportMatrix,r.collisionCircleArray=ce.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,l){const f=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*f>r}setStale(){this.stale=!0}}function re(g,r,l,f,p){g.emplaceBack(r?1:0,l?1:0,f||0,p||0),g.emplaceBack(r?1:0,l?1:0,f||0,p||0),g.emplaceBack(r?1:0,l?1:0,f||0,p||0),g.emplaceBack(r?1:0,l?1:0,f||0,p||0)}const Ne=Math.pow(2,25),Ze=Math.pow(2,24),Le=Math.pow(2,17),ze=Math.pow(2,16),je=Math.pow(2,9),at=Math.pow(2,8),gt=Math.pow(2,1);function St(g){if(g.opacity===0&&!g.placed)return 0;if(g.opacity===1&&g.placed)return 4294967295;const r=g.placed?1:0,l=Math.floor(127*g.opacity);return l*Ne+r*Ze+l*Le+r*ze+l*je+r*at+l*gt+r}const dt=0;class Ft{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&!r.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(r,l,f,p,y){const T=this._bucketParts;for(;this._currentTileIndex<r.length;)if(l.getBucketParts(T,p,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort((E,A)=>E.sortKey-A.sortKey));this._currentPartIndex<T.length;)if(l.placeLayerBucketPart(T[this._currentPartIndex],this._seenCrossTileIDs,f),this._currentPartIndex++,y())return!0;return!1}}class Wt{constructor(r,l,f,p,y,T,E,A){this.placement=new Q(r,l,T,E,A),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(r,l,f){const p=o.h.now(),y=()=>!this._forceFullPlacement&&o.h.now()-p>2;for(;this._currentPlacementIndex>=0;){const T=l[r[this._currentPlacementIndex]],E=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=E)&&(!T.maxzoom||T.maxzoom>E)){if(this._inProgressLayer||(this._inProgressLayer=new Ft(T)),this._inProgressLayer.continuePlacement(f[T.source],this.placement,this._showCollisionBoxes,T,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const kr=512/o.N/2;class Rr{constructor(r,l,f){this.tileID=r,this.bucketInstanceId=f,this._symbolsByKey={};const p=new Map;for(let y=0;y<l.length;y++){const T=l.get(y),E=T.key,A=p.get(E);A?A.push(T):p.set(E,[T])}for(const[y,T]of p){const E={positions:T.map(A=>({x:Math.floor(A.anchorX*kr),y:Math.floor(A.anchorY*kr)})),crossTileIDs:T.map(A=>A.crossTileID)};if(E.positions.length>128){const A=new o.av(E.positions.length,16,Uint16Array);for(const{x:F,y:D}of E.positions)A.add(F,D);A.finish(),delete E.positions,E.index=A}this._symbolsByKey[y]=E}}getScaledCoordinates(r,l){const{x:f,y:p,z:y}=this.tileID.canonical,{x:T,y:E,z:A}=l.canonical,F=kr/Math.pow(2,A-y),D=(E*o.N+r.anchorY)*F,R=p*o.N*kr;return{x:Math.floor((T*o.N+r.anchorX)*F-f*o.N*kr),y:Math.floor(D-R)}}findMatches(r,l,f){const p=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z);for(let y=0;y<r.length;y++){const T=r.get(y);if(T.crossTileID)continue;const E=this._symbolsByKey[T.key];if(!E)continue;const A=this.getScaledCoordinates(T,l);if(E.index){const F=E.index.range(A.x-p,A.y-p,A.x+p,A.y+p).sort();for(const D of F){const R=E.crossTileIDs[D];if(!f[R]){f[R]=!0,T.crossTileID=R;break}}}else if(E.positions)for(let F=0;F<E.positions.length;F++){const D=E.positions[F],R=E.crossTileIDs[F];if(Math.abs(D.x-A.x)<=p&&Math.abs(D.y-A.y)<=p&&!f[R]){f[R]=!0,T.crossTileID=R;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:r})=>r)}}class Qt{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class on{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const l=Math.round((r-this.lng)/360);if(l!==0)for(const f in this.indexes){const p=this.indexes[f],y={};for(const T in p){const E=p[T];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+l),y[E.tileID.key]=E}this.indexes[f]=y}this.lng=r}addBucket(r,l,f){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let y=0;y<l.symbolInstances.length;y++)l.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]={});const p=this.usedCrossTileIDs[r.overscaledZ];for(const y in this.indexes){const T=this.indexes[y];if(Number(y)>r.overscaledZ)for(const E in T){const A=T[E];A.tileID.isChildOf(r)&&A.findMatches(l.symbolInstances,r,p)}else{const E=T[r.scaledTo(Number(y)).key];E&&E.findMatches(l.symbolInstances,r,p)}}for(let y=0;y<l.symbolInstances.length;y++){const T=l.symbolInstances.get(y);T.crossTileID||(T.crossTileID=f.generate(),p[T.crossTileID]=!0)}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new Rr(r,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(r,l){for(const f of l.getCrossTileIDsLists())for(const p of f)delete this.usedCrossTileIDs[r][p]}removeStaleBuckets(r){let l=!1;for(const f in this.indexes){const p=this.indexes[f];for(const y in p)r[p[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,p[y]),delete p[y],l=!0)}return l}}class Hi{constructor(){this.layerIndexes={},this.crossTileIDs=new Qt,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,l,f){let p=this.layerIndexes[r.id];p===void 0&&(p=this.layerIndexes[r.id]=new on);let y=!1;const T={};p.handleWrapJump(f);for(const E of l){const A=E.getBucket(r);A&&r.id===A.layerIds[0]&&(A.bucketInstanceId||(A.bucketInstanceId=++this.maxBucketInstanceId),p.addBucket(E.tileID,A,this.crossTileIDs)&&(y=!0),T[A.bucketInstanceId]=!0)}return p.removeStaleBuckets(T)&&(y=!0),y}pruneUnusedLayers(r){const l={};r.forEach(f=>{l[f]=!0});for(const f in this.layerIndexes)l[f]||delete this.layerIndexes[f]}}const Xr=(g,r)=>o.x(g,r&&r.filter(l=>l.identifier!=="source.canvas")),ta=o.F(o.ax,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),Os=o.F(o.ax,["setCenter","setZoom","setBearing","setPitch"]),Kr=o.aw();class ka extends o.E{constructor(r,l={}){super(),this.map=r,this.dispatcher=new Dt(zr(),this,r._getMapId()),this.imageManager=new Re,this.imageManager.setEventedParent(this),this.glyphManager=new _t(r._requestManager,l.localIdeographFontFamily),this.lineAtlas=new $t(256,512),this.crossTileSymbolIndex=new Hi,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.az());const f=this;this._rtlTextPluginCallback=ka.registerForPluginStateChange(p=>{f.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:p.pluginStatus,pluginURL:p.pluginURL},(y,T)=>{if(o.aA(y),T&&T.every(E=>E))for(const E in f.sourceCaches){const A=f.sourceCaches[E].getSource().type;A!=="vector"&&A!=="geojson"||f.sourceCaches[E].reload()}})}),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const y=this.sourceCaches[p.sourceId];if(!y)return;const T=y.getSource();if(T&&T.vectorLayerIds)for(const E in this._layers){const A=this._layers[E];A.source===T.id&&this._validateLayer(A)}})}loadURL(r,l={},f){this.fire(new o.k("dataloading",{dataType:"style"})),l.validate=typeof l.validate!="boolean"||l.validate;const p=this.map._requestManager.transformRequest(r,ie.Style);this._request=o.f(p,(y,T)=>{this._request=null,y?this.fire(new o.j(y)):T&&this._load(T,l,f)})}loadJSON(r,l={},f){this.fire(new o.k("dataloading",{dataType:"style"})),this._request=o.h.frame(()=>{this._request=null,l.validate=l.validate!==!1,this._load(r,l,f)})}loadEmpty(){this.fire(new o.k("dataloading",{dataType:"style"})),this._load(Kr,{validate:!1})}_load(r,l,f){var p;const y=l.transformStyle?l.transformStyle(f,r):r;if(!l.validate||!Xr(this,o.y(y))){this._loaded=!0,this.stylesheet=y;for(const T in y.sources)this.addSource(T,y.sources[T],{validate:!1});y.sprite?this._loadSprite(y.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(y.glyphs),this._createLayers(),this.light=new qe(this.stylesheet.light),this.map.setTerrain((p=this.stylesheet.terrain)!==null&&p!==void 0?p:null),this.fire(new o.k("data",{dataType:"style"})),this.fire(new o.k("style.load"))}}_createLayers(){const r=o.aB(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",r),this._order=r.map(l=>l.id),this._layers={},this._serializedLayers=null;for(const l of r){const f=o.aC(l);f.setEventedParent(this,{layer:{id:l.id}}),this._layers[l.id]=f}}_loadSprite(r,l=!1,f=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(p,y,T,E){const A=Be(p),F=A.length,D=T>1?"@2x":"",R={},q={},oe={};for(const{id:se,url:ce}of A){const ae=y.transformRequest(y.normalizeSpriteURL(ce,D,".json"),ie.SpriteJSON),Ie=`${se}_${ae.url}`;R[Ie]=o.f(ae,(Pe,He)=>{delete R[Ie],q[se]=He,Ce(E,q,oe,Pe,F)});const Ve=y.transformRequest(y.normalizeSpriteURL(ce,D,".png"),ie.SpriteImage),ge=`${se}_${Ve.url}`;R[ge]=G.getImage(Ve,(Pe,He)=>{delete R[ge],oe[se]=He,Ce(E,q,oe,Pe,F)})}return{cancel(){for(const se of Object.values(R))se.cancel()}}}(r,this.map._requestManager,this.map.getPixelRatio(),(p,y)=>{if(this._spriteRequest=null,p)this.fire(new o.j(p));else if(y)for(const T in y){this._spritesImagesIds[T]=[];const E=this._spritesImagesIds[T]?this._spritesImagesIds[T].filter(A=>!(A in y)):[];for(const A of E)this.imageManager.removeImage(A),this._changedImages[A]=!0;for(const A in y[T]){const F=T==="default"?A:`${T}:${A}`;this._spritesImagesIds[T].push(F),F in this.imageManager.images?this.imageManager.updateImage(F,y[T][A],!1):this.imageManager.addImage(F,y[T][A]),l&&(this._changedImages[F]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),l&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.k("data",{dataType:"style"})),f&&f(p)})}_unloadSprite(){for(const r of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(r),this._changedImages[r]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}_validateLayer(r){const l=this.sourceCaches[r.source];if(!l)return;const f=r.sourceLayer;if(!f)return;const p=l.getSource();(p.type==="geojson"||p.vectorLayerIds&&p.vectorLayerIds.indexOf(f)===-1)&&this.fire(new o.j(new Error(`Source layer "${f}" does not exist on source "${p.id}" as specified by style layer "${r.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const r in this.sourceCaches)if(!this.sourceCaches[r].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(r){const l=this._serializedAllLayers();if(!r||r.length===0)return Object.values(l);const f=[];for(const p of r)l[p]&&f.push(l[p]);return f}_serializedAllLayers(){let r=this._serializedLayers;if(r)return r;r=this._serializedLayers={};const l=Object.keys(this._layers);for(const f of l){const p=this._layers[f];p.type!=="custom"&&(r[f]=p.serialize())}return r}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const r in this.sourceCaches)if(this.sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(r){if(!this._loaded)return;const l=this._changed;if(this._changed){const p=Object.keys(this._updatedLayers),y=Object.keys(this._removedLayers);(p.length||y.length)&&this._updateWorkerLayers(p,y);for(const T in this._updatedSources){const E=this._updatedSources[T];if(E==="reload")this._reloadSource(T);else{if(E!=="clear")throw new Error(`Invalid action ${E}`);this._clearSource(T)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const T in this._updatedPaintProps)this._layers[T].updateTransitions(r);this.light.updateTransitions(r),this._resetUpdates()}const f={};for(const p in this.sourceCaches){const y=this.sourceCaches[p];f[p]=y.used,y.used=!1}for(const p of this._order){const y=this._layers[p];y.recalculate(r,this._availableImages),!y.isHidden(r.zoom)&&y.source&&(this.sourceCaches[y.source].used=!0)}for(const p in f){const y=this.sourceCaches[p];f[p]!==y.used&&y.fire(new o.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:p}))}this.light.recalculate(r),this.z=r.zoom,l&&this.fire(new o.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=Object.keys(this._changedImages);if(r.length){for(const l in this.sourceCaches)this.sourceCaches[l].reloadTilesForDependencies(["icons","patterns"],r);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const r in this.sourceCaches)this.sourceCaches[r].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(r,l){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(r),removedIds:l})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(r,l={}){this._checkLoaded();const f=this.serialize();if(r=l.transformStyle?l.transformStyle(f,r):r,Xr(this,o.y(r)))return!1;(r=o.aD(r)).layers=o.aB(r.layers);const p=o.aE(f,r).filter(T=>!(T.command in Os));if(p.length===0)return!1;const y=p.filter(T=>!(T.command in ta));if(y.length>0)throw new Error(`Unimplemented: ${y.map(T=>T.command).join(", ")}.`);for(const T of p)T.command!=="setTransition"&&this[T.command].apply(this,T.args);return this.stylesheet=r,this._serializedLayers=null,!0}addImage(r,l){if(this.getImage(r))return this.fire(new o.j(new Error(`An image named "${r}" already exists.`)));this.imageManager.addImage(r,l),this._afterImageUpdated(r)}updateImage(r,l){this.imageManager.updateImage(r,l)}getImage(r){return this.imageManager.getImage(r)}removeImage(r){if(!this.getImage(r))return this.fire(new o.j(new Error(`An image named "${r}" does not exist.`)));this.imageManager.removeImage(r),this._afterImageUpdated(r)}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(r,l,f={}){if(this._checkLoaded(),this.sourceCaches[r]!==void 0)throw new Error(`Source "${r}" already exists.`);if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(o.y.source,`sources.${r}`,l,null,f))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const p=this.sourceCaches[r]=new Fr(r,l,this.dispatcher);p.style=this,p.setEventedParent(this,()=>({isSourceLoaded:p.loaded(),source:p.serialize(),sourceId:r})),p.onAdd(this.map),this._changed=!0}removeSource(r){if(this._checkLoaded(),this.sourceCaches[r]===void 0)throw new Error("There is no source with this ID");for(const f in this._layers)if(this._layers[f].source===r)return this.fire(new o.j(new Error(`Source "${r}" cannot be removed while layer "${f}" is using it.`)));const l=this.sourceCaches[r];delete this.sourceCaches[r],delete this._updatedSources[r],l.fire(new o.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:r})),l.setEventedParent(null),l.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(r,l){if(this._checkLoaded(),this.sourceCaches[r]===void 0)throw new Error(`There is no source with this ID=${r}`);const f=this.sourceCaches[r].getSource();if(f.type!=="geojson")throw new Error(`geojsonSource.type is ${f.type}, which is !== 'geojson`);f.setData(l),this._changed=!0}getSource(r){return this.sourceCaches[r]&&this.sourceCaches[r].getSource()}addLayer(r,l,f={}){this._checkLoaded();const p=r.id;if(this.getLayer(p))return void this.fire(new o.j(new Error(`Layer "${p}" already exists on this map.`)));let y;if(r.type==="custom"){if(Xr(this,o.aF(r)))return;y=o.aC(r)}else{if("source"in r&&typeof r.source=="object"&&(this.addSource(p,r.source),r=o.aD(r),r=o.e(r,{source:p})),this._validate(o.y.layer,`layers.${p}`,r,{arrayIndex:-1},f))return;y=o.aC(r),this._validateLayer(y),y.setEventedParent(this,{layer:{id:p}})}const T=l?this._order.indexOf(l):this._order.length;if(l&&T===-1)this.fire(new o.j(new Error(`Cannot add layer "${p}" before non-existing layer "${l}".`)));else{if(this._order.splice(T,0,p),this._layerOrderChanged=!0,this._layers[p]=y,this._removedLayers[p]&&y.source&&y.type!=="custom"){const E=this._removedLayers[p];delete this._removedLayers[p],E.type!==y.type?this._updatedSources[y.source]="clear":(this._updatedSources[y.source]="reload",this.sourceCaches[y.source].pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map)}}moveLayer(r,l){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new o.j(new Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===l)return;const f=this._order.indexOf(r);this._order.splice(f,1);const p=l?this._order.indexOf(l):this._order.length;l&&p===-1?this.fire(new o.j(new Error(`Cannot move layer "${r}" before non-existing layer "${l}".`))):(this._order.splice(p,0,r),this._layerOrderChanged=!0)}removeLayer(r){this._checkLoaded();const l=this._layers[r];if(!l)return void this.fire(new o.j(new Error(`Cannot remove non-existing layer "${r}".`)));l.setEventedParent(null);const f=this._order.indexOf(r);this._order.splice(f,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=l,delete this._layers[r],this._serializedLayers&&delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],l.onRemove&&l.onRemove(this.map)}getLayer(r){return this._layers[r]}getLayersOrder(){return[...this._order]}hasLayer(r){return r in this._layers}setLayerZoomRange(r,l,f){this._checkLoaded();const p=this.getLayer(r);p?p.minzoom===l&&p.maxzoom===f||(l!=null&&(p.minzoom=l),f!=null&&(p.maxzoom=f),this._updateLayer(p)):this.fire(new o.j(new Error(`Cannot set the zoom range of non-existing layer "${r}".`)))}setFilter(r,l,f={}){this._checkLoaded();const p=this.getLayer(r);if(p){if(!o.aG(p.filter,l))return l==null?(p.filter=void 0,void this._updateLayer(p)):void(this._validate(o.y.filter,`layers.${p.id}.filter`,l,null,f)||(p.filter=o.aD(l),this._updateLayer(p)))}else this.fire(new o.j(new Error(`Cannot filter non-existing layer "${r}".`)))}getFilter(r){return o.aD(this.getLayer(r).filter)}setLayoutProperty(r,l,f,p={}){this._checkLoaded();const y=this.getLayer(r);y?o.aG(y.getLayoutProperty(l),f)||(y.setLayoutProperty(l,f,p),this._updateLayer(y)):this.fire(new o.j(new Error(`Cannot style non-existing layer "${r}".`)))}getLayoutProperty(r,l){const f=this.getLayer(r);if(f)return f.getLayoutProperty(l);this.fire(new o.j(new Error(`Cannot get style of non-existing layer "${r}".`)))}setPaintProperty(r,l,f,p={}){this._checkLoaded();const y=this.getLayer(r);y?o.aG(y.getPaintProperty(l),f)||(y.setPaintProperty(l,f,p)&&this._updateLayer(y),this._changed=!0,this._updatedPaintProps[r]=!0):this.fire(new o.j(new Error(`Cannot style non-existing layer "${r}".`)))}getPaintProperty(r,l){return this.getLayer(r).getPaintProperty(l)}setFeatureState(r,l){this._checkLoaded();const f=r.source,p=r.sourceLayer,y=this.sourceCaches[f];if(y===void 0)return void this.fire(new o.j(new Error(`The source '${f}' does not exist in the map's style.`)));const T=y.getSource().type;T==="geojson"&&p?this.fire(new o.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):T!=="vector"||p?(r.id===void 0&&this.fire(new o.j(new Error("The feature id parameter must be provided."))),y.setFeatureState(p,r.id,l)):this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(r,l){this._checkLoaded();const f=r.source,p=this.sourceCaches[f];if(p===void 0)return void this.fire(new o.j(new Error(`The source '${f}' does not exist in the map's style.`)));const y=p.getSource().type,T=y==="vector"?r.sourceLayer:void 0;y!=="vector"||T?l&&typeof r.id!="string"&&typeof r.id!="number"?this.fire(new o.j(new Error("A feature id is required to remove its specific state property."))):p.removeFeatureState(T,r.id,l):this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(r){this._checkLoaded();const l=r.source,f=r.sourceLayer,p=this.sourceCaches[l];if(p!==void 0)return p.getSource().type!=="vector"||f?(r.id===void 0&&this.fire(new o.j(new Error("The feature id parameter must be provided."))),p.getFeatureState(f,r.id)):void this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.j(new Error(`The source '${l}' does not exist in the map's style.`)))}getTransition(){return o.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const r=o.aH(this.sourceCaches,y=>y.serialize()),l=this._serializeByIds(this._order),f=this.map.getTerrain()||void 0,p=this.stylesheet;return o.aI({version:p.version,name:p.name,metadata:p.metadata,light:p.light,center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch,sprite:p.sprite,glyphs:p.glyphs,transition:p.transition,sources:r,layers:l,terrain:f},y=>y!==void 0)}_updateLayer(r){this._updatedLayers[r.id]=!0,r.source&&!this._updatedSources[r.source]&&this.sourceCaches[r.source].getSource().type!=="raster"&&(this._updatedSources[r.source]="reload",this.sourceCaches[r.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(r){const l=T=>this._layers[T].type==="fill-extrusion",f={},p=[];for(let T=this._order.length-1;T>=0;T--){const E=this._order[T];if(l(E)){f[E]=T;for(const A of r){const F=A[E];if(F)for(const D of F)p.push(D)}}}p.sort((T,E)=>E.intersectionZ-T.intersectionZ);const y=[];for(let T=this._order.length-1;T>=0;T--){const E=this._order[T];if(l(E))for(let A=p.length-1;A>=0;A--){const F=p[A].feature;if(f[F.layer.id]<T)break;y.push(F),p.pop()}else for(const A of r){const F=A[E];if(F)for(const D of F)y.push(D.feature)}}return y}queryRenderedFeatures(r,l,f){l&&l.filter&&this._validate(o.y.filter,"queryRenderedFeatures.filter",l.filter,null,l);const p={};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new o.j(new Error("parameters.layers must be an Array."))),[];for(const E of l.layers){const A=this._layers[E];if(!A)return this.fire(new o.j(new Error(`The layer '${E}' does not exist in the map's style and cannot be queried for features.`))),[];p[A.source]=!0}}const y=[];l.availableImages=this._availableImages;const T=this._serializedAllLayers();for(const E in this.sourceCaches)l.layers&&!p[E]||y.push(Zt(this.sourceCaches[E],this._layers,T,r,l,f));return this.placement&&y.push(function(E,A,F,D,R,q,oe){const se={},ce=q.queryRenderedSymbols(D),ae=[];for(const Ie of Object.keys(ce).map(Number))ae.push(oe[Ie]);ae.sort(Et);for(const Ie of ae){const Ve=Ie.featureIndex.lookupSymbolFeatures(ce[Ie.bucketInstanceId],A,Ie.bucketIndex,Ie.sourceLayerIndex,R.filter,R.layers,R.availableImages,E);for(const ge in Ve){const Pe=se[ge]=se[ge]||[],He=Ve[ge];He.sort((We,et)=>{const ct=Ie.featureSortOrder;if(ct){const nt=ct.indexOf(We.featureIndex);return ct.indexOf(et.featureIndex)-nt}return et.featureIndex-We.featureIndex});for(const We of He)Pe.push(We)}}for(const Ie in se)se[Ie].forEach(Ve=>{const ge=Ve.feature,Pe=F[E[Ie].source].getFeatureState(ge.layer["source-layer"],ge.id);ge.source=ge.layer.source,ge.layer["source-layer"]&&(ge.sourceLayer=ge.layer["source-layer"]),ge.state=Pe});return se}(this._layers,T,this.sourceCaches,r,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(y)}querySourceFeatures(r,l){l&&l.filter&&this._validate(o.y.filter,"querySourceFeatures.filter",l.filter,null,l);const f=this.sourceCaches[r];return f?function(p,y){const T=p.getRenderableIds().map(F=>p.getTileByID(F)),E=[],A={};for(let F=0;F<T.length;F++){const D=T[F],R=D.tileID.canonical.key;A[R]||(A[R]=!0,D.querySourceFeatures(E,y))}return E}(f,l):[]}addSourceType(r,l,f){return Jt(r)?f(new Error(`A source type called "${r}" already exists.`)):(((p,y)=>{er[p]=y})(r,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:l.workerSourceURL},f):f(null,null))}getLight(){return this.light.getLight()}setLight(r,l={}){this._checkLoaded();const f=this.light.getLight();let p=!1;for(const T in r)if(!o.aG(r[T],f[T])){p=!0;break}if(!p)return;const y={now:o.h.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(r,l),this.light.updateTransitions(y)}_validate(r,l,f,p,y={}){return(!y||y.validate!==!1)&&Xr(this,r.call(o.y,o.e({key:l,style:this.serialize(),value:f,styleSpec:o.v},p)))}_remove(r=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.aJ.off("pluginStateChange",this._rtlTextPluginCallback);for(const l in this._layers)this._layers[l].setEventedParent(null);for(const l in this.sourceCaches){const f=this.sourceCaches[l];f.setEventedParent(null),f.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(r)}_clearSource(r){this.sourceCaches[r].clearTiles()}_reloadSource(r){this.sourceCaches[r].resume(),this.sourceCaches[r].reload()}_updateSources(r){for(const l in this.sourceCaches)this.sourceCaches[l].update(r,this.map.terrain)}_generateCollisionBoxes(){for(const r in this.sourceCaches)this._reloadSource(r)}_updatePlacement(r,l,f,p,y=!1){let T=!1,E=!1;const A={};for(const F of this._order){const D=this._layers[F];if(D.type!=="symbol")continue;if(!A[D.source]){const q=this.sourceCaches[D.source];A[D.source]=q.getRenderableIds(!0).map(oe=>q.getTileByID(oe)).sort((oe,se)=>se.tileID.overscaledZ-oe.tileID.overscaledZ||(oe.tileID.isLessThan(se.tileID)?-1:1))}const R=this.crossTileSymbolIndex.addLayer(D,A[D.source],r.center.lng);T=T||R}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((y=y||this._layerOrderChanged||f===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.h.now(),r.zoom))&&(this.pauseablePlacement=new Wt(r,this.map.terrain,this._order,y,l,f,p,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,A),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.h.now()),E=!0),T&&this.pauseablePlacement.placement.setStale()),E||T)for(const F of this._order){const D=this._layers[F];D.type==="symbol"&&this.placement.updateLayerOpacities(D,A[D.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.h.now())}_releaseSymbolFadeTiles(){for(const r in this.sourceCaches)this.sourceCaches[r].releaseSymbolFadeTiles()}getImages(r,l,f){this.imageManager.getImages(l.icons,f),this._updateTilesForChangedImages();const p=this.sourceCaches[l.source];p&&p.setDependencies(l.tileID.key,l.type,l.icons)}getGlyphs(r,l,f){this.glyphManager.getGlyphs(l.stacks,f);const p=this.sourceCaches[l.source];p&&p.setDependencies(l.tileID.key,l.type,[""])}getResource(r,l,f){return o.m(l,f)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(r,l={}){this._checkLoaded(),r&&this._validate(o.y.glyphs,"glyphs",r,null,l)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=r,this.glyphManager.entries={},this.glyphManager.setURL(r))}addSprite(r,l,f={},p){this._checkLoaded();const y=[{id:r,url:l}],T=[...Be(this.stylesheet.sprite),...y];this._validate(o.y.sprite,"sprite",T,null,f)||(this.stylesheet.sprite=T,this._loadSprite(y,!0,p))}removeSprite(r){this._checkLoaded();const l=Be(this.stylesheet.sprite);if(l.find(f=>f.id===r)){if(this._spritesImagesIds[r])for(const f of this._spritesImagesIds[r])this.imageManager.removeImage(f),this._changedImages[f]=!0;l.splice(l.findIndex(f=>f.id===r),1),this.stylesheet.sprite=l.length>0?l:void 0,delete this._spritesImagesIds[r],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}else this.fire(new o.j(new Error(`Sprite "${r}" doesn't exists on this map.`)))}getSprite(){return Be(this.stylesheet.sprite)}setSprite(r,l={},f){this._checkLoaded(),r&&this._validate(o.y.sprite,"sprite",r,null,l)||(this.stylesheet.sprite=r,r?this._loadSprite(r,!0,f):(this._unloadSprite(),f&&f(null)))}}ka.registerForPluginStateChange=o.aK;var bo=o.Q([{name:"a_pos",type:"Int16",components:2}]),os="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const Nr={prelude:xr(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:xr(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:xr(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:xr(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:xr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:xr(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:xr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:xr("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:xr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:xr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:xr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:xr(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:xr(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:xr(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:xr(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:xr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:xr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:xr(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:xr(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:xr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:xr(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:xr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:xr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:xr(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:xr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:xr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:xr("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",os),terrainDepth:xr("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",os),terrainCoords:xr("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",os)};function xr(g,r){const l=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,f=r.match(/attribute ([\w]+) ([\w]+)/g),p=g.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=r.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=y?y.concat(p):p,E={};return{fragmentSource:g=g.replace(l,(A,F,D,R,q)=>(E[q]=!0,F==="define"?`
#ifndef HAS_UNIFORM_u_${q}
varying ${D} ${R} ${q};
#else
uniform ${D} ${R} u_${q};
#endif
`:`
#ifdef HAS_UNIFORM_u_${q}
    ${D} ${R} ${q} = u_${q};
#endif
`)),vertexSource:r=r.replace(l,(A,F,D,R,q)=>{const oe=R==="float"?"vec2":"vec4",se=q.match(/color/)?"color":oe;return E[q]?F==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
attribute ${D} ${oe} a_${q};
varying ${D} ${R} ${q};
#else
uniform ${D} ${R} u_${q};
#endif
`:se==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = a_${q};
#else
    ${D} ${R} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = unpack_mix_${se}(a_${q}, u_${q}_t);
#else
    ${D} ${R} ${q} = u_${q};
#endif
`:F==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
attribute ${D} ${oe} a_${q};
#else
uniform ${D} ${R} u_${q};
#endif
`:se==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${D} ${R} ${q} = a_${q};
#else
    ${D} ${R} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${D} ${R} ${q} = unpack_mix_${se}(a_${q}, u_${q}_t);
#else
    ${D} ${R} ${q} = u_${q};
#endif
`}),staticAttributes:f,staticUniforms:T}}class Nn{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(r,l,f,p,y,T,E,A,F){this.context=r;let D=this.boundPaintVertexBuffers.length!==p.length;for(let R=0;!D&&R<p.length;R++)this.boundPaintVertexBuffers[R]!==p[R]&&(D=!0);!this.vao||this.boundProgram!==l||this.boundLayoutVertexBuffer!==f||D||this.boundIndexBuffer!==y||this.boundVertexOffset!==T||this.boundDynamicVertexBuffer!==E||this.boundDynamicVertexBuffer2!==A||this.boundDynamicVertexBuffer3!==F?this.freshBind(l,f,p,y,T,E,A,F):(r.bindVertexArray.set(this.vao),E&&E.bind(),y&&y.dynamicDraw&&y.bind(),A&&A.bind(),F&&F.bind())}freshBind(r,l,f,p,y,T,E,A){const F=r.numAttributes,D=this.context,R=D.gl;this.vao&&this.destroy(),this.vao=D.createVertexArray(),D.bindVertexArray.set(this.vao),this.boundProgram=r,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=p,this.boundVertexOffset=y,this.boundDynamicVertexBuffer=T,this.boundDynamicVertexBuffer2=E,this.boundDynamicVertexBuffer3=A,l.enableAttributes(R,r);for(const q of f)q.enableAttributes(R,r);T&&T.enableAttributes(R,r),E&&E.enableAttributes(R,r),A&&A.enableAttributes(R,r),l.bind(),l.setVertexAttribPointers(R,r,y);for(const q of f)q.bind(),q.setVertexAttribPointers(R,r,y);T&&(T.bind(),T.setVertexAttribPointers(R,r,y)),p&&p.bind(),E&&(E.bind(),E.setVertexAttribPointers(R,r,y)),A&&(A.bind(),A.setVertexAttribPointers(R,r,y)),D.currentNumAttributes=F}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Gr(g){const r=[];for(let l=0;l<g.length;l++){if(g[l]===null)continue;const f=g[l].split(" ");r.push(f.pop())}return r}class To{constructor(r,l,f,p,y,T){const E=r.gl;this.program=E.createProgram();const A=Gr(l.staticAttributes),F=f?f.getBinderAttributes():[],D=A.concat(F),R=Nr.prelude.staticUniforms?Gr(Nr.prelude.staticUniforms):[],q=l.staticUniforms?Gr(l.staticUniforms):[],oe=f?f.getBinderUniforms():[],se=R.concat(q).concat(oe),ce=[];for(const We of se)ce.indexOf(We)<0&&ce.push(We);const ae=f?f.defines():[];y&&ae.push("#define OVERDRAW_INSPECTOR;"),T&&ae.push("#define TERRAIN3D;");const Ie=ae.concat(Nr.prelude.fragmentSource,l.fragmentSource).join(`
`),Ve=ae.concat(Nr.prelude.vertexSource,l.vertexSource).join(`
`),ge=E.createShader(E.FRAGMENT_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);if(E.shaderSource(ge,Ie),E.compileShader(ge),!E.getShaderParameter(ge,E.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${E.getShaderInfoLog(ge)}`);E.attachShader(this.program,ge);const Pe=E.createShader(E.VERTEX_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);if(E.shaderSource(Pe,Ve),E.compileShader(Pe),!E.getShaderParameter(Pe,E.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${E.getShaderInfoLog(Pe)}`);E.attachShader(this.program,Pe),this.attributes={};const He={};this.numAttributes=D.length;for(let We=0;We<this.numAttributes;We++)D[We]&&(E.bindAttribLocation(this.program,We,D[We]),this.attributes[D[We]]=We);if(E.linkProgram(this.program),!E.getProgramParameter(this.program,E.LINK_STATUS))throw new Error(`Program failed to link: ${E.getProgramInfoLog(this.program)}`);E.deleteShader(Pe),E.deleteShader(ge);for(let We=0;We<ce.length;We++){const et=ce[We];if(et&&!He[et]){const ct=E.getUniformLocation(this.program,et);ct&&(He[et]=ct)}}this.fixedUniforms=p(r,He),this.terrainUniforms=((We,et)=>({u_depth:new o.aL(We,et.u_depth),u_terrain:new o.aL(We,et.u_terrain),u_terrain_dim:new o.aM(We,et.u_terrain_dim),u_terrain_matrix:new o.aN(We,et.u_terrain_matrix),u_terrain_unpack:new o.aO(We,et.u_terrain_unpack),u_terrain_exaggeration:new o.aM(We,et.u_terrain_exaggeration)}))(r,He),this.binderUniforms=f?f.getUniforms(r,He):[]}draw(r,l,f,p,y,T,E,A,F,D,R,q,oe,se,ce,ae,Ie,Ve){const ge=r.gl;if(this.failedToCreate)return;if(r.program.set(this.program),r.setDepthMode(f),r.setStencilMode(p),r.setColorMode(y),r.setCullFace(T),A){r.activeTexture.set(ge.TEXTURE2),ge.bindTexture(ge.TEXTURE_2D,A.depthTexture),r.activeTexture.set(ge.TEXTURE3),ge.bindTexture(ge.TEXTURE_2D,A.texture);for(const He in this.terrainUniforms)this.terrainUniforms[He].set(A[He])}for(const He in this.fixedUniforms)this.fixedUniforms[He].set(E[He]);ce&&ce.setUniforms(r,this.binderUniforms,oe,{zoom:se});let Pe=0;switch(l){case ge.LINES:Pe=2;break;case ge.TRIANGLES:Pe=3;break;case ge.LINE_STRIP:Pe=1}for(const He of q.get()){const We=He.vaos||(He.vaos={});(We[F]||(We[F]=new Nn)).bind(r,this,D,ce?ce.getPaintVertexBuffers():[],R,He.vertexOffset,ae,Ie,Ve),ge.drawElements(l,He.primitiveLength*Pe,ge.UNSIGNED_SHORT,He.primitiveOffset*Pe*2)}}}function Ai(g,r,l){const f=1/ke(l,1,r.transform.tileZoom),p=Math.pow(2,l.tileID.overscaledZ),y=l.tileSize*Math.pow(2,r.transform.tileZoom)/p,T=y*(l.tileID.canonical.x+l.tileID.wrap*p),E=y*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture.size,u_scale:[f,g.fromScale,g.toScale],u_fade:g.t,u_pixel_coord_upper:[T>>16,E>>16],u_pixel_coord_lower:[65535&T,65535&E]}}const wl=(g,r,l,f)=>{const p=r.style.light,y=p.properties.get("position"),T=[y.x,y.y,y.z],E=function(){var F=new o.A(9);return o.A!=Float32Array&&(F[1]=0,F[2]=0,F[3]=0,F[5]=0,F[6]=0,F[7]=0),F[0]=1,F[4]=1,F[8]=1,F}();p.properties.get("anchor")==="viewport"&&function(F,D){var R=Math.sin(D),q=Math.cos(D);F[0]=q,F[1]=R,F[2]=0,F[3]=-R,F[4]=q,F[5]=0,F[6]=0,F[7]=0,F[8]=1}(E,-r.transform.angle),function(F,D,R){var q=D[0],oe=D[1],se=D[2];F[0]=q*R[0]+oe*R[3]+se*R[6],F[1]=q*R[1]+oe*R[4]+se*R[7],F[2]=q*R[2]+oe*R[5]+se*R[8]}(T,T,E);const A=p.properties.get("color");return{u_matrix:g,u_lightpos:T,u_lightintensity:p.properties.get("intensity"),u_lightcolor:[A.r,A.g,A.b],u_vertical_gradient:+l,u_opacity:f}},En=(g,r,l,f,p,y,T)=>o.e(wl(g,r,l,f),Ai(y,r,T),{u_height_factor:-Math.pow(2,p.overscaledZ)/T.tileSize/8}),rh=g=>({u_matrix:g}),bl=(g,r,l,f)=>o.e(rh(g),Ai(l,r,f)),Eo=(g,r)=>({u_matrix:g,u_world:r}),So=(g,r,l,f,p)=>o.e(bl(g,r,l,f),{u_world:p}),Sn=(g,r,l,f)=>{const p=g.transform;let y,T;if(f.paint.get("circle-pitch-alignment")==="map"){const E=ke(l,1,p.zoom);y=!0,T=[E,E]}else y=!1,T=p.pixelsToGLUnits;return{u_camera_to_center_distance:p.cameraToCenterDistance,u_scale_with_map:+(f.paint.get("circle-pitch-scale")==="map"),u_matrix:g.translatePosMatrix(r.posMatrix,l,f.paint.get("circle-translate"),f.paint.get("circle-translate-anchor")),u_pitch_with_map:+y,u_device_pixel_ratio:g.pixelRatio,u_extrude_scale:T}},Tl=(g,r,l)=>{const f=ke(l,1,r.zoom),p=Math.pow(2,r.zoom-l.tileID.overscaledZ),y=l.tileID.overscaleFactor();return{u_matrix:g,u_camera_to_center_distance:r.cameraToCenterDistance,u_pixels_to_tile_units:f,u_extrude_scale:[r.pixelsToGLUnits[0]/(f*p),r.pixelsToGLUnits[1]/(f*p)],u_overscale_factor:y}},Bs=(g,r,l=1)=>({u_matrix:g,u_color:r,u_overlay:0,u_overlay_scale:l}),ah=g=>({u_matrix:g}),$u=(g,r,l,f)=>({u_matrix:g,u_extrude_scale:ke(r,1,l),u_intensity:f});function El(g,r){const l=Math.pow(2,r.canonical.z),f=r.canonical.y;return[new o.U(0,f/l).toLngLat().lat,new o.U(0,(f+1)/l).toLngLat().lat]}const Sl=(g,r,l,f)=>{const p=g.transform;return{u_matrix:ko(g,r,l,f),u_ratio:1/ke(r,1,p.zoom),u_device_pixel_ratio:g.pixelRatio,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},ih=(g,r,l,f,p)=>o.e(Sl(g,r,l,p),{u_image:0,u_image_height:f}),ju=(g,r,l,f,p)=>{const y=g.transform,T=sh(r,y);return{u_matrix:ko(g,r,l,p),u_texsize:r.imageAtlasTexture.size,u_ratio:1/ke(r,1,y.zoom),u_device_pixel_ratio:g.pixelRatio,u_image:0,u_scale:[T,f.fromScale,f.toScale],u_fade:f.t,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},nh=(g,r,l,f,p,y)=>{const T=g.lineAtlas,E=sh(r,g.transform),A=l.layout.get("line-cap")==="round",F=T.getDash(f.from,A),D=T.getDash(f.to,A),R=F.width*p.fromScale,q=D.width*p.toScale;return o.e(Sl(g,r,l,y),{u_patternscale_a:[E/R,-F.height/2],u_patternscale_b:[E/q,-D.height/2],u_sdfgamma:T.width/(256*Math.min(R,q)*g.pixelRatio)/2,u_image:0,u_tex_y_a:F.y,u_tex_y_b:D.y,u_mix:p.t})};function sh(g,r){return 1/ke(g,1,r.tileZoom)}function ko(g,r,l,f){return g.translatePosMatrix(f?f.posMatrix:r.tileID.posMatrix,r,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}const oh=(g,r,l,f,p)=>{return{u_matrix:g,u_tl_parent:r,u_scale_parent:l,u_buffer_scale:1,u_fade_t:f.mix,u_opacity:f.opacity*p.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:p.paint.get("raster-brightness-min"),u_brightness_high:p.paint.get("raster-brightness-max"),u_saturation_factor:(T=p.paint.get("raster-saturation"),T>0?1-1/(1.001-T):-T),u_contrast_factor:(y=p.paint.get("raster-contrast"),y>0?1/(1-y):1+y),u_spin_weights:lh(p.paint.get("raster-hue-rotate"))};var y,T};function lh(g){g*=Math.PI/180;const r=Math.sin(g),l=Math.cos(g);return[(2*l+1)/3,(-Math.sqrt(3)*r-l+1)/3,(Math.sqrt(3)*r-l+1)/3]}const kl=(g,r,l,f,p,y,T,E,A,F)=>{const D=p.transform;return{u_is_size_zoom_constant:+(g==="constant"||g==="source"),u_is_size_feature_constant:+(g==="constant"||g==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:D.cameraToCenterDistance,u_pitch:D.pitch/360*2*Math.PI,u_rotate_symbol:+l,u_aspect_ratio:D.width/D.height,u_fade_change:p.options.fadeDuration?p.symbolFadeChange:1,u_matrix:y,u_label_plane_matrix:T,u_coord_matrix:E,u_is_text:+A,u_pitch_with_map:+f,u_texsize:F,u_texture:0}},Cl=(g,r,l,f,p,y,T,E,A,F,D)=>{const R=p.transform;return o.e(kl(g,r,l,f,p,y,T,E,A,F),{u_gamma_scale:f?Math.cos(R._pitch)*R.cameraToCenterDistance:1,u_device_pixel_ratio:p.pixelRatio,u_is_halo:+D})},Un=(g,r,l,f,p,y,T,E,A,F)=>o.e(Cl(g,r,l,f,p,y,T,E,!0,A,!0),{u_texsize_icon:F,u_texture_icon:1}),Co=(g,r,l)=>({u_matrix:g,u_opacity:r,u_color:l}),Ii=(g,r,l,f,p,y)=>o.e(function(T,E,A,F){const D=A.imageManager.getPattern(T.from.toString()),R=A.imageManager.getPattern(T.to.toString()),{width:q,height:oe}=A.imageManager.getPixelSize(),se=Math.pow(2,F.tileID.overscaledZ),ce=F.tileSize*Math.pow(2,A.transform.tileZoom)/se,ae=ce*(F.tileID.canonical.x+F.tileID.wrap*se),Ie=ce*F.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:D.tl,u_pattern_br_a:D.br,u_pattern_tl_b:R.tl,u_pattern_br_b:R.br,u_texsize:[q,oe],u_mix:E.t,u_pattern_size_a:D.displaySize,u_pattern_size_b:R.displaySize,u_scale_a:E.fromScale,u_scale_b:E.toScale,u_tile_units_to_pixels:1/ke(F,1,A.transform.tileZoom),u_pixel_coord_upper:[ae>>16,Ie>>16],u_pixel_coord_lower:[65535&ae,65535&Ie]}}(f,y,l,p),{u_matrix:g,u_opacity:r}),Ao={fillExtrusion:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_lightpos:new o.aP(g,r.u_lightpos),u_lightintensity:new o.aM(g,r.u_lightintensity),u_lightcolor:new o.aP(g,r.u_lightcolor),u_vertical_gradient:new o.aM(g,r.u_vertical_gradient),u_opacity:new o.aM(g,r.u_opacity)}),fillExtrusionPattern:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_lightpos:new o.aP(g,r.u_lightpos),u_lightintensity:new o.aM(g,r.u_lightintensity),u_lightcolor:new o.aP(g,r.u_lightcolor),u_vertical_gradient:new o.aM(g,r.u_vertical_gradient),u_height_factor:new o.aM(g,r.u_height_factor),u_image:new o.aL(g,r.u_image),u_texsize:new o.aQ(g,r.u_texsize),u_pixel_coord_upper:new o.aQ(g,r.u_pixel_coord_upper),u_pixel_coord_lower:new o.aQ(g,r.u_pixel_coord_lower),u_scale:new o.aP(g,r.u_scale),u_fade:new o.aM(g,r.u_fade),u_opacity:new o.aM(g,r.u_opacity)}),fill:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix)}),fillPattern:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_image:new o.aL(g,r.u_image),u_texsize:new o.aQ(g,r.u_texsize),u_pixel_coord_upper:new o.aQ(g,r.u_pixel_coord_upper),u_pixel_coord_lower:new o.aQ(g,r.u_pixel_coord_lower),u_scale:new o.aP(g,r.u_scale),u_fade:new o.aM(g,r.u_fade)}),fillOutline:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_world:new o.aQ(g,r.u_world)}),fillOutlinePattern:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_world:new o.aQ(g,r.u_world),u_image:new o.aL(g,r.u_image),u_texsize:new o.aQ(g,r.u_texsize),u_pixel_coord_upper:new o.aQ(g,r.u_pixel_coord_upper),u_pixel_coord_lower:new o.aQ(g,r.u_pixel_coord_lower),u_scale:new o.aP(g,r.u_scale),u_fade:new o.aM(g,r.u_fade)}),circle:(g,r)=>({u_camera_to_center_distance:new o.aM(g,r.u_camera_to_center_distance),u_scale_with_map:new o.aL(g,r.u_scale_with_map),u_pitch_with_map:new o.aL(g,r.u_pitch_with_map),u_extrude_scale:new o.aQ(g,r.u_extrude_scale),u_device_pixel_ratio:new o.aM(g,r.u_device_pixel_ratio),u_matrix:new o.aN(g,r.u_matrix)}),collisionBox:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_camera_to_center_distance:new o.aM(g,r.u_camera_to_center_distance),u_pixels_to_tile_units:new o.aM(g,r.u_pixels_to_tile_units),u_extrude_scale:new o.aQ(g,r.u_extrude_scale),u_overscale_factor:new o.aM(g,r.u_overscale_factor)}),collisionCircle:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_inv_matrix:new o.aN(g,r.u_inv_matrix),u_camera_to_center_distance:new o.aM(g,r.u_camera_to_center_distance),u_viewport_size:new o.aQ(g,r.u_viewport_size)}),debug:(g,r)=>({u_color:new o.aR(g,r.u_color),u_matrix:new o.aN(g,r.u_matrix),u_overlay:new o.aL(g,r.u_overlay),u_overlay_scale:new o.aM(g,r.u_overlay_scale)}),clippingMask:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix)}),heatmap:(g,r)=>({u_extrude_scale:new o.aM(g,r.u_extrude_scale),u_intensity:new o.aM(g,r.u_intensity),u_matrix:new o.aN(g,r.u_matrix)}),heatmapTexture:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_world:new o.aQ(g,r.u_world),u_image:new o.aL(g,r.u_image),u_color_ramp:new o.aL(g,r.u_color_ramp),u_opacity:new o.aM(g,r.u_opacity)}),hillshade:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_image:new o.aL(g,r.u_image),u_latrange:new o.aQ(g,r.u_latrange),u_light:new o.aQ(g,r.u_light),u_shadow:new o.aR(g,r.u_shadow),u_highlight:new o.aR(g,r.u_highlight),u_accent:new o.aR(g,r.u_accent)}),hillshadePrepare:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_image:new o.aL(g,r.u_image),u_dimension:new o.aQ(g,r.u_dimension),u_zoom:new o.aM(g,r.u_zoom),u_unpack:new o.aO(g,r.u_unpack)}),line:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_ratio:new o.aM(g,r.u_ratio),u_device_pixel_ratio:new o.aM(g,r.u_device_pixel_ratio),u_units_to_pixels:new o.aQ(g,r.u_units_to_pixels)}),lineGradient:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_ratio:new o.aM(g,r.u_ratio),u_device_pixel_ratio:new o.aM(g,r.u_device_pixel_ratio),u_units_to_pixels:new o.aQ(g,r.u_units_to_pixels),u_image:new o.aL(g,r.u_image),u_image_height:new o.aM(g,r.u_image_height)}),linePattern:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_texsize:new o.aQ(g,r.u_texsize),u_ratio:new o.aM(g,r.u_ratio),u_device_pixel_ratio:new o.aM(g,r.u_device_pixel_ratio),u_image:new o.aL(g,r.u_image),u_units_to_pixels:new o.aQ(g,r.u_units_to_pixels),u_scale:new o.aP(g,r.u_scale),u_fade:new o.aM(g,r.u_fade)}),lineSDF:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_ratio:new o.aM(g,r.u_ratio),u_device_pixel_ratio:new o.aM(g,r.u_device_pixel_ratio),u_units_to_pixels:new o.aQ(g,r.u_units_to_pixels),u_patternscale_a:new o.aQ(g,r.u_patternscale_a),u_patternscale_b:new o.aQ(g,r.u_patternscale_b),u_sdfgamma:new o.aM(g,r.u_sdfgamma),u_image:new o.aL(g,r.u_image),u_tex_y_a:new o.aM(g,r.u_tex_y_a),u_tex_y_b:new o.aM(g,r.u_tex_y_b),u_mix:new o.aM(g,r.u_mix)}),raster:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_tl_parent:new o.aQ(g,r.u_tl_parent),u_scale_parent:new o.aM(g,r.u_scale_parent),u_buffer_scale:new o.aM(g,r.u_buffer_scale),u_fade_t:new o.aM(g,r.u_fade_t),u_opacity:new o.aM(g,r.u_opacity),u_image0:new o.aL(g,r.u_image0),u_image1:new o.aL(g,r.u_image1),u_brightness_low:new o.aM(g,r.u_brightness_low),u_brightness_high:new o.aM(g,r.u_brightness_high),u_saturation_factor:new o.aM(g,r.u_saturation_factor),u_contrast_factor:new o.aM(g,r.u_contrast_factor),u_spin_weights:new o.aP(g,r.u_spin_weights)}),symbolIcon:(g,r)=>({u_is_size_zoom_constant:new o.aL(g,r.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aL(g,r.u_is_size_feature_constant),u_size_t:new o.aM(g,r.u_size_t),u_size:new o.aM(g,r.u_size),u_camera_to_center_distance:new o.aM(g,r.u_camera_to_center_distance),u_pitch:new o.aM(g,r.u_pitch),u_rotate_symbol:new o.aL(g,r.u_rotate_symbol),u_aspect_ratio:new o.aM(g,r.u_aspect_ratio),u_fade_change:new o.aM(g,r.u_fade_change),u_matrix:new o.aN(g,r.u_matrix),u_label_plane_matrix:new o.aN(g,r.u_label_plane_matrix),u_coord_matrix:new o.aN(g,r.u_coord_matrix),u_is_text:new o.aL(g,r.u_is_text),u_pitch_with_map:new o.aL(g,r.u_pitch_with_map),u_texsize:new o.aQ(g,r.u_texsize),u_texture:new o.aL(g,r.u_texture)}),symbolSDF:(g,r)=>({u_is_size_zoom_constant:new o.aL(g,r.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aL(g,r.u_is_size_feature_constant),u_size_t:new o.aM(g,r.u_size_t),u_size:new o.aM(g,r.u_size),u_camera_to_center_distance:new o.aM(g,r.u_camera_to_center_distance),u_pitch:new o.aM(g,r.u_pitch),u_rotate_symbol:new o.aL(g,r.u_rotate_symbol),u_aspect_ratio:new o.aM(g,r.u_aspect_ratio),u_fade_change:new o.aM(g,r.u_fade_change),u_matrix:new o.aN(g,r.u_matrix),u_label_plane_matrix:new o.aN(g,r.u_label_plane_matrix),u_coord_matrix:new o.aN(g,r.u_coord_matrix),u_is_text:new o.aL(g,r.u_is_text),u_pitch_with_map:new o.aL(g,r.u_pitch_with_map),u_texsize:new o.aQ(g,r.u_texsize),u_texture:new o.aL(g,r.u_texture),u_gamma_scale:new o.aM(g,r.u_gamma_scale),u_device_pixel_ratio:new o.aM(g,r.u_device_pixel_ratio),u_is_halo:new o.aL(g,r.u_is_halo)}),symbolTextAndIcon:(g,r)=>({u_is_size_zoom_constant:new o.aL(g,r.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aL(g,r.u_is_size_feature_constant),u_size_t:new o.aM(g,r.u_size_t),u_size:new o.aM(g,r.u_size),u_camera_to_center_distance:new o.aM(g,r.u_camera_to_center_distance),u_pitch:new o.aM(g,r.u_pitch),u_rotate_symbol:new o.aL(g,r.u_rotate_symbol),u_aspect_ratio:new o.aM(g,r.u_aspect_ratio),u_fade_change:new o.aM(g,r.u_fade_change),u_matrix:new o.aN(g,r.u_matrix),u_label_plane_matrix:new o.aN(g,r.u_label_plane_matrix),u_coord_matrix:new o.aN(g,r.u_coord_matrix),u_is_text:new o.aL(g,r.u_is_text),u_pitch_with_map:new o.aL(g,r.u_pitch_with_map),u_texsize:new o.aQ(g,r.u_texsize),u_texsize_icon:new o.aQ(g,r.u_texsize_icon),u_texture:new o.aL(g,r.u_texture),u_texture_icon:new o.aL(g,r.u_texture_icon),u_gamma_scale:new o.aM(g,r.u_gamma_scale),u_device_pixel_ratio:new o.aM(g,r.u_device_pixel_ratio),u_is_halo:new o.aL(g,r.u_is_halo)}),background:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_opacity:new o.aM(g,r.u_opacity),u_color:new o.aR(g,r.u_color)}),backgroundPattern:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_opacity:new o.aM(g,r.u_opacity),u_image:new o.aL(g,r.u_image),u_pattern_tl_a:new o.aQ(g,r.u_pattern_tl_a),u_pattern_br_a:new o.aQ(g,r.u_pattern_br_a),u_pattern_tl_b:new o.aQ(g,r.u_pattern_tl_b),u_pattern_br_b:new o.aQ(g,r.u_pattern_br_b),u_texsize:new o.aQ(g,r.u_texsize),u_mix:new o.aM(g,r.u_mix),u_pattern_size_a:new o.aQ(g,r.u_pattern_size_a),u_pattern_size_b:new o.aQ(g,r.u_pattern_size_b),u_scale_a:new o.aM(g,r.u_scale_a),u_scale_b:new o.aM(g,r.u_scale_b),u_pixel_coord_upper:new o.aQ(g,r.u_pixel_coord_upper),u_pixel_coord_lower:new o.aQ(g,r.u_pixel_coord_lower),u_tile_units_to_pixels:new o.aM(g,r.u_tile_units_to_pixels)}),terrain:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_texture:new o.aL(g,r.u_texture),u_ele_delta:new o.aM(g,r.u_ele_delta)}),terrainDepth:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_ele_delta:new o.aM(g,r.u_ele_delta)}),terrainCoords:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_texture:new o.aL(g,r.u_texture),u_terrain_coords_id:new o.aM(g,r.u_terrain_coords_id),u_ele_delta:new o.aM(g,r.u_ele_delta)})};class Io{constructor(r,l,f){this.context=r;const p=r.gl;this.buffer=p.createBuffer(),this.dynamicDraw=!!f,this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete l.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){const l=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const zs={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Fo{constructor(r,l,f,p){this.length=l.length,this.attributes=f,this.itemSize=l.bytesPerElement,this.dynamicDraw=p,this.context=r;const y=r.gl;this.buffer=y.createBuffer(),r.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete l.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){if(r.length!==this.length)throw new Error(`Length of new data is ${r.length}, which doesn't match current length of ${this.length}`);const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,l){for(let f=0;f<this.attributes.length;f++){const p=l.attributes[this.attributes[f].name];p!==void 0&&r.enableVertexAttribArray(p)}}setVertexAttribPointers(r,l,f){for(let p=0;p<this.attributes.length;p++){const y=this.attributes[p],T=l.attributes[y.name];T!==void 0&&r.vertexAttribPointer(T,y.components,r[zs[y.type]],!1,this.itemSize,y.offset+this.itemSize*(f||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ls=new WeakMap;function kn(g){var r;if(ls.has(g))return ls.get(g);{const l=(r=g.getParameter(g.VERSION))===null||r===void 0?void 0:r.startsWith("WebGL 2.0");return ls.set(g,l),l}}class dr{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Po extends dr{getDefault(){return o.aT.transparent}set(r){const l=this.current;(r.r!==l.r||r.g!==l.g||r.b!==l.b||r.a!==l.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class di extends dr{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class pi extends dr{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class Al extends dr{getDefault(){return[!0,!0,!0,!0]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||r[3]!==l[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Mo extends dr{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class Do extends dr{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class Il extends dr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const l=this.current;(r.func!==l.func||r.ref!==l.ref||r.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class Fl extends dr{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class Lo extends dr{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=r,this.dirty=!1}}class Pl extends dr{getDefault(){return[0,1]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class Ml extends dr{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=r,this.dirty=!1}}class Ro extends dr{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class ch extends dr{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.BLEND):l.disable(l.BLEND),this.current=r,this.dirty=!1}}class hh extends dr{getDefault(){const r=this.gl;return[r.ONE,r.ZERO]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||this.dirty)&&(this.gl.blendFunc(r[0],r[1]),this.current=r,this.dirty=!1)}}class cs extends dr{getDefault(){return o.aT.transparent}set(r){const l=this.current;(r.r!==l.r||r.g!==l.g||r.b!==l.b||r.a!==l.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Gu extends dr{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquation(r),this.current=r,this.dirty=!1)}}class Hu extends dr{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=r,this.dirty=!1}}class qu extends dr{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class Wu extends dr{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}class Zu extends dr{getDefault(){return null}set(r){(r!==this.current||this.dirty)&&(this.gl.useProgram(r),this.current=r,this.dirty=!1)}}class Xu extends dr{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class Dl extends dr{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||r[3]!==l[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Oo extends dr{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class Ll extends dr{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Rl extends dr{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class hs extends dr{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class uh extends dr{getDefault(){return null}set(r){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class fh extends dr{getDefault(){return null}set(r){var l;if(r===this.current&&!this.dirty)return;const f=this.gl;kn(f)?f.bindVertexArray(r):(l=f.getExtension("OES_vertex_array_object"))===null||l===void 0||l.bindVertexArrayOES(r),this.current=r,this.dirty=!1}}class Ol extends dr{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class Vn extends dr{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class dh extends dr{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class Cn extends dr{constructor(r,l){super(r),this.context=r,this.parent=l}getDefault(){return null}}class us extends Cn{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class ph extends Cn{set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,l.DEPTH_ATTACHMENT,l.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Bl extends Cn{set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,l.DEPTH_STENCIL_ATTACHMENT,l.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class _r{constructor(r,l,f,p,y){this.context=r,this.width=l,this.height=f;const T=r.gl,E=this.framebuffer=T.createFramebuffer();if(this.colorAttachment=new us(r,E),p)this.depthAttachment=y?new Bl(r,E):new ph(r,E);else if(y)throw new Error("Stencil cannot be setted without depth");if(T.checkFramebufferStatus(T.FRAMEBUFFER)!==T.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const r=this.context.gl,l=this.colorAttachment.get();if(l&&r.deleteTexture(l),this.depthAttachment){const f=this.depthAttachment.get();f&&r.deleteRenderbuffer(f)}r.deleteFramebuffer(this.framebuffer)}}class Ur{constructor(r,l,f){this.blendFunction=r,this.blendColor=l,this.mask=f}}Ur.Replace=[1,0],Ur.disabled=new Ur(Ur.Replace,o.aT.transparent,[!1,!1,!1,!1]),Ur.unblended=new Ur(Ur.Replace,o.aT.transparent,[!0,!0,!0,!0]),Ur.alphaBlended=new Ur([1,771],o.aT.transparent,[!0,!0,!0,!0]);class Ku{constructor(r){var l,f;if(this.gl=r,this.clearColor=new Po(this),this.clearDepth=new di(this),this.clearStencil=new pi(this),this.colorMask=new Al(this),this.depthMask=new Mo(this),this.stencilMask=new Do(this),this.stencilFunc=new Il(this),this.stencilOp=new Fl(this),this.stencilTest=new Lo(this),this.depthRange=new Pl(this),this.depthTest=new Ml(this),this.depthFunc=new Ro(this),this.blend=new ch(this),this.blendFunc=new hh(this),this.blendColor=new cs(this),this.blendEquation=new Gu(this),this.cullFace=new Hu(this),this.cullFaceSide=new qu(this),this.frontFace=new Wu(this),this.program=new Zu(this),this.activeTexture=new Xu(this),this.viewport=new Dl(this),this.bindFramebuffer=new Oo(this),this.bindRenderbuffer=new Ll(this),this.bindTexture=new Rl(this),this.bindVertexBuffer=new hs(this),this.bindElementBuffer=new uh(this),this.bindVertexArray=new fh(this),this.pixelStoreUnpack=new Ol(this),this.pixelStoreUnpackPremultiplyAlpha=new Vn(this),this.pixelStoreUnpackFlipY=new dh(this),this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),kn(r)){this.HALF_FLOAT=r.HALF_FLOAT;const p=r.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(l=r.RGBA16F)!==null&&l!==void 0?l:p?.RGBA16F_EXT,this.RGB16F=(f=r.RGB16F)!==null&&f!==void 0?f:p?.RGB16F_EXT,r.getExtension("EXT_color_buffer_float")}else{r.getExtension("EXT_color_buffer_half_float"),r.getExtension("OES_texture_half_float_linear");const p=r.getExtension("OES_texture_half_float");this.HALF_FLOAT=p?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,l){return new Io(this,r,l)}createVertexBuffer(r,l,f){return new Fo(this,r,l,f)}createRenderbuffer(r,l,f){const p=this.gl,y=p.createRenderbuffer();return this.bindRenderbuffer.set(y),p.renderbufferStorage(p.RENDERBUFFER,r,l,f),this.bindRenderbuffer.set(null),y}createFramebuffer(r,l,f,p){return new _r(this,r,l,f,p)}clear({color:r,depth:l,stencil:f}){const p=this.gl;let y=0;r&&(y|=p.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set([!0,!0,!0,!0])),l!==void 0&&(y|=p.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),f!==void 0&&(y|=p.STENCIL_BUFFER_BIT,this.clearStencil.set(f),this.stencilMask.set(255)),p.clear(y)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){o.aG(r.blendFunction,Ur.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}createVertexArray(){var r;return kn(this.gl)?this.gl.createVertexArray():(r=this.gl.getExtension("OES_vertex_array_object"))===null||r===void 0?void 0:r.createVertexArrayOES()}deleteVertexArray(r){var l;return kn(this.gl)?this.gl.deleteVertexArray(r):(l=this.gl.getExtension("OES_vertex_array_object"))===null||l===void 0?void 0:l.deleteVertexArrayOES(r)}unbindVAO(){this.bindVertexArray.set(null)}}class pr{constructor(r,l,f){this.func=r,this.mask=l,this.range=f}}pr.ReadOnly=!1,pr.ReadWrite=!0,pr.disabled=new pr(519,pr.ReadOnly,[0,1]);const $n=7680;class Vr{constructor(r,l,f,p,y,T){this.test=r,this.ref=l,this.mask=f,this.fail=p,this.depthFail=y,this.pass=T}}Vr.disabled=new Vr({func:519,mask:0},0,0,$n,$n,$n);class Or{constructor(r,l,f){this.enable=r,this.mode=l,this.frontFace=f}}let Ns;function mh(g,r,l,f,p,y,T){const E=g.context,A=E.gl,F=g.useProgram("collisionBox"),D=[];let R=0,q=0;for(let ge=0;ge<f.length;ge++){const Pe=f[ge],He=r.getTile(Pe),We=He.getBucket(l);if(!We)continue;let et=Pe.posMatrix;p[0]===0&&p[1]===0||(et=g.translatePosMatrix(Pe.posMatrix,He,p,y));const ct=T?We.textCollisionBox:We.iconCollisionBox,nt=We.collisionCircleArray;if(nt.length>0){const xt=o.Z(),Lt=et;o.aU(xt,We.placementInvProjMatrix,g.transform.glCoordMatrix),o.aU(xt,xt,We.placementViewportMatrix),D.push({circleArray:nt,circleOffset:q,transform:Lt,invTransform:xt,coord:Pe}),R+=nt.length/4,q=R}ct&&F.draw(E,A.LINES,pr.disabled,Vr.disabled,g.colorModeForRenderPass(),Or.disabled,Tl(et,g.transform,He),g.style.map.terrain&&g.style.map.terrain.getTerrainData(Pe),l.id,ct.layoutVertexBuffer,ct.indexBuffer,ct.segments,null,g.transform.zoom,null,null,ct.collisionVertexBuffer)}if(!T||!D.length)return;const oe=g.useProgram("collisionCircle"),se=new o.aV;se.resize(4*R),se._trim();let ce=0;for(const ge of D)for(let Pe=0;Pe<ge.circleArray.length/4;Pe++){const He=4*Pe,We=ge.circleArray[He+0],et=ge.circleArray[He+1],ct=ge.circleArray[He+2],nt=ge.circleArray[He+3];se.emplace(ce++,We,et,ct,nt,0),se.emplace(ce++,We,et,ct,nt,1),se.emplace(ce++,We,et,ct,nt,2),se.emplace(ce++,We,et,ct,nt,3)}(!Ns||Ns.length<2*R)&&(Ns=function(ge){const Pe=2*ge,He=new o.aX;He.resize(Pe),He._trim();for(let We=0;We<Pe;We++){const et=6*We;He.uint16[et+0]=4*We+0,He.uint16[et+1]=4*We+1,He.uint16[et+2]=4*We+2,He.uint16[et+3]=4*We+2,He.uint16[et+4]=4*We+3,He.uint16[et+5]=4*We+0}return He}(R));const ae=E.createIndexBuffer(Ns,!0),Ie=E.createVertexBuffer(se,o.aW.members,!0);for(const ge of D){const Pe={u_matrix:ge.transform,u_inv_matrix:ge.invTransform,u_camera_to_center_distance:(Ve=g.transform).cameraToCenterDistance,u_viewport_size:[Ve.width,Ve.height]};oe.draw(E,A.TRIANGLES,pr.disabled,Vr.disabled,g.colorModeForRenderPass(),Or.disabled,Pe,g.style.map.terrain&&g.style.map.terrain.getTerrainData(ge.coord),l.id,Ie,ae,o.S.simpleSegment(0,2*ge.circleOffset,ge.circleArray.length,ge.circleArray.length/2),null,g.transform.zoom,null,null,null)}var Ve;Ie.destroy(),ae.destroy()}Or.disabled=new Or(!1,1029,2305),Or.backCCW=new Or(!0,1029,2305);const zl=o.ao(new Float32Array(16));function Bo(g,r,l,f,p,y){const{horizontalAlign:T,verticalAlign:E}=o.au(g);return new o.P((-(T-.5)*r/p+f[0])*y,(-(E-.5)*l/p+f[1])*y)}function zo(g,r,l,f,p,y,T,E,A,F,D){const R=g.text.placedSymbolArray,q=g.text.dynamicLayoutVertexArray,oe=g.icon.dynamicLayoutVertexArray,se={};q.clear();for(let ce=0;ce<R.length;ce++){const ae=R.get(ce),Ie=ae.hidden||!ae.crossTileID||g.allowVerticalPlacement&&!ae.placedOrientation?null:f[ae.crossTileID];if(Ie){const Ve=new o.P(ae.anchorX,ae.anchorY),ge=Ut(Ve,l?T:y,D),Pe=gr(p.cameraToCenterDistance,ge.signedDistanceFromCamera);let He=o.aj(g.textSizeData,A,ae)*Pe/o.ap;l&&(He*=g.tilePixelRatio/E);const{width:We,height:et,anchor:ct,textOffset:nt,textBoxScale:xt}=Ie,Lt=Bo(ct,We,et,nt,xt,He),lr=l?Ut(Ve.add(Lt),y,D).point:ge.point.add(r?Lt.rotate(-p.angle):Lt),bt=g.allowVerticalPlacement&&ae.placedOrientation===o.ai.vertical?Math.PI/2:0;for(let Ht=0;Ht<ae.numGlyphs;Ht++)o.ak(q,lr,bt);F&&ae.associatedIconIndex>=0&&(se[ae.associatedIconIndex]={shiftedAnchor:lr,angle:bt})}else ee(ae.numGlyphs,q)}if(F){oe.clear();const ce=g.icon.placedSymbolArray;for(let ae=0;ae<ce.length;ae++){const Ie=ce.get(ae);if(Ie.hidden)ee(Ie.numGlyphs,oe);else{const Ve=se[ae];if(Ve)for(let ge=0;ge<Ie.numGlyphs;ge++)o.ak(oe,Ve.shiftedAnchor,Ve.angle);else ee(Ie.numGlyphs,oe)}}g.icon.dynamicLayoutVertexBuffer.updateData(oe)}g.text.dynamicLayoutVertexBuffer.updateData(q)}function Nl(g,r,l){return l.iconsInText&&r?"symbolTextAndIcon":g?"symbolSDF":"symbolIcon"}function No(g,r,l,f,p,y,T,E,A,F,D,R){const q=g.context,oe=q.gl,se=g.transform,ce=E==="map",ae=A==="map",Ie=E!=="viewport"&&l.layout.get("symbol-placement")!=="point",Ve=ce&&!ae&&!Ie,ge=!l.layout.get("symbol-sort-key").isConstant();let Pe=!1;const He=g.depthModeForSublayer(0,pr.ReadOnly),We=l._unevaluatedLayout.hasValue("text-variable-anchor")||l._unevaluatedLayout.hasValue("text-variable-anchor-offset"),et=[];for(const ct of f){const nt=r.getTile(ct),xt=nt.getBucket(l);if(!xt)continue;const Lt=p?xt.text:xt.icon;if(!Lt||!Lt.segments.get().length||!Lt.hasVisibleVertices)continue;const lr=Lt.programConfigurations.get(l.id),bt=p||xt.sdfIcons,Ht=p?xt.textSizeData:xt.iconSizeData,Ot=ae||se.pitch!==0,Cr=g.useProgram(Nl(bt,p,xt),lr),or=o.ah(Ht,se.zoom),ar=g.style.map.terrain&&g.style.map.terrain.getTerrainData(ct);let cr,Yr,Ir,Ca,da=[0,0],aa=null;if(p)Yr=nt.glyphAtlasTexture,Ir=oe.LINEAR,cr=nt.glyphAtlasTexture.size,xt.iconsInText&&(da=nt.imageAtlasTexture.size,aa=nt.imageAtlasTexture,Ca=Ot||g.options.rotating||g.options.zooming||Ht.kind==="composite"||Ht.kind==="camera"?oe.LINEAR:oe.NEAREST);else{const Jr=l.layout.get("icon-size").constantOr(0)!==1||xt.iconsNeedLinear;Yr=nt.imageAtlasTexture,Ir=bt||g.options.rotating||g.options.zooming||Jr||Ot?oe.LINEAR:oe.NEAREST,cr=nt.imageAtlasTexture.size}const xi=ke(nt,1,g.transform.zoom),Mr=lt(ct.posMatrix,ae,ce,g.transform,xi),Wi=Mt(ct.posMatrix,ae,ce,g.transform,xi),Zi=We&&xt.hasTextData(),Fn=l.layout.get("icon-text-fit")!=="none"&&Zi&&xt.hasIconData();if(Ie){const Jr=g.style.map.terrain?(ei,Qr)=>g.style.map.terrain.getElevation(ct,ei,Qr):null,pa=l.layout.get("text-rotation-alignment")==="map";it(xt,ct.posMatrix,g,p,Mr,Wi,ae,F,pa,Jr)}const Wn=g.translatePosMatrix(ct.posMatrix,nt,y,T),_s=Ie||p&&We||Fn?zl:Mr,Da=g.translatePosMatrix(Wi,nt,y,T,!0),Aa=bt&&l.paint.get(p?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ua;Ua=bt?xt.iconsInText?Un(Ht.kind,or,Ve,ae,g,Wn,_s,Da,cr,da):Cl(Ht.kind,or,Ve,ae,g,Wn,_s,Da,p,cr,!0):kl(Ht.kind,or,Ve,ae,g,Wn,_s,Da,p,cr);const Zn={program:Cr,buffers:Lt,uniformValues:Ua,atlasTexture:Yr,atlasTextureIcon:aa,atlasInterpolation:Ir,atlasInterpolationIcon:Ca,isSDF:bt,hasHalo:Aa};if(ge&&xt.canOverlap){Pe=!0;const Jr=Lt.segments.get();for(const pa of Jr)et.push({segments:new o.S([pa]),sortKey:pa.sortKey,state:Zn,terrainData:ar})}else et.push({segments:Lt.segments,sortKey:0,state:Zn,terrainData:ar})}Pe&&et.sort((ct,nt)=>ct.sortKey-nt.sortKey);for(const ct of et){const nt=ct.state;if(q.activeTexture.set(oe.TEXTURE0),nt.atlasTexture.bind(nt.atlasInterpolation,oe.CLAMP_TO_EDGE),nt.atlasTextureIcon&&(q.activeTexture.set(oe.TEXTURE1),nt.atlasTextureIcon&&nt.atlasTextureIcon.bind(nt.atlasInterpolationIcon,oe.CLAMP_TO_EDGE)),nt.isSDF){const xt=nt.uniformValues;nt.hasHalo&&(xt.u_is_halo=1,Ul(nt.buffers,ct.segments,l,g,nt.program,He,D,R,xt,ct.terrainData)),xt.u_is_halo=0}Ul(nt.buffers,ct.segments,l,g,nt.program,He,D,R,nt.uniformValues,ct.terrainData)}}function Ul(g,r,l,f,p,y,T,E,A,F){const D=f.context;p.draw(D,D.gl.TRIANGLES,y,T,E,Or.disabled,A,F,l.id,g.layoutVertexBuffer,g.indexBuffer,r,l.paint,f.transform.zoom,g.programConfigurations.get(l.id),g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer)}function Us(g,r,l,f,p){if(!l||!f||!f.imageAtlas)return;const y=f.imageAtlas.patternPositions;let T=y[l.to.toString()],E=y[l.from.toString()];if(!T&&E&&(T=E),!E&&T&&(E=T),!T||!E){const A=p.getPaintProperty(r);T=y[A],E=y[A]}T&&E&&g.setConstantPatternPositions(T,E)}function Vs(g,r,l,f,p,y,T){const E=g.context.gl,A="fill-pattern",F=l.paint.get(A),D=F&&F.constantOr(1),R=l.getCrossfadeParameters();let q,oe,se,ce,ae;T?(oe=D&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",q=E.LINES):(oe=D?"fillPattern":"fill",q=E.TRIANGLES);const Ie=F.constantOr(null);for(const Ve of f){const ge=r.getTile(Ve);if(D&&!ge.patternsLoaded())continue;const Pe=ge.getBucket(l);if(!Pe)continue;const He=Pe.programConfigurations.get(l.id),We=g.useProgram(oe,He),et=g.style.map.terrain&&g.style.map.terrain.getTerrainData(Ve);D&&(g.context.activeTexture.set(E.TEXTURE0),ge.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),He.updatePaintBuffers(R)),Us(He,A,Ie,ge,l);const ct=et?Ve:null,nt=g.translatePosMatrix(ct?ct.posMatrix:Ve.posMatrix,ge,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor"));if(T){ce=Pe.indexBuffer2,ae=Pe.segments2;const xt=[E.drawingBufferWidth,E.drawingBufferHeight];se=oe==="fillOutlinePattern"&&D?So(nt,g,R,ge,xt):Eo(nt,xt)}else ce=Pe.indexBuffer,ae=Pe.segments,se=D?bl(nt,g,R,ge):rh(nt);We.draw(g.context,q,p,g.stencilModeForClipping(Ve),y,Or.disabled,se,et,l.id,Pe.layoutVertexBuffer,ce,ae,l.paint,g.transform.zoom,He)}}function $s(g,r,l,f,p,y,T){const E=g.context,A=E.gl,F="fill-extrusion-pattern",D=l.paint.get(F),R=D.constantOr(1),q=l.getCrossfadeParameters(),oe=l.paint.get("fill-extrusion-opacity"),se=D.constantOr(null);for(const ce of f){const ae=r.getTile(ce),Ie=ae.getBucket(l);if(!Ie)continue;const Ve=g.style.map.terrain&&g.style.map.terrain.getTerrainData(ce),ge=Ie.programConfigurations.get(l.id),Pe=g.useProgram(R?"fillExtrusionPattern":"fillExtrusion",ge);R&&(g.context.activeTexture.set(A.TEXTURE0),ae.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),ge.updatePaintBuffers(q)),Us(ge,F,se,ae,l);const He=g.translatePosMatrix(ce.posMatrix,ae,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),We=l.paint.get("fill-extrusion-vertical-gradient"),et=R?En(He,g,We,oe,ce,q,ae):wl(He,g,We,oe);Pe.draw(E,E.gl.TRIANGLES,p,y,T,Or.backCCW,et,Ve,l.id,Ie.layoutVertexBuffer,Ie.indexBuffer,Ie.segments,l.paint,g.transform.zoom,ge,g.style.map.terrain&&Ie.centroidVertexBuffer)}}function Yu(g,r,l,f,p,y,T){const E=g.context,A=E.gl,F=l.fbo;if(!F)return;const D=g.useProgram("hillshade"),R=g.style.map.terrain&&g.style.map.terrain.getTerrainData(r);E.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,F.colorAttachment.get()),D.draw(E,A.TRIANGLES,p,y,T,Or.disabled,((q,oe,se,ce)=>{const ae=se.paint.get("hillshade-shadow-color"),Ie=se.paint.get("hillshade-highlight-color"),Ve=se.paint.get("hillshade-accent-color");let ge=se.paint.get("hillshade-illumination-direction")*(Math.PI/180);se.paint.get("hillshade-illumination-anchor")==="viewport"&&(ge-=q.transform.angle);const Pe=!q.options.moving;return{u_matrix:ce?ce.posMatrix:q.transform.calculatePosMatrix(oe.tileID.toUnwrapped(),Pe),u_image:0,u_latrange:El(0,oe.tileID),u_light:[se.paint.get("hillshade-exaggeration"),ge],u_shadow:ae,u_highlight:Ie,u_accent:Ve}})(g,l,f,R?r:null),R,f.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments)}function Vl(g,r,l,f,p,y){const T=g.context,E=T.gl,A=r.dem;if(A&&A.data){const F=A.dim,D=A.stride,R=A.getPixels();if(T.activeTexture.set(E.TEXTURE1),T.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||g.getTileTexture(D),r.demTexture){const oe=r.demTexture;oe.update(R,{premultiply:!1}),oe.bind(E.NEAREST,E.CLAMP_TO_EDGE)}else r.demTexture=new Ue(T,R,E.RGBA,{premultiply:!1}),r.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE);T.activeTexture.set(E.TEXTURE0);let q=r.fbo;if(!q){const oe=new Ue(T,{width:F,height:F,data:null},E.RGBA);oe.bind(E.LINEAR,E.CLAMP_TO_EDGE),q=r.fbo=T.createFramebuffer(F,F,!0,!1),q.colorAttachment.set(oe.texture)}T.bindFramebuffer.set(q.framebuffer),T.viewport.set([0,0,F,F]),g.useProgram("hillshadePrepare").draw(T,E.TRIANGLES,f,p,y,Or.disabled,((oe,se)=>{const ce=se.stride,ae=o.Z();return o.aS(ae,0,o.N,-o.N,0,0,1),o.$(ae,ae,[0,-o.N,0]),{u_matrix:ae,u_image:1,u_dimension:[ce,ce],u_zoom:oe.overscaledZ,u_unpack:se.getUnpackVector()}})(r.tileID,A),null,l.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments),r.needsHillshadePrepare=!1}}function Ju(g,r,l,f,p,y){const T=f.paint.get("raster-fade-duration");if(!y&&T>0){const E=o.h.now(),A=(E-g.timeAdded)/T,F=r?(E-r.timeAdded)/T:-1,D=l.getSource(),R=p.coveringZoomLevel({tileSize:D.tileSize,roundZoom:D.roundZoom}),q=!r||Math.abs(r.tileID.overscaledZ-R)>Math.abs(g.tileID.overscaledZ-R),oe=q&&g.refreshedUponExpiration?1:o.ad(q?A:1-F,0,1);return g.refreshedUponExpiration&&A>=1&&(g.refreshedUponExpiration=!1),r?{opacity:1,mix:1-oe}:{opacity:oe,mix:0}}return{opacity:1,mix:0}}const gh=new o.aT(1,0,0,1),Uo=new o.aT(0,1,0,1),$l=new o.aT(0,0,1,1),xh=new o.aT(1,0,1,1),_h=new o.aT(0,1,1,1);function js(g,r,l,f){$o(g,0,r+l/2,g.transform.width,l,f)}function Vo(g,r,l,f){$o(g,r-l/2,0,l,g.transform.height,f)}function $o(g,r,l,f,p,y){const T=g.context,E=T.gl;E.enable(E.SCISSOR_TEST),E.scissor(r*g.pixelRatio,l*g.pixelRatio,f*g.pixelRatio,p*g.pixelRatio),T.clear({color:y}),E.disable(E.SCISSOR_TEST)}function yh(g,r,l){const f=g.context,p=f.gl,y=l.posMatrix,T=g.useProgram("debug"),E=pr.disabled,A=Vr.disabled,F=g.colorModeForRenderPass(),D="$debug",R=g.style.map.terrain&&g.style.map.terrain.getTerrainData(l);f.activeTexture.set(p.TEXTURE0);const q=r.getTileByID(l.key).latestRawTileData,oe=Math.floor((q&&q.byteLength||0)/1024),se=r.getTile(l).tileSize,ce=512/Math.min(se,512)*(l.overscaledZ/g.transform.zoom)*.5;let ae=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(ae+=` => ${l.overscaledZ}`),function(Ie,Ve){Ie.initDebugOverlayCanvas();const ge=Ie.debugOverlayCanvas,Pe=Ie.context.gl,He=Ie.debugOverlayCanvas.getContext("2d");He.clearRect(0,0,ge.width,ge.height),He.shadowColor="white",He.shadowBlur=2,He.lineWidth=1.5,He.strokeStyle="white",He.textBaseline="top",He.font="bold 36px Open Sans, sans-serif",He.fillText(Ve,5,5),He.strokeText(Ve,5,5),Ie.debugOverlayTexture.update(ge),Ie.debugOverlayTexture.bind(Pe.LINEAR,Pe.CLAMP_TO_EDGE)}(g,`${ae} ${oe}kB`),T.draw(f,p.TRIANGLES,E,A,Ur.alphaBlended,Or.disabled,Bs(y,o.aT.transparent,ce),null,D,g.debugBuffer,g.quadTriangleIndexBuffer,g.debugSegments),T.draw(f,p.LINE_STRIP,E,A,F,Or.disabled,Bs(y,o.aT.red),R,D,g.debugBuffer,g.tileBorderIndexBuffer,g.debugSegments)}function Hr(g,r,l){const f=g.context,p=f.gl,y=g.colorModeForRenderPass(),T=new pr(p.LEQUAL,pr.ReadWrite,g.depthRangeFor3D),E=g.useProgram("terrain"),A=r.getTerrainMesh();f.bindFramebuffer.set(null),f.viewport.set([0,0,g.width,g.height]);for(const F of l){const D=g.renderToTexture.getTexture(F),R=r.getTerrainData(F.tileID);f.activeTexture.set(p.TEXTURE0),p.bindTexture(p.TEXTURE_2D,D.texture);const q={u_matrix:g.transform.calculatePosMatrix(F.tileID.toUnwrapped()),u_texture:0,u_ele_delta:r.getMeshFrameDelta(g.transform.zoom)};E.draw(f,p.TRIANGLES,T,Vr.disabled,y,Or.backCCW,q,R,"terrain",A.vertexBuffer,A.indexBuffer,A.segments)}}class jn{constructor(r,l){this.context=new Ku(r),this.transform=l,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.Z(),renderTime:0},this.setup(),this.numSublayers=Fr.maxUnderzooming+Fr.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Hi}resize(r,l,f){if(this.width=Math.floor(r*f),this.height=Math.floor(l*f),this.pixelRatio=f,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style._order)this.style._layers[p].resize()}setup(){const r=this.context,l=new o.a_;l.emplaceBack(0,0),l.emplaceBack(o.N,0),l.emplaceBack(0,o.N),l.emplaceBack(o.N,o.N),this.tileExtentBuffer=r.createVertexBuffer(l,bo.members),this.tileExtentSegments=o.S.simpleSegment(0,0,4,2);const f=new o.a_;f.emplaceBack(0,0),f.emplaceBack(o.N,0),f.emplaceBack(0,o.N),f.emplaceBack(o.N,o.N),this.debugBuffer=r.createVertexBuffer(f,bo.members),this.debugSegments=o.S.simpleSegment(0,0,4,5);const p=new o.V;p.emplaceBack(0,0,0,0),p.emplaceBack(o.N,0,o.N,0),p.emplaceBack(0,o.N,0,o.N),p.emplaceBack(o.N,o.N,o.N,o.N),this.rasterBoundsBuffer=r.createVertexBuffer(p,ut.members),this.rasterBoundsSegments=o.S.simpleSegment(0,0,4,2);const y=new o.a_;y.emplaceBack(0,0),y.emplaceBack(1,0),y.emplaceBack(0,1),y.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(y,bo.members),this.viewportSegments=o.S.simpleSegment(0,0,4,2);const T=new o.a$;T.emplaceBack(0),T.emplaceBack(1),T.emplaceBack(3),T.emplaceBack(2),T.emplaceBack(0),this.tileBorderIndexBuffer=r.createIndexBuffer(T);const E=new o.b0;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(E);const A=this.context.gl;this.stencilClearMode=new Vr({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO)}clearStencil(){const r=this.context,l=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const f=o.Z();o.aS(f,0,this.width,this.height,0,0,1),o.a0(f,f,[l.drawingBufferWidth,l.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(r,l.TRIANGLES,pr.disabled,this.stencilClearMode,Ur.disabled,Or.disabled,ah(f),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(r,l){if(this.currentStencilSource===r.source||!r.isTileClipped()||!l||!l.length)return;this.currentStencilSource=r.source;const f=this.context,p=f.gl;this.nextStencilID+l.length>256&&this.clearStencil(),f.setColorMode(Ur.disabled),f.setDepthMode(pr.disabled);const y=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const T of l){const E=this._tileClippingMaskIDs[T.key]=this.nextStencilID++,A=this.style.map.terrain&&this.style.map.terrain.getTerrainData(T);y.draw(f,p.TRIANGLES,pr.disabled,new Vr({func:p.ALWAYS,mask:0},E,255,p.KEEP,p.KEEP,p.REPLACE),Ur.disabled,Or.disabled,ah(T.posMatrix),A,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,l=this.context.gl;return new Vr({func:l.NOTEQUAL,mask:255},r,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(r){const l=this.context.gl;return new Vr({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(r){const l=this.context.gl,f=r.sort((T,E)=>E.overscaledZ-T.overscaledZ),p=f[f.length-1].overscaledZ,y=f[0].overscaledZ-p+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const T={};for(let E=0;E<y;E++)T[E+p]=new Vr({func:l.GEQUAL,mask:255},E+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=y,[T,f]}return[{[p]:Vr.disabled},f]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new Ur([r.CONSTANT_COLOR,r.ONE],new o.aT(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ur.unblended:Ur.alphaBlended}depthModeForSublayer(r,l,f){if(!this.opaquePassEnabledForLayer())return pr.disabled;const p=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new pr(f||this.context.gl.LEQUAL,l,[p,p])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,l){this.style=r,this.options=l,this.lineAtlas=r.lineAtlas,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(o.h.now()),this.imageManager.beginFrame();const f=this.style._order,p=this.style.sourceCaches,y={},T={},E={};for(const A in p){const F=p[A];F.used&&F.prepare(this.context),y[A]=F.getVisibleCoordinates(),T[A]=y[A].slice().reverse(),E[A]=F.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let A=0;A<f.length;A++)if(this.style._layers[f[A]].is3D()){this.opaquePassCutoff=A;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const A=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!o.b1(this.terrainFacilitator.matrix,this.transform.projMatrix)||A.length)&&(o.b2(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(F,D){const R=F.context,q=R.gl,oe=Ur.unblended,se=new pr(q.LEQUAL,pr.ReadWrite,[0,1]),ce=D.getTerrainMesh(),ae=D.sourceCache.getRenderableTiles(),Ie=F.useProgram("terrainDepth");R.bindFramebuffer.set(D.getFramebuffer("depth").framebuffer),R.viewport.set([0,0,F.width/devicePixelRatio,F.height/devicePixelRatio]),R.clear({color:o.aT.transparent,depth:1});for(const Ve of ae){const ge=D.getTerrainData(Ve.tileID),Pe={u_matrix:F.transform.calculatePosMatrix(Ve.tileID.toUnwrapped()),u_ele_delta:D.getMeshFrameDelta(F.transform.zoom)};Ie.draw(R,q.TRIANGLES,se,Vr.disabled,oe,Or.backCCW,Pe,ge,"terrain",ce.vertexBuffer,ce.indexBuffer,ce.segments)}R.bindFramebuffer.set(null),R.viewport.set([0,0,F.width,F.height])}(this,this.style.map.terrain),function(F,D){const R=F.context,q=R.gl,oe=Ur.unblended,se=new pr(q.LEQUAL,pr.ReadWrite,[0,1]),ce=D.getTerrainMesh(),ae=D.getCoordsTexture(),Ie=D.sourceCache.getRenderableTiles(),Ve=F.useProgram("terrainCoords");R.bindFramebuffer.set(D.getFramebuffer("coords").framebuffer),R.viewport.set([0,0,F.width/devicePixelRatio,F.height/devicePixelRatio]),R.clear({color:o.aT.transparent,depth:1}),D.coordsIndex=[];for(const ge of Ie){const Pe=D.getTerrainData(ge.tileID);R.activeTexture.set(q.TEXTURE0),q.bindTexture(q.TEXTURE_2D,ae.texture);const He={u_matrix:F.transform.calculatePosMatrix(ge.tileID.toUnwrapped()),u_terrain_coords_id:(255-D.coordsIndex.length)/255,u_texture:0,u_ele_delta:D.getMeshFrameDelta(F.transform.zoom)};Ve.draw(R,q.TRIANGLES,se,Vr.disabled,oe,Or.backCCW,He,Pe,"terrain",ce.vertexBuffer,ce.indexBuffer,ce.segments),D.coordsIndex.push(ge.tileID.key)}R.bindFramebuffer.set(null),R.viewport.set([0,0,F.width,F.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const A of f){const F=this.style._layers[A];if(!F.hasOffscreenPass()||F.isHidden(this.transform.zoom))continue;const D=T[F.source];(F.type==="custom"||D.length)&&this.renderLayer(this,p[F.source],F,D)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:l.showOverdrawInspector?o.aT.black:o.aT.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.depthRangeFor3D=[0,1-(r._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=f.length-1;this.currentLayer>=0;this.currentLayer--){const A=this.style._layers[f[this.currentLayer]],F=p[A.source],D=y[A.source];this._renderTileClippingMasks(A,D),this.renderLayer(this,F,A,D)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<f.length;this.currentLayer++){const A=this.style._layers[f[this.currentLayer]],F=p[A.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(A))continue;const D=(A.type==="symbol"?E:T)[A.source];this._renderTileClippingMasks(A,y[A.source]),this.renderLayer(this,F,A,D)}if(this.options.showTileBoundaries){const A=function(F,D){let R=null;const q=Object.values(F._layers).flatMap(ae=>ae.source&&!ae.isHidden(D)?[F.sourceCaches[ae.source]]:[]),oe=q.filter(ae=>ae.getSource().type==="vector"),se=q.filter(ae=>ae.getSource().type!=="vector"),ce=ae=>{(!R||R.getSource().maxzoom<ae.getSource().maxzoom)&&(R=ae)};return oe.forEach(ae=>ce(ae)),R||se.forEach(ae=>ce(ae)),R}(this.style,this.transform.zoom);A&&function(F,D,R){for(let q=0;q<R.length;q++)yh(F,D,R[q])}(this,A,A.getVisibleCoordinates())}this.options.showPadding&&function(A){const F=A.transform.padding;js(A,A.transform.height-(F.top||0),3,gh),js(A,F.bottom||0,3,Uo),Vo(A,F.left||0,3,$l),Vo(A,A.transform.width-(F.right||0),3,xh);const D=A.transform.centerPoint;(function(R,q,oe,se){$o(R,q-1,oe-10,2,20,se),$o(R,q-10,oe-1,20,2,se)})(A,D.x,A.transform.height-D.y,_h)}(this),this.context.setDefault()}renderLayer(r,l,f,p){if(!f.isHidden(this.transform.zoom)&&(f.type==="background"||f.type==="custom"||(p||[]).length))switch(this.id=f.id,f.type){case"symbol":(function(y,T,E,A,F){if(y.renderPass!=="translucent")return;const D=Vr.disabled,R=y.colorModeForRenderPass();(E._unevaluatedLayout.hasValue("text-variable-anchor")||E._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(q,oe,se,ce,ae,Ie,Ve){const ge=oe.transform,Pe=ae==="map",He=Ie==="map";for(const We of q){const et=ce.getTile(We),ct=et.getBucket(se);if(!ct||!ct.text||!ct.text.segments.get().length)continue;const nt=o.ah(ct.textSizeData,ge.zoom),xt=ke(et,1,oe.transform.zoom),Lt=lt(We.posMatrix,He,Pe,oe.transform,xt),lr=se.layout.get("icon-text-fit")!=="none"&&ct.hasIconData();if(nt){const bt=Math.pow(2,ge.zoom-et.tileID.overscaledZ);zo(ct,Pe,He,Ve,ge,Lt,We.posMatrix,bt,nt,lr,oe.style.map.terrain?(Ht,Ot)=>oe.style.map.terrain.getElevation(We,Ht,Ot):null)}}}(A,y,E,T,E.layout.get("text-rotation-alignment"),E.layout.get("text-pitch-alignment"),F),E.paint.get("icon-opacity").constantOr(1)!==0&&No(y,T,E,A,!1,E.paint.get("icon-translate"),E.paint.get("icon-translate-anchor"),E.layout.get("icon-rotation-alignment"),E.layout.get("icon-pitch-alignment"),E.layout.get("icon-keep-upright"),D,R),E.paint.get("text-opacity").constantOr(1)!==0&&No(y,T,E,A,!0,E.paint.get("text-translate"),E.paint.get("text-translate-anchor"),E.layout.get("text-rotation-alignment"),E.layout.get("text-pitch-alignment"),E.layout.get("text-keep-upright"),D,R),T.map.showCollisionBoxes&&(mh(y,T,E,A,E.paint.get("text-translate"),E.paint.get("text-translate-anchor"),!0),mh(y,T,E,A,E.paint.get("icon-translate"),E.paint.get("icon-translate-anchor"),!1))})(r,l,f,p,this.style.placement.variableOffsets);break;case"circle":(function(y,T,E,A){if(y.renderPass!=="translucent")return;const F=E.paint.get("circle-opacity"),D=E.paint.get("circle-stroke-width"),R=E.paint.get("circle-stroke-opacity"),q=!E.layout.get("circle-sort-key").isConstant();if(F.constantOr(1)===0&&(D.constantOr(1)===0||R.constantOr(1)===0))return;const oe=y.context,se=oe.gl,ce=y.depthModeForSublayer(0,pr.ReadOnly),ae=Vr.disabled,Ie=y.colorModeForRenderPass(),Ve=[];for(let ge=0;ge<A.length;ge++){const Pe=A[ge],He=T.getTile(Pe),We=He.getBucket(E);if(!We)continue;const et=We.programConfigurations.get(E.id),ct=y.useProgram("circle",et),nt=We.layoutVertexBuffer,xt=We.indexBuffer,Lt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Pe),lr={programConfiguration:et,program:ct,layoutVertexBuffer:nt,indexBuffer:xt,uniformValues:Sn(y,Pe,He,E),terrainData:Lt};if(q){const bt=We.segments.get();for(const Ht of bt)Ve.push({segments:new o.S([Ht]),sortKey:Ht.sortKey,state:lr})}else Ve.push({segments:We.segments,sortKey:0,state:lr})}q&&Ve.sort((ge,Pe)=>ge.sortKey-Pe.sortKey);for(const ge of Ve){const{programConfiguration:Pe,program:He,layoutVertexBuffer:We,indexBuffer:et,uniformValues:ct,terrainData:nt}=ge.state;He.draw(oe,se.TRIANGLES,ce,ae,Ie,Or.disabled,ct,nt,E.id,We,et,ge.segments,E.paint,y.transform.zoom,Pe)}})(r,l,f,p);break;case"heatmap":(function(y,T,E,A){if(E.paint.get("heatmap-opacity")!==0)if(y.renderPass==="offscreen"){const F=y.context,D=F.gl,R=Vr.disabled,q=new Ur([D.ONE,D.ONE],o.aT.transparent,[!0,!0,!0,!0]);(function(oe,se,ce){const ae=oe.gl;oe.activeTexture.set(ae.TEXTURE1),oe.viewport.set([0,0,se.width/4,se.height/4]);let Ie=ce.heatmapFbo;if(Ie)ae.bindTexture(ae.TEXTURE_2D,Ie.colorAttachment.get()),oe.bindFramebuffer.set(Ie.framebuffer);else{const Ve=ae.createTexture();ae.bindTexture(ae.TEXTURE_2D,Ve),ae.texParameteri(ae.TEXTURE_2D,ae.TEXTURE_WRAP_S,ae.CLAMP_TO_EDGE),ae.texParameteri(ae.TEXTURE_2D,ae.TEXTURE_WRAP_T,ae.CLAMP_TO_EDGE),ae.texParameteri(ae.TEXTURE_2D,ae.TEXTURE_MIN_FILTER,ae.LINEAR),ae.texParameteri(ae.TEXTURE_2D,ae.TEXTURE_MAG_FILTER,ae.LINEAR),Ie=ce.heatmapFbo=oe.createFramebuffer(se.width/4,se.height/4,!1,!1),function(ge,Pe,He,We){var et,ct;const nt=ge.gl,xt=(et=ge.HALF_FLOAT)!==null&&et!==void 0?et:nt.UNSIGNED_BYTE,Lt=(ct=ge.RGBA16F)!==null&&ct!==void 0?ct:nt.RGBA;nt.texImage2D(nt.TEXTURE_2D,0,Lt,Pe.width/4,Pe.height/4,0,nt.RGBA,xt,null),We.colorAttachment.set(He)}(oe,se,Ve,Ie)}})(F,y,E),F.clear({color:o.aT.transparent});for(let oe=0;oe<A.length;oe++){const se=A[oe];if(T.hasRenderableParent(se))continue;const ce=T.getTile(se),ae=ce.getBucket(E);if(!ae)continue;const Ie=ae.programConfigurations.get(E.id),Ve=y.useProgram("heatmap",Ie),{zoom:ge}=y.transform;Ve.draw(F,D.TRIANGLES,pr.disabled,R,q,Or.disabled,$u(se.posMatrix,ce,ge,E.paint.get("heatmap-intensity")),null,E.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,E.paint,y.transform.zoom,Ie)}F.viewport.set([0,0,y.width,y.height])}else y.renderPass==="translucent"&&(y.context.setColorMode(y.colorModeForRenderPass()),function(F,D){const R=F.context,q=R.gl,oe=D.heatmapFbo;if(!oe)return;R.activeTexture.set(q.TEXTURE0),q.bindTexture(q.TEXTURE_2D,oe.colorAttachment.get()),R.activeTexture.set(q.TEXTURE1);let se=D.colorRampTexture;se||(se=D.colorRampTexture=new Ue(R,D.colorRamp,q.RGBA)),se.bind(q.LINEAR,q.CLAMP_TO_EDGE),F.useProgram("heatmapTexture").draw(R,q.TRIANGLES,pr.disabled,Vr.disabled,F.colorModeForRenderPass(),Or.disabled,((ce,ae,Ie,Ve)=>{const ge=o.Z();o.aS(ge,0,ce.width,ce.height,0,0,1);const Pe=ce.context.gl;return{u_matrix:ge,u_world:[Pe.drawingBufferWidth,Pe.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:ae.paint.get("heatmap-opacity")}})(F,D),null,D.id,F.viewportBuffer,F.quadTriangleIndexBuffer,F.viewportSegments,D.paint,F.transform.zoom)}(y,E))})(r,l,f,p);break;case"line":(function(y,T,E,A){if(y.renderPass!=="translucent")return;const F=E.paint.get("line-opacity"),D=E.paint.get("line-width");if(F.constantOr(1)===0||D.constantOr(1)===0)return;const R=y.depthModeForSublayer(0,pr.ReadOnly),q=y.colorModeForRenderPass(),oe=E.paint.get("line-dasharray"),se=E.paint.get("line-pattern"),ce=se.constantOr(1),ae=E.paint.get("line-gradient"),Ie=E.getCrossfadeParameters(),Ve=ce?"linePattern":oe?"lineSDF":ae?"lineGradient":"line",ge=y.context,Pe=ge.gl;let He=!0;for(const We of A){const et=T.getTile(We);if(ce&&!et.patternsLoaded())continue;const ct=et.getBucket(E);if(!ct)continue;const nt=ct.programConfigurations.get(E.id),xt=y.context.program.get(),Lt=y.useProgram(Ve,nt),lr=He||Lt.program!==xt,bt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(We),Ht=se.constantOr(null);if(Ht&&et.imageAtlas){const or=et.imageAtlas,ar=or.patternPositions[Ht.to.toString()],cr=or.patternPositions[Ht.from.toString()];ar&&cr&&nt.setConstantPatternPositions(ar,cr)}const Ot=bt?We:null,Cr=ce?ju(y,et,E,Ie,Ot):oe?nh(y,et,E,oe,Ie,Ot):ae?ih(y,et,E,ct.lineClipsArray.length,Ot):Sl(y,et,E,Ot);if(ce)ge.activeTexture.set(Pe.TEXTURE0),et.imageAtlasTexture.bind(Pe.LINEAR,Pe.CLAMP_TO_EDGE),nt.updatePaintBuffers(Ie);else if(oe&&(lr||y.lineAtlas.dirty))ge.activeTexture.set(Pe.TEXTURE0),y.lineAtlas.bind(ge);else if(ae){const or=ct.gradients[E.id];let ar=or.texture;if(E.gradientVersion!==or.version){let cr=256;if(E.stepInterpolant){const Yr=T.getSource().maxzoom,Ir=We.canonical.z===Yr?Math.ceil(1<<y.transform.maxZoom-We.canonical.z):1;cr=o.ad(o.aY(ct.maxLineLength/o.N*1024*Ir),256,ge.maxTextureSize)}or.gradient=o.aZ({expression:E.gradientExpression(),evaluationKey:"lineProgress",resolution:cr,image:or.gradient||void 0,clips:ct.lineClipsArray}),or.texture?or.texture.update(or.gradient):or.texture=new Ue(ge,or.gradient,Pe.RGBA),or.version=E.gradientVersion,ar=or.texture}ge.activeTexture.set(Pe.TEXTURE0),ar.bind(E.stepInterpolant?Pe.NEAREST:Pe.LINEAR,Pe.CLAMP_TO_EDGE)}Lt.draw(ge,Pe.TRIANGLES,R,y.stencilModeForClipping(We),q,Or.disabled,Cr,bt,E.id,ct.layoutVertexBuffer,ct.indexBuffer,ct.segments,E.paint,y.transform.zoom,nt,ct.layoutVertexBuffer2),He=!1}})(r,l,f,p);break;case"fill":(function(y,T,E,A){const F=E.paint.get("fill-color"),D=E.paint.get("fill-opacity");if(D.constantOr(1)===0)return;const R=y.colorModeForRenderPass(),q=E.paint.get("fill-pattern"),oe=y.opaquePassEnabledForLayer()&&!q.constantOr(1)&&F.constantOr(o.aT.transparent).a===1&&D.constantOr(0)===1?"opaque":"translucent";if(y.renderPass===oe){const se=y.depthModeForSublayer(1,y.renderPass==="opaque"?pr.ReadWrite:pr.ReadOnly);Vs(y,T,E,A,se,R,!1)}if(y.renderPass==="translucent"&&E.paint.get("fill-antialias")){const se=y.depthModeForSublayer(E.getPaintProperty("fill-outline-color")?2:0,pr.ReadOnly);Vs(y,T,E,A,se,R,!0)}})(r,l,f,p);break;case"fill-extrusion":(function(y,T,E,A){const F=E.paint.get("fill-extrusion-opacity");if(F!==0&&y.renderPass==="translucent"){const D=new pr(y.context.gl.LEQUAL,pr.ReadWrite,y.depthRangeFor3D);if(F!==1||E.paint.get("fill-extrusion-pattern").constantOr(1))$s(y,T,E,A,D,Vr.disabled,Ur.disabled),$s(y,T,E,A,D,y.stencilModeFor3D(),y.colorModeForRenderPass());else{const R=y.colorModeForRenderPass();$s(y,T,E,A,D,Vr.disabled,R)}}})(r,l,f,p);break;case"hillshade":(function(y,T,E,A){if(y.renderPass!=="offscreen"&&y.renderPass!=="translucent")return;const F=y.context,D=y.depthModeForSublayer(0,pr.ReadOnly),R=y.colorModeForRenderPass(),[q,oe]=y.renderPass==="translucent"?y.stencilConfigForOverlap(A):[{},A];for(const se of oe){const ce=T.getTile(se);ce.needsHillshadePrepare!==void 0&&ce.needsHillshadePrepare&&y.renderPass==="offscreen"?Vl(y,ce,E,D,Vr.disabled,R):y.renderPass==="translucent"&&Yu(y,se,ce,E,D,q[se.overscaledZ],R)}F.viewport.set([0,0,y.width,y.height])})(r,l,f,p);break;case"raster":(function(y,T,E,A){if(y.renderPass!=="translucent"||E.paint.get("raster-opacity")===0||!A.length)return;const F=y.context,D=F.gl,R=T.getSource(),q=y.useProgram("raster"),oe=y.colorModeForRenderPass(),[se,ce]=R instanceof rt?[{},A]:y.stencilConfigForOverlap(A),ae=ce[ce.length-1].overscaledZ,Ie=!y.options.moving;for(const Ve of ce){const ge=y.depthModeForSublayer(Ve.overscaledZ-ae,E.paint.get("raster-opacity")===1?pr.ReadWrite:pr.ReadOnly,D.LESS),Pe=T.getTile(Ve);Pe.registerFadeDuration(E.paint.get("raster-fade-duration"));const He=T.findLoadedParent(Ve,0),We=Ju(Pe,He,T,E,y.transform,y.style.map.terrain);let et,ct;const nt=E.paint.get("raster-resampling")==="nearest"?D.NEAREST:D.LINEAR;F.activeTexture.set(D.TEXTURE0),Pe.texture.bind(nt,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST),F.activeTexture.set(D.TEXTURE1),He?(He.texture.bind(nt,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST),et=Math.pow(2,He.tileID.overscaledZ-Pe.tileID.overscaledZ),ct=[Pe.tileID.canonical.x*et%1,Pe.tileID.canonical.y*et%1]):Pe.texture.bind(nt,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST);const xt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Ve),Lt=xt?Ve:null,lr=Lt?Lt.posMatrix:y.transform.calculatePosMatrix(Ve.toUnwrapped(),Ie),bt=oh(lr,ct||[0,0],et||1,We,E);R instanceof rt?q.draw(F,D.TRIANGLES,ge,Vr.disabled,oe,Or.disabled,bt,xt,E.id,R.boundsBuffer,y.quadTriangleIndexBuffer,R.boundsSegments):q.draw(F,D.TRIANGLES,ge,se[Ve.overscaledZ],oe,Or.disabled,bt,xt,E.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments)}})(r,l,f,p);break;case"background":(function(y,T,E,A){const F=E.paint.get("background-color"),D=E.paint.get("background-opacity");if(D===0)return;const R=y.context,q=R.gl,oe=y.transform,se=oe.tileSize,ce=E.paint.get("background-pattern");if(y.isPatternMissing(ce))return;const ae=!ce&&F.a===1&&D===1&&y.opaquePassEnabledForLayer()?"opaque":"translucent";if(y.renderPass!==ae)return;const Ie=Vr.disabled,Ve=y.depthModeForSublayer(0,ae==="opaque"?pr.ReadWrite:pr.ReadOnly),ge=y.colorModeForRenderPass(),Pe=y.useProgram(ce?"backgroundPattern":"background"),He=A||oe.coveringTiles({tileSize:se,terrain:y.style.map.terrain});ce&&(R.activeTexture.set(q.TEXTURE0),y.imageManager.bind(y.context));const We=E.getCrossfadeParameters();for(const et of He){const ct=A?et.posMatrix:y.transform.calculatePosMatrix(et.toUnwrapped()),nt=ce?Ii(ct,D,y,ce,{tileID:et,tileSize:se},We):Co(ct,D,F),xt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(et);Pe.draw(R,q.TRIANGLES,Ve,Ie,ge,Or.disabled,nt,xt,E.id,y.tileExtentBuffer,y.quadTriangleIndexBuffer,y.tileExtentSegments)}})(r,0,f,p);break;case"custom":(function(y,T,E){const A=y.context,F=E.implementation;if(y.renderPass==="offscreen"){const D=F.prerender;D&&(y.setCustomLayerDefaults(),A.setColorMode(y.colorModeForRenderPass()),D.call(F,A.gl,y.transform.customLayerMatrix()),A.setDirty(),y.setBaseState())}else if(y.renderPass==="translucent"){y.setCustomLayerDefaults(),A.setColorMode(y.colorModeForRenderPass()),A.setStencilMode(Vr.disabled);const D=F.renderingMode==="3d"?new pr(y.context.gl.LEQUAL,pr.ReadWrite,y.depthRangeFor3D):y.depthModeForSublayer(0,pr.ReadOnly);A.setDepthMode(D),F.render(A.gl,y.transform.customLayerMatrix()),A.setDirty(),y.setBaseState(),A.bindFramebuffer.set(null)}})(r,0,f)}}translatePosMatrix(r,l,f,p,y){if(!f[0]&&!f[1])return r;const T=y?p==="map"?this.transform.angle:0:p==="viewport"?-this.transform.angle:0;if(T){const F=Math.sin(T),D=Math.cos(T);f=[f[0]*D-f[1]*F,f[0]*F+f[1]*D]}const E=[y?f[0]:ke(l,f[0],this.transform.zoom),y?f[1]:ke(l,f[1],this.transform.zoom),0],A=new Float32Array(16);return o.$(A,r,E),A}saveTileTexture(r){const l=this._tileTextures[r.size[0]];l?l.push(r):this._tileTextures[r.size[0]]=[r]}getTileTexture(r){const l=this._tileTextures[r];return l&&l.length>0?l.pop():null}isPatternMissing(r){if(!r)return!1;if(!r.from||!r.to)return!0;const l=this.imageManager.getPattern(r.from.toString()),f=this.imageManager.getPattern(r.to.toString());return!l||!f}useProgram(r,l){this.cache=this.cache||{};const f=r+(l?l.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[f]||(this.cache[f]=new To(this.context,Nr[r],l,Ao[r],this._showOverdrawInspector,this.style.map.terrain)),this.cache[f]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Ue(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:r,drawingBufferHeight:l}=this.context.gl;return this.width!==r||this.height!==l}}class Ja{constructor(r,l){this.points=r,this.planes=l}static fromInvProjectionMatrix(r,l,f){const p=Math.pow(2,f),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{const A=1/(E=o.ag([],E,r))[3]/l*p;return o.b3(E,E,[A,A,1/E[3],A])}),T=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{const A=function(q,oe){var se=oe[0],ce=oe[1],ae=oe[2],Ie=se*se+ce*ce+ae*ae;return Ie>0&&(Ie=1/Math.sqrt(Ie)),q[0]=oe[0]*Ie,q[1]=oe[1]*Ie,q[2]=oe[2]*Ie,q}([],function(q,oe,se){var ce=oe[0],ae=oe[1],Ie=oe[2],Ve=se[0],ge=se[1],Pe=se[2];return q[0]=ae*Pe-Ie*ge,q[1]=Ie*Ve-ce*Pe,q[2]=ce*ge-ae*Ve,q}([],we([],y[E[0]],y[E[1]]),we([],y[E[2]],y[E[1]]))),F=-((D=A)[0]*(R=y[E[1]])[0]+D[1]*R[1]+D[2]*R[2]);var D,R;return A.concat(F)});return new Ja(y,T)}}class fs{constructor(r,l){this.min=r,this.max=l,this.center=function(f,p,y){return f[0]=.5*p[0],f[1]=.5*p[1],f[2]=.5*p[2],f}([],function(f,p,y){return f[0]=p[0]+y[0],f[1]=p[1]+y[1],f[2]=p[2]+y[2],f}([],this.min,this.max))}quadrant(r){const l=[r%2==0,r<2],f=me(this.min),p=me(this.max);for(let y=0;y<l.length;y++)f[y]=l[y]?this.min[y]:this.center[y],p[y]=l[y]?this.center[y]:this.max[y];return p[2]=this.max[2],new fs(f,p)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}intersects(r){const l=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let f=!0;for(let p=0;p<r.planes.length;p++){const y=r.planes[p];let T=0;for(let E=0;E<l.length;E++)o.b4(y,l[E])>=0&&T++;if(T===0)return 0;T!==l.length&&(f=!1)}if(f)return 2;for(let p=0;p<3;p++){let y=Number.MAX_VALUE,T=-Number.MAX_VALUE;for(let E=0;E<r.points.length;E++){const A=r.points[E][p]-this.min[p];y=Math.min(y,A),T=Math.max(T,A)}if(T<0||y>this.max[p]-this.min[p])return 0}return 1}}class Gs{constructor(r=0,l=0,f=0,p=0){if(isNaN(r)||r<0||isNaN(l)||l<0||isNaN(f)||f<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=l,this.left=f,this.right=p}interpolate(r,l,f){return l.top!=null&&r.top!=null&&(this.top=o.B.number(r.top,l.top,f)),l.bottom!=null&&r.bottom!=null&&(this.bottom=o.B.number(r.bottom,l.bottom,f)),l.left!=null&&r.left!=null&&(this.left=o.B.number(r.left,l.left,f)),l.right!=null&&r.right!=null&&(this.right=o.B.number(r.right,l.right,f)),this}getCenter(r,l){const f=o.ad((this.left+r-this.right)/2,0,r),p=o.ad((this.top+l-this.bottom)/2,0,l);return new o.P(f,p)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new Gs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class jo{constructor(r,l,f,p,y){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=y===void 0||!!y,this._minZoom=r||0,this._maxZoom=l||22,this._minPitch=f??0,this._maxPitch=p??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new o.L(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Gs,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const r=new jo(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return r.apply(this),r}apply(r){this.tileSize=r.tileSize,this.latRange=r.latRange,this.width=r.width,this.height=r.height,this._center=r._center,this._elevation=r._elevation,this._minEleveationForCurrentTile=r._minEleveationForCurrentTile,this.zoom=r.zoom,this.angle=r.angle,this._fov=r._fov,this._pitch=r._pitch,this._unmodified=r._unmodified,this._edgeInsets=r._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(r){const l=-o.b5(r,-180,180)*Math.PI/180;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=function(){var f=new o.A(4);return o.A!=Float32Array&&(f[1]=0,f[2]=0),f[0]=1,f[3]=1,f}(),function(f,p,y){var T=p[0],E=p[1],A=p[2],F=p[3],D=Math.sin(y),R=Math.cos(y);f[0]=T*R+A*D,f[1]=E*R+F*D,f[2]=T*-D+A*R,f[3]=E*-D+F*R}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const l=o.ad(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=r/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(r){const l=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._zoom=l,this.tileZoom=Math.max(0,Math.floor(l)),this.scale=this.zoomScale(l),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(r){r!==this._elevation&&(this._elevation=r,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,l,f){this._unmodified=!1,this._edgeInsets.interpolate(r,l,f),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const l=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(r){const l=[new o.b6(0,r)];if(this._renderWorldCopies){const f=this.pointCoordinate(new o.P(0,0)),p=this.pointCoordinate(new o.P(this.width,0)),y=this.pointCoordinate(new o.P(this.width,this.height)),T=this.pointCoordinate(new o.P(0,this.height)),E=Math.floor(Math.min(f.x,p.x,y.x,T.x)),A=Math.floor(Math.max(f.x,p.x,y.x,T.x)),F=1;for(let D=E-F;D<=A+F;D++)D!==0&&l.push(new o.b6(D,r))}return l}coveringTiles(r){var l,f;let p=this.coveringZoomLevel(r);const y=p;if(r.minzoom!==void 0&&p<r.minzoom)return[];r.maxzoom!==void 0&&p>r.maxzoom&&(p=r.maxzoom);const T=this.pointCoordinate(this.getCameraPoint()),E=o.U.fromLngLat(this.center),A=Math.pow(2,p),F=[A*T.x,A*T.y,0],D=[A*E.x,A*E.y,0],R=Ja.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,p);let q=r.minzoom||0;!r.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(q=p);const oe=r.terrain?2/Math.min(this.tileSize,r.tileSize)*this.tileSize:3,se=ge=>({aabb:new fs([ge*A,0,0],[(ge+1)*A,A,0]),zoom:0,x:0,y:0,wrap:ge,fullyVisible:!1}),ce=[],ae=[],Ie=p,Ve=r.reparseOverscaled?y:p;if(this._renderWorldCopies)for(let ge=1;ge<=3;ge++)ce.push(se(-ge)),ce.push(se(ge));for(ce.push(se(0));ce.length>0;){const ge=ce.pop(),Pe=ge.x,He=ge.y;let We=ge.fullyVisible;if(!We){const Lt=ge.aabb.intersects(R);if(Lt===0)continue;We=Lt===2}const et=r.terrain?F:D,ct=ge.aabb.distanceX(et),nt=ge.aabb.distanceY(et),xt=Math.max(Math.abs(ct),Math.abs(nt));if(ge.zoom===Ie||xt>oe+(1<<Ie-ge.zoom)-2&&ge.zoom>=q){const Lt=Ie-ge.zoom,lr=F[0]-.5-(Pe<<Lt),bt=F[1]-.5-(He<<Lt);ae.push({tileID:new o.O(ge.zoom===Ie?Ve:ge.zoom,ge.wrap,ge.zoom,Pe,He),distanceSq:te([D[0]-.5-Pe,D[1]-.5-He]),tileDistanceToCamera:Math.sqrt(lr*lr+bt*bt)})}else for(let Lt=0;Lt<4;Lt++){const lr=(Pe<<1)+Lt%2,bt=(He<<1)+(Lt>>1),Ht=ge.zoom+1;let Ot=ge.aabb.quadrant(Lt);if(r.terrain){const Cr=new o.O(Ht,ge.wrap,Ht,lr,bt),or=r.terrain.getMinMaxElevation(Cr),ar=(l=or.minElevation)!==null&&l!==void 0?l:this.elevation,cr=(f=or.maxElevation)!==null&&f!==void 0?f:this.elevation;Ot=new fs([Ot.min[0],Ot.min[1],ar],[Ot.max[0],Ot.max[1],cr])}ce.push({aabb:Ot,zoom:Ht,x:lr,y:bt,wrap:ge.wrap,fullyVisible:We})}}return ae.sort((ge,Pe)=>ge.distanceSq-Pe.distanceSq).map(ge=>ge.tileID)}resize(r,l){this.width=r,this.height=l,this.pixelsToGLUnits=[2/r,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const l=o.ad(r.lat,-this.maxValidLatitude,this.maxValidLatitude);return new o.P(o.G(r.lng)*this.worldSize,o.H(l)*this.worldSize)}unproject(r){return new o.U(r.x/this.worldSize,r.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(r){const l=this.pointLocation(this.centerPoint,r),f=r.getElevationForLngLatZoom(l,this.tileZoom);if(!(this.elevation-f))return;const p=this.getCameraPosition(),y=o.U.fromLngLat(p.lngLat,p.altitude),T=o.U.fromLngLat(l,f),E=y.x-T.x,A=y.y-T.y,F=y.z-T.z,D=Math.sqrt(E*E+A*A+F*F),R=this.scaleZoom(this.cameraToCenterDistance/D/this.tileSize);this._elevation=f,this._center=l,this.zoom=R}setLocationAtPoint(r,l){const f=this.pointCoordinate(l),p=this.pointCoordinate(this.centerPoint),y=this.locationCoordinate(r),T=new o.U(y.x-(f.x-p.x),y.y-(f.y-p.y));this.center=this.coordinateLocation(T),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(r,l){return l?this.coordinatePoint(this.locationCoordinate(r),l.getElevationForLngLatZoom(r,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(r))}pointLocation(r,l){return this.coordinateLocation(this.pointCoordinate(r,l))}locationCoordinate(r){return o.U.fromLngLat(r)}coordinateLocation(r){return r&&r.toLngLat()}pointCoordinate(r,l){if(l){const q=l.pointCoordinate(r);if(q!=null)return q}const f=[r.x,r.y,0,1],p=[r.x,r.y,1,1];o.ag(f,f,this.pixelMatrixInverse),o.ag(p,p,this.pixelMatrixInverse);const y=f[3],T=p[3],E=f[1]/y,A=p[1]/T,F=f[2]/y,D=p[2]/T,R=F===D?0:(0-F)/(D-F);return new o.U(o.B.number(f[0]/y,p[0]/T,R)/this.worldSize,o.B.number(E,A,R)/this.worldSize)}coordinatePoint(r,l=0,f=this.pixelMatrix){const p=[r.x*this.worldSize,r.y*this.worldSize,l,1];return o.ag(p,p,f),new o.P(p[0]/p[3],p[1]/p[3])}getBounds(){const r=Math.max(0,this.height/2-this.getHorizon());return new be().extend(this.pointLocation(new o.P(0,r))).extend(this.pointLocation(new o.P(this.width,r))).extend(this.pointLocation(new o.P(this.width,this.height))).extend(this.pointLocation(new o.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new be([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(r){r?(this.lngRange=[r.getWest(),r.getEast()],this.latRange=[r.getSouth(),r.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(r,l=!1){const f=r.key,p=l?this._alignedPosMatrixCache:this._posMatrixCache;if(p[f])return p[f];const y=r.canonical,T=this.worldSize/this.zoomScale(y.z),E=y.x+Math.pow(2,y.z)*r.wrap,A=o.ao(new Float64Array(16));return o.$(A,A,[E*T,y.y*T,0]),o.a0(A,A,[T/o.N,T/o.N,1]),o.a1(A,l?this.alignedProjMatrix:this.projMatrix,A),p[f]=new Float32Array(A),p[f]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let r,l,f,p,y=-90,T=90,E=-180,A=180;const F=this.size,D=this._unmodified;if(this.latRange){const oe=this.latRange;y=o.H(oe[1])*this.worldSize,T=o.H(oe[0])*this.worldSize,r=T-y<F.y?F.y/(T-y):0}if(this.lngRange){const oe=this.lngRange;E=o.b5(o.G(oe[0])*this.worldSize,0,this.worldSize),A=o.b5(o.G(oe[1])*this.worldSize,0,this.worldSize),A<E&&(A+=this.worldSize),l=A-E<F.x?F.x/(A-E):0}const R=this.point,q=Math.max(l||0,r||0);if(q)return this.center=this.unproject(new o.P(l?(A+E)/2:R.x,r?(T+y)/2:R.y)),this.zoom+=this.scaleZoom(q),this._unmodified=D,void(this._constraining=!1);if(this.latRange){const oe=R.y,se=F.y/2;oe-se<y&&(p=y+se),oe+se>T&&(p=T-se)}if(this.lngRange){const oe=(E+A)/2,se=o.b5(R.x,oe-this.worldSize/2,oe+this.worldSize/2),ce=F.x/2;se-ce<E&&(f=E+ce),se+ce>A&&(f=A-ce)}f===void 0&&p===void 0||(this.center=this.unproject(new o.P(f!==void 0?f:R.x,p!==void 0?p:R.y)).wrap()),this._unmodified=D,this._constraining=!1}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,l=this.point.x,f=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=o.b7(1,this.center.lat)*this.worldSize;let p=o.ao(new Float64Array(16));o.a0(p,p,[this.width/2,-this.height/2,1]),o.$(p,p,[1,-1,0]),this.labelPlaneMatrix=p,p=o.ao(new Float64Array(16)),o.a0(p,p,[1,-1,1]),o.$(p,p,[-1,-1,0]),o.a0(p,p,[2/this.width,2/this.height,1]),this.glCoordMatrix=p;const y=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),T=Math.min(this.elevation,this._minEleveationForCurrentTile),E=y-T*this._pixelPerMeter/Math.cos(this._pitch),A=T<0?E:y,F=Math.PI/2+this._pitch,D=this._fov*(.5+r.y/this.height),R=Math.sin(D)*A/Math.sin(o.ad(Math.PI-F-D,.01,Math.PI-.01)),q=this.getHorizon(),oe=2*Math.atan(q/this.cameraToCenterDistance)*(.5+r.y/(2*q)),se=Math.sin(oe)*A/Math.sin(o.ad(Math.PI-F-oe,.01,Math.PI-.01)),ce=Math.min(R,se),ae=1.01*(Math.cos(Math.PI/2-this._pitch)*ce+A),Ie=this.height/50;p=new Float64Array(16),o.b8(p,this._fov,this.width/this.height,Ie,ae),p[8]=2*-r.x/this.width,p[9]=2*r.y/this.height,o.a0(p,p,[1,-1,1]),o.$(p,p,[0,0,-this.cameraToCenterDistance]),o.b9(p,p,this._pitch),o.ae(p,p,this.angle),o.$(p,p,[-l,-f,0]),this.mercatorMatrix=o.a0([],p,[this.worldSize,this.worldSize,this.worldSize]),o.a0(p,p,[1,1,this._pixelPerMeter]),this.pixelMatrix=o.a1(new Float64Array(16),this.labelPlaneMatrix,p),o.$(p,p,[0,0,-this.elevation]),this.projMatrix=p,this.invProjMatrix=o.as([],p),this.pixelMatrix3D=o.a1(new Float64Array(16),this.labelPlaneMatrix,p);const Ve=this.width%2/2,ge=this.height%2/2,Pe=Math.cos(this.angle),He=Math.sin(this.angle),We=l-Math.round(l)+Pe*Ve+He*ge,et=f-Math.round(f)+Pe*ge+He*Ve,ct=new Float64Array(p);if(o.$(ct,ct,[We>.5?We-1:We,et>.5?et-1:et,0]),this.alignedProjMatrix=ct,p=o.as(new Float64Array(16),this.pixelMatrix),!p)throw new Error("failed to invert matrix");this.pixelMatrixInverse=p,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const r=this.pointCoordinate(new o.P(0,0)),l=[r.x*this.worldSize,r.y*this.worldSize,0,1];return o.ag(l,l,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,r))}getCameraQueryGeometry(r){const l=this.getCameraPoint();if(r.length===1)return[r[0],l];{let f=l.x,p=l.y,y=l.x,T=l.y;for(const E of r)f=Math.min(f,E.x),p=Math.min(p,E.y),y=Math.max(y,E.x),T=Math.max(T,E.y);return[new o.P(f,p),new o.P(y,p),new o.P(y,T),new o.P(f,T),new o.P(f,p)]}}}function Gn(g,r){let l,f=!1,p=null,y=null;const T=()=>{p=null,f&&(g.apply(y,l),p=setTimeout(T,r),f=!1)};return(...E)=>(f=!0,y=this,l=E,p||T(),p)}class Hs{constructor(r){this._getCurrentHash=()=>{const l=window.location.hash.replace("#","");if(this._hashName){let f;return l.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(f=p)}),(f&&f[1]||"").split("/")}return l.split("/")},this._onHashChange=()=>{const l=this._getCurrentHash();if(l.length>=3&&!l.some(f=>isNaN(f))){const f=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(l[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:f,pitch:+(l[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const l=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,l)}catch{}},this._updateHash=Gn(this._updateHashUnthrottled,300),this._hashName=r&&encodeURIComponent(r)}addTo(r){return this._map=r,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(r){const l=this._map.getCenter(),f=Math.round(100*this._map.getZoom())/100,p=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,p),T=Math.round(l.lng*y)/y,E=Math.round(l.lat*y)/y,A=this._map.getBearing(),F=this._map.getPitch();let D="";if(D+=r?`/${T}/${E}/${f}`:`${f}/${E}/${T}`,(A||F)&&(D+="/"+Math.round(10*A)/10),F&&(D+=`/${Math.round(F)}`),this._hashName){const R=this._hashName;let q=!1;const oe=window.location.hash.slice(1).split("&").map(se=>{const ce=se.split("=")[0];return ce===R?(q=!0,`${ce}=${D}`):se}).filter(se=>se);return q||oe.push(`${R}=${D}`),`#${oe.join("&")}`}return`#${D}`}}const ds={linearity:.3,easing:o.ba(0,0,.3,1)},vh=o.e({deceleration:2500,maxSpeed:1400},ds),wh=o.e({deceleration:20,maxSpeed:1400},ds),bh=o.e({deceleration:1e3,maxSpeed:360},ds),Th=o.e({deceleration:1e3,maxSpeed:90},ds);class Eh{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.h.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,l=o.h.now();for(;r.length>0&&l-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const l={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)l.zoom+=y.zoomDelta||0,l.bearing+=y.bearingDelta||0,l.pitch+=y.pitchDelta||0,y.panDelta&&l.pan._add(y.panDelta),y.around&&(l.around=y.around),y.pinchAround&&(l.pinchAround=y.pinchAround);const f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(l.pan.mag()){const y=qs(l.pan.mag(),f,o.e({},vh,r||{}));p.offset=l.pan.mult(y.amount/l.pan.mag()),p.center=this._map.transform.center,qi(p,y)}if(l.zoom){const y=qs(l.zoom,f,wh);p.zoom=this._map.transform.zoom+y.amount,qi(p,y)}if(l.bearing){const y=qs(l.bearing,f,bh);p.bearing=this._map.transform.bearing+o.ad(y.amount,-179,179),qi(p,y)}if(l.pitch){const y=qs(l.pitch,f,Th);p.pitch=this._map.transform.pitch+y.amount,qi(p,y)}if(p.zoom||p.bearing){const y=l.pinchAround===void 0?l.around:l.pinchAround;p.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),o.e(p,{noMoveStart:!0})}}function qi(g,r){(!g.duration||g.duration<r.duration)&&(g.duration=r.duration,g.easing=r.easing)}function qs(g,r,l){const{maxSpeed:f,linearity:p,deceleration:y}=l,T=o.ad(g*p/(r/1e3),-f,f),E=Math.abs(T)/(y*p);return{easing:l.easing,duration:1e3*E,amount:T*(E/2)}}class mi extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,f,p={}){const y=b.mousePos(l.getCanvasContainer(),f),T=l.unproject(y);super(r,o.e({point:y,lngLat:T,originalEvent:f},p)),this._defaultPrevented=!1,this.target=l}}class Ws extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,f){const p=r==="touchend"?f.changedTouches:f.touches,y=b.touchPos(l.getCanvasContainer(),p),T=y.map(A=>l.unproject(A)),E=y.reduce((A,F,D,R)=>A.add(F.div(R.length)),new o.P(0,0));super(r,{points:y,point:E,lngLats:T,lngLat:l.unproject(E),originalEvent:f}),this._defaultPrevented=!1}}class Sh extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,f){super(r,{originalEvent:f}),this._defaultPrevented=!1}}class kh{constructor(r,l){this._map=r,this._clickTolerance=l.clickTolerance}reset(){delete this._mousedownPos}wheel(r){return this._firePreventable(new Sh(r.type,this._map,r))}mousedown(r,l){return this._mousedownPos=l,this._firePreventable(new mi(r.type,this._map,r))}mouseup(r){this._map.fire(new mi(r.type,this._map,r))}click(r,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||this._map.fire(new mi(r.type,this._map,r))}dblclick(r){return this._firePreventable(new mi(r.type,this._map,r))}mouseover(r){this._map.fire(new mi(r.type,this._map,r))}mouseout(r){this._map.fire(new mi(r.type,this._map,r))}touchstart(r){return this._firePreventable(new Ws(r.type,this._map,r))}touchmove(r){this._map.fire(new Ws(r.type,this._map,r))}touchend(r){this._map.fire(new Ws(r.type,this._map,r))}touchcancel(r){this._map.fire(new Ws(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ch{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(r){this._map.fire(new mi(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new mi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._ignoreContextMenu||this._map.fire(new mi(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ln{constructor(r){this._map=r}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(r){return this.transform.pointLocation(o.P.convert(r),this._map.terrain)}}class Ah{constructor(r,l){this._map=r,this._tr=new ln(r),this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,l){this.isEnabled()&&r.shiftKey&&r.button===0&&(b.disableDrag(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(r,l){if(!this._active)return;const f=l;if(this._lastPos.equals(f)||!this._box&&f.dist(this._startPos)<this._clickTolerance)return;const p=this._startPos;this._lastPos=f,this._box||(this._box=b.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",r));const y=Math.min(p.x,f.x),T=Math.max(p.x,f.x),E=Math.min(p.y,f.y),A=Math.max(p.y,f.y);b.setTransform(this._box,`translate(${y}px,${E}px)`),this._box.style.width=T-y+"px",this._box.style.height=A-E+"px"}mouseupWindow(r,l){if(!this._active||r.button!==0)return;const f=this._startPos,p=l;if(this.reset(),b.suppressClick(),f.x!==p.x||f.y!==p.y)return this._map.fire(new o.k("boxzoomend",{originalEvent:r})),{cameraAnimation:y=>y.fitScreenCoordinates(f,p,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",r)}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(b.remove(this._box),this._box=null),b.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(r,l){return this._map.fire(new o.k(r,{originalEvent:l}))}}function Fi(g,r){if(g.length!==r.length)throw new Error(`The number of touches and points are not equal - touches ${g.length}, points ${r.length}`);const l={};for(let f=0;f<g.length;f++)l[g[f].identifier]=r[f];return l}class cn{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(r,l,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=r.timeStamp),f.length===this.numTouches&&(this.centroid=function(p){const y=new o.P(0,0);for(const T of p)y._add(T);return y.div(p.length)}(l),this.touches=Fi(f,l)))}touchmove(r,l,f){if(this.aborted||!this.centroid)return;const p=Fi(f,l);for(const y in this.touches){const T=p[y];(!T||T.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(r,l,f){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){const p=!this.aborted&&this.centroid;if(this.reset(),p)return p}}}class Go{constructor(r){this.singleTap=new cn(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(r,l,f){this.singleTap.touchstart(r,l,f)}touchmove(r,l,f){this.singleTap.touchmove(r,l,f)}touchend(r,l,f){const p=this.singleTap.touchend(r,l,f);if(p){const y=r.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(p)<30;if(y&&T||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}}}class hn{constructor(r){this._tr=new ln(r),this._zoomIn=new Go({numTouches:1,numTaps:2}),this._zoomOut=new Go({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,l,f){this._zoomIn.touchstart(r,l,f),this._zoomOut.touchstart(r,l,f)}touchmove(r,l,f){this._zoomIn.touchmove(r,l,f),this._zoomOut.touchmove(r,l,f)}touchend(r,l,f){const p=this._zoomIn.touchend(r,l,f),y=this._zoomOut.touchend(r,l,f),T=this._tr;return p?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:T.zoom+1,around:T.unproject(p)},{originalEvent:r})}):y?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:T.zoom-1,around:T.unproject(y)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class un{constructor(r){this._enabled=!!r.enable,this._moveStateManager=r.moveStateManager,this._clickTolerance=r.clickTolerance||1,this._moveFunction=r.move,this._activateOnStart=!!r.activateOnStart,r.assignEvents(this),this.reset()}reset(r){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(r)}_move(...r){const l=this._moveFunction(...r);if(l.bearingDelta||l.pitchDelta||l.around||l.panDelta)return this._active=!0,l}dragStart(r,l){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(r)&&(this._moveStateManager.startMove(r),this._lastPoint=l.length?l[0]:l,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(r,l){if(!this.isEnabled())return;const f=this._lastPoint;if(!f)return;if(r.preventDefault(),!this._moveStateManager.isValidMoveEvent(r))return void this.reset(r);const p=l.length?l[0]:l;return!this._moved&&p.dist(f)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=p,this._move(f,p))}dragEnd(r){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(r)&&(this._moved&&b.suppressClick(),this.reset(r))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Qu={0:1,2:2};class jl{constructor(r){this._correctEvent=r.checkCorrectEvent}startMove(r){const l=b.mouseButton(r);this._eventButton=l}endMove(r){delete this._eventButton}isValidStartEvent(r){return this._correctEvent(r)}isValidMoveEvent(r){return!function(l,f){const p=Qu[f];return l.buttons===void 0||(l.buttons&p)!==p}(r,this._eventButton)}isValidEndEvent(r){return b.mouseButton(r)===this._eventButton}}class Ih{constructor(){this._firstTouch=void 0}_isOneFingerTouch(r){return r.targetTouches.length===1}_isSameTouchEvent(r){return r.targetTouches[0].identifier===this._firstTouch}startMove(r){this._firstTouch=r.targetTouches[0].identifier}endMove(r){delete this._firstTouch}isValidStartEvent(r){return this._isOneFingerTouch(r)}isValidMoveEvent(r){return this._isOneFingerTouch(r)&&this._isSameTouchEvent(r)}isValidEndEvent(r){return this._isOneFingerTouch(r)&&this._isSameTouchEvent(r)}}const Ho=g=>{g.mousedown=g.dragStart,g.mousemoveWindow=g.dragMove,g.mouseup=g.dragEnd,g.contextmenu=function(r){r.preventDefault()}},ps=({enable:g,clickTolerance:r,bearingDegreesPerPixelMoved:l=.8})=>{const f=new jl({checkCorrectEvent:p=>b.mouseButton(p)===0&&p.ctrlKey||b.mouseButton(p)===2});return new un({clickTolerance:r,move:(p,y)=>({bearingDelta:(y.x-p.x)*l}),moveStateManager:f,enable:g,assignEvents:Ho})},fn=({enable:g,clickTolerance:r,pitchDegreesPerPixelMoved:l=-.5})=>{const f=new jl({checkCorrectEvent:p=>b.mouseButton(p)===0&&p.ctrlKey||b.mouseButton(p)===2});return new un({clickTolerance:r,move:(p,y)=>({pitchDelta:(y.y-p.y)*l}),moveStateManager:f,enable:g,assignEvents:Ho})};class It{constructor(r,l){this._minTouches=r.cooperativeGestures?2:1,this._clickTolerance=r.clickTolerance||1,this._map=l,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(r,l,f){return this._calculateTransform(r,l,f)}touchmove(r,l,f){if(this._map._cooperativeGestures&&(this._minTouches===2&&f.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(r,!1,f.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(f.length<this._minTouches))return r.preventDefault(),this._calculateTransform(r,l,f)}touchend(r,l,f){this._calculateTransform(r,l,f),this._active&&f.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,l,f){f.length>0&&(this._active=!0);const p=Fi(f,l),y=new o.P(0,0),T=new o.P(0,0);let E=0;for(const F in p){const D=p[F],R=this._touches[F];R&&(y._add(D),T._add(D.sub(R)),E++,p[F]=D)}if(this._touches=p,E<this._minTouches||!T.mag())return;const A=T.div(E);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(E),panDelta:A}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class qo{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(r,l,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([l[0],l[1]]))}touchmove(r,l,f){if(!this._firstTwoTouches)return;r.preventDefault();const[p,y]=this._firstTwoTouches,T=An(f,l,p),E=An(f,l,y);if(!T||!E)return;const A=this._aroundCenter?null:T.add(E).div(2);return this._move([T,E],A,r)}touchend(r,l,f){if(!this._firstTwoTouches)return;const[p,y]=this._firstTwoTouches,T=An(f,l,p),E=An(f,l,y);T&&E||(this._active&&b.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function An(g,r,l){for(let f=0;f<g.length;f++)if(g[f].identifier===l)return r[f]}function ms(g,r){return Math.log(g/r)/Math.LN2}class Fh extends qo{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,l){const f=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(ms(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ms(this._distance,f),pinchAround:l}}}function Ct(g,r){return 180*g.angleWith(r)/Math.PI}class Gl extends qo{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,l){const f=this._vector;if(this._vector=r[0].sub(r[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Ct(this._vector,f),pinchAround:l}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const l=25/(Math.PI*this._minDiameter)*360,f=Ct(r,this._startVector);return Math.abs(f)<l}}function Hl(g){return Math.abs(g.y)>Math.abs(g.x)}class ef extends qo{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(r,l,f){super.touchstart(r,l,f),this._currentTouchCount=f.length}_start(r){this._lastPoints=r,Hl(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,l,f){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const p=r[0].sub(this._lastPoints[0]),y=r[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(p,y,f.timeStamp),this._valid?(this._lastPoints=r,this._active=!0,{pitchDelta:(p.y+y.y)/2*-.5}):void 0}gestureBeginsVertically(r,l,f){if(this._valid!==void 0)return this._valid;const p=r.mag()>=2,y=l.mag()>=2;if(!p&&!y)return;if(!p||!y)return this._firstMove===void 0&&(this._firstMove=f),f-this._firstMove<100&&void 0;const T=r.y>0==l.y>0;return Hl(r)&&Hl(l)&&T}}const ql={panStep:100,bearingStep:15,pitchStep:10};class Ph{constructor(r){this._tr=new ln(r);const l=ql;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let l=0,f=0,p=0,y=0,T=0;switch(r.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:r.shiftKey?f=-1:(r.preventDefault(),y=-1);break;case 39:r.shiftKey?f=1:(r.preventDefault(),y=1);break;case 38:r.shiftKey?p=1:(r.preventDefault(),T=-1);break;case 40:r.shiftKey?p=-1:(r.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(f=0,p=0),{cameraAnimation:E=>{const A=this._tr;E.easeTo({duration:300,easeId:"keyboardHandler",easing:Mh,zoom:l?Math.round(A.zoom)+l*(r.shiftKey?2:1):A.zoom,bearing:A.bearing+f*this._bearingStep,pitch:A.pitch+p*this._pitchStep,offset:[-y*this._panStep,-T*this._panStep],center:A.center},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Mh(g){return g*(2-g)}const Dh=4.000244140625;class tf{constructor(r,l){this._onTimeout=f=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(f)},this._map=r,this._tr=new ln(r),this._el=r.getCanvasContainer(),this._triggerRenderFrame=l,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&r.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!r[this._map._metaKey])return;r.preventDefault()}let l=r.deltaMode===WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const f=o.h.now(),p=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,l!==0&&l%Dh==0?this._type="wheel":l!==0&&Math.abs(l)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=l,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(p*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),r.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=r,this._delta-=l,this._active||this._start(r)),r.preventDefault()}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=b.mousePos(this._el,r),f=this._tr;this._around=o.L.convert(this._aroundCenter?f.center:f.unproject(l)),this._aroundPoint=f.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._tr.transform;if(this._delta!==0){const E=this._type==="wheel"&&Math.abs(this._delta)>Dh?this._wheelZoomRate:this._defaultZoomRate;let A=2/(1+Math.exp(-Math.abs(this._delta*E)));this._delta<0&&A!==0&&(A=1/A);const F=typeof this._targetZoom=="number"?r.zoomScale(this._targetZoom):r.scale;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(F*A))),this._type==="wheel"&&(this._startZoom=r.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const l=typeof this._targetZoom=="number"?this._targetZoom:r.zoom,f=this._startZoom,p=this._easing;let y,T=!1;if(this._type==="wheel"&&f&&p){const E=Math.min((o.h.now()-this._lastWheelEventTime)/200,1),A=p(E);y=o.B.number(f,l,A),E<1?this._frameId||(this._frameId=!0):T=!0}else y=l,T=!0;return this._active=!0,T&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!T,zoomDelta:y-r.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let l=o.bb;if(this._prevEase){const f=this._prevEase,p=(o.h.now()-f.start)/f.duration,y=f.easing(p+.01)-f.easing(p),T=.27/Math.sqrt(y*y+1e-4)*.01,E=Math.sqrt(.0729-T*T);l=o.ba(T,E,.25,1)}return this._prevEase={start:o.h.now(),duration:r,easing:l},l}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Wl{constructor(r,l){this._clickZoom=r,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Zl{constructor(r){this._tr=new ln(r),this.reset()}reset(){this._active=!1}dblclick(r,l){return r.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:this._tr.zoom+(r.shiftKey?-1:1),around:this._tr.unproject(l)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Xl{constructor(){this._tap=new Go({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(r,l,f){if(!this._swipePoint)if(this._tapTime){const p=l[0],y=r.timeStamp-this._tapTime<500,T=this._tapPoint.dist(p)<30;y&&T?f.length>0&&(this._swipePoint=p,this._swipeTouch=f[0].identifier):this.reset()}else this._tap.touchstart(r,l,f)}touchmove(r,l,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;const p=l[0],y=p.y-this._swipePoint.y;return this._swipePoint=p,r.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(r,l,f)}touchend(r,l,f){if(this._tapTime)this._swipePoint&&f.length===0&&this.reset();else{const p=this._tap.touchend(r,l,f);p&&(this._tapTime=r.timeStamp,this._tapPoint=p)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Kl{constructor(r,l,f){this._el=r,this._mousePan=l,this._touchPan=f}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Qa{constructor(r,l,f){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=l,this._mousePitch=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class In{constructor(r,l,f,p){this._el=r,this._touchZoom=l,this._touchRotate=f,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Zs=g=>g.zoom||g.drag||g.pitch||g.rotate;class Yl extends o.k{}function Xs(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta}class Jl{constructor(r,l){this.handleWindowEvent=p=>{this.handleEvent(p,`${p.type}Window`)},this.handleEvent=(p,y)=>{if(p.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const T=p.type==="renderFrame"?void 0:p,E={needsRenderFrame:!1},A={},F={},D=p.touches,R=D?this._getMapTouches(D):void 0,q=R?b.touchPos(this._el,R):b.mousePos(this._el,p);for(const{handlerName:ce,handler:ae,allowed:Ie}of this._handlers){if(!ae.isEnabled())continue;let Ve;this._blockedByActive(F,Ie,ce)?ae.reset():ae[y||p.type]&&(Ve=ae[y||p.type](p,q,R),this.mergeHandlerResult(E,A,Ve,ce,T),Ve&&Ve.needsRenderFrame&&this._triggerRenderFrame()),(Ve||ae.isActive())&&(F[ce]=ae)}const oe={};for(const ce in this._previousActiveHandlers)F[ce]||(oe[ce]=T);this._previousActiveHandlers=F,(Object.keys(oe).length||Xs(E))&&(this._changes.push([E,A,oe]),this._triggerRenderFrame()),(Object.keys(F).length||Xs(E))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:se}=E;se&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],se(this._map))},this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Eh(r),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(l);const f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[window,"blur",void 0]];for(const[p,y,T]of this._listeners)b.addEventListener(p,y,p===document?this.handleWindowEvent:this.handleEvent,T)}destroy(){for(const[r,l,f]of this._listeners)b.removeEventListener(r,l,r===document?this.handleWindowEvent:this.handleEvent,f)}_addDefaultHandlers(r){const l=this._map,f=l.getCanvasContainer();this._add("mapEvent",new kh(l,r));const p=l.boxZoom=new Ah(l,r);this._add("boxZoom",p),r.interactive&&r.boxZoom&&p.enable();const y=new hn(l),T=new Zl(l);l.doubleClickZoom=new Wl(T,y),this._add("tapZoom",y),this._add("clickZoom",T),r.interactive&&r.doubleClickZoom&&l.doubleClickZoom.enable();const E=new Xl;this._add("tapDragZoom",E);const A=l.touchPitch=new ef(l);this._add("touchPitch",A),r.interactive&&r.touchPitch&&l.touchPitch.enable(r.touchPitch);const F=ps(r),D=fn(r);l.dragRotate=new Qa(r,F,D),this._add("mouseRotate",F,["mousePitch"]),this._add("mousePitch",D,["mouseRotate"]),r.interactive&&r.dragRotate&&l.dragRotate.enable();const R=(({enable:Ie,clickTolerance:Ve})=>{const ge=new jl({checkCorrectEvent:Pe=>b.mouseButton(Pe)===0&&!Pe.ctrlKey});return new un({clickTolerance:Ve,move:(Pe,He)=>({around:He,panDelta:He.sub(Pe)}),activateOnStart:!0,moveStateManager:ge,enable:Ie,assignEvents:Ho})})(r),q=new It(r,l);l.dragPan=new Kl(f,R,q),this._add("mousePan",R),this._add("touchPan",q,["touchZoom","touchRotate"]),r.interactive&&r.dragPan&&l.dragPan.enable(r.dragPan);const oe=new Gl,se=new Fh;l.touchZoomRotate=new In(f,se,oe,E),this._add("touchRotate",oe,["touchPan","touchZoom"]),this._add("touchZoom",se,["touchPan","touchRotate"]),r.interactive&&r.touchZoomRotate&&l.touchZoomRotate.enable(r.touchZoomRotate);const ce=l.scrollZoom=new tf(l,()=>this._triggerRenderFrame());this._add("scrollZoom",ce,["mousePan"]),r.interactive&&r.scrollZoom&&l.scrollZoom.enable(r.scrollZoom);const ae=l.keyboard=new Ph(l);this._add("keyboard",ae),r.interactive&&r.keyboard&&l.keyboard.enable(),this._add("blockableMapEvent",new Ch(l))}_add(r,l,f){this._handlers.push({handlerName:r,handler:l,allowed:f}),this._handlersById[r]=l}stop(r){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[]}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Zs(this._eventsInProgress)||this.isZooming()}_blockedByActive(r,l,f){for(const p in r)if(p!==f&&(!l||l.indexOf(p)<0))return!0;return!1}_getMapTouches(r){const l=[];for(const f of r)this._el.contains(f.target)&&l.push(f);return l}mergeHandlerResult(r,l,f,p,y){if(!f)return;o.e(r,f);const T={handlerName:p,originalEvent:f.originalEvent||y};f.zoomDelta!==void 0&&(l.zoom=T),f.panDelta!==void 0&&(l.drag=T),f.pitchDelta!==void 0&&(l.pitch=T),f.bearingDelta!==void 0&&(l.rotate=T)}_applyChanges(){const r={},l={},f={};for(const[p,y,T]of this._changes)p.panDelta&&(r.panDelta=(r.panDelta||new o.P(0,0))._add(p.panDelta)),p.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+p.pitchDelta),p.around!==void 0&&(r.around=p.around),p.pinchAround!==void 0&&(r.pinchAround=p.pinchAround),p.noInertia&&(r.noInertia=p.noInertia),o.e(l,y),o.e(f,T);this._updateMapTransform(r,l,f),this._changes=[]}_updateMapTransform(r,l,f){const p=this._map,y=p._getTransformForUpdate(),T=p.terrain;if(!(Xs(r)||T&&this._terrainMovement))return this._fireEvents(l,f,!0);let{panDelta:E,zoomDelta:A,bearingDelta:F,pitchDelta:D,around:R,pinchAround:q}=r;q!==void 0&&(R=q),p._stop(!0),R=R||p.transform.centerPoint;const oe=y.pointLocation(E?R.sub(E):R);F&&(y.bearing+=F),D&&(y.pitch+=D),A&&(y.zoom+=A),T?this._terrainMovement||!l.drag&&!l.zoom?l.drag&&this._terrainMovement?y.center=y.pointLocation(y.centerPoint.sub(E)):y.setLocationAtPoint(oe,R):(this._terrainMovement=!0,this._map._elevationFreeze=!0,y.setLocationAtPoint(oe,R),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,y.recalculateZoom(p.terrain)})):y.setLocationAtPoint(oe,R),p._applyUpdatedTransform(y),this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(l,f,!0)}_fireEvents(r,l,f){const p=Zs(this._eventsInProgress),y=Zs(r),T={};for(const D in r){const{originalEvent:R}=r[D];this._eventsInProgress[D]||(T[`${D}start`]=R),this._eventsInProgress[D]=r[D]}!p&&y&&this._fireEvent("movestart",y.originalEvent);for(const D in T)this._fireEvent(D,T[D]);y&&this._fireEvent("move",y.originalEvent);for(const D in r){const{originalEvent:R}=r[D];this._fireEvent(D,R)}const E={};let A;for(const D in this._eventsInProgress){const{handlerName:R,originalEvent:q}=this._eventsInProgress[D];this._handlersById[R].isActive()||(delete this._eventsInProgress[D],A=l[R]||q,E[`${D}end`]=A)}for(const D in E)this._fireEvent(D,E[D]);const F=Zs(this._eventsInProgress);if(f&&(p||y)&&!F){this._updatingCamera=!0;const D=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),R=q=>q!==0&&-this._bearingSnap<q&&q<this._bearingSnap;!D||!D.essential&&o.h.prefersReducedMotion?(this._map.fire(new o.k("moveend",{originalEvent:A})),R(this._map.getBearing())&&this._map.resetNorth()):(R(D.bearing||this._map.getBearing())&&(D.bearing=0),D.freezeElevation=!0,this._map.easeTo(D,{originalEvent:A})),this._updatingCamera=!1}}_fireEvent(r,l){this._map.fire(new o.k(r,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{delete this._frameId,this.handleEvent(new Yl("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Lh extends o.E{constructor(r,l){super(),this._renderFrameCallback=()=>{const f=Math.min((o.h.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(f)),f<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=l.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new o.L(this.transform.center.lng,this.transform.center.lat)}setCenter(r,l){return this.jumpTo({center:r},l)}panBy(r,l,f){return r=o.P.convert(r).mult(-1),this.panTo(this.transform.center,o.e({offset:r},l),f)}panTo(r,l,f){return this.easeTo(o.e({center:r},l),f)}getZoom(){return this.transform.zoom}setZoom(r,l){return this.jumpTo({zoom:r},l),this}zoomTo(r,l,f){return this.easeTo(o.e({zoom:r},l),f)}zoomIn(r,l){return this.zoomTo(this.getZoom()+1,r,l),this}zoomOut(r,l){return this.zoomTo(this.getZoom()-1,r,l),this}getBearing(){return this.transform.bearing}setBearing(r,l){return this.jumpTo({bearing:r},l),this}getPadding(){return this.transform.padding}setPadding(r,l){return this.jumpTo({padding:r},l),this}rotateTo(r,l,f){return this.easeTo(o.e({bearing:r},l),f)}resetNorth(r,l){return this.rotateTo(0,o.e({duration:1e3},r),l),this}resetNorthPitch(r,l){return this.easeTo(o.e({bearing:0,pitch:0,duration:1e3},r),l),this}snapToNorth(r,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,l):this}getPitch(){return this.transform.pitch}setPitch(r,l){return this.jumpTo({pitch:r},l),this}cameraForBounds(r,l){r=be.convert(r);const f=l&&l.bearing||0;return this._cameraForBoxAndBearing(r.getNorthWest(),r.getSouthEast(),f,l)}_cameraForBoxAndBearing(r,l,f,p){const y={top:0,bottom:0,right:0,left:0};if(typeof(p=o.e({padding:y,offset:[0,0],maxZoom:this.transform.maxZoom},p)).padding=="number"){const He=p.padding;p.padding={top:He,bottom:He,right:He,left:He}}p.padding=o.e(y,p.padding);const T=this.transform,E=T.padding,A=T.project(o.L.convert(r)),F=T.project(o.L.convert(l)),D=A.rotate(-f*Math.PI/180),R=F.rotate(-f*Math.PI/180),q=new o.P(Math.max(D.x,R.x),Math.max(D.y,R.y)),oe=new o.P(Math.min(D.x,R.x),Math.min(D.y,R.y)),se=q.sub(oe),ce=(T.width-(E.left+E.right+p.padding.left+p.padding.right))/se.x,ae=(T.height-(E.top+E.bottom+p.padding.top+p.padding.bottom))/se.y;if(ae<0||ce<0)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Ie=Math.min(T.scaleZoom(T.scale*Math.min(ce,ae)),p.maxZoom),Ve=o.P.convert(p.offset),ge=new o.P((p.padding.left-p.padding.right)/2,(p.padding.top-p.padding.bottom)/2).rotate(f*Math.PI/180),Pe=Ve.add(ge).mult(T.scale/T.zoomScale(Ie));return{center:T.unproject(A.add(F).div(2).sub(Pe)),zoom:Ie,bearing:f}}fitBounds(r,l,f){return this._fitInternal(this.cameraForBounds(r,l),l,f)}fitScreenCoordinates(r,l,f,p,y){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(o.P.convert(r)),this.transform.pointLocation(o.P.convert(l)),f,p),p,y)}_fitInternal(r,l,f){return r?(delete(l=o.e(r,l)).padding,l.linear?this.easeTo(l,f):this.flyTo(l,f)):this}jumpTo(r,l){this.stop();const f=this._getTransformForUpdate();let p=!1,y=!1,T=!1;return"zoom"in r&&f.zoom!==+r.zoom&&(p=!0,f.zoom=+r.zoom),r.center!==void 0&&(f.center=o.L.convert(r.center)),"bearing"in r&&f.bearing!==+r.bearing&&(y=!0,f.bearing=+r.bearing),"pitch"in r&&f.pitch!==+r.pitch&&(T=!0,f.pitch=+r.pitch),r.padding==null||f.isPaddingEqual(r.padding)||(f.padding=r.padding),this._applyUpdatedTransform(f),this.fire(new o.k("movestart",l)).fire(new o.k("move",l)),p&&this.fire(new o.k("zoomstart",l)).fire(new o.k("zoom",l)).fire(new o.k("zoomend",l)),y&&this.fire(new o.k("rotatestart",l)).fire(new o.k("rotate",l)).fire(new o.k("rotateend",l)),T&&this.fire(new o.k("pitchstart",l)).fire(new o.k("pitch",l)).fire(new o.k("pitchend",l)),this.fire(new o.k("moveend",l))}calculateCameraOptionsFromTo(r,l,f,p=0){const y=o.U.fromLngLat(r,l),T=o.U.fromLngLat(f,p),E=T.x-y.x,A=T.y-y.y,F=T.z-y.z,D=Math.hypot(E,A,F);if(D===0)throw new Error("Can't calculate camera options with same From and To");const R=Math.hypot(E,A),q=this.transform.scaleZoom(this.transform.cameraToCenterDistance/D/this.transform.tileSize),oe=180*Math.atan2(E,-A)/Math.PI;let se=180*Math.acos(R/D)/Math.PI;return se=F<0?90-se:90+se,{center:T.toLngLat(),zoom:q,pitch:se,bearing:oe}}easeTo(r,l){this._stop(!1,r.easeId),((r=o.e({offset:[0,0],duration:500,easing:o.bb},r)).animate===!1||!r.essential&&o.h.prefersReducedMotion)&&(r.duration=0);const f=this._getTransformForUpdate(),p=this.getZoom(),y=this.getBearing(),T=this.getPitch(),E=this.getPadding(),A="zoom"in r?+r.zoom:p,F="bearing"in r?this._normalizeBearing(r.bearing,y):y,D="pitch"in r?+r.pitch:T,R="padding"in r?r.padding:f.padding,q=o.P.convert(r.offset);let oe=f.centerPoint.add(q);const se=f.pointLocation(oe),ce=o.L.convert(r.center||se);this._normalizeCenter(ce);const ae=f.project(se),Ie=f.project(ce).sub(ae),Ve=f.zoomScale(A-p);let ge,Pe;r.around&&(ge=o.L.convert(r.around),Pe=f.locationPoint(ge));const He={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||A!==p,this._rotating=this._rotating||y!==F,this._pitching=this._pitching||D!==T,this._padding=!f.isPaddingEqual(R),this._easeId=r.easeId,this._prepareEase(l,r.noMoveStart,He),this.terrain&&this._prepareElevation(ce),this._ease(We=>{if(this._zooming&&(f.zoom=o.B.number(p,A,We)),this._rotating&&(f.bearing=o.B.number(y,F,We)),this._pitching&&(f.pitch=o.B.number(T,D,We)),this._padding&&(f.interpolatePadding(E,R,We),oe=f.centerPoint.add(q)),this.terrain&&!r.freezeElevation&&this._updateElevation(We),ge)f.setLocationAtPoint(ge,Pe);else{const et=f.zoomScale(f.zoom-p),ct=A>p?Math.min(2,Ve):Math.max(.5,Ve),nt=Math.pow(ct,1-We),xt=f.unproject(ae.add(Ie.mult(We*nt)).mult(et));f.setLocationAtPoint(f.renderWorldCopies?xt.wrap():xt,oe)}this._applyUpdatedTransform(f),this._fireMoveEvents(l)},We=>{this.terrain&&this._finalizeElevation(),this._afterEase(l,We)},r),this}_prepareEase(r,l,f={}){this._moving=!0,l||f.moving||this.fire(new o.k("movestart",r)),this._zooming&&!f.zooming&&this.fire(new o.k("zoomstart",r)),this._rotating&&!f.rotating&&this.fire(new o.k("rotatestart",r)),this._pitching&&!f.pitching&&this.fire(new o.k("pitchstart",r))}_prepareElevation(r){this._elevationCenter=r,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(r,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(r){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const l=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(r<1&&l!==this._elevationTarget){const f=this._elevationTarget-this._elevationStart;this._elevationStart+=r*(f-(l-(f*r+this._elevationStart))/(1-r)),this._elevationTarget=l}this.transform.elevation=o.B.number(this._elevationStart,this._elevationTarget,r)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(r){if(!this.transformCameraUpdate)return;const l=r.clone(),{center:f,zoom:p,pitch:y,bearing:T,elevation:E}=this.transformCameraUpdate(l);f&&(l.center=f),p!==void 0&&(l.zoom=p),y!==void 0&&(l.pitch=y),T!==void 0&&(l.bearing=T),E!==void 0&&(l.elevation=E),this.transform.apply(l)}_fireMoveEvents(r){this.fire(new o.k("move",r)),this._zooming&&this.fire(new o.k("zoom",r)),this._rotating&&this.fire(new o.k("rotate",r)),this._pitching&&this.fire(new o.k("pitch",r))}_afterEase(r,l){if(this._easeId&&l&&this._easeId===l)return;delete this._easeId;const f=this._zooming,p=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,f&&this.fire(new o.k("zoomend",r)),p&&this.fire(new o.k("rotateend",r)),y&&this.fire(new o.k("pitchend",r)),this.fire(new o.k("moveend",r))}flyTo(r,l){if(!r.essential&&o.h.prefersReducedMotion){const Ot=o.F(r,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ot,l)}this.stop(),r=o.e({offset:[0,0],speed:1.2,curve:1.42,easing:o.bb},r);const f=this._getTransformForUpdate(),p=this.getZoom(),y=this.getBearing(),T=this.getPitch(),E=this.getPadding(),A="zoom"in r?o.ad(+r.zoom,f.minZoom,f.maxZoom):p,F="bearing"in r?this._normalizeBearing(r.bearing,y):y,D="pitch"in r?+r.pitch:T,R="padding"in r?r.padding:f.padding,q=f.zoomScale(A-p),oe=o.P.convert(r.offset);let se=f.centerPoint.add(oe);const ce=f.pointLocation(se),ae=o.L.convert(r.center||ce);this._normalizeCenter(ae);const Ie=f.project(ce),Ve=f.project(ae).sub(Ie);let ge=r.curve;const Pe=Math.max(f.width,f.height),He=Pe/q,We=Ve.mag();if("minZoom"in r){const Ot=o.ad(Math.min(r.minZoom,p,A),f.minZoom,f.maxZoom),Cr=Pe/f.zoomScale(Ot-p);ge=Math.sqrt(Cr/We*2)}const et=ge*ge;function ct(Ot){const Cr=(He*He-Pe*Pe+(Ot?-1:1)*et*et*We*We)/(2*(Ot?He:Pe)*et*We);return Math.log(Math.sqrt(Cr*Cr+1)-Cr)}function nt(Ot){return(Math.exp(Ot)-Math.exp(-Ot))/2}function xt(Ot){return(Math.exp(Ot)+Math.exp(-Ot))/2}const Lt=ct(!1);let lr=function(Ot){return xt(Lt)/xt(Lt+ge*Ot)},bt=function(Ot){return Pe*((xt(Lt)*(nt(Cr=Lt+ge*Ot)/xt(Cr))-nt(Lt))/et)/We;var Cr},Ht=(ct(!0)-Lt)/ge;if(Math.abs(We)<1e-6||!isFinite(Ht)){if(Math.abs(Pe-He)<1e-6)return this.easeTo(r,l);const Ot=He<Pe?-1:1;Ht=Math.abs(Math.log(He/Pe))/ge,bt=function(){return 0},lr=function(Cr){return Math.exp(Ot*ge*Cr)}}return r.duration="duration"in r?+r.duration:1e3*Ht/("screenSpeed"in r?+r.screenSpeed/ge:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0),this._zooming=!0,this._rotating=y!==F,this._pitching=D!==T,this._padding=!f.isPaddingEqual(R),this._prepareEase(l,!1),this.terrain&&this._prepareElevation(ae),this._ease(Ot=>{const Cr=Ot*Ht,or=1/lr(Cr);f.zoom=Ot===1?A:p+f.scaleZoom(or),this._rotating&&(f.bearing=o.B.number(y,F,Ot)),this._pitching&&(f.pitch=o.B.number(T,D,Ot)),this._padding&&(f.interpolatePadding(E,R,Ot),se=f.centerPoint.add(oe)),this.terrain&&!r.freezeElevation&&this._updateElevation(Ot);const ar=Ot===1?ae:f.unproject(Ie.add(Ve.mult(bt(Cr))).mult(or));f.setLocationAtPoint(f.renderWorldCopies?ar.wrap():ar,se),this._applyUpdatedTransform(f),this._fireMoveEvents(l)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(l)},r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const f=this._onEaseEnd;delete this._onEaseEnd,f.call(this,l)}if(!r){const f=this.handlers;f&&f.stop(!1)}return this}_ease(r,l,f){f.animate===!1||f.duration===0?(r(1),l()):(this._easeStart=o.h.now(),this._easeOptions=f,this._onEaseFrame=r,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(r,l){r=o.b5(r,-180,180);const f=Math.abs(r-l);return Math.abs(r-360-l)<f&&(r-=360),Math.abs(r+360-l)<f&&(r+=360),r}_normalizeCenter(r){const l=this.transform;if(!l.renderWorldCopies||l.lngRange)return;const f=r.lng-l.center.lng;r.lng+=f>180?-360:f<-180?360:0}queryTerrainElevation(r){return this.terrain?this.terrain.getElevationForLngLatZoom(o.L.convert(r),this.transform.tileZoom)-this.transform.elevation:null}}class gi{constructor(r={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=l=>{!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"&&l.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=r}getDefaultPosition(){return"bottom-right"}onAdd(r){return this._map=r,this._compact=this.options&&this.options.compact,this._container=b.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=b.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=b.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){b.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(r,l){const f=this._map._getUIString(`AttributionControl.${l}`);r.title=f,r.setAttribute("aria-label",f)}_updateAttributions(){if(!this._map.style)return;let r=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=r.concat(this.options.customAttribution.map(p=>typeof p!="string"?"":p)):typeof this.options.customAttribution=="string"&&r.push(this.options.customAttribution)),this._map.style.stylesheet){const p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}const l=this._map.style.sourceCaches;for(const p in l){const y=l[p];if(y.used||y.usedForTerrain){const T=y.getSource();T.attribution&&r.indexOf(T.attribution)<0&&r.push(T.attribution)}}r=r.filter(p=>String(p).trim()),r.sort((p,y)=>p.length-y.length),r=r.filter((p,y)=>{for(let T=y+1;T<r.length;T++)if(r[T].indexOf(p)>=0)return!1;return!0});const f=r.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,r.length?(this._innerContainer.innerHTML=f,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Pr{constructor(r={}){this._updateCompact=()=>{const l=this._container.children;if(l.length){const f=l[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&f.classList.add("maplibregl-compact"):f.classList.remove("maplibregl-compact")}},this.options=r}getDefaultPosition(){return"bottom-left"}onAdd(r){this._map=r,this._compact=this.options&&this.options.compact,this._container=b.create("div","maplibregl-ctrl");const l=b.create("a","maplibregl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://maplibre.org/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){b.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Wo{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const l=++this._id;return this._queue.push({callback:r,id:l,cancelled:!1}),l}remove(r){const l=this._currentlyRunning,f=l?this._queue.concat(l):this._queue;for(const p of f)if(p.id===r)return void(p.cancelled=!0)}run(r=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const l=this._currentlyRunning=this._queue;this._queue=[];for(const f of l)if(!f.cancelled&&(f.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const Ql={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var Rh=o.Q([{name:"a_pos3d",type:"Int16",components:3}]);class Oh extends o.E{constructor(r){super(),this.sourceCache=r,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,r.usedForTerrain=!0,r.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(r,l){this.sourceCache.update(r,l),this._renderableTilesKeys=[];const f={};for(const p of r.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:l}))f[p.key]=!0,this._renderableTilesKeys.push(p.key),this._tiles[p.key]||(p.posMatrix=new Float64Array(16),o.aS(p.posMatrix,0,o.N,0,o.N,0,1),this._tiles[p.key]=new wr(p,this.tileSize));for(const p in this._tiles)f[p]||delete this._tiles[p]}freeRtt(r){for(const l in this._tiles){const f=this._tiles[l];(!r||f.tileID.equals(r)||f.tileID.isChildOf(r)||r.isChildOf(f.tileID))&&(f.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(r=>this.getTileByID(r))}getTileByID(r){return this._tiles[r]}getTerrainCoords(r){const l={};for(const f of this._renderableTilesKeys){const p=this._tiles[f].tileID;if(p.canonical.equals(r.canonical)){const y=r.clone();y.posMatrix=new Float64Array(16),o.aS(y.posMatrix,0,o.N,0,o.N,0,1),l[f]=y}else if(p.canonical.isChildOf(r.canonical)){const y=r.clone();y.posMatrix=new Float64Array(16);const T=p.canonical.z-r.canonical.z,E=p.canonical.x-(p.canonical.x>>T<<T),A=p.canonical.y-(p.canonical.y>>T<<T),F=o.N>>T;o.aS(y.posMatrix,0,F,0,F,0,1),o.$(y.posMatrix,y.posMatrix,[-E*F,-A*F,0]),l[f]=y}else if(r.canonical.isChildOf(p.canonical)){const y=r.clone();y.posMatrix=new Float64Array(16);const T=r.canonical.z-p.canonical.z,E=r.canonical.x-(r.canonical.x>>T<<T),A=r.canonical.y-(r.canonical.y>>T<<T),F=o.N>>T;o.aS(y.posMatrix,0,o.N,0,o.N,0,1),o.$(y.posMatrix,y.posMatrix,[E*F,A*F,0]),o.a0(y.posMatrix,y.posMatrix,[1/2**T,1/2**T,0]),l[f]=y}}return l}getSourceTile(r,l){const f=this.sourceCache._source;let p=r.overscaledZ-this.deltaZoom;if(p>f.maxzoom&&(p=f.maxzoom),p<f.minzoom)return null;this._sourceTileCache[r.key]||(this._sourceTileCache[r.key]=r.scaledTo(p).key);let y=this.sourceCache.getTileByID(this._sourceTileCache[r.key]);if((!y||!y.dem)&&l)for(;p>=f.minzoom&&(!y||!y.dem);)y=this.sourceCache.getTileByID(r.scaledTo(p--).key);return y}tilesAfterTime(r=Date.now()){return Object.values(this._tiles).filter(l=>l.timeAdded>=r)}}class Bh{constructor(r,l,f){this.painter=r,this.sourceCache=new Oh(l),this.options=f,this.exaggeration=typeof f.exaggeration=="number"?f.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(r,l,f,p=o.N){var y;if(!(l>=0&&l<p&&f>=0&&f<p))return 0;const T=this.getTerrainData(r),E=(y=T.tile)===null||y===void 0?void 0:y.dem;if(!E)return 0;const A=function(se,ce,ae){var Ie=ce[0],Ve=ce[1];return se[0]=ae[0]*Ie+ae[4]*Ve+ae[12],se[1]=ae[1]*Ie+ae[5]*Ve+ae[13],se}([],[l/p*o.N,f/p*o.N],T.u_terrain_matrix),F=[A[0]*E.dim,A[1]*E.dim],D=Math.floor(F[0]),R=Math.floor(F[1]),q=F[0]-D,oe=F[1]-R;return E.get(D,R)*(1-q)*(1-oe)+E.get(D+1,R)*q*(1-oe)+E.get(D,R+1)*(1-q)*oe+E.get(D+1,R+1)*q*oe}getElevationForLngLatZoom(r,l){const{tileID:f,mercatorX:p,mercatorY:y}=this._getOverscaledTileIDFromLngLatZoom(r,l);return this.getElevation(f,p%o.N,y%o.N,o.N)}getElevation(r,l,f,p=o.N){return this.getDEMElevation(r,l,f,p)*this.exaggeration}getTerrainData(r){if(!this._emptyDemTexture){const p=this.painter.context,y=new o.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Ue(p,y,p.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Ue(p,new o.R({width:1,height:1}),p.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.ao([])}const l=this.sourceCache.getSourceTile(r,!0);if(l&&l.dem&&(!l.demTexture||l.needsTerrainPrepare)){const p=this.painter.context;l.demTexture=this.painter.getTileTexture(l.dem.stride),l.demTexture?l.demTexture.update(l.dem.getPixels(),{premultiply:!1}):l.demTexture=new Ue(p,l.dem.getPixels(),p.gl.RGBA,{premultiply:!1}),l.demTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),l.needsTerrainPrepare=!1}const f=l&&l+l.tileID.key+r.key;if(f&&!this._demMatrixCache[f]){const p=this.sourceCache.sourceCache._source.maxzoom;let y=r.canonical.z-l.tileID.canonical.z;r.overscaledZ>r.canonical.z&&(r.canonical.z>=p?y=r.canonical.z-p:o.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const T=r.canonical.x-(r.canonical.x>>y<<y),E=r.canonical.y-(r.canonical.y>>y<<y),A=o.bc(new Float64Array(16),[1/(o.N<<y),1/(o.N<<y),0]);o.$(A,A,[T*o.N,E*o.N,0]),this._demMatrixCache[r.key]={matrix:A,coord:r}}return{u_depth:2,u_terrain:3,u_terrain_dim:l&&l.dem&&l.dem.dim||1,u_terrain_matrix:f?this._demMatrixCache[r.key].matrix:this._emptyDemMatrix,u_terrain_unpack:l&&l.dem&&l.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(l&&l.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:l}}getFramebuffer(r){const l=this.painter,f=l.width/devicePixelRatio,p=l.height/devicePixelRatio;return!this._fbo||this._fbo.width===f&&this._fbo.height===p||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Ue(l.context,{width:f,height:p,data:null},l.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(l.context.gl.NEAREST,l.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Ue(l.context,{width:f,height:p,data:null},l.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(l.context.gl.NEAREST,l.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=l.context.createFramebuffer(f,p,!0,!1),this._fbo.depthAttachment.set(l.context.createRenderbuffer(l.context.gl.DEPTH_COMPONENT16,f,p))),this._fbo.colorAttachment.set(r==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const r=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const l=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let y=0,T=0;y<this._coordsTextureSize;y++)for(let E=0;E<this._coordsTextureSize;E++,T+=4)l[T+0]=255&E,l[T+1]=255&y,l[T+2]=E>>8<<4|y>>8,l[T+3]=0;const f=new o.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(l.buffer)),p=new Ue(r,f,r.gl.RGBA,{premultiply:!1});return p.bind(r.gl.NEAREST,r.gl.CLAMP_TO_EDGE),this._coordsTexture=p,p}pointCoordinate(r){const l=new Uint8Array(4),f=this.painter.context,p=f.gl;f.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),p.readPixels(r.x,this.painter.height/devicePixelRatio-r.y-1,1,1,p.RGBA,p.UNSIGNED_BYTE,l),f.bindFramebuffer.set(null);const y=l[0]+(l[2]>>4<<8),T=l[1]+((15&l[2])<<8),E=this.coordsIndex[255-l[3]],A=E&&this.sourceCache.getTileByID(E);if(!A)return null;const F=this._coordsTextureSize,D=(1<<A.tileID.canonical.z)*F;return new o.U(this._allowMercatorOverflow(r,(A.tileID.canonical.x*F+y)/D),(A.tileID.canonical.y*F+T)/D,this.getElevation(A.tileID,y,T,F))}getTerrainMesh(){if(this._mesh)return this._mesh;const r=this.painter.context,l=new o.bd,f=new o.b0,p=this.meshSize,y=o.N/p,T=p*p;for(let R=0;R<=p;R++)for(let q=0;q<=p;q++)l.emplaceBack(q*y,R*y,0);for(let R=0;R<T;R+=p+1)for(let q=0;q<p;q++)f.emplaceBack(q+R,p+q+R+1,p+q+R+2),f.emplaceBack(q+R,p+q+R+2,q+R+1);const E=l.length,A=E+2*(p+1);for(const R of[0,1])for(let q=0;q<=p;q++)for(const oe of[0,1])l.emplaceBack(q*y,R*o.N,oe);for(let R=0;R<2*p;R+=2)f.emplaceBack(A+R,A+R+1,A+R+3),f.emplaceBack(A+R,A+R+3,A+R+2),f.emplaceBack(E+R,E+R+3,E+R+1),f.emplaceBack(E+R,E+R+2,E+R+3);const F=l.length,D=F+2*(p+1);for(const R of[0,1])for(let q=0;q<=p;q++)for(const oe of[0,1])l.emplaceBack(R*o.N,q*y,oe);for(let R=0;R<2*p;R+=2)f.emplaceBack(F+R,F+R+1,F+R+3),f.emplaceBack(F+R,F+R+3,F+R+2),f.emplaceBack(D+R,D+R+3,D+R+1),f.emplaceBack(D+R,D+R+2,D+R+3);return this._mesh={indexBuffer:r.createIndexBuffer(f),vertexBuffer:r.createVertexBuffer(l,Rh.members),segments:o.S.simpleSegment(0,0,l.length,f.length)},this._mesh}getMeshFrameDelta(r){return 2*Math.PI*o.be/Math.pow(2,r)/5}getMinTileElevationForLngLatZoom(r,l){var f;const{tileID:p}=this._getOverscaledTileIDFromLngLatZoom(r,l);return(f=this.getMinMaxElevation(p).minElevation)!==null&&f!==void 0?f:0}getMinMaxElevation(r){const l=this.getTerrainData(r).tile,f={minElevation:null,maxElevation:null};return l&&l.dem&&(f.minElevation=l.dem.min*this.exaggeration,f.maxElevation=l.dem.max*this.exaggeration),f}_getOverscaledTileIDFromLngLatZoom(r,l){const f=o.U.fromLngLat(r.wrap()),p=(1<<l)*o.N,y=f.x*p,T=f.y*p,E=Math.floor(y/o.N),A=Math.floor(T/o.N);return{tileID:new o.O(l,0,l,E,A),mercatorX:y,mercatorY:T}}_allowMercatorOverflow(r,l){const f=r.x<this.painter.width/2;let p=o.bf(l);const y=this.painter.transform.center.lng;return f&&Math.sign(p)>0&&Math.sign(y)<0||!f&&Math.sign(p)<0&&Math.sign(y)>0?(p=360*Math.sign(y)+p,o.G(p)):l}}class rf{constructor(r,l,f){this._context=r,this._size=l,this._tileSize=f,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const r of this._objects)r.texture.destroy(),r.fbo.destroy()}_createObject(r){const l=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),f=new Ue(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return f.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),l.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),l.colorAttachment.set(f.texture),{id:r,fbo:l,texture:f,stamp:-1,inUse:!1}}getObjectForId(r){return this._objects[r]}useObject(r){r.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(l=>r.id!==l),this._recentlyUsed.push(r.id)}stampObject(r){r.stamp=++this._stamp}getOrCreateFreeObject(){for(const l of this._recentlyUsed)if(!this._objects[l].inUse)return this._objects[l];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const r=this._createObject(this._objects.length);return this._objects.push(r),r}freeObject(r){r.inUse=!1}freeAllObjects(){for(const r of this._objects)this.freeObject(r)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(r=>!r.inUse)===!1}}const Na={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Zo{constructor(r,l){this.painter=r,this.terrain=l,this.pool=new rf(r.context,30,l.sourceCache.tileSize*l.qualityFactor)}destruct(){this.pool.destruct()}getTexture(r){return this.pool.getObjectForId(r.rtt[this._stacks.length-1].id).texture}prepareForRender(r,l){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=r._order.filter(f=>!r._layers[f].isHidden(l)),this._coordsDescendingInv={};for(const f in r.sourceCaches){this._coordsDescendingInv[f]={};const p=r.sourceCaches[f].getVisibleCoordinates();for(const y of p){const T=this.terrain.sourceCache.getTerrainCoords(y);for(const E in T)this._coordsDescendingInv[f][E]||(this._coordsDescendingInv[f][E]=[]),this._coordsDescendingInv[f][E].push(T[E])}}this._coordsDescendingInvStr={};for(const f of r._order){const p=r._layers[f],y=p.source;if(Na[p.type]&&!this._coordsDescendingInvStr[y]){this._coordsDescendingInvStr[y]={};for(const T in this._coordsDescendingInv[y])this._coordsDescendingInvStr[y][T]=this._coordsDescendingInv[y][T].map(E=>E.key).sort().join()}}for(const f of this._renderableTiles)for(const p in this._coordsDescendingInvStr){const y=this._coordsDescendingInvStr[p][f.tileID.key];y&&y!==f.rttCoords[p]&&(f.rtt=[])}}renderLayer(r){if(r.isHidden(this.painter.transform.zoom))return!1;const l=r.type,f=this.painter,p=this._renderableLayerIds[this._renderableLayerIds.length-1]===r.id;if(Na[l]&&(this._prevType&&Na[this._prevType]||this._stacks.push([]),this._prevType=l,this._stacks[this._stacks.length-1].push(r.id),!p))return!0;if(Na[this._prevType]||Na[l]&&p){this._prevType=l;const y=this._stacks.length-1,T=this._stacks[y]||[];for(const E of this._renderableTiles){if(this.pool.isFull()&&(Hr(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(E),E.rtt[y]){const F=this.pool.getObjectForId(E.rtt[y].id);if(F.stamp===E.rtt[y].stamp){this.pool.useObject(F);continue}}const A=this.pool.getOrCreateFreeObject();this.pool.useObject(A),this.pool.stampObject(A),E.rtt[y]={id:A.id,stamp:A.stamp},f.context.bindFramebuffer.set(A.fbo.framebuffer),f.context.clear({color:o.aT.transparent,stencil:0}),f.currentStencilSource=void 0;for(let F=0;F<T.length;F++){const D=f.style._layers[T[F]],R=D.source?this._coordsDescendingInv[D.source][E.tileID.key]:[E.tileID];f.context.viewport.set([0,0,A.fbo.width,A.fbo.height]),f._renderTileClippingMasks(D,R),f.renderLayer(f,f.style.sourceCaches[D.source],D,R),D.source&&(E.rttCoords[D.source]=this._coordsDescendingInvStr[D.source][E.tileID.key])}}return Hr(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Na[l]}return!1}}const zt=S,Gt={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:o.c.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},Ks=g=>{g.touchstart=g.dragStart,g.touchmoveWindow=g.dragMove,g.touchend=g.dragEnd},ec={showCompass:!0,showZoom:!0,visualizePitch:!1};class tc{constructor(r,l,f=!1){this.mousedown=T=>{this.startMouse(o.e({},T,{ctrlKey:!0,preventDefault:()=>T.preventDefault()}),b.mousePos(this.element,T)),b.addEventListener(window,"mousemove",this.mousemove),b.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=T=>{this.moveMouse(T,b.mousePos(this.element,T))},this.mouseup=T=>{this.mouseRotate.dragEnd(T),this.mousePitch&&this.mousePitch.dragEnd(T),this.offTemp()},this.touchstart=T=>{T.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=b.touchPos(this.element,T.targetTouches)[0],this.startTouch(T,this._startPos),b.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),b.addEventListener(window,"touchend",this.touchend))},this.touchmove=T=>{T.targetTouches.length!==1?this.reset():(this._lastPos=b.touchPos(this.element,T.targetTouches)[0],this.moveTouch(T,this._lastPos))},this.touchend=T=>{T.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const p=r.dragRotate._mouseRotate.getClickTolerance(),y=r.dragRotate._mousePitch.getClickTolerance();this.element=l,this.mouseRotate=ps({clickTolerance:p,enable:!0}),this.touchRotate=(({enable:T,clickTolerance:E,bearingDegreesPerPixelMoved:A=.8})=>{const F=new Ih;return new un({clickTolerance:E,move:(D,R)=>({bearingDelta:(R.x-D.x)*A}),moveStateManager:F,enable:T,assignEvents:Ks})})({clickTolerance:p,enable:!0}),this.map=r,f&&(this.mousePitch=fn({clickTolerance:y,enable:!0}),this.touchPitch=(({enable:T,clickTolerance:E,pitchDegreesPerPixelMoved:A=-.5})=>{const F=new Ih;return new un({clickTolerance:E,move:(D,R)=>({pitchDelta:(R.y-D.y)*A}),moveStateManager:F,enable:T,assignEvents:Ks})})({clickTolerance:y,enable:!0})),b.addEventListener(l,"mousedown",this.mousedown),b.addEventListener(l,"touchstart",this.touchstart,{passive:!1}),b.addEventListener(l,"touchcancel",this.reset)}startMouse(r,l){this.mouseRotate.dragStart(r,l),this.mousePitch&&this.mousePitch.dragStart(r,l),b.disableDrag()}startTouch(r,l){this.touchRotate.dragStart(r,l),this.touchPitch&&this.touchPitch.dragStart(r,l),b.disableDrag()}moveMouse(r,l){const f=this.map,{bearingDelta:p}=this.mouseRotate.dragMove(r,l)||{};if(p&&f.setBearing(f.getBearing()+p),this.mousePitch){const{pitchDelta:y}=this.mousePitch.dragMove(r,l)||{};y&&f.setPitch(f.getPitch()+y)}}moveTouch(r,l){const f=this.map,{bearingDelta:p}=this.touchRotate.dragMove(r,l)||{};if(p&&f.setBearing(f.getBearing()+p),this.touchPitch){const{pitchDelta:y}=this.touchPitch.dragMove(r,l)||{};y&&f.setPitch(f.getPitch()+y)}}off(){const r=this.element;b.removeEventListener(r,"mousedown",this.mousedown),b.removeEventListener(r,"touchstart",this.touchstart,{passive:!1}),b.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),b.removeEventListener(window,"touchend",this.touchend),b.removeEventListener(r,"touchcancel",this.reset),this.offTemp()}offTemp(){b.enableDrag(),b.removeEventListener(window,"mousemove",this.mousemove),b.removeEventListener(window,"mouseup",this.mouseup),b.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),b.removeEventListener(window,"touchend",this.touchend)}}let ra;function rc(g,r,l){if(g=new o.L(g.lng,g.lat),r){const f=new o.L(g.lng-360,g.lat),p=new o.L(g.lng+360,g.lat),y=l.locationPoint(g).distSqr(r);l.locationPoint(f).distSqr(r)<y?g=f:l.locationPoint(p).distSqr(r)<y&&(g=p)}for(;Math.abs(g.lng-l.center.lng)>180;){const f=l.locationPoint(g);if(f.x>=0&&f.y>=0&&f.x<=l.width&&f.y<=l.height)break;g.lng>l.center.lng?g.lng-=360:g.lng+=360}return g}const Pi={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function zh(g,r,l){const f=g.classList;for(const p in Pi)f.remove(`maplibregl-${l}-anchor-${p}`);f.add(`maplibregl-${l}-anchor-${r}`)}class Hn extends o.E{constructor(r){if(super(),this._onKeyPress=l=>{const f=l.code,p=l.charCode||l.keyCode;f!=="Space"&&f!=="Enter"&&p!==32&&p!==13||this.togglePopup()},this._onMapClick=l=>{const f=l.originalEvent.target,p=this._element;this._popup&&(f===p||p.contains(f))&&this.togglePopup()},this._update=l=>{if(!this._map)return;const f=this._map.loaded()&&!this._map.isMoving();(l?.type==="terrain"||l?.type==="render"&&!f)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=rc(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let p="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?p=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(p=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let y="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?y="rotateX(0deg)":this._pitchAlignment==="map"&&(y=`rotateX(${this._map.getPitch()}deg)`),l&&l.type!=="moveend"||(this._pos=this._pos.round()),b.setTransform(this._element,`${Pi[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${y} ${p}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const T=this._map.unproject(this._pos),E=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=T.distanceTo(this._lngLat)>20*E?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=l=>{if(!this._isDragging){const f=this._clickTolerance||this._map._clickTolerance;this._isDragging=l.point.dist(this._pointerdownPos)>=f}this._isDragging&&(this._pos=l.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.k("dragstart"))),this.fire(new o.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.k("dragend")),this._state="inactive"},this._addDragHandler=l=>{this._element.contains(l.originalEvent.target)&&(l.preventDefault(),this._positionDelta=l.point.sub(this._pos).add(this._offset),this._pointerdownPos=l.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment!=="auto"?r.pitchAlignment:this._rotationAlignment,r&&r.element)this._element=r.element,this._offset=o.P.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=b.create("div"),this._element.setAttribute("aria-label","Map marker");const l=b.createNS("http://www.w3.org/2000/svg","svg"),f=41,p=27;l.setAttributeNS(null,"display","block"),l.setAttributeNS(null,"height",`${f}px`),l.setAttributeNS(null,"width",`${p}px`),l.setAttributeNS(null,"viewBox",`0 0 ${p} ${f}`);const y=b.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"stroke","none"),y.setAttributeNS(null,"stroke-width","1"),y.setAttributeNS(null,"fill","none"),y.setAttributeNS(null,"fill-rule","evenodd");const T=b.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"fill-rule","nonzero");const E=b.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"transform","translate(3.0, 29.0)"),E.setAttributeNS(null,"fill","#000000");const A=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Ie of A){const Ve=b.createNS("http://www.w3.org/2000/svg","ellipse");Ve.setAttributeNS(null,"opacity","0.04"),Ve.setAttributeNS(null,"cx","10.5"),Ve.setAttributeNS(null,"cy","5.80029008"),Ve.setAttributeNS(null,"rx",Ie.rx),Ve.setAttributeNS(null,"ry",Ie.ry),E.appendChild(Ve)}const F=b.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"fill",this._color);const D=b.createNS("http://www.w3.org/2000/svg","path");D.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),F.appendChild(D);const R=b.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"opacity","0.25"),R.setAttributeNS(null,"fill","#000000");const q=b.createNS("http://www.w3.org/2000/svg","path");q.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),R.appendChild(q);const oe=b.createNS("http://www.w3.org/2000/svg","g");oe.setAttributeNS(null,"transform","translate(6.0, 7.0)"),oe.setAttributeNS(null,"fill","#FFFFFF");const se=b.createNS("http://www.w3.org/2000/svg","g");se.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ce=b.createNS("http://www.w3.org/2000/svg","circle");ce.setAttributeNS(null,"fill","#000000"),ce.setAttributeNS(null,"opacity","0.25"),ce.setAttributeNS(null,"cx","5.5"),ce.setAttributeNS(null,"cy","5.5"),ce.setAttributeNS(null,"r","5.4999962");const ae=b.createNS("http://www.w3.org/2000/svg","circle");ae.setAttributeNS(null,"fill","#FFFFFF"),ae.setAttributeNS(null,"cx","5.5"),ae.setAttributeNS(null,"cy","5.5"),ae.setAttributeNS(null,"r","5.4999962"),se.appendChild(ce),se.appendChild(ae),T.appendChild(E),T.appendChild(F),T.appendChild(R),T.appendChild(oe),T.appendChild(se),l.appendChild(T),l.setAttributeNS(null,"height",f*this._scale+"px"),l.setAttributeNS(null,"width",p*this._scale+"px"),this._element.appendChild(l),this._offset=o.P.convert(r&&r.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",l=>{l.preventDefault()}),this._element.addEventListener("mousedown",l=>{l.preventDefault()}),zh(this._element,this._anchor,"marker"),r&&r.className)for(const l of r.className.split(" "))this._element.classList.add(l);this._popup=null}addTo(r){return this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._update),r.on("moveend",this._update),r.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),b.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=o.L.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const p=Math.abs(13.5)/Math.SQRT2;r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(38.1-13.5+p)],"bottom-right":[-p,-1*(38.1-13.5+p)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?r.remove():r.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(r){return this._offset=o.P.convert(r),this._update(),this}addClassName(r){this._element.classList.add(r)}removeClassName(r){this._element.classList.remove(r)}toggleClassName(r){return this._element.classList.toggle(r)}setDraggable(r){return this._draggable=!!r,this._map&&(r?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r&&r!=="auto"?r:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const qr={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let $r=0,gs=!1;const Ys={maxWidth:100,unit:"metric"};function Js(g,r,l){const f=l&&l.maxWidth||100,p=g._container.clientHeight/2,y=g.unproject([0,p]),T=g.unproject([f,p]),E=y.distanceTo(T);if(l&&l.unit==="imperial"){const A=3.2808*E;A>5280?qn(r,f,A/5280,g._getUIString("ScaleControl.Miles")):qn(r,f,A,g._getUIString("ScaleControl.Feet"))}else l&&l.unit==="nautical"?qn(r,f,E/1852,g._getUIString("ScaleControl.NauticalMiles")):E>=1e3?qn(r,f,E/1e3,g._getUIString("ScaleControl.Kilometers")):qn(r,f,E,g._getUIString("ScaleControl.Meters"))}function qn(g,r,l,f){const p=function(y){const T=Math.pow(10,`${Math.floor(y)}`.length-1);let E=y/T;return E=E>=10?10:E>=5?5:E>=3?3:E>=2?2:E>=1?1:function(A){const F=Math.pow(10,Math.ceil(-Math.log(A)/Math.LN10));return Math.round(A*F)/F}(E),T*E}(l);g.style.width=r*(p/l)+"px",g.innerHTML=`${p}&nbsp;${f}`}const ac={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ic=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function xs(g){if(g){if(typeof g=="number"){const r=Math.round(Math.abs(g)/Math.SQRT2);return{center:new o.P(0,0),top:new o.P(0,g),"top-left":new o.P(r,r),"top-right":new o.P(-r,r),bottom:new o.P(0,-g),"bottom-left":new o.P(r,-r),"bottom-right":new o.P(-r,-r),left:new o.P(g,0),right:new o.P(-g,0)}}if(g instanceof o.P||Array.isArray(g)){const r=o.P.convert(g);return{center:r,top:r,"top-left":r,"top-right":r,bottom:r,"bottom-left":r,"bottom-right":r,left:r,right:r}}return{center:o.P.convert(g.center||[0,0]),top:o.P.convert(g.top||[0,0]),"top-left":o.P.convert(g["top-left"]||[0,0]),"top-right":o.P.convert(g["top-right"]||[0,0]),bottom:o.P.convert(g.bottom||[0,0]),"bottom-left":o.P.convert(g["bottom-left"]||[0,0]),"bottom-right":o.P.convert(g["bottom-right"]||[0,0]),left:o.P.convert(g.left||[0,0]),right:o.P.convert(g.right||[0,0])}}return xs(new o.P(0,0))}const nc={extend:(g,...r)=>o.e(g,...r),run(g){g()},logToElement(g,r=!1,l="log"){const f=window.document.getElementById(l);f&&(r&&(f.innerHTML=""),f.innerHTML+=`<br>${g}`)}},sc=S;class yr{static get version(){return sc}static get workerCount(){return Zr.workerCount}static set workerCount(r){Zr.workerCount=r}static get maxParallelImageRequests(){return o.c.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(r){o.c.MAX_PARALLEL_IMAGE_REQUESTS=r}static get workerUrl(){return o.c.WORKER_URL}static set workerUrl(r){o.c.WORKER_URL=r}static addProtocol(r,l){o.c.REGISTERED_PROTOCOLS[r]=l}static removeProtocol(r){delete o.c.REGISTERED_PROTOCOLS[r]}}return yr.Map=class extends Lh{constructor(g){if(o.bg.mark(o.bh.create),(g=o.e({},Gt,g)).minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new jo(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies),{bearingSnap:g.bearingSnap}),this._cooperativeGesturesOnWheel=r=>{this._onCooperativeGesture(r,r[this._metaKey],1)},this._contextLost=r=>{r.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.k("webglcontextlost",{originalEvent:r}))},this._contextRestored=r=>{this._setupPainter(),this.resize(),this._update(),this.fire(new o.k("webglcontextrestored",{originalEvent:r}))},this._onMapScroll=r=>{if(r.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=g.interactive,this._cooperativeGestures=g.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=g.maxTileCacheSize,this._maxTileCacheZoomLevels=g.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._crossSourceCollisions=g.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=g.collectResourceTiming,this._renderTaskQueue=new Wo,this._controls=[],this._mapId=o.a2(),this._locale=o.e({},Ql,g.locale),this._clickTolerance=g.clickTolerance,this._overridePixelRatio=g.pixelRatio,this._maxCanvasSize=g.maxCanvasSize,this.transformCameraUpdate=g.transformCameraUpdate,this._imageQueueHandle=G.addThrottleControl(()=>this.isMoving()),this._requestManager=new pe(g.transformRequest),typeof g.container=="string"){if(this._container=document.getElementById(g.container),!this._container)throw new Error(`Container '${g.container}' not found.`)}else{if(!(g.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(g.maxBounds&&this.setMaxBounds(g.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let r=!1;const l=Gn(f=>{this._trackResize&&!this._removed&&this.resize(f)._update()},50);this._resizeObserver=new ResizeObserver(f=>{r?l(f):r=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Jl(this,g),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=g.hash&&new Hs(typeof g.hash=="string"&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,o.e({},g.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=g.localIdeographFontFamily,this._validateStyle=g.validateStyle,g.style&&this.setStyle(g.style,{localIdeographFontFamily:g.localIdeographFontFamily}),g.attributionControl&&this.addControl(new gi({customAttribution:g.customAttribution})),g.maplibreLogo&&this.addControl(new Pr,g.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",r=>{this._update(r.dataType==="style"),this.fire(new o.k(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new o.k(`${r.dataType}dataloading`,r))}),this.on("dataabort",r=>{this.fire(new o.k("sourcedataabort",r))})}_getMapId(){return this._mapId}addControl(g,r){if(r===void 0&&(r=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new o.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=g.onAdd(this);this._controls.push(g);const f=this._controlPositions[r];return r.indexOf("bottom")!==-1?f.insertBefore(l,f.firstChild):f.appendChild(l),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new o.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(g);return r>-1&&this._controls.splice(r,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}calculateCameraOptionsFromTo(g,r,l,f){return f==null&&this.terrain&&(f=this.terrain.getElevationForLngLatZoom(l,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(g,r,l,f)}resize(g){var r;const l=this._containerDimensions(),f=l[0],p=l[1],y=this._getClampedPixelRatio(f,p);if(this._resizeCanvas(f,p,y),this.painter.resize(f,p,y),this.painter.overLimit()){const E=this.painter.context.gl;this._maxCanvasSize=[E.drawingBufferWidth,E.drawingBufferHeight];const A=this._getClampedPixelRatio(f,p);this._resizeCanvas(f,p,A),this.painter.resize(f,p,A)}this.transform.resize(f,p),(r=this._requestedCameraState)===null||r===void 0||r.resize(f,p);const T=!this._moving;return T&&(this.stop(),this.fire(new o.k("movestart",g)).fire(new o.k("move",g))),this.fire(new o.k("resize",g)),T&&this.fire(new o.k("moveend",g)),this}_getClampedPixelRatio(g,r){const{0:l,1:f}=this._maxCanvasSize,p=this.getPixelRatio(),y=g*p,T=r*p;return Math.min(y>l?l/y:1,T>f?f/T:1)*p}getPixelRatio(){var g;return(g=this._overridePixelRatio)!==null&&g!==void 0?g:devicePixelRatio}setPixelRatio(g){this._overridePixelRatio=g,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(g){return this.transform.setMaxBounds(be.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g&&this.setZoom(g),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g&&this.setZoom(g),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g&&this.setPitch(g),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g&&this.setPitch(g),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.renderWorldCopies=g,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(g){return this._cooperativeGestures=g,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(g){return this.transform.locationPoint(o.L.convert(g),this.style&&this.terrain)}unproject(g){return this.transform.pointLocation(o.P.convert(g),this.terrain)}isMoving(){var g;return this._moving||((g=this.handlers)===null||g===void 0?void 0:g.isMoving())}isZooming(){var g;return this._zooming||((g=this.handlers)===null||g===void 0?void 0:g.isZooming())}isRotating(){var g;return this._rotating||((g=this.handlers)===null||g===void 0?void 0:g.isRotating())}_createDelegatedListener(g,r,l){if(g==="mouseenter"||g==="mouseover"){let f=!1;return{layer:r,listener:l,delegates:{mousemove:y=>{const T=this.getLayer(r)?this.queryRenderedFeatures(y.point,{layers:[r]}):[];T.length?f||(f=!0,l.call(this,new mi(g,this,y.originalEvent,{features:T}))):f=!1},mouseout:()=>{f=!1}}}}if(g==="mouseleave"||g==="mouseout"){let f=!1;return{layer:r,listener:l,delegates:{mousemove:T=>{(this.getLayer(r)?this.queryRenderedFeatures(T.point,{layers:[r]}):[]).length?f=!0:f&&(f=!1,l.call(this,new mi(g,this,T.originalEvent)))},mouseout:T=>{f&&(f=!1,l.call(this,new mi(g,this,T.originalEvent)))}}}}{const f=p=>{const y=this.getLayer(r)?this.queryRenderedFeatures(p.point,{layers:[r]}):[];y.length&&(p.features=y,l.call(this,p),delete p.features)};return{layer:r,listener:l,delegates:{[g]:f}}}}on(g,r,l){if(l===void 0)return super.on(g,r);const f=this._createDelegatedListener(g,r,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(f);for(const p in f.delegates)this.on(p,f.delegates[p]);return this}once(g,r,l){if(l===void 0)return super.once(g,r);const f=this._createDelegatedListener(g,r,l);for(const p in f.delegates)this.once(p,f.delegates[p]);return this}off(g,r,l){return l===void 0?super.off(g,r):(this._delegatedListeners&&this._delegatedListeners[g]&&(f=>{const p=this._delegatedListeners[g];for(let y=0;y<p.length;y++){const T=p[y];if(T.layer===r&&T.listener===l){for(const E in T.delegates)this.off(E,T.delegates[E]);return p.splice(y,1),this}}})(),this)}queryRenderedFeatures(g,r){if(!this.style)return[];let l;const f=g instanceof o.P||Array.isArray(g),p=f?g:[[0,0],[this.transform.width,this.transform.height]];if(r=r||(f?{}:g)||{},p instanceof o.P||typeof p[0]=="number")l=[o.P.convert(p)];else{const y=o.P.convert(p[0]),T=o.P.convert(p[1]);l=[y,new o.P(T.x,y.y),T,new o.P(y.x,T.y),y]}return this.style.queryRenderedFeatures(l,r,this.transform)}querySourceFeatures(g,r){return this.style.querySourceFeatures(g,r)}setStyle(g,r){return(r=o.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},r)).diff!==!1&&r.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&g?(this._diffStyle(g,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._updateStyle(g,r))}setTransformRequest(g){return this._requestManager.setTransformRequest(g),this}_getUIString(g){const r=this._locale[g];if(r==null)throw new Error(`Missing UI string '${g}'`);return r}_updateStyle(g,r){if(r.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(g,r));const l=this.style&&r.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!g)),g?(this.style=new ka(this,r||{}),this.style.setEventedParent(this,{style:this.style}),typeof g=="string"?this.style.loadURL(g,r,l):this.style.loadJSON(g,r,l),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ka(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(g,r){if(typeof g=="string"){const l=this._requestManager.transformRequest(g,ie.Style);o.f(l,(f,p)=>{f?this.fire(new o.j(f)):p&&this._updateDiff(p,r)})}else typeof g=="object"&&this._updateDiff(g,r)}_updateDiff(g,r){try{this.style.setState(g,r)&&this._update(!0)}catch(l){o.w(`Unable to perform style diff: ${l.message||l.error||l}.  Rebuilding the style from scratch.`),this._updateStyle(g,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.w("There is no style added to the map.")}addSource(g,r){return this._lazyInitEmptyStyle(),this.style.addSource(g,r),this._update(!0)}isSourceLoaded(g){const r=this.style&&this.style.sourceCaches[g];if(r!==void 0)return r.loaded();this.fire(new o.j(new Error(`There is no source with ID '${g}'`)))}setTerrain(g){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),g){const r=this.style.sourceCaches[g.source];if(!r)throw new Error(`cannot load terrain, because there exists no source with ID: ${g.source}`);for(const l in this.style._layers){const f=this.style._layers[l];f.type==="hillshade"&&f.source===g.source&&o.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Bh(this.painter,r,g),this.painter.renderToTexture=new Zo(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=l=>{l.dataType==="style"?this.terrain.sourceCache.freeRtt():l.dataType==="source"&&l.tile&&(l.sourceId!==g.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(l.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new o.k("terrain",{terrain:g})),this}getTerrain(){var g,r;return(r=(g=this.terrain)===null||g===void 0?void 0:g.options)!==null&&r!==void 0?r:null}areTilesLoaded(){const g=this.style&&this.style.sourceCaches;for(const r in g){const l=g[r]._tiles;for(const f in l){const p=l[f];if(p.state!=="loaded"&&p.state!=="errored")return!1}}return!0}addSourceType(g,r,l){return this._lazyInitEmptyStyle(),this.style.addSourceType(g,r,l)}removeSource(g){return this.style.removeSource(g),this._update(!0)}getSource(g){return this.style.getSource(g)}addImage(g,r,l={}){const{pixelRatio:f=1,sdf:p=!1,stretchX:y,stretchY:T,content:E}=l;if(this._lazyInitEmptyStyle(),!(r instanceof HTMLImageElement||o.a(r))){if(r.width===void 0||r.height===void 0)return this.fire(new o.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:A,height:F,data:D}=r,R=r;return this.style.addImage(g,{data:new o.R({width:A,height:F},new Uint8Array(D)),pixelRatio:f,stretchX:y,stretchY:T,content:E,sdf:p,version:0,userImage:R}),R.onAdd&&R.onAdd(this,g),this}}{const{width:A,height:F,data:D}=o.h.getImageData(r);this.style.addImage(g,{data:new o.R({width:A,height:F},D),pixelRatio:f,stretchX:y,stretchY:T,content:E,sdf:p,version:0})}}updateImage(g,r){const l=this.style.getImage(g);if(!l)return this.fire(new o.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const f=r instanceof HTMLImageElement||o.a(r)?o.h.getImageData(r):r,{width:p,height:y,data:T}=f;if(p===void 0||y===void 0)return this.fire(new o.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(p!==l.data.width||y!==l.data.height)return this.fire(new o.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const E=!(r instanceof HTMLImageElement||o.a(r));return l.data.replace(T,E),this.style.updateImage(g,l),this}getImage(g){return this.style.getImage(g)}hasImage(g){return g?!!this.style.getImage(g):(this.fire(new o.j(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g,r){G.getImage(this._requestManager.transformRequest(g,ie.Image),r)}listImages(){return this.style.listImages()}addLayer(g,r){return this._lazyInitEmptyStyle(),this.style.addLayer(g,r),this._update(!0)}moveLayer(g,r){return this.style.moveLayer(g,r),this._update(!0)}removeLayer(g){return this.style.removeLayer(g),this._update(!0)}getLayer(g){return this.style.getLayer(g)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(g,r,l){return this.style.setLayerZoomRange(g,r,l),this._update(!0)}setFilter(g,r,l={}){return this.style.setFilter(g,r,l),this._update(!0)}getFilter(g){return this.style.getFilter(g)}setPaintProperty(g,r,l,f={}){return this.style.setPaintProperty(g,r,l,f),this._update(!0)}getPaintProperty(g,r){return this.style.getPaintProperty(g,r)}setLayoutProperty(g,r,l,f={}){return this.style.setLayoutProperty(g,r,l,f),this._update(!0)}getLayoutProperty(g,r){return this.style.getLayoutProperty(g,r)}setGlyphs(g,r={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(g,r),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(g,r,l={}){return this._lazyInitEmptyStyle(),this.style.addSprite(g,r,l,f=>{f||this._update(!0)}),this}removeSprite(g){return this._lazyInitEmptyStyle(),this.style.removeSprite(g),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(g,r={}){return this._lazyInitEmptyStyle(),this.style.setSprite(g,r,l=>{l||this._update(!0)}),this}setLight(g,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(g,r),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(g,r){return this.style.setFeatureState(g,r),this._update()}removeFeatureState(g,r){return this.style.removeFeatureState(g,r),this._update()}getFeatureState(g){return this.style.getFeatureState(g)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let g=0,r=0;return this._container&&(g=this._container.clientWidth||400,r=this._container.clientHeight||300),[g,r]}_setupContainer(){const g=this._container;g.classList.add("maplibregl-map");const r=this._canvasContainer=b.create("div","maplibregl-canvas-container",g);this._interactive&&r.classList.add("maplibregl-interactive"),this._canvas=b.create("canvas","maplibregl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const l=this._containerDimensions(),f=this._getClampedPixelRatio(l[0],l[1]);this._resizeCanvas(l[0],l[1],f);const p=this._controlContainer=b.create("div","maplibregl-control-container",g),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(T=>{y[T]=b.create("div",`maplibregl-ctrl-${T} `,p)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=b.create("div","maplibregl-cooperative-gesture-screen",this._container);let g=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(g=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use  + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${g}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){b.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(g,r,l){this._canvas.width=Math.floor(l*g),this._canvas.height=Math.floor(l*r),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${r}px`}_setupPainter(){const g={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let r=null;this._canvas.addEventListener("webglcontextcreationerror",f=>{r={requestedAttributes:g},f&&(r.statusMessage=f.statusMessage,r.type=f.type)},{once:!0});const l=this._canvas.getContext("webgl2",g)||this._canvas.getContext("webgl",g);if(!l){const f="Failed to initialize WebGL";throw r?(r.message=f,new Error(JSON.stringify(r))):new Error(f)}this.painter=new jn(l,this.transform),C.testSupport(l)}_onCooperativeGesture(g,r,l){return!r&&l<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(g){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_render(g){const r=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(g),this._removed)return;let l=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const p=this.transform.zoom,y=o.h.now();this.style.zoomHistory.update(p,y);const T=new o.a8(p,{now:y,fadeDuration:r,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),E=T.crossFadingFactor();E===1&&E===this._crossFadingFactor||(l=!0,this._crossFadingFactor=E),this.style.update(T)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,r,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:r,showPadding:this.showPadding}),this.fire(new o.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.bg.mark(o.bh.load),this.fire(new o.k("load"))),this.style&&(this.style.hasTransitions()||l)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const f=this._sourcesDirty||this._styleDirty||this._placementDirty;return f||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.k("idle")),!this._loaded||this._fullyLoaded||f||(this._fullyLoaded=!0,o.bg.mark(o.bh.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var g;this._hash&&this._hash.remove();for(const l of this._controls)l.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),G.removeThrottleControl(this._imageQueueHandle),(g=this._resizeObserver)===null||g===void 0||g.disconnect();const r=this.painter.context.gl.getExtension("WEBGL_lose_context");r&&r.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),b.remove(this._canvasContainer),b.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),o.bg.clearMetrics(),this._removed=!0,this.fire(new o.k("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=o.h.frame(g=>{o.bg.frame(g),this._frame=null,this._render(g)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get version(){return zt}getCameraTargetElevation(){return this.transform.elevation}},yr.NavigationControl=class{constructor(g){this._updateZoomButtons=()=>{const r=this._map.getZoom(),l=r===this._map.getMaxZoom(),f=r===this._map.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())},this._rotateCompassArrow=()=>{const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=r},this._setButtonTitle=(r,l)=>{const f=this._map._getUIString(`NavigationControl.${l}`);r.title=f,r.setAttribute("aria-label",f)},this.options=o.e({},ec,g),this._container=b.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",r=>this._map.zoomIn({},{originalEvent:r})),b.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",r=>this._map.zoomOut({},{originalEvent:r})),b.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",r=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:r}):this._map.resetNorth({},{originalEvent:r})}),this._compassIcon=b.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new tc(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){b.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(g,r){const l=b.create("button",g,this._container);return l.type="button",l.addEventListener("click",r),l}},yr.GeolocateControl=class extends o.E{constructor(g){super(),this._onSuccess=r=>{if(this._map){if(this._isOutOfMapMaxBounds(r))return this._setErrorState(),this.fire(new o.k("outofmaxbounds",r)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=r,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(r),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(r),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new o.k("geolocate",r)),this._finish()}},this._updateCamera=r=>{const l=new o.L(r.coords.longitude,r.coords.latitude),f=r.coords.accuracy,p=this._map.getBearing(),y=o.e({bearing:p},this.options.fitBoundsOptions),T=be.fromLngLat(l,f);this._map.fitBounds(T,y,{geolocateSource:!0})},this._updateMarker=r=>{if(r){const l=new o.L(r.coords.longitude,r.coords.latitude);this._accuracyCircleMarker.setLngLat(l).addTo(this._map),this._userLocationDotMarker.setLngLat(l).addTo(this._map),this._accuracy=r.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=r=>{if(this._map){if(this.options.trackUserLocation)if(r.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=l,this._geolocateButton.setAttribute("aria-label",l),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(r.code===3&&gs)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new o.k("error",r)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=r=>{if(this._map){if(this._container.addEventListener("contextmenu",l=>l.preventDefault()),this._geolocateButton=b.create("button","maplibregl-ctrl-geolocate",this._container),b.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",r===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=l,this._geolocateButton.setAttribute("aria-label",l)}else{const l=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=l,this._geolocateButton.setAttribute("aria-label",l)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=b.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Hn({element:this._dotElement}),this._circleElement=b.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Hn({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",l=>{l.geolocateSource||this._watchState!=="ACTIVE_LOCK"||l.originalEvent&&l.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new o.k("trackuserlocationend")))})}},this.options=o.e({},qr,g)}onAdd(g){return this._map=g,this._container=b.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(r,l=!1){ra===void 0||l?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(f=>{ra=f.state!=="denied",r(ra)}).catch(()=>{ra=!!window.navigator.geolocation,r(ra)}):(ra=!!window.navigator.geolocation,r(ra)):r(ra)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),b.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,$r=0,gs=!1}_isOutOfMapMaxBounds(g){const r=this._map.getMaxBounds(),l=g.coords;return r&&(l.longitude<r.getWest()||l.longitude>r.getEast()||l.latitude<r.getSouth()||l.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const g=this._map.getBounds(),r=g.getSouthEast(),l=g.getNorthEast(),f=r.distanceTo(l),p=Math.ceil(this._accuracy/(f/this._map._container.clientHeight)*2);this._circleElement.style.width=`${p}px`,this._circleElement.style.height=`${p}px`}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":$r--,gs=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new o.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let g;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),$r++,$r>1?(g={maximumAge:6e5,timeout:0},gs=!0):(g=this.options.positionOptions,gs=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,g)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},yr.AttributionControl=gi,yr.LogoControl=Pr,yr.ScaleControl=class{constructor(g){this._onMove=()=>{Js(this._map,this._container,this.options)},this.setUnit=r=>{this.options.unit=r,Js(this._map,this._container,this.options)},this.options=o.e({},Ys,g)}getDefaultPosition(){return"bottom-left"}onAdd(g){return this._map=g,this._container=b.create("div","maplibregl-ctrl maplibregl-ctrl-scale",g.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){b.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},yr.FullscreenControl=class extends o.E{constructor(g={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,g&&g.container&&(g.container instanceof HTMLElement?this._container=g.container:o.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=b.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){b.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const g=this._fullscreenButton=b.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);b.create("span","maplibregl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.title=g}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new o.k("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new o.k("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},yr.TerrainControl=class{constructor(g){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=g}onAdd(g){return this._map=g,this._container=b.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=b.create("button","maplibregl-ctrl-terrain",this._container),b.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){b.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},yr.Popup=class extends o.E{constructor(g){super(),this.remove=()=>(this._content&&b.remove(this._content),this._container&&(b.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new o.k("close")),this),this._onMouseUp=r=>{this._update(r.point)},this._onMouseMove=r=>{this._update(r.point)},this._onDrag=r=>{this._update(r.point)},this._update=r=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=b.create("div","maplibregl-popup",this._map.getContainer()),this._tip=b.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const T of this.options.className.split(" "))this._container.classList.add(T);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=rc(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!r)return;const l=this._pos=this._trackPointer&&r?r:this._map.project(this._lngLat);let f=this.options.anchor;const p=xs(this.options.offset);if(!f){const T=this._container.offsetWidth,E=this._container.offsetHeight;let A;A=l.y+p.bottom.y<E?["top"]:l.y>this._map.transform.height-E?["bottom"]:[],l.x<T/2?A.push("left"):l.x>this._map.transform.width-T/2&&A.push("right"),f=A.length===0?"bottom":A.join("-")}const y=l.add(p[f]).round();b.setTransform(this._container,`${Pi[f]} translate(${y.x}px,${y.y}px)`),zh(this._container,f,"popup")},this._onClose=()=>{this.remove()},this.options=o.e(Object.create(ac),g)}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new o.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(g){return this._lngLat=o.L.convert(g),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(document.createTextNode(g))}setHTML(g){const r=document.createDocumentFragment(),l=document.createElement("body");let f;for(l.innerHTML=g;f=l.firstChild,f;)r.appendChild(f);return this.setDOMContent(r)}getMaxWidth(){var g;return(g=this._container)===null||g===void 0?void 0:g.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=b.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(g),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(g){this._container&&this._container.classList.add(g)}removeClassName(g){this._container&&this._container.classList.remove(g)}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){if(this._container)return this._container.classList.toggle(g)}_createCloseButton(){this.options.closeButton&&(this._closeButton=b.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(ic);g&&g.focus()}},yr.Marker=Hn,yr.Style=ka,yr.LngLat=o.L,yr.LngLatBounds=be,yr.Point=o.P,yr.MercatorCoordinate=o.U,yr.Evented=o.E,yr.AJAXError=o.bi,yr.config=o.c,yr.CanvasSource=xe,yr.GeoJSONSource=wt,yr.ImageSource=rt,yr.RasterDEMTileSource=mt,yr.RasterTileSource=Ye,yr.VectorTileSource=Ae,yr.VideoSource=Yt,yr.setRTLTextPlugin=o.bj,yr.getRTLTextPluginStatus=o.bk,yr.prewarm=function(){zr().acquire(qt)},yr.clearPrewarmedResources=function(){const g=ua;g&&(g.isPreloaded()&&g.numActive()===1?(g.release(qt),ua=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},nc.extend(yr,{isSafari:o.ac,getPerformanceMetrics:o.bg.getPerformanceMetrics}),yr});var x=h;return x})})(Lg);var _w=Lg.exports;const yw=Py(_w);function vw({locations:e}){const[n,i]=Se.useState(!1);return Ke.jsx("div",{className:n?"fixed top-0 right-0 bottom-0 left-0 z-[9999]":"w-full h-full relative",children:Ke.jsxs(pw,{mapLib:yw,style:{width:"100%",height:" 100%",position:"relative"},mapStyle:"https://api.ekgis.vn/v2/mapstyles/style/osmplus/standard/style.json?api_key=wtpM0U1ZmE2s87LEZNSHf63Osc1a2sboaozCQNsy",children:[e.map(c=>Ke.jsx(mw,{latitude:c.lat,longitude:c.long,offsetLeft:-20,offsetTop:-10,children:Ke.jsx(A2,{des:c?.customer_name})},c.customer_name)),Ke.jsx(xw,{id:"lines",type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",properties:{color:"#F7455D"},geometry:{type:"LineString",coordinates:e.map(c=>[c.long,c.lat])}}]},children:Ke.jsx(gw,{id:"lines",type:"line",paint:{"line-color":["get","color"],"line-width":3}})})]})})}function ww({data:e}){const[n,i]=Se.useState([]);return Se.useEffect(()=>{console.log("data in map",e),i(Cg(e,["customer_name","long","lat"],{isNull:!1}))},[e]),Ke.jsx(Ke.Fragment,{children:Ke.jsxs(lo,{className:"h-[500px]",children:[Ke.jsx(Ti,{span:8,children:Ke.jsx(F0,{columns:[{title:"Stt",dataIndex:"stt",key:"stt",render:(c,h,m)=>m+1},...M0],dataSource:e,pagination:!1})}),Ke.jsx(Ti,{span:16,className:"overflow-hidden",children:Ke.jsx(vw,{locations:n})})]})})}const{Dragger:bw}=y2;function Tw({handleFile:e}){const n={name:"file",accept:".xls,.xlsx",action:"https://run.mocky.io/v3/435e224c-44fb-4773-9faf-380c5e6a2188",onChange(i){const{status:c}=i.file;c!=="uploading"&&console.log(i.file,i.fileList),c==="done"?wu.success(`${i.file.name} file uploaded successfully.`):c==="error"&&wu.error(`${i.file.name} file upload failed.`);let h=i.file.originFileObj;e(h)},onDrop(i){}};return Ke.jsxs(bw,{...n,children:[Ke.jsx("p",{className:"ant-upload-drag-icon",children:Ke.jsx(T2,{})}),Ke.jsx("p",{className:"ant-upload-text",children:"Ko, th hoc chn tp  ti ln"}),Ke.jsx("p",{className:"ant-upload-hint",children:"H tr tp .xls, .xlsx"})]})}function Ew({form:e,filter:n,setFilter:i}){const[c,h]=Se.useState([]),[m,x]=Se.useState([]),[o,S]=Se.useState([]),[b,C]=Se.useState([]);Se.useState(""),Se.useState(""),Se.useEffect(()=>{e.setFieldsValue(n)},[n]),Se.useEffect(()=>{(async()=>{let z=await an.get("/api/method/frappe.desk.search.search_link",{params:{txt:"",doctype:"Customer Group",ignore_user_permissions:0,reference_doctype:"Customer"}}),U=await an.get("/api/method/mbw_dms.api.location.list_province");x(U.result);let{results:N}=z;h(N.map(G=>({label:G.value,value:G.value})))})()},[]);const M=async z=>{let U=m.find(N=>N.ten_tinh==z)?.ma_tinh;if(U){let N=await an.get("/api/method/mbw_dms.api.location.list_district",{params:{ma_tinh:U}});S(N.result)}},L=async z=>{let U=o.find(N=>N.ten_huyen==z)?.ma_huyen;if(U){let N=await an.get("/api/method/mbw_dms.api.location.list_ward",{params:{ma_quan_huyen:U}});C(N.result)}};return Ke.jsxs(m0,{form:e,layout:"vertical",onFinish:i,children:[Ke.jsx(Ri,{label:"Loi khch hng",name:"customer_type",children:Ke.jsx(ts,{options:[{label:"Tt c",value:!1},{label:"Company",value:"Company"},{label:"Individual",value:"Individual"}]})}),Ke.jsx(Ri,{label:"Nhm khch hng",name:"customer_group",children:Ke.jsx(ts,{options:c})}),Ke.jsx("p",{className:"font-medium text-sm",children:"a ch"}),Ke.jsx(Ri,{label:"Tnh/Thnh ph",name:"city",children:Ke.jsx(ts,{options:m.map(z=>({label:z.ten_tinh,value:z.ten_tinh})),onChange:M})}),Ke.jsx(Ri,{label:"Qun/huyn",name:"district",children:Ke.jsx(ts,{options:o.map(z=>({label:z.ten_huyen,value:z.ten_huyen})),disabled:o.length==0,onChange:L})}),Ke.jsx(Ri,{label:"Phng/x",name:"ward",children:Ke.jsx(ts,{options:b.map(z=>({label:z.ten_xa,value:z.ten_xa})),disabled:b.length==0})})]})}const Sw=[...M0,{title:"Loi khch hng",dataIndex:"customer_id",key:"customer_type"},{title:"Nhm khch hng",dataIndex:"customer_name",key:"customer_group"},...Dg],cm=e=>{let n=[];for(let i in e)e[i]&&(n=[...n,{key:[M2[i]],value:e[i],key2:i}]);return n};function kw({selected:e,handleAdd:n,closeModal:i}){const[c]=My(),[h,m]=Se.useState(1),[x,o]=Se.useState({1:[]}),[S,b]=Se.useState([]),[C,M]=Se.useState({}),[L,z]=Se.useState(!1),U=20,[N,G]=Se.useState(40),ie={selectedRowKeys:x[h]&&x[h].map(ve=>ve.customer_code),onChange:(ve,we)=>{o(te=>({...te,[h]:we}))}},pe=()=>{c.submit(),z(!1)},Y=ve=>{if(ve){let we={...C};delete we[ve.key2],c.setFieldsValue(we),M(te=>(delete te[ve.key2],{...te}))}else c.resetFields(),M({})},me=()=>{let ve=Object.keys(x).reduce((we,te)=>{let Be=Number.parseInt(te);return[...we,...x[Be]]},[]);n(ve),i()};return Se.useEffect(()=>{(async()=>{const ve=await an.get("/api/method/mbw_dms.api.router.get_customer",{params:{...C,page_size:U,page_number:h}});console.log(ve?.result?.data),b(ve?.result?.data),G(ve.result?.total)})()},[C,h]),Se.useEffect(()=>{if(S.length>0){let ve=S.map(te=>te.customer_code),we=e.filter(te=>ve.includes(te.customer_code));console.log("selected",{csCode:ve,selectedPage:we}),o(te=>(console.log("prev",te),te[h]&&te[h].length>0?(console.log("chn c"),te):(console.log("chn mi",we),Object.keys(te).length>0?{...te,[h]:we}:{[h]:we})))}},[e,h,S]),Ke.jsxs(Ke.Fragment,{children:[Ke.jsxs(lo,{className:"justify-between",children:[Ke.jsxs(Ti,{className:"inline-flex ",children:[Ke.jsx(Ri,{children:Ke.jsx(vu,{placeholder:"Tm kim khch hng",prefix:Ke.jsx(kg,{})})}),Ke.jsxs("div",{className:"flex justify-center items-center ml-4",children:[Ke.jsx(oo,{className:"flex items-center text-nowrap !text-[13px] !leading-[21px] !font-normal  border-r-[0.1px] rounded-r-none h-[36px]",icon:Ke.jsx($y,{style:{fontSize:"20px"}}),onClick:z.bind(null,!0),children:"B lc"}),Ke.jsx(oo,{className:"border-l-[0.1px] rounded-l-none h-[36px]",onClick:()=>Y(),children:Ke.jsx(jy,{style:{fontSize:"20px"}})})]})]}),Ke.jsxs(Ti,{className:"inline-flex items-center",children:[Ke.jsxs("span",{className:"mr-4",children:[" chn ",Object.keys(x).reduce((ve,we)=>ve+x[we].length,0)," khch hng"]}),Ke.jsx(oo,{type:"primary",onClick:me,children:"Thm"})]})]}),Ke.jsxs("div",{className:"py-5 px-4",children:[Ke.jsxs("span",{children:[S.length," kt qu hin th"]}),cm(C).length>0&&Ke.jsx(lo,{className:"items-center",children:cm(C).map(ve=>Ke.jsxs(Dy,{closeIcon:Ke.jsx(_g,{}),onClose:()=>{Y(ve)},children:[ve.key,": ",ve.value]}))})]}),Ke.jsx(F0,{scroll:{y:500},rowSelection:{type:"checkbox",...ie},columns:Sw,dataSource:S.map(ve=>({key:ve.customer_code,...ve})),pagination:!1}),Ke.jsx(lo,{className:"justify-end mt-2",children:Ke.jsx(Ly,{showSizeChanger:!1,defaultCurrent:h,pageSize:U,total:N,onChange:(ve,we)=>{m(ve)}})}),Ke.jsx(g0,{width:451,title:"B lc",open:L,okText:"p dng",cancelText:"t li",onCancel:z.bind(null,!1),onOk:pe,children:Ke.jsx(Ew,{filter:C,setFilter:M,form:c})})]})}/*! xlsx.js (C) 2013-present SheetJS -- http://sheetjs.com */var Og=1252,Cw=[874,932,936,949,950,1250,1251,1252,1253,1254,1255,1256,1257,1258,1e4],D0={0:1252,1:65001,2:65001,77:1e4,128:932,129:949,130:1361,134:936,136:950,161:1253,162:1254,163:1258,177:1255,178:1256,186:1257,204:1251,222:874,238:1250,255:1252,69:6969},L0=function(e){Cw.indexOf(e)!=-1&&(Og=D0[0]=e)};function Aw(){L0(1252)}var wn=function(e){L0(e)};function Bg(){wn(1200),Aw()}function hm(e){for(var n=[],i=0,c=e.length;i<c;++i)n[i]=e.charCodeAt(i);return n}function Iw(e){for(var n=[],i=0;i<e.length>>1;++i)n[i]=String.fromCharCode(e.charCodeAt(2*i)+(e.charCodeAt(2*i+1)<<8));return n.join("")}function zg(e){for(var n=[],i=0;i<e.length>>1;++i)n[i]=String.fromCharCode(e.charCodeAt(2*i+1)+(e.charCodeAt(2*i)<<8));return n.join("")}var Ac=function(e){var n=e.charCodeAt(0),i=e.charCodeAt(1);return n==255&&i==254?Iw(e.slice(2)):n==254&&i==255?zg(e.slice(2)):n==65279?e.slice(1):e},hu=function(n){return String.fromCharCode(n)},um=function(n){return String.fromCharCode(n)},Cs,Is="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function fm(e){for(var n="",i=0,c=0,h=0,m=0,x=0,o=0,S=0,b=0;b<e.length;)i=e.charCodeAt(b++),m=i>>2,c=e.charCodeAt(b++),x=(i&3)<<4|c>>4,h=e.charCodeAt(b++),o=(c&15)<<2|h>>6,S=h&63,isNaN(c)?o=S=64:isNaN(h)&&(S=64),n+=Is.charAt(m)+Is.charAt(x)+Is.charAt(o)+Is.charAt(S);return n}function Gi(e){var n="",i=0,c=0,h=0,m=0,x=0,o=0,S=0;e=e.replace(/[^\w\+\/\=]/g,"");for(var b=0;b<e.length;)m=Is.indexOf(e.charAt(b++)),x=Is.indexOf(e.charAt(b++)),i=m<<2|x>>4,n+=String.fromCharCode(i),o=Is.indexOf(e.charAt(b++)),c=(x&15)<<4|o>>2,o!==64&&(n+=String.fromCharCode(c)),S=Is.indexOf(e.charAt(b++)),h=(o&3)<<6|S,S!==64&&(n+=String.fromCharCode(h));return n}var vr=function(){return typeof Buffer<"u"&&typeof process<"u"&&typeof process.versions<"u"&&!!process.versions.node}(),go=function(){if(typeof Buffer<"u"){var e=!Buffer.from;if(!e)try{Buffer.from("foo","utf8")}catch{e=!0}return e?function(n,i){return i?new Buffer(n,i):new Buffer(n)}:Buffer.from.bind(Buffer)}return function(){}}();function Ds(e){return vr?Buffer.alloc?Buffer.alloc(e):new Buffer(e):typeof Uint8Array<"u"?new Uint8Array(e):new Array(e)}function dm(e){return vr?Buffer.allocUnsafe?Buffer.allocUnsafe(e):new Buffer(e):typeof Uint8Array<"u"?new Uint8Array(e):new Array(e)}var vn=function(n){return vr?go(n,"binary"):n.split("").map(function(i){return i.charCodeAt(0)&255})};function xo(e){if(Array.isArray(e))return e.map(function(c){return String.fromCharCode(c)}).join("");for(var n=[],i=0;i<e.length;++i)n[i]=String.fromCharCode(e[i]);return n.join("")}function R0(e){if(typeof ArrayBuffer>"u")throw new Error("Unsupported");if(e instanceof ArrayBuffer)return R0(new Uint8Array(e));for(var n=new Array(e.length),i=0;i<e.length;++i)n[i]=e[i];return n}var As=vr?function(e){return Buffer.concat(e.map(function(n){return Buffer.isBuffer(n)?n:go(n)}))}:function(e){if(typeof Uint8Array<"u"){var n=0,i=0;for(n=0;n<e.length;++n)i+=e[n].length;var c=new Uint8Array(i),h=0;for(n=0,i=0;n<e.length;i+=h,++n)if(h=e[n].length,e[n]instanceof Uint8Array)c.set(e[n],i);else{if(typeof e[n]=="string")throw"wtf";c.set(new Uint8Array(e[n]),i)}return c}return[].concat.apply([],e.map(function(m){return Array.isArray(m)?m:[].slice.call(m)}))};function Fw(e){for(var n=[],i=0,c=e.length+250,h=Ds(e.length+255),m=0;m<e.length;++m){var x=e.charCodeAt(m);if(x<128)h[i++]=x;else if(x<2048)h[i++]=192|x>>6&31,h[i++]=128|x&63;else if(x>=55296&&x<57344){x=(x&1023)+64;var o=e.charCodeAt(++m)&1023;h[i++]=240|x>>8&7,h[i++]=128|x>>2&63,h[i++]=128|o>>6&15|(x&3)<<4,h[i++]=128|o&63}else h[i++]=224|x>>12&15,h[i++]=128|x>>6&63,h[i++]=128|x&63;i>c&&(n.push(h.slice(0,i)),i=0,h=Ds(65535),c=65530)}return n.push(h.slice(0,i)),As(n)}var ki=/\u0000/g,Ic=/[\u0001-\u0006]/g;function hl(e){for(var n="",i=e.length-1;i>=0;)n+=e.charAt(i--);return n}function bn(e,n){var i=""+e;return i.length>=n?i:ca("0",n-i.length)+i}function O0(e,n){var i=""+e;return i.length>=n?i:ca(" ",n-i.length)+i}function Su(e,n){var i=""+e;return i.length>=n?i:i+ca(" ",n-i.length)}function Pw(e,n){var i=""+Math.round(e);return i.length>=n?i:ca("0",n-i.length)+i}function Mw(e,n){var i=""+e;return i.length>=n?i:ca("0",n-i.length)+i}var pm=Math.pow(2,32);function sl(e,n){if(e>pm||e<-pm)return Pw(e,n);var i=Math.round(e);return Mw(i,n)}function ku(e,n){return n=n||0,e.length>=7+n&&(e.charCodeAt(n)|32)===103&&(e.charCodeAt(n+1)|32)===101&&(e.charCodeAt(n+2)|32)===110&&(e.charCodeAt(n+3)|32)===101&&(e.charCodeAt(n+4)|32)===114&&(e.charCodeAt(n+5)|32)===97&&(e.charCodeAt(n+6)|32)===108}var mm=[["Sun","Sunday"],["Mon","Monday"],["Tue","Tuesday"],["Wed","Wednesday"],["Thu","Thursday"],["Fri","Friday"],["Sat","Saturday"]],r0=[["J","Jan","January"],["F","Feb","February"],["M","Mar","March"],["A","Apr","April"],["M","May","May"],["J","Jun","June"],["J","Jul","July"],["A","Aug","August"],["S","Sep","September"],["O","Oct","October"],["N","Nov","November"],["D","Dec","December"]];function Dw(e){return e||(e={}),e[0]="General",e[1]="0",e[2]="0.00",e[3]="#,##0",e[4]="#,##0.00",e[9]="0%",e[10]="0.00%",e[11]="0.00E+00",e[12]="# ?/?",e[13]="# ??/??",e[14]="m/d/yy",e[15]="d-mmm-yy",e[16]="d-mmm",e[17]="mmm-yy",e[18]="h:mm AM/PM",e[19]="h:mm:ss AM/PM",e[20]="h:mm",e[21]="h:mm:ss",e[22]="m/d/yy h:mm",e[37]="#,##0 ;(#,##0)",e[38]="#,##0 ;[Red](#,##0)",e[39]="#,##0.00;(#,##0.00)",e[40]="#,##0.00;[Red](#,##0.00)",e[45]="mm:ss",e[46]="[h]:mm:ss",e[47]="mmss.0",e[48]="##0.0E+0",e[49]="@",e[56]='"/ "hh""mm""ss" "',e}var hr={0:"General",1:"0",2:"0.00",3:"#,##0",4:"#,##0.00",9:"0%",10:"0.00%",11:"0.00E+00",12:"# ?/?",13:"# ??/??",14:"m/d/yy",15:"d-mmm-yy",16:"d-mmm",17:"mmm-yy",18:"h:mm AM/PM",19:"h:mm:ss AM/PM",20:"h:mm",21:"h:mm:ss",22:"m/d/yy h:mm",37:"#,##0 ;(#,##0)",38:"#,##0 ;[Red](#,##0)",39:"#,##0.00;(#,##0.00)",40:"#,##0.00;[Red](#,##0.00)",45:"mm:ss",46:"[h]:mm:ss",47:"mmss.0",48:"##0.0E+0",49:"@",56:'"/ "hh""mm""ss" "'},gm={5:37,6:38,7:39,8:40,23:0,24:0,25:0,26:0,27:14,28:14,29:14,30:14,31:14,50:14,51:14,52:14,53:14,54:14,55:14,56:14,57:14,58:14,59:1,60:2,61:3,62:4,67:9,68:10,69:12,70:13,71:14,72:14,73:15,74:16,75:17,76:20,77:21,78:22,79:45,80:46,81:47,82:0},Lw={5:'"$"#,##0_);\\("$"#,##0\\)',63:'"$"#,##0_);\\("$"#,##0\\)',6:'"$"#,##0_);[Red]\\("$"#,##0\\)',64:'"$"#,##0_);[Red]\\("$"#,##0\\)',7:'"$"#,##0.00_);\\("$"#,##0.00\\)',65:'"$"#,##0.00_);\\("$"#,##0.00\\)',8:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',66:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',41:'_(* #,##0_);_(* \\(#,##0\\);_(* "-"_);_(@_)',42:'_("$"* #,##0_);_("$"* \\(#,##0\\);_("$"* "-"_);_(@_)',43:'_(* #,##0.00_);_(* \\(#,##0.00\\);_(* "-"??_);_(@_)',44:'_("$"* #,##0.00_);_("$"* \\(#,##0.00\\);_("$"* "-"??_);_(@_)'};function Cu(e,n,i){for(var c=e<0?-1:1,h=e*c,m=0,x=1,o=0,S=1,b=0,C=0,M=Math.floor(h);b<n&&(M=Math.floor(h),o=M*x+m,C=M*b+S,!(h-M<5e-8));)h=1/(h-M),m=x,x=o,S=b,b=C;if(C>n&&(b>n?(C=S,o=m):(C=b,o=x)),!i)return[0,c*o,C];var L=Math.floor(c*o/C);return[L,c*o-L*C,C]}function no(e,n,i){if(e>2958465||e<0)return null;var c=e|0,h=Math.floor(86400*(e-c)),m=0,x=[],o={D:c,T:h,u:86400*(e-c)-h,y:0,m:0,d:0,H:0,M:0,S:0,q:0};if(Math.abs(o.u)<1e-6&&(o.u=0),n&&n.date1904&&(c+=1462),o.u>.9999&&(o.u=0,++h==86400&&(o.T=h=0,++c,++o.D)),c===60)x=i?[1317,10,29]:[1900,2,29],m=3;else if(c===0)x=i?[1317,8,29]:[1900,1,0],m=6;else{c>60&&--c;var S=new Date(1900,0,1);S.setDate(S.getDate()+c-1),x=[S.getFullYear(),S.getMonth()+1,S.getDate()],m=S.getDay(),c<60&&(m=(m+6)%7),i&&(m=Uw(S,x))}return o.y=x[0],o.m=x[1],o.d=x[2],o.S=h%60,h=Math.floor(h/60),o.M=h%60,h=Math.floor(h/60),o.H=h,o.q=m,o}var Ng=new Date(1899,11,31,0,0,0),Rw=Ng.getTime(),Ow=new Date(1900,2,1,0,0,0);function Ug(e,n){var i=e.getTime();return n?i-=1461*24*60*60*1e3:e>=Ow&&(i+=24*60*60*1e3),(i-(Rw+(e.getTimezoneOffset()-Ng.getTimezoneOffset())*6e4))/(24*60*60*1e3)}function B0(e){return e.indexOf(".")==-1?e:e.replace(/(?:\.0*|(\.\d*[1-9])0+)$/,"$1")}function Bw(e){return e.indexOf("E")==-1?e:e.replace(/(?:\.0*|(\.\d*[1-9])0+)[Ee]/,"$1E").replace(/(E[+-])(\d)$/,"$10$2")}function zw(e){var n=e<0?12:11,i=B0(e.toFixed(12));return i.length<=n||(i=e.toPrecision(10),i.length<=n)?i:e.toExponential(5)}function Nw(e){var n=B0(e.toFixed(11));return n.length>(e<0?12:11)||n==="0"||n==="-0"?e.toPrecision(6):n}function Vc(e){var n=Math.floor(Math.log(Math.abs(e))*Math.LOG10E),i;return n>=-4&&n<=-1?i=e.toPrecision(10+n):Math.abs(n)<=9?i=zw(e):n===10?i=e.toFixed(10).substr(0,12):i=Nw(e),B0(Bw(i.toUpperCase()))}function uo(e,n){switch(typeof e){case"string":return e;case"boolean":return e?"TRUE":"FALSE";case"number":return(e|0)===e?e.toString(10):Vc(e);case"undefined":return"";case"object":if(e==null)return"";if(e instanceof Date)return nn(14,Ug(e,n&&n.date1904),n)}throw new Error("unsupported value in General format: "+e)}function Uw(e,n){n[0]-=581;var i=e.getDay();return e<60&&(i=(i+6)%7),i}function Vw(e,n,i,c){var h="",m=0,x=0,o=i.y,S,b=0;switch(e){case 98:o=i.y+543;case 121:switch(n.length){case 1:case 2:S=o%100,b=2;break;default:S=o%1e4,b=4;break}break;case 109:switch(n.length){case 1:case 2:S=i.m,b=n.length;break;case 3:return r0[i.m-1][1];case 5:return r0[i.m-1][0];default:return r0[i.m-1][2]}break;case 100:switch(n.length){case 1:case 2:S=i.d,b=n.length;break;case 3:return mm[i.q][0];default:return mm[i.q][1]}break;case 104:switch(n.length){case 1:case 2:S=1+(i.H+11)%12,b=n.length;break;default:throw"bad hour format: "+n}break;case 72:switch(n.length){case 1:case 2:S=i.H,b=n.length;break;default:throw"bad hour format: "+n}break;case 77:switch(n.length){case 1:case 2:S=i.M,b=n.length;break;default:throw"bad minute format: "+n}break;case 115:if(n!="s"&&n!="ss"&&n!=".0"&&n!=".00"&&n!=".000")throw"bad second format: "+n;return i.u===0&&(n=="s"||n=="ss")?bn(i.S,n.length):(c>=2?x=c===3?1e3:100:x=c===1?10:1,m=Math.round(x*(i.S+i.u)),m>=60*x&&(m=0),n==="s"?m===0?"0":""+m/x:(h=bn(m,2+c),n==="ss"?h.substr(0,2):"."+h.substr(2,n.length-1)));case 90:switch(n){case"[h]":case"[hh]":S=i.D*24+i.H;break;case"[m]":case"[mm]":S=(i.D*24+i.H)*60+i.M;break;case"[s]":case"[ss]":S=((i.D*24+i.H)*60+i.M)*60+Math.round(i.S+i.u);break;default:throw"bad abstime format: "+n}b=n.length===3?1:2;break;case 101:S=o,b=1;break}var C=b>0?bn(S,b):"";return C}function Fs(e){var n=3;if(e.length<=n)return e;for(var i=e.length%n,c=e.substr(0,i);i!=e.length;i+=n)c+=(c.length>0?",":"")+e.substr(i,n);return c}var Vg=/%/g;function $w(e,n,i){var c=n.replace(Vg,""),h=n.length-c.length;return as(e,c,i*Math.pow(10,2*h))+ca("%",h)}function jw(e,n,i){for(var c=n.length-1;n.charCodeAt(c-1)===44;)--c;return as(e,n.substr(0,c),i/Math.pow(10,3*(n.length-c)))}function $g(e,n){var i,c=e.indexOf("E")-e.indexOf(".")-1;if(e.match(/^#+0.0E\+0$/)){if(n==0)return"0.0E+0";if(n<0)return"-"+$g(e,-n);var h=e.indexOf(".");h===-1&&(h=e.indexOf("E"));var m=Math.floor(Math.log(n)*Math.LOG10E)%h;if(m<0&&(m+=h),i=(n/Math.pow(10,m)).toPrecision(c+1+(h+m)%h),i.indexOf("e")===-1){var x=Math.floor(Math.log(n)*Math.LOG10E);for(i.indexOf(".")===-1?i=i.charAt(0)+"."+i.substr(1)+"E+"+(x-i.length+m):i+="E+"+(x-m);i.substr(0,2)==="0.";)i=i.charAt(0)+i.substr(2,h)+"."+i.substr(2+h),i=i.replace(/^0+([1-9])/,"$1").replace(/^0+\./,"0.");i=i.replace(/\+-/,"-")}i=i.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(o,S,b,C){return S+b+C.substr(0,(h+m)%h)+"."+C.substr(m)+"E"})}else i=n.toExponential(c);return e.match(/E\+00$/)&&i.match(/e[+-]\d$/)&&(i=i.substr(0,i.length-1)+"0"+i.charAt(i.length-1)),e.match(/E\-/)&&i.match(/e\+/)&&(i=i.replace(/e\+/,"e")),i.replace("e","E")}var jg=/# (\?+)( ?)\/( ?)(\d+)/;function Gw(e,n,i){var c=parseInt(e[4],10),h=Math.round(n*c),m=Math.floor(h/c),x=h-m*c,o=c;return i+(m===0?"":""+m)+" "+(x===0?ca(" ",e[1].length+1+e[4].length):O0(x,e[1].length)+e[2]+"/"+e[3]+bn(o,e[4].length))}function Hw(e,n,i){return i+(n===0?"":""+n)+ca(" ",e[1].length+2+e[4].length)}var Gg=/^#*0*\.([0#]+)/,Hg=/\).*[0#]/,qg=/\(###\) ###\\?-####/;function bi(e){for(var n="",i,c=0;c!=e.length;++c)switch(i=e.charCodeAt(c)){case 35:break;case 63:n+=" ";break;case 48:n+="0";break;default:n+=String.fromCharCode(i)}return n}function xm(e,n){var i=Math.pow(10,n);return""+Math.round(e*i)/i}function _m(e,n){var i=e-Math.floor(e),c=Math.pow(10,n);return n<(""+Math.round(i*c)).length?0:Math.round(i*c)}function qw(e,n){return n<(""+Math.round((e-Math.floor(e))*Math.pow(10,n))).length?1:0}function Ww(e){return e<2147483647&&e>-2147483648?""+(e>=0?e|0:e-1|0):""+Math.floor(e)}function tn(e,n,i){if(e.charCodeAt(0)===40&&!n.match(Hg)){var c=n.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return i>=0?tn("n",c,i):"("+tn("n",c,-i)+")"}if(n.charCodeAt(n.length-1)===44)return jw(e,n,i);if(n.indexOf("%")!==-1)return $w(e,n,i);if(n.indexOf("E")!==-1)return $g(n,i);if(n.charCodeAt(0)===36)return"$"+tn(e,n.substr(n.charAt(1)==" "?2:1),i);var h,m,x,o,S=Math.abs(i),b=i<0?"-":"";if(n.match(/^00+$/))return b+sl(S,n.length);if(n.match(/^[#?]+$/))return h=sl(i,0),h==="0"&&(h=""),h.length>n.length?h:bi(n.substr(0,n.length-h.length))+h;if(m=n.match(jg))return Gw(m,S,b);if(n.match(/^#+0+$/))return b+sl(S,n.length-n.indexOf("0"));if(m=n.match(Gg))return h=xm(i,m[1].length).replace(/^([^\.]+)$/,"$1."+bi(m[1])).replace(/\.$/,"."+bi(m[1])).replace(/\.(\d*)$/,function(U,N){return"."+N+ca("0",bi(m[1]).length-N.length)}),n.indexOf("0.")!==-1?h:h.replace(/^0\./,".");if(n=n.replace(/^#+([0.])/,"$1"),m=n.match(/^(0*)\.(#*)$/))return b+xm(S,m[2].length).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,m[1].length?"0.":".");if(m=n.match(/^#{1,3},##0(\.?)$/))return b+Fs(sl(S,0));if(m=n.match(/^#,##0\.([#0]*0)$/))return i<0?"-"+tn(e,n,-i):Fs(""+(Math.floor(i)+qw(i,m[1].length)))+"."+bn(_m(i,m[1].length),m[1].length);if(m=n.match(/^#,#*,#0/))return tn(e,n.replace(/^#,#*,/,""),i);if(m=n.match(/^([0#]+)(\\?-([0#]+))+$/))return h=hl(tn(e,n.replace(/[\\-]/g,""),i)),x=0,hl(hl(n.replace(/\\/g,"")).replace(/[0#]/g,function(U){return x<h.length?h.charAt(x++):U==="0"?"0":""}));if(n.match(qg))return h=tn(e,"##########",i),"("+h.substr(0,3)+") "+h.substr(3,3)+"-"+h.substr(6);var C="";if(m=n.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return x=Math.min(m[4].length,7),o=Cu(S,Math.pow(10,x)-1,!1),h=""+b,C=as("n",m[1],o[1]),C.charAt(C.length-1)==" "&&(C=C.substr(0,C.length-1)+"0"),h+=C+m[2]+"/"+m[3],C=Su(o[2],x),C.length<m[4].length&&(C=bi(m[4].substr(m[4].length-C.length))+C),h+=C,h;if(m=n.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return x=Math.min(Math.max(m[1].length,m[4].length),7),o=Cu(S,Math.pow(10,x)-1,!0),b+(o[0]||(o[1]?"":"0"))+" "+(o[1]?O0(o[1],x)+m[2]+"/"+m[3]+Su(o[2],x):ca(" ",2*x+1+m[2].length+m[3].length));if(m=n.match(/^[#0?]+$/))return h=sl(i,0),n.length<=h.length?h:bi(n.substr(0,n.length-h.length))+h;if(m=n.match(/^([#0?]+)\.([#0]+)$/)){h=""+i.toFixed(Math.min(m[2].length,10)).replace(/([^0])0+$/,"$1"),x=h.indexOf(".");var M=n.indexOf(".")-x,L=n.length-h.length-M;return bi(n.substr(0,M)+h+n.substr(n.length-L))}if(m=n.match(/^00,000\.([#0]*0)$/))return x=_m(i,m[1].length),i<0?"-"+tn(e,n,-i):Fs(Ww(i)).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(U){return"00,"+(U.length<3?bn(0,3-U.length):"")+U})+"."+bn(x,m[1].length);switch(n){case"###,##0.00":return tn(e,"#,##0.00",i);case"###,###":case"##,###":case"#,###":var z=Fs(sl(S,0));return z!=="0"?b+z:"";case"###,###.00":return tn(e,"###,##0.00",i).replace(/^0\./,".");case"#,###.00":return tn(e,"#,##0.00",i).replace(/^0\./,".")}throw new Error("unsupported format |"+n+"|")}function Zw(e,n,i){for(var c=n.length-1;n.charCodeAt(c-1)===44;)--c;return as(e,n.substr(0,c),i/Math.pow(10,3*(n.length-c)))}function Xw(e,n,i){var c=n.replace(Vg,""),h=n.length-c.length;return as(e,c,i*Math.pow(10,2*h))+ca("%",h)}function Wg(e,n){var i,c=e.indexOf("E")-e.indexOf(".")-1;if(e.match(/^#+0.0E\+0$/)){if(n==0)return"0.0E+0";if(n<0)return"-"+Wg(e,-n);var h=e.indexOf(".");h===-1&&(h=e.indexOf("E"));var m=Math.floor(Math.log(n)*Math.LOG10E)%h;if(m<0&&(m+=h),i=(n/Math.pow(10,m)).toPrecision(c+1+(h+m)%h),!i.match(/[Ee]/)){var x=Math.floor(Math.log(n)*Math.LOG10E);i.indexOf(".")===-1?i=i.charAt(0)+"."+i.substr(1)+"E+"+(x-i.length+m):i+="E+"+(x-m),i=i.replace(/\+-/,"-")}i=i.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(o,S,b,C){return S+b+C.substr(0,(h+m)%h)+"."+C.substr(m)+"E"})}else i=n.toExponential(c);return e.match(/E\+00$/)&&i.match(/e[+-]\d$/)&&(i=i.substr(0,i.length-1)+"0"+i.charAt(i.length-1)),e.match(/E\-/)&&i.match(/e\+/)&&(i=i.replace(/e\+/,"e")),i.replace("e","E")}function Ln(e,n,i){if(e.charCodeAt(0)===40&&!n.match(Hg)){var c=n.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return i>=0?Ln("n",c,i):"("+Ln("n",c,-i)+")"}if(n.charCodeAt(n.length-1)===44)return Zw(e,n,i);if(n.indexOf("%")!==-1)return Xw(e,n,i);if(n.indexOf("E")!==-1)return Wg(n,i);if(n.charCodeAt(0)===36)return"$"+Ln(e,n.substr(n.charAt(1)==" "?2:1),i);var h,m,x,o,S=Math.abs(i),b=i<0?"-":"";if(n.match(/^00+$/))return b+bn(S,n.length);if(n.match(/^[#?]+$/))return h=""+i,i===0&&(h=""),h.length>n.length?h:bi(n.substr(0,n.length-h.length))+h;if(m=n.match(jg))return Hw(m,S,b);if(n.match(/^#+0+$/))return b+bn(S,n.length-n.indexOf("0"));if(m=n.match(Gg))return h=(""+i).replace(/^([^\.]+)$/,"$1."+bi(m[1])).replace(/\.$/,"."+bi(m[1])),h=h.replace(/\.(\d*)$/,function(U,N){return"."+N+ca("0",bi(m[1]).length-N.length)}),n.indexOf("0.")!==-1?h:h.replace(/^0\./,".");if(n=n.replace(/^#+([0.])/,"$1"),m=n.match(/^(0*)\.(#*)$/))return b+(""+S).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,m[1].length?"0.":".");if(m=n.match(/^#{1,3},##0(\.?)$/))return b+Fs(""+S);if(m=n.match(/^#,##0\.([#0]*0)$/))return i<0?"-"+Ln(e,n,-i):Fs(""+i)+"."+ca("0",m[1].length);if(m=n.match(/^#,#*,#0/))return Ln(e,n.replace(/^#,#*,/,""),i);if(m=n.match(/^([0#]+)(\\?-([0#]+))+$/))return h=hl(Ln(e,n.replace(/[\\-]/g,""),i)),x=0,hl(hl(n.replace(/\\/g,"")).replace(/[0#]/g,function(U){return x<h.length?h.charAt(x++):U==="0"?"0":""}));if(n.match(qg))return h=Ln(e,"##########",i),"("+h.substr(0,3)+") "+h.substr(3,3)+"-"+h.substr(6);var C="";if(m=n.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return x=Math.min(m[4].length,7),o=Cu(S,Math.pow(10,x)-1,!1),h=""+b,C=as("n",m[1],o[1]),C.charAt(C.length-1)==" "&&(C=C.substr(0,C.length-1)+"0"),h+=C+m[2]+"/"+m[3],C=Su(o[2],x),C.length<m[4].length&&(C=bi(m[4].substr(m[4].length-C.length))+C),h+=C,h;if(m=n.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return x=Math.min(Math.max(m[1].length,m[4].length),7),o=Cu(S,Math.pow(10,x)-1,!0),b+(o[0]||(o[1]?"":"0"))+" "+(o[1]?O0(o[1],x)+m[2]+"/"+m[3]+Su(o[2],x):ca(" ",2*x+1+m[2].length+m[3].length));if(m=n.match(/^[#0?]+$/))return h=""+i,n.length<=h.length?h:bi(n.substr(0,n.length-h.length))+h;if(m=n.match(/^([#0]+)\.([#0]+)$/)){h=""+i.toFixed(Math.min(m[2].length,10)).replace(/([^0])0+$/,"$1"),x=h.indexOf(".");var M=n.indexOf(".")-x,L=n.length-h.length-M;return bi(n.substr(0,M)+h+n.substr(n.length-L))}if(m=n.match(/^00,000\.([#0]*0)$/))return i<0?"-"+Ln(e,n,-i):Fs(""+i).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(U){return"00,"+(U.length<3?bn(0,3-U.length):"")+U})+"."+bn(0,m[1].length);switch(n){case"###,###":case"##,###":case"#,###":var z=Fs(""+S);return z!=="0"?b+z:"";default:if(n.match(/\.[0#?]*$/))return Ln(e,n.slice(0,n.lastIndexOf(".")),i)+bi(n.slice(n.lastIndexOf(".")))}throw new Error("unsupported format |"+n+"|")}function as(e,n,i){return(i|0)===i?Ln(e,n,i):tn(e,n,i)}function Kw(e){for(var n=[],i=!1,c=0,h=0;c<e.length;++c)switch(e.charCodeAt(c)){case 34:i=!i;break;case 95:case 42:case 92:++c;break;case 59:n[n.length]=e.substr(h,c-h),h=c+1}if(n[n.length]=e.substr(h),i===!0)throw new Error("Format |"+e+"| unterminated string ");return n}var Zg=/\[[HhMmSs\u0E0A\u0E19\u0E17]*\]/;function _l(e){for(var n=0,i="",c="";n<e.length;)switch(i=e.charAt(n)){case"G":ku(e,n)&&(n+=6),n++;break;case'"':for(;e.charCodeAt(++n)!==34&&n<e.length;);++n;break;case"\\":n+=2;break;case"_":n+=2;break;case"@":++n;break;case"B":case"b":if(e.charAt(n+1)==="1"||e.charAt(n+1)==="2")return!0;case"M":case"D":case"Y":case"H":case"S":case"E":case"m":case"d":case"y":case"h":case"s":case"e":case"g":return!0;case"A":case"a":case"":if(e.substr(n,3).toUpperCase()==="A/P"||e.substr(n,5).toUpperCase()==="AM/PM"||e.substr(n,5).toUpperCase()==="/")return!0;++n;break;case"[":for(c=i;e.charAt(n++)!=="]"&&n<e.length;)c+=e.charAt(n);if(c.match(Zg))return!0;break;case".":case"0":case"#":for(;n<e.length&&("0#?.,E+-%".indexOf(i=e.charAt(++n))>-1||i=="\\"&&e.charAt(n+1)=="-"&&"0#".indexOf(e.charAt(n+2))>-1););break;case"?":for(;e.charAt(++n)===i;);break;case"*":++n,(e.charAt(n)==" "||e.charAt(n)=="*")&&++n;break;case"(":case")":++n;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(;n<e.length&&"0123456789".indexOf(e.charAt(++n))>-1;);break;case" ":++n;break;default:++n;break}return!1}function Yw(e,n,i,c){for(var h=[],m="",x=0,o="",S="t",b,C,M,L="H";x<e.length;)switch(o=e.charAt(x)){case"G":if(!ku(e,x))throw new Error("unrecognized character "+o+" in "+e);h[h.length]={t:"G",v:"General"},x+=7;break;case'"':for(m="";(M=e.charCodeAt(++x))!==34&&x<e.length;)m+=String.fromCharCode(M);h[h.length]={t:"t",v:m},++x;break;case"\\":var z=e.charAt(++x),U=z==="("||z===")"?z:"t";h[h.length]={t:U,v:z},++x;break;case"_":h[h.length]={t:"t",v:" "},x+=2;break;case"@":h[h.length]={t:"T",v:n},++x;break;case"B":case"b":if(e.charAt(x+1)==="1"||e.charAt(x+1)==="2"){if(b==null&&(b=no(n,i,e.charAt(x+1)==="2"),b==null))return"";h[h.length]={t:"X",v:e.substr(x,2)},S=o,x+=2;break}case"M":case"D":case"Y":case"H":case"S":case"E":o=o.toLowerCase();case"m":case"d":case"y":case"h":case"s":case"e":case"g":if(n<0||b==null&&(b=no(n,i),b==null))return"";for(m=o;++x<e.length&&e.charAt(x).toLowerCase()===o;)m+=o;o==="m"&&S.toLowerCase()==="h"&&(o="M"),o==="h"&&(o=L),h[h.length]={t:o,v:m},S=o;break;case"A":case"a":case"":var N={t:o,v:o};if(b==null&&(b=no(n,i)),e.substr(x,3).toUpperCase()==="A/P"?(b!=null&&(N.v=b.H>=12?"P":"A"),N.t="T",L="h",x+=3):e.substr(x,5).toUpperCase()==="AM/PM"?(b!=null&&(N.v=b.H>=12?"PM":"AM"),N.t="T",x+=5,L="h"):e.substr(x,5).toUpperCase()==="/"?(b!=null&&(N.v=b.H>=12?"":""),N.t="T",x+=5,L="h"):(N.t="t",++x),b==null&&N.t==="T")return"";h[h.length]=N,S=o;break;case"[":for(m=o;e.charAt(x++)!=="]"&&x<e.length;)m+=e.charAt(x);if(m.slice(-1)!=="]")throw'unterminated "[" block: |'+m+"|";if(m.match(Zg)){if(b==null&&(b=no(n,i),b==null))return"";h[h.length]={t:"Z",v:m.toLowerCase()},S=m.charAt(1)}else m.indexOf("$")>-1&&(m=(m.match(/\$([^-\[\]]*)/)||[])[1]||"$",_l(e)||(h[h.length]={t:"t",v:m}));break;case".":if(b!=null){for(m=o;++x<e.length&&(o=e.charAt(x))==="0";)m+=o;h[h.length]={t:"s",v:m};break}case"0":case"#":for(m=o;++x<e.length&&"0#?.,E+-%".indexOf(o=e.charAt(x))>-1;)m+=o;h[h.length]={t:"n",v:m};break;case"?":for(m=o;e.charAt(++x)===o;)m+=o;h[h.length]={t:o,v:m},S=o;break;case"*":++x,(e.charAt(x)==" "||e.charAt(x)=="*")&&++x;break;case"(":case")":h[h.length]={t:c===1?"t":o,v:o},++x;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(m=o;x<e.length&&"0123456789".indexOf(e.charAt(++x))>-1;)m+=e.charAt(x);h[h.length]={t:"D",v:m};break;case" ":h[h.length]={t:o,v:o},++x;break;case"$":h[h.length]={t:"t",v:"$"},++x;break;default:if(",$-+/():!^&'~{}<>=acfijklopqrtuvwxzP".indexOf(o)===-1)throw new Error("unrecognized character "+o+" in "+e);h[h.length]={t:"t",v:o},++x;break}var G=0,ie=0,pe;for(x=h.length-1,S="t";x>=0;--x)switch(h[x].t){case"h":case"H":h[x].t=L,S="h",G<1&&(G=1);break;case"s":(pe=h[x].v.match(/\.0+$/))&&(ie=Math.max(ie,pe[0].length-1)),G<3&&(G=3);case"d":case"y":case"M":case"e":S=h[x].t;break;case"m":S==="s"&&(h[x].t="M",G<2&&(G=2));break;case"X":break;case"Z":G<1&&h[x].v.match(/[Hh]/)&&(G=1),G<2&&h[x].v.match(/[Mm]/)&&(G=2),G<3&&h[x].v.match(/[Ss]/)&&(G=3)}switch(G){case 0:break;case 1:b.u>=.5&&(b.u=0,++b.S),b.S>=60&&(b.S=0,++b.M),b.M>=60&&(b.M=0,++b.H);break;case 2:b.u>=.5&&(b.u=0,++b.S),b.S>=60&&(b.S=0,++b.M);break}var Y="",me;for(x=0;x<h.length;++x)switch(h[x].t){case"t":case"T":case" ":case"D":break;case"X":h[x].v="",h[x].t=";";break;case"d":case"m":case"y":case"h":case"H":case"M":case"s":case"e":case"b":case"Z":h[x].v=Vw(h[x].t.charCodeAt(0),h[x].v,b,ie),h[x].t="t";break;case"n":case"?":for(me=x+1;h[me]!=null&&((o=h[me].t)==="?"||o==="D"||(o===" "||o==="t")&&h[me+1]!=null&&(h[me+1].t==="?"||h[me+1].t==="t"&&h[me+1].v==="/")||h[x].t==="("&&(o===" "||o==="n"||o===")")||o==="t"&&(h[me].v==="/"||h[me].v===" "&&h[me+1]!=null&&h[me+1].t=="?"));)h[x].v+=h[me].v,h[me]={v:"",t:";"},++me;Y+=h[x].v,x=me-1;break;case"G":h[x].t="t",h[x].v=uo(n,i);break}var ve="",we,te;if(Y.length>0){Y.charCodeAt(0)==40?(we=n<0&&Y.charCodeAt(0)===45?-n:n,te=as("n",Y,we)):(we=n<0&&c>1?-n:n,te=as("n",Y,we),we<0&&h[0]&&h[0].t=="t"&&(te=te.substr(1),h[0].v="-"+h[0].v)),me=te.length-1;var Be=h.length;for(x=0;x<h.length;++x)if(h[x]!=null&&h[x].t!="t"&&h[x].v.indexOf(".")>-1){Be=x;break}var Ce=h.length;if(Be===h.length&&te.indexOf("E")===-1){for(x=h.length-1;x>=0;--x)h[x]==null||"n?".indexOf(h[x].t)===-1||(me>=h[x].v.length-1?(me-=h[x].v.length,h[x].v=te.substr(me+1,h[x].v.length)):me<0?h[x].v="":(h[x].v=te.substr(0,me+1),me=-1),h[x].t="t",Ce=x);me>=0&&Ce<h.length&&(h[Ce].v=te.substr(0,me+1)+h[Ce].v)}else if(Be!==h.length&&te.indexOf("E")===-1){for(me=te.indexOf(".")-1,x=Be;x>=0;--x)if(!(h[x]==null||"n?".indexOf(h[x].t)===-1)){for(C=h[x].v.indexOf(".")>-1&&x===Be?h[x].v.indexOf(".")-1:h[x].v.length-1,ve=h[x].v.substr(C+1);C>=0;--C)me>=0&&(h[x].v.charAt(C)==="0"||h[x].v.charAt(C)==="#")&&(ve=te.charAt(me--)+ve);h[x].v=ve,h[x].t="t",Ce=x}for(me>=0&&Ce<h.length&&(h[Ce].v=te.substr(0,me+1)+h[Ce].v),me=te.indexOf(".")+1,x=Be;x<h.length;++x)if(!(h[x]==null||"n?(".indexOf(h[x].t)===-1&&x!==Be)){for(C=h[x].v.indexOf(".")>-1&&x===Be?h[x].v.indexOf(".")+1:0,ve=h[x].v.substr(0,C);C<h[x].v.length;++C)me<te.length&&(ve+=te.charAt(me++));h[x].v=ve,h[x].t="t",Ce=x}}}for(x=0;x<h.length;++x)h[x]!=null&&"n?".indexOf(h[x].t)>-1&&(we=c>1&&n<0&&x>0&&h[x-1].v==="-"?-n:n,h[x].v=as(h[x].t,h[x].v,we),h[x].t="t");var Ue="";for(x=0;x!==h.length;++x)h[x]!=null&&(Ue+=h[x].v);return Ue}var ym=/\[(=|>[=]?|<[>=]?)(-?\d+(?:\.\d*)?)\]/;function vm(e,n){if(n==null)return!1;var i=parseFloat(n[2]);switch(n[1]){case"=":if(e==i)return!0;break;case">":if(e>i)return!0;break;case"<":if(e<i)return!0;break;case"<>":if(e!=i)return!0;break;case">=":if(e>=i)return!0;break;case"<=":if(e<=i)return!0;break}return!1}function Jw(e,n){var i=Kw(e),c=i.length,h=i[c-1].indexOf("@");if(c<4&&h>-1&&--c,i.length>4)throw new Error("cannot find right format for |"+i.join("|")+"|");if(typeof n!="number")return[4,i.length===4||h>-1?i[i.length-1]:"@"];switch(i.length){case 1:i=h>-1?["General","General","General",i[0]]:[i[0],i[0],i[0],"@"];break;case 2:i=h>-1?[i[0],i[0],i[0],i[1]]:[i[0],i[1],i[0],"@"];break;case 3:i=h>-1?[i[0],i[1],i[0],i[2]]:[i[0],i[1],i[2],"@"];break}var m=n>0?i[0]:n<0?i[1]:i[2];if(i[0].indexOf("[")===-1&&i[1].indexOf("[")===-1)return[c,m];if(i[0].match(/\[[=<>]/)!=null||i[1].match(/\[[=<>]/)!=null){var x=i[0].match(ym),o=i[1].match(ym);return vm(n,x)?[c,i[0]]:vm(n,o)?[c,i[1]]:[c,i[x!=null&&o!=null?2:1]]}return[c,m]}function nn(e,n,i){i==null&&(i={});var c="";switch(typeof e){case"string":e=="m/d/yy"&&i.dateNF?c=i.dateNF:c=e;break;case"number":e==14&&i.dateNF?c=i.dateNF:c=(i.table!=null?i.table:hr)[e],c==null&&(c=i.table&&i.table[gm[e]]||hr[gm[e]]),c==null&&(c=Lw[e]||"General");break}if(ku(c,0))return uo(n,i);n instanceof Date&&(n=Ug(n,i.date1904));var h=Jw(c,n);if(ku(h[1]))return uo(n,i);if(n===!0)n="TRUE";else if(n===!1)n="FALSE";else if(n===""||n==null)return"";return Yw(h[1],n,i,h[0])}function co(e,n){if(typeof n!="number"){n=+n||-1;for(var i=0;i<392;++i){if(hr[i]==null){n<0&&(n=i);continue}if(hr[i]==e){n=i;break}}n<0&&(n=391)}return hr[n]=e,n}function Xg(){hr=Dw()}var Qw={5:'"$"#,##0_);\\("$"#,##0\\)',6:'"$"#,##0_);[Red]\\("$"#,##0\\)',7:'"$"#,##0.00_);\\("$"#,##0.00\\)',8:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',23:"General",24:"General",25:"General",26:"General",27:"m/d/yy",28:"m/d/yy",29:"m/d/yy",30:"m/d/yy",31:"m/d/yy",32:"h:mm:ss",33:"h:mm:ss",34:"h:mm:ss",35:"h:mm:ss",36:"m/d/yy",41:'_(* #,##0_);_(* (#,##0);_(* "-"_);_(@_)',42:'_("$"* #,##0_);_("$"* (#,##0);_("$"* "-"_);_(@_)',43:'_(* #,##0.00_);_(* (#,##0.00);_(* "-"??_);_(@_)',44:'_("$"* #,##0.00_);_("$"* (#,##0.00);_("$"* "-"??_);_(@_)',50:"m/d/yy",51:"m/d/yy",52:"m/d/yy",53:"m/d/yy",54:"m/d/yy",55:"m/d/yy",56:"m/d/yy",57:"m/d/yy",58:"m/d/yy",59:"0",60:"0.00",61:"#,##0",62:"#,##0.00",63:'"$"#,##0_);\\("$"#,##0\\)',64:'"$"#,##0_);[Red]\\("$"#,##0\\)',65:'"$"#,##0.00_);\\("$"#,##0.00\\)',66:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',67:"0%",68:"0.00%",69:"# ?/?",70:"# ??/??",71:"m/d/yy",72:"m/d/yy",73:"d-mmm-yy",74:"d-mmm",75:"mmm-yy",76:"h:mm",77:"h:mm:ss",78:"m/d/yy h:mm",79:"mm:ss",80:"[h]:mm:ss",81:"mmss.0"},Kg=/[dD]+|[mM]+|[yYeE]+|[Hh]+|[Ss]+/g;function eb(e){var n=typeof e=="number"?hr[e]:e;return n=n.replace(Kg,"(\\d+)"),new RegExp("^"+n+"$")}function tb(e,n,i){var c=-1,h=-1,m=-1,x=-1,o=-1,S=-1;(n.match(Kg)||[]).forEach(function(M,L){var z=parseInt(i[L+1],10);switch(M.toLowerCase().charAt(0)){case"y":c=z;break;case"d":m=z;break;case"h":x=z;break;case"s":S=z;break;case"m":x>=0?o=z:h=z;break}}),S>=0&&o==-1&&h>=0&&(o=h,h=-1);var b=(""+(c>=0?c:new Date().getFullYear())).slice(-4)+"-"+("00"+(h>=1?h:1)).slice(-2)+"-"+("00"+(m>=1?m:1)).slice(-2);b.length==7&&(b="0"+b),b.length==8&&(b="20"+b);var C=("00"+(x>=0?x:0)).slice(-2)+":"+("00"+(o>=0?o:0)).slice(-2)+":"+("00"+(S>=0?S:0)).slice(-2);return x==-1&&o==-1&&S==-1?b:c==-1&&h==-1&&m==-1?C:b+"T"+C}var rb=function(){var e={};e.version="1.2.0";function n(){for(var te=0,Be=new Array(256),Ce=0;Ce!=256;++Ce)te=Ce,te=te&1?-306674912^te>>>1:te>>>1,te=te&1?-306674912^te>>>1:te>>>1,te=te&1?-306674912^te>>>1:te>>>1,te=te&1?-306674912^te>>>1:te>>>1,te=te&1?-306674912^te>>>1:te>>>1,te=te&1?-306674912^te>>>1:te>>>1,te=te&1?-306674912^te>>>1:te>>>1,te=te&1?-306674912^te>>>1:te>>>1,Be[Ce]=te;return typeof Int32Array<"u"?new Int32Array(Be):Be}var i=n();function c(te){var Be=0,Ce=0,Ue=0,$e=typeof Int32Array<"u"?new Int32Array(4096):new Array(4096);for(Ue=0;Ue!=256;++Ue)$e[Ue]=te[Ue];for(Ue=0;Ue!=256;++Ue)for(Ce=te[Ue],Be=256+Ue;Be<4096;Be+=256)Ce=$e[Be]=Ce>>>8^te[Ce&255];var Re=[];for(Ue=1;Ue!=16;++Ue)Re[Ue-1]=typeof Int32Array<"u"?$e.subarray(Ue*256,Ue*256+256):$e.slice(Ue*256,Ue*256+256);return Re}var h=c(i),m=h[0],x=h[1],o=h[2],S=h[3],b=h[4],C=h[5],M=h[6],L=h[7],z=h[8],U=h[9],N=h[10],G=h[11],ie=h[12],pe=h[13],Y=h[14];function me(te,Be){for(var Ce=Be^-1,Ue=0,$e=te.length;Ue<$e;)Ce=Ce>>>8^i[(Ce^te.charCodeAt(Ue++))&255];return~Ce}function ve(te,Be){for(var Ce=Be^-1,Ue=te.length-15,$e=0;$e<Ue;)Ce=Y[te[$e++]^Ce&255]^pe[te[$e++]^Ce>>8&255]^ie[te[$e++]^Ce>>16&255]^G[te[$e++]^Ce>>>24]^N[te[$e++]]^U[te[$e++]]^z[te[$e++]]^L[te[$e++]]^M[te[$e++]]^C[te[$e++]]^b[te[$e++]]^S[te[$e++]]^o[te[$e++]]^x[te[$e++]]^m[te[$e++]]^i[te[$e++]];for(Ue+=15;$e<Ue;)Ce=Ce>>>8^i[(Ce^te[$e++])&255];return~Ce}function we(te,Be){for(var Ce=Be^-1,Ue=0,$e=te.length,Re=0,st=0;Ue<$e;)Re=te.charCodeAt(Ue++),Re<128?Ce=Ce>>>8^i[(Ce^Re)&255]:Re<2048?(Ce=Ce>>>8^i[(Ce^(192|Re>>6&31))&255],Ce=Ce>>>8^i[(Ce^(128|Re&63))&255]):Re>=55296&&Re<57344?(Re=(Re&1023)+64,st=te.charCodeAt(Ue++)&1023,Ce=Ce>>>8^i[(Ce^(240|Re>>8&7))&255],Ce=Ce>>>8^i[(Ce^(128|Re>>2&63))&255],Ce=Ce>>>8^i[(Ce^(128|st>>6&15|(Re&3)<<4))&255],Ce=Ce>>>8^i[(Ce^(128|st&63))&255]):(Ce=Ce>>>8^i[(Ce^(224|Re>>12&15))&255],Ce=Ce>>>8^i[(Ce^(128|Re>>6&63))&255],Ce=Ce>>>8^i[(Ce^(128|Re&63))&255]);return~Ce}return e.table=i,e.bstr=me,e.buf=ve,e.str=we,e}(),br=function(){var n={};n.version="1.2.1";function i(B,J){for(var K=B.split("/"),X=J.split("/"),Q=0,re=0,Ne=Math.min(K.length,X.length);Q<Ne;++Q){if(re=K[Q].length-X[Q].length)return re;if(K[Q]!=X[Q])return K[Q]<X[Q]?-1:1}return K.length-X.length}function c(B){if(B.charAt(B.length-1)=="/")return B.slice(0,-1).indexOf("/")===-1?B:c(B.slice(0,-1));var J=B.lastIndexOf("/");return J===-1?B:B.slice(0,J+1)}function h(B){if(B.charAt(B.length-1)=="/")return h(B.slice(0,-1));var J=B.lastIndexOf("/");return J===-1?B:B.slice(J+1)}function m(B,J){typeof J=="string"&&(J=new Date(J));var K=J.getHours();K=K<<6|J.getMinutes(),K=K<<5|J.getSeconds()>>>1,B.write_shift(2,K);var X=J.getFullYear()-1980;X=X<<4|J.getMonth()+1,X=X<<5|J.getDate(),B.write_shift(2,X)}function x(B){var J=B.read_shift(2)&65535,K=B.read_shift(2)&65535,X=new Date,Q=K&31;K>>>=5;var re=K&15;K>>>=4,X.setMilliseconds(0),X.setFullYear(K+1980),X.setMonth(re-1),X.setDate(Q);var Ne=J&31;J>>>=5;var Ze=J&63;return J>>>=6,X.setHours(J),X.setMinutes(Ze),X.setSeconds(Ne<<1),X}function o(B){Za(B,0);for(var J={},K=0;B.l<=B.length-4;){var X=B.read_shift(2),Q=B.read_shift(2),re=B.l+Q,Ne={};switch(X){case 21589:K=B.read_shift(1),K&1&&(Ne.mtime=B.read_shift(4)),Q>5&&(K&2&&(Ne.atime=B.read_shift(4)),K&4&&(Ne.ctime=B.read_shift(4))),Ne.mtime&&(Ne.mt=new Date(Ne.mtime*1e3));break}B.l=re,J[X]=Ne}return J}var S;function b(){return S||(S={})}function C(B,J){if(B[0]==80&&B[1]==75)return Lr(B,J);if((B[0]|32)==109&&(B[1]|32)==105)return de(B,J);if(B.length<512)throw new Error("CFB file size "+B.length+" < 512");var K=3,X=512,Q=0,re=0,Ne=0,Ze=0,Le=0,ze=[],je=B.slice(0,512);Za(je,0);var at=M(je);switch(K=at[0],K){case 3:X=512;break;case 4:X=4096;break;case 0:if(at[1]==0)return Lr(B,J);default:throw new Error("Major Version: Expected 3 or 4 saw "+K)}X!==512&&(je=B.slice(0,X),Za(je,28));var gt=B.slice(0,X);L(je,K);var St=je.read_shift(4,"i");if(K===3&&St!==0)throw new Error("# Directory Sectors: Expected 0 saw "+St);je.l+=4,Ne=je.read_shift(4,"i"),je.l+=4,je.chk("00100000","Mini Stream Cutoff Size: "),Ze=je.read_shift(4,"i"),Q=je.read_shift(4,"i"),Le=je.read_shift(4,"i"),re=je.read_shift(4,"i");for(var dt=-1,Ft=0;Ft<109&&(dt=je.read_shift(4,"i"),!(dt<0));++Ft)ze[Ft]=dt;var Wt=z(B,X);G(Le,re,Wt,X,ze);var kr=pe(Wt,Ne,ze,X);kr[Ne].name="!Directory",Q>0&&Ze!==st&&(kr[Ze].name="!MiniFAT"),kr[ze[0]].name="!FAT",kr.fat_addrs=ze,kr.ssz=X;var Rr={},Qt=[],on=[],Hi=[];Y(Ne,kr,Wt,Qt,Q,Rr,on,Ze),U(on,Hi,Qt),Qt.shift();var Xr={FileIndex:on,FullPaths:Hi};return J&&J.raw&&(Xr.raw={header:gt,sectors:Wt}),Xr}function M(B){if(B[B.l]==80&&B[B.l+1]==75)return[0,0];B.chk(pt,"Header Signature: "),B.l+=16;var J=B.read_shift(2,"u");return[B.read_shift(2,"u"),J]}function L(B,J){var K=9;switch(B.l+=2,K=B.read_shift(2)){case 9:if(J!=3)throw new Error("Sector Shift: Expected 9 saw "+K);break;case 12:if(J!=4)throw new Error("Sector Shift: Expected 12 saw "+K);break;default:throw new Error("Sector Shift: Expected 9 or 12 saw "+K)}B.chk("0600","Mini Sector Shift: "),B.chk("000000000000","Reserved: ")}function z(B,J){for(var K=Math.ceil(B.length/J)-1,X=[],Q=1;Q<K;++Q)X[Q-1]=B.slice(Q*J,(Q+1)*J);return X[K-1]=B.slice(K*J),X}function U(B,J,K){for(var X=0,Q=0,re=0,Ne=0,Ze=0,Le=K.length,ze=[],je=[];X<Le;++X)ze[X]=je[X]=X,J[X]=K[X];for(;Ze<je.length;++Ze)X=je[Ze],Q=B[X].L,re=B[X].R,Ne=B[X].C,ze[X]===X&&(Q!==-1&&ze[Q]!==Q&&(ze[X]=ze[Q]),re!==-1&&ze[re]!==re&&(ze[X]=ze[re])),Ne!==-1&&(ze[Ne]=X),Q!==-1&&X!=ze[X]&&(ze[Q]=ze[X],je.lastIndexOf(Q)<Ze&&je.push(Q)),re!==-1&&X!=ze[X]&&(ze[re]=ze[X],je.lastIndexOf(re)<Ze&&je.push(re));for(X=1;X<Le;++X)ze[X]===X&&(re!==-1&&ze[re]!==re?ze[X]=ze[re]:Q!==-1&&ze[Q]!==Q&&(ze[X]=ze[Q]));for(X=1;X<Le;++X)if(B[X].type!==0){if(Ze=X,Ze!=ze[Ze])do Ze=ze[Ze],J[X]=J[Ze]+"/"+J[X];while(Ze!==0&&ze[Ze]!==-1&&Ze!=ze[Ze]);ze[X]=-1}for(J[0]+="/",X=1;X<Le;++X)B[X].type!==2&&(J[X]+="/")}function N(B,J,K){for(var X=B.start,Q=B.size,re=[],Ne=X;K&&Q>0&&Ne>=0;)re.push(J.slice(Ne*Re,Ne*Re+Re)),Q-=Re,Ne=io(K,Ne*4);return re.length===0?Fa(0):As(re).slice(0,B.size)}function G(B,J,K,X,Q){var re=st;if(B===st){if(J!==0)throw new Error("DIFAT chain shorter than expected")}else if(B!==-1){var Ne=K[B],Ze=(X>>>2)-1;if(!Ne)return;for(var Le=0;Le<Ze&&(re=io(Ne,Le*4))!==st;++Le)Q.push(re);G(io(Ne,X-4),J-1,K,X,Q)}}function ie(B,J,K,X,Q){var re=[],Ne=[];Q||(Q=[]);var Ze=X-1,Le=0,ze=0;for(Le=J;Le>=0;){Q[Le]=!0,re[re.length]=Le,Ne.push(B[Le]);var je=K[Math.floor(Le*4/X)];if(ze=Le*4&Ze,X<4+ze)throw new Error("FAT boundary crossed: "+Le+" 4 "+X);if(!B[je])break;Le=io(B[je],ze)}return{nodes:re,data:Fm([Ne])}}function pe(B,J,K,X){var Q=B.length,re=[],Ne=[],Ze=[],Le=[],ze=X-1,je=0,at=0,gt=0,St=0;for(je=0;je<Q;++je)if(Ze=[],gt=je+J,gt>=Q&&(gt-=Q),!Ne[gt]){Le=[];var dt=[];for(at=gt;at>=0;){dt[at]=!0,Ne[at]=!0,Ze[Ze.length]=at,Le.push(B[at]);var Ft=K[Math.floor(at*4/X)];if(St=at*4&ze,X<4+St)throw new Error("FAT boundary crossed: "+at+" 4 "+X);if(!B[Ft]||(at=io(B[Ft],St),dt[at]))break}re[gt]={nodes:Ze,data:Fm([Le])}}return re}function Y(B,J,K,X,Q,re,Ne,Ze){for(var Le=0,ze=X.length?2:0,je=J[B].data,at=0,gt=0,St;at<je.length;at+=128){var dt=je.slice(at,at+128);Za(dt,64),gt=dt.read_shift(2),St=$0(dt,0,gt-ze),X.push(St);var Ft={name:St,type:dt.read_shift(1),color:dt.read_shift(1),L:dt.read_shift(4,"i"),R:dt.read_shift(4,"i"),C:dt.read_shift(4,"i"),clsid:dt.read_shift(16),state:dt.read_shift(4,"i"),start:0,size:0},Wt=dt.read_shift(2)+dt.read_shift(2)+dt.read_shift(2)+dt.read_shift(2);Wt!==0&&(Ft.ct=me(dt,dt.l-8));var kr=dt.read_shift(2)+dt.read_shift(2)+dt.read_shift(2)+dt.read_shift(2);kr!==0&&(Ft.mt=me(dt,dt.l-8)),Ft.start=dt.read_shift(4,"i"),Ft.size=dt.read_shift(4,"i"),Ft.size<0&&Ft.start<0&&(Ft.size=Ft.type=0,Ft.start=st,Ft.name=""),Ft.type===5?(Le=Ft.start,Q>0&&Le!==st&&(J[Le].name="!StreamData")):Ft.size>=4096?(Ft.storage="fat",J[Ft.start]===void 0&&(J[Ft.start]=ie(K,Ft.start,J.fat_addrs,J.ssz)),J[Ft.start].name=Ft.name,Ft.content=J[Ft.start].data.slice(0,Ft.size)):(Ft.storage="minifat",Ft.size<0?Ft.size=0:Le!==st&&Ft.start!==st&&J[Le]&&(Ft.content=N(Ft,J[Le].data,(J[Ze]||{}).data))),Ft.content&&Za(Ft.content,0),re[St]=Ft,Ne.push(Ft)}}function me(B,J){return new Date((Vi(B,J+4)/1e7*Math.pow(2,32)+Vi(B,J)/1e7-11644473600)*1e3)}function ve(B,J){return b(),C(S.readFileSync(B),J)}function we(B,J){var K=J&&J.type;switch(K||vr&&Buffer.isBuffer(B)&&(K="buffer"),K||"base64"){case"file":return ve(B,J);case"base64":return C(vn(Gi(B)),J);case"binary":return C(vn(B),J)}return C(B,J)}function te(B,J){var K=J||{},X=K.root||"Root Entry";if(B.FullPaths||(B.FullPaths=[]),B.FileIndex||(B.FileIndex=[]),B.FullPaths.length!==B.FileIndex.length)throw new Error("inconsistent CFB structure");B.FullPaths.length===0&&(B.FullPaths[0]=X+"/",B.FileIndex[0]={name:X,type:5}),K.CLSID&&(B.FileIndex[0].clsid=K.CLSID),Be(B)}function Be(B){var J="Sh33tJ5";if(!br.find(B,"/"+J)){var K=Fa(4);K[0]=55,K[1]=K[3]=50,K[2]=54,B.FileIndex.push({name:J,type:2,content:K,size:4,L:69,R:69,C:69}),B.FullPaths.push(B.FullPaths[0]+J),Ce(B)}}function Ce(B,J){te(B);for(var K=!1,X=!1,Q=B.FullPaths.length-1;Q>=0;--Q){var re=B.FileIndex[Q];switch(re.type){case 0:X?K=!0:(B.FileIndex.pop(),B.FullPaths.pop());break;case 1:case 2:case 5:X=!0,isNaN(re.R*re.L*re.C)&&(K=!0),re.R>-1&&re.L>-1&&re.R==re.L&&(K=!0);break;default:K=!0;break}}if(!(!K&&!J)){var Ne=new Date(1987,1,19),Ze=0,Le=Object.create?Object.create(null):{},ze=[];for(Q=0;Q<B.FullPaths.length;++Q)Le[B.FullPaths[Q]]=!0,B.FileIndex[Q].type!==0&&ze.push([B.FullPaths[Q],B.FileIndex[Q]]);for(Q=0;Q<ze.length;++Q){var je=c(ze[Q][0]);X=Le[je],X||(ze.push([je,{name:h(je).replace("/",""),type:1,clsid:_t,ct:Ne,mt:Ne,content:null}]),Le[je]=!0)}for(ze.sort(function(St,dt){return i(St[0],dt[0])}),B.FullPaths=[],B.FileIndex=[],Q=0;Q<ze.length;++Q)B.FullPaths[Q]=ze[Q][0],B.FileIndex[Q]=ze[Q][1];for(Q=0;Q<ze.length;++Q){var at=B.FileIndex[Q],gt=B.FullPaths[Q];if(at.name=h(gt).replace("/",""),at.L=at.R=at.C=-(at.color=1),at.size=at.content?at.content.length:0,at.start=0,at.clsid=at.clsid||_t,Q===0)at.C=ze.length>1?1:-1,at.size=0,at.type=5;else if(gt.slice(-1)=="/"){for(Ze=Q+1;Ze<ze.length&&c(B.FullPaths[Ze])!=gt;++Ze);for(at.C=Ze>=ze.length?-1:Ze,Ze=Q+1;Ze<ze.length&&c(B.FullPaths[Ze])!=c(gt);++Ze);at.R=Ze>=ze.length?-1:Ze,at.type=1}else c(B.FullPaths[Q+1]||"")==c(gt)&&(at.R=Q+1),at.type=2}}}function Ue(B,J){var K=J||{};if(K.fileType=="mad")return De(B,K);switch(Ce(B),K.fileType){case"zip":return Kt(B,K)}var X=function(St){for(var dt=0,Ft=0,Wt=0;Wt<St.FileIndex.length;++Wt){var kr=St.FileIndex[Wt];if(kr.content){var Rr=kr.content.length;Rr>0&&(Rr<4096?dt+=Rr+63>>6:Ft+=Rr+511>>9)}}for(var Qt=St.FullPaths.length+3>>2,on=dt+7>>3,Hi=dt+127>>7,Xr=on+Ft+Qt+Hi,ta=Xr+127>>7,Os=ta<=109?0:Math.ceil((ta-109)/127);Xr+ta+Os+127>>7>ta;)Os=++ta<=109?0:Math.ceil((ta-109)/127);var Kr=[1,Os,ta,Hi,Qt,Ft,dt,0];return St.FileIndex[0].size=dt<<6,Kr[7]=(St.FileIndex[0].start=Kr[0]+Kr[1]+Kr[2]+Kr[3]+Kr[4]+Kr[5])+(Kr[6]+7>>3),Kr}(B),Q=Fa(X[7]<<9),re=0,Ne=0;{for(re=0;re<8;++re)Q.write_shift(1,ot[re]);for(re=0;re<8;++re)Q.write_shift(2,0);for(Q.write_shift(2,62),Q.write_shift(2,3),Q.write_shift(2,65534),Q.write_shift(2,9),Q.write_shift(2,6),re=0;re<3;++re)Q.write_shift(2,0);for(Q.write_shift(4,0),Q.write_shift(4,X[2]),Q.write_shift(4,X[0]+X[1]+X[2]+X[3]-1),Q.write_shift(4,0),Q.write_shift(4,4096),Q.write_shift(4,X[3]?X[0]+X[1]+X[2]-1:st),Q.write_shift(4,X[3]),Q.write_shift(-4,X[1]?X[0]-1:st),Q.write_shift(4,X[1]),re=0;re<109;++re)Q.write_shift(-4,re<X[2]?X[1]+re:-1)}if(X[1])for(Ne=0;Ne<X[1];++Ne){for(;re<236+Ne*127;++re)Q.write_shift(-4,re<X[2]?X[1]+re:-1);Q.write_shift(-4,Ne===X[1]-1?st:Ne+1)}var Ze=function(St){for(Ne+=St;re<Ne-1;++re)Q.write_shift(-4,re+1);St&&(++re,Q.write_shift(-4,st))};for(Ne=re=0,Ne+=X[1];re<Ne;++re)Q.write_shift(-4,ft.DIFSECT);for(Ne+=X[2];re<Ne;++re)Q.write_shift(-4,ft.FATSECT);Ze(X[3]),Ze(X[4]);for(var Le=0,ze=0,je=B.FileIndex[0];Le<B.FileIndex.length;++Le)je=B.FileIndex[Le],je.content&&(ze=je.content.length,!(ze<4096)&&(je.start=Ne,Ze(ze+511>>9)));for(Ze(X[6]+7>>3);Q.l&511;)Q.write_shift(-4,ft.ENDOFCHAIN);for(Ne=re=0,Le=0;Le<B.FileIndex.length;++Le)je=B.FileIndex[Le],je.content&&(ze=je.content.length,!(!ze||ze>=4096)&&(je.start=Ne,Ze(ze+63>>6)));for(;Q.l&511;)Q.write_shift(-4,ft.ENDOFCHAIN);for(re=0;re<X[4]<<2;++re){var at=B.FullPaths[re];if(!at||at.length===0){for(Le=0;Le<17;++Le)Q.write_shift(4,0);for(Le=0;Le<3;++Le)Q.write_shift(4,-1);for(Le=0;Le<12;++Le)Q.write_shift(4,0);continue}je=B.FileIndex[re],re===0&&(je.start=je.size?je.start-1:st);var gt=re===0&&K.root||je.name;if(ze=2*(gt.length+1),Q.write_shift(64,gt,"utf16le"),Q.write_shift(2,ze),Q.write_shift(1,je.type),Q.write_shift(1,je.color),Q.write_shift(-4,je.L),Q.write_shift(-4,je.R),Q.write_shift(-4,je.C),je.clsid)Q.write_shift(16,je.clsid,"hex");else for(Le=0;Le<4;++Le)Q.write_shift(4,0);Q.write_shift(4,je.state||0),Q.write_shift(4,0),Q.write_shift(4,0),Q.write_shift(4,0),Q.write_shift(4,0),Q.write_shift(4,je.start),Q.write_shift(4,je.size),Q.write_shift(4,0)}for(re=1;re<B.FileIndex.length;++re)if(je=B.FileIndex[re],je.size>=4096)if(Q.l=je.start+1<<9,vr&&Buffer.isBuffer(je.content))je.content.copy(Q,Q.l,0,je.size),Q.l+=je.size+511&-512;else{for(Le=0;Le<je.size;++Le)Q.write_shift(1,je.content[Le]);for(;Le&511;++Le)Q.write_shift(1,0)}for(re=1;re<B.FileIndex.length;++re)if(je=B.FileIndex[re],je.size>0&&je.size<4096)if(vr&&Buffer.isBuffer(je.content))je.content.copy(Q,Q.l,0,je.size),Q.l+=je.size+63&-64;else{for(Le=0;Le<je.size;++Le)Q.write_shift(1,je.content[Le]);for(;Le&63;++Le)Q.write_shift(1,0)}if(vr)Q.l=Q.length;else for(;Q.l<Q.length;)Q.write_shift(1,0);return Q}function $e(B,J){var K=B.FullPaths.map(function(Le){return Le.toUpperCase()}),X=K.map(function(Le){var ze=Le.split("/");return ze[ze.length-(Le.slice(-1)=="/"?2:1)]}),Q=!1;J.charCodeAt(0)===47?(Q=!0,J=K[0].slice(0,-1)+J):Q=J.indexOf("/")!==-1;var re=J.toUpperCase(),Ne=Q===!0?K.indexOf(re):X.indexOf(re);if(Ne!==-1)return B.FileIndex[Ne];var Ze=!re.match(Ic);for(re=re.replace(ki,""),Ze&&(re=re.replace(Ic,"!")),Ne=0;Ne<K.length;++Ne)if((Ze?K[Ne].replace(Ic,"!"):K[Ne]).replace(ki,"")==re||(Ze?X[Ne].replace(Ic,"!"):X[Ne]).replace(ki,"")==re)return B.FileIndex[Ne];return null}var Re=64,st=-2,pt="d0cf11e0a1b11ae1",ot=[208,207,17,224,161,177,26,225],_t="00000000000000000000000000000000",ft={MAXREGSECT:-6,DIFSECT:-4,FATSECT:-3,ENDOFCHAIN:st,FREESECT:-1,HEADER_SIGNATURE:pt,HEADER_MINOR_VERSION:"3e00",MAXREGSID:-6,NOSTREAM:-1,HEADER_CLSID:_t,EntryTypes:["unknown","storage","stream","lockbytes","property","root"]};function ir(B,J,K){b();var X=Ue(B,K);S.writeFileSync(J,X)}function qe(B){for(var J=new Array(B.length),K=0;K<B.length;++K)J[K]=String.fromCharCode(B[K]);return J.join("")}function $t(B,J){var K=Ue(B,J);switch(J&&J.type||"buffer"){case"file":return b(),S.writeFileSync(J.filename,K),K;case"binary":return typeof K=="string"?K:qe(K);case"base64":return fm(typeof K=="string"?K:qe(K));case"buffer":if(vr)return Buffer.isBuffer(K)?K:go(K);case"array":return typeof K=="string"?vn(K):K}return K}var Dt;function ue(B){try{var J=B.InflateRaw,K=new J;if(K._processChunk(new Uint8Array([3,0]),K._finishFlushFlag),K.bytesRead)Dt=B;else throw new Error("zlib does not expose bytesRead")}catch(X){console.error("cannot use native zlib: "+(X.message||X))}}function be(B,J){if(!Dt)return Nt(B,J);var K=Dt.InflateRaw,X=new K,Q=X._processChunk(B.slice(B.l),X._finishFlushFlag);return B.l+=X.bytesRead,Q}function Te(B){return Dt?Dt.deflateRawSync(B):Xt(B)}var Ae=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Ye=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258],mt=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];function wt(B){var J=(B<<1|B<<11)&139536|(B<<5|B<<15)&558144;return(J>>16|J>>8|J)&255}for(var ut=typeof Uint8Array<"u",rt=ut?new Uint8Array(256):[],Yt=0;Yt<256;++Yt)rt[Yt]=wt(Yt);function xe(B,J){var K=rt[B&255];return J<=8?K>>>8-J:(K=K<<8|rt[B>>8&255],J<=16?K>>>16-J:(K=K<<8|rt[B>>16&255],K>>>24-J))}function er(B,J){var K=J&7,X=J>>>3;return(B[X]|(K<=6?0:B[X+1]<<8))>>>K&3}function Jt(B,J){var K=J&7,X=J>>>3;return(B[X]|(K<=5?0:B[X+1]<<8))>>>K&7}function mr(B,J){var K=J&7,X=J>>>3;return(B[X]|(K<=4?0:B[X+1]<<8))>>>K&15}function Zt(B,J){var K=J&7,X=J>>>3;return(B[X]|(K<=3?0:B[X+1]<<8))>>>K&31}function Et(B,J){var K=J&7,X=J>>>3;return(B[X]|(K<=1?0:B[X+1]<<8))>>>K&127}function wr(B,J,K){var X=J&7,Q=J>>>3,re=(1<<K)-1,Ne=B[Q]>>>X;return K<8-X||(Ne|=B[Q+1]<<8-X,K<16-X)||(Ne|=B[Q+2]<<16-X,K<24-X)||(Ne|=B[Q+3]<<24-X),Ne&re}function Wr(B,J,K){var X=J&7,Q=J>>>3;return X<=5?B[Q]|=(K&7)<<X:(B[Q]|=K<<X&255,B[Q+1]=(K&7)>>8-X),J+3}function Xe(B,J,K){var X=J&7,Q=J>>>3;return K=(K&1)<<X,B[Q]|=K,J+1}function Fr(B,J,K){var X=J&7,Q=J>>>3;return K<<=X,B[Q]|=K&255,K>>>=8,B[Q+1]=K,J+8}function na(B,J,K){var X=J&7,Q=J>>>3;return K<<=X,B[Q]|=K&255,K>>>=8,B[Q+1]=K&255,B[Q+2]=K>>>8,J+16}function ur(B,J){var K=B.length,X=2*K>J?2*K:J+5,Q=0;if(K>=J)return B;if(vr){var re=dm(X);if(B.copy)B.copy(re);else for(;Q<B.length;++Q)re[Q]=B[Q];return re}else if(ut){var Ne=new Uint8Array(X);if(Ne.set)Ne.set(B);else for(;Q<K;++Q)Ne[Q]=B[Q];return Ne}return B.length=X,B}function qt(B){for(var J=new Array(B),K=0;K<B;++K)J[K]=0;return J}function Zr(B,J,K){var X=1,Q=0,re=0,Ne=0,Ze=0,Le=B.length,ze=ut?new Uint16Array(32):qt(32);for(re=0;re<32;++re)ze[re]=0;for(re=Le;re<K;++re)B[re]=0;Le=B.length;var je=ut?new Uint16Array(Le):qt(Le);for(re=0;re<Le;++re)ze[Q=B[re]]++,X<Q&&(X=Q),je[re]=0;for(ze[0]=0,re=1;re<=X;++re)ze[re+16]=Ze=Ze+ze[re-1]<<1;for(re=0;re<Le;++re)Ze=B[re],Ze!=0&&(je[re]=ze[Ze+16]++);var at=0;for(re=0;re<Le;++re)if(at=B[re],at!=0)for(Ze=xe(je[re],X)>>X-at,Ne=(1<<X+4-at)-1;Ne>=0;--Ne)J[Ze|Ne<<at]=at&15|re<<4;return X}var Sa=ut?new Uint16Array(512):qt(512),ua=ut?new Uint16Array(32):qt(32);if(!ut){for(var zr=0;zr<512;++zr)Sa[zr]=0;for(zr=0;zr<32;++zr)ua[zr]=0}(function(){for(var B=[],J=0;J<32;J++)B.push(5);Zr(B,ua,32);var K=[];for(J=0;J<=143;J++)K.push(8);for(;J<=255;J++)K.push(9);for(;J<=279;J++)K.push(7);for(;J<=287;J++)K.push(8);Zr(K,Sa,288)})();var fa=function(){for(var J=ut?new Uint8Array(32768):[],K=0,X=0;K<mt.length-1;++K)for(;X<mt[K+1];++X)J[X]=K;for(;X<32768;++X)J[X]=29;var Q=ut?new Uint8Array(259):[];for(K=0,X=0;K<Ye.length-1;++K)for(;X<Ye[K+1];++X)Q[X]=K;function re(Ze,Le){for(var ze=0;ze<Ze.length;){var je=Math.min(65535,Ze.length-ze),at=ze+je==Ze.length;for(Le.write_shift(1,+at),Le.write_shift(2,je),Le.write_shift(2,~je&65535);je-- >0;)Le[Le.l++]=Ze[ze++]}return Le.l}function Ne(Ze,Le){for(var ze=0,je=0,at=ut?new Uint16Array(32768):[];je<Ze.length;){var gt=Math.min(65535,Ze.length-je);if(gt<10){for(ze=Wr(Le,ze,+(je+gt==Ze.length)),ze&7&&(ze+=8-(ze&7)),Le.l=ze/8|0,Le.write_shift(2,gt),Le.write_shift(2,~gt&65535);gt-- >0;)Le[Le.l++]=Ze[je++];ze=Le.l*8;continue}ze=Wr(Le,ze,+(je+gt==Ze.length)+2);for(var St=0;gt-- >0;){var dt=Ze[je];St=(St<<5^dt)&32767;var Ft=-1,Wt=0;if((Ft=at[St])&&(Ft|=je&-32768,Ft>je&&(Ft-=32768),Ft<je))for(;Ze[Ft+Wt]==Ze[je+Wt]&&Wt<250;)++Wt;if(Wt>2){dt=Q[Wt],dt<=22?ze=Fr(Le,ze,rt[dt+1]>>1)-1:(Fr(Le,ze,3),ze+=5,Fr(Le,ze,rt[dt-23]>>5),ze+=3);var kr=dt<8?0:dt-4>>2;kr>0&&(na(Le,ze,Wt-Ye[dt]),ze+=kr),dt=J[je-Ft],ze=Fr(Le,ze,rt[dt]>>3),ze-=3;var Rr=dt<4?0:dt-2>>1;Rr>0&&(na(Le,ze,je-Ft-mt[dt]),ze+=Rr);for(var Qt=0;Qt<Wt;++Qt)at[St]=je&32767,St=(St<<5^Ze[je])&32767,++je;gt-=Wt-1}else dt<=143?dt=dt+48:ze=Xe(Le,ze,1),ze=Fr(Le,ze,rt[dt]),at[St]=je&32767,++je}ze=Fr(Le,ze,0)-1}return Le.l=(ze+7)/8|0,Le.l}return function(Le,ze){return Le.length<8?re(Le,ze):Ne(Le,ze)}}();function Xt(B){var J=Fa(50+Math.floor(B.length*1.1)),K=fa(B,J);return J.slice(0,K)}var Sr=ut?new Uint16Array(32768):qt(32768),lt=ut?new Uint16Array(32768):qt(32768),Mt=ut?new Uint16Array(128):qt(128),Ut=1,gr=1;function tr(B,J){var K=Zt(B,J)+257;J+=5;var X=Zt(B,J)+1;J+=5;var Q=mr(B,J)+4;J+=4;for(var re=0,Ne=ut?new Uint8Array(19):qt(19),Ze=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Le=1,ze=ut?new Uint8Array(8):qt(8),je=ut?new Uint8Array(8):qt(8),at=Ne.length,gt=0;gt<Q;++gt)Ne[Ae[gt]]=re=Jt(B,J),Le<re&&(Le=re),ze[re]++,J+=3;var St=0;for(ze[0]=0,gt=1;gt<=Le;++gt)je[gt]=St=St+ze[gt-1]<<1;for(gt=0;gt<at;++gt)(St=Ne[gt])!=0&&(Ze[gt]=je[St]++);var dt=0;for(gt=0;gt<at;++gt)if(dt=Ne[gt],dt!=0){St=rt[Ze[gt]]>>8-dt;for(var Ft=(1<<7-dt)-1;Ft>=0;--Ft)Mt[St|Ft<<dt]=dt&7|gt<<3}var Wt=[];for(Le=1;Wt.length<K+X;)switch(St=Mt[Et(B,J)],J+=St&7,St>>>=3){case 16:for(re=3+er(B,J),J+=2,St=Wt[Wt.length-1];re-- >0;)Wt.push(St);break;case 17:for(re=3+Jt(B,J),J+=3;re-- >0;)Wt.push(0);break;case 18:for(re=11+Et(B,J),J+=7;re-- >0;)Wt.push(0);break;default:Wt.push(St),Le<St&&(Le=St);break}var kr=Wt.slice(0,K),Rr=Wt.slice(K);for(gt=K;gt<286;++gt)kr[gt]=0;for(gt=X;gt<30;++gt)Rr[gt]=0;return Ut=Zr(kr,Sr,286),gr=Zr(Rr,lt,30),J}function it(B,J){if(B[0]==3&&!(B[1]&3))return[Ds(J),2];for(var K=0,X=0,Q=dm(J||1<<18),re=0,Ne=Q.length>>>0,Ze=0,Le=0;!(X&1);){if(X=Jt(B,K),K+=3,X>>>1)X>>1==1?(Ze=9,Le=5):(K=tr(B,K),Ze=Ut,Le=gr);else{K&7&&(K+=8-(K&7));var ze=B[K>>>3]|B[(K>>>3)+1]<<8;if(K+=32,ze>0)for(!J&&Ne<re+ze&&(Q=ur(Q,re+ze),Ne=Q.length);ze-- >0;)Q[re++]=B[K>>>3],K+=8;continue}for(;;){!J&&Ne<re+32767&&(Q=ur(Q,re+32767),Ne=Q.length);var je=wr(B,K,Ze),at=X>>>1==1?Sa[je]:Sr[je];if(K+=at&15,at>>>=4,!(at>>>8&255))Q[re++]=at;else{if(at==256)break;at-=257;var gt=at<8?0:at-4>>2;gt>5&&(gt=0);var St=re+Ye[at];gt>0&&(St+=wr(B,K,gt),K+=gt),je=wr(B,K,Le),at=X>>>1==1?ua[je]:lt[je],K+=at&15,at>>>=4;var dt=at<4?0:at-2>>1,Ft=mt[at];for(dt>0&&(Ft+=wr(B,K,dt),K+=dt),!J&&Ne<St&&(Q=ur(Q,St+100),Ne=Q.length);re<St;)Q[re]=Q[re-Ft],++re}}}return J?[Q,K+7>>>3]:[Q.slice(0,re),K+7>>>3]}function Nt(B,J){var K=B.slice(B.l||0),X=it(K,J);return B.l+=X[1],X[0]}function jt(B,J){if(B)typeof console<"u"&&console.error(J);else throw new Error(J)}function Lr(B,J){var K=B;Za(K,0);var X=[],Q=[],re={FileIndex:X,FullPaths:Q};te(re,{root:J.root});for(var Ne=K.length-4;(K[Ne]!=80||K[Ne+1]!=75||K[Ne+2]!=5||K[Ne+3]!=6)&&Ne>=0;)--Ne;K.l=Ne+4,K.l+=4;var Ze=K.read_shift(2);K.l+=6;var Le=K.read_shift(4);for(K.l=Le,Ne=0;Ne<Ze;++Ne){K.l+=20;var ze=K.read_shift(4),je=K.read_shift(4),at=K.read_shift(2),gt=K.read_shift(2),St=K.read_shift(2);K.l+=8;var dt=K.read_shift(4),Ft=o(K.slice(K.l+at,K.l+at+gt));K.l+=at+gt+St;var Wt=K.l;K.l=dt+4,sa(K,ze,je,re,Ft),K.l=Wt}return re}function sa(B,J,K,X,Q){B.l+=2;var re=B.read_shift(2),Ne=B.read_shift(2),Ze=x(B);if(re&8257)throw new Error("Unsupported ZIP encryption");for(var Le=B.read_shift(4),ze=B.read_shift(4),je=B.read_shift(4),at=B.read_shift(2),gt=B.read_shift(2),St="",dt=0;dt<at;++dt)St+=String.fromCharCode(B[B.l++]);if(gt){var Ft=o(B.slice(B.l,B.l+gt));(Ft[21589]||{}).mt&&(Ze=Ft[21589].mt),((Q||{})[21589]||{}).mt&&(Ze=Q[21589].mt)}B.l+=gt;var Wt=B.slice(B.l,B.l+ze);switch(Ne){case 8:Wt=be(B,je);break;case 0:break;default:throw new Error("Unsupported ZIP Compression method "+Ne)}var kr=!1;re&8&&(Le=B.read_shift(4),Le==134695760&&(Le=B.read_shift(4),kr=!0),ze=B.read_shift(4),je=B.read_shift(4)),ze!=J&&jt(kr,"Bad compressed size: "+J+" != "+ze),je!=K&&jt(kr,"Bad uncompressed size: "+K+" != "+je),_e(X,St,Wt,{unsafe:!0,mt:Ze})}function Kt(B,J){var K=J||{},X=[],Q=[],re=Fa(1),Ne=K.compression?8:0,Ze=0,Le=0,ze=0,je=0,at=0,gt=B.FullPaths[0],St=gt,dt=B.FileIndex[0],Ft=[],Wt=0;for(Le=1;Le<B.FullPaths.length;++Le)if(St=B.FullPaths[Le].slice(gt.length),dt=B.FileIndex[Le],!(!dt.size||!dt.content||St=="Sh33tJ5")){var kr=je,Rr=Fa(St.length);for(ze=0;ze<St.length;++ze)Rr.write_shift(1,St.charCodeAt(ze)&127);Rr=Rr.slice(0,Rr.l),Ft[at]=rb.buf(dt.content,0);var Qt=dt.content;Ne==8&&(Qt=Te(Qt)),re=Fa(30),re.write_shift(4,67324752),re.write_shift(2,20),re.write_shift(2,Ze),re.write_shift(2,Ne),dt.mt?m(re,dt.mt):re.write_shift(4,0),re.write_shift(-4,Ft[at]),re.write_shift(4,Qt.length),re.write_shift(4,dt.content.length),re.write_shift(2,Rr.length),re.write_shift(2,0),je+=re.length,X.push(re),je+=Rr.length,X.push(Rr),je+=Qt.length,X.push(Qt),re=Fa(46),re.write_shift(4,33639248),re.write_shift(2,0),re.write_shift(2,20),re.write_shift(2,Ze),re.write_shift(2,Ne),re.write_shift(4,0),re.write_shift(-4,Ft[at]),re.write_shift(4,Qt.length),re.write_shift(4,dt.content.length),re.write_shift(2,Rr.length),re.write_shift(2,0),re.write_shift(2,0),re.write_shift(2,0),re.write_shift(2,0),re.write_shift(4,0),re.write_shift(4,kr),Wt+=re.l,Q.push(re),Wt+=Rr.length,Q.push(Rr),++at}return re=Fa(22),re.write_shift(4,101010256),re.write_shift(2,0),re.write_shift(2,0),re.write_shift(2,at),re.write_shift(2,at),re.write_shift(4,Wt),re.write_shift(4,je),re.write_shift(2,0),As([As(X),As(Q),re])}var Ya={htm:"text/html",xml:"text/xml",gif:"image/gif",jpg:"image/jpeg",png:"image/png",mso:"application/x-mso",thmx:"application/vnd.ms-officetheme",sh33tj5:"application/octet-stream"};function le(B,J){if(B.ctype)return B.ctype;var K=B.name||"",X=K.match(/\.([^\.]+)$/);return X&&Ya[X[1]]||J&&(X=(K=J).match(/[\.\\]([^\.\\])+$/),X&&Ya[X[1]])?Ya[X[1]]:"application/octet-stream"}function V(B){for(var J=fm(B),K=[],X=0;X<J.length;X+=76)K.push(J.slice(X,X+76));return K.join(`\r
`)+`\r
`}function H(B){var J=B.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF=]/g,function(ze){var je=ze.charCodeAt(0).toString(16).toUpperCase();return"="+(je.length==1?"0"+je:je)});J=J.replace(/ $/mg,"=20").replace(/\t$/mg,"=09"),J.charAt(0)==`
`&&(J="=0D"+J.slice(1)),J=J.replace(/\r(?!\n)/mg,"=0D").replace(/\n\n/mg,`
=0A`).replace(/([^\r\n])\n/mg,"$1=0A");for(var K=[],X=J.split(`\r
`),Q=0;Q<X.length;++Q){var re=X[Q];if(re.length==0){K.push("");continue}for(var Ne=0;Ne<re.length;){var Ze=76,Le=re.slice(Ne,Ne+Ze);Le.charAt(Ze-1)=="="?Ze--:Le.charAt(Ze-2)=="="?Ze-=2:Le.charAt(Ze-3)=="="&&(Ze-=3),Le=re.slice(Ne,Ne+Ze),Ne+=Ze,Ne<re.length&&(Le+="="),K.push(Le)}}return K.join(`\r
`)}function ee(B){for(var J=[],K=0;K<B.length;++K){for(var X=B[K];K<=B.length&&X.charAt(X.length-1)=="=";)X=X.slice(0,X.length-1)+B[++K];J.push(X)}for(var Q=0;Q<J.length;++Q)J[Q]=J[Q].replace(/[=][0-9A-Fa-f]{2}/g,function(re){return String.fromCharCode(parseInt(re.slice(1),16))});return vn(J.join(`\r
`))}function he(B,J,K){for(var X="",Q="",re="",Ne,Ze=0;Ze<10;++Ze){var Le=J[Ze];if(!Le||Le.match(/^\s*$/))break;var ze=Le.match(/^(.*?):\s*([^\s].*)$/);if(ze)switch(ze[1].toLowerCase()){case"content-location":X=ze[2].trim();break;case"content-type":re=ze[2].trim();break;case"content-transfer-encoding":Q=ze[2].trim();break}}switch(++Ze,Q.toLowerCase()){case"base64":Ne=vn(Gi(J.slice(Ze).join("")));break;case"quoted-printable":Ne=ee(J.slice(Ze));break;default:throw new Error("Unsupported Content-Transfer-Encoding "+Q)}var je=_e(B,X.slice(K.length),Ne,{unsafe:!0});re&&(je.ctype=re)}function de(B,J){if(qe(B.slice(0,13)).toLowerCase()!="mime-version:")throw new Error("Unsupported MAD header");var K=J&&J.root||"",X=(vr&&Buffer.isBuffer(B)?B.toString("binary"):qe(B)).split(`\r
`),Q=0,re="";for(Q=0;Q<X.length;++Q)if(re=X[Q],!!/^Content-Location:/i.test(re)&&(re=re.slice(re.indexOf("file")),K||(K=re.slice(0,re.lastIndexOf("/")+1)),re.slice(0,K.length)!=K))for(;K.length>0&&(K=K.slice(0,K.length-1),K=K.slice(0,K.lastIndexOf("/")+1),re.slice(0,K.length)!=K););var Ne=(X[1]||"").match(/boundary="(.*?)"/);if(!Ne)throw new Error("MAD cannot find boundary");var Ze="--"+(Ne[1]||""),Le=[],ze=[],je={FileIndex:Le,FullPaths:ze};te(je);var at,gt=0;for(Q=0;Q<X.length;++Q){var St=X[Q];St!==Ze&&St!==Ze+"--"||(gt++&&he(je,X.slice(at,Q),K),at=Q)}return je}function De(B,J){var K=J||{},X=K.boundary||"SheetJS";X="------="+X;for(var Q=["MIME-Version: 1.0",'Content-Type: multipart/related; boundary="'+X.slice(2)+'"',"","",""],re=B.FullPaths[0],Ne=re,Ze=B.FileIndex[0],Le=1;Le<B.FullPaths.length;++Le)if(Ne=B.FullPaths[Le].slice(re.length),Ze=B.FileIndex[Le],!(!Ze.size||!Ze.content||Ne=="Sh33tJ5")){Ne=Ne.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF]/g,function(Wt){return"_x"+Wt.charCodeAt(0).toString(16)+"_"}).replace(/[\u0080-\uFFFF]/g,function(Wt){return"_u"+Wt.charCodeAt(0).toString(16)+"_"});for(var ze=Ze.content,je=vr&&Buffer.isBuffer(ze)?ze.toString("binary"):qe(ze),at=0,gt=Math.min(1024,je.length),St=0,dt=0;dt<=gt;++dt)(St=je.charCodeAt(dt))>=32&&St<128&&++at;var Ft=at>=gt*4/5;Q.push(X),Q.push("Content-Location: "+(K.root||"file:///C:/SheetJS/")+Ne),Q.push("Content-Transfer-Encoding: "+(Ft?"quoted-printable":"base64")),Q.push("Content-Type: "+le(Ze,Ne)),Q.push(""),Q.push(Ft?H(je):V(je))}return Q.push(X+`--\r
`),Q.join(`\r
`)}function ke(B){var J={};return te(J,B),J}function _e(B,J,K,X){var Q=X&&X.unsafe;Q||te(B);var re=!Q&&br.find(B,J);if(!re){var Ne=B.FullPaths[0];J.slice(0,Ne.length)==Ne?Ne=J:(Ne.slice(-1)!="/"&&(Ne+="/"),Ne=(Ne+J).replace("//","/")),re={name:h(J),type:2},B.FileIndex.push(re),B.FullPaths.push(Ne),Q||br.utils.cfb_gc(B)}return re.content=K,re.size=K?K.length:0,X&&(X.CLSID&&(re.clsid=X.CLSID),X.mt&&(re.mt=X.mt),X.ct&&(re.ct=X.ct)),re}function Fe(B,J){te(B);var K=br.find(B,J);if(K){for(var X=0;X<B.FileIndex.length;++X)if(B.FileIndex[X]==K)return B.FileIndex.splice(X,1),B.FullPaths.splice(X,1),!0}return!1}function Je(B,J,K){te(B);var X=br.find(B,J);if(X){for(var Q=0;Q<B.FileIndex.length;++Q)if(B.FileIndex[Q]==X)return B.FileIndex[Q].name=h(K),B.FullPaths[Q]=K,!0}return!1}function Qe(B){Ce(B,!0)}return n.find=$e,n.read=we,n.parse=C,n.write=$t,n.writeFile=ir,n.utils={cfb_new:ke,cfb_add:_e,cfb_del:Fe,cfb_mov:Je,cfb_gc:Qe,ReadShift:Mc,CheckField:y1,prep_blob:Za,bconcat:As,use_zlib:ue,_deflateRaw:Xt,_inflateRaw:Nt,consts:ft},n}();function ab(e){if(typeof Deno<"u")return Deno.readFileSync(e);if(typeof $<"u"&&typeof File<"u"&&typeof Folder<"u")try{var n=File(e);n.open("r"),n.encoding="binary";var i=n.read();return n.close(),i}catch(c){if(!c.message||!c.message.match(/onstruct/))throw c}throw new Error("Cannot access file "+e)}function On(e){for(var n=Object.keys(e),i=[],c=0;c<n.length;++c)Object.prototype.hasOwnProperty.call(e,n[c])&&i.push(n[c]);return i}function z0(e){for(var n=[],i=On(e),c=0;c!==i.length;++c)n[e[i[c]]]=i[c];return n}var Au=new Date(1899,11,30,0,0,0);function Ci(e,n){var i=e.getTime();n&&(i-=1462*24*60*60*1e3);var c=Au.getTime()+(e.getTimezoneOffset()-Au.getTimezoneOffset())*6e4;return(i-c)/(24*60*60*1e3)}var Yg=new Date,ib=Au.getTime()+(Yg.getTimezoneOffset()-Au.getTimezoneOffset())*6e4,wm=Yg.getTimezoneOffset();function zu(e){var n=new Date;return n.setTime(e*24*60*60*1e3+ib),n.getTimezoneOffset()!==wm&&n.setTime(n.getTime()+(n.getTimezoneOffset()-wm)*6e4),n}function nb(e){var n=0,i=0,c=!1,h=e.match(/P([0-9\.]+Y)?([0-9\.]+M)?([0-9\.]+D)?T([0-9\.]+H)?([0-9\.]+M)?([0-9\.]+S)?/);if(!h)throw new Error("|"+e+"| is not an ISO8601 Duration");for(var m=1;m!=h.length;++m)if(h[m]){switch(i=1,m>3&&(c=!0),h[m].slice(h[m].length-1)){case"Y":throw new Error("Unsupported ISO Duration Field: "+h[m].slice(h[m].length-1));case"D":i*=24;case"H":i*=60;case"M":if(c)i*=60;else throw new Error("Unsupported ISO Duration Field: M")}n+=i*parseInt(h[m],10)}return n}var bm=new Date("2017-02-19T19:06:09.000Z"),Jg=isNaN(bm.getFullYear())?new Date("2/19/17"):bm,sb=Jg.getFullYear()==2017;function za(e,n){var i=new Date(e);if(sb)return n>0?i.setTime(i.getTime()+i.getTimezoneOffset()*60*1e3):n<0&&i.setTime(i.getTime()-i.getTimezoneOffset()*60*1e3),i;if(e instanceof Date)return e;if(Jg.getFullYear()==1917&&!isNaN(i.getFullYear())){var c=i.getFullYear();return e.indexOf(""+c)>-1||i.setFullYear(i.getFullYear()+100),i}var h=e.match(/\d+/g)||["2017","2","19","0","0","0"],m=new Date(+h[0],+h[1]-1,+h[2],+h[3]||0,+h[4]||0,+h[5]||0);return e.indexOf("Z")>-1&&(m=new Date(m.getTime()-m.getTimezoneOffset()*60*1e3)),m}function fo(e,n){if(vr&&Buffer.isBuffer(e)){if(n){if(e[0]==255&&e[1]==254)return Pc(e.slice(2).toString("utf16le"));if(e[1]==254&&e[2]==255)return Pc(zg(e.slice(2).toString("binary")))}return e.toString("binary")}if(typeof TextDecoder<"u")try{if(n){if(e[0]==255&&e[1]==254)return Pc(new TextDecoder("utf-16le").decode(e.slice(2)));if(e[0]==254&&e[1]==255)return Pc(new TextDecoder("utf-16be").decode(e.slice(2)))}var i={"":"","":"",:"","":"","":"","":"","":"","":"","":"",:"","":"",:"",:"","":"","":"","":"","":"","":"","":"","":"","":"","":"",:"","":"",:"",:"",:""};return Array.isArray(e)&&(e=new Uint8Array(e)),new TextDecoder("latin1").decode(e).replace(/[]/g,function(m){return i[m]||m})}catch{}for(var c=[],h=0;h!=e.length;++h)c.push(String.fromCharCode(e[h]));return c.join("")}function Xa(e){if(typeof JSON<"u"&&!Array.isArray(e))return JSON.parse(JSON.stringify(e));if(typeof e!="object"||e==null)return e;if(e instanceof Date)return new Date(e.getTime());var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=Xa(e[i]));return n}function ca(e,n){for(var i="";i.length<n;)i+=e;return i}function Tn(e){var n=Number(e);if(!isNaN(n))return isFinite(n)?n:NaN;if(!/\d/.test(e))return n;var i=1,c=e.replace(/([\d]),([\d])/g,"$1$2").replace(/[$]/g,"").replace(/[%]/g,function(){return i*=100,""});return!isNaN(n=Number(c))||(c=c.replace(/[(](.*)[)]/,function(h,m){return i=-i,m}),!isNaN(n=Number(c)))?n/i:n}var ob=["january","february","march","april","may","june","july","august","september","october","november","december"];function pl(e){var n=new Date(e),i=new Date(NaN),c=n.getYear(),h=n.getMonth(),m=n.getDate();if(isNaN(m))return i;var x=e.toLowerCase();if(x.match(/jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec/)){if(x=x.replace(/[^a-z]/g,"").replace(/([^a-z]|^)[ap]m?([^a-z]|$)/,""),x.length>3&&ob.indexOf(x)==-1)return i}else if(x.match(/[a-z]/))return i;return c<0||c>8099?i:(h>0||m>1)&&c!=101?n:e.match(/[^-0-9:,\/\\]/)?i:n}var lb=function(){var e="abacaba".split(/(:?b)/i).length==5;return function(i,c,h){if(e||typeof c=="string")return i.split(c);for(var m=i.split(c),x=[m[0]],o=1;o<m.length;++o)x.push(h),x.push(m[o]);return x}}();function Qg(e){return e?e.content&&e.type?fo(e.content,!0):e.data?Ac(e.data):e.asNodeBuffer&&vr?Ac(e.asNodeBuffer().toString("binary")):e.asBinary?Ac(e.asBinary()):e._data&&e._data.getContent?Ac(fo(Array.prototype.slice.call(e._data.getContent(),0))):null:null}function e1(e){if(!e)return null;if(e.data)return hm(e.data);if(e.asNodeBuffer&&vr)return e.asNodeBuffer();if(e._data&&e._data.getContent){var n=e._data.getContent();return typeof n=="string"?hm(n):Array.prototype.slice.call(n)}return e.content&&e.type?e.content:null}function cb(e){return e&&e.name.slice(-4)===".bin"?e1(e):Qg(e)}function rn(e,n){for(var i=e.FullPaths||On(e.files),c=n.toLowerCase().replace(/[\/]/g,"\\"),h=c.replace(/\\/g,"/"),m=0;m<i.length;++m){var x=i[m].replace(/^Root Entry[\/]/,"").toLowerCase();if(c==x||h==x)return e.files?e.files[i[m]]:e.FileIndex[m]}return null}function N0(e,n){var i=rn(e,n);if(i==null)throw new Error("Cannot find file "+n+" in zip");return i}function Ta(e,n,i){if(!i)return cb(N0(e,n));if(!n)return null;try{return Ta(e,n)}catch{return null}}function ji(e,n,i){if(!i)return Qg(N0(e,n));if(!n)return null;try{return ji(e,n)}catch{return null}}function t1(e,n,i){if(!i)return e1(N0(e,n));if(!n)return null;try{return t1(e,n)}catch{return null}}function Tm(e){for(var n=e.FullPaths||On(e.files),i=[],c=0;c<n.length;++c)n[c].slice(-1)!="/"&&i.push(n[c].replace(/^Root Entry[\/]/,""));return i.sort()}function hb(e,n,i){if(e.FullPaths){if(typeof i=="string"){var c;return vr?c=go(i):c=Fw(i),br.utils.cfb_add(e,n,c)}br.utils.cfb_add(e,n,i)}else e.file(n,i)}function r1(e,n){switch(n.type){case"base64":return br.read(e,{type:"base64"});case"binary":return br.read(e,{type:"binary"});case"buffer":case"array":return br.read(e,{type:"buffer"})}throw new Error("Unrecognized type "+n.type)}function Fc(e,n){if(e.charAt(0)=="/")return e.slice(1);var i=n.split("/");n.slice(-1)!="/"&&i.pop();for(var c=e.split("/");c.length!==0;){var h=c.shift();h===".."?i.pop():h!=="."&&i.push(h)}return i.join("/")}var a1=`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\r
`,ub=/([^"\s?>\/]+)\s*=\s*((?:")([^"]*)(?:")|(?:')([^']*)(?:')|([^'">\s]+))/g,Em=/<[\/\?]?[a-zA-Z0-9:_-]+(?:\s+[^"\s?>\/]+\s*=\s*(?:"[^"]*"|'[^']*'|[^'">\s=]+))*\s*[\/\?]?>/mg,fb=/<[^>]*>/g,fi=a1.match(Em)?Em:fb,db=/<\w*:/,pb=/<(\/?)\w+:/;function rr(e,n,i){for(var c={},h=0,m=0;h!==e.length&&!((m=e.charCodeAt(h))===32||m===10||m===13);++h);if(n||(c[0]=e.slice(0,h)),h===e.length)return c;var x=e.match(ub),o=0,S="",b=0,C="",M="",L=1;if(x)for(b=0;b!=x.length;++b){for(M=x[b],m=0;m!=M.length&&M.charCodeAt(m)!==61;++m);for(C=M.slice(0,m).trim();M.charCodeAt(m+1)==32;)++m;for(L=(h=M.charCodeAt(m+1))==34||h==39?1:0,S=M.slice(m+1+L,M.length-L),o=0;o!=C.length&&C.charCodeAt(o)!==58;++o);if(o===C.length)C.indexOf("_")>0&&(C=C.slice(0,C.indexOf("_"))),c[C]=S,i||(c[C.toLowerCase()]=S);else{var z=(o===5&&C.slice(0,5)==="xmlns"?"xmlns":"")+C.slice(o+1);if(c[z]&&C.slice(o-3,o)=="ext")continue;c[z]=S,i||(c[z.toLowerCase()]=S)}}return c}function Bn(e){return e.replace(pb,"<$1")}var i1={"&quot;":'"',"&apos;":"'","&gt;":">","&lt;":"<","&amp;":"&"},mb=z0(i1),Er=function(){var e=/&(?:quot|apos|gt|lt|amp|#x?([\da-fA-F]+));/ig,n=/_x([\da-fA-F]{4})_/ig;return function i(c){var h=c+"",m=h.indexOf("<![CDATA[");if(m==-1)return h.replace(e,function(o,S){return i1[o]||String.fromCharCode(parseInt(S,o.indexOf("x")>-1?16:10))||o}).replace(n,function(o,S){return String.fromCharCode(parseInt(S,16))});var x=h.indexOf("]]>");return i(h.slice(0,m))+h.slice(m+9,x)+i(h.slice(x+3))}}(),gb=/[&<>'"]/g,xb=/[\u0000-\u001f]/g;function U0(e){var n=e+"";return n.replace(gb,function(i){return mb[i]}).replace(/\n/g,"<br/>").replace(xb,function(i){return"&#x"+("000"+i.charCodeAt(0).toString(16)).slice(-4)+";"})}var Sm=function(){var e=/&#(\d+);/g;function n(i,c){return String.fromCharCode(parseInt(c,10))}return function(c){return c.replace(e,n)}}();function ea(e){switch(e){case 1:case!0:case"1":case"true":case"TRUE":return!0;default:return!1}}function a0(e){for(var n="",i=0,c=0,h=0,m=0,x=0,o=0;i<e.length;){if(c=e.charCodeAt(i++),c<128){n+=String.fromCharCode(c);continue}if(h=e.charCodeAt(i++),c>191&&c<224){x=(c&31)<<6,x|=h&63,n+=String.fromCharCode(x);continue}if(m=e.charCodeAt(i++),c<240){n+=String.fromCharCode((c&15)<<12|(h&63)<<6|m&63);continue}x=e.charCodeAt(i++),o=((c&7)<<18|(h&63)<<12|(m&63)<<6|x&63)-65536,n+=String.fromCharCode(55296+(o>>>10&1023)),n+=String.fromCharCode(56320+(o&1023))}return n}function km(e){var n=Ds(2*e.length),i,c,h=1,m=0,x=0,o;for(c=0;c<e.length;c+=h)h=1,(o=e.charCodeAt(c))<128?i=o:o<224?(i=(o&31)*64+(e.charCodeAt(c+1)&63),h=2):o<240?(i=(o&15)*4096+(e.charCodeAt(c+1)&63)*64+(e.charCodeAt(c+2)&63),h=3):(h=4,i=(o&7)*262144+(e.charCodeAt(c+1)&63)*4096+(e.charCodeAt(c+2)&63)*64+(e.charCodeAt(c+3)&63),i-=65536,x=55296+(i>>>10&1023),i=56320+(i&1023)),x!==0&&(n[m++]=x&255,n[m++]=x>>>8,x=0),n[m++]=i%256,n[m++]=i>>>8;return n.slice(0,m).toString("ucs2")}function Cm(e){return go(e,"binary").toString("utf8")}var uu="foo bar baz",jr=vr&&(Cm(uu)==a0(uu)&&Cm||km(uu)==a0(uu)&&km)||a0,Pc=vr?function(e){return go(e,"utf8").toString("binary")}:function(e){for(var n=[],i=0,c=0,h=0;i<e.length;)switch(c=e.charCodeAt(i++),!0){case c<128:n.push(String.fromCharCode(c));break;case c<2048:n.push(String.fromCharCode(192+(c>>6))),n.push(String.fromCharCode(128+(c&63)));break;case(c>=55296&&c<57344):c-=55296,h=e.charCodeAt(i++)-56320+(c<<10),n.push(String.fromCharCode(240+(h>>18&7))),n.push(String.fromCharCode(144+(h>>12&63))),n.push(String.fromCharCode(128+(h>>6&63))),n.push(String.fromCharCode(128+(h&63)));break;default:n.push(String.fromCharCode(224+(c>>12))),n.push(String.fromCharCode(128+(c>>6&63))),n.push(String.fromCharCode(128+(c&63)))}return n.join("")},$c=function(){var e={};return function(i,c){var h=i+"|"+(c||"");return e[h]?e[h]:e[h]=new RegExp("<(?:\\w+:)?"+i+'(?: xml:space="preserve")?(?:[^>]*)>([\\s\\S]*?)</(?:\\w+:)?'+i+">",c||"")}}(),n1=function(){var e=[["nbsp"," "],["middot",""],["quot",'"'],["apos","'"],["gt",">"],["lt","<"],["amp","&"]].map(function(n){return[new RegExp("&"+n[0]+";","ig"),n[1]]});return function(i){for(var c=i.replace(/^[\t\n\r ]+/,"").replace(/[\t\n\r ]+$/,"").replace(/>\s+/g,">").replace(/\s+</g,"<").replace(/[\t\n\r ]+/g," ").replace(/<\s*[bB][rR]\s*\/?>/g,`
`).replace(/<[^>]*>/g,""),h=0;h<e.length;++h)c=c.replace(e[h][0],e[h][1]);return c}}(),_b=function(){var e={};return function(i){return e[i]!==void 0?e[i]:e[i]=new RegExp("<(?:vt:)?"+i+">([\\s\\S]*?)</(?:vt:)?"+i+">","g")}}(),yb=/<\/?(?:vt:)?variant>/g,vb=/<(?:vt:)([^>]*)>([\s\S]*)</;function Am(e,n){var i=rr(e),c=e.match(_b(i.baseType))||[],h=[];if(c.length!=i.size){if(n.WTF)throw new Error("unexpected vector length "+c.length+" != "+i.size);return h}return c.forEach(function(m){var x=m.replace(yb,"").match(vb);x&&h.push({v:jr(x[2]),t:x[1]})}),h}var wb=/(^\s|\s$|\n)/;function bb(e){return On(e).map(function(n){return" "+n+'="'+e[n]+'"'}).join("")}function Tb(e,n,i){return"<"+e+(i!=null?bb(i):"")+(n!=null?(n.match(wb)?' xml:space="preserve"':"")+">"+n+"</"+e:"/")+">"}function V0(e){if(vr&&Buffer.isBuffer(e))return e.toString("utf8");if(typeof e=="string")return e;if(typeof Uint8Array<"u"&&e instanceof Uint8Array)return jr(xo(R0(e)));throw new Error("Bad input format: expected Buffer or string")}var jc=/<(\/?)([^\s?><!\/:]*:|)([^\s?<>:\/]+)(?:[\s?:\/][^>]*)?>/mg,Eb={CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/metadata/core-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/custom-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/extended-properties",CT:"http://schemas.openxmlformats.org/package/2006/content-types",RELS:"http://schemas.openxmlformats.org/package/2006/relationships",TCMNT:"http://schemas.microsoft.com/office/spreadsheetml/2018/threadedcomments",dc:"http://purl.org/dc/elements/1.1/",dcterms:"http://purl.org/dc/terms/",dcmitype:"http://purl.org/dc/dcmitype/",mx:"http://schemas.microsoft.com/office/mac/excel/2008/main",r:"http://schemas.openxmlformats.org/officeDocument/2006/relationships",sjs:"http://schemas.openxmlformats.org/package/2006/sheetjs/core-properties",vt:"http://schemas.openxmlformats.org/officeDocument/2006/docPropsVTypes",xsi:"http://www.w3.org/2001/XMLSchema-instance",xsd:"http://www.w3.org/2001/XMLSchema"},Sb=["http://schemas.openxmlformats.org/spreadsheetml/2006/main","http://purl.oclc.org/ooxml/spreadsheetml/main","http://schemas.microsoft.com/office/excel/2006/main","http://schemas.microsoft.com/office/excel/2006/2"];function kb(e,n){for(var i=1-2*(e[n+7]>>>7),c=((e[n+7]&127)<<4)+(e[n+6]>>>4&15),h=e[n+6]&15,m=5;m>=0;--m)h=h*256+e[n+m];return c==2047?h==0?i*(1/0):NaN:(c==0?c=-1022:(c-=1023,h+=Math.pow(2,52)),i*Math.pow(2,c-52)*h)}function Cb(e,n,i){var c=(n<0||1/n==-1/0?1:0)<<7,h=0,m=0,x=c?-n:n;isFinite(x)?x==0?h=m=0:(h=Math.floor(Math.log(x)/Math.LN2),m=x*Math.pow(2,52-h),h<=-1023&&(!isFinite(m)||m<Math.pow(2,52))?h=-1022:(m-=Math.pow(2,52),h+=1023)):(h=2047,m=isNaN(n)?26985:0);for(var o=0;o<=5;++o,m/=256)e[i+o]=m&255;e[i+6]=(h&15)<<4|m&15,e[i+7]=h>>4|c}var Im=function(e){for(var n=[],i=10240,c=0;c<e[0].length;++c)if(e[0][c])for(var h=0,m=e[0][c].length;h<m;h+=i)n.push.apply(n,e[0][c].slice(h,h+i));return n},Fm=vr?function(e){return e[0].length>0&&Buffer.isBuffer(e[0][0])?Buffer.concat(e[0].map(function(n){return Buffer.isBuffer(n)?n:go(n)})):Im(e)}:Im,Pm=function(e,n,i){for(var c=[],h=n;h<i;h+=2)c.push(String.fromCharCode(rs(e,h)));return c.join("").replace(ki,"")},$0=vr?function(e,n,i){return Buffer.isBuffer(e)?e.toString("utf16le",n,i).replace(ki,""):Pm(e,n,i)}:Pm,Mm=function(e,n,i){for(var c=[],h=n;h<n+i;++h)c.push(("0"+e[h].toString(16)).slice(-2));return c.join("")},s1=vr?function(e,n,i){return Buffer.isBuffer(e)?e.toString("hex",n,n+i):Mm(e,n,i)}:Mm,Dm=function(e,n,i){for(var c=[],h=n;h<i;h++)c.push(String.fromCharCode(ol(e,h)));return c.join("")},Kc=vr?function(n,i,c){return Buffer.isBuffer(n)?n.toString("utf8",i,c):Dm(n,i,c)}:Dm,o1=function(e,n){var i=Vi(e,n);return i>0?Kc(e,n+4,n+4+i-1):""},l1=o1,c1=function(e,n){var i=Vi(e,n);return i>0?Kc(e,n+4,n+4+i-1):""},h1=c1,u1=function(e,n){var i=2*Vi(e,n);return i>0?Kc(e,n+4,n+4+i-1):""},f1=u1,d1=function(n,i){var c=Vi(n,i);return c>0?$0(n,i+4,i+4+c):""},p1=d1,m1=function(e,n){var i=Vi(e,n);return i>0?Kc(e,n+4,n+4+i):""},g1=m1,x1=function(e,n){return kb(e,n)},Iu=x1,_1=function(n){return Array.isArray(n)||typeof Uint8Array<"u"&&n instanceof Uint8Array};vr&&(l1=function(n,i){if(!Buffer.isBuffer(n))return o1(n,i);var c=n.readUInt32LE(i);return c>0?n.toString("utf8",i+4,i+4+c-1):""},h1=function(n,i){if(!Buffer.isBuffer(n))return c1(n,i);var c=n.readUInt32LE(i);return c>0?n.toString("utf8",i+4,i+4+c-1):""},f1=function(n,i){if(!Buffer.isBuffer(n))return u1(n,i);var c=2*n.readUInt32LE(i);return n.toString("utf16le",i+4,i+4+c-1)},p1=function(n,i){if(!Buffer.isBuffer(n))return d1(n,i);var c=n.readUInt32LE(i);return n.toString("utf16le",i+4,i+4+c)},g1=function(n,i){if(!Buffer.isBuffer(n))return m1(n,i);var c=n.readUInt32LE(i);return n.toString("utf8",i+4,i+4+c)},Iu=function(n,i){return Buffer.isBuffer(n)?n.readDoubleLE(i):x1(n,i)},_1=function(n){return Buffer.isBuffer(n)||Array.isArray(n)||typeof Uint8Array<"u"&&n instanceof Uint8Array});var ol=function(e,n){return e[n]},rs=function(e,n){return e[n+1]*256+e[n]},Ab=function(e,n){var i=e[n+1]*256+e[n];return i<32768?i:(65535-i+1)*-1},Vi=function(e,n){return e[n+3]*(1<<24)+(e[n+2]<<16)+(e[n+1]<<8)+e[n]},io=function(e,n){return e[n+3]<<24|e[n+2]<<16|e[n+1]<<8|e[n]},Ib=function(e,n){return e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3]};function Mc(e,n){var i="",c,h,m=[],x,o,S,b;switch(n){case"dbcs":if(b=this.l,vr&&Buffer.isBuffer(this))i=this.slice(this.l,this.l+2*e).toString("utf16le");else for(S=0;S<e;++S)i+=String.fromCharCode(rs(this,b)),b+=2;e*=2;break;case"utf8":i=Kc(this,this.l,this.l+e);break;case"utf16le":e*=2,i=$0(this,this.l,this.l+e);break;case"wstr":return Mc.call(this,e,"dbcs");case"lpstr-ansi":i=l1(this,this.l),e=4+Vi(this,this.l);break;case"lpstr-cp":i=h1(this,this.l),e=4+Vi(this,this.l);break;case"lpwstr":i=f1(this,this.l),e=4+2*Vi(this,this.l);break;case"lpp4":e=4+Vi(this,this.l),i=p1(this,this.l),e&2&&(e+=2);break;case"8lpp4":e=4+Vi(this,this.l),i=g1(this,this.l),e&3&&(e+=4-(e&3));break;case"cstr":for(e=0,i="";(x=ol(this,this.l+e++))!==0;)m.push(hu(x));i=m.join("");break;case"_wstr":for(e=0,i="";(x=rs(this,this.l+e))!==0;)m.push(hu(x)),e+=2;e+=2,i=m.join("");break;case"dbcs-cont":for(i="",b=this.l,S=0;S<e;++S){if(this.lens&&this.lens.indexOf(b)!==-1)return x=ol(this,b),this.l=b+1,o=Mc.call(this,e-S,x?"dbcs-cont":"sbcs-cont"),m.join("")+o;m.push(hu(rs(this,b))),b+=2}i=m.join(""),e*=2;break;case"cpstr":case"sbcs-cont":for(i="",b=this.l,S=0;S!=e;++S){if(this.lens&&this.lens.indexOf(b)!==-1)return x=ol(this,b),this.l=b+1,o=Mc.call(this,e-S,x?"dbcs-cont":"sbcs-cont"),m.join("")+o;m.push(hu(ol(this,b))),b+=1}i=m.join("");break;default:switch(e){case 1:return c=ol(this,this.l),this.l++,c;case 2:return c=(n==="i"?Ab:rs)(this,this.l),this.l+=2,c;case 4:case-4:return n==="i"||!(this[this.l+3]&128)?(c=(e>0?io:Ib)(this,this.l),this.l+=4,c):(h=Vi(this,this.l),this.l+=4,h);case 8:case-8:if(n==="f")return e==8?h=Iu(this,this.l):h=Iu([this[this.l+7],this[this.l+6],this[this.l+5],this[this.l+4],this[this.l+3],this[this.l+2],this[this.l+1],this[this.l+0]],0),this.l+=8,h;e=8;case 16:i=s1(this,this.l,e);break}}return this.l+=e,i}var Fb=function(e,n,i){e[i]=n&255,e[i+1]=n>>>8&255,e[i+2]=n>>>16&255,e[i+3]=n>>>24&255},Pb=function(e,n,i){e[i]=n&255,e[i+1]=n>>8&255,e[i+2]=n>>16&255,e[i+3]=n>>24&255},Mb=function(e,n,i){e[i]=n&255,e[i+1]=n>>>8&255};function Db(e,n,i){var c=0,h=0;if(i==="dbcs"){for(h=0;h!=n.length;++h)Mb(this,n.charCodeAt(h),this.l+2*h);c=2*n.length}else if(i==="sbcs"){for(n=n.replace(/[^\x00-\x7F]/g,"_"),h=0;h!=n.length;++h)this[this.l+h]=n.charCodeAt(h)&255;c=n.length}else if(i==="hex"){for(;h<e;++h)this[this.l++]=parseInt(n.slice(2*h,2*h+2),16)||0;return this}else if(i==="utf16le"){var m=Math.min(this.l+e,this.length);for(h=0;h<Math.min(n.length,e);++h){var x=n.charCodeAt(h);this[this.l++]=x&255,this[this.l++]=x>>8}for(;this.l<m;)this[this.l++]=0;return this}else switch(e){case 1:c=1,this[this.l]=n&255;break;case 2:c=2,this[this.l]=n&255,n>>>=8,this[this.l+1]=n&255;break;case 3:c=3,this[this.l]=n&255,n>>>=8,this[this.l+1]=n&255,n>>>=8,this[this.l+2]=n&255;break;case 4:c=4,Fb(this,n,this.l);break;case 8:if(c=8,i==="f"){Cb(this,n,this.l);break}case 16:break;case-4:c=4,Pb(this,n,this.l);break}return this.l+=c,this}function y1(e,n){var i=s1(this,this.l,e.length>>1);if(i!==e)throw new Error(n+"Expected "+e+" saw "+i);this.l+=e.length>>1}function Za(e,n){e.l=n,e.read_shift=Mc,e.chk=y1,e.write_shift=Db}function ui(e,n){e.l+=n}function Fa(e){var n=Ds(e);return Za(n,0),n}function ss(e,n,i){if(e){var c,h,m;Za(e,e.l||0);for(var x=e.length,o=0,S=0;e.l<x;){o=e.read_shift(1),o&128&&(o=(o&127)+((e.read_shift(1)&127)<<7));var b=Ru[o]||Ru[65535];for(c=e.read_shift(1),m=c&127,h=1;h<4&&c&128;++h)m+=((c=e.read_shift(1))&127)<<7*h;S=e.l+m;var C=b.f&&b.f(e,m,i);if(e.l=S,n(C,b,o))return}}}function _0(){var e=[],n=vr?256:2048,i=function(b){var C=Fa(b);return Za(C,0),C},c=i(n),h=function(){c&&(c.length>c.l&&(c=c.slice(0,c.l),c.l=c.length),c.length>0&&e.push(c),c=null)},m=function(b){return c&&b<c.length-c.l?c:(h(),c=i(Math.max(b+1,n)))},x=function(){return h(),As(e)},o=function(b){h(),c=b,c.l==null&&(c.l=c.length),m(n)};return{next:m,push:o,end:x,_bufs:e}}function Dc(e,n,i){var c=Xa(e);if(n.s?(c.cRel&&(c.c+=n.s.c),c.rRel&&(c.r+=n.s.r)):(c.cRel&&(c.c+=n.c),c.rRel&&(c.r+=n.r)),!i||i.biff<12){for(;c.c>=256;)c.c-=256;for(;c.r>=65536;)c.r-=65536}return c}function Lm(e,n,i){var c=Xa(e);return c.s=Dc(c.s,n.s,i),c.e=Dc(c.e,n.s,i),c}function Lc(e,n){if(e.cRel&&e.c<0)for(e=Xa(e);e.c<0;)e.c+=n>8?16384:256;if(e.rRel&&e.r<0)for(e=Xa(e);e.r<0;)e.r+=n>8?1048576:n>5?65536:16384;var i=sr(e);return!e.cRel&&e.cRel!=null&&(i=Ob(i)),!e.rRel&&e.rRel!=null&&(i=Lb(i)),i}function i0(e,n){return e.s.r==0&&!e.s.rRel&&e.e.r==(n.biff>=12?1048575:n.biff>=8?65536:16384)&&!e.e.rRel?(e.s.cRel?"":"$")+Pa(e.s.c)+":"+(e.e.cRel?"":"$")+Pa(e.e.c):e.s.c==0&&!e.s.cRel&&e.e.c==(n.biff>=12?16383:255)&&!e.e.cRel?(e.s.rRel?"":"$")+Ka(e.s.r)+":"+(e.e.rRel?"":"$")+Ka(e.e.r):Lc(e.s,n.biff)+":"+Lc(e.e,n.biff)}function j0(e){return parseInt(Rb(e),10)-1}function Ka(e){return""+(e+1)}function Lb(e){return e.replace(/([A-Z]|^)(\d+)$/,"$1$$$2")}function Rb(e){return e.replace(/\$(\d+)$/,"$1")}function G0(e){for(var n=Bb(e),i=0,c=0;c!==n.length;++c)i=26*i+n.charCodeAt(c)-64;return i-1}function Pa(e){if(e<0)throw new Error("invalid column "+e);var n="";for(++e;e;e=Math.floor((e-1)/26))n=String.fromCharCode((e-1)%26+65)+n;return n}function Ob(e){return e.replace(/^([A-Z])/,"$$$1")}function Bb(e){return e.replace(/^\$([A-Z])/,"$1")}function zb(e){return e.replace(/(\$?[A-Z]*)(\$?\d*)/,"$1,$2").split(",")}function Si(e){for(var n=0,i=0,c=0;c<e.length;++c){var h=e.charCodeAt(c);h>=48&&h<=57?n=10*n+(h-48):h>=65&&h<=90&&(i=26*i+(h-64))}return{c:i-1,r:n-1}}function sr(e){for(var n=e.c+1,i="";n;n=(n-1)/26|0)i=String.fromCharCode((n-1)%26+65)+i;return i+(e.r+1)}function yl(e){var n=e.indexOf(":");return n==-1?{s:Si(e),e:Si(e)}:{s:Si(e.slice(0,n)),e:Si(e.slice(n+1))}}function Tr(e,n){return typeof n>"u"||typeof n=="number"?Tr(e.s,e.e):(typeof e!="string"&&(e=sr(e)),typeof n!="string"&&(n=sr(n)),e==n?e:e+":"+n)}function ha(e){var n={s:{c:0,r:0},e:{c:0,r:0}},i=0,c=0,h=0,m=e.length;for(i=0;c<m&&!((h=e.charCodeAt(c)-64)<1||h>26);++c)i=26*i+h;for(n.s.c=--i,i=0;c<m&&!((h=e.charCodeAt(c)-48)<0||h>9);++c)i=10*i+h;if(n.s.r=--i,c===m||h!=10)return n.e.c=n.s.c,n.e.r=n.s.r,n;for(++c,i=0;c!=m&&!((h=e.charCodeAt(c)-64)<1||h>26);++c)i=26*i+h;for(n.e.c=--i,i=0;c!=m&&!((h=e.charCodeAt(c)-48)<0||h>9);++c)i=10*i+h;return n.e.r=--i,n}function Rm(e,n){var i=e.t=="d"&&n instanceof Date;if(e.z!=null)try{return e.w=nn(e.z,i?Ci(n):n)}catch{}try{return e.w=nn((e.XF||{}).numFmtId||(i?14:0),i?Ci(n):n)}catch{return""+n}}function ns(e,n,i){return e==null||e.t==null||e.t=="z"?"":e.w!==void 0?e.w:(e.t=="d"&&!e.z&&i&&i.dateNF&&(e.z=i.dateNF),e.t=="e"?vo[e.v]||e.v:n==null?Rm(e,e.v):Rm(e,n))}function Rs(e,n){var i=n&&n.sheet?n.sheet:"Sheet1",c={};return c[i]=e,{SheetNames:[i],Sheets:c}}function v1(e,n,i){var c=i||{},h=e?Array.isArray(e):c.dense,m=e||(h?[]:{}),x=0,o=0;if(m&&c.origin!=null){if(typeof c.origin=="number")x=c.origin;else{var S=typeof c.origin=="string"?Si(c.origin):c.origin;x=S.r,o=S.c}m["!ref"]||(m["!ref"]="A1:A1")}var b={s:{c:1e7,r:1e7},e:{c:0,r:0}};if(m["!ref"]){var C=ha(m["!ref"]);b.s.c=C.s.c,b.s.r=C.s.r,b.e.c=Math.max(b.e.c,C.e.c),b.e.r=Math.max(b.e.r,C.e.r),x==-1&&(b.e.r=x=C.e.r+1)}for(var M=0;M!=n.length;++M)if(n[M]){if(!Array.isArray(n[M]))throw new Error("aoa_to_sheet expects an array of arrays");for(var L=0;L!=n[M].length;++L)if(!(typeof n[M][L]>"u")){var z={v:n[M][L]},U=x+M,N=o+L;if(b.s.r>U&&(b.s.r=U),b.s.c>N&&(b.s.c=N),b.e.r<U&&(b.e.r=U),b.e.c<N&&(b.e.c=N),n[M][L]&&typeof n[M][L]=="object"&&!Array.isArray(n[M][L])&&!(n[M][L]instanceof Date))z=n[M][L];else if(Array.isArray(z.v)&&(z.f=n[M][L][1],z.v=z.v[0]),z.v===null)if(z.f)z.t="n";else if(c.nullError)z.t="e",z.v=0;else if(c.sheetStubs)z.t="z";else continue;else typeof z.v=="number"?z.t="n":typeof z.v=="boolean"?z.t="b":z.v instanceof Date?(z.z=c.dateNF||hr[14],c.cellDates?(z.t="d",z.w=nn(z.z,Ci(z.v))):(z.t="n",z.v=Ci(z.v),z.w=nn(z.z,z.v))):z.t="s";if(h)m[U]||(m[U]=[]),m[U][N]&&m[U][N].z&&(z.z=m[U][N].z),m[U][N]=z;else{var G=sr({c:N,r:U});m[G]&&m[G].z&&(z.z=m[G].z),m[G]=z}}}return b.s.c<1e7&&(m["!ref"]=Tr(b)),m}function vl(e,n){return v1(null,e,n)}function Nb(e){return e.read_shift(4,"i")}function hi(e){var n=e.read_shift(4);return n===0?"":e.read_shift(n,"dbcs")}function Ub(e){return{ich:e.read_shift(2),ifnt:e.read_shift(2)}}function H0(e,n){var i=e.l,c=e.read_shift(1),h=hi(e),m=[],x={t:h,h};if(c&1){for(var o=e.read_shift(4),S=0;S!=o;++S)m.push(Ub(e));x.r=m}else x.r=[{ich:0,ifnt:0}];return e.l=i+n,x}var Vb=H0;function sn(e){var n=e.read_shift(4),i=e.read_shift(2);return i+=e.read_shift(1)<<16,e.l++,{c:n,iStyleRef:i}}function _o(e){var n=e.read_shift(2);return n+=e.read_shift(1)<<16,e.l++,{c:-1,iStyleRef:n}}var $b=hi;function q0(e){var n=e.read_shift(4);return n===0||n===4294967295?"":e.read_shift(n,"dbcs")}var jb=hi,y0=q0;function W0(e){var n=e.slice(e.l,e.l+4),i=n[0]&1,c=n[0]&2;e.l+=4;var h=c===0?Iu([0,0,0,0,n[0]&252,n[1],n[2],n[3]],0):io(n,0)>>2;return i?h/100:h}function w1(e){var n={s:{},e:{}};return n.s.r=e.read_shift(4),n.e.r=e.read_shift(4),n.s.c=e.read_shift(4),n.e.c=e.read_shift(4),n}var yo=w1;function li(e){if(e.length-e.l<8)throw"XLS Xnum Buffer underflow";return e.read_shift(8,"f")}function Gb(e){var n={},i=e.read_shift(1),c=i>>>1,h=e.read_shift(1),m=e.read_shift(2,"i"),x=e.read_shift(1),o=e.read_shift(1),S=e.read_shift(1);switch(e.l++,c){case 0:n.auto=1;break;case 1:n.index=h;var b=ho[h];b&&(n.rgb=Hc(b));break;case 2:n.rgb=Hc([x,o,S]);break;case 3:n.theme=h;break}return m!=0&&(n.tint=m>0?m/32767:m/32768),n}function Hb(e){var n=e.read_shift(1);e.l++;var i={fBold:n&1,fItalic:n&2,fUnderline:n&4,fStrikeout:n&8,fOutline:n&16,fShadow:n&32,fCondense:n&64,fExtend:n&128};return i}function b1(e,n){var i={2:"BITMAP",3:"METAFILEPICT",8:"DIB",14:"ENHMETAFILE"},c=e.read_shift(4);switch(c){case 0:return"";case 4294967295:case 4294967294:return i[e.read_shift(4)]||""}if(c>400)throw new Error("Unsupported Clipboard: "+c.toString(16));return e.l-=4,e.read_shift(0,n==1?"lpstr":"lpwstr")}function qb(e){return b1(e,1)}function Wb(e){return b1(e,2)}var Z0=2,Li=3,fu=11,Om=12,Fu=19,du=64,Zb=65,Xb=71,Kb=4108,Yb=4126,Ba=80,T1=81,Jb=[Ba,T1],Qb={1:{n:"CodePage",t:Z0},2:{n:"Category",t:Ba},3:{n:"PresentationFormat",t:Ba},4:{n:"ByteCount",t:Li},5:{n:"LineCount",t:Li},6:{n:"ParagraphCount",t:Li},7:{n:"SlideCount",t:Li},8:{n:"NoteCount",t:Li},9:{n:"HiddenCount",t:Li},10:{n:"MultimediaClipCount",t:Li},11:{n:"ScaleCrop",t:fu},12:{n:"HeadingPairs",t:Kb},13:{n:"TitlesOfParts",t:Yb},14:{n:"Manager",t:Ba},15:{n:"Company",t:Ba},16:{n:"LinksUpToDate",t:fu},17:{n:"CharacterCount",t:Li},19:{n:"SharedDoc",t:fu},22:{n:"HyperlinksChanged",t:fu},23:{n:"AppVersion",t:Li,p:"version"},24:{n:"DigSig",t:Zb},26:{n:"ContentType",t:Ba},27:{n:"ContentStatus",t:Ba},28:{n:"Language",t:Ba},29:{n:"Version",t:Ba},255:{},2147483648:{n:"Locale",t:Fu},2147483651:{n:"Behavior",t:Fu},1919054434:{}},eT={1:{n:"CodePage",t:Z0},2:{n:"Title",t:Ba},3:{n:"Subject",t:Ba},4:{n:"Author",t:Ba},5:{n:"Keywords",t:Ba},6:{n:"Comments",t:Ba},7:{n:"Template",t:Ba},8:{n:"LastAuthor",t:Ba},9:{n:"RevNumber",t:Ba},10:{n:"EditTime",t:du},11:{n:"LastPrinted",t:du},12:{n:"CreatedDate",t:du},13:{n:"ModifiedDate",t:du},14:{n:"PageCount",t:Li},15:{n:"WordCount",t:Li},16:{n:"CharCount",t:Li},17:{n:"Thumbnail",t:Xb},18:{n:"Application",t:Ba},19:{n:"DocSecurity",t:Li},255:{},2147483648:{n:"Locale",t:Fu},2147483651:{n:"Behavior",t:Fu},1919054434:{}},Bm={1:"US",2:"CA",3:"",7:"RU",20:"EG",30:"GR",31:"NL",32:"BE",33:"FR",34:"ES",36:"HU",39:"IT",41:"CH",43:"AT",44:"GB",45:"DK",46:"SE",47:"NO",48:"PL",49:"DE",52:"MX",55:"BR",61:"AU",64:"NZ",66:"TH",81:"JP",82:"KR",84:"VN",86:"CN",90:"TR",105:"JS",213:"DZ",216:"MA",218:"LY",351:"PT",354:"IS",358:"FI",420:"CZ",886:"TW",961:"LB",962:"JO",963:"SY",964:"IQ",965:"KW",966:"SA",971:"AE",972:"IL",974:"QA",981:"IR",65535:"US"},tT=[null,"solid","mediumGray","darkGray","lightGray","darkHorizontal","darkVertical","darkDown","darkUp","darkGrid","darkTrellis","lightHorizontal","lightVertical","lightDown","lightUp","lightGrid","lightTrellis","gray125","gray0625"];function rT(e){return e.map(function(n){return[n>>16&255,n>>8&255,n&255]})}var aT=rT([0,16777215,16711680,65280,255,16776960,16711935,65535,0,16777215,16711680,65280,255,16776960,16711935,65535,8388608,32768,128,8421376,8388736,32896,12632256,8421504,10066431,10040166,16777164,13434879,6684774,16744576,26316,13421823,128,16711935,16776960,65535,8388736,8388608,32896,255,52479,13434879,13434828,16777113,10079487,16751052,13408767,16764057,3368703,3394764,10079232,16763904,16750848,16737792,6710937,9868950,13158,3381606,13056,3355392,10040064,10040166,3355545,3355443,16777215,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),ho=Xa(aT),vo={0:"#NULL!",7:"#DIV/0!",15:"#VALUE!",23:"#REF!",29:"#NAME?",36:"#NUM!",42:"#N/A",43:"#GETTING_DATA",255:"#WTF?"},E1={"#NULL!":0,"#DIV/0!":7,"#VALUE!":15,"#REF!":23,"#NAME?":29,"#NUM!":36,"#N/A":42,"#GETTING_DATA":43,"#WTF?":255},zm={"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml":"workbooks","application/vnd.ms-excel.sheet.macroEnabled.main+xml":"workbooks","application/vnd.ms-excel.sheet.binary.macroEnabled.main":"workbooks","application/vnd.ms-excel.addin.macroEnabled.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml":"sheets","application/vnd.ms-excel.worksheet":"sheets","application/vnd.ms-excel.binIndexWs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml":"charts","application/vnd.ms-excel.chartsheet":"charts","application/vnd.ms-excel.macrosheet+xml":"macros","application/vnd.ms-excel.macrosheet":"macros","application/vnd.ms-excel.intlmacrosheet":"TODO","application/vnd.ms-excel.binIndexMs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml":"dialogs","application/vnd.ms-excel.dialogsheet":"dialogs","application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml":"strs","application/vnd.ms-excel.sharedStrings":"strs","application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml":"styles","application/vnd.ms-excel.styles":"styles","application/vnd.openxmlformats-package.core-properties+xml":"coreprops","application/vnd.openxmlformats-officedocument.custom-properties+xml":"custprops","application/vnd.openxmlformats-officedocument.extended-properties+xml":"extprops","application/vnd.openxmlformats-officedocument.customXmlProperties+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.customProperty":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml":"comments","application/vnd.ms-excel.comments":"comments","application/vnd.ms-excel.threadedcomments+xml":"threadedcomments","application/vnd.ms-excel.person+xml":"people","application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml":"metadata","application/vnd.ms-excel.sheetMetadata":"metadata","application/vnd.ms-excel.pivotTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotTable+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.chart+xml":"TODO","application/vnd.ms-office.chartcolorstyle+xml":"TODO","application/vnd.ms-office.chartstyle+xml":"TODO","application/vnd.ms-office.chartex+xml":"TODO","application/vnd.ms-excel.calcChain":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.calcChain+xml":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.printerSettings":"TODO","application/vnd.ms-office.activeX":"TODO","application/vnd.ms-office.activeX+xml":"TODO","application/vnd.ms-excel.attachedToolbars":"TODO","application/vnd.ms-excel.connections":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.connections+xml":"TODO","application/vnd.ms-excel.externalLink":"links","application/vnd.openxmlformats-officedocument.spreadsheetml.externalLink+xml":"links","application/vnd.ms-excel.pivotCacheDefinition":"TODO","application/vnd.ms-excel.pivotCacheRecords":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheDefinition+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheRecords+xml":"TODO","application/vnd.ms-excel.queryTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.queryTable+xml":"TODO","application/vnd.ms-excel.userNames":"TODO","application/vnd.ms-excel.revisionHeaders":"TODO","application/vnd.ms-excel.revisionLog":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionHeaders+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionLog+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.userNames+xml":"TODO","application/vnd.ms-excel.tableSingleCells":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.tableSingleCells+xml":"TODO","application/vnd.ms-excel.slicer":"TODO","application/vnd.ms-excel.slicerCache":"TODO","application/vnd.ms-excel.slicer+xml":"TODO","application/vnd.ms-excel.slicerCache+xml":"TODO","application/vnd.ms-excel.wsSortMap":"TODO","application/vnd.ms-excel.table":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml":"TODO","application/vnd.openxmlformats-officedocument.theme+xml":"themes","application/vnd.openxmlformats-officedocument.themeOverride+xml":"TODO","application/vnd.ms-excel.Timeline+xml":"TODO","application/vnd.ms-excel.TimelineCache+xml":"TODO","application/vnd.ms-office.vbaProject":"vba","application/vnd.ms-office.vbaProjectSignature":"TODO","application/vnd.ms-office.volatileDependencies":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.volatileDependencies+xml":"TODO","application/vnd.ms-excel.controlproperties+xml":"TODO","application/vnd.openxmlformats-officedocument.model+data":"TODO","application/vnd.ms-excel.Survey+xml":"TODO","application/vnd.openxmlformats-officedocument.drawing+xml":"drawings","application/vnd.openxmlformats-officedocument.drawingml.chartshapes+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramColors+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramData+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramLayout+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramStyle+xml":"TODO","application/vnd.openxmlformats-officedocument.vmlDrawing":"TODO","application/vnd.openxmlformats-package.relationships+xml":"rels","application/vnd.openxmlformats-officedocument.oleObject":"TODO","image/png":"TODO",sheet:"js"};function iT(){return{workbooks:[],sheets:[],charts:[],dialogs:[],macros:[],rels:[],strs:[],comments:[],threadedcomments:[],links:[],coreprops:[],extprops:[],custprops:[],themes:[],styles:[],calcchains:[],vba:[],drawings:[],metadata:[],people:[],TODO:[],xmlns:""}}function nT(e){var n=iT();if(!e||!e.match)return n;var i={};if((e.match(fi)||[]).forEach(function(c){var h=rr(c);switch(h[0].replace(db,"<")){case"<?xml":break;case"<Types":n.xmlns=h["xmlns"+(h[0].match(/<(\w+):/)||["",""])[1]];break;case"<Default":i[h.Extension]=h.ContentType;break;case"<Override":n[zm[h.ContentType]]!==void 0&&n[zm[h.ContentType]].push(h.PartName);break}}),n.xmlns!==Eb.CT)throw new Error("Unknown Namespace: "+n.xmlns);return n.calcchain=n.calcchains.length>0?n.calcchains[0]:"",n.sst=n.strs.length>0?n.strs[0]:"",n.style=n.styles.length>0?n.styles[0]:"",n.defaults=i,delete n.calcchains,n}var cl={WB:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument",SHEET:"http://sheetjs.openxmlformats.org/officeDocument/2006/relationships/officeDocument",HLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink",VML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/vmlDrawing",XPATH:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLinkPath",XMISS:"http://schemas.microsoft.com/office/2006/relationships/xlExternalLinkPath/xlPathMissing",XLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLink",CXML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXml",CXMLP:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXmlProps",CMNT:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/comments",CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/custom-properties",SST:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings",STY:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles",THEME:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/theme",CHART:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chart",CHARTEX:"http://schemas.microsoft.com/office/2014/relationships/chartEx",CS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chartsheet",WS:["http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet","http://purl.oclc.org/ooxml/officeDocument/relationships/worksheet"],DS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/dialogsheet",MS:"http://schemas.microsoft.com/office/2006/relationships/xlMacrosheet",IMG:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/image",DRAW:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing",XLMETA:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sheetMetadata",TCMNT:"http://schemas.microsoft.com/office/2017/10/relationships/threadedComment",PEOPLE:"http://schemas.microsoft.com/office/2017/10/relationships/person",VBA:"http://schemas.microsoft.com/office/2006/relationships/vbaProject"};function v0(e){var n=e.lastIndexOf("/");return e.slice(0,n+1)+"_rels/"+e.slice(n+1)+".rels"}function Rc(e,n){var i={"!id":{}};if(!e)return i;n.charAt(0)!=="/"&&(n="/"+n);var c={};return(e.match(fi)||[]).forEach(function(h){var m=rr(h);if(m[0]==="<Relationship"){var x={};x.Type=m.Type,x.Target=m.Target,x.Id=m.Id,m.TargetMode&&(x.TargetMode=m.TargetMode);var o=m.TargetMode==="External"?m.Target:Fc(m.Target,n);i[o]=x,c[m.Id]=x}}),i["!id"]=c,i}var sT="application/vnd.oasis.opendocument.spreadsheet";function oT(e,n){for(var i=V0(e),c,h;c=jc.exec(i);)switch(c[3]){case"manifest":break;case"file-entry":if(h=rr(c[0],!1),h.path=="/"&&h.type!==sT)throw new Error("This OpenDocument is not a spreadsheet");break;case"encryption-data":case"algorithm":case"start-key-generation":case"key-derivation":throw new Error("Unsupported ODS Encryption");default:if(n&&n.WTF)throw c}}var Oc=[["cp:category","Category"],["cp:contentStatus","ContentStatus"],["cp:keywords","Keywords"],["cp:lastModifiedBy","LastAuthor"],["cp:lastPrinted","LastPrinted"],["cp:revision","RevNumber"],["cp:version","Version"],["dc:creator","Author"],["dc:description","Comments"],["dc:identifier","Identifier"],["dc:language","Language"],["dc:subject","Subject"],["dc:title","Title"],["dcterms:created","CreatedDate","date"],["dcterms:modified","ModifiedDate","date"]],lT=function(){for(var e=new Array(Oc.length),n=0;n<Oc.length;++n){var i=Oc[n],c="(?:"+i[0].slice(0,i[0].indexOf(":"))+":)"+i[0].slice(i[0].indexOf(":")+1);e[n]=new RegExp("<"+c+"[^>]*>([\\s\\S]*?)</"+c+">")}return e}();function S1(e){var n={};e=jr(e);for(var i=0;i<Oc.length;++i){var c=Oc[i],h=e.match(lT[i]);h!=null&&h.length>0&&(n[c[1]]=Er(h[1])),c[2]==="date"&&n[c[1]]&&(n[c[1]]=za(n[c[1]]))}return n}var cT=[["Application","Application","string"],["AppVersion","AppVersion","string"],["Company","Company","string"],["DocSecurity","DocSecurity","string"],["Manager","Manager","string"],["HyperlinksChanged","HyperlinksChanged","bool"],["SharedDoc","SharedDoc","bool"],["LinksUpToDate","LinksUpToDate","bool"],["ScaleCrop","ScaleCrop","bool"],["HeadingPairs","HeadingPairs","raw"],["TitlesOfParts","TitlesOfParts","raw"]];function k1(e,n,i,c){var h=[];if(typeof e=="string")h=Am(e,c);else for(var m=0;m<e.length;++m)h=h.concat(e[m].map(function(C){return{v:C}}));var x=typeof n=="string"?Am(n,c).map(function(C){return C.v}):n,o=0,S=0;if(x.length>0)for(var b=0;b!==h.length;b+=2){switch(S=+h[b+1].v,h[b].v){case"Worksheets":case"":case"":case" ":case"":case" ":case"Arbeitsbltter":case"alma Sayfalar":case"Feuilles de calcul":case"Fogli di lavoro":case"Folhas de clculo":case"Planilhas":case"Regneark":case"Hojas de clculo":case"Werkbladen":i.Worksheets=S,i.SheetNames=x.slice(o,o+S);break;case"Named Ranges":case"Rangos con nombre":case"":case"Benannte Bereiche":case"Navngivne omrder":i.NamedRanges=S,i.DefinedNames=x.slice(o,o+S);break;case"Charts":case"Diagramme":i.Chartsheets=S,i.ChartNames=x.slice(o,o+S);break}o+=S}}function hT(e,n,i){var c={};return n||(n={}),e=jr(e),cT.forEach(function(h){var m=(e.match($c(h[0]))||[])[1];switch(h[2]){case"string":m&&(n[h[1]]=Er(m));break;case"bool":n[h[1]]=m==="true";break;case"raw":var x=e.match(new RegExp("<"+h[0]+"[^>]*>([\\s\\S]*?)</"+h[0]+">"));x&&x.length>0&&(c[h[1]]=x[1]);break}}),c.HeadingPairs&&c.TitlesOfParts&&k1(c.HeadingPairs,c.TitlesOfParts,n,i),n}var uT=/<[^>]+>[^<]*/g;function fT(e,n){var i={},c="",h=e.match(uT);if(h)for(var m=0;m!=h.length;++m){var x=h[m],o=rr(x);switch(o[0]){case"<?xml":break;case"<Properties":break;case"<property":c=Er(o.name);break;case"</property>":c=null;break;default:if(x.indexOf("<vt:")===0){var S=x.split(">"),b=S[0].slice(4),C=S[1];switch(b){case"lpstr":case"bstr":case"lpwstr":i[c]=Er(C);break;case"bool":i[c]=ea(C);break;case"i1":case"i2":case"i4":case"i8":case"int":case"uint":i[c]=parseInt(C,10);break;case"r4":case"r8":case"decimal":i[c]=parseFloat(C);break;case"filetime":case"date":i[c]=za(C);break;case"cy":case"error":i[c]=Er(C);break;default:if(b.slice(-1)=="/")break;n.WTF&&typeof console<"u"&&console.warn("Unexpected",x,b,S)}}else if(x.slice(0,2)!=="</"){if(n.WTF)throw new Error(x)}}}return i}var dT={Title:"Title",Subject:"Subject",Author:"Author",Keywords:"Keywords",Comments:"Description",LastAuthor:"LastAuthor",RevNumber:"Revision",Application:"AppName",LastPrinted:"LastPrinted",CreatedDate:"Created",ModifiedDate:"LastSaved",Category:"Category",Manager:"Manager",Company:"Company",AppVersion:"Version",ContentStatus:"ContentStatus",Identifier:"Identifier",Language:"Language"},n0;function pT(e,n,i){n0||(n0=z0(dT)),n=n0[n]||n,e[n]=i}function X0(e){var n=e.read_shift(4),i=e.read_shift(4);return new Date((i/1e7*Math.pow(2,32)+n/1e7-11644473600)*1e3).toISOString().replace(/\.000/,"")}function C1(e,n,i){var c=e.l,h=e.read_shift(0,"lpstr-cp");if(i)for(;e.l-c&3;)++e.l;return h}function A1(e,n,i){var c=e.read_shift(0,"lpwstr");return i&&(e.l+=4-(c.length+1&3)&3),c}function I1(e,n,i){return n===31?A1(e):C1(e,n,i)}function w0(e,n,i){return I1(e,n,i===!1?0:4)}function mT(e,n){if(!n)throw new Error("VtUnalignedString must have positive length");return I1(e,n,0)}function gT(e){for(var n=e.read_shift(4),i=[],c=0;c!=n;++c){var h=e.l;i[c]=e.read_shift(0,"lpwstr").replace(ki,""),e.l-h&2&&(e.l+=2)}return i}function xT(e){for(var n=e.read_shift(4),i=[],c=0;c!=n;++c)i[c]=e.read_shift(0,"lpstr-cp").replace(ki,"");return i}function _T(e){var n=e.l,i=Pu(e,T1);e[e.l]==0&&e[e.l+1]==0&&e.l-n&2&&(e.l+=2);var c=Pu(e,Li);return[i,c]}function yT(e){for(var n=e.read_shift(4),i=[],c=0;c<n/2;++c)i.push(_T(e));return i}function Nm(e,n){for(var i=e.read_shift(4),c={},h=0;h!=i;++h){var m=e.read_shift(4),x=e.read_shift(4);c[m]=e.read_shift(x,n===1200?"utf16le":"utf8").replace(ki,"").replace(Ic,"!"),n===1200&&x%2&&(e.l+=2)}return e.l&3&&(e.l=e.l>>3<<2),c}function F1(e){var n=e.read_shift(4),i=e.slice(e.l,e.l+n);return e.l+=n,(n&3)>0&&(e.l+=4-(n&3)&3),i}function vT(e){var n={};return n.Size=e.read_shift(4),e.l+=n.Size+3-(n.Size-1)%4,n}function Pu(e,n,i){var c=e.read_shift(2),h,m=i||{};if(e.l+=2,n!==Om&&c!==n&&Jb.indexOf(n)===-1&&!((n&65534)==4126&&(c&65534)==4126))throw new Error("Expected type "+n+" saw "+c);switch(n===Om?c:n){case 2:return h=e.read_shift(2,"i"),m.raw||(e.l+=2),h;case 3:return h=e.read_shift(4,"i"),h;case 11:return e.read_shift(4)!==0;case 19:return h=e.read_shift(4),h;case 30:return C1(e,c,4).replace(ki,"");case 31:return A1(e);case 64:return X0(e);case 65:return F1(e);case 71:return vT(e);case 80:return w0(e,c,!m.raw).replace(ki,"");case 81:return mT(e,c).replace(ki,"");case 4108:return yT(e);case 4126:case 4127:return c==4127?gT(e):xT(e);default:throw new Error("TypedPropertyValue unrecognized type "+n+" "+c)}}function Um(e,n){var i=e.l,c=e.read_shift(4),h=e.read_shift(4),m=[],x=0,o=0,S=-1,b={};for(x=0;x!=h;++x){var C=e.read_shift(4),M=e.read_shift(4);m[x]=[C,M+i]}m.sort(function(pe,Y){return pe[1]-Y[1]});var L={};for(x=0;x!=h;++x){if(e.l!==m[x][1]){var z=!0;if(x>0&&n)switch(n[m[x-1][0]].t){case 2:e.l+2===m[x][1]&&(e.l+=2,z=!1);break;case 80:e.l<=m[x][1]&&(e.l=m[x][1],z=!1);break;case 4108:e.l<=m[x][1]&&(e.l=m[x][1],z=!1);break}if((!n||x==0)&&e.l<=m[x][1]&&(z=!1,e.l=m[x][1]),z)throw new Error("Read Error: Expected address "+m[x][1]+" at "+e.l+" :"+x)}if(n){var U=n[m[x][0]];if(L[U.n]=Pu(e,U.t,{raw:!0}),U.p==="version"&&(L[U.n]=String(L[U.n]>>16)+"."+("0000"+String(L[U.n]&65535)).slice(-4)),U.n=="CodePage")switch(L[U.n]){case 0:L[U.n]=1252;case 874:case 932:case 936:case 949:case 950:case 1250:case 1251:case 1253:case 1254:case 1255:case 1256:case 1257:case 1258:case 1e4:case 1200:case 1201:case 1252:case 65e3:case-536:case 65001:case-535:wn(o=L[U.n]>>>0&65535);break;default:throw new Error("Unsupported CodePage: "+L[U.n])}}else if(m[x][0]===1){if(o=L.CodePage=Pu(e,Z0),wn(o),S!==-1){var N=e.l;e.l=m[S][1],b=Nm(e,o),e.l=N}}else if(m[x][0]===0){if(o===0){S=x,e.l=m[x+1][1];continue}b=Nm(e,o)}else{var G=b[m[x][0]],ie;switch(e[e.l]){case 65:e.l+=4,ie=F1(e);break;case 30:e.l+=4,ie=w0(e,e[e.l-4]).replace(/\u0000+$/,"");break;case 31:e.l+=4,ie=w0(e,e[e.l-4]).replace(/\u0000+$/,"");break;case 3:e.l+=4,ie=e.read_shift(4,"i");break;case 19:e.l+=4,ie=e.read_shift(4);break;case 5:e.l+=4,ie=e.read_shift(8,"f");break;case 11:e.l+=4,ie=wa(e,4);break;case 64:e.l+=4,ie=za(X0(e));break;default:throw new Error("unparsed value: "+e[e.l])}L[G]=ie}}return e.l=i+c,L}function Vm(e,n,i){var c=e.content;if(!c)return{};Za(c,0);var h,m,x,o,S=0;c.chk("feff","Byte Order: "),c.read_shift(2);var b=c.read_shift(4),C=c.read_shift(16);if(C!==br.utils.consts.HEADER_CLSID&&C!==i)throw new Error("Bad PropertySet CLSID "+C);if(h=c.read_shift(4),h!==1&&h!==2)throw new Error("Unrecognized #Sets: "+h);if(m=c.read_shift(16),o=c.read_shift(4),h===1&&o!==c.l)throw new Error("Length mismatch: "+o+" !== "+c.l);h===2&&(x=c.read_shift(16),S=c.read_shift(4));var M=Um(c,n),L={SystemIdentifier:b};for(var z in M)L[z]=M[z];if(L.FMTID=m,h===1)return L;if(S-c.l==2&&(c.l+=2),c.l!==S)throw new Error("Length mismatch 2: "+c.l+" !== "+S);var U;try{U=Um(c,null)}catch{}for(z in U)L[z]=U[z];return L.FMTID=[m,x],L}function ks(e,n){return e.read_shift(n),null}function wT(e,n,i){for(var c=[],h=e.l+n;e.l<h;)c.push(i(e,h-e.l));if(h!==e.l)throw new Error("Slurp error");return c}function wa(e,n){return e.read_shift(n)===1}function Ea(e){return e.read_shift(2,"u")}function P1(e,n){return wT(e,n,Ea)}function bT(e){var n=e.read_shift(1),i=e.read_shift(1);return i===1?n:n===1}function Yc(e,n,i){var c=e.read_shift(i&&i.biff>=12?2:1),h="sbcs-cont";if(i&&i.biff>=8,!i||i.biff==8){var m=e.read_shift(1);m&&(h="dbcs-cont")}else i.biff==12&&(h="wstr");i.biff>=2&&i.biff<=5&&(h="cpstr");var x=c?e.read_shift(c,h):"";return x}function TT(e){var n=e.read_shift(2),i=e.read_shift(1),c=i&4,h=i&8,m=1+(i&1),x=0,o,S={};h&&(x=e.read_shift(2)),c&&(o=e.read_shift(4));var b=m==2?"dbcs-cont":"sbcs-cont",C=n===0?"":e.read_shift(n,b);return h&&(e.l+=4*x),c&&(e.l+=o),S.t=C,h||(S.raw="<t>"+S.t+"</t>",S.r=S.t),S}function po(e,n,i){var c;if(i){if(i.biff>=2&&i.biff<=5)return e.read_shift(n,"cpstr");if(i.biff>=12)return e.read_shift(n,"dbcs-cont")}var h=e.read_shift(1);return h===0?c=e.read_shift(n,"sbcs-cont"):c=e.read_shift(n,"dbcs-cont"),c}function Jc(e,n,i){var c=e.read_shift(i&&i.biff==2?1:2);return c===0?(e.l++,""):po(e,c,i)}function wo(e,n,i){if(i.biff>5)return Jc(e,n,i);var c=e.read_shift(1);return c===0?(e.l++,""):e.read_shift(c,i.biff<=4||!e.lens?"cpstr":"sbcs-cont")}function ET(e){var n=e.read_shift(1);e.l++;var i=e.read_shift(2);return e.l+=2,[n,i]}function ST(e){var n=e.read_shift(4),i=e.l,c=!1;n>24&&(e.l+=n-24,e.read_shift(16)==="795881f43b1d7f48af2c825dc4852763"&&(c=!0),e.l=i);var h=e.read_shift((c?n-24:n)>>1,"utf16le").replace(ki,"");return c&&(e.l+=24),h}function kT(e){for(var n=e.read_shift(2),i="";n-- >0;)i+="../";var c=e.read_shift(0,"lpstr-ansi");if(e.l+=2,e.read_shift(2)!=57005)throw new Error("Bad FileMoniker");var h=e.read_shift(4);if(h===0)return i+c.replace(/\\/g,"/");var m=e.read_shift(4);if(e.read_shift(2)!=3)throw new Error("Bad FileMoniker");var x=e.read_shift(m>>1,"utf16le").replace(ki,"");return i+x}function CT(e,n){var i=e.read_shift(16);switch(i){case"e0c9ea79f9bace118c8200aa004ba90b":return ST(e);case"0303000000000000c000000000000046":return kT(e);default:throw new Error("Unsupported Moniker "+i)}}function pu(e){var n=e.read_shift(4),i=n>0?e.read_shift(n,"utf16le").replace(ki,""):"";return i}function AT(e,n){var i=e.l+n,c=e.read_shift(4);if(c!==2)throw new Error("Unrecognized streamVersion: "+c);var h=e.read_shift(2);e.l+=2;var m,x,o,S,b="",C,M;h&16&&(m=pu(e,i-e.l)),h&128&&(x=pu(e,i-e.l)),(h&257)===257&&(o=pu(e,i-e.l)),(h&257)===1&&(S=CT(e,i-e.l)),h&8&&(b=pu(e,i-e.l)),h&32&&(C=e.read_shift(16)),h&64&&(M=X0(e)),e.l=i;var L=x||o||S||"";L&&b&&(L+="#"+b),L||(L="#"+b),h&2&&L.charAt(0)=="/"&&L.charAt(1)!="/"&&(L="file://"+L);var z={Target:L};return C&&(z.guid=C),M&&(z.time=M),m&&(z.Tooltip=m),z}function M1(e){var n=e.read_shift(1),i=e.read_shift(1),c=e.read_shift(1),h=e.read_shift(1);return[n,i,c,h]}function D1(e,n){var i=M1(e);return i[3]=0,i}function zn(e){var n=e.read_shift(2),i=e.read_shift(2),c=e.read_shift(2);return{r:n,c:i,ixfe:c}}function IT(e){var n=e.read_shift(2),i=e.read_shift(2);return e.l+=8,{type:n,flags:i}}function FT(e,n,i){return n===0?"":wo(e,n,i)}function PT(e,n,i){var c=i.biff>8?4:2,h=e.read_shift(c),m=e.read_shift(c,"i"),x=e.read_shift(c,"i");return[h,m,x]}function L1(e){var n=e.read_shift(2),i=W0(e);return[n,i]}function MT(e,n,i){e.l+=4,n-=4;var c=e.l+n,h=Yc(e,n,i),m=e.read_shift(2);if(c-=e.l,m!==c)throw new Error("Malformed AddinUdf: padding = "+c+" != "+m);return e.l+=m,h}function Nu(e){var n=e.read_shift(2),i=e.read_shift(2),c=e.read_shift(2),h=e.read_shift(2);return{s:{c,r:n},e:{c:h,r:i}}}function R1(e){var n=e.read_shift(2),i=e.read_shift(2),c=e.read_shift(1),h=e.read_shift(1);return{s:{c,r:n},e:{c:h,r:i}}}var DT=R1;function O1(e){e.l+=4;var n=e.read_shift(2),i=e.read_shift(2),c=e.read_shift(2);return e.l+=12,[i,n,c]}function LT(e){var n={};return e.l+=4,e.l+=16,n.fSharedNote=e.read_shift(2),e.l+=4,n}function RT(e){var n={};return e.l+=4,e.cf=e.read_shift(2),n}function si(e){e.l+=2,e.l+=e.read_shift(2)}var OT={0:si,4:si,5:si,6:si,7:RT,8:si,9:si,10:si,11:si,12:si,13:LT,14:si,15:si,16:si,17:si,18:si,19:si,20:si,21:O1};function BT(e,n){for(var i=e.l+n,c=[];e.l<i;){var h=e.read_shift(2);e.l-=2;try{c.push(OT[h](e,i-e.l))}catch{return e.l=i,c}}return e.l!=i&&(e.l=i),c}function mu(e,n){var i={BIFFVer:0,dt:0};switch(i.BIFFVer=e.read_shift(2),n-=2,n>=2&&(i.dt=e.read_shift(2),e.l-=2),i.BIFFVer){case 1536:case 1280:case 1024:case 768:case 512:case 2:case 7:break;default:if(n>6)throw new Error("Unexpected BIFF Ver "+i.BIFFVer)}return e.read_shift(n),i}function zT(e,n){return n===0||e.read_shift(2),1200}function NT(e,n,i){if(i.enc)return e.l+=n,"";var c=e.l,h=wo(e,0,i);return e.read_shift(n+c-e.l),h}function UT(e,n,i){var c=i&&i.biff==8||n==2?e.read_shift(2):(e.l+=n,0);return{fDialog:c&16,fBelow:c&64,fRight:c&128}}function VT(e,n,i){var c=e.read_shift(4),h=e.read_shift(1)&3,m=e.read_shift(1);switch(m){case 0:m="Worksheet";break;case 1:m="Macrosheet";break;case 2:m="Chartsheet";break;case 6:m="VBAModule";break}var x=Yc(e,0,i);return x.length===0&&(x="Sheet1"),{pos:c,hs:h,dt:m,name:x}}function $T(e,n){for(var i=e.l+n,c=e.read_shift(4),h=e.read_shift(4),m=[],x=0;x!=h&&e.l<i;++x)m.push(TT(e));return m.Count=c,m.Unique=h,m}function jT(e,n){var i={};return i.dsst=e.read_shift(2),e.l+=n-2,i}function GT(e){var n={};n.r=e.read_shift(2),n.c=e.read_shift(2),n.cnt=e.read_shift(2)-n.c;var i=e.read_shift(2);e.l+=4;var c=e.read_shift(1);return e.l+=3,c&7&&(n.level=c&7),c&32&&(n.hidden=!0),c&64&&(n.hpt=i/20),n}function HT(e){var n=IT(e);if(n.type!=2211)throw new Error("Invalid Future Record "+n.type);var i=e.read_shift(4);return i!==0}function qT(e){return e.read_shift(2),e.read_shift(4)}function $m(e,n,i){var c=0;i&&i.biff==2||(c=e.read_shift(2));var h=e.read_shift(2);i&&i.biff==2&&(c=1-(h>>15),h&=32767);var m={Unsynced:c&1,DyZero:(c&2)>>1,ExAsc:(c&4)>>2,ExDsc:(c&8)>>3};return[m,h]}function WT(e){var n=e.read_shift(2),i=e.read_shift(2),c=e.read_shift(2),h=e.read_shift(2),m=e.read_shift(2),x=e.read_shift(2),o=e.read_shift(2),S=e.read_shift(2),b=e.read_shift(2);return{Pos:[n,i],Dim:[c,h],Flags:m,CurTab:x,FirstTab:o,Selected:S,TabRatio:b}}function ZT(e,n,i){if(i&&i.biff>=2&&i.biff<5)return{};var c=e.read_shift(2);return{RTL:c&64}}function XT(){}function KT(e,n,i){var c={dyHeight:e.read_shift(2),fl:e.read_shift(2)};switch(i&&i.biff||8){case 2:break;case 3:case 4:e.l+=2;break;default:e.l+=10;break}return c.name=Yc(e,0,i),c}function YT(e){var n=zn(e);return n.isst=e.read_shift(4),n}function JT(e,n,i){i.biffguess&&i.biff==2&&(i.biff=5);var c=e.l+n,h=zn(e);i.biff==2&&e.l++;var m=Jc(e,c-e.l,i);return h.val=m,h}function QT(e,n,i){var c=e.read_shift(2),h=wo(e,0,i);return[c,h]}var eE=wo;function jm(e,n,i){var c=e.l+n,h=i.biff==8||!i.biff?4:2,m=e.read_shift(h),x=e.read_shift(h),o=e.read_shift(2),S=e.read_shift(2);return e.l=c,{s:{r:m,c:o},e:{r:x,c:S}}}function tE(e){var n=e.read_shift(2),i=e.read_shift(2),c=L1(e);return{r:n,c:i,ixfe:c[0],rknum:c[1]}}function rE(e,n){for(var i=e.l+n-2,c=e.read_shift(2),h=e.read_shift(2),m=[];e.l<i;)m.push(L1(e));if(e.l!==i)throw new Error("MulRK read error");var x=e.read_shift(2);if(m.length!=x-h+1)throw new Error("MulRK length mismatch");return{r:c,c:h,C:x,rkrec:m}}function aE(e,n){for(var i=e.l+n-2,c=e.read_shift(2),h=e.read_shift(2),m=[];e.l<i;)m.push(e.read_shift(2));if(e.l!==i)throw new Error("MulBlank read error");var x=e.read_shift(2);if(m.length!=x-h+1)throw new Error("MulBlank length mismatch");return{r:c,c:h,C:x,ixfe:m}}function iE(e,n,i,c){var h={},m=e.read_shift(4),x=e.read_shift(4),o=e.read_shift(4),S=e.read_shift(2);return h.patternType=tT[o>>26],c.cellStyles&&(h.alc=m&7,h.fWrap=m>>3&1,h.alcV=m>>4&7,h.fJustLast=m>>7&1,h.trot=m>>8&255,h.cIndent=m>>16&15,h.fShrinkToFit=m>>20&1,h.iReadOrder=m>>22&2,h.fAtrNum=m>>26&1,h.fAtrFnt=m>>27&1,h.fAtrAlc=m>>28&1,h.fAtrBdr=m>>29&1,h.fAtrPat=m>>30&1,h.fAtrProt=m>>31&1,h.dgLeft=x&15,h.dgRight=x>>4&15,h.dgTop=x>>8&15,h.dgBottom=x>>12&15,h.icvLeft=x>>16&127,h.icvRight=x>>23&127,h.grbitDiag=x>>30&3,h.icvTop=o&127,h.icvBottom=o>>7&127,h.icvDiag=o>>14&127,h.dgDiag=o>>21&15,h.icvFore=S&127,h.icvBack=S>>7&127,h.fsxButton=S>>14&1),h}function nE(e,n,i){var c={};return c.ifnt=e.read_shift(2),c.numFmtId=e.read_shift(2),c.flags=e.read_shift(2),c.fStyle=c.flags>>2&1,n-=6,c.data=iE(e,n,c.fStyle,i),c}function sE(e){e.l+=4;var n=[e.read_shift(2),e.read_shift(2)];if(n[0]!==0&&n[0]--,n[1]!==0&&n[1]--,n[0]>7||n[1]>7)throw new Error("Bad Gutters: "+n.join("|"));return n}function Gm(e,n,i){var c=zn(e);(i.biff==2||n==9)&&++e.l;var h=bT(e);return c.val=h,c.t=h===!0||h===!1?"b":"e",c}function oE(e,n,i){i.biffguess&&i.biff==2&&(i.biff=5);var c=zn(e),h=li(e);return c.val=h,c}var Hm=FT;function lE(e,n,i){var c=e.l+n,h=e.read_shift(2),m=e.read_shift(2);if(i.sbcch=m,m==1025||m==14849)return[m,h];if(m<1||m>255)throw new Error("Unexpected SupBook type: "+m);for(var x=po(e,m),o=[];c>e.l;)o.push(Jc(e));return[m,h,x,o]}function qm(e,n,i){var c=e.read_shift(2),h,m={fBuiltIn:c&1,fWantAdvise:c>>>1&1,fWantPict:c>>>2&1,fOle:c>>>3&1,fOleLink:c>>>4&1,cf:c>>>5&1023,fIcon:c>>>15&1};return i.sbcch===14849&&(h=MT(e,n-2,i)),m.body=h||e.read_shift(n-2),typeof h=="string"&&(m.Name=h),m}var cE=["_xlnm.Consolidate_Area","_xlnm.Auto_Open","_xlnm.Auto_Close","_xlnm.Extract","_xlnm.Database","_xlnm.Criteria","_xlnm.Print_Area","_xlnm.Print_Titles","_xlnm.Recorder","_xlnm.Data_Form","_xlnm.Auto_Activate","_xlnm.Auto_Deactivate","_xlnm.Sheet_Title","_xlnm._FilterDatabase"];function Wm(e,n,i){var c=e.l+n,h=e.read_shift(2),m=e.read_shift(1),x=e.read_shift(1),o=e.read_shift(i&&i.biff==2?1:2),S=0;(!i||i.biff>=5)&&(i.biff!=5&&(e.l+=2),S=e.read_shift(2),i.biff==5&&(e.l+=2),e.l+=4);var b=po(e,x,i);h&32&&(b=cE[b.charCodeAt(0)]);var C=c-e.l;i&&i.biff==2&&--C;var M=c==e.l||o===0||!(C>0)?[]:G4(e,C,i,o);return{chKey:m,Name:b,itab:S,rgce:M}}function B1(e,n,i){if(i.biff<8)return hE(e,n,i);for(var c=[],h=e.l+n,m=e.read_shift(i.biff>8?4:2);m--!==0;)c.push(PT(e,i.biff>8?12:6,i));if(e.l!=h)throw new Error("Bad ExternSheet: "+e.l+" != "+h);return c}function hE(e,n,i){e[e.l+1]==3&&e[e.l]++;var c=Yc(e,n,i);return c.charCodeAt(0)==3?c.slice(1):c}function uE(e,n,i){if(i.biff<8){e.l+=n;return}var c=e.read_shift(2),h=e.read_shift(2),m=po(e,c,i),x=po(e,h,i);return[m,x]}function fE(e,n,i){var c=R1(e);e.l++;var h=e.read_shift(1);return n-=8,[H4(e,n,i),h,c]}function Zm(e,n,i){var c=DT(e);switch(i.biff){case 2:e.l++,n-=7;break;case 3:case 4:e.l+=2,n-=8;break;default:e.l+=6,n-=12}return[c,$4(e,n,i)]}function dE(e){var n=e.read_shift(4)!==0,i=e.read_shift(4)!==0,c=e.read_shift(4);return[n,i,c]}function pE(e,n,i){if(!(i.biff<8)){var c=e.read_shift(2),h=e.read_shift(2),m=e.read_shift(2),x=e.read_shift(2),o=wo(e,0,i);return i.biff<8&&e.read_shift(1),[{r:c,c:h},o,x,m]}}function mE(e,n,i){return pE(e,n,i)}function gE(e,n){for(var i=[],c=e.read_shift(2);c--;)i.push(Nu(e));return i}function xE(e,n,i){if(i&&i.biff<8)return yE(e,n,i);var c=O1(e),h=BT(e,n-22,c[1]);return{cmo:c,ft:h}}var _E={8:function(e,n){var i=e.l+n;e.l+=10;var c=e.read_shift(2);e.l+=4,e.l+=2,e.l+=2,e.l+=2,e.l+=4;var h=e.read_shift(1);return e.l+=h,e.l=i,{fmt:c}}};function yE(e,n,i){e.l+=4;var c=e.read_shift(2),h=e.read_shift(2),m=e.read_shift(2);e.l+=2,e.l+=2,e.l+=2,e.l+=2,e.l+=2,e.l+=2,e.l+=2,e.l+=2,e.l+=2,e.l+=6,n-=36;var x=[];return x.push((_E[c]||ui)(e,n,i)),{cmo:[h,c,m],ft:x}}function vE(e,n,i){var c=e.l,h="";try{e.l+=4;var m=(i.lastobj||{cmo:[0,0]}).cmo[1],x;[0,5,7,11,12,14].indexOf(m)==-1?e.l+=6:x=ET(e,6,i);var o=e.read_shift(2);e.read_shift(2),Ea(e,2);var S=e.read_shift(2);e.l+=S;for(var b=1;b<e.lens.length-1;++b){if(e.l-c!=e.lens[b])throw new Error("TxO: bad continue record");var C=e[e.l],M=po(e,e.lens[b+1]-e.lens[b]-1);if(h+=M,h.length>=(C?o:2*o))break}if(h.length!==o&&h.length!==o*2)throw new Error("cchText: "+o+" != "+h.length);return e.l=c+n,{t:h}}catch{return e.l=c+n,{t:h}}}function wE(e,n){var i=Nu(e);e.l+=16;var c=AT(e,n-24);return[i,c]}function bE(e,n){e.read_shift(2);var i=Nu(e),c=e.read_shift((n-10)/2,"dbcs-cont");return c=c.replace(ki,""),[i,c]}function TE(e){var n=[0,0],i;return i=e.read_shift(2),n[0]=Bm[i]||i,i=e.read_shift(2),n[1]=Bm[i]||i,n}function EE(e){for(var n=e.read_shift(2),i=[];n-- >0;)i.push(D1(e));return i}function SE(e){for(var n=e.read_shift(2),i=[];n-- >0;)i.push(D1(e));return i}function kE(e){e.l+=2;var n={cxfs:0,crc:0};return n.cxfs=e.read_shift(2),n.crc=e.read_shift(4),n}function z1(e,n,i){if(!i.cellStyles)return ui(e,n);var c=i&&i.biff>=12?4:2,h=e.read_shift(c),m=e.read_shift(c),x=e.read_shift(c),o=e.read_shift(c),S=e.read_shift(2);c==2&&(e.l+=2);var b={s:h,e:m,w:x,ixfe:o,flags:S};return(i.biff>=5||!i.biff)&&(b.level=S>>8&7),b}function CE(e,n){var i={};return n<32||(e.l+=16,i.header=li(e),i.footer=li(e),e.l+=2),i}function AE(e,n,i){var c={area:!1};if(i.biff!=5)return e.l+=n,c;var h=e.read_shift(1);return e.l+=3,h&16&&(c.area=!0),c}var IE=zn,FE=P1,PE=Jc;function ME(e){var n=e.read_shift(2),i=e.read_shift(2),c=e.read_shift(4),h={fmt:n,env:i,len:c,data:e.slice(e.l,e.l+c)};return e.l+=c,h}function DE(e,n,i){i.biffguess&&i.biff==5&&(i.biff=2);var c=zn(e);++e.l;var h=wo(e,n-7,i);return c.t="str",c.val=h,c}function LE(e){var n=zn(e);++e.l;var i=li(e);return n.t="n",n.val=i,n}function RE(e){var n=zn(e);++e.l;var i=e.read_shift(2);return n.t="n",n.val=i,n}function OE(e){var n=e.read_shift(1);return n===0?(e.l++,""):e.read_shift(n,"sbcs-cont")}function BE(e,n){e.l+=6,e.l+=2,e.l+=1,e.l+=3,e.l+=1,e.l+=n-13}function zE(e,n,i){var c=e.l+n,h=zn(e),m=e.read_shift(2),x=po(e,m,i);return e.l=c,h.t="str",h.val=x,h}var NE=[2,3,48,49,131,139,140,245],Xm=function(){var e={1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127,8:865,9:437,10:850,11:437,13:437,14:850,15:437,16:850,17:437,18:850,19:932,20:850,21:437,22:850,23:865,24:437,25:437,26:850,27:437,28:863,29:850,31:852,34:852,35:852,36:860,37:850,38:866,55:850,64:852,77:936,78:949,79:950,80:874,87:1252,88:1252,89:1252,108:863,134:737,135:852,136:857,204:1257,255:16969},n=z0({1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127});function i(o,S){var b=[],C=Ds(1);switch(S.type){case"base64":C=vn(Gi(o));break;case"binary":C=vn(o);break;case"buffer":case"array":C=o;break}Za(C,0);var M=C.read_shift(1),L=!!(M&136),z=!1,U=!1;switch(M){case 2:break;case 3:break;case 48:z=!0,L=!0;break;case 49:z=!0,L=!0;break;case 131:break;case 139:break;case 140:U=!0;break;case 245:break;default:throw new Error("DBF Unsupported Version: "+M.toString(16))}var N=0,G=521;M==2&&(N=C.read_shift(2)),C.l+=3,M!=2&&(N=C.read_shift(4)),N>1048576&&(N=1e6),M!=2&&(G=C.read_shift(2));var ie=C.read_shift(2),pe=S.codepage||1252;M!=2&&(C.l+=16,C.read_shift(1),C[C.l]!==0&&(pe=e[C[C.l]]),C.l+=1,C.l+=2),U&&(C.l+=36);for(var Y=[],me={},ve=Math.min(C.length,M==2?521:G-10-(z?264:0)),we=U?32:11;C.l<ve&&C[C.l]!=13;)switch(me={},me.name=Cs.utils.decode(pe,C.slice(C.l,C.l+we)).replace(/[\u0000\r\n].*$/g,""),C.l+=we,me.type=String.fromCharCode(C.read_shift(1)),M!=2&&!U&&(me.offset=C.read_shift(4)),me.len=C.read_shift(1),M==2&&(me.offset=C.read_shift(2)),me.dec=C.read_shift(1),me.name.length&&Y.push(me),M!=2&&(C.l+=U?13:14),me.type){case"B":(!z||me.len!=8)&&S.WTF&&console.log("Skipping "+me.name+":"+me.type);break;case"G":case"P":S.WTF&&console.log("Skipping "+me.name+":"+me.type);break;case"+":case"0":case"@":case"C":case"D":case"F":case"I":case"L":case"M":case"N":case"O":case"T":case"Y":break;default:throw new Error("Unknown Field Type: "+me.type)}if(C[C.l]!==13&&(C.l=G-1),C.read_shift(1)!==13)throw new Error("DBF Terminator not found "+C.l+" "+C[C.l]);C.l=G;var te=0,Be=0;for(b[0]=[],Be=0;Be!=Y.length;++Be)b[0][Be]=Y[Be].name;for(;N-- >0;){if(C[C.l]===42){C.l+=ie;continue}for(++C.l,b[++te]=[],Be=0,Be=0;Be!=Y.length;++Be){var Ce=C.slice(C.l,C.l+Y[Be].len);C.l+=Y[Be].len,Za(Ce,0);var Ue=Cs.utils.decode(pe,Ce);switch(Y[Be].type){case"C":Ue.trim().length&&(b[te][Be]=Ue.replace(/\s+$/,""));break;case"D":Ue.length===8?b[te][Be]=new Date(+Ue.slice(0,4),+Ue.slice(4,6)-1,+Ue.slice(6,8)):b[te][Be]=Ue;break;case"F":b[te][Be]=parseFloat(Ue.trim());break;case"+":case"I":b[te][Be]=U?Ce.read_shift(-4,"i")^2147483648:Ce.read_shift(4,"i");break;case"L":switch(Ue.trim().toUpperCase()){case"Y":case"T":b[te][Be]=!0;break;case"N":case"F":b[te][Be]=!1;break;case"":case"?":break;default:throw new Error("DBF Unrecognized L:|"+Ue+"|")}break;case"M":if(!L)throw new Error("DBF Unexpected MEMO for type "+M.toString(16));b[te][Be]="##MEMO##"+(U?parseInt(Ue.trim(),10):Ce.read_shift(4));break;case"N":Ue=Ue.replace(/\u0000/g,"").trim(),Ue&&Ue!="."&&(b[te][Be]=+Ue||0);break;case"@":b[te][Be]=new Date(Ce.read_shift(-8,"f")-621356832e5);break;case"T":b[te][Be]=new Date((Ce.read_shift(4)-2440588)*864e5+Ce.read_shift(4));break;case"Y":b[te][Be]=Ce.read_shift(4,"i")/1e4+Ce.read_shift(4,"i")/1e4*Math.pow(2,32);break;case"O":b[te][Be]=-Ce.read_shift(-8,"f");break;case"B":if(z&&Y[Be].len==8){b[te][Be]=Ce.read_shift(8,"f");break}case"G":case"P":Ce.l+=Y[Be].len;break;case"0":if(Y[Be].name==="_NullFlags")break;default:throw new Error("DBF Unsupported data type "+Y[Be].type)}}}if(M!=2&&C.l<C.length&&C[C.l++]!=26)throw new Error("DBF EOF Marker missing "+(C.l-1)+" of "+C.length+" "+C[C.l-1].toString(16));return S&&S.sheetRows&&(b=b.slice(0,S.sheetRows)),S.DBF=Y,b}function c(o,S){var b=S||{};b.dateNF||(b.dateNF="yyyymmdd");var C=vl(i(o,b),b);return C["!cols"]=b.DBF.map(function(M){return{wch:M.len,DBF:M}}),delete b.DBF,C}function h(o,S){try{return Rs(c(o,S),S)}catch(b){if(S&&S.WTF)throw b}return{SheetNames:[],Sheets:{}}}var m={B:8,C:250,L:1,D:8,"?":0,"":0};function x(o,S){var b=S||{};if(+b.codepage>=0&&wn(+b.codepage),b.type=="string")throw new Error("Cannot write DBF to JS string");var C=_0(),M=A0(o,{header:1,raw:!0,cellDates:!0}),L=M[0],z=M.slice(1),U=o["!cols"]||[],N=0,G=0,ie=0,pe=1;for(N=0;N<L.length;++N){if(((U[N]||{}).DBF||{}).name){L[N]=U[N].DBF.name,++ie;continue}if(L[N]!=null){if(++ie,typeof L[N]=="number"&&(L[N]=L[N].toString(10)),typeof L[N]!="string")throw new Error("DBF Invalid column name "+L[N]+" |"+typeof L[N]+"|");if(L.indexOf(L[N])!==N){for(G=0;G<1024;++G)if(L.indexOf(L[N]+"_"+G)==-1){L[N]+="_"+G;break}}}}var Y=ha(o["!ref"]),me=[],ve=[],we=[];for(N=0;N<=Y.e.c-Y.s.c;++N){var te="",Be="",Ce=0,Ue=[];for(G=0;G<z.length;++G)z[G][N]!=null&&Ue.push(z[G][N]);if(Ue.length==0||L[N]==null){me[N]="?";continue}for(G=0;G<Ue.length;++G){switch(typeof Ue[G]){case"number":Be="B";break;case"string":Be="C";break;case"boolean":Be="L";break;case"object":Be=Ue[G]instanceof Date?"D":"C";break;default:Be="C"}Ce=Math.max(Ce,String(Ue[G]).length),te=te&&te!=Be?"C":Be}Ce>250&&(Ce=250),Be=((U[N]||{}).DBF||{}).type,Be=="C"&&U[N].DBF.len>Ce&&(Ce=U[N].DBF.len),te=="B"&&Be=="N"&&(te="N",we[N]=U[N].DBF.dec,Ce=U[N].DBF.len),ve[N]=te=="C"||Be=="N"?Ce:m[te]||0,pe+=ve[N],me[N]=te}var $e=C.next(32);for($e.write_shift(4,318902576),$e.write_shift(4,z.length),$e.write_shift(2,296+32*ie),$e.write_shift(2,pe),N=0;N<4;++N)$e.write_shift(4,0);for($e.write_shift(4,0|(+n[Og]||3)<<8),N=0,G=0;N<L.length;++N)if(L[N]!=null){var Re=C.next(32),st=(L[N].slice(-10)+"\0\0\0\0\0\0\0\0\0\0\0").slice(0,11);Re.write_shift(1,st,"sbcs"),Re.write_shift(1,me[N]=="?"?"C":me[N],"sbcs"),Re.write_shift(4,G),Re.write_shift(1,ve[N]||m[me[N]]||0),Re.write_shift(1,we[N]||0),Re.write_shift(1,2),Re.write_shift(4,0),Re.write_shift(1,0),Re.write_shift(4,0),Re.write_shift(4,0),G+=ve[N]||m[me[N]]||0}var pt=C.next(264);for(pt.write_shift(4,13),N=0;N<65;++N)pt.write_shift(4,0);for(N=0;N<z.length;++N){var ot=C.next(pe);for(ot.write_shift(1,0),G=0;G<L.length;++G)if(L[G]!=null)switch(me[G]){case"L":ot.write_shift(1,z[N][G]==null?63:z[N][G]?84:70);break;case"B":ot.write_shift(8,z[N][G]||0,"f");break;case"N":var _t="0";for(typeof z[N][G]=="number"&&(_t=z[N][G].toFixed(we[G]||0)),ie=0;ie<ve[G]-_t.length;++ie)ot.write_shift(1,32);ot.write_shift(1,_t,"sbcs");break;case"D":z[N][G]?(ot.write_shift(4,("0000"+z[N][G].getFullYear()).slice(-4),"sbcs"),ot.write_shift(2,("00"+(z[N][G].getMonth()+1)).slice(-2),"sbcs"),ot.write_shift(2,("00"+z[N][G].getDate()).slice(-2),"sbcs")):ot.write_shift(8,"00000000","sbcs");break;case"C":var ft=String(z[N][G]!=null?z[N][G]:"").slice(0,ve[G]);for(ot.write_shift(1,ft,"sbcs"),ie=0;ie<ve[G]-ft.length;++ie)ot.write_shift(1,32);break}}return C.next(1).write_shift(1,26),C.end()}return{to_workbook:h,to_sheet:c,from_sheet:x}}(),UE=function(){var e={AA:"",BA:"",CA:"",DA:195,HA:"",JA:197,AE:"",BE:"",CE:"",HE:"",AI:"",BI:"",CI:"",HI:"",AO:"",BO:"",CO:"",DO:213,HO:"",AU:"",BU:"",CU:"",HU:"",Aa:"",Ba:"",Ca:"",Da:227,Ha:"",Ja:229,Ae:"",Be:"",Ce:"",He:"",Ai:"",Bi:"",Ci:"",Hi:"",Ao:"",Bo:"",Co:"",Do:245,Ho:"",Au:"",Bu:"",Cu:"",Hu:"",KC:"",Kc:"",q:"",z:"",a:"",j:"",DN:209,Dn:241,Hy:255,S:169,c:170,R:174,"B ":180,0:176,1:177,2:178,3:179,5:181,6:182,7:183,Q:185,k:186,b:208,i:216,l:222,s:240,y:248,"!":161,'"':162,"#":163,"(":164,"%":165,"'":167,"H ":168,"+":171,";":187,"<":188,"=":189,">":190,"?":191,"{":223},n=new RegExp("\x1BN("+On(e).join("|").replace(/\|\|\|/,"|\\||").replace(/([?()+])/g,"\\$1")+"|\\|)","gm"),i=function(L,z){var U=e[z];return typeof U=="number"?um(U):U},c=function(L,z,U){var N=z.charCodeAt(0)-32<<4|U.charCodeAt(0)-48;return N==59?L:um(N)};e["|"]=254;function h(L,z){switch(z.type){case"base64":return m(Gi(L),z);case"binary":return m(L,z);case"buffer":return m(vr&&Buffer.isBuffer(L)?L.toString("binary"):xo(L),z);case"array":return m(fo(L),z)}throw new Error("Unrecognized type "+z.type)}function m(L,z){var U=L.split(/[\n\r]+/),N=-1,G=-1,ie=0,pe=0,Y=[],me=[],ve=null,we={},te=[],Be=[],Ce=[],Ue=0,$e;for(+z.codepage>=0&&wn(+z.codepage);ie!==U.length;++ie){Ue=0;var Re=U[ie].trim().replace(/\x1B([\x20-\x2F])([\x30-\x3F])/g,c).replace(n,i),st=Re.replace(/;;/g,"\0").split(";").map(function(Ae){return Ae.replace(/\u0000/g,";")}),pt=st[0],ot;if(Re.length>0)switch(pt){case"ID":break;case"E":break;case"B":break;case"O":break;case"W":break;case"P":st[1].charAt(0)=="P"&&me.push(Re.slice(3).replace(/;;/g,";"));break;case"C":var _t=!1,ft=!1,ir=!1,qe=!1,$t=-1,Dt=-1;for(pe=1;pe<st.length;++pe)switch(st[pe].charAt(0)){case"A":break;case"X":G=parseInt(st[pe].slice(1))-1,ft=!0;break;case"Y":for(N=parseInt(st[pe].slice(1))-1,ft||(G=0),$e=Y.length;$e<=N;++$e)Y[$e]=[];break;case"K":ot=st[pe].slice(1),ot.charAt(0)==='"'?ot=ot.slice(1,ot.length-1):ot==="TRUE"?ot=!0:ot==="FALSE"?ot=!1:isNaN(Tn(ot))?isNaN(pl(ot).getDate())||(ot=za(ot)):(ot=Tn(ot),ve!==null&&_l(ve)&&(ot=zu(ot))),_t=!0;break;case"E":qe=!0;var ue=ul(st[pe].slice(1),{r:N,c:G});Y[N][G]=[Y[N][G],ue];break;case"S":ir=!0,Y[N][G]=[Y[N][G],"S5S"];break;case"G":break;case"R":$t=parseInt(st[pe].slice(1))-1;break;case"C":Dt=parseInt(st[pe].slice(1))-1;break;default:if(z&&z.WTF)throw new Error("SYLK bad record "+Re)}if(_t&&(Y[N][G]&&Y[N][G].length==2?Y[N][G][0]=ot:Y[N][G]=ot,ve=null),ir){if(qe)throw new Error("SYLK shared formula cannot have own formula");var be=$t>-1&&Y[$t][Dt];if(!be||!be[1])throw new Error("SYLK shared formula cannot find base");Y[N][G][1]=Z1(be[1],{r:N-$t,c:G-Dt})}break;case"F":var Te=0;for(pe=1;pe<st.length;++pe)switch(st[pe].charAt(0)){case"X":G=parseInt(st[pe].slice(1))-1,++Te;break;case"Y":for(N=parseInt(st[pe].slice(1))-1,$e=Y.length;$e<=N;++$e)Y[$e]=[];break;case"M":Ue=parseInt(st[pe].slice(1))/20;break;case"F":break;case"G":break;case"P":ve=me[parseInt(st[pe].slice(1))];break;case"S":break;case"D":break;case"N":break;case"W":for(Ce=st[pe].slice(1).split(" "),$e=parseInt(Ce[0],10);$e<=parseInt(Ce[1],10);++$e)Ue=parseInt(Ce[2],10),Be[$e-1]=Ue===0?{hidden:!0}:{wch:Ue},ml(Be[$e-1]);break;case"C":G=parseInt(st[pe].slice(1))-1,Be[G]||(Be[G]={});break;case"R":N=parseInt(st[pe].slice(1))-1,te[N]||(te[N]={}),Ue>0?(te[N].hpt=Ue,te[N].hpx=qc(Ue)):Ue===0&&(te[N].hidden=!0);break;default:if(z&&z.WTF)throw new Error("SYLK bad record "+Re)}Te<1&&(ve=null);break;default:if(z&&z.WTF)throw new Error("SYLK bad record "+Re)}}return te.length>0&&(we["!rows"]=te),Be.length>0&&(we["!cols"]=Be),z&&z.sheetRows&&(Y=Y.slice(0,z.sheetRows)),[Y,we]}function x(L,z){var U=h(L,z),N=U[0],G=U[1],ie=vl(N,z);return On(G).forEach(function(pe){ie[pe]=G[pe]}),ie}function o(L,z){return Rs(x(L,z),z)}function S(L,z,U,N){var G="C;Y"+(U+1)+";X"+(N+1)+";K";switch(L.t){case"n":G+=L.v||0,L.f&&!L.F&&(G+=";E"+kk(L.f,{r:U,c:N}));break;case"b":G+=L.v?"TRUE":"FALSE";break;case"e":G+=L.w||L.v;break;case"d":G+='"'+(L.w||L.v)+'"';break;case"s":G+='"'+L.v.replace(/"/g,"").replace(/;/g,";;")+'"';break}return G}function b(L,z){z.forEach(function(U,N){var G="F;W"+(N+1)+" "+(N+1)+" ";U.hidden?G+="0":(typeof U.width=="number"&&!U.wpx&&(U.wpx=Du(U.width)),typeof U.wpx=="number"&&!U.wch&&(U.wch=Lu(U.wpx)),typeof U.wch=="number"&&(G+=Math.round(U.wch))),G.charAt(G.length-1)!=" "&&L.push(G)})}function C(L,z){z.forEach(function(U,N){var G="F;";U.hidden?G+="M0;":U.hpt?G+="M"+20*U.hpt+";":U.hpx&&(G+="M"+20*H1(U.hpx)+";"),G.length>2&&L.push(G+"R"+(N+1))})}function M(L,z){var U=["ID;PWXL;N;E"],N=[],G=ha(L["!ref"]),ie,pe=Array.isArray(L),Y=`\r
`;U.push("P;PGeneral"),U.push("F;P0;DG0G8;M255"),L["!cols"]&&b(U,L["!cols"]),L["!rows"]&&C(U,L["!rows"]),U.push("B;Y"+(G.e.r-G.s.r+1)+";X"+(G.e.c-G.s.c+1)+";D"+[G.s.c,G.s.r,G.e.c,G.e.r].join(" "));for(var me=G.s.r;me<=G.e.r;++me)for(var ve=G.s.c;ve<=G.e.c;++ve){var we=sr({r:me,c:ve});ie=pe?(L[me]||[])[ve]:L[we],!(!ie||ie.v==null&&(!ie.f||ie.F))&&N.push(S(ie,L,me,ve))}return U.join(Y)+Y+N.join(Y)+Y+"E"+Y}return{to_workbook:o,to_sheet:x,from_sheet:M}}(),VE=function(){function e(m,x){switch(x.type){case"base64":return n(Gi(m),x);case"binary":return n(m,x);case"buffer":return n(vr&&Buffer.isBuffer(m)?m.toString("binary"):xo(m),x);case"array":return n(fo(m),x)}throw new Error("Unrecognized type "+x.type)}function n(m,x){for(var o=m.split(`
`),S=-1,b=-1,C=0,M=[];C!==o.length;++C){if(o[C].trim()==="BOT"){M[++S]=[],b=0;continue}if(!(S<0)){var L=o[C].trim().split(","),z=L[0],U=L[1];++C;for(var N=o[C]||"";(N.match(/["]/g)||[]).length&1&&C<o.length-1;)N+=`
`+o[++C];switch(N=N.trim(),+z){case-1:if(N==="BOT"){M[++S]=[],b=0;continue}else if(N!=="EOD")throw new Error("Unrecognized DIF special command "+N);break;case 0:N==="TRUE"?M[S][b]=!0:N==="FALSE"?M[S][b]=!1:isNaN(Tn(U))?isNaN(pl(U).getDate())?M[S][b]=U:M[S][b]=za(U):M[S][b]=Tn(U),++b;break;case 1:N=N.slice(1,N.length-1),N=N.replace(/""/g,'"'),N&&N.match(/^=".*"$/)&&(N=N.slice(2,-1)),M[S][b++]=N!==""?N:null;break}if(N==="EOD")break}}return x&&x.sheetRows&&(M=M.slice(0,x.sheetRows)),M}function i(m,x){return vl(e(m,x),x)}function c(m,x){return Rs(i(m,x),x)}var h=function(){var m=function(S,b,C,M,L){S.push(b),S.push(C+","+M),S.push('"'+L.replace(/"/g,'""')+'"')},x=function(S,b,C,M){S.push(b+","+C),S.push(b==1?'"'+M.replace(/"/g,'""')+'"':M)};return function(S){var b=[],C=ha(S["!ref"]),M,L=Array.isArray(S);m(b,"TABLE",0,1,"sheetjs"),m(b,"VECTORS",0,C.e.r-C.s.r+1,""),m(b,"TUPLES",0,C.e.c-C.s.c+1,""),m(b,"DATA",0,0,"");for(var z=C.s.r;z<=C.e.r;++z){x(b,-1,0,"BOT");for(var U=C.s.c;U<=C.e.c;++U){var N=sr({r:z,c:U});if(M=L?(S[z]||[])[U]:S[N],!M){x(b,1,0,"");continue}switch(M.t){case"n":var G=M.w;!G&&M.v!=null&&(G=M.v),G==null?M.f&&!M.F?x(b,1,0,"="+M.f):x(b,1,0,""):x(b,0,G,"V");break;case"b":x(b,0,M.v?1:0,M.v?"TRUE":"FALSE");break;case"s":x(b,1,0,isNaN(M.v)?M.v:'="'+M.v+'"');break;case"d":M.w||(M.w=nn(M.z||hr[14],Ci(za(M.v)))),x(b,0,M.w,"V");break;default:x(b,1,0,"")}}}x(b,-1,0,"EOD");var ie=`\r
`,pe=b.join(ie);return pe}}();return{to_workbook:c,to_sheet:i,from_sheet:h}}(),$E=function(){function e(M){return M.replace(/\\b/g,"\\").replace(/\\c/g,":").replace(/\\n/g,`
`)}function n(M){return M.replace(/\\/g,"\\b").replace(/:/g,"\\c").replace(/\n/g,"\\n")}function i(M,L){for(var z=M.split(`
`),U=-1,N=-1,G=0,ie=[];G!==z.length;++G){var pe=z[G].trim().split(":");if(pe[0]==="cell"){var Y=Si(pe[1]);if(ie.length<=Y.r)for(U=ie.length;U<=Y.r;++U)ie[U]||(ie[U]=[]);switch(U=Y.r,N=Y.c,pe[2]){case"t":ie[U][N]=e(pe[3]);break;case"v":ie[U][N]=+pe[3];break;case"vtf":var me=pe[pe.length-1];case"vtc":switch(pe[3]){case"nl":ie[U][N]=!!+pe[4];break;default:ie[U][N]=+pe[4];break}pe[2]=="vtf"&&(ie[U][N]=[ie[U][N],me])}}}return L&&L.sheetRows&&(ie=ie.slice(0,L.sheetRows)),ie}function c(M,L){return vl(i(M,L),L)}function h(M,L){return Rs(c(M,L),L)}var m=["socialcalc:version:1.5","MIME-Version: 1.0","Content-Type: multipart/mixed; boundary=SocialCalcSpreadsheetControlSave"].join(`
`),x=["--SocialCalcSpreadsheetControlSave","Content-type: text/plain; charset=UTF-8"].join(`
`)+`
`,o=["# SocialCalc Spreadsheet Control Save","part:sheet"].join(`
`),S="--SocialCalcSpreadsheetControlSave--";function b(M){if(!M||!M["!ref"])return"";for(var L=[],z=[],U,N="",G=yl(M["!ref"]),ie=Array.isArray(M),pe=G.s.r;pe<=G.e.r;++pe)for(var Y=G.s.c;Y<=G.e.c;++Y)if(N=sr({r:pe,c:Y}),U=ie?(M[pe]||[])[Y]:M[N],!(!U||U.v==null||U.t==="z")){switch(z=["cell",N,"t"],U.t){case"s":case"str":z.push(n(U.v));break;case"n":U.f?(z[2]="vtf",z[3]="n",z[4]=U.v,z[5]=n(U.f)):(z[2]="v",z[3]=U.v);break;case"b":z[2]="vt"+(U.f?"f":"c"),z[3]="nl",z[4]=U.v?"1":"0",z[5]=n(U.f||(U.v?"TRUE":"FALSE"));break;case"d":var me=Ci(za(U.v));z[2]="vtc",z[3]="nd",z[4]=""+me,z[5]=U.w||nn(U.z||hr[14],me);break;case"e":continue}L.push(z.join(":"))}return L.push("sheet:c:"+(G.e.c-G.s.c+1)+":r:"+(G.e.r-G.s.r+1)+":tvf:1"),L.push("valueformat:1:text-wiki"),L.join(`
`)}function C(M){return[m,x,o,x,b(M),S].join(`
`)}return{to_workbook:h,to_sheet:c,from_sheet:C}}(),Gc=function(){function e(C,M,L,z,U){U.raw?M[L][z]=C:C===""||(C==="TRUE"?M[L][z]=!0:C==="FALSE"?M[L][z]=!1:isNaN(Tn(C))?isNaN(pl(C).getDate())?M[L][z]=C:M[L][z]=za(C):M[L][z]=Tn(C))}function n(C,M){var L=M||{},z=[];if(!C||C.length===0)return z;for(var U=C.split(/[\r\n]/),N=U.length-1;N>=0&&U[N].length===0;)--N;for(var G=10,ie=0,pe=0;pe<=N;++pe)ie=U[pe].indexOf(" "),ie==-1?ie=U[pe].length:ie++,G=Math.max(G,ie);for(pe=0;pe<=N;++pe){z[pe]=[];var Y=0;for(e(U[pe].slice(0,G).trim(),z,pe,Y,L),Y=1;Y<=(U[pe].length-G)/10+1;++Y)e(U[pe].slice(G+(Y-1)*10,G+Y*10).trim(),z,pe,Y,L)}return L.sheetRows&&(z=z.slice(0,L.sheetRows)),z}var i={44:",",9:"	",59:";",124:"|"},c={44:3,9:2,59:1,124:0};function h(C){for(var M={},L=!1,z=0,U=0;z<C.length;++z)(U=C.charCodeAt(z))==34?L=!L:!L&&U in i&&(M[U]=(M[U]||0)+1);U=[];for(z in M)Object.prototype.hasOwnProperty.call(M,z)&&U.push([M[z],z]);if(!U.length){M=c;for(z in M)Object.prototype.hasOwnProperty.call(M,z)&&U.push([M[z],z])}return U.sort(function(N,G){return N[0]-G[0]||c[N[1]]-c[G[1]]}),i[U.pop()[1]]||44}function m(C,M){var L=M||{},z="",U=L.dense?[]:{},N={s:{c:0,r:0},e:{c:0,r:0}};C.slice(0,4)=="sep="?C.charCodeAt(5)==13&&C.charCodeAt(6)==10?(z=C.charAt(4),C=C.slice(7)):C.charCodeAt(5)==13||C.charCodeAt(5)==10?(z=C.charAt(4),C=C.slice(6)):z=h(C.slice(0,1024)):L&&L.FS?z=L.FS:z=h(C.slice(0,1024));var G=0,ie=0,pe=0,Y=0,me=0,ve=z.charCodeAt(0),we=!1,te=0,Be=C.charCodeAt(0);C=C.replace(/\r\n/mg,`
`);var Ce=L.dateNF!=null?eb(L.dateNF):null;function Ue(){var $e=C.slice(Y,me),Re={};if($e.charAt(0)=='"'&&$e.charAt($e.length-1)=='"'&&($e=$e.slice(1,-1).replace(/""/g,'"')),$e.length===0)Re.t="z";else if(L.raw)Re.t="s",Re.v=$e;else if($e.trim().length===0)Re.t="s",Re.v=$e;else if($e.charCodeAt(0)==61)$e.charCodeAt(1)==34&&$e.charCodeAt($e.length-1)==34?(Re.t="s",Re.v=$e.slice(2,-1).replace(/""/g,'"')):Ak($e)?(Re.t="n",Re.f=$e.slice(1)):(Re.t="s",Re.v=$e);else if($e=="TRUE")Re.t="b",Re.v=!0;else if($e=="FALSE")Re.t="b",Re.v=!1;else if(!isNaN(pe=Tn($e)))Re.t="n",L.cellText!==!1&&(Re.w=$e),Re.v=pe;else if(!isNaN(pl($e).getDate())||Ce&&$e.match(Ce)){Re.z=L.dateNF||hr[14];var st=0;Ce&&$e.match(Ce)&&($e=tb($e,L.dateNF,$e.match(Ce)||[]),st=1),L.cellDates?(Re.t="d",Re.v=za($e,st)):(Re.t="n",Re.v=Ci(za($e,st))),L.cellText!==!1&&(Re.w=nn(Re.z,Re.v instanceof Date?Ci(Re.v):Re.v)),L.cellNF||delete Re.z}else Re.t="s",Re.v=$e;if(Re.t=="z"||(L.dense?(U[G]||(U[G]=[]),U[G][ie]=Re):U[sr({c:ie,r:G})]=Re),Y=me+1,Be=C.charCodeAt(Y),N.e.c<ie&&(N.e.c=ie),N.e.r<G&&(N.e.r=G),te==ve)++ie;else if(ie=0,++G,L.sheetRows&&L.sheetRows<=G)return!0}e:for(;me<C.length;++me)switch(te=C.charCodeAt(me)){case 34:Be===34&&(we=!we);break;case ve:case 10:case 13:if(!we&&Ue())break e;break}return me-Y>0&&Ue(),U["!ref"]=Tr(N),U}function x(C,M){return!(M&&M.PRN)||M.FS||C.slice(0,4)=="sep="||C.indexOf("	")>=0||C.indexOf(",")>=0||C.indexOf(";")>=0?m(C,M):vl(n(C,M),M)}function o(C,M){var L="",z=M.type=="string"?[0,0,0,0]:ad(C,M);switch(M.type){case"base64":L=Gi(C);break;case"binary":L=C;break;case"buffer":M.codepage==65001?L=C.toString("utf8"):M.codepage&&typeof Cs<"u"?L=Cs.utils.decode(M.codepage,C):L=vr&&Buffer.isBuffer(C)?C.toString("binary"):xo(C);break;case"array":L=fo(C);break;case"string":L=C;break;default:throw new Error("Unrecognized type "+M.type)}return z[0]==239&&z[1]==187&&z[2]==191?L=jr(L.slice(3)):M.type!="string"&&M.type!="buffer"&&M.codepage==65001?L=jr(L):M.type=="binary"&&typeof Cs<"u"&&M.codepage&&(L=Cs.utils.decode(M.codepage,Cs.utils.encode(28591,L))),L.slice(0,19)=="socialcalc:version:"?$E.to_sheet(M.type=="string"?L:jr(L),M):x(L,M)}function S(C,M){return Rs(o(C,M),M)}function b(C){for(var M=[],L=ha(C["!ref"]),z,U=Array.isArray(C),N=L.s.r;N<=L.e.r;++N){for(var G=[],ie=L.s.c;ie<=L.e.c;++ie){var pe=sr({r:N,c:ie});if(z=U?(C[N]||[])[ie]:C[pe],!z||z.v==null){G.push("          ");continue}for(var Y=(z.w||(ns(z),z.w)||"").slice(0,10);Y.length<10;)Y+=" ";G.push(Y+(ie===0?" ":""))}M.push(G.join(""))}return M.join(`
`)}return{to_workbook:S,to_sheet:o,from_sheet:b}}();function jE(e,n){var i=n||{},c=!!i.WTF;i.WTF=!0;try{var h=UE.to_workbook(e,i);return i.WTF=c,h}catch(m){if(i.WTF=c,!m.message.match(/SYLK bad record ID/)&&c)throw m;return Gc.to_workbook(e,n)}}var Bc=function(){function e(ue,be,Te){if(ue){Za(ue,ue.l||0);for(var Ae=Te.Enum||$t;ue.l<ue.length;){var Ye=ue.read_shift(2),mt=Ae[Ye]||Ae[65535],wt=ue.read_shift(2),ut=ue.l+wt,rt=mt.f&&mt.f(ue,wt,Te);if(ue.l=ut,be(rt,mt,Ye))return}}}function n(ue,be){switch(be.type){case"base64":return i(vn(Gi(ue)),be);case"binary":return i(vn(ue),be);case"buffer":case"array":return i(ue,be)}throw"Unsupported type "+be.type}function i(ue,be){if(!ue)return ue;var Te=be||{},Ae=Te.dense?[]:{},Ye="Sheet1",mt="",wt=0,ut={},rt=[],Yt=[],xe={s:{r:0,c:0},e:{r:0,c:0}},er=Te.sheetRows||0;if(ue[2]==0&&(ue[3]==8||ue[3]==9)&&ue.length>=16&&ue[14]==5&&ue[15]===108)throw new Error("Unsupported Works 3 for Mac file");if(ue[2]==2)Te.Enum=$t,e(ue,function(Et,wr,Wr){switch(Wr){case 0:Te.vers=Et,Et>=4096&&(Te.qpro=!0);break;case 6:xe=Et;break;case 204:Et&&(mt=Et);break;case 222:mt=Et;break;case 15:case 51:Te.qpro||(Et[1].v=Et[1].v.slice(1));case 13:case 14:case 16:Wr==14&&(Et[2]&112)==112&&(Et[2]&15)>1&&(Et[2]&15)<15&&(Et[1].z=Te.dateNF||hr[14],Te.cellDates&&(Et[1].t="d",Et[1].v=zu(Et[1].v))),Te.qpro&&Et[3]>wt&&(Ae["!ref"]=Tr(xe),ut[Ye]=Ae,rt.push(Ye),Ae=Te.dense?[]:{},xe={s:{r:0,c:0},e:{r:0,c:0}},wt=Et[3],Ye=mt||"Sheet"+(wt+1),mt="");var Xe=Te.dense?(Ae[Et[0].r]||[])[Et[0].c]:Ae[sr(Et[0])];if(Xe){Xe.t=Et[1].t,Xe.v=Et[1].v,Et[1].z!=null&&(Xe.z=Et[1].z),Et[1].f!=null&&(Xe.f=Et[1].f);break}Te.dense?(Ae[Et[0].r]||(Ae[Et[0].r]=[]),Ae[Et[0].r][Et[0].c]=Et[1]):Ae[sr(Et[0])]=Et[1];break}},Te);else if(ue[2]==26||ue[2]==14)Te.Enum=Dt,ue[2]==14&&(Te.qpro=!0,ue.l=0),e(ue,function(Et,wr,Wr){switch(Wr){case 204:Ye=Et;break;case 22:Et[1].v=Et[1].v.slice(1);case 23:case 24:case 25:case 37:case 39:case 40:if(Et[3]>wt&&(Ae["!ref"]=Tr(xe),ut[Ye]=Ae,rt.push(Ye),Ae=Te.dense?[]:{},xe={s:{r:0,c:0},e:{r:0,c:0}},wt=Et[3],Ye="Sheet"+(wt+1)),er>0&&Et[0].r>=er)break;Te.dense?(Ae[Et[0].r]||(Ae[Et[0].r]=[]),Ae[Et[0].r][Et[0].c]=Et[1]):Ae[sr(Et[0])]=Et[1],xe.e.c<Et[0].c&&(xe.e.c=Et[0].c),xe.e.r<Et[0].r&&(xe.e.r=Et[0].r);break;case 27:Et[14e3]&&(Yt[Et[14e3][0]]=Et[14e3][1]);break;case 1537:Yt[Et[0]]=Et[1],Et[0]==wt&&(Ye=Et[1]);break}},Te);else throw new Error("Unrecognized LOTUS BOF "+ue[2]);if(Ae["!ref"]=Tr(xe),ut[mt||Ye]=Ae,rt.push(mt||Ye),!Yt.length)return{SheetNames:rt,Sheets:ut};for(var Jt={},mr=[],Zt=0;Zt<Yt.length;++Zt)ut[rt[Zt]]?(mr.push(Yt[Zt]||rt[Zt]),Jt[Yt[Zt]]=ut[Yt[Zt]]||ut[rt[Zt]]):(mr.push(Yt[Zt]),Jt[Yt[Zt]]={"!ref":"A1"});return{SheetNames:mr,Sheets:Jt}}function c(ue,be){var Te=be||{};if(+Te.codepage>=0&&wn(+Te.codepage),Te.type=="string")throw new Error("Cannot write WK1 to JS string");var Ae=_0(),Ye=ha(ue["!ref"]),mt=Array.isArray(ue),wt=[];yn(Ae,0,m(1030)),yn(Ae,6,S(Ye));for(var ut=Math.min(Ye.e.r,8191),rt=Ye.s.r;rt<=ut;++rt)for(var Yt=Ka(rt),xe=Ye.s.c;xe<=Ye.e.c;++xe){rt===Ye.s.r&&(wt[xe]=Pa(xe));var er=wt[xe]+Yt,Jt=mt?(ue[rt]||[])[xe]:ue[er];if(!(!Jt||Jt.t=="z"))if(Jt.t=="n")(Jt.v|0)==Jt.v&&Jt.v>=-32768&&Jt.v<=32767?yn(Ae,13,z(rt,xe,Jt.v)):yn(Ae,14,N(rt,xe,Jt.v));else{var mr=ns(Jt);yn(Ae,15,M(rt,xe,mr.slice(0,239)))}}return yn(Ae,1),Ae.end()}function h(ue,be){var Te=be||{};if(+Te.codepage>=0&&wn(+Te.codepage),Te.type=="string")throw new Error("Cannot write WK3 to JS string");var Ae=_0();yn(Ae,0,x(ue));for(var Ye=0,mt=0;Ye<ue.SheetNames.length;++Ye)(ue.Sheets[ue.SheetNames[Ye]]||{})["!ref"]&&yn(Ae,27,qe(ue.SheetNames[Ye],mt++));var wt=0;for(Ye=0;Ye<ue.SheetNames.length;++Ye){var ut=ue.Sheets[ue.SheetNames[Ye]];if(!(!ut||!ut["!ref"])){for(var rt=ha(ut["!ref"]),Yt=Array.isArray(ut),xe=[],er=Math.min(rt.e.r,8191),Jt=rt.s.r;Jt<=er;++Jt)for(var mr=Ka(Jt),Zt=rt.s.c;Zt<=rt.e.c;++Zt){Jt===rt.s.r&&(xe[Zt]=Pa(Zt));var Et=xe[Zt]+mr,wr=Yt?(ut[Jt]||[])[Zt]:ut[Et];if(!(!wr||wr.t=="z"))if(wr.t=="n")yn(Ae,23,Ue(Jt,Zt,wt,wr.v));else{var Wr=ns(wr);yn(Ae,22,te(Jt,Zt,wt,Wr.slice(0,239)))}}++wt}}return yn(Ae,1),Ae.end()}function m(ue){var be=Fa(2);return be.write_shift(2,ue),be}function x(ue){var be=Fa(26);be.write_shift(2,4096),be.write_shift(2,4),be.write_shift(4,0);for(var Te=0,Ae=0,Ye=0,mt=0;mt<ue.SheetNames.length;++mt){var wt=ue.SheetNames[mt],ut=ue.Sheets[wt];if(!(!ut||!ut["!ref"])){++Ye;var rt=yl(ut["!ref"]);Te<rt.e.r&&(Te=rt.e.r),Ae<rt.e.c&&(Ae=rt.e.c)}}return Te>8191&&(Te=8191),be.write_shift(2,Te),be.write_shift(1,Ye),be.write_shift(1,Ae),be.write_shift(2,0),be.write_shift(2,0),be.write_shift(1,1),be.write_shift(1,2),be.write_shift(4,0),be.write_shift(4,0),be}function o(ue,be,Te){var Ae={s:{c:0,r:0},e:{c:0,r:0}};return be==8&&Te.qpro?(Ae.s.c=ue.read_shift(1),ue.l++,Ae.s.r=ue.read_shift(2),Ae.e.c=ue.read_shift(1),ue.l++,Ae.e.r=ue.read_shift(2),Ae):(Ae.s.c=ue.read_shift(2),Ae.s.r=ue.read_shift(2),be==12&&Te.qpro&&(ue.l+=2),Ae.e.c=ue.read_shift(2),Ae.e.r=ue.read_shift(2),be==12&&Te.qpro&&(ue.l+=2),Ae.s.c==65535&&(Ae.s.c=Ae.e.c=Ae.s.r=Ae.e.r=0),Ae)}function S(ue){var be=Fa(8);return be.write_shift(2,ue.s.c),be.write_shift(2,ue.s.r),be.write_shift(2,ue.e.c),be.write_shift(2,ue.e.r),be}function b(ue,be,Te){var Ae=[{c:0,r:0},{t:"n",v:0},0,0];return Te.qpro&&Te.vers!=20768?(Ae[0].c=ue.read_shift(1),Ae[3]=ue.read_shift(1),Ae[0].r=ue.read_shift(2),ue.l+=2):(Ae[2]=ue.read_shift(1),Ae[0].c=ue.read_shift(2),Ae[0].r=ue.read_shift(2)),Ae}function C(ue,be,Te){var Ae=ue.l+be,Ye=b(ue,be,Te);if(Ye[1].t="s",Te.vers==20768){ue.l++;var mt=ue.read_shift(1);return Ye[1].v=ue.read_shift(mt,"utf8"),Ye}return Te.qpro&&ue.l++,Ye[1].v=ue.read_shift(Ae-ue.l,"cstr"),Ye}function M(ue,be,Te){var Ae=Fa(7+Te.length);Ae.write_shift(1,255),Ae.write_shift(2,be),Ae.write_shift(2,ue),Ae.write_shift(1,39);for(var Ye=0;Ye<Ae.length;++Ye){var mt=Te.charCodeAt(Ye);Ae.write_shift(1,mt>=128?95:mt)}return Ae.write_shift(1,0),Ae}function L(ue,be,Te){var Ae=b(ue,be,Te);return Ae[1].v=ue.read_shift(2,"i"),Ae}function z(ue,be,Te){var Ae=Fa(7);return Ae.write_shift(1,255),Ae.write_shift(2,be),Ae.write_shift(2,ue),Ae.write_shift(2,Te,"i"),Ae}function U(ue,be,Te){var Ae=b(ue,be,Te);return Ae[1].v=ue.read_shift(8,"f"),Ae}function N(ue,be,Te){var Ae=Fa(13);return Ae.write_shift(1,255),Ae.write_shift(2,be),Ae.write_shift(2,ue),Ae.write_shift(8,Te,"f"),Ae}function G(ue,be,Te){var Ae=ue.l+be,Ye=b(ue,be,Te);if(Ye[1].v=ue.read_shift(8,"f"),Te.qpro)ue.l=Ae;else{var mt=ue.read_shift(2);me(ue.slice(ue.l,ue.l+mt),Ye),ue.l+=mt}return Ye}function ie(ue,be,Te){var Ae=be&32768;return be&=-32769,be=(Ae?ue:0)+(be>=8192?be-16384:be),(Ae?"":"$")+(Te?Pa(be):Ka(be))}var pe={51:["FALSE",0],52:["TRUE",0],70:["LEN",1],80:["SUM",69],81:["AVERAGEA",69],82:["COUNTA",69],83:["MINA",69],84:["MAXA",69],111:["T",1]},Y=["","","","","","","","","","+","-","*","/","^","=","<>","<=",">=","<",">","","","","","&","","","","","","",""];function me(ue,be){Za(ue,0);for(var Te=[],Ae=0,Ye="",mt="",wt="",ut="";ue.l<ue.length;){var rt=ue[ue.l++];switch(rt){case 0:Te.push(ue.read_shift(8,"f"));break;case 1:mt=ie(be[0].c,ue.read_shift(2),!0),Ye=ie(be[0].r,ue.read_shift(2),!1),Te.push(mt+Ye);break;case 2:{var Yt=ie(be[0].c,ue.read_shift(2),!0),xe=ie(be[0].r,ue.read_shift(2),!1);mt=ie(be[0].c,ue.read_shift(2),!0),Ye=ie(be[0].r,ue.read_shift(2),!1),Te.push(Yt+xe+":"+mt+Ye)}break;case 3:if(ue.l<ue.length){console.error("WK1 premature formula end");return}break;case 4:Te.push("("+Te.pop()+")");break;case 5:Te.push(ue.read_shift(2));break;case 6:{for(var er="";rt=ue[ue.l++];)er+=String.fromCharCode(rt);Te.push('"'+er.replace(/"/g,'""')+'"')}break;case 8:Te.push("-"+Te.pop());break;case 23:Te.push("+"+Te.pop());break;case 22:Te.push("NOT("+Te.pop()+")");break;case 20:case 21:ut=Te.pop(),wt=Te.pop(),Te.push(["AND","OR"][rt-20]+"("+wt+","+ut+")");break;default:if(rt<32&&Y[rt])ut=Te.pop(),wt=Te.pop(),Te.push(wt+Y[rt]+ut);else if(pe[rt]){if(Ae=pe[rt][1],Ae==69&&(Ae=ue[ue.l++]),Ae>Te.length){console.error("WK1 bad formula parse 0x"+rt.toString(16)+":|"+Te.join("|")+"|");return}var Jt=Te.slice(-Ae);Te.length-=Ae,Te.push(pe[rt][0]+"("+Jt.join(",")+")")}else return rt<=7?console.error("WK1 invalid opcode "+rt.toString(16)):rt<=24?console.error("WK1 unsupported op "+rt.toString(16)):rt<=30?console.error("WK1 invalid opcode "+rt.toString(16)):rt<=115?console.error("WK1 unsupported function opcode "+rt.toString(16)):console.error("WK1 unrecognized opcode "+rt.toString(16))}}Te.length==1?be[1].f=""+Te[0]:console.error("WK1 bad formula parse |"+Te.join("|")+"|")}function ve(ue){var be=[{c:0,r:0},{t:"n",v:0},0];return be[0].r=ue.read_shift(2),be[3]=ue[ue.l++],be[0].c=ue[ue.l++],be}function we(ue,be){var Te=ve(ue);return Te[1].t="s",Te[1].v=ue.read_shift(be-4,"cstr"),Te}function te(ue,be,Te,Ae){var Ye=Fa(6+Ae.length);Ye.write_shift(2,ue),Ye.write_shift(1,Te),Ye.write_shift(1,be),Ye.write_shift(1,39);for(var mt=0;mt<Ae.length;++mt){var wt=Ae.charCodeAt(mt);Ye.write_shift(1,wt>=128?95:wt)}return Ye.write_shift(1,0),Ye}function Be(ue,be){var Te=ve(ue);Te[1].v=ue.read_shift(2);var Ae=Te[1].v>>1;if(Te[1].v&1)switch(Ae&7){case 0:Ae=(Ae>>3)*5e3;break;case 1:Ae=(Ae>>3)*500;break;case 2:Ae=(Ae>>3)/20;break;case 3:Ae=(Ae>>3)/200;break;case 4:Ae=(Ae>>3)/2e3;break;case 5:Ae=(Ae>>3)/2e4;break;case 6:Ae=(Ae>>3)/16;break;case 7:Ae=(Ae>>3)/64;break}return Te[1].v=Ae,Te}function Ce(ue,be){var Te=ve(ue),Ae=ue.read_shift(4),Ye=ue.read_shift(4),mt=ue.read_shift(2);if(mt==65535)return Ae===0&&Ye===3221225472?(Te[1].t="e",Te[1].v=15):Ae===0&&Ye===3489660928?(Te[1].t="e",Te[1].v=42):Te[1].v=0,Te;var wt=mt&32768;return mt=(mt&32767)-16446,Te[1].v=(1-wt*2)*(Ye*Math.pow(2,mt+32)+Ae*Math.pow(2,mt)),Te}function Ue(ue,be,Te,Ae){var Ye=Fa(14);if(Ye.write_shift(2,ue),Ye.write_shift(1,Te),Ye.write_shift(1,be),Ae==0)return Ye.write_shift(4,0),Ye.write_shift(4,0),Ye.write_shift(2,65535),Ye;var mt=0,wt=0,ut=0,rt=0;return Ae<0&&(mt=1,Ae=-Ae),wt=Math.log2(Ae)|0,Ae/=Math.pow(2,wt-31),rt=Ae>>>0,rt&2147483648||(Ae/=2,++wt,rt=Ae>>>0),Ae-=rt,rt|=2147483648,rt>>>=0,Ae*=Math.pow(2,32),ut=Ae>>>0,Ye.write_shift(4,ut),Ye.write_shift(4,rt),wt+=16383+(mt?32768:0),Ye.write_shift(2,wt),Ye}function $e(ue,be){var Te=Ce(ue);return ue.l+=be-14,Te}function Re(ue,be){var Te=ve(ue),Ae=ue.read_shift(4);return Te[1].v=Ae>>6,Te}function st(ue,be){var Te=ve(ue),Ae=ue.read_shift(8,"f");return Te[1].v=Ae,Te}function pt(ue,be){var Te=st(ue);return ue.l+=be-10,Te}function ot(ue,be){return ue[ue.l+be-1]==0?ue.read_shift(be,"cstr"):""}function _t(ue,be){var Te=ue[ue.l++];Te>be-1&&(Te=be-1);for(var Ae="";Ae.length<Te;)Ae+=String.fromCharCode(ue[ue.l++]);return Ae}function ft(ue,be,Te){if(!(!Te.qpro||be<21)){var Ae=ue.read_shift(1);ue.l+=17,ue.l+=1,ue.l+=2;var Ye=ue.read_shift(be-21,"cstr");return[Ae,Ye]}}function ir(ue,be){for(var Te={},Ae=ue.l+be;ue.l<Ae;){var Ye=ue.read_shift(2);if(Ye==14e3){for(Te[Ye]=[0,""],Te[Ye][0]=ue.read_shift(2);ue[ue.l];)Te[Ye][1]+=String.fromCharCode(ue[ue.l]),ue.l++;ue.l++}}return Te}function qe(ue,be){var Te=Fa(5+ue.length);Te.write_shift(2,14e3),Te.write_shift(2,be);for(var Ae=0;Ae<ue.length;++Ae){var Ye=ue.charCodeAt(Ae);Te[Te.l++]=Ye>127?95:Ye}return Te[Te.l++]=0,Te}var $t={0:{n:"BOF",f:Ea},1:{n:"EOF"},2:{n:"CALCMODE"},3:{n:"CALCORDER"},4:{n:"SPLIT"},5:{n:"SYNC"},6:{n:"RANGE",f:o},7:{n:"WINDOW1"},8:{n:"COLW1"},9:{n:"WINTWO"},10:{n:"COLW2"},11:{n:"NAME"},12:{n:"BLANK"},13:{n:"INTEGER",f:L},14:{n:"NUMBER",f:U},15:{n:"LABEL",f:C},16:{n:"FORMULA",f:G},24:{n:"TABLE"},25:{n:"ORANGE"},26:{n:"PRANGE"},27:{n:"SRANGE"},28:{n:"FRANGE"},29:{n:"KRANGE1"},32:{n:"HRANGE"},35:{n:"KRANGE2"},36:{n:"PROTEC"},37:{n:"FOOTER"},38:{n:"HEADER"},39:{n:"SETUP"},40:{n:"MARGINS"},41:{n:"LABELFMT"},42:{n:"TITLES"},43:{n:"SHEETJS"},45:{n:"GRAPH"},46:{n:"NGRAPH"},47:{n:"CALCCOUNT"},48:{n:"UNFORMATTED"},49:{n:"CURSORW12"},50:{n:"WINDOW"},51:{n:"STRING",f:C},55:{n:"PASSWORD"},56:{n:"LOCKED"},60:{n:"QUERY"},61:{n:"QUERYNAME"},62:{n:"PRINT"},63:{n:"PRINTNAME"},64:{n:"GRAPH2"},65:{n:"GRAPHNAME"},66:{n:"ZOOM"},67:{n:"SYMSPLIT"},68:{n:"NSROWS"},69:{n:"NSCOLS"},70:{n:"RULER"},71:{n:"NNAME"},72:{n:"ACOMM"},73:{n:"AMACRO"},74:{n:"PARSE"},102:{n:"PRANGES??"},103:{n:"RRANGES??"},104:{n:"FNAME??"},105:{n:"MRANGES??"},204:{n:"SHEETNAMECS",f:ot},222:{n:"SHEETNAMELP",f:_t},65535:{n:""}},Dt={0:{n:"BOF"},1:{n:"EOF"},2:{n:"PASSWORD"},3:{n:"CALCSET"},4:{n:"WINDOWSET"},5:{n:"SHEETCELLPTR"},6:{n:"SHEETLAYOUT"},7:{n:"COLUMNWIDTH"},8:{n:"HIDDENCOLUMN"},9:{n:"USERRANGE"},10:{n:"SYSTEMRANGE"},11:{n:"ZEROFORCE"},12:{n:"SORTKEYDIR"},13:{n:"FILESEAL"},14:{n:"DATAFILLNUMS"},15:{n:"PRINTMAIN"},16:{n:"PRINTSTRING"},17:{n:"GRAPHMAIN"},18:{n:"GRAPHSTRING"},19:{n:"??"},20:{n:"ERRCELL"},21:{n:"NACELL"},22:{n:"LABEL16",f:we},23:{n:"NUMBER17",f:Ce},24:{n:"NUMBER18",f:Be},25:{n:"FORMULA19",f:$e},26:{n:"FORMULA1A"},27:{n:"XFORMAT",f:ir},28:{n:"DTLABELMISC"},29:{n:"DTLABELCELL"},30:{n:"GRAPHWINDOW"},31:{n:"CPA"},32:{n:"LPLAUTO"},33:{n:"QUERY"},34:{n:"HIDDENSHEET"},35:{n:"??"},37:{n:"NUMBER25",f:Re},38:{n:"??"},39:{n:"NUMBER27",f:st},40:{n:"FORMULA28",f:pt},142:{n:"??"},147:{n:"??"},150:{n:"??"},151:{n:"??"},152:{n:"??"},153:{n:"??"},154:{n:"??"},155:{n:"??"},156:{n:"??"},163:{n:"??"},174:{n:"??"},175:{n:"??"},176:{n:"??"},177:{n:"??"},184:{n:"??"},185:{n:"??"},186:{n:"??"},187:{n:"??"},188:{n:"??"},195:{n:"??"},201:{n:"??"},204:{n:"SHEETNAMECS",f:ot},205:{n:"??"},206:{n:"??"},207:{n:"??"},208:{n:"??"},256:{n:"??"},259:{n:"??"},260:{n:"??"},261:{n:"??"},262:{n:"??"},263:{n:"??"},265:{n:"??"},266:{n:"??"},267:{n:"??"},268:{n:"??"},270:{n:"??"},271:{n:"??"},384:{n:"??"},389:{n:"??"},390:{n:"??"},393:{n:"??"},396:{n:"??"},512:{n:"??"},514:{n:"??"},513:{n:"??"},516:{n:"??"},517:{n:"??"},640:{n:"??"},641:{n:"??"},642:{n:"??"},643:{n:"??"},644:{n:"??"},645:{n:"??"},646:{n:"??"},647:{n:"??"},648:{n:"??"},658:{n:"??"},659:{n:"??"},660:{n:"??"},661:{n:"??"},662:{n:"??"},665:{n:"??"},666:{n:"??"},768:{n:"??"},772:{n:"??"},1537:{n:"SHEETINFOQP",f:ft},1600:{n:"??"},1602:{n:"??"},1793:{n:"??"},1794:{n:"??"},1795:{n:"??"},1796:{n:"??"},1920:{n:"??"},2048:{n:"??"},2049:{n:"??"},2052:{n:"??"},2688:{n:"??"},10998:{n:"??"},12849:{n:"??"},28233:{n:"??"},28484:{n:"??"},65535:{n:""}};return{sheet_to_wk1:c,book_to_wk3:h,to_workbook:n}}();function GE(e){var n={},i=e.match(fi),c=0,h=!1;if(i)for(;c!=i.length;++c){var m=rr(i[c]);switch(m[0].replace(/\w*:/g,"")){case"<condense":break;case"<extend":break;case"<shadow":if(!m.val)break;case"<shadow>":case"<shadow/>":n.shadow=1;break;case"</shadow>":break;case"<charset":if(m.val=="1")break;n.cp=D0[parseInt(m.val,10)];break;case"<outline":if(!m.val)break;case"<outline>":case"<outline/>":n.outline=1;break;case"</outline>":break;case"<rFont":n.name=m.val;break;case"<sz":n.sz=m.val;break;case"<strike":if(!m.val)break;case"<strike>":case"<strike/>":n.strike=1;break;case"</strike>":break;case"<u":if(!m.val)break;switch(m.val){case"double":n.uval="double";break;case"singleAccounting":n.uval="single-accounting";break;case"doubleAccounting":n.uval="double-accounting";break}case"<u>":case"<u/>":n.u=1;break;case"</u>":break;case"<b":if(m.val=="0")break;case"<b>":case"<b/>":n.b=1;break;case"</b>":break;case"<i":if(m.val=="0")break;case"<i>":case"<i/>":n.i=1;break;case"</i>":break;case"<color":m.rgb&&(n.color=m.rgb.slice(2,8));break;case"<color>":case"<color/>":case"</color>":break;case"<family":n.family=m.val;break;case"<family>":case"<family/>":case"</family>":break;case"<vertAlign":n.valign=m.val;break;case"<vertAlign>":case"<vertAlign/>":case"</vertAlign>":break;case"<scheme":break;case"<scheme>":case"<scheme/>":case"</scheme>":break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":h=!0;break;case"</ext>":h=!1;break;default:if(m[0].charCodeAt(1)!==47&&!h)throw new Error("Unrecognized rich format "+m[0])}}return n}var HE=function(){var e=$c("t"),n=$c("rPr");function i(m){var x=m.match(e);if(!x)return{t:"s",v:""};var o={t:"s",v:Er(x[1])},S=m.match(n);return S&&(o.s=GE(S[1])),o}var c=/<(?:\w+:)?r>/g,h=/<\/(?:\w+:)?r>/;return function(x){return x.replace(c,"").split(h).map(i).filter(function(o){return o.v})}}(),qE=function(){var n=/(\r\n|\n)/g;function i(h,m,x){var o=[];h.u&&o.push("text-decoration: underline;"),h.uval&&o.push("text-underline-style:"+h.uval+";"),h.sz&&o.push("font-size:"+h.sz+"pt;"),h.outline&&o.push("text-effect: outline;"),h.shadow&&o.push("text-shadow: auto;"),m.push('<span style="'+o.join("")+'">'),h.b&&(m.push("<b>"),x.push("</b>")),h.i&&(m.push("<i>"),x.push("</i>")),h.strike&&(m.push("<s>"),x.push("</s>"));var S=h.valign||"";return S=="superscript"||S=="super"?S="sup":S=="subscript"&&(S="sub"),S!=""&&(m.push("<"+S+">"),x.push("</"+S+">")),x.push("</span>"),h}function c(h){var m=[[],h.v,[]];return h.v?(h.s&&i(h.s,m[0],m[2]),m[0].join("")+m[1].replace(n,"<br/>")+m[2].join("")):""}return function(m){return m.map(c).join("")}}(),WE=/<(?:\w+:)?t[^>]*>([^<]*)<\/(?:\w+:)?t>/g,ZE=/<(?:\w+:)?r>/,XE=/<(?:\w+:)?rPh.*?>([\s\S]*?)<\/(?:\w+:)?rPh>/g;function K0(e,n){var i=n?n.cellHTML:!0,c={};return e?(e.match(/^\s*<(?:\w+:)?t[^>]*>/)?(c.t=Er(jr(e.slice(e.indexOf(">")+1).split(/<\/(?:\w+:)?t>/)[0]||"")),c.r=jr(e),i&&(c.h=U0(c.t))):e.match(ZE)&&(c.r=jr(e),c.t=Er(jr((e.replace(XE,"").match(WE)||[]).join("").replace(fi,""))),i&&(c.h=qE(HE(c.r)))),c):{t:""}}var KE=/<(?:\w+:)?sst([^>]*)>([\s\S]*)<\/(?:\w+:)?sst>/,YE=/<(?:\w+:)?(?:si|sstItem)>/g,JE=/<\/(?:\w+:)?(?:si|sstItem)>/;function QE(e,n){var i=[],c="";if(!e)return i;var h=e.match(KE);if(h){c=h[2].replace(YE,"").split(JE);for(var m=0;m!=c.length;++m){var x=K0(c[m].trim(),n);x!=null&&(i[i.length]=x)}h=rr(h[1]),i.Count=h.count,i.Unique=h.uniqueCount}return i}function eS(e){return[e.read_shift(4),e.read_shift(4)]}function tS(e,n){var i=[],c=!1;return ss(e,function(m,x,o){switch(o){case 159:i.Count=m[0],i.Unique=m[1];break;case 19:i.push(m);break;case 160:return!0;case 35:c=!0;break;case 36:c=!1;break;default:if(x.T,!c||n.WTF)throw new Error("Unexpected record 0x"+o.toString(16))}}),i}function N1(e){for(var n=[],i=e.split(""),c=0;c<i.length;++c)n[c]=i[c].charCodeAt(0);return n}function is(e,n){var i={};return i.Major=e.read_shift(2),i.Minor=e.read_shift(2),n>=4&&(e.l+=n-4),i}function rS(e){var n={};return n.id=e.read_shift(0,"lpp4"),n.R=is(e,4),n.U=is(e,4),n.W=is(e,4),n}function aS(e){for(var n=e.read_shift(4),i=e.l+n-4,c={},h=e.read_shift(4),m=[];h-- >0;)m.push({t:e.read_shift(4),v:e.read_shift(0,"lpp4")});if(c.name=e.read_shift(0,"lpp4"),c.comps=m,e.l!=i)throw new Error("Bad DataSpaceMapEntry: "+e.l+" != "+i);return c}function iS(e){var n=[];e.l+=4;for(var i=e.read_shift(4);i-- >0;)n.push(aS(e));return n}function nS(e){var n=[];e.l+=4;for(var i=e.read_shift(4);i-- >0;)n.push(e.read_shift(0,"lpp4"));return n}function sS(e){var n={};return e.read_shift(4),e.l+=4,n.id=e.read_shift(0,"lpp4"),n.name=e.read_shift(0,"lpp4"),n.R=is(e,4),n.U=is(e,4),n.W=is(e,4),n}function oS(e){var n=sS(e);if(n.ename=e.read_shift(0,"8lpp4"),n.blksz=e.read_shift(4),n.cmode=e.read_shift(4),e.read_shift(4)!=4)throw new Error("Bad !Primary record");return n}function U1(e,n){var i=e.l+n,c={};c.Flags=e.read_shift(4)&63,e.l+=4,c.AlgID=e.read_shift(4);var h=!1;switch(c.AlgID){case 26126:case 26127:case 26128:h=c.Flags==36;break;case 26625:h=c.Flags==4;break;case 0:h=c.Flags==16||c.Flags==4||c.Flags==36;break;default:throw"Unrecognized encryption algorithm: "+c.AlgID}if(!h)throw new Error("Encryption Flags/AlgID mismatch");return c.AlgIDHash=e.read_shift(4),c.KeySize=e.read_shift(4),c.ProviderType=e.read_shift(4),e.l+=8,c.CSPName=e.read_shift(i-e.l>>1,"utf16le"),e.l=i,c}function V1(e,n){var i={},c=e.l+n;return e.l+=4,i.Salt=e.slice(e.l,e.l+16),e.l+=16,i.Verifier=e.slice(e.l,e.l+16),e.l+=16,e.read_shift(4),i.VerifierHash=e.slice(e.l,c),e.l=c,i}function lS(e){var n=is(e);switch(n.Minor){case 2:return[n.Minor,cS(e)];case 3:return[n.Minor,hS()];case 4:return[n.Minor,uS(e)]}throw new Error("ECMA-376 Encrypted file unrecognized Version: "+n.Minor)}function cS(e){var n=e.read_shift(4);if((n&63)!=36)throw new Error("EncryptionInfo mismatch");var i=e.read_shift(4),c=U1(e,i),h=V1(e,e.length-e.l);return{t:"Std",h:c,v:h}}function hS(){throw new Error("File is password-protected: ECMA-376 Extensible")}function uS(e){var n=["saltSize","blockSize","keyBits","hashSize","cipherAlgorithm","cipherChaining","hashAlgorithm","saltValue"];e.l+=4;var i=e.read_shift(e.length-e.l,"utf8"),c={};return i.replace(fi,function(m){var x=rr(m);switch(Bn(x[0])){case"<?xml":break;case"<encryption":case"</encryption>":break;case"<keyData":n.forEach(function(o){c[o]=x[o]});break;case"<dataIntegrity":c.encryptedHmacKey=x.encryptedHmacKey,c.encryptedHmacValue=x.encryptedHmacValue;break;case"<keyEncryptors>":case"<keyEncryptors":c.encs=[];break;case"</keyEncryptors>":break;case"<keyEncryptor":c.uri=x.uri;break;case"</keyEncryptor>":break;case"<encryptedKey":c.encs.push(x);break;default:throw x[0]}}),c}function fS(e,n){var i={},c=i.EncryptionVersionInfo=is(e,4);if(n-=4,c.Minor!=2)throw new Error("unrecognized minor version code: "+c.Minor);if(c.Major>4||c.Major<2)throw new Error("unrecognized major version code: "+c.Major);i.Flags=e.read_shift(4),n-=4;var h=e.read_shift(4);return n-=4,i.EncryptionHeader=U1(e,h),n-=h,i.EncryptionVerifier=V1(e,n),i}function dS(e){var n={},i=n.EncryptionVersionInfo=is(e,4);if(i.Major!=1||i.Minor!=1)throw"unrecognized version code "+i.Major+" : "+i.Minor;return n.Salt=e.read_shift(16),n.EncryptedVerifier=e.read_shift(16),n.EncryptedVerifierHash=e.read_shift(16),n}function pS(e){var n=0,i,c=N1(e),h=c.length+1,m,x,o,S,b;for(i=Ds(h),i[0]=c.length,m=1;m!=h;++m)i[m]=c[m-1];for(m=h-1;m>=0;--m)x=i[m],o=n&16384?1:0,S=n<<1&32767,b=o|S,n=b^x;return n^52811}var $1=function(){var e=[187,255,255,186,255,255,185,128,0,190,15,0,191,15,0],n=[57840,7439,52380,33984,4364,3600,61902,12606,6258,57657,54287,34041,10252,43370,20163],i=[44796,19929,39858,10053,20106,40212,10761,31585,63170,64933,60267,50935,40399,11199,17763,35526,1453,2906,5812,11624,23248,885,1770,3540,7080,14160,28320,56640,55369,41139,20807,41614,21821,43642,17621,28485,56970,44341,19019,38038,14605,29210,60195,50791,40175,10751,21502,43004,24537,18387,36774,3949,7898,15796,31592,63184,47201,24803,49606,37805,14203,28406,56812,17824,35648,1697,3394,6788,13576,27152,43601,17539,35078,557,1114,2228,4456,30388,60776,51953,34243,7079,14158,28316,14128,28256,56512,43425,17251,34502,7597,13105,26210,52420,35241,883,1766,3532,4129,8258,16516,33032,4657,9314,18628],c=function(x){return(x/2|x*128)&255},h=function(x,o){return c(x^o)},m=function(x){for(var o=n[x.length-1],S=104,b=x.length-1;b>=0;--b)for(var C=x[b],M=0;M!=7;++M)C&64&&(o^=i[S]),C*=2,--S;return o};return function(x){for(var o=N1(x),S=m(o),b=o.length,C=Ds(16),M=0;M!=16;++M)C[M]=0;var L,z,U;for((b&1)===1&&(L=S>>8,C[b]=h(e[0],L),--b,L=S&255,z=o[o.length-1],C[b]=h(z,L));b>0;)--b,L=S>>8,C[b]=h(o[b],L),--b,L=S&255,C[b]=h(o[b],L);for(b=15,U=15-o.length;U>0;)L=S>>8,C[b]=h(e[U],L),--b,--U,L=S&255,C[b]=h(o[b],L),--b,--U;return C}}(),mS=function(e,n,i,c,h){h||(h=n),c||(c=$1(e));var m,x;for(m=0;m!=n.length;++m)x=n[m],x^=c[i],x=(x>>5|x<<3)&255,h[m]=x,++i;return[h,i,c]},gS=function(e){var n=0,i=$1(e);return function(c){var h=mS("",c,n,i);return n=h[1],h[0]}};function xS(e,n,i,c){var h={key:Ea(e),verificationBytes:Ea(e)};return i.password&&(h.verifier=pS(i.password)),c.valid=h.verificationBytes===h.verifier,c.valid&&(c.insitu=gS(i.password)),h}function _S(e,n,i){var c=i||{};return c.Info=e.read_shift(2),e.l-=2,c.Info===1?c.Data=dS(e):c.Data=fS(e,n),c}function yS(e,n,i){var c={Type:i.biff>=8?e.read_shift(2):0};return c.Type?_S(e,n-2,c):xS(e,i.biff>=8?n:n-2,i,c),c}var vS=function(){function e(h,m){switch(m.type){case"base64":return n(Gi(h),m);case"binary":return n(h,m);case"buffer":return n(vr&&Buffer.isBuffer(h)?h.toString("binary"):xo(h),m);case"array":return n(fo(h),m)}throw new Error("Unrecognized type "+m.type)}function n(h,m){var x=m||{},o=x.dense?[]:{},S=h.match(/\\trowd.*?\\row\b/g);if(!S.length)throw new Error("RTF missing table");var b={s:{c:0,r:0},e:{c:0,r:S.length-1}};return S.forEach(function(C,M){Array.isArray(o)&&(o[M]=[]);for(var L=/\\\w+\b/g,z=0,U,N=-1;U=L.exec(C);){switch(U[0]){case"\\cell":var G=C.slice(z,L.lastIndex-U[0].length);if(G[0]==" "&&(G=G.slice(1)),++N,G.length){var ie={v:G,t:"s"};Array.isArray(o)?o[M][N]=ie:o[sr({r:M,c:N})]=ie}break}z=L.lastIndex}N>b.e.c&&(b.e.c=N)}),o["!ref"]=Tr(b),o}function i(h,m){return Rs(e(h,m),m)}function c(h){for(var m=["{\\rtf1\\ansi"],x=ha(h["!ref"]),o,S=Array.isArray(h),b=x.s.r;b<=x.e.r;++b){m.push("\\trowd\\trautofit1");for(var C=x.s.c;C<=x.e.c;++C)m.push("\\cellx"+(C+1));for(m.push("\\pard\\intbl"),C=x.s.c;C<=x.e.c;++C){var M=sr({r:b,c:C});o=S?(h[b]||[])[C]:h[M],!(!o||o.v==null&&(!o.f||o.F))&&(m.push(" "+(o.w||(ns(o),o.w))),m.push("\\cell"))}m.push("\\pard\\intbl\\row")}return m.join("")+"}"}return{to_workbook:i,to_sheet:e,from_sheet:c}}();function wS(e){var n=e.slice(e[0]==="#"?1:0).slice(0,6);return[parseInt(n.slice(0,2),16),parseInt(n.slice(2,4),16),parseInt(n.slice(4,6),16)]}function Hc(e){for(var n=0,i=1;n!=3;++n)i=i*256+(e[n]>255?255:e[n]<0?0:e[n]);return i.toString(16).toUpperCase().slice(1)}function bS(e){var n=e[0]/255,i=e[1]/255,c=e[2]/255,h=Math.max(n,i,c),m=Math.min(n,i,c),x=h-m;if(x===0)return[0,0,n];var o=0,S=0,b=h+m;switch(S=x/(b>1?2-b:b),h){case n:o=((i-c)/x+6)%6;break;case i:o=(c-n)/x+2;break;case c:o=(n-i)/x+4;break}return[o/6,S,b/2]}function TS(e){var n=e[0],i=e[1],c=e[2],h=i*2*(c<.5?c:1-c),m=c-h/2,x=[m,m,m],o=6*n,S;if(i!==0)switch(o|0){case 0:case 6:S=h*o,x[0]+=h,x[1]+=S;break;case 1:S=h*(2-o),x[0]+=S,x[1]+=h;break;case 2:S=h*(o-2),x[1]+=h,x[2]+=S;break;case 3:S=h*(4-o),x[1]+=S,x[2]+=h;break;case 4:S=h*(o-4),x[2]+=h,x[0]+=S;break;case 5:S=h*(6-o),x[2]+=S,x[0]+=h;break}for(var b=0;b!=3;++b)x[b]=Math.round(x[b]*255);return x}function Mu(e,n){if(n===0)return e;var i=bS(wS(e));return n<0?i[2]=i[2]*(1+n):i[2]=1-(1-i[2])*(1-n),Hc(TS(i))}var j1=6,ES=15,SS=1,Ei=j1;function Du(e){return Math.floor((e+Math.round(128/Ei)/256)*Ei)}function Lu(e){return Math.floor((e-5)/Ei*100+.5)/100}function b0(e){return Math.round((e*Ei+5)/Ei*256)/256}function s0(e){return b0(Lu(Du(e)))}function Y0(e){var n=Math.abs(e-s0(e)),i=Ei;if(n>.005)for(Ei=SS;Ei<ES;++Ei)Math.abs(e-s0(e))<=n&&(n=Math.abs(e-s0(e)),i=Ei);Ei=i}function ml(e){e.width?(e.wpx=Du(e.width),e.wch=Lu(e.wpx),e.MDW=Ei):e.wpx?(e.wch=Lu(e.wpx),e.width=b0(e.wch),e.MDW=Ei):typeof e.wch=="number"&&(e.width=b0(e.wch),e.wpx=Du(e.width),e.MDW=Ei),e.customWidth&&delete e.customWidth}var kS=96,G1=kS;function H1(e){return e*96/G1}function qc(e){return e*G1/96}var CS={None:"none",Solid:"solid",Gray50:"mediumGray",Gray75:"darkGray",Gray25:"lightGray",HorzStripe:"darkHorizontal",VertStripe:"darkVertical",ReverseDiagStripe:"darkDown",DiagStripe:"darkUp",DiagCross:"darkGrid",ThickDiagCross:"darkTrellis",ThinHorzStripe:"lightHorizontal",ThinVertStripe:"lightVertical",ThinReverseDiagStripe:"lightDown",ThinHorzCross:"lightGrid"};function AS(e,n,i,c){n.Borders=[];var h={},m=!1;(e[0].match(fi)||[]).forEach(function(x){var o=rr(x);switch(Bn(o[0])){case"<borders":case"<borders>":case"</borders>":break;case"<border":case"<border>":case"<border/>":h={},o.diagonalUp&&(h.diagonalUp=ea(o.diagonalUp)),o.diagonalDown&&(h.diagonalDown=ea(o.diagonalDown)),n.Borders.push(h);break;case"</border>":break;case"<left/>":break;case"<left":case"<left>":break;case"</left>":break;case"<right/>":break;case"<right":case"<right>":break;case"</right>":break;case"<top/>":break;case"<top":case"<top>":break;case"</top>":break;case"<bottom/>":break;case"<bottom":case"<bottom>":break;case"</bottom>":break;case"<diagonal":case"<diagonal>":case"<diagonal/>":break;case"</diagonal>":break;case"<horizontal":case"<horizontal>":case"<horizontal/>":break;case"</horizontal>":break;case"<vertical":case"<vertical>":case"<vertical/>":break;case"</vertical>":break;case"<start":case"<start>":case"<start/>":break;case"</start>":break;case"<end":case"<end>":case"<end/>":break;case"</end>":break;case"<color":case"<color>":break;case"<color/>":case"</color>":break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":m=!0;break;case"</ext>":m=!1;break;default:if(c&&c.WTF&&!m)throw new Error("unrecognized "+o[0]+" in borders")}})}function IS(e,n,i,c){n.Fills=[];var h={},m=!1;(e[0].match(fi)||[]).forEach(function(x){var o=rr(x);switch(Bn(o[0])){case"<fills":case"<fills>":case"</fills>":break;case"<fill>":case"<fill":case"<fill/>":h={},n.Fills.push(h);break;case"</fill>":break;case"<gradientFill>":break;case"<gradientFill":case"</gradientFill>":n.Fills.push(h),h={};break;case"<patternFill":case"<patternFill>":o.patternType&&(h.patternType=o.patternType);break;case"<patternFill/>":case"</patternFill>":break;case"<bgColor":h.bgColor||(h.bgColor={}),o.indexed&&(h.bgColor.indexed=parseInt(o.indexed,10)),o.theme&&(h.bgColor.theme=parseInt(o.theme,10)),o.tint&&(h.bgColor.tint=parseFloat(o.tint)),o.rgb&&(h.bgColor.rgb=o.rgb.slice(-6));break;case"<bgColor/>":case"</bgColor>":break;case"<fgColor":h.fgColor||(h.fgColor={}),o.theme&&(h.fgColor.theme=parseInt(o.theme,10)),o.tint&&(h.fgColor.tint=parseFloat(o.tint)),o.rgb!=null&&(h.fgColor.rgb=o.rgb.slice(-6));break;case"<fgColor/>":case"</fgColor>":break;case"<stop":case"<stop/>":break;case"</stop>":break;case"<color":case"<color/>":break;case"</color>":break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":m=!0;break;case"</ext>":m=!1;break;default:if(c&&c.WTF&&!m)throw new Error("unrecognized "+o[0]+" in fills")}})}function FS(e,n,i,c){n.Fonts=[];var h={},m=!1;(e[0].match(fi)||[]).forEach(function(x){var o=rr(x);switch(Bn(o[0])){case"<fonts":case"<fonts>":case"</fonts>":break;case"<font":case"<font>":break;case"</font>":case"<font/>":n.Fonts.push(h),h={};break;case"<name":o.val&&(h.name=jr(o.val));break;case"<name/>":case"</name>":break;case"<b":h.bold=o.val?ea(o.val):1;break;case"<b/>":h.bold=1;break;case"<i":h.italic=o.val?ea(o.val):1;break;case"<i/>":h.italic=1;break;case"<u":switch(o.val){case"none":h.underline=0;break;case"single":h.underline=1;break;case"double":h.underline=2;break;case"singleAccounting":h.underline=33;break;case"doubleAccounting":h.underline=34;break}break;case"<u/>":h.underline=1;break;case"<strike":h.strike=o.val?ea(o.val):1;break;case"<strike/>":h.strike=1;break;case"<outline":h.outline=o.val?ea(o.val):1;break;case"<outline/>":h.outline=1;break;case"<shadow":h.shadow=o.val?ea(o.val):1;break;case"<shadow/>":h.shadow=1;break;case"<condense":h.condense=o.val?ea(o.val):1;break;case"<condense/>":h.condense=1;break;case"<extend":h.extend=o.val?ea(o.val):1;break;case"<extend/>":h.extend=1;break;case"<sz":o.val&&(h.sz=+o.val);break;case"<sz/>":case"</sz>":break;case"<vertAlign":o.val&&(h.vertAlign=o.val);break;case"<vertAlign/>":case"</vertAlign>":break;case"<family":o.val&&(h.family=parseInt(o.val,10));break;case"<family/>":case"</family>":break;case"<scheme":o.val&&(h.scheme=o.val);break;case"<scheme/>":case"</scheme>":break;case"<charset":if(o.val=="1")break;o.codepage=D0[parseInt(o.val,10)];break;case"<color":if(h.color||(h.color={}),o.auto&&(h.color.auto=ea(o.auto)),o.rgb)h.color.rgb=o.rgb.slice(-6);else if(o.indexed){h.color.index=parseInt(o.indexed,10);var S=ho[h.color.index];h.color.index==81&&(S=ho[1]),S||(S=ho[1]),h.color.rgb=S[0].toString(16)+S[1].toString(16)+S[2].toString(16)}else o.theme&&(h.color.theme=parseInt(o.theme,10),o.tint&&(h.color.tint=parseFloat(o.tint)),o.theme&&i.themeElements&&i.themeElements.clrScheme&&(h.color.rgb=Mu(i.themeElements.clrScheme[h.color.theme].rgb,h.color.tint||0)));break;case"<color/>":case"</color>":break;case"<AlternateContent":m=!0;break;case"</AlternateContent>":m=!1;break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":m=!0;break;case"</ext>":m=!1;break;default:if(c&&c.WTF&&!m)throw new Error("unrecognized "+o[0]+" in fonts")}})}function PS(e,n,i){n.NumberFmt=[];for(var c=On(hr),h=0;h<c.length;++h)n.NumberFmt[c[h]]=hr[c[h]];var m=e[0].match(fi);if(m)for(h=0;h<m.length;++h){var x=rr(m[h]);switch(Bn(x[0])){case"<numFmts":case"</numFmts>":case"<numFmts/>":case"<numFmts>":break;case"<numFmt":{var o=Er(jr(x.formatCode)),S=parseInt(x.numFmtId,10);if(n.NumberFmt[S]=o,S>0){if(S>392){for(S=392;S>60&&n.NumberFmt[S]!=null;--S);n.NumberFmt[S]=o}co(o,S)}}break;case"</numFmt>":break;default:if(i.WTF)throw new Error("unrecognized "+x[0]+" in numFmts")}}}var gu=["numFmtId","fillId","fontId","borderId","xfId"],xu=["applyAlignment","applyBorder","applyFill","applyFont","applyNumberFormat","applyProtection","pivotButton","quotePrefix"];function MS(e,n,i){n.CellXf=[];var c,h=!1;(e[0].match(fi)||[]).forEach(function(m){var x=rr(m),o=0;switch(Bn(x[0])){case"<cellXfs":case"<cellXfs>":case"<cellXfs/>":case"</cellXfs>":break;case"<xf":case"<xf/>":for(c=x,delete c[0],o=0;o<gu.length;++o)c[gu[o]]&&(c[gu[o]]=parseInt(c[gu[o]],10));for(o=0;o<xu.length;++o)c[xu[o]]&&(c[xu[o]]=ea(c[xu[o]]));if(n.NumberFmt&&c.numFmtId>392){for(o=392;o>60;--o)if(n.NumberFmt[c.numFmtId]==n.NumberFmt[o]){c.numFmtId=o;break}}n.CellXf.push(c);break;case"</xf>":break;case"<alignment":case"<alignment/>":var S={};x.vertical&&(S.vertical=x.vertical),x.horizontal&&(S.horizontal=x.horizontal),x.textRotation!=null&&(S.textRotation=x.textRotation),x.indent&&(S.indent=x.indent),x.wrapText&&(S.wrapText=ea(x.wrapText)),c.alignment=S;break;case"</alignment>":break;case"<protection":break;case"</protection>":case"<protection/>":break;case"<AlternateContent":h=!0;break;case"</AlternateContent>":h=!1;break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":h=!0;break;case"</ext>":h=!1;break;default:if(i&&i.WTF&&!h)throw new Error("unrecognized "+x[0]+" in cellXfs")}})}var DS=function(){var n=/<(?:\w+:)?numFmts([^>]*)>[\S\s]*?<\/(?:\w+:)?numFmts>/,i=/<(?:\w+:)?cellXfs([^>]*)>[\S\s]*?<\/(?:\w+:)?cellXfs>/,c=/<(?:\w+:)?fills([^>]*)>[\S\s]*?<\/(?:\w+:)?fills>/,h=/<(?:\w+:)?fonts([^>]*)>[\S\s]*?<\/(?:\w+:)?fonts>/,m=/<(?:\w+:)?borders([^>]*)>[\S\s]*?<\/(?:\w+:)?borders>/;return function(o,S,b){var C={};if(!o)return C;o=o.replace(/<!--([\s\S]*?)-->/mg,"").replace(/<!DOCTYPE[^\[]*\[[^\]]*\]>/gm,"");var M;return(M=o.match(n))&&PS(M,C,b),(M=o.match(h))&&FS(M,C,S,b),(M=o.match(c))&&IS(M,C,S,b),(M=o.match(m))&&AS(M,C,S,b),(M=o.match(i))&&MS(M,C,b),C}}();function LS(e,n){var i=e.read_shift(2),c=hi(e);return[i,c]}function RS(e,n,i){var c={};c.sz=e.read_shift(2)/20;var h=Hb(e);h.fItalic&&(c.italic=1),h.fCondense&&(c.condense=1),h.fExtend&&(c.extend=1),h.fShadow&&(c.shadow=1),h.fOutline&&(c.outline=1),h.fStrikeout&&(c.strike=1);var m=e.read_shift(2);switch(m===700&&(c.bold=1),e.read_shift(2)){case 1:c.vertAlign="superscript";break;case 2:c.vertAlign="subscript";break}var x=e.read_shift(1);x!=0&&(c.underline=x);var o=e.read_shift(1);o>0&&(c.family=o);var S=e.read_shift(1);switch(S>0&&(c.charset=S),e.l++,c.color=Gb(e),e.read_shift(1)){case 1:c.scheme="major";break;case 2:c.scheme="minor";break}return c.name=hi(e),c}var OS=ui;function BS(e,n){var i=e.l+n,c=e.read_shift(2),h=e.read_shift(2);return e.l=i,{ixfe:c,numFmtId:h}}var zS=ui;function NS(e,n,i){var c={};c.NumberFmt=[];for(var h in hr)c.NumberFmt[h]=hr[h];c.CellXf=[],c.Fonts=[];var m=[],x=!1;return ss(e,function(S,b,C){switch(C){case 44:c.NumberFmt[S[0]]=S[1],co(S[1],S[0]);break;case 43:c.Fonts.push(S),S.color.theme!=null&&n&&n.themeElements&&n.themeElements.clrScheme&&(S.color.rgb=Mu(n.themeElements.clrScheme[S.color.theme].rgb,S.color.tint||0));break;case 1025:break;case 45:break;case 46:break;case 47:m[m.length-1]==617&&c.CellXf.push(S);break;case 48:case 507:case 572:case 475:break;case 1171:case 2102:case 1130:case 512:case 2095:case 3072:break;case 35:x=!0;break;case 36:x=!1;break;case 37:m.push(C),x=!0;break;case 38:m.pop(),x=!1;break;default:if(b.T>0)m.push(C);else if(b.T<0)m.pop();else if(!x||i.WTF&&m[m.length-1]!=37)throw new Error("Unexpected record 0x"+C.toString(16))}}),c}var US=["</a:lt1>","</a:dk1>","</a:lt2>","</a:dk2>","</a:accent1>","</a:accent2>","</a:accent3>","</a:accent4>","</a:accent5>","</a:accent6>","</a:hlink>","</a:folHlink>"];function VS(e,n,i){n.themeElements.clrScheme=[];var c={};(e[0].match(fi)||[]).forEach(function(h){var m=rr(h);switch(m[0]){case"<a:clrScheme":case"</a:clrScheme>":break;case"<a:srgbClr":c.rgb=m.val;break;case"<a:sysClr":c.rgb=m.lastClr;break;case"<a:dk1>":case"</a:dk1>":case"<a:lt1>":case"</a:lt1>":case"<a:dk2>":case"</a:dk2>":case"<a:lt2>":case"</a:lt2>":case"<a:accent1>":case"</a:accent1>":case"<a:accent2>":case"</a:accent2>":case"<a:accent3>":case"</a:accent3>":case"<a:accent4>":case"</a:accent4>":case"<a:accent5>":case"</a:accent5>":case"<a:accent6>":case"</a:accent6>":case"<a:hlink>":case"</a:hlink>":case"<a:folHlink>":case"</a:folHlink>":m[0].charAt(1)==="/"?(n.themeElements.clrScheme[US.indexOf(m[0])]=c,c={}):c.name=m[0].slice(3,m[0].length-1);break;default:if(i&&i.WTF)throw new Error("Unrecognized "+m[0]+" in clrScheme")}})}function $S(){}function jS(){}var GS=/<a:clrScheme([^>]*)>[\s\S]*<\/a:clrScheme>/,HS=/<a:fontScheme([^>]*)>[\s\S]*<\/a:fontScheme>/,qS=/<a:fmtScheme([^>]*)>[\s\S]*<\/a:fmtScheme>/;function WS(e,n,i){n.themeElements={};var c;[["clrScheme",GS,VS],["fontScheme",HS,$S],["fmtScheme",qS,jS]].forEach(function(h){if(!(c=e.match(h[1])))throw new Error(h[0]+" not found in themeElements");h[2](c,n,i)})}var ZS=/<a:themeElements([^>]*)>[\s\S]*<\/a:themeElements>/;function q1(e,n){(!e||e.length===0)&&(e=XS());var i,c={};if(!(i=e.match(ZS)))throw new Error("themeElements not found in theme");return WS(i[0],c,n),c.raw=e,c}function XS(e,n){if(n&&n.themeXLSX)return n.themeXLSX;if(e&&typeof e.raw=="string")return e.raw;var i=[a1];return i[i.length]='<a:theme xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" name="Office Theme">',i[i.length]="<a:themeElements>",i[i.length]='<a:clrScheme name="Office">',i[i.length]='<a:dk1><a:sysClr val="windowText" lastClr="000000"/></a:dk1>',i[i.length]='<a:lt1><a:sysClr val="window" lastClr="FFFFFF"/></a:lt1>',i[i.length]='<a:dk2><a:srgbClr val="1F497D"/></a:dk2>',i[i.length]='<a:lt2><a:srgbClr val="EEECE1"/></a:lt2>',i[i.length]='<a:accent1><a:srgbClr val="4F81BD"/></a:accent1>',i[i.length]='<a:accent2><a:srgbClr val="C0504D"/></a:accent2>',i[i.length]='<a:accent3><a:srgbClr val="9BBB59"/></a:accent3>',i[i.length]='<a:accent4><a:srgbClr val="8064A2"/></a:accent4>',i[i.length]='<a:accent5><a:srgbClr val="4BACC6"/></a:accent5>',i[i.length]='<a:accent6><a:srgbClr val="F79646"/></a:accent6>',i[i.length]='<a:hlink><a:srgbClr val="0000FF"/></a:hlink>',i[i.length]='<a:folHlink><a:srgbClr val="800080"/></a:folHlink>',i[i.length]="</a:clrScheme>",i[i.length]='<a:fontScheme name="Office">',i[i.length]="<a:majorFont>",i[i.length]='<a:latin typeface="Cambria"/>',i[i.length]='<a:ea typeface=""/>',i[i.length]='<a:cs typeface=""/>',i[i.length]='<a:font script="Jpan" typeface=" "/>',i[i.length]='<a:font script="Hang" typeface=" "/>',i[i.length]='<a:font script="Hans" typeface=""/>',i[i.length]='<a:font script="Hant" typeface=""/>',i[i.length]='<a:font script="Arab" typeface="Times New Roman"/>',i[i.length]='<a:font script="Hebr" typeface="Times New Roman"/>',i[i.length]='<a:font script="Thai" typeface="Tahoma"/>',i[i.length]='<a:font script="Ethi" typeface="Nyala"/>',i[i.length]='<a:font script="Beng" typeface="Vrinda"/>',i[i.length]='<a:font script="Gujr" typeface="Shruti"/>',i[i.length]='<a:font script="Khmr" typeface="MoolBoran"/>',i[i.length]='<a:font script="Knda" typeface="Tunga"/>',i[i.length]='<a:font script="Guru" typeface="Raavi"/>',i[i.length]='<a:font script="Cans" typeface="Euphemia"/>',i[i.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',i[i.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',i[i.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',i[i.length]='<a:font script="Thaa" typeface="MV Boli"/>',i[i.length]='<a:font script="Deva" typeface="Mangal"/>',i[i.length]='<a:font script="Telu" typeface="Gautami"/>',i[i.length]='<a:font script="Taml" typeface="Latha"/>',i[i.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',i[i.length]='<a:font script="Orya" typeface="Kalinga"/>',i[i.length]='<a:font script="Mlym" typeface="Kartika"/>',i[i.length]='<a:font script="Laoo" typeface="DokChampa"/>',i[i.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',i[i.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',i[i.length]='<a:font script="Viet" typeface="Times New Roman"/>',i[i.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',i[i.length]='<a:font script="Geor" typeface="Sylfaen"/>',i[i.length]="</a:majorFont>",i[i.length]="<a:minorFont>",i[i.length]='<a:latin typeface="Calibri"/>',i[i.length]='<a:ea typeface=""/>',i[i.length]='<a:cs typeface=""/>',i[i.length]='<a:font script="Jpan" typeface=" "/>',i[i.length]='<a:font script="Hang" typeface=" "/>',i[i.length]='<a:font script="Hans" typeface=""/>',i[i.length]='<a:font script="Hant" typeface=""/>',i[i.length]='<a:font script="Arab" typeface="Arial"/>',i[i.length]='<a:font script="Hebr" typeface="Arial"/>',i[i.length]='<a:font script="Thai" typeface="Tahoma"/>',i[i.length]='<a:font script="Ethi" typeface="Nyala"/>',i[i.length]='<a:font script="Beng" typeface="Vrinda"/>',i[i.length]='<a:font script="Gujr" typeface="Shruti"/>',i[i.length]='<a:font script="Khmr" typeface="DaunPenh"/>',i[i.length]='<a:font script="Knda" typeface="Tunga"/>',i[i.length]='<a:font script="Guru" typeface="Raavi"/>',i[i.length]='<a:font script="Cans" typeface="Euphemia"/>',i[i.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',i[i.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',i[i.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',i[i.length]='<a:font script="Thaa" typeface="MV Boli"/>',i[i.length]='<a:font script="Deva" typeface="Mangal"/>',i[i.length]='<a:font script="Telu" typeface="Gautami"/>',i[i.length]='<a:font script="Taml" typeface="Latha"/>',i[i.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',i[i.length]='<a:font script="Orya" typeface="Kalinga"/>',i[i.length]='<a:font script="Mlym" typeface="Kartika"/>',i[i.length]='<a:font script="Laoo" typeface="DokChampa"/>',i[i.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',i[i.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',i[i.length]='<a:font script="Viet" typeface="Arial"/>',i[i.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',i[i.length]='<a:font script="Geor" typeface="Sylfaen"/>',i[i.length]="</a:minorFont>",i[i.length]="</a:fontScheme>",i[i.length]='<a:fmtScheme name="Office">',i[i.length]="<a:fillStyleLst>",i[i.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',i[i.length]='<a:gradFill rotWithShape="1">',i[i.length]="<a:gsLst>",i[i.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="50000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',i[i.length]='<a:gs pos="35000"><a:schemeClr val="phClr"><a:tint val="37000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',i[i.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="15000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',i[i.length]="</a:gsLst>",i[i.length]='<a:lin ang="16200000" scaled="1"/>',i[i.length]="</a:gradFill>",i[i.length]='<a:gradFill rotWithShape="1">',i[i.length]="<a:gsLst>",i[i.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="100000"/><a:shade val="100000"/><a:satMod val="130000"/></a:schemeClr></a:gs>',i[i.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="50000"/><a:shade val="100000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',i[i.length]="</a:gsLst>",i[i.length]='<a:lin ang="16200000" scaled="0"/>',i[i.length]="</a:gradFill>",i[i.length]="</a:fillStyleLst>",i[i.length]="<a:lnStyleLst>",i[i.length]='<a:ln w="9525" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"><a:shade val="95000"/><a:satMod val="105000"/></a:schemeClr></a:solidFill><a:prstDash val="solid"/></a:ln>',i[i.length]='<a:ln w="25400" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',i[i.length]='<a:ln w="38100" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',i[i.length]="</a:lnStyleLst>",i[i.length]="<a:effectStyleLst>",i[i.length]="<a:effectStyle>",i[i.length]="<a:effectLst>",i[i.length]='<a:outerShdw blurRad="40000" dist="20000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="38000"/></a:srgbClr></a:outerShdw>',i[i.length]="</a:effectLst>",i[i.length]="</a:effectStyle>",i[i.length]="<a:effectStyle>",i[i.length]="<a:effectLst>",i[i.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',i[i.length]="</a:effectLst>",i[i.length]="</a:effectStyle>",i[i.length]="<a:effectStyle>",i[i.length]="<a:effectLst>",i[i.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',i[i.length]="</a:effectLst>",i[i.length]='<a:scene3d><a:camera prst="orthographicFront"><a:rot lat="0" lon="0" rev="0"/></a:camera><a:lightRig rig="threePt" dir="t"><a:rot lat="0" lon="0" rev="1200000"/></a:lightRig></a:scene3d>',i[i.length]='<a:sp3d><a:bevelT w="63500" h="25400"/></a:sp3d>',i[i.length]="</a:effectStyle>",i[i.length]="</a:effectStyleLst>",i[i.length]="<a:bgFillStyleLst>",i[i.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',i[i.length]='<a:gradFill rotWithShape="1">',i[i.length]="<a:gsLst>",i[i.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="40000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',i[i.length]='<a:gs pos="40000"><a:schemeClr val="phClr"><a:tint val="45000"/><a:shade val="99000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',i[i.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="20000"/><a:satMod val="255000"/></a:schemeClr></a:gs>',i[i.length]="</a:gsLst>",i[i.length]='<a:path path="circle"><a:fillToRect l="50000" t="-80000" r="50000" b="180000"/></a:path>',i[i.length]="</a:gradFill>",i[i.length]='<a:gradFill rotWithShape="1">',i[i.length]="<a:gsLst>",i[i.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="80000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',i[i.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="30000"/><a:satMod val="200000"/></a:schemeClr></a:gs>',i[i.length]="</a:gsLst>",i[i.length]='<a:path path="circle"><a:fillToRect l="50000" t="50000" r="50000" b="50000"/></a:path>',i[i.length]="</a:gradFill>",i[i.length]="</a:bgFillStyleLst>",i[i.length]="</a:fmtScheme>",i[i.length]="</a:themeElements>",i[i.length]="<a:objectDefaults>",i[i.length]="<a:spDef>",i[i.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="1"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="3"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="2"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="lt1"/></a:fontRef></a:style>',i[i.length]="</a:spDef>",i[i.length]="<a:lnDef>",i[i.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="2"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="0"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="1"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="tx1"/></a:fontRef></a:style>',i[i.length]="</a:lnDef>",i[i.length]="</a:objectDefaults>",i[i.length]="<a:extraClrSchemeLst/>",i[i.length]="</a:theme>",i.join("")}function KS(e,n,i){var c=e.l+n,h=e.read_shift(4);if(h!==124226){if(!i.cellStyles){e.l=c;return}var m=e.slice(e.l);e.l=c;var x;try{x=r1(m,{type:"array"})}catch{return}var o=ji(x,"theme/theme/theme1.xml",!0);if(o)return q1(o,i)}}function YS(e){return e.read_shift(4)}function JS(e){var n={};switch(n.xclrType=e.read_shift(2),n.nTintShade=e.read_shift(2),n.xclrType){case 0:e.l+=4;break;case 1:n.xclrValue=QS(e,4);break;case 2:n.xclrValue=M1(e);break;case 3:n.xclrValue=YS(e);break;case 4:e.l+=4;break}return e.l+=8,n}function QS(e,n){return ui(e,n)}function ek(e,n){return ui(e,n)}function tk(e){var n=e.read_shift(2),i=e.read_shift(2)-4,c=[n];switch(n){case 4:case 5:case 7:case 8:case 9:case 10:case 11:case 13:c[1]=JS(e);break;case 6:c[1]=ek(e,i);break;case 14:case 15:c[1]=e.read_shift(i===1?1:2);break;default:throw new Error("Unrecognized ExtProp type: "+n+" "+i)}return c}function rk(e,n){var i=e.l+n;e.l+=2;var c=e.read_shift(2);e.l+=2;for(var h=e.read_shift(2),m=[];h-- >0;)m.push(tk(e,i-e.l));return{ixfe:c,ext:m}}function ak(e,n){n.forEach(function(i){switch(i[0]){}})}function ik(e,n){return{flags:e.read_shift(4),version:e.read_shift(4),name:hi(e)}}function nk(e){for(var n=[],i=e.read_shift(4);i-- >0;)n.push([e.read_shift(4),e.read_shift(4)]);return n}function sk(e){return e.l+=4,e.read_shift(4)!=0}function ok(e,n,i){var c={Types:[],Cell:[],Value:[]},h=i||{},m=[],x=!1,o=2;return ss(e,function(S,b,C){switch(C){case 335:c.Types.push({name:S.name});break;case 51:S.forEach(function(M){o==1?c.Cell.push({type:c.Types[M[0]-1].name,index:M[1]}):o==0&&c.Value.push({type:c.Types[M[0]-1].name,index:M[1]})});break;case 337:o=S?1:0;break;case 338:o=2;break;case 35:m.push(C),x=!0;break;case 36:m.pop(),x=!1;break;default:if(!b.T){if(!x||h.WTF&&m[m.length-1]!=35)throw new Error("Unexpected record 0x"+C.toString(16))}}}),c}function lk(e,n,i){var c={Types:[],Cell:[],Value:[]};if(!e)return c;var h=!1,m=2,x;return e.replace(fi,function(o){var S=rr(o);switch(Bn(S[0])){case"<?xml":break;case"<metadata":case"</metadata>":break;case"<metadataTypes":case"</metadataTypes>":break;case"<metadataType":c.Types.push({name:S.name});break;case"</metadataType>":break;case"<futureMetadata":for(var b=0;b<c.Types.length;++b)c.Types[b].name==S.name&&(x=c.Types[b]);break;case"</futureMetadata>":break;case"<bk>":break;case"</bk>":break;case"<rc":m==1?c.Cell.push({type:c.Types[S.t-1].name,index:+S.v}):m==0&&c.Value.push({type:c.Types[S.t-1].name,index:+S.v});break;case"</rc>":break;case"<cellMetadata":m=1;break;case"</cellMetadata>":m=2;break;case"<valueMetadata":m=0;break;case"</valueMetadata>":m=2;break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":h=!0;break;case"</ext>":h=!1;break;case"<rvb":if(!x)break;x.offsets||(x.offsets=[]),x.offsets.push(+S.i);break;default:if(!h&&i.WTF)throw new Error("unrecognized "+S[0]+" in metadata")}return o}),c}function ck(e){var n=[];if(!e)return n;var i=1;return(e.match(fi)||[]).forEach(function(c){var h=rr(c);switch(h[0]){case"<?xml":break;case"<calcChain":case"<calcChain>":case"</calcChain>":break;case"<c":delete h[0],h.i?i=h.i:h.i=i,n.push(h);break}}),n}function hk(e){var n={};n.i=e.read_shift(4);var i={};i.r=e.read_shift(4),i.c=e.read_shift(4),n.r=sr(i);var c=e.read_shift(1);return c&2&&(n.l="1"),c&8&&(n.a="1"),n}function uk(e,n,i){var c=[];return ss(e,function(m,x,o){switch(o){case 63:c.push(m);break;default:if(!x.T)throw new Error("Unexpected record 0x"+o.toString(16))}}),c}function fk(e,n,i,c){if(!e)return e;var h=c||{},m=!1;ss(e,function(o,S,b){switch(b){case 359:case 363:case 364:case 366:case 367:case 368:case 369:case 370:case 371:case 472:case 577:case 578:case 579:case 580:case 581:case 582:case 583:case 584:case 585:case 586:case 587:break;case 35:m=!0;break;case 36:m=!1;break;default:if(!S.T){if(!m||h.WTF)throw new Error("Unexpected record 0x"+b.toString(16))}}},h)}function dk(e,n){if(!e)return"??";var i=(e.match(/<c:chart [^>]*r:id="([^"]*)"/)||["",""])[1];return n["!id"][i].Target}function Km(e,n,i,c){var h=Array.isArray(e),m;n.forEach(function(x){var o=Si(x.ref);if(h?(e[o.r]||(e[o.r]=[]),m=e[o.r][o.c]):m=e[x.ref],!m){m={t:"z"},h?e[o.r][o.c]=m:e[x.ref]=m;var S=ha(e["!ref"]||"BDWGO1000001:A1");S.s.r>o.r&&(S.s.r=o.r),S.e.r<o.r&&(S.e.r=o.r),S.s.c>o.c&&(S.s.c=o.c),S.e.c<o.c&&(S.e.c=o.c);var b=Tr(S);b!==e["!ref"]&&(e["!ref"]=b)}m.c||(m.c=[]);var C={a:x.author,t:x.t,r:x.r,T:i};x.h&&(C.h=x.h);for(var M=m.c.length-1;M>=0;--M){if(!i&&m.c[M].T)return;i&&!m.c[M].T&&m.c.splice(M,1)}if(i&&c){for(M=0;M<c.length;++M)if(C.a==c[M].id){C.a=c[M].name||C.a;break}}m.c.push(C)})}function pk(e,n){if(e.match(/<(?:\w+:)?comments *\/>/))return[];var i=[],c=[],h=e.match(/<(?:\w+:)?authors>([\s\S]*)<\/(?:\w+:)?authors>/);h&&h[1]&&h[1].split(/<\/\w*:?author>/).forEach(function(x){if(!(x===""||x.trim()==="")){var o=x.match(/<(?:\w+:)?author[^>]*>(.*)/);o&&i.push(o[1])}});var m=e.match(/<(?:\w+:)?commentList>([\s\S]*)<\/(?:\w+:)?commentList>/);return m&&m[1]&&m[1].split(/<\/\w*:?comment>/).forEach(function(x){if(!(x===""||x.trim()==="")){var o=x.match(/<(?:\w+:)?comment[^>]*>/);if(o){var S=rr(o[0]),b={author:S.authorId&&i[S.authorId]||"sheetjsghost",ref:S.ref,guid:S.guid},C=Si(S.ref);if(!(n.sheetRows&&n.sheetRows<=C.r)){var M=x.match(/<(?:\w+:)?text>([\s\S]*)<\/(?:\w+:)?text>/),L=!!M&&!!M[1]&&K0(M[1])||{r:"",t:"",h:""};b.r=L.r,L.r=="<t></t>"&&(L.t=L.h=""),b.t=(L.t||"").replace(/\r\n/g,`
`).replace(/\r/g,`
`),n.cellHTML&&(b.h=L.h),c.push(b)}}}}),c}function mk(e,n){var i=[],c=!1,h={},m=0;return e.replace(fi,function(o,S){var b=rr(o);switch(Bn(b[0])){case"<?xml":break;case"<ThreadedComments":break;case"</ThreadedComments>":break;case"<threadedComment":h={author:b.personId,guid:b.id,ref:b.ref,T:1};break;case"</threadedComment>":h.t!=null&&i.push(h);break;case"<text>":case"<text":m=S+o.length;break;case"</text>":h.t=e.slice(m,S).replace(/\r\n/g,`
`).replace(/\r/g,`
`);break;case"<mentions":case"<mentions>":c=!0;break;case"</mentions>":c=!1;break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":c=!0;break;case"</ext>":c=!1;break;default:if(!c&&n.WTF)throw new Error("unrecognized "+b[0]+" in threaded comments")}return o}),i}function gk(e,n){var i=[],c=!1;return e.replace(fi,function(m){var x=rr(m);switch(Bn(x[0])){case"<?xml":break;case"<personList":break;case"</personList>":break;case"<person":i.push({name:x.displayname,id:x.id});break;case"</person>":break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":c=!0;break;case"</ext>":c=!1;break;default:if(!c&&n.WTF)throw new Error("unrecognized "+x[0]+" in threaded comments")}return m}),i}function xk(e){var n={};n.iauthor=e.read_shift(4);var i=yo(e);return n.rfx=i.s,n.ref=sr(i.s),e.l+=16,n}var _k=hi;function yk(e,n){var i=[],c=[],h={},m=!1;return ss(e,function(o,S,b){switch(b){case 632:c.push(o);break;case 635:h=o;break;case 637:h.t=o.t,h.h=o.h,h.r=o.r;break;case 636:if(h.author=c[h.iauthor],delete h.iauthor,n.sheetRows&&h.rfx&&n.sheetRows<=h.rfx.r)break;h.t||(h.t=""),delete h.rfx,i.push(h);break;case 3072:break;case 35:m=!0;break;case 36:m=!1;break;case 37:break;case 38:break;default:if(!S.T){if(!m||n.WTF)throw new Error("Unexpected record 0x"+b.toString(16))}}}),i}var vk="application/vnd.ms-office.vbaProject";function wk(e){var n=br.utils.cfb_new({root:"R"});return e.FullPaths.forEach(function(i,c){if(!(i.slice(-1)==="/"||!i.match(/_VBA_PROJECT_CUR/))){var h=i.replace(/^[^\/]*/,"R").replace(/\/_VBA_PROJECT_CUR\u0000*/,"");br.utils.cfb_add(n,h,e.FileIndex[c].content)}}),br.write(n)}function bk(){return{"!type":"dialog"}}function Tk(){return{"!type":"dialog"}}function Ek(){return{"!type":"macro"}}function Sk(){return{"!type":"macro"}}var ul=function(){var e=/(^|[^A-Za-z_])R(\[?-?\d+\]|[1-9]\d*|)C(\[?-?\d+\]|[1-9]\d*|)(?![A-Za-z0-9_])/g,n={r:0,c:0};function i(c,h,m,x){var o=!1,S=!1;m.length==0?S=!0:m.charAt(0)=="["&&(S=!0,m=m.slice(1,-1)),x.length==0?o=!0:x.charAt(0)=="["&&(o=!0,x=x.slice(1,-1));var b=m.length>0?parseInt(m,10)|0:0,C=x.length>0?parseInt(x,10)|0:0;return o?C+=n.c:--C,S?b+=n.r:--b,h+(o?"":"$")+Pa(C)+(S?"":"$")+Ka(b)}return function(h,m){return n=m,h.replace(e,i)}}(),W1=/(^|[^._A-Z0-9])([$]?)([A-Z]{1,2}|[A-W][A-Z]{2}|X[A-E][A-Z]|XF[A-D])([$]?)(10[0-3]\d{4}|104[0-7]\d{3}|1048[0-4]\d{2}|10485[0-6]\d|104857[0-6]|[1-9]\d{0,5})(?![_.\(A-Za-z0-9])/g,kk=function(){return function(n,i){return n.replace(W1,function(c,h,m,x,o,S){var b=G0(x)-(m?0:i.c),C=j0(S)-(o?0:i.r),M=C==0?"":o?C+1:"["+C+"]",L=b==0?"":m?b+1:"["+b+"]";return h+"R"+M+"C"+L})}}();function Z1(e,n){return e.replace(W1,function(i,c,h,m,x,o){return c+(h=="$"?h+m:Pa(G0(m)+n.c))+(x=="$"?x+o:Ka(j0(o)+n.r))})}function Ck(e,n,i){var c=yl(n),h=c.s,m=Si(i),x={r:m.r-h.r,c:m.c-h.c};return Z1(e,x)}function Ak(e){return e.length!=1}function Ym(e){return e.replace(/_xlfn\./g,"")}function ba(e){e.l+=1}function Ls(e,n){var i=e.read_shift(n==1?1:2);return[i&16383,i>>14&1,i>>15&1]}function X1(e,n,i){var c=2;if(i){if(i.biff>=2&&i.biff<=5)return K1(e);i.biff==12&&(c=4)}var h=e.read_shift(c),m=e.read_shift(c),x=Ls(e,2),o=Ls(e,2);return{s:{r:h,c:x[0],cRel:x[1],rRel:x[2]},e:{r:m,c:o[0],cRel:o[1],rRel:o[2]}}}function K1(e){var n=Ls(e,2),i=Ls(e,2),c=e.read_shift(1),h=e.read_shift(1);return{s:{r:n[0],c,cRel:n[1],rRel:n[2]},e:{r:i[0],c:h,cRel:i[1],rRel:i[2]}}}function Ik(e,n,i){if(i.biff<8)return K1(e);var c=e.read_shift(i.biff==12?4:2),h=e.read_shift(i.biff==12?4:2),m=Ls(e,2),x=Ls(e,2);return{s:{r:c,c:m[0],cRel:m[1],rRel:m[2]},e:{r:h,c:x[0],cRel:x[1],rRel:x[2]}}}function Y1(e,n,i){if(i&&i.biff>=2&&i.biff<=5)return Fk(e);var c=e.read_shift(i&&i.biff==12?4:2),h=Ls(e,2);return{r:c,c:h[0],cRel:h[1],rRel:h[2]}}function Fk(e){var n=Ls(e,2),i=e.read_shift(1);return{r:n[0],c:i,cRel:n[1],rRel:n[2]}}function Pk(e){var n=e.read_shift(2),i=e.read_shift(2);return{r:n,c:i&255,fQuoted:!!(i&16384),cRel:i>>15,rRel:i>>15}}function Mk(e,n,i){var c=i&&i.biff?i.biff:8;if(c>=2&&c<=5)return Dk(e);var h=e.read_shift(c>=12?4:2),m=e.read_shift(2),x=(m&16384)>>14,o=(m&32768)>>15;if(m&=16383,o==1)for(;h>524287;)h-=1048576;if(x==1)for(;m>8191;)m=m-16384;return{r:h,c:m,cRel:x,rRel:o}}function Dk(e){var n=e.read_shift(2),i=e.read_shift(1),c=(n&32768)>>15,h=(n&16384)>>14;return n&=16383,c==1&&n>=8192&&(n=n-16384),h==1&&i>=128&&(i=i-256),{r:n,c:i,cRel:h,rRel:c}}function Lk(e,n,i){var c=(e[e.l++]&96)>>5,h=X1(e,i.biff>=2&&i.biff<=5?6:8,i);return[c,h]}function Rk(e,n,i){var c=(e[e.l++]&96)>>5,h=e.read_shift(2,"i"),m=8;if(i)switch(i.biff){case 5:e.l+=12,m=6;break;case 12:m=12;break}var x=X1(e,m,i);return[c,h,x]}function Ok(e,n,i){var c=(e[e.l++]&96)>>5;return e.l+=i&&i.biff>8?12:i.biff<8?6:8,[c]}function Bk(e,n,i){var c=(e[e.l++]&96)>>5,h=e.read_shift(2),m=8;if(i)switch(i.biff){case 5:e.l+=12,m=6;break;case 12:m=12;break}return e.l+=m,[c,h]}function zk(e,n,i){var c=(e[e.l++]&96)>>5,h=Ik(e,n-1,i);return[c,h]}function Nk(e,n,i){var c=(e[e.l++]&96)>>5;return e.l+=i.biff==2?6:i.biff==12?14:7,[c]}function Jm(e){var n=e[e.l+1]&1,i=1;return e.l+=4,[n,i]}function Uk(e,n,i){e.l+=2;for(var c=e.read_shift(i&&i.biff==2?1:2),h=[],m=0;m<=c;++m)h.push(e.read_shift(i&&i.biff==2?1:2));return h}function Vk(e,n,i){var c=e[e.l+1]&255?1:0;return e.l+=2,[c,e.read_shift(i&&i.biff==2?1:2)]}function $k(e,n,i){var c=e[e.l+1]&255?1:0;return e.l+=2,[c,e.read_shift(i&&i.biff==2?1:2)]}function jk(e){var n=e[e.l+1]&255?1:0;return e.l+=2,[n,e.read_shift(2)]}function Gk(e,n,i){var c=e[e.l+1]&255?1:0;return e.l+=i&&i.biff==2?3:4,[c]}function J1(e){var n=e.read_shift(1),i=e.read_shift(1);return[n,i]}function Hk(e){return e.read_shift(2),J1(e)}function qk(e){return e.read_shift(2),J1(e)}function Wk(e,n,i){var c=(e[e.l]&96)>>5;e.l+=1;var h=Y1(e,0,i);return[c,h]}function Zk(e,n,i){var c=(e[e.l]&96)>>5;e.l+=1;var h=Mk(e,0,i);return[c,h]}function Xk(e,n,i){var c=(e[e.l]&96)>>5;e.l+=1;var h=e.read_shift(2);i&&i.biff==5&&(e.l+=12);var m=Y1(e,0,i);return[c,h,m]}function Kk(e,n,i){var c=(e[e.l]&96)>>5;e.l+=1;var h=e.read_shift(i&&i.biff<=3?1:2);return[Y4[h],tx[h],c]}function Yk(e,n,i){var c=e[e.l++],h=e.read_shift(1),m=i&&i.biff<=3?[c==88?-1:0,e.read_shift(1)]:Jk(e);return[h,(m[0]===0?tx:K4)[m[1]]]}function Jk(e){return[e[e.l+1]>>7,e.read_shift(2)&32767]}function Qk(e,n,i){e.l+=i&&i.biff==2?3:4}function e4(e,n,i){if(e.l++,i&&i.biff==12)return[e.read_shift(4,"i"),0];var c=e.read_shift(2),h=e.read_shift(i&&i.biff==2?1:2);return[c,h]}function t4(e){return e.l++,vo[e.read_shift(1)]}function r4(e){return e.l++,e.read_shift(2)}function a4(e){return e.l++,e.read_shift(1)!==0}function i4(e){return e.l++,li(e)}function n4(e,n,i){return e.l++,Yc(e,n-1,i)}function s4(e,n){var i=[e.read_shift(1)];if(n==12)switch(i[0]){case 2:i[0]=4;break;case 4:i[0]=16;break;case 0:i[0]=1;break;case 1:i[0]=2;break}switch(i[0]){case 4:i[1]=wa(e,1)?"TRUE":"FALSE",n!=12&&(e.l+=7);break;case 37:case 16:i[1]=vo[e[e.l]],e.l+=n==12?4:8;break;case 0:e.l+=8;break;case 1:i[1]=li(e);break;case 2:i[1]=wo(e,0,{biff:n>0&&n<8?2:n});break;default:throw new Error("Bad SerAr: "+i[0])}return i}function o4(e,n,i){for(var c=e.read_shift(i.biff==12?4:2),h=[],m=0;m!=c;++m)h.push((i.biff==12?yo:Nu)(e));return h}function l4(e,n,i){var c=0,h=0;i.biff==12?(c=e.read_shift(4),h=e.read_shift(4)):(h=1+e.read_shift(1),c=1+e.read_shift(2)),i.biff>=2&&i.biff<8&&(--c,--h==0&&(h=256));for(var m=0,x=[];m!=c&&(x[m]=[]);++m)for(var o=0;o!=h;++o)x[m][o]=s4(e,i.biff);return x}function c4(e,n,i){var c=e.read_shift(1)>>>5&3,h=!i||i.biff>=8?4:2,m=e.read_shift(h);switch(i.biff){case 2:e.l+=5;break;case 3:case 4:e.l+=8;break;case 5:e.l+=12;break}return[c,0,m]}function h4(e,n,i){if(i.biff==5)return u4(e);var c=e.read_shift(1)>>>5&3,h=e.read_shift(2),m=e.read_shift(4);return[c,h,m]}function u4(e){var n=e.read_shift(1)>>>5&3,i=e.read_shift(2,"i");e.l+=8;var c=e.read_shift(2);return e.l+=12,[n,i,c]}function f4(e,n,i){var c=e.read_shift(1)>>>5&3;e.l+=i&&i.biff==2?3:4;var h=e.read_shift(i&&i.biff==2?1:2);return[c,h]}function d4(e,n,i){var c=e.read_shift(1)>>>5&3,h=e.read_shift(i&&i.biff==2?1:2);return[c,h]}function p4(e,n,i){var c=e.read_shift(1)>>>5&3;return e.l+=4,i.biff<8&&e.l--,i.biff==12&&(e.l+=2),[c]}function m4(e,n,i){var c=(e[e.l++]&96)>>5,h=e.read_shift(2),m=4;if(i)switch(i.biff){case 5:m=15;break;case 12:m=6;break}return e.l+=m,[c,h]}var g4=ui,x4=ui,_4=ui;function Qc(e,n,i){return e.l+=2,[Pk(e)]}function J0(e){return e.l+=6,[]}var y4=Qc,v4=J0,w4=J0,b4=Qc;function Q1(e){return e.l+=2,[Ea(e),e.read_shift(2)&1]}var T4=Qc,E4=Q1,S4=J0,k4=Qc,C4=Qc,A4=["Data","All","Headers","??","?Data2","??","?DataHeaders","??","Totals","??","??","??","?DataTotals","??","??","??","?Current"];function I4(e){e.l+=2;var n=e.read_shift(2),i=e.read_shift(2),c=e.read_shift(4),h=e.read_shift(2),m=e.read_shift(2),x=A4[i>>2&31];return{ixti:n,coltype:i&3,rt:x,idx:c,c:h,C:m}}function F4(e){return e.l+=2,[e.read_shift(4)]}function P4(e,n,i){return e.l+=5,e.l+=2,e.l+=i.biff==2?1:4,["PTGSHEET"]}function M4(e,n,i){return e.l+=i.biff==2?4:5,["PTGENDSHEET"]}function D4(e){var n=e.read_shift(1)>>>5&3,i=e.read_shift(2);return[n,i]}function L4(e){var n=e.read_shift(1)>>>5&3,i=e.read_shift(2);return[n,i]}function R4(e){return e.l+=4,[0,0]}var Qm={1:{n:"PtgExp",f:e4},2:{n:"PtgTbl",f:_4},3:{n:"PtgAdd",f:ba},4:{n:"PtgSub",f:ba},5:{n:"PtgMul",f:ba},6:{n:"PtgDiv",f:ba},7:{n:"PtgPower",f:ba},8:{n:"PtgConcat",f:ba},9:{n:"PtgLt",f:ba},10:{n:"PtgLe",f:ba},11:{n:"PtgEq",f:ba},12:{n:"PtgGe",f:ba},13:{n:"PtgGt",f:ba},14:{n:"PtgNe",f:ba},15:{n:"PtgIsect",f:ba},16:{n:"PtgUnion",f:ba},17:{n:"PtgRange",f:ba},18:{n:"PtgUplus",f:ba},19:{n:"PtgUminus",f:ba},20:{n:"PtgPercent",f:ba},21:{n:"PtgParen",f:ba},22:{n:"PtgMissArg",f:ba},23:{n:"PtgStr",f:n4},26:{n:"PtgSheet",f:P4},27:{n:"PtgEndSheet",f:M4},28:{n:"PtgErr",f:t4},29:{n:"PtgBool",f:a4},30:{n:"PtgInt",f:r4},31:{n:"PtgNum",f:i4},32:{n:"PtgArray",f:Nk},33:{n:"PtgFunc",f:Kk},34:{n:"PtgFuncVar",f:Yk},35:{n:"PtgName",f:c4},36:{n:"PtgRef",f:Wk},37:{n:"PtgArea",f:Lk},38:{n:"PtgMemArea",f:f4},39:{n:"PtgMemErr",f:g4},40:{n:"PtgMemNoMem",f:x4},41:{n:"PtgMemFunc",f:d4},42:{n:"PtgRefErr",f:p4},43:{n:"PtgAreaErr",f:Ok},44:{n:"PtgRefN",f:Zk},45:{n:"PtgAreaN",f:zk},46:{n:"PtgMemAreaN",f:D4},47:{n:"PtgMemNoMemN",f:L4},57:{n:"PtgNameX",f:h4},58:{n:"PtgRef3d",f:Xk},59:{n:"PtgArea3d",f:Rk},60:{n:"PtgRefErr3d",f:m4},61:{n:"PtgAreaErr3d",f:Bk},255:{}},O4={64:32,96:32,65:33,97:33,66:34,98:34,67:35,99:35,68:36,100:36,69:37,101:37,70:38,102:38,71:39,103:39,72:40,104:40,73:41,105:41,74:42,106:42,75:43,107:43,76:44,108:44,77:45,109:45,78:46,110:46,79:47,111:47,88:34,120:34,89:57,121:57,90:58,122:58,91:59,123:59,92:60,124:60,93:61,125:61},B4={1:{n:"PtgElfLel",f:Q1},2:{n:"PtgElfRw",f:k4},3:{n:"PtgElfCol",f:y4},6:{n:"PtgElfRwV",f:C4},7:{n:"PtgElfColV",f:b4},10:{n:"PtgElfRadical",f:T4},11:{n:"PtgElfRadicalS",f:S4},13:{n:"PtgElfColS",f:v4},15:{n:"PtgElfColSV",f:w4},16:{n:"PtgElfRadicalLel",f:E4},25:{n:"PtgList",f:I4},29:{n:"PtgSxName",f:F4},255:{}},z4={0:{n:"PtgAttrNoop",f:R4},1:{n:"PtgAttrSemi",f:Gk},2:{n:"PtgAttrIf",f:$k},4:{n:"PtgAttrChoose",f:Uk},8:{n:"PtgAttrGoto",f:Vk},16:{n:"PtgAttrSum",f:Qk},32:{n:"PtgAttrBaxcel",f:Jm},33:{n:"PtgAttrBaxcel",f:Jm},64:{n:"PtgAttrSpace",f:Hk},65:{n:"PtgAttrSpaceSemi",f:qk},128:{n:"PtgAttrIfError",f:jk},255:{}};function eh(e,n,i,c){if(c.biff<8)return ui(e,n);for(var h=e.l+n,m=[],x=0;x!==i.length;++x)switch(i[x][0]){case"PtgArray":i[x][1]=l4(e,0,c),m.push(i[x][1]);break;case"PtgMemArea":i[x][2]=o4(e,i[x][1],c),m.push(i[x][2]);break;case"PtgExp":c&&c.biff==12&&(i[x][1][1]=e.read_shift(4),m.push(i[x][1]));break;case"PtgList":case"PtgElfRadicalS":case"PtgElfColS":case"PtgElfColSV":throw"Unsupported "+i[x][0]}return n=h-e.l,n!==0&&m.push(ui(e,n)),m}function th(e,n,i){for(var c=e.l+n,h,m,x=[];c!=e.l;)n=c-e.l,m=e[e.l],h=Qm[m]||Qm[O4[m]],(m===24||m===25)&&(h=(m===24?B4:z4)[e[e.l+1]]),!h||!h.f?ui(e,n):x.push([h.n,h.f(e,n,i)]);return x}function N4(e){for(var n=[],i=0;i<e.length;++i){for(var c=e[i],h=[],m=0;m<c.length;++m){var x=c[m];if(x)switch(x[0]){case 2:h.push('"'+x[1].replace(/"/g,'""')+'"');break;default:h.push(x[1])}else h.push("")}n.push(h.join(","))}return n.join(";")}var U4={PtgAdd:"+",PtgConcat:"&",PtgDiv:"/",PtgEq:"=",PtgGe:">=",PtgGt:">",PtgLe:"<=",PtgLt:"<",PtgMul:"*",PtgNe:"<>",PtgPower:"^",PtgSub:"-"};function V4(e,n){if(!e&&!(n&&n.biff<=5&&n.biff>=2))throw new Error("empty sheet name");return/[^\w\u4E00-\u9FFF\u3040-\u30FF]/.test(e)?"'"+e+"'":e}function ex(e,n,i){if(!e)return"SH33TJSERR0";if(i.biff>8&&(!e.XTI||!e.XTI[n]))return e.SheetNames[n];if(!e.XTI)return"SH33TJSERR6";var c=e.XTI[n];if(i.biff<8)return n>1e4&&(n-=65536),n<0&&(n=-n),n==0?"":e.XTI[n-1];if(!c)return"SH33TJSERR1";var h="";if(i.biff>8)switch(e[c[0]][0]){case 357:return h=c[1]==-1?"#REF":e.SheetNames[c[1]],c[1]==c[2]?h:h+":"+e.SheetNames[c[2]];case 358:return i.SID!=null?e.SheetNames[i.SID]:"SH33TJSSAME"+e[c[0]][0];case 355:default:return"SH33TJSSRC"+e[c[0]][0]}switch(e[c[0]][0][0]){case 1025:return h=c[1]==-1?"#REF":e.SheetNames[c[1]]||"SH33TJSERR3",c[1]==c[2]?h:h+":"+e.SheetNames[c[2]];case 14849:return e[c[0]].slice(1).map(function(m){return m.Name}).join(";;");default:return e[c[0]][0][3]?(h=c[1]==-1?"#REF":e[c[0]][0][3][c[1]]||"SH33TJSERR4",c[1]==c[2]?h:h+":"+e[c[0]][0][3][c[2]]):"SH33TJSERR2"}}function eg(e,n,i){var c=ex(e,n,i);return c=="#REF"?c:V4(c,i)}function oi(e,n,i,c,h){var m=h&&h.biff||8,x={s:{c:0,r:0},e:{c:0,r:0}},o=[],S,b,C,M=0,L=0,z,U="";if(!e[0]||!e[0][0])return"";for(var N=-1,G="",ie=0,pe=e[0].length;ie<pe;++ie){var Y=e[0][ie];switch(Y[0]){case"PtgUminus":o.push("-"+o.pop());break;case"PtgUplus":o.push("+"+o.pop());break;case"PtgPercent":o.push(o.pop()+"%");break;case"PtgAdd":case"PtgConcat":case"PtgDiv":case"PtgEq":case"PtgGe":case"PtgGt":case"PtgLe":case"PtgLt":case"PtgMul":case"PtgNe":case"PtgPower":case"PtgSub":if(S=o.pop(),b=o.pop(),N>=0){switch(e[0][N][1][0]){case 0:G=ca(" ",e[0][N][1][1]);break;case 1:G=ca("\r",e[0][N][1][1]);break;default:if(G="",h.WTF)throw new Error("Unexpected PtgAttrSpaceType "+e[0][N][1][0])}b=b+G,N=-1}o.push(b+U4[Y[0]]+S);break;case"PtgIsect":S=o.pop(),b=o.pop(),o.push(b+" "+S);break;case"PtgUnion":S=o.pop(),b=o.pop(),o.push(b+","+S);break;case"PtgRange":S=o.pop(),b=o.pop(),o.push(b+":"+S);break;case"PtgAttrChoose":break;case"PtgAttrGoto":break;case"PtgAttrIf":break;case"PtgAttrIfError":break;case"PtgRef":C=Dc(Y[1][1],x,h),o.push(Lc(C,m));break;case"PtgRefN":C=i?Dc(Y[1][1],i,h):Y[1][1],o.push(Lc(C,m));break;case"PtgRef3d":M=Y[1][1],C=Dc(Y[1][2],x,h),U=eg(c,M,h),o.push(U+"!"+Lc(C,m));break;case"PtgFunc":case"PtgFuncVar":var me=Y[1][0],ve=Y[1][1];me||(me=0),me&=127;var we=me==0?[]:o.slice(-me);o.length-=me,ve==="User"&&(ve=we.shift()),o.push(ve+"("+we.join(",")+")");break;case"PtgBool":o.push(Y[1]?"TRUE":"FALSE");break;case"PtgInt":o.push(Y[1]);break;case"PtgNum":o.push(String(Y[1]));break;case"PtgStr":o.push('"'+Y[1].replace(/"/g,'""')+'"');break;case"PtgErr":o.push(Y[1]);break;case"PtgAreaN":z=Lm(Y[1][1],i?{s:i}:x,h),o.push(i0(z,h));break;case"PtgArea":z=Lm(Y[1][1],x,h),o.push(i0(z,h));break;case"PtgArea3d":M=Y[1][1],z=Y[1][2],U=eg(c,M,h),o.push(U+"!"+i0(z,h));break;case"PtgAttrSum":o.push("SUM("+o.pop()+")");break;case"PtgAttrBaxcel":case"PtgAttrSemi":break;case"PtgName":L=Y[1][2];var te=(c.names||[])[L-1]||(c[0]||[])[L],Be=te?te.Name:"SH33TJSNAME"+String(L);Be&&Be.slice(0,6)=="_xlfn."&&!h.xlfn&&(Be=Be.slice(6)),o.push(Be);break;case"PtgNameX":var Ce=Y[1][1];L=Y[1][2];var Ue;if(h.biff<=5)Ce<0&&(Ce=-Ce),c[Ce]&&(Ue=c[Ce][L]);else{var $e="";if(((c[Ce]||[])[0]||[])[0]==14849||(((c[Ce]||[])[0]||[])[0]==1025?c[Ce][L]&&c[Ce][L].itab>0&&($e=c.SheetNames[c[Ce][L].itab-1]+"!"):$e=c.SheetNames[L-1]+"!"),c[Ce]&&c[Ce][L])$e+=c[Ce][L].Name;else if(c[0]&&c[0][L])$e+=c[0][L].Name;else{var Re=(ex(c,Ce,h)||"").split(";;");Re[L-1]?$e=Re[L-1]:$e+="SH33TJSERRX"}o.push($e);break}Ue||(Ue={Name:"SH33TJSERRY"}),o.push(Ue.Name);break;case"PtgParen":var st="(",pt=")";if(N>=0){switch(G="",e[0][N][1][0]){case 2:st=ca(" ",e[0][N][1][1])+st;break;case 3:st=ca("\r",e[0][N][1][1])+st;break;case 4:pt=ca(" ",e[0][N][1][1])+pt;break;case 5:pt=ca("\r",e[0][N][1][1])+pt;break;default:if(h.WTF)throw new Error("Unexpected PtgAttrSpaceType "+e[0][N][1][0])}N=-1}o.push(st+o.pop()+pt);break;case"PtgRefErr":o.push("#REF!");break;case"PtgRefErr3d":o.push("#REF!");break;case"PtgExp":C={c:Y[1][1],r:Y[1][0]};var ot={c:i.c,r:i.r};if(c.sharedf[sr(C)]){var _t=c.sharedf[sr(C)];o.push(oi(_t,x,ot,c,h))}else{var ft=!1;for(S=0;S!=c.arrayf.length;++S)if(b=c.arrayf[S],!(C.c<b[0].s.c||C.c>b[0].e.c)&&!(C.r<b[0].s.r||C.r>b[0].e.r)){o.push(oi(b[1],x,ot,c,h)),ft=!0;break}ft||o.push(Y[1])}break;case"PtgArray":o.push("{"+N4(Y[1])+"}");break;case"PtgMemArea":break;case"PtgAttrSpace":case"PtgAttrSpaceSemi":N=ie;break;case"PtgTbl":break;case"PtgMemErr":break;case"PtgMissArg":o.push("");break;case"PtgAreaErr":o.push("#REF!");break;case"PtgAreaErr3d":o.push("#REF!");break;case"PtgList":o.push("Table"+Y[1].idx+"[#"+Y[1].rt+"]");break;case"PtgMemAreaN":case"PtgMemNoMemN":case"PtgAttrNoop":case"PtgSheet":case"PtgEndSheet":break;case"PtgMemFunc":break;case"PtgMemNoMem":break;case"PtgElfCol":case"PtgElfColS":case"PtgElfColSV":case"PtgElfColV":case"PtgElfLel":case"PtgElfRadical":case"PtgElfRadicalLel":case"PtgElfRadicalS":case"PtgElfRw":case"PtgElfRwV":throw new Error("Unsupported ELFs");case"PtgSxName":throw new Error("Unrecognized Formula Token: "+String(Y));default:throw new Error("Unrecognized Formula Token: "+String(Y))}var ir=["PtgAttrSpace","PtgAttrSpaceSemi","PtgAttrGoto"];if(h.biff!=3&&N>=0&&ir.indexOf(e[0][ie][0])==-1){Y=e[0][N];var qe=!0;switch(Y[1][0]){case 4:qe=!1;case 0:G=ca(" ",Y[1][1]);break;case 5:qe=!1;case 1:G=ca("\r",Y[1][1]);break;default:if(G="",h.WTF)throw new Error("Unexpected PtgAttrSpaceType "+Y[1][0])}o.push((qe?G:"")+o.pop()+(qe?"":G)),N=-1}}if(o.length>1&&h.WTF)throw new Error("bad formula stack");return o[0]}function $4(e,n,i){var c=e.l+n,h=i.biff==2?1:2,m,x=e.read_shift(h);if(x==65535)return[[],ui(e,n-2)];var o=th(e,x,i);return n!==x+h&&(m=eh(e,n-x-h,o,i)),e.l=c,[o,m]}function j4(e,n,i){var c=e.l+n,h=i.biff==2?1:2,m,x=e.read_shift(h);if(x==65535)return[[],ui(e,n-2)];var o=th(e,x,i);return n!==x+h&&(m=eh(e,n-x-h,o,i)),e.l=c,[o,m]}function G4(e,n,i,c){var h=e.l+n,m=th(e,c,i),x;return h!==e.l&&(x=eh(e,h-e.l,m,i)),[m,x]}function H4(e,n,i){var c=e.l+n,h,m=e.read_shift(2),x=th(e,m,i);return m==65535?[[],ui(e,n-2)]:(n!==m+2&&(h=eh(e,c-m-2,x,i)),[x,h])}function q4(e){var n;if(rs(e,e.l+6)!==65535)return[li(e),"n"];switch(e[e.l]){case 0:return e.l+=8,["String","s"];case 1:return n=e[e.l+2]===1,e.l+=8,[n,"b"];case 2:return n=e[e.l+2],e.l+=8,[n,"e"];case 3:return e.l+=8,["","s"]}return[]}function o0(e,n,i){var c=e.l+n,h=zn(e);i.biff==2&&++e.l;var m=q4(e),x=e.read_shift(1);i.biff!=2&&(e.read_shift(1),i.biff>=5&&e.read_shift(4));var o=j4(e,c-e.l,i);return{cell:h,val:m[0],formula:o,shared:x>>3&1,tt:m[1]}}function Uu(e,n,i){var c=e.read_shift(4),h=th(e,c,i),m=e.read_shift(4),x=m>0?eh(e,m,h,i):null;return[h,x]}var W4=Uu,Vu=Uu,Z4=Uu,X4=Uu,K4={0:"BEEP",1:"OPEN",2:"OPEN.LINKS",3:"CLOSE.ALL",4:"SAVE",5:"SAVE.AS",6:"FILE.DELETE",7:"PAGE.SETUP",8:"PRINT",9:"PRINTER.SETUP",10:"QUIT",11:"NEW.WINDOW",12:"ARRANGE.ALL",13:"WINDOW.SIZE",14:"WINDOW.MOVE",15:"FULL",16:"CLOSE",17:"RUN",22:"SET.PRINT.AREA",23:"SET.PRINT.TITLES",24:"SET.PAGE.BREAK",25:"REMOVE.PAGE.BREAK",26:"FONT",27:"DISPLAY",28:"PROTECT.DOCUMENT",29:"PRECISION",30:"A1.R1C1",31:"CALCULATE.NOW",32:"CALCULATION",34:"DATA.FIND",35:"EXTRACT",36:"DATA.DELETE",37:"SET.DATABASE",38:"SET.CRITERIA",39:"SORT",40:"DATA.SERIES",41:"TABLE",42:"FORMAT.NUMBER",43:"ALIGNMENT",44:"STYLE",45:"BORDER",46:"CELL.PROTECTION",47:"COLUMN.WIDTH",48:"UNDO",49:"CUT",50:"COPY",51:"PASTE",52:"CLEAR",53:"PASTE.SPECIAL",54:"EDIT.DELETE",55:"INSERT",56:"FILL.RIGHT",57:"FILL.DOWN",61:"DEFINE.NAME",62:"CREATE.NAMES",63:"FORMULA.GOTO",64:"FORMULA.FIND",65:"SELECT.LAST.CELL",66:"SHOW.ACTIVE.CELL",67:"GALLERY.AREA",68:"GALLERY.BAR",69:"GALLERY.COLUMN",70:"GALLERY.LINE",71:"GALLERY.PIE",72:"GALLERY.SCATTER",73:"COMBINATION",74:"PREFERRED",75:"ADD.OVERLAY",76:"GRIDLINES",77:"SET.PREFERRED",78:"AXES",79:"LEGEND",80:"ATTACH.TEXT",81:"ADD.ARROW",82:"SELECT.CHART",83:"SELECT.PLOT.AREA",84:"PATTERNS",85:"MAIN.CHART",86:"OVERLAY",87:"SCALE",88:"FORMAT.LEGEND",89:"FORMAT.TEXT",90:"EDIT.REPEAT",91:"PARSE",92:"JUSTIFY",93:"HIDE",94:"UNHIDE",95:"WORKSPACE",96:"FORMULA",97:"FORMULA.FILL",98:"FORMULA.ARRAY",99:"DATA.FIND.NEXT",100:"DATA.FIND.PREV",101:"FORMULA.FIND.NEXT",102:"FORMULA.FIND.PREV",103:"ACTIVATE",104:"ACTIVATE.NEXT",105:"ACTIVATE.PREV",106:"UNLOCKED.NEXT",107:"UNLOCKED.PREV",108:"COPY.PICTURE",109:"SELECT",110:"DELETE.NAME",111:"DELETE.FORMAT",112:"VLINE",113:"HLINE",114:"VPAGE",115:"HPAGE",116:"VSCROLL",117:"HSCROLL",118:"ALERT",119:"NEW",120:"CANCEL.COPY",121:"SHOW.CLIPBOARD",122:"MESSAGE",124:"PASTE.LINK",125:"APP.ACTIVATE",126:"DELETE.ARROW",127:"ROW.HEIGHT",128:"FORMAT.MOVE",129:"FORMAT.SIZE",130:"FORMULA.REPLACE",131:"SEND.KEYS",132:"SELECT.SPECIAL",133:"APPLY.NAMES",134:"REPLACE.FONT",135:"FREEZE.PANES",136:"SHOW.INFO",137:"SPLIT",138:"ON.WINDOW",139:"ON.DATA",140:"DISABLE.INPUT",142:"OUTLINE",143:"LIST.NAMES",144:"FILE.CLOSE",145:"SAVE.WORKBOOK",146:"DATA.FORM",147:"COPY.CHART",148:"ON.TIME",149:"WAIT",150:"FORMAT.FONT",151:"FILL.UP",152:"FILL.LEFT",153:"DELETE.OVERLAY",155:"SHORT.MENUS",159:"SET.UPDATE.STATUS",161:"COLOR.PALETTE",162:"DELETE.STYLE",163:"WINDOW.RESTORE",164:"WINDOW.MAXIMIZE",166:"CHANGE.LINK",167:"CALCULATE.DOCUMENT",168:"ON.KEY",169:"APP.RESTORE",170:"APP.MOVE",171:"APP.SIZE",172:"APP.MINIMIZE",173:"APP.MAXIMIZE",174:"BRING.TO.FRONT",175:"SEND.TO.BACK",185:"MAIN.CHART.TYPE",186:"OVERLAY.CHART.TYPE",187:"SELECT.END",188:"OPEN.MAIL",189:"SEND.MAIL",190:"STANDARD.FONT",191:"CONSOLIDATE",192:"SORT.SPECIAL",193:"GALLERY.3D.AREA",194:"GALLERY.3D.COLUMN",195:"GALLERY.3D.LINE",196:"GALLERY.3D.PIE",197:"VIEW.3D",198:"GOAL.SEEK",199:"WORKGROUP",200:"FILL.GROUP",201:"UPDATE.LINK",202:"PROMOTE",203:"DEMOTE",204:"SHOW.DETAIL",206:"UNGROUP",207:"OBJECT.PROPERTIES",208:"SAVE.NEW.OBJECT",209:"SHARE",210:"SHARE.NAME",211:"DUPLICATE",212:"APPLY.STYLE",213:"ASSIGN.TO.OBJECT",214:"OBJECT.PROTECTION",215:"HIDE.OBJECT",216:"SET.EXTRACT",217:"CREATE.PUBLISHER",218:"SUBSCRIBE.TO",219:"ATTRIBUTES",220:"SHOW.TOOLBAR",222:"PRINT.PREVIEW",223:"EDIT.COLOR",224:"SHOW.LEVELS",225:"FORMAT.MAIN",226:"FORMAT.OVERLAY",227:"ON.RECALC",228:"EDIT.SERIES",229:"DEFINE.STYLE",240:"LINE.PRINT",243:"ENTER.DATA",249:"GALLERY.RADAR",250:"MERGE.STYLES",251:"EDITION.OPTIONS",252:"PASTE.PICTURE",253:"PASTE.PICTURE.LINK",254:"SPELLING",256:"ZOOM",259:"INSERT.OBJECT",260:"WINDOW.MINIMIZE",265:"SOUND.NOTE",266:"SOUND.PLAY",267:"FORMAT.SHAPE",268:"EXTEND.POLYGON",269:"FORMAT.AUTO",272:"GALLERY.3D.BAR",273:"GALLERY.3D.SURFACE",274:"FILL.AUTO",276:"CUSTOMIZE.TOOLBAR",277:"ADD.TOOL",278:"EDIT.OBJECT",279:"ON.DOUBLECLICK",280:"ON.ENTRY",281:"WORKBOOK.ADD",282:"WORKBOOK.MOVE",283:"WORKBOOK.COPY",284:"WORKBOOK.OPTIONS",285:"SAVE.WORKSPACE",288:"CHART.WIZARD",289:"DELETE.TOOL",290:"MOVE.TOOL",291:"WORKBOOK.SELECT",292:"WORKBOOK.ACTIVATE",293:"ASSIGN.TO.TOOL",295:"COPY.TOOL",296:"RESET.TOOL",297:"CONSTRAIN.NUMERIC",298:"PASTE.TOOL",302:"WORKBOOK.NEW",305:"SCENARIO.CELLS",306:"SCENARIO.DELETE",307:"SCENARIO.ADD",308:"SCENARIO.EDIT",309:"SCENARIO.SHOW",310:"SCENARIO.SHOW.NEXT",311:"SCENARIO.SUMMARY",312:"PIVOT.TABLE.WIZARD",313:"PIVOT.FIELD.PROPERTIES",314:"PIVOT.FIELD",315:"PIVOT.ITEM",316:"PIVOT.ADD.FIELDS",318:"OPTIONS.CALCULATION",319:"OPTIONS.EDIT",320:"OPTIONS.VIEW",321:"ADDIN.MANAGER",322:"MENU.EDITOR",323:"ATTACH.TOOLBARS",324:"VBAActivate",325:"OPTIONS.CHART",328:"VBA.INSERT.FILE",330:"VBA.PROCEDURE.DEFINITION",336:"ROUTING.SLIP",338:"ROUTE.DOCUMENT",339:"MAIL.LOGON",342:"INSERT.PICTURE",343:"EDIT.TOOL",344:"GALLERY.DOUGHNUT",350:"CHART.TREND",352:"PIVOT.ITEM.PROPERTIES",354:"WORKBOOK.INSERT",355:"OPTIONS.TRANSITION",356:"OPTIONS.GENERAL",370:"FILTER.ADVANCED",373:"MAIL.ADD.MAILER",374:"MAIL.DELETE.MAILER",375:"MAIL.REPLY",376:"MAIL.REPLY.ALL",377:"MAIL.FORWARD",378:"MAIL.NEXT.LETTER",379:"DATA.LABEL",380:"INSERT.TITLE",381:"FONT.PROPERTIES",382:"MACRO.OPTIONS",383:"WORKBOOK.HIDE",384:"WORKBOOK.UNHIDE",385:"WORKBOOK.DELETE",386:"WORKBOOK.NAME",388:"GALLERY.CUSTOM",390:"ADD.CHART.AUTOFORMAT",391:"DELETE.CHART.AUTOFORMAT",392:"CHART.ADD.DATA",393:"AUTO.OUTLINE",394:"TAB.ORDER",395:"SHOW.DIALOG",396:"SELECT.ALL",397:"UNGROUP.SHEETS",398:"SUBTOTAL.CREATE",399:"SUBTOTAL.REMOVE",400:"RENAME.OBJECT",412:"WORKBOOK.SCROLL",413:"WORKBOOK.NEXT",414:"WORKBOOK.PREV",415:"WORKBOOK.TAB.SPLIT",416:"FULL.SCREEN",417:"WORKBOOK.PROTECT",420:"SCROLLBAR.PROPERTIES",421:"PIVOT.SHOW.PAGES",422:"TEXT.TO.COLUMNS",423:"FORMAT.CHARTTYPE",424:"LINK.FORMAT",425:"TRACER.DISPLAY",430:"TRACER.NAVIGATE",431:"TRACER.CLEAR",432:"TRACER.ERROR",433:"PIVOT.FIELD.GROUP",434:"PIVOT.FIELD.UNGROUP",435:"CHECKBOX.PROPERTIES",436:"LABEL.PROPERTIES",437:"LISTBOX.PROPERTIES",438:"EDITBOX.PROPERTIES",439:"PIVOT.REFRESH",440:"LINK.COMBO",441:"OPEN.TEXT",442:"HIDE.DIALOG",443:"SET.DIALOG.FOCUS",444:"ENABLE.OBJECT",445:"PUSHBUTTON.PROPERTIES",446:"SET.DIALOG.DEFAULT",447:"FILTER",448:"FILTER.SHOW.ALL",449:"CLEAR.OUTLINE",450:"FUNCTION.WIZARD",451:"ADD.LIST.ITEM",452:"SET.LIST.ITEM",453:"REMOVE.LIST.ITEM",454:"SELECT.LIST.ITEM",455:"SET.CONTROL.VALUE",456:"SAVE.COPY.AS",458:"OPTIONS.LISTS.ADD",459:"OPTIONS.LISTS.DELETE",460:"SERIES.AXES",461:"SERIES.X",462:"SERIES.Y",463:"ERRORBAR.X",464:"ERRORBAR.Y",465:"FORMAT.CHART",466:"SERIES.ORDER",467:"MAIL.LOGOFF",468:"CLEAR.ROUTING.SLIP",469:"APP.ACTIVATE.MICROSOFT",470:"MAIL.EDIT.MAILER",471:"ON.SHEET",472:"STANDARD.WIDTH",473:"SCENARIO.MERGE",474:"SUMMARY.INFO",475:"FIND.FILE",476:"ACTIVE.CELL.FONT",477:"ENABLE.TIPWIZARD",478:"VBA.MAKE.ADDIN",480:"INSERTDATATABLE",481:"WORKGROUP.OPTIONS",482:"MAIL.SEND.MAILER",485:"AUTOCORRECT",489:"POST.DOCUMENT",491:"PICKLIST",493:"VIEW.SHOW",494:"VIEW.DEFINE",495:"VIEW.DELETE",509:"SHEET.BACKGROUND",510:"INSERT.MAP.OBJECT",511:"OPTIONS.MENONO",517:"MSOCHECKS",518:"NORMAL",519:"LAYOUT",520:"RM.PRINT.AREA",521:"CLEAR.PRINT.AREA",522:"ADD.PRINT.AREA",523:"MOVE.BRK",545:"HIDECURR.NOTE",546:"HIDEALL.NOTES",547:"DELETE.NOTE",548:"TRAVERSE.NOTES",549:"ACTIVATE.NOTES",620:"PROTECT.REVISIONS",621:"UNPROTECT.REVISIONS",647:"OPTIONS.ME",653:"WEB.PUBLISH",667:"NEWWEBQUERY",673:"PIVOT.TABLE.CHART",753:"OPTIONS.SAVE",755:"OPTIONS.SPELL",808:"HIDEALL.INKANNOTS"},tx={0:"COUNT",1:"IF",2:"ISNA",3:"ISERROR",4:"SUM",5:"AVERAGE",6:"MIN",7:"MAX",8:"ROW",9:"COLUMN",10:"NA",11:"NPV",12:"STDEV",13:"DOLLAR",14:"FIXED",15:"SIN",16:"COS",17:"TAN",18:"ATAN",19:"PI",20:"SQRT",21:"EXP",22:"LN",23:"LOG10",24:"ABS",25:"INT",26:"SIGN",27:"ROUND",28:"LOOKUP",29:"INDEX",30:"REPT",31:"MID",32:"LEN",33:"VALUE",34:"TRUE",35:"FALSE",36:"AND",37:"OR",38:"NOT",39:"MOD",40:"DCOUNT",41:"DSUM",42:"DAVERAGE",43:"DMIN",44:"DMAX",45:"DSTDEV",46:"VAR",47:"DVAR",48:"TEXT",49:"LINEST",50:"TREND",51:"LOGEST",52:"GROWTH",53:"GOTO",54:"HALT",55:"RETURN",56:"PV",57:"FV",58:"NPER",59:"PMT",60:"RATE",61:"MIRR",62:"IRR",63:"RAND",64:"MATCH",65:"DATE",66:"TIME",67:"DAY",68:"MONTH",69:"YEAR",70:"WEEKDAY",71:"HOUR",72:"MINUTE",73:"SECOND",74:"NOW",75:"AREAS",76:"ROWS",77:"COLUMNS",78:"OFFSET",79:"ABSREF",80:"RELREF",81:"ARGUMENT",82:"SEARCH",83:"TRANSPOSE",84:"ERROR",85:"STEP",86:"TYPE",87:"ECHO",88:"SET.NAME",89:"CALLER",90:"DEREF",91:"WINDOWS",92:"SERIES",93:"DOCUMENTS",94:"ACTIVE.CELL",95:"SELECTION",96:"RESULT",97:"ATAN2",98:"ASIN",99:"ACOS",100:"CHOOSE",101:"HLOOKUP",102:"VLOOKUP",103:"LINKS",104:"INPUT",105:"ISREF",106:"GET.FORMULA",107:"GET.NAME",108:"SET.VALUE",109:"LOG",110:"EXEC",111:"CHAR",112:"LOWER",113:"UPPER",114:"PROPER",115:"LEFT",116:"RIGHT",117:"EXACT",118:"TRIM",119:"REPLACE",120:"SUBSTITUTE",121:"CODE",122:"NAMES",123:"DIRECTORY",124:"FIND",125:"CELL",126:"ISERR",127:"ISTEXT",128:"ISNUMBER",129:"ISBLANK",130:"T",131:"N",132:"FOPEN",133:"FCLOSE",134:"FSIZE",135:"FREADLN",136:"FREAD",137:"FWRITELN",138:"FWRITE",139:"FPOS",140:"DATEVALUE",141:"TIMEVALUE",142:"SLN",143:"SYD",144:"DDB",145:"GET.DEF",146:"REFTEXT",147:"TEXTREF",148:"INDIRECT",149:"REGISTER",150:"CALL",151:"ADD.BAR",152:"ADD.MENU",153:"ADD.COMMAND",154:"ENABLE.COMMAND",155:"CHECK.COMMAND",156:"RENAME.COMMAND",157:"SHOW.BAR",158:"DELETE.MENU",159:"DELETE.COMMAND",160:"GET.CHART.ITEM",161:"DIALOG.BOX",162:"CLEAN",163:"MDETERM",164:"MINVERSE",165:"MMULT",166:"FILES",167:"IPMT",168:"PPMT",169:"COUNTA",170:"CANCEL.KEY",171:"FOR",172:"WHILE",173:"BREAK",174:"NEXT",175:"INITIATE",176:"REQUEST",177:"POKE",178:"EXECUTE",179:"TERMINATE",180:"RESTART",181:"HELP",182:"GET.BAR",183:"PRODUCT",184:"FACT",185:"GET.CELL",186:"GET.WORKSPACE",187:"GET.WINDOW",188:"GET.DOCUMENT",189:"DPRODUCT",190:"ISNONTEXT",191:"GET.NOTE",192:"NOTE",193:"STDEVP",194:"VARP",195:"DSTDEVP",196:"DVARP",197:"TRUNC",198:"ISLOGICAL",199:"DCOUNTA",200:"DELETE.BAR",201:"UNREGISTER",204:"USDOLLAR",205:"FINDB",206:"SEARCHB",207:"REPLACEB",208:"LEFTB",209:"RIGHTB",210:"MIDB",211:"LENB",212:"ROUNDUP",213:"ROUNDDOWN",214:"ASC",215:"DBCS",216:"RANK",219:"ADDRESS",220:"DAYS360",221:"TODAY",222:"VDB",223:"ELSE",224:"ELSE.IF",225:"END.IF",226:"FOR.CELL",227:"MEDIAN",228:"SUMPRODUCT",229:"SINH",230:"COSH",231:"TANH",232:"ASINH",233:"ACOSH",234:"ATANH",235:"DGET",236:"CREATE.OBJECT",237:"VOLATILE",238:"LAST.ERROR",239:"CUSTOM.UNDO",240:"CUSTOM.REPEAT",241:"FORMULA.CONVERT",242:"GET.LINK.INFO",243:"TEXT.BOX",244:"INFO",245:"GROUP",246:"GET.OBJECT",247:"DB",248:"PAUSE",251:"RESUME",252:"FREQUENCY",253:"ADD.TOOLBAR",254:"DELETE.TOOLBAR",255:"User",256:"RESET.TOOLBAR",257:"EVALUATE",258:"GET.TOOLBAR",259:"GET.TOOL",260:"SPELLING.CHECK",261:"ERROR.TYPE",262:"APP.TITLE",263:"WINDOW.TITLE",264:"SAVE.TOOLBAR",265:"ENABLE.TOOL",266:"PRESS.TOOL",267:"REGISTER.ID",268:"GET.WORKBOOK",269:"AVEDEV",270:"BETADIST",271:"GAMMALN",272:"BETAINV",273:"BINOMDIST",274:"CHIDIST",275:"CHIINV",276:"COMBIN",277:"CONFIDENCE",278:"CRITBINOM",279:"EVEN",280:"EXPONDIST",281:"FDIST",282:"FINV",283:"FISHER",284:"FISHERINV",285:"FLOOR",286:"GAMMADIST",287:"GAMMAINV",288:"CEILING",289:"HYPGEOMDIST",290:"LOGNORMDIST",291:"LOGINV",292:"NEGBINOMDIST",293:"NORMDIST",294:"NORMSDIST",295:"NORMINV",296:"NORMSINV",297:"STANDARDIZE",298:"ODD",299:"PERMUT",300:"POISSON",301:"TDIST",302:"WEIBULL",303:"SUMXMY2",304:"SUMX2MY2",305:"SUMX2PY2",306:"CHITEST",307:"CORREL",308:"COVAR",309:"FORECAST",310:"FTEST",311:"INTERCEPT",312:"PEARSON",313:"RSQ",314:"STEYX",315:"SLOPE",316:"TTEST",317:"PROB",318:"DEVSQ",319:"GEOMEAN",320:"HARMEAN",321:"SUMSQ",322:"KURT",323:"SKEW",324:"ZTEST",325:"LARGE",326:"SMALL",327:"QUARTILE",328:"PERCENTILE",329:"PERCENTRANK",330:"MODE",331:"TRIMMEAN",332:"TINV",334:"MOVIE.COMMAND",335:"GET.MOVIE",336:"CONCATENATE",337:"POWER",338:"PIVOT.ADD.DATA",339:"GET.PIVOT.TABLE",340:"GET.PIVOT.FIELD",341:"GET.PIVOT.ITEM",342:"RADIANS",343:"DEGREES",344:"SUBTOTAL",345:"SUMIF",346:"COUNTIF",347:"COUNTBLANK",348:"SCENARIO.GET",349:"OPTIONS.LISTS.GET",350:"ISPMT",351:"DATEDIF",352:"DATESTRING",353:"NUMBERSTRING",354:"ROMAN",355:"OPEN.DIALOG",356:"SAVE.DIALOG",357:"VIEW.GET",358:"GETPIVOTDATA",359:"HYPERLINK",360:"PHONETIC",361:"AVERAGEA",362:"MAXA",363:"MINA",364:"STDEVPA",365:"VARPA",366:"STDEVA",367:"VARA",368:"BAHTTEXT",369:"THAIDAYOFWEEK",370:"THAIDIGIT",371:"THAIMONTHOFYEAR",372:"THAINUMSOUND",373:"THAINUMSTRING",374:"THAISTRINGLENGTH",375:"ISTHAIDIGIT",376:"ROUNDBAHTDOWN",377:"ROUNDBAHTUP",378:"THAIYEAR",379:"RTD",380:"CUBEVALUE",381:"CUBEMEMBER",382:"CUBEMEMBERPROPERTY",383:"CUBERANKEDMEMBER",384:"HEX2BIN",385:"HEX2DEC",386:"HEX2OCT",387:"DEC2BIN",388:"DEC2HEX",389:"DEC2OCT",390:"OCT2BIN",391:"OCT2HEX",392:"OCT2DEC",393:"BIN2DEC",394:"BIN2OCT",395:"BIN2HEX",396:"IMSUB",397:"IMDIV",398:"IMPOWER",399:"IMABS",400:"IMSQRT",401:"IMLN",402:"IMLOG2",403:"IMLOG10",404:"IMSIN",405:"IMCOS",406:"IMEXP",407:"IMARGUMENT",408:"IMCONJUGATE",409:"IMAGINARY",410:"IMREAL",411:"COMPLEX",412:"IMSUM",413:"IMPRODUCT",414:"SERIESSUM",415:"FACTDOUBLE",416:"SQRTPI",417:"QUOTIENT",418:"DELTA",419:"GESTEP",420:"ISEVEN",421:"ISODD",422:"MROUND",423:"ERF",424:"ERFC",425:"BESSELJ",426:"BESSELK",427:"BESSELY",428:"BESSELI",429:"XIRR",430:"XNPV",431:"PRICEMAT",432:"YIELDMAT",433:"INTRATE",434:"RECEIVED",435:"DISC",436:"PRICEDISC",437:"YIELDDISC",438:"TBILLEQ",439:"TBILLPRICE",440:"TBILLYIELD",441:"PRICE",442:"YIELD",443:"DOLLARDE",444:"DOLLARFR",445:"NOMINAL",446:"EFFECT",447:"CUMPRINC",448:"CUMIPMT",449:"EDATE",450:"EOMONTH",451:"YEARFRAC",452:"COUPDAYBS",453:"COUPDAYS",454:"COUPDAYSNC",455:"COUPNCD",456:"COUPNUM",457:"COUPPCD",458:"DURATION",459:"MDURATION",460:"ODDLPRICE",461:"ODDLYIELD",462:"ODDFPRICE",463:"ODDFYIELD",464:"RANDBETWEEN",465:"WEEKNUM",466:"AMORDEGRC",467:"AMORLINC",468:"CONVERT",724:"SHEETJS",469:"ACCRINT",470:"ACCRINTM",471:"WORKDAY",472:"NETWORKDAYS",473:"GCD",474:"MULTINOMIAL",475:"LCM",476:"FVSCHEDULE",477:"CUBEKPIMEMBER",478:"CUBESET",479:"CUBESETCOUNT",480:"IFERROR",481:"COUNTIFS",482:"SUMIFS",483:"AVERAGEIF",484:"AVERAGEIFS"},Y4={2:1,3:1,10:0,15:1,16:1,17:1,18:1,19:0,20:1,21:1,22:1,23:1,24:1,25:1,26:1,27:2,30:2,31:3,32:1,33:1,34:0,35:0,38:1,39:2,40:3,41:3,42:3,43:3,44:3,45:3,47:3,48:2,53:1,61:3,63:0,65:3,66:3,67:1,68:1,69:1,70:1,71:1,72:1,73:1,74:0,75:1,76:1,77:1,79:2,80:2,83:1,85:0,86:1,89:0,90:1,94:0,95:0,97:2,98:1,99:1,101:3,102:3,105:1,106:1,108:2,111:1,112:1,113:1,114:1,117:2,118:1,119:4,121:1,126:1,127:1,128:1,129:1,130:1,131:1,133:1,134:1,135:1,136:2,137:2,138:2,140:1,141:1,142:3,143:4,144:4,161:1,162:1,163:1,164:1,165:2,172:1,175:2,176:2,177:3,178:2,179:1,184:1,186:1,189:3,190:1,195:3,196:3,197:1,198:1,199:3,201:1,207:4,210:3,211:1,212:2,213:2,214:1,215:1,225:0,229:1,230:1,231:1,232:1,233:1,234:1,235:3,244:1,247:4,252:2,257:1,261:1,271:1,273:4,274:2,275:2,276:2,277:3,278:3,279:1,280:3,281:3,282:3,283:1,284:1,285:2,286:4,287:3,288:2,289:4,290:3,291:3,292:3,293:4,294:1,295:3,296:1,297:3,298:1,299:2,300:3,301:3,302:4,303:2,304:2,305:2,306:2,307:2,308:2,309:3,310:2,311:2,312:2,313:2,314:2,315:2,316:4,325:2,326:2,327:2,328:2,331:2,332:2,337:2,342:1,343:1,346:2,347:1,350:4,351:3,352:1,353:2,360:1,368:1,369:1,370:1,371:1,372:1,373:1,374:1,375:1,376:1,377:1,378:1,382:3,385:1,392:1,393:1,396:2,397:2,398:2,399:1,400:1,401:1,402:1,403:1,404:1,405:1,406:1,407:1,408:1,409:1,410:1,414:4,415:1,416:1,417:2,420:1,421:1,422:2,424:1,425:2,426:2,427:2,428:2,430:3,438:3,439:3,440:3,443:2,444:2,445:2,446:2,447:6,448:6,449:2,450:2,464:2,468:3,476:2,479:1,480:2,65535:0};function tg(e){return e.slice(0,3)=="of:"&&(e=e.slice(3)),e.charCodeAt(0)==61&&(e=e.slice(1),e.charCodeAt(0)==61&&(e=e.slice(1))),e=e.replace(/COM\.MICROSOFT\./g,""),e=e.replace(/\[((?:\.[A-Z]+[0-9]+)(?::\.[A-Z]+[0-9]+)?)\]/g,function(n,i){return i.replace(/\./g,"")}),e=e.replace(/\[.(#[A-Z]*[?!])\]/g,"$1"),e.replace(/[;~]/g,",").replace(/\|/g,";")}function l0(e){var n=e.split(":"),i=n[0].split(".")[0];return[i,n[0].split(".")[1]+(n.length>1?":"+(n[1].split(".")[1]||n[1].split(".")[0]):"")]}var zc={},fl={};function Nc(e,n){if(e){var i=[.7,.7,.75,.75,.3,.3];n=="xlml"&&(i=[1,1,1,1,.5,.5]),e.left==null&&(e.left=i[0]),e.right==null&&(e.right=i[1]),e.top==null&&(e.top=i[2]),e.bottom==null&&(e.bottom=i[3]),e.header==null&&(e.header=i[4]),e.footer==null&&(e.footer=i[5])}}function rx(e,n,i,c,h,m){try{c.cellNF&&(e.z=hr[n])}catch(o){if(c.WTF)throw o}if(!(e.t==="z"&&!c.cellStyles)){if(e.t==="d"&&typeof e.v=="string"&&(e.v=za(e.v)),(!c||c.cellText!==!1)&&e.t!=="z")try{if(hr[n]==null&&co(Qw[n]||"General",n),e.t==="e")e.w=e.w||vo[e.v];else if(n===0)if(e.t==="n")(e.v|0)===e.v?e.w=e.v.toString(10):e.w=Vc(e.v);else if(e.t==="d"){var x=Ci(e.v);(x|0)===x?e.w=x.toString(10):e.w=Vc(x)}else{if(e.v===void 0)return"";e.w=uo(e.v,fl)}else e.t==="d"?e.w=nn(n,Ci(e.v),fl):e.w=nn(n,e.v,fl)}catch(o){if(c.WTF)throw o}if(c.cellStyles&&i!=null)try{e.s=m.Fills[i],e.s.fgColor&&e.s.fgColor.theme&&!e.s.fgColor.rgb&&(e.s.fgColor.rgb=Mu(h.themeElements.clrScheme[e.s.fgColor.theme].rgb,e.s.fgColor.tint||0),c.WTF&&(e.s.fgColor.raw_rgb=h.themeElements.clrScheme[e.s.fgColor.theme].rgb)),e.s.bgColor&&e.s.bgColor.theme&&(e.s.bgColor.rgb=Mu(h.themeElements.clrScheme[e.s.bgColor.theme].rgb,e.s.bgColor.tint||0),c.WTF&&(e.s.bgColor.raw_rgb=h.themeElements.clrScheme[e.s.bgColor.theme].rgb))}catch(o){if(c.WTF&&m.Fills)throw o}}}function J4(e,n){var i=ha(n);i.s.r<=i.e.r&&i.s.c<=i.e.c&&i.s.r>=0&&i.s.c>=0&&(e["!ref"]=Tr(i))}var Q4=/<(?:\w:)?mergeCell ref="[A-Z0-9:]+"\s*[\/]?>/g,eC=/<(?:\w+:)?sheetData[^>]*>([\s\S]*)<\/(?:\w+:)?sheetData>/,tC=/<(?:\w:)?hyperlink [^>]*>/mg,rC=/"(\w*:\w*)"/,aC=/<(?:\w:)?col\b[^>]*[\/]?>/g,iC=/<(?:\w:)?autoFilter[^>]*([\/]|>([\s\S]*)<\/(?:\w:)?autoFilter)>/g,nC=/<(?:\w:)?pageMargins[^>]*\/>/g,ax=/<(?:\w:)?sheetPr\b(?:[^>a-z][^>]*)?\/>/,sC=/<(?:\w:)?sheetPr[^>]*(?:[\/]|>([\s\S]*)<\/(?:\w:)?sheetPr)>/,oC=/<(?:\w:)?sheetViews[^>]*(?:[\/]|>([\s\S]*)<\/(?:\w:)?sheetViews)>/;function lC(e,n,i,c,h,m,x){if(!e)return e;c||(c={"!id":{}});var o=n.dense?[]:{},S={s:{r:2e6,c:2e6},e:{r:0,c:0}},b="",C="",M=e.match(eC);M?(b=e.slice(0,M.index),C=e.slice(M.index+M[0].length)):b=C=e;var L=b.match(ax);L?Q0(L[0],o,h,i):(L=b.match(sC))&&cC(L[0],L[1]||"",o,h,i);var z=(b.match(/<(?:\w*:)?dimension/)||{index:-1}).index;if(z>0){var U=b.slice(z,z+50).match(rC);U&&J4(o,U[1])}var N=b.match(oC);N&&N[1]&&mC(N[1],h);var G=[];if(n.cellStyles){var ie=b.match(aC);ie&&fC(G,ie)}M&&gC(M[1],o,n,S,m,x);var pe=C.match(iC);pe&&(o["!autofilter"]=dC(pe[0]));var Y=[],me=C.match(Q4);if(me)for(z=0;z!=me.length;++z)Y[z]=ha(me[z].slice(me[z].indexOf('"')+1));var ve=C.match(tC);ve&&hC(o,ve,c);var we=C.match(nC);if(we&&(o["!margins"]=uC(rr(we[0]))),!o["!ref"]&&S.e.c>=S.s.c&&S.e.r>=S.s.r&&(o["!ref"]=Tr(S)),n.sheetRows>0&&o["!ref"]){var te=ha(o["!ref"]);n.sheetRows<=+te.e.r&&(te.e.r=n.sheetRows-1,te.e.r>S.e.r&&(te.e.r=S.e.r),te.e.r<te.s.r&&(te.s.r=te.e.r),te.e.c>S.e.c&&(te.e.c=S.e.c),te.e.c<te.s.c&&(te.s.c=te.e.c),o["!fullref"]=o["!ref"],o["!ref"]=Tr(te))}return G.length>0&&(o["!cols"]=G),Y.length>0&&(o["!merges"]=Y),o}function Q0(e,n,i,c){var h=rr(e);i.Sheets[c]||(i.Sheets[c]={}),h.codeName&&(i.Sheets[c].CodeName=Er(jr(h.codeName)))}function cC(e,n,i,c,h){Q0(e.slice(0,e.indexOf(">")),i,c,h)}function hC(e,n,i){for(var c=Array.isArray(e),h=0;h!=n.length;++h){var m=rr(jr(n[h]),!0);if(!m.ref)return;var x=((i||{})["!id"]||[])[m.id];x?(m.Target=x.Target,m.location&&(m.Target+="#"+Er(m.location))):(m.Target="#"+Er(m.location),x={Target:m.Target,TargetMode:"Internal"}),m.Rel=x,m.tooltip&&(m.Tooltip=m.tooltip,delete m.tooltip);for(var o=ha(m.ref),S=o.s.r;S<=o.e.r;++S)for(var b=o.s.c;b<=o.e.c;++b){var C=sr({c:b,r:S});c?(e[S]||(e[S]=[]),e[S][b]||(e[S][b]={t:"z",v:void 0}),e[S][b].l=m):(e[C]||(e[C]={t:"z",v:void 0}),e[C].l=m)}}}function uC(e){var n={};return["left","right","top","bottom","header","footer"].forEach(function(i){e[i]&&(n[i]=parseFloat(e[i]))}),n}function fC(e,n){for(var i=!1,c=0;c!=n.length;++c){var h=rr(n[c],!0);h.hidden&&(h.hidden=ea(h.hidden));var m=parseInt(h.min,10)-1,x=parseInt(h.max,10)-1;for(h.outlineLevel&&(h.level=+h.outlineLevel||0),delete h.min,delete h.max,h.width=+h.width,!i&&h.width&&(i=!0,Y0(h.width)),ml(h);m<=x;)e[m++]=Xa(h)}}function dC(e){var n={ref:(e.match(/ref="([^"]*)"/)||[])[1]};return n}var pC=/<(?:\w:)?sheetView(?:[^>a-z][^>]*)?\/?>/;function mC(e,n){n.Views||(n.Views=[{}]),(e.match(pC)||[]).forEach(function(i,c){var h=rr(i);n.Views[c]||(n.Views[c]={}),+h.zoomScale&&(n.Views[c].zoom=+h.zoomScale),ea(h.rightToLeft)&&(n.Views[c].RTL=!0)})}var gC=function(){var e=/<(?:\w+:)?c[ \/>]/,n=/<\/(?:\w+:)?row>/,i=/r=["']([^"']*)["']/,c=/<(?:\w+:)?is>([\S\s]*?)<\/(?:\w+:)?is>/,h=/ref=["']([^"']*)["']/,m=$c("v"),x=$c("f");return function(S,b,C,M,L,z){for(var U=0,N="",G=[],ie=[],pe=0,Y=0,me=0,ve="",we,te,Be=0,Ce=0,Ue,$e,Re=0,st=0,pt=Array.isArray(z.CellXf),ot,_t=[],ft=[],ir=Array.isArray(b),qe=[],$t={},Dt=!1,ue=!!C.sheetStubs,be=S.split(n),Te=0,Ae=be.length;Te!=Ae;++Te){N=be[Te].trim();var Ye=N.length;if(Ye!==0){var mt=0;e:for(U=0;U<Ye;++U)switch(N[U]){case">":if(N[U-1]!="/"){++U;break e}if(C&&C.cellStyles){if(te=rr(N.slice(mt,U),!0),Be=te.r!=null?parseInt(te.r,10):Be+1,Ce=-1,C.sheetRows&&C.sheetRows<Be)continue;$t={},Dt=!1,te.ht&&(Dt=!0,$t.hpt=parseFloat(te.ht),$t.hpx=qc($t.hpt)),te.hidden=="1"&&(Dt=!0,$t.hidden=!0),te.outlineLevel!=null&&(Dt=!0,$t.level=+te.outlineLevel),Dt&&(qe[Be-1]=$t)}break;case"<":mt=U;break}if(mt>=U)break;if(te=rr(N.slice(mt,U),!0),Be=te.r!=null?parseInt(te.r,10):Be+1,Ce=-1,!(C.sheetRows&&C.sheetRows<Be)){M.s.r>Be-1&&(M.s.r=Be-1),M.e.r<Be-1&&(M.e.r=Be-1),C&&C.cellStyles&&($t={},Dt=!1,te.ht&&(Dt=!0,$t.hpt=parseFloat(te.ht),$t.hpx=qc($t.hpt)),te.hidden=="1"&&(Dt=!0,$t.hidden=!0),te.outlineLevel!=null&&(Dt=!0,$t.level=+te.outlineLevel),Dt&&(qe[Be-1]=$t)),G=N.slice(U).split(e);for(var wt=0;wt!=G.length&&G[wt].trim().charAt(0)=="<";++wt);for(G=G.slice(wt),U=0;U!=G.length;++U)if(N=G[U].trim(),N.length!==0){if(ie=N.match(i),pe=U,Y=0,me=0,N="<c "+(N.slice(0,1)=="<"?">":"")+N,ie!=null&&ie.length===2){for(pe=0,ve=ie[1],Y=0;Y!=ve.length&&!((me=ve.charCodeAt(Y)-64)<1||me>26);++Y)pe=26*pe+me;--pe,Ce=pe}else++Ce;for(Y=0;Y!=N.length&&N.charCodeAt(Y)!==62;++Y);if(++Y,te=rr(N.slice(0,Y),!0),te.r||(te.r=sr({r:Be-1,c:Ce})),ve=N.slice(Y),we={t:""},(ie=ve.match(m))!=null&&ie[1]!==""&&(we.v=Er(ie[1])),C.cellFormula){if((ie=ve.match(x))!=null&&ie[1]!==""){if(we.f=Er(jr(ie[1])).replace(/\r\n/g,`
`),C.xlfn||(we.f=Ym(we.f)),ie[0].indexOf('t="array"')>-1)we.F=(ve.match(h)||[])[1],we.F.indexOf(":")>-1&&_t.push([ha(we.F),we.F]);else if(ie[0].indexOf('t="shared"')>-1){$e=rr(ie[0]);var ut=Er(jr(ie[1]));C.xlfn||(ut=Ym(ut)),ft[parseInt($e.si,10)]=[$e,ut,te.r]}}else(ie=ve.match(/<f[^>]*\/>/))&&($e=rr(ie[0]),ft[$e.si]&&(we.f=Ck(ft[$e.si][1],ft[$e.si][2],te.r)));var rt=Si(te.r);for(Y=0;Y<_t.length;++Y)rt.r>=_t[Y][0].s.r&&rt.r<=_t[Y][0].e.r&&rt.c>=_t[Y][0].s.c&&rt.c<=_t[Y][0].e.c&&(we.F=_t[Y][1])}if(te.t==null&&we.v===void 0)if(we.f||we.F)we.v=0,we.t="n";else if(ue)we.t="z";else continue;else we.t=te.t||"n";switch(M.s.c>Ce&&(M.s.c=Ce),M.e.c<Ce&&(M.e.c=Ce),we.t){case"n":if(we.v==""||we.v==null){if(!ue)continue;we.t="z"}else we.v=parseFloat(we.v);break;case"s":if(typeof we.v>"u"){if(!ue)continue;we.t="z"}else Ue=zc[parseInt(we.v,10)],we.v=Ue.t,we.r=Ue.r,C.cellHTML&&(we.h=Ue.h);break;case"str":we.t="s",we.v=we.v!=null?jr(we.v):"",C.cellHTML&&(we.h=U0(we.v));break;case"inlineStr":ie=ve.match(c),we.t="s",ie!=null&&(Ue=K0(ie[1]))?(we.v=Ue.t,C.cellHTML&&(we.h=Ue.h)):we.v="";break;case"b":we.v=ea(we.v);break;case"d":C.cellDates?we.v=za(we.v,1):(we.v=Ci(za(we.v,1)),we.t="n");break;case"e":(!C||C.cellText!==!1)&&(we.w=we.v),we.v=E1[we.v];break}if(Re=st=0,ot=null,pt&&te.s!==void 0&&(ot=z.CellXf[te.s],ot!=null&&(ot.numFmtId!=null&&(Re=ot.numFmtId),C.cellStyles&&ot.fillId!=null&&(st=ot.fillId))),rx(we,Re,st,C,L,z),C.cellDates&&pt&&we.t=="n"&&_l(hr[Re])&&(we.t="d",we.v=zu(we.v)),te.cm&&C.xlmeta){var Yt=(C.xlmeta.Cell||[])[+te.cm-1];Yt&&Yt.type=="XLDAPR"&&(we.D=!0)}if(ir){var xe=Si(te.r);b[xe.r]||(b[xe.r]=[]),b[xe.r][xe.c]=we}else b[te.r]=we}}}}qe.length>0&&(b["!rows"]=qe)}}();function xC(e,n){var i={},c=e.l+n;i.r=e.read_shift(4),e.l+=4;var h=e.read_shift(2);e.l+=1;var m=e.read_shift(1);return e.l=c,m&7&&(i.level=m&7),m&16&&(i.hidden=!0),m&32&&(i.hpt=h/20),i}var _C=yo;function yC(){}function vC(e,n){var i={},c=e[e.l];return++e.l,i.above=!(c&64),i.left=!(c&128),e.l+=18,i.name=$b(e),i}function wC(e){var n=sn(e);return[n]}function bC(e){var n=_o(e);return[n]}function TC(e){var n=sn(e),i=e.read_shift(1);return[n,i,"b"]}function EC(e){var n=_o(e),i=e.read_shift(1);return[n,i,"b"]}function SC(e){var n=sn(e),i=e.read_shift(1);return[n,i,"e"]}function kC(e){var n=_o(e),i=e.read_shift(1);return[n,i,"e"]}function CC(e){var n=sn(e),i=e.read_shift(4);return[n,i,"s"]}function AC(e){var n=_o(e),i=e.read_shift(4);return[n,i,"s"]}function IC(e){var n=sn(e),i=li(e);return[n,i,"n"]}function ix(e){var n=_o(e),i=li(e);return[n,i,"n"]}function FC(e){var n=sn(e),i=W0(e);return[n,i,"n"]}function PC(e){var n=_o(e),i=W0(e);return[n,i,"n"]}function MC(e){var n=sn(e),i=H0(e);return[n,i,"is"]}function DC(e){var n=sn(e),i=hi(e);return[n,i,"str"]}function LC(e){var n=_o(e),i=hi(e);return[n,i,"str"]}function RC(e,n,i){var c=e.l+n,h=sn(e);h.r=i["!row"];var m=e.read_shift(1),x=[h,m,"b"];if(i.cellFormula){e.l+=2;var o=Vu(e,c-e.l,i);x[3]=oi(o,null,h,i.supbooks,i)}else e.l=c;return x}function OC(e,n,i){var c=e.l+n,h=sn(e);h.r=i["!row"];var m=e.read_shift(1),x=[h,m,"e"];if(i.cellFormula){e.l+=2;var o=Vu(e,c-e.l,i);x[3]=oi(o,null,h,i.supbooks,i)}else e.l=c;return x}function BC(e,n,i){var c=e.l+n,h=sn(e);h.r=i["!row"];var m=li(e),x=[h,m,"n"];if(i.cellFormula){e.l+=2;var o=Vu(e,c-e.l,i);x[3]=oi(o,null,h,i.supbooks,i)}else e.l=c;return x}function zC(e,n,i){var c=e.l+n,h=sn(e);h.r=i["!row"];var m=hi(e),x=[h,m,"str"];if(i.cellFormula){e.l+=2;var o=Vu(e,c-e.l,i);x[3]=oi(o,null,h,i.supbooks,i)}else e.l=c;return x}var NC=yo;function UC(e,n){var i=e.l+n,c=yo(e),h=q0(e),m=hi(e),x=hi(e),o=hi(e);e.l=i;var S={rfx:c,relId:h,loc:m,display:o};return x&&(S.Tooltip=x),S}function VC(){}function $C(e,n,i){var c=e.l+n,h=w1(e),m=e.read_shift(1),x=[h];if(x[2]=m,i.cellFormula){var o=W4(e,c-e.l,i);x[1]=o}else e.l=c;return x}function jC(e,n,i){var c=e.l+n,h=yo(e),m=[h];if(i.cellFormula){var x=X4(e,c-e.l,i);m[1]=x,e.l=c}else e.l=c;return m}var GC=["left","right","top","bottom","header","footer"];function HC(e){var n={};return GC.forEach(function(i){n[i]=li(e)}),n}function qC(e){var n=e.read_shift(2);return e.l+=28,{RTL:n&32}}function WC(){}function ZC(){}function XC(e,n,i,c,h,m,x){if(!e)return e;var o=n||{};c||(c={"!id":{}});var S=o.dense?[]:{},b,C={s:{r:2e6,c:2e6},e:{r:0,c:0}},M=!1,L=!1,z,U,N,G,ie,pe,Y,me,ve,we=[];o.biff=12,o["!row"]=0;var te=0,Be=!1,Ce=[],Ue={},$e=o.supbooks||h.supbooks||[[]];if($e.sharedf=Ue,$e.arrayf=Ce,$e.SheetNames=h.SheetNames||h.Sheets.map(function(ir){return ir.name}),!o.supbooks&&(o.supbooks=$e,h.Names))for(var Re=0;Re<h.Names.length;++Re)$e[0][Re+1]=h.Names[Re];var st=[],pt=[],ot=!1;Ru[16]={n:"BrtShortReal",f:ix};var _t;if(ss(e,function(qe,$t,Dt){if(!L)switch(Dt){case 148:b=qe;break;case 0:z=qe,o.sheetRows&&o.sheetRows<=z.r&&(L=!0),me=Ka(G=z.r),o["!row"]=z.r,(qe.hidden||qe.hpt||qe.level!=null)&&(qe.hpt&&(qe.hpx=qc(qe.hpt)),pt[qe.r]=qe);break;case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 13:case 14:case 15:case 16:case 17:case 18:case 62:switch(U={t:qe[2]},qe[2]){case"n":U.v=qe[1];break;case"s":Y=zc[qe[1]],U.v=Y.t,U.r=Y.r;break;case"b":U.v=!!qe[1];break;case"e":U.v=qe[1],o.cellText!==!1&&(U.w=vo[U.v]);break;case"str":U.t="s",U.v=qe[1];break;case"is":U.t="s",U.v=qe[1].t;break}if((N=x.CellXf[qe[0].iStyleRef])&&rx(U,N.numFmtId,null,o,m,x),ie=qe[0].c==-1?ie+1:qe[0].c,o.dense?(S[G]||(S[G]=[]),S[G][ie]=U):S[Pa(ie)+me]=U,o.cellFormula){for(Be=!1,te=0;te<Ce.length;++te){var ue=Ce[te];z.r>=ue[0].s.r&&z.r<=ue[0].e.r&&ie>=ue[0].s.c&&ie<=ue[0].e.c&&(U.F=Tr(ue[0]),Be=!0)}!Be&&qe.length>3&&(U.f=qe[3])}if(C.s.r>z.r&&(C.s.r=z.r),C.s.c>ie&&(C.s.c=ie),C.e.r<z.r&&(C.e.r=z.r),C.e.c<ie&&(C.e.c=ie),o.cellDates&&N&&U.t=="n"&&_l(hr[N.numFmtId])){var be=no(U.v);be&&(U.t="d",U.v=new Date(be.y,be.m-1,be.d,be.H,be.M,be.S,be.u))}_t&&(_t.type=="XLDAPR"&&(U.D=!0),_t=void 0);break;case 1:case 12:if(!o.sheetStubs||M)break;U={t:"z",v:void 0},ie=qe[0].c==-1?ie+1:qe[0].c,o.dense?(S[G]||(S[G]=[]),S[G][ie]=U):S[Pa(ie)+me]=U,C.s.r>z.r&&(C.s.r=z.r),C.s.c>ie&&(C.s.c=ie),C.e.r<z.r&&(C.e.r=z.r),C.e.c<ie&&(C.e.c=ie),_t&&(_t.type=="XLDAPR"&&(U.D=!0),_t=void 0);break;case 176:we.push(qe);break;case 49:_t=((o.xlmeta||{}).Cell||[])[qe-1];break;case 494:var Te=c["!id"][qe.relId];for(Te?(qe.Target=Te.Target,qe.loc&&(qe.Target+="#"+qe.loc),qe.Rel=Te):qe.relId==""&&(qe.Target="#"+qe.loc),G=qe.rfx.s.r;G<=qe.rfx.e.r;++G)for(ie=qe.rfx.s.c;ie<=qe.rfx.e.c;++ie)o.dense?(S[G]||(S[G]=[]),S[G][ie]||(S[G][ie]={t:"z",v:void 0}),S[G][ie].l=qe):(pe=sr({c:ie,r:G}),S[pe]||(S[pe]={t:"z",v:void 0}),S[pe].l=qe);break;case 426:if(!o.cellFormula)break;Ce.push(qe),ve=o.dense?S[G][ie]:S[Pa(ie)+me],ve.f=oi(qe[1],C,{r:z.r,c:ie},$e,o),ve.F=Tr(qe[0]);break;case 427:if(!o.cellFormula)break;Ue[sr(qe[0].s)]=qe[1],ve=o.dense?S[G][ie]:S[Pa(ie)+me],ve.f=oi(qe[1],C,{r:z.r,c:ie},$e,o);break;case 60:if(!o.cellStyles)break;for(;qe.e>=qe.s;)st[qe.e--]={width:qe.w/256,hidden:!!(qe.flags&1),level:qe.level},ot||(ot=!0,Y0(qe.w/256)),ml(st[qe.e+1]);break;case 161:S["!autofilter"]={ref:Tr(qe)};break;case 476:S["!margins"]=qe;break;case 147:h.Sheets[i]||(h.Sheets[i]={}),qe.name&&(h.Sheets[i].CodeName=qe.name),(qe.above||qe.left)&&(S["!outline"]={above:qe.above,left:qe.left});break;case 137:h.Views||(h.Views=[{}]),h.Views[0]||(h.Views[0]={}),qe.RTL&&(h.Views[0].RTL=!0);break;case 485:break;case 64:case 1053:break;case 151:break;case 152:case 175:case 644:case 625:case 562:case 396:case 1112:case 1146:case 471:case 1050:case 649:case 1105:case 589:case 607:case 564:case 1055:case 168:case 174:case 1180:case 499:case 507:case 550:case 171:case 167:case 1177:case 169:case 1181:case 551:case 552:case 661:case 639:case 478:case 537:case 477:case 536:case 1103:case 680:case 1104:case 1024:case 663:case 535:case 678:case 504:case 1043:case 428:case 170:case 3072:case 50:case 2070:case 1045:break;case 35:M=!0;break;case 36:M=!1;break;case 37:M=!0;break;case 38:M=!1;break;default:if(!$t.T){if(!M||o.WTF)throw new Error("Unexpected record 0x"+Dt.toString(16))}}},o),delete o.supbooks,delete o["!row"],!S["!ref"]&&(C.s.r<2e6||b&&(b.e.r>0||b.e.c>0||b.s.r>0||b.s.c>0))&&(S["!ref"]=Tr(b||C)),o.sheetRows&&S["!ref"]){var ft=ha(S["!ref"]);o.sheetRows<=+ft.e.r&&(ft.e.r=o.sheetRows-1,ft.e.r>C.e.r&&(ft.e.r=C.e.r),ft.e.r<ft.s.r&&(ft.s.r=ft.e.r),ft.e.c>C.e.c&&(ft.e.c=C.e.c),ft.e.c<ft.s.c&&(ft.s.c=ft.e.c),S["!fullref"]=S["!ref"],S["!ref"]=Tr(ft))}return we.length>0&&(S["!merges"]=we),st.length>0&&(S["!cols"]=st),pt.length>0&&(S["!rows"]=pt),S}function KC(e){var n=[],i=e.match(/^<c:numCache>/),c;(e.match(/<c:pt idx="(\d*)">(.*?)<\/c:pt>/mg)||[]).forEach(function(m){var x=m.match(/<c:pt idx="(\d*?)"><c:v>(.*)<\/c:v><\/c:pt>/);x&&(n[+x[1]]=i?+x[2]:x[2])});var h=Er((e.match(/<c:formatCode>([\s\S]*?)<\/c:formatCode>/)||["","General"])[1]);return(e.match(/<c:f>(.*?)<\/c:f>/mg)||[]).forEach(function(m){c=m.replace(/<.*?>/g,"")}),[n,h,c]}function YC(e,n,i,c,h,m){var x=m||{"!type":"chart"};if(!e)return m;var o=0,S=0,b="A",C={s:{r:2e6,c:2e6},e:{r:0,c:0}};return(e.match(/<c:numCache>[\s\S]*?<\/c:numCache>/gm)||[]).forEach(function(M){var L=KC(M);C.s.r=C.s.c=0,C.e.c=o,b=Pa(o),L[0].forEach(function(z,U){x[b+Ka(U)]={t:"n",v:z,z:L[1]},S=U}),C.e.r<S&&(C.e.r=S),++o}),o>0&&(x["!ref"]=Tr(C)),x}function JC(e,n,i,c,h){if(!e)return e;c||(c={"!id":{}});var m={"!type":"chart","!drawel":null,"!rel":""},x,o=e.match(ax);return o&&Q0(o[0],m,h,i),(x=e.match(/drawing r:id="(.*?)"/))&&(m["!rel"]=x[1]),c["!id"][m["!rel"]]&&(m["!drawel"]=c["!id"][m["!rel"]]),m}function QC(e,n){e.l+=10;var i=hi(e);return{name:i}}function e3(e,n,i,c,h){if(!e)return e;c||(c={"!id":{}});var m={"!type":"chart","!drawel":null,"!rel":""},x=!1;return ss(e,function(S,b,C){switch(C){case 550:m["!rel"]=S;break;case 651:h.Sheets[i]||(h.Sheets[i]={}),S.name&&(h.Sheets[i].CodeName=S.name);break;case 562:case 652:case 669:case 679:case 551:case 552:case 476:case 3072:break;case 35:x=!0;break;case 36:x=!1;break;case 37:break;case 38:break;default:if(!(b.T>0)){if(!(b.T<0)){if(!x||n.WTF)throw new Error("Unexpected record 0x"+C.toString(16))}}}},n),c["!id"][m["!rel"]]&&(m["!drawel"]=c["!id"][m["!rel"]]),m}var nx=[["allowRefreshQuery",!1,"bool"],["autoCompressPictures",!0,"bool"],["backupFile",!1,"bool"],["checkCompatibility",!1,"bool"],["CodeName",""],["date1904",!1,"bool"],["defaultThemeVersion",0,"int"],["filterPrivacy",!1,"bool"],["hidePivotFieldList",!1,"bool"],["promptedSolutions",!1,"bool"],["publishItems",!1,"bool"],["refreshAllConnections",!1,"bool"],["saveExternalLinkValues",!0,"bool"],["showBorderUnselectedTables",!0,"bool"],["showInkAnnotation",!0,"bool"],["showObjects","all"],["showPivotChartFilter",!1,"bool"],["updateLinks","userSet"]],t3=[["activeTab",0,"int"],["autoFilterDateGrouping",!0,"bool"],["firstSheet",0,"int"],["minimized",!1,"bool"],["showHorizontalScroll",!0,"bool"],["showSheetTabs",!0,"bool"],["showVerticalScroll",!0,"bool"],["tabRatio",600,"int"],["visibility","visible"]],r3=[],a3=[["calcCompleted","true"],["calcMode","auto"],["calcOnSave","true"],["concurrentCalc","true"],["fullCalcOnLoad","false"],["fullPrecision","true"],["iterate","false"],["iterateCount","100"],["iterateDelta","0.001"],["refMode","A1"]];function rg(e,n){for(var i=0;i!=e.length;++i)for(var c=e[i],h=0;h!=n.length;++h){var m=n[h];if(c[m[0]]==null)c[m[0]]=m[1];else switch(m[2]){case"bool":typeof c[m[0]]=="string"&&(c[m[0]]=ea(c[m[0]]));break;case"int":typeof c[m[0]]=="string"&&(c[m[0]]=parseInt(c[m[0]],10));break}}}function ag(e,n){for(var i=0;i!=n.length;++i){var c=n[i];if(e[c[0]]==null)e[c[0]]=c[1];else switch(c[2]){case"bool":typeof e[c[0]]=="string"&&(e[c[0]]=ea(e[c[0]]));break;case"int":typeof e[c[0]]=="string"&&(e[c[0]]=parseInt(e[c[0]],10));break}}}function sx(e){ag(e.WBProps,nx),ag(e.CalcPr,a3),rg(e.WBView,t3),rg(e.Sheets,r3),fl.date1904=ea(e.WBProps.date1904)}var i3="][*?/\\".split("");function n3(e,n){if(e.length>31){if(n)return!1;throw new Error("Sheet names cannot exceed 31 chars")}var i=!0;return i3.forEach(function(c){if(e.indexOf(c)!=-1){if(!n)throw new Error("Sheet name cannot contain : \\ / ? * [ ]");i=!1}}),i}var s3=/<\w+:workbook/;function o3(e,n){if(!e)throw new Error("Could not find file");var i={AppVersion:{},WBProps:{},WBView:[],Sheets:[],CalcPr:{},Names:[],xmlns:""},c=!1,h="xmlns",m={},x=0;if(e.replace(fi,function(S,b){var C=rr(S);switch(Bn(C[0])){case"<?xml":break;case"<workbook":S.match(s3)&&(h="xmlns"+S.match(/<(\w+):/)[1]),i.xmlns=C[h];break;case"</workbook>":break;case"<fileVersion":delete C[0],i.AppVersion=C;break;case"<fileVersion/>":case"</fileVersion>":break;case"<fileSharing":break;case"<fileSharing/>":break;case"<workbookPr":case"<workbookPr/>":nx.forEach(function(M){if(C[M[0]]!=null)switch(M[2]){case"bool":i.WBProps[M[0]]=ea(C[M[0]]);break;case"int":i.WBProps[M[0]]=parseInt(C[M[0]],10);break;default:i.WBProps[M[0]]=C[M[0]]}}),C.codeName&&(i.WBProps.CodeName=jr(C.codeName));break;case"</workbookPr>":break;case"<workbookProtection":break;case"<workbookProtection/>":break;case"<bookViews":case"<bookViews>":case"</bookViews>":break;case"<workbookView":case"<workbookView/>":delete C[0],i.WBView.push(C);break;case"</workbookView>":break;case"<sheets":case"<sheets>":case"</sheets>":break;case"<sheet":switch(C.state){case"hidden":C.Hidden=1;break;case"veryHidden":C.Hidden=2;break;default:C.Hidden=0}delete C.state,C.name=Er(jr(C.name)),delete C[0],i.Sheets.push(C);break;case"</sheet>":break;case"<functionGroups":case"<functionGroups/>":break;case"<functionGroup":break;case"<externalReferences":case"</externalReferences>":case"<externalReferences>":break;case"<externalReference":break;case"<definedNames/>":break;case"<definedNames>":case"<definedNames":c=!0;break;case"</definedNames>":c=!1;break;case"<definedName":m={},m.Name=jr(C.name),C.comment&&(m.Comment=C.comment),C.localSheetId&&(m.Sheet=+C.localSheetId),ea(C.hidden||"0")&&(m.Hidden=!0),x=b+S.length;break;case"</definedName>":m.Ref=Er(jr(e.slice(x,b))),i.Names.push(m);break;case"<definedName/>":break;case"<calcPr":delete C[0],i.CalcPr=C;break;case"<calcPr/>":delete C[0],i.CalcPr=C;break;case"</calcPr>":break;case"<oleSize":break;case"<customWorkbookViews>":case"</customWorkbookViews>":case"<customWorkbookViews":break;case"<customWorkbookView":case"</customWorkbookView>":break;case"<pivotCaches>":case"</pivotCaches>":case"<pivotCaches":break;case"<pivotCache":break;case"<smartTagPr":case"<smartTagPr/>":break;case"<smartTagTypes":case"<smartTagTypes>":case"</smartTagTypes>":break;case"<smartTagType":break;case"<webPublishing":case"<webPublishing/>":break;case"<fileRecoveryPr":case"<fileRecoveryPr/>":break;case"<webPublishObjects>":case"<webPublishObjects":case"</webPublishObjects>":break;case"<webPublishObject":break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":c=!0;break;case"</ext>":c=!1;break;case"<ArchID":break;case"<AlternateContent":case"<AlternateContent>":c=!0;break;case"</AlternateContent>":c=!1;break;case"<revisionPtr":break;default:if(!c&&n.WTF)throw new Error("unrecognized "+C[0]+" in workbook")}return S}),Sb.indexOf(i.xmlns)===-1)throw new Error("Unknown Namespace: "+i.xmlns);return sx(i),i}function l3(e,n){var i={};return i.Hidden=e.read_shift(4),i.iTabID=e.read_shift(4),i.strRelID=y0(e),i.name=hi(e),i}function c3(e,n){var i={},c=e.read_shift(4);i.defaultThemeVersion=e.read_shift(4);var h=n>8?hi(e):"";return h.length>0&&(i.CodeName=h),i.autoCompressPictures=!!(c&65536),i.backupFile=!!(c&64),i.checkCompatibility=!!(c&4096),i.date1904=!!(c&1),i.filterPrivacy=!!(c&8),i.hidePivotFieldList=!!(c&1024),i.promptedSolutions=!!(c&16),i.publishItems=!!(c&2048),i.refreshAllConnections=!!(c&262144),i.saveExternalLinkValues=!!(c&128),i.showBorderUnselectedTables=!!(c&4),i.showInkAnnotation=!!(c&32),i.showObjects=["all","placeholders","none"][c>>13&3],i.showPivotChartFilter=!!(c&32768),i.updateLinks=["userSet","never","always"][c>>8&3],i}function h3(e,n){var i={};return e.read_shift(4),i.ArchID=e.read_shift(4),e.l+=n-8,i}function u3(e,n,i){var c=e.l+n;e.l+=4,e.l+=1;var h=e.read_shift(4),m=jb(e),x=Z4(e,0,i),o=q0(e);e.l=c;var S={Name:m,Ptg:x};return h<268435455&&(S.Sheet=h),o&&(S.Comment=o),S}function f3(e,n){var i={AppVersion:{},WBProps:{},WBView:[],Sheets:[],CalcPr:{},xmlns:""},c=[],h=!1;n||(n={}),n.biff=12;var m=[],x=[[]];return x.SheetNames=[],x.XTI=[],Ru[16]={n:"BrtFRTArchID$",f:h3},ss(e,function(S,b,C){switch(C){case 156:x.SheetNames.push(S.name),i.Sheets.push(S);break;case 153:i.WBProps=S;break;case 39:S.Sheet!=null&&(n.SID=S.Sheet),S.Ref=oi(S.Ptg,null,null,x,n),delete n.SID,delete S.Ptg,m.push(S);break;case 1036:break;case 357:case 358:case 355:case 667:x[0].length?x.push([C,S]):x[0]=[C,S],x[x.length-1].XTI=[];break;case 362:x.length===0&&(x[0]=[],x[0].XTI=[]),x[x.length-1].XTI=x[x.length-1].XTI.concat(S),x.XTI=x.XTI.concat(S);break;case 361:break;case 2071:case 158:case 143:case 664:case 353:break;case 3072:case 3073:case 534:case 677:case 157:case 610:case 2050:case 155:case 548:case 676:case 128:case 665:case 2128:case 2125:case 549:case 2053:case 596:case 2076:case 2075:case 2082:case 397:case 154:case 1117:case 553:case 2091:break;case 35:c.push(C),h=!0;break;case 36:c.pop(),h=!1;break;case 37:c.push(C),h=!0;break;case 38:c.pop(),h=!1;break;case 16:break;default:if(!b.T){if(!h||n.WTF&&c[c.length-1]!=37&&c[c.length-1]!=35)throw new Error("Unexpected record 0x"+C.toString(16))}}},n),sx(i),i.Names=m,i.supbooks=x,i}function d3(e,n,i){return n.slice(-4)===".bin"?f3(e,i):o3(e,i)}function p3(e,n,i,c,h,m,x,o){return n.slice(-4)===".bin"?XC(e,c,i,h,m,x,o):lC(e,c,i,h,m,x,o)}function m3(e,n,i,c,h,m,x,o){return n.slice(-4)===".bin"?e3(e,c,i,h,m):JC(e,c,i,h,m)}function g3(e,n,i,c,h,m,x,o){return n.slice(-4)===".bin"?Ek():Sk()}function x3(e,n,i,c,h,m,x,o){return n.slice(-4)===".bin"?bk():Tk()}function _3(e,n,i,c){return n.slice(-4)===".bin"?NS(e,i,c):DS(e,i,c)}function y3(e,n,i){return q1(e,i)}function v3(e,n,i){return n.slice(-4)===".bin"?tS(e,i):QE(e,i)}function w3(e,n,i){return n.slice(-4)===".bin"?yk(e,i):pk(e,i)}function b3(e,n,i){return n.slice(-4)===".bin"?uk(e):ck(e)}function T3(e,n,i,c){return i.slice(-4)===".bin"?fk(e,n,i,c):void 0}function E3(e,n,i){return n.slice(-4)===".bin"?ok(e,n,i):lk(e,n,i)}var ox=/([\w:]+)=((?:")([^"]*)(?:")|(?:')([^']*)(?:'))/g,lx=/([\w:]+)=((?:")(?:[^"]*)(?:")|(?:')(?:[^']*)(?:'))/;function _n(e,n){var i=e.split(/\s+/),c=[];if(n||(c[0]=i[0]),i.length===1)return c;var h=e.match(ox),m,x,o,S;if(h)for(S=0;S!=h.length;++S)m=h[S].match(lx),(x=m[1].indexOf(":"))===-1?c[m[1]]=m[2].slice(1,m[2].length-1):(m[1].slice(0,6)==="xmlns:"?o="xmlns"+m[1].slice(6):o=m[1].slice(x+1),c[o]=m[2].slice(1,m[2].length-1));return c}function S3(e){var n=e.split(/\s+/),i={};if(n.length===1)return i;var c=e.match(ox),h,m,x,o;if(c)for(o=0;o!=c.length;++o)h=c[o].match(lx),(m=h[1].indexOf(":"))===-1?i[h[1]]=h[2].slice(1,h[2].length-1):(h[1].slice(0,6)==="xmlns:"?x="xmlns"+h[1].slice(6):x=h[1].slice(m+1),i[x]=h[2].slice(1,h[2].length-1));return i}var Uc;function k3(e,n){var i=Uc[e]||Er(e);return i==="General"?uo(n):nn(i,n)}function C3(e,n,i,c){var h=c;switch((i[0].match(/dt:dt="([\w.]+)"/)||["",""])[1]){case"boolean":h=ea(c);break;case"i2":case"int":h=parseInt(c,10);break;case"r4":case"float":h=parseFloat(c);break;case"date":case"dateTime.tz":h=za(c);break;case"i8":case"string":case"fixed":case"uuid":case"bin.base64":break;default:throw new Error("bad custprop:"+i[0])}e[Er(n)]=h}function A3(e,n,i){if(e.t!=="z"){if(!i||i.cellText!==!1)try{e.t==="e"?e.w=e.w||vo[e.v]:n==="General"?e.t==="n"?(e.v|0)===e.v?e.w=e.v.toString(10):e.w=Vc(e.v):e.w=uo(e.v):e.w=k3(n||"General",e.v)}catch(m){if(i.WTF)throw m}try{var c=Uc[n]||n||"General";if(i.cellNF&&(e.z=c),i.cellDates&&e.t=="n"&&_l(c)){var h=no(e.v);h&&(e.t="d",e.v=new Date(h.y,h.m-1,h.d,h.H,h.M,h.S,h.u))}}catch(m){if(i.WTF)throw m}}}function I3(e,n,i){if(i.cellStyles&&n.Interior){var c=n.Interior;c.Pattern&&(c.patternType=CS[c.Pattern]||c.Pattern)}e[n.ID]=n}function F3(e,n,i,c,h,m,x,o,S,b){var C="General",M=c.StyleID,L={};b=b||{};var z=[],U=0;for(M===void 0&&o&&(M=o.StyleID),M===void 0&&x&&(M=x.StyleID);m[M]!==void 0&&(m[M].nf&&(C=m[M].nf),m[M].Interior&&z.push(m[M].Interior),!!m[M].Parent);)M=m[M].Parent;switch(i.Type){case"Boolean":c.t="b",c.v=ea(e);break;case"String":c.t="s",c.r=Sm(Er(e)),c.v=e.indexOf("<")>-1?Er(n||e).replace(/<.*?>/g,""):c.r;break;case"DateTime":e.slice(-1)!="Z"&&(e+="Z"),c.v=(za(e)-new Date(Date.UTC(1899,11,30)))/(24*60*60*1e3),c.v!==c.v?c.v=Er(e):c.v<60&&(c.v=c.v-1),(!C||C=="General")&&(C="yyyy-mm-dd");case"Number":c.v===void 0&&(c.v=+e),c.t||(c.t="n");break;case"Error":c.t="e",c.v=E1[e],b.cellText!==!1&&(c.w=e);break;default:e==""&&n==""?c.t="z":(c.t="s",c.v=Sm(n||e));break}if(A3(c,C,b),b.cellFormula!==!1)if(c.Formula){var N=Er(c.Formula);N.charCodeAt(0)==61&&(N=N.slice(1)),c.f=ul(N,h),delete c.Formula,c.ArrayRange=="RC"?c.F=ul("RC:RC",h):c.ArrayRange&&(c.F=ul(c.ArrayRange,h),S.push([ha(c.F),c.F]))}else for(U=0;U<S.length;++U)h.r>=S[U][0].s.r&&h.r<=S[U][0].e.r&&h.c>=S[U][0].s.c&&h.c<=S[U][0].e.c&&(c.F=S[U][1]);b.cellStyles&&(z.forEach(function(G){!L.patternType&&G.patternType&&(L.patternType=G.patternType)}),c.s=L),c.StyleID!==void 0&&(c.ixfe=c.StyleID)}function P3(e){e.t=e.v||"",e.t=e.t.replace(/\r\n/g,`
`).replace(/\r/g,`
`),e.v=e.w=e.ixfe=void 0}function c0(e,n){var i=n||{};Xg();var c=Ac(V0(e));(i.type=="binary"||i.type=="array"||i.type=="base64")&&(c=jr(c));var h=c.slice(0,1024).toLowerCase(),m=!1;if(h=h.replace(/".*?"/g,""),(h.indexOf(">")&1023)>Math.min(h.indexOf(",")&1023,h.indexOf(";")&1023)){var x=Xa(i);return x.type="string",Gc.to_workbook(c,x)}if(h.indexOf("<?xml")==-1&&["html","table","head","meta","script","style","div"].forEach(function(wr){h.indexOf("<"+wr)>=0&&(m=!0)}),m)return U3(c,i);Uc={"General Number":"General","General Date":hr[22],"Long Date":"dddd, mmmm dd, yyyy","Medium Date":hr[15],"Short Date":hr[14],"Long Time":hr[19],"Medium Time":hr[18],"Short Time":hr[20],Currency:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',Fixed:hr[2],Standard:hr[4],Percent:hr[10],Scientific:hr[11],"Yes/No":'"Yes";"Yes";"No";@',"True/False":'"True";"True";"False";@',"On/Off":'"Yes";"Yes";"No";@'};var o,S=[],b,C={},M=[],L=i.dense?[]:{},z="",U={},N={},G=_n('<Data ss:Type="String">'),ie=0,pe=0,Y=0,me={s:{r:2e6,c:2e6},e:{r:0,c:0}},ve={},we={},te="",Be=0,Ce=[],Ue={},$e={},Re=0,st=[],pt=[],ot={},_t=[],ft,ir=!1,qe=[],$t=[],Dt={},ue=0,be=0,Te={Sheets:[],WBProps:{date1904:!1}},Ae={};jc.lastIndex=0,c=c.replace(/<!--([\s\S]*?)-->/mg,"");for(var Ye="";o=jc.exec(c);)switch(o[3]=(Ye=o[3]).toLowerCase()){case"data":if(Ye=="data"){if(o[1]==="/"){if((b=S.pop())[0]!==o[3])throw new Error("Bad state: "+b.join("|"))}else o[0].charAt(o[0].length-2)!=="/"&&S.push([o[3],!0]);break}if(S[S.length-1][1])break;o[1]==="/"?F3(c.slice(ie,o.index),te,G,S[S.length-1][0]=="comment"?ot:U,{c:pe,r:Y},ve,_t[pe],N,qe,i):(te="",G=_n(o[0]),ie=o.index+o[0].length);break;case"cell":if(o[1]==="/")if(pt.length>0&&(U.c=pt),(!i.sheetRows||i.sheetRows>Y)&&U.v!==void 0&&(i.dense?(L[Y]||(L[Y]=[]),L[Y][pe]=U):L[Pa(pe)+Ka(Y)]=U),U.HRef&&(U.l={Target:Er(U.HRef)},U.HRefScreenTip&&(U.l.Tooltip=U.HRefScreenTip),delete U.HRef,delete U.HRefScreenTip),(U.MergeAcross||U.MergeDown)&&(ue=pe+(parseInt(U.MergeAcross,10)|0),be=Y+(parseInt(U.MergeDown,10)|0),Ce.push({s:{c:pe,r:Y},e:{c:ue,r:be}})),!i.sheetStubs)U.MergeAcross?pe=ue+1:++pe;else if(U.MergeAcross||U.MergeDown){for(var mt=pe;mt<=ue;++mt)for(var wt=Y;wt<=be;++wt)(mt>pe||wt>Y)&&(i.dense?(L[wt]||(L[wt]=[]),L[wt][mt]={t:"z"}):L[Pa(mt)+Ka(wt)]={t:"z"});pe=ue+1}else++pe;else U=S3(o[0]),U.Index&&(pe=+U.Index-1),pe<me.s.c&&(me.s.c=pe),pe>me.e.c&&(me.e.c=pe),o[0].slice(-2)==="/>"&&++pe,pt=[];break;case"row":o[1]==="/"||o[0].slice(-2)==="/>"?(Y<me.s.r&&(me.s.r=Y),Y>me.e.r&&(me.e.r=Y),o[0].slice(-2)==="/>"&&(N=_n(o[0]),N.Index&&(Y=+N.Index-1)),pe=0,++Y):(N=_n(o[0]),N.Index&&(Y=+N.Index-1),Dt={},(N.AutoFitHeight=="0"||N.Height)&&(Dt.hpx=parseInt(N.Height,10),Dt.hpt=H1(Dt.hpx),$t[Y]=Dt),N.Hidden=="1"&&(Dt.hidden=!0,$t[Y]=Dt));break;case"worksheet":if(o[1]==="/"){if((b=S.pop())[0]!==o[3])throw new Error("Bad state: "+b.join("|"));M.push(z),me.s.r<=me.e.r&&me.s.c<=me.e.c&&(L["!ref"]=Tr(me),i.sheetRows&&i.sheetRows<=me.e.r&&(L["!fullref"]=L["!ref"],me.e.r=i.sheetRows-1,L["!ref"]=Tr(me))),Ce.length&&(L["!merges"]=Ce),_t.length>0&&(L["!cols"]=_t),$t.length>0&&(L["!rows"]=$t),C[z]=L}else me={s:{r:2e6,c:2e6},e:{r:0,c:0}},Y=pe=0,S.push([o[3],!1]),b=_n(o[0]),z=Er(b.Name),L=i.dense?[]:{},Ce=[],qe=[],$t=[],Ae={name:z,Hidden:0},Te.Sheets.push(Ae);break;case"table":if(o[1]==="/"){if((b=S.pop())[0]!==o[3])throw new Error("Bad state: "+b.join("|"))}else{if(o[0].slice(-2)=="/>")break;S.push([o[3],!1]),_t=[],ir=!1}break;case"style":o[1]==="/"?I3(ve,we,i):we=_n(o[0]);break;case"numberformat":we.nf=Er(_n(o[0]).Format||"General"),Uc[we.nf]&&(we.nf=Uc[we.nf]);for(var ut=0;ut!=392&&hr[ut]!=we.nf;++ut);if(ut==392){for(ut=57;ut!=392;++ut)if(hr[ut]==null){co(we.nf,ut);break}}break;case"column":if(S[S.length-1][0]!=="table")break;if(ft=_n(o[0]),ft.Hidden&&(ft.hidden=!0,delete ft.Hidden),ft.Width&&(ft.wpx=parseInt(ft.Width,10)),!ir&&ft.wpx>10){ir=!0,Ei=j1;for(var rt=0;rt<_t.length;++rt)_t[rt]&&ml(_t[rt])}ir&&ml(ft),_t[ft.Index-1||_t.length]=ft;for(var Yt=0;Yt<+ft.Span;++Yt)_t[_t.length]=Xa(ft);break;case"namedrange":if(o[1]==="/")break;Te.Names||(Te.Names=[]);var xe=rr(o[0]),er={Name:xe.Name,Ref:ul(xe.RefersTo.slice(1),{r:0,c:0})};Te.Sheets.length>0&&(er.Sheet=Te.Sheets.length-1),Te.Names.push(er);break;case"namedcell":break;case"b":break;case"i":break;case"u":break;case"s":break;case"em":break;case"h2":break;case"h3":break;case"sub":break;case"sup":break;case"span":break;case"alignment":break;case"borders":break;case"border":break;case"font":if(o[0].slice(-2)==="/>")break;o[1]==="/"?te+=c.slice(Be,o.index):Be=o.index+o[0].length;break;case"interior":if(!i.cellStyles)break;we.Interior=_n(o[0]);break;case"protection":break;case"author":case"title":case"description":case"created":case"keywords":case"subject":case"category":case"company":case"lastauthor":case"lastsaved":case"lastprinted":case"version":case"revision":case"totaltime":case"hyperlinkbase":case"manager":case"contentstatus":case"identifier":case"language":case"appname":if(o[0].slice(-2)==="/>")break;o[1]==="/"?pT(Ue,Ye,c.slice(Re,o.index)):Re=o.index+o[0].length;break;case"paragraphs":break;case"styles":case"workbook":if(o[1]==="/"){if((b=S.pop())[0]!==o[3])throw new Error("Bad state: "+b.join("|"))}else S.push([o[3],!1]);break;case"comment":if(o[1]==="/"){if((b=S.pop())[0]!==o[3])throw new Error("Bad state: "+b.join("|"));P3(ot),pt.push(ot)}else S.push([o[3],!1]),b=_n(o[0]),ot={a:b.Author};break;case"autofilter":if(o[1]==="/"){if((b=S.pop())[0]!==o[3])throw new Error("Bad state: "+b.join("|"))}else if(o[0].charAt(o[0].length-2)!=="/"){var Jt=_n(o[0]);L["!autofilter"]={ref:ul(Jt.Range).replace(/\$/g,"")},S.push([o[3],!0])}break;case"name":break;case"datavalidation":if(o[1]==="/"){if((b=S.pop())[0]!==o[3])throw new Error("Bad state: "+b.join("|"))}else o[0].charAt(o[0].length-2)!=="/"&&S.push([o[3],!0]);break;case"pixelsperinch":break;case"componentoptions":case"documentproperties":case"customdocumentproperties":case"officedocumentsettings":case"pivottable":case"pivotcache":case"names":case"mapinfo":case"pagebreaks":case"querytable":case"sorting":case"schema":case"conditionalformatting":case"smarttagtype":case"smarttags":case"excelworkbook":case"workbookoptions":case"worksheetoptions":if(o[1]==="/"){if((b=S.pop())[0]!==o[3])throw new Error("Bad state: "+b.join("|"))}else o[0].charAt(o[0].length-2)!=="/"&&S.push([o[3],!0]);break;case"null":break;default:if(S.length==0&&o[3]=="document"||S.length==0&&o[3]=="uof")return cg(c,i);var mr=!0;switch(S[S.length-1][0]){case"officedocumentsettings":switch(o[3]){case"allowpng":break;case"removepersonalinformation":break;case"downloadcomponents":break;case"locationofcomponents":break;case"colors":break;case"color":break;case"index":break;case"rgb":break;case"targetscreensize":break;case"readonlyrecommended":break;default:mr=!1}break;case"componentoptions":switch(o[3]){case"toolbar":break;case"hideofficelogo":break;case"spreadsheetautofit":break;case"label":break;case"caption":break;case"maxheight":break;case"maxwidth":break;case"nextsheetnumber":break;default:mr=!1}break;case"excelworkbook":switch(o[3]){case"date1904":Te.WBProps.date1904=!0;break;case"windowheight":break;case"windowwidth":break;case"windowtopx":break;case"windowtopy":break;case"tabratio":break;case"protectstructure":break;case"protectwindow":break;case"protectwindows":break;case"activesheet":break;case"displayinknotes":break;case"firstvisiblesheet":break;case"supbook":break;case"sheetname":break;case"sheetindex":break;case"sheetindexfirst":break;case"sheetindexlast":break;case"dll":break;case"acceptlabelsinformulas":break;case"donotsavelinkvalues":break;case"iteration":break;case"maxiterations":break;case"maxchange":break;case"path":break;case"xct":break;case"count":break;case"selectedsheets":break;case"calculation":break;case"uncalced":break;case"startupprompt":break;case"crn":break;case"externname":break;case"formula":break;case"colfirst":break;case"collast":break;case"wantadvise":break;case"boolean":break;case"error":break;case"text":break;case"ole":break;case"noautorecover":break;case"publishobjects":break;case"donotcalculatebeforesave":break;case"number":break;case"refmoder1c1":break;case"embedsavesmarttags":break;default:mr=!1}break;case"workbookoptions":switch(o[3]){case"owcversion":break;case"height":break;case"width":break;default:mr=!1}break;case"worksheetoptions":switch(o[3]){case"visible":if(o[0].slice(-2)!=="/>")if(o[1]==="/")switch(c.slice(Re,o.index)){case"SheetHidden":Ae.Hidden=1;break;case"SheetVeryHidden":Ae.Hidden=2;break}else Re=o.index+o[0].length;break;case"header":L["!margins"]||Nc(L["!margins"]={},"xlml"),isNaN(+rr(o[0]).Margin)||(L["!margins"].header=+rr(o[0]).Margin);break;case"footer":L["!margins"]||Nc(L["!margins"]={},"xlml"),isNaN(+rr(o[0]).Margin)||(L["!margins"].footer=+rr(o[0]).Margin);break;case"pagemargins":var Zt=rr(o[0]);L["!margins"]||Nc(L["!margins"]={},"xlml"),isNaN(+Zt.Top)||(L["!margins"].top=+Zt.Top),isNaN(+Zt.Left)||(L["!margins"].left=+Zt.Left),isNaN(+Zt.Right)||(L["!margins"].right=+Zt.Right),isNaN(+Zt.Bottom)||(L["!margins"].bottom=+Zt.Bottom);break;case"displayrighttoleft":Te.Views||(Te.Views=[]),Te.Views[0]||(Te.Views[0]={}),Te.Views[0].RTL=!0;break;case"freezepanes":break;case"frozennosplit":break;case"splithorizontal":case"splitvertical":break;case"donotdisplaygridlines":break;case"activerow":break;case"activecol":break;case"toprowbottompane":break;case"leftcolumnrightpane":break;case"unsynced":break;case"print":break;case"printerrors":break;case"panes":break;case"scale":break;case"pane":break;case"number":break;case"layout":break;case"pagesetup":break;case"selected":break;case"protectobjects":break;case"enableselection":break;case"protectscenarios":break;case"validprinterinfo":break;case"horizontalresolution":break;case"verticalresolution":break;case"numberofcopies":break;case"activepane":break;case"toprowvisible":break;case"leftcolumnvisible":break;case"fittopage":break;case"rangeselection":break;case"papersizeindex":break;case"pagelayoutzoom":break;case"pagebreakzoom":break;case"filteron":break;case"fitwidth":break;case"fitheight":break;case"commentslayout":break;case"zoom":break;case"lefttoright":break;case"gridlines":break;case"allowsort":break;case"allowfilter":break;case"allowinsertrows":break;case"allowdeleterows":break;case"allowinsertcols":break;case"allowdeletecols":break;case"allowinserthyperlinks":break;case"allowformatcells":break;case"allowsizecols":break;case"allowsizerows":break;case"nosummaryrowsbelowdetail":L["!outline"]||(L["!outline"]={}),L["!outline"].above=!0;break;case"tabcolorindex":break;case"donotdisplayheadings":break;case"showpagelayoutzoom":break;case"nosummarycolumnsrightdetail":L["!outline"]||(L["!outline"]={}),L["!outline"].left=!0;break;case"blackandwhite":break;case"donotdisplayzeros":break;case"displaypagebreak":break;case"rowcolheadings":break;case"donotdisplayoutline":break;case"noorientation":break;case"allowusepivottables":break;case"zeroheight":break;case"viewablerange":break;case"selection":break;case"protectcontents":break;default:mr=!1}break;case"pivottable":case"pivotcache":switch(o[3]){case"immediateitemsondrop":break;case"showpagemultipleitemlabel":break;case"compactrowindent":break;case"location":break;case"pivotfield":break;case"orientation":break;case"layoutform":break;case"layoutsubtotallocation":break;case"layoutcompactrow":break;case"position":break;case"pivotitem":break;case"datatype":break;case"datafield":break;case"sourcename":break;case"parentfield":break;case"ptlineitems":break;case"ptlineitem":break;case"countofsameitems":break;case"item":break;case"itemtype":break;case"ptsource":break;case"cacheindex":break;case"consolidationreference":break;case"filename":break;case"reference":break;case"nocolumngrand":break;case"norowgrand":break;case"blanklineafteritems":break;case"hidden":break;case"subtotal":break;case"basefield":break;case"mapchilditems":break;case"function":break;case"refreshonfileopen":break;case"printsettitles":break;case"mergelabels":break;case"defaultversion":break;case"refreshname":break;case"refreshdate":break;case"refreshdatecopy":break;case"versionlastrefresh":break;case"versionlastupdate":break;case"versionupdateablemin":break;case"versionrefreshablemin":break;case"calculation":break;default:mr=!1}break;case"pagebreaks":switch(o[3]){case"colbreaks":break;case"colbreak":break;case"rowbreaks":break;case"rowbreak":break;case"colstart":break;case"colend":break;case"rowend":break;default:mr=!1}break;case"autofilter":switch(o[3]){case"autofiltercolumn":break;case"autofiltercondition":break;case"autofilterand":break;case"autofilteror":break;default:mr=!1}break;case"querytable":switch(o[3]){case"id":break;case"autoformatfont":break;case"autoformatpattern":break;case"querysource":break;case"querytype":break;case"enableredirections":break;case"refreshedinxl9":break;case"urlstring":break;case"htmltables":break;case"connection":break;case"commandtext":break;case"refreshinfo":break;case"notitles":break;case"nextid":break;case"columninfo":break;case"overwritecells":break;case"donotpromptforfile":break;case"textwizardsettings":break;case"source":break;case"number":break;case"decimal":break;case"thousandseparator":break;case"trailingminusnumbers":break;case"formatsettings":break;case"fieldtype":break;case"delimiters":break;case"tab":break;case"comma":break;case"autoformatname":break;case"versionlastedit":break;case"versionlastrefresh":break;default:mr=!1}break;case"datavalidation":switch(o[3]){case"range":break;case"type":break;case"min":break;case"max":break;case"sort":break;case"descending":break;case"order":break;case"casesensitive":break;case"value":break;case"errorstyle":break;case"errormessage":break;case"errortitle":break;case"inputmessage":break;case"inputtitle":break;case"combohide":break;case"inputhide":break;case"condition":break;case"qualifier":break;case"useblank":break;case"value1":break;case"value2":break;case"format":break;case"cellrangelist":break;default:mr=!1}break;case"sorting":case"conditionalformatting":switch(o[3]){case"range":break;case"type":break;case"min":break;case"max":break;case"sort":break;case"descending":break;case"order":break;case"casesensitive":break;case"value":break;case"errorstyle":break;case"errormessage":break;case"errortitle":break;case"cellrangelist":break;case"inputmessage":break;case"inputtitle":break;case"combohide":break;case"inputhide":break;case"condition":break;case"qualifier":break;case"useblank":break;case"value1":break;case"value2":break;case"format":break;default:mr=!1}break;case"mapinfo":case"schema":case"data":switch(o[3]){case"map":break;case"entry":break;case"range":break;case"xpath":break;case"field":break;case"xsdtype":break;case"filteron":break;case"aggregate":break;case"elementtype":break;case"attributetype":break;case"schema":case"element":case"complextype":case"datatype":case"all":case"attribute":case"extends":break;case"row":break;default:mr=!1}break;case"smarttags":break;default:mr=!1;break}if(mr||o[3].match(/!\[CDATA/))break;if(!S[S.length-1][1])throw"Unrecognized tag: "+o[3]+"|"+S.join("|");if(S[S.length-1][0]==="customdocumentproperties"){if(o[0].slice(-2)==="/>")break;o[1]==="/"?C3($e,Ye,st,c.slice(Re,o.index)):(st=o,Re=o.index+o[0].length);break}if(i.WTF)throw"Unrecognized tag: "+o[3]+"|"+S.join("|")}var Et={};return!i.bookSheets&&!i.bookProps&&(Et.Sheets=C),Et.SheetNames=M,Et.Workbook=Te,Et.SSF=Xa(hr),Et.Props=Ue,Et.Custprops=$e,Et}function T0(e,n){switch(rd(n=n||{}),n.type||"base64"){case"base64":return c0(Gi(e),n);case"binary":case"buffer":case"file":return c0(e,n);case"array":return c0(xo(e),n)}}function M3(e){var n={},i=e.content;if(i.l=28,n.AnsiUserType=i.read_shift(0,"lpstr-ansi"),n.AnsiClipboardFormat=qb(i),i.length-i.l<=4)return n;var c=i.read_shift(4);if(c==0||c>40||(i.l-=4,n.Reserved1=i.read_shift(0,"lpstr-ansi"),i.length-i.l<=4)||(c=i.read_shift(4),c!==1907505652)||(n.UnicodeClipboardFormat=Wb(i),c=i.read_shift(4),c==0||c>40))return n;i.l-=4,n.Reserved2=i.read_shift(0,"lpwstr")}var D3=[60,1084,2066,2165,2175];function L3(e,n,i,c,h){var m=c,x=[],o=i.slice(i.l,i.l+m);if(h&&h.enc&&h.enc.insitu&&o.length>0)switch(e){case 9:case 521:case 1033:case 2057:case 47:case 405:case 225:case 406:case 312:case 404:case 10:break;case 133:break;default:h.enc.insitu(o)}x.push(o),i.l+=m;for(var S=rs(i,i.l),b=E0[S],C=0;b!=null&&D3.indexOf(S)>-1;)m=rs(i,i.l+2),C=i.l+4,S==2066?C+=4:(S==2165||S==2175)&&(C+=12),o=i.slice(C,i.l+4+m),x.push(o),i.l+=4+m,b=E0[S=rs(i,i.l)];var M=As(x);Za(M,0);var L=0;M.lens=[];for(var z=0;z<x.length;++z)M.lens.push(L),L+=x[z].length;if(M.length<c)throw"XLS Record 0x"+e.toString(16)+" Truncated: "+M.length+" < "+c;return n.f(M,M.length,h)}function Dn(e,n,i){if(e.t!=="z"&&e.XF){var c=0;try{c=e.z||e.XF.numFmtId||0,n.cellNF&&(e.z=hr[c])}catch(m){if(n.WTF)throw m}if(!n||n.cellText!==!1)try{e.t==="e"?e.w=e.w||vo[e.v]:c===0||c=="General"?e.t==="n"?(e.v|0)===e.v?e.w=e.v.toString(10):e.w=Vc(e.v):e.w=uo(e.v):e.w=nn(c,e.v,{date1904:!!i,dateNF:n&&n.dateNF})}catch(m){if(n.WTF)throw m}if(n.cellDates&&c&&e.t=="n"&&_l(hr[c]||String(c))){var h=no(e.v);h&&(e.t="d",e.v=new Date(h.y,h.m-1,h.d,h.H,h.M,h.S,h.u))}}}function _u(e,n,i){return{v:e,ixfe:n,t:i}}function R3(e,n){var i={opts:{}},c={},h=n.dense?[]:{},m={},x={},o=null,S=[],b="",C={},M,L="",z,U,N,G,ie={},pe=[],Y,me,ve=[],we=[],te={Sheets:[],WBProps:{date1904:!1},Views:[{}]},Be={},Ce=function(Xt){return Xt<8?ho[Xt]:Xt<64&&we[Xt-8]||ho[Xt]},Ue=function(Xt,Sr,lt){var Mt=Sr.XF.data;if(!(!Mt||!Mt.patternType||!lt||!lt.cellStyles)){Sr.s={},Sr.s.patternType=Mt.patternType;var Ut;(Ut=Hc(Ce(Mt.icvFore)))&&(Sr.s.fgColor={rgb:Ut}),(Ut=Hc(Ce(Mt.icvBack)))&&(Sr.s.bgColor={rgb:Ut})}},$e=function(Xt,Sr,lt){if(!(Dt>1)&&!(lt.sheetRows&&Xt.r>=lt.sheetRows)){if(lt.cellStyles&&Sr.XF&&Sr.XF.data&&Ue(Xt,Sr,lt),delete Sr.ixfe,delete Sr.XF,M=Xt,L=sr(Xt),(!x||!x.s||!x.e)&&(x={s:{r:0,c:0},e:{r:0,c:0}}),Xt.r<x.s.r&&(x.s.r=Xt.r),Xt.c<x.s.c&&(x.s.c=Xt.c),Xt.r+1>x.e.r&&(x.e.r=Xt.r+1),Xt.c+1>x.e.c&&(x.e.c=Xt.c+1),lt.cellFormula&&Sr.f){for(var Mt=0;Mt<pe.length;++Mt)if(!(pe[Mt][0].s.c>Xt.c||pe[Mt][0].s.r>Xt.r)&&!(pe[Mt][0].e.c<Xt.c||pe[Mt][0].e.r<Xt.r)){Sr.F=Tr(pe[Mt][0]),(pe[Mt][0].s.c!=Xt.c||pe[Mt][0].s.r!=Xt.r)&&delete Sr.f,Sr.f&&(Sr.f=""+oi(pe[Mt][1],x,Xt,qe,Re));break}}lt.dense?(h[Xt.r]||(h[Xt.r]=[]),h[Xt.r][Xt.c]=Sr):h[L]=Sr}},Re={enc:!1,sbcch:0,snames:[],sharedf:ie,arrayf:pe,rrtabid:[],lastuser:"",biff:8,codepage:0,winlocked:0,cellStyles:!!n&&!!n.cellStyles,WTF:!!n&&!!n.wtf};n.password&&(Re.password=n.password);var st,pt=[],ot=[],_t=[],ft=[],ir=!1,qe=[];qe.SheetNames=Re.snames,qe.sharedf=Re.sharedf,qe.arrayf=Re.arrayf,qe.names=[],qe.XTI=[];var $t=0,Dt=0,ue=0,be=[],Te=[],Ae;Re.codepage=1200,wn(1200);for(var Ye=!1;e.l<e.length-1;){var mt=e.l,wt=e.read_shift(2);if(wt===0&&$t===10)break;var ut=e.l===e.length?0:e.read_shift(2),rt=E0[wt];if(rt&&rt.f){if(n.bookSheets&&$t===133&&wt!==133)break;if($t=wt,rt.r===2||rt.r==12){var Yt=e.read_shift(2);if(ut-=2,!Re.enc&&Yt!==wt&&((Yt&255)<<8|Yt>>8)!==wt)throw new Error("rt mismatch: "+Yt+"!="+wt);rt.r==12&&(e.l+=10,ut-=10)}var xe={};if(wt===10?xe=rt.f(e,ut,Re):xe=L3(wt,rt,e,ut,Re),Dt==0&&[9,521,1033,2057].indexOf($t)===-1)continue;switch(wt){case 34:i.opts.Date1904=te.WBProps.date1904=xe;break;case 134:i.opts.WriteProtect=!0;break;case 47:if(Re.enc||(e.l=0),Re.enc=xe,!n.password)throw new Error("File is password-protected");if(xe.valid==null)throw new Error("Encryption scheme unsupported");if(!xe.valid)throw new Error("Password is incorrect");break;case 92:Re.lastuser=xe;break;case 66:var er=Number(xe);switch(er){case 21010:er=1200;break;case 32768:er=1e4;break;case 32769:er=1252;break}wn(Re.codepage=er),Ye=!0;break;case 317:Re.rrtabid=xe;break;case 25:Re.winlocked=xe;break;case 439:i.opts.RefreshAll=xe;break;case 12:i.opts.CalcCount=xe;break;case 16:i.opts.CalcDelta=xe;break;case 17:i.opts.CalcIter=xe;break;case 13:i.opts.CalcMode=xe;break;case 14:i.opts.CalcPrecision=xe;break;case 95:i.opts.CalcSaveRecalc=xe;break;case 15:Re.CalcRefMode=xe;break;case 2211:i.opts.FullCalc=xe;break;case 129:xe.fDialog&&(h["!type"]="dialog"),xe.fBelow||((h["!outline"]||(h["!outline"]={})).above=!0),xe.fRight||((h["!outline"]||(h["!outline"]={})).left=!0);break;case 224:ve.push(xe);break;case 430:qe.push([xe]),qe[qe.length-1].XTI=[];break;case 35:case 547:qe[qe.length-1].push(xe);break;case 24:case 536:Ae={Name:xe.Name,Ref:oi(xe.rgce,x,null,qe,Re)},xe.itab>0&&(Ae.Sheet=xe.itab-1),qe.names.push(Ae),qe[0]||(qe[0]=[],qe[0].XTI=[]),qe[qe.length-1].push(xe),xe.Name=="_xlnm._FilterDatabase"&&xe.itab>0&&xe.rgce&&xe.rgce[0]&&xe.rgce[0][0]&&xe.rgce[0][0][0]=="PtgArea3d"&&(Te[xe.itab-1]={ref:Tr(xe.rgce[0][0][1][2])});break;case 22:Re.ExternCount=xe;break;case 23:qe.length==0&&(qe[0]=[],qe[0].XTI=[]),qe[qe.length-1].XTI=qe[qe.length-1].XTI.concat(xe),qe.XTI=qe.XTI.concat(xe);break;case 2196:if(Re.biff<8)break;Ae!=null&&(Ae.Comment=xe[1]);break;case 18:h["!protect"]=xe;break;case 19:xe!==0&&Re.WTF&&console.error("Password verifier: "+xe);break;case 133:m[xe.pos]=xe,Re.snames.push(xe.name);break;case 10:{if(--Dt)break;if(x.e){if(x.e.r>0&&x.e.c>0){if(x.e.r--,x.e.c--,h["!ref"]=Tr(x),n.sheetRows&&n.sheetRows<=x.e.r){var Jt=x.e.r;x.e.r=n.sheetRows-1,h["!fullref"]=h["!ref"],h["!ref"]=Tr(x),x.e.r=Jt}x.e.r++,x.e.c++}pt.length>0&&(h["!merges"]=pt),ot.length>0&&(h["!objects"]=ot),_t.length>0&&(h["!cols"]=_t),ft.length>0&&(h["!rows"]=ft),te.Sheets.push(Be)}b===""?C=h:c[b]=h,h=n.dense?[]:{}}break;case 9:case 521:case 1033:case 2057:{if(Re.biff===8&&(Re.biff={9:2,521:3,1033:4}[wt]||{512:2,768:3,1024:4,1280:5,1536:8,2:2,7:2}[xe.BIFFVer]||8),Re.biffguess=xe.BIFFVer==0,xe.BIFFVer==0&&xe.dt==4096&&(Re.biff=5,Ye=!0,wn(Re.codepage=28591)),Re.biff==8&&xe.BIFFVer==0&&xe.dt==16&&(Re.biff=2),Dt++)break;if(h=n.dense?[]:{},Re.biff<8&&!Ye&&(Ye=!0,wn(Re.codepage=n.codepage||1252)),Re.biff<5||xe.BIFFVer==0&&xe.dt==4096){b===""&&(b="Sheet1"),x={s:{r:0,c:0},e:{r:0,c:0}};var mr={pos:e.l-ut,name:b};m[mr.pos]=mr,Re.snames.push(b)}else b=(m[mt]||{name:""}).name;xe.dt==32&&(h["!type"]="chart"),xe.dt==64&&(h["!type"]="macro"),pt=[],ot=[],Re.arrayf=pe=[],_t=[],ft=[],ir=!1,Be={Hidden:(m[mt]||{hs:0}).hs,name:b}}break;case 515:case 3:case 2:h["!type"]=="chart"&&(n.dense?(h[xe.r]||[])[xe.c]:h[sr({c:xe.c,r:xe.r})])&&++xe.c,Y={ixfe:xe.ixfe,XF:ve[xe.ixfe]||{},v:xe.val,t:"n"},ue>0&&(Y.z=be[Y.ixfe>>8&63]),Dn(Y,n,i.opts.Date1904),$e({c:xe.c,r:xe.r},Y,n);break;case 5:case 517:Y={ixfe:xe.ixfe,XF:ve[xe.ixfe],v:xe.val,t:xe.t},ue>0&&(Y.z=be[Y.ixfe>>8&63]),Dn(Y,n,i.opts.Date1904),$e({c:xe.c,r:xe.r},Y,n);break;case 638:Y={ixfe:xe.ixfe,XF:ve[xe.ixfe],v:xe.rknum,t:"n"},ue>0&&(Y.z=be[Y.ixfe>>8&63]),Dn(Y,n,i.opts.Date1904),$e({c:xe.c,r:xe.r},Y,n);break;case 189:for(var Zt=xe.c;Zt<=xe.C;++Zt){var Et=xe.rkrec[Zt-xe.c][0];Y={ixfe:Et,XF:ve[Et],v:xe.rkrec[Zt-xe.c][1],t:"n"},ue>0&&(Y.z=be[Y.ixfe>>8&63]),Dn(Y,n,i.opts.Date1904),$e({c:Zt,r:xe.r},Y,n)}break;case 6:case 518:case 1030:{if(xe.val=="String"){o=xe;break}if(Y=_u(xe.val,xe.cell.ixfe,xe.tt),Y.XF=ve[Y.ixfe],n.cellFormula){var wr=xe.formula;if(wr&&wr[0]&&wr[0][0]&&wr[0][0][0]=="PtgExp"){var Wr=wr[0][0][1][0],Xe=wr[0][0][1][1],Fr=sr({r:Wr,c:Xe});ie[Fr]?Y.f=""+oi(xe.formula,x,xe.cell,qe,Re):Y.F=((n.dense?(h[Wr]||[])[Xe]:h[Fr])||{}).F}else Y.f=""+oi(xe.formula,x,xe.cell,qe,Re)}ue>0&&(Y.z=be[Y.ixfe>>8&63]),Dn(Y,n,i.opts.Date1904),$e(xe.cell,Y,n),o=xe}break;case 7:case 519:if(o)o.val=xe,Y=_u(xe,o.cell.ixfe,"s"),Y.XF=ve[Y.ixfe],n.cellFormula&&(Y.f=""+oi(o.formula,x,o.cell,qe,Re)),ue>0&&(Y.z=be[Y.ixfe>>8&63]),Dn(Y,n,i.opts.Date1904),$e(o.cell,Y,n),o=null;else throw new Error("String record expects Formula");break;case 33:case 545:{pe.push(xe);var na=sr(xe[0].s);if(z=n.dense?(h[xe[0].s.r]||[])[xe[0].s.c]:h[na],n.cellFormula&&z){if(!o||!na||!z)break;z.f=""+oi(xe[1],x,xe[0],qe,Re),z.F=Tr(xe[0])}}break;case 1212:{if(!n.cellFormula)break;if(L){if(!o)break;ie[sr(o.cell)]=xe[0],z=n.dense?(h[o.cell.r]||[])[o.cell.c]:h[sr(o.cell)],(z||{}).f=""+oi(xe[0],x,M,qe,Re)}}break;case 253:Y=_u(S[xe.isst].t,xe.ixfe,"s"),S[xe.isst].h&&(Y.h=S[xe.isst].h),Y.XF=ve[Y.ixfe],ue>0&&(Y.z=be[Y.ixfe>>8&63]),Dn(Y,n,i.opts.Date1904),$e({c:xe.c,r:xe.r},Y,n);break;case 513:n.sheetStubs&&(Y={ixfe:xe.ixfe,XF:ve[xe.ixfe],t:"z"},ue>0&&(Y.z=be[Y.ixfe>>8&63]),Dn(Y,n,i.opts.Date1904),$e({c:xe.c,r:xe.r},Y,n));break;case 190:if(n.sheetStubs)for(var ur=xe.c;ur<=xe.C;++ur){var qt=xe.ixfe[ur-xe.c];Y={ixfe:qt,XF:ve[qt],t:"z"},ue>0&&(Y.z=be[Y.ixfe>>8&63]),Dn(Y,n,i.opts.Date1904),$e({c:ur,r:xe.r},Y,n)}break;case 214:case 516:case 4:Y=_u(xe.val,xe.ixfe,"s"),Y.XF=ve[Y.ixfe],ue>0&&(Y.z=be[Y.ixfe>>8&63]),Dn(Y,n,i.opts.Date1904),$e({c:xe.c,r:xe.r},Y,n);break;case 0:case 512:Dt===1&&(x=xe);break;case 252:S=xe;break;case 1054:if(Re.biff==4){be[ue++]=xe[1];for(var Zr=0;Zr<ue+163&&hr[Zr]!=xe[1];++Zr);Zr>=163&&co(xe[1],ue+163)}else co(xe[1],xe[0]);break;case 30:{be[ue++]=xe;for(var Sa=0;Sa<ue+163&&hr[Sa]!=xe;++Sa);Sa>=163&&co(xe,ue+163)}break;case 229:pt=pt.concat(xe);break;case 93:ot[xe.cmo[0]]=Re.lastobj=xe;break;case 438:Re.lastobj.TxO=xe;break;case 127:Re.lastobj.ImData=xe;break;case 440:for(G=xe[0].s.r;G<=xe[0].e.r;++G)for(N=xe[0].s.c;N<=xe[0].e.c;++N)z=n.dense?(h[G]||[])[N]:h[sr({c:N,r:G})],z&&(z.l=xe[1]);break;case 2048:for(G=xe[0].s.r;G<=xe[0].e.r;++G)for(N=xe[0].s.c;N<=xe[0].e.c;++N)z=n.dense?(h[G]||[])[N]:h[sr({c:N,r:G})],z&&z.l&&(z.l.Tooltip=xe[1]);break;case 28:{if(Re.biff<=5&&Re.biff>=2)break;z=n.dense?(h[xe[0].r]||[])[xe[0].c]:h[sr(xe[0])];var ua=ot[xe[2]];z||(n.dense?(h[xe[0].r]||(h[xe[0].r]=[]),z=h[xe[0].r][xe[0].c]={t:"z"}):z=h[sr(xe[0])]={t:"z"},x.e.r=Math.max(x.e.r,xe[0].r),x.s.r=Math.min(x.s.r,xe[0].r),x.e.c=Math.max(x.e.c,xe[0].c),x.s.c=Math.min(x.s.c,xe[0].c)),z.c||(z.c=[]),U={a:xe[1],t:ua.TxO.t},z.c.push(U)}break;case 2173:ak(ve[xe.ixfe],xe.ext);break;case 125:{if(!Re.cellStyles)break;for(;xe.e>=xe.s;)_t[xe.e--]={width:xe.w/256,level:xe.level||0,hidden:!!(xe.flags&1)},ir||(ir=!0,Y0(xe.w/256)),ml(_t[xe.e+1])}break;case 520:{var zr={};xe.level!=null&&(ft[xe.r]=zr,zr.level=xe.level),xe.hidden&&(ft[xe.r]=zr,zr.hidden=!0),xe.hpt&&(ft[xe.r]=zr,zr.hpt=xe.hpt,zr.hpx=qc(xe.hpt))}break;case 38:case 39:case 40:case 41:h["!margins"]||Nc(h["!margins"]={}),h["!margins"][{38:"left",39:"right",40:"top",41:"bottom"}[wt]]=xe;break;case 161:h["!margins"]||Nc(h["!margins"]={}),h["!margins"].header=xe.header,h["!margins"].footer=xe.footer;break;case 574:xe.RTL&&(te.Views[0].RTL=!0);break;case 146:we=xe;break;case 2198:st=xe;break;case 140:me=xe;break;case 442:b?Be.CodeName=xe||Be.name:te.WBProps.CodeName=xe||"ThisWorkbook";break}}else rt||console.error("Missing Info for XLS Record 0x"+wt.toString(16)),e.l+=ut}return i.SheetNames=On(m).sort(function(fa,Xt){return Number(fa)-Number(Xt)}).map(function(fa){return m[fa].name}),n.bookSheets||(i.Sheets=c),!i.SheetNames.length&&C["!ref"]?(i.SheetNames.push("Sheet1"),i.Sheets&&(i.Sheets.Sheet1=C)):i.Preamble=C,i.Sheets&&Te.forEach(function(fa,Xt){i.Sheets[i.SheetNames[Xt]]["!autofilter"]=fa}),i.Strings=S,i.SSF=Xa(hr),Re.enc&&(i.Encryption=Re.enc),st&&(i.Themes=st),i.Metadata={},me!==void 0&&(i.Metadata.Country=me),qe.names.length>0&&(te.Names=qe.names),i.Workbook=te,i}var ig={SI:"e0859ff2f94f6810ab9108002b27b3d9",DSI:"02d5cdd59c2e1b10939708002b2cf9ae",UDI:"05d5cdd59c2e1b10939708002b2cf9ae"};function O3(e,n,i){var c=br.find(e,"/!DocumentSummaryInformation");if(c&&c.size>0)try{var h=Vm(c,Qb,ig.DSI);for(var m in h)n[m]=h[m]}catch(b){if(i.WTF)throw b}var x=br.find(e,"/!SummaryInformation");if(x&&x.size>0)try{var o=Vm(x,eT,ig.SI);for(var S in o)n[S]==null&&(n[S]=o[S])}catch(b){if(i.WTF)throw b}n.HeadingPairs&&n.TitlesOfParts&&(k1(n.HeadingPairs,n.TitlesOfParts,n,i),delete n.HeadingPairs,delete n.TitlesOfParts)}function cx(e,n){n||(n={}),rd(n),Bg(),n.codepage&&L0(n.codepage);var i,c;if(e.FullPaths){if(br.find(e,"/encryption"))throw new Error("File is password-protected");i=br.find(e,"!CompObj"),c=br.find(e,"/Workbook")||br.find(e,"/Book")}else{switch(n.type){case"base64":e=vn(Gi(e));break;case"binary":e=vn(e);break;case"buffer":break;case"array":Array.isArray(e)||(e=Array.prototype.slice.call(e));break}Za(e,0),c={content:e}}var h,m;if(i&&M3(i),n.bookProps&&!n.bookSheets)h={};else{var x=vr?"buffer":"array";if(c&&c.content)h=R3(c.content,n);else if((m=br.find(e,"PerfectOffice_MAIN"))&&m.content)h=Bc.to_workbook(m.content,(n.type=x,n));else if((m=br.find(e,"NativeContent_MAIN"))&&m.content)h=Bc.to_workbook(m.content,(n.type=x,n));else throw(m=br.find(e,"MN0"))&&m.content?new Error("Unsupported Works 4 for Mac file"):new Error("Cannot find Workbook stream");n.bookVBA&&e.FullPaths&&br.find(e,"/_VBA_PROJECT_CUR/VBA/dir")&&(h.vbaraw=wk(e))}var o={};return e.FullPaths&&O3(e,o,n),h.Props=h.Custprops=o,n.bookFiles&&(h.cfb=e),h}var Ru={0:{f:xC},1:{f:wC},2:{f:FC},3:{f:SC},4:{f:TC},5:{f:IC},6:{f:DC},7:{f:CC},8:{f:zC},9:{f:BC},10:{f:RC},11:{f:OC},12:{f:bC},13:{f:PC},14:{f:kC},15:{f:EC},16:{f:ix},17:{f:LC},18:{f:AC},19:{f:H0},20:{},21:{},22:{},23:{},24:{},25:{},26:{},27:{},28:{},29:{},30:{},31:{},32:{},33:{},34:{},35:{T:1},36:{T:-1},37:{T:1},38:{T:-1},39:{f:u3},40:{},42:{},43:{f:RS},44:{f:LS},45:{f:OS},46:{f:zS},47:{f:BS},48:{},49:{f:Nb},50:{},51:{f:nk},52:{T:1},53:{T:-1},54:{T:1},55:{T:-1},56:{T:1},57:{T:-1},58:{},59:{},60:{f:z1},62:{f:MC},63:{f:hk},64:{f:WC},65:{},66:{},67:{},68:{},69:{},70:{},128:{},129:{T:1},130:{T:-1},131:{T:1,f:ui,p:0},132:{T:-1},133:{T:1},134:{T:-1},135:{T:1},136:{T:-1},137:{T:1,f:qC},138:{T:-1},139:{T:1},140:{T:-1},141:{T:1},142:{T:-1},143:{T:1},144:{T:-1},145:{T:1},146:{T:-1},147:{f:vC},148:{f:_C,p:16},151:{f:VC},152:{},153:{f:c3},154:{},155:{},156:{f:l3},157:{},158:{},159:{T:1,f:eS},160:{T:-1},161:{T:1,f:yo},162:{T:-1},163:{T:1},164:{T:-1},165:{T:1},166:{T:-1},167:{},168:{},169:{},170:{},171:{},172:{T:1},173:{T:-1},174:{},175:{},176:{f:NC},177:{T:1},178:{T:-1},179:{T:1},180:{T:-1},181:{T:1},182:{T:-1},183:{T:1},184:{T:-1},185:{T:1},186:{T:-1},187:{T:1},188:{T:-1},189:{T:1},190:{T:-1},191:{T:1},192:{T:-1},193:{T:1},194:{T:-1},195:{T:1},196:{T:-1},197:{T:1},198:{T:-1},199:{T:1},200:{T:-1},201:{T:1},202:{T:-1},203:{T:1},204:{T:-1},205:{T:1},206:{T:-1},207:{T:1},208:{T:-1},209:{T:1},210:{T:-1},211:{T:1},212:{T:-1},213:{T:1},214:{T:-1},215:{T:1},216:{T:-1},217:{T:1},218:{T:-1},219:{T:1},220:{T:-1},221:{T:1},222:{T:-1},223:{T:1},224:{T:-1},225:{T:1},226:{T:-1},227:{T:1},228:{T:-1},229:{T:1},230:{T:-1},231:{T:1},232:{T:-1},233:{T:1},234:{T:-1},235:{T:1},236:{T:-1},237:{T:1},238:{T:-1},239:{T:1},240:{T:-1},241:{T:1},242:{T:-1},243:{T:1},244:{T:-1},245:{T:1},246:{T:-1},247:{T:1},248:{T:-1},249:{T:1},250:{T:-1},251:{T:1},252:{T:-1},253:{T:1},254:{T:-1},255:{T:1},256:{T:-1},257:{T:1},258:{T:-1},259:{T:1},260:{T:-1},261:{T:1},262:{T:-1},263:{T:1},264:{T:-1},265:{T:1},266:{T:-1},267:{T:1},268:{T:-1},269:{T:1},270:{T:-1},271:{T:1},272:{T:-1},273:{T:1},274:{T:-1},275:{T:1},276:{T:-1},277:{},278:{T:1},279:{T:-1},280:{T:1},281:{T:-1},282:{T:1},283:{T:1},284:{T:-1},285:{T:1},286:{T:-1},287:{T:1},288:{T:-1},289:{T:1},290:{T:-1},291:{T:1},292:{T:-1},293:{T:1},294:{T:-1},295:{T:1},296:{T:-1},297:{T:1},298:{T:-1},299:{T:1},300:{T:-1},301:{T:1},302:{T:-1},303:{T:1},304:{T:-1},305:{T:1},306:{T:-1},307:{T:1},308:{T:-1},309:{T:1},310:{T:-1},311:{T:1},312:{T:-1},313:{T:-1},314:{T:1},315:{T:-1},316:{T:1},317:{T:-1},318:{T:1},319:{T:-1},320:{T:1},321:{T:-1},322:{T:1},323:{T:-1},324:{T:1},325:{T:-1},326:{T:1},327:{T:-1},328:{T:1},329:{T:-1},330:{T:1},331:{T:-1},332:{T:1},333:{T:-1},334:{T:1},335:{f:ik},336:{T:-1},337:{f:sk,T:1},338:{T:-1},339:{T:1},340:{T:-1},341:{T:1},342:{T:-1},343:{T:1},344:{T:-1},345:{T:1},346:{T:-1},347:{T:1},348:{T:-1},349:{T:1},350:{T:-1},351:{},352:{},353:{T:1},354:{T:-1},355:{f:y0},357:{},358:{},359:{},360:{T:1},361:{},362:{f:B1},363:{},364:{},366:{},367:{},368:{},369:{},370:{},371:{},372:{T:1},373:{T:-1},374:{T:1},375:{T:-1},376:{T:1},377:{T:-1},378:{T:1},379:{T:-1},380:{T:1},381:{T:-1},382:{T:1},383:{T:-1},384:{T:1},385:{T:-1},386:{T:1},387:{T:-1},388:{T:1},389:{T:-1},390:{T:1},391:{T:-1},392:{T:1},393:{T:-1},394:{T:1},395:{T:-1},396:{},397:{},398:{},399:{},400:{},401:{T:1},403:{},404:{},405:{},406:{},407:{},408:{},409:{},410:{},411:{},412:{},413:{},414:{},415:{},416:{},417:{},418:{},419:{},420:{},421:{},422:{T:1},423:{T:1},424:{T:-1},425:{T:-1},426:{f:$C},427:{f:jC},428:{},429:{T:1},430:{T:-1},431:{T:1},432:{T:-1},433:{T:1},434:{T:-1},435:{T:1},436:{T:-1},437:{T:1},438:{T:-1},439:{T:1},440:{T:-1},441:{T:1},442:{T:-1},443:{T:1},444:{T:-1},445:{T:1},446:{T:-1},447:{T:1},448:{T:-1},449:{T:1},450:{T:-1},451:{T:1},452:{T:-1},453:{T:1},454:{T:-1},455:{T:1},456:{T:-1},457:{T:1},458:{T:-1},459:{T:1},460:{T:-1},461:{T:1},462:{T:-1},463:{T:1},464:{T:-1},465:{T:1},466:{T:-1},467:{T:1},468:{T:-1},469:{T:1},470:{T:-1},471:{},472:{},473:{T:1},474:{T:-1},475:{},476:{f:HC},477:{},478:{},479:{T:1},480:{T:-1},481:{T:1},482:{T:-1},483:{T:1},484:{T:-1},485:{f:yC},486:{T:1},487:{T:-1},488:{T:1},489:{T:-1},490:{T:1},491:{T:-1},492:{T:1},493:{T:-1},494:{f:UC},495:{T:1},496:{T:-1},497:{T:1},498:{T:-1},499:{},500:{T:1},501:{T:-1},502:{T:1},503:{T:-1},504:{},505:{T:1},506:{T:-1},507:{},508:{T:1},509:{T:-1},510:{T:1},511:{T:-1},512:{},513:{},514:{T:1},515:{T:-1},516:{T:1},517:{T:-1},518:{T:1},519:{T:-1},520:{T:1},521:{T:-1},522:{},523:{},524:{},525:{},526:{},527:{},528:{T:1},529:{T:-1},530:{T:1},531:{T:-1},532:{T:1},533:{T:-1},534:{},535:{},536:{},537:{},538:{T:1},539:{T:-1},540:{T:1},541:{T:-1},542:{T:1},548:{},549:{},550:{f:y0},551:{},552:{},553:{},554:{T:1},555:{T:-1},556:{T:1},557:{T:-1},558:{T:1},559:{T:-1},560:{T:1},561:{T:-1},562:{},564:{},565:{T:1},566:{T:-1},569:{T:1},570:{T:-1},572:{},573:{T:1},574:{T:-1},577:{},578:{},579:{},580:{},581:{},582:{},583:{},584:{},585:{},586:{},587:{},588:{T:-1},589:{},590:{T:1},591:{T:-1},592:{T:1},593:{T:-1},594:{T:1},595:{T:-1},596:{},597:{T:1},598:{T:-1},599:{T:1},600:{T:-1},601:{T:1},602:{T:-1},603:{T:1},604:{T:-1},605:{T:1},606:{T:-1},607:{},608:{T:1},609:{T:-1},610:{},611:{T:1},612:{T:-1},613:{T:1},614:{T:-1},615:{T:1},616:{T:-1},617:{T:1},618:{T:-1},619:{T:1},620:{T:-1},625:{},626:{T:1},627:{T:-1},628:{T:1},629:{T:-1},630:{T:1},631:{T:-1},632:{f:_k},633:{T:1},634:{T:-1},635:{T:1,f:xk},636:{T:-1},637:{f:Vb},638:{T:1},639:{},640:{T:-1},641:{T:1},642:{T:-1},643:{T:1},644:{},645:{T:-1},646:{T:1},648:{T:1},649:{},650:{T:-1},651:{f:QC},652:{},653:{T:1},654:{T:-1},655:{T:1},656:{T:-1},657:{T:1},658:{T:-1},659:{},660:{T:1},661:{},662:{T:-1},663:{},664:{T:1},665:{},666:{T:-1},667:{},668:{},669:{},671:{T:1},672:{T:-1},673:{T:1},674:{T:-1},675:{},676:{},677:{},678:{},679:{},680:{},681:{},1024:{},1025:{},1026:{T:1},1027:{T:-1},1028:{T:1},1029:{T:-1},1030:{},1031:{T:1},1032:{T:-1},1033:{T:1},1034:{T:-1},1035:{},1036:{},1037:{},1038:{T:1},1039:{T:-1},1040:{},1041:{T:1},1042:{T:-1},1043:{},1044:{},1045:{},1046:{T:1},1047:{T:-1},1048:{T:1},1049:{T:-1},1050:{},1051:{T:1},1052:{T:1},1053:{f:ZC},1054:{T:1},1055:{},1056:{T:1},1057:{T:-1},1058:{T:1},1059:{T:-1},1061:{},1062:{T:1},1063:{T:-1},1064:{T:1},1065:{T:-1},1066:{T:1},1067:{T:-1},1068:{T:1},1069:{T:-1},1070:{T:1},1071:{T:-1},1072:{T:1},1073:{T:-1},1075:{T:1},1076:{T:-1},1077:{T:1},1078:{T:-1},1079:{T:1},1080:{T:-1},1081:{T:1},1082:{T:-1},1083:{T:1},1084:{T:-1},1085:{},1086:{T:1},1087:{T:-1},1088:{T:1},1089:{T:-1},1090:{T:1},1091:{T:-1},1092:{T:1},1093:{T:-1},1094:{T:1},1095:{T:-1},1096:{},1097:{T:1},1098:{},1099:{T:-1},1100:{T:1},1101:{T:-1},1102:{},1103:{},1104:{},1105:{},1111:{},1112:{},1113:{T:1},1114:{T:-1},1115:{T:1},1116:{T:-1},1117:{},1118:{T:1},1119:{T:-1},1120:{T:1},1121:{T:-1},1122:{T:1},1123:{T:-1},1124:{T:1},1125:{T:-1},1126:{},1128:{T:1},1129:{T:-1},1130:{},1131:{T:1},1132:{T:-1},1133:{T:1},1134:{T:-1},1135:{T:1},1136:{T:-1},1137:{T:1},1138:{T:-1},1139:{T:1},1140:{T:-1},1141:{},1142:{T:1},1143:{T:-1},1144:{T:1},1145:{T:-1},1146:{},1147:{T:1},1148:{T:-1},1149:{T:1},1150:{T:-1},1152:{T:1},1153:{T:-1},1154:{T:-1},1155:{T:-1},1156:{T:-1},1157:{T:1},1158:{T:-1},1159:{T:1},1160:{T:-1},1161:{T:1},1162:{T:-1},1163:{T:1},1164:{T:-1},1165:{T:1},1166:{T:-1},1167:{T:1},1168:{T:-1},1169:{T:1},1170:{T:-1},1171:{},1172:{T:1},1173:{T:-1},1177:{},1178:{T:1},1180:{},1181:{},1182:{},2048:{T:1},2049:{T:-1},2050:{},2051:{T:1},2052:{T:-1},2053:{},2054:{},2055:{T:1},2056:{T:-1},2057:{T:1},2058:{T:-1},2060:{},2067:{},2068:{T:1},2069:{T:-1},2070:{},2071:{},2072:{T:1},2073:{T:-1},2075:{},2076:{},2077:{T:1},2078:{T:-1},2079:{},2080:{T:1},2081:{T:-1},2082:{},2083:{T:1},2084:{T:-1},2085:{T:1},2086:{T:-1},2087:{T:1},2088:{T:-1},2089:{T:1},2090:{T:-1},2091:{},2092:{},2093:{T:1},2094:{T:-1},2095:{},2096:{T:1},2097:{T:-1},2098:{T:1},2099:{T:-1},2100:{T:1},2101:{T:-1},2102:{},2103:{T:1},2104:{T:-1},2105:{},2106:{T:1},2107:{T:-1},2108:{},2109:{T:1},2110:{T:-1},2111:{T:1},2112:{T:-1},2113:{T:1},2114:{T:-1},2115:{},2116:{},2117:{},2118:{T:1},2119:{T:-1},2120:{},2121:{T:1},2122:{T:-1},2123:{T:1},2124:{T:-1},2125:{},2126:{T:1},2127:{T:-1},2128:{},2129:{T:1},2130:{T:-1},2131:{T:1},2132:{T:-1},2133:{T:1},2134:{},2135:{},2136:{},2137:{T:1},2138:{T:-1},2139:{T:1},2140:{T:-1},2141:{},3072:{},3073:{},4096:{T:1},4097:{T:-1},5002:{T:1},5003:{T:-1},5081:{T:1},5082:{T:-1},5083:{},5084:{T:1},5085:{T:-1},5086:{T:1},5087:{T:-1},5088:{},5089:{},5090:{},5092:{T:1},5093:{T:-1},5094:{},5095:{T:1},5096:{T:-1},5097:{},5099:{},65535:{n:""}},E0={6:{f:o0},10:{f:ks},12:{f:Ea},13:{f:Ea},14:{f:wa},15:{f:wa},16:{f:li},17:{f:wa},18:{f:wa},19:{f:Ea},20:{f:Hm},21:{f:Hm},23:{f:B1},24:{f:Wm},25:{f:wa},26:{},27:{},28:{f:mE},29:{},34:{f:wa},35:{f:qm},38:{f:li},39:{f:li},40:{f:li},41:{f:li},42:{f:wa},43:{f:wa},47:{f:yS},49:{f:KT},51:{f:Ea},60:{},61:{f:WT},64:{f:wa},65:{f:XT},66:{f:Ea},77:{},80:{},81:{},82:{},85:{f:Ea},89:{},90:{},91:{},92:{f:NT},93:{f:xE},94:{},95:{f:wa},96:{},97:{},99:{f:wa},125:{f:z1},128:{f:sE},129:{f:UT},130:{f:Ea},131:{f:wa},132:{f:wa},133:{f:VT},134:{},140:{f:TE},141:{f:Ea},144:{},146:{f:SE},151:{},152:{},153:{},154:{},155:{},156:{f:Ea},157:{},158:{},160:{f:FE},161:{f:CE},174:{},175:{},176:{},177:{},178:{},180:{},181:{},182:{},184:{},185:{},189:{f:rE},190:{f:aE},193:{f:ks},197:{},198:{},199:{},200:{},201:{},202:{f:wa},203:{},204:{},205:{},206:{},207:{},208:{},209:{},210:{},211:{},213:{},215:{},216:{},217:{},218:{f:Ea},220:{},221:{f:wa},222:{},224:{f:nE},225:{f:zT},226:{f:ks},227:{},229:{f:gE},233:{},235:{},236:{},237:{},239:{},240:{},241:{},242:{},244:{},245:{},246:{},247:{},248:{},249:{},251:{},252:{f:$T},253:{f:YT},255:{f:jT},256:{},259:{},290:{},311:{},312:{},315:{},317:{f:P1},318:{},319:{},320:{},330:{},331:{},333:{},334:{},335:{},336:{},337:{},338:{},339:{},340:{},351:{},352:{f:wa},353:{f:ks},401:{},402:{},403:{},404:{},405:{},406:{},407:{},408:{},425:{},426:{},427:{},428:{},429:{},430:{f:lE},431:{f:wa},432:{},433:{},434:{},437:{},438:{f:vE},439:{f:wa},440:{f:wE},441:{},442:{f:Jc},443:{},444:{f:Ea},445:{},446:{},448:{f:ks},449:{f:qT,r:2},450:{f:ks},512:{f:jm},513:{f:IE},515:{f:oE},516:{f:JT},517:{f:Gm},519:{f:PE},520:{f:GT},523:{},545:{f:Zm},549:{f:$m},566:{},574:{f:ZT},638:{f:tE},659:{},1048:{},1054:{f:QT},1084:{},1212:{f:fE},2048:{f:bE},2049:{},2050:{},2051:{},2052:{},2053:{},2054:{},2055:{},2056:{},2057:{f:mu},2058:{},2059:{},2060:{},2061:{},2062:{},2063:{},2064:{},2066:{},2067:{},2128:{},2129:{},2130:{},2131:{},2132:{},2133:{},2134:{},2135:{},2136:{},2137:{},2138:{},2146:{},2147:{r:12},2148:{},2149:{},2150:{},2151:{f:ks},2152:{},2154:{},2155:{},2156:{},2161:{},2162:{},2164:{},2165:{},2166:{},2167:{},2168:{},2169:{},2170:{},2171:{},2172:{f:kE,r:12},2173:{f:rk,r:12},2174:{},2175:{},2180:{},2181:{},2182:{},2183:{},2184:{},2185:{},2186:{},2187:{},2188:{f:wa,r:12},2189:{},2190:{r:12},2191:{},2192:{},2194:{},2195:{},2196:{f:uE,r:12},2197:{},2198:{f:KS,r:12},2199:{},2200:{},2201:{},2202:{f:dE,r:12},2203:{f:ks},2204:{},2205:{},2206:{},2207:{},2211:{f:HT},2212:{},2213:{},2214:{},2215:{},4097:{},4098:{},4099:{},4102:{},4103:{},4105:{},4106:{},4107:{},4108:{},4109:{},4116:{},4117:{},4118:{},4119:{},4120:{},4121:{},4122:{},4123:{},4124:{},4125:{},4126:{},4127:{},4128:{},4129:{},4130:{},4132:{},4133:{},4134:{f:Ea},4135:{},4146:{},4147:{},4148:{},4149:{},4154:{},4156:{},4157:{},4158:{},4159:{},4160:{},4161:{},4163:{},4164:{f:AE},4165:{},4166:{},4168:{},4170:{},4171:{},4174:{},4175:{},4176:{},4177:{},4187:{},4188:{f:EE},4189:{},4191:{},4192:{},4193:{},4194:{},4195:{},4196:{},4197:{},4198:{},4199:{},4200:{},0:{f:jm},1:{},2:{f:RE},3:{f:LE},4:{f:DE},5:{f:Gm},7:{f:OE},8:{},9:{f:mu},11:{},22:{f:Ea},30:{f:eE},31:{},32:{},33:{f:Zm},36:{},37:{f:$m},50:{f:BE},62:{},52:{},67:{},68:{f:Ea},69:{},86:{},126:{},127:{f:ME},135:{},136:{},137:{},145:{},148:{},149:{},150:{},169:{},171:{},188:{},191:{},192:{},194:{},195:{},214:{f:zE},223:{},234:{},354:{},421:{},518:{f:o0},521:{f:mu},536:{f:Wm},547:{f:qm},561:{},579:{},1030:{f:o0},1033:{f:mu},1091:{},2157:{},2163:{},2177:{},2240:{},2241:{},2242:{},2243:{},2244:{},2245:{},2246:{},2247:{},2248:{},2249:{},2250:{},2251:{},2262:{r:12},29282:{}};function yn(e,n,i,c){var h=n;if(!isNaN(h)){var m=c||(i||[]).length||0,x=e.next(4);x.write_shift(2,h),x.write_shift(2,m),m>0&&_1(i)&&e.push(i)}}function ng(e,n){var i=n||{},c=i.dense?[]:{};e=e.replace(/<!--.*?-->/g,"");var h=e.match(/<table/i);if(!h)throw new Error("Invalid HTML: could not find <table>");var m=e.match(/<\/table/i),x=h.index,o=m&&m.index||e.length,S=lb(e.slice(x,o),/(:?<tr[^>]*>)/i,"<tr>"),b=-1,C=0,M=0,L=0,z={s:{r:1e7,c:1e7},e:{r:0,c:0}},U=[];for(x=0;x<S.length;++x){var N=S[x].trim(),G=N.slice(0,3).toLowerCase();if(G=="<tr"){if(++b,i.sheetRows&&i.sheetRows<=b){--b;break}C=0;continue}if(!(G!="<td"&&G!="<th")){var ie=N.split(/<\/t[dh]>/i);for(o=0;o<ie.length;++o){var pe=ie[o].trim();if(pe.match(/<t[dh]/i)){for(var Y=pe,me=0;Y.charAt(0)=="<"&&(me=Y.indexOf(">"))>-1;)Y=Y.slice(me+1);for(var ve=0;ve<U.length;++ve){var we=U[ve];we.s.c==C&&we.s.r<b&&b<=we.e.r&&(C=we.e.c+1,ve=-1)}var te=rr(pe.slice(0,pe.indexOf(">")));L=te.colspan?+te.colspan:1,((M=+te.rowspan)>1||L>1)&&U.push({s:{r:b,c:C},e:{r:b+(M||1)-1,c:C+L-1}});var Be=te.t||te["data-t"]||"";if(!Y.length){C+=L;continue}if(Y=n1(Y),z.s.r>b&&(z.s.r=b),z.e.r<b&&(z.e.r=b),z.s.c>C&&(z.s.c=C),z.e.c<C&&(z.e.c=C),!Y.length){C+=L;continue}var Ce={t:"s",v:Y};i.raw||!Y.trim().length||Be=="s"||(Y==="TRUE"?Ce={t:"b",v:!0}:Y==="FALSE"?Ce={t:"b",v:!1}:isNaN(Tn(Y))?isNaN(pl(Y).getDate())||(Ce={t:"d",v:za(Y)},i.cellDates||(Ce={t:"n",v:Ci(Ce.v)}),Ce.z=i.dateNF||hr[14]):Ce={t:"n",v:Tn(Y)}),i.dense?(c[b]||(c[b]=[]),c[b][C]=Ce):c[sr({r:b,c:C})]=Ce,C+=L}}}}return c["!ref"]=Tr(z),U.length&&(c["!merges"]=U),c}function B3(e,n,i,c){for(var h=e["!merges"]||[],m=[],x=n.s.c;x<=n.e.c;++x){for(var o=0,S=0,b=0;b<h.length;++b)if(!(h[b].s.r>i||h[b].s.c>x)&&!(h[b].e.r<i||h[b].e.c<x)){if(h[b].s.r<i||h[b].s.c<x){o=-1;break}o=h[b].e.r-h[b].s.r+1,S=h[b].e.c-h[b].s.c+1;break}if(!(o<0)){var C=sr({r:i,c:x}),M=c.dense?(e[i]||[])[x]:e[C],L=M&&M.v!=null&&(M.h||U0(M.w||(ns(M),M.w)||""))||"",z={};o>1&&(z.rowspan=o),S>1&&(z.colspan=S),c.editable?L='<span contenteditable="true">'+L+"</span>":M&&(z["data-t"]=M&&M.t||"z",M.v!=null&&(z["data-v"]=M.v),M.z!=null&&(z["data-z"]=M.z),M.l&&(M.l.Target||"#").charAt(0)!="#"&&(L='<a href="'+M.l.Target+'">'+L+"</a>")),z.id=(c.id||"sjs")+"-"+C,m.push(Tb("td",L,z))}}var U="<tr>";return U+m.join("")+"</tr>"}var z3='<html><head><meta charset="utf-8"/><title>SheetJS Table Export</title></head><body>',N3="</body></html>";function U3(e,n){var i=e.match(/<table[\s\S]*?>[\s\S]*?<\/table>/gi);if(!i||i.length==0)throw new Error("Invalid HTML: could not find <table>");if(i.length==1)return Rs(ng(i[0],n),n);var c=id();return i.forEach(function(h,m){nd(c,ng(h,n),"Sheet"+(m+1))}),c}function V3(e,n,i){var c=[];return c.join("")+"<table"+(i&&i.id?' id="'+i.id+'"':"")+">"}function $3(e,n){var i=n||{},c=i.header!=null?i.header:z3,h=i.footer!=null?i.footer:N3,m=[c],x=yl(e["!ref"]);i.dense=Array.isArray(e),m.push(V3(e,x,i));for(var o=x.s.r;o<=x.e.r;++o)m.push(B3(e,x,o,i));return m.push("</table>"+h),m.join("")}function hx(e,n,i){var c=i||{},h=0,m=0;if(c.origin!=null)if(typeof c.origin=="number")h=c.origin;else{var x=typeof c.origin=="string"?Si(c.origin):c.origin;h=x.r,m=x.c}var o=n.getElementsByTagName("tr"),S=Math.min(c.sheetRows||1e7,o.length),b={s:{r:0,c:0},e:{r:h,c:m}};if(e["!ref"]){var C=yl(e["!ref"]);b.s.r=Math.min(b.s.r,C.s.r),b.s.c=Math.min(b.s.c,C.s.c),b.e.r=Math.max(b.e.r,C.e.r),b.e.c=Math.max(b.e.c,C.e.c),h==-1&&(b.e.r=h=C.e.r+1)}var M=[],L=0,z=e["!rows"]||(e["!rows"]=[]),U=0,N=0,G=0,ie=0,pe=0,Y=0;for(e["!cols"]||(e["!cols"]=[]);U<o.length&&N<S;++U){var me=o[U];if(sg(me)){if(c.display)continue;z[N]={hidden:!0}}var ve=me.children;for(G=ie=0;G<ve.length;++G){var we=ve[G];if(!(c.display&&sg(we))){var te=we.hasAttribute("data-v")?we.getAttribute("data-v"):we.hasAttribute("v")?we.getAttribute("v"):n1(we.innerHTML),Be=we.getAttribute("data-z")||we.getAttribute("z");for(L=0;L<M.length;++L){var Ce=M[L];Ce.s.c==ie+m&&Ce.s.r<N+h&&N+h<=Ce.e.r&&(ie=Ce.e.c+1-m,L=-1)}Y=+we.getAttribute("colspan")||1,((pe=+we.getAttribute("rowspan")||1)>1||Y>1)&&M.push({s:{r:N+h,c:ie+m},e:{r:N+h+(pe||1)-1,c:ie+m+(Y||1)-1}});var Ue={t:"s",v:te},$e=we.getAttribute("data-t")||we.getAttribute("t")||"";te!=null&&(te.length==0?Ue.t=$e||"z":c.raw||te.trim().length==0||$e=="s"||(te==="TRUE"?Ue={t:"b",v:!0}:te==="FALSE"?Ue={t:"b",v:!1}:isNaN(Tn(te))?isNaN(pl(te).getDate())||(Ue={t:"d",v:za(te)},c.cellDates||(Ue={t:"n",v:Ci(Ue.v)}),Ue.z=c.dateNF||hr[14]):Ue={t:"n",v:Tn(te)})),Ue.z===void 0&&Be!=null&&(Ue.z=Be);var Re="",st=we.getElementsByTagName("A");if(st&&st.length)for(var pt=0;pt<st.length&&!(st[pt].hasAttribute("href")&&(Re=st[pt].getAttribute("href"),Re.charAt(0)!="#"));++pt);Re&&Re.charAt(0)!="#"&&(Ue.l={Target:Re}),c.dense?(e[N+h]||(e[N+h]=[]),e[N+h][ie+m]=Ue):e[sr({c:ie+m,r:N+h})]=Ue,b.e.c<ie+m&&(b.e.c=ie+m),ie+=Y}}++N}return M.length&&(e["!merges"]=(e["!merges"]||[]).concat(M)),b.e.r=Math.max(b.e.r,N-1+h),e["!ref"]=Tr(b),N>=S&&(e["!fullref"]=Tr((b.e.r=o.length-U+N-1+h,b))),e}function ux(e,n){var i=n||{},c=i.dense?[]:{};return hx(c,e,n)}function j3(e,n){return Rs(ux(e,n),n)}function sg(e){var n="",i=G3(e);return i&&(n=i(e).getPropertyValue("display")),n||(n=e.style&&e.style.display),n==="none"}function G3(e){return e.ownerDocument.defaultView&&typeof e.ownerDocument.defaultView.getComputedStyle=="function"?e.ownerDocument.defaultView.getComputedStyle:typeof getComputedStyle=="function"?getComputedStyle:null}function H3(e){var n=e.replace(/[\t\r\n]/g," ").trim().replace(/ +/g," ").replace(/<text:s\/>/g," ").replace(/<text:s text:c="(\d+)"\/>/g,function(c,h){return Array(parseInt(h,10)+1).join(" ")}).replace(/<text:tab[^>]*\/>/g,"	").replace(/<text:line-break\/>/g,`
`),i=Er(n.replace(/<[^>]*>/g,""));return[i]}var og={day:["d","dd"],month:["m","mm"],year:["y","yy"],hours:["h","hh"],minutes:["m","mm"],seconds:["s","ss"],"am-pm":["A/P","AM/PM"],"day-of-week":["ddd","dddd"],era:["e","ee"],quarter:["\\Qm",'m\\"th quarter"']};function fx(e,n){var i=n||{},c=V0(e),h=[],m,x,o={name:""},S="",b=0,C,M,L={},z=[],U=i.dense?[]:{},N,G,ie={value:""},pe="",Y=0,me=[],ve=-1,we=-1,te={s:{r:1e6,c:1e7},e:{r:0,c:0}},Be=0,Ce={},Ue=[],$e={},Re=0,st=0,pt=[],ot=1,_t=1,ft=[],ir={Names:[]},qe={},$t=["",""],Dt=[],ue={},be="",Te=0,Ae=!1,Ye=!1,mt=0;for(jc.lastIndex=0,c=c.replace(/<!--([\s\S]*?)-->/mg,"").replace(/<!DOCTYPE[^\[]*\[[^\]]*\]>/gm,"");N=jc.exec(c);)switch(N[3]=N[3].replace(/_.*$/,"")){case"table":case"":N[1]==="/"?(te.e.c>=te.s.c&&te.e.r>=te.s.r?U["!ref"]=Tr(te):U["!ref"]="A1:A1",i.sheetRows>0&&i.sheetRows<=te.e.r&&(U["!fullref"]=U["!ref"],te.e.r=i.sheetRows-1,U["!ref"]=Tr(te)),Ue.length&&(U["!merges"]=Ue),pt.length&&(U["!rows"]=pt),C.name=C.||C.name,typeof JSON<"u"&&JSON.stringify(C),z.push(C.name),L[C.name]=U,Ye=!1):N[0].charAt(N[0].length-2)!=="/"&&(C=rr(N[0],!1),ve=we=-1,te.s.r=te.s.c=1e7,te.e.r=te.e.c=0,U=i.dense?[]:{},Ue=[],pt=[],Ye=!0);break;case"table-row-group":N[1]==="/"?--Be:++Be;break;case"table-row":case"":if(N[1]==="/"){ve+=ot,ot=1;break}if(M=rr(N[0],!1),M.?ve=M.-1:ve==-1&&(ve=0),ot=+M["number-rows-repeated"]||1,ot<10)for(mt=0;mt<ot;++mt)Be>0&&(pt[ve+mt]={level:Be});we=-1;break;case"covered-table-cell":N[1]!=="/"&&++we,i.sheetStubs&&(i.dense?(U[ve]||(U[ve]=[]),U[ve][we]={t:"z"}):U[sr({r:ve,c:we})]={t:"z"}),pe="",me=[];break;case"table-cell":case"":if(N[0].charAt(N[0].length-2)==="/")++we,ie=rr(N[0],!1),_t=parseInt(ie["number-columns-repeated"]||"1",10),G={t:"z",v:null},ie.formula&&i.cellFormula!=!1&&(G.f=tg(Er(ie.formula))),(ie.||ie["value-type"])=="string"&&(G.t="s",G.v=Er(ie["string-value"]||""),i.dense?(U[ve]||(U[ve]=[]),U[ve][we]=G):U[sr({r:ve,c:we})]=G),we+=_t-1;else if(N[1]!=="/"){++we,pe="",Y=0,me=[],_t=1;var wt=ot?ve+ot-1:ve;if(we>te.e.c&&(te.e.c=we),we<te.s.c&&(te.s.c=we),ve<te.s.r&&(te.s.r=ve),wt>te.e.r&&(te.e.r=wt),ie=rr(N[0],!1),Dt=[],ue={},G={t:ie.||ie["value-type"],v:null},i.cellFormula)if(ie.formula&&(ie.formula=Er(ie.formula)),ie["number-matrix-columns-spanned"]&&ie["number-matrix-rows-spanned"]&&(Re=parseInt(ie["number-matrix-rows-spanned"],10)||0,st=parseInt(ie["number-matrix-columns-spanned"],10)||0,$e={s:{r:ve,c:we},e:{r:ve+Re-1,c:we+st-1}},G.F=Tr($e),ft.push([$e,G.F])),ie.formula)G.f=tg(ie.formula);else for(mt=0;mt<ft.length;++mt)ve>=ft[mt][0].s.r&&ve<=ft[mt][0].e.r&&we>=ft[mt][0].s.c&&we<=ft[mt][0].e.c&&(G.F=ft[mt][1]);switch((ie["number-columns-spanned"]||ie["number-rows-spanned"])&&(Re=parseInt(ie["number-rows-spanned"],10)||0,st=parseInt(ie["number-columns-spanned"],10)||0,$e={s:{r:ve,c:we},e:{r:ve+Re-1,c:we+st-1}},Ue.push($e)),ie["number-columns-repeated"]&&(_t=parseInt(ie["number-columns-repeated"],10)),G.t){case"boolean":G.t="b",G.v=ea(ie["boolean-value"]);break;case"float":G.t="n",G.v=parseFloat(ie.value);break;case"percentage":G.t="n",G.v=parseFloat(ie.value);break;case"currency":G.t="n",G.v=parseFloat(ie.value);break;case"date":G.t="d",G.v=za(ie["date-value"]),i.cellDates||(G.t="n",G.v=Ci(G.v)),G.z="m/d/yy";break;case"time":G.t="n",G.v=nb(ie["time-value"])/86400,i.cellDates&&(G.t="d",G.v=zu(G.v)),G.z="HH:MM:SS";break;case"number":G.t="n",G.v=parseFloat(ie.);break;default:if(G.t==="string"||G.t==="text"||!G.t)G.t="s",ie["string-value"]!=null&&(pe=Er(ie["string-value"]),me=[]);else throw new Error("Unsupported value type "+G.t)}}else{if(Ae=!1,G.t==="s"&&(G.v=pe||"",me.length&&(G.R=me),Ae=Y==0),qe.Target&&(G.l=qe),Dt.length>0&&(G.c=Dt,Dt=[]),pe&&i.cellText!==!1&&(G.w=pe),Ae&&(G.t="z",delete G.v),(!Ae||i.sheetStubs)&&!(i.sheetRows&&i.sheetRows<=ve))for(var ut=0;ut<ot;++ut){if(_t=parseInt(ie["number-columns-repeated"]||"1",10),i.dense)for(U[ve+ut]||(U[ve+ut]=[]),U[ve+ut][we]=ut==0?G:Xa(G);--_t>0;)U[ve+ut][we+_t]=Xa(G);else for(U[sr({r:ve+ut,c:we})]=G;--_t>0;)U[sr({r:ve+ut,c:we+_t})]=Xa(G);te.e.c<=we&&(te.e.c=we)}_t=parseInt(ie["number-columns-repeated"]||"1",10),we+=_t-1,_t=0,G={},pe="",me=[]}qe={};break;case"document":case"document-content":case"":case"spreadsheet":case"":case"scripts":case"styles":case"font-face-decls":case"master-styles":if(N[1]==="/"){if((m=h.pop())[0]!==N[3])throw"Bad state: "+m}else N[0].charAt(N[0].length-2)!=="/"&&h.push([N[3],!0]);break;case"annotation":if(N[1]==="/"){if((m=h.pop())[0]!==N[3])throw"Bad state: "+m;ue.t=pe,me.length&&(ue.R=me),ue.a=be,Dt.push(ue)}else N[0].charAt(N[0].length-2)!=="/"&&h.push([N[3],!1]);be="",Te=0,pe="",Y=0,me=[];break;case"creator":N[1]==="/"?be=c.slice(Te,N.index):Te=N.index+N[0].length;break;case"meta":case"":case"settings":case"config-item-set":case"config-item-map-indexed":case"config-item-map-entry":case"config-item-map-named":case"shapes":case"frame":case"text-box":case"image":case"data-pilot-tables":case"list-style":case"form":case"dde-links":case"event-listeners":case"chart":if(N[1]==="/"){if((m=h.pop())[0]!==N[3])throw"Bad state: "+m}else N[0].charAt(N[0].length-2)!=="/"&&h.push([N[3],!1]);pe="",Y=0,me=[];break;case"scientific-number":break;case"currency-symbol":break;case"currency-style":break;case"number-style":case"percentage-style":case"date-style":case"time-style":if(N[1]==="/"){if(Ce[o.name]=S,(m=h.pop())[0]!==N[3])throw"Bad state: "+m}else N[0].charAt(N[0].length-2)!=="/"&&(S="",o=rr(N[0],!1),h.push([N[3],!0]));break;case"script":break;case"libraries":break;case"automatic-styles":break;case"default-style":case"page-layout":break;case"style":break;case"map":break;case"font-face":break;case"paragraph-properties":break;case"table-properties":break;case"table-column-properties":break;case"table-row-properties":break;case"table-cell-properties":break;case"number":switch(h[h.length-1][0]){case"time-style":case"date-style":x=rr(N[0],!1),S+=og[N[3]][x.style==="long"?1:0];break}break;case"fraction":break;case"day":case"month":case"year":case"era":case"day-of-week":case"week-of-year":case"quarter":case"hours":case"minutes":case"seconds":case"am-pm":switch(h[h.length-1][0]){case"time-style":case"date-style":x=rr(N[0],!1),S+=og[N[3]][x.style==="long"?1:0];break}break;case"boolean-style":break;case"boolean":break;case"text-style":break;case"text":if(N[0].slice(-2)==="/>")break;if(N[1]==="/")switch(h[h.length-1][0]){case"number-style":case"date-style":case"time-style":S+=c.slice(b,N.index);break}else b=N.index+N[0].length;break;case"named-range":x=rr(N[0],!1),$t=l0(x["cell-range-address"]);var rt={Name:x.name,Ref:$t[0]+"!"+$t[1]};Ye&&(rt.Sheet=z.length),ir.Names.push(rt);break;case"text-content":break;case"text-properties":break;case"embedded-text":break;case"body":case"":break;case"forms":break;case"table-column":break;case"table-header-rows":break;case"table-rows":break;case"table-column-group":break;case"table-header-columns":break;case"table-columns":break;case"null-date":break;case"graphic-properties":break;case"calculation-settings":break;case"named-expressions":break;case"label-range":break;case"label-ranges":break;case"named-expression":break;case"sort":break;case"sort-by":break;case"sort-groups":break;case"tab":break;case"line-break":break;case"span":break;case"p":case"":if(["master-styles"].indexOf(h[h.length-1][0])>-1)break;if(N[1]==="/"&&(!ie||!ie["string-value"])){var Yt=H3(c.slice(Y,N.index));pe=(pe.length>0?pe+`
`:"")+Yt[0]}else rr(N[0],!1),Y=N.index+N[0].length;break;case"s":break;case"database-range":if(N[1]==="/")break;try{$t=l0(rr(N[0])["target-range-address"]),L[$t[0]]["!autofilter"]={ref:$t[1]}}catch{}break;case"date":break;case"object":break;case"title":case"":break;case"desc":break;case"binary-data":break;case"table-source":break;case"scenario":break;case"iteration":break;case"content-validations":break;case"content-validation":break;case"help-message":break;case"error-message":break;case"database-ranges":break;case"filter":break;case"filter-and":break;case"filter-or":break;case"filter-condition":break;case"list-level-style-bullet":break;case"list-level-style-number":break;case"list-level-properties":break;case"sender-firstname":case"sender-lastname":case"sender-initials":case"sender-title":case"sender-position":case"sender-email":case"sender-phone-private":case"sender-fax":case"sender-company":case"sender-phone-work":case"sender-street":case"sender-city":case"sender-postal-code":case"sender-country":case"sender-state-or-province":case"author-name":case"author-initials":case"chapter":case"file-name":case"template-name":case"sheet-name":break;case"event-listener":break;case"initial-creator":case"creation-date":case"print-date":case"generator":case"document-statistic":case"user-defined":case"editing-duration":case"editing-cycles":break;case"config-item":break;case"page-number":break;case"page-count":break;case"time":break;case"cell-range-source":break;case"detective":break;case"operation":break;case"highlighted-range":break;case"data-pilot-table":case"source-cell-range":case"source-service":case"data-pilot-field":case"data-pilot-level":case"data-pilot-subtotals":case"data-pilot-subtotal":case"data-pilot-members":case"data-pilot-member":case"data-pilot-display-info":case"data-pilot-sort-info":case"data-pilot-layout-info":case"data-pilot-field-reference":case"data-pilot-groups":case"data-pilot-group":case"data-pilot-group-member":break;case"rect":break;case"dde-connection-decls":case"dde-connection-decl":case"dde-link":case"dde-source":break;case"properties":break;case"property":break;case"a":if(N[1]!=="/"){if(qe=rr(N[0],!1),!qe.href)break;qe.Target=Er(qe.href),delete qe.href,qe.Target.charAt(0)=="#"&&qe.Target.indexOf(".")>-1?($t=l0(qe.Target.slice(1)),qe.Target="#"+$t[0]+"!"+$t[1]):qe.Target.match(/^\.\.[\\\/]/)&&(qe.Target=qe.Target.slice(3))}break;case"table-protection":break;case"data-pilot-grand-total":break;case"office-document-common-attrs":break;default:switch(N[2]){case"dc:":case"calcext:":case"loext:":case"ooo:":case"chartooo:":case"draw:":case"style:":case"chart:":case"form:":case"uof:":case":":case":":break;default:if(i.WTF)throw new Error(N)}}var xe={Sheets:L,SheetNames:z,Workbook:ir};return i.bookSheets&&delete xe.Sheets,xe}function lg(e,n){n=n||{},rn(e,"META-INF/manifest.xml")&&oT(Ta(e,"META-INF/manifest.xml"),n);var i=ji(e,"content.xml");if(!i)throw new Error("Missing content.xml in ODS / UOF file");var c=fx(jr(i),n);return rn(e,"meta.xml")&&(c.Props=S1(Ta(e,"meta.xml"))),c}function cg(e,n){return fx(e,n)}/*! sheetjs (C) 2013-present SheetJS -- http://sheetjs.com */function ed(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function S0(e){return typeof TextDecoder<"u"?new TextDecoder().decode(e):jr(xo(e))}function k0(e){var n=e.reduce(function(h,m){return h+m.length},0),i=new Uint8Array(n),c=0;return e.forEach(function(h){i.set(h,c),c+=h.length}),i}function hg(e){return e-=e>>1&1431655765,e=(e&858993459)+(e>>2&858993459),(e+(e>>4)&252645135)*16843009>>>24}function q3(e,n){for(var i=(e[n+15]&127)<<7|e[n+14]>>1,c=e[n+14]&1,h=n+13;h>=n;--h)c=c*256+e[h];return(e[n+15]&128?-c:c)*Math.pow(10,i-6176)}function Wc(e,n){var i=n?n[0]:0,c=e[i]&127;e:if(e[i++]>=128&&(c|=(e[i]&127)<<7,e[i++]<128||(c|=(e[i]&127)<<14,e[i++]<128)||(c|=(e[i]&127)<<21,e[i++]<128)||(c+=(e[i]&127)*Math.pow(2,28),++i,e[i++]<128)||(c+=(e[i]&127)*Math.pow(2,35),++i,e[i++]<128)||(c+=(e[i]&127)*Math.pow(2,42),++i,e[i++]<128)))break e;return n&&(n[0]=i),c}function Ma(e){var n=0,i=e[n]&127;e:if(e[n++]>=128){if(i|=(e[n]&127)<<7,e[n++]<128||(i|=(e[n]&127)<<14,e[n++]<128)||(i|=(e[n]&127)<<21,e[n++]<128))break e;i|=(e[n]&127)<<28}return i}function ci(e){for(var n=[],i=[0];i[0]<e.length;){var c=i[0],h=Wc(e,i),m=h&7;h=Math.floor(h/8);var x=0,o;if(h==0)break;switch(m){case 0:{for(var S=i[0];e[i[0]++]>=128;);o=e.slice(S,i[0])}break;case 5:x=4,o=e.slice(i[0],i[0]+x),i[0]+=x;break;case 1:x=8,o=e.slice(i[0],i[0]+x),i[0]+=x;break;case 2:x=Wc(e,i),o=e.slice(i[0],i[0]+x),i[0]+=x;break;case 3:case 4:default:throw new Error("PB Type ".concat(m," for Field ").concat(h," at offset ").concat(c))}var b={data:o,type:m};n[h]==null?n[h]=[b]:n[h].push(b)}return n}function td(e,n){return e?.map(function(i){return n(i.data)})||[]}function W3(e){for(var n,i=[],c=[0];c[0]<e.length;){var h=Wc(e,c),m=ci(e.slice(c[0],c[0]+h));c[0]+=h;var x={id:Ma(m[1][0].data),messages:[]};m[2].forEach(function(o){var S=ci(o.data),b=Ma(S[3][0].data);x.messages.push({meta:S,data:e.slice(c[0],c[0]+b)}),c[0]+=b}),(n=m[3])!=null&&n[0]&&(x.merge=Ma(m[3][0].data)>>>0>0),i.push(x)}return i}function Z3(e,n){if(e!=0)throw new Error("Unexpected Snappy chunk type ".concat(e));for(var i=[0],c=Wc(n,i),h=[];i[0]<n.length;){var m=n[i[0]]&3;if(m==0){var x=n[i[0]++]>>2;if(x<60)++x;else{var o=x-59;x=n[i[0]],o>1&&(x|=n[i[0]+1]<<8),o>2&&(x|=n[i[0]+2]<<16),o>3&&(x|=n[i[0]+3]<<24),x>>>=0,x++,i[0]+=o}h.push(n.slice(i[0],i[0]+x)),i[0]+=x;continue}else{var S=0,b=0;if(m==1?(b=(n[i[0]]>>2&7)+4,S=(n[i[0]++]&224)<<3,S|=n[i[0]++]):(b=(n[i[0]++]>>2)+1,m==2?(S=n[i[0]]|n[i[0]+1]<<8,i[0]+=2):(S=(n[i[0]]|n[i[0]+1]<<8|n[i[0]+2]<<16|n[i[0]+3]<<24)>>>0,i[0]+=4)),h=[k0(h)],S==0)throw new Error("Invalid offset 0");if(S>h[0].length)throw new Error("Invalid offset beyond length");if(b>=S)for(h.push(h[0].slice(-S)),b-=S;b>=h[h.length-1].length;)h.push(h[h.length-1]),b-=h[h.length-1].length;h.push(h[0].slice(-S,-S+b))}}var C=k0(h);if(C.length!=c)throw new Error("Unexpected length: ".concat(C.length," != ").concat(c));return C}function X3(e){for(var n=[],i=0;i<e.length;){var c=e[i++],h=e[i]|e[i+1]<<8|e[i+2]<<16;i+=3,n.push(Z3(c,e.slice(i,i+h))),i+=h}if(i!==e.length)throw new Error("data is not a valid framed stream!");return k0(n)}function K3(e,n,i,c){var h=ed(e),m=h.getUint32(4,!0),x=(c>1?12:8)+hg(m&(c>1?3470:398))*4,o=-1,S=-1,b=NaN,C=new Date(2001,0,1);m&512&&(o=h.getUint32(x,!0),x+=4),x+=hg(m&(c>1?12288:4096))*4,m&16&&(S=h.getUint32(x,!0),x+=4),m&32&&(b=h.getFloat64(x,!0),x+=8),m&64&&(C.setTime(C.getTime()+h.getFloat64(x,!0)*1e3),x+=8);var M;switch(e[2]){case 0:break;case 2:M={t:"n",v:b};break;case 3:M={t:"s",v:n[S]};break;case 5:M={t:"d",v:C};break;case 6:M={t:"b",v:b>0};break;case 7:M={t:"n",v:b/86400};break;case 8:M={t:"e",v:0};break;case 9:if(o>-1)M={t:"s",v:i[o]};else if(S>-1)M={t:"s",v:n[S]};else if(!isNaN(b))M={t:"n",v:b};else throw new Error("Unsupported cell type ".concat(e.slice(0,4)));break;default:throw new Error("Unsupported cell type ".concat(e.slice(0,4)))}return M}function Y3(e,n,i){var c=ed(e),h=c.getUint32(8,!0),m=12,x=-1,o=-1,S=NaN,b=NaN,C=new Date(2001,0,1);h&1&&(S=q3(e,m),m+=16),h&2&&(b=c.getFloat64(m,!0),m+=8),h&4&&(C.setTime(C.getTime()+c.getFloat64(m,!0)*1e3),m+=8),h&8&&(o=c.getUint32(m,!0),m+=4),h&16&&(x=c.getUint32(m,!0),m+=4);var M;switch(e[1]){case 0:break;case 2:M={t:"n",v:S};break;case 3:M={t:"s",v:n[o]};break;case 5:M={t:"d",v:C};break;case 6:M={t:"b",v:b>0};break;case 7:M={t:"n",v:b/86400};break;case 8:M={t:"e",v:0};break;case 9:if(x>-1)M={t:"s",v:i[x]};else throw new Error("Unsupported cell type ".concat(e[1]," : ").concat(h&31," : ").concat(e.slice(0,4)));break;case 10:M={t:"n",v:S};break;default:throw new Error("Unsupported cell type ".concat(e[1]," : ").concat(h&31," : ").concat(e.slice(0,4)))}return M}function J3(e,n,i){switch(e[0]){case 0:case 1:case 2:case 3:return K3(e,n,i,e[0]);case 5:return Y3(e,n,i);default:throw new Error("Unsupported payload version ".concat(e[0]))}}function Ms(e){var n=ci(e);return Wc(n[1][0].data)}function ug(e,n){var i=ci(n.data),c=Ma(i[1][0].data),h=i[3],m=[];return(h||[]).forEach(function(x){var o=ci(x.data),S=Ma(o[1][0].data)>>>0;switch(c){case 1:m[S]=S0(o[3][0].data);break;case 8:{var b=e[Ms(o[9][0].data)][0],C=ci(b.data),M=e[Ms(C[1][0].data)][0],L=Ma(M.meta[1][0].data);if(L!=2001)throw new Error("2000 unexpected reference to ".concat(L));var z=ci(M.data);m[S]=z[3].map(function(U){return S0(U.data)}).join("")}break}}),m}function Q3(e,n){var i,c,h,m,x,o,S,b,C,M,L,z,U,N,G=ci(e),ie=Ma(G[1][0].data)>>>0,pe=Ma(G[2][0].data)>>>0,Y=((c=(i=G[8])==null?void 0:i[0])==null?void 0:c.data)&&Ma(G[8][0].data)>0||!1,me,ve;if((m=(h=G[7])==null?void 0:h[0])!=null&&m.data&&n!=0)me=(o=(x=G[7])==null?void 0:x[0])==null?void 0:o.data,ve=(b=(S=G[6])==null?void 0:S[0])==null?void 0:b.data;else if((M=(C=G[4])==null?void 0:C[0])!=null&&M.data&&n!=1)me=(z=(L=G[4])==null?void 0:L[0])==null?void 0:z.data,ve=(N=(U=G[3])==null?void 0:U[0])==null?void 0:N.data;else throw"NUMBERS Tile missing ".concat(n," cell storage");for(var we=Y?4:1,te=ed(me),Be=[],Ce=0;Ce<me.length/2;++Ce){var Ue=te.getUint16(Ce*2,!0);Ue<65535&&Be.push([Ce,Ue])}if(Be.length!=pe)throw"Expected ".concat(pe," cells, found ").concat(Be.length);var $e=[];for(Ce=0;Ce<Be.length-1;++Ce)$e[Be[Ce][0]]=ve.subarray(Be[Ce][1]*we,Be[Ce+1][1]*we);return Be.length>=1&&($e[Be[Be.length-1][0]]=ve.subarray(Be[Be.length-1][1]*we)),{R:ie,cells:$e}}function eA(e,n){var i,c=ci(n.data),h=(i=c?.[7])!=null&&i[0]?Ma(c[7][0].data)>>>0>0?1:0:-1,m=td(c[5],function(x){return Q3(x,h)});return{nrows:Ma(c[4][0].data)>>>0,data:m.reduce(function(x,o){return x[o.R]||(x[o.R]=[]),o.cells.forEach(function(S,b){if(x[o.R][b])throw new Error("Duplicate cell r=".concat(o.R," c=").concat(b));x[o.R][b]=S}),x},[])}}function tA(e,n,i){var c,h=ci(n.data),m={s:{r:0,c:0},e:{r:0,c:0}};if(m.e.r=(Ma(h[6][0].data)>>>0)-1,m.e.r<0)throw new Error("Invalid row varint ".concat(h[6][0].data));if(m.e.c=(Ma(h[7][0].data)>>>0)-1,m.e.c<0)throw new Error("Invalid col varint ".concat(h[7][0].data));i["!ref"]=Tr(m);var x=ci(h[4][0].data),o=ug(e,e[Ms(x[4][0].data)][0]),S=(c=x[17])!=null&&c[0]?ug(e,e[Ms(x[17][0].data)][0]):[],b=ci(x[3][0].data),C=0;b[1].forEach(function(M){var L=ci(M.data),z=e[Ms(L[2][0].data)][0],U=Ma(z.meta[1][0].data);if(U!=6002)throw new Error("6001 unexpected reference to ".concat(U));var N=eA(e,z);N.data.forEach(function(G,ie){G.forEach(function(pe,Y){var me=sr({r:C+ie,c:Y}),ve=J3(pe,o,S);ve&&(i[me]=ve)})}),C+=N.nrows})}function rA(e,n){var i=ci(n.data),c={"!ref":"A1"},h=e[Ms(i[2][0].data)],m=Ma(h[0].meta[1][0].data);if(m!=6001)throw new Error("6000 unexpected reference to ".concat(m));return tA(e,h[0],c),c}function aA(e,n){var i,c=ci(n.data),h={name:(i=c[1])!=null&&i[0]?S0(c[1][0].data):"",sheets:[]},m=td(c[2],Ms);return m.forEach(function(x){e[x].forEach(function(o){var S=Ma(o.meta[1][0].data);S==6e3&&h.sheets.push(rA(e,o))})}),h}function iA(e,n){var i=id(),c=ci(n.data),h=td(c[1],Ms);if(h.forEach(function(m){e[m].forEach(function(x){var o=Ma(x.meta[1][0].data);if(o==2){var S=aA(e,x);S.sheets.forEach(function(b,C){nd(i,b,C==0?S.name:S.name+"_"+C,!0)})}})}),i.SheetNames.length==0)throw new Error("Empty NUMBERS file");return i}function h0(e){var n,i,c,h,m={},x=[];if(e.FullPaths.forEach(function(S){if(S.match(/\.iwpv2/))throw new Error("Unsupported password protection")}),e.FileIndex.forEach(function(S){if(S.name.match(/\.iwa$/)){var b;try{b=X3(S.content)}catch(M){return console.log("?? "+S.content.length+" "+(M.message||M))}var C;try{C=W3(b)}catch(M){return console.log("## "+(M.message||M))}C.forEach(function(M){m[M.id]=M.messages,x.push(M.id)})}}),!x.length)throw new Error("File has no messages");var o=((h=(c=(i=(n=m?.[1])==null?void 0:n[0])==null?void 0:i.meta)==null?void 0:c[1])==null?void 0:h[0].data)&&Ma(m[1][0].meta[1][0].data)==1&&m[1][0];if(o||x.forEach(function(S){m[S].forEach(function(b){var C=Ma(b.meta[1][0].data)>>>0;if(C==1)if(!o)o=b;else throw new Error("Document has multiple roots")})}),!o)throw new Error("Cannot find Document root");return iA(m,o)}function nA(e){return function(i){for(var c=0;c!=e.length;++c){var h=e[c];i[h[0]]===void 0&&(i[h[0]]=h[1]),h[2]==="n"&&(i[h[0]]=Number(i[h[0]]))}}}function rd(e){nA([["cellNF",!1],["cellHTML",!0],["cellFormula",!0],["cellStyles",!1],["cellText",!0],["cellDates",!1],["sheetStubs",!1],["sheetRows",0,"n"],["bookDeps",!1],["bookSheets",!1],["bookProps",!1],["bookFiles",!1],["bookVBA",!1],["password",""],["WTF",!1]])(e)}function sA(e){return cl.WS.indexOf(e)>-1?"sheet":e==cl.CS?"chart":e==cl.DS?"dialog":e==cl.MS?"macro":e&&e.length?e:"sheet"}function oA(e,n){if(!e)return 0;try{e=n.map(function(c){return c.id||(c.id=c.strRelID),[c.name,e["!id"][c.id].Target,sA(e["!id"][c.id].Type)]})}catch{return null}return!e||e.length===0?null:e}function lA(e,n,i,c,h,m,x,o,S,b,C,M){try{m[c]=Rc(ji(e,i,!0),n);var L=Ta(e,n),z;switch(o){case"sheet":z=p3(L,n,h,S,m[c],b,C,M);break;case"chart":if(z=m3(L,n,h,S,m[c],b,C,M),!z||!z["!drawel"])break;var U=Fc(z["!drawel"].Target,n),N=v0(U),G=dk(ji(e,U,!0),Rc(ji(e,N,!0),U)),ie=Fc(G,U),pe=v0(ie);z=YC(ji(e,ie,!0),ie,S,Rc(ji(e,pe,!0),ie),b,z);break;case"macro":z=g3(L,n,h,S,m[c],b,C,M);break;case"dialog":z=x3(L,n,h,S,m[c],b,C,M);break;default:throw new Error("Unrecognized sheet type "+o)}x[c]=z;var Y=[];m&&m[c]&&On(m[c]).forEach(function(me){var ve="";if(m[c][me].Type==cl.CMNT){ve=Fc(m[c][me].Target,n);var we=w3(Ta(e,ve,!0),ve,S);if(!we||!we.length)return;Km(z,we,!1)}m[c][me].Type==cl.TCMNT&&(ve=Fc(m[c][me].Target,n),Y=Y.concat(mk(Ta(e,ve,!0),S)))}),Y&&Y.length&&Km(z,Y,!0,S.people||[])}catch(me){if(S.WTF)throw me}}function en(e){return e.charAt(0)=="/"?e.slice(1):e}function cA(e,n){if(Xg(),n=n||{},rd(n),rn(e,"META-INF/manifest.xml")||rn(e,"objectdata.xml"))return lg(e,n);if(rn(e,"Index/Document.iwa")){if(typeof Uint8Array>"u")throw new Error("NUMBERS file parsing requires Uint8Array support");if(typeof h0<"u"){if(e.FileIndex)return h0(e);var i=br.utils.cfb_new();return Tm(e).forEach(function(pt){hb(i,pt,t1(e,pt))}),h0(i)}throw new Error("Unsupported NUMBERS file")}if(!rn(e,"[Content_Types].xml"))throw rn(e,"index.xml.gz")?new Error("Unsupported NUMBERS 08 file"):rn(e,"index.xml")?new Error("Unsupported NUMBERS 09 file"):new Error("Unsupported ZIP file");var c=Tm(e),h=nT(ji(e,"[Content_Types].xml")),m=!1,x,o;if(h.workbooks.length===0&&(o="xl/workbook.xml",Ta(e,o,!0)&&h.workbooks.push(o)),h.workbooks.length===0){if(o="xl/workbook.bin",!Ta(e,o,!0))throw new Error("Could not find workbook");h.workbooks.push(o),m=!0}h.workbooks[0].slice(-3)=="bin"&&(m=!0);var S={},b={};if(!n.bookSheets&&!n.bookProps){if(zc=[],h.sst)try{zc=v3(Ta(e,en(h.sst)),h.sst,n)}catch(pt){if(n.WTF)throw pt}n.cellStyles&&h.themes.length&&(S=y3(ji(e,h.themes[0].replace(/^\//,""),!0)||"",h.themes[0],n)),h.style&&(b=_3(Ta(e,en(h.style)),h.style,S,n))}h.links.map(function(pt){try{var ot=Rc(ji(e,v0(en(pt))),pt);return T3(Ta(e,en(pt)),ot,pt,n)}catch{}});var C=d3(Ta(e,en(h.workbooks[0])),h.workbooks[0],n),M={},L="";h.coreprops.length&&(L=Ta(e,en(h.coreprops[0]),!0),L&&(M=S1(L)),h.extprops.length!==0&&(L=Ta(e,en(h.extprops[0]),!0),L&&hT(L,M,n)));var z={};(!n.bookSheets||n.bookProps)&&h.custprops.length!==0&&(L=ji(e,en(h.custprops[0]),!0),L&&(z=fT(L,n)));var U={};if((n.bookSheets||n.bookProps)&&(C.Sheets?x=C.Sheets.map(function(ot){return ot.name}):M.Worksheets&&M.SheetNames.length>0&&(x=M.SheetNames),n.bookProps&&(U.Props=M,U.Custprops=z),n.bookSheets&&typeof x<"u"&&(U.SheetNames=x),n.bookSheets?U.SheetNames:n.bookProps))return U;x={};var N={};n.bookDeps&&h.calcchain&&(N=b3(Ta(e,en(h.calcchain)),h.calcchain));var G=0,ie={},pe,Y;{var me=C.Sheets;M.Worksheets=me.length,M.SheetNames=[];for(var ve=0;ve!=me.length;++ve)M.SheetNames[ve]=me[ve].name}var we=m?"bin":"xml",te=h.workbooks[0].lastIndexOf("/"),Be=(h.workbooks[0].slice(0,te+1)+"_rels/"+h.workbooks[0].slice(te+1)+".rels").replace(/^\//,"");rn(e,Be)||(Be="xl/_rels/workbook."+we+".rels");var Ce=Rc(ji(e,Be,!0),Be.replace(/_rels.*/,"s5s"));(h.metadata||[]).length>=1&&(n.xlmeta=E3(Ta(e,en(h.metadata[0])),h.metadata[0],n)),(h.people||[]).length>=1&&(n.people=gk(Ta(e,en(h.people[0])),n)),Ce&&(Ce=oA(Ce,C.Sheets));var Ue=Ta(e,"xl/worksheets/sheet.xml",!0)?1:0;e:for(G=0;G!=M.Worksheets;++G){var $e="sheet";if(Ce&&Ce[G]?(pe="xl/"+Ce[G][1].replace(/[\/]?xl\//,""),rn(e,pe)||(pe=Ce[G][1]),rn(e,pe)||(pe=Be.replace(/_rels\/.*$/,"")+Ce[G][1]),$e=Ce[G][2]):(pe="xl/worksheets/sheet"+(G+1-Ue)+"."+we,pe=pe.replace(/sheet0\./,"sheet.")),Y=pe.replace(/^(.*)(\/)([^\/]*)$/,"$1/_rels/$3.rels"),n&&n.sheets!=null)switch(typeof n.sheets){case"number":if(G!=n.sheets)continue e;break;case"string":if(M.SheetNames[G].toLowerCase()!=n.sheets.toLowerCase())continue e;break;default:if(Array.isArray&&Array.isArray(n.sheets)){for(var Re=!1,st=0;st!=n.sheets.length;++st)typeof n.sheets[st]=="number"&&n.sheets[st]==G&&(Re=1),typeof n.sheets[st]=="string"&&n.sheets[st].toLowerCase()==M.SheetNames[G].toLowerCase()&&(Re=1);if(!Re)continue e}}lA(e,pe,Y,M.SheetNames[G],G,ie,x,$e,n,C,S,b)}return U={Directory:h,Workbook:C,Props:M,Custprops:z,Deps:N,Sheets:x,SheetNames:M.SheetNames,Strings:zc,Styles:b,Themes:S,SSF:Xa(hr)},n&&n.bookFiles&&(e.files?(U.keys=c,U.files=e.files):(U.keys=[],U.files={},e.FullPaths.forEach(function(pt,ot){pt=pt.replace(/^Root Entry[\/]/,""),U.keys.push(pt),U.files[pt]=e.FileIndex[ot]}))),n&&n.bookVBA&&(h.vba.length>0?U.vbaraw=Ta(e,en(h.vba[0]),!0):h.defaults&&h.defaults.bin===vk&&(U.vbaraw=Ta(e,"xl/vbaProject.bin",!0))),U}function hA(e,n){var i=n||{},c="Workbook",h=br.find(e,c);try{if(c="/!DataSpaces/Version",h=br.find(e,c),!h||!h.content)throw new Error("ECMA-376 Encrypted file missing "+c);if(rS(h.content),c="/!DataSpaces/DataSpaceMap",h=br.find(e,c),!h||!h.content)throw new Error("ECMA-376 Encrypted file missing "+c);var m=iS(h.content);if(m.length!==1||m[0].comps.length!==1||m[0].comps[0].t!==0||m[0].name!=="StrongEncryptionDataSpace"||m[0].comps[0].v!=="EncryptedPackage")throw new Error("ECMA-376 Encrypted file bad "+c);if(c="/!DataSpaces/DataSpaceInfo/StrongEncryptionDataSpace",h=br.find(e,c),!h||!h.content)throw new Error("ECMA-376 Encrypted file missing "+c);var x=nS(h.content);if(x.length!=1||x[0]!="StrongEncryptionTransform")throw new Error("ECMA-376 Encrypted file bad "+c);if(c="/!DataSpaces/TransformInfo/StrongEncryptionTransform/!Primary",h=br.find(e,c),!h||!h.content)throw new Error("ECMA-376 Encrypted file missing "+c);oS(h.content)}catch{}if(c="/EncryptionInfo",h=br.find(e,c),!h||!h.content)throw new Error("ECMA-376 Encrypted file missing "+c);var o=lS(h.content);if(c="/EncryptedPackage",h=br.find(e,c),!h||!h.content)throw new Error("ECMA-376 Encrypted file missing "+c);if(o[0]==4&&typeof decrypt_agile<"u")return decrypt_agile(o[1],h.content,i.password||"",i);if(o[0]==2&&typeof decrypt_std76<"u")return decrypt_std76(o[1],h.content,i.password||"",i);throw new Error("File is password-protected")}function ad(e,n){var i="";switch((n||{}).type||"base64"){case"buffer":return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]];case"base64":i=Gi(e.slice(0,12));break;case"binary":i=e;break;case"array":return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]];default:throw new Error("Unrecognized type "+(n&&n.type||"undefined"))}return[i.charCodeAt(0),i.charCodeAt(1),i.charCodeAt(2),i.charCodeAt(3),i.charCodeAt(4),i.charCodeAt(5),i.charCodeAt(6),i.charCodeAt(7)]}function uA(e,n){return br.find(e,"EncryptedPackage")?hA(e,n):cx(e,n)}function fA(e,n){var i,c=e,h=n||{};return h.type||(h.type=vr&&Buffer.isBuffer(e)?"buffer":"base64"),i=r1(c,h),cA(i,h)}function dx(e,n){var i=0;e:for(;i<e.length;)switch(e.charCodeAt(i)){case 10:case 13:case 32:++i;break;case 60:return T0(e.slice(i),n);default:break e}return Gc.to_workbook(e,n)}function dA(e,n){var i="",c=ad(e,n);switch(n.type){case"base64":i=Gi(e);break;case"binary":i=e;break;case"buffer":i=e.toString("binary");break;case"array":i=fo(e);break;default:throw new Error("Unrecognized type "+n.type)}return c[0]==239&&c[1]==187&&c[2]==191&&(i=jr(i)),n.type="binary",dx(i,n)}function pA(e,n){var i=e;return n.type=="base64"&&(i=Gi(i)),i=Cs.utils.decode(1200,i.slice(2),"str"),n.type="binary",dx(i,n)}function mA(e){return e.match(/[^\x00-\x7F]/)?Pc(e):e}function u0(e,n,i,c){return c?(i.type="string",Gc.to_workbook(e,i)):Gc.to_workbook(n,i)}function C0(e,n){Bg();var i=n||{};if(typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer)return C0(new Uint8Array(e),(i=Xa(i),i.type="array",i));typeof Uint8Array<"u"&&e instanceof Uint8Array&&!i.type&&(i.type=typeof Deno<"u"?"buffer":"array");var c=e,h=[0,0,0,0],m=!1;if(i.cellStyles&&(i.cellNF=!0,i.sheetStubs=!0),fl={},i.dateNF&&(fl.dateNF=i.dateNF),i.type||(i.type=vr&&Buffer.isBuffer(e)?"buffer":"base64"),i.type=="file"&&(i.type=vr?"buffer":"binary",c=ab(e),typeof Uint8Array<"u"&&!vr&&(i.type="array")),i.type=="string"&&(m=!0,i.type="binary",i.codepage=65001,c=mA(e)),i.type=="array"&&typeof Uint8Array<"u"&&e instanceof Uint8Array&&typeof ArrayBuffer<"u"){var x=new ArrayBuffer(3),o=new Uint8Array(x);if(o.foo="bar",!o.foo)return i=Xa(i),i.type="array",C0(R0(c),i)}switch((h=ad(c,i))[0]){case 208:if(h[1]===207&&h[2]===17&&h[3]===224&&h[4]===161&&h[5]===177&&h[6]===26&&h[7]===225)return uA(br.read(c,i),i);break;case 9:if(h[1]<=8)return cx(c,i);break;case 60:return T0(c,i);case 73:if(h[1]===73&&h[2]===42&&h[3]===0)throw new Error("TIFF Image File is not a spreadsheet");if(h[1]===68)return jE(c,i);break;case 84:if(h[1]===65&&h[2]===66&&h[3]===76)return VE.to_workbook(c,i);break;case 80:return h[1]===75&&h[2]<9&&h[3]<9?fA(c,i):u0(e,c,i,m);case 239:return h[3]===60?T0(c,i):u0(e,c,i,m);case 255:if(h[1]===254)return pA(c,i);if(h[1]===0&&h[2]===2&&h[3]===0)return Bc.to_workbook(c,i);break;case 0:if(h[1]===0&&(h[2]>=2&&h[3]===0||h[2]===0&&(h[3]===8||h[3]===9)))return Bc.to_workbook(c,i);break;case 3:case 131:case 139:case 140:return Xm.to_workbook(c,i);case 123:if(h[1]===92&&h[2]===114&&h[3]===116)return vS.to_workbook(c,i);break;case 10:case 13:case 32:return dA(c,i);case 137:if(h[1]===80&&h[2]===78&&h[3]===71)throw new Error("PNG Image File is not a spreadsheet");break}return NE.indexOf(h[0])>-1&&h[2]<=12&&h[3]<=31?Xm.to_workbook(c,i):u0(e,c,i,m)}function gA(e,n,i,c,h,m,x,o){var S=Ka(i),b=o.defval,C=o.raw||!Object.prototype.hasOwnProperty.call(o,"raw"),M=!0,L=h===1?[]:{};if(h!==1)if(Object.defineProperty)try{Object.defineProperty(L,"__rowNum__",{value:i,enumerable:!1})}catch{L.__rowNum__=i}else L.__rowNum__=i;if(!x||e[i])for(var z=n.s.c;z<=n.e.c;++z){var U=x?e[i][z]:e[c[z]+S];if(U===void 0||U.t===void 0){if(b===void 0)continue;m[z]!=null&&(L[m[z]]=b);continue}var N=U.v;switch(U.t){case"z":if(N==null)break;continue;case"e":N=N==0?null:void 0;break;case"s":case"d":case"b":case"n":break;default:throw new Error("unrecognized type "+U.t)}if(m[z]!=null){if(N==null)if(U.t=="e"&&N===null)L[m[z]]=null;else if(b!==void 0)L[m[z]]=b;else if(C&&N===null)L[m[z]]=null;else continue;else L[m[z]]=C&&(U.t!=="n"||U.t==="n"&&o.rawNumbers!==!1)?N:ns(U,N,o);N!=null&&(M=!1)}}return{row:L,isempty:M}}function A0(e,n){if(e==null||e["!ref"]==null)return[];var i={t:"n",v:0},c=0,h=1,m=[],x=0,o="",S={s:{r:0,c:0},e:{r:0,c:0}},b=n||{},C=b.range!=null?b.range:e["!ref"];switch(b.header===1?c=1:b.header==="A"?c=2:Array.isArray(b.header)?c=3:b.header==null&&(c=0),typeof C){case"string":S=ha(C);break;case"number":S=ha(e["!ref"]),S.s.r=C;break;default:S=C}c>0&&(h=0);var M=Ka(S.s.r),L=[],z=[],U=0,N=0,G=Array.isArray(e),ie=S.s.r,pe=0,Y={};G&&!e[ie]&&(e[ie]=[]);var me=b.skipHidden&&e["!cols"]||[],ve=b.skipHidden&&e["!rows"]||[];for(pe=S.s.c;pe<=S.e.c;++pe)if(!(me[pe]||{}).hidden)switch(L[pe]=Pa(pe),i=G?e[ie][pe]:e[L[pe]+M],c){case 1:m[pe]=pe-S.s.c;break;case 2:m[pe]=L[pe];break;case 3:m[pe]=b.header[pe-S.s.c];break;default:if(i==null&&(i={w:"__EMPTY",t:"s"}),o=x=ns(i,null,b),N=Y[x]||0,!N)Y[x]=1;else{do o=x+"_"+N++;while(Y[o]);Y[x]=N,Y[o]=1}m[pe]=o}for(ie=S.s.r+h;ie<=S.e.r;++ie)if(!(ve[ie]||{}).hidden){var we=gA(e,S,ie,L,c,m,G,b);(we.isempty===!1||(c===1?b.blankrows!==!1:b.blankrows))&&(z[U++]=we.row)}return z.length=U,z}var fg=/"/g;function xA(e,n,i,c,h,m,x,o){for(var S=!0,b=[],C="",M=Ka(i),L=n.s.c;L<=n.e.c;++L)if(c[L]){var z=o.dense?(e[i]||[])[L]:e[c[L]+M];if(z==null)C="";else if(z.v!=null){S=!1,C=""+(o.rawNumbers&&z.t=="n"?z.v:ns(z,null,o));for(var U=0,N=0;U!==C.length;++U)if((N=C.charCodeAt(U))===h||N===m||N===34||o.forceQuotes){C='"'+C.replace(fg,'""')+'"';break}C=="ID"&&(C='"ID"')}else z.f!=null&&!z.F?(S=!1,C="="+z.f,C.indexOf(",")>=0&&(C='"'+C.replace(fg,'""')+'"')):C="";b.push(C)}return o.blankrows===!1&&S?null:b.join(x)}function px(e,n){var i=[],c=n??{};if(e==null||e["!ref"]==null)return"";var h=ha(e["!ref"]),m=c.FS!==void 0?c.FS:",",x=m.charCodeAt(0),o=c.RS!==void 0?c.RS:`
`,S=o.charCodeAt(0),b=new RegExp((m=="|"?"\\|":m)+"+$"),C="",M=[];c.dense=Array.isArray(e);for(var L=c.skipHidden&&e["!cols"]||[],z=c.skipHidden&&e["!rows"]||[],U=h.s.c;U<=h.e.c;++U)(L[U]||{}).hidden||(M[U]=Pa(U));for(var N=0,G=h.s.r;G<=h.e.r;++G)(z[G]||{}).hidden||(C=xA(e,h,G,M,x,S,m,c),C!=null&&(c.strip&&(C=C.replace(b,"")),(C||c.blankrows!==!1)&&i.push((N++?o:"")+C)));return delete c.dense,i.join("")}function _A(e,n){n||(n={}),n.FS="	",n.RS=`
`;var i=px(e,n);return i}function yA(e){var n="",i,c="";if(e==null||e["!ref"]==null)return[];var h=ha(e["!ref"]),m="",x=[],o,S=[],b=Array.isArray(e);for(o=h.s.c;o<=h.e.c;++o)x[o]=Pa(o);for(var C=h.s.r;C<=h.e.r;++C)for(m=Ka(C),o=h.s.c;o<=h.e.c;++o)if(n=x[o]+m,i=b?(e[C]||[])[o]:e[n],c="",i!==void 0){if(i.F!=null){if(n=i.F,!i.f)continue;c=i.f,n.indexOf(":")==-1&&(n=n+":"+n)}if(i.f!=null)c=i.f;else{if(i.t=="z")continue;if(i.t=="n"&&i.v!=null)c=""+i.v;else if(i.t=="b")c=i.v?"TRUE":"FALSE";else if(i.w!==void 0)c="'"+i.w;else{if(i.v===void 0)continue;i.t=="s"?c="'"+i.v:c=""+i.v}}S[S.length]=n+"="+c}return S}function mx(e,n,i){var c=i||{},h=+!c.skipHeader,m=e||{},x=0,o=0;if(m&&c.origin!=null)if(typeof c.origin=="number")x=c.origin;else{var S=typeof c.origin=="string"?Si(c.origin):c.origin;x=S.r,o=S.c}var b,C={s:{c:0,r:0},e:{c:o,r:x+n.length-1+h}};if(m["!ref"]){var M=ha(m["!ref"]);C.e.c=Math.max(C.e.c,M.e.c),C.e.r=Math.max(C.e.r,M.e.r),x==-1&&(x=M.e.r+1,C.e.r=x+n.length-1+h)}else x==-1&&(x=0,C.e.r=n.length-1+h);var L=c.header||[],z=0;n.forEach(function(N,G){On(N).forEach(function(ie){(z=L.indexOf(ie))==-1&&(L[z=L.length]=ie);var pe=N[ie],Y="z",me="",ve=sr({c:o+z,r:x+G+h});b=Zc(m,ve),pe&&typeof pe=="object"&&!(pe instanceof Date)?m[ve]=pe:(typeof pe=="number"?Y="n":typeof pe=="boolean"?Y="b":typeof pe=="string"?Y="s":pe instanceof Date?(Y="d",c.cellDates||(Y="n",pe=Ci(pe)),me=c.dateNF||hr[14]):pe===null&&c.nullError&&(Y="e",pe=0),b?(b.t=Y,b.v=pe,delete b.w,delete b.R,me&&(b.z=me)):m[ve]=b={t:Y,v:pe},me&&(b.z=me))})}),C.e.c=Math.max(C.e.c,o+L.length-1);var U=Ka(x);if(h)for(z=0;z<L.length;++z)m[Pa(z+o)+U]={t:"s",v:L[z]};return m["!ref"]=Tr(C),m}function vA(e,n){return mx(null,e,n)}function Zc(e,n,i){if(typeof n=="string"){if(Array.isArray(e)){var c=Si(n);return e[c.r]||(e[c.r]=[]),e[c.r][c.c]||(e[c.r][c.c]={t:"z"})}return e[n]||(e[n]={t:"z"})}return typeof n!="number"?Zc(e,sr(n)):Zc(e,sr({r:n,c:i||0}))}function wA(e,n){if(typeof n=="number"){if(n>=0&&e.SheetNames.length>n)return n;throw new Error("Cannot find sheet # "+n)}else if(typeof n=="string"){var i=e.SheetNames.indexOf(n);if(i>-1)return i;throw new Error("Cannot find sheet name |"+n+"|")}else throw new Error("Cannot find sheet |"+n+"|")}function id(){return{SheetNames:[],Sheets:{}}}function nd(e,n,i,c){var h=1;if(!i)for(;h<=65535&&e.SheetNames.indexOf(i="Sheet"+h)!=-1;++h,i=void 0);if(!i||e.SheetNames.length>=65535)throw new Error("Too many worksheets");if(c&&e.SheetNames.indexOf(i)>=0){var m=i.match(/(^.*?)(\d+)$/);h=m&&+m[2]||0;var x=m&&m[1]||i;for(++h;h<=65535&&e.SheetNames.indexOf(i=x+h)!=-1;++h);}if(n3(i),e.SheetNames.indexOf(i)>=0)throw new Error("Worksheet with name |"+i+"| already exists!");return e.SheetNames.push(i),e.Sheets[i]=n,i}function bA(e,n,i){e.Workbook||(e.Workbook={}),e.Workbook.Sheets||(e.Workbook.Sheets=[]);var c=wA(e,n);switch(e.Workbook.Sheets[c]||(e.Workbook.Sheets[c]={}),i){case 0:case 1:case 2:break;default:throw new Error("Bad sheet visibility setting "+i)}e.Workbook.Sheets[c].Hidden=i}function TA(e,n){return e.z=n,e}function gx(e,n,i){return n?(e.l={Target:n},i&&(e.l.Tooltip=i)):delete e.l,e}function EA(e,n,i){return gx(e,"#"+n,i)}function SA(e,n,i){e.c||(e.c=[]),e.c.push({t:n,a:i||"SheetJS"})}function kA(e,n,i,c){for(var h=typeof n!="string"?n:ha(n),m=typeof n=="string"?n:Tr(n),x=h.s.r;x<=h.e.r;++x)for(var o=h.s.c;o<=h.e.c;++o){var S=Zc(e,x,o);S.t="n",S.F=m,delete S.v,x==h.s.r&&o==h.s.c&&(S.f=i,c&&(S.D=!0))}return e}var CA={encode_col:Pa,encode_row:Ka,encode_cell:sr,encode_range:Tr,decode_col:G0,decode_row:j0,split_cell:zb,decode_cell:Si,decode_range:yl,format_cell:ns,sheet_add_aoa:v1,sheet_add_json:mx,sheet_add_dom:hx,aoa_to_sheet:vl,json_to_sheet:vA,table_to_sheet:ux,table_to_book:j3,sheet_to_csv:px,sheet_to_txt:_A,sheet_to_json:A0,sheet_to_html:$3,sheet_to_formulae:yA,sheet_to_row_object_array:A0,sheet_get_cell:Zc,book_new:id,book_append_sheet:nd,book_set_sheet_visibility:bA,cell_set_number_format:TA,cell_set_hyperlink:gx,cell_set_internal_link:EA,cell_add_comment:SA,sheet_set_array_formula:kA,consts:{SHEET_VISIBLE:0,SHEET_HIDDEN:1,SHEET_VERY_HIDDEN:2}};function AA({listCustomer:e,handleCustomer:n}){const[i,c]=wu.useMessage(),[h,m]=Se.useState("list"),[x,o]=Se.useState(!1),[S,b]=Se.useState(!1),[C,M]=Se.useState([]),L=me=>{i.open({type:"warning",content:me})},z=(me="error")=>{i.open({type:"error",content:me})},U=(me="Success")=>{i.open({type:"success",content:me})},N=me=>{switch(me){case"Choose":o(!1);break;case"Import":b(!1);break;default:o(!1),b(!1)}},G=me=>{switch(me){case"Choose":o(!0);break;case"Import":b(!0);break}},ie=async me=>{const ve=new FileReader;ve.onload=we=>{const te=new Uint8Array(we.target.result),Be=C0(te,{type:"array"}),Ce=Be.SheetNames[0],Ue=Be.Sheets[Ce],$e=CA.sheet_to_json(Ue);console.log("json_data",$e),M($e)},ve.readAsArrayBuffer(me)},pe=async()=>{const ve=Cg(C,["M khch hng","Th t VT","Tn sut"],{isNull:!1}).map(we=>we["M khch hng"]).filter(we=>!!we&&!e.map(te=>te.customer_code).includes(we));try{const we=await an.post("/api/method/mbw_dms.api.router.get_customer_import",{customer_codes:ve});console.log("rsImport:::",we),n(te=>[...te,...we.result]),L(we.message),b(!1)}catch{z()}},Y=Se.useCallback(async()=>{const me=e.filter(te=>te.longitude&&te.latitude),ve=e.filter(te=>!(te.longitude&&te.latitude)),we=me.map((te,Be)=>({id:Be,customer:te.name,long:te.longitude,lat:te.latitude}));try{const Ce=(await an.post("/api/method/mbw_dms.api.helpers.optimal_router.optimal_router",{locations:we})).result.map(Ue=>me.find(Re=>Re.name==Ue.customer));n([...Ce,...ve]),U()}catch(te){z(te?.response?.data?.message||"Something was wrong")}},[e]);return Ke.jsxs(Ke.Fragment,{children:[c,Ke.jsxs(lo,{gutter:16,className:"justify-between p-4 pb-5 pt-10 mt-0",children:[Ke.jsx(Ti,{children:Ke.jsxs(lo,{gutter:8,children:[Ke.jsx(Ti,{span:9,className:"text-[#1677ff]",children:Ke.jsx(Ri,{children:Ke.jsx(Ry,{defaultValue:"add",options:F2,onSelect:G})})}),Ke.jsx(Ti,{span:7,children:Ke.jsx(oo,{className:"w-full flex items-center text-[#1677ff] bg-[#1877f214] h-[36px]",icon:Ke.jsx(E2,{}),onClick:Y,children:"Ti u tuyn"})}),Ke.jsx(Ti,{span:8,children:Ke.jsx(Ri,{children:Ke.jsx(vu,{placeholder:"Tm kim khch hng",prefix:Ke.jsx(kg,{})})})})]})}),Ke.jsxs(Ti,{children:[" ",Ke.jsxs(Zf.Group,{defaultValue:h,onChange:me=>m(me.target.value),size:"middle",children:[Ke.jsx(Zf.Button,{value:"list",children:Ke.jsx(k2,{size:28})}),Ke.jsx(Zf.Button,{value:"map",children:Ke.jsx(S2,{size:28})})]})]})]}),Ke.jsx("div",{children:h=="list"?Ke.jsx(R2,{data:e,handleData:n}):Ke.jsx(ww,{data:e})}),Ke.jsx(g0,{width:1240,open:x,onCancel:N.bind(null,"Choose"),title:Ke.jsx("strong",{className:"text-xl",children:"Chn khch hng"}),footer:!1,children:Ke.jsx(kw,{selected:e,handleAdd:n,closeModal:o.bind(null,!1)})}),Ke.jsx(g0,{width:777,open:S,onCancel:N.bind(null,"Import"),okText:"Tip tc",cancelText:"Hy",title:Ke.jsxs(Ke.Fragment,{children:[Ke.jsx("strong",{className:"text-xl",children:"Nhp d liu khch hng"}),Ke.jsx("br",{}),Ke.jsxs(oo,{type:"link",className:"px-0",children:["Ti v file mu ",Ke.jsx(Pg,{})]})]}),onOk:pe,children:Ke.jsx(Tw,{handleFile:ie})})]})}function IA(){const[e]=m0.useForm(),n=Oy(),{type:i}=By(),[c,h]=Se.useState([]),[m,x]=wu.useMessage(),[o,S]=Se.useState(),b=()=>{m.open({type:"success",content:"Success!!"})},C=()=>{m.open({type:"error",content:"Something was wrong"})},M=Se.useCallback(async z=>{z={...z,customers:c.map(U=>{let N=["customer_id","customer_code","customer_name","display_address","phone_number","customer","frequency","latitude","longitude"];for(let G in U)N.includes(G)||delete U[G];return U})};try{await an.post("/api/method/mbw_dms.api.router.create_router",z),b(),n("/router-control")}catch(U){C(),console.log("error create",U)}},[c]),L=Se.useCallback(async z=>{z={...z,customers:c.map(U=>{let N=["customer_id","customer_code","customer_name","display_address","phone_number","customer","frequency","lat","long"];for(let G in U)N.includes(G)||delete U[G];return U})};try{await an.patch("/api/method/mbw_dms.api.router.update_router",{name:i,...z}),b(),n("/router-control")}catch(U){C(),console.log("error create",U)}},[c]);return Se.useEffect(()=>{i!=="create-dms-router"&&(async()=>{const z=await an.get("/api/method/mbw_dms.api.router.get_router",{params:{id:i}});S(z.result),z.result&&e.setFieldsValue(z.result),h(z.result?.customers||[])})()},[i]),Ke.jsxs(Ke.Fragment,{children:[x,Ke.jsx(Gy,{title:"Thm tuyn",buttons:[o?{label:"Lu",action:e.submit,type:"primary"}:{label:"Thm",action:e.submit,type:"primary"}]}),Ke.jsx("div",{className:"bg-white rounded-md",children:Ke.jsx(m0,{layout:"vertical",form:e,onFinish:o?L:M,children:Ke.jsx(Hy,{defaultActiveKey:"1",items:[{label:Ke.jsx("p",{className:"px-4 mb-0",children:" Thng tin chung"}),key:"1",children:Ke.jsx(L2,{form:e})},{label:Ke.jsx("p",{className:"px-4 mb-0",children:"Khch hng"}),key:"2",children:Ke.jsx(AA,{handleCustomer:h,listCustomer:c})}],indicatorSize:z=>z-18})})})]})}function NA(){return Ke.jsxs(Ke.Fragment,{children:[Ke.jsx(zy,{children:Ke.jsx("title",{children:" RouterControll"})}),Ke.jsx(IA,{})]})}export{NA as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/mapbox-gl-olW7wZPc.js","assets/index-sApiNKv_.js","assets/index-TAUT8xKj.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
