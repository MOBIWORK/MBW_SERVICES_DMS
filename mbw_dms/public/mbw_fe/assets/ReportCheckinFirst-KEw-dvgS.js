import{Y as s,a3 as i,L as t,N as se,R as ae,O as l,a5 as c,a6 as oe,V as Y,aR as G,a8 as ne}from"./index-E0O7XQer.js";import{H as le}from"./header-page-_jBNoOFe.js";import{C as ie}from"./index-bAZBBsIL.js";import{e as ce}from"./data-u-VkVTNg.js";import{u as m}from"./useDebount-28SXHhcf.js";import{a as me}from"./index-Cd0TkIiC.js";import{D as M}from"./index-O0oLlUJg.js";import{V as de}from"./VerticalAlignBottomOutlined-8R8rOFKn.js";const d=Y().startOf("month"),p=Y().endOf("month");let pe=Date.parse(d.$d)/1e3,he=Date.parse(p.$d)/1e3;const ue=[{title:"STT",dataIndex:"stt",key:"stt",render:(o,r,h)=>h+1},{title:"Phòng/nhóm",dataIndex:"department",key:"department",render:(o,r)=>t.jsx("div",{children:r.department})},{title:"Mã nhân viên",dataIndex:"employee_id",key:"employee_id",render:(o,r)=>t.jsx("div",{children:r.employee_id})},{title:"Tên nhân viên",dataIndex:"employee_name",key:"employee_name",render:(o,r)=>t.jsx("div",{children:r.employee_name})},{title:"Mã khách hàng",dataIndex:"customer_code",key:"customer_code",render:(o,r)=>t.jsx("div",{children:r.customer_code})},{title:"Tên khách hàng",dataIndex:"customer_name",key:"customer_name",render:(o,r)=>t.jsx("div",{children:r.customer_name})},{title:"Loại khách hàng",dataIndex:"customer_type",key:"customer_type",render:(o,r)=>t.jsx("div",{children:r.customer_type})},{title:"Nhóm khách hàng",dataIndex:"customer_group",key:"customer_group",render:(o,r)=>t.jsx("div",{children:r.customer_group})},{title:"Người liên hệ",dataIndex:"contact_person",key:"contact_person",render:(o,r)=>t.jsx("div",{children:r.contact_person})},{title:"SDT",dataIndex:"phone",key:"phone",render:(o,r)=>t.jsx("div",{children:r.phone})},{title:"Mã số thuế",dataIndex:"tax_id",key:"tax_id",render:(o,r)=>t.jsx("div",{children:r.tax_id})},{title:"Khu vực",dataIndex:"territory",key:"territory",render:(o,r)=>t.jsx("div",{children:r.territory})},{title:"Địa chỉ",dataIndex:"address",key:"address",render:(o,r)=>t.jsx("div",{className:"!w-[175px] truncate hover:whitespace-normal",children:r.address})},{title:"Ngày viếng thăm",dataIndex:"date_checkin",key:"date_checkin",render:(o,r)=>t.jsx("div",{children:r.date_checkin?.split("-")?.reverse()?.toString()?.replaceAll(",","-")})}];function ye(){const[o,r]=s.useState([]),[h,P]=s.useState(0),u=20,[y,R]=s.useState(1),[K,L]=s.useState([]),[x,g]=s.useState(""),[A,V]=s.useState("");let _=m(A,500);const[f,k]=s.useState(""),[q,z]=s.useState([]),[$,B]=s.useState("");let b=m($,500);const[F,j]=s.useState(""),[H,U]=s.useState([]),[X,Z]=s.useState("");let v=m(X,500);const[S,C]=s.useState(""),[D,N]=s.useState(""),[J,Q]=s.useState([]),[W,ee]=s.useState("");let T=m(W,500);const[w,E]=s.useState(pe),[I,O]=s.useState(he),te=e=>{if(e==null)E("");else if(p&&e&&e.isAfter(p,"day"))G.error("Từ ngày phải nhỏ hơn hoặc bằng Đến ngày");else{let a=Date.parse(e.$d)/1e3;E(a)}},re=e=>{if(e==null)O("");else if(d&&e&&e.isBefore(d,"day"))G.error("Đến ngày phải lớn hơn hoặc bằng Từ ngày");else{let a=Date.parse(e.$d)/1e3;O(a)}};return s.useEffect(()=>{(async()=>{let e=await i.get("/api/method/frappe.desk.search.search_link",{params:{txt:_,doctype:"Department",ignore_user_permissions:0,query:""}}),{message:a}=e;console.log("Customer Group",a),L(a.map(n=>({value:n.value.trim(),label:n.value.trim()})))})()},[_]),s.useEffect(()=>{(async()=>{let e=await i.get("/api/method/frappe.desk.search.search_link",{params:{txt:b,doctype:"Employee",ignore_user_permissions:0,query:""}}),{message:a}=e;console.log("rsEmployee",a),z(a.map(n=>({value:n.description.trim(),label:n.description.trim()})))})()},[b]),s.useEffect(()=>{(async()=>{let e=await i.get("/api/method/frappe.desk.search.search_link",{params:{txt:v,doctype:"Customer Group",ignore_user_permissions:0,query:""}}),{message:a}=e;U(a.map(n=>({value:n.value.trim(),label:n.value.trim()})))})()},[v]),s.useEffect(()=>{(async()=>{let e=await i.get("/api/method/frappe.desk.search.search_link",{params:{txt:T,doctype:"Territory",ignore_user_permissions:0,query:""}}),{message:a}=e;Q(a.map(n=>({value:n.value,label:n.value})))})()},[T]),s.useEffect(()=>{(async()=>{const e=await i.get("/api/method/mbw_dms.api.report.first_checkin_rp.first_checkin_report",{params:{page_size:u,page_number:y,department:x,employee:f,customer_group:F,customer_type:S,territory:D,from_date:w,to_date:I}});let{result:a}=e;console.log("dt",a),r(a),P(a?.totals)})()},[y,x,f,F,S,D,w,I]),t.jsx(t.Fragment,{children:t.jsx(ie,{header:t.jsx(le,{title:"Báo cáo thống kê khách hàng viếng thăm lần đầu",buttons:[{label:"Xuất dữ liệu",type:"primary",icon:t.jsx(de,{className:"text-xl"}),size:"20px",className:"flex items-center",action:()=>{me("/app/data-export/Data%20Export")}}]}),children:t.jsxs("div",{className:"bg-white rounded-md pt-4 pb-7 border-[#DFE3E8] border-[0.2px] border-solid",children:[t.jsx(se,{layout:"vertical",className:"flex flex-wrap justify-start items-center px-4",children:t.jsxs(ae,{className:"",gutter:[8,8],children:[t.jsx(l,{label:"Phòng ban",className:"w-[175px] border-none mr-2",children:t.jsx(c,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:K,onSelect:e=>{g(e)},onSearch:e=>{V(e)},onClear:()=>g(""),filterOption:!1,allowClear:!0,placeholder:"Tất cả phòng ban"})}),t.jsx(l,{label:"Nhân viên",className:"w-[175px] border-none mr-2",children:t.jsx(c,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:q,onSelect:e=>{k(e)},onSearch:e=>{B(e)},onClear:()=>k(""),filterOption:!1,allowClear:!0,placeholder:"Tất cả nhân viên"})}),t.jsx(l,{label:"Khách hàng",className:"w-[175px] border-none mr-2",children:t.jsx(c,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:ce,filterOption:!1,allowClear:!0,placeholder:"Tất cả loại khách hàng",onSelect:e=>{C(e)},onClear:()=>C("")})}),t.jsx(l,{label:"Nhóm khách hàng",className:"w-[175px] border-none mr-2",children:t.jsx(c,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:H,onSelect:e=>{j(e)},onSearch:e=>{Z(e)},onClear:()=>j(""),filterOption:!1,allowClear:!0,placeholder:"Tất cả nhóm khách hàng"})}),t.jsx(l,{label:"Khu vực",className:"w-[175px] border-none mr-2",children:t.jsx(c,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:J,onSelect:e=>{N(e)},onSearch:e=>{ee(e)},onClear:()=>N(""),filterOption:!1,allowClear:!0,placeholder:"Tất cả khu vực"})}),t.jsx(l,{label:"Từ ngày",className:"w-[175px] border-none mr-2",children:t.jsx(M,{format:"DD-MM-YYYY",placeholder:"Từ ngày",className:"!bg-[#F4F6F8] !h-8",onChange:te,defaultValue:d})}),t.jsx(l,{label:"Đến ngày",className:"w-[175px] border-none mr-2",children:t.jsx(M,{format:"DD-MM-YYYY",placeholder:"Đến ngày",className:"!bg-[#F4F6F8] !h-8",onChange:re,defaultValue:p})})]})}),t.jsx("div",{className:"pt-5",children:t.jsx(oe,{dataSource:o?.data?.map(e=>({...e,key:e.name})),bordered:!0,pagination:{defaultPageSize:u,total:h,showSizeChanger:!1,onChange(e){R(e)}},columns:ue,scroll:{x:!0}})})]})})})}function ve(){return t.jsxs(t.Fragment,{children:[t.jsx(ne,{children:t.jsx("title",{children:" ReportCheckinFirst"})}),t.jsx(ye,{})]})}export{ve as default};
