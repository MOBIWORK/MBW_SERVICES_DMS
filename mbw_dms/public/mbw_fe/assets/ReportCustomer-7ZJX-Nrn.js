import{Y as s,aS as be,a3 as m,L as e,R as i,P as l,O as r,a5 as x,a4 as Se,N as Fe,Q as u,a6 as ke,bv as ve,V as Q,a8 as we}from"./index-9n6lZY3-.js";import{H as De}from"./header-page-T-89oa4c.js";import{D as Ce}from"./index-kWS7CEq-.js";import{a as Ie,b as Te}from"./index.esm-QsRgCAJk.js";import{u as h}from"./useDebount-qxkp2Xhe.js";import{t as Ye,a as Ee}from"./index-0Q7ihCw5.js";import{V as Me}from"./VerticalAlignBottomOutlined-D9UDuknn.js";import{T as qe}from"./index-V4n0J05h.js";import{D as f}from"./index-Y6eAoEw-.js";import{I as _}from"./index-voay_HWH.js";const Re=[{title:e.jsx("div",{className:"relative",children:e.jsx("span",{className:"absolute -top-[11px] -left-8",children:"STT"})}),dataIndex:"stt",key:"stt",render:(j,g,c)=>c+1},{title:"Mã khách hàng",dataIndex:"customer_code",key:"customer_code"},{title:"Tên khách hàng",dataIndex:"customer_name",key:"customer_name"},{title:"Loại khách hàng",dataIndex:"customer_type",key:"customer_type"},{title:"Địa chỉ",dataIndex:"customer_address",key:"customer_address"}];function Ue(){const[j,g]=s.useState([]),[c]=be(),[y,N]=s.useState(),[b,S]=s.useState(),[F,k]=s.useState(),[v,w]=s.useState(),[D,C]=s.useState(),[I,T]=s.useState(),[Y,E]=s.useState(),[M,q]=s.useState(),[W,Z]=s.useState([]),[R,U]=s.useState(""),d=t=>{console.log(t)},B=20,[K,J]=s.useState(1),[ee,te]=s.useState(0),[se,ae]=s.useState(""),[L,O]=s.useState(""),[ne,re]=s.useState([]),[le,oe]=s.useState("");let P=h(se,500),H=h(le,500);const[ie,me]=s.useState([]),[ce,de]=s.useState([]),[p,pe]=s.useState(),[xe,ue]=s.useState(""),[z,A]=s.useState();let V=h(xe);const[$,G]=s.useState(""),[he,fe]=s.useState([]),[_e,je]=s.useState("");let X=h(_e,500);const ge=t=>{const n=[{title:"STT",dataIndex:"stt",key:"stt",render:(a,o,Ne)=>Ne+1},{title:"Mã sản phẩm",dataIndex:"item_code",key:"item_code"},{title:"Tên sản phẩm",dataIndex:"item_name",key:"item_name"},{title:"Hạn sử dụng",dataIndex:"exp_time",key:"exp_time",render:(a,o)=>a?e.jsx("p",{children:Q(a*1e3).format("DD/MM/YYYY")}):e.jsx(e.Fragment,{})},{title:"Đơn vị tính",dataIndex:"item_unit",key:"item_unit"},{title:"Tồn",dataIndex:"quantity",key:"quantity"},{title:"Giá sản phẩm",dataIndex:"item_price",key:"item_price",render:(a,o)=>e.jsx("p",{children:Intl.NumberFormat().format(o.item_price)})},{title:"Tổng giá trị",dataIndex:"total",key:"total",render:(a,o)=>e.jsx("p",{children:Intl.NumberFormat().format(o.quantity*o.item_price)})},{title:"Ngày cập nhật",dataIndex:"update_at",key:"update_at",render:(a,o)=>a?e.jsx("p",{children:Q(a*1e3).format("DD/MM/YYYY")}):e.jsx(e.Fragment,{})},{title:"Người cập nhật",dataIndex:"update_byname",key:"update_byname",render:(a,o)=>e.jsxs(e.Fragment,{children:[e.jsx("div",{children:o.update_byname}),e.jsx("div",{className:"font-normal text-sm leading-[21px] text-[#637381]",children:o.update_bycode})]})}];return e.jsx(ve,{columns:n,dataSource:t.items.map(a=>({...a,key:a.item_code})),pagination:!1})},ye=t=>{if(t.expire_from){let n=Date.parse(t.expire_from.$d)/1e3;N(n)}else N(void 0);if(t.expire_to){let n=Date.parse(t.expire_to.$d)/1e3;S(n)}else S(void 0);if(t.qty_inven_from?C(t.qty_inven_from):C(void 0),t.qty_inven_to?T(t.qty_inven_to):T(void 0),t.total_from?E(t.total_from):E(void 0),t.total_to?q(t.total_to):q(void 0),t.update_at_from){let n=Date.parse(t.update_at_from.$d)/1e3;k(n)}else k(void 0);if(t.update_at_to){let n=Date.parse(t.update_at_to.$d)/1e3;w(n)}else w(void 0)};return s.useEffect(()=>{(async()=>{let t=await m.get("/api/method/mbw_dms.api.router.get_team_sale");de(Ye({data:t.result.map(n=>({title:n.name,value:n.name,...n})),keyValue:"value",parentField:"parent_sales_person"}))})()},[]),s.useEffect(()=>{(async()=>{let t=await m.get("/api/method/mbw_dms.api.router.get_sale_person",{params:{team_sale:p,key_search:V}}),{message:n}=t;me(n.map(a=>({value:a.employee_code,label:a.employee_name||a.employee_code})))})()},[p,V]),s.useEffect(()=>{(async()=>{let t=await m.get("/api/method/frappe.desk.search.search_link",{params:{txt:X,doctype:"Customer",ignore_user_permissions:0,query:""}}),{message:n}=t;fe(n.map(a=>({value:a.value,label:a.value})))})()},[X]),s.useEffect(()=>{(async()=>{let t=await m.get("/api/method/frappe.desk.search.search_link",{params:{txt:P,doctype:"Item",ignore_user_permissions:0,query:""}}),{message:n}=t;Z(n.map(a=>({value:a.value,label:a.description.split(",")[0].trim(),des:a.value})))})()},[P]),s.useEffect(()=>{(async()=>{let t=await m.get("/api/method/frappe.desk.search.search_link",{params:{txt:H,doctype:"UOM",ignore_user_permissions:0,query:""}}),{message:n}=t;re(n.map(a=>({value:a.value,label:a.value})))})()},[H]),s.useEffect(()=>{(async()=>{const t=await m.get("/api/method/mbw_dms.api.report.inventory.get_customer_inventory",{params:{expire_from:y,expire_to:b,update_at_from:F,update_at_to:v,qty_inven_from:D,qty_inven_to:I,total_from:Y,total_to:M,item_code:R,page_size:B,page_number:K,unit_product:L,employee_sale:p,employee:z,customer:$}});g(t.result),te(t?.result?.total)})()},[y,b,D,I,Y,M,R,F,v,K,L,p,z,$]),e.jsxs(e.Fragment,{children:[e.jsx(De,{title:"Báo cáo tồn kho khách hàng",buttons:[{label:"Xuất dữ liệu",type:"primary",icon:e.jsx(Me,{className:"text-xl"}),size:"20px",className:"flex items-center",action:()=>{Ee("/app/data-export/Data%20Export")}}]}),e.jsxs("div",{className:"bg-white rounded-xl border-[#DFE3E8] border-[0.2px] border-solid",children:[e.jsxs(i,{gutter:[16,16],className:"justify-between items-end w-full p-4",children:[e.jsx(l,{children:e.jsx(i,{gutter:[8,8],children:e.jsx(l,{className:"mx-4 w-full",span:24,children:e.jsxs("div",{className:"flex flex-wrap justify-start items-center ",children:[e.jsx(r,{label:"Sản phẩm",className:"!w-[175px] border-none mr-2",children:e.jsx(x,{optionFilterProp:"children",filterOption:!1,onSearch:t=>ae(t),onSelect:t=>{U(t)},placeholder:e.jsx(e.Fragment,{children:"Tất cả sản phẩm"}),notFoundContent:null,options:W,allowClear:!0,onClear:()=>U(""),optionRender:t=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{role:"img","aria-label":t.data.label,className:"my-1",children:t.data.label}),e.jsx("span",{className:"text-xs !font-semibold",children:t.data.des})]})})})}),e.jsx(r,{label:"Đơn vị tính",className:"!w-[175px] border-none mr-2",children:e.jsx(x,{placeholder:"Tất cả đơn vị tính",options:ne,onSelect:t=>{O(t)},onSearch:t=>{oe(t)},onClear:()=>O(""),filterOption:!1,allowClear:!0})}),e.jsx(r,{label:"Nhóm bán hàng",className:"!w-[175px] border-none mr-2",children:e.jsx(qe,{placeholder:"Tất cả nhóm bán hàng",allowClear:!0,treeData:ce,onChange:t=>{pe(t)},dropdownStyle:{maxHeight:400,overflow:"auto",minWidth:350}})}),e.jsx(r,{label:"Người kiểm tồn",name:"employee",className:"!w-[175px] border-none mr-2",children:e.jsx(x,{filterOption:!1,notFoundContent:null,allowClear:!0,placeholder:"Tất cả người kiểm tồn",onSearch:t=>{ue(t)},options:ie,onSelect:t=>{A(t)},onClear:()=>{A("")}})}),e.jsx(r,{label:"Khách hàng",className:"!w-[175px] border-none mr-2",children:e.jsx(x,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:he,onSelect:t=>{G(t)},onSearch:t=>{je(t)},onClear:()=>G(""),filterOption:!1,allowClear:!0,placeholder:"Tất cả khách hàng"})})]})})})}),e.jsx(l,{className:"!ml-4",children:e.jsx("div",{className:"flex flex-wrap items-center",children:e.jsxs("div",{className:"flex justify-center items-center mr-4",children:[e.jsx(Se,{className:"!h-8",placement:"bottomRight",trigger:["click"],dropdownRender:()=>e.jsx(Ce,{title:"Bộ lọc",children:e.jsx("div",{className:"pt-6",children:e.jsxs(Fe,{form:c,onFinish:ye,children:[e.jsx("div",{className:"font-semibold text-sm leading-5 text-[#212B36]",children:"Hạn sử dụng"}),e.jsxs(i,{className:"pt-1",gutter:16,children:[e.jsxs(l,{span:12,children:[e.jsx("span",{className:"font-normal text-sm leading-5 text-[#637381]",children:"Ngày bắt đầu"}),e.jsx(r,{className:"pt-2",name:"expire_from",children:e.jsx(f,{format:"DD-MM-YYYY",className:"!bg-[#F4F6F8]",onChange:d})})]}),e.jsxs(l,{span:12,children:[e.jsx("span",{className:"font-normal text-sm leading-5 text-[#637381]",children:"Kết thúc"}),e.jsx(r,{className:"pt-2",name:"expire_to",children:e.jsx(f,{format:"DD-MM-YYYY",className:"!bg-[#F4F6F8]",onChange:d})})]})]}),e.jsx("div",{className:"pt-5 font-semibold text-sm leading-5 text-[#212B36]",children:"Ngày cập nhật"}),e.jsxs(i,{className:"pt-1",gutter:16,children:[e.jsxs(l,{span:12,children:[e.jsx("span",{className:"font-normal text-sm leading-5 text-[#637381]",children:"Ngày bắt đầu"}),e.jsx(r,{name:"update_at_from",className:"pt-2",children:e.jsx(f,{format:"DD-MM-YYYY",className:"!bg-[#F4F6F8]",onChange:d})})]}),e.jsxs(l,{span:12,children:[e.jsx("span",{className:"font-normal text-sm leading-5 text-[#637381]",children:"Kết thúc"}),e.jsx(r,{name:"update_at_to",className:"pt-2",children:e.jsx(f,{format:"DD-MM-YYYY",className:"!bg-[#F4F6F8]",onChange:d})})]})]}),e.jsx("div",{className:"pt-5 font-semibold text-sm leading-5 text-[#212B36]",children:"Số lượng tồn kho"}),e.jsxs(i,{className:"pt-1",gutter:16,children:[e.jsxs(l,{span:12,children:[e.jsx("span",{className:"font-normal text-sm leading-5 text-[#637381]",children:"Từ"}),e.jsx(r,{className:"pt-2",name:"qty_inven_from",children:e.jsx(_,{controls:!1,className:"w-full",placeholder:"0"})})]}),e.jsxs(l,{span:12,children:[e.jsx("span",{className:"font-normal text-sm leading-5 text-[#637381]",children:"Đến"}),e.jsx(r,{className:"pt-2",name:"qty_inven_to",children:e.jsx(_,{controls:!1,className:"w-full",placeholder:"0"})})]})]}),e.jsx("div",{className:"pt-5 font-semibold text-sm leading-5 text-[#212B36]",children:"Tổng giá trị"}),e.jsxs(i,{className:"pt-1",gutter:16,children:[e.jsxs(l,{span:12,children:[e.jsx("span",{className:"font-normal text-sm leading-5 text-[#637381]",children:"Từ"}),e.jsx(r,{className:"pt-2",name:"total_from",children:e.jsx(_,{controls:!1,className:"!bg-[#F5F7FA] w-full",placeholder:"0",suffix:"VND"})})]}),e.jsxs(l,{span:12,children:[e.jsx("span",{className:"font-normal text-sm leading-5 text-[#637381]",children:"Đến"}),e.jsx(r,{className:"pt-2",name:"total_to",children:e.jsx(_,{controls:!1,className:"!bg-[#F5F7FA] w-full",placeholder:"0",suffix:"VND"})})]})]}),e.jsxs(i,{className:"justify-between pt-6 pb-4",children:[e.jsx("div",{}),e.jsxs("div",{children:[e.jsx(u,{className:"mr-3",onClick:t=>{t.preventDefault(),c.resetFields()},children:"Đặt lại"}),e.jsx(u,{type:"primary",onClick:()=>{c.submit()},children:"Áp dụng"})]})]})]})})}),children:e.jsx(u,{onClick:t=>t.preventDefault(),className:"flex items-center text-nowrap !text-[13px] !leading-[21px] !font-normal  border-r-[0.1px] rounded-r-none h-9",icon:e.jsx(Ie,{style:{fontSize:"20px"}}),children:"Bộ lọc"})}),e.jsx(u,{className:"border-l-[0.1px] rounded-l-none !h-8",children:e.jsx(Te,{style:{fontSize:"20px"}})})]})})})]}),e.jsx(ke,{columns:Re,scroll:{x:!0},expandable:{expandedRowRender:ge,defaultExpandedRowKeys:["0"]},dataSource:j?.data?.map(t=>({...t,key:t.name})),pagination:{defaultPageSize:B,total:ee,showSizeChanger:!1,onChange(t){J(t)}},rowHoverable:!1}),e.jsx("div",{className:""})]})]})}function Ge(){return e.jsxs(e.Fragment,{children:[e.jsx(we,{children:e.jsx("title",{children:" ReportCustomer"})}),e.jsx(Ue,{})]})}export{Ge as default};
