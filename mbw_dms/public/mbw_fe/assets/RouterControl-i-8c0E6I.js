import{u as D,r as s,A as i,j as e,R as f,C as l,F as c,S as d,B as o,T as $,L as M,H as O}from"./index-KwWGhUjE.js";import{L as X,V as G}from"./index.esm-w91TRHZE.js";import{L as Q,a as U,b as Z}from"./index.esm-5lW-GXHl.js";import{P as J}from"./index.esm-GaEKpfWD.js";import{H as W}from"./header-page-rQLPC4DX.js";import{u as g}from"./useDebount-8PooBZHK.js";const Y=[{title:"Mã tuyến",dataIndex:"channel_code",key:"channel_code"},{title:"Tên tuyến",dataIndex:"channel_name",key:"channel_name"},{title:"NVBH",dataIndex:"employee",key:"employee"},{title:"Trạng thái",dataIndex:"status",key:"status"},{title:"Ngày tạo",dataIndex:"modified",key:"modified"},{title:"Người tạo",dataIndex:"modified_by",key:"modified_by"},{title:"Ngày cập nhật",dataIndex:"modified",key:"modified"},{title:"Người cập nhật",dataIndex:"modified_by",key:"modified_by"}];function ee(){const j=D(),[b,S]=s.useState([]),[N,_]=s.useState(""),[v,k]=s.useState("");let u=g(N,300),m=g(v,500);const[w,C]=s.useState([]),[R,F]=s.useState([]),[r,L]=s.useState(),[x,E]=s.useState(),[p,I]=s.useState(),[h,T]=s.useState(1),y=20,[z,q]=s.useState([]),[A,P]=s.useState(0),H={selectedRowKeys:b,onChange:t=>{console.log("selectedRowKeys changed: ",t),S(t)}},K=t=>{I(t)},B=t=>{console.log("search:",t)},V=(t,a)=>(a?.label??"").toLowerCase().includes(t.toLowerCase());return s.useEffect(()=>{(async()=>{let t=await i.get("/api/method/frappe.desk.search.search_link",{params:{txt:u,doctype:"Employee",ignore_user_permissions:0,reference_doctype:"Attendance",query:"erpnext.controllers.queries.employee_query"}}),{message:a}=t;C(a.map(n=>({value:n.value,label:n.description})))})()},[u]),s.useEffect(()=>{(async()=>{let t=await i.get("/api/method/frappe.desk.search.search_link",{params:{txt:m,doctype:"DMS Router",ignore_user_permissions:0,reference_doctype:"Attendance",query:"mbw_dms.api.controller.queries.router_query"}}),{message:a}=t;F(a.map(n=>({value:n.value,label:n.description.split(",")[0],desc:n.description.split(",")[1]})))})()},[m]),s.useEffect(()=>{(async()=>{const t=await i.get("/api/method/mbw_dms.api.router.get_list_router",{params:{page_size:y,page_number:h,status:p,router:r&&r.reduce((a,n)=>`${a};${n}`),employee:x}});q(t?.result?.data),P(t?.result?.total)})()},[r,x,p,h]),e.jsxs(e.Fragment,{children:[e.jsx(W,{title:"Quản lý tuyến",buttons:[{label:"Xuất excel",icon:e.jsx(X,{className:"text-xl"}),size:"20px",className:"flex items-center mr-2"},{label:"Nhập excel",icon:e.jsx(Q,{className:"text-xl"}),size:"20px",className:"flex items-center mr-2"},{label:"Thêm mới",type:"primary",icon:e.jsx(G,{className:"text-xl"}),size:"20px",className:"flex items-center",action:()=>j("/dms-router/create-dms-router")}]}),e.jsx("div",{className:"bg-[#f9fafa]",children:e.jsx("div",{className:"mx-2 pt-5 pb-10",children:e.jsx("div",{className:"pt-5",children:e.jsxs("div",{className:"h-auto bg-white py-7 px-4 rounded-lg",children:[e.jsxs(f,{className:"justify-between w-full",children:[e.jsx(l,{span:14,children:e.jsxs(f,{gutter:8,children:[e.jsx(l,{span:8,children:e.jsx(c,{name:"employee",required:!0,children:e.jsx(d,{mode:"multiple",filterOption:!1,onChange:t=>{console.log("router",r),L(t)},showSearch:!0,placeholder:"Tuyến",notFoundContent:null,onSearch:t=>k(t),options:R,optionRender:t=>e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{role:"img","aria-label":t.data.label,className:"my-1",children:t.data.label}),e.jsx("span",{className:"text-xs !font-semibold",children:t.data.desc})]})})})}),e.jsx(l,{span:8,children:e.jsx(c,{name:"employee",required:!0,children:e.jsx(d,{placeholder:"Nhân viên bán hàng",showSearch:!0,notFoundContent:null,onSearch:t=>_(t),options:[{label:"Tất cả nhân viên",value:""},...w],onChange:t=>{E(t)}})})}),e.jsx(l,{span:8,children:e.jsx(c,{className:"w-[150px] border-none",children:e.jsx(d,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",optionFilterProp:"children",onChange:K,onSearch:B,filterOption:V,defaultValue:"",options:[{value:"",label:"Trạng thái"},{value:"Active",label:"Hoạt động"},{value:"Lock",label:"Khóa"}]})})})]})}),e.jsx(l,{children:e.jsxs("div",{className:"flex flex-wrap items-center",children:[e.jsxs("div",{className:"flex justify-center items-center mr-4",children:[e.jsx(o,{className:"flex items-center text-nowrap !text-[13px] !leading-[21px] !font-normal  border-r-[0.1px] rounded-r-none h-[32px]",icon:e.jsx(U,{style:{fontSize:"20px"}}),children:"Filter"}),e.jsx(o,{className:"border-l-[0.1px] rounded-l-none h-[32px]",children:e.jsx(Z,{style:{fontSize:"20px"}})})]}),e.jsxs("div",{className:"flex justify-center items-center rounded-md",children:[e.jsx(o,{className:"border-r-[0.1px] rounded-r-none",children:e.jsx(J,{style:{fontSize:"20px"}})}),e.jsx(o,{className:"border-l-[0.1px] rounded-l-none",children:"Last update on"})]})]})})]}),e.jsx("div",{className:"pt-5",children:e.jsx("div",{children:e.jsx($,{rowSelection:H,columns:Y.map(t=>t.dataIndex=="channel_code"?{...t,render:(a,n,se)=>e.jsx(M,{className:"!text-slate-900",to:`/dms-router/${n?.name}`,children:a})}:t),dataSource:z?.map(t=>({key:t.channel_code,...t})),pagination:{defaultPageSize:y,total:A,onChange(t,a){T(t)}}})})})]})})})})]})}function ce(){return e.jsxs(e.Fragment,{children:[e.jsx(O,{children:e.jsx("title",{children:" RouterControll"})}),e.jsx(ee,{})]})}export{ce as default};
