import{Y as a,cu as C,cv as Ze,cw as ee,V as j,L as e,P as _,a2 as f,cx as ue,a1 as y,a6 as he,aa as pe,cy as M,cz as me,cA as v,cB as T,cC as I,aZ as Je,cD as R,cE as L,cF as O,a_ as Xe,a9 as Pe,N as x,R as es,Q as H,cG as se,cH as te,cI as ae,cJ as re,cK as le,cL as ne,cM as oe,a7 as ss,bD as ts}from"./index-A4AvfZ5v.js";import{D as as,S as rs}from"./index-eh5UDfhY.js";import{a as ls}from"./index.esm-iFycesO7.js";import{e as ns,f as os}from"./data-u-VkVTNg.js";import{D as q}from"./index-VvUwF_0e.js";import{V as cs}from"./VerticalAlignBottomOutlined-EizH2DUN.js";function de(){var t=a.useContext(C);return t}function xe(t){t===void 0&&(t=C);var l=t===C?de:function(){return a.useContext(t)};return function(){var r=l(),c=r.store;return c}}var is=xe();function us(t){t===void 0&&(t=C);var l=t===C?is:xe(t);return function(){var r=l();return r.dispatch}}var w=us(),hs=function(l,n){return l===n};function ps(t,l,n,r){var c=a.useReducer(function(b){return b+1},0),m=c[1],i=a.useMemo(function(){return Ze(n,r)},[n,r]),o=a.useRef(),h=a.useRef(),S=a.useRef(),g=a.useRef(),N=n.getState(),F;try{if(t!==h.current||N!==S.current||o.current){var D=t(N);g.current===void 0||!l(D,g.current)?F=D:F=g.current}else F=g.current}catch(b){throw o.current&&(b.message+=`
The error may be correlated with this previous error:
`+o.current.stack+`

`),b}return ee(function(){h.current=t,S.current=N,g.current=F,o.current=void 0}),ee(function(){function b(){try{var k=n.getState();if(k===S.current)return;var E=h.current(k);if(l(E,g.current))return;g.current=E,S.current=k}catch($){o.current=$}m()}return i.onStateChange=b,i.trySubscribe(),b(),function(){return i.tryUnsubscribe()}},[n,i]),F}function ms(t){t===void 0&&(t=C);var l=t===C?de:function(){return a.useContext(t)};return function(r,c){c===void 0&&(c=hs);var m=l(),i=m.store,o=m.subscription,h=ps(r,c,i,o);return a.useDebugValue(h),h}}var B=ms();const K="(max-width: 1062px)",Ms="(min-width: 1200px)",ds=[{label:"Tháng 1",value:"1"},{label:"Tháng 2",value:"2"},{label:"Tháng 3",value:"3"},{label:"Tháng 4",value:"4"},{label:"Tháng 5",value:"5"},{label:"Tháng 6",value:"6"},{label:"Tháng 7",value:"7"},{label:"Tháng 8",value:"8"},{label:"Tháng 9",value:"9"},{label:"Tháng 10",value:"10"},{label:"Tháng 11",value:"11"},{label:"Tháng 12",value:"12"}],Rs=20,V=t=>{const[l,n]=a.useState(!1);return a.useEffect(()=>{const r=window.matchMedia(t);r.matches!==l&&n(r.matches);const c=()=>n(r.matches);return window.addEventListener("resize",c),()=>window.removeEventListener("resize",c)},[l,t]),l},xs=(j().month()+1).toString(),fe=({setPage:t})=>{const l=w(),n=V(`${K}`);return e.jsxs(_,{className:`min-w-[130px] ${n?"w-full":" w-[20%]"}`,children:[e.jsx("label",{className:"text-xs font-normal leading-[21px] pl-1 ",children:"Tháng"}),e.jsx(f,{className:"!bg-[#F4F6F8] ",defaultValue:xs,options:ds,onChange:r=>{l(ue(r)),t&&t(1)}})]})},fs=()=>{const t=w(),[l,n]=a.useState([]);return a.useEffect(()=>{(async()=>{let r=await y.get("/api/method/mbw_dms.api.router.get_team_sale");n(he({data:r.result.map(c=>({title:c.name,value:c.name,...c})),keyValue:"value",parentField:"parent_sales_person"}))})()},[]),e.jsxs(_,{className:"min-w-[130px]  w-[20%]",children:[e.jsx("label",{className:"text-xs font-normal leading-[21px] pl-1 ",children:"Nhóm bán hàng"}),e.jsx(pe,{placeholder:"Tất cả nhóm bán hàng",allowClear:!0,showSearch:!0,treeData:l,onChange:r=>{t(M(r))},dropdownStyle:{maxHeight:400,overflow:"auto",minWidth:350}})]})},ye=()=>{const t=w(),l=r=>{t(me(r?.$y.toString()))},n=V(`${K}`);return e.jsxs(_,{className:`min-w-[130px] ${n?"w-full":" w-[20%]"}`,children:[e.jsx("label",{className:"text-xs font-normal leading-[21px] pl-1 ",children:"Năm"}),e.jsx(q,{className:"!bg-[#F4F6F8] w-full rounded-lg h-7",onChange:l,placeholder:"Chọn năm",picker:"year",allowClear:!1,defaultValue:j().startOf("year")})]})},ys=({setPage:t,matchMedia:l})=>{const[n,r]=a.useState([]),[c,m]=a.useState(""),i=w(),{sales_team:o}=B(h=>h.group);return a.useEffect(()=>{(async()=>{let h=await y.get("/api/method/mbw_dms.api.router.get_sale_person",{params:{team_sale:o,key_search:c}}),{message:S}=h;r(S.map(g=>({value:g.employee_code,label:g.employee_name||g.employee_code})))})()},[c,o]),e.jsxs(_,{className:`min-w-[130px] ${l?"w-full":"w-[20%]"}`,children:[e.jsx("label",{className:"text-xs font-normal leading-[21px] pl-1 ",children:"Nhân viên"}),e.jsx(f,{filterOption:!0,allowClear:!0,showSearch:!0,placeholder:"Tất cả nhân viên",onSearch:h=>{m(h)},options:n,onSelect:h=>{i(v(h)),t(1)},onClear:()=>{i(v(""))}})]})},ce=j().startOf("month"),Se=()=>{const t=w();B(r=>r.date);const l=V(`${K}`),n=r=>{if(r==null)t(T(r));else{let c=Date.parse(r.$d)/1e3;t(T(c))}};return a.useEffect(()=>{t(T(Date.parse(ce.$d)/1e3))},[]),e.jsxs(_,{className:`min-w-[130px]  ${l?"w-full":" w-[20%]"}`,children:[e.jsx("label",{className:"text-xs font-normal leading-[21px] pl-1 ",children:"Từ ngày"}),e.jsx(q,{format:"DD-MM-YYYY",className:"!bg-[#F4F6F8] w-full rounded-lg h-7",placeholder:"Từ ngày",onChange:n,defaultValue:ce,allowClear:!1})]})},ie=j().endOf("month"),ge=()=>{const t=w(),{startDate:l,endDate:n}=B(o=>o.date),r=o=>{if(l){const h=j.unix(l).month();return o&&o.month()!==h}},c=o=>{if(o==null)t(I(o));else if(l&&o&&o.isBefore(j.unix(l),"day"))Je.error("Đến ngày phải lớn hơn hoặc bằng Từ ngày");else{let h=Date.parse(o.$d)/1e3;t(I(h))}},m=V(`${K}`),i=j(n*1e3);return a.useEffect(()=>{t(I(Date.parse(ie.$d)/1e3))},[]),e.jsxs(_,{className:`min-w-[130px] ${m?"w-full":" w-[20%]"}`,children:[e.jsx("label",{className:"text-xs font-normal leading-[21px] pl-1 ",children:"Đến ngày"}),e.jsx(q,{format:"DD-MM-YYYY",className:"!bg-[#F4F6F8] w-full rounded-lg h-7",onChange:c,placeholder:"Đến ngày",defaultValue:ie,disabledDate:r,value:i,allowClear:!1})]})},Ss=({setPage:t})=>{const[l,n]=a.useState([]),[r,c]=a.useState(""),m=w();return a.useEffect(()=>{(async()=>{let i=await y.get("/api/method/frappe.desk.search.search_link",{params:{txt:r,doctype:"Supplier",ignore_user_permissions:0,query:""}}),{message:o}=i;n(o.map(h=>({value:h?.value,label:h.description.split(",")[0].trim()})))})()},[r]),e.jsxs(_,{className:"min-w-[130px] w-[20%]",children:[e.jsx("label",{className:"text-xs font-normal leading-[21px] pl-1 ",children:"Nhà Cung cấp"}),e.jsx(f,{filterOption:!1,allowClear:!0,showSearch:!0,placeholder:"Tất cả nhà cung cấp",onSearch:i=>{c&&c(i)},options:l,onSelect:i=>{m(R(i)),t(1)},onClear:()=>{m(R(""))}})]})},gs=({setPage:t,matchMedia:l})=>{const[n,r]=a.useState([]),[c,m]=a.useState(""),i=w();return a.useEffect(()=>{(async()=>{let o=await y.get("/api/method/frappe.desk.search.search_link",{params:{txt:c,doctype:"Brand",ignore_user_permissions:0,query:""}}),{message:h}=o;r(h.map(S=>({value:S?.value,description:S?.description})))})()},[c]),e.jsxs(_,{className:`min-w-[130px] ${l?"w-full":"w-[20%]"}`,children:[e.jsx("label",{className:"text-xs font-normal leading-[21px] pl-1 ",children:"Nhãn hiệu"}),e.jsx(f,{filterOption:!1,allowClear:!0,showSearch:!0,placeholder:"Tất cả nhãn hiệu",onSearch:o=>{m(o)},options:n,onSelect:o=>{i(L(o)),t(1)},onClear:()=>{i(L(""))}})]})},ws=({setPage:t})=>{const[l,n]=a.useState([]),[r,c]=a.useState(""),m=w();return a.useEffect(()=>{(async()=>{let i=await y.get("/api/method/frappe.desk.search.search_link",{params:{txt:r,doctype:"DMS Industry",ignore_user_permissions:0,query:""}}),{message:o}=i;n(o.map(h=>({value:h?.value,description:h?.description})))})()},[r]),e.jsxs(_,{className:"min-w-[130px] w-[20%]",children:[e.jsx("label",{className:"text-xs font-normal leading-[21px] pl-1 ",children:"Ngành hàng"}),e.jsx(f,{filterOption:!1,allowClear:!0,showSearch:!0,placeholder:"Tất cả ngành hàng",onSearch:i=>{c(i)},options:l,onSelect:i=>{m(O(i)),t(1)},onClear:()=>{m(O(""))}})]})},bs=({setPage:t,inputMonth:l,inputYear:n,inputFromDate:r,inputToDate:c,inputSaleGroup:m,inputEmployee:i,inputSupplier:o,inputIndustry:h,inpitBrand:S})=>e.jsxs(e.Fragment,{children:[l&&e.jsx(fe,{setPage:t}),n&&e.jsx(ye,{}),r&&e.jsx(Se,{}),c&&e.jsx(ge,{}),m&&e.jsx(fs,{}),i&&e.jsx(ys,{setPage:t}),o&&e.jsx(Ss,{setPage:t}),h&&e.jsx(ws,{setPage:t}),S&&e.jsx(gs,{setPage:t})]}),Ls=bs,js=j().startOf("month"),_s=j().endOf("month");let Fs=Date.parse(js.$d)/1e3,vs=Date.parse(_s.$d)/1e3;const Cs=({setPage:t,matchMedia:l,inputFromDate:n,inputMonth:r,inputToDate:c,inputYear:m,inputSaleGroup:i,inputEmployee:o,inputCompany:h,inputCustomer:S,inputTerritory:g,inputWarehouse:N,inputCustomerType:F,inputCustomerGroup:D,inputOrder:b,inputSupplier:k,inputIndustry:E,inputBrand:$})=>{const[we,be]=a.useState([]),[je,_e]=a.useState([]),[Fe,ve]=a.useState([]),[Ce,Ne]=a.useState([]),[ke,De]=a.useState([]),[Ee,Te]=a.useState([]),[Ie,$e]=a.useState([]),[Me,Re]=a.useState([]),[Le,Oe]=a.useState([]),[Be,Ke]=a.useState([]),[W,Ve]=a.useState(""),[G,Ye]=a.useState(""),[A,He]=a.useState(""),[z,qe]=a.useState(""),[Q,We]=a.useState(""),[U,Ge]=a.useState(""),[Z,Ae]=a.useState(""),[J,ze]=a.useState(""),[X,Qe]=a.useState(""),[Y]=Xe(),u=w(),{sales_team:P}=B(s=>s.group);E&&a.useEffect(()=>{(async()=>{let s=await y.get("/api/method/frappe.desk.search.search_link",{params:{txt:J,doctype:"DMS Industry",ignore_user_permissions:0,query:""}}),{message:d}=s;$e(d.map(p=>({value:p?.value,description:p?.description})))})()},[J]),$&&a.useEffect(()=>{(async()=>{let s=await y.get("/api/method/frappe.desk.search.search_link",{params:{txt:Z,doctype:"Brand",ignore_user_permissions:0,query:""}}),{message:d}=s;Te(d.map(p=>({value:p?.value,description:p?.description})))})()},[Z]),S&&a.useEffect(()=>{(async()=>{let s=await y.get("/api/method/frappe.desk.search.search_link",{params:{txt:A,doctype:"Customer",ignore_user_permissions:0,query:""}}),{message:d}=s;be(d.map(p=>({value:p.value,label:p.value})))})()},[A]),g&&a.useEffect(()=>{(async()=>{let s=await y.get("/api/method/frappe.desk.search.search_link",{params:{txt:z,doctype:"Territory",ignore_user_permissions:0,query:""}}),{message:d}=s;ve(d.map(p=>({value:p.value,label:p.value})))})()},[z]),D&&a.useEffect(()=>{(async()=>{let s=await y.get("/api/method/frappe.desk.search.search_link",{params:{txt:X,doctype:"Customer Group",ignore_user_permissions:0,query:""}}),{message:d}=s;Ne(d.map(p=>({value:p.value.trim(),label:p.value.trim()})))})()},[X]),a.useEffect(()=>{(async()=>{let s=await y.get("/api/method/mbw_dms.api.router.get_team_sale");Re(he({data:s.result.map(d=>({title:d.name,value:d.name,...d})),keyValue:"value",parentField:"parent_sales_person"}))})()},[]),o&&a.useEffect(()=>{(async()=>{let s=await y.get("/api/method/mbw_dms.api.router.get_sale_person",{params:{team_sale:P,key_search:G}}),{message:d}=s;Oe(d.map(p=>({value:p.employee_code,label:p.employee_name||p.employee_code})))})()},[P,G]),h&&a.useEffect(()=>{(async()=>{let s=await y.get("/api/method/frappe.desk.search.search_link",{params:{txt:Q,doctype:"Company",ignore_user_permissions:0,query:""}}),{message:d}=s;De(d.map(p=>({value:p.value,label:p.value})))})()},[Q]),N&&a.useEffect(()=>{(async()=>{let s=await y.get("/api/method/frappe.desk.search.search_link",{params:{txt:U,doctype:"Warehouse",ignore_user_permissions:0,query:""}}),{message:d}=s;_e(d.map(p=>({value:p.value,label:p.value})))})()},[U]),k&&a.useEffect(()=>{(async()=>{let s=await y.get("/api/method/frappe.desk.search.search_link",{params:{txt:W,doctype:"Supplier",ignore_user_permissions:0,query:""}}),{message:d}=s;Ke(d.map(p=>({value:p?.value,label:p.description.split(",")[0].trim()})))})()},[W]);const Ue=s=>{s.customergroup?u(se(s.customergroup)):u(se("")),s.customertype?u(te(s.customertype)):u(te("")),s.territory?u(ae(s.territory)):u(ae("")),s.has_sales_order?u(re(s.has_sales_order)):u(re("")),s.filter_month?u(T(Date.parse(s.filter_month.$d)/1e3)):u(T(Fs)),s.filter_year?u(I(Date.parse(s.filter_year.$d)/1e3)):u(I(vs)),s.company?u(le(s.company)):u(le("")),s.customer?u(ne(s.customer)):u(ne("")),s.warehouse?u(oe(s.warehouse)):u(oe("")),s.filter_group_sales?u(M(s.filter_group_sales)):u(M("")),s.filter_employee?u(v(s.filter_employee)):u(v("")),t&&t(1)};return e.jsx(Pe,{className:"!h-8",placement:"bottomRight",trigger:["click"],dropdownRender:()=>e.jsxs(as,{title:"Bộ lọc",children:[e.jsxs(x,{layout:"vertical",form:Y,onFinish:Ue,children:[!l&&e.jsxs(e.Fragment,{children:[n&&e.jsx(x.Item,{className:"w-[468px] border-none",name:"filter_month",children:e.jsx(Se,{})}),r&&e.jsx(x.Item,{className:"w-[468px] border-none",name:"filter_month",children:e.jsx(fe,{setPage:t})}),c&&e.jsx(x.Item,{className:"w-[468px] border-none",name:"filter_year",children:e.jsx(ge,{})}),m&&e.jsx(x.Item,{className:"w-[468px] border-none",name:"filter_year",children:e.jsx(ye,{})}),i&&e.jsx(x.Item,{className:"w-[468px] border-none",name:"filter_group_sales",label:"Nhóm bán hàng",children:e.jsx(pe,{placeholder:"Tất cả nhóm bán hàng",allowClear:!0,showSearch:!0,treeData:Me,dropdownStyle:{maxHeight:400,overflow:"auto",minWidth:350}})}),o&&e.jsx(x.Item,{className:"w-[468px] border-none",label:"Nhân viên",name:"filter_employee",children:e.jsx(f,{filterOption:!0,allowClear:!0,showSearch:!0,placeholder:"Tất cả nhân viên",onSearch:s=>{Ye(s)},options:Le,onClear:()=>{v&&v("")}})})]}),h&&e.jsx(x.Item,{name:"company",label:"Công ty",className:"w-[468px] border-none",children:e.jsx(f,{showSearch:!0,className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:ke,allowClear:!0,onSearch:s=>{We(s)},placeholder:"Tất cả công ty"})}),S&&e.jsx(x.Item,{name:"customer",label:"Khách hàng",className:"w-[468px] border-none",children:e.jsx(f,{showSearch:!0,className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:we,filterOption:!1,allowClear:!0,onSearch:s=>{He(s)},placeholder:"Tất cả khách hàng"})}),N&&e.jsx(x.Item,{name:"warehouse",label:"Kho",className:"w-[468px] border-none",children:e.jsx(f,{showSearch:!0,className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:je,allowClear:!0,onSearch:s=>{Ge(s)},placeholder:"Tất cả kho"})}),F&&e.jsx(x.Item,{name:"customertype",label:"Loại khách hàng",className:"w-[468px] border-none",children:e.jsx(f,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:ns,allowClear:!0,showSearch:!0,placeholder:"Tất cả loại khách hàng"})}),D&&e.jsx(x.Item,{name:"customergroup",label:"Nhóm khách hàng",className:"w-[468px] border-none",children:e.jsx(f,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:Ce,allowClear:!0,onSearch:s=>{Qe(s)},showSearch:!0,placeholder:"Tất cả nhóm khách hàng"})}),b&&e.jsx(x.Item,{label:"Phát sinh đơn hàng",name:"hasorder",className:"w-[468px] border-none",children:e.jsx(f,{placeholder:"Tất cả",className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:os,allowClear:!0,showSearch:!0})}),g&&e.jsx(x.Item,{name:"territory",label:"Khu vực",className:"w-[468px] border-none",children:e.jsx(f,{showSearch:!0,className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:Fe,allowClear:!0,onSearch:s=>{qe(s)},placeholder:"Tất cả khu vực"})}),$&&e.jsx(x.Item,{name:"territory",label:"Nhãn hiệu",className:"w-[468px] border-none",children:e.jsx(f,{filterOption:!1,allowClear:!0,showSearch:!0,placeholder:"Tất cả nhãn hiệu",onSearch:s=>{Ae(s)},options:Ee,onSelect:s=>{u(L(s)),t&&t(1)},onClear:()=>{u(L(""))}})}),k&&e.jsx(x.Item,{name:"supplier",label:"Nhà cung cấp",className:"w-[468px] border-none",children:e.jsx(f,{filterOption:!1,notFoundContent:null,allowClear:!0,showSearch:!0,placeholder:"Tất cả nhà cung cấp",onSearch:s=>{Ve(s)},options:Be,onSelect:s=>{u(R(s)),t&&t(1)},onClear:()=>{u(R(""))}})}),E&&e.jsx(x.Item,{name:"industry",label:"Ngành hàng",className:"w-[468px] border-none",children:e.jsx(f,{filterOption:!1,allowClear:!0,showSearch:!0,placeholder:"Tất cả ngành hàng",onSearch:s=>{ze(s)},options:Ie,onSelect:s=>{u(O(s)),t&&t(1)},onClear:()=>{u(O(""))}})})]}),e.jsx(es,{className:"justify-between pt-6 pb-4",children:e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"mr-3",onClick:s=>{s.preventDefault(),u(ue("")),u(me("")),u(M("")),u(v("")),Y.resetFields()},children:"Đặt lại"}),e.jsx(H,{type:"primary",onClick:()=>{Y.submit()},children:"Áp dụng"})]})})]}),children:e.jsx(H,{onClick:s=>s.preventDefault(),className:"flex items-center text-nowrap !text-[13px] !leading-[21px] !font-normal  border-r-[0.1px]  h-8 mt-4",icon:e.jsx(ls,{style:{fontSize:"20px"}}),children:"Bộ lọc"})})},Os=Cs,Ns=({setRefresh:t,title:l,params:n,file_name:r})=>{const[c,m]=a.useState(!1);return e.jsx(ss,{title:l,buttons:[{icon:e.jsx(rs,{className:"text-xl size-4 mb-1 mr-[2px]"}),className:"flex mr-2 h-7 mt-6",action:()=>{t(i=>!i)}},{disabled:c,label:"Xuất dữ liệu",type:"primary",icon:e.jsx(cs,{className:"text-xl"}),size:"18px",className:"flex items-center h-7 mt-6",action:ts.bind(null,{url:"/api/method/mbw_dms.api.exports.export_excel.export_excel",params:n,file_name:r},m)}]})},Bs=Ns;export{Os as D,Ls as F,Rs as P,Bs as R,V as a,Ms as b,K as m,B as u};
