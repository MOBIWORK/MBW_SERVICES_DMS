import{ac as Z,af as je,ag as be,aw as ge,ai as he,bF as fe,aj as Fe,ah as Be,h as H,W as p,au as Pe,aJ as Ee,bu as He,bi as De,ao as Se,ab as we,L as t,R as me,P as X,Q as xe,a2 as Oe,bG as We,aS as re,a0 as Re,bH as Ae,a6 as Ve,bz as qe,b1 as _e,a7 as Ge}from"./index-3nS2ylof.js";import{D as Xe}from"./date-picker-bbdK4CIB.js";import{a as ce,T as ve}from"./index-Goo8I8BT.js";import{H as Ze}from"./header-page-eKF9R_es.js";import{W as ae,c as Ke,d as R,r as Ye,l as Ue,p as ee,f as pe,s as Je,g as ye,e as Qe,b as et}from"./WrapperCard-BCdJWr--.js";import{s as tt}from"./index-AXlMfcGY.js";import"./index-5-Hn-D0T.js";const Ce=["wrap","nowrap","wrap-reverse"],$e=["flex-start","flex-end","start","end","center","space-between","space-around","space-evenly","stretch","normal","left","right"],Te=["center","start","end","flex-start","flex-end","self-start","self-end","baseline","normal","stretch"],it=(e,i)=>{const a={};return Ce.forEach(n=>{a[`${e}-wrap-${n}`]=i.wrap===n}),a},nt=(e,i)=>{const a={};return Te.forEach(n=>{a[`${e}-align-${n}`]=i.align===n}),a[`${e}-align-stretch`]=!i.align&&!!i.vertical,a},rt=(e,i)=>{const a={};return $e.forEach(n=>{a[`${e}-justify-${n}`]=i.justify===n}),a};function at(e,i){return Z(Object.assign(Object.assign(Object.assign({},it(e,i)),nt(e,i)),rt(e,i)))}const st=e=>{const{componentCls:i}=e;return{[i]:{display:"flex","&-vertical":{flexDirection:"column"},"&-rtl":{direction:"rtl"},"&:empty":{display:"none"}}}},ot=e=>{const{componentCls:i}=e;return{[i]:{"&-gap-small":{gap:e.flexGapSM},"&-gap-middle":{gap:e.flexGap},"&-gap-large":{gap:e.flexGapLG}}}},lt=e=>{const{componentCls:i}=e,a={};return Ce.forEach(n=>{a[`${i}-wrap-${n}`]={flexWrap:n}}),a},ct=e=>{const{componentCls:i}=e,a={};return Te.forEach(n=>{a[`${i}-align-${n}`]={alignItems:n}}),a},dt=e=>{const{componentCls:i}=e,a={};return $e.forEach(n=>{a[`${i}-justify-${n}`]={justifyContent:n}}),a},gt=()=>({}),mt=je("Flex",e=>{const{paddingXS:i,padding:a,paddingLG:n}=e,o=be(e,{flexGapSM:i,flexGap:a,flexGapLG:n});return[st(o),ot(o),lt(o),ct(o),dt(o)]},gt,{resetStyle:!1});var pt=function(e,i){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&i.indexOf(n)<0&&(a[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(e);o<n.length;o++)i.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(a[n[o]]=e[n[o]]);return a};const ht=ge.forwardRef((e,i)=>{const{prefixCls:a,rootClassName:n,className:o,style:k,flex:h,gap:v,children:l,vertical:x=!1,component:m="div"}=e,f=pt(e,["prefixCls","rootClassName","className","style","flex","gap","children","vertical","component"]),{flex:c,direction:r,getPrefixCls:M}=ge.useContext(he),$=M("flex",a),[P,I,O]=mt($),d=x??c?.vertical,q=Z(o,n,c?.className,$,I,O,at($,e),{[`${$}-rtl`]:r==="rtl",[`${$}-gap-${v}`]:fe(v),[`${$}-vertical`]:d}),b=Object.assign(Object.assign({},c?.style),k);return h&&(b.flex=h),v&&!fe(v)&&(b.gap=v),P(ge.createElement(m,Object.assign({ref:i,className:q,style:b},Fe(f,["justify","wrap","align"])),l))}),ut=ht,ft=e=>{const{componentCls:i,calc:a}=e;return{[i]:Object.assign(Object.assign({},Be(e)),{margin:0,padding:0,listStyle:"none",[`${i}-item`]:{position:"relative",margin:0,paddingBottom:e.itemPaddingBottom,fontSize:e.fontSize,listStyle:"none","&-tail":{position:"absolute",insetBlockStart:e.itemHeadSize,insetInlineStart:a(a(e.itemHeadSize).sub(e.tailWidth)).div(2).equal(),height:`calc(100% - ${H(e.itemHeadSize)})`,borderInlineStart:`${H(e.tailWidth)} ${e.lineType} ${e.tailColor}`},"&-pending":{[`${i}-item-head`]:{fontSize:e.fontSizeSM,backgroundColor:"transparent"},[`${i}-item-tail`]:{display:"none"}},"&-head":{position:"absolute",width:e.itemHeadSize,height:e.itemHeadSize,backgroundColor:e.dotBg,border:`${H(e.dotBorderWidth)} ${e.lineType} transparent`,borderRadius:"50%","&-blue":{color:e.colorPrimary,borderColor:e.colorPrimary},"&-red":{color:e.colorError,borderColor:e.colorError},"&-green":{color:e.colorSuccess,borderColor:e.colorSuccess},"&-gray":{color:e.colorTextDisabled,borderColor:e.colorTextDisabled}},"&-head-custom":{position:"absolute",insetBlockStart:a(e.itemHeadSize).div(2).equal(),insetInlineStart:a(e.itemHeadSize).div(2).equal(),width:"auto",height:"auto",marginBlockStart:0,paddingBlock:e.customHeadPaddingVertical,lineHeight:1,textAlign:"center",border:0,borderRadius:0,transform:"translate(-50%, -50%)"},"&-content":{position:"relative",insetBlockStart:a(a(e.fontSize).mul(e.lineHeight).sub(e.fontSize)).mul(-1).add(e.lineWidth).equal(),marginInlineStart:a(e.margin).add(e.itemHeadSize).equal(),marginInlineEnd:0,marginBlockStart:0,marginBlockEnd:0,wordBreak:"break-word"},"&-last":{[`> ${i}-item-tail`]:{display:"none"},[`> ${i}-item-content`]:{minHeight:a(e.controlHeightLG).mul(1.2).equal()}}},[`&${i}-alternate,
        &${i}-right,
        &${i}-label`]:{[`${i}-item`]:{"&-tail, &-head, &-head-custom":{insetInlineStart:"50%"},"&-head":{marginInlineStart:a(e.marginXXS).mul(-1).equal(),"&-custom":{marginInlineStart:a(e.tailWidth).div(2).equal()}},"&-left":{[`${i}-item-content`]:{insetInlineStart:`calc(50% - ${H(e.marginXXS)})`,width:`calc(50% - ${H(e.marginSM)})`,textAlign:"start"}},"&-right":{[`${i}-item-content`]:{width:`calc(50% - ${H(e.marginSM)})`,margin:0,textAlign:"end"}}}},[`&${i}-right`]:{[`${i}-item-right`]:{[`${i}-item-tail,
            ${i}-item-head,
            ${i}-item-head-custom`]:{insetInlineStart:`calc(100% - ${H(a(a(e.itemHeadSize).add(e.tailWidth)).div(2).equal())})`},[`${i}-item-content`]:{width:`calc(100% - ${H(a(e.itemHeadSize).add(e.marginXS).equal())})`}}},[`&${i}-pending
        ${i}-item-last
        ${i}-item-tail`]:{display:"block",height:`calc(100% - ${H(e.margin)})`,borderInlineStart:`${H(e.tailWidth)} dotted ${e.tailColor}`},[`&${i}-reverse
        ${i}-item-last
        ${i}-item-tail`]:{display:"none"},[`&${i}-reverse ${i}-item-pending`]:{[`${i}-item-tail`]:{insetBlockStart:e.margin,display:"block",height:`calc(100% - ${H(e.margin)})`,borderInlineStart:`${H(e.tailWidth)} dotted ${e.tailColor}`},[`${i}-item-content`]:{minHeight:a(e.controlHeightLG).mul(1.2).equal()}},[`&${i}-label`]:{[`${i}-item-label`]:{position:"absolute",insetBlockStart:a(a(e.fontSize).mul(e.lineHeight).sub(e.fontSize)).mul(-1).add(e.tailWidth).equal(),width:`calc(50% - ${H(e.marginSM)})`,textAlign:"end"},[`${i}-item-right`]:{[`${i}-item-label`]:{insetInlineStart:`calc(50% + ${H(e.marginSM)})`,width:`calc(50% - ${H(e.marginSM)})`,textAlign:"start"}}},"&-rtl":{direction:"rtl",[`${i}-item-head-custom`]:{transform:"translate(50%, -50%)"}}})}},xt=e=>({tailColor:e.colorSplit,tailWidth:e.lineWidthBold,dotBorderWidth:e.wireframe?e.lineWidthBold:e.lineWidth*3,dotBg:e.colorBgContainer,itemPaddingBottom:e.padding*1.25}),vt=je("Timeline",e=>{const i=be(e,{itemHeadSize:10,customHeadPaddingVertical:e.paddingXXS,paddingInlineEnd:2});return[ft(i)]},xt);var yt=function(e,i){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&i.indexOf(n)<0&&(a[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(e);o<n.length;o++)i.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(a[n[o]]=e[n[o]]);return a};const kt=e=>{var{prefixCls:i,className:a,color:n="blue",dot:o,pending:k=!1,position:h,label:v,children:l}=e,x=yt(e,["prefixCls","className","color","dot","pending","position","label","children"]);const{getPrefixCls:m}=p.useContext(he),f=m("timeline",i),c=Z(`${f}-item`,{[`${f}-item-pending`]:k},a),r=/blue|red|green|gray/.test(n||"")?void 0:n,M=Z(`${f}-item-head`,{[`${f}-item-head-custom`]:!!o,[`${f}-item-head-${n}`]:!r});return p.createElement("li",Object.assign({},x,{className:c}),v&&p.createElement("div",{className:`${f}-item-label`},v),p.createElement("div",{className:`${f}-item-tail`}),p.createElement("div",{className:M,style:{borderColor:r,color:r}},o),p.createElement("div",{className:`${f}-item-content`},l))},Ne=kt;var ke=function(e,i){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&i.indexOf(n)<0&&(a[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(e);o<n.length;o++)i.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(a[n[o]]=e[n[o]]);return a};const jt=e=>{var{prefixCls:i,className:a,pending:n=!1,children:o,items:k,rootClassName:h,reverse:v=!1,direction:l,hashId:x,pendingDot:m,mode:f=""}=e,c=ke(e,["prefixCls","className","pending","children","items","rootClassName","reverse","direction","hashId","pendingDot","mode"]);const r=(b,A)=>f==="alternate"?b==="right"?`${i}-item-right`:b==="left"?`${i}-item-left`:A%2===0?`${i}-item-left`:`${i}-item-right`:f==="left"?`${i}-item-left`:f==="right"?`${i}-item-right`:b==="right"?`${i}-item-right`:"",M=Pe(k||[]),$=typeof n=="boolean"?null:n;n&&M.push({pending:!!n,dot:m||p.createElement(Ee,null),children:$}),v&&M.reverse();const P=M.length,I=`${i}-item-last`,O=M.filter(b=>!!b).map((b,A)=>{var G;const te=A===P-2?I:"",F=A===P-1?I:"",{className:K}=b,W=ke(b,["className"]);return p.createElement(Ne,Object.assign({},W,{className:Z([K,!v&&n?te:F,r((G=b?.position)!==null&&G!==void 0?G:"",A)]),key:b?.key||A}))}),d=M.some(b=>!!b?.label),q=Z(i,{[`${i}-pending`]:!!n,[`${i}-reverse`]:!!v,[`${i}-${f}`]:!!f&&!d,[`${i}-label`]:d,[`${i}-rtl`]:l==="rtl"},a,h,x);return p.createElement("ul",Object.assign({},c,{className:q}),O)},bt=jt;function St(e,i){return e&&Array.isArray(e)?e:He(i).map(a=>{var n,o;return Object.assign({children:(o=(n=a?.props)===null||n===void 0?void 0:n.children)!==null&&o!==void 0?o:""},a.props)})}var wt=function(e,i){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&i.indexOf(n)<0&&(a[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(e);o<n.length;o++)i.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(a[n[o]]=e[n[o]]);return a};const Le=e=>{const{getPrefixCls:i,direction:a,timeline:n}=p.useContext(he),{prefixCls:o,children:k,items:h,className:v,style:l}=e,x=wt(e,["prefixCls","children","items","className","style"]),m=i("timeline",o),f=De(m),[c,r,M]=vt(m,f),$=St(h,k);return c(p.createElement(bt,Object.assign({},x,{className:Z(n?.className,v,M,f),style:Object.assign(Object.assign({},n?.style),l),prefixCls:m,direction:a,items:$,hashId:r})))};Le.Item=Ne;const Ct=Le;var $t={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M715.8 493.5L335 165.1c-14.2-12.2-35-1.2-35 18.5v656.8c0 19.7 20.8 30.7 35 18.5l380.8-328.4c10.9-9.4 10.9-27.6 0-37z"}}]},name:"caret-right",theme:"outlined"};const Tt=$t;var Nt=function(i,a){return p.createElement(Se,we({},i,{ref:a,icon:Tt}))};const Lt=p.forwardRef(Nt);var Mt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M304 176h80v672h-80zm408 0h-64c-4.4 0-8 3.6-8 8v656c0 4.4 3.6 8 8 8h64c4.4 0 8-3.6 8-8V184c0-4.4-3.6-8-8-8z"}}]},name:"pause",theme:"outlined"};const It=Mt;var zt=function(i,a){return p.createElement(Se,we({},i,{ref:a,icon:It}))};const Ft=p.forwardRef(zt),Bt=({size:e=16})=>t.jsx("svg",{width:e,height:e+12,viewBox:"0 0 16 28",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M14 27.3438C13.8125 27.3438 13.6406 27.3073 13.4844 27.2344C13.3281 27.1615 13.1875 27.0729 13.0625 26.9688L1.0625 14.9375C0.9375 14.8333 0.838542 14.6979 0.765625 14.5312C0.692708 14.3646 0.65625 14.1875 0.65625 14C0.65625 13.8125 0.692708 13.6406 0.765625 13.4844C0.838542 13.3281 0.9375 13.1875 1.0625 13.0625L13.0625 1.0625C13.1875 0.9375 13.3281 0.838541 13.4844 0.765625C13.6406 0.692709 13.8229 0.65625 14.0312 0.65625C14.3854 0.65625 14.6927 0.786459 14.9531 1.04688C15.2135 1.30729 15.3438 1.625 15.3438 2C15.3438 2.1875 15.3073 2.36458 15.2344 2.53125C15.1615 2.69792 15.0625 2.83333 14.9375 2.9375L3.875 14L14.9375 25.0625C15.0625 25.1875 15.1615 25.3333 15.2344 25.5C15.3073 25.6667 15.3438 25.8333 15.3438 26C15.3438 26.375 15.2135 26.6927 14.9531 26.9531C14.6927 27.2135 14.375 27.3438 14 27.3438Z",fill:"#ABABAB"})});function Pt(){return t.jsx(t.Fragment,{children:t.jsx("div",{style:{height:"36px",width:"36px",borderRadius:"32px",border:"1px solid #DFE3E8",gap:"8px"},className:"flex items-center justify-center",children:t.jsx("div",{style:{width:"20px",height:"20px",backgroundSize:"Cover"},className:"icon_starting"})})})}function Et({data:e}){return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{style:{color:"#212B36",fontWeight:500,fontSize:"15px",lineHeight:"21px",marginLeft:"5px"},children:"Bắt đầu"}),t.jsx("div",{className:"mx-3 h-2 w-2 rounded-full bg-black"}),t.jsx("div",{style:{color:"#212B36",fontWeight:400,fontSize:"14px",lineHeight:"21px"},children:e.time_start})]}),t.jsxs("div",{className:"flex",style:{marginTop:"5px"},children:[t.jsx("div",{style:{height:"20px",width:"20px",marginLeft:"5px",marginRight:"5px"},className:"flex items-center justify-center",children:t.jsx("div",{style:{width:"15px",height:"18px",backgroundSize:"Cover"},className:"icon_marker"})}),t.jsx("div",{style:{color:"#637381",fontWeight:400,fontSize:"14px",lineHeight:"21px"},children:e.address})]})]})}function Ht(){return t.jsx(t.Fragment,{children:t.jsx("div",{style:{height:"36px",width:"36px",borderRadius:"32px",border:"1px solid #DFE3E8",gap:"8px"},className:"flex items-center justify-center",children:t.jsx("div",{style:{width:"20px",height:"20px",backgroundSize:"Cover"},className:"icon_ending"})})})}function Dt({data:e}){return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{style:{color:"#212B36",fontWeight:500,fontSize:"15px",lineHeight:"21px",marginLeft:"5px"},children:"Kết thúc"}),t.jsx("div",{className:"mx-3 h-2 w-2 rounded-full bg-black"}),t.jsx("div",{style:{color:"#212B36",fontWeight:400,fontSize:"14px",lineHeight:"21px"},children:e.time_end})]}),t.jsxs("div",{className:"flex",style:{marginTop:"5px"},children:[t.jsx("div",{style:{height:"20px",width:"20px",marginLeft:"5px",marginRight:"5px"},className:"flex items-center justify-center",children:t.jsx("div",{style:{width:"15px",height:"18px",backgroundSize:"Cover"},className:"icon_marker"})}),t.jsx("div",{style:{color:"#637381",fontWeight:400,fontSize:"14px",lineHeight:"21px"},children:e.address})]})]})}function Ot(){return t.jsx(t.Fragment,{children:t.jsx("div",{style:{height:"36px",width:"36px",borderRadius:"32px",border:"1px solid #DFE3E8",gap:"8px"},className:"flex items-center justify-center",children:t.jsx("div",{style:{width:"20px",height:"20px",backgroundSize:"Cover"},className:"icon_checking"})})})}function Wt({data:e}){return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{style:{color:"#212B36",fontWeight:500,fontSize:"15px",lineHeight:"21px",marginLeft:"5px"},children:"Viếng thăm"}),t.jsx("div",{className:"mx-3 h-2 w-2 rounded-full bg-black"}),t.jsx("div",{style:{color:"#212B36",fontWeight:400,fontSize:"14px",lineHeight:"21px"},children:e.time_checking})]}),t.jsxs("div",{className:"flex",style:{marginTop:"5px"},children:[t.jsx("div",{style:{height:"20px",width:"20px",marginLeft:"5px",marginRight:"5px"},className:"flex items-center justify-center",children:t.jsx("div",{style:{width:"15px",height:"18px",backgroundSize:"Cover"},className:"icon_user"})}),t.jsx("div",{style:{color:"#637381",fontWeight:400,fontSize:"14px",lineHeight:"21px"},children:e.retail_name})]}),t.jsxs("div",{className:"flex",style:{marginTop:"5px"},children:[t.jsx("div",{style:{height:"20px",width:"20px",marginLeft:"5px",marginRight:"5px"},className:"flex items-center justify-center",children:t.jsx("div",{style:{width:"15px",height:"18px",backgroundSize:"Cover"},className:"icon_marker"})}),t.jsx("div",{style:{color:"#637381",fontWeight:400,fontSize:"14px",lineHeight:"21px"},children:e.address})]})]})}function Rt(){return t.jsx(t.Fragment,{children:t.jsx("div",{style:{height:"36px",width:"36px",borderRadius:"32px",border:"1px solid #DFE3E8",gap:"8px"},className:"flex items-center justify-center",children:t.jsx("div",{style:{width:"20px",height:"20px",backgroundSize:"Cover"},className:"icon_distance"})})})}function At({data:e}){return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{style:{color:"#212B36",fontWeight:500,fontSize:"15px",lineHeight:"21px",marginLeft:"5px"},children:"Di chuyển"}),t.jsx("div",{className:"mx-3 h-2 w-2 rounded-full bg-black"}),t.jsx("div",{style:{color:"#212B36",fontWeight:400,fontSize:"14px",lineHeight:"21px"},children:e.time_moving})]}),t.jsxs("div",{className:"flex",style:{marginTop:"5px"},children:[t.jsx("div",{style:{height:"20px",width:"20px",marginLeft:"5px",marginRight:"5px"},className:"flex items-center justify-center",children:t.jsx("div",{style:{width:"18px",height:"20px",backgroundSize:"Cover",color:"#1877F2"},className:"icon_marker_blue"})}),t.jsxs("div",{style:{color:"#1877F2",fontWeight:400,fontSize:"14px",lineHeight:"21px"},children:[e.total_distance," Trip"]})]})]})}function Vt(){return t.jsx(t.Fragment,{children:t.jsx("div",{style:{height:"36px",width:"36px",borderRadius:"32px",border:"1px solid #DFE3E8",gap:"8px"},className:"flex items-center justify-center",children:t.jsx("div",{style:{width:"20px",height:"20px",backgroundSize:"Cover"},className:"icon_parking"})})})}function qt({data:e}){return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{style:{color:"#212B36",fontWeight:500,fontSize:"15px",lineHeight:"21px",marginLeft:"5px"},children:"Dừng"}),t.jsx("div",{className:"mx-3 h-2 w-2 rounded-full bg-black"}),t.jsx("div",{style:{color:"#212B36",fontWeight:400,fontSize:"14px",lineHeight:"21px"},children:e.time_stop})]}),t.jsxs("div",{className:"flex",style:{marginTop:"5px"},children:[t.jsx("div",{style:{height:"20px",width:"20px",marginLeft:"5px",marginRight:"5px"},className:"flex items-center justify-center",children:t.jsx("div",{style:{width:"15px",height:"18px",backgroundSize:"Cover"},className:"icon_marker"})}),t.jsx("div",{style:{color:"#637381",fontWeight:400,fontSize:"14px",lineHeight:"21px"},children:e.address})]})]})}function _t({options:e,loading:i}){const[a,n]=p.useState([]),[o,k]=p.useState(!1);p.useEffect(()=>{k(i)},[i]),p.useEffect(()=>{let m=[];if(e.details!=null)for(let f=0;f<e.details.length;f++){let c=e.details[f];c.type=="start"?m.push({dot:t.jsx(Pt,{}),children:t.jsx(Et,{data:{time_start:x(c.timestamp),address:c.address}})}):c.type=="checkin"?m.push({dot:t.jsx(Ot,{}),children:t.jsx(Wt,{data:{time_checking:`${x(c.startTime)} - ${x(c.endTime)}`,retail_name:c.storeName,address:c.address}})}):c.type=="move"?m.push({dot:t.jsx(Rt,{}),children:t.jsx(At,{data:{time_moving:`${x(c.startTime)} - ${x(c.endTime)}`,total_distance:`${h(c.distance)}`}})}):c.type=="stop"?m.push({dot:t.jsx(Vt,{}),children:t.jsx(qt,{data:{time_stop:`${x(c.startTime)} - ${x(c.endTime)}`,address:c.address}})}):c.type=="end"&&m.push({dot:t.jsx(Ht,{}),children:t.jsx(Dt,{data:{time_end:`${x(c.timestamp)}`,address:c.address}})})}n(m)},[e]);const h=m=>m<1e3?`${Math.round(m)} m`:`${Math.round(m/1e3)} km`,v=m=>m<60?`${Math.round(m)} giây`:m>=60&&m<3600?`${Math.round(m/60)} phút`:`${Math.round(m/3600)} giờ`,l=m=>Math.round(m*3.6),x=m=>{var f=new Date(m);return f.setUTCHours(f.getUTCHours()+7),`${f.getUTCHours()}:${f.getUTCMinutes()}`};return t.jsxs(t.Fragment,{children:[t.jsxs(me,{gutter:20,children:[t.jsx(X,{span:4,className:"card-container",children:t.jsx(ae,{children:t.jsx("div",{className:"wrap-card-container",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"flex items-center justify-center",style:{width:"64px",height:"64px",backgroundColor:"#8E33FF1F",gap:"8px",borderRadius:"15px"},children:t.jsx("div",{style:{width:"44px",height:"44px",backgroundSize:"Cover"},className:"icon_distance"})}),t.jsxs("div",{style:{marginLeft:"10px"},children:[t.jsx("div",{style:{opacity:"70%",color:"#212B36",fontSize:"14px",fontWeight:500},children:"Quãng đường di chuyển"}),t.jsx("div",{style:{fontWeight:600,fontSize:"22px",color:"#212B36",marginTop:"8px"},children:e.summary&&h(e.summary.move.distance)})]})]})})})}),t.jsx(X,{span:4,className:"card-container",children:t.jsx(ae,{children:t.jsx("div",{className:"wrap-card-container",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"flex items-center justify-center",style:{width:"64px",height:"64px",backgroundColor:"#00B8D91F",gap:"8px",borderRadius:"15px"},children:t.jsx("div",{style:{width:"44px",height:"44px",backgroundSize:"Cover"},className:"icon_clock"})}),t.jsxs("div",{style:{marginLeft:"10px"},children:[t.jsx("div",{style:{opacity:"70%",color:"#212B36",fontSize:"14px",fontWeight:500},children:"Thời gian di chuyển"}),t.jsx("div",{style:{fontWeight:600,fontSize:"22px",color:"#212B36",marginTop:"8px"},children:e.summary&&v(e.summary.move.totalTime)})]})]})})})}),t.jsx(X,{span:4,className:"card-container",children:t.jsx(ae,{children:t.jsx("div",{className:"wrap-card-container",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"flex items-center justify-center",style:{width:"64px",height:"64px",backgroundColor:"#FFAB001F",gap:"8px",borderRadius:"15px"},children:t.jsx("div",{style:{width:"44px",height:"44px",backgroundSize:"Cover"},className:"icon_speeding"})}),t.jsxs("div",{style:{marginLeft:"10px"},children:[t.jsx("div",{style:{opacity:"70%",color:"#212B36",fontSize:"14px",fontWeight:500},children:"Tốc độ trung bình"}),t.jsxs("div",{style:{fontWeight:600,fontSize:"22px",color:"#212B36",marginTop:"8px"},children:[e.summary&&l(e.summary.move.avgSpeed)," km/h"]})]})]})})})}),t.jsx(X,{span:6,className:"card-container",children:t.jsx(ae,{children:t.jsxs("div",{className:"flex ",children:[t.jsx("div",{className:"flex items-center justify-center",style:{width:"64px",height:"64px",backgroundColor:"#1877F21F",gap:"8px",borderRadius:"15px"},children:t.jsx("div",{style:{width:"44px",height:"44px",backgroundSize:"Cover"},className:"icon_parking"})}),t.jsxs("div",{style:{marginLeft:"10px",width:"100%"},className:"flex items-center",children:[t.jsxs("div",{style:{marginRight:"40px"},children:[t.jsx("div",{style:{opacity:"70%",color:"#212B36",fontSize:"14px",fontWeight:500},children:"Số lần dừng"}),t.jsx("div",{style:{fontWeight:600,fontSize:"22px",color:"#212B36",marginTop:"8px"},children:e.summary&&e.summary.stop.count})]}),t.jsx("div",{style:{border:"1px solid #D9D9D9",height:"100%"}}),t.jsxs("div",{style:{marginLeft:"25px"},children:[t.jsx("div",{style:{opacity:"70%",color:"#212B36",fontSize:"14px",fontWeight:500},children:"Thời gian dừng"}),t.jsx("div",{style:{fontWeight:600,fontSize:"22px",color:"#212B36",marginTop:"8px"},children:e.summary&&v(e.summary.stop.totalTime)})]})]})]})})}),t.jsx(X,{span:6,className:"card-container",children:t.jsx(ae,{children:t.jsxs("div",{className:"flex ",children:[t.jsx("div",{className:"flex items-center justify-center",style:{width:"64px",height:"64px",backgroundColor:"#FF56301F",gap:"8px",borderRadius:"15px"},children:t.jsx("div",{style:{width:"44px",height:"44px",backgroundSize:"Cover"},className:"icon_checking"})}),t.jsxs("div",{style:{marginLeft:"10px",width:"100%"},className:"flex items-center ",children:[t.jsxs("div",{style:{marginRight:"13px"},children:[t.jsx("div",{style:{opacity:"70%",color:"#212B36",fontSize:"14px",fontWeight:500},children:"Số lần viếng thăm"}),t.jsx("div",{style:{fontWeight:600,fontSize:"22px",color:"#212B36",marginTop:"8px"},children:e.summary&&e.summary.checkin.count})]}),t.jsx("div",{style:{border:"1px solid #D9D9D9",height:"100%"}}),t.jsxs("div",{style:{marginLeft:"25px"},children:[t.jsx("div",{style:{opacity:"70%",color:"#212B36",fontSize:"14px",fontWeight:500},children:"Thời gian viếng thăm"}),t.jsx("div",{style:{fontWeight:600,fontSize:"22px",color:"#212B36",marginTop:"8px"},children:e.summary&&v(e.summary.checkin.totalTime)})]})]})]})})})]}),t.jsx("div",{style:{marginTop:"20px"},children:t.jsx(me,{gutter:20,style:{marginLeft:"0px",marginRight:"0px"},children:t.jsx(Ke,{children:t.jsxs(me,{children:[t.jsxs(X,{span:6,style:{paddingTop:"1rem",paddingLeft:"1rem"},children:[t.jsx("div",{style:{fontWeight:500,fontSize:"16px",color:"#000000",height:"45px"},children:"Quãng đường di chuyển"}),t.jsx("div",{style:{padding:"8px 16px 8px 16px",maxHeight:"530px",overflowY:"auto"},children:a.length>0?t.jsx(Ct,{mode:"left",items:a}):t.jsx("div",{children:"Chưa có lộ trình"})})]}),t.jsx(X,{span:18,style:{height:"615px"},children:t.jsx(Qt,{options:e})})]})})})})]})}function Gt(){const[e,i]=p.useState(!1),a=()=>{i(!e)},n={iconStart:"https://files.ekgis.vn/sdks/tracking/assets/start-icon.png",iconEnd:"https://files.ekgis.vn/sdks/tracking/assets/end-icon.png",iconCheckin:"https://files.ekgis.vn/sdks/tracking/assets/check-icon.png",iconStop:"https://files.ekgis.vn/sdks/tracking/assets/stop-icon.png"};return t.jsxs("div",{id:"ekmapplf_tracking_legend",className:"ekmapplf_tracking-map-legend",children:[t.jsxs("div",{className:"ekmapplf_tracking-legend-title",onClick:a,children:[t.jsx("span",{className:`icon ${e?"ekmapplf_tracking-icon-square-minus":"ekmapplf_tracking-icon-square-plus"}`,style:{filter:"invert(100%) sepia(100%) saturate(0%) hue-rotate(187deg) brightness(105%) contrast(103%)"}}),t.jsx("span",{children:"Chú giải bản đồ"})]}),t.jsx("div",{className:`ekmapplf_tracking-legend-body ${e?"open":""}`,style:{maxHeight:e?"none":"0"},children:t.jsxs("ul",{children:[t.jsxs("li",{children:[t.jsx("span",{className:"ekmapplf_tracking-legend-icon",style:{backgroundImage:`url(${n.iconStart})`}}),"Vị trí bắt đầu"]}),t.jsxs("li",{children:[t.jsx("span",{className:"ekmapplf_tracking-legend-icon",style:{backgroundImage:`url(${n.iconEnd})`}}),"Vị trí kết thúc"]}),t.jsxs("li",{children:[t.jsx("span",{className:"ekmapplf_tracking-legend-icon",style:{backgroundImage:`url(${n.iconCheckin})`}}),"Vị trí khách hàng"]}),t.jsxs("li",{children:[t.jsx("span",{className:"ekmapplf_tracking-legend-icon",style:{backgroundImage:`url(${n.iconStop})`}}),"Vị trí điểm dừng"]})]})})]})}function se(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Xt(e){return e.type==="Feature"?e.geometry:e}function Me(e,i,a){a===void 0&&(a={});var n=se(e),o=se(i),k=R(o[1]-n[1]),h=R(o[0]-n[0]),v=R(n[1]),l=R(o[1]),x=Math.pow(Math.sin(k/2),2)+Math.pow(Math.sin(h/2),2)*Math.cos(v)*Math.cos(l);return Ye(2*Math.atan2(Math.sqrt(x),Math.sqrt(1-x)),a.units)}function Zt(e,i,a,n){n===void 0&&(n={});var o=se(e),k=R(o[0]),h=R(o[1]),v=R(a),l=Ue(i,n.units),x=Math.asin(Math.sin(h)*Math.cos(l)+Math.cos(h)*Math.sin(l)*Math.cos(v)),m=k+Math.atan2(Math.sin(v)*Math.sin(l)*Math.cos(h),Math.cos(l)-Math.sin(h)*Math.sin(x)),f=pe(m),c=pe(x);return ee([f,c],n.properties)}function ue(e,i,a){if(a===void 0&&(a={}),a.final===!0)return Kt(e,i);var n=se(e),o=se(i),k=R(n[0]),h=R(o[0]),v=R(n[1]),l=R(o[1]),x=Math.sin(h-k)*Math.cos(l),m=Math.cos(v)*Math.sin(l)-Math.sin(v)*Math.cos(l)*Math.cos(h-k);return pe(Math.atan2(x,m))}function Kt(e,i){var a=ue(i,e);return a=(a+180)%360,a}function Yt(e,i,a){a===void 0&&(a={});for(var n=Xt(e),o=n.coordinates,k=0,h=0;h<o.length&&!(i>=k&&h===o.length-1);h++)if(k>=i){var v=i-k;if(v){var l=ue(o[h],o[h-1])-180,x=Zt(o[h],v,l,a);return x}else return ee(o[h])}else k+=Me(o[h],o[h+1],a);return ee(o[o.length-1])}function Ut(e,i){return i===void 0&&(i={}),Je(e,function(a,n){var o=n.geometry.coordinates;return a+Me(o[0],o[1],i)},0)}const Jt=({map:e,segmentData:i,options:a,animID:n,timeoutID:o})=>{const k=p.useRef(null),h=p.useRef(null),[v,l]=p.useState(a.animation.follow),[x,m]=p.useState(a.animation.animate),[f,c]=p.useState(10),[r,M]=p.useState(!0),$=[{value:1,label:"x1"},{value:2,label:"x2"},{value:5,label:"x5"},{value:10,label:"x10"},{value:20,label:"x20"},{value:100,label:"x100"}];var P=0,I=e.getContainer(),O=0,d=[];function q(F,K){if(!e){A();return}O=F,F==0&&(d=[],e.getSource("LocationHistory")&&e.getSource("LocationHistory").setData({type:"FeatureCollection",features:[]}));const W=K[F];if(!W){O=F-1;return}if(W.computed.time){let y=W.computed.time*1e3/f;if(W.computed.speed){let T=function(S){ie||(Y=W.loc1.loc,ie=S);const u=(S-ie)/(Number(W.computed.time?.toString())*1e3/f);if(!(u>1||!x)){var j=ye([W.loc1.loc,W.loc2.loc]),C=Ut(j),w=Yt(j,C*u).geometry.coordinates,_=ue(ee(Y),ee(w));Y[0]!==w[0]&&Y[1]!==w[1]&&(P=_),Y=w,v&&e.panTo(w,{animate:!0,essential:!0,curve:1.42,duration:100,pitch:60,bearing:P}),e.getSource("locationMarker")&&e.getSource("locationMarker").setData({type:"FeatureCollection",features:[ee(w,{bearing:P})]}),d=d.concat([w]),d.length>1&&e.getSource("LocationHistory")&&e.getSource("LocationHistory").setData({type:"FeatureCollection",features:[ye(d)]}),k.current=requestAnimationFrame(T)}};var ie,Y;k.current=requestAnimationFrame(T),n(k.current)}F++,r&&F==K.length&&(F=0),h.current=setTimeout(q.bind(this),y,F,K),o(h.current)}}p.useEffect(()=>(x?(q(O,i),e.setPaintProperty(`ek-tracking-his-${I.id}-LineString`,"line-color","#b5b5b5"),e.setPaintProperty(`ek-tracking-his-${I.id}-LineString`,"line-opacity",.5),e.setLayoutProperty(`ek-tracking-his-${I.id}-LineString-arrow`,"visibility","none"),e.setLayoutProperty(`ek-tracking-his-${I.id}-LineString`,"visibility","none"),e.setLayoutProperty("locationMarker","visibility","visible"),e.setLayoutProperty("LocationHistory","visibility","visible")):(clearTimeout(h.current),e.setPaintProperty(`ek-tracking-his-${I.id}-LineString`,"line-color",a.route.lineCorlor),e.setPaintProperty(`ek-tracking-his-${I.id}-LineString`,"line-opacity",a.route.lineOpacity),e.setLayoutProperty(`ek-tracking-his-${I.id}-LineString`,"visibility","visible"),e.setLayoutProperty(`ek-tracking-his-${I.id}-LineString-arrow`,"visibility","visible"),e.setLayoutProperty("locationMarker","visibility","none"),e.setLayoutProperty("LocationHistory","visibility","none")),()=>{k.current&&cancelAnimationFrame(k.current),h.current&&clearTimeout(h.current)}),[e,i,a,v,x,f]);const b=()=>{m(!x)},A=()=>{m(!1),O=0},G=F=>{c(F)},te=F=>{F.target.checked&&e.setZoom(17),l(!v)};return t.jsxs("div",{id:"ekmapplf_tracking_control",className:"ekmapplf_tracking-map-control",children:[t.jsxs(ut,{gap:"small",align:"center",justify:"center",style:{marginBottom:"10px"},children:[t.jsx(xe,{icon:t.jsx(Lt,{}),disabled:x,onClick:b}),t.jsx(xe,{icon:t.jsx(Ft,{}),disabled:!x,onClick:b}),t.jsx(Oe,{defaultValue:f,style:{width:"75px"},onChange:G,options:$})]}),t.jsx(We,{onChange:te,checked:v,children:"Theo dõi lộ trình"})]})},de=window.ekmapplf;function Qt({options:e}){const i=p.useRef(null),a=p.useState(null);p.useState([]),p.useState([]);const[n,o]=p.useState({map:null,Data:[],options:null}),k=p.useRef(null),h=p.useRef(null),l=Qe({},{center:[105,17],zoom:4.5,pageNumber:1,pageSize:5e3,icon:{track:"https://files.ekgis.vn/sdks/tracking/assets/custom_marker.png",navigation:"https://files.ekgis.vn/sdks/tracking/assets/arrow.png",checkin:"https://files.ekgis.vn/sdks/tracking/assets/check-icon.png",start:"https://files.ekgis.vn/sdks/tracking/assets/start-icon.png",end:"https://files.ekgis.vn/sdks/tracking/assets/end-icon.png",stop:"https://files.ekgis.vn/sdks/tracking/assets/stop-icon.png"},route:{visible:!0,lineCorlor:"#01579B",lineWidth:4,lineOpacity:.8},animation:{follow:!0,animate:!0}},e);if(l.apiKey===""||!l.apiKey)throw new Error("Parameter apiKey not valid");if(l.projectId===""||!l.projectId)throw new Error("Parameter projectId not valid");if(l.objectId===""||!l.objectId)throw new Error("Parameter objectId not valid");if(l.from_time===""||!l.from_time)throw new Error("Parameter from_time not valid");if(l.to_time===""||!l.to_time)throw new Error("Parameter to_time not valid");const x=()=>{try{let O=function(){var y={type:"FeatureCollection",features:[]};r.getSource("LocationHistory")?r.getSource("LocationHistory").setData(y):(r.addSource("LocationHistory",{type:"geojson",data:y}),r.addLayer({id:"LocationHistory",type:"line",source:"LocationHistory",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":l.route.lineCorlor,"line-width":l.route.lineWidth,"line-opacity":l.route.lineOpacity}}))};var c;a.current=new re.Map({container:i.current,center:l.center,zoom:l.zoom,minZoom:1});var r=a.current;const d=r.getContainer();r.setPadding({top:100,bottom:100,left:100,right:100}),new de.VectorBaseMap("OSM:Bright",l.apiKey).addTo(r);var M=new de.control.BaseMap({id:"ekmapplf_tracking_ctrl_basemap_"+d.id,baseLayers:[{id:"OSM:Bright",title:"Bản đồ nền Sáng",thumbnail:"https://docs.ekgis.vn/assets/map-sang.png",width:"50px",height:"50px"},{id:"OSM:Standard",title:"Bản đồ nền Tiêu chuẩn",thumbnail:"https://docs.ekgis.vn/assets/map-chuan.png",width:"50px",height:"50px"},{id:"OSM:Gray",title:"Bản đồ nền Xám",thumbnail:"https://docs.ekgis.vn/assets/xam-map.png",width:"50px",height:"50px"},{id:"OSM:Night",title:"Bản đồ nền Đêm",thumbnail:"https://docs.ekgis.vn/assets/dem-map.png",width:"50px",height:"50px"},{id:"OSM:Dark",title:"Bản đồ nền Đêm xanh coban",thumbnail:"https://docs.ekgis.vn/assets/xanhcoban-map.png",width:"50px",height:"50px"},{id:"OSM:Pencil",title:"Bản đồ nền Bút chì",thumbnail:"https://docs.ekgis.vn/assets/chi-map.png",width:"50px",height:"50px"},{id:"OSM:Pirates",title:"Bản đồ nền Cổ điển",thumbnail:"https://docs.ekgis.vn/assets/dien-map.png",width:"50px",height:"50px"},{id:"OSM:Wood",title:"Bản đồ nền Gỗ",thumbnail:"https://docs.ekgis.vn/assets/go-map.png",width:"50px",height:"50px"}]});r.addControl(M,"bottom-left"),M.on("changeBaseLayer",async function(y){await new de.VectorBaseMap(y.layer,l.apiKey).addTo(r),setTimeout(()=>{b(l.from_time,l.to_time,l.pageNumber,l.pageSize)},500)}),r.addControl(new re.NavigationControl({visualizePitch:!0}),"bottom-right");var $=!1;r.getPitch()>0?$=!0:$=!1;var P="maplibregl-terrain2d-control",I="Hiển thị 2D";$||(P="maplibregl-terrain3d-control",I="Bản đồ 3D");let q=new de.control.Button({className:"btn-ctl-group "+P,icon:"none",tooltip:I});q.on("click",y=>{$=!$,$?(y._div.className=y._div.className.replaceAll("maplibregl-terrain3d-control","maplibregl-terrain2d-control"),y._div.title="Hiển thị 2D"):(y._div.className=y._div.className.replaceAll("maplibregl-terrain2d-control","maplibregl-terrain3d-control"),y._div.title="Hiển thị 3D"),$?(r.easeTo({pitch:60}),r.setLayoutProperty("building-3d","visibility","visible")):(r.easeTo({pitch:0}),r.setLayoutProperty("building-3d","visibility","none"))}),r.addControl(q,"bottom-right"),r.addControl(new re.FullscreenControl,"bottom-right"),r.on("load",()=>{try{b(l.from_time,l.to_time,l.pageNumber,l.pageSize)}catch(y){console.error("Error:",y)}});const b=async(y,T,S,u)=>{let j=await A(y,T,S,u);await G(j);let C=await W(j);j.length&&j[0].coordinates&&r.easeTo({center:j[0].coordinates,duration:100,zoom:16}),console.log(a.current),setTimeout(()=>o({map:a.current,Data:C,options:l}),1e3)},A=async(y,T,S,u)=>{let j=`https://api.ekgis.vn/v2/tracking/locationHistory/summary/${l.projectId}/${l.objectId}?api_key=${l.apiKey}&from_time=${y}&to_time=${T}`;var _=(await(await fetch(j)).json()).details;return _},G=y=>{let T={type:"FeatureCollection",features:[]},S={type:"FeatureCollection",features:[]},u={type:"FeatureCollection",features:[]};if(y.forEach(C=>{const w={type:"Feature",properties:C.type!=="move"?C:{},geometry:C.type==="move"?C.route.geometry:{type:"Point",coordinates:C.coordinates}};C.type==="move"?T.features.push(w):C.type==="checkin"?S.features.push(w):u.features.push(w)}),te(T),F(S,u),y.length){var j=et(T);r.fitBounds(j,{padding:100,maxZoom:14,duration:1e3})}O(),ie()},te=y=>{try{if(!r.getImage("icon_arrow")){var T='<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M19.2901 9.1698L7.70015 3.0698C4.95015 1.6198 1.96015 4.5498 3.35015 7.3298L4.97015 10.5698C5.42015 11.4698 5.42015 12.5298 4.97015 13.4298L3.35015 16.6698C1.96015 19.4498 4.95015 22.3698 7.70015 20.9298L19.2901 14.8298C21.5701 13.6298 21.5701 10.3698 19.2901 9.1698Z" stroke="#292D32" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" fill="#e50027"/></svg>',S=new Image;S.onload=function(){r.hasImage("icon_arrow")||r.addImage("icon_arrow",S)},S.src="data:image/svg+xml;charset=utf-8;base64,"+btoa(T)}r.getSource(`ek-tracking-his-${d.id}-line-source`)?r.getSource(`ek-tracking-his-${d.id}-line-source`).setData(y):(r.addSource(`ek-tracking-his-${d.id}-line-source`,{type:"geojson",data:y}),r.addLayer({id:`ek-tracking-his-${d.id}-LineString`,type:"line",source:`ek-tracking-his-${d.id}-line-source`,layout:{"line-join":"round","line-cap":"round",visibility:l.route.visible?"visible":"none"},paint:{"line-color":l.route.lineCorlor,"line-width":l.route.lineWidth,"line-opacity":l.route.lineOpacity},filter:["==","$type","LineString"]}),r.addLayer({id:`ek-tracking-his-${d.id}-LineString-arrow`,type:"symbol",source:`ek-tracking-his-${d.id}-line-source`,layout:{"symbol-placement":"line","icon-ignore-placement":!0,"symbol-spacing":100,"icon-image":"icon_arrow","icon-size":{stops:[[13,.35],[16,.5],[18,.625],[21,.75]]}}}))}catch(u){console.error("Error setLine:",u)}},F=async(y,T)=>{try{let S=function(u){if(u||u!=""){const j=new Date(u);return new Intl.DateTimeFormat("en-GB",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",timeZone:"Asia/Ho_Chi_Minh"}).format(j)}else return"Không có thông tin"};if(!r.getImage("marker-start")){const u=await r.loadImage(l.icon.start);r.addImage("marker-start",u.data)}if(!r.getImage("marker-end")){const u=await r.loadImage(l.icon.end);r.addImage("marker-end",u.data)}if(!r.getImage("marker-check")){const u=await r.loadImage(l.icon.checkin);r.addImage("marker-check",u.data)}if(!r.getImage("marker-stop")){const u=await r.loadImage(l.icon.stop);r.addImage("marker-stop",u.data)}r.getSource(`ek-tracking-his-${d.id}-track-source`)?r.getSource(`ek-tracking-his-${d.id}-track-source`).setData(T):(r.addSource(`ek-tracking-his-${d.id}-track-source`,{type:"geojson",data:T}),r.addLayer({id:`ek-tracking-his-${d.id}-track-point`,type:"symbol",source:`ek-tracking-his-${d.id}-track-source`,layout:{"icon-image":["match",["get","type"],"start","marker-start","end","marker-end","marker-stop"],"icon-overlap":"cooperative","icon-anchor":"bottom","icon-size":.7,"icon-offset":["case",["==",["get","type"],"start"],["literal",[20,5]],["==",["get","type"],"end"],["literal",[20,5]],["literal",[0,0]]]}}),r.on("mouseenter",`ek-tracking-his-${d.id}-track-point`,u=>{r.getCanvas().style.cursor="pointer";const j=[[u.point.x-5,u.point.y-5],[u.point.x+5,u.point.y+5]];let w=r.queryRenderedFeatures(j,{layers:[`ek-tracking-his-${d.id}-track-point`]})[0],_="default";w.properties.type!="stop"&&(_=w.properties.type),c&&c.remove(),c=new re.Popup({className:"ek-tracking-his-popup",closeButton:!1,anchor:"bottom"}).setLngLat(w.geometry.coordinates).setHTML(`
                                        <div class="ek-tracking-his-popup-info">
                                            <span class="ek-tracking-his-popup-icon ekmapplf_tracking-icon-marker ekmapplf_tracking-icon-${_}-color"></span>
                                            <span>${w.properties.address}</span>
                                        </div>
                                        ${w.properties.type!=="stop"?`
                                            <div class="ek-tracking-his-popup-info">
                                                <span class="ek-tracking-his-popup-icon ekmapplf_tracking-icon-clock ekmapplf_tracking-icon-${_}-color"></span>
                                                <span>${S(w.properties.timestamp)}</span>
                                            </div>`:`
                                            <div class="ek-tracking-his-popup-info">
                                                <span class="ek-tracking-his-popup-icon">
                                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                                                        <path d="M464 256A208 208 0 1 1 48 256a208 208 0 1 1 416 0zM0 256a256 256 0 1 0 512 0A256 256 0 1 0 0 256zM232 120V256c0 8 4 15.5 10.7 20l96 64c11 7.4 25.9 4.4 33.3-6.7s4.4-25.9-6.7-33.3L280 243.2V120c0-13.3-10.7-24-24-24s-24 10.7-24 24z" fill="#51CF66"/>
                                                    </svg>
                                                </span>
                                                <span>${S(w.properties.startTime)}</span>
                                            </div>
                                            ${w.properties.endTime!==""?`
                                                <div class="ek-tracking-his-popup-info">
                                                    <span class="ek-tracking-his-popup-icon">
                                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                                                            <path d="M464 256A208 208 0 1 1 48 256a208 208 0 1 1 416 0zM0 256a256 256 0 1 0 512 0A256 256 0 1 0 0 256zM232 120V256c0 8 4 15.5 10.7 20l96 64c11 7.4 25.9 4.4 33.3-6.7s4.4-25.9-6.7-33.3L280 243.2V120c0-13.3-10.7-24-24-24s-24 10.7-24 24z" fill="#FF6B6B"/>
                                                        </svg>
                                                    </span>
                                                    <span>${S(w.properties.endTime)}</span>
                                                </div>`:""} `}
                                    `).setOffset([0,-20]).addTo(r)}),r.on("mouseleave",`ek-tracking-his-${d.id}-track-point`,()=>{r.getCanvas().style.cursor="",c&&c.remove()})),r.getSource(`ek-tracking-his-${d.id}-check-source`)?r.getSource(`ek-tracking-his-${d.id}-check-source`).setData(y):(r.addSource(`ek-tracking-his-${d.id}-check-source`,{type:"geojson",data:y,cluster:!0,clusterMaxZoom:14,clusterRadius:50}),r.addLayer({id:`ek-tracking-his-${d.id}-check-clusters`,type:"circle",source:`ek-tracking-his-${d.id}-check-source`,paint:{"circle-color":["step",["get","point_count"],"#90D667",10,"#EFCD41",50,"#FF0012"],"circle-radius":12,"circle-stroke-color":["step",["get","point_count"],"#90D667",10,"#EFCD41",50,"#FF0012"],"circle-stroke-opacity":.7,"circle-stroke-width":5},filter:["all",["has","point_count"]]}),r.addLayer({id:`ek-tracking-his-${d.id}-check-cluster-count`,type:"symbol",source:`ek-tracking-his-${d.id}-check-source`,layout:{"text-field":"{point_count_abbreviated}","text-size":12},filter:["all",["has","point_count"]]}),r.addLayer({id:`ek-tracking-his-${d.id}-check-point`,type:"symbol",source:`ek-tracking-his-${d.id}-check-source`,layout:{"icon-image":"marker-check","icon-overlap":"always","icon-anchor":"bottom","icon-size":.7},filter:["all",["!has","point_count"]]}),r.on("mouseenter",`ek-tracking-his-${d.id}-check-clusters`,()=>{r.getCanvas().style.cursor="pointer"}),r.on("mouseleave",`ek-tracking-his-${d.id}-check-clusters`,()=>{r.getCanvas().style.cursor=""}),r.on("click",`ek-tracking-his-${d.id}-check-clusters`,async u=>{const j=r.queryRenderedFeatures(u.point,{layers:[`ek-tracking-his-${d.id}-check-clusters`]}),C=j[0].properties.cluster_id,w=await r.getSource(`ek-tracking-his-${d.id}-check-source`).getClusterExpansionZoom(C);r.easeTo({center:j[0].geometry.coordinates,zoom:w})}),r.on("mouseenter",`ek-tracking-his-${d.id}-check-point`,u=>{r.getCanvas().style.cursor="pointer";const j=[[u.point.x-5,u.point.y-5],[u.point.x+5,u.point.y+5]],C=r.queryRenderedFeatures(j,{layers:[`ek-tracking-his-${d.id}-check-point`]});c&&c.remove(),c=new re.Popup({className:"ek-tracking-his-popup",closeButton:!1,anchor:"bottom"}).setLngLat(C[0].geometry.coordinates).setHTML(`<div class="ek-tracking-his-popup-info">
                                    <span class="ek-tracking-his-popup-icon ekmapplf_tracking-icon-marker ekmapplf_tracking-icon-default-color"></span>
                                    <span>${C[0].properties.address}</span>
                                </div>
                                <div class="ek-tracking-his-popup-info">
                                    <span class="ek-tracking-his-popup-icon">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M464 256A208 208 0 1 1 48 256a208 208 0 1 1 416 0zM0 256a256 256 0 1 0 512 0A256 256 0 1 0 0 256zM232 120V256c0 8 4 15.5 10.7 20l96 64c11 7.4 25.9 4.4 33.3-6.7s4.4-25.9-6.7-33.3L280 243.2V120c0-13.3-10.7-24-24-24s-24 10.7-24 24z" fill="#51CF66"/></svg>
                                    </span>
                                    <span>${S(C[0].properties.startTime)}</span>
                                </div>
                                ${C[0].properties.endTime!=""?`
                                    <div class="ek-tracking-his-popup-info">
                                        <span class="ek-tracking-his-popup-icon">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M464 256A208 208 0 1 1 48 256a208 208 0 1 1 416 0zM0 256a256 256 0 1 0 512 0A256 256 0 1 0 0 256zM232 120V256c0 8 4 15.5 10.7 20l96 64c11 7.4 25.9 4.4 33.3-6.7s4.4-25.9-6.7-33.3L280 243.2V120c0-13.3-10.7-24-24-24s-24 10.7-24 24z" fill="#FF6B6B"/></svg>
                                        </span>
                                        <span>${S(C[0].properties.endTime)}</span>
                                    </div>`:""}
                                `).setOffset([0,-20]).addTo(r)}),r.on("mouseleave",`ek-tracking-his-${d.id}-check-point`,()=>{r.getCanvas().style.cursor="",c&&c.remove()}))}catch(S){console.error("Error setPoints:",S)}},K=async y=>{try{let u=[];if(y.forEach(j=>{j.type==="move"&&(u=u.concat(j.route.geometry.coordinates))}),!r.getImage("marker-navigation")){const j=await r.loadImage(l.icon.navigation);r.addImage("marker-navigation",j.data)}var T={type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Point",coordinates:u[0]}}]},S={type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"LineString",coordinates:[u[0]]}}]};r.getSource(`ek-tracking-his-${d.id}-navigation-line-source`)?r.getSource(`ek-tracking-his-${d.id}-navigation-line-source`).setData(S):(r.addSource(`ek-tracking-his-${d.id}-navigation-line-source`,{type:"geojson",data:S}),r.addLayer({id:`ek-tracking-his-${d.id}-navigation-line-animation`,source:`ek-tracking-his-${d.id}-navigation-line-source`,type:"line",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":l.route.lineCorlor,"line-width":l.route.lineWidth,"line-opacity":.8}})),r.getSource(`ek-tracking-his-${d.id}-navigation-point-source`)?r.getSource(`ek-tracking-his-${d.id}-navigation-point-source`).setData(T):(r.addSource(`ek-tracking-his-${d.id}-navigation-point-source`,{type:"geojson",data:T}),r.addLayer({id:`ek-tracking-his-${d.id}-navigation-point-animation`,source:`ek-tracking-his-${d.id}-navigation-point-source`,type:"symbol",layout:{"icon-image":"marker-navigation","icon-rotate":["get","bearing"],"icon-rotation-alignment":"map","icon-allow-overlap":!0,"icon-overlap":"always","icon-ignore-placement":!0,"icon-size":.7}}))}catch(u){console.error("Error setNavigation:",u)}},W=async y=>{var T,S,u,j={type:"FeatureCollection",features:[]};return y.forEach(N=>{if(N.type==="move")for(let s=0;s<N.route.locations.length;s++){let L=N.route.locations[s],g={type:"Feature",properties:{time:L.timestamp,ele:0,speed:L.speed},geometry:{type:"Point",coordinates:L.coordinates}};j.features.push(g)}else if(N.type==="stop"||N.type==="checkin"){let s={type:"Feature",properties:{time:N.timestamp,ele:0,speed:-1},geometry:{type:"Point",coordinates:N.coordinates}};j.features.push(s)}}),T=C(j),S=w(T),S;function C(N){var s={segments:[],id:e.objectId};let L=[];s.segments.push(L);for(let B=0;B<N.features.length;B++){var g=N.features[B];let E={loc:g.geometry.coordinates,time:new Date(g.properties.time).getTime(),ele:g.properties.ele};L.push(E)}return s}function w(N){const s=[];for(let oe=0;oe<N.segments.length;oe++){const ne=N.segments[oe];for(let U=1;U<ne.length;U++){const D=ne[U-1],z=ne[U];var L=D.time,g=z.time,B=new Date(L),E=new Date(g);let J=0;B.getDate()===E.getDate()&&B.getMonth()===E.getMonth()&&B.getFullYear()===E.getFullYear()&&(J=_(D.loc[1],D.loc[0],z.loc[1],z.loc[0],D.ele,z.ele));const V={computed:{distance:J},loc1:D,loc2:z};if(D.ele&&z.ele&&(V.computed.ele=z.ele),D.time&&z.time){const{speed:Q,time:le}=Ie(J,D.time,z.time),ze=Q;V.computed.speed=Q,V.computed.time=le,V.computed.filteredSpeed=ze}D.temp&&z.temp&&(V.computed.temp=(D.temp+z.temp)/2),z.hr&&(V.computed.hr=z.hr),z.cad&&(V.computed.cad=z.cad),V.computed.speed&&s.push(V)}}return s}function _(N,s,L,g,B,E){const ne=N*Math.PI/180,U=L*Math.PI/180,D=(L-N)*Math.PI/180,z=(g-s)*Math.PI/180,J=Math.sin(D/2)*Math.sin(D/2)+Math.cos(ne)*Math.cos(U)*Math.sin(z/2)*Math.sin(z/2);let Q=6371e3*(2*Math.atan2(Math.sqrt(J),Math.sqrt(1-J)));if(B!==void 0&&E!==void 0){const le=E-B;le!==0&&(Q=Math.sqrt(Math.pow(Q,2)+Math.pow(le,2)))}return Q}function Ie(N,s,L){const g=L/1e3-s/1e3;return{speed:N/g*3.6,time:g}}function ii(N){let s={};s.distance=0;for(let L=0;L<N.length;L++){const g=N[L].computed;let B;if(N[L-1]&&(B=N[L-1].computed),s.distance+=g.distance,g.ele&&(s.maxEle=s.maxEle||0,s.minEle=s.minEle||0,s.gainEle=s.gainEle||0,s.totEle=s.totEle||0,g.ele>s.maxEle&&(s.maxEle=g.ele),g.ele<s.minEle&&(s.minEle=g.ele),B&&B.ele)){let E=g.ele-B.ele;E>0?(s.gainEle+=E,s.totEle+=E):E<0&&(s.totEle+=E)}g.time&&(s.totalTime=s.totalTime||0,s.totalTime+=g.time,g.speed&&g.filteredSpeed&&(s.avgSpeed=s.avgSpeed||0,s.avgMovingSpeed=s.avgMovingSpeed||0,s.movingTime=s.movingTime||0,s.maxSpeed=s.maxSpeed||0,s.avgSpeed+=g.speed*g.time,g.speed>5&&(s.avgMovingSpeed+=g.speed*g.time,s.movingTime+=g.time),g.filteredSpeed>s.maxSpeed&&g.filteredSpeed<200&&(s.maxSpeed=g.filteredSpeed,s.maxSpeedIndex=L)),g.temp&&(s.avgTemp=s.avgTemp||0,s.maxTemp=s.maxTemp||0,s.avgTemp+=g.temp*g.time,g.temp>s.maxTemp&&(s.maxTemp=g.temp)),g.hr&&(s.avgHr=s.avgHr||0,s.maxHr=s.maxHr||0,s.avgHr+=g.hr*g.time,g.hr>s.maxHr&&(s.maxHr=g.hr,s.maxHrIndex=L)),g.cad&&(s.avgCad=s.avgCad||0,s.maxCad=s.maxCad||0,s.avgCad+=g.cad*g.time,g.cad>s.maxCad&&(s.maxCad=g.cad,s.maxCadIndex=L)))}return s.totalTime&&(s.avgSpeed=s.avgSpeed||0,s.avgCad=s.avgCad||0,s.avgHr=s.avgHr||0,s.avgTemp=s.avgTemp||0,s.avgSpeed/=s.totalTime,s.avgCad/=s.totalTime,s.avgHr/=s.totalTime,s.avgTemp/=s.totalTime,s.totalTime/=3600),s.movingTime&&(s.avgMovingSpeed=s.avgMovingSpeed||0,s.avgMovingSpeed/=s.movingTime,s.movingTime/=3600),s}};async function ie(){if(!r.getImage("marker-navigation")){const T=await r.loadImage(l.icon.navigation);r.addImage("marker-navigation",T.data)}var y={type:"FeatureCollection",features:[]};r.getSource("locationMarker")?r.getSource("locationMarker").setData(y):(r.addSource("locationMarker",{type:"geojson",data:y}),r.addLayer({id:"locationMarker",source:"locationMarker",type:"symbol",layout:{"icon-size":.7,"icon-offset":[0,-10],"icon-allow-overlap":!0,"icon-image":"marker-navigation","icon-rotate":["get","bearing"],"icon-rotation-alignment":"map","icon-overlap":"always","icon-ignore-placement":!0}}))}const Y=y=>{r.setLayoutProperty(`ek-tracking-his-${d.id}-LineString`,"visibility",y)}}catch(O){console.error("Error initializing map:",O)}};p.useEffect(()=>(x(),()=>{k.current&&window.cancelAnimationFrame(k.current),h.current&&window.clearTimeout(h.current)}),[e]);const m=c=>{console.log("animationID",c),k.current=c},f=c=>{console.log("timeoutAnimation",c),h.current=c};return t.jsxs("div",{ref:i,id:"ekmap-tracking-his-map",children:[n.map!=null&&t.jsx(Jt,{map:n.map,segmentData:n.Data,options:n.options,animID:m,timeoutID:f}),t.jsx(Gt,{})]})}function ei({employee:e}){const[i,a]=p.useState(Date.now()),[n,o]=p.useState(ce(new Date().setHours(0,0,0).toString())),[k,h]=p.useState(ce(new Date().setHours(24,0,0).toString())),[v,l]=p.useState(!0),x=r=>{setTimeout(()=>{a(r),o(ce(ve(r).today)),h(ce(ve(r).nextday))},200)},[m,f]=p.useState({apiKey:"w1Dlh2wRon7mE6sL196TgvLS45fw02uon74pJ0rc",projectId:"",objectId:"",from_time:n,to_time:k}),c=async(r,M)=>{l(!0);let $=`https://api.ekgis.vn/v2/tracking/locationHistory/summary/${r}/${M}?from_time=${n}&to_time=${k}&api_key=${m.apiKey}`;console.log($);let P=await qe.get($);P.statusText=="OK"&&f(I=>({...I,summary:P.data.summary,details:P.data.details})),l(!1)};return p.useEffect(()=>{(async()=>{try{const r=await Re.get(`/api/method/mbw_dms.api.user.get_project_object_id?name=${e}`);f(M=>({...M,projectId:r.result["Project ID"],objectId:e})),c(r.result["Project ID"],e)}catch(r){tt.error(r?.message||"Something was wrong!!!")}})()},[e]),p.useEffect(()=>{c(m.projectId,m.objectId)},[n,k]),t.jsxs(t.Fragment,{children:[t.jsx(Ze,{title:t.jsxs("div",{className:"flex items-center",children:[t.jsxs(Ae,{to:"/employee-monitor",children:[" ",t.jsx(Bt,{})]}),t.jsx("span",{className:"ml-4",children:"Nhân viên Trần Đình Tùng - NV1234"})]}),customButton:t.jsx("div",{className:"p-4 border border-solid border-transparent border-b-[#F5F5F5]",children:t.jsx(Xe,{defaultValue:Ve(i),format:"DD-MM-YYYY",onChange:x})})}),t.jsx("div",{className:"border border-solid border-[#F5F5F5] rounded-lg",children:t.jsx("div",{id:"travel",className:"relative",children:m.projectId&&m.objectId&&t.jsx(_t,{options:m,loading:v})})})]})}function ti(){p.useState("list");const{employee_id:e}=_e();return t.jsx(t.Fragment,{children:t.jsx(ei,{employee:e})})}function di(){return t.jsxs(t.Fragment,{children:[t.jsx(Ge,{children:t.jsx("title",{children:" EmployeeMonitor Detail"})}),t.jsx(ti,{})]})}export{di as default};
