import{L as s,aX as ye,a3 as c,P as e,a8 as ge,U as j,V as b,Q as K,R as l,aV as fe,aT as d,a9 as _e,W as p,ab as je,Y as A,aW as P,ad as be}from"./index-f6BFzVtx.js";import{D as ke}from"./index-8NKHhtPT.js";import{C as ve}from"./index-CuiDXtH7.js";import{u as m}from"./useDebount-0KTpV7bi.js";import{t as Se,a as we}from"./index-Nqj_Vmem.js";import{a as Fe,b as Ne}from"./index.esm-SqMuMJ9H.js";import{e as De}from"./data-u-VkVTNg.js";import{u as Ce}from"./index-mEJXdmqA.js";import{D as V}from"./index-cIGrzALf.js";import{V as Te}from"./VerticalAlignBottomOutlined-rKGQJjR4.js";const u=A().startOf("month"),h=A().endOf("month");let Ee=Date.parse(u.$d)/1e3,Ie=Date.parse(h.$d)/1e3;const Re=[{title:"STT",dataIndex:"stt",key:"stt",width:60,render:(n,r,i)=>e.jsx("div",{className:"text-center",children:i+1})},{title:"Phòng/nhóm",dataIndex:"department",key:"department",render:(n,r)=>e.jsx("div",{children:r.department})},{title:"Mã nhân viên",dataIndex:"employee_id",key:"employee_id",render:(n,r)=>e.jsx("div",{children:r.employee_id})},{title:"Tên nhân viên",dataIndex:"employee_name",key:"employee_name",render:(n,r)=>e.jsx("div",{children:r.employee_name})},{title:"Mã khách hàng",dataIndex:"customer_code",key:"customer_code",render:(n,r)=>e.jsx("div",{children:r.customer_code})},{title:"Tên khách hàng",dataIndex:"customer_name",key:"customer_name",render:(n,r)=>e.jsx("div",{children:r.customer_name})},{title:"Loại khách hàng",dataIndex:"customer_type",key:"customer_type",render:(n,r)=>e.jsx("div",{children:r.customer_type})},{title:"Nhóm khách hàng",dataIndex:"customer_group",key:"customer_group",render:(n,r)=>e.jsx("div",{children:r.customer_group})},{title:"Người liên hệ",dataIndex:"contact_person",key:"contact_person",render:(n,r)=>e.jsx("div",{className:"!w-[175px] truncate hover:whitespace-normal",children:r.contact_person})},{title:"SDT",dataIndex:"phone",key:"phone",render:(n,r)=>e.jsx("div",{children:r.phone})},{title:"Mã số thuế",dataIndex:"tax_id",key:"tax_id",render:(n,r)=>e.jsx("div",{children:r.tax_id})},{title:"Khu vực",dataIndex:"territory",key:"territory",render:(n,r)=>e.jsx("div",{children:r.territory})},{title:"Địa chỉ",dataIndex:"address",key:"address",render:(n,r)=>e.jsx("div",{className:"!w-[175px] truncate hover:whitespace-normal",children:r.address})},{title:"Ngày viếng thăm",dataIndex:"date_checkin",key:"date_checkin",render:(n,r)=>e.jsx("div",{children:r.date_checkin?.split("-")?.reverse()?.toString()?.replaceAll(",","-")})}];function Ye(){const[n,r]=s.useState([]),[i,B]=s.useState(0),x=20,[y]=ye(),[g,H]=s.useState(1),[ze,$]=s.useState([]),[k,Le]=s.useState(""),[q,Ge]=s.useState("");let v=m(q,500);const[S,w]=s.useState(""),[W,X]=s.useState([]),[U,Me]=s.useState("");m(U,500);const[F,N]=s.useState(""),[Q,Z]=s.useState([]),[J,Oe]=s.useState("");let D=m(J,500);const[C,T]=s.useState(""),[E,I]=s.useState(""),[ee,te]=s.useState([]),[se,Ke]=s.useState("");let R=m(se,500);const[Y,z]=s.useState(Ee),[L,G]=s.useState(Ie),[re,ae]=s.useState([]),[M,ne]=s.useState(),[oe,le]=s.useState("");let O=m(oe);const f=s.useRef(null),_=Ce(),[ce,ie]=s.useState(0),[me,de]=s.useState(_?.h*.52);s.useEffect(()=>{de(_.h*.52)},[_]),s.useEffect(()=>{const t=f.current;if(t){const a=new ResizeObserver(o=>{for(let xe of o)ie(xe.contentRect.height)});return a.observe(t),()=>a.disconnect()}},[f]);const pe=t=>{if(t==null)z("");else if(h&&t&&t.isAfter(h,"day"))P.error("Từ ngày phải nhỏ hơn hoặc bằng Đến ngày");else{let a=Date.parse(t.$d)/1e3;z(a)}},ue=t=>{if(t==null)G("");else if(u&&t&&t.isBefore(u,"day"))P.error("Đến ngày phải lớn hơn hoặc bằng Từ ngày");else{let a=Date.parse(t.$d)/1e3;G(a)}};s.useEffect(()=>{(async()=>{let t=await c.get("/api/method/frappe.desk.search.search_link",{params:{txt:v,doctype:"Department",ignore_user_permissions:0,query:""}}),{message:a}=t;console.log("Customer Group",a),$(a.map(o=>({value:o.value.trim(),label:o.value.trim()})))})()},[v]),s.useEffect(()=>{(async()=>{let t=await c.get("/api/method/mbw_dms.api.router.get_team_sale");ae(Se({data:t.result.map(a=>({title:a.name,value:a.name,...a})),keyValue:"value",parentField:"parent_sales_person"}))})()},[]),s.useEffect(()=>{(async()=>{let t=await c.get("/api/method/mbw_dms.api.router.get_sale_person",{params:{team_sale:M,key_search:O}}),{message:a}=t;X(a.map(o=>({value:o.employee_code,label:o.employee_name||o.employee_code})))})()},[M,O]),s.useEffect(()=>{(async()=>{let t=await c.get("/api/method/frappe.desk.search.search_link",{params:{txt:D,doctype:"Customer Group",ignore_user_permissions:0,query:""}}),{message:a}=t;Z(a.map(o=>({value:o.value.trim(),label:o.value.trim()})))})()},[D]),s.useEffect(()=>{(async()=>{let t=await c.get("/api/method/frappe.desk.search.search_link",{params:{txt:R,doctype:"Territory",ignore_user_permissions:0,query:""}}),{message:a}=t;te(a.map(o=>({value:o.value,label:o.value})))})()},[R]),s.useEffect(()=>{(async()=>{const t=await c.get("/api/method/mbw_dms.api.report.first_checkin_rp.first_checkin_report",{params:{page_size:x,page_number:g,department:k,employee:S,customer_group:F,customer_type:C,territory:E,from_date:Y,to_date:L}});let{result:a}=t;console.log("dt",a),r(a),B(a?.totals)})()},[g,k,S,F,C,E,Y,L]);const he=t=>{t.customergroup?N(t.customergroup):N(""),t.customertype?T(t.customertype):T(""),t.territory?I(t.territory):I("")};return e.jsx(e.Fragment,{children:e.jsx(ve,{header:e.jsx(ge,{title:"Báo cáo thống kê khách hàng viếng thăm lần đầu",buttons:[{label:"Xuất dữ liệu",type:"primary",icon:e.jsx(Te,{className:"text-xl"}),size:"20px",className:"flex items-center",action:()=>{we("/app/data-export/Data%20Export")}}]}),children:e.jsxs("div",{className:"bg-white rounded-2xl pt-4 pb-7 border-[#DFE3E8] border-[0.2px] border-solid",children:[e.jsxs(j,{gutter:[16,16],className:"justify-between items-end w-full",children:[e.jsx(b,{children:e.jsx(j,{gutter:[8,8],children:e.jsx(b,{className:"mx-4 w-full",span:24,children:e.jsxs(K,{layout:"vertical",className:"flex flex-wrap justify-start items-center ",children:[e.jsx(l,{label:"Từ ngày",className:"w-[175px] border-none mr-2",children:e.jsx(V,{format:"DD-MM-YYYY",className:"!bg-[#F4F6F8] !h-7 rounded-lg mt-[-2px]",placeholder:"Từ ngày",onChange:pe,defaultValue:u})}),e.jsx(l,{label:"Đến ngày",className:"w-[175px] border-none mr-2",children:e.jsx(V,{format:"DD-MM-YYYY",className:"!bg-[#F4F6F8] !h-7 rounded-lg mt-[-2px]",onChange:ue,placeholder:"Đến ngày",defaultValue:h})}),e.jsx(l,{label:"Nhóm bán hàng",className:"border-none mr-2 w-[200px]",children:e.jsx(fe,{placeholder:"Tất cả nhóm bán hàng",allowClear:!0,treeData:re,onChange:t=>{ne(t)},dropdownStyle:{maxHeight:400,overflow:"auto",minWidth:400}})}),e.jsx(l,{label:"Nhân viên",className:"border-none mr-2 w-[200px]",name:"employee",children:e.jsx(d,{filterOption:!1,notFoundContent:null,allowClear:!0,placeholder:"Tất cả nhân viên",onSearch:t=>{le(t)},options:W,onSelect:t=>{w(t)},onClear:()=>{w("")}})})]})})})}),e.jsx(b,{className:"!ml-4",children:e.jsx("div",{className:"flex flex-wrap items-center",children:e.jsxs("div",{className:"flex justify-center items-center mr-4",children:[e.jsx(_e,{className:"!h-9",placement:"bottomRight",trigger:["click"],dropdownRender:()=>e.jsxs(ke,{title:"Bộ lọc",children:[e.jsx("div",{className:"",children:e.jsxs(K,{layout:"vertical",form:y,onFinish:he,children:[e.jsx(l,{name:"customertype",label:"Loại khách hàng",className:"w-[468px] border-none pt-2",children:e.jsx(d,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:De,allowClear:!0,placeholder:"Tất cả loại khách hàng"})}),e.jsx(l,{name:"customergroup",label:"Nhóm khách hàng",className:"w-[468px] border-none pt-2",children:e.jsx(d,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:Q,allowClear:!0,placeholder:"Tất cả nhóm khách hàng"})}),e.jsx(l,{name:"territory",label:"Khu vực",className:"w-[468px] border-none pt-2",children:e.jsx(d,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:ee,allowClear:!0,placeholder:"Tất cẩ khu vực"})})]})}),e.jsxs(j,{className:"justify-between pt-6 pb-4",children:[e.jsx("div",{}),e.jsxs("div",{children:[e.jsx(p,{className:"mr-3",onClick:t=>{t.preventDefault(),y.resetFields()},children:"Đặt lại"}),e.jsx(p,{type:"primary",onClick:()=>{y.submit()},children:"Áp dụng"})]})]})]}),children:e.jsx(p,{onClick:t=>t.preventDefault(),className:"flex items-center text-nowrap !text-[13px] !leading-[21px] !font-normal  border-r-[0.1px] rounded-r-none h-9",icon:e.jsx(Fe,{style:{fontSize:"20px"}}),children:"Bộ lọc"})}),e.jsx(p,{className:"border-l-[0.1px] rounded-l-none !h-9",children:e.jsx(Ne,{style:{fontSize:"20px"}})})]})})})]}),e.jsx("div",{ref:f,className:"pt-5",children:e.jsx(je,{dataSource:n?.data?.map(t=>({...t,key:t.name})),bordered:!0,scroll:{x:3e3,y:ce<400?void 0:me},pagination:i&&i>x?{pageSize:x,showSizeChanger:!1,total:i,current:g,onChange(t){H(t)}}:!1,columns:Re})})]})})})}function Qe(){return e.jsxs(e.Fragment,{children:[e.jsx(be,{children:e.jsx("title",{children:" ReportCheckinFirst"})}),e.jsx(Ye,{})]})}export{Qe as default};
