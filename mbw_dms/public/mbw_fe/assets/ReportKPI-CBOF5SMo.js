import{Y as r,a1 as k,L as e,a6 as U,R as W,P as x,a2 as f,V as N,a8 as X,a9 as b,bz as a,ab as Z}from"./index-2HP0RfjX.js";import{u as $,C as q,S as J}from"./index-OJLSNTfB.js";import{u as Q}from"./useDebount-E1S_7vEd.js";import{t as ee,h as te}from"./index-9TORzD_2.js";import{D as ne}from"./index-nR2a4o1l.js";import{V as ae}from"./VerticalAlignBottomOutlined-hKOWhnA6.js";import"./FileSaver.min-nraNywVD.js";const se=[{label:"Tháng 1",value:"1"},{label:"Tháng 2",value:"2"},{label:"Tháng 3",value:"3"},{label:"Tháng 4",value:"4"},{label:"Tháng 5",value:"5"},{label:"Tháng 6",value:"6"},{label:"Tháng 7",value:"7"},{label:"Tháng 8",value:"8"},{label:"Tháng 9",value:"9"},{label:"Tháng 10",value:"10"},{label:"Tháng 11",value:"11"},{label:"Tháng 12",value:"12"}],{Column:s,ColumnGroup:i}=b,le=N().month()+1,F=le.toString(),re=N().format("YYYY");function ie(){const[C,I]=r.useState([]),[T,H]=r.useState([]),[m,K]=r.useState(),[E,R]=r.useState(""),[S,v]=r.useState();let w=Q(E);const[o,_]=r.useState(1),c=20,[l,L]=r.useState([]),[u,P]=r.useState(F),[d,y]=r.useState(""),[g,z]=r.useState(0),j=r.useRef(null),p=$(),[D,V]=r.useState(0),[Y,O]=r.useState(p?.h*.52),[A,B]=r.useState(!1);r.useEffect(()=>{O(p.h*.52)},[p]),r.useEffect(()=>{const n=j.current;if(n){const t=new ResizeObserver(h=>{for(let M of h)V(M.contentRect.height)});return t.observe(n),()=>t.disconnect()}},[j]);const G=n=>{y(n?.$y.toString())};return r.useEffect(()=>{(async()=>{let n=await k.get("/api/method/mbw_dms.api.router.get_team_sale");H(ee({data:n.result.map(t=>({title:t.name,value:t.name,...t})),keyValue:"value",parentField:"parent_sales_person"}))})()},[]),r.useEffect(()=>{(async()=>{let n=await k.get("/api/method/mbw_dms.api.router.get_sale_person",{params:{team_sale:m,key_search:w}}),{message:t}=n;I(t.map(h=>({value:h.employee_code,label:h.employee_name||h.employee_code})))})()},[m,w]),r.useEffect(()=>{(d===void 0||d==="")&&y(re),(async()=>{const n=await k.get("/api/method/mbw_dms.api.report.kpi.kpi_report",{params:{page_size:c,page_number:o,month:u,year:d,sales_team:m,employee:S}});L(n?.result),z(n?.result?.totals)})()},[u,d,m,S,o,A]),e.jsx(e.Fragment,{children:e.jsx(q,{header:e.jsx(U,{title:"Báo cáo KPI",buttons:[{icon:e.jsx(J,{className:"text-xl"}),size:"18px",className:"flex mr-2 ",action:()=>{B(n=>!n)}},{label:"Xuất dữ liệu",type:"primary",icon:e.jsx(ae,{className:"text-xl"}),size:"18px",className:"flex items-center",action:te.bind(null,{url:"/api/method/mbw_dms.api.exports.export_excel.export_excel",params:{report_type:"Report KPI",data_filter:{month:u,year:d}},file_name:"Report KPI.xlsx"})}]}),children:e.jsxs("div",{className:"bg-white rounded-2xl pt-4 pb-7 border-[#DFE3E8] border-[0.2px] border-solid",children:[e.jsxs(W,{className:"px-4 flex-auto",gutter:[8,8],children:[e.jsx(x,{span:4,children:e.jsx(f,{className:"!bg-[#F4F6F8]",defaultValue:F,options:se,onChange:n=>{P(n),_(1)}})}),e.jsx(x,{span:4,children:e.jsx(ne,{className:"!bg-[#F4F6F8] w-full rounded-lg h-7",onChange:G,placeholder:"Chọn năm",picker:"year",defaultValue:N().startOf("year")})}),e.jsx(x,{span:4,children:e.jsx(X,{placeholder:"Tất cả nhóm bán hàng",allowClear:!0,showSearch:!0,treeData:T,onChange:n=>{K(n),_(1)},dropdownStyle:{maxHeight:400,overflow:"auto",minWidth:350}})}),e.jsx(x,{span:4,children:e.jsx(f,{filterOption:!1,notFoundContent:null,allowClear:!0,showSearch:!0,placeholder:"Tất cả nhân viên",onSearch:n=>{R(n)},options:C,onSelect:n=>{v(n),_(1)},onClear:()=>{v("")}})})]}),e.jsx("div",{ref:j,className:"pt-5",children:e.jsxs(b,{dataSource:l?.data?.map(n=>({key:n.name,...n})),bordered:!0,scroll:{x:"max-content",y:D<400?void 0:Y},pagination:g&&g>c?{pageSize:c,showSizeChanger:!1,total:g,current:o,onChange(n){_(n)}}:!1,summary:()=>e.jsxs(a.Summary.Row,{children:[e.jsx(a.Summary.Cell,{index:0}),e.jsx(a.Summary.Cell,{index:1,children:"Tổng"}),e.jsx(a.Summary.Cell,{index:2}),e.jsx(a.Summary.Cell,{index:3}),e.jsx(a.Summary.Cell,{index:4,className:"text-center",children:l?.sum?.tong_kh_vt}),e.jsx(a.Summary.Cell,{index:5,className:"text-center underline text-[#1877F2]",children:l?.sum?.tong_th_vt}),e.jsx(a.Summary.Cell,{index:6}),e.jsx(a.Summary.Cell,{index:7,className:"text-center",children:l?.sum?.tong_kh_vt_dn}),e.jsx(a.Summary.Cell,{index:8,className:"text-center underline text-[#1877F2]",children:l?.sum?.tong_th_vt_dn}),e.jsx(a.Summary.Cell,{index:9}),e.jsx(a.Summary.Cell,{index:10,className:"text-center",children:l?.sum?.tong_kh_dat_hang}),e.jsx(a.Summary.Cell,{index:11,className:"text-center underline text-[#1877F2]",children:l?.sum?.tong_th_dat_hang}),e.jsx(a.Summary.Cell,{index:12}),e.jsx(a.Summary.Cell,{index:13,className:"text-center",children:l?.sum?.tong_kh_kh_moi}),e.jsx(a.Summary.Cell,{index:14,className:"text-center underline text-[#1877F2]",children:l?.sum?.tong_th_kh_moi}),e.jsx(a.Summary.Cell,{index:15}),e.jsx(a.Summary.Cell,{index:16,className:"text-center",children:l?.sum?.tong_kh_don_hang}),e.jsx(a.Summary.Cell,{index:17,className:"text-center underline text-[#1877F2]",children:l?.sum?.tong_th_don_hang}),e.jsx(a.Summary.Cell,{index:18}),e.jsx(a.Summary.Cell,{index:19,className:"text-center",children:Intl.NumberFormat().format(l?.sum?.tong_kh_doanh_so)}),e.jsx(a.Summary.Cell,{index:20,className:"text-center underline text-[#1877F2]",children:Intl.NumberFormat().format(l?.sum?.tong_th_doanh_so)}),e.jsx(a.Summary.Cell,{index:21}),e.jsx(a.Summary.Cell,{index:22,className:"text-center",children:Intl.NumberFormat().format(l?.sum?.tong_kh_doanh_thu)}),e.jsx(a.Summary.Cell,{index:23,className:"text-center underline text-[#1877F2]",children:Intl.NumberFormat().format(l?.sum?.tong_th_doanh_thu)}),e.jsx(a.Summary.Cell,{index:24}),e.jsx(a.Summary.Cell,{index:25,className:"text-center",children:l?.sum?.tong_kh_san_lg}),e.jsx(a.Summary.Cell,{index:26,className:"text-center underline text-[#1877F2]",children:l?.sum?.tong_th_san_lg}),e.jsx(a.Summary.Cell,{index:27}),e.jsx(a.Summary.Cell,{index:28,className:"text-center",children:l?.sum?.tong_kh_sku}),e.jsx(a.Summary.Cell,{index:29,className:"text-center underline text-[#1877F2]",children:l?.sum?.tong_th_sku}),e.jsx(a.Summary.Cell,{index:30}),e.jsx(a.Summary.Cell,{index:31,className:"text-center",children:l?.sum?.tong_kh_so_gio_lam_viec}),e.jsx(a.Summary.Cell,{index:32,className:"text-center underline text-[#1877F2]",children:l?.sum?.tong_th_so_gio_lam_viec}),e.jsx(a.Summary.Cell,{index:33})]}),children:[e.jsx(s,{title:"STT",dataIndex:"stt",fixed:"left",className:"!text-center",width:60,render:(n,t,h)=>h+1},"stt"),e.jsx(s,{title:"Mã Nhân viên",dataIndex:"nhan_vien_ban_hang",fixed:"left",render:(n,t)=>e.jsx(e.Fragment,{children:e.jsx("div",{className:"!min-w-[130px]",children:t.nhan_vien_ban_hang})})},"nhan_vien_ban_hang"),e.jsx(s,{title:"Nhân viên",dataIndex:"ten_nv",fixed:"left",render:(n,t)=>e.jsx(e.Fragment,{children:e.jsx("div",{className:"!min-w-[200px]",children:t.ten_nv})})},"ten_nv"),e.jsx(s,{title:"Nhóm bán hàng",dataIndex:"nhom_ban_hang",render:(n,t)=>e.jsx("div",{children:t.nhom_ban_hang})},"nhom_ban_hang"),e.jsxs(i,{className:"!whitespace-normal !min-w-[210px] !text-center",title:"Số khách hàng viếng thăm",children:[e.jsx(s,{className:"!text-center",title:"KH",width:70,dataIndex:"kh_vt"},"kh_vt"),e.jsx(s,{className:"!text-center underline text-[#1877F2]",title:"TH",width:70,dataIndex:"th_vt",render:(n,t)=>e.jsx("div",{children:t?.kpi_month[0]?t?.kpi_month[0]?.th_vt:0})},"th_vt"),e.jsx(s,{className:"!text-center",title:"TL",width:70,dataIndex:"tl_vt",render:(n,t)=>e.jsxs(e.Fragment,{children:[t.tl_vt,"%"]})},"tl_vt")]}),e.jsxs(i,{className:"!whitespace-normal !min-w-[210px] !text-center",title:"Số khách hàng viếng thăm duy nhất",children:[e.jsx(s,{className:"!text-center",title:"KH",width:70,dataIndex:"kh_vt_dn"},"kh_vt_dn"),e.jsx(s,{className:"!text-center underline text-[#1877F2]",title:"TH",width:70,dataIndex:"th_vt_dn",render:(n,t)=>e.jsx("div",{children:t?.kpi_month[0]?t?.kpi_month[0]?.th_vt_dn:0})},"th_vt_dn"),e.jsx(s,{className:"!text-center",title:"TL",width:70,dataIndex:"tl_vt_dn",render:(n,t)=>e.jsxs(e.Fragment,{children:[t.tl_vt_dn,"%"]})},"tl_vt_dn")]}),e.jsxs(i,{className:"!whitespace-normal !min-w-[210px] !text-center",title:"Số khách hàng đặt hàng",children:[e.jsx(s,{className:"!text-center",title:"KH",width:70,dataIndex:"kh_dat_hang"},"kh_dat_hang"),e.jsx(s,{className:"!text-center underline text-[#1877F2]",title:"TH",width:70,dataIndex:"th_dat_hang",render:(n,t)=>e.jsx("div",{children:t?.kpi_month[0]?t?.kpi_month[0]?.th_dat_hang:0})},"th_dat_hang"),e.jsx(s,{className:"!text-center",title:"TL",width:70,dataIndex:"tl_dat_hang",render:(n,t)=>e.jsxs(e.Fragment,{children:[t.tl_dat_hang,"%"]})},"tl_dat_hang")]}),e.jsxs(i,{className:"!whitespace-normal !min-w-[210px] !text-center",title:"Số khách hàng thêm mới",children:[e.jsx(s,{className:"!text-center",title:"KH",width:70,dataIndex:"kh_kh_moi"},"kh_kh_moi"),e.jsx(s,{className:"!text-center underline text-[#1877F2]",title:"TH",width:70,dataIndex:"th_kh_moi",render:(n,t)=>e.jsx("div",{children:t?.kpi_month[0]?t?.kpi_month[0]?.th_kh_moi:0})},"th_kh_moi"),e.jsx(s,{className:"!text-center",title:"TL",width:70,dataIndex:"tl_kh_moi",render:(n,t)=>e.jsxs(e.Fragment,{children:[t.tl_kh_moi,"%"]})},"tl_kh_moi")]}),e.jsxs(i,{className:"!whitespace-normal",title:"Số đơn hàng",width:210,children:[e.jsx(s,{className:"!text-center",title:"KH",width:70,dataIndex:"kh_don_hang"},"kh_don_hang"),e.jsx(s,{className:"!text-center underline text-[#1877F2]",title:"TH",width:70,dataIndex:"th_don_hang",render:(n,t)=>e.jsx("div",{children:t?.kpi_month[0]?t?.kpi_month[0]?.th_don_hang:0})},"th_don_hang"),e.jsx(s,{className:"!text-center",title:"TL",width:70,dataIndex:"tl_don_hang",render:(n,t)=>e.jsxs(e.Fragment,{children:[t.tl_don_hang,"%"]})},"tl_don_hang")]}),e.jsxs(i,{className:"!whitespace-normal",title:"Doanh số (VNĐ)",width:210,children:[e.jsx(s,{className:"!text-center",title:"KH",dataIndex:"kh_doanh_so",render:(n,t)=>e.jsx(e.Fragment,{children:Intl.NumberFormat().format(t.kh_doanh_so)})},"kh_doanh_so"),e.jsx(s,{className:"!text-center underline text-[#1877F2]",title:"TH",width:70,dataIndex:"th_doanh_so",render:(n,t)=>e.jsx(e.Fragment,{children:t?.kpi_month[0]?Intl.NumberFormat().format(t?.kpi_month[0]?.th_doanh_so):0})},"th_doanh_so"),e.jsx(s,{className:"!text-center",title:"TL",width:70,dataIndex:"tl_don_hang",render:(n,t)=>e.jsxs(e.Fragment,{children:[t.tl_don_hang,"%"]})},"tl_don_hang")]}),e.jsxs(i,{className:"!whitespace-normal",title:"Doanh thu (VNĐ)",width:210,children:[e.jsx(s,{className:"!text-center",title:"KH",width:70,dataIndex:"kh_doanh_thu",render:(n,t)=>e.jsx(e.Fragment,{children:Intl.NumberFormat().format(t.kh_doanh_thu)})},"kh_doanh_thu"),e.jsx(s,{className:"!text-center underline text-[#1877F2]",title:"TH",width:70,dataIndex:"th_doanh_thu",render:(n,t)=>e.jsx(e.Fragment,{children:t?.kpi_month[0]?Intl.NumberFormat().format(t?.kpi_month[0]?.th_doanh_thu):0})},"th_doanh_thu"),e.jsx(s,{className:"!text-center",title:"TL",width:70,dataIndex:"tl_doanh_thu",render:(n,t)=>e.jsxs(e.Fragment,{children:[t.tl_doanh_thu,"%"]})},"tl_doanh_thu")]}),e.jsxs(i,{className:"!whitespace-normal",title:"Sản lượng",width:210,children:[e.jsx(s,{className:"!text-center",title:"KH",width:70,dataIndex:"kh_san_lg"},"kh_san_lg"),e.jsx(s,{className:"!text-center underline text-[#1877F2]",title:"TH",width:70,dataIndex:"th_san_lg",render:(n,t)=>e.jsx("div",{children:t?.kpi_month[0]?t?.kpi_month[0]?.th_san_lg:0})},"th_san_lg"),e.jsx(s,{className:"!text-center",title:"TL",width:70,dataIndex:"tl_san_luong",render:(n,t)=>e.jsxs(e.Fragment,{children:[t.tl_san_luong,"%"]})},"tl_san_luong")]}),e.jsxs(i,{className:"!whitespace-normal",title:"SKU",width:210,children:[e.jsx(s,{className:"!text-center",title:"KH",width:70,dataIndex:"kh_sku"},"kh_sku"),e.jsx(s,{className:"!text-center underline text-[#1877F2]",title:"TH",width:70,dataIndex:"th_sku",render:(n,t)=>e.jsx("div",{children:t?.kpi_month[0]?t?.kpi_month[0]?.th_sku:0})},"th_sku"),e.jsx(s,{className:"!text-center",title:"TL",width:70,dataIndex:"tl_sku",render:(n,t)=>e.jsxs(e.Fragment,{children:[t.tl_sku,"%"]})},"tl_sku")]}),e.jsxs(i,{className:"!whitespace-normal",title:"Số giờ làm việc",width:210,children:[e.jsx(s,{className:"!text-center",title:"KH",width:70,dataIndex:"kh_so_gio_lam_viec"},"kh_so_gio_lam_viec"),e.jsx(s,{className:"!text-center underline text-[#1877F2]",title:"TH",width:70,dataIndex:"th_so_gio_lam_viec",render:(n,t)=>e.jsx("div",{children:t?.kpi_month[0]?t?.kpi_month[0]?.th_so_gio_lam_viec:0})},"th_so_gio_lam_viec"),e.jsx(s,{className:"!text-center",title:"TL",width:70,dataIndex:"tl_so_gio_lam_viec",render:(n,t)=>e.jsxs(e.Fragment,{children:[t.tl_so_gio_lam_viec,"%"]})},"tl_so_gio_lam_viec")]})]})})]})})})}function ue(){return e.jsxs(e.Fragment,{children:[e.jsx(Z,{children:e.jsx("title",{children:" ReportKPI"})}),e.jsx(ie,{})]})}export{ue as default};
