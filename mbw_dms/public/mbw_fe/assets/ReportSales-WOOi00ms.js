import{Y as a,a3 as d,L as e,N as ue,R as he,O as m,a5 as c,a6 as xe,bv as o,V as g,aR as R,a8 as pe}from"./index-E0O7XQer.js";import{H as ye}from"./header-page-_jBNoOFe.js";import{C as ge}from"./index-bAZBBsIL.js";import{u}from"./useDebount-28SXHhcf.js";import{a as _e}from"./index-Cd0TkIiC.js";import{D as q}from"./index-O0oLlUJg.js";import{V as je}from"./VerticalAlignBottomOutlined-8R8rOFKn.js";const h=g().startOf("month"),x=g().endOf("month");let fe=Date.parse(h.$d)/1e3,Ne=Date.parse(x.$d)/1e3;const be=[{title:e.jsx("div",{className:"relative",children:e.jsx("span",{className:"absolute -top-[11px] -left-8",children:"STT"})}),dataIndex:"stt",key:"stt",render:(l,s,p)=>p+1},{title:"Đơn đặt",dataIndex:"name",key:"name",render:(l,s)=>e.jsx("div",{children:e.jsx("a",{className:"text-[#212B36]",href:`app/sales-invoice/${s.name}`,target:"_blank",children:s.name})})},{title:"Khách hàng",dataIndex:"customer",key:"customer",render:(l,s)=>e.jsx("div",{children:s.customer})},{title:"Khu vực",dataIndex:"territory",key:"territory",render:(l,s)=>e.jsx("div",{children:s.territory})},{title:"Kho",dataIndex:"set_warehouse",key:"set_warehouse",render:(l,s)=>e.jsx("div",{children:s.set_warehouse})},{title:"Ngày tạo",dataIndex:"posting_date",key:"posting_date",render:(l,s)=>e.jsx("div",{children:g(s.posting_date*1e3).format("DD/MM/YYYY")})},{title:"Nhân viên",dataIndex:"employee",key:"employee",render:(l,s)=>e.jsx("div",{children:s.employee})},{title:e.jsx("div",{className:"text-right",children:"Thành tiền (VNĐ)"}),dataIndex:"total",key:"total",render:(l,s)=>e.jsx("div",{className:"!text-right",children:Intl.NumberFormat().format(s.total)})},{title:e.jsx("div",{className:"text-right",children:"Tiền VAT (VNĐ)"}),dataIndex:"tax_amount",key:"tax_amount",render:(l,s)=>e.jsx("div",{className:"text-right",children:Intl.NumberFormat().format(s.tax_amount)})},{title:e.jsx("div",{className:"text-right",children:"Chiết khấu (VNĐ)"}),dataIndex:"discount_amount",key:"discount_amount",render:(l,s)=>e.jsx("div",{className:"text-right",children:Intl.NumberFormat().format(s.discount_amount)})},{title:e.jsx("div",{className:"text-right",children:"Tổng tiền (VNĐ)"}),dataIndex:"grand_total",key:"grand_total",render:(l,s)=>e.jsx("div",{className:"text-right",children:Intl.NumberFormat().format(s.grand_total)})}];function Se(){const[l,s]=a.useState([]),[p,M]=a.useState(0),_=20,[j,W]=a.useState(1),[L,P]=a.useState([]),[f,N]=a.useState(""),[A,$]=a.useState(""),[b,S]=a.useState(""),[z,B]=a.useState([]),[H,G]=a.useState(""),[v,F]=a.useState(""),[U,X]=a.useState([]),[Z,J]=a.useState(""),[k,C]=a.useState(fe),[I,T]=a.useState(Ne),[w,D]=a.useState(""),[Q,ee]=a.useState([]),[te,ae]=a.useState(""),[E,O]=a.useState(""),[se,re]=a.useState([]),[ne,le]=a.useState("");let Y=u(A,500),y=u(H,500),K=u(Z,500),V=u(te,500),oe=u(ne,500);const ie=t=>{const n=[{title:e.jsx("div",{className:"text-center",children:"STT"}),dataIndex:"stt",key:"stt",render:(r,i,ce)=>e.jsx("div",{className:"text-center",children:ce+1})},{title:"Mã sản phẩm",dataIndex:"item_code",key:"item_code"},{title:"Tên sản phẩm",dataIndex:"item_name",key:"item_name"},{title:"Nhóm sản phẩm",dataIndex:"item_group",key:"item_group"},{title:"Nhãn hàng",dataIndex:"brand",key:"brand"},{title:e.jsx("div",{className:"text-right",children:"Đơn giá"}),dataIndex:"rate",key:"rate",render:(r,i)=>e.jsx("div",{className:"!text-right",children:Intl.NumberFormat().format(i.rate)})},{title:e.jsx("div",{className:"text-right",children:"Số lượng"}),dataIndex:"qty",key:"qty",render:(r,i)=>e.jsx("div",{className:"!text-right",children:i.qty})},{title:e.jsx("div",{className:"text-right",children:"Chiết khấu (%)"}),dataIndex:"discount_percentage",key:"discount_percentage",render:(r,i)=>e.jsx("div",{className:"!text-right",children:Intl.NumberFormat().format(i.discount_percentage)})},{title:e.jsx("div",{className:"text-right",children:"Tiền chiết khấu (VNĐ)"}),dataIndex:"discount_amount",key:"discount_amount",render:(r,i)=>e.jsx("div",{className:"!text-right",children:Intl.NumberFormat().format(i.discount_amount)})},{title:e.jsx("div",{className:"text-right",children:"Tổng tiền (VNĐ)"}),dataIndex:"amount",key:"amount",render:(r,i)=>e.jsx("div",{className:"!text-right",children:Intl.NumberFormat().format(i.amount)})}];return e.jsx(o,{columns:n,dataSource:t.items.map(r=>({...r,key:r.item_code})),pagination:!1})};a.useEffect(()=>{(async()=>{let t=await d.get("/api/method/frappe.desk.search.search_link",{params:{txt:Y,doctype:"Company",ignore_user_permissions:0,query:""}}),{message:n}=t;P(n.map(r=>({value:r.value,label:r.value})))})()},[Y]),a.useEffect(()=>{(async()=>{let t=await d.get("/api/method/frappe.desk.search.search_link",{params:{txt:K,doctype:"Customer",ignore_user_permissions:0,query:""}}),{message:n}=t;X(n.map(r=>({value:r.value,label:r.value})))})()},[K]),a.useEffect(()=>{(async()=>{let t=await d.get("/api/method/frappe.desk.search.search_link",{params:{txt:V,doctype:"Warehouse",ignore_user_permissions:0,query:""}}),{message:n}=t;ee(n.map(r=>({value:r.value,label:r.value})))})()},[V]),a.useEffect(()=>{(async()=>{let t=await d.get("/api/method/frappe.desk.search.search_link",{params:{txt:y,doctype:"Territory",ignore_user_permissions:0,query:""}}),{message:n}=t;B(n.map(r=>({value:r.value,label:r.value})))})()},[y]),a.useEffect(()=>{(async()=>{let t=await d.get("/api/method/frappe.desk.search.search_link",{params:{txt:y,doctype:"Employee",ignore_user_permissions:0,query:"mbw_dms.api.report.so_report.employee_query"}}),{message:n}=t;re(n.map(r=>({value:r.description.split(",")[1].trim(),label:r.description.split(",")[0].trim()})))})()},[oe]),a.useEffect(()=>{(async()=>{const t=await d.get("/api/method/mbw_dms.api.report.so_report.si_report",{params:{page_size:_,page_number:j,company:f,territory:b,customer:v,from_date:k,to_date:I,warehouse:w,employee:E}});let{result:n}=t;s(n),M(n?.totals)})()},[j,f,b,v,k,I,w,E]);const me=t=>{if(t==null)C("");else if(x&&t&&t.isAfter(x,"day"))R.error("Từ ngày phải nhỏ hơn hoặc bằng Đến ngày");else{let n=Date.parse(t.$d)/1e3;C(n)}},de=t=>{if(t==null)T("");else if(h&&t&&t.isBefore(h,"day"))R.error("Đến ngày phải lớn hơn hoặc bằng Từ ngày");else{let n=Date.parse(t.$d)/1e3;T(n)}};return e.jsx(e.Fragment,{children:e.jsx(ge,{header:e.jsx(ye,{title:"Báo cáo tổng hợp bán hàng",buttons:[{label:"Xuất dữ liệu",type:"primary",icon:e.jsx(je,{className:"text-xl"}),size:"20px",className:"flex items-center",action:()=>{_e("/app/data-export/Data%20Export")}}]}),children:e.jsxs("div",{className:"bg-white rounded-md pt-4 pb-7 border-[#DFE3E8] border-[0.2px] border-solid",children:[e.jsx(ue,{layout:"vertical",className:"flex flex-wrap justify-start items-center px-4",children:e.jsxs(he,{className:"",gutter:[8,8],children:[e.jsx(m,{label:"Từ ngày",className:"w-[175px] border-none mr-2",children:e.jsx(q,{format:"DD-MM-YYYY",className:"!bg-[#F4F6F8] !h-7 rounded-lg mt-[-2px]",placeholder:"Từ ngày",onChange:me,defaultValue:h})}),e.jsx(m,{label:"Đến ngày",className:"w-[175px] border-none mr-2",children:e.jsx(q,{format:"DD-MM-YYYY",className:"!bg-[#F4F6F8] !h-7 rounded-lg mt-[-2px]",onChange:de,placeholder:"Đến ngày",defaultValue:x})}),e.jsx(m,{label:"Công ty",className:"w-[175px] border-none mr-2",children:e.jsx(c,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:L,onSelect:t=>{N(t)},onSearch:t=>{$(t)},onClear:()=>N(""),filterOption:!1,allowClear:!0,placeholder:"Tất cả công ty"})}),e.jsx(m,{label:"Khách hàng",className:"w-[175px] border-none mr-2",children:e.jsx(c,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:U,onSelect:t=>{F(t)},onSearch:t=>{J(t)},onClear:()=>F(""),filterOption:!1,allowClear:!0,placeholder:"Tất cả khách hàng"})}),e.jsx(m,{label:"Khu vực",className:"w-[175px] border-none mr-2",children:e.jsx(c,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:z,onSelect:t=>{S(t)},onSearch:t=>{G(t)},onClear:()=>S(""),filterOption:!1,allowClear:!0,placeholder:"Tất cẩ khu vực"})}),e.jsx(m,{label:"Kho",className:"w-[175px] border-none mr-2",children:e.jsx(c,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:Q,onSelect:t=>{D(t)},onSearch:t=>{ae(t)},onClear:()=>D(""),filterOption:!1,allowClear:!0,placeholder:"Tất cả kho"})}),e.jsx(m,{label:"Nhân viên",className:"w-[175px] border-none mr-2",children:e.jsx(c,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:se,onSelect:t=>{O(t)},onSearch:t=>{le(t)},onClear:()=>O(""),filterOption:!1,allowClear:!0,placeholder:"Tất cả nhân viên"})})]})}),e.jsx("div",{className:"pt-5",children:e.jsx(xe,{dataSource:l?.data?.map(t=>({...t,key:t.name})),expandable:{expandedRowRender:ie,defaultExpandedRowKeys:["0"]},bordered:!0,columns:be,scroll:{x:!0},pagination:{defaultPageSize:_,total:p,showSizeChanger:!1,onChange(t){W(t)}},summary:()=>e.jsxs(o.Summary.Row,{children:[e.jsx(o.Summary.Cell,{index:0,className:"!border-r-0"}),e.jsx(o.Summary.Cell,{index:1}),e.jsx(o.Summary.Cell,{index:2,children:"Tổng"}),e.jsx(o.Summary.Cell,{index:3}),e.jsx(o.Summary.Cell,{index:4}),e.jsx(o.Summary.Cell,{index:5}),e.jsx(o.Summary.Cell,{index:6}),e.jsx(o.Summary.Cell,{index:7}),e.jsx(o.Summary.Cell,{index:8,children:e.jsx("div",{className:"text-right",children:Intl.NumberFormat().format(l?.sum?.sum_total)})}),e.jsx(o.Summary.Cell,{index:9,children:e.jsx("div",{className:"text-right",children:Intl.NumberFormat().format(l?.sum?.sum_vat)})}),e.jsx(o.Summary.Cell,{index:10,children:e.jsx("div",{className:"text-right",children:Intl.NumberFormat().format(l?.sum?.sum_discount_amount)})}),e.jsx(o.Summary.Cell,{index:11,children:e.jsx("div",{className:"text-right",children:Intl.NumberFormat().format(l?.sum?.sum_grand_total)})})]})})})]})})})}function De(){return e.jsxs(e.Fragment,{children:[e.jsx(pe,{children:e.jsx("title",{children:" ReportSales"})}),e.jsx(Se,{})]})}export{De as default};
