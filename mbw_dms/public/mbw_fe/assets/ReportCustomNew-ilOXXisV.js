import{Y as a,a3 as m,L as e,N as J,R as Q,O as i,a5 as c,bv as l,V as E,a8 as W}from"./index-diwCb8Hq.js";import{H as $}from"./header-page-nAdL1FFk.js";import{C as ee}from"./index-1WmXdaNi.js";import{T as te}from"./tableCustom-Y14QWbYN.js";import{e as se,f as re}from"./data-u-VkVTNg.js";import{u as d}from"./useDebount-TYGsy433.js";import{a as ae}from"./index-v6yy1zdl.js";import{V as le}from"./VerticalAlignBottomOutlined-diBKv2y8.js";const ne=[{title:"STT",dataIndex:"stt",key:"stt",render:(r,t,p)=>p+1},{title:"Phòng ban",dataIndex:"department",key:"department",render:(r,t)=>e.jsx("div",{className:"!w-[175px]",children:t.department})},{title:"Mã nhân viên",dataIndex:"employee_id",key:"employee_id",render:(r,t)=>e.jsx("div",{className:"!w-[175px]",children:t.employee_id})},{title:"Tên nhân viên",dataIndex:"employee_name",key:"employee_name",render:(r,t)=>e.jsx("div",{className:"!w-[175px]",children:t.employee_name})},{title:"Mã khách hàng",dataIndex:"customer_code",key:"customer_code",render:(r,t)=>e.jsx("div",{className:"!w-[175px]",children:t.customer_code})},{title:"Tên khách hàng",dataIndex:"customer_name",key:"customer_name",render:(r,t)=>e.jsx("div",{className:"!w-[175px]",children:t.customer_name})},{title:"Loại khách hàng",dataIndex:"customer_type",key:"customer_type",render:(r,t)=>e.jsx("div",{className:"!w-[175px]",children:t.customer_type})},{title:"Nhóm khách hàng",dataIndex:"customer_group",key:"customer_group",render:(r,t)=>e.jsx("div",{className:"!w-[175px]",children:t.customer_group})},{title:"Người liên hệ",dataIndex:"contact",key:"contact",render:(r,t)=>e.jsx("div",{className:"!w-[175px]",children:t.contact})},{title:"SDT",dataIndex:"phone",key:"phone",render:(r,t)=>e.jsx("div",{className:"!w-[175px]",children:t.phone})},{title:"Mã số thuế",dataIndex:"tax_id",key:"tax_id",render:(r,t)=>e.jsx("div",{className:"!w-[175px]",children:t.tax_id})},{title:"Khu vưc",dataIndex:"territory",key:"territory",render:(r,t)=>e.jsx("div",{className:"!w-[175px]",children:t.territory})},{title:"Địa chỉ",dataIndex:"address",key:"address",render:(r,t)=>e.jsx("div",{className:"!w-[175px]",children:t.contribution})},{title:"Ngày thu thập",dataIndex:"creation",key:"creation",render:(r,t)=>e.jsx("div",{className:"!w-[175px]",children:E(t.creation*1e3).format("DD/MM/YYYY")})},{title:"Nguồn",dataIndex:"f1",key:"f1"},{title:"Số lần VT",dataIndex:"totals_checkin",key:"totals_checkin",render:(r,t)=>e.jsx("div",{className:"!text-right",children:t.totals_checkin})},{title:"VT đầu",dataIndex:"first_checkin",key:"first_checkin",render:(r,t)=>e.jsx("div",{className:"!text-right",children:t.first_checkin})},{title:"VT cuối",dataIndex:"last_checkin",key:"last_checkin",render:(r,t)=>e.jsx("div",{className:"!text-right",children:t.last_checkin})},{title:"Số đơn hàng",dataIndex:"totals_so",key:"totals_so",render:(r,t)=>e.jsx("div",{className:"!text-right",children:t.totals_so})},{title:"Đơn hàng cuối",dataIndex:"last_sale_order",key:"last_sale_order",render:r=>r?e.jsx("p",{children:E(r*1e3).format("DD/MM/YYYY")}):e.jsx(e.Fragment,{})}];function oe(){const[r,t]=a.useState([]),[p,D]=a.useState(0),u=20,[x,O]=a.useState(1),[h,y]=a.useState(""),[Y,G]=a.useState([]),[K,M]=a.useState("");let _=d(K,500);const[P,R]=a.useState([]),[g,S]=a.useState(""),[L,V]=a.useState(""),[j,k]=a.useState("");let f=d(L,500);const[C,N]=a.useState(""),[q,z]=a.useState([]),[H,A]=a.useState("");let b=d(H,500);const[F,v]=a.useState(""),[B,U]=a.useState([]),[X,Z]=a.useState("");let w=d(X,500);const[T,I]=a.useState();return a.useEffect(()=>{(async()=>{let s=await m.get("/api/method/frappe.desk.search.search_link",{params:{txt:_,doctype:"Employee",ignore_user_permissions:0,query:""}}),{message:n}=s;console.log("rsEmployee",n),G(n.map(o=>({value:o.description.trim(),label:o.description.trim()})))})()},[_]),a.useEffect(()=>{(async()=>{let s=await m.get("/api/method/frappe.desk.search.search_link",{params:{txt:f,doctype:"Department",ignore_user_permissions:0,query:""}}),{message:n}=s;R(n.map(o=>({value:o.value.trim(),label:o.value.trim()})))})()},[f]),a.useEffect(()=>{(async()=>{let s=await m.get("/api/method/frappe.desk.search.search_link",{params:{txt:b,doctype:"Customer Group",ignore_user_permissions:0,query:""}}),{message:n}=s;z(n.map(o=>({value:o.value.trim(),label:o.value.trim()})))})()},[b]),a.useEffect(()=>{(async()=>{let s=await m.get("/api/method/frappe.desk.search.search_link",{params:{txt:w,doctype:"Territory",ignore_user_permissions:0,query:""}}),{message:n}=s;U(n.map(o=>({value:o.value,label:o.value})))})()},[w]),a.useEffect(()=>{(async()=>{const s=await m.get("/api/method/mbw_dms.api.report.customer_report.customer_report",{params:{page_size:u,page_number:x,customer_type:j,customer_group:C,territory:F,employee:h,has_sales_order:T,department:g}});let{result:n}=s;console.log("result",n),t(n),D(n?.totals_cus)})()},[x,j,C,F,h,T,g]),e.jsx(e.Fragment,{children:e.jsx(ee,{header:e.jsx($,{title:"Báo cáo khách hàng mới",buttons:[{label:"Xuất dữ liệu",type:"primary",icon:e.jsx(le,{className:"text-xl"}),size:"20px",className:"flex items-center",action:()=>{ae("/app/data-export/Data%20Export")}}]}),children:e.jsxs("div",{className:"bg-white rounded-md pt-4 pb-7 border-[#DFE3E8] border-[0.2px] border-solid",children:[e.jsx(J,{layout:"vertical",className:"flex flex-wrap justify-start items-center px-4",children:e.jsxs(Q,{className:"",gutter:[8,8],children:[e.jsx(i,{label:"Phòng ban",className:"w-[175px] border-none mr-2",children:e.jsx(c,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:P,onSelect:s=>{S(s)},onSearch:s=>{V(s)},onClear:()=>S(""),filterOption:!1,allowClear:!0,placeholder:"Tất cả phòng ban"})}),e.jsx(i,{label:"Nhân viên",className:"w-[175px] border-none mr-2",children:e.jsx(c,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:Y,onSelect:s=>{y(s)},onSearch:s=>{M(s)},onClear:()=>y(""),filterOption:!1,allowClear:!0,placeholder:"Tất cả nhân viên"})}),e.jsx(i,{label:"Khách hàng",className:"w-[175px] border-none mr-2",children:e.jsx(c,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:se,filterOption:!1,allowClear:!0,placeholder:"Tất cả loại khách hàng",onSelect:s=>{k(s)},onClear:()=>k("")})}),e.jsx(i,{label:"Nhóm khách hàng",className:"w-[175px] border-none mr-2",children:e.jsx(c,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:q,onSelect:s=>{N(s)},onSearch:s=>{A(s)},onClear:()=>N(""),filterOption:!1,allowClear:!0,placeholder:"Tất cả nhóm khách hàng"})}),e.jsx(i,{label:"Khu vực",className:"w-[175px] border-none mr-2",children:e.jsx(c,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:B,onSelect:s=>{v(s)},onSearch:s=>{Z(s)},onClear:()=>v(""),filterOption:!1,allowClear:!0,placeholder:"Tất cả khu vực"})}),e.jsx(i,{label:" ",className:"w-[175px] border-none mr-2",children:e.jsx(c,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:re,filterOption:!1,allowClear:!0,showSearch:!0,onSelect:s=>{I(s)},onClear:()=>I(void 0)})})]})}),e.jsx("div",{className:"pt-5",children:e.jsx(te,{dataSource:r?.data?.map(s=>({...s,key:s.name})),bordered:!0,columns:ne,pagination:{defaultPageSize:u,total:p,showSizeChanger:!1,onChange(s){O(s)}},scroll:{x:!0},summary:()=>e.jsxs(l.Summary.Row,{children:[e.jsx(l.Summary.Cell,{index:0}),e.jsx(l.Summary.Cell,{index:1,children:"Tổng"}),e.jsx(l.Summary.Cell,{index:2}),e.jsx(l.Summary.Cell,{index:3}),e.jsx(l.Summary.Cell,{index:4}),e.jsx(l.Summary.Cell,{index:5}),e.jsx(l.Summary.Cell,{index:6}),e.jsx(l.Summary.Cell,{index:7}),e.jsx(l.Summary.Cell,{index:8}),e.jsx(l.Summary.Cell,{index:9}),e.jsx(l.Summary.Cell,{index:10}),e.jsx(l.Summary.Cell,{index:11}),e.jsx(l.Summary.Cell,{index:12}),e.jsx(l.Summary.Cell,{index:13}),e.jsx(l.Summary.Cell,{index:14}),e.jsx(l.Summary.Cell,{index:15,children:e.jsx("div",{className:"text-right",children:r?.sum?.sum_checkin})}),e.jsx(l.Summary.Cell,{index:16}),e.jsx(l.Summary.Cell,{index:17}),e.jsx(l.Summary.Cell,{index:18,children:e.jsx("div",{className:"text-right",children:r?.sum?.sum_so})})]})})})]})})})}function ye(){return e.jsxs(e.Fragment,{children:[e.jsx(W,{children:e.jsx("title",{children:" ReportCustomNew"})}),e.jsx(oe,{})]})}export{ye as default};
