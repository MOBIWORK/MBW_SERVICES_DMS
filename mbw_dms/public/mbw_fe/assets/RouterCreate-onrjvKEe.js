import{r as ue,_ as ns,a as Hi,c as Wr,b as Sa,K as Dy,d as Ls,e as uo,f as Fg,g as Hh,h as Rs,i as Gi,k as Wc,l as z0,m as N0,n as Zc,o as U0,p as Ly,q as wl,s as Pg,t as Mg,v as Dg,E as Ry,w as b0,x as V0,y as Oy,z as By,D as zy,G as Lg,I as Ny,J as T0,M as Rg,N as Wa,O as Uy,P as Vy,Q as bl,U as $y,V as Og,W as Bg,X as zg,Y as Ui,Z as Ng,$ as jy,a0 as Gy,a1 as Qp,a2 as Ug,a3 as Vg,a4 as em,a5 as Hy,a6 as qy,a7 as $g,a8 as Wy,a9 as Zy,aa as tm,ab as rm,B as po,ac as Xy,ad as Ky,ae as Yy,af as Jy,j as Ye,R as mo,A as Tn,C as Ti,F as Ri,ag as Ih,S as zn,T as $0,ah as Qy,ai as ev,aj as tv,ak as E0,al as rv,am as jg,an as av,ao as iv,ap as nv,aq as i0,u as sv,ar as ov,H as lv}from"./index-KwWGhUjE.js";import{u as cv}from"./useDebount-8PooBZHK.js";import{I as uv,i as hv,M as S0,T as fv}from"./index-493UCEmH.js";import{a as dv,b as pv}from"./index.esm-5lW-GXHl.js";import{H as mv}from"./header-page-rQLPC4DX.js";var Gg=ue.forwardRef(function(e,n){var a=e.prefixCls,c=e.style,u=e.className,m=e.duration,x=m===void 0?4.5:m,o=e.eventKey,E=e.content,w=e.closable,C=e.closeIcon,P=C===void 0?"x":C,M=e.props,O=e.onClick,U=e.onNoticeClose,z=e.times,j=e.hovering,ee=ue.useState(!1),le=ns(ee,2),Z=le[0],fe=le[1],me=j||Z,Te=function(){U(o)},re=function(Fe){(Fe.key==="Enter"||Fe.code==="Enter"||Fe.keyCode===Dy.ENTER)&&Te()};ue.useEffect(function(){if(!me&&x>0){var be=setTimeout(function(){Te()},x*1e3);return function(){clearTimeout(be)}}},[x,me,z]);var Ce="".concat(a,"-notice");return ue.createElement("div",Hi({},M,{ref:n,className:Wr(Ce,u,Sa({},"".concat(Ce,"-closable"),w)),style:c,onMouseEnter:function(Fe){var Oe;fe(!0),M==null||(Oe=M.onMouseEnter)===null||Oe===void 0||Oe.call(M,Fe)},onMouseLeave:function(Fe){var Oe;fe(!1),M==null||(Oe=M.onMouseLeave)===null||Oe===void 0||Oe.call(M,Fe)},onClick:O}),ue.createElement("div",{className:"".concat(Ce,"-content")},E),w&&ue.createElement("a",{tabIndex:0,className:"".concat(Ce,"-close"),onKeyDown:re,onClick:function(Fe){Fe.preventDefault(),Fe.stopPropagation(),Te()}},P))}),Hg=Ls.createContext({}),gv=function(n){var a=n.children,c=n.classNames;return Ls.createElement(Hg.Provider,{value:{classNames:c}},a)},am=8,im=3,nm=16,xv=function(n){var a={offset:am,threshold:im,gap:nm};if(n&&uo(n)==="object"){var c,u,m;a.offset=(c=n.offset)!==null&&c!==void 0?c:am,a.threshold=(u=n.threshold)!==null&&u!==void 0?u:im,a.gap=(m=n.gap)!==null&&m!==void 0?m:nm}return[!!n,a]},_v=["className","style","classNames","styles"],yv=function(n){var a,c=n.configList,u=n.placement,m=n.prefixCls,x=n.className,o=n.style,E=n.motion,w=n.onAllNoticeRemoved,C=n.onNoticeClose,P=n.stack,M=ue.useContext(Hg),O=M.classNames,U=ue.useRef({}),z=ue.useState(null),j=ns(z,2),ee=j[0],le=j[1],Z=ue.useState([]),fe=ns(Z,2),me=fe[0],Te=fe[1],re=c.map(function(nt){return{config:nt,key:String(nt.key)}}),Ce=xv(P),be=ns(Ce,2),Fe=be[0],Oe=be[1],Me=Oe.offset,rt=Oe.threshold,ft=Oe.gap,lt=Fe&&(me.length>0||re.length<=rt),_t=typeof E=="function"?E(u):E;return ue.useEffect(function(){Fe&&me.length>1&&Te(function(nt){return nt.filter(function(Kt){return re.some(function(He){var Nt=He.key;return Kt===Nt})})})},[me,re,Fe]),ue.useEffect(function(){var nt;if(Fe&&U.current[(nt=re[re.length-1])===null||nt===void 0?void 0:nt.key]){var Kt;le(U.current[(Kt=re[re.length-1])===null||Kt===void 0?void 0:Kt.key])}},[re,Fe]),Ls.createElement(Fg,Hi({key:u,className:Wr(m,"".concat(m,"-").concat(u),O?.list,x,(a={},Sa(a,"".concat(m,"-stack"),!!Fe),Sa(a,"".concat(m,"-stack-expanded"),lt),a)),style:o,keys:re,motionAppear:!0},_t,{onAllRemoved:function(){w(u)}}),function(nt,Kt){var He=nt.config,Nt=nt.className,Mt=nt.style,pe=nt.index,Ee=He,Se=Ee.key,Ie=Ee.times,Ke=String(Se),dt=He,vt=dt.className,ut=dt.style,Qe=dt.classNames,qt=dt.styles,_e=Hh(dt,_v),Yt=re.findIndex(function(Fr){return Fr.key===Ke}),Wt={};if(Fe){var nr=re.length-1-(Yt>-1?Yt:pe-1),Zt=u==="top"||u==="bottom"?"-50%":"0";if(nr>0){var wt,gr,Mr;Wt.height=lt?(wt=U.current[Ke])===null||wt===void 0?void 0:wt.offsetHeight:ee?.offsetHeight;for(var Xe=0,Sr=0;Sr<nr;Sr++){var Vr;Xe+=((Vr=U.current[re[re.length-1-Sr].key])===null||Vr===void 0?void 0:Vr.offsetHeight)+ft}var lr=(lt?Xe:nr*Me)*(u.startsWith("top")?1:-1),Xt=!lt&&ee!==null&&ee!==void 0&&ee.offsetWidth&&(gr=U.current[Ke])!==null&&gr!==void 0&&gr.offsetWidth?(ee?.offsetWidth-Me*2*(nr<3?nr:3))/((Mr=U.current[Ke])===null||Mr===void 0?void 0:Mr.offsetWidth):1;Wt.transform="translate3d(".concat(Zt,", ").concat(lr,"px, 0) scaleX(").concat(Xt,")")}else Wt.transform="translate3d(".concat(Zt,", 0, 0)")}return Ls.createElement("div",{ref:Kt,className:Wr("".concat(m,"-notice-wrapper"),Nt,Qe?.wrapper),style:Rs(Rs(Rs({},Mt),Wt),qt?.wrapper),onMouseEnter:function(){return Te(function(Or){return Or.includes(Ke)?Or:[].concat(Gi(Or),[Ke])})},onMouseLeave:function(){return Te(function(Or){return Or.filter(function(ia){return ia!==Ke})})}},Ls.createElement(Gg,Hi({},_e,{ref:function(Or){Yt>-1?U.current[Ke]=Or:delete U.current[Ke]},prefixCls:m,classNames:Qe,styles:qt,className:Wr(vt,O?.notice),style:ut,times:Ie,key:Se,eventKey:Se,onNoticeClose:C,hovering:Fe&&me.length>0})))})},vv=ue.forwardRef(function(e,n){var a=e.prefixCls,c=a===void 0?"rc-notification":a,u=e.container,m=e.motion,x=e.maxCount,o=e.className,E=e.style,w=e.onAllRemoved,C=e.stack,P=e.renderNotifications,M=ue.useState([]),O=ns(M,2),U=O[0],z=O[1],j=function(be){var Fe,Oe=U.find(function(Me){return Me.key===be});Oe==null||(Fe=Oe.onClose)===null||Fe===void 0||Fe.call(Oe),z(function(Me){return Me.filter(function(rt){return rt.key!==be})})};ue.useImperativeHandle(n,function(){return{open:function(be){z(function(Fe){var Oe=Gi(Fe),Me=Oe.findIndex(function(lt){return lt.key===be.key}),rt=Rs({},be);if(Me>=0){var ft;rt.times=(((ft=Fe[Me])===null||ft===void 0?void 0:ft.times)||0)+1,Oe[Me]=rt}else rt.times=0,Oe.push(rt);return x>0&&Oe.length>x&&(Oe=Oe.slice(-x)),Oe})},close:function(be){j(be)},destroy:function(){z([])}}});var ee=ue.useState({}),le=ns(ee,2),Z=le[0],fe=le[1];ue.useEffect(function(){var Ce={};U.forEach(function(be){var Fe=be.placement,Oe=Fe===void 0?"topRight":Fe;Oe&&(Ce[Oe]=Ce[Oe]||[],Ce[Oe].push(be))}),Object.keys(Z).forEach(function(be){Ce[be]=Ce[be]||[]}),fe(Ce)},[U]);var me=function(be){fe(function(Fe){var Oe=Rs({},Fe),Me=Oe[be]||[];return Me.length||delete Oe[be],Oe})},Te=ue.useRef(!1);if(ue.useEffect(function(){Object.keys(Z).length>0?Te.current=!0:Te.current&&(w?.(),Te.current=!1)},[Z]),!u)return null;var re=Object.keys(Z);return Wc.createPortal(ue.createElement(ue.Fragment,null,re.map(function(Ce){var be=Z[Ce],Fe=ue.createElement(yv,{key:Ce,configList:be,placement:Ce,prefixCls:c,className:o?.(Ce),style:E?.(Ce),motion:m,onNoticeClose:j,onAllNoticeRemoved:me,stack:C});return P?P(Fe,{prefixCls:c,key:Ce}):Fe})),u)}),wv=["getContainer","motion","prefixCls","maxCount","className","style","onAllRemoved","stack","renderNotifications"],bv=function(){return document.body},sm=0;function Tv(){for(var e={},n=arguments.length,a=new Array(n),c=0;c<n;c++)a[c]=arguments[c];return a.forEach(function(u){u&&Object.keys(u).forEach(function(m){var x=u[m];x!==void 0&&(e[m]=x)})}),e}function Ev(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.getContainer,a=n===void 0?bv:n,c=e.motion,u=e.prefixCls,m=e.maxCount,x=e.className,o=e.style,E=e.onAllRemoved,w=e.stack,C=e.renderNotifications,P=Hh(e,wv),M=ue.useState(),O=ns(M,2),U=O[0],z=O[1],j=ue.useRef(),ee=ue.createElement(vv,{container:U,ref:j,prefixCls:u,motion:c,maxCount:m,className:x,style:o,onAllRemoved:E,stack:w,renderNotifications:C}),le=ue.useState([]),Z=ns(le,2),fe=Z[0],me=Z[1],Te=ue.useMemo(function(){return{open:function(Ce){var be=Tv(P,Ce);(be.key===null||be.key===void 0)&&(be.key="rc-notification-".concat(sm),sm+=1),me(function(Fe){return[].concat(Gi(Fe),[{type:"open",config:be}])})},close:function(Ce){me(function(be){return[].concat(Gi(be),[{type:"close",key:Ce}])})},destroy:function(){me(function(Ce){return[].concat(Gi(Ce),[{type:"destroy"}])})}}},[]);return ue.useEffect(function(){z(a())}),ue.useEffect(function(){j.current&&fe.length&&(fe.forEach(function(re){switch(re.type){case"open":j.current.open(re.config);break;case"close":j.current.close(re.key);break;case"destroy":j.current.destroy();break}}),me(function(re){return re.filter(function(Ce){return!fe.includes(Ce)})}))},[fe]),[Te,ee]}const Sv=e=>{const{componentCls:n,iconCls:a,boxShadow:c,colorText:u,colorSuccess:m,colorError:x,colorWarning:o,colorInfo:E,fontSizeLG:w,motionEaseInOutCirc:C,motionDurationSlow:P,marginXS:M,paddingXS:O,borderRadiusLG:U,zIndexPopup:z,contentPadding:j,contentBg:ee}=e,le=`${n}-notice`,Z=new Zc("MessageMoveIn",{"0%":{padding:0,transform:"translateY(-100%)",opacity:0},"100%":{padding:O,transform:"translateY(0)",opacity:1}}),fe=new Zc("MessageMoveOut",{"0%":{maxHeight:e.height,padding:O,opacity:1},"100%":{maxHeight:0,padding:0,opacity:0}}),me={padding:O,textAlign:"center",[`${n}-custom-content > ${a}`]:{verticalAlign:"text-bottom",marginInlineEnd:M,fontSize:w},[`${le}-content`]:{display:"inline-block",padding:j,background:ee,borderRadius:U,boxShadow:c,pointerEvents:"all"},[`${n}-success > ${a}`]:{color:m},[`${n}-error > ${a}`]:{color:x},[`${n}-warning > ${a}`]:{color:o},[`${n}-info > ${a},
      ${n}-loading > ${a}`]:{color:E}};return[{[n]:Object.assign(Object.assign({},U0(e)),{color:u,position:"fixed",top:M,width:"100%",pointerEvents:"none",zIndex:z,[`${n}-move-up`]:{animationFillMode:"forwards"},[`
        ${n}-move-up-appear,
        ${n}-move-up-enter
      `]:{animationName:Z,animationDuration:P,animationPlayState:"paused",animationTimingFunction:C},[`
        ${n}-move-up-appear${n}-move-up-appear-active,
        ${n}-move-up-enter${n}-move-up-enter-active
      `]:{animationPlayState:"running"},[`${n}-move-up-leave`]:{animationName:fe,animationDuration:P,animationPlayState:"paused",animationTimingFunction:C},[`${n}-move-up-leave${n}-move-up-leave-active`]:{animationPlayState:"running"},"&-rtl":{direction:"rtl",span:{direction:"rtl"}}})},{[n]:{[`${le}-wrapper`]:Object.assign({},me)}},{[`${n}-notice-pure-panel`]:Object.assign(Object.assign({},me),{padding:0,textAlign:"start"})}]},kv=e=>({zIndexPopup:e.zIndexPopupBase+Ly+10,contentBg:e.colorBgElevated,contentPadding:`${(e.controlHeightLG-e.fontSize*e.lineHeight)/2}px ${e.paddingSM}px`}),qg=z0("Message",e=>{const n=N0(e,{height:150});return[Sv(n)]},kv);var Cv=function(e,n){var a={};for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&n.indexOf(c)<0&&(a[c]=e[c]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var u=0,c=Object.getOwnPropertySymbols(e);u<c.length;u++)n.indexOf(c[u])<0&&Object.prototype.propertyIsEnumerable.call(e,c[u])&&(a[c[u]]=e[c[u]]);return a};const Av={info:ue.createElement(uv,null),success:ue.createElement(Mg,null),error:ue.createElement(Dg,null),warning:ue.createElement(Ry,null),loading:ue.createElement(b0,null)},Wg=e=>{let{prefixCls:n,type:a,icon:c,children:u}=e;return ue.createElement("div",{className:Wr(`${n}-custom-content`,`${n}-${a}`)},c||Av[a],ue.createElement("span",null,u))},Iv=e=>{const{prefixCls:n,className:a,type:c,icon:u,content:m}=e,x=Cv(e,["prefixCls","className","type","icon","content"]),{getPrefixCls:o}=ue.useContext(wl),E=n||o("message"),w=Pg(E),[C,P,M]=qg(E,w);return C(ue.createElement(Gg,Object.assign({},x,{prefixCls:E,className:Wr(a,P,`${E}-notice-pure-panel`,M,w),eventKey:"pure",duration:null,content:ue.createElement(Wg,{prefixCls:E,type:c,icon:u},m)})))},Fv=Iv;function Pv(e,n){return{motionName:n??`${e}-move-up`}}function j0(e){let n;const a=new Promise(u=>{n=e(()=>{u(!0)})}),c=()=>{n?.()};return c.then=(u,m)=>a.then(u,m),c.promise=a,c}var Mv=function(e,n){var a={};for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&n.indexOf(c)<0&&(a[c]=e[c]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var u=0,c=Object.getOwnPropertySymbols(e);u<c.length;u++)n.indexOf(c[u])<0&&Object.prototype.propertyIsEnumerable.call(e,c[u])&&(a[c[u]]=e[c[u]]);return a};const Dv=8,Lv=3,Rv=e=>{let{children:n,prefixCls:a}=e;const c=Pg(a),[u,m,x]=qg(a,c);return u(ue.createElement(gv,{classNames:{list:Wr(m,x,c)}},n))},Ov=(e,n)=>{let{prefixCls:a,key:c}=n;return ue.createElement(Rv,{prefixCls:a,key:c},e)},Bv=ue.forwardRef((e,n)=>{const{top:a,prefixCls:c,getContainer:u,maxCount:m,duration:x=Lv,rtl:o,transitionName:E,onAllRemoved:w}=e,{getPrefixCls:C,getPopupContainer:P,message:M}=ue.useContext(wl),O=c||C("message"),U=()=>({left:"50%",transform:"translateX(-50%)",top:a??Dv}),z=()=>Wr({[`${O}-rtl`]:o}),j=()=>Pv(O,E),ee=ue.createElement("span",{className:`${O}-close-x`},ue.createElement(V0,{className:`${O}-close-icon`})),[le,Z]=Ev({prefixCls:O,style:U,className:z,motion:j,closable:!1,closeIcon:ee,duration:x,getContainer:()=>u?.()||P?.()||document.body,maxCount:m,onAllRemoved:w,renderNotifications:Ov});return ue.useImperativeHandle(n,()=>Object.assign(Object.assign({},le),{prefixCls:O,message:M})),Z});let om=0;function Zg(e){const n=ue.useRef(null);return Oy(),[ue.useMemo(()=>{const c=E=>{var w;(w=n.current)===null||w===void 0||w.close(E)},u=E=>{if(!n.current){const Te=()=>{};return Te.then=()=>{},Te}const{open:w,prefixCls:C,message:P}=n.current,M=`${C}-notice`,{content:O,icon:U,type:z,key:j,className:ee,style:le,onClose:Z}=E,fe=Mv(E,["content","icon","type","key","className","style","onClose"]);let me=j;return me==null&&(om+=1,me=`antd-message-${om}`),j0(Te=>(w(Object.assign(Object.assign({},fe),{key:me,content:ue.createElement(Wg,{prefixCls:C,type:z,icon:U},O),placement:"top",className:Wr(z&&`${M}-${z}`,ee,P?.className),style:Object.assign(Object.assign({},P?.style),le),onClose:()=>{Z?.(),Te()}})),()=>{c(me)}))},x={open:u,destroy:E=>{var w;E!==void 0?c(E):(w=n.current)===null||w===void 0||w.destroy()}};return["info","success","warning","error","loading"].forEach(E=>{const w=(C,P,M)=>{let O;C&&typeof C=="object"&&"content"in C?O=C:O={content:C};let U,z;typeof P=="function"?z=P:(U=P,z=M);const j=Object.assign(Object.assign({onClose:z,duration:U},O),{type:E});return u(j)};x[E]=w}),x},[]),ue.createElement(Bv,Object.assign({key:"message-holder"},e,{ref:n}))]}function zv(e){return Zg(e)}let sn=null,ho=e=>e(),Xc=[],Fh={};function lm(){const{prefixCls:e,getContainer:n,duration:a,rtl:c,maxCount:u,top:m}=Fh,x=e??Lg().getPrefixCls("message"),o=n?.()||document.body;return{prefixCls:x,getContainer:()=>o,duration:a,rtl:c,maxCount:u,top:m}}const Nv=ue.forwardRef((e,n)=>{const[a,c]=ue.useState(lm),[u,m]=Zg(a),x=Lg(),o=x.getRootPrefixCls(),E=x.getIconPrefixCls(),w=x.getTheme(),C=()=>{c(lm)};return ue.useEffect(C,[]),ue.useImperativeHandle(n,()=>{const P=Object.assign({},u);return Object.keys(P).forEach(M=>{P[M]=function(){return C(),u[M].apply(u,arguments)}}),{instance:P,sync:C}}),ue.createElement(zy,{prefixCls:o,iconPrefixCls:E,theme:w},m)});function qh(){if(!sn){const e=document.createDocumentFragment(),n={fragment:e};sn=n,ho(()=>{By(ue.createElement(Nv,{ref:a=>{const{instance:c,sync:u}=a||{};Promise.resolve().then(()=>{!n.instance&&c&&(n.instance=c,n.sync=u,qh())})}}),e)});return}sn.instance&&(Xc.forEach(e=>{const{type:n,skipped:a}=e;if(!a)switch(n){case"open":{ho(()=>{const c=sn.instance.open(Object.assign(Object.assign({},Fh),e.config));c?.then(e.resolve),e.setCloseFn(c)});break}case"destroy":ho(()=>{sn?.instance.destroy(e.key)});break;default:ho(()=>{var c;const u=(c=sn.instance)[n].apply(c,Gi(e.args));u?.then(e.resolve),e.setCloseFn(u)})}}),Xc=[])}function Uv(e){Fh=Object.assign(Object.assign({},Fh),e),ho(()=>{var n;(n=sn?.sync)===null||n===void 0||n.call(sn)})}function Vv(e){const n=j0(a=>{let c;const u={type:"open",config:e,resolve:a,setCloseFn:m=>{c=m}};return Xc.push(u),()=>{c?ho(()=>{c()}):u.skipped=!0}});return qh(),n}function $v(e,n){const a=j0(c=>{let u;const m={type:e,args:n,resolve:c,setCloseFn:x=>{u=x}};return Xc.push(m),()=>{u?ho(()=>{u()}):m.skipped=!0}});return qh(),a}function jv(e){Xc.push({type:"destroy",key:e}),qh()}const Gv=["success","info","warning","error","loading"],Hv={open:Vv,destroy:jv,config:Uv,useMessage:zv,_InternalPanelDoNotUseOrYouWillBeFired:Fv},Kc=Hv;Gv.forEach(e=>{Kc[e]=function(){for(var n=arguments.length,a=new Array(n),c=0;c<n;c++)a[c]=arguments[c];return $v(e,a)}});var qv={percent:0,prefixCls:"rc-progress",strokeColor:"#2db7f5",strokeLinecap:"round",strokeWidth:1,trailColor:"#D9D9D9",trailWidth:1,gapPosition:"bottom"},Wv=function(){var n=ue.useRef([]),a=ue.useRef(null);return ue.useEffect(function(){var c=Date.now(),u=!1;n.current.forEach(function(m){if(m){u=!0;var x=m.style;x.transitionDuration=".3s, .3s, .3s, .06s",a.current&&c-a.current<100&&(x.transitionDuration="0s, 0s")}}),u&&(a.current=Date.now())}),n.current},cm=0,Zv=Ny();function Xv(){var e;return Zv?(e=cm,cm+=1):e="TEST_OR_SSR",e}const Kv=function(e){var n=ue.useState(),a=ns(n,2),c=a[0],u=a[1];return ue.useEffect(function(){u("rc_progress_".concat(Xv()))},[]),e||c};var um=function(n){var a=n.bg,c=n.children;return ue.createElement("div",{style:{width:"100%",height:"100%",background:a}},c)};function hm(e,n){return Object.keys(e).map(function(a){var c=parseFloat(a),u="".concat(Math.floor(c*n),"%");return"".concat(e[a]," ").concat(u)})}var Yv=ue.forwardRef(function(e,n){var a=e.prefixCls,c=e.color,u=e.gradientId,m=e.radius,x=e.style,o=e.ptg,E=e.strokeLinecap,w=e.strokeWidth,C=e.size,P=e.gapDegree,M=c&&uo(c)==="object",O=M?"#FFF":void 0,U=C/2,z=ue.createElement("circle",{className:"".concat(a,"-circle-path"),r:m,cx:U,cy:U,stroke:O,strokeLinecap:E,strokeWidth:w,opacity:o===0?0:1,style:x,ref:n});if(!M)return z;var j="".concat(u,"-conic"),ee=P?"".concat(180+P/2,"deg"):"0deg",le=hm(c,(360-P)/360),Z=hm(c,1),fe="conic-gradient(from ".concat(ee,", ").concat(le.join(", "),")"),me="linear-gradient(to ".concat(P?"bottom":"top",", ").concat(Z.join(", "),")");return ue.createElement(ue.Fragment,null,ue.createElement("mask",{id:j},z),ue.createElement("foreignObject",{x:0,y:0,width:C,height:C,mask:"url(#".concat(j,")")},ue.createElement(um,{bg:me},ue.createElement(um,{bg:fe}))))}),Mc=100,n0=function(n,a,c,u,m,x,o,E,w,C){var P=arguments.length>10&&arguments[10]!==void 0?arguments[10]:0,M=c/100*360*((360-x)/360),O=x===0?0:{bottom:0,top:180,left:90,right:-90}[o],U=(100-u)/100*a;w==="round"&&u!==100&&(U+=C/2,U>=a&&(U=a-.01));var z=Mc/2;return{stroke:typeof E=="string"?E:void 0,strokeDasharray:"".concat(a,"px ").concat(n),strokeDashoffset:U+P,transform:"rotate(".concat(m+M+O,"deg)"),transformOrigin:"".concat(z,"px ").concat(z,"px"),transition:"stroke-dashoffset .3s ease 0s, stroke-dasharray .3s ease 0s, stroke .3s, stroke-width .06s ease .3s, opacity .3s ease 0s",fillOpacity:0}},Jv=["id","prefixCls","steps","strokeWidth","trailWidth","gapDegree","gapPosition","trailColor","strokeLinecap","style","className","strokeColor","percent"];function fm(e){var n=e??[];return Array.isArray(n)?n:[n]}var Qv=function(n){var a=Rs(Rs({},qv),n),c=a.id,u=a.prefixCls,m=a.steps,x=a.strokeWidth,o=a.trailWidth,E=a.gapDegree,w=E===void 0?0:E,C=a.gapPosition,P=a.trailColor,M=a.strokeLinecap,O=a.style,U=a.className,z=a.strokeColor,j=a.percent,ee=Hh(a,Jv),le=Mc/2,Z=Kv(c),fe="".concat(Z,"-gradient"),me=le-x/2,Te=Math.PI*2*me,re=w>0?90+w/2:-90,Ce=Te*((360-w)/360),be=uo(m)==="object"?m:{count:m,space:2},Fe=be.count,Oe=be.space,Me=fm(j),rt=fm(z),ft=rt.find(function(Mt){return Mt&&uo(Mt)==="object"}),lt=ft&&uo(ft)==="object",_t=lt?"butt":M,nt=n0(Te,Ce,0,100,re,w,C,P,_t,x),Kt=Wv(),He=function(){var pe=0;return Me.map(function(Ee,Se){var Ie=rt[Se]||rt[rt.length-1],Ke=n0(Te,Ce,pe,Ee,re,w,C,Ie,_t,x);return pe+=Ee,ue.createElement(Yv,{key:Se,color:Ie,ptg:Ee,radius:me,prefixCls:u,gradientId:fe,style:Ke,strokeLinecap:_t,strokeWidth:x,gapDegree:w,ref:function(vt){Kt[Se]=vt},size:Mc})}).reverse()},Nt=function(){var pe=Math.round(Fe*(Me[0]/100)),Ee=100/Fe,Se=0;return new Array(Fe).fill(null).map(function(Ie,Ke){var dt=Ke<=pe-1?rt[0]:P,vt=dt&&uo(dt)==="object"?"url(#".concat(fe,")"):void 0,ut=n0(Te,Ce,Se,Ee,re,w,C,dt,"butt",x,Oe);return Se+=(Ce-ut.strokeDashoffset+Oe)*100/Ce,ue.createElement("circle",{key:Ke,className:"".concat(u,"-circle-path"),r:me,cx:le,cy:le,stroke:vt,strokeWidth:x,opacity:1,style:ut,ref:function(qt){Kt[Ke]=qt}})})};return ue.createElement("svg",Hi({className:Wr("".concat(u,"-circle"),U),viewBox:"0 0 ".concat(Mc," ").concat(Mc),style:O,id:c,role:"presentation"},ee),!Fe&&ue.createElement("circle",{className:"".concat(u,"-circle-trail"),r:me,cx:le,cy:le,stroke:P,strokeLinecap:_t,strokeWidth:o||x,style:nt}),Fe?Nt():He())};function Os(e){return!e||e<0?0:e>100?100:e}function Ph(e){let{success:n,successPercent:a}=e,c=a;return n&&"progress"in n&&(c=n.progress),n&&"percent"in n&&(c=n.percent),c}const e2=e=>{let{percent:n,success:a,successPercent:c}=e;const u=Os(Ph({success:a,successPercent:c}));return[u,Os(Os(n)-u)]},t2=e=>{let{success:n={},strokeColor:a}=e;const{strokeColor:c}=n;return[c||T0.green,a||null]},Wh=(e,n,a)=>{var c,u,m,x;let o=-1,E=-1;if(n==="step"){const w=a.steps,C=a.strokeWidth;typeof e=="string"||typeof e>"u"?(o=e==="small"?2:14,E=C??8):typeof e=="number"?[o,E]=[e,e]:[o=14,E=8]=e,o*=w}else if(n==="line"){const w=a?.strokeWidth;typeof e=="string"||typeof e>"u"?E=w||(e==="small"?6:8):typeof e=="number"?[o,E]=[e,e]:[o=-1,E=8]=e}else(n==="circle"||n==="dashboard")&&(typeof e=="string"||typeof e>"u"?[o,E]=e==="small"?[60,60]:[120,120]:typeof e=="number"?[o,E]=[e,e]:(o=(u=(c=e[0])!==null&&c!==void 0?c:e[1])!==null&&u!==void 0?u:120,E=(x=(m=e[0])!==null&&m!==void 0?m:e[1])!==null&&x!==void 0?x:120));return[o,E]},r2=3,a2=e=>r2/e*100,i2=e=>{const{prefixCls:n,trailColor:a=null,strokeLinecap:c="round",gapPosition:u,gapDegree:m,width:x=120,type:o,children:E,success:w,size:C=x}=e,[P,M]=Wh(C,"circle");let{strokeWidth:O}=e;O===void 0&&(O=Math.max(a2(P),6));const U={width:P,height:M,fontSize:P*.15+6},z=ue.useMemo(()=>{if(m||m===0)return m;if(o==="dashboard")return 75},[m,o]),j=u||o==="dashboard"&&"bottom"||void 0,ee=Object.prototype.toString.call(e.strokeColor)==="[object Object]",le=t2({success:w,strokeColor:e.strokeColor}),Z=Wr(`${n}-inner`,{[`${n}-circle-gradient`]:ee}),fe=ue.createElement(Qv,{percent:e2(e),strokeWidth:O,trailWidth:O,strokeColor:le,strokeLinecap:c,trailColor:a,prefixCls:n,gapDegree:z,gapPosition:j});return ue.createElement("div",{className:Z,style:U},P<=20?ue.createElement(Rg,{title:E},ue.createElement("span",null,fe)):ue.createElement(ue.Fragment,null,fe,E))},n2=i2,Mh="--progress-line-stroke-color",Xg="--progress-percent",dm=e=>{const n=e?"100%":"-100%";return new Zc(`antProgress${e?"RTL":"LTR"}Active`,{"0%":{transform:`translateX(${n}) scaleX(0)`,opacity:.1},"20%":{transform:`translateX(${n}) scaleX(0)`,opacity:.5},to:{transform:"translateX(0) scaleX(1)",opacity:0}})},s2=e=>{const{componentCls:n,iconCls:a}=e;return{[n]:Object.assign(Object.assign({},U0(e)),{display:"inline-block","&-rtl":{direction:"rtl"},"&-line":{position:"relative",width:"100%",fontSize:e.fontSize,marginInlineEnd:e.marginXS,marginBottom:e.marginXS},[`${n}-outer`]:{display:"inline-block",width:"100%"},[`&${n}-show-info`]:{[`${n}-outer`]:{marginInlineEnd:`calc(-2em - ${Wa(e.marginXS)})`,paddingInlineEnd:`calc(2em + ${Wa(e.paddingXS)})`}},[`${n}-inner`]:{position:"relative",display:"inline-block",width:"100%",overflow:"hidden",verticalAlign:"middle",backgroundColor:e.remainingColor,borderRadius:e.lineBorderRadius},[`${n}-inner:not(${n}-circle-gradient)`]:{[`${n}-circle-path`]:{stroke:e.defaultColor}},[`${n}-success-bg, ${n}-bg`]:{position:"relative",background:e.defaultColor,borderRadius:e.lineBorderRadius,transition:`all ${e.motionDurationSlow} ${e.motionEaseInOutCirc}`},[`${n}-bg`]:{overflow:"hidden","&::after":{content:'""',background:{_multi_value_:!0,value:["inherit",`var(${Mh})`]},height:"100%",width:`calc(1 / var(${Xg}) * 100%)`,display:"block"}},[`${n}-success-bg`]:{position:"absolute",insetBlockStart:0,insetInlineStart:0,backgroundColor:e.colorSuccess},[`${n}-text`]:{display:"inline-block",width:"2em",marginInlineStart:e.marginXS,color:e.colorText,lineHeight:1,whiteSpace:"nowrap",textAlign:"start",verticalAlign:"middle",wordBreak:"normal",[a]:{fontSize:e.fontSize}},[`&${n}-status-active`]:{[`${n}-bg::before`]:{position:"absolute",inset:0,backgroundColor:e.colorBgContainer,borderRadius:e.lineBorderRadius,opacity:0,animationName:dm(),animationDuration:e.progressActiveMotionDuration,animationTimingFunction:e.motionEaseOutQuint,animationIterationCount:"infinite",content:'""'}},[`&${n}-rtl${n}-status-active`]:{[`${n}-bg::before`]:{animationName:dm(!0)}},[`&${n}-status-exception`]:{[`${n}-bg`]:{backgroundColor:e.colorError},[`${n}-text`]:{color:e.colorError}},[`&${n}-status-exception ${n}-inner:not(${n}-circle-gradient)`]:{[`${n}-circle-path`]:{stroke:e.colorError}},[`&${n}-status-success`]:{[`${n}-bg`]:{backgroundColor:e.colorSuccess},[`${n}-text`]:{color:e.colorSuccess}},[`&${n}-status-success ${n}-inner:not(${n}-circle-gradient)`]:{[`${n}-circle-path`]:{stroke:e.colorSuccess}}})}},o2=e=>{const{componentCls:n,iconCls:a}=e;return{[n]:{[`${n}-circle-trail`]:{stroke:e.remainingColor},[`&${n}-circle ${n}-inner`]:{position:"relative",lineHeight:1,backgroundColor:"transparent"},[`&${n}-circle ${n}-text`]:{position:"absolute",insetBlockStart:"50%",insetInlineStart:0,width:"100%",margin:0,padding:0,color:e.circleTextColor,fontSize:e.circleTextFontSize,lineHeight:1,whiteSpace:"normal",textAlign:"center",transform:"translateY(-50%)",[a]:{fontSize:e.circleIconFontSize}},[`${n}-circle&-status-exception`]:{[`${n}-text`]:{color:e.colorError}},[`${n}-circle&-status-success`]:{[`${n}-text`]:{color:e.colorSuccess}}},[`${n}-inline-circle`]:{lineHeight:1,[`${n}-inner`]:{verticalAlign:"bottom"}}}},l2=e=>{const{componentCls:n}=e;return{[n]:{[`${n}-steps`]:{display:"inline-block","&-outer":{display:"flex",flexDirection:"row",alignItems:"center"},"&-item":{flexShrink:0,minWidth:e.progressStepMinWidth,marginInlineEnd:e.progressStepMarginInlineEnd,backgroundColor:e.remainingColor,transition:`all ${e.motionDurationSlow}`,"&-active":{backgroundColor:e.defaultColor}}}}}},c2=e=>{const{componentCls:n,iconCls:a}=e;return{[n]:{[`${n}-small&-line, ${n}-small&-line ${n}-text ${a}`]:{fontSize:e.fontSizeSM}}}},u2=e=>({circleTextColor:e.colorText,defaultColor:e.colorInfo,remainingColor:e.colorFillSecondary,lineBorderRadius:100,circleTextFontSize:"1em",circleIconFontSize:`${e.fontSize/e.fontSizeSM}em`}),h2=z0("Progress",e=>{const n=e.calc(e.marginXXS).div(2).equal(),a=N0(e,{progressStepMarginInlineEnd:n,progressStepMinWidth:n,progressActiveMotionDuration:"2.4s"});return[s2(a),o2(a),l2(a),c2(a)]},u2);var f2=function(e,n){var a={};for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&n.indexOf(c)<0&&(a[c]=e[c]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var u=0,c=Object.getOwnPropertySymbols(e);u<c.length;u++)n.indexOf(c[u])<0&&Object.prototype.propertyIsEnumerable.call(e,c[u])&&(a[c[u]]=e[c[u]]);return a};const d2=e=>{let n=[];return Object.keys(e).forEach(a=>{const c=parseFloat(a.replace(/%/g,""));isNaN(c)||n.push({key:c,value:e[a]})}),n=n.sort((a,c)=>a.key-c.key),n.map(a=>{let{key:c,value:u}=a;return`${u} ${c}%`}).join(", ")},p2=(e,n)=>{const{from:a=T0.blue,to:c=T0.blue,direction:u=n==="rtl"?"to left":"to right"}=e,m=f2(e,["from","to","direction"]);if(Object.keys(m).length!==0){const o=d2(m),E=`linear-gradient(${u}, ${o})`;return{background:E,[Mh]:E}}const x=`linear-gradient(${u}, ${a}, ${c})`;return{background:x,[Mh]:x}},m2=e=>{const{prefixCls:n,direction:a,percent:c,size:u,strokeWidth:m,strokeColor:x,strokeLinecap:o="round",children:E,trailColor:w=null,success:C}=e,P=x&&typeof x!="string"?p2(x,a):{[Mh]:x,background:x},M=o==="square"||o==="butt"?0:void 0,O=u??[-1,m||(u==="small"?6:8)],[U,z]=Wh(O,"line",{strokeWidth:m}),j={backgroundColor:w||void 0,borderRadius:M},ee=Object.assign(Object.assign({width:`${Os(c)}%`,height:z,borderRadius:M},P),{[Xg]:Os(c)/100}),le=Ph(e),Z={width:`${Os(le)}%`,height:z,borderRadius:M,backgroundColor:C?.strokeColor},fe={width:U<0?"100%":U,height:z};return ue.createElement(ue.Fragment,null,ue.createElement("div",{className:`${n}-outer`,style:fe},ue.createElement("div",{className:`${n}-inner`,style:j},ue.createElement("div",{className:`${n}-bg`,style:ee}),le!==void 0?ue.createElement("div",{className:`${n}-success-bg`,style:Z}):null)),E)},g2=m2,x2=e=>{const{size:n,steps:a,percent:c=0,strokeWidth:u=8,strokeColor:m,trailColor:x=null,prefixCls:o,children:E}=e,w=Math.round(a*(c/100)),P=n??[n==="small"?2:14,u],[M,O]=Wh(P,"step",{steps:a,strokeWidth:u}),U=M/a,z=new Array(a);for(let j=0;j<a;j++){const ee=Array.isArray(m)?m[j]:m;z[j]=ue.createElement("div",{key:j,className:Wr(`${o}-steps-item`,{[`${o}-steps-item-active`]:j<=w-1}),style:{backgroundColor:j<=w-1?ee:x,width:U,height:O}})}return ue.createElement("div",{className:`${o}-steps-outer`},z,E)},_2=x2;var y2=function(e,n){var a={};for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&n.indexOf(c)<0&&(a[c]=e[c]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var u=0,c=Object.getOwnPropertySymbols(e);u<c.length;u++)n.indexOf(c[u])<0&&Object.prototype.propertyIsEnumerable.call(e,c[u])&&(a[c[u]]=e[c[u]]);return a};const v2=["normal","exception","active","success"],w2=ue.forwardRef((e,n)=>{const{prefixCls:a,className:c,rootClassName:u,steps:m,strokeColor:x,percent:o=0,size:E="default",showInfo:w=!0,type:C="line",status:P,format:M,style:O}=e,U=y2(e,["prefixCls","className","rootClassName","steps","strokeColor","percent","size","showInfo","type","status","format","style"]),z=ue.useMemo(()=>{var rt,ft;const lt=Ph(e);return parseInt(lt!==void 0?(rt=lt??0)===null||rt===void 0?void 0:rt.toString():(ft=o??0)===null||ft===void 0?void 0:ft.toString(),10)},[o,e.success,e.successPercent]),j=ue.useMemo(()=>!v2.includes(P)&&z>=100?"success":P||"normal",[P,z]),{getPrefixCls:ee,direction:le,progress:Z}=ue.useContext(wl),fe=ee("progress",a),[me,Te,re]=h2(fe),Ce=ue.useMemo(()=>{if(!w)return null;const rt=Ph(e);let ft;const lt=M||(nt=>`${nt}%`),_t=C==="line";return M||j!=="exception"&&j!=="success"?ft=lt(Os(o),Os(rt)):j==="exception"?ft=_t?ue.createElement(Dg,null):ue.createElement(V0,null):j==="success"&&(ft=_t?ue.createElement(Mg,null):ue.createElement(Vy,null)),ue.createElement("span",{className:`${fe}-text`,title:typeof ft=="string"?ft:void 0},ft)},[w,o,z,j,C,fe,M]),be=Array.isArray(x)?x[0]:x,Fe=typeof x=="string"||Array.isArray(x)?x:void 0;let Oe;C==="line"?Oe=m?ue.createElement(_2,Object.assign({},e,{strokeColor:Fe,prefixCls:fe,steps:m}),Ce):ue.createElement(g2,Object.assign({},e,{strokeColor:be,prefixCls:fe,direction:le}),Ce):(C==="circle"||C==="dashboard")&&(Oe=ue.createElement(n2,Object.assign({},e,{strokeColor:be,prefixCls:fe,progressStatus:j}),Ce));const Me=Wr(fe,`${fe}-status-${j}`,`${fe}-${C==="dashboard"&&"circle"||m&&"steps"||C}`,{[`${fe}-inline-circle`]:C==="circle"&&Wh(E,"circle")[0]<=20,[`${fe}-show-info`]:w,[`${fe}-${E}`]:typeof E=="string",[`${fe}-rtl`]:le==="rtl"},Z?.className,c,u,Te,re);return me(ue.createElement("div",Object.assign({ref:n,style:Object.assign(Object.assign({},Z?.style),O),className:Me,role:"progressbar","aria-valuenow":z},Uy(U,["trailColor","strokeWidth","width","gapDegree","gapPosition","strokeLinecap","success","successPercent"])),Oe))}),b2=w2;var T2={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z"}}]},name:"delete",theme:"outlined"};const E2=T2;var S2=function(n,a){return ue.createElement(bl,Hi({},n,{ref:a,icon:E2}))};const Kg=ue.forwardRef(S2),s0=function(e,n){if(e&&n){var a=Array.isArray(n)?n:n.split(","),c=e.name||"",u=e.type||"",m=u.replace(/\/.*$/,"");return a.some(function(x){var o=x.trim();if(/^\*(\/\*)?$/.test(x))return!0;if(o.charAt(0)==="."){var E=c.toLowerCase(),w=o.toLowerCase(),C=[w];return(w===".jpg"||w===".jpeg")&&(C=[".jpg",".jpeg"]),C.some(function(P){return E.endsWith(P)})}return/\/\*$/.test(o)?m===o.replace(/\/.*$/,""):u===o?!0:/^\w+$/.test(o)?($y(!1,"Upload takes an invalidate 'accept' type '".concat(o,"'.Skip for check.")),!0):!1})}return!0};function k2(e,n){var a="cannot ".concat(e.method," ").concat(e.action," ").concat(n.status,"'"),c=new Error(a);return c.status=n.status,c.method=e.method,c.url=e.action,c}function pm(e){var n=e.responseText||e.response;if(!n)return n;try{return JSON.parse(n)}catch{return n}}function C2(e){var n=new XMLHttpRequest;e.onProgress&&n.upload&&(n.upload.onprogress=function(m){m.total>0&&(m.percent=m.loaded/m.total*100),e.onProgress(m)});var a=new FormData;e.data&&Object.keys(e.data).forEach(function(u){var m=e.data[u];if(Array.isArray(m)){m.forEach(function(x){a.append("".concat(u,"[]"),x)});return}a.append(u,m)}),e.file instanceof Blob?a.append(e.filename,e.file,e.file.name):a.append(e.filename,e.file),n.onerror=function(m){e.onError(m)},n.onload=function(){return n.status<200||n.status>=300?e.onError(k2(e,n),pm(n)):e.onSuccess(pm(n),n)},n.open(e.method,e.action,!0),e.withCredentials&&"withCredentials"in n&&(n.withCredentials=!0);var c=e.headers||{};return c["X-Requested-With"]!==null&&n.setRequestHeader("X-Requested-With","XMLHttpRequest"),Object.keys(c).forEach(function(u){c[u]!==null&&n.setRequestHeader(u,c[u])}),n.send(a),{abort:function(){n.abort()}}}function A2(e,n){var a=e.createReader(),c=[];function u(){a.readEntries(function(m){var x=Array.prototype.slice.apply(m);c=c.concat(x);var o=!x.length;o?n(c):u()})}u()}var I2=function(n,a,c){var u=function m(x,o){x&&(x.path=o||"",x.isFile?x.file(function(E){c(E)&&(x.fullPath&&!E.webkitRelativePath&&(Object.defineProperties(E,{webkitRelativePath:{writable:!0}}),E.webkitRelativePath=x.fullPath.replace(/^\//,""),Object.defineProperties(E,{webkitRelativePath:{writable:!1}})),a([E]))}):x.isDirectory&&A2(x,function(E){E.forEach(function(w){m(w,"".concat(o).concat(x.name,"/"))})}))};n.forEach(function(m){u(m.webkitGetAsEntry())})},F2=+new Date,P2=0;function o0(){return"rc-upload-".concat(F2,"-").concat(++P2)}var M2=["component","prefixCls","className","classNames","disabled","id","style","styles","multiple","accept","capture","children","directory","openFileDialogOnClick","onMouseEnter","onMouseLeave","hasControlInside"],D2=function(e){Og(a,e);var n=Bg(a);function a(){var c;zg(this,a);for(var u=arguments.length,m=new Array(u),x=0;x<u;x++)m[x]=arguments[x];return c=n.call.apply(n,[this].concat(m)),Sa(Ui(c),"state",{uid:o0()}),Sa(Ui(c),"reqs",{}),Sa(Ui(c),"fileInput",void 0),Sa(Ui(c),"_isMounted",void 0),Sa(Ui(c),"onChange",function(o){var E=c.props,w=E.accept,C=E.directory,P=o.target.files,M=Gi(P).filter(function(O){return!C||s0(O,w)});c.uploadFiles(M),c.reset()}),Sa(Ui(c),"onClick",function(o){var E=c.fileInput;if(E){var w=o.target,C=c.props.onClick;if(w&&w.tagName==="BUTTON"){var P=E.parentNode;P.focus(),w.blur()}E.click(),C&&C(o)}}),Sa(Ui(c),"onKeyDown",function(o){o.key==="Enter"&&c.onClick(o)}),Sa(Ui(c),"onFileDrop",function(o){var E=c.props.multiple;if(o.preventDefault(),o.type!=="dragover")if(c.props.directory)I2(Array.prototype.slice.call(o.dataTransfer.items),c.uploadFiles,function(C){return s0(C,c.props.accept)});else{var w=Gi(o.dataTransfer.files).filter(function(C){return s0(C,c.props.accept)});E===!1&&(w=w.slice(0,1)),c.uploadFiles(w)}}),Sa(Ui(c),"uploadFiles",function(o){var E=Gi(o),w=E.map(function(C){return C.uid=o0(),c.processFile(C,E)});Promise.all(w).then(function(C){var P=c.props.onBatchStart;P?.(C.map(function(M){var O=M.origin,U=M.parsedFile;return{file:O,parsedFile:U}})),C.filter(function(M){return M.parsedFile!==null}).forEach(function(M){c.post(M)})})}),Sa(Ui(c),"processFile",function(){var o=Gy(Qp().mark(function E(w,C){var P,M,O,U,z,j,ee,le,Z;return Qp().wrap(function(me){for(;;)switch(me.prev=me.next){case 0:if(P=c.props.beforeUpload,M=w,!P){me.next=14;break}return me.prev=3,me.next=6,P(w,C);case 6:M=me.sent,me.next=12;break;case 9:me.prev=9,me.t0=me.catch(3),M=!1;case 12:if(M!==!1){me.next=14;break}return me.abrupt("return",{origin:w,parsedFile:null,action:null,data:null});case 14:if(O=c.props.action,typeof O!="function"){me.next=21;break}return me.next=18,O(w);case 18:U=me.sent,me.next=22;break;case 21:U=O;case 22:if(z=c.props.data,typeof z!="function"){me.next=29;break}return me.next=26,z(w);case 26:j=me.sent,me.next=30;break;case 29:j=z;case 30:return ee=(uo(M)==="object"||typeof M=="string")&&M?M:w,ee instanceof File?le=ee:le=new File([ee],w.name,{type:w.type}),Z=le,Z.uid=w.uid,me.abrupt("return",{origin:w,data:j,parsedFile:Z,action:U});case 35:case"end":return me.stop()}},E,null,[[3,9]])}));return function(E,w){return o.apply(this,arguments)}}()),Sa(Ui(c),"saveFileInput",function(o){c.fileInput=o}),c}return Ng(a,[{key:"componentDidMount",value:function(){this._isMounted=!0}},{key:"componentWillUnmount",value:function(){this._isMounted=!1,this.abort()}},{key:"post",value:function(u){var m=this,x=u.data,o=u.origin,E=u.action,w=u.parsedFile;if(this._isMounted){var C=this.props,P=C.onStart,M=C.customRequest,O=C.name,U=C.headers,z=C.withCredentials,j=C.method,ee=o.uid,le=M||C2,Z={action:E,filename:O,data:x,file:w,headers:U,withCredentials:z,method:j||"post",onProgress:function(me){var Te=m.props.onProgress;Te?.(me,w)},onSuccess:function(me,Te){var re=m.props.onSuccess;re?.(me,w,Te),delete m.reqs[ee]},onError:function(me,Te){var re=m.props.onError;re?.(me,Te,w),delete m.reqs[ee]}};P(o),this.reqs[ee]=le(Z)}}},{key:"reset",value:function(){this.setState({uid:o0()})}},{key:"abort",value:function(u){var m=this.reqs;if(u){var x=u.uid?u.uid:u;m[x]&&m[x].abort&&m[x].abort(),delete m[x]}else Object.keys(m).forEach(function(o){m[o]&&m[o].abort&&m[o].abort(),delete m[o]})}},{key:"render",value:function(){var u,m=this.props,x=m.component,o=m.prefixCls,E=m.className,w=m.classNames,C=w===void 0?{}:w,P=m.disabled,M=m.id,O=m.style,U=m.styles,z=U===void 0?{}:U,j=m.multiple,ee=m.accept,le=m.capture,Z=m.children,fe=m.directory,me=m.openFileDialogOnClick,Te=m.onMouseEnter,re=m.onMouseLeave,Ce=m.hasControlInside,be=Hh(m,M2),Fe=Wr((u={},Sa(u,o,!0),Sa(u,"".concat(o,"-disabled"),P),Sa(u,E,E),u)),Oe=fe?{directory:"directory",webkitdirectory:"webkitdirectory"}:{},Me=P?{}:{onClick:me?this.onClick:function(){},onKeyDown:me?this.onKeyDown:function(){},onMouseEnter:Te,onMouseLeave:re,onDrop:this.onFileDrop,onDragOver:this.onFileDrop,tabIndex:Ce?void 0:"0"};return Ls.createElement(x,Hi({},Me,{className:Fe,role:Ce?void 0:"button",style:O}),Ls.createElement("input",Hi({},jy(be,{aria:!0,data:!0}),{id:M,disabled:P,type:"file",ref:this.saveFileInput,onClick:function(ft){return ft.stopPropagation()},key:this.state.uid,style:Rs({display:"none"},z.input),className:C.input,accept:ee},Oe,{multiple:j,onChange:this.onChange},le!=null?{capture:le}:{})),Z)}}]),a}(ue.Component);function l0(){}var k0=function(e){Og(a,e);var n=Bg(a);function a(){var c;zg(this,a);for(var u=arguments.length,m=new Array(u),x=0;x<u;x++)m[x]=arguments[x];return c=n.call.apply(n,[this].concat(m)),Sa(Ui(c),"uploader",void 0),Sa(Ui(c),"saveUploader",function(o){c.uploader=o}),c}return Ng(a,[{key:"abort",value:function(u){this.uploader.abort(u)}},{key:"render",value:function(){return Ls.createElement(D2,Hi({},this.props,{ref:this.saveUploader}))}}]),a}(ue.Component);Sa(k0,"defaultProps",{component:"span",prefixCls:"rc-upload",data:{},headers:{},name:"file",multipart:!1,onStart:l0,onError:l0,onSuccess:l0,multiple:!1,beforeUpload:null,customRequest:null,withCredentials:!1,openFileDialogOnClick:!0,hasControlInside:!1});const L2=e=>{const{componentCls:n,iconCls:a}=e;return{[`${n}-wrapper`]:{[`${n}-drag`]:{position:"relative",width:"100%",height:"100%",textAlign:"center",background:e.colorFillAlter,border:`${Wa(e.lineWidth)} dashed ${e.colorBorder}`,borderRadius:e.borderRadiusLG,cursor:"pointer",transition:`border-color ${e.motionDurationSlow}`,[n]:{padding:e.padding},[`${n}-btn`]:{display:"table",width:"100%",height:"100%",outline:"none",borderRadius:e.borderRadiusLG,"&:focus-visible":{outline:`${Wa(e.lineWidthFocus)} solid ${e.colorPrimaryBorder}`}},[`${n}-drag-container`]:{display:"table-cell",verticalAlign:"middle"},[`
          &:not(${n}-disabled):hover,
          &-hover:not(${n}-disabled)
        `]:{borderColor:e.colorPrimaryHover},[`p${n}-drag-icon`]:{marginBottom:e.margin,[a]:{color:e.colorPrimary,fontSize:e.uploadThumbnailSize}},[`p${n}-text`]:{margin:`0 0 ${Wa(e.marginXXS)}`,color:e.colorTextHeading,fontSize:e.fontSizeLG},[`p${n}-hint`]:{color:e.colorTextDescription,fontSize:e.fontSize},[`&${n}-disabled`]:{[`p${n}-drag-icon ${a},
            p${n}-text,
            p${n}-hint
          `]:{color:e.colorTextDisabled}}}}}},R2=e=>{const{componentCls:n,antCls:a,iconCls:c,fontSize:u,lineHeight:m,calc:x}=e,o=`${n}-list-item`,E=`${o}-actions`,w=`${o}-action`,C=e.fontHeightSM;return{[`${n}-wrapper`]:{[`${n}-list`]:Object.assign(Object.assign({},Ug()),{lineHeight:e.lineHeight,[o]:{position:"relative",height:x(e.lineHeight).mul(u).equal(),marginTop:e.marginXS,fontSize:u,display:"flex",alignItems:"center",transition:`background-color ${e.motionDurationSlow}`,"&:hover":{backgroundColor:e.controlItemBgHover},[`${o}-name`]:Object.assign(Object.assign({},Vg),{padding:`0 ${Wa(e.paddingXS)}`,lineHeight:m,flex:"auto",transition:`all ${e.motionDurationSlow}`}),[E]:{[w]:{opacity:0},[c]:{color:e.actionsColor,transition:`all ${e.motionDurationSlow}`},[`
              ${w}:focus-visible,
              &.picture ${w}
            `]:{opacity:1},[`${w}${a}-btn`]:{height:C,border:0,lineHeight:1}},[`${n}-icon ${c}`]:{color:e.colorTextDescription,fontSize:u},[`${o}-progress`]:{position:"absolute",bottom:e.calc(e.uploadProgressOffset).mul(-1).equal(),width:"100%",paddingInlineStart:x(u).add(e.paddingXS).equal(),fontSize:u,lineHeight:0,pointerEvents:"none","> div":{margin:0}}},[`${o}:hover ${w}`]:{opacity:1},[`${o}-error`]:{color:e.colorError,[`${o}-name, ${n}-icon ${c}`]:{color:e.colorError},[E]:{[`${c}, ${c}:hover`]:{color:e.colorError},[w]:{opacity:1}}},[`${n}-list-item-container`]:{transition:`opacity ${e.motionDurationSlow}, height ${e.motionDurationSlow}`,"&::before":{display:"table",width:0,height:0,content:'""'}}})}}},mm=new Zc("uploadAnimateInlineIn",{from:{width:0,height:0,margin:0,padding:0,opacity:0}}),gm=new Zc("uploadAnimateInlineOut",{to:{width:0,height:0,margin:0,padding:0,opacity:0}}),O2=e=>{const{componentCls:n}=e,a=`${n}-animate-inline`;return[{[`${n}-wrapper`]:{[`${a}-appear, ${a}-enter, ${a}-leave`]:{animationDuration:e.motionDurationSlow,animationTimingFunction:e.motionEaseInOutCirc,animationFillMode:"forwards"},[`${a}-appear, ${a}-enter`]:{animationName:mm},[`${a}-leave`]:{animationName:gm}}},{[`${n}-wrapper`]:hv(e)},mm,gm]},B2=e=>{const{componentCls:n,iconCls:a,uploadThumbnailSize:c,uploadProgressOffset:u,calc:m}=e,x=`${n}-list`,o=`${x}-item`;return{[`${n}-wrapper`]:{[`
        ${x}${x}-picture,
        ${x}${x}-picture-card,
        ${x}${x}-picture-circle
      `]:{[o]:{position:"relative",height:m(c).add(m(e.lineWidth).mul(2)).add(m(e.paddingXS).mul(2)).equal(),padding:e.paddingXS,border:`${Wa(e.lineWidth)} ${e.lineType} ${e.colorBorder}`,borderRadius:e.borderRadiusLG,"&:hover":{background:"transparent"},[`${o}-thumbnail`]:Object.assign(Object.assign({},Vg),{width:c,height:c,lineHeight:Wa(m(c).add(e.paddingSM).equal()),textAlign:"center",flex:"none",[a]:{fontSize:e.fontSizeHeading2,color:e.colorPrimary},img:{display:"block",width:"100%",height:"100%",overflow:"hidden"}}),[`${o}-progress`]:{bottom:u,width:`calc(100% - ${Wa(m(e.paddingSM).mul(2).equal())})`,marginTop:0,paddingInlineStart:m(c).add(e.paddingXS).equal()}},[`${o}-error`]:{borderColor:e.colorError,[`${o}-thumbnail ${a}`]:{[`svg path[fill='${em[0]}']`]:{fill:e.colorErrorBg},[`svg path[fill='${em.primary}']`]:{fill:e.colorError}}},[`${o}-uploading`]:{borderStyle:"dashed",[`${o}-name`]:{marginBottom:u}}},[`${x}${x}-picture-circle ${o}`]:{[`&, &::before, ${o}-thumbnail`]:{borderRadius:"50%"}}}}},z2=e=>{const{componentCls:n,iconCls:a,fontSizeLG:c,colorTextLightSolid:u,calc:m}=e,x=`${n}-list`,o=`${x}-item`,E=e.uploadPicCardSize;return{[`
      ${n}-wrapper${n}-picture-card-wrapper,
      ${n}-wrapper${n}-picture-circle-wrapper
    `]:Object.assign(Object.assign({},Ug()),{display:"inline-block",width:"100%",[`${n}${n}-select`]:{width:E,height:E,marginInlineEnd:e.marginXS,marginBottom:e.marginXS,textAlign:"center",verticalAlign:"top",backgroundColor:e.colorFillAlter,border:`${Wa(e.lineWidth)} dashed ${e.colorBorder}`,borderRadius:e.borderRadiusLG,cursor:"pointer",transition:`border-color ${e.motionDurationSlow}`,[`> ${n}`]:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",textAlign:"center"},[`&:not(${n}-disabled):hover`]:{borderColor:e.colorPrimary}},[`${x}${x}-picture-card, ${x}${x}-picture-circle`]:{[`${x}-item-container`]:{display:"inline-block",width:E,height:E,marginBlock:`0 ${Wa(e.marginXS)}`,marginInline:`0 ${Wa(e.marginXS)}`,verticalAlign:"top"},"&::after":{display:"none"},[o]:{height:"100%",margin:0,"&::before":{position:"absolute",zIndex:1,width:`calc(100% - ${Wa(m(e.paddingXS).mul(2).equal())})`,height:`calc(100% - ${Wa(m(e.paddingXS).mul(2).equal())})`,backgroundColor:e.colorBgMask,opacity:0,transition:`all ${e.motionDurationSlow}`,content:'" "'}},[`${o}:hover`]:{[`&::before, ${o}-actions`]:{opacity:1}},[`${o}-actions`]:{position:"absolute",insetInlineStart:0,zIndex:10,width:"100%",whiteSpace:"nowrap",textAlign:"center",opacity:0,transition:`all ${e.motionDurationSlow}`,[`
            ${a}-eye,
            ${a}-download,
            ${a}-delete
          `]:{zIndex:10,width:c,margin:`0 ${Wa(e.marginXXS)}`,fontSize:c,cursor:"pointer",transition:`all ${e.motionDurationSlow}`,color:u,"&:hover":{color:u},svg:{verticalAlign:"baseline"}}},[`${o}-thumbnail, ${o}-thumbnail img`]:{position:"static",display:"block",width:"100%",height:"100%",objectFit:"contain"},[`${o}-name`]:{display:"none",textAlign:"center"},[`${o}-file + ${o}-name`]:{position:"absolute",bottom:e.margin,display:"block",width:`calc(100% - ${Wa(m(e.paddingXS).mul(2).equal())})`},[`${o}-uploading`]:{[`&${o}`]:{backgroundColor:e.colorFillAlter},[`&::before, ${a}-eye, ${a}-download, ${a}-delete`]:{display:"none"}},[`${o}-progress`]:{bottom:e.marginXL,width:`calc(100% - ${Wa(m(e.paddingXS).mul(2).equal())})`,paddingInlineStart:0}}}),[`${n}-wrapper${n}-picture-circle-wrapper`]:{[`${n}${n}-select`]:{borderRadius:"50%"}}}},N2=e=>{const{componentCls:n}=e;return{[`${n}-rtl`]:{direction:"rtl"}}},U2=e=>{const{componentCls:n,colorTextDisabled:a}=e;return{[`${n}-wrapper`]:Object.assign(Object.assign({},U0(e)),{[n]:{outline:0,"input[type='file']":{cursor:"pointer"}},[`${n}-select`]:{display:"inline-block"},[`${n}-disabled`]:{color:a,cursor:"not-allowed"}})}},V2=e=>({actionsColor:e.colorTextDescription}),$2=z0("Upload",e=>{const{fontSizeHeading3:n,fontHeight:a,lineWidth:c,controlHeightLG:u,calc:m}=e,x=N0(e,{uploadThumbnailSize:m(n).mul(2).equal(),uploadProgressOffset:m(m(a).div(2)).add(c).equal(),uploadPicCardSize:m(u).mul(2.55).equal()});return[U2(x),L2(x),B2(x),z2(x),R2(x),O2(x),N2(x),Hy(x)]},V2);var j2={icon:function(n,a){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M534 352V136H232v752h560V394H576a42 42 0 01-42-42z",fill:a}},{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM602 137.8L790.2 326H602V137.8zM792 888H232V136h302v216a42 42 0 0042 42h216v494z",fill:n}}]}},name:"file",theme:"twotone"};const G2=j2;var H2=function(n,a){return ue.createElement(bl,Hi({},n,{ref:a,icon:G2}))};const q2=ue.forwardRef(H2);var W2={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M779.3 196.6c-94.2-94.2-247.6-94.2-341.7 0l-261 260.8c-1.7 1.7-2.6 4-2.6 6.4s.9 4.7 2.6 6.4l36.9 36.9a9 9 0 0012.7 0l261-260.8c32.4-32.4 75.5-50.2 121.3-50.2s88.9 17.8 121.2 50.2c32.4 32.4 50.2 75.5 50.2 121.2 0 45.8-17.8 88.8-50.2 121.2l-266 265.9-43.1 43.1c-40.3 40.3-105.8 40.3-146.1 0-19.5-19.5-30.2-45.4-30.2-73s10.7-53.5 30.2-73l263.9-263.8c6.7-6.6 15.5-10.3 24.9-10.3h.1c9.4 0 18.1 3.7 24.7 10.3 6.7 6.7 10.3 15.5 10.3 24.9 0 9.3-3.7 18.1-10.3 24.7L372.4 653c-1.7 1.7-2.6 4-2.6 6.4s.9 4.7 2.6 6.4l36.9 36.9a9 9 0 0012.7 0l215.6-215.6c19.9-19.9 30.8-46.3 30.8-74.4s-11-54.6-30.8-74.4c-41.1-41.1-107.9-41-149 0L463 364 224.8 602.1A172.22 172.22 0 00174 724.8c0 46.3 18.1 89.8 50.8 122.5 33.9 33.8 78.3 50.7 122.7 50.7 44.4 0 88.8-16.9 122.6-50.7l309.2-309C824.8 492.7 850 432 850 367.5c.1-64.6-25.1-125.3-70.7-170.9z"}}]},name:"paper-clip",theme:"outlined"};const Z2=W2;var X2=function(n,a){return ue.createElement(bl,Hi({},n,{ref:a,icon:Z2}))};const K2=ue.forwardRef(X2);var Y2={icon:function(n,a){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 632H136v-39.9l138.5-164.3 150.1 178L658.1 489 888 761.6V792zm0-129.8L664.2 396.8c-3.2-3.8-9-3.8-12.2 0L424.6 666.4l-144-170.7c-3.2-3.8-9-3.8-12.2 0L136 652.7V232h752v430.2z",fill:n}},{tag:"path",attrs:{d:"M424.6 765.8l-150.1-178L136 752.1V792h752v-30.4L658.1 489z",fill:a}},{tag:"path",attrs:{d:"M136 652.7l132.4-157c3.2-3.8 9-3.8 12.2 0l144 170.7L652 396.8c3.2-3.8 9-3.8 12.2 0L888 662.2V232H136v420.7zM304 280a88 88 0 110 176 88 88 0 010-176z",fill:a}},{tag:"path",attrs:{d:"M276 368a28 28 0 1056 0 28 28 0 10-56 0z",fill:a}},{tag:"path",attrs:{d:"M304 456a88 88 0 100-176 88 88 0 000 176zm0-116c15.5 0 28 12.5 28 28s-12.5 28-28 28-28-12.5-28-28 12.5-28 28-28z",fill:n}}]}},name:"picture",theme:"twotone"};const J2=Y2;var Q2=function(n,a){return ue.createElement(bl,Hi({},n,{ref:a,icon:J2}))};const ew=ue.forwardRef(Q2);function _h(e){return Object.assign(Object.assign({},e),{lastModified:e.lastModified,lastModifiedDate:e.lastModifiedDate,name:e.name,size:e.size,type:e.type,uid:e.uid,percent:0,originFileObj:e})}function yh(e,n){const a=Gi(n),c=a.findIndex(u=>{let{uid:m}=u;return m===e.uid});return c===-1?a.push(e):a[c]=e,a}function c0(e,n){const a=e.uid!==void 0?"uid":"name";return n.filter(c=>c[a]===e[a])[0]}function tw(e,n){const a=e.uid!==void 0?"uid":"name",c=n.filter(u=>u[a]!==e[a]);return c.length===n.length?null:c}const rw=function(){const n=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:"").split("/"),c=n[n.length-1].split(/#|\?/)[0];return(/\.[^./\\]*$/.exec(c)||[""])[0]},Yg=e=>e.indexOf("image/")===0,aw=e=>{if(e.type&&!e.thumbUrl)return Yg(e.type);const n=e.thumbUrl||e.url||"",a=rw(n);return/^data:image\//.test(n)||/(webp|svg|png|gif|jpg|jpeg|jfif|bmp|dpg|ico|heic|heif)$/i.test(a)?!0:!(/^data:/.test(n)||a)},As=200;function iw(e){return new Promise(n=>{if(!e.type||!Yg(e.type)){n("");return}const a=document.createElement("canvas");a.width=As,a.height=As,a.style.cssText=`position: fixed; left: 0; top: 0; width: ${As}px; height: ${As}px; z-index: 9999; display: none;`,document.body.appendChild(a);const c=a.getContext("2d"),u=new Image;if(u.onload=()=>{const{width:m,height:x}=u;let o=As,E=As,w=0,C=0;m>x?(E=x*(As/m),C=-(E-o)/2):(o=m*(As/x),w=-(o-E)/2),c.drawImage(u,w,C,o,E);const P=a.toDataURL();document.body.removeChild(a),window.URL.revokeObjectURL(u.src),n(P)},u.crossOrigin="anonymous",e.type.startsWith("image/svg+xml")){const m=new FileReader;m.onload=()=>{m.result&&(u.src=m.result)},m.readAsDataURL(e)}else if(e.type.startsWith("image/gif")){const m=new FileReader;m.onload=()=>{m.result&&n(m.result)},m.readAsDataURL(e)}else u.src=window.URL.createObjectURL(e)})}var nw={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M505.7 661a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9h-74.1V168c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v338.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.8zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"download",theme:"outlined"};const sw=nw;var ow=function(n,a){return ue.createElement(bl,Hi({},n,{ref:a,icon:sw}))};const Jg=ue.forwardRef(ow),lw=ue.forwardRef((e,n)=>{let{prefixCls:a,className:c,style:u,locale:m,listType:x,file:o,items:E,progress:w,iconRender:C,actionIconRender:P,itemRender:M,isImgUrl:O,showPreviewIcon:U,showRemoveIcon:z,showDownloadIcon:j,previewIcon:ee,removeIcon:le,downloadIcon:Z,onPreview:fe,onDownload:me,onClose:Te}=e;var re,Ce;const{status:be}=o,[Fe,Oe]=ue.useState(be);ue.useEffect(()=>{be!=="removed"&&Oe(be)},[be]);const[Me,rt]=ue.useState(!1);ue.useEffect(()=>{const Qe=setTimeout(()=>{rt(!0)},300);return()=>{clearTimeout(Qe)}},[]);const ft=C(o);let lt=ue.createElement("div",{className:`${a}-icon`},ft);if(x==="picture"||x==="picture-card"||x==="picture-circle")if(Fe==="uploading"||!o.thumbUrl&&!o.url){const Qe=Wr(`${a}-list-item-thumbnail`,{[`${a}-list-item-file`]:Fe!=="uploading"});lt=ue.createElement("div",{className:Qe},ft)}else{const Qe=O?.(o)?ue.createElement("img",{src:o.thumbUrl||o.url,alt:o.name,className:`${a}-list-item-image`,crossOrigin:o.crossOrigin}):ft,qt=Wr(`${a}-list-item-thumbnail`,{[`${a}-list-item-file`]:O&&!O(o)});lt=ue.createElement("a",{className:qt,onClick:_e=>fe(o,_e),href:o.url||o.thumbUrl,target:"_blank",rel:"noopener noreferrer"},Qe)}const _t=Wr(`${a}-list-item`,`${a}-list-item-${Fe}`),nt=typeof o.linkProps=="string"?JSON.parse(o.linkProps):o.linkProps,Kt=z?P((typeof le=="function"?le(o):le)||ue.createElement(Kg,null),()=>Te(o),a,m.removeFile,!0):null,He=j&&Fe==="done"?P((typeof Z=="function"?Z(o):Z)||ue.createElement(Jg,null),()=>me(o),a,m.downloadFile):null,Nt=x!=="picture-card"&&x!=="picture-circle"&&ue.createElement("span",{key:"download-delete",className:Wr(`${a}-list-item-actions`,{picture:x==="picture"})},He,Kt),Mt=Wr(`${a}-list-item-name`),pe=o.url?[ue.createElement("a",Object.assign({key:"view",target:"_blank",rel:"noopener noreferrer",className:Mt,title:o.name},nt,{href:o.url,onClick:Qe=>fe(o,Qe)}),o.name),Nt]:[ue.createElement("span",{key:"view",className:Mt,onClick:Qe=>fe(o,Qe),title:o.name},o.name),Nt],Ee=U&&(o.url||o.thumbUrl)?ue.createElement("a",{href:o.url||o.thumbUrl,target:"_blank",rel:"noopener noreferrer",onClick:Qe=>fe(o,Qe),title:m.previewFile},typeof ee=="function"?ee(o):ee||ue.createElement(qy,null)):null,Se=(x==="picture-card"||x==="picture-circle")&&Fe!=="uploading"&&ue.createElement("span",{className:`${a}-list-item-actions`},Ee,Fe==="done"&&He,Kt),{getPrefixCls:Ie}=ue.useContext(wl),Ke=Ie(),dt=ue.createElement("div",{className:_t},lt,pe,Se,Me&&ue.createElement($g,{motionName:`${Ke}-fade`,visible:Fe==="uploading",motionDeadline:2e3},Qe=>{let{className:qt}=Qe;const _e="percent"in o?ue.createElement(b2,Object.assign({},w,{type:"line",percent:o.percent,"aria-label":o["aria-label"],"aria-labelledby":o["aria-labelledby"]})):null;return ue.createElement("div",{className:Wr(`${a}-list-item-progress`,qt)},_e)})),vt=o.response&&typeof o.response=="string"?o.response:((re=o.error)===null||re===void 0?void 0:re.statusText)||((Ce=o.error)===null||Ce===void 0?void 0:Ce.message)||m.uploadError,ut=Fe==="error"?ue.createElement(Rg,{title:vt,getPopupContainer:Qe=>Qe.parentNode},dt):dt;return ue.createElement("div",{className:Wr(`${a}-list-item-container`,c),style:u,ref:n},M?M(ut,o,E,{download:me.bind(null,o),preview:fe.bind(null,o),remove:Te.bind(null,o)}):ut)}),cw=lw,uw=(e,n)=>{const{listType:a="text",previewFile:c=iw,onPreview:u,onDownload:m,onRemove:x,locale:o,iconRender:E,isImageUrl:w=aw,prefixCls:C,items:P=[],showPreviewIcon:M=!0,showRemoveIcon:O=!0,showDownloadIcon:U=!1,removeIcon:z,previewIcon:j,downloadIcon:ee,progress:le={size:[-1,2],showInfo:!1},appendAction:Z,appendActionVisible:fe=!0,itemRender:me,disabled:Te}=e,re=Wy(),[Ce,be]=ue.useState(!1);ue.useEffect(()=>{a!=="picture"&&a!=="picture-card"&&a!=="picture-circle"||(P||[]).forEach(Ee=>{typeof document>"u"||typeof window>"u"||!window.FileReader||!window.File||!(Ee.originFileObj instanceof File||Ee.originFileObj instanceof Blob)||Ee.thumbUrl!==void 0||(Ee.thumbUrl="",c&&c(Ee.originFileObj).then(Se=>{Ee.thumbUrl=Se||"",re()}))})},[a,P,c]),ue.useEffect(()=>{be(!0)},[]);const Fe=(Ee,Se)=>{if(u)return Se?.preventDefault(),u(Ee)},Oe=Ee=>{typeof m=="function"?m(Ee):Ee.url&&window.open(Ee.url)},Me=Ee=>{x?.(Ee)},rt=Ee=>{if(E)return E(Ee,a);const Se=Ee.status==="uploading",Ie=w&&w(Ee)?ue.createElement(ew,null):ue.createElement(q2,null);let Ke=Se?ue.createElement(b0,null):ue.createElement(K2,null);return a==="picture"?Ke=Se?ue.createElement(b0,null):Ie:(a==="picture-card"||a==="picture-circle")&&(Ke=Se?o.uploading:Ie),Ke},ft=(Ee,Se,Ie,Ke,dt)=>{const vt={type:"text",size:"small",title:Ke,onClick:ut=>{Se(),rm(Ee)&&Ee.props.onClick&&Ee.props.onClick(ut)},className:`${Ie}-list-item-action`};if(dt&&(vt.disabled=Te),rm(Ee)){const ut=tm(Ee,Object.assign(Object.assign({},Ee.props),{onClick:()=>{}}));return ue.createElement(po,Object.assign({},vt,{icon:ut}))}return ue.createElement(po,Object.assign({},vt),ue.createElement("span",null,Ee))};ue.useImperativeHandle(n,()=>({handlePreview:Fe,handleDownload:Oe}));const{getPrefixCls:lt}=ue.useContext(wl),_t=lt("upload",C),nt=lt(),Kt=Wr(`${_t}-list`,`${_t}-list-${a}`),He=Gi(P.map(Ee=>({key:Ee.uid,file:Ee})));let Mt={motionDeadline:2e3,motionName:`${_t}-${a==="picture-card"||a==="picture-circle"?"animate-inline":"animate"}`,keys:He,motionAppear:Ce};const pe=ue.useMemo(()=>{const Ee=Object.assign({},Zy(nt));return delete Ee.onAppearEnd,delete Ee.onEnterEnd,delete Ee.onLeaveEnd,Ee},[nt]);return a!=="picture-card"&&a!=="picture-circle"&&(Mt=Object.assign(Object.assign({},pe),Mt)),ue.createElement("div",{className:Kt},ue.createElement(Fg,Object.assign({},Mt,{component:!1}),Ee=>{let{key:Se,file:Ie,className:Ke,style:dt}=Ee;return ue.createElement(cw,{key:Se,locale:o,prefixCls:_t,className:Ke,style:dt,file:Ie,items:P,progress:le,listType:a,isImgUrl:w,showPreviewIcon:M,showRemoveIcon:O,showDownloadIcon:U,removeIcon:z,previewIcon:j,downloadIcon:ee,iconRender:rt,actionIconRender:ft,itemRender:me,onPreview:Fe,onDownload:Oe,onClose:Me})}),Z&&ue.createElement($g,Object.assign({},Mt,{visible:fe,forceRender:!0}),Ee=>{let{className:Se,style:Ie}=Ee;return tm(Z,Ke=>({className:Wr(Ke.className,Se),style:Object.assign(Object.assign(Object.assign({},Ie),{pointerEvents:Se?"none":void 0}),Ke.style)}))}))},hw=ue.forwardRef(uw),fw=hw;var dw=function(e,n,a,c){function u(m){return m instanceof a?m:new a(function(x){x(m)})}return new(a||(a=Promise))(function(m,x){function o(C){try{w(c.next(C))}catch(P){x(P)}}function E(C){try{w(c.throw(C))}catch(P){x(P)}}function w(C){C.done?m(C.value):u(C.value).then(o,E)}w((c=c.apply(e,n||[])).next())})};const Dc=`__LIST_IGNORE_${Date.now()}__`,pw=(e,n)=>{const{fileList:a,defaultFileList:c,onRemove:u,showUploadList:m=!0,listType:x="text",onPreview:o,onDownload:E,onChange:w,onDrop:C,previewFile:P,disabled:M,locale:O,iconRender:U,isImageUrl:z,progress:j,prefixCls:ee,className:le,type:Z="select",children:fe,style:me,itemRender:Te,maxCount:re,data:Ce={},multiple:be=!1,hasControlInside:Fe=!0,action:Oe="",accept:Me="",supportServerRender:rt=!0,rootClassName:ft}=e,lt=ue.useContext(Xy),_t=M??lt,[nt,Kt]=Ky(c||[],{value:a,postState:Dt=>Dt??[]}),[He,Nt]=ue.useState("drop"),Mt=ue.useRef(null);ue.useMemo(()=>{const Dt=Date.now();(a||[]).forEach((Vt,xr)=>{!Vt.uid&&!Object.isFrozen(Vt)&&(Vt.uid=`__AUTO__${Dt}_${xr}__`)})},[a]);const pe=(Dt,Vt,xr)=>{let rr=Gi(Vt),st=!1;re===1?rr=rr.slice(-1):re&&(st=rr.length>re,rr=rr.slice(0,re)),Wc.flushSync(()=>{Kt(rr)});const Ut={file:Dt,fileList:rr};xr&&(Ut.event=xr),(!st||rr.some(jt=>jt.uid===Dt.uid))&&Wc.flushSync(()=>{w?.(Ut)})},Ee=(Dt,Vt)=>dw(void 0,void 0,void 0,function*(){const{beforeUpload:xr,transformFile:rr}=e;let st=Dt;if(xr){const Ut=yield xr(Dt,Vt);if(Ut===!1)return!1;if(delete Dt[Dc],Ut===Dc)return Object.defineProperty(Dt,Dc,{value:!0,configurable:!0}),!1;typeof Ut=="object"&&Ut&&(st=Ut)}return rr&&(st=yield rr(st)),st}),Se=Dt=>{const Vt=Dt.filter(st=>!st.file[Dc]);if(!Vt.length)return;const xr=Vt.map(st=>_h(st.file));let rr=Gi(nt);xr.forEach(st=>{rr=yh(st,rr)}),xr.forEach((st,Ut)=>{let jt=st;if(Vt[Ut].parsedFile)st.status="uploading";else{const{originFileObj:Br}=st;let ca;try{ca=new File([Br],Br.name,{type:Br.type})}catch{ca=new Blob([Br],{type:Br.type}),ca.name=Br.name,ca.lastModifiedDate=new Date,ca.lastModified=new Date().getTime()}ca.uid=st.uid,jt=ca}pe(jt,rr)})},Ie=(Dt,Vt,xr)=>{try{typeof Dt=="string"&&(Dt=JSON.parse(Dt))}catch{}if(!c0(Vt,nt))return;const rr=_h(Vt);rr.status="done",rr.percent=100,rr.response=Dt,rr.xhr=xr;const st=yh(rr,nt);pe(rr,st)},Ke=(Dt,Vt)=>{if(!c0(Vt,nt))return;const xr=_h(Vt);xr.status="uploading",xr.percent=Dt.percent;const rr=yh(xr,nt);pe(xr,rr,Dt)},dt=(Dt,Vt,xr)=>{if(!c0(xr,nt))return;const rr=_h(xr);rr.error=Dt,rr.response=Vt,rr.status="error";const st=yh(rr,nt);pe(rr,st)},vt=Dt=>{let Vt;Promise.resolve(typeof u=="function"?u(Dt):u).then(xr=>{var rr;if(xr===!1)return;const st=tw(Dt,nt);st&&(Vt=Object.assign(Object.assign({},Dt),{status:"removed"}),nt?.forEach(Ut=>{const jt=Vt.uid!==void 0?"uid":"name";Ut[jt]===Vt[jt]&&!Object.isFrozen(Ut)&&(Ut.status="removed")}),(rr=Mt.current)===null||rr===void 0||rr.abort(Vt),pe(Vt,st))})},ut=Dt=>{Nt(Dt.type),Dt.type==="drop"&&C?.(Dt)};ue.useImperativeHandle(n,()=>({onBatchStart:Se,onSuccess:Ie,onProgress:Ke,onError:dt,fileList:nt,upload:Mt.current}));const{getPrefixCls:Qe,direction:qt,upload:_e}=ue.useContext(wl),Yt=Qe("upload",ee),Wt=Object.assign(Object.assign({onBatchStart:Se,onError:dt,onProgress:Ke,onSuccess:Ie},e),{data:Ce,multiple:be,action:Oe,accept:Me,supportServerRender:rt,prefixCls:Yt,disabled:_t,beforeUpload:Ee,onChange:void 0,hasControlInside:Fe});delete Wt.className,delete Wt.style,(!fe||_t)&&delete Wt.id;const nr=`${Yt}-wrapper`,[Zt,wt,gr]=$2(Yt,nr),[Mr]=Yy("Upload",Jy.Upload),{showRemoveIcon:Xe,showPreviewIcon:Sr,showDownloadIcon:Vr,removeIcon:lr,previewIcon:Xt,downloadIcon:Fr}=typeof m=="boolean"?{}:m,Or=typeof Xe>"u"?!_t:!!Xe,ia=(Dt,Vt)=>m?ue.createElement(fw,{prefixCls:Yt,listType:x,items:nt,previewFile:P,onPreview:o,onDownload:E,onRemove:vt,showRemoveIcon:Or,showPreviewIcon:Sr,showDownloadIcon:Vr,removeIcon:lr,previewIcon:Xt,downloadIcon:Fr,iconRender:U,locale:Object.assign(Object.assign({},Mr),O),isImageUrl:z,progress:j,appendAction:Dt,appendActionVisible:Vt,itemRender:Te,disabled:_t}):Dt,$r=Wr(nr,le,ft,wt,gr,_e?.className,{[`${Yt}-rtl`]:qt==="rtl",[`${Yt}-picture-card-wrapper`]:x==="picture-card",[`${Yt}-picture-circle-wrapper`]:x==="picture-circle"}),pa=Object.assign(Object.assign({},_e?.style),me);if(Z==="drag"){const Dt=Wr(wt,Yt,`${Yt}-drag`,{[`${Yt}-drag-uploading`]:nt.some(Vt=>Vt.status==="uploading"),[`${Yt}-drag-hover`]:He==="dragover",[`${Yt}-disabled`]:_t,[`${Yt}-rtl`]:qt==="rtl"});return Zt(ue.createElement("span",{className:$r},ue.createElement("div",{className:Dt,style:pa,onDrop:ut,onDragOver:ut,onDragLeave:ut},ue.createElement(k0,Object.assign({},Wt,{ref:Mt,className:`${Yt}-btn`}),ue.createElement("div",{className:`${Yt}-drag-container`},fe))),ia()))}const Qt=Wr(Yt,`${Yt}-select`,{[`${Yt}-disabled`]:_t}),ct=(Dt=>ue.createElement("div",{className:Qt,style:Dt},ue.createElement(k0,Object.assign({},Wt,{ref:Mt}))))(fe?void 0:{display:"none"});return Zt(x==="picture-card"||x==="picture-circle"?ue.createElement("span",{className:$r},ia(ct,!!fe)):ue.createElement("span",{className:$r},ct,ia()))},mw=ue.forwardRef(pw),Qg=mw;var gw=function(e,n){var a={};for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&n.indexOf(c)<0&&(a[c]=e[c]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var u=0,c=Object.getOwnPropertySymbols(e);u<c.length;u++)n.indexOf(c[u])<0&&Object.prototype.propertyIsEnumerable.call(e,c[u])&&(a[c[u]]=e[c[u]]);return a};const xw=ue.forwardRef((e,n)=>{var{style:a,height:c,hasControlInside:u=!1}=e,m=gw(e,["style","height","hasControlInside"]);return ue.createElement(Qg,Object.assign({ref:n,hasControlInside:u},m,{type:"drag",style:Object.assign(Object.assign({},a),{height:c})}))}),_w=xw,G0=Qg;G0.Dragger=_w;G0.LIST_IGNORE=Dc;const yw=G0;var vw={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M885.2 446.3l-.2-.8-112.2-285.1c-5-16.1-19.9-27.2-36.8-27.2H281.2c-17 0-32.1 11.3-36.9 27.6L139.4 443l-.3.7-.2.8c-1.3 4.9-1.7 9.9-1 14.8-.1 1.6-.2 3.2-.2 4.8V830a60.9 60.9 0 0060.8 60.8h627.2c33.5 0 60.8-27.3 60.9-60.8V464.1c0-1.3 0-2.6-.1-3.7.4-4.9 0-9.6-1.3-14.1zm-295.8-43l-.3 15.7c-.8 44.9-31.8 75.1-77.1 75.1-22.1 0-41.1-7.1-54.8-20.6S436 441.2 435.6 419l-.3-15.7H229.5L309 210h399.2l81.7 193.3H589.4zm-375 76.8h157.3c24.3 57.1 76 90.8 140.4 90.8 33.7 0 65-9.4 90.3-27.2 22.2-15.6 39.5-37.4 50.7-63.6h156.5V814H214.4V480.1z"}}]},name:"inbox",theme:"outlined"};const ww=vw;var bw=function(n,a){return ue.createElement(bl,Hi({},n,{ref:a,icon:ww}))};const Tw=ue.forwardRef(bw),Ew=({size:e=20})=>Ye.jsx("svg",{width:e,height:e,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:Ye.jsx("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M11.0267 1.13334C11.5534 0.501676 12.5792 0.933342 12.4959 1.75168L11.9076 7.50001H16.6667C16.8251 7.50007 16.9801 7.54524 17.1137 7.63024C17.2473 7.71523 17.3539 7.83653 17.4211 7.97993C17.4882 8.12333 17.5132 8.2829 17.4929 8.43994C17.4726 8.59698 17.4081 8.74501 17.3067 8.86668L8.97339 18.8667C8.44672 19.4983 7.42089 19.0667 7.50422 18.2483L8.09255 12.5H3.33339C3.17504 12.4999 3.01999 12.4548 2.88639 12.3698C2.75279 12.2848 2.64617 12.1635 2.57902 12.0201C2.51187 11.8767 2.48696 11.7171 2.50721 11.5601C2.52747 11.403 2.59205 11.255 2.69339 11.1333L11.0267 1.13334Z",fill:"currentColor"})}),Sw=({size:e=20})=>Ye.jsxs("svg",{width:e,height:e,viewBox:"0 0 28 28",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[Ye.jsx("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M9.83847 8.58794C10.1411 8.46187 10.4827 8.4689 10.7798 8.60732L15.0763 10.6088C15.6604 10.8809 15.9133 11.5749 15.6412 12.159C15.3691 12.7431 14.6751 12.996 14.091 12.7239L11.4888 11.5117L11.653 20.2421L15.7503 22.1045V15.7497C15.7503 15.1053 16.2727 14.583 16.917 14.583C17.5613 14.583 18.0837 15.1053 18.0837 15.7497V22.1663L22.7503 20.2219V13.4163C22.7503 12.772 23.2727 12.2497 23.917 12.2497C24.5613 12.2497 25.0837 12.772 25.0837 13.4163V20.9997C25.0837 21.4707 24.8005 21.8955 24.3657 22.0766L17.3657 24.9933C17.0666 25.1179 16.7292 25.1125 16.4342 24.9784L10.5003 22.2812L4.56643 24.9784C4.20532 25.1426 3.78555 25.112 3.45204 24.8972C3.11854 24.6825 2.91699 24.313 2.91699 23.9163V12.2497C2.91699 11.7787 3.20019 11.3539 3.63494 11.1728L9.83847 8.58794ZM9.31945 20.2549L9.15297 11.4013L5.25033 13.0275V22.1045L9.31945 20.2549Z",fill:"currentColor"}),Ye.jsx("path",{d:"M19.8337 8.61425C20.478 8.61425 21.0003 8.09192 21.0003 7.44759C21.0003 6.80326 20.478 6.28092 19.8337 6.28092C19.1893 6.28092 18.667 6.80326 18.667 7.44759C18.667 8.09192 19.1893 8.61425 19.8337 8.61425Z",fill:"currentColor"}),Ye.jsx("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M19.8337 2.33301C17.2197 2.33301 15.167 4.52385 15.167 7.1293C15.167 7.85019 15.4274 8.59094 15.7195 9.21916C16.0229 9.8717 16.4198 10.5259 16.8094 11.1056C17.5898 12.2664 18.4067 13.2245 18.579 13.4238L18.5825 13.4278C18.89 13.7803 19.3411 13.9997 19.8337 13.9997C20.3262 13.9997 20.7773 13.7803 21.0848 13.4278L21.0883 13.4238C21.2606 13.2245 22.0776 12.2664 22.8579 11.1056C23.2476 10.5259 23.6444 9.8717 23.9478 9.21916C24.2399 8.59094 24.5003 7.85019 24.5003 7.1293C24.5003 4.52385 22.4476 2.33301 19.8337 2.33301ZM17.5003 7.1293C17.5003 5.7318 18.5876 4.66634 19.8337 4.66634C21.0797 4.66634 22.167 5.7318 22.167 7.1293C22.167 7.33968 22.0764 7.70972 21.832 8.23544C21.5989 8.73683 21.2738 9.2797 20.9214 9.80382C20.5368 10.376 20.1392 10.8972 19.8337 11.2802C19.5281 10.8972 19.1305 10.376 18.7459 9.80382C18.3936 9.2797 18.0684 8.73683 17.8353 8.23544C17.5909 7.70972 17.5003 7.33968 17.5003 7.1293Z",fill:"currentColor"})]}),kw=({size:e=20,fill:n="#1877F2"})=>Ye.jsx("svg",{width:e,height:e,viewBox:"0 0 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:Ye.jsx("path",{d:"M23.1875 5.25H10.9375C10.6094 5.25 10.3314 5.36393 10.1035 5.5918C9.87565 5.81966 9.76172 6.09766 9.76172 6.42578C9.76172 6.73568 9.87565 7.00456 10.1035 7.23242C10.3314 7.46029 10.6094 7.57422 10.9375 7.57422H23.1875C23.4974 7.57422 23.7663 7.46029 23.9941 7.23242C24.222 7.00456 24.3359 6.73568 24.3359 6.42578C24.3359 6.09766 24.222 5.81966 23.9941 5.5918C23.7663 5.36393 23.4974 5.25 23.1875 5.25ZM23.1875 12.25H10.9375C10.6094 12.25 10.3314 12.3639 10.1035 12.5918C9.87565 12.8197 9.76172 13.0977 9.76172 13.4258C9.76172 13.7357 9.87565 14.0046 10.1035 14.2324C10.3314 14.4603 10.6094 14.5742 10.9375 14.5742H23.1875C23.4974 14.5742 23.7663 14.4603 23.9941 14.2324C24.222 14.0046 24.3359 13.7357 24.3359 13.4258C24.3359 13.0977 24.222 12.8197 23.9941 12.5918C23.7663 12.3639 23.4974 12.25 23.1875 12.25ZM23.1875 19.25H10.9375C10.6094 19.25 10.3314 19.3639 10.1035 19.5918C9.87565 19.8197 9.76172 20.0977 9.76172 20.4258C9.76172 20.7357 9.87565 21.0046 10.1035 21.2324C10.3314 21.4603 10.6094 21.5742 10.9375 21.5742H23.1875C23.4974 21.5742 23.7663 21.4603 23.9941 21.2324C24.222 21.0046 24.3359 20.7357 24.3359 20.4258C24.3359 20.0977 24.222 19.8197 23.9941 19.5918C23.7663 19.3639 23.4974 19.25 23.1875 19.25ZM5.25 18.6758C5.72396 18.6758 6.13411 18.8444 6.48047 19.1816C6.82682 19.5189 7 19.9336 7 20.4258C7 20.8997 6.82682 21.3099 6.48047 21.6562C6.13411 22.0026 5.72396 22.1758 5.25 22.1758C4.75781 22.1758 4.3431 22.0026 4.00586 21.6562C3.66862 21.3099 3.5 20.8997 3.5 20.4258C3.5 19.9336 3.66862 19.5189 4.00586 19.1816C4.3431 18.8444 4.75781 18.6758 5.25 18.6758ZM5.25 15.1758C4.75781 15.1758 4.3431 15.0026 4.00586 14.6562C3.66862 14.3099 3.5 13.8997 3.5 13.4258C3.5 12.9336 3.66862 12.5189 4.00586 12.1816C4.3431 11.8444 4.75781 11.6758 5.25 11.6758C5.72396 11.6758 6.13411 11.8444 6.48047 12.1816C6.82682 12.5189 7 12.9336 7 13.4258C7 13.8997 6.82682 14.3099 6.48047 14.6562C6.13411 15.0026 5.72396 15.1758 5.25 15.1758ZM5.25 8.17578C4.75781 8.17578 4.3431 8.0026 4.00586 7.65625C3.66862 7.3099 3.5 6.89974 3.5 6.42578C3.5 5.93359 3.66862 5.51888 4.00586 5.18164C4.3431 4.8444 4.75781 4.67578 5.25 4.67578C5.72396 4.67578 6.13411 4.8444 6.48047 5.18164C6.82682 5.51888 7 5.93359 7 6.42578C7 6.89974 6.82682 7.3099 6.48047 7.65625C6.13411 8.0026 5.72396 8.17578 5.25 8.17578Z",fill:"currentColor"})}),Cw=({size:e=32})=>Ye.jsxs("svg",{width:e-1,height:e,viewBox:"0 0 31 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[Ye.jsx("ellipse",{cx:"15.5002",cy:"14.6668",rx:"5.16667",ry:"5.33333",fill:"white"}),Ye.jsx("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M4.77881 13.8369C4.77881 7.71569 9.45773 2.49951 15.5 2.49951C21.5423 2.49951 26.2212 7.71569 26.2212 13.8369C26.2212 15.6318 25.6013 17.3884 24.9844 18.7581C24.3325 20.2055 23.4909 21.6336 22.6828 22.8745C21.0637 25.3608 19.3742 27.4058 19.0124 27.8378L19.0103 27.8403L19.0032 27.8488L19.0013 27.851C18.1452 28.8639 16.8841 29.5005 15.5 29.5005C14.1159 29.5005 12.8548 28.8639 11.9987 27.851L11.9968 27.8487L11.9896 27.8402L11.9876 27.8378C11.6259 27.4058 9.93637 25.3608 8.31723 22.8745C7.50914 21.6336 6.66752 20.2055 6.0156 18.7581C5.39871 17.3884 4.77881 15.6318 4.77881 13.8369ZM15.5 13.4007C14.9114 13.4007 14.4343 13.8933 14.4343 14.5008C14.4343 15.1084 14.9114 15.6009 15.5 15.6009C16.0886 15.6009 16.5657 15.1084 16.5657 14.5008C16.5657 13.8933 16.0886 13.4007 15.5 13.4007ZM11.851 14.5008C11.851 12.4205 13.4847 10.7341 15.5 10.7341C17.5153 10.7341 19.1491 12.4205 19.1491 14.5008C19.1491 16.5811 17.5153 18.2676 15.5 18.2676C13.4847 18.2676 11.851 16.5811 11.851 14.5008Z",fill:"#22C55E"})]});function Aw({des:e}){return Ye.jsxs("div",{className:"relative",children:[Ye.jsx("span",{className:"absolute whitespace-nowrap top-[-50%]",children:e}),Ye.jsx(Cw,{})]})}function u0({children:e,className:n}){return Ye.jsx(mo,{gutter:38,className:"mt-3 first:mt-0 "+n,children:e})}const Iw=[{label:"Hoạt động",value:"Active"},{label:"Khóa",value:"Lock"}],Fw=[{label:"Thêm khách hàng",value:"add"},{label:"Chọn khách hàng",value:"Choose"},{label:"Import khách hàng",value:"Import"}],H0=[{title:"Mã khách hàng",dataIndex:"customer_code",key:"customercode"},{title:"Tên khách hàng",dataIndex:"customer_name",key:"customername"}],e1=[{title:"Địa chỉ",dataIndex:"display_address",key:"display_address"},{title:"Số điện thoại",dataIndex:"phone_number",key:"phone_number"}],Pw=[{customer_id:"431456",customer_name:"Chu Văn A",display_address:"CT1 Chung cư bộ công an",phone_number:"0123456789",frequency:"1;2;3;4;5"},{customer_id:"4314s56",customer_name:"Chu Văn A",display_address:"CT1 Chung cư bộ công an",phone_number:"0123456789",frequency:""}],Mw=[{label:"1",value:"1"},{label:"2",value:"2"},{label:"3",value:"3"},{label:"4",value:"4"},{label:"5",value:"5"}],Dw={customer_type:"Loại khách hàng",customer_group:"Nhóm khách hàng",city:"Tỉnh/Thành phố",district:"Quận/huyện",ward:"Phường/xã"},Lw=[{label:"Không giới hạn ",value:null},{label:"Thứ 2",value:"Thứ 2"},{label:"Thứ 3",value:"Thứ 3"},{label:"Thứ 4",value:"Thứ 4"},{label:"Thứ 5",value:"Thứ 5"},{label:"Thứ 6",value:"Thứ 6"},{label:"Thứ 7",value:"Thứ 7"},{label:"Chủ nhật",value:"Chủ nhật"}];function Rw({form:e}){console.log(e);const[n,a]=ue.useState("");let c=cv(n);const[u,m]=ue.useState([]),[x,o]=ue.useState([]),[E,w]=ue.useState();return ue.useState(),ue.useEffect(()=>{(async()=>{let C=await Tn.get("/api/method/mbw_dms.api.router.get_team_sale");m(C.result.map(P=>({label:P,value:P})))})()},[]),ue.useEffect(()=>{(async()=>{let C=await Tn.get("/api/method/mbw_dms.api.router.get_sale_person",{params:{team_sale:E,key_search:c}}),{message:P}=C;o(P.map(M=>({value:M.employee_code,label:M.employee_name||M.employee_code})))})()},[E,c]),Ye.jsxs("div",{className:"p-4 pt-[43px] pb-[58px]",children:[Ye.jsxs(u0,{children:[Ye.jsx(Ti,{span:12,children:Ye.jsx(Ri,{label:"Mã tuyến",name:"channel_code",required:!0,children:Ye.jsx(Ih,{})})}),Ye.jsx(Ti,{span:12,children:Ye.jsx(Ri,{label:"Tên tuyến",name:"channel_name",required:!0,children:Ye.jsx(Ih,{})})})]}),Ye.jsxs(u0,{children:[Ye.jsx(Ti,{span:12,children:Ye.jsx(Ri,{label:"Team sale",name:"team_sale",required:!0,children:Ye.jsx(zn,{showSearch:!0,options:u,defaultActiveFirstOption:!1,onChange:C=>{w(C),e.setFieldsValue({employee:void 0})}})})}),Ye.jsx(Ti,{span:12,children:Ye.jsx(Ri,{label:"Nhân viên",name:"employee",required:!0,children:Ye.jsx(zn,{showSearch:!0,onSearch:a,options:x,allowClear:!0})})})]}),Ye.jsxs(u0,{children:[Ye.jsx(Ti,{span:12,children:Ye.jsx(Ri,{label:"Ngày đi tuyến",name:"travel_date",required:!0,children:Ye.jsx(zn,{options:Lw})})}),Ye.jsx(Ti,{span:12,children:Ye.jsx(Ri,{label:"Trạng thái",name:"status",children:Ye.jsx(zn,{options:Iw,defaultValue:"Active"})})})]})]})}function Ow({data:e,handleData:n}){const a=[{title:"Stt",dataIndex:"stt",key:"stt",render:(c,u,m)=>m+1},...H0,...e1,{title:"Tần suất",dataIndex:"frequency",key:"frequency",render:(c,u)=>Ye.jsx(zn,{mode:"multiple",options:Mw,style:{width:"100%"},placeholder:"Chọn tần suất",onChange:m=>{n(x=>x.map(o=>(o.customer_id==u.customer_id&&(o.frequency=m.toString().replaceAll(",",";")),o)))},defaultValue:c?c.split(";"):[]})},{title:"Hành động",dataIndex:"",key:"action",render:(c,u)=>Ye.jsx("div",{className:"flex justify-center",onClick:()=>{n(m=>[...m.filter(x=>x.customer_code!=u.customer_code)])},children:Ye.jsx(Kg,{})})}];return Ye.jsx("div",{className:"p-4",children:Ye.jsx($0,{columns:a,dataSource:e,pagination:!1})})}const Bw=ue.createContext(null);function zw(e,n){const a=Array.isArray(e)?e[0]:e?e.x:0,c=Array.isArray(e)?e[1]:e?e.y:0,u=Array.isArray(n)?n[0]:n?n.x:0,m=Array.isArray(n)?n[1]:n?n.y:0;return a===u&&c===m}function $i(e,n){if(e===n)return!0;if(!e||!n)return!1;if(Array.isArray(e)){if(!Array.isArray(n)||e.length!==n.length)return!1;for(let a=0;a<e.length;a++)if(!$i(e[a],n[a]))return!1;return!0}else if(Array.isArray(n))return!1;if(typeof e=="object"&&typeof n=="object"){const a=Object.keys(e),c=Object.keys(n);if(a.length!==c.length)return!1;for(const u of a)if(!n.hasOwnProperty(u)||!$i(e[u],n[u]))return!1;return!0}return!1}function Nw(e){const n=e.clone();return n.pixelsToGLUnits=e.pixelsToGLUnits,n}function xm(e,n){if(!e.getProjection)return;const a=e.getProjection(),c=n.getProjection();$i(a,c)||n.setProjection(a)}function _m(e){return{longitude:e.center.lng,latitude:e.center.lat,zoom:e.zoom,pitch:e.pitch,bearing:e.bearing,padding:e.padding}}function ym(e,n){const a=n.viewState||n;let c=!1;if("longitude"in a&&"latitude"in a){const u=e.center;e.center=new u.constructor(a.longitude,a.latitude),c=c||u!==e.center}if("zoom"in a){const u=e.zoom;e.zoom=a.zoom,c=c||u!==e.zoom}if("bearing"in a){const u=e.bearing;e.bearing=a.bearing,c=c||u!==e.bearing}if("pitch"in a){const u=e.pitch;e.pitch=a.pitch,c=c||u!==e.pitch}return a.padding&&!e.isPaddingEqual(a.padding)&&(c=!0,e.padding=a.padding),c}const Uw=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function vm(e){if(!e)return null;if(typeof e=="string"||("toJS"in e&&(e=e.toJS()),!e.layers))return e;const n={};for(const c of e.layers)n[c.id]=c;const a=e.layers.map(c=>{let u=null;"interactive"in c&&(u=Object.assign({},c),delete u.interactive);const m=n[c.ref];if(m){u=u||Object.assign({},c),delete u.ref;for(const x of Uw)x in m&&(u[x]=m[x])}return u||c});return{...e,layers:a}}var wm={};const bm={version:8,sources:{},layers:[]},Tm={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},h0={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},Em={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},Vw=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],$w=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class _l{constructor(n,a,c){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=u=>{const m=this.props[Em[u.type]];m?m(u):u.type==="error"&&console.error(u.error)},this._onPointerEvent=u=>{(u.type==="mousemove"||u.type==="mouseout")&&this._updateHover(u);const m=this.props[Tm[u.type]];m&&(this.props.interactiveLayerIds&&u.type!=="mouseover"&&u.type!=="mouseout"&&(u.features=this._hoveredFeatures||this._queryRenderedFeatures(u.point)),m(u),delete u.features)},this._onCameraEvent=u=>{if(!this._internalUpdate){const m=this.props[h0[u.type]];m&&m(u)}u.type in this._deferredEvents&&(this._deferredEvents[u.type]=!1)},this._MapClass=n,this.props=a,this._initialize(c)}get map(){return this._map}get transform(){return this._renderTransform}setProps(n){const a=this.props;this.props=n;const c=this._updateSettings(n,a);c&&this._createShadowTransform(this._map);const u=this._updateSize(n),m=this._updateViewState(n,!0);this._updateStyle(n,a),this._updateStyleComponents(n,a),this._updateHandlers(n,a),(c||u||m&&!this._map.isMoving())&&this.redraw()}static reuse(n,a){const c=_l.savedMaps.pop();if(!c)return null;const u=c.map,m=u.getContainer();for(a.className=m.className;m.childNodes.length>0;)a.appendChild(m.childNodes[0]);u._container=a;const x=u._resizeObserver;x&&(x.disconnect(),x.observe(a)),c.setProps({...n,styleDiffing:!1}),u.resize();const{initialViewState:o}=n;return o&&(o.bounds?u.fitBounds(o.bounds,{...o.fitBoundsOptions,duration:0}):c._updateViewState(o,!1)),u.isStyleLoaded()?u.fire("load"):u.once("styledata",()=>u.fire("load")),u._update(),c}_initialize(n){const{props:a}=this,{mapStyle:c=bm}=a,u={...a,...a.initialViewState,accessToken:a.mapboxAccessToken||jw()||null,container:n,style:vm(c)},m=u.initialViewState||u.viewState||u;if(Object.assign(u,{center:[m.longitude||0,m.latitude||0],zoom:m.zoom||0,pitch:m.pitch||0,bearing:m.bearing||0}),a.gl){const C=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=C,a.gl)}const x=new this._MapClass(u);m.padding&&x.setPadding(m.padding),a.cursor&&(x.getCanvas().style.cursor=a.cursor),this._createShadowTransform(x);const o=x._render;x._render=C=>{this._inRender=!0,o.call(x,C),this._inRender=!1};const E=x._renderTaskQueue.run;x._renderTaskQueue.run=C=>{E.call(x._renderTaskQueue,C),this._onBeforeRepaint()},x.on("render",()=>this._onAfterRepaint());const w=x.fire;x.fire=this._fireEvent.bind(this,w),x.on("resize",()=>{this._renderTransform.resize(x.transform.width,x.transform.height)}),x.on("styledata",()=>{this._updateStyleComponents(this.props,{}),xm(x.transform,this._renderTransform)}),x.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const C in Tm)x.on(C,this._onPointerEvent);for(const C in h0)x.on(C,this._onCameraEvent);for(const C in Em)x.on(C,this._onEvent);this._map=x}recycle(){const a=this.map.getContainer().querySelector("[mapboxgl-children]");a?.remove(),_l.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const n=this._map;!this._inRender&&n.style&&(n._frame&&(n._frame.cancel(),n._frame=null),n._render())}_createShadowTransform(n){const a=Nw(n.transform);n.painter.transform=a,this._renderTransform=a}_updateSize(n){const{viewState:a}=n;if(a){const c=this._map;if(a.width!==c.transform.width||a.height!==c.transform.height)return c.resize(),!0}return!1}_updateViewState(n,a){if(this._internalUpdate)return!1;const c=this._map,u=this._renderTransform,{zoom:m,pitch:x,bearing:o}=u,E=c.isMoving();E&&(u.cameraElevationReference="sea");const w=ym(u,{..._m(c.transform),...n});if(E&&(u.cameraElevationReference="ground"),w&&a){const C=this._deferredEvents;C.move=!0,C.zoom||(C.zoom=m!==u.zoom),C.rotate||(C.rotate=o!==u.bearing),C.pitch||(C.pitch=x!==u.pitch)}return E||ym(c.transform,n),w}_updateSettings(n,a){const c=this._map;let u=!1;for(const m of Vw)if(m in n&&!$i(n[m],a[m])){u=!0;const x=c[`set${m[0].toUpperCase()}${m.slice(1)}`];x?.call(c,n[m])}return u}_updateStyle(n,a){if(n.cursor!==a.cursor&&(this._map.getCanvas().style.cursor=n.cursor||""),n.mapStyle!==a.mapStyle){const{mapStyle:c=bm,styleDiffing:u=!0}=n,m={diff:u};return"localIdeographFontFamily"in n&&(m.localIdeographFontFamily=n.localIdeographFontFamily),this._map.setStyle(vm(c),m),!0}return!1}_updateStyleComponents(n,a){const c=this._map;let u=!1;return c.isStyleLoaded()&&("light"in n&&c.setLight&&!$i(n.light,a.light)&&(u=!0,c.setLight(n.light)),"fog"in n&&c.setFog&&!$i(n.fog,a.fog)&&(u=!0,c.setFog(n.fog)),"terrain"in n&&c.setTerrain&&!$i(n.terrain,a.terrain)&&(!n.terrain||c.getSource(n.terrain.source))&&(u=!0,c.setTerrain(n.terrain))),u}_updateHandlers(n,a){var c,u;const m=this._map;let x=!1;for(const o of $w){const E=(c=n[o])!==null&&c!==void 0?c:!0,w=(u=a[o])!==null&&u!==void 0?u:!0;$i(E,w)||(x=!0,E?m[o].enable(E):m[o].disable())}return x}_queryRenderedFeatures(n){const a=this._map,c=a.transform,{interactiveLayerIds:u=[]}=this.props;try{return a.transform=this._renderTransform,a.queryRenderedFeatures(n,{layers:u.filter(a.getLayer.bind(a))})}catch{return[]}finally{a.transform=c}}_updateHover(n){var a;const{props:c}=this;if(c.interactiveLayerIds&&(c.onMouseMove||c.onMouseEnter||c.onMouseLeave)){const m=n.type,x=((a=this._hoveredFeatures)===null||a===void 0?void 0:a.length)>0,o=this._queryRenderedFeatures(n.point),E=o.length>0;!E&&x&&(n.type="mouseleave",this._onPointerEvent(n)),this._hoveredFeatures=o,E&&!x&&(n.type="mouseenter",this._onPointerEvent(n)),n.type=m}else this._hoveredFeatures=null}_fireEvent(n,a,c){const u=this._map,m=u.transform,x=typeof a=="string"?a:a.type;return x==="move"&&this._updateViewState(this.props,!1),x in h0&&(typeof a=="object"&&(a.viewState=_m(m)),this._map.isMoving())?(u.transform=this._renderTransform,n.call(u,a,c),u.transform=m,u):(n.call(u,a,c),u)}_onBeforeRepaint(){const n=this._map;this._internalUpdate=!0;for(const c in this._deferredEvents)this._deferredEvents[c]&&n.fire(c);this._internalUpdate=!1;const a=this._map.transform;n.transform=this._renderTransform,this._onAfterRepaint=()=>{xm(this._renderTransform,a),n.transform=a}}}_l.savedMaps=[];function jw(){let e=null;if(typeof location<"u"){const n=/access_token=([^&\/]*)/.exec(location.search);e=n&&n[1]}try{e=e||wm.MapboxAccessToken}catch{}try{e=e||wm.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return e}const Gw=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function Hw(e){if(!e)return null;const n=e.map,a={getMap:()=>n,getCenter:()=>e.transform.center,getZoom:()=>e.transform.zoom,getBearing:()=>e.transform.bearing,getPitch:()=>e.transform.pitch,getPadding:()=>e.transform.padding,getBounds:()=>e.transform.getBounds(),project:c=>{const u=n.transform;n.transform=e.transform;const m=n.project(c);return n.transform=u,m},unproject:c=>{const u=n.transform;n.transform=e.transform;const m=n.unproject(c);return n.transform=u,m},queryTerrainElevation:(c,u)=>{const m=n.transform;n.transform=e.transform;const x=n.queryTerrainElevation(c,u);return n.transform=m,x},queryRenderedFeatures:(c,u)=>{const m=n.transform;n.transform=e.transform;const x=n.queryRenderedFeatures(c,u);return n.transform=m,x}};for(const c of qw(n))!(c in a)&&!Gw.includes(c)&&(a[c]=n[c].bind(n));return a}function qw(e){const n=new Set;let a=e;for(;a;){for(const c of Object.getOwnPropertyNames(a))c[0]!=="_"&&typeof e[c]=="function"&&c!=="fire"&&c!=="setEventedParent"&&n.add(c);a=Object.getPrototypeOf(a)}return Array.from(n)}const Ww=typeof document<"u"?ue.useLayoutEffect:ue.useEffect,Zw=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function Xw(e,n){for(const c of Zw)c in n&&(e[c]=n[c]);const{RTLTextPlugin:a="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=n;a&&e.getRTLTextPluginStatus&&e.getRTLTextPluginStatus()==="unavailable"&&e.setRTLTextPlugin(a,c=>{c&&console.error(c)},!0)}const Tl=ue.createContext(null);function Kw(e,n,a){const c=ue.useContext(Bw),[u,m]=ue.useState(null),x=ue.useRef(),{current:o}=ue.useRef({mapLib:null,map:null});ue.useEffect(()=>{const C=e.mapLib;let P=!0,M;return Promise.resolve(C||a).then(O=>{if(!P)return;if(!O)throw new Error("Invalid mapLib");const U="Map"in O?O:O.default;if(!U.Map)throw new Error("Invalid mapLib");if(Xw(U,e),!U.supported||U.supported(e))e.reuseMaps&&(M=_l.reuse(e,x.current)),M||(M=new _l(U.Map,e,x.current)),o.map=Hw(M),o.mapLib=U,m(M),c?.onMapMount(o.map,e.id);else throw new Error("Map is not supported by this browser")}).catch(O=>{const{onError:U}=e;U?U({type:"error",target:null,originalEvent:null,error:O}):console.error(O)}),()=>{P=!1,M&&(c?.onMapUnmount(e.id),e.reuseMaps?M.recycle():M.destroy())}},[]),Ww(()=>{u&&u.setProps(e)}),ue.useImperativeHandle(n,()=>o.map,[u]);const E=ue.useMemo(()=>({position:"relative",width:"100%",height:"100%",...e.style}),[e.style]),w={height:"100%"};return ue.createElement("div",{id:e.id,ref:x,style:E},u&&ue.createElement(Tl.Provider,{value:o},ue.createElement("div",{"mapboxgl-children":"",style:w},e.children)))}const Yw=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function wo(e,n){if(!e||!n)return;const a=e.style;for(const c in n){const u=n[c];Number.isFinite(u)&&!Yw.test(c)?a[c]=`${u}px`:a[c]=u}}function Jw(e,n){const{map:a,mapLib:c}=ue.useContext(Tl),u=ue.useRef({props:e});u.current.props=e;const m=ue.useMemo(()=>{let z=!1;ue.Children.forEach(e.children,le=>{le&&(z=!0)});const j={...e,element:z?document.createElement("div"):null},ee=new c.Marker(j);return ee.setLngLat([e.longitude,e.latitude]),ee.getElement().addEventListener("click",le=>{var Z,fe;(fe=(Z=u.current.props).onClick)===null||fe===void 0||fe.call(Z,{type:"click",target:ee,originalEvent:le})}),ee.on("dragstart",le=>{var Z,fe;const me=le;me.lngLat=m.getLngLat(),(fe=(Z=u.current.props).onDragStart)===null||fe===void 0||fe.call(Z,me)}),ee.on("drag",le=>{var Z,fe;const me=le;me.lngLat=m.getLngLat(),(fe=(Z=u.current.props).onDrag)===null||fe===void 0||fe.call(Z,me)}),ee.on("dragend",le=>{var Z,fe;const me=le;me.lngLat=m.getLngLat(),(fe=(Z=u.current.props).onDragEnd)===null||fe===void 0||fe.call(Z,me)}),ee},[]);ue.useEffect(()=>(m.addTo(a.getMap()),()=>{m.remove()}),[]);const{longitude:x,latitude:o,offset:E,style:w,draggable:C=!1,popup:P=null,rotation:M=0,rotationAlignment:O="auto",pitchAlignment:U="auto"}=e;return ue.useEffect(()=>{wo(m.getElement(),w)},[w]),ue.useImperativeHandle(n,()=>m,[]),(m.getLngLat().lng!==x||m.getLngLat().lat!==o)&&m.setLngLat([x,o]),E&&!zw(m.getOffset(),E)&&m.setOffset(E),m.isDraggable()!==C&&m.setDraggable(C),m.getRotation()!==M&&m.setRotation(M),m.getRotationAlignment()!==O&&m.setRotationAlignment(O),m.getPitchAlignment()!==U&&m.setPitchAlignment(U),m.getPopup()!==P&&m.setPopup(P),Wc.createPortal(e.children,m.getElement())}const Qw=ue.memo(ue.forwardRef(Jw));function Sm(e){return new Set(e?e.trim().split(/\s+/):[])}function eb(e,n){const{map:a,mapLib:c}=ue.useContext(Tl),u=ue.useMemo(()=>document.createElement("div"),[]),m=ue.useRef({props:e});m.current.props=e;const x=ue.useMemo(()=>{const o={...e},E=new c.Popup(o);return E.setLngLat([e.longitude,e.latitude]),E.once("open",w=>{var C,P;(P=(C=m.current.props).onOpen)===null||P===void 0||P.call(C,w)}),E},[]);if(ue.useEffect(()=>{const o=E=>{var w,C;(C=(w=m.current.props).onClose)===null||C===void 0||C.call(w,E)};return x.on("close",o),x.setDOMContent(u).addTo(a.getMap()),()=>{x.off("close",o),x.isOpen()&&x.remove()}},[]),ue.useEffect(()=>{wo(x.getElement(),e.style)},[e.style]),ue.useImperativeHandle(n,()=>x,[]),x.isOpen()&&((x.getLngLat().lng!==e.longitude||x.getLngLat().lat!==e.latitude)&&x.setLngLat([e.longitude,e.latitude]),e.offset&&!$i(x.options.offset,e.offset)&&x.setOffset(e.offset),(x.options.anchor!==e.anchor||x.options.maxWidth!==e.maxWidth)&&(x.options.anchor=e.anchor,x.setMaxWidth(e.maxWidth)),x.options.className!==e.className)){const o=Sm(x.options.className),E=Sm(e.className);for(const w of o)E.has(w)||x.removeClassName(w);for(const w of E)o.has(w)||x.addClassName(w);x.options.className=e.className}return Wc.createPortal(e.children,u)}ue.memo(ue.forwardRef(eb));function nu(e,n,a,c){const u=ue.useContext(Tl),m=ue.useMemo(()=>e(u),[]);return ue.useEffect(()=>{const x=c||a||n,o=typeof n=="function"&&typeof a=="function"?n:null,E=typeof a=="function"?a:typeof n=="function"?n:null,{map:w}=u;return w.hasControl(m)||(w.addControl(m,x?.position),o&&o(u)),()=>{E&&E(u),w.hasControl(m)&&w.removeControl(m)}},[]),m}function tb(e){const n=nu(({mapLib:a})=>new a.AttributionControl(e),{position:e.position});return ue.useEffect(()=>{wo(n._container,e.style)},[e.style]),null}ue.memo(tb);function rb(e){const n=nu(({mapLib:a})=>new a.FullscreenControl({container:e.containerId&&document.getElementById(e.containerId)}),{position:e.position});return ue.useEffect(()=>{wo(n._controlContainer,e.style)},[e.style]),null}ue.memo(rb);function ab(e,n){const a=ue.useRef({props:e}),c=nu(({mapLib:u})=>{const m=new u.GeolocateControl(e),x=m._setupUI;return m._setupUI=o=>{m._container.hasChildNodes()||x(o)},m.on("geolocate",o=>{var E,w;(w=(E=a.current.props).onGeolocate)===null||w===void 0||w.call(E,o)}),m.on("error",o=>{var E,w;(w=(E=a.current.props).onError)===null||w===void 0||w.call(E,o)}),m.on("outofmaxbounds",o=>{var E,w;(w=(E=a.current.props).onOutOfMaxBounds)===null||w===void 0||w.call(E,o)}),m.on("trackuserlocationstart",o=>{var E,w;(w=(E=a.current.props).onTrackUserLocationStart)===null||w===void 0||w.call(E,o)}),m.on("trackuserlocationend",o=>{var E,w;(w=(E=a.current.props).onTrackUserLocationEnd)===null||w===void 0||w.call(E,o)}),m},{position:e.position});return a.current.props=e,ue.useImperativeHandle(n,()=>c,[]),ue.useEffect(()=>{wo(c._container,e.style)},[e.style]),null}ue.memo(ue.forwardRef(ab));function ib(e){const n=nu(({mapLib:a})=>new a.NavigationControl(e),{position:e.position});return ue.useEffect(()=>{wo(n._container,e.style)},[e.style]),null}ue.memo(ib);function nb(e){const n=nu(({mapLib:m})=>new m.ScaleControl(e),{position:e.position}),a=ue.useRef(e),c=a.current;a.current=e;const{style:u}=e;return e.maxWidth!==void 0&&e.maxWidth!==c.maxWidth&&(n.options.maxWidth=e.maxWidth),e.unit!==void 0&&e.unit!==c.unit&&n.setUnit(e.unit),ue.useEffect(()=>{wo(n._container,u)},[u]),null}ue.memo(nb);function Dh(e,n){if(!e)throw new Error(n)}function sb(e,n,a,c){if(Dh(a.id===c.id,"layer id changed"),Dh(a.type===c.type,"layer type changed"),a.type==="custom"||c.type==="custom")return;const{layout:u={},paint:m={},filter:x,minzoom:o,maxzoom:E,beforeId:w}=a;if(w!==c.beforeId&&e.moveLayer(n,w),u!==c.layout){const C=c.layout||{};for(const P in u)$i(u[P],C[P])||e.setLayoutProperty(n,P,u[P]);for(const P in C)u.hasOwnProperty(P)||e.setLayoutProperty(n,P,void 0)}if(m!==c.paint){const C=c.paint||{};for(const P in m)$i(m[P],C[P])||e.setPaintProperty(n,P,m[P]);for(const P in C)m.hasOwnProperty(P)||e.setPaintProperty(n,P,void 0)}$i(x,c.filter)||e.setFilter(n,x),(o!==c.minzoom||E!==c.maxzoom)&&e.setLayerZoomRange(n,o,E)}function ob(e,n,a){if(e.style&&e.style._loaded&&(!("source"in a)||e.getSource(a.source))){const c={...a,id:n};delete c.beforeId,e.addLayer(c,a.beforeId)}}let lb=0;function cb(e){const n=ue.useContext(Tl).map.getMap(),a=ue.useRef(e),[,c]=ue.useState(0),u=ue.useMemo(()=>e.id||`jsx-layer-${lb++}`,[]);if(ue.useEffect(()=>{if(n){const x=()=>c(o=>o+1);return n.on("styledata",x),x(),()=>{n.off("styledata",x),n.style&&n.style._loaded&&n.getLayer(u)&&n.removeLayer(u)}}},[n]),n&&n.style&&n.getLayer(u))try{sb(n,u,e,a.current)}catch(x){console.warn(x)}else ob(n,u,e);return a.current=e,null}let ub=0;function hb(e,n,a){if(e.style&&e.style._loaded){const c={...a};return delete c.id,delete c.children,e.addSource(n,c),e.getSource(n)}return null}function fb(e,n,a){Dh(n.id===a.id,"source id changed"),Dh(n.type===a.type,"source type changed");let c="",u=0;for(const x in n)x!=="children"&&x!=="id"&&!$i(a[x],n[x])&&(c=x,u++);if(!u)return;const m=n.type;if(m==="geojson")e.setData(n.data);else if(m==="image")e.updateImage({url:n.url,coordinates:n.coordinates});else if("setCoordinates"in e&&u===1&&c==="coordinates")e.setCoordinates(n.coordinates);else if("setUrl"in e)switch(c){case"url":e.setUrl(n.url);break;case"tiles":e.setTiles(n.tiles);break}else console.warn(`Unable to update <Source> prop: ${c}`)}function db(e){const n=ue.useContext(Tl).map.getMap(),a=ue.useRef(e),[,c]=ue.useState(0),u=ue.useMemo(()=>e.id||`jsx-source-${ub++}`,[]);ue.useEffect(()=>{if(n){const x=()=>setTimeout(()=>c(o=>o+1),0);return n.on("styledata",x),x(),()=>{var o;if(n.off("styledata",x),n.style&&n.style._loaded&&n.getSource(u)){const E=(o=n.getStyle())===null||o===void 0?void 0:o.layers;if(E)for(const w of E)w.source===u&&n.removeLayer(w.id);n.removeSource(u)}}}},[n]);let m=n&&n.style&&n.getSource(u);return m?fb(m,e,a.current):m=hb(n,u,e),a.current=e,m&&ue.Children.map(e.children,x=>x&&ue.cloneElement(x,{source:u}))||null}const pb=Qy(()=>import("./mapbox-gl-lA8sAnvA.js").then(e=>e.m),__vite__mapDeps([0,1,2])),mb=ue.forwardRef(function(n,a){return Kw(n,a,pb)}),gb=Qw,xb=cb,_b=db;var t1={exports:{}};(function(e,n){(function(a,c){e.exports=c()})(ev,function(){var a,c,u;function m(o,E){if(!a)a=E;else if(!c)c=E;else{var w="var sharedChunk = {}; ("+a+")(sharedChunk); ("+c+")(sharedChunk);",C={};a(C),u=E(C),typeof window<"u"&&(u.workerUrl=window.URL.createObjectURL(new Blob([w],{type:"text/javascript"})))}}m(["exports"],function(o){function E(i,t,s,h){return new(s||(s=Promise))(function(d,_){function v(I){try{k(h.next(I))}catch(D){_(D)}}function b(I){try{k(h.throw(I))}catch(D){_(D)}}function k(I){var D;I.done?d(I.value):(D=I.value,D instanceof s?D:new s(function(B){B(D)})).then(v,b)}k((h=h.apply(i,t||[])).next())})}function w(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}typeof SuppressedError=="function"&&SuppressedError;var C=P;function P(i,t){this.x=i,this.y=t}P.prototype={clone:function(){return new P(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,t){return this.clone()._rotateAround(i,t)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var t=i.x-this.x,s=i.y-this.y;return t*t+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,t){return Math.atan2(this.x*t-this.y*i,this.x*i+this.y*t)},_matMult:function(i){var t=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=t,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var t=Math.cos(i),s=Math.sin(i),h=s*this.x+t*this.y;return this.x=t*this.x-s*this.y,this.y=h,this},_rotateAround:function(i,t){var s=Math.cos(i),h=Math.sin(i),d=t.y+h*(this.x-t.x)+s*(this.y-t.y);return this.x=t.x+s*(this.x-t.x)-h*(this.y-t.y),this.y=d,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},P.convert=function(i){return i instanceof P?i:Array.isArray(i)?new P(i[0],i[1]):i};var M=w(C),O=U;function U(i,t,s,h){this.cx=3*i,this.bx=3*(s-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(h-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=s,this.p2y=h}U.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var s=i,h=0;h<8;h++){var d=this.sampleCurveX(s)-i;if(Math.abs(d)<t)return s;var _=this.sampleCurveDerivativeX(s);if(Math.abs(_)<1e-6)break;s-=d/_}var v=0,b=1;for(s=i,h=0;h<20&&(d=this.sampleCurveX(s),!(Math.abs(d-i)<t));h++)i>d?v=s:b=s,s=.5*(b-v)+v;return s},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};var z=w(O);let j,ee;function le(){return j==null&&(j=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),j}function Z(){if(ee==null&&(ee=!1,le())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let h=0;h<5*5;h++){const d=4*h;t.fillStyle=`rgb(${d},${d+1},${d+2})`,t.fillRect(h%5,Math.floor(h/5),1,1)}const s=t.getImageData(0,0,5,5).data;for(let h=0;h<5*5*4;h++)if(h%4!=3&&s[h]!==h){ee=!0;break}}}return ee||!1}function fe(i,t,s,h){const d=new z(i,t,s,h);return function(_){return d.solve(_)}}const me=fe(.25,.1,.25,1);function Te(i,t,s){return Math.min(s,Math.max(t,i))}function re(i,t,s){const h=s-t,d=((i-t)%h+h)%h+t;return d===t?s:d}function Ce(i,...t){for(const s of t)for(const h in s)i[h]=s[h];return i}let be=1;function Fe(i,t,s){const h={};for(const d in i)h[d]=t.call(s||this,i[d],d,i);return h}function Oe(i,t,s){const h={};for(const d in i)t.call(s||this,i[d],d,i)&&(h[d]=i[d]);return h}function Me(i){return Array.isArray(i)?i.map(Me):typeof i=="object"&&i?Fe(i,Me):i}const rt={};function ft(i){rt[i]||(typeof console<"u"&&console.warn(i),rt[i]=!0)}function lt(i,t,s){return(s.y-i.y)*(t.x-i.x)>(t.y-i.y)*(s.x-i.x)}function _t(i){let t=0;for(let s,h,d=0,_=i.length,v=_-1;d<_;v=d++)s=i[d],h=i[v],t+=(h.x-s.x)*(s.y+h.y);return t}function nt(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let Kt=null;function He(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const Nt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Mt(i,t,s,h,d){return E(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const _=new VideoFrame(i,{timestamp:0});try{const v=_?.format;if(!v||!v.startsWith("BGR")&&!v.startsWith("RGB"))throw new Error(`Unrecognized format ${v}`);const b=v.startsWith("BGR"),k=new Uint8ClampedArray(h*d*4);if(yield _.copyTo(k,function(I,D,B,G,W){const X=4*Math.max(-D,0),ne=(Math.max(0,B)-B)*G*4+X,ge=4*G,we=Math.max(0,D),Re=Math.max(0,B);return{rect:{x:we,y:Re,width:Math.min(I.width,D+G)-we,height:Math.min(I.height,B+W)-Re},layout:[{offset:ne,stride:ge}]}}(i,t,s,h,d)),b)for(let I=0;I<k.length;I+=4){const D=k[I];k[I]=k[I+2],k[I+2]=D}return k}finally{_.close()}})}let pe,Ee,Se,Ie;const Ke={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(i){const t=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(i,t=0){return this.getImageCanvasContext(i).getImageData(-t,-t,i.width+2*t,i.height+2*t)},getImageCanvasContext(i){const t=window.document.createElement("canvas"),s=t.getContext("2d",{willReadFrequently:!0});if(!s)throw new Error("failed to create canvas 2d context");return t.width=i.width,t.height=i.height,s.drawImage(i,0,0,i.width,i.height),s},resolveURL:i=>(Se||(Se=document.createElement("a")),Se.href=i,Se.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Ie==null&&(Ie=matchMedia("(prefers-reduced-motion: reduce)")),Ie.matches)}},dt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class vt extends Error{constructor(t,s,h,d){super(`AJAXError: ${s} (${t}): ${h}`),this.status=t,this.statusText=s,this.url=h,this.body=d}}const ut=nt()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,Qe=i=>dt.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))];function qt(i,t){const s=new AbortController,h=new Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,cache:i.cache,referrer:ut(),signal:s.signal});let d=!1,_=!1;return i.type==="json"&&h.headers.set("Accept","application/json"),_||fetch(h).then(v=>v.ok?(b=>{(i.type==="arrayBuffer"||i.type==="image"?b.arrayBuffer():i.type==="json"?b.json():b.text()).then(k=>{_||(d=!0,t(null,k,b.headers.get("Cache-Control"),b.headers.get("Expires")))}).catch(k=>{_||t(new Error(k.message))})})(v):v.blob().then(b=>t(new vt(v.status,v.statusText,i.url,b)))).catch(v=>{v.code!==20&&t(new Error(v.message))}),{cancel:()=>{_=!0,d||s.abort()}}}const _e=function(i,t){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){if(nt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,t);if(!nt())return(Qe(i.url)||qt)(i,t)}if(!(/^file:/.test(s=i.url)||/^file:/.test(ut())&&!/^\w+:/.test(s))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return qt(i,t);if(nt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,t,void 0,!0)}var s;return function(h,d){const _=new XMLHttpRequest;_.open(h.method||"GET",h.url,!0),h.type!=="arrayBuffer"&&h.type!=="image"||(_.responseType="arraybuffer");for(const v in h.headers)_.setRequestHeader(v,h.headers[v]);return h.type==="json"&&(_.responseType="text",_.setRequestHeader("Accept","application/json")),_.withCredentials=h.credentials==="include",_.onerror=()=>{d(new Error(_.statusText))},_.onload=()=>{if((_.status>=200&&_.status<300||_.status===0)&&_.response!==null){let v=_.response;if(h.type==="json")try{v=JSON.parse(_.response)}catch(b){return d(b)}d(null,v,_.getResponseHeader("Cache-Control"),_.getResponseHeader("Expires"))}else{const v=new Blob([_.response],{type:_.getResponseHeader("Content-Type")});d(new vt(_.status,_.statusText,h.url,v))}},_.send(h.body),{cancel:()=>_.abort()}}(i,t)},Yt=function(i,t){return _e(Ce(i,{type:"arrayBuffer"}),t)};function Wt(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const t=new URL(i),s=window.location;return t.protocol===s.protocol&&t.host===s.host}function nr(i,t,s){s[i]&&s[i].indexOf(t)!==-1||(s[i]=s[i]||[],s[i].push(t))}function Zt(i,t,s){if(s&&s[i]){const h=s[i].indexOf(t);h!==-1&&s[i].splice(h,1)}}class wt{constructor(t,s={}){Ce(this,s),this.type=t}}class gr extends wt{constructor(t,s={}){super("error",Ce({error:t},s))}}class Mr{on(t,s){return this._listeners=this._listeners||{},nr(t,s,this._listeners),this}off(t,s){return Zt(t,s,this._listeners),Zt(t,s,this._oneTimeListeners),this}once(t,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},nr(t,s,this._oneTimeListeners),this):new Promise(h=>this.once(t,h))}fire(t,s){typeof t=="string"&&(t=new wt(t,s||{}));const h=t.type;if(this.listens(h)){t.target=this;const d=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const b of d)b.call(this,t);const _=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const b of _)Zt(h,b,this._oneTimeListeners),b.call(this,t);const v=this._eventedParent;v&&(Ce(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),v.fire(t))}else t instanceof gr&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,s){return this._eventedParent=t,this._eventedParentData=s,this}}var Xe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Sr=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Vr(i,t){const s={};for(const h in i)h!=="ref"&&(s[h]=i[h]);return Sr.forEach(h=>{h in t&&(s[h]=t[h])}),s}function lr(i,t){if(Array.isArray(i)){if(!Array.isArray(t)||i.length!==t.length)return!1;for(let s=0;s<i.length;s++)if(!lr(i[s],t[s]))return!1;return!0}if(typeof i=="object"&&i!==null&&t!==null){if(typeof t!="object"||Object.keys(i).length!==Object.keys(t).length)return!1;for(const s in i)if(!lr(i[s],t[s]))return!1;return!0}return i===t}const Xt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Fr(i,t,s){s.push({command:Xt.addSource,args:[i,t[i]]})}function Or(i,t,s){t.push({command:Xt.removeSource,args:[i]}),s[i]=!0}function ia(i,t,s,h){Or(i,s,h),Fr(i,t,s)}function $r(i,t,s){let h;for(h in i[s])if(Object.prototype.hasOwnProperty.call(i[s],h)&&h!=="data"&&!lr(i[s][h],t[s][h]))return!1;for(h in t[s])if(Object.prototype.hasOwnProperty.call(t[s],h)&&h!=="data"&&!lr(i[s][h],t[s][h]))return!1;return!0}function pa(i,t,s,h,d,_){let v;for(v in t=t||{},i=i||{})Object.prototype.hasOwnProperty.call(i,v)&&(lr(i[v],t[v])||s.push({command:_,args:[h,v,t[v],d]}));for(v in t)Object.prototype.hasOwnProperty.call(t,v)&&!Object.prototype.hasOwnProperty.call(i,v)&&(lr(i[v],t[v])||s.push({command:_,args:[h,v,t[v],d]}))}function Qt(i){return i.id}function kr(i,t){return i[t.id]=t,i}class ct{constructor(t,s,h,d){this.message=(t?`${t}: `:"")+h,d&&(this.identifier=d),s!=null&&s.__line__&&(this.line=s.__line__)}}function Dt(i,...t){for(const s of t)for(const h in s)i[h]=s[h];return i}class Vt extends Error{constructor(t,s){super(s),this.message=s,this.key=t}}class xr{constructor(t,s=[]){this.parent=t,this.bindings={};for(const[h,d]of s)this.bindings[h]=d}concat(t){return new xr(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const rr={kind:"null"},st={kind:"number"},Ut={kind:"string"},jt={kind:"boolean"},Br={kind:"color"},ca={kind:"object"},er={kind:"value"},Ya={kind:"collator"},ce={kind:"formatted"},V={kind:"padding"},H={kind:"resolvedImage"},te={kind:"variableAnchorOffsetCollection"};function de(i,t){return{kind:"array",itemType:i,N:t}}function xe(i){if(i.kind==="array"){const t=xe(i.itemType);return typeof i.N=="number"?`array<${t}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${t}>`}return i.kind}const Be=[rr,st,Ut,jt,Br,ce,ca,de(er),V,H,te];function Ae(i,t){if(t.kind==="error")return null;if(i.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Ae(i.itemType,t.itemType))&&(typeof i.N!="number"||i.N===t.N))return null}else{if(i.kind===t.kind)return null;if(i.kind==="value"){for(const s of Be)if(!Ae(s,t))return null}}return`Expected ${xe(i)} but found ${xe(t)} instead.`}function ve(i,t){return t.some(s=>s.kind===i.kind)}function De(i,t){return t.some(s=>s==="null"?i===null:s==="array"?Array.isArray(i):s==="object"?i&&!Array.isArray(i)&&typeof i=="object":s===typeof i)}function Je(i,t){return i.kind==="array"&&t.kind==="array"?i.itemType.kind===t.itemType.kind&&typeof i.N=="number":i.kind===t.kind}const et=.96422,N=.82521,J=4/29,Y=6/29,K=3*Y*Y,Q=Y*Y*Y,ae=Math.PI/180,Ve=180/Math.PI;function Ze(i){return(i%=360)<0&&(i+=360),i}function ze([i,t,s,h]){let d,_;const v=je((.2225045*(i=Ue(i))+.7168786*(t=Ue(t))+.0606169*(s=Ue(s)))/1);i===t&&t===s?d=_=v:(d=je((.4360747*i+.3850649*t+.1430804*s)/et),_=je((.0139322*i+.0971045*t+.7141733*s)/N));const b=116*v-16;return[b<0?0:b,500*(d-v),200*(v-_),h]}function Ue(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function je(i){return i>Q?Math.pow(i,1/3):i/K+J}function it([i,t,s,h]){let d=(i+16)/116,_=isNaN(t)?d:d+t/500,v=isNaN(s)?d:d-s/200;return d=1*St(d),_=et*St(_),v=N*St(v),[gt(3.1338561*_-1.6168667*d-.4906146*v),gt(-.9787684*_+1.9161415*d+.033454*v),gt(.0719453*_-.2289914*d+1.4052427*v),h]}function gt(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function St(i){return i>Y?i*i*i:K*(i-J)}function mt(i){return parseInt(i.padEnd(2,i),16)/255}function Ft(i,t){return Jt(t?i/100:i,0,1)}function Jt(i,t,s){return Math.min(Math.max(t,i),s)}function Cr(i){return!i.some(Number.isNaN)}const zr={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class tr{constructor(t,s,h,d=1,_=!0){this.r=t,this.g=s,this.b=h,this.a=d,_||(this.r*=d,this.g*=d,this.b*=d,d||this.overwriteGetter("rgb",[t,s,h,d]))}static parse(t){if(t instanceof tr)return t;if(typeof t!="string")return;const s=function(h){if((h=h.toLowerCase().trim())==="transparent")return[0,0,0,0];const d=zr[h];if(d){const[v,b,k]=d;return[v/255,b/255,k/255,1]}if(h.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(h)){const v=h.length<6?1:2;let b=1;return[mt(h.slice(b,b+=v)),mt(h.slice(b,b+=v)),mt(h.slice(b,b+=v)),mt(h.slice(b,b+v)||"ff")]}if(h.startsWith("rgb")){const v=h.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(v){const[b,k,I,D,B,G,W,X,ne,ge,we,Re]=v,ke=[D||" ",W||" ",ge].join("");if(ke==="  "||ke==="  /"||ke===",,"||ke===",,,"){const Ne=[I,G,ne].join(""),Ge=Ne==="%%%"?100:Ne===""?255:0;if(Ge){const at=[Jt(+k/Ge,0,1),Jt(+B/Ge,0,1),Jt(+X/Ge,0,1),we?Ft(+we,Re):1];if(Cr(at))return at}}return}}const _=h.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(_){const[v,b,k,I,D,B,G,W,X]=_,ne=[k||" ",D||" ",G].join("");if(ne==="  "||ne==="  /"||ne===",,"||ne===",,,"){const ge=[+b,Jt(+I,0,100),Jt(+B,0,100),W?Ft(+W,X):1];if(Cr(ge))return function([we,Re,ke,Ne]){function Ge(at){const At=(at+we/30)%12,Rt=Re*Math.min(ke,1-ke);return ke-Rt*Math.max(-1,Math.min(At-3,9-At,1))}return we=Ze(we),Re/=100,ke/=100,[Ge(0),Ge(8),Ge(4),Ne]}(ge)}}}(t);return s?new tr(...s,!1):void 0}get rgb(){const{r:t,g:s,b:h,a:d}=this,_=d||1/0;return this.overwriteGetter("rgb",[t/_,s/_,h/_,d])}get hcl(){return this.overwriteGetter("hcl",function(t){const[s,h,d,_]=ze(t),v=Math.sqrt(h*h+d*d);return[Math.round(1e4*v)?Ze(Math.atan2(d,h)*Ve):NaN,v,s,_]}(this.rgb))}get lab(){return this.overwriteGetter("lab",ze(this.rgb))}overwriteGetter(t,s){return Object.defineProperty(this,t,{value:s}),s}toString(){const[t,s,h,d]=this.rgb;return`rgba(${[t,s,h].map(_=>Math.round(255*_)).join(",")},${d})`}}tr.black=new tr(0,0,0,1),tr.white=new tr(1,1,1,1),tr.transparent=new tr(0,0,0,0),tr.red=new tr(1,0,0,1);class cn{constructor(t,s,h){this.sensitivity=t?s?"variant":"case":s?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,s){return this.collator.compare(t,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Wi{constructor(t,s,h,d,_){this.text=t,this.image=s,this.scale=h,this.fontStack=d,this.textColor=_}}class Jr{constructor(t){this.sections=t}static fromString(t){return new Jr([new Wi(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof Jr?t:Jr.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class na{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof na)return t;if(typeof t=="number")return new na([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const s of t)if(typeof s!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new na(t)}}toString(){return JSON.stringify(this.values)}}const Vs=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Qr{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Qr)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let s=0;s<t.length;s+=2){const h=t[s],d=t[s+1];if(typeof h!="string"||!Vs.has(h)||!Array.isArray(d)||d.length!==2||typeof d[0]!="number"||typeof d[1]!="number")return}return new Qr(t)}}toString(){return JSON.stringify(this.values)}}class Aa{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Aa({name:t,available:!1}):null}}function Ao(i,t,s,h){return typeof i=="number"&&i>=0&&i<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof s=="number"&&s>=0&&s<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:`Invalid rgba value [${[i,t,s,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof h=="number"?[i,t,s,h]:[i,t,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function us(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof tr||i instanceof cn||i instanceof Jr||i instanceof na||i instanceof Qr||i instanceof Aa)return!0;if(Array.isArray(i)){for(const t of i)if(!us(t))return!1;return!0}if(typeof i=="object"){for(const t in i)if(!us(i[t]))return!1;return!0}return!1}function jr(i){if(i===null)return rr;if(typeof i=="string")return Ut;if(typeof i=="boolean")return jt;if(typeof i=="number")return st;if(i instanceof tr)return Br;if(i instanceof cn)return Ya;if(i instanceof Jr)return ce;if(i instanceof na)return V;if(i instanceof Qr)return te;if(i instanceof Aa)return H;if(Array.isArray(i)){const t=i.length;let s;for(const h of i){const d=jr(h);if(s){if(s===d)continue;s=er;break}s=d}return de(s||er,t)}return ca}function _r(i){const t=typeof i;return i===null?"":t==="string"||t==="number"||t==="boolean"?String(i):i instanceof tr||i instanceof Jr||i instanceof na||i instanceof Qr||i instanceof Aa?i.toString():JSON.stringify(i)}class $n{constructor(t,s){this.type=t,this.value=s}static parse(t,s){if(t.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!us(t[1]))return s.error("invalid value");const h=t[1];let d=jr(h);const _=s.expectedType;return d.kind!=="array"||d.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(d=_),new $n(d,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Xr{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const Io={string:Ut,number:st,boolean:jt,object:ca};class Ai{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");let h,d=1;const _=t[0];if(_==="array"){let b,k;if(t.length>2){const I=t[1];if(typeof I!="string"||!(I in Io)||I==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);b=Io[I],d++}else b=er;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return s.error('The length argument to "array" must be a positive integer literal',2);k=t[2],d++}h=de(b,k)}else{if(!Io[_])throw new Error(`Types doesn't contain name = ${_}`);h=Io[_]}const v=[];for(;d<t.length;d++){const b=s.parse(t[d],d,er);if(!b)return null;v.push(b)}return new Ai(h,v)}evaluate(t){for(let s=0;s<this.args.length;s++){const h=this.args[s].evaluate(t);if(!Ae(this.type,jr(h)))return h;if(s===this.args.length-1)throw new Xr(`Expected value to be of type ${xe(this.type)}, but found ${xe(jr(h))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Cl={"to-boolean":jt,"to-color":Br,"to-number":st,"to-string":Ut};class Cn{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");const h=t[0];if(!Cl[h])throw new Error(`Can't parse ${h} as it is not part of the known types`);if((h==="to-boolean"||h==="to-string")&&t.length!==2)return s.error("Expected one argument.");const d=Cl[h],_=[];for(let v=1;v<t.length;v++){const b=s.parse(t[v],v,er);if(!b)return null;_.push(b)}return new Cn(d,_)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let s,h;for(const d of this.args){if(s=d.evaluate(t),h=null,s instanceof tr)return s;if(typeof s=="string"){const _=t.parseColor(s);if(_)return _}else if(Array.isArray(s)&&(h=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:Ao(s[0],s[1],s[2],s[3]),!h))return new tr(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new Xr(h||`Could not parse color from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"padding":{let s;for(const h of this.args){s=h.evaluate(t);const d=na.parse(s);if(d)return d}throw new Xr(`Could not parse padding from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"variableAnchorOffsetCollection":{let s;for(const h of this.args){s=h.evaluate(t);const d=Qr.parse(s);if(d)return d}throw new Xr(`Could not parse variableAnchorOffsetCollection from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"number":{let s=null;for(const h of this.args){if(s=h.evaluate(t),s===null)return 0;const d=Number(s);if(!isNaN(d))return d}throw new Xr(`Could not convert ${JSON.stringify(s)} to number.`)}case"formatted":return Jr.fromString(_r(this.args[0].evaluate(t)));case"resolvedImage":return Aa.fromString(_r(this.args[0].evaluate(t)));default:return _r(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const fu=["Unknown","Point","LineString","Polygon"];class Al{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?fu[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let s=this._parseColorCache[t];return s||(s=this._parseColorCache[t]=tr.parse(t)),s}}class Fo{constructor(t,s,h=[],d,_=new xr,v=[]){this.registry=t,this.path=h,this.key=h.map(b=>`[${b}]`).join(""),this.scope=_,this.errors=v,this.expectedType=d,this._isConstant=s}parse(t,s,h,d,_={}){return s?this.concat(s,h,d)._parse(t,_):this._parse(t,_)}_parse(t,s){function h(d,_,v){return v==="assert"?new Ai(_,[d]):v==="coerce"?new Cn(_,[d]):d}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const d=t[0];if(typeof d!="string")return this.error(`Expression name must be a string, but found ${typeof d} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const _=this.registry[d];if(_){let v=_.parse(t,this);if(!v)return null;if(this.expectedType){const b=this.expectedType,k=v.type;if(b.kind!=="string"&&b.kind!=="number"&&b.kind!=="boolean"&&b.kind!=="object"&&b.kind!=="array"||k.kind!=="value")if(b.kind!=="color"&&b.kind!=="formatted"&&b.kind!=="resolvedImage"||k.kind!=="value"&&k.kind!=="string")if(b.kind!=="padding"||k.kind!=="value"&&k.kind!=="number"&&k.kind!=="array")if(b.kind!=="variableAnchorOffsetCollection"||k.kind!=="value"&&k.kind!=="array"){if(this.checkSubtype(b,k))return null}else v=h(v,b,s.typeAnnotation||"coerce");else v=h(v,b,s.typeAnnotation||"coerce");else v=h(v,b,s.typeAnnotation||"coerce");else v=h(v,b,s.typeAnnotation||"assert")}if(!(v instanceof $n)&&v.type.kind!=="resolvedImage"&&this._isConstant(v)){const b=new Al;try{v=new $n(v.type,v.evaluate(b))}catch(k){return this.error(k.message),null}}return v}return this.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,s,h){const d=typeof t=="number"?this.path.concat(t):this.path,_=h?this.scope.concat(h):this.scope;return new Fo(this.registry,this._isConstant,d,s||null,_,this.errors)}error(t,...s){const h=`${this.key}${s.map(d=>`[${d}]`).join("")}`;this.errors.push(new Vt(h,t))}checkSubtype(t,s){const h=Ae(t,s);return h&&this.error(h),h}}class Po{constructor(t,s,h){this.type=Ya,this.locale=h,this.caseSensitive=t,this.diacriticSensitive=s}static parse(t,s){if(t.length!==2)return s.error("Expected one argument.");const h=t[1];if(typeof h!="object"||Array.isArray(h))return s.error("Collator options argument must be an object.");const d=s.parse(h["case-sensitive"]!==void 0&&h["case-sensitive"],1,jt);if(!d)return null;const _=s.parse(h["diacritic-sensitive"]!==void 0&&h["diacritic-sensitive"],1,jt);if(!_)return null;let v=null;return h.locale&&(v=s.parse(h.locale,1,Ut),!v)?null:new Po(d,_,v)}evaluate(t){return new cn(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}const An=8192;function Il(i,t){i[0]=Math.min(i[0],t[0]),i[1]=Math.min(i[1],t[1]),i[2]=Math.max(i[2],t[0]),i[3]=Math.max(i[3],t[1])}function $s(i,t){return!(i[0]<=t[0]||i[2]>=t[2]||i[1]<=t[1]||i[3]>=t[3])}function du(i,t){const s=(180+i[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,d=Math.pow(2,t.z);return[Math.round(s*d*An),Math.round(h*d*An)]}function Jh(i,t,s){const h=i[0]-t[0],d=i[1]-t[1],_=i[0]-s[0],v=i[1]-s[1];return h*v-_*d==0&&h*_<=0&&d*v<=0}function Fl(i,t){let s=!1;for(let v=0,b=t.length;v<b;v++){const k=t[v];for(let I=0,D=k.length;I<D-1;I++){if(Jh(i,k[I],k[I+1]))return!1;(d=k[I])[1]>(h=i)[1]!=(_=k[I+1])[1]>h[1]&&h[0]<(_[0]-d[0])*(h[1]-d[1])/(_[1]-d[1])+d[0]&&(s=!s)}}var h,d,_;return s}function Pl(i,t){for(let s=0;s<t.length;s++)if(Fl(i,t[s]))return!0;return!1}function pu(i,t,s,h){const d=h[0]-s[0],_=h[1]-s[1],v=(i[0]-s[0])*_-d*(i[1]-s[1]),b=(t[0]-s[0])*_-d*(t[1]-s[1]);return v>0&&b<0||v<0&&b>0}function Qh(i,t,s){for(const I of s)for(let D=0;D<I.length-1;++D)if((b=[(v=I[D+1])[0]-(_=I[D])[0],v[1]-_[1]])[0]*(k=[(d=t)[0]-(h=i)[0],d[1]-h[1]])[1]-b[1]*k[0]!=0&&pu(h,d,_,v)&&pu(_,v,h,d))return!0;var h,d,_,v,b,k;return!1}function mu(i,t){for(let s=0;s<i.length;++s)if(!Fl(i[s],t))return!1;for(let s=0;s<i.length-1;++s)if(Qh(i[s],i[s+1],t))return!1;return!0}function gu(i,t){for(let s=0;s<t.length;s++)if(mu(i,t[s]))return!0;return!1}function Mo(i,t,s){const h=[];for(let d=0;d<i.length;d++){const _=[];for(let v=0;v<i[d].length;v++){const b=du(i[d][v],s);Il(t,b),_.push(b)}h.push(_)}return h}function xu(i,t,s){const h=[];for(let d=0;d<i.length;d++){const _=Mo(i[d],t,s);h.push(_)}return h}function _u(i,t,s,h){if(i[0]<s[0]||i[0]>s[2]){const d=.5*h;let _=i[0]-s[0]>d?-h:s[0]-i[0]>d?h:0;_===0&&(_=i[0]-s[2]>d?-h:s[2]-i[0]>d?h:0),i[0]+=_}Il(t,i)}function Ml(i,t,s,h){const d=Math.pow(2,h.z)*An,_=[h.x*An,h.y*An],v=[];for(const b of i)for(const k of b){const I=[k.x+_[0],k.y+_[1]];_u(I,t,s,d),v.push(I)}return v}function Dl(i,t,s,h){const d=Math.pow(2,h.z)*An,_=[h.x*An,h.y*An],v=[];for(const k of i){const I=[];for(const D of k){const B=[D.x+_[0],D.y+_[1]];Il(t,B),I.push(B)}v.push(I)}if(t[2]-t[0]<=d/2){(b=t)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(const k of v)for(const I of k)_u(I,t,s,d)}var b;return v}class jn{constructor(t,s){this.type=jt,this.geojson=t,this.geometries=s}static parse(t,s){if(t.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(us(t[1])){const h=t[1];if(h.type==="FeatureCollection")for(let d=0;d<h.features.length;++d){const _=h.features[d].geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new jn(h,h.features[d].geometry)}else if(h.type==="Feature"){const d=h.geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new jn(h,h.geometry)}else if(h.type==="Polygon"||h.type==="MultiPolygon")return new jn(h,h)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(s,h){const d=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],v=s.canonicalID();if(h.type==="Polygon"){const b=Mo(h.coordinates,_,v),k=Ml(s.geometry(),d,_,v);if(!$s(d,_))return!1;for(const I of k)if(!Fl(I,b))return!1}if(h.type==="MultiPolygon"){const b=xu(h.coordinates,_,v),k=Ml(s.geometry(),d,_,v);if(!$s(d,_))return!1;for(const I of k)if(!Pl(I,b))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(s,h){const d=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],v=s.canonicalID();if(h.type==="Polygon"){const b=Mo(h.coordinates,_,v),k=Dl(s.geometry(),d,_,v);if(!$s(d,_))return!1;for(const I of k)if(!mu(I,b))return!1}if(h.type==="MultiPolygon"){const b=xu(h.coordinates,_,v),k=Dl(s.geometry(),d,_,v);if(!$s(d,_))return!1;for(const I of k)if(!gu(I,b))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Do{constructor(t,s){this.type=s.type,this.name=t,this.boundExpression=s}static parse(t,s){if(t.length!==2||typeof t[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const h=t[1];return s.scope.has(h)?new Do(h,s.scope.get(h)):s.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Ii{constructor(t,s,h,d){this.name=t,this.type=s,this._evaluate=h,this.args=d}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,s){const h=t[0],d=Ii.definitions[h];if(!d)return s.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);const _=Array.isArray(d)?d[0]:d.type,v=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,b=v.filter(([I])=>!Array.isArray(I)||I.length===t.length-1);let k=null;for(const[I,D]of b){k=new Fo(s.registry,Lo,s.path,null,s.scope);const B=[];let G=!1;for(let W=1;W<t.length;W++){const X=t[W],ne=Array.isArray(I)?I[W-1]:I.type,ge=k.parse(X,1+B.length,ne);if(!ge){G=!0;break}B.push(ge)}if(!G)if(Array.isArray(I)&&I.length!==B.length)k.error(`Expected ${I.length} arguments, but found ${B.length} instead.`);else{for(let W=0;W<B.length;W++){const X=Array.isArray(I)?I[W]:I.type,ne=B[W];k.concat(W+1).checkSubtype(X,ne.type)}if(k.errors.length===0)return new Ii(h,_,D,B)}}if(b.length===1)s.errors.push(...k.errors);else{const I=(b.length?b:v).map(([B])=>{return G=B,Array.isArray(G)?`(${G.map(xe).join(", ")})`:`(${xe(G.type)}...)`;var G}).join(" | "),D=[];for(let B=1;B<t.length;B++){const G=s.parse(t[B],1+D.length);if(!G)return null;D.push(xe(G.type))}s.error(`Expected arguments of type ${I}, but found (${D.join(", ")}) instead.`)}return null}static register(t,s){Ii.definitions=s;for(const h in s)t[h]=Ii}}function Lo(i){if(i instanceof Do)return Lo(i.boundExpression);if(i instanceof Ii&&i.name==="error"||i instanceof Po||i instanceof jn)return!1;const t=i instanceof Cn||i instanceof Ai;let s=!0;return i.eachChild(h=>{s=t?s&&Lo(h):s&&h instanceof $n}),!!s&&Ro(i)&&Oo(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Ro(i){if(i instanceof Ii&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof jn)return!1;let t=!0;return i.eachChild(s=>{t&&!Ro(s)&&(t=!1)}),t}function js(i){if(i instanceof Ii&&i.name==="feature-state")return!1;let t=!0;return i.eachChild(s=>{t&&!js(s)&&(t=!1)}),t}function Oo(i,t){if(i instanceof Ii&&t.indexOf(i.name)>=0)return!1;let s=!0;return i.eachChild(h=>{s&&!Oo(h,t)&&(s=!1)}),s}function hs(i,t){const s=i.length-1;let h,d,_=0,v=s,b=0;for(;_<=v;)if(b=Math.floor((_+v)/2),h=i[b],d=i[b+1],h<=t){if(b===s||t<d)return b;_=b+1}else{if(!(h>t))throw new Xr("Input is not a number.");v=b-1}return 0}class In{constructor(t,s,h){this.type=t,this.input=s,this.labels=[],this.outputs=[];for(const[d,_]of h)this.labels.push(d),this.outputs.push(_)}static parse(t,s){if(t.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return s.error("Expected an even number of arguments.");const h=s.parse(t[1],1,st);if(!h)return null;const d=[];let _=null;s.expectedType&&s.expectedType.kind!=="value"&&(_=s.expectedType);for(let v=1;v<t.length;v+=2){const b=v===1?-1/0:t[v],k=t[v+1],I=v,D=v+1;if(typeof b!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(d.length&&d[d.length-1][0]>=b)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',I);const B=s.parse(k,D,_);if(!B)return null;_=_||B.type,d.push([b,B])}return new In(_,h,d)}evaluate(t){const s=this.labels,h=this.outputs;if(s.length===1)return h[0].evaluate(t);const d=this.input.evaluate(t);if(d<=s[0])return h[0].evaluate(t);const _=s.length;return d>=s[_-1]?h[_-1].evaluate(t):h[hs(s,d)].evaluate(t)}eachChild(t){t(this.input);for(const s of this.outputs)t(s)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function pr(i,t,s){return i+s*(t-i)}function Bo(i,t,s){return i.map((h,d)=>pr(h,t[d],s))}const di={number:pr,color:function(i,t,s,h="rgb"){switch(h){case"rgb":{const[d,_,v,b]=Bo(i.rgb,t.rgb,s);return new tr(d,_,v,b,!1)}case"hcl":{const[d,_,v,b]=i.hcl,[k,I,D,B]=t.hcl;let G,W;if(isNaN(d)||isNaN(k))isNaN(d)?isNaN(k)?G=NaN:(G=k,v!==1&&v!==0||(W=I)):(G=d,D!==1&&D!==0||(W=_));else{let Re=k-d;k>d&&Re>180?Re-=360:k<d&&d-k>180&&(Re+=360),G=d+s*Re}const[X,ne,ge,we]=function([Re,ke,Ne,Ge]){return Re=isNaN(Re)?0:Re*ae,it([Ne,Math.cos(Re)*ke,Math.sin(Re)*ke,Ge])}([G,W??pr(_,I,s),pr(v,D,s),pr(b,B,s)]);return new tr(X,ne,ge,we,!1)}case"lab":{const[d,_,v,b]=it(Bo(i.lab,t.lab,s));return new tr(d,_,v,b,!1)}}},array:Bo,padding:function(i,t,s){return new na(Bo(i.values,t.values,s))},variableAnchorOffsetCollection:function(i,t,s){const h=i.values,d=t.values;if(h.length!==d.length)throw new Xr(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${t.toString()}`);const _=[];for(let v=0;v<h.length;v+=2){if(h[v]!==d[v])throw new Xr(`Cannot interpolate values containing mismatched anchors. from[${v}]: ${h[v]}, to[${v}]: ${d[v]}`);_.push(h[v]);const[b,k]=h[v+1],[I,D]=d[v+1];_.push([pr(b,I,s),pr(k,D,s)])}return new Qr(_)}};class pi{constructor(t,s,h,d,_){this.type=t,this.operator=s,this.interpolation=h,this.input=d,this.labels=[],this.outputs=[];for(const[v,b]of _)this.labels.push(v),this.outputs.push(b)}static interpolationFactor(t,s,h,d){let _=0;if(t.name==="exponential")_=Ll(s,t.base,h,d);else if(t.name==="linear")_=Ll(s,1,h,d);else if(t.name==="cubic-bezier"){const v=t.controlPoints;_=new z(v[0],v[1],v[2],v[3]).solve(Ll(s,1,h,d))}return _}static parse(t,s){let[h,d,_,...v]=t;if(!Array.isArray(d)||d.length===0)return s.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){const I=d[1];if(typeof I!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:I}}else{if(d[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(d[0])}`,1,0);{const I=d.slice(1);if(I.length!==4||I.some(D=>typeof D!="number"||D<0||D>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:I}}}if(t.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(_=s.parse(_,2,st),!_)return null;const b=[];let k=null;h==="interpolate-hcl"||h==="interpolate-lab"?k=Br:s.expectedType&&s.expectedType.kind!=="value"&&(k=s.expectedType);for(let I=0;I<v.length;I+=2){const D=v[I],B=v[I+1],G=I+3,W=I+4;if(typeof D!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',G);if(b.length&&b[b.length-1][0]>=D)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',G);const X=s.parse(B,W,k);if(!X)return null;k=k||X.type,b.push([D,X])}return Je(k,st)||Je(k,Br)||Je(k,V)||Je(k,te)||Je(k,de(st))?new pi(k,h,d,_,b):s.error(`Type ${xe(k)} is not interpolatable.`)}evaluate(t){const s=this.labels,h=this.outputs;if(s.length===1)return h[0].evaluate(t);const d=this.input.evaluate(t);if(d<=s[0])return h[0].evaluate(t);const _=s.length;if(d>=s[_-1])return h[_-1].evaluate(t);const v=hs(s,d),b=pi.interpolationFactor(this.interpolation,d,s[v],s[v+1]),k=h[v].evaluate(t),I=h[v+1].evaluate(t);switch(this.operator){case"interpolate":return di[this.type.kind](k,I,b);case"interpolate-hcl":return di.color(k,I,b,"hcl");case"interpolate-lab":return di.color(k,I,b,"lab")}}eachChild(t){t(this.input);for(const s of this.outputs)t(s)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Ll(i,t,s,h){const d=h-s,_=i-s;return d===0?0:t===1?_/d:(Math.pow(t,_)-1)/(Math.pow(t,d)-1)}class zo{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expectected at least one argument.");let h=null;const d=s.expectedType;d&&d.kind!=="value"&&(h=d);const _=[];for(const b of t.slice(1)){const k=s.parse(b,1+_.length,h,void 0,{typeAnnotation:"omit"});if(!k)return null;h=h||k.type,_.push(k)}if(!h)throw new Error("No output type");const v=d&&_.some(b=>Ae(d,b.type));return new zo(v?er:h,_)}evaluate(t){let s,h=null,d=0;for(const _ of this.args)if(d++,h=_.evaluate(t),h&&h instanceof Aa&&!h.available&&(s||(s=h.name),h=null,d===this.args.length&&(h=s)),h!==null)break;return h}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}class No{constructor(t,s){this.type=s.type,this.bindings=[].concat(t),this.result=s}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const s of this.bindings)t(s[1]);t(this.result)}static parse(t,s){if(t.length<4)return s.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const h=[];for(let _=1;_<t.length-1;_+=2){const v=t[_];if(typeof v!="string")return s.error(`Expected string, but found ${typeof v} instead.`,_);if(/[^a-zA-Z0-9_]/.test(v))return s.error("Variable names must contain only alphanumeric characters or '_'.",_);const b=s.parse(t[_+1],_+1);if(!b)return null;h.push([v,b])}const d=s.parse(t[t.length-1],t.length-1,s.expectedType,h);return d?new No(h,d):null}outputDefined(){return this.result.outputDefined()}}class Rl{constructor(t,s,h){this.type=t,this.index=s,this.input=h}static parse(t,s){if(t.length!==3)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const h=s.parse(t[1],1,st),d=s.parse(t[2],2,de(s.expectedType||er));return h&&d?new Rl(d.type.itemType,h,d):null}evaluate(t){const s=this.index.evaluate(t),h=this.input.evaluate(t);if(s<0)throw new Xr(`Array index out of bounds: ${s} < 0.`);if(s>=h.length)throw new Xr(`Array index out of bounds: ${s} > ${h.length-1}.`);if(s!==Math.floor(s))throw new Xr(`Array index must be an integer, but found ${s} instead.`);return h[s]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class Ol{constructor(t,s){this.type=jt,this.needle=t,this.haystack=s}static parse(t,s){if(t.length!==3)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const h=s.parse(t[1],1,er),d=s.parse(t[2],2,er);return h&&d?ve(h.type,[jt,Ut,st,rr,er])?new Ol(h,d):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${xe(h.type)} instead`):null}evaluate(t){const s=this.needle.evaluate(t),h=this.haystack.evaluate(t);if(!h)return!1;if(!De(s,["boolean","string","number","null"]))throw new Xr(`Expected first argument to be of type boolean, string, number or null, but found ${xe(jr(s))} instead.`);if(!De(h,["string","array"]))throw new Xr(`Expected second argument to be of type array or string, but found ${xe(jr(h))} instead.`);return h.indexOf(s)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class Uo{constructor(t,s,h){this.type=st,this.needle=t,this.haystack=s,this.fromIndex=h}static parse(t,s){if(t.length<=2||t.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const h=s.parse(t[1],1,er),d=s.parse(t[2],2,er);if(!h||!d)return null;if(!ve(h.type,[jt,Ut,st,rr,er]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${xe(h.type)} instead`);if(t.length===4){const _=s.parse(t[3],3,st);return _?new Uo(h,d,_):null}return new Uo(h,d)}evaluate(t){const s=this.needle.evaluate(t),h=this.haystack.evaluate(t);if(!De(s,["boolean","string","number","null"]))throw new Xr(`Expected first argument to be of type boolean, string, number or null, but found ${xe(jr(s))} instead.`);if(!De(h,["string","array"]))throw new Xr(`Expected second argument to be of type array or string, but found ${xe(jr(h))} instead.`);if(this.fromIndex){const d=this.fromIndex.evaluate(t);return h.indexOf(s,d)}return h.indexOf(s)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class Bl{constructor(t,s,h,d,_,v){this.inputType=t,this.type=s,this.input=h,this.cases=d,this.outputs=_,this.otherwise=v}static parse(t,s){if(t.length<5)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return s.error("Expected an even number of arguments.");let h,d;s.expectedType&&s.expectedType.kind!=="value"&&(d=s.expectedType);const _={},v=[];for(let I=2;I<t.length-1;I+=2){let D=t[I];const B=t[I+1];Array.isArray(D)||(D=[D]);const G=s.concat(I);if(D.length===0)return G.error("Expected at least one branch label.");for(const X of D){if(typeof X!="number"&&typeof X!="string")return G.error("Branch labels must be numbers or strings.");if(typeof X=="number"&&Math.abs(X)>Number.MAX_SAFE_INTEGER)return G.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof X=="number"&&Math.floor(X)!==X)return G.error("Numeric branch labels must be integer values.");if(h){if(G.checkSubtype(h,jr(X)))return null}else h=jr(X);if(_[String(X)]!==void 0)return G.error("Branch labels must be unique.");_[String(X)]=v.length}const W=s.parse(B,I,d);if(!W)return null;d=d||W.type,v.push(W)}const b=s.parse(t[1],1,er);if(!b)return null;const k=s.parse(t[t.length-1],t.length-1,d);return k?b.type.kind!=="value"&&s.concat(1).checkSubtype(h,b.type)?null:new Bl(h,d,b,_,v,k):null}evaluate(t){const s=this.input.evaluate(t);return(jr(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class zl{constructor(t,s,h){this.type=t,this.branches=s,this.otherwise=h}static parse(t,s){if(t.length<4)return s.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return s.error("Expected an odd number of arguments.");let h;s.expectedType&&s.expectedType.kind!=="value"&&(h=s.expectedType);const d=[];for(let v=1;v<t.length-1;v+=2){const b=s.parse(t[v],v,jt);if(!b)return null;const k=s.parse(t[v+1],v+1,h);if(!k)return null;d.push([b,k]),h=h||k.type}const _=s.parse(t[t.length-1],t.length-1,h);if(!_)return null;if(!h)throw new Error("Can't infer output type");return new zl(h,d,_)}evaluate(t){for(const[s,h]of this.branches)if(s.evaluate(t))return h.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[s,h]of this.branches)t(s),t(h);t(this.otherwise)}outputDefined(){return this.branches.every(([t,s])=>s.outputDefined())&&this.otherwise.outputDefined()}}class Vo{constructor(t,s,h,d){this.type=t,this.input=s,this.beginIndex=h,this.endIndex=d}static parse(t,s){if(t.length<=2||t.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const h=s.parse(t[1],1,er),d=s.parse(t[2],2,st);if(!h||!d)return null;if(!ve(h.type,[de(er),Ut,er]))return s.error(`Expected first argument to be of type array or string, but found ${xe(h.type)} instead`);if(t.length===4){const _=s.parse(t[3],3,st);return _?new Vo(h.type,h,d,_):null}return new Vo(h.type,h,d)}evaluate(t){const s=this.input.evaluate(t),h=this.beginIndex.evaluate(t);if(!De(s,["string","array"]))throw new Xr(`Expected first argument to be of type array or string, but found ${xe(jr(s))} instead.`);if(this.endIndex){const d=this.endIndex.evaluate(t);return s.slice(h,d)}return s.slice(h)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function yu(i,t){return i==="=="||i==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function vu(i,t,s,h){return h.compare(t,s)===0}function fs(i,t,s){const h=i!=="=="&&i!=="!=";return class r1{constructor(_,v,b){this.type=jt,this.lhs=_,this.rhs=v,this.collator=b,this.hasUntypedArgument=_.type.kind==="value"||v.type.kind==="value"}static parse(_,v){if(_.length!==3&&_.length!==4)return v.error("Expected two or three arguments.");const b=_[0];let k=v.parse(_[1],1,er);if(!k)return null;if(!yu(b,k.type))return v.concat(1).error(`"${b}" comparisons are not supported for type '${xe(k.type)}'.`);let I=v.parse(_[2],2,er);if(!I)return null;if(!yu(b,I.type))return v.concat(2).error(`"${b}" comparisons are not supported for type '${xe(I.type)}'.`);if(k.type.kind!==I.type.kind&&k.type.kind!=="value"&&I.type.kind!=="value")return v.error(`Cannot compare types '${xe(k.type)}' and '${xe(I.type)}'.`);h&&(k.type.kind==="value"&&I.type.kind!=="value"?k=new Ai(I.type,[k]):k.type.kind!=="value"&&I.type.kind==="value"&&(I=new Ai(k.type,[I])));let D=null;if(_.length===4){if(k.type.kind!=="string"&&I.type.kind!=="string"&&k.type.kind!=="value"&&I.type.kind!=="value")return v.error("Cannot use collator to compare non-string types.");if(D=v.parse(_[3],3,Ya),!D)return null}return new r1(k,I,D)}evaluate(_){const v=this.lhs.evaluate(_),b=this.rhs.evaluate(_);if(h&&this.hasUntypedArgument){const k=jr(v),I=jr(b);if(k.kind!==I.kind||k.kind!=="string"&&k.kind!=="number")throw new Xr(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${k.kind}, ${I.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){const k=jr(v),I=jr(b);if(k.kind!=="string"||I.kind!=="string")return t(_,v,b)}return this.collator?s(_,v,b,this.collator.evaluate(_)):t(_,v,b)}eachChild(_){_(this.lhs),_(this.rhs),this.collator&&_(this.collator)}outputDefined(){return!0}}}const ef=fs("==",function(i,t,s){return t===s},vu),tf=fs("!=",function(i,t,s){return t!==s},function(i,t,s,h){return!vu(0,t,s,h)}),rf=fs("<",function(i,t,s){return t<s},function(i,t,s,h){return h.compare(t,s)<0}),af=fs(">",function(i,t,s){return t>s},function(i,t,s,h){return h.compare(t,s)>0}),nf=fs("<=",function(i,t,s){return t<=s},function(i,t,s,h){return h.compare(t,s)<=0}),sf=fs(">=",function(i,t,s){return t>=s},function(i,t,s,h){return h.compare(t,s)>=0});class Nl{constructor(t,s,h,d,_){this.type=Ut,this.number=t,this.locale=s,this.currency=h,this.minFractionDigits=d,this.maxFractionDigits=_}static parse(t,s){if(t.length!==3)return s.error("Expected two arguments.");const h=s.parse(t[1],1,st);if(!h)return null;const d=t[2];if(typeof d!="object"||Array.isArray(d))return s.error("NumberFormat options argument must be an object.");let _=null;if(d.locale&&(_=s.parse(d.locale,1,Ut),!_))return null;let v=null;if(d.currency&&(v=s.parse(d.currency,1,Ut),!v))return null;let b=null;if(d["min-fraction-digits"]&&(b=s.parse(d["min-fraction-digits"],1,st),!b))return null;let k=null;return d["max-fraction-digits"]&&(k=s.parse(d["max-fraction-digits"],1,st),!k)?null:new Nl(h,_,v,b,k)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class $o{constructor(t){this.type=ce,this.sections=t}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");const h=t[1];if(!Array.isArray(h)&&typeof h=="object")return s.error("First argument must be an image or text section.");const d=[];let _=!1;for(let v=1;v<=t.length-1;++v){const b=t[v];if(_&&typeof b=="object"&&!Array.isArray(b)){_=!1;let k=null;if(b["font-scale"]&&(k=s.parse(b["font-scale"],1,st),!k))return null;let I=null;if(b["text-font"]&&(I=s.parse(b["text-font"],1,de(Ut)),!I))return null;let D=null;if(b["text-color"]&&(D=s.parse(b["text-color"],1,Br),!D))return null;const B=d[d.length-1];B.scale=k,B.font=I,B.textColor=D}else{const k=s.parse(t[v],1,er);if(!k)return null;const I=k.type.kind;if(I!=="string"&&I!=="value"&&I!=="null"&&I!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,d.push({content:k,scale:null,font:null,textColor:null})}}return new $o(d)}evaluate(t){return new Jr(this.sections.map(s=>{const h=s.content.evaluate(t);return jr(h)===H?new Wi("",h,null,null,null):new Wi(_r(h),null,s.scale?s.scale.evaluate(t):null,s.font?s.font.evaluate(t).join(","):null,s.textColor?s.textColor.evaluate(t):null)}))}eachChild(t){for(const s of this.sections)t(s.content),s.scale&&t(s.scale),s.font&&t(s.font),s.textColor&&t(s.textColor)}outputDefined(){return!1}}class Ul{constructor(t){this.type=H,this.input=t}static parse(t,s){if(t.length!==2)return s.error("Expected two arguments.");const h=s.parse(t[1],1,Ut);return h?new Ul(h):s.error("No image name provided.")}evaluate(t){const s=this.input.evaluate(t),h=Aa.fromString(s);return h&&t.availableImages&&(h.available=t.availableImages.indexOf(s)>-1),h}eachChild(t){t(this.input)}outputDefined(){return!1}}class Vl{constructor(t){this.type=st,this.input=t}static parse(t,s){if(t.length!==2)return s.error(`Expected 1 argument, but found ${t.length-1} instead.`);const h=s.parse(t[1],1);return h?h.type.kind!=="array"&&h.type.kind!=="string"&&h.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${xe(h.type)} instead.`):new Vl(h):null}evaluate(t){const s=this.input.evaluate(t);if(typeof s=="string"||Array.isArray(s))return s.length;throw new Xr(`Expected value to be of type string or array, but found ${xe(jr(s))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const ds={"==":ef,"!=":tf,">":af,"<":rf,">=":sf,"<=":nf,array:Ai,at:Rl,boolean:Ai,case:zl,coalesce:zo,collator:Po,format:$o,image:Ul,in:Ol,"index-of":Uo,interpolate:pi,"interpolate-hcl":pi,"interpolate-lab":pi,length:Vl,let:No,literal:$n,match:Bl,number:Ai,"number-format":Nl,object:Ai,slice:Vo,step:In,string:Ai,"to-boolean":Cn,"to-color":Cn,"to-number":Cn,"to-string":Cn,var:Do,within:jn};function wu(i,[t,s,h,d]){t=t.evaluate(i),s=s.evaluate(i),h=h.evaluate(i);const _=d?d.evaluate(i):1,v=Ao(t,s,h,_);if(v)throw new Xr(v);return new tr(t/255,s/255,h/255,_,!1)}function bu(i,t){return i in t}function $l(i,t){const s=t[i];return s===void 0?null:s}function Gn(i){return{type:i}}function Tu(i){return{result:"success",value:i}}function Fn(i){return{result:"error",value:i}}function ps(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Eu(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function jl(i){return!!i.expression&&i.expression.interpolated}function yr(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Gr(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function of(i){return i}function mr(i,t){const s=t.type==="color",h=i.stops&&typeof i.stops[0][0]=="object",d=h||!(h||i.property!==void 0),_=i.type||(jl(t)?"exponential":"interval");if(s||t.type==="padding"){const D=s?tr.parse:na.parse;(i=Dt({},i)).stops&&(i.stops=i.stops.map(B=>[B[0],D(B[1])])),i.default=D(i.default?i.default:t.default)}if(i.colorSpace&&(v=i.colorSpace)!=="rgb"&&v!=="hcl"&&v!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var v;let b,k,I;if(_==="exponential")b=Gs;else if(_==="interval")b=Nr;else if(_==="categorical"){b=Hr,k=Object.create(null);for(const D of i.stops)k[D[0]]=D[1];I=typeof i.stops[0][0]}else{if(_!=="identity")throw new Error(`Unknown function type "${_}"`);b=Su}if(h){const D={},B=[];for(let X=0;X<i.stops.length;X++){const ne=i.stops[X],ge=ne[0].zoom;D[ge]===void 0&&(D[ge]={zoom:ge,type:i.type,property:i.property,default:i.default,stops:[]},B.push(ge)),D[ge].stops.push([ne[0].value,ne[1]])}const G=[];for(const X of B)G.push([D[X].zoom,mr(D[X],t)]);const W={name:"linear"};return{kind:"composite",interpolationType:W,interpolationFactor:pi.interpolationFactor.bind(void 0,W),zoomStops:G.map(X=>X[0]),evaluate:({zoom:X},ne)=>Gs({stops:G,base:i.base},t,X).evaluate(X,ne)}}if(d){const D=_==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:D,interpolationFactor:pi.interpolationFactor.bind(void 0,D),zoomStops:i.stops.map(B=>B[0]),evaluate:({zoom:B})=>b(i,t,B,k,I)}}return{kind:"source",evaluate(D,B){const G=B&&B.properties?B.properties[i.property]:void 0;return G===void 0?Hn(i.default,t.default):b(i,t,G,k,I)}}}function Hn(i,t,s){return i!==void 0?i:t!==void 0?t:s!==void 0?s:void 0}function Hr(i,t,s,h,d){return Hn(typeof s===d?h[s]:void 0,i.default,t.default)}function Nr(i,t,s){if(yr(s)!=="number")return Hn(i.default,t.default);const h=i.stops.length;if(h===1||s<=i.stops[0][0])return i.stops[0][1];if(s>=i.stops[h-1][0])return i.stops[h-1][1];const d=hs(i.stops.map(_=>_[0]),s);return i.stops[d][1]}function Gs(i,t,s){const h=i.base!==void 0?i.base:1;if(yr(s)!=="number")return Hn(i.default,t.default);const d=i.stops.length;if(d===1||s<=i.stops[0][0])return i.stops[0][1];if(s>=i.stops[d-1][0])return i.stops[d-1][1];const _=hs(i.stops.map(D=>D[0]),s),v=function(D,B,G,W){const X=W-G,ne=D-G;return X===0?0:B===1?ne/X:(Math.pow(B,ne)-1)/(Math.pow(B,X)-1)}(s,h,i.stops[_][0],i.stops[_+1][0]),b=i.stops[_][1],k=i.stops[_+1][1],I=di[t.type]||of;return typeof b.evaluate=="function"?{evaluate(...D){const B=b.evaluate.apply(void 0,D),G=k.evaluate.apply(void 0,D);if(B!==void 0&&G!==void 0)return I(B,G,v,i.colorSpace)}}:I(b,k,v,i.colorSpace)}function Su(i,t,s){switch(t.type){case"color":s=tr.parse(s);break;case"formatted":s=Jr.fromString(s.toString());break;case"resolvedImage":s=Aa.fromString(s.toString());break;case"padding":s=na.parse(s);break;default:yr(s)===t.type||t.type==="enum"&&t.values[s]||(s=void 0)}return Hn(s,i.default,t.default)}Ii.register(ds,{error:[{kind:"error"},[Ut],(i,[t])=>{throw new Xr(t.evaluate(i))}],typeof:[Ut,[er],(i,[t])=>xe(jr(t.evaluate(i)))],"to-rgba":[de(st,4),[Br],(i,[t])=>{const[s,h,d,_]=t.evaluate(i).rgb;return[255*s,255*h,255*d,_]}],rgb:[Br,[st,st,st],wu],rgba:[Br,[st,st,st,st],wu],has:{type:jt,overloads:[[[Ut],(i,[t])=>bu(t.evaluate(i),i.properties())],[[Ut,ca],(i,[t,s])=>bu(t.evaluate(i),s.evaluate(i))]]},get:{type:er,overloads:[[[Ut],(i,[t])=>$l(t.evaluate(i),i.properties())],[[Ut,ca],(i,[t,s])=>$l(t.evaluate(i),s.evaluate(i))]]},"feature-state":[er,[Ut],(i,[t])=>$l(t.evaluate(i),i.featureState||{})],properties:[ca,[],i=>i.properties()],"geometry-type":[Ut,[],i=>i.geometryType()],id:[er,[],i=>i.id()],zoom:[st,[],i=>i.globals.zoom],"heatmap-density":[st,[],i=>i.globals.heatmapDensity||0],"line-progress":[st,[],i=>i.globals.lineProgress||0],accumulated:[er,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[st,Gn(st),(i,t)=>{let s=0;for(const h of t)s+=h.evaluate(i);return s}],"*":[st,Gn(st),(i,t)=>{let s=1;for(const h of t)s*=h.evaluate(i);return s}],"-":{type:st,overloads:[[[st,st],(i,[t,s])=>t.evaluate(i)-s.evaluate(i)],[[st],(i,[t])=>-t.evaluate(i)]]},"/":[st,[st,st],(i,[t,s])=>t.evaluate(i)/s.evaluate(i)],"%":[st,[st,st],(i,[t,s])=>t.evaluate(i)%s.evaluate(i)],ln2:[st,[],()=>Math.LN2],pi:[st,[],()=>Math.PI],e:[st,[],()=>Math.E],"^":[st,[st,st],(i,[t,s])=>Math.pow(t.evaluate(i),s.evaluate(i))],sqrt:[st,[st],(i,[t])=>Math.sqrt(t.evaluate(i))],log10:[st,[st],(i,[t])=>Math.log(t.evaluate(i))/Math.LN10],ln:[st,[st],(i,[t])=>Math.log(t.evaluate(i))],log2:[st,[st],(i,[t])=>Math.log(t.evaluate(i))/Math.LN2],sin:[st,[st],(i,[t])=>Math.sin(t.evaluate(i))],cos:[st,[st],(i,[t])=>Math.cos(t.evaluate(i))],tan:[st,[st],(i,[t])=>Math.tan(t.evaluate(i))],asin:[st,[st],(i,[t])=>Math.asin(t.evaluate(i))],acos:[st,[st],(i,[t])=>Math.acos(t.evaluate(i))],atan:[st,[st],(i,[t])=>Math.atan(t.evaluate(i))],min:[st,Gn(st),(i,t)=>Math.min(...t.map(s=>s.evaluate(i)))],max:[st,Gn(st),(i,t)=>Math.max(...t.map(s=>s.evaluate(i)))],abs:[st,[st],(i,[t])=>Math.abs(t.evaluate(i))],round:[st,[st],(i,[t])=>{const s=t.evaluate(i);return s<0?-Math.round(-s):Math.round(s)}],floor:[st,[st],(i,[t])=>Math.floor(t.evaluate(i))],ceil:[st,[st],(i,[t])=>Math.ceil(t.evaluate(i))],"filter-==":[jt,[Ut,er],(i,[t,s])=>i.properties()[t.value]===s.value],"filter-id-==":[jt,[er],(i,[t])=>i.id()===t.value],"filter-type-==":[jt,[Ut],(i,[t])=>i.geometryType()===t.value],"filter-<":[jt,[Ut,er],(i,[t,s])=>{const h=i.properties()[t.value],d=s.value;return typeof h==typeof d&&h<d}],"filter-id-<":[jt,[er],(i,[t])=>{const s=i.id(),h=t.value;return typeof s==typeof h&&s<h}],"filter->":[jt,[Ut,er],(i,[t,s])=>{const h=i.properties()[t.value],d=s.value;return typeof h==typeof d&&h>d}],"filter-id->":[jt,[er],(i,[t])=>{const s=i.id(),h=t.value;return typeof s==typeof h&&s>h}],"filter-<=":[jt,[Ut,er],(i,[t,s])=>{const h=i.properties()[t.value],d=s.value;return typeof h==typeof d&&h<=d}],"filter-id-<=":[jt,[er],(i,[t])=>{const s=i.id(),h=t.value;return typeof s==typeof h&&s<=h}],"filter->=":[jt,[Ut,er],(i,[t,s])=>{const h=i.properties()[t.value],d=s.value;return typeof h==typeof d&&h>=d}],"filter-id->=":[jt,[er],(i,[t])=>{const s=i.id(),h=t.value;return typeof s==typeof h&&s>=h}],"filter-has":[jt,[er],(i,[t])=>t.value in i.properties()],"filter-has-id":[jt,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[jt,[de(Ut)],(i,[t])=>t.value.indexOf(i.geometryType())>=0],"filter-id-in":[jt,[de(er)],(i,[t])=>t.value.indexOf(i.id())>=0],"filter-in-small":[jt,[Ut,de(er)],(i,[t,s])=>s.value.indexOf(i.properties()[t.value])>=0],"filter-in-large":[jt,[Ut,de(er)],(i,[t,s])=>function(h,d,_,v){for(;_<=v;){const b=_+v>>1;if(d[b]===h)return!0;d[b]>h?v=b-1:_=b+1}return!1}(i.properties()[t.value],s.value,0,s.value.length-1)],all:{type:jt,overloads:[[[jt,jt],(i,[t,s])=>t.evaluate(i)&&s.evaluate(i)],[Gn(jt),(i,t)=>{for(const s of t)if(!s.evaluate(i))return!1;return!0}]]},any:{type:jt,overloads:[[[jt,jt],(i,[t,s])=>t.evaluate(i)||s.evaluate(i)],[Gn(jt),(i,t)=>{for(const s of t)if(s.evaluate(i))return!0;return!1}]]},"!":[jt,[jt],(i,[t])=>!t.evaluate(i)],"is-supported-script":[jt,[Ut],(i,[t])=>{const s=i.globals&&i.globals.isSupportedScript;return!s||s(t.evaluate(i))}],upcase:[Ut,[Ut],(i,[t])=>t.evaluate(i).toUpperCase()],downcase:[Ut,[Ut],(i,[t])=>t.evaluate(i).toLowerCase()],concat:[Ut,Gn(er),(i,t)=>t.map(s=>_r(s.evaluate(i))).join("")],"resolved-locale":[Ut,[Ya],(i,[t])=>t.evaluate(i).resolvedLocale()]});class Gl{constructor(t,s){var h;this.expression=t,this._warningHistory={},this._evaluator=new Al,this._defaultValue=s?(h=s).type==="color"&&Gr(h.default)?new tr(0,0,0,0):h.type==="color"?tr.parse(h.default)||null:h.type==="padding"?na.parse(h.default)||null:h.type==="variableAnchorOffsetCollection"?Qr.parse(h.default)||null:h.default===void 0?null:h.default:null,this._enumValues=s&&s.type==="enum"?s.values:null}evaluateWithoutErrorHandling(t,s,h,d,_,v){return this._evaluator.globals=t,this._evaluator.feature=s,this._evaluator.featureState=h,this._evaluator.canonical=d,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=v,this.expression.evaluate(this._evaluator)}evaluate(t,s,h,d,_,v){this._evaluator.globals=t,this._evaluator.feature=s||null,this._evaluator.featureState=h||null,this._evaluator.canonical=d,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=v||null;try{const b=this.expression.evaluate(this._evaluator);if(b==null||typeof b=="number"&&b!=b)return this._defaultValue;if(this._enumValues&&!(b in this._enumValues))throw new Xr(`Expected value to be one of ${Object.keys(this._enumValues).map(k=>JSON.stringify(k)).join(", ")}, but found ${JSON.stringify(b)} instead.`);return b}catch(b){return this._warningHistory[b.message]||(this._warningHistory[b.message]=!0,typeof console<"u"&&console.warn(b.message)),this._defaultValue}}}function jo(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in ds}function Go(i,t){const s=new Fo(ds,Lo,[],t?function(d){const _={color:Br,string:Ut,number:st,enum:Ut,boolean:jt,formatted:ce,padding:V,resolvedImage:H,variableAnchorOffsetCollection:te};return d.type==="array"?de(_[d.value]||er,d.length):_[d.type]}(t):void 0),h=s.parse(i,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?Tu(new Gl(h,t)):Fn(s.errors)}class Hl{constructor(t,s){this.kind=t,this._styleExpression=s,this.isStateDependent=t!=="constant"&&!js(s.expression)}evaluateWithoutErrorHandling(t,s,h,d,_,v){return this._styleExpression.evaluateWithoutErrorHandling(t,s,h,d,_,v)}evaluate(t,s,h,d,_,v){return this._styleExpression.evaluate(t,s,h,d,_,v)}}class Ho{constructor(t,s,h,d){this.kind=t,this.zoomStops=h,this._styleExpression=s,this.isStateDependent=t!=="camera"&&!js(s.expression),this.interpolationType=d}evaluateWithoutErrorHandling(t,s,h,d,_,v){return this._styleExpression.evaluateWithoutErrorHandling(t,s,h,d,_,v)}evaluate(t,s,h,d,_,v){return this._styleExpression.evaluate(t,s,h,d,_,v)}interpolationFactor(t,s,h){return this.interpolationType?pi.interpolationFactor(this.interpolationType,t,s,h):0}}function ql(i,t){const s=Go(i,t);if(s.result==="error")return s;const h=s.value.expression,d=Ro(h);if(!d&&!ps(t))return Fn([new Vt("","data expressions not supported")]);const _=Oo(h,["zoom"]);if(!_&&!Eu(t))return Fn([new Vt("","zoom expressions not supported")]);const v=qs(h);return v||_?v instanceof Vt?Fn([v]):v instanceof pi&&!jl(t)?Fn([new Vt("",'"interpolate" expressions cannot be used with this property')]):Tu(v?new Ho(d?"camera":"composite",s.value,v.labels,v instanceof pi?v.interpolation:void 0):new Hl(d?"constant":"source",s.value)):Fn([new Vt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Hs{constructor(t,s){this._parameters=t,this._specification=s,Dt(this,mr(this._parameters,this._specification))}static deserialize(t){return new Hs(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function qs(i){let t=null;if(i instanceof No)t=qs(i.result);else if(i instanceof zo){for(const s of i.args)if(t=qs(s),t)break}else(i instanceof In||i instanceof pi)&&i.input instanceof Ii&&i.input.name==="zoom"&&(t=i);return t instanceof Vt||i.eachChild(s=>{const h=qs(s);h instanceof Vt?t=h:!t&&h?t=new Vt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&h&&t!==h&&(t=new Vt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function Ws(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const t of i.slice(1))if(!Ws(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const lf={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Wl(i){if(i==null)return{filter:()=>!0,needGeometry:!1};Ws(i)||(i=qo(i));const t=Go(i,lf);if(t.result==="error")throw new Error(t.value.map(s=>`${s.key}: ${s.message}`).join(", "));return{filter:(s,h,d)=>t.value.evaluate(s,h,{},d),needGeometry:ku(i)}}function cf(i,t){return i<t?-1:i>t?1:0}function ku(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let t=1;t<i.length;t++)if(ku(i[t]))return!0;return!1}function qo(i){if(!i)return!0;const t=i[0];return i.length<=1?t!=="any":t==="=="?Zl(i[1],i[2],"=="):t==="!="?Zs(Zl(i[1],i[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Zl(i[1],i[2],t):t==="any"?(s=i.slice(1),["any"].concat(s.map(qo))):t==="all"?["all"].concat(i.slice(1).map(qo)):t==="none"?["all"].concat(i.slice(1).map(qo).map(Zs)):t==="in"?Cu(i[1],i.slice(2)):t==="!in"?Zs(Cu(i[1],i.slice(2))):t==="has"?Au(i[1]):t==="!has"?Zs(Au(i[1])):t!=="within"||i;var s}function Zl(i,t,s){switch(i){case"$type":return[`filter-type-${s}`,t];case"$id":return[`filter-id-${s}`,t];default:return[`filter-${s}`,i,t]}}function Cu(i,t){if(t.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(s=>typeof s!=typeof t[0])?["filter-in-large",i,["literal",t.sort(cf)]]:["filter-in-small",i,["literal",t]]}}function Au(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Zs(i){return["!",i]}function Wo(i){const t=typeof i;if(t==="number"||t==="boolean"||t==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let d="[";for(const _ of i)d+=`${Wo(_)},`;return`${d}]`}const s=Object.keys(i).sort();let h="{";for(let d=0;d<s.length;d++)h+=`${JSON.stringify(s[d])}:${Wo(i[s[d]])},`;return`${h}}`}function Zo(i){let t="";for(const s of Sr)t+=`/${Wo(i[s])}`;return t}function Iu(i){const t=i.value;return t?[new ct(i.key,t,"constants have been deprecated as of v8")]:[]}function Kr(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function qn(i){if(Array.isArray(i))return i.map(qn);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const t={};for(const s in i)t[s]=qn(i[s]);return t}return Kr(i)}function Ja(i){const t=i.key,s=i.value,h=i.valueSpec||{},d=i.objectElementValidators||{},_=i.style,v=i.styleSpec,b=i.validateSpec;let k=[];const I=yr(s);if(I!=="object")return[new ct(t,s,`object expected, ${I} found`)];for(const D in s){const B=D.split(".")[0],G=h[B]||h["*"];let W;if(d[B])W=d[B];else if(h[B])W=b;else if(d["*"])W=d["*"];else{if(!h["*"]){k.push(new ct(t,s[D],`unknown property "${D}"`));continue}W=b}k=k.concat(W({key:(t&&`${t}.`)+D,value:s[D],valueSpec:G,style:_,styleSpec:v,object:s,objectKey:D,validateSpec:b},s))}for(const D in h)d[D]||h[D].required&&h[D].default===void 0&&s[D]===void 0&&k.push(new ct(t,s,`missing required property "${D}"`));return k}function ms(i){const t=i.value,s=i.valueSpec,h=i.style,d=i.styleSpec,_=i.key,v=i.arrayElementValidator||i.validateSpec;if(yr(t)!=="array")return[new ct(_,t,`array expected, ${yr(t)} found`)];if(s.length&&t.length!==s.length)return[new ct(_,t,`array length ${s.length} expected, length ${t.length} found`)];if(s["min-length"]&&t.length<s["min-length"])return[new ct(_,t,`array length at least ${s["min-length"]} expected, length ${t.length} found`)];let b={type:s.value,values:s.values};d.$version<7&&(b.function=s.function),yr(s.value)==="object"&&(b=s.value);let k=[];for(let I=0;I<t.length;I++)k=k.concat(v({array:t,arrayIndex:I,value:t[I],valueSpec:b,validateSpec:i.validateSpec,style:h,styleSpec:d,key:`${_}[${I}]`}));return k}function Xs(i){const t=i.key,s=i.value,h=i.valueSpec;let d=yr(s);return d==="number"&&s!=s&&(d="NaN"),d!=="number"?[new ct(t,s,`number expected, ${d} found`)]:"minimum"in h&&s<h.minimum?[new ct(t,s,`${s} is less than the minimum value ${h.minimum}`)]:"maximum"in h&&s>h.maximum?[new ct(t,s,`${s} is greater than the maximum value ${h.maximum}`)]:[]}function Xo(i){const t=i.valueSpec,s=Kr(i.value.type);let h,d,_,v={};const b=s!=="categorical"&&i.value.property===void 0,k=!b,I=yr(i.value.stops)==="array"&&yr(i.value.stops[0])==="array"&&yr(i.value.stops[0][0])==="object",D=Ja({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(W){if(s==="identity")return[new ct(W.key,W.value,'identity function may not have a "stops" property')];let X=[];const ne=W.value;return X=X.concat(ms({key:W.key,value:ne,valueSpec:W.valueSpec,validateSpec:W.validateSpec,style:W.style,styleSpec:W.styleSpec,arrayElementValidator:B})),yr(ne)==="array"&&ne.length===0&&X.push(new ct(W.key,ne,"array must have at least one stop")),X},default:function(W){return W.validateSpec({key:W.key,value:W.value,valueSpec:t,validateSpec:W.validateSpec,style:W.style,styleSpec:W.styleSpec})}}});return s==="identity"&&b&&D.push(new ct(i.key,i.value,'missing required property "property"')),s==="identity"||i.value.stops||D.push(new ct(i.key,i.value,'missing required property "stops"')),s==="exponential"&&i.valueSpec.expression&&!jl(i.valueSpec)&&D.push(new ct(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(k&&!ps(i.valueSpec)?D.push(new ct(i.key,i.value,"property functions not supported")):b&&!Eu(i.valueSpec)&&D.push(new ct(i.key,i.value,"zoom functions not supported"))),s!=="categorical"&&!I||i.value.property!==void 0||D.push(new ct(i.key,i.value,'"property" property is required')),D;function B(W){let X=[];const ne=W.value,ge=W.key;if(yr(ne)!=="array")return[new ct(ge,ne,`array expected, ${yr(ne)} found`)];if(ne.length!==2)return[new ct(ge,ne,`array length 2 expected, length ${ne.length} found`)];if(I){if(yr(ne[0])!=="object")return[new ct(ge,ne,`object expected, ${yr(ne[0])} found`)];if(ne[0].zoom===void 0)return[new ct(ge,ne,"object stop key must have zoom")];if(ne[0].value===void 0)return[new ct(ge,ne,"object stop key must have value")];if(_&&_>Kr(ne[0].zoom))return[new ct(ge,ne[0].zoom,"stop zoom values must appear in ascending order")];Kr(ne[0].zoom)!==_&&(_=Kr(ne[0].zoom),d=void 0,v={}),X=X.concat(Ja({key:`${ge}[0]`,value:ne[0],valueSpec:{zoom:{}},validateSpec:W.validateSpec,style:W.style,styleSpec:W.styleSpec,objectElementValidators:{zoom:Xs,value:G}}))}else X=X.concat(G({key:`${ge}[0]`,value:ne[0],valueSpec:{},validateSpec:W.validateSpec,style:W.style,styleSpec:W.styleSpec},ne));return jo(qn(ne[1]))?X.concat([new ct(`${ge}[1]`,ne[1],"expressions are not allowed in function stops.")]):X.concat(W.validateSpec({key:`${ge}[1]`,value:ne[1],valueSpec:t,validateSpec:W.validateSpec,style:W.style,styleSpec:W.styleSpec}))}function G(W,X){const ne=yr(W.value),ge=Kr(W.value),we=W.value!==null?W.value:X;if(h){if(ne!==h)return[new ct(W.key,we,`${ne} stop domain type must match previous stop domain type ${h}`)]}else h=ne;if(ne!=="number"&&ne!=="string"&&ne!=="boolean")return[new ct(W.key,we,"stop domain value must be a number, string, or boolean")];if(ne!=="number"&&s!=="categorical"){let Re=`number expected, ${ne} found`;return ps(t)&&s===void 0&&(Re+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ct(W.key,we,Re)]}return s!=="categorical"||ne!=="number"||isFinite(ge)&&Math.floor(ge)===ge?s!=="categorical"&&ne==="number"&&d!==void 0&&ge<d?[new ct(W.key,we,"stop domain values must appear in ascending order")]:(d=ge,s==="categorical"&&ge in v?[new ct(W.key,we,"stop domain values must be unique")]:(v[ge]=!0,[])):[new ct(W.key,we,`integer expected, found ${ge}`)]}}function Wn(i){const t=(i.expressionContext==="property"?ql:Go)(qn(i.value),i.valueSpec);if(t.result==="error")return t.value.map(h=>new ct(`${i.key}${h.key}`,i.value,h.message));const s=t.value.expression||t.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!s.outputDefined())return[new ct(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!js(s))return[new ct(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!js(s))return[new ct(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!Oo(s,["zoom","feature-state"]))return[new ct(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Ro(s))return[new ct(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ks(i){const t=i.key,s=i.value,h=i.valueSpec,d=[];return Array.isArray(h.values)?h.values.indexOf(Kr(s))===-1&&d.push(new ct(t,s,`expected one of [${h.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(h.values).indexOf(Kr(s))===-1&&d.push(new ct(t,s,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(s)} found`)),d}function gs(i){return Ws(qn(i.value))?Wn(Dt({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Fu(i)}function Fu(i){const t=i.value,s=i.key;if(yr(t)!=="array")return[new ct(s,t,`array expected, ${yr(t)} found`)];const h=i.styleSpec;let d,_=[];if(t.length<1)return[new ct(s,t,"filter array must have at least 1 element")];switch(_=_.concat(Ks({key:`${s}[0]`,value:t[0],valueSpec:h.filter_operator,style:i.style,styleSpec:i.styleSpec})),Kr(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Kr(t[1])==="$type"&&_.push(new ct(s,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&_.push(new ct(s,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(d=yr(t[1]),d!=="string"&&_.push(new ct(`${s}[1]`,t[1],`string expected, ${d} found`)));for(let v=2;v<t.length;v++)d=yr(t[v]),Kr(t[1])==="$type"?_=_.concat(Ks({key:`${s}[${v}]`,value:t[v],valueSpec:h.geometry_type,style:i.style,styleSpec:i.styleSpec})):d!=="string"&&d!=="number"&&d!=="boolean"&&_.push(new ct(`${s}[${v}]`,t[v],`string, number, or boolean expected, ${d} found`));break;case"any":case"all":case"none":for(let v=1;v<t.length;v++)_=_.concat(Fu({key:`${s}[${v}]`,value:t[v],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":d=yr(t[1]),t.length!==2?_.push(new ct(s,t,`filter array for "${t[0]}" operator must have 2 elements`)):d!=="string"&&_.push(new ct(`${s}[1]`,t[1],`string expected, ${d} found`));break;case"within":d=yr(t[1]),t.length!==2?_.push(new ct(s,t,`filter array for "${t[0]}" operator must have 2 elements`)):d!=="object"&&_.push(new ct(`${s}[1]`,t[1],`object expected, ${d} found`))}return _}function Pu(i,t){const s=i.key,h=i.validateSpec,d=i.style,_=i.styleSpec,v=i.value,b=i.objectKey,k=_[`${t}_${i.layerType}`];if(!k)return[];const I=b.match(/^(.*)-transition$/);if(t==="paint"&&I&&k[I[1]]&&k[I[1]].transition)return h({key:s,value:v,valueSpec:_.transition,style:d,styleSpec:_});const D=i.valueSpec||k[b];if(!D)return[new ct(s,v,`unknown property "${b}"`)];let B;if(yr(v)==="string"&&ps(D)&&!D.tokens&&(B=/^{([^}]+)}$/.exec(v)))return[new ct(s,v,`"${b}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(B[1])} }\`.`)];const G=[];return i.layerType==="symbol"&&(b==="text-field"&&d&&!d.glyphs&&G.push(new ct(s,v,'use of "text-field" requires a style "glyphs" property')),b==="text-font"&&Gr(qn(v))&&Kr(v.type)==="identity"&&G.push(new ct(s,v,'"text-font" does not support identity functions'))),G.concat(h({key:i.key,value:v,valueSpec:D,style:d,styleSpec:_,expressionContext:"property",propertyType:t,propertyKey:b}))}function Mu(i){return Pu(i,"paint")}function Du(i){return Pu(i,"layout")}function Lu(i){let t=[];const s=i.value,h=i.key,d=i.style,_=i.styleSpec;s.type||s.ref||t.push(new ct(h,s,'either "type" or "ref" is required'));let v=Kr(s.type);const b=Kr(s.ref);if(s.id){const k=Kr(s.id);for(let I=0;I<i.arrayIndex;I++){const D=d.layers[I];Kr(D.id)===k&&t.push(new ct(h,s.id,`duplicate layer id "${s.id}", previously used at line ${D.id.__line__}`))}}if("ref"in s){let k;["type","source","source-layer","filter","layout"].forEach(I=>{I in s&&t.push(new ct(h,s[I],`"${I}" is prohibited for ref layers`))}),d.layers.forEach(I=>{Kr(I.id)===b&&(k=I)}),k?k.ref?t.push(new ct(h,s.ref,"ref cannot reference another ref layer")):v=Kr(k.type):t.push(new ct(h,s.ref,`ref layer "${b}" not found`))}else if(v!=="background")if(s.source){const k=d.sources&&d.sources[s.source],I=k&&Kr(k.type);k?I==="vector"&&v==="raster"?t.push(new ct(h,s.source,`layer "${s.id}" requires a raster source`)):I!=="raster-dem"&&v==="hillshade"?t.push(new ct(h,s.source,`layer "${s.id}" requires a raster-dem source`)):I==="raster"&&v!=="raster"?t.push(new ct(h,s.source,`layer "${s.id}" requires a vector source`)):I!=="vector"||s["source-layer"]?I==="raster-dem"&&v!=="hillshade"?t.push(new ct(h,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):v!=="line"||!s.paint||!s.paint["line-gradient"]||I==="geojson"&&k.lineMetrics||t.push(new ct(h,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new ct(h,s,`layer "${s.id}" must specify a "source-layer"`)):t.push(new ct(h,s.source,`source "${s.source}" not found`))}else t.push(new ct(h,s,'missing required property "source"'));return t=t.concat(Ja({key:h,value:s,valueSpec:_.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${h}.type`,value:s.type,valueSpec:_.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:s,objectKey:"type"}),filter:gs,layout:k=>Ja({layer:s,key:k.key,value:k.value,style:k.style,styleSpec:k.styleSpec,validateSpec:k.validateSpec,objectElementValidators:{"*":I=>Du(Dt({layerType:v},I))}}),paint:k=>Ja({layer:s,key:k.key,value:k.value,style:k.style,styleSpec:k.styleSpec,validateSpec:k.validateSpec,objectElementValidators:{"*":I=>Mu(Dt({layerType:v},I))}})}})),t}function Zi(i){const t=i.value,s=i.key,h=yr(t);return h!=="string"?[new ct(s,t,`string expected, ${h} found`)]:[]}const Ys={promoteId:function({key:i,value:t}){if(yr(t)==="string")return Zi({key:i,value:t});{const s=[];for(const h in t)s.push(...Zi({key:`${i}.${h}`,value:t[h]}));return s}}};function mi(i){const t=i.value,s=i.key,h=i.styleSpec,d=i.style,_=i.validateSpec;if(!t.type)return[new ct(s,t,'"type" is required')];const v=Kr(t.type);let b;switch(v){case"vector":case"raster":return b=Ja({key:s,value:t,valueSpec:h[`source_${v.replace("-","_")}`],style:i.style,styleSpec:h,objectElementValidators:Ys,validateSpec:_}),b;case"raster-dem":return b=function(k){var I;const D=(I=k.sourceName)!==null&&I!==void 0?I:"",B=k.value,G=k.styleSpec,W=G.source_raster_dem,X=k.style;let ne=[];const ge=yr(B);if(B===void 0)return ne;if(ge!=="object")return ne.push(new ct("source_raster_dem",B,`object expected, ${ge} found`)),ne;const we=Kr(B.encoding)==="custom",Re=["redFactor","greenFactor","blueFactor","baseShift"],ke=k.value.encoding?`"${k.value.encoding}"`:"Default";for(const Ne in B)!we&&Re.includes(Ne)?ne.push(new ct(Ne,B[Ne],`In "${D}": "${Ne}" is only valid when "encoding" is set to "custom". ${ke} encoding found`)):W[Ne]?ne=ne.concat(k.validateSpec({key:Ne,value:B[Ne],valueSpec:W[Ne],validateSpec:k.validateSpec,style:X,styleSpec:G})):ne.push(new ct(Ne,B[Ne],`unknown property "${Ne}"`));return ne}({sourceName:s,value:t,style:i.style,styleSpec:h,validateSpec:_}),b;case"geojson":if(b=Ja({key:s,value:t,valueSpec:h.source_geojson,style:d,styleSpec:h,validateSpec:_,objectElementValidators:Ys}),t.cluster)for(const k in t.clusterProperties){const[I,D]=t.clusterProperties[k],B=typeof I=="string"?[I,["accumulated"],["get",k]]:I;b.push(...Wn({key:`${s}.${k}.map`,value:D,validateSpec:_,expressionContext:"cluster-map"})),b.push(...Wn({key:`${s}.${k}.reduce`,value:B,validateSpec:_,expressionContext:"cluster-reduce"}))}return b;case"video":return Ja({key:s,value:t,valueSpec:h.source_video,style:d,validateSpec:_,styleSpec:h});case"image":return Ja({key:s,value:t,valueSpec:h.source_image,style:d,validateSpec:_,styleSpec:h});case"canvas":return[new ct(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ks({key:`${s}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:d,validateSpec:_,styleSpec:h})}}function Js(i){const t=i.value,s=i.styleSpec,h=s.light,d=i.style;let _=[];const v=yr(t);if(t===void 0)return _;if(v!=="object")return _=_.concat([new ct("light",t,`object expected, ${v} found`)]),_;for(const b in t){const k=b.match(/^(.*)-transition$/);_=_.concat(k&&h[k[1]]&&h[k[1]].transition?i.validateSpec({key:b,value:t[b],valueSpec:s.transition,validateSpec:i.validateSpec,style:d,styleSpec:s}):h[b]?i.validateSpec({key:b,value:t[b],valueSpec:h[b],validateSpec:i.validateSpec,style:d,styleSpec:s}):[new ct(b,t[b],`unknown property "${b}"`)])}return _}function Ru(i){const t=i.value,s=i.styleSpec,h=s.terrain,d=i.style;let _=[];const v=yr(t);if(t===void 0)return _;if(v!=="object")return _=_.concat([new ct("terrain",t,`object expected, ${v} found`)]),_;for(const b in t)_=_.concat(h[b]?i.validateSpec({key:b,value:t[b],valueSpec:h[b],validateSpec:i.validateSpec,style:d,styleSpec:s}):[new ct(b,t[b],`unknown property "${b}"`)]);return _}function Ou(i){let t=[];const s=i.value,h=i.key;if(Array.isArray(s)){const d=[],_=[];for(const v in s)s[v].id&&d.includes(s[v].id)&&t.push(new ct(h,s,`all the sprites' ids must be unique, but ${s[v].id} is duplicated`)),d.push(s[v].id),s[v].url&&_.includes(s[v].url)&&t.push(new ct(h,s,`all the sprites' URLs must be unique, but ${s[v].url} is duplicated`)),_.push(s[v].url),t=t.concat(Ja({key:`${h}[${v}]`,value:s[v],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return t}return Zi({key:h,value:s})}const Bu={"*":()=>[],array:ms,boolean:function(i){const t=i.value,s=i.key,h=yr(t);return h!=="boolean"?[new ct(s,t,`boolean expected, ${h} found`)]:[]},number:Xs,color:function(i){const t=i.key,s=i.value,h=yr(s);return h!=="string"?[new ct(t,s,`color expected, ${h} found`)]:tr.parse(String(s))?[]:[new ct(t,s,`color expected, "${s}" found`)]},constants:Iu,enum:Ks,filter:gs,function:Xo,layer:Lu,object:Ja,source:mi,light:Js,terrain:Ru,string:Zi,formatted:function(i){return Zi(i).length===0?[]:Wn(i)},resolvedImage:function(i){return Zi(i).length===0?[]:Wn(i)},padding:function(i){const t=i.key,s=i.value;if(yr(s)==="array"){if(s.length<1||s.length>4)return[new ct(t,s,`padding requires 1 to 4 values; ${s.length} values found`)];const h={type:"number"};let d=[];for(let _=0;_<s.length;_++)d=d.concat(i.validateSpec({key:`${t}[${_}]`,value:s[_],validateSpec:i.validateSpec,valueSpec:h}));return d}return Xs({key:t,value:s,valueSpec:{}})},variableAnchorOffsetCollection:function(i){const t=i.key,s=i.value,h=yr(s),d=i.styleSpec;if(h!=="array"||s.length<1||s.length%2!=0)return[new ct(t,s,"variableAnchorOffsetCollection requires a non-empty array of even length")];let _=[];for(let v=0;v<s.length;v+=2)_=_.concat(Ks({key:`${t}[${v}]`,value:s[v],valueSpec:d.layout_symbol["text-anchor"]})),_=_.concat(ms({key:`${t}[${v+1}]`,value:s[v+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:d}));return _},sprite:Ou};function un(i){const t=i.value,s=i.valueSpec,h=i.styleSpec;return i.validateSpec=un,s.expression&&Gr(Kr(t))?Xo(i):s.expression&&jo(qn(t))?Wn(i):s.type&&Bu[s.type]?Bu[s.type](i):Ja(Dt({},i,{valueSpec:s.type?h[s.type]:s}))}function zu(i){const t=i.value,s=i.key,h=Zi(i);return h.length||(t.indexOf("{fontstack}")===-1&&h.push(new ct(s,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&h.push(new ct(s,t,'"glyphs" url must include a "{range}" token'))),h}function Fi(i,t=Xe){let s=[];return s=s.concat(un({key:"",value:i,valueSpec:t.$root,styleSpec:t,style:i,validateSpec:un,objectElementValidators:{glyphs:zu,"*":()=>[]}})),i.constants&&(s=s.concat(Iu({key:"constants",value:i.constants,style:i,styleSpec:t,validateSpec:un}))),Ko(s)}function hn(i){return function(t){return i({...t,validateSpec:un})}}function Ko(i){return[].concat(i).sort((t,s)=>t.line-s.line)}function fn(i){return function(...t){return Ko(i.apply(this,t))}}Fi.source=fn(hn(mi)),Fi.sprite=fn(hn(Ou)),Fi.glyphs=fn(hn(zu)),Fi.light=fn(hn(Js)),Fi.terrain=fn(hn(Ru)),Fi.layer=fn(hn(Lu)),Fi.filter=fn(hn(gs)),Fi.paintProperty=fn(hn(Mu)),Fi.layoutProperty=fn(hn(Du));const dn=Fi,uf=dn.light,Xl=dn.paintProperty,Nu=dn.layoutProperty;function Yo(i,t){let s=!1;if(t&&t.length)for(const h of t)i.fire(new gr(new Error(h.message))),s=!0;return s}class xs{constructor(t,s,h){const d=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const v=new Int32Array(this.arrayBuffer);t=v[0],this.d=(s=v[1])+2*(h=v[2]);for(let k=0;k<this.d*this.d;k++){const I=v[3+k],D=v[3+k+1];d.push(I===D?null:v.subarray(I,D))}const b=v[3+d.length+1];this.keys=v.subarray(v[3+d.length],b),this.bboxes=v.subarray(b),this.insert=this._insertReadonly}else{this.d=s+2*h;for(let v=0;v<this.d*this.d;v++)d.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=t,this.padding=h,this.scale=s/t,this.uid=0;const _=h/s*t;this.min=-_,this.max=t+_}insert(t,s,h,d,_){this._forEachCell(s,h,d,_,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(s),this.bboxes.push(h),this.bboxes.push(d),this.bboxes.push(_)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,s,h,d,_,v){this.cells[_].push(v)}query(t,s,h,d,_){const v=this.min,b=this.max;if(t<=v&&s<=v&&b<=h&&b<=d&&!_)return Array.prototype.slice.call(this.keys);{const k=[];return this._forEachCell(t,s,h,d,this._queryCell,k,{},_),k}}_queryCell(t,s,h,d,_,v,b,k){const I=this.cells[_];if(I!==null){const D=this.keys,B=this.bboxes;for(let G=0;G<I.length;G++){const W=I[G];if(b[W]===void 0){const X=4*W;(k?k(B[X+0],B[X+1],B[X+2],B[X+3]):t<=B[X+2]&&s<=B[X+3]&&h>=B[X+0]&&d>=B[X+1])?(b[W]=!0,v.push(D[W])):b[W]=!1}}}}_forEachCell(t,s,h,d,_,v,b,k){const I=this._convertToCellCoord(t),D=this._convertToCellCoord(s),B=this._convertToCellCoord(h),G=this._convertToCellCoord(d);for(let W=I;W<=B;W++)for(let X=D;X<=G;X++){const ne=this.d*X+W;if((!k||k(this._convertFromCellCoord(W),this._convertFromCellCoord(X),this._convertFromCellCoord(W+1),this._convertFromCellCoord(X+1)))&&_.call(this,t,s,h,d,ne,v,b,k))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,s=3+this.cells.length+1+1;let h=0;for(let v=0;v<this.cells.length;v++)h+=this.cells[v].length;const d=new Int32Array(s+h+this.keys.length+this.bboxes.length);d[0]=this.extent,d[1]=this.n,d[2]=this.padding;let _=s;for(let v=0;v<t.length;v++){const b=t[v];d[3+v]=_,d.set(b,_),_+=b.length}return d[3+t.length]=_,d.set(this.keys,_),_+=this.keys.length,d[3+t.length+1]=_,d.set(this.bboxes,_),_+=this.bboxes.length,d.buffer}static serialize(t,s){const h=t.toArrayBuffer();return s&&s.push(h),{buffer:h}}static deserialize(t){return new xs(t.buffer)}}const pn={};function It(i,t,s={}){if(pn[i])throw new Error(`${i} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:i,writeable:!1}),pn[i]={klass:t,omit:s.omit||[],shallow:s.shallow||[]}}It("Object",Object),It("TransferableGridIndex",xs),It("Color",tr),It("Error",Error),It("AJAXError",vt),It("ResolvedImage",Aa),It("StylePropertyFunction",Hs),It("StyleExpression",Gl,{omit:["_evaluator"]}),It("ZoomDependentExpression",Ho),It("ZoomConstantExpression",Hl),It("CompoundExpression",Ii,{omit:["_evaluate"]});for(const i in ds)ds[i]._classRegistryKey||It(`Expression_${i}`,ds[i]);function Jo(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Pn(i,t){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob)return i;if(Jo(i)||He(i))return t&&t.push(i),i;if(ArrayBuffer.isView(i)){const s=i;return t&&t.push(s.buffer),s}if(i instanceof ImageData)return t&&t.push(i.data.buffer),i;if(Array.isArray(i)){const s=[];for(const h of i)s.push(Pn(h,t));return s}if(typeof i=="object"){const s=i.constructor,h=s._classRegistryKey;if(!h)throw new Error("can't serialize object of unregistered class");if(!pn[h])throw new Error(`${h} is not registered.`);const d=s.serialize?s.serialize(i,t):{};if(s.serialize){if(t&&d===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const _ in i){if(!i.hasOwnProperty(_)||pn[h].omit.indexOf(_)>=0)continue;const v=i[_];d[_]=pn[h].shallow.indexOf(_)>=0?v:Pn(v,t)}i instanceof Error&&(d.message=i.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return h!=="Object"&&(d.$name=h),d}throw new Error("can't serialize object of type "+typeof i)}function _s(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||Jo(i)||He(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(_s);if(typeof i=="object"){const t=i.$name||"Object";if(!pn[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:s}=pn[t];if(!s)throw new Error(`can't deserialize unregistered class ${t}`);if(s.deserialize)return s.deserialize(i);const h=Object.create(s.prototype);for(const d of Object.keys(i)){if(d==="$name")continue;const _=i[d];h[d]=pn[t].shallow.indexOf(d)>=0?_:_s(_)}return h}throw new Error("can't deserialize object of type "+typeof i)}class Uu{constructor(){this.first=!0}update(t,s){const h=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=h,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=h,!0):(this.lastFloorZoom>h?(this.lastIntegerZoom=h+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<h&&(this.lastIntegerZoom=h,this.lastIntegerZoomTime=s),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=h,!0))}}const Ct={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function Kl(i){for(const t of i)if(Jl(t.charCodeAt(0)))return!0;return!1}function Yl(i){for(const t of i)if(!hf(t.charCodeAt(0)))return!1;return!0}function hf(i){return!(Ct.Arabic(i)||Ct["Arabic Supplement"](i)||Ct["Arabic Extended-A"](i)||Ct["Arabic Presentation Forms-A"](i)||Ct["Arabic Presentation Forms-B"](i))}function Jl(i){return!(i!==746&&i!==747&&(i<4352||!(Ct["Bopomofo Extended"](i)||Ct.Bopomofo(i)||Ct["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||Ct["CJK Compatibility Ideographs"](i)||Ct["CJK Compatibility"](i)||Ct["CJK Radicals Supplement"](i)||Ct["CJK Strokes"](i)||!(!Ct["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Ct["CJK Unified Ideographs Extension A"](i)||Ct["CJK Unified Ideographs"](i)||Ct["Enclosed CJK Letters and Months"](i)||Ct["Hangul Compatibility Jamo"](i)||Ct["Hangul Jamo Extended-A"](i)||Ct["Hangul Jamo Extended-B"](i)||Ct["Hangul Jamo"](i)||Ct["Hangul Syllables"](i)||Ct.Hiragana(i)||Ct["Ideographic Description Characters"](i)||Ct.Kanbun(i)||Ct["Kangxi Radicals"](i)||Ct["Katakana Phonetic Extensions"](i)||Ct.Katakana(i)&&i!==12540||!(!Ct["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Ct["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||Ct["Unified Canadian Aboriginal Syllabics"](i)||Ct["Unified Canadian Aboriginal Syllabics Extended"](i)||Ct["Vertical Forms"](i)||Ct["Yijing Hexagram Symbols"](i)||Ct["Yi Syllables"](i)||Ct["Yi Radicals"](i))))}function Vu(i){return!(Jl(i)||function(t){return!!(Ct["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Ct["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Ct["Letterlike Symbols"](t)||Ct["Number Forms"](t)||Ct["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Ct["Control Pictures"](t)&&t!==9251||Ct["Optical Character Recognition"](t)||Ct["Enclosed Alphanumerics"](t)||Ct["Geometric Shapes"](t)||Ct["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Ct["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Ct["CJK Symbols and Punctuation"](t)||Ct.Katakana(t)||Ct["Private Use Area"](t)||Ct["CJK Compatibility Forms"](t)||Ct["Small Form Variants"](t)||Ct["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(i))}function $u(i){return i>=1424&&i<=2303||Ct["Arabic Presentation Forms-A"](i)||Ct["Arabic Presentation Forms-B"](i)}function ju(i,t){return!(!t&&$u(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||Ct.Khmer(i))}function ff(i){for(const t of i)if($u(t.charCodeAt(0)))return!0;return!1}const Ql="deferred",ec="loading",tc="loaded";let rc=null,Qa="unavailable",Mn=null;const Qs=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(Qa="error"),rc&&rc(i)};function ac(){eo.fire(new wt("pluginStateChange",{pluginStatus:Qa,pluginURL:Mn}))}const eo=new Mr,ic=function(){return Qa},Gu=function(){if(Qa!==Ql||!Mn)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Qa=ec,ac(),Mn&&Yt({url:Mn},i=>{i?Qs(i):(Qa=tc,ac())})},gi={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Qa===tc||gi.applyArabicShaping!=null,isLoading:()=>Qa===ec,setState(i){if(!nt())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Qa=i.pluginStatus,Mn=i.pluginURL},isParsed(){if(!nt())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return gi.applyArabicShaping!=null&&gi.processBidirectionalText!=null&&gi.processStyledBidirectionalText!=null},getPluginURL(){if(!nt())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Mn}};class Dr{constructor(t,s){this.zoom=t,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Uu,this.transition={})}isSupportedScript(t){return function(s,h){for(const d of s)if(!ju(d.charCodeAt(0),h))return!1;return!0}(t,gi.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,s=t-Math.floor(t),h=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*h}:{fromScale:.5,toScale:1,t:1-(1-h)*s}}}class Qo{constructor(t,s){this.property=t,this.value=s,this.expression=function(h,d){if(Gr(h))return new Hs(h,d);if(jo(h)){const _=ql(h,d);if(_.result==="error")throw new Error(_.value.map(v=>`${v.key}: ${v.message}`).join(", "));return _.value}{let _=h;return d.type==="color"&&typeof h=="string"?_=tr.parse(h):d.type!=="padding"||typeof h!="number"&&!Array.isArray(h)?d.type==="variableAnchorOffsetCollection"&&Array.isArray(h)&&(_=Qr.parse(h)):_=na.parse(h),{kind:"constant",evaluate:()=>_}}}(s===void 0?t.specification.default:s,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,s,h){return this.property.possiblyEvaluate(this,t,s,h)}}class nc{constructor(t){this.property=t,this.value=new Qo(t,void 0)}transitioned(t,s){return new qu(this.property,this.value,s,Ce({},t.transition,this.transition),t.now)}untransitioned(){return new qu(this.property,this.value,null,{},0)}}class Hu{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return Me(this._values[t].value.value)}setValue(t,s){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new nc(this._values[t].property)),this._values[t].value=new Qo(this._values[t].property,s===null?void 0:Me(s))}getTransition(t){return Me(this._values[t].transition)}setTransition(t,s){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new nc(this._values[t].property)),this._values[t].transition=Me(s)||void 0}serialize(){const t={};for(const s of Object.keys(this._values)){const h=this.getValue(s);h!==void 0&&(t[s]=h);const d=this.getTransition(s);d!==void 0&&(t[`${s}-transition`]=d)}return t}transitioned(t,s){const h=new Wu(this._properties);for(const d of Object.keys(this._values))h._values[d]=this._values[d].transitioned(t,s._values[d]);return h}untransitioned(){const t=new Wu(this._properties);for(const s of Object.keys(this._values))t._values[s]=this._values[s].untransitioned();return t}}class qu{constructor(t,s,h,d,_){this.property=t,this.value=s,this.begin=_+d.delay||0,this.end=this.begin+d.duration||0,t.specification.transition&&(d.delay||d.duration)&&(this.prior=h)}possiblyEvaluate(t,s,h){const d=t.now||0,_=this.value.possiblyEvaluate(t,s,h),v=this.prior;if(v){if(d>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(d<this.begin)return v.possiblyEvaluate(t,s,h);{const b=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(v.possiblyEvaluate(t,s,h),_,function(k){if(k<=0)return 0;if(k>=1)return 1;const I=k*k,D=I*k;return 4*(k<.5?D:3*(k-I)+D-.75)}(b))}}return _}}class Wu{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,s,h){const d=new el(this._properties);for(const _ of Object.keys(this._values))d._values[_]=this._values[_].possiblyEvaluate(t,s,h);return d}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class df{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return Me(this._values[t].value)}setValue(t,s){this._values[t]=new Qo(this._values[t].property,s===null?void 0:Me(s))}serialize(){const t={};for(const s of Object.keys(this._values)){const h=this.getValue(s);h!==void 0&&(t[s]=h)}return t}possiblyEvaluate(t,s,h){const d=new el(this._properties);for(const _ of Object.keys(this._values))d._values[_]=this._values[_].possiblyEvaluate(t,s,h);return d}}class Va{constructor(t,s,h){this.property=t,this.value=s,this.parameters=h}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,s,h,d){return this.property.evaluate(this.value,this.parameters,t,s,h,d)}}class el{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class zt{constructor(t){this.specification=t}possiblyEvaluate(t,s){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(s)}interpolate(t,s,h){const d=di[this.specification.type];return d?d(t,s,h):t}}class Gt{constructor(t,s){this.specification=t,this.overrides=s}possiblyEvaluate(t,s,h,d){return new Va(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(s,null,{},h,d)}:t.expression,s)}interpolate(t,s,h){if(t.value.kind!=="constant"||s.value.kind!=="constant")return t;if(t.value.value===void 0||s.value.value===void 0)return new Va(this,{kind:"constant",value:void 0},t.parameters);const d=di[this.specification.type];if(d){const _=d(t.value.value,s.value.value,h);return new Va(this,{kind:"constant",value:_},t.parameters)}return t}evaluate(t,s,h,d,_,v){return t.kind==="constant"?t.value:t.evaluate(s,h,d,_,v)}}class to extends Gt{possiblyEvaluate(t,s,h,d){if(t.value===void 0)return new Va(this,{kind:"constant",value:void 0},s);if(t.expression.kind==="constant"){const _=t.expression.evaluate(s,null,{},h,d),v=t.property.specification.type==="resolvedImage"&&typeof _!="string"?_.name:_,b=this._calculate(v,v,v,s);return new Va(this,{kind:"constant",value:b},s)}if(t.expression.kind==="camera"){const _=this._calculate(t.expression.evaluate({zoom:s.zoom-1}),t.expression.evaluate({zoom:s.zoom}),t.expression.evaluate({zoom:s.zoom+1}),s);return new Va(this,{kind:"constant",value:_},s)}return new Va(this,t.expression,s)}evaluate(t,s,h,d,_,v){if(t.kind==="source"){const b=t.evaluate(s,h,d,_,v);return this._calculate(b,b,b,s)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(s.zoom)-1},h,d),t.evaluate({zoom:Math.floor(s.zoom)},h,d),t.evaluate({zoom:Math.floor(s.zoom)+1},h,d),s):t.value}_calculate(t,s,h,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:t,to:s}:{from:h,to:s}}interpolate(t){return t}}class sc{constructor(t){this.specification=t}possiblyEvaluate(t,s,h,d){if(t.value!==void 0){if(t.expression.kind==="constant"){const _=t.expression.evaluate(s,null,{},h,d);return this._calculate(_,_,_,s)}return this._calculate(t.expression.evaluate(new Dr(Math.floor(s.zoom-1),s)),t.expression.evaluate(new Dr(Math.floor(s.zoom),s)),t.expression.evaluate(new Dr(Math.floor(s.zoom+1),s)),s)}}_calculate(t,s,h,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:t,to:s}:{from:h,to:s}}interpolate(t){return t}}class oc{constructor(t){this.specification=t}possiblyEvaluate(t,s,h,d){return!!t.expression.evaluate(s,null,{},h,d)}interpolate(){return!1}}class sa{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const s in t){const h=t[s];h.specification.overridable&&this.overridableProperties.push(s);const d=this.defaultPropertyValues[s]=new Qo(h,void 0),_=this.defaultTransitionablePropertyValues[s]=new nc(h);this.defaultTransitioningPropertyValues[s]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=d.possiblyEvaluate({})}}}It("DataDrivenProperty",Gt),It("DataConstantProperty",zt),It("CrossFadedDataDrivenProperty",to),It("CrossFadedProperty",sc),It("ColorRampProperty",oc);const lc="-transition";class Pi extends Mr{constructor(t,s){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),s.layout&&(this._unevaluatedLayout=new df(s.layout)),s.paint)){this._transitionablePaint=new Hu(s.paint);for(const h in t.paint)this.setPaintProperty(h,t.paint[h],{validate:!1});for(const h in t.layout)this.setLayoutProperty(h,t.layout[h],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new el(s.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,s,h={}){s!=null&&this._validate(Nu,`layers.${this.id}.layout.${t}`,t,s,h)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,s):this.visibility=s)}getPaintProperty(t){return t.endsWith(lc)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,s,h={}){if(s!=null&&this._validate(Xl,`layers.${this.id}.paint.${t}`,t,s,h))return!1;if(t.endsWith(lc))return this._transitionablePaint.setTransition(t.slice(0,-11),s||void 0),!1;{const d=this._transitionablePaint._values[t],_=d.property.specification["property-type"]==="cross-faded-data-driven",v=d.value.isDataDriven(),b=d.value;this._transitionablePaint.setValue(t,s),this._handleSpecialPaintPropertyUpdate(t);const k=this._transitionablePaint._values[t].value;return k.isDataDriven()||v||_||this._handleOverridablePaintPropertyUpdate(t,b,k)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,s,h){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,s){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,s)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Oe(t,(s,h)=>!(s===void 0||h==="layout"&&!Object.keys(s).length||h==="paint"&&!Object.keys(s).length))}_validate(t,s,h,d,_={}){return(!_||_.validate!==!1)&&Yo(this,t.call(dn,{key:s,layerType:this.type,objectKey:h,value:d,styleSpec:Xe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const s=this.paint.get(t);if(s instanceof Va&&ps(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}return!1}}const Zu={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Zn{constructor(t,s){this._structArray=t,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Yr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,s){return t._trim(),s&&(t.isTransferred=!0,s.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const s=Object.create(this.prototype);return s.arrayBuffer=t.arrayBuffer,s.length=t.length,s.capacity=t.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function qr(i,t=1){let s=0,h=0;return{members:i.map(d=>{const _=Zu[d.type].BYTES_PER_ELEMENT,v=s=ys(s,Math.max(t,_)),b=d.components||1;return h=Math.max(h,_),s+=_*b,{name:d.name,type:d.type,components:b,offset:v}}),size:ys(s,Math.max(h,t)),alignment:t}}function ys(i,t){return Math.ceil(i/t)*t}class ro extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s){const h=this.length;return this.resize(h+1),this.emplace(h,t,s)}emplace(t,s,h){const d=2*t;return this.int16[d+0]=s,this.int16[d+1]=h,t}}ro.prototype.bytesPerElement=4,It("StructArrayLayout2i4",ro);class ao extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,h){const d=this.length;return this.resize(d+1),this.emplace(d,t,s,h)}emplace(t,s,h,d){const _=3*t;return this.int16[_+0]=s,this.int16[_+1]=h,this.int16[_+2]=d,t}}ao.prototype.bytesPerElement=6,It("StructArrayLayout3i6",ao);class Xn extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,h,d){const _=this.length;return this.resize(_+1),this.emplace(_,t,s,h,d)}emplace(t,s,h,d,_){const v=4*t;return this.int16[v+0]=s,this.int16[v+1]=h,this.int16[v+2]=d,this.int16[v+3]=_,t}}Xn.prototype.bytesPerElement=8,It("StructArrayLayout4i8",Xn);class cc extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,h,d,_,v){const b=this.length;return this.resize(b+1),this.emplace(b,t,s,h,d,_,v)}emplace(t,s,h,d,_,v,b){const k=6*t;return this.int16[k+0]=s,this.int16[k+1]=h,this.int16[k+2]=d,this.int16[k+3]=_,this.int16[k+4]=v,this.int16[k+5]=b,t}}cc.prototype.bytesPerElement=12,It("StructArrayLayout2i4i12",cc);class uc extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,h,d,_,v){const b=this.length;return this.resize(b+1),this.emplace(b,t,s,h,d,_,v)}emplace(t,s,h,d,_,v,b){const k=4*t,I=8*t;return this.int16[k+0]=s,this.int16[k+1]=h,this.uint8[I+4]=d,this.uint8[I+5]=_,this.uint8[I+6]=v,this.uint8[I+7]=b,t}}uc.prototype.bytesPerElement=8,It("StructArrayLayout2i4ub8",uc);class vs extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s){const h=this.length;return this.resize(h+1),this.emplace(h,t,s)}emplace(t,s,h){const d=2*t;return this.float32[d+0]=s,this.float32[d+1]=h,t}}vs.prototype.bytesPerElement=8,It("StructArrayLayout2f8",vs);class hc extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,h,d,_,v,b,k,I,D){const B=this.length;return this.resize(B+1),this.emplace(B,t,s,h,d,_,v,b,k,I,D)}emplace(t,s,h,d,_,v,b,k,I,D,B){const G=10*t;return this.uint16[G+0]=s,this.uint16[G+1]=h,this.uint16[G+2]=d,this.uint16[G+3]=_,this.uint16[G+4]=v,this.uint16[G+5]=b,this.uint16[G+6]=k,this.uint16[G+7]=I,this.uint16[G+8]=D,this.uint16[G+9]=B,t}}hc.prototype.bytesPerElement=20,It("StructArrayLayout10ui20",hc);class fc extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,h,d,_,v,b,k,I,D,B,G){const W=this.length;return this.resize(W+1),this.emplace(W,t,s,h,d,_,v,b,k,I,D,B,G)}emplace(t,s,h,d,_,v,b,k,I,D,B,G,W){const X=12*t;return this.int16[X+0]=s,this.int16[X+1]=h,this.int16[X+2]=d,this.int16[X+3]=_,this.uint16[X+4]=v,this.uint16[X+5]=b,this.uint16[X+6]=k,this.uint16[X+7]=I,this.int16[X+8]=D,this.int16[X+9]=B,this.int16[X+10]=G,this.int16[X+11]=W,t}}fc.prototype.bytesPerElement=24,It("StructArrayLayout4i4ui4i24",fc);class vr extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,h){const d=this.length;return this.resize(d+1),this.emplace(d,t,s,h)}emplace(t,s,h,d){const _=3*t;return this.float32[_+0]=s,this.float32[_+1]=h,this.float32[_+2]=d,t}}vr.prototype.bytesPerElement=12,It("StructArrayLayout3f12",vr);class g extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint32[1*t+0]=s,t}}g.prototype.bytesPerElement=4,It("StructArrayLayout1ul4",g);class r extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,h,d,_,v,b,k,I){const D=this.length;return this.resize(D+1),this.emplace(D,t,s,h,d,_,v,b,k,I)}emplace(t,s,h,d,_,v,b,k,I,D){const B=10*t,G=5*t;return this.int16[B+0]=s,this.int16[B+1]=h,this.int16[B+2]=d,this.int16[B+3]=_,this.int16[B+4]=v,this.int16[B+5]=b,this.uint32[G+3]=k,this.uint16[B+8]=I,this.uint16[B+9]=D,t}}r.prototype.bytesPerElement=20,It("StructArrayLayout6i1ul2ui20",r);class l extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,h,d,_,v){const b=this.length;return this.resize(b+1),this.emplace(b,t,s,h,d,_,v)}emplace(t,s,h,d,_,v,b){const k=6*t;return this.int16[k+0]=s,this.int16[k+1]=h,this.int16[k+2]=d,this.int16[k+3]=_,this.int16[k+4]=v,this.int16[k+5]=b,t}}l.prototype.bytesPerElement=12,It("StructArrayLayout2i2i2i12",l);class f extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,h,d,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,s,h,d,_)}emplace(t,s,h,d,_,v){const b=4*t,k=8*t;return this.float32[b+0]=s,this.float32[b+1]=h,this.float32[b+2]=d,this.int16[k+6]=_,this.int16[k+7]=v,t}}f.prototype.bytesPerElement=16,It("StructArrayLayout2f1f2i16",f);class p extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,h,d){const _=this.length;return this.resize(_+1),this.emplace(_,t,s,h,d)}emplace(t,s,h,d,_){const v=12*t,b=3*t;return this.uint8[v+0]=s,this.uint8[v+1]=h,this.float32[b+1]=d,this.float32[b+2]=_,t}}p.prototype.bytesPerElement=12,It("StructArrayLayout2ub2f12",p);class y extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,h){const d=this.length;return this.resize(d+1),this.emplace(d,t,s,h)}emplace(t,s,h,d){const _=3*t;return this.uint16[_+0]=s,this.uint16[_+1]=h,this.uint16[_+2]=d,t}}y.prototype.bytesPerElement=6,It("StructArrayLayout3ui6",y);class T extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,h,d,_,v,b,k,I,D,B,G,W,X,ne,ge,we){const Re=this.length;return this.resize(Re+1),this.emplace(Re,t,s,h,d,_,v,b,k,I,D,B,G,W,X,ne,ge,we)}emplace(t,s,h,d,_,v,b,k,I,D,B,G,W,X,ne,ge,we,Re){const ke=24*t,Ne=12*t,Ge=48*t;return this.int16[ke+0]=s,this.int16[ke+1]=h,this.uint16[ke+2]=d,this.uint16[ke+3]=_,this.uint32[Ne+2]=v,this.uint32[Ne+3]=b,this.uint32[Ne+4]=k,this.uint16[ke+10]=I,this.uint16[ke+11]=D,this.uint16[ke+12]=B,this.float32[Ne+7]=G,this.float32[Ne+8]=W,this.uint8[Ge+36]=X,this.uint8[Ge+37]=ne,this.uint8[Ge+38]=ge,this.uint32[Ne+10]=we,this.int16[ke+22]=Re,t}}T.prototype.bytesPerElement=48,It("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",T);class S extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,h,d,_,v,b,k,I,D,B,G,W,X,ne,ge,we,Re,ke,Ne,Ge,at,At,Rt,kt,Et,yt,Pt){const bt=this.length;return this.resize(bt+1),this.emplace(bt,t,s,h,d,_,v,b,k,I,D,B,G,W,X,ne,ge,we,Re,ke,Ne,Ge,at,At,Rt,kt,Et,yt,Pt)}emplace(t,s,h,d,_,v,b,k,I,D,B,G,W,X,ne,ge,we,Re,ke,Ne,Ge,at,At,Rt,kt,Et,yt,Pt,bt){const pt=32*t,$t=16*t;return this.int16[pt+0]=s,this.int16[pt+1]=h,this.int16[pt+2]=d,this.int16[pt+3]=_,this.int16[pt+4]=v,this.int16[pt+5]=b,this.int16[pt+6]=k,this.int16[pt+7]=I,this.uint16[pt+8]=D,this.uint16[pt+9]=B,this.uint16[pt+10]=G,this.uint16[pt+11]=W,this.uint16[pt+12]=X,this.uint16[pt+13]=ne,this.uint16[pt+14]=ge,this.uint16[pt+15]=we,this.uint16[pt+16]=Re,this.uint16[pt+17]=ke,this.uint16[pt+18]=Ne,this.uint16[pt+19]=Ge,this.uint16[pt+20]=at,this.uint16[pt+21]=At,this.uint16[pt+22]=Rt,this.uint32[$t+12]=kt,this.float32[$t+13]=Et,this.float32[$t+14]=yt,this.uint16[pt+30]=Pt,this.uint16[pt+31]=bt,t}}S.prototype.bytesPerElement=64,It("StructArrayLayout8i15ui1ul2f2ui64",S);class A extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.float32[1*t+0]=s,t}}A.prototype.bytesPerElement=4,It("StructArrayLayout1f4",A);class F extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,h){const d=this.length;return this.resize(d+1),this.emplace(d,t,s,h)}emplace(t,s,h,d){const _=3*t;return this.uint16[6*t+0]=s,this.float32[_+1]=h,this.float32[_+2]=d,t}}F.prototype.bytesPerElement=12,It("StructArrayLayout1ui2f12",F);class L extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,h){const d=this.length;return this.resize(d+1),this.emplace(d,t,s,h)}emplace(t,s,h,d){const _=4*t;return this.uint32[2*t+0]=s,this.uint16[_+2]=h,this.uint16[_+3]=d,t}}L.prototype.bytesPerElement=8,It("StructArrayLayout1ul2ui8",L);class R extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s){const h=this.length;return this.resize(h+1),this.emplace(h,t,s)}emplace(t,s,h){const d=2*t;return this.uint16[d+0]=s,this.uint16[d+1]=h,t}}R.prototype.bytesPerElement=4,It("StructArrayLayout2ui4",R);class q extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint16[1*t+0]=s,t}}q.prototype.bytesPerElement=2,It("StructArrayLayout1ui2",q);class oe extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,h,d){const _=this.length;return this.resize(_+1),this.emplace(_,t,s,h,d)}emplace(t,s,h,d,_){const v=4*t;return this.float32[v+0]=s,this.float32[v+1]=h,this.float32[v+2]=d,this.float32[v+3]=_,t}}oe.prototype.bytesPerElement=16,It("StructArrayLayout4f16",oe);class se extends Zn{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new M(this.anchorPointX,this.anchorPointY)}}se.prototype.size=20;class he extends r{get(t){return new se(this,t)}}It("CollisionBoxArray",he);class ie extends Zn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}ie.prototype.size=48;class Pe extends T{get(t){return new ie(this,t)}}It("PlacedSymbolArray",Pe);class $e extends Zn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}$e.prototype.size=64;class ye extends S{get(t){return new $e(this,t)}}It("SymbolInstanceArray",ye);class Le extends A{getoffsetX(t){return this.float32[1*t+0]}}It("GlyphOffsetArray",Le);class qe extends ao{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}It("SymbolLineVertexArray",qe);class We extends Zn{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}We.prototype.size=12;class tt extends F{get(t){return new We(this,t)}}It("TextAnchorOffsetArray",tt);class ht extends Zn{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ht.prototype.size=8;class ot extends L{get(t){return new ht(this,t)}}It("FeatureIndexArray",ot);class xt extends ro{}class Lt extends ro{}class ur extends ro{}class Tt extends cc{}class Ht extends uc{}class Ot extends vs{}class Ar extends hc{}class cr extends fc{}class ir extends vr{}class hr extends g{}class ea extends l{}class Pr extends p{}class Ia extends y{}class ma extends R{}const oa=qr([{name:"a_pos",components:2,type:"Int16"}],4),{members:xi}=oa;class Lr{constructor(t=[]){this.segments=t}prepareSegment(t,s,h,d){let _=this.segments[this.segments.length-1];return t>Lr.MAX_VERTEX_ARRAY_LENGTH&&ft(`Max vertices per segment is ${Lr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!_||_.vertexLength+t>Lr.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==d)&&(_={vertexOffset:s.length,primitiveOffset:h.length,vertexLength:0,primitiveLength:0},d!==void 0&&(_.sortKey=d),this.segments.push(_)),_}get(){return this.segments}destroy(){for(const t of this.segments)for(const s in t.vaos)t.vaos[s].destroy()}static simpleSegment(t,s,h,d){return new Lr([{vertexOffset:t,primitiveOffset:s,vertexLength:h,primitiveLength:d,vaos:{},sortKey:0}])}}function Xi(i,t){return 256*(i=Te(Math.floor(i),0,255))+Te(Math.floor(t),0,255)}Lr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,It("SegmentVector",Lr);const Ki=qr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Dn={exports:{}},Kn={exports:{}};Kn.exports=function(i,t){var s,h,d,_,v,b,k,I;for(h=i.length-(s=3&i.length),d=t,v=3432918353,b=461845907,I=0;I<h;)k=255&i.charCodeAt(I)|(255&i.charCodeAt(++I))<<8|(255&i.charCodeAt(++I))<<16|(255&i.charCodeAt(++I))<<24,++I,d=27492+(65535&(_=5*(65535&(d=(d^=k=(65535&(k=(k=(65535&k)*v+(((k>>>16)*v&65535)<<16)&4294967295)<<15|k>>>17))*b+(((k>>>16)*b&65535)<<16)&4294967295)<<13|d>>>19))+((5*(d>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(k=0,s){case 3:k^=(255&i.charCodeAt(I+2))<<16;case 2:k^=(255&i.charCodeAt(I+1))<<8;case 1:d^=k=(65535&(k=(k=(65535&(k^=255&i.charCodeAt(I)))*v+(((k>>>16)*v&65535)<<16)&4294967295)<<15|k>>>17))*b+(((k>>>16)*b&65535)<<16)&4294967295}return d^=i.length,d=2246822507*(65535&(d^=d>>>16))+((2246822507*(d>>>16)&65535)<<16)&4294967295,d=3266489909*(65535&(d^=d>>>13))+((3266489909*(d>>>16)&65535)<<16)&4294967295,(d^=d>>>16)>>>0};var ws=Kn.exports,Ra={exports:{}};Ra.exports=function(i,t){for(var s,h=i.length,d=t^h,_=0;h>=4;)s=1540483477*(65535&(s=255&i.charCodeAt(_)|(255&i.charCodeAt(++_))<<8|(255&i.charCodeAt(++_))<<16|(255&i.charCodeAt(++_))<<24))+((1540483477*(s>>>16)&65535)<<16),d=1540483477*(65535&d)+((1540483477*(d>>>16)&65535)<<16)^(s=1540483477*(65535&(s^=s>>>24))+((1540483477*(s>>>16)&65535)<<16)),h-=4,++_;switch(h){case 3:d^=(255&i.charCodeAt(_+2))<<16;case 2:d^=(255&i.charCodeAt(_+1))<<8;case 1:d=1540483477*(65535&(d^=255&i.charCodeAt(_)))+((1540483477*(d>>>16)&65535)<<16)}return d=1540483477*(65535&(d^=d>>>13))+((1540483477*(d>>>16)&65535)<<16),(d^=d>>>15)>>>0};var Fa=ws,$a=Ra.exports;Dn.exports=Fa,Dn.exports.murmur3=Fa,Dn.exports.murmur2=$a;var Yn=w(Dn.exports);class ta{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,s,h,d){this.ids.push(ga(t)),this.positions.push(s,h,d)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const s=ga(t);let h=0,d=this.ids.length-1;for(;h<d;){const v=h+d>>1;this.ids[v]>=s?d=v:h=v+1}const _=[];for(;this.ids[h]===s;)_.push({index:this.positions[3*h],start:this.positions[3*h+1],end:this.positions[3*h+2]}),h++;return _}static serialize(t,s){const h=new Float64Array(t.ids),d=new Uint32Array(t.positions);return ei(h,d,0,h.length-1),s&&s.push(h.buffer,d.buffer),{ids:h,positions:d}}static deserialize(t){const s=new ta;return s.ids=t.ids,s.positions=t.positions,s.indexed=!0,s}}function ga(i){const t=+i;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Yn(String(i))}function ei(i,t,s,h){for(;s<h;){const d=i[s+h>>1];let _=s-1,v=h+1;for(;;){do _++;while(i[_]<d);do v--;while(i[v]>d);if(_>=v)break;ra(i,_,v),ra(t,3*_,3*v),ra(t,3*_+1,3*v+1),ra(t,3*_+2,3*v+2)}v-s<h-v?(ei(i,t,s,v),s=v+1):(ei(i,t,v+1,h),h=v)}}function ra(i,t,s){const h=i[t];i[t]=i[s],i[s]=h}It("FeaturePositionMap",ta);class Jn{constructor(t,s){this.gl=t.gl,this.location=s}}class tl extends Jn{constructor(t,s){super(t,s),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Xu extends Jn{constructor(t,s){super(t,s),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Ku extends Jn{constructor(t,s){super(t,s),this.current=tr.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const pf=new Float32Array(16);function dc(i){return[Xi(255*i.r,255*i.g),Xi(255*i.b,255*i.a)]}class Yi{constructor(t,s,h){this.value=t,this.uniformNames=s.map(d=>`u_${d}`),this.type=h}setUniform(t,s,h){t.set(h.constantOr(this.value))}getBinding(t,s,h){return this.type==="color"?new Ku(t,s):new tl(t,s)}}class Qn{constructor(t,s){this.uniformNames=s.map(h=>`u_${h}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=s.tlbr,this.patternTo=t.tlbr}setUniform(t,s,h,d){const _=d==="u_pattern_to"?this.patternTo:d==="u_pattern_from"?this.patternFrom:d==="u_pixel_ratio_to"?this.pixelRatioTo:d==="u_pixel_ratio_from"?this.pixelRatioFrom:null;_&&t.set(_)}getBinding(t,s,h){return h.substr(0,9)==="u_pattern"?new Xu(t,s):new tl(t,s)}}class Ji{constructor(t,s,h,d){this.expression=t,this.type=h,this.maxValue=0,this.paintVertexAttributes=s.map(_=>({name:`a_${_}`,type:"Float32",components:h==="color"?2:1,offset:0})),this.paintVertexArray=new d}populatePaintArray(t,s,h,d,_){const v=this.paintVertexArray.length,b=this.expression.evaluate(new Dr(0),s,{},d,[],_);this.paintVertexArray.resize(t),this._setPaintValue(v,t,b)}updatePaintArray(t,s,h,d){const _=this.expression.evaluate({zoom:0},h,d);this._setPaintValue(t,s,_)}_setPaintValue(t,s,h){if(this.type==="color"){const d=dc(h);for(let _=t;_<s;_++)this.paintVertexArray.emplace(_,d[0],d[1])}else{for(let d=t;d<s;d++)this.paintVertexArray.emplace(d,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Mi{constructor(t,s,h,d,_,v){this.expression=t,this.uniformNames=s.map(b=>`u_${b}_t`),this.type=h,this.useIntegerZoom=d,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=s.map(b=>({name:`a_${b}`,type:"Float32",components:h==="color"?4:2,offset:0})),this.paintVertexArray=new v}populatePaintArray(t,s,h,d,_){const v=this.expression.evaluate(new Dr(this.zoom),s,{},d,[],_),b=this.expression.evaluate(new Dr(this.zoom+1),s,{},d,[],_),k=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(k,t,v,b)}updatePaintArray(t,s,h,d){const _=this.expression.evaluate({zoom:this.zoom},h,d),v=this.expression.evaluate({zoom:this.zoom+1},h,d);this._setPaintValue(t,s,_,v)}_setPaintValue(t,s,h,d){if(this.type==="color"){const _=dc(h),v=dc(d);for(let b=t;b<s;b++)this.paintVertexArray.emplace(b,_[0],_[1],v[0],v[1])}else{for(let _=t;_<s;_++)this.paintVertexArray.emplace(_,h,d);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(d))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,s){const h=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,d=Te(this.expression.interpolationFactor(h,this.zoom,this.zoom+1),0,1);t.set(d)}getBinding(t,s,h){return new tl(t,s)}}class Qi{constructor(t,s,h,d,_,v){this.expression=t,this.type=s,this.useIntegerZoom=h,this.zoom=d,this.layerId=v,this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(t,s,h){const d=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(d,t,s.patterns&&s.patterns[this.layerId],h)}updatePaintArray(t,s,h,d,_){this._setPaintValues(t,s,h.patterns&&h.patterns[this.layerId],_)}_setPaintValues(t,s,h,d){if(!d||!h)return;const{min:_,mid:v,max:b}=h,k=d[_],I=d[v],D=d[b];if(k&&I&&D)for(let B=t;B<s;B++)this.zoomInPaintVertexArray.emplace(B,I.tl[0],I.tl[1],I.br[0],I.br[1],k.tl[0],k.tl[1],k.br[0],k.br[1],I.pixelRatio,k.pixelRatio),this.zoomOutPaintVertexArray.emplace(B,I.tl[0],I.tl[1],I.br[0],I.br[1],D.tl[0],D.tl[1],D.br[0],D.br[1],I.pixelRatio,D.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Ki.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Ki.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class pc{constructor(t,s,h){this.binders={},this._buffers=[];const d=[];for(const _ in t.paint._values){if(!h(_))continue;const v=t.paint.get(_);if(!(v instanceof Va&&ps(v.property.specification)))continue;const b=Nx(_,t.type),k=v.value,I=v.property.specification.type,D=v.property.useIntegerZoom,B=v.property.specification["property-type"],G=B==="cross-faded"||B==="cross-faded-data-driven";if(k.kind==="constant")this.binders[_]=G?new Qn(k.value,b):new Yi(k.value,b,I),d.push(`/u_${_}`);else if(k.kind==="source"||G){const W=yd(_,I,"source");this.binders[_]=G?new Qi(k,I,D,s,W,t.id):new Ji(k,b,I,W),d.push(`/a_${_}`)}else{const W=yd(_,I,"composite");this.binders[_]=new Mi(k,b,I,D,s,W),d.push(`/z_${_}`)}}this.cacheKey=d.sort().join("")}getMaxValue(t){const s=this.binders[t];return s instanceof Ji||s instanceof Mi?s.maxValue:0}populatePaintArrays(t,s,h,d,_){for(const v in this.binders){const b=this.binders[v];(b instanceof Ji||b instanceof Mi||b instanceof Qi)&&b.populatePaintArray(t,s,h,d,_)}}setConstantPatternPositions(t,s){for(const h in this.binders){const d=this.binders[h];d instanceof Qn&&d.setConstantPatternPositions(t,s)}}updatePaintArrays(t,s,h,d,_){let v=!1;for(const b in t){const k=s.getPositions(b);for(const I of k){const D=h.feature(I.index);for(const B in this.binders){const G=this.binders[B];if((G instanceof Ji||G instanceof Mi||G instanceof Qi)&&G.expression.isStateDependent===!0){const W=d.paint.get(B);G.expression=W.value,G.updatePaintArray(I.start,I.end,D,t[b],_),v=!0}}}}return v}defines(){const t=[];for(const s in this.binders){const h=this.binders[s];(h instanceof Yi||h instanceof Qn)&&t.push(...h.uniformNames.map(d=>`#define HAS_UNIFORM_${d}`))}return t}getBinderAttributes(){const t=[];for(const s in this.binders){const h=this.binders[s];if(h instanceof Ji||h instanceof Mi)for(let d=0;d<h.paintVertexAttributes.length;d++)t.push(h.paintVertexAttributes[d].name);else if(h instanceof Qi)for(let d=0;d<Ki.members.length;d++)t.push(Ki.members[d].name)}return t}getBinderUniforms(){const t=[];for(const s in this.binders){const h=this.binders[s];if(h instanceof Yi||h instanceof Qn||h instanceof Mi)for(const d of h.uniformNames)t.push(d)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,s){const h=[];for(const d in this.binders){const _=this.binders[d];if(_ instanceof Yi||_ instanceof Qn||_ instanceof Mi){for(const v of _.uniformNames)if(s[v]){const b=_.getBinding(t,s[v],v);h.push({name:v,property:d,binding:b})}}}return h}setUniforms(t,s,h,d){for(const{name:_,property:v,binding:b}of s)this.binders[v].setUniform(b,d,h.get(v),_)}updatePaintBuffers(t){this._buffers=[];for(const s in this.binders){const h=this.binders[s];if(t&&h instanceof Qi){const d=t.fromScale===2?h.zoomInPaintVertexBuffer:h.zoomOutPaintVertexBuffer;d&&this._buffers.push(d)}else(h instanceof Ji||h instanceof Mi)&&h.paintVertexBuffer&&this._buffers.push(h.paintVertexBuffer)}}upload(t){for(const s in this.binders){const h=this.binders[s];(h instanceof Ji||h instanceof Mi||h instanceof Qi)&&h.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const s=this.binders[t];(s instanceof Ji||s instanceof Mi||s instanceof Qi)&&s.destroy()}}}class mn{constructor(t,s,h=()=>!0){this.programConfigurations={};for(const d of t)this.programConfigurations[d.id]=new pc(d,s,h);this.needsUpload=!1,this._featureMap=new ta,this._bufferOffset=0}populatePaintArrays(t,s,h,d,_,v){for(const b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(t,s,d,_,v);s.id!==void 0&&this._featureMap.add(s.id,h,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,s,h,d){for(const _ of h)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(t,this._featureMap,s,_,d)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function Nx(i,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${t}-`,"").replace(/-/g,"_")]}function yd(i,t,s){const h={color:{source:vs,composite:oe},number:{source:A,composite:vs}},d=function(_){return{"line-pattern":{source:Ar,composite:Ar},"fill-pattern":{source:Ar,composite:Ar},"fill-extrusion-pattern":{source:Ar,composite:Ar}}[_]}(i);return d&&d[s]||h[t][s]}It("ConstantBinder",Yi),It("CrossFadedConstantBinder",Qn),It("SourceExpressionBinder",Ji),It("CrossFadedCompositeBinder",Qi),It("CompositeExpressionBinder",Mi),It("ProgramConfiguration",pc,{omit:["_buffers"]}),It("ProgramConfigurationSet",mn);const ua=8192,mf=Math.pow(2,14)-1,vd=-mf-1;function io(i){const t=ua/i.extent,s=i.loadGeometry();for(let h=0;h<s.length;h++){const d=s[h];for(let _=0;_<d.length;_++){const v=d[_],b=Math.round(v.x*t),k=Math.round(v.y*t);v.x=Te(b,vd,mf),v.y=Te(k,vd,mf),(b<v.x||b>v.x+1||k<v.y||k>v.y+1)&&ft("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return s}function no(i,t){return{type:i.type,id:i.id,properties:i.properties,geometry:t?io(i):[]}}function Yu(i,t,s,h,d){i.emplaceBack(2*t+(h+1)/2,2*s+(d+1)/2)}class gf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Lt,this.indexArray=new Ia,this.segments=new Lr,this.programConfigurations=new mn(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,h){const d=this.layers[0],_=[];let v=null,b=!1;d.type==="circle"&&(v=d.layout.get("circle-sort-key"),b=!v.isConstant());for(const{feature:k,id:I,index:D,sourceLayerIndex:B}of t){const G=this.layers[0]._featureFilter.needGeometry,W=no(k,G);if(!this.layers[0]._featureFilter.filter(new Dr(this.zoom),W,h))continue;const X=b?v.evaluate(W,{},h):void 0,ne={id:I,properties:k.properties,type:k.type,sourceLayerIndex:B,index:D,geometry:G?W.geometry:io(k),patterns:{},sortKey:X};_.push(ne)}b&&_.sort((k,I)=>k.sortKey-I.sortKey);for(const k of _){const{geometry:I,index:D,sourceLayerIndex:B}=k,G=t[D].feature;this.addFeature(k,I,D,h),s.featureIndex.insert(G,I,D,B,this.index)}}update(t,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,xi),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,s,h,d){for(const _ of s)for(const v of _){const b=v.x,k=v.y;if(b<0||b>=ua||k<0||k>=ua)continue;const I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),D=I.vertexLength;Yu(this.layoutVertexArray,b,k,-1,-1),Yu(this.layoutVertexArray,b,k,1,-1),Yu(this.layoutVertexArray,b,k,1,1),Yu(this.layoutVertexArray,b,k,-1,1),this.indexArray.emplaceBack(D,D+1,D+2),this.indexArray.emplaceBack(D,D+3,D+2),I.vertexLength+=4,I.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,h,{},d)}}function wd(i,t){for(let s=0;s<i.length;s++)if(rl(t,i[s]))return!0;for(let s=0;s<t.length;s++)if(rl(i,t[s]))return!0;return!!xf(i,t)}function Ux(i,t,s){return!!rl(i,t)||!!_f(t,i,s)}function bd(i,t){if(i.length===1)return Ed(t,i[0]);for(let s=0;s<t.length;s++){const h=t[s];for(let d=0;d<h.length;d++)if(rl(i,h[d]))return!0}for(let s=0;s<i.length;s++)if(Ed(t,i[s]))return!0;for(let s=0;s<t.length;s++)if(xf(i,t[s]))return!0;return!1}function Vx(i,t,s){if(i.length>1){if(xf(i,t))return!0;for(let h=0;h<t.length;h++)if(_f(t[h],i,s))return!0}for(let h=0;h<i.length;h++)if(_f(i[h],t,s))return!0;return!1}function xf(i,t){if(i.length===0||t.length===0)return!1;for(let s=0;s<i.length-1;s++){const h=i[s],d=i[s+1];for(let _=0;_<t.length-1;_++)if($x(h,d,t[_],t[_+1]))return!0}return!1}function $x(i,t,s,h){return lt(i,s,h)!==lt(t,s,h)&&lt(i,t,s)!==lt(i,t,h)}function _f(i,t,s){const h=s*s;if(t.length===1)return i.distSqr(t[0])<h;for(let d=1;d<t.length;d++)if(Td(i,t[d-1],t[d])<h)return!0;return!1}function Td(i,t,s){const h=t.distSqr(s);if(h===0)return i.distSqr(t);const d=((i.x-t.x)*(s.x-t.x)+(i.y-t.y)*(s.y-t.y))/h;return i.distSqr(d<0?t:d>1?s:s.sub(t)._mult(d)._add(t))}function Ed(i,t){let s,h,d,_=!1;for(let v=0;v<i.length;v++){s=i[v];for(let b=0,k=s.length-1;b<s.length;k=b++)h=s[b],d=s[k],h.y>t.y!=d.y>t.y&&t.x<(d.x-h.x)*(t.y-h.y)/(d.y-h.y)+h.x&&(_=!_)}return _}function rl(i,t){let s=!1;for(let h=0,d=i.length-1;h<i.length;d=h++){const _=i[h],v=i[d];_.y>t.y!=v.y>t.y&&t.x<(v.x-_.x)*(t.y-_.y)/(v.y-_.y)+_.x&&(s=!s)}return s}function jx(i,t,s){const h=s[0],d=s[2];if(i.x<h.x&&t.x<h.x||i.x>d.x&&t.x>d.x||i.y<h.y&&t.y<h.y||i.y>d.y&&t.y>d.y)return!1;const _=lt(i,t,s[0]);return _!==lt(i,t,s[1])||_!==lt(i,t,s[2])||_!==lt(i,t,s[3])}function mc(i,t,s){const h=t.paint.get(i).value;return h.kind==="constant"?h.value:s.programConfigurations.get(t.id).getMaxValue(i)}function Ju(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Qu(i,t,s,h,d){if(!t[0]&&!t[1])return i;const _=M.convert(t)._mult(d);s==="viewport"&&_._rotate(-h);const v=[];for(let b=0;b<i.length;b++)v.push(i[b].sub(_));return v}let Sd,kd;It("CircleBucket",gf,{omit:["layers"]});var Gx={get paint(){return kd=kd||new sa({"circle-radius":new Gt(Xe.paint_circle["circle-radius"]),"circle-color":new Gt(Xe.paint_circle["circle-color"]),"circle-blur":new Gt(Xe.paint_circle["circle-blur"]),"circle-opacity":new Gt(Xe.paint_circle["circle-opacity"]),"circle-translate":new zt(Xe.paint_circle["circle-translate"]),"circle-translate-anchor":new zt(Xe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new zt(Xe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new zt(Xe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Gt(Xe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Gt(Xe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Gt(Xe.paint_circle["circle-stroke-opacity"])})},get layout(){return Sd=Sd||new sa({"circle-sort-key":new Gt(Xe.layout_circle["circle-sort-key"])})}},ti=1e-6,al=typeof Float32Array<"u"?Float32Array:Array;function yf(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Cd(i,t,s){var h=t[0],d=t[1],_=t[2],v=t[3],b=t[4],k=t[5],I=t[6],D=t[7],B=t[8],G=t[9],W=t[10],X=t[11],ne=t[12],ge=t[13],we=t[14],Re=t[15],ke=s[0],Ne=s[1],Ge=s[2],at=s[3];return i[0]=ke*h+Ne*b+Ge*B+at*ne,i[1]=ke*d+Ne*k+Ge*G+at*ge,i[2]=ke*_+Ne*I+Ge*W+at*we,i[3]=ke*v+Ne*D+Ge*X+at*Re,i[4]=(ke=s[4])*h+(Ne=s[5])*b+(Ge=s[6])*B+(at=s[7])*ne,i[5]=ke*d+Ne*k+Ge*G+at*ge,i[6]=ke*_+Ne*I+Ge*W+at*we,i[7]=ke*v+Ne*D+Ge*X+at*Re,i[8]=(ke=s[8])*h+(Ne=s[9])*b+(Ge=s[10])*B+(at=s[11])*ne,i[9]=ke*d+Ne*k+Ge*G+at*ge,i[10]=ke*_+Ne*I+Ge*W+at*we,i[11]=ke*v+Ne*D+Ge*X+at*Re,i[12]=(ke=s[12])*h+(Ne=s[13])*b+(Ge=s[14])*B+(at=s[15])*ne,i[13]=ke*d+Ne*k+Ge*G+at*ge,i[14]=ke*_+Ne*I+Ge*W+at*we,i[15]=ke*v+Ne*D+Ge*X+at*Re,i}Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)});var gc,Hx=Cd;function eh(i,t,s){var h=t[0],d=t[1],_=t[2],v=t[3];return i[0]=s[0]*h+s[4]*d+s[8]*_+s[12]*v,i[1]=s[1]*h+s[5]*d+s[9]*_+s[13]*v,i[2]=s[2]*h+s[6]*d+s[10]*_+s[14]*v,i[3]=s[3]*h+s[7]*d+s[11]*_+s[15]*v,i}gc=new al(4),al!=Float32Array&&(gc[0]=0,gc[1]=0,gc[2]=0,gc[3]=0);class qx extends Pi{constructor(t){super(t,Gx)}createBucket(t){return new gf(t)}queryRadius(t){const s=t;return mc("circle-radius",this,s)+mc("circle-stroke-width",this,s)+Ju(this.paint.get("circle-translate"))}queryIntersectsFeature(t,s,h,d,_,v,b,k){const I=Qu(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),v.angle,b),D=this.paint.get("circle-radius").evaluate(s,h)+this.paint.get("circle-stroke-width").evaluate(s,h),B=this.paint.get("circle-pitch-alignment")==="map",G=B?I:function(X,ne){return X.map(ge=>Ad(ge,ne))}(I,k),W=B?D*b:D;for(const X of d)for(const ne of X){const ge=B?ne:Ad(ne,k);let we=W;const Re=eh([],[ne.x,ne.y,0,1],k);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?we*=Re[3]/v.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(we*=v.cameraToCenterDistance/Re[3]),Ux(G,ge,we))return!0}return!1}}function Ad(i,t){const s=eh([],[i.x,i.y,0,1],t);return new M(s[0]/s[3],s[1]/s[3])}class Id extends gf{}let Fd;It("HeatmapBucket",Id,{omit:["layers"]});var Wx={get paint(){return Fd=Fd||new sa({"heatmap-radius":new Gt(Xe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Gt(Xe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new zt(Xe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new oc(Xe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new zt(Xe.paint_heatmap["heatmap-opacity"])})}};function vf(i,{width:t,height:s},h,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==t*s*h)throw new RangeError(`mismatched image size. expected: ${d.length} but got: ${t*s*h}`)}else d=new Uint8Array(t*s*h);return i.width=t,i.height=s,i.data=d,i}function Pd(i,{width:t,height:s},h){if(t===i.width&&s===i.height)return;const d=vf({},{width:t,height:s},h);wf(i,d,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,t),height:Math.min(i.height,s)},h),i.width=t,i.height=s,i.data=d.data}function wf(i,t,s,h,d,_){if(d.width===0||d.height===0)return t;if(d.width>i.width||d.height>i.height||s.x>i.width-d.width||s.y>i.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>t.width||d.height>t.height||h.x>t.width-d.width||h.y>t.height-d.height)throw new RangeError("out of range destination coordinates for image copy");const v=i.data,b=t.data;if(v===b)throw new Error("srcData equals dstData, so image is already copied");for(let k=0;k<d.height;k++){const I=((s.y+k)*i.width+s.x)*_,D=((h.y+k)*t.width+h.x)*_;for(let B=0;B<d.width*_;B++)b[D+B]=v[I+B]}return t}class xc{constructor(t,s){vf(this,t,1,s)}resize(t){Pd(this,t,1)}clone(){return new xc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,s,h,d,_){wf(t,s,h,d,_,1)}}class Oi{constructor(t,s){vf(this,t,4,s)}resize(t){Pd(this,t,4)}replace(t,s){s?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Oi({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,s,h,d,_){wf(t,s,h,d,_,4)}}function Md(i){const t={},s=i.resolution||256,h=i.clips?i.clips.length:1,d=i.image||new Oi({width:s,height:h});if(Math.log(s)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${s}`);const _=(v,b,k)=>{t[i.evaluationKey]=k;const I=i.expression.evaluate(t);d.data[v+b+0]=Math.floor(255*I.r/I.a),d.data[v+b+1]=Math.floor(255*I.g/I.a),d.data[v+b+2]=Math.floor(255*I.b/I.a),d.data[v+b+3]=Math.floor(255*I.a)};if(i.clips)for(let v=0,b=0;v<h;++v,b+=4*s)for(let k=0,I=0;k<s;k++,I+=4){const D=k/(s-1),{start:B,end:G}=i.clips[v];_(b,I,B*(1-D)+G*D)}else for(let v=0,b=0;v<s;v++,b+=4)_(0,b,v/(s-1));return d}It("AlphaImage",xc),It("RGBAImage",Oi);class Zx extends Pi{createBucket(t){return new Id(t)}constructor(t){super(t,Wx),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Md({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Dd;var Xx={get paint(){return Dd=Dd||new sa({"hillshade-illumination-direction":new zt(Xe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new zt(Xe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new zt(Xe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new zt(Xe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new zt(Xe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new zt(Xe.paint_hillshade["hillshade-accent-color"])})}};class Kx extends Pi{constructor(t){super(t,Xx)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Yx=qr([{name:"a_pos",components:2,type:"Int16"}],4),{members:Jx}=Yx;var bf={exports:{}};function th(i,t,s){s=s||2;var h,d,_,v,b,k,I,D=t&&t.length,B=D?t[0]*s:i.length,G=Ld(i,0,B,s,!0),W=[];if(!G||G.next===G.prev)return W;if(D&&(G=function(ne,ge,we,Re){var ke,Ne,Ge,at=[];for(ke=0,Ne=ge.length;ke<Ne;ke++)(Ge=Ld(ne,ge[ke]*Re,ke<Ne-1?ge[ke+1]*Re:ne.length,Re,!1))===Ge.next&&(Ge.steiner=!0),at.push(s_(Ge));for(at.sort(a_),ke=0;ke<at.length;ke++)we=i_(at[ke],we);return we}(i,t,G,s)),i.length>80*s){h=_=i[0],d=v=i[1];for(var X=s;X<B;X+=s)(b=i[X])<h&&(h=b),(k=i[X+1])<d&&(d=k),b>_&&(_=b),k>v&&(v=k);I=(I=Math.max(_-h,v-d))!==0?32767/I:0}return _c(G,W,s,h,d,I,0),W}function Ld(i,t,s,h,d){var _,v;if(d===Sf(i,t,s,h)>0)for(_=t;_<s;_+=h)v=Bd(_,i[_],i[_+1],v);else for(_=s-h;_>=t;_-=h)v=Bd(_,i[_],i[_+1],v);return v&&rh(v,v.next)&&(vc(v),v=v.next),v}function so(i,t){if(!i)return i;t||(t=i);var s,h=i;do if(s=!1,h.steiner||!rh(h,h.next)&&la(h.prev,h,h.next)!==0)h=h.next;else{if(vc(h),(h=t=h.prev)===h.next)break;s=!0}while(s||h!==t);return t}function _c(i,t,s,h,d,_,v){if(i){!v&&_&&function(D,B,G,W){var X=D;do X.z===0&&(X.z=Tf(X.x,X.y,B,G,W)),X.prevZ=X.prev,X.nextZ=X.next,X=X.next;while(X!==D);X.prevZ.nextZ=null,X.prevZ=null,function(ne){var ge,we,Re,ke,Ne,Ge,at,At,Rt=1;do{for(we=ne,ne=null,Ne=null,Ge=0;we;){for(Ge++,Re=we,at=0,ge=0;ge<Rt&&(at++,Re=Re.nextZ);ge++);for(At=Rt;at>0||At>0&&Re;)at!==0&&(At===0||!Re||we.z<=Re.z)?(ke=we,we=we.nextZ,at--):(ke=Re,Re=Re.nextZ,At--),Ne?Ne.nextZ=ke:ne=ke,ke.prevZ=Ne,Ne=ke;we=Re}Ne.nextZ=null,Rt*=2}while(Ge>1)}(X)}(i,h,d,_);for(var b,k,I=i;i.prev!==i.next;)if(b=i.prev,k=i.next,_?e_(i,h,d,_):Qx(i))t.push(b.i/s|0),t.push(i.i/s|0),t.push(k.i/s|0),vc(i),i=k.next,I=k.next;else if((i=k)===I){v?v===1?_c(i=t_(so(i),t,s),t,s,h,d,_,2):v===2&&r_(i,t,s,h,d,_):_c(so(i),t,s,h,d,_,1);break}}}function Qx(i){var t=i.prev,s=i,h=i.next;if(la(t,s,h)>=0)return!1;for(var d=t.x,_=s.x,v=h.x,b=t.y,k=s.y,I=h.y,D=d<_?d<v?d:v:_<v?_:v,B=b<k?b<I?b:I:k<I?k:I,G=d>_?d>v?d:v:_>v?_:v,W=b>k?b>I?b:I:k>I?k:I,X=h.next;X!==t;){if(X.x>=D&&X.x<=G&&X.y>=B&&X.y<=W&&il(d,b,_,k,v,I,X.x,X.y)&&la(X.prev,X,X.next)>=0)return!1;X=X.next}return!0}function e_(i,t,s,h){var d=i.prev,_=i,v=i.next;if(la(d,_,v)>=0)return!1;for(var b=d.x,k=_.x,I=v.x,D=d.y,B=_.y,G=v.y,W=b<k?b<I?b:I:k<I?k:I,X=D<B?D<G?D:G:B<G?B:G,ne=b>k?b>I?b:I:k>I?k:I,ge=D>B?D>G?D:G:B>G?B:G,we=Tf(W,X,t,s,h),Re=Tf(ne,ge,t,s,h),ke=i.prevZ,Ne=i.nextZ;ke&&ke.z>=we&&Ne&&Ne.z<=Re;){if(ke.x>=W&&ke.x<=ne&&ke.y>=X&&ke.y<=ge&&ke!==d&&ke!==v&&il(b,D,k,B,I,G,ke.x,ke.y)&&la(ke.prev,ke,ke.next)>=0||(ke=ke.prevZ,Ne.x>=W&&Ne.x<=ne&&Ne.y>=X&&Ne.y<=ge&&Ne!==d&&Ne!==v&&il(b,D,k,B,I,G,Ne.x,Ne.y)&&la(Ne.prev,Ne,Ne.next)>=0))return!1;Ne=Ne.nextZ}for(;ke&&ke.z>=we;){if(ke.x>=W&&ke.x<=ne&&ke.y>=X&&ke.y<=ge&&ke!==d&&ke!==v&&il(b,D,k,B,I,G,ke.x,ke.y)&&la(ke.prev,ke,ke.next)>=0)return!1;ke=ke.prevZ}for(;Ne&&Ne.z<=Re;){if(Ne.x>=W&&Ne.x<=ne&&Ne.y>=X&&Ne.y<=ge&&Ne!==d&&Ne!==v&&il(b,D,k,B,I,G,Ne.x,Ne.y)&&la(Ne.prev,Ne,Ne.next)>=0)return!1;Ne=Ne.nextZ}return!0}function t_(i,t,s){var h=i;do{var d=h.prev,_=h.next.next;!rh(d,_)&&Rd(d,h,h.next,_)&&yc(d,_)&&yc(_,d)&&(t.push(d.i/s|0),t.push(h.i/s|0),t.push(_.i/s|0),vc(h),vc(h.next),h=i=_),h=h.next}while(h!==i);return so(h)}function r_(i,t,s,h,d,_){var v=i;do{for(var b=v.next.next;b!==v.prev;){if(v.i!==b.i&&o_(v,b)){var k=Od(v,b);return v=so(v,v.next),k=so(k,k.next),_c(v,t,s,h,d,_,0),void _c(k,t,s,h,d,_,0)}b=b.next}v=v.next}while(v!==i)}function a_(i,t){return i.x-t.x}function i_(i,t){var s=function(d,_){var v,b=_,k=d.x,I=d.y,D=-1/0;do{if(I<=b.y&&I>=b.next.y&&b.next.y!==b.y){var B=b.x+(I-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(B<=k&&B>D&&(D=B,v=b.x<b.next.x?b:b.next,B===k))return v}b=b.next}while(b!==_);if(!v)return null;var G,W=v,X=v.x,ne=v.y,ge=1/0;b=v;do k>=b.x&&b.x>=X&&k!==b.x&&il(I<ne?k:D,I,X,ne,I<ne?D:k,I,b.x,b.y)&&(G=Math.abs(I-b.y)/(k-b.x),yc(b,d)&&(G<ge||G===ge&&(b.x>v.x||b.x===v.x&&n_(v,b)))&&(v=b,ge=G)),b=b.next;while(b!==W);return v}(i,t);if(!s)return t;var h=Od(s,i);return so(h,h.next),so(s,s.next)}function n_(i,t){return la(i.prev,i,t.prev)<0&&la(t.next,i,i.next)<0}function Tf(i,t,s,h,d){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-s)*d|0)|i<<8))|i<<4))|i<<2))|i<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-h)*d|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function s_(i){var t=i,s=i;do(t.x<s.x||t.x===s.x&&t.y<s.y)&&(s=t),t=t.next;while(t!==i);return s}function il(i,t,s,h,d,_,v,b){return(d-v)*(t-b)>=(i-v)*(_-b)&&(i-v)*(h-b)>=(s-v)*(t-b)&&(s-v)*(_-b)>=(d-v)*(h-b)}function o_(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!function(s,h){var d=s;do{if(d.i!==s.i&&d.next.i!==s.i&&d.i!==h.i&&d.next.i!==h.i&&Rd(d,d.next,s,h))return!0;d=d.next}while(d!==s);return!1}(i,t)&&(yc(i,t)&&yc(t,i)&&function(s,h){var d=s,_=!1,v=(s.x+h.x)/2,b=(s.y+h.y)/2;do d.y>b!=d.next.y>b&&d.next.y!==d.y&&v<(d.next.x-d.x)*(b-d.y)/(d.next.y-d.y)+d.x&&(_=!_),d=d.next;while(d!==s);return _}(i,t)&&(la(i.prev,i,t.prev)||la(i,t.prev,t))||rh(i,t)&&la(i.prev,i,i.next)>0&&la(t.prev,t,t.next)>0)}function la(i,t,s){return(t.y-i.y)*(s.x-t.x)-(t.x-i.x)*(s.y-t.y)}function rh(i,t){return i.x===t.x&&i.y===t.y}function Rd(i,t,s,h){var d=ih(la(i,t,s)),_=ih(la(i,t,h)),v=ih(la(s,h,i)),b=ih(la(s,h,t));return d!==_&&v!==b||!(d!==0||!ah(i,s,t))||!(_!==0||!ah(i,h,t))||!(v!==0||!ah(s,i,h))||!(b!==0||!ah(s,t,h))}function ah(i,t,s){return t.x<=Math.max(i.x,s.x)&&t.x>=Math.min(i.x,s.x)&&t.y<=Math.max(i.y,s.y)&&t.y>=Math.min(i.y,s.y)}function ih(i){return i>0?1:i<0?-1:0}function yc(i,t){return la(i.prev,i,i.next)<0?la(i,t,i.next)>=0&&la(i,i.prev,t)>=0:la(i,t,i.prev)<0||la(i,i.next,t)<0}function Od(i,t){var s=new Ef(i.i,i.x,i.y),h=new Ef(t.i,t.x,t.y),d=i.next,_=t.prev;return i.next=t,t.prev=i,s.next=d,d.prev=s,h.next=s,s.prev=h,_.next=h,h.prev=_,h}function Bd(i,t,s,h){var d=new Ef(i,t,s);return h?(d.next=h.next,d.prev=h,h.next.prev=d,h.next=d):(d.prev=d,d.next=d),d}function vc(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Ef(i,t,s){this.i=i,this.x=t,this.y=s,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Sf(i,t,s,h){for(var d=0,_=t,v=s-h;_<s;_+=h)d+=(i[v]-i[_])*(i[_+1]+i[v+1]),v=_;return d}bf.exports=th,bf.exports.default=th,th.deviation=function(i,t,s,h){var d=t&&t.length,_=Math.abs(Sf(i,0,d?t[0]*s:i.length,s));if(d)for(var v=0,b=t.length;v<b;v++)_-=Math.abs(Sf(i,t[v]*s,v<b-1?t[v+1]*s:i.length,s));var k=0;for(v=0;v<h.length;v+=3){var I=h[v]*s,D=h[v+1]*s,B=h[v+2]*s;k+=Math.abs((i[I]-i[B])*(i[D+1]-i[I+1])-(i[I]-i[D])*(i[B+1]-i[I+1]))}return _===0&&k===0?0:Math.abs((k-_)/_)},th.flatten=function(i){for(var t=i[0][0].length,s={vertices:[],holes:[],dimensions:t},h=0,d=0;d<i.length;d++){for(var _=0;_<i[d].length;_++)for(var v=0;v<t;v++)s.vertices.push(i[d][_][v]);d>0&&s.holes.push(h+=i[d-1].length)}return s};var zd=w(bf.exports);function l_(i,t,s,h,d){Nd(i,t,s||0,h||i.length-1,d||c_)}function Nd(i,t,s,h,d){for(;h>s;){if(h-s>600){var _=h-s+1,v=t-s+1,b=Math.log(_),k=.5*Math.exp(2*b/3),I=.5*Math.sqrt(b*k*(_-k)/_)*(v-_/2<0?-1:1);Nd(i,t,Math.max(s,Math.floor(t-v*k/_+I)),Math.min(h,Math.floor(t+(_-v)*k/_+I)),d)}var D=i[t],B=s,G=h;for(wc(i,s,t),d(i[h],D)>0&&wc(i,s,h);B<G;){for(wc(i,B,G),B++,G--;d(i[B],D)<0;)B++;for(;d(i[G],D)>0;)G--}d(i[s],D)===0?wc(i,s,G):wc(i,++G,h),G<=t&&(s=G+1),t<=G&&(h=G-1)}}function wc(i,t,s){var h=i[t];i[t]=i[s],i[s]=h}function c_(i,t){return i<t?-1:i>t?1:0}function kf(i,t){const s=i.length;if(s<=1)return[i];const h=[];let d,_;for(let v=0;v<s;v++){const b=_t(i[v]);b!==0&&(i[v].area=Math.abs(b),_===void 0&&(_=b<0),_===b<0?(d&&h.push(d),d=[i[v]]):d.push(i[v]))}if(d&&h.push(d),t>1)for(let v=0;v<h.length;v++)h[v].length<=t||(l_(h[v],t,1,h[v].length-1,u_),h[v]=h[v].slice(0,t));return h}function u_(i,t){return t.area-i.area}function Cf(i,t,s){const h=s.patternDependencies;let d=!1;for(const _ of t){const v=_.paint.get(`${i}-pattern`);v.isConstant()||(d=!0);const b=v.constantOr(null);b&&(d=!0,h[b.to]=!0,h[b.from]=!0)}return d}function Af(i,t,s,h,d){const _=d.patternDependencies;for(const v of t){const b=v.paint.get(`${i}-pattern`).value;if(b.kind!=="constant"){let k=b.evaluate({zoom:h-1},s,{},d.availableImages),I=b.evaluate({zoom:h},s,{},d.availableImages),D=b.evaluate({zoom:h+1},s,{},d.availableImages);k=k&&k.name?k.name:k,I=I&&I.name?I.name:I,D=D&&D.name?D.name:D,_[k]=!0,_[I]=!0,_[D]=!0,s.patterns[v.id]={min:k,mid:I,max:D}}}return s}class If{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ur,this.indexArray=new Ia,this.indexArray2=new ma,this.programConfigurations=new mn(t.layers,t.zoom),this.segments=new Lr,this.segments2=new Lr,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,h){this.hasPattern=Cf("fill",this.layers,s);const d=this.layers[0].layout.get("fill-sort-key"),_=!d.isConstant(),v=[];for(const{feature:b,id:k,index:I,sourceLayerIndex:D}of t){const B=this.layers[0]._featureFilter.needGeometry,G=no(b,B);if(!this.layers[0]._featureFilter.filter(new Dr(this.zoom),G,h))continue;const W=_?d.evaluate(G,{},h,s.availableImages):void 0,X={id:k,properties:b.properties,type:b.type,sourceLayerIndex:D,index:I,geometry:B?G.geometry:io(b),patterns:{},sortKey:W};v.push(X)}_&&v.sort((b,k)=>b.sortKey-k.sortKey);for(const b of v){const{geometry:k,index:I,sourceLayerIndex:D}=b;if(this.hasPattern){const B=Af("fill",this.layers,b,this.zoom,s);this.patternFeatures.push(B)}else this.addFeature(b,k,I,h,{});s.featureIndex.insert(t[I].feature,k,I,D,this.index)}}update(t,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,h)}addFeatures(t,s,h){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,s,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Jx),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,s,h,d,_){for(const v of kf(s,500)){let b=0;for(const W of v)b+=W.length;const k=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray),I=k.vertexLength,D=[],B=[];for(const W of v){if(W.length===0)continue;W!==v[0]&&B.push(D.length/2);const X=this.segments2.prepareSegment(W.length,this.layoutVertexArray,this.indexArray2),ne=X.vertexLength;this.layoutVertexArray.emplaceBack(W[0].x,W[0].y),this.indexArray2.emplaceBack(ne+W.length-1,ne),D.push(W[0].x),D.push(W[0].y);for(let ge=1;ge<W.length;ge++)this.layoutVertexArray.emplaceBack(W[ge].x,W[ge].y),this.indexArray2.emplaceBack(ne+ge-1,ne+ge),D.push(W[ge].x),D.push(W[ge].y);X.vertexLength+=W.length,X.primitiveLength+=W.length}const G=zd(D,B);for(let W=0;W<G.length;W+=3)this.indexArray.emplaceBack(I+G[W],I+G[W+1],I+G[W+2]);k.vertexLength+=b,k.primitiveLength+=G.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,h,_,d)}}let Ud,Vd;It("FillBucket",If,{omit:["layers","patternFeatures"]});var h_={get paint(){return Vd=Vd||new sa({"fill-antialias":new zt(Xe.paint_fill["fill-antialias"]),"fill-opacity":new Gt(Xe.paint_fill["fill-opacity"]),"fill-color":new Gt(Xe.paint_fill["fill-color"]),"fill-outline-color":new Gt(Xe.paint_fill["fill-outline-color"]),"fill-translate":new zt(Xe.paint_fill["fill-translate"]),"fill-translate-anchor":new zt(Xe.paint_fill["fill-translate-anchor"]),"fill-pattern":new to(Xe.paint_fill["fill-pattern"])})},get layout(){return Ud=Ud||new sa({"fill-sort-key":new Gt(Xe.layout_fill["fill-sort-key"])})}};class f_ extends Pi{constructor(t){super(t,h_)}recalculate(t,s){super.recalculate(t,s);const h=this.paint._values["fill-outline-color"];h.value.kind==="constant"&&h.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new If(t)}queryRadius(){return Ju(this.paint.get("fill-translate"))}queryIntersectsFeature(t,s,h,d,_,v,b){return bd(Qu(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),v.angle,b),d)}isTileClipped(){return!0}}const d_=qr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),p_=qr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:m_}=d_;var bs={},g_=C,$d=nl;function nl(i,t,s,h,d){this.properties={},this.extent=s,this.type=0,this._pbf=i,this._geometry=-1,this._keys=h,this._values=d,i.readFields(x_,this,t)}function x_(i,t,s){i==1?t.id=s.readVarint():i==2?function(h,d){for(var _=h.readVarint()+h.pos;h.pos<_;){var v=d._keys[h.readVarint()],b=d._values[h.readVarint()];d.properties[v]=b}}(s,t):i==3?t.type=s.readVarint():i==4&&(t._geometry=s.pos)}function __(i){for(var t,s,h=0,d=0,_=i.length,v=_-1;d<_;v=d++)h+=((s=i[v]).x-(t=i[d]).x)*(t.y+s.y);return h}nl.types=["Unknown","Point","LineString","Polygon"],nl.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var t,s=i.readVarint()+i.pos,h=1,d=0,_=0,v=0,b=[];i.pos<s;){if(d<=0){var k=i.readVarint();h=7&k,d=k>>3}if(d--,h===1||h===2)_+=i.readSVarint(),v+=i.readSVarint(),h===1&&(t&&b.push(t),t=[]),t.push(new g_(_,v));else{if(h!==7)throw new Error("unknown command "+h);t&&t.push(t[0].clone())}}return t&&b.push(t),b},nl.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var t=i.readVarint()+i.pos,s=1,h=0,d=0,_=0,v=1/0,b=-1/0,k=1/0,I=-1/0;i.pos<t;){if(h<=0){var D=i.readVarint();s=7&D,h=D>>3}if(h--,s===1||s===2)(d+=i.readSVarint())<v&&(v=d),d>b&&(b=d),(_+=i.readSVarint())<k&&(k=_),_>I&&(I=_);else if(s!==7)throw new Error("unknown command "+s)}return[v,k,b,I]},nl.prototype.toGeoJSON=function(i,t,s){var h,d,_=this.extent*Math.pow(2,s),v=this.extent*i,b=this.extent*t,k=this.loadGeometry(),I=nl.types[this.type];function D(W){for(var X=0;X<W.length;X++){var ne=W[X];W[X]=[360*(ne.x+v)/_-180,360/Math.PI*Math.atan(Math.exp((180-360*(ne.y+b)/_)*Math.PI/180))-90]}}switch(this.type){case 1:var B=[];for(h=0;h<k.length;h++)B[h]=k[h][0];D(k=B);break;case 2:for(h=0;h<k.length;h++)D(k[h]);break;case 3:for(k=function(W){var X=W.length;if(X<=1)return[W];for(var ne,ge,we=[],Re=0;Re<X;Re++){var ke=__(W[Re]);ke!==0&&(ge===void 0&&(ge=ke<0),ge===ke<0?(ne&&we.push(ne),ne=[W[Re]]):ne.push(W[Re]))}return ne&&we.push(ne),we}(k),h=0;h<k.length;h++)for(d=0;d<k[h].length;d++)D(k[h][d])}k.length===1?k=k[0]:I="Multi"+I;var G={type:"Feature",geometry:{type:I,coordinates:k},properties:this.properties};return"id"in this&&(G.id=this.id),G};var y_=$d,jd=Gd;function Gd(i,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(v_,this,t),this.length=this._features.length}function v_(i,t,s){i===15?t.version=s.readVarint():i===1?t.name=s.readString():i===5?t.extent=s.readVarint():i===2?t._features.push(s.pos):i===3?t._keys.push(s.readString()):i===4&&t._values.push(function(h){for(var d=null,_=h.readVarint()+h.pos;h.pos<_;){var v=h.readVarint()>>3;d=v===1?h.readString():v===2?h.readFloat():v===3?h.readDouble():v===4?h.readVarint64():v===5?h.readVarint():v===6?h.readSVarint():v===7?h.readBoolean():null}return d}(s))}Gd.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var t=this._pbf.readVarint()+this._pbf.pos;return new y_(this._pbf,t,this.extent,this._keys,this._values)};var w_=jd;function b_(i,t,s){if(i===3){var h=new w_(s,s.readVarint()+s.pos);h.length&&(t[h.name]=h)}}bs.VectorTile=function(i,t){this.layers=i.readFields(b_,{},t)},bs.VectorTileFeature=$d,bs.VectorTileLayer=jd;const T_=bs.VectorTileFeature.types,Ff=Math.pow(2,13);function bc(i,t,s,h,d,_,v,b){i.emplaceBack(t,s,2*Math.floor(h*Ff)+v,d*Ff*2,_*Ff*2,Math.round(b))}class Pf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Tt,this.centroidVertexArray=new xt,this.indexArray=new Ia,this.programConfigurations=new mn(t.layers,t.zoom),this.segments=new Lr,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,h){this.features=[],this.hasPattern=Cf("fill-extrusion",this.layers,s);for(const{feature:d,id:_,index:v,sourceLayerIndex:b}of t){const k=this.layers[0]._featureFilter.needGeometry,I=no(d,k);if(!this.layers[0]._featureFilter.filter(new Dr(this.zoom),I,h))continue;const D={id:_,sourceLayerIndex:b,index:v,geometry:k?I.geometry:io(d),properties:d.properties,type:d.type,patterns:{}};this.hasPattern?this.features.push(Af("fill-extrusion",this.layers,D,this.zoom,s)):this.addFeature(D,D.geometry,v,h,{}),s.featureIndex.insert(d,D.geometry,v,b,this.index,!0)}}addFeatures(t,s,h){for(const d of this.features){const{geometry:_}=d;this.addFeature(d,_,d.index,s,h)}}update(t,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,h)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,m_),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,p_.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,s,h,d,_){const v={x:0,y:0,vertexCount:0};for(const b of kf(s,500)){let k=0;for(const X of b)k+=X.length;let I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const X of b){if(X.length===0||S_(X))continue;let ne=0;for(let ge=0;ge<X.length;ge++){const we=X[ge];if(ge>=1){const Re=X[ge-1];if(!E_(we,Re)){I.vertexLength+4>Lr.MAX_VERTEX_ARRAY_LENGTH&&(I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ke=we.sub(Re)._perp()._unit(),Ne=Re.dist(we);ne+Ne>32768&&(ne=0),bc(this.layoutVertexArray,we.x,we.y,ke.x,ke.y,0,0,ne),bc(this.layoutVertexArray,we.x,we.y,ke.x,ke.y,0,1,ne),v.x+=2*we.x,v.y+=2*we.y,v.vertexCount+=2,ne+=Ne,bc(this.layoutVertexArray,Re.x,Re.y,ke.x,ke.y,0,0,ne),bc(this.layoutVertexArray,Re.x,Re.y,ke.x,ke.y,0,1,ne),v.x+=2*Re.x,v.y+=2*Re.y,v.vertexCount+=2;const Ge=I.vertexLength;this.indexArray.emplaceBack(Ge,Ge+2,Ge+1),this.indexArray.emplaceBack(Ge+1,Ge+2,Ge+3),I.vertexLength+=4,I.primitiveLength+=2}}}}if(I.vertexLength+k>Lr.MAX_VERTEX_ARRAY_LENGTH&&(I=this.segments.prepareSegment(k,this.layoutVertexArray,this.indexArray)),T_[t.type]!=="Polygon")continue;const D=[],B=[],G=I.vertexLength;for(const X of b)if(X.length!==0){X!==b[0]&&B.push(D.length/2);for(let ne=0;ne<X.length;ne++){const ge=X[ne];bc(this.layoutVertexArray,ge.x,ge.y,0,0,1,1,0),v.x+=ge.x,v.y+=ge.y,v.vertexCount+=1,D.push(ge.x),D.push(ge.y)}}const W=zd(D,B);for(let X=0;X<W.length;X+=3)this.indexArray.emplaceBack(G+W[X],G+W[X+2],G+W[X+1]);I.primitiveLength+=W.length/3,I.vertexLength+=k}for(let b=0;b<v.vertexCount;b++)this.centroidVertexArray.emplaceBack(Math.floor(v.x/v.vertexCount),Math.floor(v.y/v.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,h,_,d)}}function E_(i,t){return i.x===t.x&&(i.x<0||i.x>ua)||i.y===t.y&&(i.y<0||i.y>ua)}function S_(i){return i.every(t=>t.x<0)||i.every(t=>t.x>ua)||i.every(t=>t.y<0)||i.every(t=>t.y>ua)}let Hd;It("FillExtrusionBucket",Pf,{omit:["layers","features"]});var k_={get paint(){return Hd=Hd||new sa({"fill-extrusion-opacity":new zt(Xe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Gt(Xe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new zt(Xe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new zt(Xe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new to(Xe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Gt(Xe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Gt(Xe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new zt(Xe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class C_ extends Pi{constructor(t){super(t,k_)}createBucket(t){return new Pf(t)}queryRadius(){return Ju(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,s,h,d,_,v,b,k){const I=Qu(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),v.angle,b),D=this.paint.get("fill-extrusion-height").evaluate(s,h),B=this.paint.get("fill-extrusion-base").evaluate(s,h),G=function(X,ne,ge,we){const Re=[];for(const ke of X){const Ne=[ke.x,ke.y,0,1];eh(Ne,Ne,ne),Re.push(new M(Ne[0]/Ne[3],Ne[1]/Ne[3]))}return Re}(I,k),W=function(X,ne,ge,we){const Re=[],ke=[],Ne=we[8]*ne,Ge=we[9]*ne,at=we[10]*ne,At=we[11]*ne,Rt=we[8]*ge,kt=we[9]*ge,Et=we[10]*ge,yt=we[11]*ge;for(const Pt of X){const bt=[],pt=[];for(const $t of Pt){const Bt=$t.x,sr=$t.y,Rr=we[0]*Bt+we[4]*sr+we[12],Ur=we[1]*Bt+we[5]*sr+we[13],_a=we[2]*Bt+we[6]*sr+we[14],Di=we[3]*Bt+we[7]*sr+we[15],ri=_a+at,ha=Di+At,Pa=Rr+Rt,Ba=Ur+kt,ai=_a+Et,ii=Di+yt,ya=new M((Rr+Ne)/ha,(Ur+Ge)/ha);ya.z=ri/ha,bt.push(ya);const va=new M(Pa/ii,Ba/ii);va.z=ai/ii,pt.push(va)}Re.push(bt),ke.push(pt)}return[Re,ke]}(d,B,D,k);return function(X,ne,ge){let we=1/0;bd(ge,ne)&&(we=qd(ge,ne[0]));for(let Re=0;Re<ne.length;Re++){const ke=ne[Re],Ne=X[Re];for(let Ge=0;Ge<ke.length-1;Ge++){const at=ke[Ge],At=[at,ke[Ge+1],Ne[Ge+1],Ne[Ge],at];wd(ge,At)&&(we=Math.min(we,qd(ge,At)))}}return we!==1/0&&we}(W[0],W[1],G)}}function Tc(i,t){return i.x*t.x+i.y*t.y}function qd(i,t){if(i.length===1){let s=0;const h=t[s++];let d;for(;!d||h.equals(d);)if(d=t[s++],!d)return 1/0;for(;s<t.length;s++){const _=t[s],v=i[0],b=d.sub(h),k=_.sub(h),I=v.sub(h),D=Tc(b,b),B=Tc(b,k),G=Tc(k,k),W=Tc(I,b),X=Tc(I,k),ne=D*G-B*B,ge=(G*W-B*X)/ne,we=(D*X-B*W)/ne,Re=h.z*(1-ge-we)+d.z*ge+_.z*we;if(isFinite(Re))return Re}return 1/0}{let s=1/0;for(const h of t)s=Math.min(s,h.z);return s}}const A_=qr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:I_}=A_,F_=qr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:P_}=F_,M_=bs.VectorTileFeature.types,D_=Math.cos(Math.PI/180*37.5),Wd=Math.pow(2,14)/.5;class Mf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new Ht,this.layoutVertexArray2=new Ot,this.indexArray=new Ia,this.programConfigurations=new mn(t.layers,t.zoom),this.segments=new Lr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,h){this.hasPattern=Cf("line",this.layers,s);const d=this.layers[0].layout.get("line-sort-key"),_=!d.isConstant(),v=[];for(const{feature:b,id:k,index:I,sourceLayerIndex:D}of t){const B=this.layers[0]._featureFilter.needGeometry,G=no(b,B);if(!this.layers[0]._featureFilter.filter(new Dr(this.zoom),G,h))continue;const W=_?d.evaluate(G,{},h):void 0,X={id:k,properties:b.properties,type:b.type,sourceLayerIndex:D,index:I,geometry:B?G.geometry:io(b),patterns:{},sortKey:W};v.push(X)}_&&v.sort((b,k)=>b.sortKey-k.sortKey);for(const b of v){const{geometry:k,index:I,sourceLayerIndex:D}=b;if(this.hasPattern){const B=Af("line",this.layers,b,this.zoom,s);this.patternFeatures.push(B)}else this.addFeature(b,k,I,h,{});s.featureIndex.insert(t[I].feature,k,I,D,this.index)}}update(t,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,h)}addFeatures(t,s,h){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,s,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,P_)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,I_),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,s,h,d,_){const v=this.layers[0].layout,b=v.get("line-join").evaluate(t,{}),k=v.get("line-cap"),I=v.get("line-miter-limit"),D=v.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const B of s)this.addLine(B,t,b,k,I,D);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,h,_,d)}addLine(t,s,h,d,_,v){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let we=0;we<t.length-1;we++)this.totalDistance+=t[we].dist(t[we+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const b=M_[s.type]==="Polygon";let k=t.length;for(;k>=2&&t[k-1].equals(t[k-2]);)k--;let I=0;for(;I<k-1&&t[I].equals(t[I+1]);)I++;if(k<(b?3:2))return;h==="bevel"&&(_=1.05);const D=this.overscaling<=16?15*ua/(512*this.overscaling):0,B=this.segments.prepareSegment(10*k,this.layoutVertexArray,this.indexArray);let G,W,X,ne,ge;this.e1=this.e2=-1,b&&(G=t[k-2],ge=t[I].sub(G)._unit()._perp());for(let we=I;we<k;we++){if(X=we===k-1?b?t[I+1]:void 0:t[we+1],X&&t[we].equals(X))continue;ge&&(ne=ge),G&&(W=G),G=t[we],ge=X?X.sub(G)._unit()._perp():ne,ne=ne||ge;let Re=ne.add(ge);Re.x===0&&Re.y===0||Re._unit();const ke=ne.x*ge.x+ne.y*ge.y,Ne=Re.x*ge.x+Re.y*ge.y,Ge=Ne!==0?1/Ne:1/0,at=2*Math.sqrt(2-2*Ne),At=Ne<D_&&W&&X,Rt=ne.x*ge.y-ne.y*ge.x>0;if(At&&we>I){const yt=G.dist(W);if(yt>2*D){const Pt=G.sub(G.sub(W)._mult(D/yt)._round());this.updateDistance(W,Pt),this.addCurrentVertex(Pt,ne,0,0,B),W=Pt}}const kt=W&&X;let Et=kt?h:b?"butt":d;if(kt&&Et==="round"&&(Ge<v?Et="miter":Ge<=2&&(Et="fakeround")),Et==="miter"&&Ge>_&&(Et="bevel"),Et==="bevel"&&(Ge>2&&(Et="flipbevel"),Ge<_&&(Et="miter")),W&&this.updateDistance(W,G),Et==="miter")Re._mult(Ge),this.addCurrentVertex(G,Re,0,0,B);else if(Et==="flipbevel"){if(Ge>100)Re=ge.mult(-1);else{const yt=Ge*ne.add(ge).mag()/ne.sub(ge).mag();Re._perp()._mult(yt*(Rt?-1:1))}this.addCurrentVertex(G,Re,0,0,B),this.addCurrentVertex(G,Re.mult(-1),0,0,B)}else if(Et==="bevel"||Et==="fakeround"){const yt=-Math.sqrt(Ge*Ge-1),Pt=Rt?yt:0,bt=Rt?0:yt;if(W&&this.addCurrentVertex(G,ne,Pt,bt,B),Et==="fakeround"){const pt=Math.round(180*at/Math.PI/20);for(let $t=1;$t<pt;$t++){let Bt=$t/pt;if(Bt!==.5){const Rr=Bt-.5;Bt+=Bt*Rr*(Bt-1)*((1.0904+ke*(ke*(3.55645-1.43519*ke)-3.2452))*Rr*Rr+(.848013+ke*(.215638*ke-1.06021)))}const sr=ge.sub(ne)._mult(Bt)._add(ne)._unit()._mult(Rt?-1:1);this.addHalfVertex(G,sr.x,sr.y,!1,Rt,0,B)}}X&&this.addCurrentVertex(G,ge,-Pt,-bt,B)}else if(Et==="butt")this.addCurrentVertex(G,Re,0,0,B);else if(Et==="square"){const yt=W?1:-1;this.addCurrentVertex(G,Re,yt,yt,B)}else Et==="round"&&(W&&(this.addCurrentVertex(G,ne,0,0,B),this.addCurrentVertex(G,ne,1,1,B,!0)),X&&(this.addCurrentVertex(G,ge,-1,-1,B,!0),this.addCurrentVertex(G,ge,0,0,B)));if(At&&we<k-1){const yt=G.dist(X);if(yt>2*D){const Pt=G.add(X.sub(G)._mult(D/yt)._round());this.updateDistance(G,Pt),this.addCurrentVertex(Pt,ge,0,0,B),G=Pt}}}}addCurrentVertex(t,s,h,d,_,v=!1){const b=s.y*d-s.x,k=-s.y-s.x*d;this.addHalfVertex(t,s.x+s.y*h,s.y-s.x*h,v,!1,h,_),this.addHalfVertex(t,b,k,v,!0,-d,_),this.distance>Wd/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,s,h,d,_,v))}addHalfVertex({x:t,y:s},h,d,_,v,b,k){const I=.5*(this.lineClips?this.scaledDistance*(Wd-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(_?1:0),(s<<1)+(v?1:0),Math.round(63*h)+128,Math.round(63*d)+128,1+(b===0?0:b<0?-1:1)|(63&I)<<2,I>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const D=k.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),k.primitiveLength++),v?this.e2=D:this.e1=D}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,s){this.distance+=t.dist(s),this.updateScaledDistance()}}let Zd,Xd;It("LineBucket",Mf,{omit:["layers","patternFeatures"]});var Kd={get paint(){return Xd=Xd||new sa({"line-opacity":new Gt(Xe.paint_line["line-opacity"]),"line-color":new Gt(Xe.paint_line["line-color"]),"line-translate":new zt(Xe.paint_line["line-translate"]),"line-translate-anchor":new zt(Xe.paint_line["line-translate-anchor"]),"line-width":new Gt(Xe.paint_line["line-width"]),"line-gap-width":new Gt(Xe.paint_line["line-gap-width"]),"line-offset":new Gt(Xe.paint_line["line-offset"]),"line-blur":new Gt(Xe.paint_line["line-blur"]),"line-dasharray":new sc(Xe.paint_line["line-dasharray"]),"line-pattern":new to(Xe.paint_line["line-pattern"]),"line-gradient":new oc(Xe.paint_line["line-gradient"])})},get layout(){return Zd=Zd||new sa({"line-cap":new zt(Xe.layout_line["line-cap"]),"line-join":new Gt(Xe.layout_line["line-join"]),"line-miter-limit":new zt(Xe.layout_line["line-miter-limit"]),"line-round-limit":new zt(Xe.layout_line["line-round-limit"]),"line-sort-key":new Gt(Xe.layout_line["line-sort-key"])})}};class L_ extends Gt{possiblyEvaluate(t,s){return s=new Dr(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,zoomHistory:s.zoomHistory,transition:s.transition}),super.possiblyEvaluate(t,s)}evaluate(t,s,h,d){return s=Ce({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(t,s,h,d)}}let nh;class R_ extends Pi{constructor(t){super(t,Kd),this.gradientVersion=0,nh||(nh=new L_(Kd.paint.properties["line-width"].specification),nh.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const s=this.gradientExpression();this.stepInterpolant=!!function(h){return h._styleExpression!==void 0}(s)&&s._styleExpression.expression instanceof In,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,s){super.recalculate(t,s),this.paint._values["line-floorwidth"]=nh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Mf(t)}queryRadius(t){const s=t,h=Yd(mc("line-width",this,s),mc("line-gap-width",this,s)),d=mc("line-offset",this,s);return h/2+Math.abs(d)+Ju(this.paint.get("line-translate"))}queryIntersectsFeature(t,s,h,d,_,v,b){const k=Qu(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),v.angle,b),I=b/2*Yd(this.paint.get("line-width").evaluate(s,h),this.paint.get("line-gap-width").evaluate(s,h)),D=this.paint.get("line-offset").evaluate(s,h);return D&&(d=function(B,G){const W=[];for(let X=0;X<B.length;X++){const ne=B[X],ge=[];for(let we=0;we<ne.length;we++){const Re=ne[we-1],ke=ne[we],Ne=ne[we+1],Ge=we===0?new M(0,0):ke.sub(Re)._unit()._perp(),at=we===ne.length-1?new M(0,0):Ne.sub(ke)._unit()._perp(),At=Ge._add(at)._unit(),Rt=At.x*at.x+At.y*at.y;Rt!==0&&At._mult(1/Rt),ge.push(At._mult(G)._add(ke))}W.push(ge)}return W}(d,D*b)),function(B,G,W){for(let X=0;X<G.length;X++){const ne=G[X];if(B.length>=3){for(let ge=0;ge<ne.length;ge++)if(rl(B,ne[ge]))return!0}if(Vx(B,ne,W))return!0}return!1}(k,d,I)}isTileClipped(){return!0}}function Yd(i,t){return t>0?t+2*i:i}const O_=qr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),B_=qr([{name:"a_projected_pos",components:3,type:"Float32"}],4);qr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const z_=qr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);qr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Jd=qr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),N_=qr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function U_(i,t,s){return i.sections.forEach(h=>{h.text=function(d,_,v){const b=_.layout.get("text-transform").evaluate(v,{});return b==="uppercase"?d=d.toLocaleUpperCase():b==="lowercase"&&(d=d.toLocaleLowerCase()),gi.applyArabicShaping&&(d=gi.applyArabicShaping(d)),d}(h.text,t,s)}),i}qr([{name:"triangle",components:3,type:"Uint16"}]),qr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),qr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),qr([{type:"Float32",name:"offsetX"}]),qr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),qr([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Ec={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var xa=24,Qd=Ir,ep=function(i,t,s,h,d){var _,v,b=8*d-h-1,k=(1<<b)-1,I=k>>1,D=-7,B=s?d-1:0,G=s?-1:1,W=i[t+B];for(B+=G,_=W&(1<<-D)-1,W>>=-D,D+=b;D>0;_=256*_+i[t+B],B+=G,D-=8);for(v=_&(1<<-D)-1,_>>=-D,D+=h;D>0;v=256*v+i[t+B],B+=G,D-=8);if(_===0)_=1-I;else{if(_===k)return v?NaN:1/0*(W?-1:1);v+=Math.pow(2,h),_-=I}return(W?-1:1)*v*Math.pow(2,_-h)},tp=function(i,t,s,h,d,_){var v,b,k,I=8*_-d-1,D=(1<<I)-1,B=D>>1,G=d===23?Math.pow(2,-24)-Math.pow(2,-77):0,W=h?0:_-1,X=h?1:-1,ne=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(b=isNaN(t)?1:0,v=D):(v=Math.floor(Math.log(t)/Math.LN2),t*(k=Math.pow(2,-v))<1&&(v--,k*=2),(t+=v+B>=1?G/k:G*Math.pow(2,1-B))*k>=2&&(v++,k/=2),v+B>=D?(b=0,v=D):v+B>=1?(b=(t*k-1)*Math.pow(2,d),v+=B):(b=t*Math.pow(2,B-1)*Math.pow(2,d),v=0));d>=8;i[s+W]=255&b,W+=X,b/=256,d-=8);for(v=v<<d|b,I+=d;I>0;i[s+W]=255&v,W+=X,v/=256,I-=8);i[s+W-X]|=128*ne};function Ir(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Ir.Varint=0,Ir.Fixed64=1,Ir.Bytes=2,Ir.Fixed32=5;var Df=4294967296,rp=1/Df,ap=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function es(i){return i.type===Ir.Bytes?i.readVarint()+i.pos:i.pos+1}function sl(i,t,s){return s?4294967296*t+(i>>>0):4294967296*(t>>>0)+(i>>>0)}function ip(i,t,s){var h=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));s.realloc(h);for(var d=s.pos-1;d>=i;d--)s.buf[d+h]=s.buf[d]}function V_(i,t){for(var s=0;s<i.length;s++)t.writeVarint(i[s])}function $_(i,t){for(var s=0;s<i.length;s++)t.writeSVarint(i[s])}function j_(i,t){for(var s=0;s<i.length;s++)t.writeFloat(i[s])}function G_(i,t){for(var s=0;s<i.length;s++)t.writeDouble(i[s])}function H_(i,t){for(var s=0;s<i.length;s++)t.writeBoolean(i[s])}function q_(i,t){for(var s=0;s<i.length;s++)t.writeFixed32(i[s])}function W_(i,t){for(var s=0;s<i.length;s++)t.writeSFixed32(i[s])}function Z_(i,t){for(var s=0;s<i.length;s++)t.writeFixed64(i[s])}function X_(i,t){for(var s=0;s<i.length;s++)t.writeSFixed64(i[s])}function sh(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+16777216*i[t+3]}function ol(i,t,s){i[s]=t,i[s+1]=t>>>8,i[s+2]=t>>>16,i[s+3]=t>>>24}function np(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+(i[t+3]<<24)}Ir.prototype={destroy:function(){this.buf=null},readFields:function(i,t,s){for(s=s||this.length;this.pos<s;){var h=this.readVarint(),d=h>>3,_=this.pos;this.type=7&h,i(d,t,this),this.pos===_&&this.skip(h)}return t},readMessage:function(i,t){return this.readFields(i,t,this.readVarint()+this.pos)},readFixed32:function(){var i=sh(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=np(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=sh(this.buf,this.pos)+sh(this.buf,this.pos+4)*Df;return this.pos+=8,i},readSFixed64:function(){var i=sh(this.buf,this.pos)+np(this.buf,this.pos+4)*Df;return this.pos+=8,i},readFloat:function(){var i=ep(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=ep(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var t,s,h=this.buf;return t=127&(s=h[this.pos++]),s<128?t:(t|=(127&(s=h[this.pos++]))<<7,s<128?t:(t|=(127&(s=h[this.pos++]))<<14,s<128?t:(t|=(127&(s=h[this.pos++]))<<21,s<128?t:function(d,_,v){var b,k,I=v.buf;if(b=(112&(k=I[v.pos++]))>>4,k<128||(b|=(127&(k=I[v.pos++]))<<3,k<128)||(b|=(127&(k=I[v.pos++]))<<10,k<128)||(b|=(127&(k=I[v.pos++]))<<17,k<128)||(b|=(127&(k=I[v.pos++]))<<24,k<128)||(b|=(1&(k=I[v.pos++]))<<31,k<128))return sl(d,b,_);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(s=h[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,t=this.pos;return this.pos=i,i-t>=12&&ap?function(s,h,d){return ap.decode(s.subarray(h,d))}(this.buf,t,i):function(s,h,d){for(var _="",v=h;v<d;){var b,k,I,D=s[v],B=null,G=D>239?4:D>223?3:D>191?2:1;if(v+G>d)break;G===1?D<128&&(B=D):G===2?(192&(b=s[v+1]))==128&&(B=(31&D)<<6|63&b)<=127&&(B=null):G===3?(k=s[v+2],(192&(b=s[v+1]))==128&&(192&k)==128&&((B=(15&D)<<12|(63&b)<<6|63&k)<=2047||B>=55296&&B<=57343)&&(B=null)):G===4&&(k=s[v+2],I=s[v+3],(192&(b=s[v+1]))==128&&(192&k)==128&&(192&I)==128&&((B=(15&D)<<18|(63&b)<<12|(63&k)<<6|63&I)<=65535||B>=1114112)&&(B=null)),B===null?(B=65533,G=1):B>65535&&(B-=65536,_+=String.fromCharCode(B>>>10&1023|55296),B=56320|1023&B),_+=String.fromCharCode(B),v+=G}return _}(this.buf,t,i)},readBytes:function(){var i=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,i);return this.pos=i,t},readPackedVarint:function(i,t){if(this.type!==Ir.Bytes)return i.push(this.readVarint(t));var s=es(this);for(i=i||[];this.pos<s;)i.push(this.readVarint(t));return i},readPackedSVarint:function(i){if(this.type!==Ir.Bytes)return i.push(this.readSVarint());var t=es(this);for(i=i||[];this.pos<t;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Ir.Bytes)return i.push(this.readBoolean());var t=es(this);for(i=i||[];this.pos<t;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Ir.Bytes)return i.push(this.readFloat());var t=es(this);for(i=i||[];this.pos<t;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Ir.Bytes)return i.push(this.readDouble());var t=es(this);for(i=i||[];this.pos<t;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Ir.Bytes)return i.push(this.readFixed32());var t=es(this);for(i=i||[];this.pos<t;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Ir.Bytes)return i.push(this.readSFixed32());var t=es(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Ir.Bytes)return i.push(this.readFixed64());var t=es(this);for(i=i||[];this.pos<t;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Ir.Bytes)return i.push(this.readSFixed64());var t=es(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed64());return i},skip:function(i){var t=7&i;if(t===Ir.Varint)for(;this.buf[this.pos++]>127;);else if(t===Ir.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Ir.Fixed32)this.pos+=4;else{if(t!==Ir.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(i,t){this.writeVarint(i<<3|t)},realloc:function(i){for(var t=this.length||16;t<this.pos+i;)t*=2;if(t!==this.length){var s=new Uint8Array(t);s.set(this.buf),this.buf=s,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),ol(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),ol(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),ol(this.buf,-1&i,this.pos),ol(this.buf,Math.floor(i*rp),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),ol(this.buf,-1&i,this.pos),ol(this.buf,Math.floor(i*rp),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(t,s){var h,d;if(t>=0?(h=t%4294967296|0,d=t/4294967296|0):(d=~(-t/4294967296),4294967295^(h=~(-t%4294967296))?h=h+1|0:(h=0,d=d+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),function(_,v,b){b.buf[b.pos++]=127&_|128,_>>>=7,b.buf[b.pos++]=127&_|128,_>>>=7,b.buf[b.pos++]=127&_|128,_>>>=7,b.buf[b.pos++]=127&_|128,b.buf[b.pos]=127&(_>>>=7)}(h,0,s),function(_,v){var b=(7&_)<<4;v.buf[v.pos++]|=b|((_>>>=3)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_)))))}(d,s)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var t=this.pos;this.pos=function(h,d,_){for(var v,b,k=0;k<d.length;k++){if((v=d.charCodeAt(k))>55295&&v<57344){if(!b){v>56319||k+1===d.length?(h[_++]=239,h[_++]=191,h[_++]=189):b=v;continue}if(v<56320){h[_++]=239,h[_++]=191,h[_++]=189,b=v;continue}v=b-55296<<10|v-56320|65536,b=null}else b&&(h[_++]=239,h[_++]=191,h[_++]=189,b=null);v<128?h[_++]=v:(v<2048?h[_++]=v>>6|192:(v<65536?h[_++]=v>>12|224:(h[_++]=v>>18|240,h[_++]=v>>12&63|128),h[_++]=v>>6&63|128),h[_++]=63&v|128)}return _}(this.buf,i,this.pos);var s=this.pos-t;s>=128&&ip(t,s,this),this.pos=t-1,this.writeVarint(s),this.pos+=s},writeFloat:function(i){this.realloc(4),tp(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),tp(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var t=i.length;this.writeVarint(t),this.realloc(t);for(var s=0;s<t;s++)this.buf[this.pos++]=i[s]},writeRawMessage:function(i,t){this.pos++;var s=this.pos;i(t,this);var h=this.pos-s;h>=128&&ip(s,h,this),this.pos=s-1,this.writeVarint(h),this.pos+=h},writeMessage:function(i,t,s){this.writeTag(i,Ir.Bytes),this.writeRawMessage(t,s)},writePackedVarint:function(i,t){t.length&&this.writeMessage(i,V_,t)},writePackedSVarint:function(i,t){t.length&&this.writeMessage(i,$_,t)},writePackedBoolean:function(i,t){t.length&&this.writeMessage(i,H_,t)},writePackedFloat:function(i,t){t.length&&this.writeMessage(i,j_,t)},writePackedDouble:function(i,t){t.length&&this.writeMessage(i,G_,t)},writePackedFixed32:function(i,t){t.length&&this.writeMessage(i,q_,t)},writePackedSFixed32:function(i,t){t.length&&this.writeMessage(i,W_,t)},writePackedFixed64:function(i,t){t.length&&this.writeMessage(i,Z_,t)},writePackedSFixed64:function(i,t){t.length&&this.writeMessage(i,X_,t)},writeBytesField:function(i,t){this.writeTag(i,Ir.Bytes),this.writeBytes(t)},writeFixed32Field:function(i,t){this.writeTag(i,Ir.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(i,t){this.writeTag(i,Ir.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(i,t){this.writeTag(i,Ir.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(i,t){this.writeTag(i,Ir.Fixed64),this.writeSFixed64(t)},writeVarintField:function(i,t){this.writeTag(i,Ir.Varint),this.writeVarint(t)},writeSVarintField:function(i,t){this.writeTag(i,Ir.Varint),this.writeSVarint(t)},writeStringField:function(i,t){this.writeTag(i,Ir.Bytes),this.writeString(t)},writeFloatField:function(i,t){this.writeTag(i,Ir.Fixed32),this.writeFloat(t)},writeDoubleField:function(i,t){this.writeTag(i,Ir.Fixed64),this.writeDouble(t)},writeBooleanField:function(i,t){this.writeVarintField(i,!!t)}};var Lf=w(Qd);const Rf=3;function K_(i,t,s){i===1&&s.readMessage(Y_,t)}function Y_(i,t,s){if(i===3){const{id:h,bitmap:d,width:_,height:v,left:b,top:k,advance:I}=s.readMessage(J_,{});t.push({id:h,bitmap:new xc({width:_+2*Rf,height:v+2*Rf},d),metrics:{width:_,height:v,left:b,top:k,advance:I}})}}function J_(i,t,s){i===1?t.id=s.readVarint():i===2?t.bitmap=s.readBytes():i===3?t.width=s.readVarint():i===4?t.height=s.readVarint():i===5?t.left=s.readSVarint():i===6?t.top=s.readSVarint():i===7&&(t.advance=s.readVarint())}const sp=Rf;function op(i){let t=0,s=0;for(const v of i)t+=v.w*v.h,s=Math.max(s,v.w);i.sort((v,b)=>b.h-v.h);const h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),s),h:1/0}];let d=0,_=0;for(const v of i)for(let b=h.length-1;b>=0;b--){const k=h[b];if(!(v.w>k.w||v.h>k.h)){if(v.x=k.x,v.y=k.y,_=Math.max(_,v.y+v.h),d=Math.max(d,v.x+v.w),v.w===k.w&&v.h===k.h){const I=h.pop();b<h.length&&(h[b]=I)}else v.h===k.h?(k.x+=v.w,k.w-=v.w):v.w===k.w?(k.y+=v.h,k.h-=v.h):(h.push({x:k.x+v.w,y:k.y,w:k.w-v.w,h:v.h}),k.y+=v.h,k.h-=v.h);break}}return{w:d,h:_,fill:t/(d*_)||0}}const _i=1;class Of{constructor(t,{pixelRatio:s,version:h,stretchX:d,stretchY:_,content:v}){this.paddedRect=t,this.pixelRatio=s,this.stretchX=d,this.stretchY=_,this.content=v,this.version=h}get tl(){return[this.paddedRect.x+_i,this.paddedRect.y+_i]}get br(){return[this.paddedRect.x+this.paddedRect.w-_i,this.paddedRect.y+this.paddedRect.h-_i]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*_i)/this.pixelRatio,(this.paddedRect.h-2*_i)/this.pixelRatio]}}class lp{constructor(t,s){const h={},d={};this.haveRenderCallbacks=[];const _=[];this.addImages(t,h,_),this.addImages(s,d,_);const{w:v,h:b}=op(_),k=new Oi({width:v||1,height:b||1});for(const I in t){const D=t[I],B=h[I].paddedRect;Oi.copy(D.data,k,{x:0,y:0},{x:B.x+_i,y:B.y+_i},D.data)}for(const I in s){const D=s[I],B=d[I].paddedRect,G=B.x+_i,W=B.y+_i,X=D.data.width,ne=D.data.height;Oi.copy(D.data,k,{x:0,y:0},{x:G,y:W},D.data),Oi.copy(D.data,k,{x:0,y:ne-1},{x:G,y:W-1},{width:X,height:1}),Oi.copy(D.data,k,{x:0,y:0},{x:G,y:W+ne},{width:X,height:1}),Oi.copy(D.data,k,{x:X-1,y:0},{x:G-1,y:W},{width:1,height:ne}),Oi.copy(D.data,k,{x:0,y:0},{x:G+X,y:W},{width:1,height:ne})}this.image=k,this.iconPositions=h,this.patternPositions=d}addImages(t,s,h){for(const d in t){const _=t[d],v={x:0,y:0,w:_.data.width+2*_i,h:_.data.height+2*_i};h.push(v),s[d]=new Of(v,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(d)}}patchUpdatedImages(t,s){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const h in t.updatedImages)this.patchUpdatedImage(this.iconPositions[h],t.getImage(h),s),this.patchUpdatedImage(this.patternPositions[h],t.getImage(h),s)}patchUpdatedImage(t,s,h){if(!t||!s||t.version===s.version)return;t.version=s.version;const[d,_]=t.tl;h.update(s.data,void 0,{x:d,y:_})}}var Ts;It("ImagePosition",Of),It("ImageAtlas",lp),o.ai=void 0,(Ts=o.ai||(o.ai={}))[Ts.none=0]="none",Ts[Ts.horizontal=1]="horizontal",Ts[Ts.vertical=2]="vertical",Ts[Ts.horizontalOnly=3]="horizontalOnly";const Sc=-17;class kc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,s){const h=new kc;return h.scale=t||1,h.fontStack=s,h}static forImage(t){const s=new kc;return s.imageName=t,s}}class ll{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,s){const h=new ll;for(let d=0;d<t.sections.length;d++){const _=t.sections[d];_.image?h.addImageSection(_):h.addTextSection(_,s)}return h}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let s="";for(let h=0;h<t.length;h++){const d=t.charCodeAt(h+1)||null,_=t.charCodeAt(h-1)||null;s+=d&&Vu(d)&&!Ec[t[h+1]]||_&&Vu(_)&&!Ec[t[h-1]]||!Ec[t[h]]?t[h]:Ec[t[h]]}return s}(this.text)}trim(){let t=0;for(let h=0;h<this.text.length&&lh[this.text.charCodeAt(h)];h++)t++;let s=this.text.length;for(let h=this.text.length-1;h>=0&&h>=t&&lh[this.text.charCodeAt(h)];h--)s--;this.text=this.text.substring(t,s),this.sectionIndex=this.sectionIndex.slice(t,s)}substring(t,s){const h=new ll;return h.text=this.text.substring(t,s),h.sectionIndex=this.sectionIndex.slice(t,s),h.sections=this.sections,h}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,s)=>Math.max(t,this.sections[s].scale),0)}addTextSection(t,s){this.text+=t.text,this.sections.push(kc.forText(t.scale,t.fontStack||s));const h=this.sections.length-1;for(let d=0;d<t.text.length;++d)this.sectionIndex.push(h)}addImageSection(t){const s=t.image?t.image.name:"";if(s.length===0)return void ft("Can't add FormattedSection with an empty image.");const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCharCode(h),this.sections.push(kc.forImage(s)),this.sectionIndex.push(this.sections.length-1)):ft("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function oh(i,t,s,h,d,_,v,b,k,I,D,B,G,W,X,ne){const ge=ll.fromFeature(i,d);let we;B===o.ai.vertical&&ge.verticalizePunctuation();const{processBidirectionalText:Re,processStyledBidirectionalText:ke}=gi;if(Re&&ge.sections.length===1){we=[];const at=Re(ge.toString(),Bf(ge,I,_,t,h,W,X));for(const At of at){const Rt=new ll;Rt.text=At,Rt.sections=ge.sections;for(let kt=0;kt<At.length;kt++)Rt.sectionIndex.push(0);we.push(Rt)}}else if(ke){we=[];const at=ke(ge.text,ge.sectionIndex,Bf(ge,I,_,t,h,W,X));for(const At of at){const Rt=new ll;Rt.text=At[0],Rt.sectionIndex=At[1],Rt.sections=ge.sections,we.push(Rt)}}else we=function(at,At){const Rt=[],kt=at.text;let Et=0;for(const yt of At)Rt.push(at.substring(Et,yt)),Et=yt;return Et<kt.length&&Rt.push(at.substring(Et,kt.length)),Rt}(ge,Bf(ge,I,_,t,h,W,X));const Ne=[],Ge={positionedLines:Ne,text:ge.toString(),top:D[1],bottom:D[1],left:D[0],right:D[0],writingMode:B,iconsInText:!1,verticalizable:!1};return function(at,At,Rt,kt,Et,yt,Pt,bt,pt,$t,Bt,sr){let Rr=0,Ur=Sc,_a=0,Di=0;const ri=bt==="right"?1:bt==="left"?0:.5;let ha=0;for(const ya of Et){ya.trim();const va=ya.getMaxScale(),ja=(va-1)*xa,ni={positionedGlyphs:[],lineOffset:0};at.positionedLines[ha]=ni;const Ga=ni.positionedGlyphs;let yi=0;if(!ya.length()){Ur+=yt,++ha;continue}for(let wa=0;wa<ya.length();wa++){const dr=ya.getSection(wa),Ha=ya.getSectionIndex(wa),za=ya.getCharCode(wa);let ba=0,en=null,gn=null,xn=null,ts=xa;const tn=!(pt===o.ai.horizontal||!Bt&&!Jl(za)||Bt&&(lh[za]||(Pa=za,Ct.Arabic(Pa)||Ct["Arabic Supplement"](Pa)||Ct["Arabic Extended-A"](Pa)||Ct["Arabic Presentation Forms-A"](Pa)||Ct["Arabic Presentation Forms-B"](Pa))));if(dr.imageName){const zi=kt[dr.imageName];if(!zi)continue;xn=dr.imageName,at.iconsInText=at.iconsInText||!0,gn=zi.paddedRect;const wi=zi.displaySize;dr.scale=dr.scale*xa/sr,en={width:wi[0],height:wi[1],left:_i,top:-sp,advance:tn?wi[1]:wi[0]},ba=ja+(xa-wi[1]*dr.scale),ts=en.advance;const rs=tn?wi[0]*dr.scale-xa*va:wi[1]*dr.scale-xa*va;rs>0&&rs>yi&&(yi=rs)}else{const zi=Rt[dr.fontStack],wi=zi&&zi[za];if(wi&&wi.rect)gn=wi.rect,en=wi.metrics;else{const rs=At[dr.fontStack],Pc=rs&&rs[za];if(!Pc)continue;en=Pc.metrics}ba=(va-dr.scale)*xa}tn?(at.verticalizable=!0,Ga.push({glyph:za,imageName:xn,x:Rr,y:Ur+ba,vertical:tn,scale:dr.scale,fontStack:dr.fontStack,sectionIndex:Ha,metrics:en,rect:gn}),Rr+=ts*dr.scale+$t):(Ga.push({glyph:za,imageName:xn,x:Rr,y:Ur+ba,vertical:tn,scale:dr.scale,fontStack:dr.fontStack,sectionIndex:Ha,metrics:en,rect:gn}),Rr+=en.advance*dr.scale+$t)}Ga.length!==0&&(_a=Math.max(Rr-$t,_a),ty(Ga,0,Ga.length-1,ri,yi)),Rr=0;const vi=yt*va+yi;ni.lineOffset=Math.max(yi,ja),Ur+=vi,Di=Math.max(vi,Di),++ha}var Pa;const Ba=Ur-Sc,{horizontalAlign:ai,verticalAlign:ii}=zf(Pt);(function(ya,va,ja,ni,Ga,yi,vi,wa,dr){const Ha=(va-ja)*Ga;let za=0;za=yi!==vi?-wa*ni-Sc:(-ni*dr+.5)*vi;for(const ba of ya)for(const en of ba.positionedGlyphs)en.x+=Ha,en.y+=za})(at.positionedLines,ri,ai,ii,_a,Di,yt,Ba,Et.length),at.top+=-ii*Ba,at.bottom=at.top+Ba,at.left+=-ai*_a,at.right=at.left+_a}(Ge,t,s,h,we,v,b,k,B,I,G,ne),!function(at){for(const At of at)if(At.positionedGlyphs.length!==0)return!1;return!0}(Ne)&&Ge}const lh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Q_={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function cp(i,t,s,h,d,_){if(t.imageName){const v=h[t.imageName];return v?v.displaySize[0]*t.scale*xa/_+d:0}{const v=s[t.fontStack],b=v&&v[i];return b?b.metrics.advance*t.scale+d:0}}function up(i,t,s,h){const d=Math.pow(i-t,2);return h?i<t?d/2:2*d:d+Math.abs(s)*s}function ey(i,t,s){let h=0;return i===10&&(h-=1e4),s&&(h+=150),i!==40&&i!==65288||(h+=50),t!==41&&t!==65289||(h+=50),h}function hp(i,t,s,h,d,_){let v=null,b=up(t,s,d,_);for(const k of h){const I=up(t-k.x,s,d,_)+k.badness;I<=b&&(v=k,b=I)}return{index:i,x:t,priorBreak:v,badness:b}}function fp(i){return i?fp(i.priorBreak).concat(i.index):[]}function Bf(i,t,s,h,d,_,v){if(_!=="point")return[];if(!i)return[];const b=[],k=function(G,W,X,ne,ge,we){let Re=0;for(let ke=0;ke<G.length();ke++){const Ne=G.getSection(ke);Re+=cp(G.getCharCode(ke),Ne,ne,ge,W,we)}return Re/Math.max(1,Math.ceil(Re/X))}(i,t,s,h,d,v),I=i.text.indexOf("​")>=0;let D=0;for(let G=0;G<i.length();G++){const W=i.getSection(G),X=i.getCharCode(G);if(lh[X]||(D+=cp(X,W,h,d,t,v)),G<i.length()-1){const ne=!((B=X)<11904||!(Ct["Bopomofo Extended"](B)||Ct.Bopomofo(B)||Ct["CJK Compatibility Forms"](B)||Ct["CJK Compatibility Ideographs"](B)||Ct["CJK Compatibility"](B)||Ct["CJK Radicals Supplement"](B)||Ct["CJK Strokes"](B)||Ct["CJK Symbols and Punctuation"](B)||Ct["CJK Unified Ideographs Extension A"](B)||Ct["CJK Unified Ideographs"](B)||Ct["Enclosed CJK Letters and Months"](B)||Ct["Halfwidth and Fullwidth Forms"](B)||Ct.Hiragana(B)||Ct["Ideographic Description Characters"](B)||Ct["Kangxi Radicals"](B)||Ct["Katakana Phonetic Extensions"](B)||Ct.Katakana(B)||Ct["Vertical Forms"](B)||Ct["Yi Radicals"](B)||Ct["Yi Syllables"](B)));(Q_[X]||ne||W.imageName)&&b.push(hp(G+1,D,k,b,ey(X,i.getCharCode(G+1),ne&&I),!1))}}var B;return fp(hp(i.length(),D,k,b,0,!0))}function zf(i){let t=.5,s=.5;switch(i){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:t,verticalAlign:s}}function ty(i,t,s,h,d){if(!h&&!d)return;const _=i[s],v=(i[s].x+_.metrics.advance*_.scale)*h;for(let b=t;b<=s;b++)i[b].x-=v,i[b].y+=d}function ry(i,t,s){const{horizontalAlign:h,verticalAlign:d}=zf(s),_=t[0]-i.displaySize[0]*h,v=t[1]-i.displaySize[1]*d;return{image:i,top:v,bottom:v+i.displaySize[1],left:_,right:_+i.displaySize[0]}}function dp(i,t,s,h,d,_){const v=i.image;let b;if(v.content){const ge=v.content,we=v.pixelRatio||1;b=[ge[0]/we,ge[1]/we,v.displaySize[0]-ge[2]/we,v.displaySize[1]-ge[3]/we]}const k=t.left*_,I=t.right*_;let D,B,G,W;s==="width"||s==="both"?(W=d[0]+k-h[3],B=d[0]+I+h[1]):(W=d[0]+(k+I-v.displaySize[0])/2,B=W+v.displaySize[0]);const X=t.top*_,ne=t.bottom*_;return s==="height"||s==="both"?(D=d[1]+X-h[0],G=d[1]+ne+h[2]):(D=d[1]+(X+ne-v.displaySize[1])/2,G=D+v.displaySize[1]),{image:v,top:D,right:B,bottom:G,left:W,collisionPadding:b}}const Cc=255,Ln=128,Es=Cc*Ln;function pp(i,t){const{expression:s}=t;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new Dr(i+1))};if(s.kind==="source")return{kind:"source"};{const{zoomStops:h,interpolationType:d}=s;let _=0;for(;_<h.length&&h[_]<=i;)_++;_=Math.max(0,_-1);let v=_;for(;v<h.length&&h[v]<i+1;)v++;v=Math.min(h.length-1,v);const b=h[_],k=h[v];return s.kind==="composite"?{kind:"composite",minZoom:b,maxZoom:k,interpolationType:d}:{kind:"camera",minZoom:b,maxZoom:k,minSize:s.evaluate(new Dr(b)),maxSize:s.evaluate(new Dr(k)),interpolationType:d}}}function Nf(i,t,s){let h="never";const d=i.get(t);return d?h=d:i.get(s)&&(h="always"),h}const ay=bs.VectorTileFeature.types,iy=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ch(i,t,s,h,d,_,v,b,k,I,D,B,G){const W=b?Math.min(Es,Math.round(b[0])):0,X=b?Math.min(Es,Math.round(b[1])):0;i.emplaceBack(t,s,Math.round(32*h),Math.round(32*d),_,v,(W<<1)+(k?1:0),X,16*I,16*D,256*B,256*G)}function Uf(i,t,s){i.emplaceBack(t.x,t.y,s),i.emplaceBack(t.x,t.y,s),i.emplaceBack(t.x,t.y,s),i.emplaceBack(t.x,t.y,s)}function ny(i){for(const t of i.sections)if(ff(t.text))return!0;return!1}class Vf{constructor(t){this.layoutVertexArray=new cr,this.indexArray=new Ia,this.programConfigurations=t,this.segments=new Lr,this.dynamicLayoutVertexArray=new ir,this.opacityVertexArray=new hr,this.hasVisibleVertices=!1,this.placedSymbolArray=new Pe}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,s,h,d){this.isEmpty()||(h&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,O_.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,B_.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,iy,!0),this.opacityVertexBuffer.itemSize=1),(h||d)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}It("SymbolBuffers",Vf);class $f{constructor(t,s,h){this.layoutVertexArray=new t,this.layoutAttributes=s,this.indexArray=new h,this.segments=new Lr,this.collisionVertexArray=new Pr}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,z_.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}It("CollisionBuffers",$f);class cl{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(v=>v.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=yf([]),this.placementViewportMatrix=yf([]);const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=pp(this.zoom,s["text-size"]),this.iconSizeData=pp(this.zoom,s["icon-size"]);const h=this.layers[0].layout,d=h.get("symbol-sort-key"),_=h.get("symbol-z-order");this.canOverlap=Nf(h,"text-overlap","text-allow-overlap")!=="never"||Nf(h,"icon-overlap","icon-allow-overlap")!=="never"||h.get("text-ignore-placement")||h.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&!d.isConstant(),this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,h.get("symbol-placement")==="point"&&(this.writingModes=h.get("text-writing-mode").map(v=>o.ai[v])),this.stateDependentLayerIds=this.layers.filter(v=>v.isStateDependent()).map(v=>v.id),this.sourceID=t.sourceID}createArrays(){this.text=new Vf(new mn(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new Vf(new mn(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new Le,this.lineVertexArray=new qe,this.symbolInstances=new ye,this.textAnchorOffsets=new tt}calculateGlyphDependencies(t,s,h,d,_){for(let v=0;v<t.length;v++)if(s[t.charCodeAt(v)]=!0,(h||d)&&_){const b=Ec[t.charAt(v)];b&&(s[b.charCodeAt(0)]=!0)}}populate(t,s,h){const d=this.layers[0],_=d.layout,v=_.get("text-font"),b=_.get("text-field"),k=_.get("icon-image"),I=(b.value.kind!=="constant"||b.value.value instanceof Jr&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&(v.value.kind!=="constant"||v.value.value.length>0),D=k.value.kind!=="constant"||!!k.value.value||Object.keys(k.parameters).length>0,B=_.get("symbol-sort-key");if(this.features=[],!I&&!D)return;const G=s.iconDependencies,W=s.glyphDependencies,X=s.availableImages,ne=new Dr(this.zoom);for(const{feature:ge,id:we,index:Re,sourceLayerIndex:ke}of t){const Ne=d._featureFilter.needGeometry,Ge=no(ge,Ne);if(!d._featureFilter.filter(ne,Ge,h))continue;let at,At;if(Ne||(Ge.geometry=io(ge)),I){const kt=d.getValueAndResolveTokens("text-field",Ge,h,X),Et=Jr.factory(kt);ny(Et)&&(this.hasRTLText=!0),(!this.hasRTLText||ic()==="unavailable"||this.hasRTLText&&gi.isParsed())&&(at=U_(Et,d,Ge))}if(D){const kt=d.getValueAndResolveTokens("icon-image",Ge,h,X);At=kt instanceof Aa?kt:Aa.fromString(kt)}if(!at&&!At)continue;const Rt=this.sortFeaturesByKey?B.evaluate(Ge,{},h):void 0;if(this.features.push({id:we,text:at,icon:At,index:Re,sourceLayerIndex:ke,geometry:Ge.geometry,properties:ge.properties,type:ay[ge.type],sortKey:Rt}),At&&(G[At.name]=!0),at){const kt=v.evaluate(Ge,{},h).join(","),Et=_.get("text-rotation-alignment")!=="viewport"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(o.ai.vertical)>=0;for(const yt of at.sections)if(yt.image)G[yt.image.name]=!0;else{const Pt=Kl(at.toString()),bt=yt.fontStack||kt,pt=W[bt]=W[bt]||{};this.calculateGlyphDependencies(yt.text,pt,Et,this.allowVerticalPlacement,Pt)}}}_.get("symbol-placement")==="line"&&(this.features=function(ge){const we={},Re={},ke=[];let Ne=0;function Ge(kt){ke.push(ge[kt]),Ne++}function at(kt,Et,yt){const Pt=Re[kt];return delete Re[kt],Re[Et]=Pt,ke[Pt].geometry[0].pop(),ke[Pt].geometry[0]=ke[Pt].geometry[0].concat(yt[0]),Pt}function At(kt,Et,yt){const Pt=we[Et];return delete we[Et],we[kt]=Pt,ke[Pt].geometry[0].shift(),ke[Pt].geometry[0]=yt[0].concat(ke[Pt].geometry[0]),Pt}function Rt(kt,Et,yt){const Pt=yt?Et[0][Et[0].length-1]:Et[0][0];return`${kt}:${Pt.x}:${Pt.y}`}for(let kt=0;kt<ge.length;kt++){const Et=ge[kt],yt=Et.geometry,Pt=Et.text?Et.text.toString():null;if(!Pt){Ge(kt);continue}const bt=Rt(Pt,yt),pt=Rt(Pt,yt,!0);if(bt in Re&&pt in we&&Re[bt]!==we[pt]){const $t=At(bt,pt,yt),Bt=at(bt,pt,ke[$t].geometry);delete we[bt],delete Re[pt],Re[Rt(Pt,ke[Bt].geometry,!0)]=Bt,ke[$t].geometry=null}else bt in Re?at(bt,pt,yt):pt in we?At(bt,pt,yt):(Ge(kt),we[bt]=Ne-1,Re[pt]=Ne-1)}return ke.filter(kt=>kt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ge,we)=>ge.sortKey-we.sortKey)}update(t,s,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,s,this.layers,h),this.icon.programConfigurations.updatePaintArrays(t,s,this.layers,h))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,s){const h=this.lineVertexArray.length;if(t.segment!==void 0){let d=t.dist(s[t.segment+1]),_=t.dist(s[t.segment]);const v={};for(let b=t.segment+1;b<s.length;b++)v[b]={x:s[b].x,y:s[b].y,tileUnitDistanceFromAnchor:d},b<s.length-1&&(d+=s[b+1].dist(s[b]));for(let b=t.segment||0;b>=0;b--)v[b]={x:s[b].x,y:s[b].y,tileUnitDistanceFromAnchor:_},b>0&&(_+=s[b-1].dist(s[b]));for(let b=0;b<s.length;b++){const k=v[b];this.lineVertexArray.emplaceBack(k.x,k.y,k.tileUnitDistanceFromAnchor)}}return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}}addSymbols(t,s,h,d,_,v,b,k,I,D,B,G){const W=t.indexArray,X=t.layoutVertexArray,ne=t.segments.prepareSegment(4*s.length,X,W,this.canOverlap?v.sortKey:void 0),ge=this.glyphOffsetArray.length,we=ne.vertexLength,Re=this.allowVerticalPlacement&&b===o.ai.vertical?Math.PI/2:0,ke=v.text&&v.text.sections;for(let Ne=0;Ne<s.length;Ne++){const{tl:Ge,tr:at,bl:At,br:Rt,tex:kt,pixelOffsetTL:Et,pixelOffsetBR:yt,minFontScaleX:Pt,minFontScaleY:bt,glyphOffset:pt,isSDF:$t,sectionIndex:Bt}=s[Ne],sr=ne.vertexLength,Rr=pt[1];ch(X,k.x,k.y,Ge.x,Rr+Ge.y,kt.x,kt.y,h,$t,Et.x,Et.y,Pt,bt),ch(X,k.x,k.y,at.x,Rr+at.y,kt.x+kt.w,kt.y,h,$t,yt.x,Et.y,Pt,bt),ch(X,k.x,k.y,At.x,Rr+At.y,kt.x,kt.y+kt.h,h,$t,Et.x,yt.y,Pt,bt),ch(X,k.x,k.y,Rt.x,Rr+Rt.y,kt.x+kt.w,kt.y+kt.h,h,$t,yt.x,yt.y,Pt,bt),Uf(t.dynamicLayoutVertexArray,k,Re),W.emplaceBack(sr,sr+1,sr+2),W.emplaceBack(sr+1,sr+2,sr+3),ne.vertexLength+=4,ne.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(pt[0]),Ne!==s.length-1&&Bt===s[Ne+1].sectionIndex||t.programConfigurations.populatePaintArrays(X.length,v,v.index,{},G,ke&&ke[Bt])}t.placedSymbolArray.emplaceBack(k.x,k.y,ge,this.glyphOffsetArray.length-ge,we,I,D,k.segment,h?h[0]:0,h?h[1]:0,d[0],d[1],b,0,!1,0,B)}_addCollisionDebugVertex(t,s,h,d,_,v){return s.emplaceBack(0,0),t.emplaceBack(h.x,h.y,d,_,Math.round(v.x),Math.round(v.y))}addCollisionDebugVertices(t,s,h,d,_,v,b){const k=_.segments.prepareSegment(4,_.layoutVertexArray,_.indexArray),I=k.vertexLength,D=_.layoutVertexArray,B=_.collisionVertexArray,G=b.anchorX,W=b.anchorY;this._addCollisionDebugVertex(D,B,v,G,W,new M(t,s)),this._addCollisionDebugVertex(D,B,v,G,W,new M(h,s)),this._addCollisionDebugVertex(D,B,v,G,W,new M(h,d)),this._addCollisionDebugVertex(D,B,v,G,W,new M(t,d)),k.vertexLength+=4;const X=_.indexArray;X.emplaceBack(I,I+1),X.emplaceBack(I+1,I+2),X.emplaceBack(I+2,I+3),X.emplaceBack(I+3,I),k.primitiveLength+=4}addDebugCollisionBoxes(t,s,h,d){for(let _=t;_<s;_++){const v=this.collisionBoxArray.get(_);this.addCollisionDebugVertices(v.x1,v.y1,v.x2,v.y2,d?this.textCollisionBox:this.iconCollisionBox,v.anchorPoint,h)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new $f(ea,Jd.members,ma),this.iconCollisionBox=new $f(ea,Jd.members,ma);for(let t=0;t<this.symbolInstances.length;t++){const s=this.symbolInstances.get(t);this.addDebugCollisionBoxes(s.textBoxStartIndex,s.textBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.iconBoxStartIndex,s.iconBoxEndIndex,s,!1),this.addDebugCollisionBoxes(s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s,!1)}}_deserializeCollisionBoxesForSymbol(t,s,h,d,_,v,b,k,I){const D={};for(let B=s;B<h;B++){const G=t.get(B);D.textBox={x1:G.x1,y1:G.y1,x2:G.x2,y2:G.y2,anchorPointX:G.anchorPointX,anchorPointY:G.anchorPointY},D.textFeatureIndex=G.featureIndex;break}for(let B=d;B<_;B++){const G=t.get(B);D.verticalTextBox={x1:G.x1,y1:G.y1,x2:G.x2,y2:G.y2,anchorPointX:G.anchorPointX,anchorPointY:G.anchorPointY},D.verticalTextFeatureIndex=G.featureIndex;break}for(let B=v;B<b;B++){const G=t.get(B);D.iconBox={x1:G.x1,y1:G.y1,x2:G.x2,y2:G.y2,anchorPointX:G.anchorPointX,anchorPointY:G.anchorPointY},D.iconFeatureIndex=G.featureIndex;break}for(let B=k;B<I;B++){const G=t.get(B);D.verticalIconBox={x1:G.x1,y1:G.y1,x2:G.x2,y2:G.y2,anchorPointX:G.anchorPointX,anchorPointY:G.anchorPointY},D.verticalIconFeatureIndex=G.featureIndex;break}return D}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const h=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,s){const h=t.placedSymbolArray.get(s),d=h.vertexStartIndex+4*h.numGlyphs;for(let _=h.vertexStartIndex;_<d;_+=4)t.indexArray.emplaceBack(_,_+1,_+2),t.indexArray.emplaceBack(_+1,_+2,_+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const s=Math.sin(t),h=Math.cos(t),d=[],_=[],v=[];for(let b=0;b<this.symbolInstances.length;++b){v.push(b);const k=this.symbolInstances.get(b);d.push(0|Math.round(s*k.anchorX+h*k.anchorY)),_.push(k.featureIndex)}return v.sort((b,k)=>d[b]-d[k]||_[k]-_[b]),v}addToSortKeyRanges(t,s){const h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===s?h.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const h=this.symbolInstances.get(s);this.featureSortOrder.push(h.featureIndex),[h.rightJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.leftJustifiedTextSymbolIndex].forEach((d,_,v)=>{d>=0&&v.indexOf(d)===_&&this.addIndicesForPlacedSymbol(this.text,d)}),h.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,h.verticalPlacedTextSymbolIndex),h.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.placedIconSymbolIndex),h.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let mp,gp;It("SymbolBucket",cl,{omit:["layers","collisionBoxArray","features","compareText"]}),cl.MAX_GLYPHS=65535,cl.addDynamicAttributes=Uf;var jf={get paint(){return gp=gp||new sa({"icon-opacity":new Gt(Xe.paint_symbol["icon-opacity"]),"icon-color":new Gt(Xe.paint_symbol["icon-color"]),"icon-halo-color":new Gt(Xe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Gt(Xe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Gt(Xe.paint_symbol["icon-halo-blur"]),"icon-translate":new zt(Xe.paint_symbol["icon-translate"]),"icon-translate-anchor":new zt(Xe.paint_symbol["icon-translate-anchor"]),"text-opacity":new Gt(Xe.paint_symbol["text-opacity"]),"text-color":new Gt(Xe.paint_symbol["text-color"],{runtimeType:Br,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new Gt(Xe.paint_symbol["text-halo-color"]),"text-halo-width":new Gt(Xe.paint_symbol["text-halo-width"]),"text-halo-blur":new Gt(Xe.paint_symbol["text-halo-blur"]),"text-translate":new zt(Xe.paint_symbol["text-translate"]),"text-translate-anchor":new zt(Xe.paint_symbol["text-translate-anchor"])})},get layout(){return mp=mp||new sa({"symbol-placement":new zt(Xe.layout_symbol["symbol-placement"]),"symbol-spacing":new zt(Xe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new zt(Xe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Gt(Xe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new zt(Xe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new zt(Xe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new zt(Xe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new zt(Xe.layout_symbol["icon-ignore-placement"]),"icon-optional":new zt(Xe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new zt(Xe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Gt(Xe.layout_symbol["icon-size"]),"icon-text-fit":new zt(Xe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new zt(Xe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Gt(Xe.layout_symbol["icon-image"]),"icon-rotate":new Gt(Xe.layout_symbol["icon-rotate"]),"icon-padding":new Gt(Xe.layout_symbol["icon-padding"]),"icon-keep-upright":new zt(Xe.layout_symbol["icon-keep-upright"]),"icon-offset":new Gt(Xe.layout_symbol["icon-offset"]),"icon-anchor":new Gt(Xe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new zt(Xe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new zt(Xe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new zt(Xe.layout_symbol["text-rotation-alignment"]),"text-field":new Gt(Xe.layout_symbol["text-field"]),"text-font":new Gt(Xe.layout_symbol["text-font"]),"text-size":new Gt(Xe.layout_symbol["text-size"]),"text-max-width":new Gt(Xe.layout_symbol["text-max-width"]),"text-line-height":new zt(Xe.layout_symbol["text-line-height"]),"text-letter-spacing":new Gt(Xe.layout_symbol["text-letter-spacing"]),"text-justify":new Gt(Xe.layout_symbol["text-justify"]),"text-radial-offset":new Gt(Xe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new zt(Xe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Gt(Xe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Gt(Xe.layout_symbol["text-anchor"]),"text-max-angle":new zt(Xe.layout_symbol["text-max-angle"]),"text-writing-mode":new zt(Xe.layout_symbol["text-writing-mode"]),"text-rotate":new Gt(Xe.layout_symbol["text-rotate"]),"text-padding":new zt(Xe.layout_symbol["text-padding"]),"text-keep-upright":new zt(Xe.layout_symbol["text-keep-upright"]),"text-transform":new Gt(Xe.layout_symbol["text-transform"]),"text-offset":new Gt(Xe.layout_symbol["text-offset"]),"text-allow-overlap":new zt(Xe.layout_symbol["text-allow-overlap"]),"text-overlap":new zt(Xe.layout_symbol["text-overlap"]),"text-ignore-placement":new zt(Xe.layout_symbol["text-ignore-placement"]),"text-optional":new zt(Xe.layout_symbol["text-optional"])})}};class xp{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:rr,this.defaultValue=t}evaluate(t){if(t.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(t.formattedSection))return s.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}It("FormatSectionOverride",xp,{omit:["defaultValue"]});class uh extends Pi{constructor(t){super(t,jf)}recalculate(t,s){if(super.recalculate(t,s),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const h=this.layout.get("text-writing-mode");if(h){const d=[];for(const _ of h)d.indexOf(_)<0&&d.push(_);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,s,h,d){const _=this.layout.get(t).evaluate(s,{},h,d),v=this._unevaluatedLayout._values[t];return v.isDataDriven()||jo(v.value)||!_?_:function(b,k){return k.replace(/{([^{}]+)}/g,(I,D)=>b&&D in b?String(b[D]):"")}(s.properties,_)}createBucket(t){return new cl(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of jf.paint.overridableProperties){if(!uh.hasPaintOverride(this.layout,t))continue;const s=this.paint.get(t),h=new xp(s),d=new Gl(h,s.property.specification);let _=null;_=s.value.kind==="constant"||s.value.kind==="source"?new Hl("source",d):new Ho("composite",d,s.value.zoomStops),this.paint._values[t]=new Va(s.property,_,s.parameters)}}_handleOverridablePaintPropertyUpdate(t,s,h){return!(!this.layout||s.isDataDriven()||h.isDataDriven())&&uh.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,s){const h=t.get("text-field"),d=jf.paint.properties[s];let _=!1;const v=b=>{for(const k of b)if(d.overrides&&d.overrides.hasOverride(k))return void(_=!0)};if(h.value.kind==="constant"&&h.value.value instanceof Jr)v(h.value.value.sections);else if(h.value.kind==="source"){const b=I=>{_||(I instanceof $n&&jr(I.value)===ce?v(I.value.sections):I instanceof $o?v(I.sections):I.eachChild(b))},k=h.value;k._styleExpression&&b(k._styleExpression.expression)}return _}}let _p;var sy={get paint(){return _p=_p||new sa({"background-color":new zt(Xe.paint_background["background-color"]),"background-pattern":new sc(Xe.paint_background["background-pattern"]),"background-opacity":new zt(Xe.paint_background["background-opacity"])})}};class oy extends Pi{constructor(t){super(t,sy)}}let yp;var ly={get paint(){return yp=yp||new sa({"raster-opacity":new zt(Xe.paint_raster["raster-opacity"]),"raster-hue-rotate":new zt(Xe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new zt(Xe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new zt(Xe.paint_raster["raster-brightness-max"]),"raster-saturation":new zt(Xe.paint_raster["raster-saturation"]),"raster-contrast":new zt(Xe.paint_raster["raster-contrast"]),"raster-resampling":new zt(Xe.paint_raster["raster-resampling"]),"raster-fade-duration":new zt(Xe.paint_raster["raster-fade-duration"])})}};class cy extends Pi{constructor(t){super(t,ly)}}class uy extends Pi{constructor(t){super(t,{}),this.onAdd=s=>{this.implementation.onAdd&&this.implementation.onAdd(s,s.painter.context.gl)},this.onRemove=s=>{this.implementation.onRemove&&this.implementation.onRemove(s,s.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class hy{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Gf=63710088e-1;class Ss{constructor(t,s){if(isNaN(t)||isNaN(s))throw new Error(`Invalid LngLat object: (${t}, ${s})`);if(this.lng=+t,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ss(re(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const s=Math.PI/180,h=this.lat*s,d=t.lat*s,_=Math.sin(h)*Math.sin(d)+Math.cos(h)*Math.cos(d)*Math.cos((t.lng-this.lng)*s);return Gf*Math.acos(Math.min(_,1))}static convert(t){if(t instanceof Ss)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Ss(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Ss(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const vp=2*Math.PI*Gf;function wp(i){return vp*Math.cos(i*Math.PI/180)}function bp(i){return(180+i)/360}function Tp(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Ep(i,t){return i/wp(t)}function Sp(i){return 360*i-180}function Hf(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class hh{constructor(t,s,h=0){this.x=+t,this.y=+s,this.z=+h}static fromLngLat(t,s=0){const h=Ss.convert(t);return new hh(bp(h.lng),Tp(h.lat),Ep(s,h.lat))}toLngLat(){return new Ss(Sp(this.x),Hf(this.y))}toAltitude(){return this.z*wp(Hf(this.y))}meterInMercatorCoordinateUnits(){return 1/vp*(t=Hf(this.y),1/Math.cos(t*Math.PI/180));var t}}function kp(i,t,s){var h=2*Math.PI*6378137/256/Math.pow(2,s);return[i*h-2*Math.PI*6378137/2,t*h-2*Math.PI*6378137/2]}class qf{constructor(t,s,h){if(t<0||t>25||h<0||h>=Math.pow(2,t)||s<0||s>=Math.pow(2,t))throw new Error(`x=${s}, y=${h}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=s,this.y=h,this.key=Ac(0,t,t,s,h)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,s,h){const d=(v=this.y,b=this.z,k=kp(256*(_=this.x),256*(v=Math.pow(2,b)-v-1),b),I=kp(256*(_+1),256*(v+1),b),k[0]+","+k[1]+","+I[0]+","+I[1]);var _,v,b,k,I;const D=function(B,G,W){let X,ne="";for(let ge=B;ge>0;ge--)X=1<<ge-1,ne+=(G&X?1:0)+(W&X?2:0);return ne}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(h==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,s>1?"@2x":"").replace(/{quadkey}/g,D).replace(/{bbox-epsg-3857}/g,d)}isChildOf(t){const s=this.z-t.z;return s>0&&t.x===this.x>>s&&t.y===this.y>>s}getTilePoint(t){const s=Math.pow(2,this.z);return new M((t.x*s-this.x)*ua,(t.y*s-this.y)*ua)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Cp{constructor(t,s){this.wrap=t,this.canonical=s,this.key=Ac(t,s.z,s.z,s.x,s.y)}}class Bi{constructor(t,s,h,d,_){if(t<h)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${h}`);this.overscaledZ=t,this.wrap=s,this.canonical=new qf(h,+d,+_),this.key=Ac(s,t,h,d,_)}clone(){return new Bi(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-t;return t>this.canonical.z?new Bi(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Bi(t,this.wrap,t,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(t,s){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const h=this.canonical.z-t;return t>this.canonical.z?Ac(this.wrap*+s,t,this.canonical.z,this.canonical.x,this.canonical.y):Ac(this.wrap*+s,t,t,this.canonical.x>>h,this.canonical.y>>h)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const s=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>s&&t.canonical.y===this.canonical.y>>s}children(t){if(this.overscaledZ>=t)return[new Bi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,h=2*this.canonical.x,d=2*this.canonical.y;return[new Bi(s,this.wrap,s,h,d),new Bi(s,this.wrap,s,h+1,d),new Bi(s,this.wrap,s,h,d+1),new Bi(s,this.wrap,s,h+1,d+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Bi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Bi(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Cp(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new hh(t.x-this.wrap,t.y))}}function Ac(i,t,s,h,d){(i*=2)<0&&(i=-1*i-1);const _=1<<s;return(_*_*i+_*d+h).toString(36)+s.toString(36)+t.toString(36)}It("CanonicalTileID",qf),It("OverscaledTileID",Bi,{omit:["posMatrix"]});class Ap{constructor(t,s,h,d=1,_=1,v=1,b=0){if(this.uid=t,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(h&&!["mapbox","terrarium","custom"].includes(h))return void ft(`"${h}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=s.height;const k=this.dim=s.height-2;switch(this.data=new Uint32Array(s.data.buffer),h){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=d,this.greenFactor=_,this.blueFactor=v,this.baseShift=b;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let I=0;I<k;I++)this.data[this._idx(-1,I)]=this.data[this._idx(0,I)],this.data[this._idx(k,I)]=this.data[this._idx(k-1,I)],this.data[this._idx(I,-1)]=this.data[this._idx(I,0)],this.data[this._idx(I,k)]=this.data[this._idx(I,k-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(k,-1)]=this.data[this._idx(k-1,0)],this.data[this._idx(-1,k)]=this.data[this._idx(0,k-1)],this.data[this._idx(k,k)]=this.data[this._idx(k-1,k-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let I=0;I<k;I++)for(let D=0;D<k;D++){const B=this.get(I,D);B>this.max&&(this.max=B),B<this.min&&(this.min=B)}}get(t,s){const h=new Uint8Array(this.data.buffer),d=4*this._idx(t,s);return this.unpack(h[d],h[d+1],h[d+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,s){if(t<-1||t>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(t+1)}unpack(t,s,h){return t*this.redFactor+s*this.greenFactor+h*this.blueFactor-this.baseShift}getPixels(){return new Oi({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,s,h){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let d=s*this.dim,_=s*this.dim+this.dim,v=h*this.dim,b=h*this.dim+this.dim;switch(s){case-1:d=_-1;break;case 1:_=d+1}switch(h){case-1:v=b-1;break;case 1:b=v+1}const k=-s*this.dim,I=-h*this.dim;for(let D=v;D<b;D++)for(let B=d;B<_;B++)this.data[this._idx(B,D)]=t.data[this._idx(B+k,D+I)]}}It("DEMData",Ap);class Ip{constructor(t){this._stringToNumber={},this._numberToString=[];for(let s=0;s<t.length;s++){const h=t[s];this._stringToNumber[h]=s,this._numberToString[s]=h}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class Fp{constructor(t,s,h,d,_){this.type="Feature",this._vectorTileFeature=t,t._z=s,t._x=h,t._y=d,this.properties=t.properties,this.id=_}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const s in this)s!=="_geometry"&&s!=="_vectorTileFeature"&&(t[s]=this[s]);return t}}class Pp{constructor(t,s){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new xs(ua,16,0),this.grid3D=new xs(ua,16,0),this.featureIndexArray=new ot,this.promoteId=s}insert(t,s,h,d,_,v){const b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,d,_);const k=v?this.grid3D:this.grid;for(let I=0;I<s.length;I++){const D=s[I],B=[1/0,1/0,-1/0,-1/0];for(let G=0;G<D.length;G++){const W=D[G];B[0]=Math.min(B[0],W.x),B[1]=Math.min(B[1],W.y),B[2]=Math.max(B[2],W.x),B[3]=Math.max(B[3],W.y)}B[0]<ua&&B[1]<ua&&B[2]>=0&&B[3]>=0&&k.insert(b,B[0],B[1],B[2],B[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new bs.VectorTile(new Lf(this.rawTileData)).layers,this.sourceLayerCoder=new Ip(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,s,h,d){this.loadVTLayers();const _=t.params||{},v=ua/t.tileSize/t.scale,b=Wl(_.filter),k=t.queryGeometry,I=t.queryPadding*v,D=Dp(k),B=this.grid.query(D.minX-I,D.minY-I,D.maxX+I,D.maxY+I),G=Dp(t.cameraQueryGeometry),W=this.grid3D.query(G.minX-I,G.minY-I,G.maxX+I,G.maxY+I,(ge,we,Re,ke)=>function(Ne,Ge,at,At,Rt){for(const Et of Ne)if(Ge<=Et.x&&at<=Et.y&&At>=Et.x&&Rt>=Et.y)return!0;const kt=[new M(Ge,at),new M(Ge,Rt),new M(At,Rt),new M(At,at)];if(Ne.length>2){for(const Et of kt)if(rl(Ne,Et))return!0}for(let Et=0;Et<Ne.length-1;Et++)if(jx(Ne[Et],Ne[Et+1],kt))return!0;return!1}(t.cameraQueryGeometry,ge-I,we-I,Re+I,ke+I));for(const ge of W)B.push(ge);B.sort(fy);const X={};let ne;for(let ge=0;ge<B.length;ge++){const we=B[ge];if(we===ne)continue;ne=we;const Re=this.featureIndexArray.get(we);let ke=null;this.loadMatchingFeature(X,Re.bucketIndex,Re.sourceLayerIndex,Re.featureIndex,b,_.layers,_.availableImages,s,h,d,(Ne,Ge,at)=>(ke||(ke=io(Ne)),Ge.queryIntersectsFeature(k,Ne,at,ke,this.z,t.transform,v,t.pixelPosMatrix)))}return X}loadMatchingFeature(t,s,h,d,_,v,b,k,I,D,B){const G=this.bucketLayerIDs[s];if(v&&!function(ge,we){for(let Re=0;Re<ge.length;Re++)if(we.indexOf(ge[Re])>=0)return!0;return!1}(v,G))return;const W=this.sourceLayerCoder.decode(h),X=this.vtLayers[W].feature(d);if(_.needGeometry){const ge=no(X,!0);if(!_.filter(new Dr(this.tileID.overscaledZ),ge,this.tileID.canonical))return}else if(!_.filter(new Dr(this.tileID.overscaledZ),X))return;const ne=this.getId(X,W);for(let ge=0;ge<G.length;ge++){const we=G[ge];if(v&&v.indexOf(we)<0)continue;const Re=k[we];if(!Re)continue;let ke={};ne&&D&&(ke=D.getState(Re.sourceLayer||"_geojsonTileLayer",ne));const Ne=Ce({},I[we]);Ne.paint=Mp(Ne.paint,Re.paint,X,ke,b),Ne.layout=Mp(Ne.layout,Re.layout,X,ke,b);const Ge=!B||B(X,Re,ke);if(!Ge)continue;const at=new Fp(X,this.z,this.x,this.y,ne);at.layer=Ne;let At=t[we];At===void 0&&(At=t[we]=[]),At.push({featureIndex:d,feature:at,intersectionZ:Ge})}}lookupSymbolFeatures(t,s,h,d,_,v,b,k){const I={};this.loadVTLayers();const D=Wl(_);for(const B of t)this.loadMatchingFeature(I,h,d,B,D,v,b,k,s);return I}hasLayer(t){for(const s of this.bucketLayerIDs)for(const h of s)if(t===h)return!0;return!1}getId(t,s){let h=t.id;return this.promoteId&&(h=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[s]],typeof h=="boolean"&&(h=Number(h))),h}}function Mp(i,t,s,h,d){return Fe(i,(_,v)=>{const b=t instanceof el?t.get(v):null;return b&&b.evaluate?b.evaluate(s,h,d):b})}function Dp(i){let t=1/0,s=1/0,h=-1/0,d=-1/0;for(const _ of i)t=Math.min(t,_.x),s=Math.min(s,_.y),h=Math.max(h,_.x),d=Math.max(d,_.y);return{minX:t,minY:s,maxX:h,maxY:d}}function fy(i,t){return t-i}function Lp(i,t,s,h,d){const _=[];for(let v=0;v<i.length;v++){const b=i[v];let k;for(let I=0;I<b.length-1;I++){let D=b[I],B=b[I+1];D.x<t&&B.x<t||(D.x<t?D=new M(t,D.y+(t-D.x)/(B.x-D.x)*(B.y-D.y))._round():B.x<t&&(B=new M(t,D.y+(t-D.x)/(B.x-D.x)*(B.y-D.y))._round()),D.y<s&&B.y<s||(D.y<s?D=new M(D.x+(s-D.y)/(B.y-D.y)*(B.x-D.x),s)._round():B.y<s&&(B=new M(D.x+(s-D.y)/(B.y-D.y)*(B.x-D.x),s)._round()),D.x>=h&&B.x>=h||(D.x>=h?D=new M(h,D.y+(h-D.x)/(B.x-D.x)*(B.y-D.y))._round():B.x>=h&&(B=new M(h,D.y+(h-D.x)/(B.x-D.x)*(B.y-D.y))._round()),D.y>=d&&B.y>=d||(D.y>=d?D=new M(D.x+(d-D.y)/(B.y-D.y)*(B.x-D.x),d)._round():B.y>=d&&(B=new M(D.x+(d-D.y)/(B.y-D.y)*(B.x-D.x),d)._round()),k&&D.equals(k[k.length-1])||(k=[D],_.push(k)),k.push(B)))))}}return _}It("FeatureIndex",Pp,{omit:["rawTileData","sourceLayerCoder"]});class ks extends M{constructor(t,s,h,d){super(t,s),this.angle=h,d!==void 0&&(this.segment=d)}clone(){return new ks(this.x,this.y,this.angle,this.segment)}}function Rp(i,t,s,h,d){if(t.segment===void 0||s===0)return!0;let _=t,v=t.segment+1,b=0;for(;b>-s/2;){if(v--,v<0)return!1;b-=i[v].dist(_),_=i[v]}b+=i[v].dist(i[v+1]),v++;const k=[];let I=0;for(;b<s/2;){const D=i[v],B=i[v+1];if(!B)return!1;let G=i[v-1].angleTo(D)-D.angleTo(B);for(G=Math.abs((G+3*Math.PI)%(2*Math.PI)-Math.PI),k.push({distance:b,angleDelta:G}),I+=G;b-k[0].distance>h;)I-=k.shift().angleDelta;if(I>d)return!1;v++,b+=D.dist(B)}return!0}function Op(i){let t=0;for(let s=0;s<i.length-1;s++)t+=i[s].dist(i[s+1]);return t}function Bp(i,t,s){return i?.6*t*s:0}function zp(i,t){return Math.max(i?i.right-i.left:0,t?t.right-t.left:0)}function dy(i,t,s,h,d,_){const v=Bp(s,d,_),b=zp(s,h)*_;let k=0;const I=Op(i)/2;for(let D=0;D<i.length-1;D++){const B=i[D],G=i[D+1],W=B.dist(G);if(k+W>I){const X=(I-k)/W,ne=di.number(B.x,G.x,X),ge=di.number(B.y,G.y,X),we=new ks(ne,ge,G.angleTo(B),D);return we._round(),!v||Rp(i,we,b,v,t)?we:void 0}k+=W}}function py(i,t,s,h,d,_,v,b,k){const I=Bp(h,_,v),D=zp(h,d),B=D*v,G=i[0].x===0||i[0].x===k||i[0].y===0||i[0].y===k;return t-B<t/4&&(t=B+t/4),Np(i,G?t/2*b%t:(D/2+2*_)*v*b%t,t,I,s,B,G,!1,k)}function Np(i,t,s,h,d,_,v,b,k){const I=_/2,D=Op(i);let B=0,G=t-s,W=[];for(let X=0;X<i.length-1;X++){const ne=i[X],ge=i[X+1],we=ne.dist(ge),Re=ge.angleTo(ne);for(;G+s<B+we;){G+=s;const ke=(G-B)/we,Ne=di.number(ne.x,ge.x,ke),Ge=di.number(ne.y,ge.y,ke);if(Ne>=0&&Ne<k&&Ge>=0&&Ge<k&&G-I>=0&&G+I<=D){const at=new ks(Ne,Ge,Re,X);at._round(),h&&!Rp(i,at,_,h,d)||W.push(at)}}B+=we}return b||W.length||v||(W=Np(i,B/2,s,h,d,_,v,!0,k)),W}It("Anchor",ks);const ul=_i;function Up(i,t,s,h){const d=[],_=i.image,v=_.pixelRatio,b=_.paddedRect.w-2*ul,k=_.paddedRect.h-2*ul,I=i.right-i.left,D=i.bottom-i.top,B=_.stretchX||[[0,b]],G=_.stretchY||[[0,k]],W=(yt,Pt)=>yt+Pt[1]-Pt[0],X=B.reduce(W,0),ne=G.reduce(W,0),ge=b-X,we=k-ne;let Re=0,ke=X,Ne=0,Ge=ne,at=0,At=ge,Rt=0,kt=we;if(_.content&&h){const yt=_.content;Re=fh(B,0,yt[0]),Ne=fh(G,0,yt[1]),ke=fh(B,yt[0],yt[2]),Ge=fh(G,yt[1],yt[3]),at=yt[0]-Re,Rt=yt[1]-Ne,At=yt[2]-yt[0]-ke,kt=yt[3]-yt[1]-Ge}const Et=(yt,Pt,bt,pt)=>{const $t=dh(yt.stretch-Re,ke,I,i.left),Bt=ph(yt.fixed-at,At,yt.stretch,X),sr=dh(Pt.stretch-Ne,Ge,D,i.top),Rr=ph(Pt.fixed-Rt,kt,Pt.stretch,ne),Ur=dh(bt.stretch-Re,ke,I,i.left),_a=ph(bt.fixed-at,At,bt.stretch,X),Di=dh(pt.stretch-Ne,Ge,D,i.top),ri=ph(pt.fixed-Rt,kt,pt.stretch,ne),ha=new M($t,sr),Pa=new M(Ur,sr),Ba=new M(Ur,Di),ai=new M($t,Di),ii=new M(Bt/v,Rr/v),ya=new M(_a/v,ri/v),va=t*Math.PI/180;if(va){const Ga=Math.sin(va),yi=Math.cos(va),vi=[yi,-Ga,Ga,yi];ha._matMult(vi),Pa._matMult(vi),ai._matMult(vi),Ba._matMult(vi)}const ja=yt.stretch+yt.fixed,ni=Pt.stretch+Pt.fixed;return{tl:ha,tr:Pa,bl:ai,br:Ba,tex:{x:_.paddedRect.x+ul+ja,y:_.paddedRect.y+ul+ni,w:bt.stretch+bt.fixed-ja,h:pt.stretch+pt.fixed-ni},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ii,pixelOffsetBR:ya,minFontScaleX:At/v/I,minFontScaleY:kt/v/D,isSDF:s}};if(h&&(_.stretchX||_.stretchY)){const yt=Vp(B,ge,X),Pt=Vp(G,we,ne);for(let bt=0;bt<yt.length-1;bt++){const pt=yt[bt],$t=yt[bt+1];for(let Bt=0;Bt<Pt.length-1;Bt++)d.push(Et(pt,Pt[Bt],$t,Pt[Bt+1]))}}else d.push(Et({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:k+1}));return d}function fh(i,t,s){let h=0;for(const d of i)h+=Math.max(t,Math.min(s,d[1]))-Math.max(t,Math.min(s,d[0]));return h}function Vp(i,t,s){const h=[{fixed:-ul,stretch:0}];for(const[d,_]of i){const v=h[h.length-1];h.push({fixed:d-v.stretch,stretch:v.stretch}),h.push({fixed:d-v.stretch,stretch:v.stretch+(_-d)})}return h.push({fixed:t+ul,stretch:s}),h}function dh(i,t,s,h){return i/t*s+h}function ph(i,t,s,h){return i-t*s/h}class mh{constructor(t,s,h,d,_,v,b,k,I,D){if(this.boxStartIndex=t.length,I){let B=v.top,G=v.bottom;const W=v.collisionPadding;W&&(B-=W[1],G+=W[3]);let X=G-B;X>0&&(X=Math.max(10,X),this.circleDiameter=X)}else{let B=v.top*b-k[0],G=v.bottom*b+k[2],W=v.left*b-k[3],X=v.right*b+k[1];const ne=v.collisionPadding;if(ne&&(W-=ne[0]*b,B-=ne[1]*b,X+=ne[2]*b,G+=ne[3]*b),D){const ge=new M(W,B),we=new M(X,B),Re=new M(W,G),ke=new M(X,G),Ne=D*Math.PI/180;ge._rotate(Ne),we._rotate(Ne),Re._rotate(Ne),ke._rotate(Ne),W=Math.min(ge.x,we.x,Re.x,ke.x),X=Math.max(ge.x,we.x,Re.x,ke.x),B=Math.min(ge.y,we.y,Re.y,ke.y),G=Math.max(ge.y,we.y,Re.y,ke.y)}t.emplaceBack(s.x,s.y,W,B,X,G,h,d,_)}this.boxEndIndex=t.length}}class my{constructor(t=[],s=gy){if(this.data=t,this.length=this.data.length,this.compare=s,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const t=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:s,compare:h}=this,d=s[t];for(;t>0;){const _=t-1>>1,v=s[_];if(h(d,v)>=0)break;s[t]=v,t=_}s[t]=d}_down(t){const{data:s,compare:h}=this,d=this.length>>1,_=s[t];for(;t<d;){let v=1+(t<<1),b=s[v];const k=v+1;if(k<this.length&&h(s[k],b)<0&&(v=k,b=s[k]),h(b,_)>=0)break;s[t]=b,t=v}s[t]=_}}function gy(i,t){return i<t?-1:i>t?1:0}function xy(i,t=1,s=!1){let h=1/0,d=1/0,_=-1/0,v=-1/0;const b=i[0];for(let W=0;W<b.length;W++){const X=b[W];(!W||X.x<h)&&(h=X.x),(!W||X.y<d)&&(d=X.y),(!W||X.x>_)&&(_=X.x),(!W||X.y>v)&&(v=X.y)}const k=Math.min(_-h,v-d);let I=k/2;const D=new my([],_y);if(k===0)return new M(h,d);for(let W=h;W<_;W+=k)for(let X=d;X<v;X+=k)D.push(new hl(W+I,X+I,I,i));let B=function(W){let X=0,ne=0,ge=0;const we=W[0];for(let Re=0,ke=we.length,Ne=ke-1;Re<ke;Ne=Re++){const Ge=we[Re],at=we[Ne],At=Ge.x*at.y-at.x*Ge.y;ne+=(Ge.x+at.x)*At,ge+=(Ge.y+at.y)*At,X+=3*At}return new hl(ne/X,ge/X,0,W)}(i),G=D.length;for(;D.length;){const W=D.pop();(W.d>B.d||!B.d)&&(B=W,s&&console.log("found best %d after %d probes",Math.round(1e4*W.d)/1e4,G)),W.max-B.d<=t||(I=W.h/2,D.push(new hl(W.p.x-I,W.p.y-I,I,i)),D.push(new hl(W.p.x+I,W.p.y-I,I,i)),D.push(new hl(W.p.x-I,W.p.y+I,I,i)),D.push(new hl(W.p.x+I,W.p.y+I,I,i)),G+=4)}return s&&(console.log(`num probes: ${G}`),console.log(`best distance: ${B.d}`)),B.p}function _y(i,t){return t.max-i.max}function hl(i,t,s,h){this.p=new M(i,t),this.h=s,this.d=function(d,_){let v=!1,b=1/0;for(let k=0;k<_.length;k++){const I=_[k];for(let D=0,B=I.length,G=B-1;D<B;G=D++){const W=I[D],X=I[G];W.y>d.y!=X.y>d.y&&d.x<(X.x-W.x)*(d.y-W.y)/(X.y-W.y)+W.x&&(v=!v),b=Math.min(b,Td(d,W,X))}}return(v?1:-1)*Math.sqrt(b)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}var Oa;o.aq=void 0,(Oa=o.aq||(o.aq={}))[Oa.center=1]="center",Oa[Oa.left=2]="left",Oa[Oa.right=3]="right",Oa[Oa.top=4]="top",Oa[Oa.bottom=5]="bottom",Oa[Oa["top-left"]=6]="top-left",Oa[Oa["top-right"]=7]="top-right",Oa[Oa["bottom-left"]=8]="bottom-left",Oa[Oa["bottom-right"]=9]="bottom-right";const Cs=7,Wf=Number.POSITIVE_INFINITY;function $p(i,t){return t[1]!==Wf?function(s,h,d){let _=0,v=0;switch(h=Math.abs(h),d=Math.abs(d),s){case"top-right":case"top-left":case"top":v=d-Cs;break;case"bottom-right":case"bottom-left":case"bottom":v=-d+Cs}switch(s){case"top-right":case"bottom-right":case"right":_=-h;break;case"top-left":case"bottom-left":case"left":_=h}return[_,v]}(i,t[0],t[1]):function(s,h){let d=0,_=0;h<0&&(h=0);const v=h/Math.SQRT2;switch(s){case"top-right":case"top-left":_=v-Cs;break;case"bottom-right":case"bottom-left":_=-v+Cs;break;case"bottom":_=-h+Cs;break;case"top":_=h-Cs}switch(s){case"top-right":case"bottom-right":d=-v;break;case"top-left":case"bottom-left":d=v;break;case"left":d=h;break;case"right":d=-h}return[d,_]}(i,t[0])}function jp(i,t,s){var h;const d=i.layout,_=(h=d.get("text-variable-anchor-offset"))===null||h===void 0?void 0:h.evaluate(t,{},s);if(_){const b=_.values,k=[];for(let I=0;I<b.length;I+=2){const D=k[I]=b[I],B=b[I+1].map(G=>G*xa);D.startsWith("top")?B[1]-=Cs:D.startsWith("bottom")&&(B[1]+=Cs),k[I+1]=B}return new Qr(k)}const v=d.get("text-variable-anchor");if(v){let b;b=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[d.get("text-radial-offset").evaluate(t,{},s)*xa,Wf]:d.get("text-offset").evaluate(t,{},s).map(I=>I*xa);const k=[];for(const I of v)k.push(I,$p(I,b));return new Qr(k)}return null}function Zf(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function yy(i,t,s,h,d,_,v,b,k,I,D){let B=_.textMaxSize.evaluate(t,{});B===void 0&&(B=v);const G=i.layers[0].layout,W=G.get("icon-offset").evaluate(t,{},D),X=Hp(s.horizontal),ne=v/24,ge=i.tilePixelRatio*ne,we=i.tilePixelRatio*B/24,Re=i.tilePixelRatio*b,ke=i.tilePixelRatio*G.get("symbol-spacing"),Ne=G.get("text-padding")*i.tilePixelRatio,Ge=function(pt,$t,Bt,sr=1){const Rr=pt.get("icon-padding").evaluate($t,{},Bt),Ur=Rr&&Rr.values;return[Ur[0]*sr,Ur[1]*sr,Ur[2]*sr,Ur[3]*sr]}(G,t,D,i.tilePixelRatio),at=G.get("text-max-angle")/180*Math.PI,At=G.get("text-rotation-alignment")!=="viewport"&&G.get("symbol-placement")!=="point",Rt=G.get("icon-rotation-alignment")==="map"&&G.get("symbol-placement")!=="point",kt=G.get("symbol-placement"),Et=ke/2,yt=G.get("icon-text-fit");let Pt;h&&yt!=="none"&&(i.allowVerticalPlacement&&s.vertical&&(Pt=dp(h,s.vertical,yt,G.get("icon-text-fit-padding"),W,ne)),X&&(h=dp(h,X,yt,G.get("icon-text-fit-padding"),W,ne)));const bt=(pt,$t)=>{$t.x<0||$t.x>=ua||$t.y<0||$t.y>=ua||function(Bt,sr,Rr,Ur,_a,Di,ri,ha,Pa,Ba,ai,ii,ya,va,ja,ni,Ga,yi,vi,wa,dr,Ha,za,ba,en){const gn=Bt.addToLineVertexArray(sr,Rr);let xn,ts,tn,zi,wi=0,rs=0,Pc=0,Xp=0,r0=-1,a0=-1;const as={};let Kp=Yn("");if(Bt.allowVerticalPlacement&&Ur.vertical){const qa=ha.layout.get("text-rotate").evaluate(dr,{},ba)+90;tn=new mh(Pa,sr,Ba,ai,ii,Ur.vertical,ya,va,ja,qa),ri&&(zi=new mh(Pa,sr,Ba,ai,ii,ri,Ga,yi,ja,qa))}if(_a){const qa=ha.layout.get("icon-rotate").evaluate(dr,{}),Ni=ha.layout.get("icon-text-fit")!=="none",oo=Up(_a,qa,za,Ni),yn=ri?Up(ri,qa,za,Ni):void 0;ts=new mh(Pa,sr,Ba,ai,ii,_a,Ga,yi,!1,qa),wi=4*oo.length;const lo=Bt.iconSizeData;let Rn=null;lo.kind==="source"?(Rn=[Ln*ha.layout.get("icon-size").evaluate(dr,{})],Rn[0]>Es&&ft(`${Bt.layerIds[0]}: Value for "icon-size" is >= ${Cc}. Reduce your "icon-size".`)):lo.kind==="composite"&&(Rn=[Ln*Ha.compositeIconSizes[0].evaluate(dr,{},ba),Ln*Ha.compositeIconSizes[1].evaluate(dr,{},ba)],(Rn[0]>Es||Rn[1]>Es)&&ft(`${Bt.layerIds[0]}: Value for "icon-size" is >= ${Cc}. Reduce your "icon-size".`)),Bt.addSymbols(Bt.icon,oo,Rn,wa,vi,dr,o.ai.none,sr,gn.lineStartIndex,gn.lineLength,-1,ba),r0=Bt.icon.placedSymbolArray.length-1,yn&&(rs=4*yn.length,Bt.addSymbols(Bt.icon,yn,Rn,wa,vi,dr,o.ai.vertical,sr,gn.lineStartIndex,gn.lineLength,-1,ba),a0=Bt.icon.placedSymbolArray.length-1)}const Yp=Object.keys(Ur.horizontal);for(const qa of Yp){const Ni=Ur.horizontal[qa];if(!xn){Kp=Yn(Ni.text);const yn=ha.layout.get("text-rotate").evaluate(dr,{},ba);xn=new mh(Pa,sr,Ba,ai,ii,Ni,ya,va,ja,yn)}const oo=Ni.positionedLines.length===1;if(Pc+=Gp(Bt,sr,Ni,Di,ha,ja,dr,ni,gn,Ur.vertical?o.ai.horizontal:o.ai.horizontalOnly,oo?Yp:[qa],as,r0,Ha,ba),oo)break}Ur.vertical&&(Xp+=Gp(Bt,sr,Ur.vertical,Di,ha,ja,dr,ni,gn,o.ai.vertical,["vertical"],as,a0,Ha,ba));const by=xn?xn.boxStartIndex:Bt.collisionBoxArray.length,Ty=xn?xn.boxEndIndex:Bt.collisionBoxArray.length,Ey=tn?tn.boxStartIndex:Bt.collisionBoxArray.length,Sy=tn?tn.boxEndIndex:Bt.collisionBoxArray.length,ky=ts?ts.boxStartIndex:Bt.collisionBoxArray.length,Cy=ts?ts.boxEndIndex:Bt.collisionBoxArray.length,Ay=zi?zi.boxStartIndex:Bt.collisionBoxArray.length,Iy=zi?zi.boxEndIndex:Bt.collisionBoxArray.length;let _n=-1;const xh=(qa,Ni)=>qa&&qa.circleDiameter?Math.max(qa.circleDiameter,Ni):Ni;_n=xh(xn,_n),_n=xh(tn,_n),_n=xh(ts,_n),_n=xh(zi,_n);const Jp=_n>-1?1:0;Jp&&(_n*=en/xa),Bt.glyphOffsetArray.length>=cl.MAX_GLYPHS&&ft("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),dr.sortKey!==void 0&&Bt.addToSortKeyRanges(Bt.symbolInstances.length,dr.sortKey);const Fy=jp(ha,dr,ba),[Py,My]=function(qa,Ni){const oo=qa.length,yn=Ni?.values;if(yn?.length>0)for(let lo=0;lo<yn.length;lo+=2){const Rn=yn[lo+1];qa.emplaceBack(o.aq[yn[lo]],Rn[0],Rn[1])}return[oo,qa.length]}(Bt.textAnchorOffsets,Fy);Bt.symbolInstances.emplaceBack(sr.x,sr.y,as.right>=0?as.right:-1,as.center>=0?as.center:-1,as.left>=0?as.left:-1,as.vertical||-1,r0,a0,Kp,by,Ty,Ey,Sy,ky,Cy,Ay,Iy,Ba,Pc,Xp,wi,rs,Jp,0,ya,_n,Py,My)}(i,$t,pt,s,h,d,Pt,i.layers[0],i.collisionBoxArray,t.index,t.sourceLayerIndex,i.index,ge,[Ne,Ne,Ne,Ne],At,k,Re,Ge,Rt,W,t,_,I,D,v)};if(kt==="line")for(const pt of Lp(t.geometry,0,0,ua,ua)){const $t=py(pt,ke,at,s.vertical||X,h,24,we,i.overscaling,ua);for(const Bt of $t)X&&vy(i,X.text,Et,Bt)||bt(pt,Bt)}else if(kt==="line-center"){for(const pt of t.geometry)if(pt.length>1){const $t=dy(pt,at,s.vertical||X,h,24,we);$t&&bt(pt,$t)}}else if(t.type==="Polygon")for(const pt of kf(t.geometry,0)){const $t=xy(pt,16);bt(pt[0],new ks($t.x,$t.y,0))}else if(t.type==="LineString")for(const pt of t.geometry)bt(pt,new ks(pt[0].x,pt[0].y,0));else if(t.type==="Point")for(const pt of t.geometry)for(const $t of pt)bt([$t],new ks($t.x,$t.y,0))}function Gp(i,t,s,h,d,_,v,b,k,I,D,B,G,W,X){const ne=function(Re,ke,Ne,Ge,at,At,Rt,kt){const Et=Ge.layout.get("text-rotate").evaluate(At,{})*Math.PI/180,yt=[];for(const Pt of ke.positionedLines)for(const bt of Pt.positionedGlyphs){if(!bt.rect)continue;const pt=bt.rect||{};let $t=sp+1,Bt=!0,sr=1,Rr=0;const Ur=(at||kt)&&bt.vertical,_a=bt.metrics.advance*bt.scale/2;if(kt&&ke.verticalizable&&(Rr=Pt.lineOffset/2-(bt.imageName?-(xa-bt.metrics.width*bt.scale)/2:(bt.scale-1)*xa)),bt.imageName){const wa=Rt[bt.imageName];Bt=wa.sdf,sr=wa.pixelRatio,$t=_i/sr}const Di=at?[bt.x+_a,bt.y]:[0,0];let ri=at?[0,0]:[bt.x+_a+Ne[0],bt.y+Ne[1]-Rr],ha=[0,0];Ur&&(ha=ri,ri=[0,0]);const Pa=bt.metrics.isDoubleResolution?2:1,Ba=(bt.metrics.left-$t)*bt.scale-_a+ri[0],ai=(-bt.metrics.top-$t)*bt.scale+ri[1],ii=Ba+pt.w/Pa*bt.scale/sr,ya=ai+pt.h/Pa*bt.scale/sr,va=new M(Ba,ai),ja=new M(ii,ai),ni=new M(Ba,ya),Ga=new M(ii,ya);if(Ur){const wa=new M(-_a,_a-Sc),dr=-Math.PI/2,Ha=xa/2-_a,za=new M(5-Sc-Ha,-(bt.imageName?Ha:0)),ba=new M(...ha);va._rotateAround(dr,wa)._add(za)._add(ba),ja._rotateAround(dr,wa)._add(za)._add(ba),ni._rotateAround(dr,wa)._add(za)._add(ba),Ga._rotateAround(dr,wa)._add(za)._add(ba)}if(Et){const wa=Math.sin(Et),dr=Math.cos(Et),Ha=[dr,-wa,wa,dr];va._matMult(Ha),ja._matMult(Ha),ni._matMult(Ha),Ga._matMult(Ha)}const yi=new M(0,0),vi=new M(0,0);yt.push({tl:va,tr:ja,bl:ni,br:Ga,tex:pt,writingMode:ke.writingMode,glyphOffset:Di,sectionIndex:bt.sectionIndex,isSDF:Bt,pixelOffsetTL:yi,pixelOffsetBR:vi,minFontScaleX:0,minFontScaleY:0})}return yt}(0,s,b,d,_,v,h,i.allowVerticalPlacement),ge=i.textSizeData;let we=null;ge.kind==="source"?(we=[Ln*d.layout.get("text-size").evaluate(v,{})],we[0]>Es&&ft(`${i.layerIds[0]}: Value for "text-size" is >= ${Cc}. Reduce your "text-size".`)):ge.kind==="composite"&&(we=[Ln*W.compositeTextSizes[0].evaluate(v,{},X),Ln*W.compositeTextSizes[1].evaluate(v,{},X)],(we[0]>Es||we[1]>Es)&&ft(`${i.layerIds[0]}: Value for "text-size" is >= ${Cc}. Reduce your "text-size".`)),i.addSymbols(i.text,ne,we,b,_,v,I,t,k.lineStartIndex,k.lineLength,G,X);for(const Re of D)B[Re]=i.text.placedSymbolArray.length-1;return 4*ne.length}function Hp(i){for(const t in i)return i[t];return null}function vy(i,t,s,h){const d=i.compareText;if(t in d){const _=d[t];for(let v=_.length-1;v>=0;v--)if(h.dist(_[v])<s)return!0}else d[t]=[];return d[t].push(h),!1}const qp=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Xf{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,h]=new Uint8Array(t,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");const d=h>>4;if(d!==1)throw new Error(`Got v${d} data when expected v1.`);const _=qp[15&h];if(!_)throw new Error("Unrecognized array type.");const[v]=new Uint16Array(t,2,1),[b]=new Uint32Array(t,4,1);return new Xf(b,v,_,t)}constructor(t,s=64,h=Float64Array,d){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=h,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const _=qp.indexOf(this.ArrayType),v=2*t*this.ArrayType.BYTES_PER_ELEMENT,b=t*this.IndexArrayType.BYTES_PER_ELEMENT,k=(8-b%8)%8;if(_<0)throw new Error(`Unexpected typed array class: ${h}.`);d&&d instanceof ArrayBuffer?(this.data=d,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+b+k,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+v+b+k),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+b+k,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+_]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=t)}add(t,s){const h=this._pos>>1;return this.ids[h]=h,this.coords[this._pos++]=t,this.coords[this._pos++]=s,h}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Kf(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,s,h,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:v,nodeSize:b}=this,k=[0,_.length-1,0],I=[];for(;k.length;){const D=k.pop()||0,B=k.pop()||0,G=k.pop()||0;if(B-G<=b){for(let ge=G;ge<=B;ge++){const we=v[2*ge],Re=v[2*ge+1];we>=t&&we<=h&&Re>=s&&Re<=d&&I.push(_[ge])}continue}const W=G+B>>1,X=v[2*W],ne=v[2*W+1];X>=t&&X<=h&&ne>=s&&ne<=d&&I.push(_[W]),(D===0?t<=X:s<=ne)&&(k.push(G),k.push(W-1),k.push(1-D)),(D===0?h>=X:d>=ne)&&(k.push(W+1),k.push(B),k.push(1-D))}return I}within(t,s,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:_,nodeSize:v}=this,b=[0,d.length-1,0],k=[],I=h*h;for(;b.length;){const D=b.pop()||0,B=b.pop()||0,G=b.pop()||0;if(B-G<=v){for(let ge=G;ge<=B;ge++)Zp(_[2*ge],_[2*ge+1],t,s)<=I&&k.push(d[ge]);continue}const W=G+B>>1,X=_[2*W],ne=_[2*W+1];Zp(X,ne,t,s)<=I&&k.push(d[W]),(D===0?t-h<=X:s-h<=ne)&&(b.push(G),b.push(W-1),b.push(1-D)),(D===0?t+h>=X:s+h>=ne)&&(b.push(W+1),b.push(B),b.push(1-D))}return k}}function Kf(i,t,s,h,d,_){if(d-h<=s)return;const v=h+d>>1;Wp(i,t,v,h,d,_),Kf(i,t,s,h,v-1,1-_),Kf(i,t,s,v+1,d,1-_)}function Wp(i,t,s,h,d,_){for(;d>h;){if(d-h>600){const I=d-h+1,D=s-h+1,B=Math.log(I),G=.5*Math.exp(2*B/3),W=.5*Math.sqrt(B*G*(I-G)/I)*(D-I/2<0?-1:1);Wp(i,t,s,Math.max(h,Math.floor(s-D*G/I+W)),Math.min(d,Math.floor(s+(I-D)*G/I+W)),_)}const v=t[2*s+_];let b=h,k=d;for(Ic(i,t,h,s),t[2*d+_]>v&&Ic(i,t,h,d);b<k;){for(Ic(i,t,b,k),b++,k--;t[2*b+_]<v;)b++;for(;t[2*k+_]>v;)k--}t[2*h+_]===v?Ic(i,t,h,k):(k++,Ic(i,t,k,d)),k<=s&&(h=k+1),s<=k&&(d=k-1)}}function Ic(i,t,s,h){Yf(i,s,h),Yf(t,2*s,2*h),Yf(t,2*s+1,2*h+1)}function Yf(i,t,s){const h=i[t];i[t]=i[s],i[s]=h}function Zp(i,t,s,h){const d=i-s,_=t-h;return d*d+_*_}var Jf;o.bh=void 0,(Jf=o.bh||(o.bh={})).create="create",Jf.load="load",Jf.fullLoad="fullLoad";let gh=null,Fc=[];const Qf=1e3/60,e0="loadTime",t0="fullLoadTime",wy={mark(i){performance.mark(i)},frame(i){const t=i;gh!=null&&Fc.push(t-gh),gh=t},clearMetrics(){gh=null,Fc=[],performance.clearMeasures(e0),performance.clearMeasures(t0);for(const i in o.bh)performance.clearMarks(o.bh[i])},getPerformanceMetrics(){performance.measure(e0,o.bh.create,o.bh.load),performance.measure(t0,o.bh.create,o.bh.fullLoad);const i=performance.getEntriesByName(e0)[0].duration,t=performance.getEntriesByName(t0)[0].duration,s=Fc.length,h=1/(Fc.reduce((_,v)=>_+v,0)/s/1e3),d=Fc.filter(_=>_>Qf).reduce((_,v)=>_+(v-Qf)/Qf,0);return{loadTime:i,fullLoadTime:t,fps:h,percentDroppedFrames:d/(s+d)*100,totalFrames:s}}};o.$=function(i,t,s){var h,d,_,v,b,k,I,D,B,G,W,X,ne=s[0],ge=s[1],we=s[2];return t===i?(i[12]=t[0]*ne+t[4]*ge+t[8]*we+t[12],i[13]=t[1]*ne+t[5]*ge+t[9]*we+t[13],i[14]=t[2]*ne+t[6]*ge+t[10]*we+t[14],i[15]=t[3]*ne+t[7]*ge+t[11]*we+t[15]):(d=t[1],_=t[2],v=t[3],b=t[4],k=t[5],I=t[6],D=t[7],B=t[8],G=t[9],W=t[10],X=t[11],i[0]=h=t[0],i[1]=d,i[2]=_,i[3]=v,i[4]=b,i[5]=k,i[6]=I,i[7]=D,i[8]=B,i[9]=G,i[10]=W,i[11]=X,i[12]=h*ne+b*ge+B*we+t[12],i[13]=d*ne+k*ge+G*we+t[13],i[14]=_*ne+I*ge+W*we+t[14],i[15]=v*ne+D*ge+X*we+t[15]),i},o.A=al,o.B=di,o.C=class{constructor(i,t,s){this.receive=h=>{const d=h.data,_=d.id;if(_&&(!d.targetMapId||this.mapId===d.targetMapId))if(d.type==="<cancel>"){delete this.tasks[_];const v=this.cancelCallbacks[_];delete this.cancelCallbacks[_],v&&v()}else nt()||d.mustQueue?(this.tasks[_]=d,this.taskQueue.push(_),this.invoker.trigger()):this.processTask(_,d)},this.process=()=>{if(!this.taskQueue.length)return;const h=this.taskQueue.shift(),d=this.tasks[h];delete this.tasks[h],this.taskQueue.length&&this.invoker.trigger(),d&&this.processTask(h,d)},this.target=i,this.parent=t,this.mapId=s,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new hy(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=nt()?i:window}send(i,t,s,h,d=!1){const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(this.callbacks[_]=s);const v=[],b={id:_,type:i,hasCallback:!!s,targetMapId:h,mustQueue:d,sourceMapId:this.mapId,data:Pn(t,v)};return this.target.postMessage(b,{transfer:v}),{cancel:()=>{s&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}processTask(i,t){if(t.type==="<response>"){const s=this.callbacks[i];delete this.callbacks[i],s&&(t.error?s(_s(t.error)):s(null,_s(t.data)))}else{let s=!1;const h=[],d=t.hasCallback?(b,k)=>{s=!0,delete this.cancelCallbacks[i];const I={id:i,type:"<response>",sourceMapId:this.mapId,error:b?Pn(b):null,data:Pn(k,h)};this.target.postMessage(I,{transfer:h})}:b=>{s=!0};let _=null;const v=_s(t.data);if(this.parent[t.type])_=this.parent[t.type](t.sourceMapId,v,d);else if("getWorkerSource"in this.parent){const b=t.type.split(".");_=this.parent.getWorkerSource(t.sourceMapId,b[0],v.source)[b[1]](v,d)}else d(new Error(`Could not find function ${t.type}`));!s&&_&&_.cancel&&(this.cancelCallbacks[i]=_.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.D=zt,o.E=Mr,o.F=function(i,t){const s={};for(let h=0;h<t.length;h++){const d=t[h];d in i&&(s[d]=i[d])}return s},o.G=bp,o.H=Tp,o.I=Of,o.J=le,o.K=Z,o.L=Ss,o.M=Mt,o.N=ua,o.O=Bi,o.P=M,o.Q=qr,o.R=Oi,o.S=Lr,o.T=Hu,o.U=hh,o.V=class extends Xn{},o.W=qf,o.X=function(i,t){const s=window.document.createElement("video");s.muted=!0,s.onloadstart=function(){t(null,s)};for(let h=0;h<i.length;h++){const d=window.document.createElement("source");Wt(i[h])||(s.crossOrigin="Anonymous"),d.src=i[h],s.appendChild(d)}return{cancel:()=>{}}},o.Y=ct,o.Z=function(){var i=new al(16);return al!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},o._=E,o.a=He,o.a$=class extends q{},o.a0=function(i,t,s){var h=s[0],d=s[1],_=s[2];return i[0]=t[0]*h,i[1]=t[1]*h,i[2]=t[2]*h,i[3]=t[3]*h,i[4]=t[4]*d,i[5]=t[5]*d,i[6]=t[6]*d,i[7]=t[7]*d,i[8]=t[8]*_,i[9]=t[9]*_,i[10]=t[10]*_,i[11]=t[11]*_,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},o.a1=Cd,o.a2=function(){return be++},o.a3=he,o.a4=cl,o.a5=function(){gi.isLoading()||gi.isLoaded()||ic()!=="deferred"||Gu()},o.a6=Wl,o.a7=no,o.a8=Dr,o.a9=Fp,o.aA=Qs,o.aB=function(i){i=i.slice();const t=Object.create(null);for(let s=0;s<i.length;s++)t[i[s].id]=i[s];for(let s=0;s<i.length;s++)"ref"in i[s]&&(i[s]=Vr(i[s],t[i[s].ref]));return i},o.aC=function(i){if(i.type==="custom")return new uy(i);switch(i.type){case"background":return new oy(i);case"circle":return new qx(i);case"fill":return new f_(i);case"fill-extrusion":return new C_(i);case"heatmap":return new Zx(i);case"hillshade":return new Kx(i);case"line":return new R_(i);case"raster":return new cy(i);case"symbol":return new uh(i)}},o.aD=Me,o.aE=function(i,t){if(!i)return[{command:Xt.setStyle,args:[t]}];let s=[];try{if(!lr(i.version,t.version))return[{command:Xt.setStyle,args:[t]}];lr(i.center,t.center)||s.push({command:Xt.setCenter,args:[t.center]}),lr(i.zoom,t.zoom)||s.push({command:Xt.setZoom,args:[t.zoom]}),lr(i.bearing,t.bearing)||s.push({command:Xt.setBearing,args:[t.bearing]}),lr(i.pitch,t.pitch)||s.push({command:Xt.setPitch,args:[t.pitch]}),lr(i.sprite,t.sprite)||s.push({command:Xt.setSprite,args:[t.sprite]}),lr(i.glyphs,t.glyphs)||s.push({command:Xt.setGlyphs,args:[t.glyphs]}),lr(i.transition,t.transition)||s.push({command:Xt.setTransition,args:[t.transition]}),lr(i.light,t.light)||s.push({command:Xt.setLight,args:[t.light]});const h={},d=[];(function(v,b,k,I){let D;for(D in b=b||{},v=v||{})Object.prototype.hasOwnProperty.call(v,D)&&(Object.prototype.hasOwnProperty.call(b,D)||Or(D,k,I));for(D in b)Object.prototype.hasOwnProperty.call(b,D)&&(Object.prototype.hasOwnProperty.call(v,D)?lr(v[D],b[D])||(v[D].type==="geojson"&&b[D].type==="geojson"&&$r(v,b,D)?k.push({command:Xt.setGeoJSONSourceData,args:[D,b[D].data]}):ia(D,b,k,I)):Fr(D,b,k))})(i.sources,t.sources,d,h);const _=[];i.layers&&i.layers.forEach(v=>{h[v.source]?s.push({command:Xt.removeLayer,args:[v.id]}):_.push(v)}),s=s.concat(d),function(v,b,k){b=b||[];const I=(v=v||[]).map(Qt),D=b.map(Qt),B=v.reduce(kr,{}),G=b.reduce(kr,{}),W=I.slice(),X=Object.create(null);let ne,ge,we,Re,ke,Ne,Ge;for(ne=0,ge=0;ne<I.length;ne++)we=I[ne],Object.prototype.hasOwnProperty.call(G,we)?ge++:(k.push({command:Xt.removeLayer,args:[we]}),W.splice(W.indexOf(we,ge),1));for(ne=0,ge=0;ne<D.length;ne++)we=D[D.length-1-ne],W[W.length-1-ne]!==we&&(Object.prototype.hasOwnProperty.call(B,we)?(k.push({command:Xt.removeLayer,args:[we]}),W.splice(W.lastIndexOf(we,W.length-ge),1)):ge++,Ne=W[W.length-ne],k.push({command:Xt.addLayer,args:[G[we],Ne]}),W.splice(W.length-ne,0,we),X[we]=!0);for(ne=0;ne<D.length;ne++)if(we=D[ne],Re=B[we],ke=G[we],!X[we]&&!lr(Re,ke))if(lr(Re.source,ke.source)&&lr(Re["source-layer"],ke["source-layer"])&&lr(Re.type,ke.type)){for(Ge in pa(Re.layout,ke.layout,k,we,null,Xt.setLayoutProperty),pa(Re.paint,ke.paint,k,we,null,Xt.setPaintProperty),lr(Re.filter,ke.filter)||k.push({command:Xt.setFilter,args:[we,ke.filter]}),lr(Re.minzoom,ke.minzoom)&&lr(Re.maxzoom,ke.maxzoom)||k.push({command:Xt.setLayerZoomRange,args:[we,ke.minzoom,ke.maxzoom]}),Re)Object.prototype.hasOwnProperty.call(Re,Ge)&&Ge!=="layout"&&Ge!=="paint"&&Ge!=="filter"&&Ge!=="metadata"&&Ge!=="minzoom"&&Ge!=="maxzoom"&&(Ge.indexOf("paint.")===0?pa(Re[Ge],ke[Ge],k,we,Ge.slice(6),Xt.setPaintProperty):lr(Re[Ge],ke[Ge])||k.push({command:Xt.setLayerProperty,args:[we,Ge,ke[Ge]]}));for(Ge in ke)Object.prototype.hasOwnProperty.call(ke,Ge)&&!Object.prototype.hasOwnProperty.call(Re,Ge)&&Ge!=="layout"&&Ge!=="paint"&&Ge!=="filter"&&Ge!=="metadata"&&Ge!=="minzoom"&&Ge!=="maxzoom"&&(Ge.indexOf("paint.")===0?pa(Re[Ge],ke[Ge],k,we,Ge.slice(6),Xt.setPaintProperty):lr(Re[Ge],ke[Ge])||k.push({command:Xt.setLayerProperty,args:[we,Ge,ke[Ge]]}))}else k.push({command:Xt.removeLayer,args:[we]}),Ne=W[W.lastIndexOf(we)+1],k.push({command:Xt.addLayer,args:[ke,Ne]})}(_,t.layers,s)}catch(h){console.warn("Unable to compute style diff:",h),s=[{command:Xt.setStyle,args:[t]}]}return s},o.aF=function(i){const t=[],s=i.id;return s===void 0&&t.push({message:`layers.${s}: missing required property "id"`}),i.render===void 0&&t.push({message:`layers.${s}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&t.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),t},o.aG=function i(t,s){if(Array.isArray(t)){if(!Array.isArray(s)||t.length!==s.length)return!1;for(let h=0;h<t.length;h++)if(!i(t[h],s[h]))return!1;return!0}if(typeof t=="object"&&t!==null&&s!==null){if(typeof s!="object"||Object.keys(t).length!==Object.keys(s).length)return!1;for(const h in t)if(!i(t[h],s[h]))return!1;return!0}return t===s},o.aH=Fe,o.aI=Oe,o.aJ=eo,o.aK=function(i){return i({pluginStatus:Qa,pluginURL:Mn}),eo.on("pluginStateChange",i),i},o.aL=class extends Jn{constructor(i,t){super(i,t),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},o.aM=tl,o.aN=class extends Jn{constructor(i,t){super(i,t),this.current=pf}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let t=1;t<16;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},o.aO=Xu,o.aP=class extends Jn{constructor(i,t){super(i,t),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},o.aQ=class extends Jn{constructor(i,t){super(i,t),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},o.aR=Ku,o.aS=function(i,t,s,h,d,_,v){var b=1/(t-s),k=1/(h-d),I=1/(_-v);return i[0]=-2*b,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*k,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*I,i[11]=0,i[12]=(t+s)*b,i[13]=(d+h)*k,i[14]=(v+_)*I,i[15]=1,i},o.aT=tr,o.aU=Hx,o.aV=class extends f{},o.aW=N_,o.aX=class extends y{},o.aY=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},o.aZ=Md,o.a_=xt,o.aa=function(i){const t={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,h,d,_)=>{const v=d||_;return t[h]=!v||v.toLowerCase(),""}),t["max-age"]){const s=parseInt(t["max-age"],10);isNaN(s)?delete t["max-age"]:t["max-age"]=s}return t},o.ab=function(i,t){const s=[];for(const h in i)h in t||s.push(h);return s},o.ac=function(i){if(Kt==null){const t=i.navigator?i.navigator.userAgent:null;Kt=!!i.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Kt},o.ad=Te,o.ae=function(i,t,s){var h=Math.sin(s),d=Math.cos(s),_=t[0],v=t[1],b=t[2],k=t[3],I=t[4],D=t[5],B=t[6],G=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=_*d+I*h,i[1]=v*d+D*h,i[2]=b*d+B*h,i[3]=k*d+G*h,i[4]=I*d-_*h,i[5]=D*d-v*h,i[6]=B*d-b*h,i[7]=G*d-k*h,i},o.af=function(i){var t=new al(16);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],t},o.ag=eh,o.ah=function(i,t){let s=0,h=0;if(i.kind==="constant")h=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:d,minZoom:_,maxZoom:v}=i,b=d?Te(pi.interpolationFactor(d,t,_,v),0,1):0;i.kind==="camera"?h=di.number(i.minSize,i.maxSize,b):s=b}return{uSizeT:s,uSize:h}},o.aj=function(i,{uSize:t,uSizeT:s},{lowerSize:h,upperSize:d}){return i.kind==="source"?h/Ln:i.kind==="composite"?di.number(h/Ln,d/Ln,s):t},o.ak=Uf,o.al=function(i,t,s,h){const d=t.y-i.y,_=t.x-i.x,v=h.y-s.y,b=h.x-s.x,k=v*_-b*d;if(k===0)return null;const I=(b*(i.y-s.y)-v*(i.x-s.x))/k;return new M(i.x+I*_,i.y+I*d)},o.am=Lp,o.an=wd,o.ao=yf,o.ap=xa,o.ar=Nf,o.as=function(i,t){var s=t[0],h=t[1],d=t[2],_=t[3],v=t[4],b=t[5],k=t[6],I=t[7],D=t[8],B=t[9],G=t[10],W=t[11],X=t[12],ne=t[13],ge=t[14],we=t[15],Re=s*b-h*v,ke=s*k-d*v,Ne=s*I-_*v,Ge=h*k-d*b,at=h*I-_*b,At=d*I-_*k,Rt=D*ne-B*X,kt=D*ge-G*X,Et=D*we-W*X,yt=B*ge-G*ne,Pt=B*we-W*ne,bt=G*we-W*ge,pt=Re*bt-ke*Pt+Ne*yt+Ge*Et-at*kt+At*Rt;return pt?(i[0]=(b*bt-k*Pt+I*yt)*(pt=1/pt),i[1]=(d*Pt-h*bt-_*yt)*pt,i[2]=(ne*At-ge*at+we*Ge)*pt,i[3]=(G*at-B*At-W*Ge)*pt,i[4]=(k*Et-v*bt-I*kt)*pt,i[5]=(s*bt-d*Et+_*kt)*pt,i[6]=(ge*Ne-X*At-we*ke)*pt,i[7]=(D*At-G*Ne+W*ke)*pt,i[8]=(v*Pt-b*Et+I*Rt)*pt,i[9]=(h*Et-s*Pt-_*Rt)*pt,i[10]=(X*at-ne*Ne+we*Re)*pt,i[11]=(B*Ne-D*at-W*Re)*pt,i[12]=(b*kt-v*yt-k*Rt)*pt,i[13]=(s*yt-h*kt+d*Rt)*pt,i[14]=(ne*ke-X*Ge-ge*Re)*pt,i[15]=(D*Ge-B*ke+G*Re)*pt,i):null},o.at=Zf,o.au=zf,o.av=Xf,o.aw=function(){const i={},t=Xe.$version;for(const s in Xe.$root){const h=Xe.$root[s];if(h.required){let d=null;d=s==="version"?t:h.type==="array"?[]:{},d!=null&&(i[s]=d)}}return i},o.ax=Xt,o.ay=Uu,o.az=ut,o.b=function(i,t){const s=new Blob([new Uint8Array(i)],{type:"image/png"});createImageBitmap(s).then(h=>{t(null,h)}).catch(h=>{t(new Error(`Could not load image because of ${h.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},o.b0=Ia,o.b1=function(i,t){var s=i[0],h=i[1],d=i[2],_=i[3],v=i[4],b=i[5],k=i[6],I=i[7],D=i[8],B=i[9],G=i[10],W=i[11],X=i[12],ne=i[13],ge=i[14],we=i[15],Re=t[0],ke=t[1],Ne=t[2],Ge=t[3],at=t[4],At=t[5],Rt=t[6],kt=t[7],Et=t[8],yt=t[9],Pt=t[10],bt=t[11],pt=t[12],$t=t[13],Bt=t[14],sr=t[15];return Math.abs(s-Re)<=ti*Math.max(1,Math.abs(s),Math.abs(Re))&&Math.abs(h-ke)<=ti*Math.max(1,Math.abs(h),Math.abs(ke))&&Math.abs(d-Ne)<=ti*Math.max(1,Math.abs(d),Math.abs(Ne))&&Math.abs(_-Ge)<=ti*Math.max(1,Math.abs(_),Math.abs(Ge))&&Math.abs(v-at)<=ti*Math.max(1,Math.abs(v),Math.abs(at))&&Math.abs(b-At)<=ti*Math.max(1,Math.abs(b),Math.abs(At))&&Math.abs(k-Rt)<=ti*Math.max(1,Math.abs(k),Math.abs(Rt))&&Math.abs(I-kt)<=ti*Math.max(1,Math.abs(I),Math.abs(kt))&&Math.abs(D-Et)<=ti*Math.max(1,Math.abs(D),Math.abs(Et))&&Math.abs(B-yt)<=ti*Math.max(1,Math.abs(B),Math.abs(yt))&&Math.abs(G-Pt)<=ti*Math.max(1,Math.abs(G),Math.abs(Pt))&&Math.abs(W-bt)<=ti*Math.max(1,Math.abs(W),Math.abs(bt))&&Math.abs(X-pt)<=ti*Math.max(1,Math.abs(X),Math.abs(pt))&&Math.abs(ne-$t)<=ti*Math.max(1,Math.abs(ne),Math.abs($t))&&Math.abs(ge-Bt)<=ti*Math.max(1,Math.abs(ge),Math.abs(Bt))&&Math.abs(we-sr)<=ti*Math.max(1,Math.abs(we),Math.abs(sr))},o.b2=function(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},o.b3=function(i,t,s){return i[0]=t[0]*s[0],i[1]=t[1]*s[1],i[2]=t[2]*s[2],i[3]=t[3]*s[3],i},o.b4=function(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]*t[3]},o.b5=re,o.b6=Cp,o.b7=Ep,o.b8=function(i,t,s,h,d){var _,v=1/Math.tan(t/2);return i[0]=v/s,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=v,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,d!=null&&d!==1/0?(i[10]=(d+h)*(_=1/(h-d)),i[14]=2*d*h*_):(i[10]=-1,i[14]=-2*h),i},o.b9=function(i,t,s){var h=Math.sin(s),d=Math.cos(s),_=t[4],v=t[5],b=t[6],k=t[7],I=t[8],D=t[9],B=t[10],G=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=_*d+I*h,i[5]=v*d+D*h,i[6]=b*d+B*h,i[7]=k*d+G*h,i[8]=I*d-_*h,i[9]=D*d-v*h,i[10]=B*d-b*h,i[11]=G*d-k*h,i},o.bA=C,o.bB=Qd,o.bC=Go,o.bD=gi,o.ba=fe,o.bb=me,o.bc=function(i,t){return i[0]=t[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=t[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=t[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},o.bd=class extends ao{},o.be=Gf,o.bf=Sp,o.bg=wy,o.bi=vt,o.bj=function(i,t,s=!1){if(Qa===Ql||Qa===ec||Qa===tc)throw new Error("setRTLTextPlugin cannot be called multiple times.");Mn=Ke.resolveURL(i),Qa=Ql,rc=t,ac(),s||Gu()},o.bk=ic,o.bl=function(i,t){const s={};for(let d=0;d<i.length;d++){const _=t&&t[i[d].id]||Zo(i[d]);t&&(t[i[d].id]=_);let v=s[_];v||(v=s[_]=[]),v.push(i[d])}const h=[];for(const d in s)h.push(s[d]);return h},o.bm=It,o.bn=Ip,o.bo=Pp,o.bp=lp,o.bq=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=ua/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const t=i.bucket.layers[0],s=t.layout,h=t._unevaluatedLayout._values,d={layoutIconSize:h["icon-size"].possiblyEvaluate(new Dr(i.bucket.zoom+1),i.canonical),layoutTextSize:h["text-size"].possiblyEvaluate(new Dr(i.bucket.zoom+1),i.canonical),textMaxSize:h["text-size"].possiblyEvaluate(new Dr(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:I,maxZoom:D}=i.bucket.textSizeData;d.compositeTextSizes=[h["text-size"].possiblyEvaluate(new Dr(I),i.canonical),h["text-size"].possiblyEvaluate(new Dr(D),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:I,maxZoom:D}=i.bucket.iconSizeData;d.compositeIconSizes=[h["icon-size"].possiblyEvaluate(new Dr(I),i.canonical),h["icon-size"].possiblyEvaluate(new Dr(D),i.canonical)]}const _=s.get("text-line-height")*xa,v=s.get("text-rotation-alignment")!=="viewport"&&s.get("symbol-placement")!=="point",b=s.get("text-keep-upright"),k=s.get("text-size");for(const I of i.bucket.features){const D=s.get("text-font").evaluate(I,{},i.canonical).join(","),B=k.evaluate(I,{},i.canonical),G=d.layoutTextSize.evaluate(I,{},i.canonical),W=d.layoutIconSize.evaluate(I,{},i.canonical),X={horizontal:{},vertical:void 0},ne=I.text;let ge,we=[0,0];if(ne){const Ne=ne.toString(),Ge=s.get("text-letter-spacing").evaluate(I,{},i.canonical)*xa,at=Yl(Ne)?Ge:0,At=s.get("text-anchor").evaluate(I,{},i.canonical),Rt=jp(t,I,i.canonical);if(!Rt){const bt=s.get("text-radial-offset").evaluate(I,{},i.canonical);we=bt?$p(At,[bt*xa,Wf]):s.get("text-offset").evaluate(I,{},i.canonical).map(pt=>pt*xa)}let kt=v?"center":s.get("text-justify").evaluate(I,{},i.canonical);const Et=s.get("symbol-placement"),yt=Et==="point"?s.get("text-max-width").evaluate(I,{},i.canonical)*xa:0,Pt=()=>{i.bucket.allowVerticalPlacement&&Kl(Ne)&&(X.vertical=oh(ne,i.glyphMap,i.glyphPositions,i.imagePositions,D,yt,_,At,"left",at,we,o.ai.vertical,!0,Et,G,B))};if(!v&&Rt){const bt=new Set;if(kt==="auto")for(let $t=0;$t<Rt.values.length;$t+=2)bt.add(Zf(Rt.values[$t]));else bt.add(kt);let pt=!1;for(const $t of bt)if(!X.horizontal[$t])if(pt)X.horizontal[$t]=X.horizontal[0];else{const Bt=oh(ne,i.glyphMap,i.glyphPositions,i.imagePositions,D,yt,_,"center",$t,at,we,o.ai.horizontal,!1,Et,G,B);Bt&&(X.horizontal[$t]=Bt,pt=Bt.positionedLines.length===1)}Pt()}else{kt==="auto"&&(kt=Zf(At));const bt=oh(ne,i.glyphMap,i.glyphPositions,i.imagePositions,D,yt,_,At,kt,at,we,o.ai.horizontal,!1,Et,G,B);bt&&(X.horizontal[kt]=bt),Pt(),Kl(Ne)&&v&&b&&(X.vertical=oh(ne,i.glyphMap,i.glyphPositions,i.imagePositions,D,yt,_,At,kt,at,we,o.ai.vertical,!1,Et,G,B))}}let Re=!1;if(I.icon&&I.icon.name){const Ne=i.imageMap[I.icon.name];Ne&&(ge=ry(i.imagePositions[I.icon.name],s.get("icon-offset").evaluate(I,{},i.canonical),s.get("icon-anchor").evaluate(I,{},i.canonical)),Re=!!Ne.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=Re:i.bucket.sdfIcons!==Re&&ft("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ne.pixelRatio!==i.bucket.pixelRatio||s.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const ke=Hp(X.horizontal)||X.vertical;i.bucket.iconsInText=!!ke&&ke.iconsInText,(ke||ge)&&yy(i.bucket,I,X,ge,i.imageMap,d,G,W,we,Re,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},o.br=Mf,o.bs=If,o.bt=Pf,o.bu=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},o.bv=Lf,o.bw=bs,o.bx=function(i,t,s,h,d){return E(this,void 0,void 0,function*(){if(Z())try{return yield Mt(i,t,s,h,d)}catch{}return function(_,v,b,k,I){const D=_.width,B=_.height;pe&&Ee||(pe=new OffscreenCanvas(D,B),Ee=pe.getContext("2d",{willReadFrequently:!0})),pe.width=D,pe.height=B,Ee.drawImage(_,0,0,D,B);const G=Ee.getImageData(v,b,k,I);return Ee.clearRect(0,0,D,B),G.data}(i,t,s,h,d)})},o.by=Ap,o.bz=w,o.c=dt,o.d=function(i,t){const s=new Image;s.onload=()=>{t(null,s),URL.revokeObjectURL(s.src),s.onload=null,window.requestAnimationFrame(()=>{s.src=Nt})},s.onerror=()=>t(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const h=new Blob([new Uint8Array(i)],{type:"image/png"});s.src=i.byteLength?URL.createObjectURL(h):Nt},o.e=Ce,o.f=function(i,t){return _e(Ce(i,{type:"json"}),t)},o.g=Qe,o.h=Ke,o.i=nt,o.j=gr,o.k=wt,o.l=Yt,o.m=_e,o.n=function(i){return new Lf(i).readFields(K_,[])},o.o=function(i,t,s){if(!i.length)return s(null,[]);let h=i.length;const d=new Array(i.length);let _=null;i.forEach((v,b)=>{t(v,(k,I)=>{k&&(_=k),d[b]=I,--h==0&&s(_,d)})})},o.p=op,o.q=xc,o.r=sa,o.s=Wt,o.t=uf,o.u=Ct,o.v=Xe,o.w=ft,o.x=Yo,o.y=dn,o.z=function([i,t,s]){return t+=90,t*=Math.PI/180,s*=Math.PI/180,{x:i*Math.cos(t)*Math.sin(s),y:i*Math.sin(t)*Math.sin(s),z:i*Math.cos(s)}}}),m(["./shared"],function(o){class E{constructor(V){this.keyCache={},V&&this.replace(V)}replace(V){this._layerConfigs={},this._layers={},this.update(V,[])}update(V,H){for(const de of V){this._layerConfigs[de.id]=de;const xe=this._layers[de.id]=o.aC(de);xe._featureFilter=o.a6(xe.filter),this.keyCache[de.id]&&delete this.keyCache[de.id]}for(const de of H)delete this.keyCache[de],delete this._layerConfigs[de],delete this._layers[de];this.familiesBySource={};const te=o.bl(Object.values(this._layerConfigs),this.keyCache);for(const de of te){const xe=de.map(et=>this._layers[et.id]),Be=xe[0];if(Be.visibility==="none")continue;const Ae=Be.source||"";let ve=this.familiesBySource[Ae];ve||(ve=this.familiesBySource[Ae]={});const De=Be.sourceLayer||"_geojsonTileLayer";let Je=ve[De];Je||(Je=ve[De]=[]),Je.push(xe)}}}class w{constructor(V){const H={},te=[];for(const Ae in V){const ve=V[Ae],De=H[Ae]={};for(const Je in ve){const et=ve[+Je];if(!et||et.bitmap.width===0||et.bitmap.height===0)continue;const N={x:0,y:0,w:et.bitmap.width+2,h:et.bitmap.height+2};te.push(N),De[Je]={rect:N,metrics:et.metrics}}}const{w:de,h:xe}=o.p(te),Be=new o.q({width:de||1,height:xe||1});for(const Ae in V){const ve=V[Ae];for(const De in ve){const Je=ve[+De];if(!Je||Je.bitmap.width===0||Je.bitmap.height===0)continue;const et=H[Ae][De].rect;o.q.copy(Je.bitmap,Be,{x:0,y:0},{x:et.x+1,y:et.y+1},Je.bitmap)}}this.image=Be,this.positions=H}}o.bm("GlyphAtlas",w);class C{constructor(V){this.tileID=new o.O(V.tileID.overscaledZ,V.tileID.wrap,V.tileID.canonical.z,V.tileID.canonical.x,V.tileID.canonical.y),this.uid=V.uid,this.zoom=V.zoom,this.pixelRatio=V.pixelRatio,this.tileSize=V.tileSize,this.source=V.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=V.showCollisionBoxes,this.collectResourceTiming=!!V.collectResourceTiming,this.returnDependencies=!!V.returnDependencies,this.promoteId=V.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(V,H,te,de,xe){this.status="parsing",this.data=V,this.collisionBoxArray=new o.a3;const Be=new o.bn(Object.keys(V.layers).sort()),Ae=new o.bo(this.tileID,this.promoteId);Ae.bucketLayerIDs=[];const ve={},De={featureIndex:Ae,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:te},Je=H.familiesBySource[this.source];for(const ze in Je){const Ue=V.layers[ze];if(!Ue)continue;Ue.version===1&&o.w(`Vector tile source "${this.source}" layer "${ze}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const je=Be.encode(ze),it=[];for(let gt=0;gt<Ue.length;gt++){const St=Ue.feature(gt),mt=Ae.getId(St,ze);it.push({feature:St,id:mt,index:gt,sourceLayerIndex:je})}for(const gt of Je[ze]){const St=gt[0];St.source!==this.source&&o.w(`layer.source = ${St.source} does not equal this.source = ${this.source}`),St.minzoom&&this.zoom<Math.floor(St.minzoom)||St.maxzoom&&this.zoom>=St.maxzoom||St.visibility!=="none"&&(P(gt,this.zoom,te),(ve[St.id]=St.createBucket({index:Ae.bucketLayerIDs.length,layers:gt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:je,sourceID:this.source})).populate(it,De,this.tileID.canonical),Ae.bucketLayerIDs.push(gt.map(mt=>mt.id)))}}let et,N,J,Y;const K=o.aH(De.glyphDependencies,ze=>Object.keys(ze).map(Number));this.inFlightDependencies.forEach(ze=>ze?.cancel()),this.inFlightDependencies=[];const Q=++this.dependencySentinel;Object.keys(K).length?this.inFlightDependencies.push(de.send("getGlyphs",{uid:this.uid,stacks:K,source:this.source,tileID:this.tileID,type:"glyphs"},(ze,Ue)=>{Q===this.dependencySentinel&&(et||(et=ze,N=Ue,Ze.call(this)))})):N={};const ae=Object.keys(De.iconDependencies);ae.length?this.inFlightDependencies.push(de.send("getImages",{icons:ae,source:this.source,tileID:this.tileID,type:"icons"},(ze,Ue)=>{Q===this.dependencySentinel&&(et||(et=ze,J=Ue,Ze.call(this)))})):J={};const Ve=Object.keys(De.patternDependencies);function Ze(){if(et)return xe(et);if(N&&J&&Y){const ze=new w(N),Ue=new o.bp(J,Y);for(const je in ve){const it=ve[je];it instanceof o.a4?(P(it.layers,this.zoom,te),o.bq({bucket:it,glyphMap:N,glyphPositions:ze.positions,imageMap:J,imagePositions:Ue.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):it.hasPattern&&(it instanceof o.br||it instanceof o.bs||it instanceof o.bt)&&(P(it.layers,this.zoom,te),it.addFeatures(De,this.tileID.canonical,Ue.patternPositions))}this.status="done",xe(null,{buckets:Object.values(ve).filter(je=>!je.isEmpty()),featureIndex:Ae,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ze.image,imageAtlas:Ue,glyphMap:this.returnDependencies?N:null,iconMap:this.returnDependencies?J:null,glyphPositions:this.returnDependencies?ze.positions:null})}}Ve.length?this.inFlightDependencies.push(de.send("getImages",{icons:Ve,source:this.source,tileID:this.tileID,type:"patterns"},(ze,Ue)=>{Q===this.dependencySentinel&&(et||(et=ze,Y=Ue,Ze.call(this)))})):Y={},Ze.call(this)}}function P(ce,V,H){const te=new o.a8(V);for(const de of ce)de.recalculate(te,H)}function M(ce,V){const H=o.l(ce.request,(te,de,xe,Be)=>{if(te)V(te);else if(de)try{const Ae=new o.bw.VectorTile(new o.bv(de));V(null,{vectorTile:Ae,rawData:de,cacheControl:xe,expires:Be})}catch(Ae){const ve=new Uint8Array(de);let De=`Unable to parse the tile at ${ce.request.url}, `;De+=ve[0]===31&&ve[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Ae.messge}`,V(new Error(De))}});return()=>{H.cancel(),V()}}class O{constructor(V,H,te,de){this.actor=V,this.layerIndex=H,this.availableImages=te,this.loadVectorData=de||M,this.fetching={},this.loading={},this.loaded={}}loadTile(V,H){const te=V.uid;this.loading||(this.loading={});const de=!!(V&&V.request&&V.request.collectResourceTiming)&&new o.bu(V.request),xe=this.loading[te]=new C(V);xe.abort=this.loadVectorData(V,(Be,Ae)=>{if(delete this.loading[te],Be||!Ae)return xe.status="done",this.loaded[te]=xe,H(Be);const ve=Ae.rawData,De={};Ae.expires&&(De.expires=Ae.expires),Ae.cacheControl&&(De.cacheControl=Ae.cacheControl);const Je={};if(de){const et=de.finish();et&&(Je.resourceTiming=JSON.parse(JSON.stringify(et)))}xe.vectorTile=Ae.vectorTile,xe.parse(Ae.vectorTile,this.layerIndex,this.availableImages,this.actor,(et,N)=>{if(delete this.fetching[te],et||!N)return H(et);H(null,o.e({rawTileData:ve.slice(0)},N,De,Je))}),this.loaded=this.loaded||{},this.loaded[te]=xe,this.fetching[te]={rawTileData:ve,cacheControl:De,resourceTiming:Je}})}reloadTile(V,H){const te=this.loaded,de=V.uid;if(te&&te[de]){const xe=te[de];xe.showCollisionBoxes=V.showCollisionBoxes,xe.status==="parsing"?xe.parse(xe.vectorTile,this.layerIndex,this.availableImages,this.actor,(Be,Ae)=>{if(Be||!Ae)return H(Be,Ae);let ve;if(this.fetching[de]){const{rawTileData:De,cacheControl:Je,resourceTiming:et}=this.fetching[de];delete this.fetching[de],ve=o.e({rawTileData:De.slice(0)},Ae,Je,et)}else ve=Ae;H(null,ve)}):xe.status==="done"&&(xe.vectorTile?xe.parse(xe.vectorTile,this.layerIndex,this.availableImages,this.actor,H):H())}}abortTile(V,H){const te=this.loading,de=V.uid;te&&te[de]&&te[de].abort&&(te[de].abort(),delete te[de]),H()}removeTile(V,H){const te=this.loaded,de=V.uid;te&&te[de]&&delete te[de],H()}}class U{constructor(){this.loaded={}}loadTile(V,H){return o._(this,void 0,void 0,function*(){const{uid:te,encoding:de,rawImageData:xe,redFactor:Be,greenFactor:Ae,blueFactor:ve,baseShift:De}=V,Je=xe.width+2,et=xe.height+2,N=o.a(xe)?new o.R({width:Je,height:et},yield o.bx(xe,-1,-1,Je,et)):xe,J=new o.by(te,N,de,Be,Ae,ve,De);this.loaded=this.loaded||{},this.loaded[te]=J,H(null,J)})}removeTile(V){const H=this.loaded,te=V.uid;H&&H[te]&&delete H[te]}}function z(ce,V){if(ce.length!==0){j(ce[0],V);for(var H=1;H<ce.length;H++)j(ce[H],!V)}}function j(ce,V){for(var H=0,te=0,de=0,xe=ce.length,Be=xe-1;de<xe;Be=de++){var Ae=(ce[de][0]-ce[Be][0])*(ce[Be][1]+ce[de][1]),ve=H+Ae;te+=Math.abs(H)>=Math.abs(Ae)?H-ve+Ae:Ae-ve+H,H=ve}H+te>=0!=!!V&&ce.reverse()}var ee=o.bz(function ce(V,H){var te,de=V&&V.type;if(de==="FeatureCollection")for(te=0;te<V.features.length;te++)ce(V.features[te],H);else if(de==="GeometryCollection")for(te=0;te<V.geometries.length;te++)ce(V.geometries[te],H);else if(de==="Feature")ce(V.geometry,H);else if(de==="Polygon")z(V.coordinates,H);else if(de==="MultiPolygon")for(te=0;te<V.coordinates.length;te++)z(V.coordinates[te],H);return V});const le=o.bw.VectorTileFeature.prototype.toGeoJSON;var Z={exports:{}},fe=o.bA,me=o.bw.VectorTileFeature,Te=re;function re(ce,V){this.options=V||{},this.features=ce,this.length=ce.length}function Ce(ce,V){this.id=typeof ce.id=="number"?ce.id:void 0,this.type=ce.type,this.rawGeometry=ce.type===1?[ce.geometry]:ce.geometry,this.properties=ce.tags,this.extent=V||4096}re.prototype.feature=function(ce){return new Ce(this.features[ce],this.options.extent)},Ce.prototype.loadGeometry=function(){var ce=this.rawGeometry;this.geometry=[];for(var V=0;V<ce.length;V++){for(var H=ce[V],te=[],de=0;de<H.length;de++)te.push(new fe(H[de][0],H[de][1]));this.geometry.push(te)}return this.geometry},Ce.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ce=this.geometry,V=1/0,H=-1/0,te=1/0,de=-1/0,xe=0;xe<ce.length;xe++)for(var Be=ce[xe],Ae=0;Ae<Be.length;Ae++){var ve=Be[Ae];V=Math.min(V,ve.x),H=Math.max(H,ve.x),te=Math.min(te,ve.y),de=Math.max(de,ve.y)}return[V,te,H,de]},Ce.prototype.toGeoJSON=me.prototype.toGeoJSON;var be=o.bB,Fe=Te;function Oe(ce){var V=new be;return function(H,te){for(var de in H.layers)te.writeMessage(3,Me,H.layers[de])}(ce,V),V.finish()}function Me(ce,V){var H;V.writeVarintField(15,ce.version||1),V.writeStringField(1,ce.name||""),V.writeVarintField(5,ce.extent||4096);var te={keys:[],values:[],keycache:{},valuecache:{}};for(H=0;H<ce.length;H++)te.feature=ce.feature(H),V.writeMessage(2,rt,te);var de=te.keys;for(H=0;H<de.length;H++)V.writeStringField(3,de[H]);var xe=te.values;for(H=0;H<xe.length;H++)V.writeMessage(4,Kt,xe[H])}function rt(ce,V){var H=ce.feature;H.id!==void 0&&V.writeVarintField(1,H.id),V.writeMessage(2,ft,ce),V.writeVarintField(3,H.type),V.writeMessage(4,nt,H)}function ft(ce,V){var H=ce.feature,te=ce.keys,de=ce.values,xe=ce.keycache,Be=ce.valuecache;for(var Ae in H.properties){var ve=H.properties[Ae],De=xe[Ae];if(ve!==null){De===void 0&&(te.push(Ae),xe[Ae]=De=te.length-1),V.writeVarint(De);var Je=typeof ve;Je!=="string"&&Je!=="boolean"&&Je!=="number"&&(ve=JSON.stringify(ve));var et=Je+":"+ve,N=Be[et];N===void 0&&(de.push(ve),Be[et]=N=de.length-1),V.writeVarint(N)}}}function lt(ce,V){return(V<<3)+(7&ce)}function _t(ce){return ce<<1^ce>>31}function nt(ce,V){for(var H=ce.loadGeometry(),te=ce.type,de=0,xe=0,Be=H.length,Ae=0;Ae<Be;Ae++){var ve=H[Ae],De=1;te===1&&(De=ve.length),V.writeVarint(lt(1,De));for(var Je=te===3?ve.length-1:ve.length,et=0;et<Je;et++){et===1&&te!==1&&V.writeVarint(lt(2,Je-1));var N=ve[et].x-de,J=ve[et].y-xe;V.writeVarint(_t(N)),V.writeVarint(_t(J)),de+=N,xe+=J}te===3&&V.writeVarint(lt(7,1))}}function Kt(ce,V){var H=typeof ce;H==="string"?V.writeStringField(1,ce):H==="boolean"?V.writeBooleanField(7,ce):H==="number"&&(ce%1!=0?V.writeDoubleField(3,ce):ce<0?V.writeSVarintField(6,ce):V.writeVarintField(5,ce))}Z.exports=Oe,Z.exports.fromVectorTileJs=Oe,Z.exports.fromGeojsonVt=function(ce,V){V=V||{};var H={};for(var te in ce)H[te]=new Fe(ce[te].features,V),H[te].name=te,H[te].version=V.version,H[te].extent=V.extent;return Oe({layers:H})},Z.exports.GeoJSONWrapper=Fe;var He=o.bz(Z.exports);const Nt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ce=>ce},Mt=Math.fround||(pe=new Float32Array(1),ce=>(pe[0]=+ce,pe[0]));var pe;const Ee=3,Se=5,Ie=6;class Ke{constructor(V){this.options=Object.assign(Object.create(Nt),V),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(V){const{log:H,minZoom:te,maxZoom:de}=this.options;H&&console.time("total time");const xe=`prepare ${V.length} points`;H&&console.time(xe),this.points=V;const Be=[];for(let ve=0;ve<V.length;ve++){const De=V[ve];if(!De.geometry)continue;const[Je,et]=De.geometry.coordinates,N=Mt(ut(Je)),J=Mt(Qe(et));Be.push(N,J,1/0,ve,-1,1),this.options.reduce&&Be.push(0)}let Ae=this.trees[de+1]=this._createTree(Be);H&&console.timeEnd(xe);for(let ve=de;ve>=te;ve--){const De=+Date.now();Ae=this.trees[ve]=this._createTree(this._cluster(Ae,ve)),H&&console.log("z%d: %d clusters in %dms",ve,Ae.numItems,+Date.now()-De)}return H&&console.timeEnd("total time"),this}getClusters(V,H){let te=((V[0]+180)%360+360)%360-180;const de=Math.max(-90,Math.min(90,V[1]));let xe=V[2]===180?180:((V[2]+180)%360+360)%360-180;const Be=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)te=-180,xe=180;else if(te>xe){const et=this.getClusters([te,de,180,Be],H),N=this.getClusters([-180,de,xe,Be],H);return et.concat(N)}const Ae=this.trees[this._limitZoom(H)],ve=Ae.range(ut(te),Qe(Be),ut(xe),Qe(de)),De=Ae.data,Je=[];for(const et of ve){const N=this.stride*et;Je.push(De[N+Se]>1?dt(De,N,this.clusterProps):this.points[De[N+Ee]])}return Je}getChildren(V){const H=this._getOriginId(V),te=this._getOriginZoom(V),de="No cluster with the specified id.",xe=this.trees[te];if(!xe)throw new Error(de);const Be=xe.data;if(H*this.stride>=Be.length)throw new Error(de);const Ae=this.options.radius/(this.options.extent*Math.pow(2,te-1)),ve=xe.within(Be[H*this.stride],Be[H*this.stride+1],Ae),De=[];for(const Je of ve){const et=Je*this.stride;Be[et+4]===V&&De.push(Be[et+Se]>1?dt(Be,et,this.clusterProps):this.points[Be[et+Ee]])}if(De.length===0)throw new Error(de);return De}getLeaves(V,H,te){const de=[];return this._appendLeaves(de,V,H=H||10,te=te||0,0),de}getTile(V,H,te){const de=this.trees[this._limitZoom(V)],xe=Math.pow(2,V),{extent:Be,radius:Ae}=this.options,ve=Ae/Be,De=(te-ve)/xe,Je=(te+1+ve)/xe,et={features:[]};return this._addTileFeatures(de.range((H-ve)/xe,De,(H+1+ve)/xe,Je),de.data,H,te,xe,et),H===0&&this._addTileFeatures(de.range(1-ve/xe,De,1,Je),de.data,xe,te,xe,et),H===xe-1&&this._addTileFeatures(de.range(0,De,ve/xe,Je),de.data,-1,te,xe,et),et.features.length?et:null}getClusterExpansionZoom(V){let H=this._getOriginZoom(V)-1;for(;H<=this.options.maxZoom;){const te=this.getChildren(V);if(H++,te.length!==1)break;V=te[0].properties.cluster_id}return H}_appendLeaves(V,H,te,de,xe){const Be=this.getChildren(H);for(const Ae of Be){const ve=Ae.properties;if(ve&&ve.cluster?xe+ve.point_count<=de?xe+=ve.point_count:xe=this._appendLeaves(V,ve.cluster_id,te,de,xe):xe<de?xe++:V.push(Ae),V.length===te)break}return xe}_createTree(V){const H=new o.av(V.length/this.stride|0,this.options.nodeSize,Float32Array);for(let te=0;te<V.length;te+=this.stride)H.add(V[te],V[te+1]);return H.finish(),H.data=V,H}_addTileFeatures(V,H,te,de,xe,Be){for(const Ae of V){const ve=Ae*this.stride,De=H[ve+Se]>1;let Je,et,N;if(De)Je=vt(H,ve,this.clusterProps),et=H[ve],N=H[ve+1];else{const K=this.points[H[ve+Ee]];Je=K.properties;const[Q,ae]=K.geometry.coordinates;et=ut(Q),N=Qe(ae)}const J={type:1,geometry:[[Math.round(this.options.extent*(et*xe-te)),Math.round(this.options.extent*(N*xe-de))]],tags:Je};let Y;Y=De||this.options.generateId?H[ve+Ee]:this.points[H[ve+Ee]].id,Y!==void 0&&(J.id=Y),Be.features.push(J)}}_limitZoom(V){return Math.max(this.options.minZoom,Math.min(Math.floor(+V),this.options.maxZoom+1))}_cluster(V,H){const{radius:te,extent:de,reduce:xe,minPoints:Be}=this.options,Ae=te/(de*Math.pow(2,H)),ve=V.data,De=[],Je=this.stride;for(let et=0;et<ve.length;et+=Je){if(ve[et+2]<=H)continue;ve[et+2]=H;const N=ve[et],J=ve[et+1],Y=V.within(ve[et],ve[et+1],Ae),K=ve[et+Se];let Q=K;for(const ae of Y){const Ve=ae*Je;ve[Ve+2]>H&&(Q+=ve[Ve+Se])}if(Q>K&&Q>=Be){let ae,Ve=N*K,Ze=J*K,ze=-1;const Ue=((et/Je|0)<<5)+(H+1)+this.points.length;for(const je of Y){const it=je*Je;if(ve[it+2]<=H)continue;ve[it+2]=H;const gt=ve[it+Se];Ve+=ve[it]*gt,Ze+=ve[it+1]*gt,ve[it+4]=Ue,xe&&(ae||(ae=this._map(ve,et,!0),ze=this.clusterProps.length,this.clusterProps.push(ae)),xe(ae,this._map(ve,it)))}ve[et+4]=Ue,De.push(Ve/Q,Ze/Q,1/0,Ue,-1,Q),xe&&De.push(ze)}else{for(let ae=0;ae<Je;ae++)De.push(ve[et+ae]);if(Q>1)for(const ae of Y){const Ve=ae*Je;if(!(ve[Ve+2]<=H)){ve[Ve+2]=H;for(let Ze=0;Ze<Je;Ze++)De.push(ve[Ve+Ze])}}}}return De}_getOriginId(V){return V-this.points.length>>5}_getOriginZoom(V){return(V-this.points.length)%32}_map(V,H,te){if(V[H+Se]>1){const Be=this.clusterProps[V[H+Ie]];return te?Object.assign({},Be):Be}const de=this.points[V[H+Ee]].properties,xe=this.options.map(de);return te&&xe===de?Object.assign({},xe):xe}}function dt(ce,V,H){return{type:"Feature",id:ce[V+Ee],properties:vt(ce,V,H),geometry:{type:"Point",coordinates:[(te=ce[V],360*(te-.5)),qt(ce[V+1])]}};var te}function vt(ce,V,H){const te=ce[V+Se],de=te>=1e4?`${Math.round(te/1e3)}k`:te>=1e3?Math.round(te/100)/10+"k":te,xe=ce[V+Ie],Be=xe===-1?{}:Object.assign({},H[xe]);return Object.assign(Be,{cluster:!0,cluster_id:ce[V+Ee],point_count:te,point_count_abbreviated:de})}function ut(ce){return ce/360+.5}function Qe(ce){const V=Math.sin(ce*Math.PI/180),H=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return H<0?0:H>1?1:H}function qt(ce){const V=(180-360*ce)*Math.PI/180;return 360*Math.atan(Math.exp(V))/Math.PI-90}function _e(ce,V,H,te){for(var de,xe=te,Be=H-V>>1,Ae=H-V,ve=ce[V],De=ce[V+1],Je=ce[H],et=ce[H+1],N=V+3;N<H;N+=3){var J=Yt(ce[N],ce[N+1],ve,De,Je,et);if(J>xe)de=N,xe=J;else if(J===xe){var Y=Math.abs(N-Be);Y<Ae&&(de=N,Ae=Y)}}xe>te&&(de-V>3&&_e(ce,V,de,te),ce[de+2]=xe,H-de>3&&_e(ce,de,H,te))}function Yt(ce,V,H,te,de,xe){var Be=de-H,Ae=xe-te;if(Be!==0||Ae!==0){var ve=((ce-H)*Be+(V-te)*Ae)/(Be*Be+Ae*Ae);ve>1?(H=de,te=xe):ve>0&&(H+=Be*ve,te+=Ae*ve)}return(Be=ce-H)*Be+(Ae=V-te)*Ae}function Wt(ce,V,H,te){var de={id:ce===void 0?null:ce,type:V,geometry:H,tags:te,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(xe){var Be=xe.geometry,Ae=xe.type;if(Ae==="Point"||Ae==="MultiPoint"||Ae==="LineString")nr(xe,Be);else if(Ae==="Polygon"||Ae==="MultiLineString")for(var ve=0;ve<Be.length;ve++)nr(xe,Be[ve]);else if(Ae==="MultiPolygon")for(ve=0;ve<Be.length;ve++)for(var De=0;De<Be[ve].length;De++)nr(xe,Be[ve][De])}(de),de}function nr(ce,V){for(var H=0;H<V.length;H+=3)ce.minX=Math.min(ce.minX,V[H]),ce.minY=Math.min(ce.minY,V[H+1]),ce.maxX=Math.max(ce.maxX,V[H]),ce.maxY=Math.max(ce.maxY,V[H+1])}function Zt(ce,V,H,te){if(V.geometry){var de=V.geometry.coordinates,xe=V.geometry.type,Be=Math.pow(H.tolerance/((1<<H.maxZoom)*H.extent),2),Ae=[],ve=V.id;if(H.promoteId?ve=V.properties[H.promoteId]:H.generateId&&(ve=te||0),xe==="Point")wt(de,Ae);else if(xe==="MultiPoint")for(var De=0;De<de.length;De++)wt(de[De],Ae);else if(xe==="LineString")gr(de,Ae,Be,!1);else if(xe==="MultiLineString"){if(H.lineMetrics){for(De=0;De<de.length;De++)gr(de[De],Ae=[],Be,!1),ce.push(Wt(ve,"LineString",Ae,V.properties));return}Mr(de,Ae,Be,!1)}else if(xe==="Polygon")Mr(de,Ae,Be,!0);else{if(xe!=="MultiPolygon"){if(xe==="GeometryCollection"){for(De=0;De<V.geometry.geometries.length;De++)Zt(ce,{id:ve,geometry:V.geometry.geometries[De],properties:V.properties},H,te);return}throw new Error("Input data is not a valid GeoJSON object.")}for(De=0;De<de.length;De++){var Je=[];Mr(de[De],Je,Be,!0),Ae.push(Je)}}ce.push(Wt(ve,xe,Ae,V.properties))}}function wt(ce,V){V.push(Xe(ce[0])),V.push(Sr(ce[1])),V.push(0)}function gr(ce,V,H,te){for(var de,xe,Be=0,Ae=0;Ae<ce.length;Ae++){var ve=Xe(ce[Ae][0]),De=Sr(ce[Ae][1]);V.push(ve),V.push(De),V.push(0),Ae>0&&(Be+=te?(de*De-ve*xe)/2:Math.sqrt(Math.pow(ve-de,2)+Math.pow(De-xe,2))),de=ve,xe=De}var Je=V.length-3;V[2]=1,_e(V,0,Je,H),V[Je+2]=1,V.size=Math.abs(Be),V.start=0,V.end=V.size}function Mr(ce,V,H,te){for(var de=0;de<ce.length;de++){var xe=[];gr(ce[de],xe,H,te),V.push(xe)}}function Xe(ce){return ce/360+.5}function Sr(ce){var V=Math.sin(ce*Math.PI/180),H=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return H<0?0:H>1?1:H}function Vr(ce,V,H,te,de,xe,Be,Ae){if(te/=V,xe>=(H/=V)&&Be<te)return ce;if(Be<H||xe>=te)return null;for(var ve=[],De=0;De<ce.length;De++){var Je=ce[De],et=Je.geometry,N=Je.type,J=de===0?Je.minX:Je.minY,Y=de===0?Je.maxX:Je.maxY;if(J>=H&&Y<te)ve.push(Je);else if(!(Y<H||J>=te)){var K=[];if(N==="Point"||N==="MultiPoint")lr(et,K,H,te,de);else if(N==="LineString")Xt(et,K,H,te,de,!1,Ae.lineMetrics);else if(N==="MultiLineString")Or(et,K,H,te,de,!1);else if(N==="Polygon")Or(et,K,H,te,de,!0);else if(N==="MultiPolygon")for(var Q=0;Q<et.length;Q++){var ae=[];Or(et[Q],ae,H,te,de,!0),ae.length&&K.push(ae)}if(K.length){if(Ae.lineMetrics&&N==="LineString"){for(Q=0;Q<K.length;Q++)ve.push(Wt(Je.id,N,K[Q],Je.tags));continue}N!=="LineString"&&N!=="MultiLineString"||(K.length===1?(N="LineString",K=K[0]):N="MultiLineString"),N!=="Point"&&N!=="MultiPoint"||(N=K.length===3?"Point":"MultiPoint"),ve.push(Wt(Je.id,N,K,Je.tags))}}}return ve.length?ve:null}function lr(ce,V,H,te,de){for(var xe=0;xe<ce.length;xe+=3){var Be=ce[xe+de];Be>=H&&Be<=te&&(V.push(ce[xe]),V.push(ce[xe+1]),V.push(ce[xe+2]))}}function Xt(ce,V,H,te,de,xe,Be){for(var Ae,ve,De=Fr(ce),Je=de===0?$r:pa,et=ce.start,N=0;N<ce.length-3;N+=3){var J=ce[N],Y=ce[N+1],K=ce[N+2],Q=ce[N+3],ae=ce[N+4],Ve=de===0?J:Y,Ze=de===0?Q:ae,ze=!1;Be&&(Ae=Math.sqrt(Math.pow(J-Q,2)+Math.pow(Y-ae,2))),Ve<H?Ze>H&&(ve=Je(De,J,Y,Q,ae,H),Be&&(De.start=et+Ae*ve)):Ve>te?Ze<te&&(ve=Je(De,J,Y,Q,ae,te),Be&&(De.start=et+Ae*ve)):ia(De,J,Y,K),Ze<H&&Ve>=H&&(ve=Je(De,J,Y,Q,ae,H),ze=!0),Ze>te&&Ve<=te&&(ve=Je(De,J,Y,Q,ae,te),ze=!0),!xe&&ze&&(Be&&(De.end=et+Ae*ve),V.push(De),De=Fr(ce)),Be&&(et+=Ae)}var Ue=ce.length-3;J=ce[Ue],Y=ce[Ue+1],K=ce[Ue+2],(Ve=de===0?J:Y)>=H&&Ve<=te&&ia(De,J,Y,K),Ue=De.length-3,xe&&Ue>=3&&(De[Ue]!==De[0]||De[Ue+1]!==De[1])&&ia(De,De[0],De[1],De[2]),De.length&&V.push(De)}function Fr(ce){var V=[];return V.size=ce.size,V.start=ce.start,V.end=ce.end,V}function Or(ce,V,H,te,de,xe){for(var Be=0;Be<ce.length;Be++)Xt(ce[Be],V,H,te,de,xe,!1)}function ia(ce,V,H,te){ce.push(V),ce.push(H),ce.push(te)}function $r(ce,V,H,te,de,xe){var Be=(xe-V)/(te-V);return ce.push(xe),ce.push(H+(de-H)*Be),ce.push(1),Be}function pa(ce,V,H,te,de,xe){var Be=(xe-H)/(de-H);return ce.push(V+(te-V)*Be),ce.push(xe),ce.push(1),Be}function Qt(ce,V){for(var H=[],te=0;te<ce.length;te++){var de,xe=ce[te],Be=xe.type;if(Be==="Point"||Be==="MultiPoint"||Be==="LineString")de=kr(xe.geometry,V);else if(Be==="MultiLineString"||Be==="Polygon"){de=[];for(var Ae=0;Ae<xe.geometry.length;Ae++)de.push(kr(xe.geometry[Ae],V))}else if(Be==="MultiPolygon")for(de=[],Ae=0;Ae<xe.geometry.length;Ae++){for(var ve=[],De=0;De<xe.geometry[Ae].length;De++)ve.push(kr(xe.geometry[Ae][De],V));de.push(ve)}H.push(Wt(xe.id,Be,de,xe.tags))}return H}function kr(ce,V){var H=[];H.size=ce.size,ce.start!==void 0&&(H.start=ce.start,H.end=ce.end);for(var te=0;te<ce.length;te+=3)H.push(ce[te]+V,ce[te+1],ce[te+2]);return H}function ct(ce,V){if(ce.transformed)return ce;var H,te,de,xe=1<<ce.z,Be=ce.x,Ae=ce.y;for(H=0;H<ce.features.length;H++){var ve=ce.features[H],De=ve.geometry,Je=ve.type;if(ve.geometry=[],Je===1)for(te=0;te<De.length;te+=2)ve.geometry.push(Dt(De[te],De[te+1],V,xe,Be,Ae));else for(te=0;te<De.length;te++){var et=[];for(de=0;de<De[te].length;de+=2)et.push(Dt(De[te][de],De[te][de+1],V,xe,Be,Ae));ve.geometry.push(et)}}return ce.transformed=!0,ce}function Dt(ce,V,H,te,de,xe){return[Math.round(H*(ce*te-de)),Math.round(H*(V*te-xe))]}function Vt(ce,V,H,te,de){for(var xe=V===de.maxZoom?0:de.tolerance/((1<<V)*de.extent),Be={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:H,y:te,z:V,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ae=0;Ae<ce.length;Ae++){Be.numFeatures++,xr(Be,ce[Ae],xe,de);var ve=ce[Ae].minX,De=ce[Ae].minY,Je=ce[Ae].maxX,et=ce[Ae].maxY;ve<Be.minX&&(Be.minX=ve),De<Be.minY&&(Be.minY=De),Je>Be.maxX&&(Be.maxX=Je),et>Be.maxY&&(Be.maxY=et)}return Be}function xr(ce,V,H,te){var de=V.geometry,xe=V.type,Be=[];if(xe==="Point"||xe==="MultiPoint")for(var Ae=0;Ae<de.length;Ae+=3)Be.push(de[Ae]),Be.push(de[Ae+1]),ce.numPoints++,ce.numSimplified++;else if(xe==="LineString")rr(Be,de,ce,H,!1,!1);else if(xe==="MultiLineString"||xe==="Polygon")for(Ae=0;Ae<de.length;Ae++)rr(Be,de[Ae],ce,H,xe==="Polygon",Ae===0);else if(xe==="MultiPolygon")for(var ve=0;ve<de.length;ve++){var De=de[ve];for(Ae=0;Ae<De.length;Ae++)rr(Be,De[Ae],ce,H,!0,Ae===0)}if(Be.length){var Je=V.tags||null;if(xe==="LineString"&&te.lineMetrics){for(var et in Je={},V.tags)Je[et]=V.tags[et];Je.mapbox_clip_start=de.start/de.size,Je.mapbox_clip_end=de.end/de.size}var N={geometry:Be,type:xe==="Polygon"||xe==="MultiPolygon"?3:xe==="LineString"||xe==="MultiLineString"?2:1,tags:Je};V.id!==null&&(N.id=V.id),ce.features.push(N)}}function rr(ce,V,H,te,de,xe){var Be=te*te;if(te>0&&V.size<(de?Be:te))H.numPoints+=V.length/3;else{for(var Ae=[],ve=0;ve<V.length;ve+=3)(te===0||V[ve+2]>Be)&&(H.numSimplified++,Ae.push(V[ve]),Ae.push(V[ve+1])),H.numPoints++;de&&function(De,Je){for(var et=0,N=0,J=De.length,Y=J-2;N<J;Y=N,N+=2)et+=(De[N]-De[Y])*(De[N+1]+De[Y+1]);if(et>0===Je)for(N=0,J=De.length;N<J/2;N+=2){var K=De[N],Q=De[N+1];De[N]=De[J-2-N],De[N+1]=De[J-1-N],De[J-2-N]=K,De[J-1-N]=Q}}(Ae,xe),ce.push(Ae)}}function st(ce,V){var H=(V=this.options=function(de,xe){for(var Be in xe)de[Be]=xe[Be];return de}(Object.create(this.options),V)).debug;if(H&&console.time("preprocess data"),V.maxZoom<0||V.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(V.promoteId&&V.generateId)throw new Error("promoteId and generateId cannot be used together.");var te=function(de,xe){var Be=[];if(de.type==="FeatureCollection")for(var Ae=0;Ae<de.features.length;Ae++)Zt(Be,de.features[Ae],xe,Ae);else Zt(Be,de.type==="Feature"?de:{geometry:de},xe);return Be}(ce,V);this.tiles={},this.tileCoords=[],H&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",V.indexMaxZoom,V.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),te=function(de,xe){var Be=xe.buffer/xe.extent,Ae=de,ve=Vr(de,1,-1-Be,Be,0,-1,2,xe),De=Vr(de,1,1-Be,2+Be,0,-1,2,xe);return(ve||De)&&(Ae=Vr(de,1,-Be,1+Be,0,-1,2,xe)||[],ve&&(Ae=Qt(ve,1).concat(Ae)),De&&(Ae=Ae.concat(Qt(De,-1)))),Ae}(te,V),te.length&&this.splitTile(te,0,0,0),H&&(te.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ut(ce,V,H){return 32*((1<<ce)*H+V)+ce}function jt(ce,V){return V?ce.properties[V]:ce.id}function Br(ce,V){if(ce==null)return!0;if(ce.type==="Feature")return jt(ce,V)!=null;if(ce.type==="FeatureCollection"){const H=new Set;for(const te of ce.features){const de=jt(te,V);if(de==null||H.has(de))return!1;H.add(de)}return!0}return!1}function ca(ce,V){const H=new Map;if(ce!=null)if(ce.type==="Feature")H.set(jt(ce,V),ce);else for(const te of ce.features)H.set(jt(te,V),te);return H}st.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},st.prototype.splitTile=function(ce,V,H,te,de,xe,Be){for(var Ae=[ce,V,H,te],ve=this.options,De=ve.debug;Ae.length;){te=Ae.pop(),H=Ae.pop(),V=Ae.pop(),ce=Ae.pop();var Je=1<<V,et=Ut(V,H,te),N=this.tiles[et];if(!N&&(De>1&&console.time("creation"),N=this.tiles[et]=Vt(ce,V,H,te,ve),this.tileCoords.push({z:V,x:H,y:te}),De)){De>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",V,H,te,N.numFeatures,N.numPoints,N.numSimplified),console.timeEnd("creation"));var J="z"+V;this.stats[J]=(this.stats[J]||0)+1,this.total++}if(N.source=ce,de){if(V===ve.maxZoom||V===de)continue;var Y=1<<de-V;if(H!==Math.floor(xe/Y)||te!==Math.floor(Be/Y))continue}else if(V===ve.indexMaxZoom||N.numPoints<=ve.indexMaxPoints)continue;if(N.source=null,ce.length!==0){De>1&&console.time("clipping");var K,Q,ae,Ve,Ze,ze,Ue=.5*ve.buffer/ve.extent,je=.5-Ue,it=.5+Ue,gt=1+Ue;K=Q=ae=Ve=null,Ze=Vr(ce,Je,H-Ue,H+it,0,N.minX,N.maxX,ve),ze=Vr(ce,Je,H+je,H+gt,0,N.minX,N.maxX,ve),ce=null,Ze&&(K=Vr(Ze,Je,te-Ue,te+it,1,N.minY,N.maxY,ve),Q=Vr(Ze,Je,te+je,te+gt,1,N.minY,N.maxY,ve),Ze=null),ze&&(ae=Vr(ze,Je,te-Ue,te+it,1,N.minY,N.maxY,ve),Ve=Vr(ze,Je,te+je,te+gt,1,N.minY,N.maxY,ve),ze=null),De>1&&console.timeEnd("clipping"),Ae.push(K||[],V+1,2*H,2*te),Ae.push(Q||[],V+1,2*H,2*te+1),Ae.push(ae||[],V+1,2*H+1,2*te),Ae.push(Ve||[],V+1,2*H+1,2*te+1)}}},st.prototype.getTile=function(ce,V,H){var te=this.options,de=te.extent,xe=te.debug;if(ce<0||ce>24)return null;var Be=1<<ce,Ae=Ut(ce,V=(V%Be+Be)%Be,H);if(this.tiles[Ae])return ct(this.tiles[Ae],de);xe>1&&console.log("drilling down to z%d-%d-%d",ce,V,H);for(var ve,De=ce,Je=V,et=H;!ve&&De>0;)De--,Je=Math.floor(Je/2),et=Math.floor(et/2),ve=this.tiles[Ut(De,Je,et)];return ve&&ve.source?(xe>1&&console.log("found parent tile z%d-%d-%d",De,Je,et),xe>1&&console.time("drilling down"),this.splitTile(ve.source,De,Je,et,ce,V,H),xe>1&&console.timeEnd("drilling down"),this.tiles[Ae]?ct(this.tiles[Ae],de):null):null};class er extends O{constructor(V,H,te,de){super(V,H,te),this._dataUpdateable=new Map,this.loadGeoJSON=(xe,Be)=>{const{promoteId:Ae}=xe;if(xe.request)return o.f(xe.request,(ve,De,Je,et)=>{this._dataUpdateable=Br(De,Ae)?ca(De,Ae):void 0,Be(ve,De,Je,et)});if(typeof xe.data=="string")try{const ve=JSON.parse(xe.data);this._dataUpdateable=Br(ve,Ae)?ca(ve,Ae):void 0,Be(null,ve)}catch{Be(new Error(`Input data given to '${xe.source}' is not a valid GeoJSON object.`))}else xe.dataDiff?this._dataUpdateable?(function(ve,De,Je){var et,N,J,Y;if(De.removeAll&&ve.clear(),De.remove)for(const K of De.remove)ve.delete(K);if(De.add)for(const K of De.add){const Q=jt(K,Je);Q!=null&&ve.set(Q,K)}if(De.update)for(const K of De.update){let Q=ve.get(K.id);if(Q==null)continue;const ae=!K.removeAllProperties&&(((et=K.removeProperties)===null||et===void 0?void 0:et.length)>0||((N=K.addOrUpdateProperties)===null||N===void 0?void 0:N.length)>0);if((K.newGeometry||K.removeAllProperties||ae)&&(Q=Object.assign({},Q),ve.set(K.id,Q),ae&&(Q.properties=Object.assign({},Q.properties))),K.newGeometry&&(Q.geometry=K.newGeometry),K.removeAllProperties)Q.properties={};else if(((J=K.removeProperties)===null||J===void 0?void 0:J.length)>0)for(const Ve of K.removeProperties)Object.prototype.hasOwnProperty.call(Q.properties,Ve)&&delete Q.properties[Ve];if(((Y=K.addOrUpdateProperties)===null||Y===void 0?void 0:Y.length)>0)for(const{key:Ve,value:Ze}of K.addOrUpdateProperties)Q.properties[Ve]=Ze}}(this._dataUpdateable,xe.dataDiff,Ae),Be(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):Be(new Error(`Cannot update existing geojson data in ${xe.source}`)):Be(new Error(`Input data given to '${xe.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},this.loadVectorData=this.loadGeoJSONTile,de&&(this.loadGeoJSON=de)}loadGeoJSONTile(V,H){const te=V.tileID.canonical;if(!this._geoJSONIndex)return H(null,null);const de=this._geoJSONIndex.getTile(te.z,te.x,te.y);if(!de)return H(null,null);const xe=new class{constructor(Ae){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.N,this.length=Ae.length,this._features=Ae}feature(Ae){return new class{constructor(ve){this._feature=ve,this.extent=o.N,this.type=ve.type,this.properties=ve.tags,"id"in ve&&!isNaN(ve.id)&&(this.id=parseInt(ve.id,10))}loadGeometry(){if(this._feature.type===1){const ve=[];for(const De of this._feature.geometry)ve.push([new o.P(De[0],De[1])]);return ve}{const ve=[];for(const De of this._feature.geometry){const Je=[];for(const et of De)Je.push(new o.P(et[0],et[1]));ve.push(Je)}return ve}}toGeoJSON(ve,De,Je){return le.call(this,ve,De,Je)}}(this._features[Ae])}}(de.features);let Be=He(xe);Be.byteOffset===0&&Be.byteLength===Be.buffer.byteLength||(Be=new Uint8Array(Be)),H(null,{vectorTile:xe,rawData:Be.buffer})}loadData(V,H){var te;(te=this._pendingRequest)===null||te===void 0||te.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const de=!!(V&&V.request&&V.request.collectResourceTiming)&&new o.bu(V.request);this._pendingCallback=H,this._pendingRequest=this.loadGeoJSON(V,(xe,Be)=>{if(delete this._pendingCallback,delete this._pendingRequest,xe||!Be)return H(xe);if(typeof Be!="object")return H(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`));{ee(Be,!0);try{if(V.filter){const ve=o.bC(V.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ve.result==="error")throw new Error(ve.value.map(Je=>`${Je.key}: ${Je.message}`).join(", "));Be={type:"FeatureCollection",features:Be.features.filter(Je=>ve.value.evaluate({zoom:0},Je))}}this._geoJSONIndex=V.cluster?new Ke(function({superclusterOptions:ve,clusterProperties:De}){if(!De||!ve)return ve;const Je={},et={},N={accumulated:null,zoom:0},J={properties:null},Y=Object.keys(De);for(const K of Y){const[Q,ae]=De[K],Ve=o.bC(ae),Ze=o.bC(typeof Q=="string"?[Q,["accumulated"],["get",K]]:Q);Je[K]=Ve.value,et[K]=Ze.value}return ve.map=K=>{J.properties=K;const Q={};for(const ae of Y)Q[ae]=Je[ae].evaluate(N,J);return Q},ve.reduce=(K,Q)=>{J.properties=Q;for(const ae of Y)N.accumulated=K[ae],K[ae]=et[ae].evaluate(N,J)},ve}(V)).load(Be.features):function(ve,De){return new st(ve,De)}(Be,V.geojsonVtOptions)}catch(ve){return H(ve)}this.loaded={};const Ae={};if(de){const ve=de.finish();ve&&(Ae.resourceTiming={},Ae.resourceTiming[V.source]=JSON.parse(JSON.stringify(ve)))}H(null,Ae)}})}reloadTile(V,H){const te=this.loaded;return te&&te[V.uid]?super.reloadTile(V,H):this.loadTile(V,H)}removeSource(V,H){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),H()}getClusterExpansionZoom(V,H){try{H(null,this._geoJSONIndex.getClusterExpansionZoom(V.clusterId))}catch(te){H(te)}}getClusterChildren(V,H){try{H(null,this._geoJSONIndex.getChildren(V.clusterId))}catch(te){H(te)}}getClusterLeaves(V,H){try{H(null,this._geoJSONIndex.getLeaves(V.clusterId,V.limit,V.offset))}catch(te){H(te)}}}class Ya{constructor(V){this.self=V,this.actor=new o.C(V,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:O,geojson:er},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(H,te)=>{if(this.workerSourceTypes[H])throw new Error(`Worker source with name "${H}" already registered.`);this.workerSourceTypes[H]=te},this.self.registerRTLTextPlugin=H=>{if(o.bD.isParsed())throw new Error("RTL text plugin already registered.");o.bD.applyArabicShaping=H.applyArabicShaping,o.bD.processBidirectionalText=H.processBidirectionalText,o.bD.processStyledBidirectionalText=H.processStyledBidirectionalText}}setReferrer(V,H){this.referrer=H}setImages(V,H,te){this.availableImages[V]=H;for(const de in this.workerSources[V]){const xe=this.workerSources[V][de];for(const Be in xe)xe[Be].availableImages=H}te()}setLayers(V,H,te){this.getLayerIndex(V).replace(H),te()}updateLayers(V,H,te){this.getLayerIndex(V).update(H.layers,H.removedIds),te()}loadTile(V,H,te){this.getWorkerSource(V,H.type,H.source).loadTile(H,te)}loadDEMTile(V,H,te){this.getDEMWorkerSource(V,H.source).loadTile(H,te)}reloadTile(V,H,te){this.getWorkerSource(V,H.type,H.source).reloadTile(H,te)}abortTile(V,H,te){this.getWorkerSource(V,H.type,H.source).abortTile(H,te)}removeTile(V,H,te){this.getWorkerSource(V,H.type,H.source).removeTile(H,te)}removeDEMTile(V,H){this.getDEMWorkerSource(V,H.source).removeTile(H)}removeSource(V,H,te){if(!this.workerSources[V]||!this.workerSources[V][H.type]||!this.workerSources[V][H.type][H.source])return;const de=this.workerSources[V][H.type][H.source];delete this.workerSources[V][H.type][H.source],de.removeSource!==void 0?de.removeSource(H,te):te()}loadWorkerSource(V,H,te){try{this.self.importScripts(H.url),te()}catch(de){te(de.toString())}}syncRTLPluginState(V,H,te){try{o.bD.setState(H);const de=o.bD.getPluginURL();if(o.bD.isLoaded()&&!o.bD.isParsed()&&de!=null){this.self.importScripts(de);const xe=o.bD.isParsed();te(xe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${de}`),xe)}}catch(de){te(de.toString())}}getAvailableImages(V){let H=this.availableImages[V];return H||(H=[]),H}getLayerIndex(V){let H=this.layerIndexes[V];return H||(H=this.layerIndexes[V]=new E),H}getWorkerSource(V,H,te){return this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][H]||(this.workerSources[V][H]={}),this.workerSources[V][H][te]||(this.workerSources[V][H][te]=new this.workerSourceTypes[H]({send:(de,xe,Be)=>{this.actor.send(de,xe,Be,V)}},this.getLayerIndex(V),this.getAvailableImages(V))),this.workerSources[V][H][te]}getDEMWorkerSource(V,H){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][H]||(this.demWorkerSources[V][H]=new U),this.demWorkerSources[V][H]}}return o.i()&&(self.worker=new Ya(self)),Ya}),m(["./shared"],function(o){var E="3.6.2";class w{static testProp(r){if(!w.docStyle)return r[0];for(let l=0;l<r.length;l++)if(r[l]in w.docStyle)return r[l];return r[0]}static create(r,l,f){const p=window.document.createElement(r);return l!==void 0&&(p.className=l),f&&f.appendChild(p),p}static createNS(r,l){return window.document.createElementNS(r,l)}static disableDrag(){w.docStyle&&w.selectProp&&(w.userSelect=w.docStyle[w.selectProp],w.docStyle[w.selectProp]="none")}static enableDrag(){w.docStyle&&w.selectProp&&(w.docStyle[w.selectProp]=w.userSelect)}static setTransform(r,l){r.style[w.transformProp]=l}static addEventListener(r,l,f,p={}){r.addEventListener(l,f,"passive"in p?p:p.capture)}static removeEventListener(r,l,f,p={}){r.removeEventListener(l,f,"passive"in p?p:p.capture)}static suppressClickInternal(r){r.preventDefault(),r.stopPropagation(),window.removeEventListener("click",w.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",w.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",w.suppressClickInternal,!0)},0)}static mousePos(r,l){const f=r.getBoundingClientRect();return new o.P(l.clientX-f.left-r.clientLeft,l.clientY-f.top-r.clientTop)}static touchPos(r,l){const f=r.getBoundingClientRect(),p=[];for(let y=0;y<l.length;y++)p.push(new o.P(l[y].clientX-f.left-r.clientLeft,l[y].clientY-f.top-r.clientTop));return p}static mouseButton(r){return r.button}static remove(r){r.parentNode&&r.parentNode.removeChild(r)}}w.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,w.selectProp=w.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),w.transformProp=w.testProp(["transform","WebkitTransform"]);const C={supported:!1,testSupport:function(g){!O&&M&&(U?z(g):P=g)}};let P,M,O=!1,U=!1;function z(g){const r=g.createTexture();g.bindTexture(g.TEXTURE_2D,r);try{if(g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,M),g.isContextLost())return;C.supported=!0}catch{}g.deleteTexture(r),O=!0}var j,ee;typeof document<"u"&&(M=document.createElement("img"),M.onload=function(){P&&z(P),P=null,U=!0},M.onerror=function(){O=!0,P=null},M.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(g){let r,l,f,p;g.resetRequestQueue=()=>{r=[],l=0,f=0,p={}},g.addThrottleControl=F=>{const L=f++;return p[L]=F,L},g.removeThrottleControl=F=>{delete p[F],S()},g.getImage=(F,L,R=!0)=>{C.supported&&(F.headers||(F.headers={}),F.headers.accept="image/webp,*/*");const q={requestParameters:F,supportImageRefresh:R,callback:L,cancelled:!1,completed:!1,cancel:()=>{q.completed||q.cancelled||(q.cancelled=!0,q.innerRequest&&(q.innerRequest.cancel(),l--),S())}};return r.push(q),S(),q};const y=F=>{const{requestParameters:L,supportImageRefresh:R,callback:q}=F;return o.e(L,{type:"image"}),(R!==!1||o.i()||o.g(L.url)||L.headers&&!Object.keys(L.headers).reduce((oe,se)=>oe&&se==="accept",!0)?o.m:A)(L,(oe,se,he,ie)=>{T(F,q,oe,se,he,ie)})},T=(F,L,R,q,oe,se)=>{R?L(R):q instanceof HTMLImageElement||o.a(q)?L(null,q):q&&((he,ie)=>{typeof createImageBitmap=="function"?o.b(he,ie):o.d(he,ie)})(q,(he,ie)=>{he!=null?L(he):ie!=null&&L(null,ie,{cacheControl:oe,expires:se})}),F.cancelled||(F.completed=!0,l--,S())},S=()=>{const F=(()=>{const L=Object.keys(p);let R=!1;if(L.length>0){for(const q of L)if(R=p[q](),R)break}return R})()?o.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:o.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let L=l;L<F&&r.length>0;L++){const R=r.shift();if(R.cancelled){L--;continue}const q=y(R);l++,R.innerRequest=q}},A=(F,L)=>{const R=new Image,q=F.url;let oe=!1;const se=F.credentials;return se&&se==="include"?R.crossOrigin="use-credentials":(se&&se==="same-origin"||!o.s(q))&&(R.crossOrigin="anonymous"),R.fetchPriority="high",R.onload=()=>{L(null,R),R.onerror=R.onload=null},R.onerror=()=>{oe||L(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),R.onerror=R.onload=null},R.src=q,{cancel:()=>{oe=!0,R.src=""}}}}(j||(j={})),j.resetRequestQueue(),function(g){g.Glyphs="Glyphs",g.Image="Image",g.Source="Source",g.SpriteImage="SpriteImage",g.SpriteJSON="SpriteJSON",g.Style="Style",g.Tile="Tile",g.Unknown="Unknown"}(ee||(ee={}));class le{constructor(r){this._transformRequestFn=r}transformRequest(r,l){return this._transformRequestFn&&this._transformRequestFn(r,l)||{url:r}}normalizeSpriteURL(r,l,f){const p=function(y){const T=y.match(Z);if(!T)throw new Error(`Unable to parse URL "${y}"`);return{protocol:T[1],authority:T[2],path:T[3]||"/",params:T[4]?T[4].split("&"):[]}}(r);return p.path+=`${l}${f}`,function(y){const T=y.params.length?`?${y.params.join("&")}`:"";return`${y.protocol}://${y.authority}${y.path}${T}`}(p)}setTransformRequest(r){this._transformRequestFn=r}}const Z=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function fe(g){var r=new o.A(3);return r[0]=g[0],r[1]=g[1],r[2]=g[2],r}var me,Te=function(g,r,l){return g[0]=r[0]-l[0],g[1]=r[1]-l[1],g[2]=r[2]-l[2],g};me=new o.A(3),o.A!=Float32Array&&(me[0]=0,me[1]=0,me[2]=0);var re=function(g){var r=g[0],l=g[1];return r*r+l*l};function Ce(g){const r=[];if(typeof g=="string")r.push({id:"default",url:g});else if(g&&g.length>0){const l=[];for(const{id:f,url:p}of g){const y=`${f}${p}`;l.indexOf(y)===-1&&(l.push(y),r.push({id:f,url:p}))}}return r}function be(g,r,l,f,p){if(f)return void g(f);if(p!==Object.values(r).length||p!==Object.values(l).length)return;const y={};for(const T in r){y[T]={};const S=o.h.getImageCanvasContext(l[T]),A=r[T];for(const F in A){const{width:L,height:R,x:q,y:oe,sdf:se,pixelRatio:he,stretchX:ie,stretchY:Pe,content:$e}=A[F];y[T][F]={data:null,pixelRatio:he,sdf:se,stretchX:ie,stretchY:Pe,content:$e,spriteData:{width:L,height:R,x:q,y:oe,context:S}}}}g(null,y)}(function(){var g=new o.A(2);o.A!=Float32Array&&(g[0]=0,g[1]=0)})();class Fe{constructor(r,l,f,p){this.context=r,this.format=f,this.texture=r.gl.createTexture(),this.update(l,p)}update(r,l,f){const{width:p,height:y}=r,T=!(this.size&&this.size[0]===p&&this.size[1]===y||f),{context:S}=this,{gl:A}=S;if(this.useMipmap=!!(l&&l.useMipmap),A.bindTexture(A.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===A.RGBA&&(!l||l.premultiply!==!1)),T)this.size=[p,y],r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||o.a(r)?A.texImage2D(A.TEXTURE_2D,0,this.format,this.format,A.UNSIGNED_BYTE,r):A.texImage2D(A.TEXTURE_2D,0,this.format,p,y,0,this.format,A.UNSIGNED_BYTE,r.data);else{const{x:F,y:L}=f||{x:0,y:0};r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||o.a(r)?A.texSubImage2D(A.TEXTURE_2D,0,F,L,A.RGBA,A.UNSIGNED_BYTE,r):A.texSubImage2D(A.TEXTURE_2D,0,F,L,p,y,A.RGBA,A.UNSIGNED_BYTE,r.data)}this.useMipmap&&this.isSizePowerOfTwo()&&A.generateMipmap(A.TEXTURE_2D)}bind(r,l,f){const{context:p}=this,{gl:y}=p;y.bindTexture(y.TEXTURE_2D,this.texture),f!==y.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(f=y.LINEAR),r!==this.filter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,r),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,f||r),this.filter=r),l!==this.wrap&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,l),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,l),this.wrap=l)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}function Oe(g){const{userImage:r}=g;return!!(r&&r.render&&r.render())&&(g.data.replace(new Uint8Array(r.data.buffer)),!0)}class Me extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(r){if(this.loaded!==r&&(this.loaded=r,r)){for(const{ids:l,callback:f}of this.requestors)this._notify(l,f);this.requestors=[]}}getImage(r){const l=this.images[r];if(l&&!l.data&&l.spriteData){const f=l.spriteData;l.data=new o.R({width:f.width,height:f.height},f.context.getImageData(f.x,f.y,f.width,f.height).data),l.spriteData=null}return l}addImage(r,l){if(this.images[r])throw new Error(`Image id ${r} already exist, use updateImage instead`);this._validate(r,l)&&(this.images[r]=l)}_validate(r,l){let f=!0;const p=l.data||l.spriteData;return this._validateStretch(l.stretchX,p&&p.width)||(this.fire(new o.j(new Error(`Image "${r}" has invalid "stretchX" value`))),f=!1),this._validateStretch(l.stretchY,p&&p.height)||(this.fire(new o.j(new Error(`Image "${r}" has invalid "stretchY" value`))),f=!1),this._validateContent(l.content,l)||(this.fire(new o.j(new Error(`Image "${r}" has invalid "content" value`))),f=!1),f}_validateStretch(r,l){if(!r)return!0;let f=0;for(const p of r){if(p[0]<f||p[1]<p[0]||l<p[1])return!1;f=p[1]}return!0}_validateContent(r,l){if(!r)return!0;if(r.length!==4)return!1;const f=l.spriteData,p=f&&f.width||l.data.width,y=f&&f.height||l.data.height;return!(r[0]<0||p<r[0]||r[1]<0||y<r[1]||r[2]<0||p<r[2]||r[3]<0||y<r[3]||r[2]<r[0]||r[3]<r[1])}updateImage(r,l,f=!0){const p=this.getImage(r);if(f&&(p.data.width!==l.data.width||p.data.height!==l.data.height))throw new Error(`size mismatch between old image (${p.data.width}x${p.data.height}) and new image (${l.data.width}x${l.data.height}).`);l.version=p.version+1,this.images[r]=l,this.updatedImages[r]=!0}removeImage(r){const l=this.images[r];delete this.images[r],delete this.patterns[r],l.userImage&&l.userImage.onRemove&&l.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(r,l){let f=!0;if(!this.isLoaded())for(const p of r)this.images[p]||(f=!1);this.isLoaded()||f?this._notify(r,l):this.requestors.push({ids:r,callback:l})}_notify(r,l){const f={};for(const p of r){let y=this.getImage(p);y||(this.fire(new o.k("styleimagemissing",{id:p})),y=this.getImage(p)),y?f[p]={data:y.data.clone(),pixelRatio:y.pixelRatio,sdf:y.sdf,version:y.version,stretchX:y.stretchX,stretchY:y.stretchY,content:y.content,hasRenderCallback:!!(y.userImage&&y.userImage.render)}:o.w(`Image "${p}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}l(null,f)}getPixelSize(){const{width:r,height:l}=this.atlasImage;return{width:r,height:l}}getPattern(r){const l=this.patterns[r],f=this.getImage(r);if(!f)return null;if(l&&l.position.version===f.version)return l.position;if(l)l.position.version=f.version;else{const p={w:f.data.width+2,h:f.data.height+2,x:0,y:0},y=new o.I(p,f);this.patterns[r]={bin:p,position:y}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){const l=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Fe(r,this.atlasImage,l.RGBA),this.atlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE)}_updatePatternAtlas(){const r=[];for(const y in this.patterns)r.push(this.patterns[y].bin);const{w:l,h:f}=o.p(r),p=this.atlasImage;p.resize({width:l||1,height:f||1});for(const y in this.patterns){const{bin:T}=this.patterns[y],S=T.x+1,A=T.y+1,F=this.getImage(y).data,L=F.width,R=F.height;o.R.copy(F,p,{x:0,y:0},{x:S,y:A},{width:L,height:R}),o.R.copy(F,p,{x:0,y:R-1},{x:S,y:A-1},{width:L,height:1}),o.R.copy(F,p,{x:0,y:0},{x:S,y:A+R},{width:L,height:1}),o.R.copy(F,p,{x:L-1,y:0},{x:S-1,y:A},{width:1,height:R}),o.R.copy(F,p,{x:0,y:0},{x:S+L,y:A},{width:1,height:R})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(r){for(const l of r){if(this.callbackDispatchedThisFrame[l])continue;this.callbackDispatchedThisFrame[l]=!0;const f=this.getImage(l);f||o.w(`Image with ID: "${l}" was not found`),Oe(f)&&this.updateImage(l,f)}}}const rt=1e20;function ft(g,r,l,f,p,y,T,S,A){for(let F=r;F<r+f;F++)lt(g,l*y+F,y,p,T,S,A);for(let F=l;F<l+p;F++)lt(g,F*y+r,1,f,T,S,A)}function lt(g,r,l,f,p,y,T){y[0]=0,T[0]=-rt,T[1]=rt,p[0]=g[r];for(let S=1,A=0,F=0;S<f;S++){p[S]=g[r+S*l];const L=S*S;do{const R=y[A];F=(p[S]-p[R]+L-R*R)/(S-R)/2}while(F<=T[A]&&--A>-1);A++,y[A]=S,T[A]=F,T[A+1]=rt}for(let S=0,A=0;S<f;S++){for(;T[A+1]<S;)A++;const F=y[A],L=S-F;g[r+S*l]=p[F]+L*L}}class _t{constructor(r,l){this.requestManager=r,this.localIdeographFontFamily=l,this.entries={}}setURL(r){this.url=r}getGlyphs(r,l){const f=[];for(const p in r)for(const y of r[p])f.push({stack:p,id:y});o.o(f,({stack:p,id:y},T)=>{let S=this.entries[p];S||(S=this.entries[p]={glyphs:{},requests:{},ranges:{}});let A=S.glyphs[y];if(A!==void 0)return void T(null,{stack:p,id:y,glyph:A});if(A=this._tinySDF(S,p,y),A)return S.glyphs[y]=A,void T(null,{stack:p,id:y,glyph:A});const F=Math.floor(y/256);if(256*F>65535)return void T(new Error("glyphs > 65535 not supported"));if(S.ranges[F])return void T(null,{stack:p,id:y,glyph:A});if(!this.url)return void T(new Error("glyphsUrl is not set"));let L=S.requests[F];L||(L=S.requests[F]=[],_t.loadGlyphRange(p,F,this.url,this.requestManager,(R,q)=>{if(q){for(const oe in q)this._doesCharSupportLocalGlyph(+oe)||(S.glyphs[+oe]=q[+oe]);S.ranges[F]=!0}for(const oe of L)oe(R,q);delete S.requests[F]})),L.push((R,q)=>{R?T(R):q&&T(null,{stack:p,id:y,glyph:q[y]||null})})},(p,y)=>{if(p)l(p);else if(y){const T={};for(const{stack:S,id:A,glyph:F}of y)(T[S]||(T[S]={}))[A]=F&&{id:F.id,bitmap:F.bitmap.clone(),metrics:F.metrics};l(null,T)}})}_doesCharSupportLocalGlyph(r){return!!this.localIdeographFontFamily&&(o.u["CJK Unified Ideographs"](r)||o.u["Hangul Syllables"](r)||o.u.Hiragana(r)||o.u.Katakana(r))}_tinySDF(r,l,f){const p=this.localIdeographFontFamily;if(!p||!this._doesCharSupportLocalGlyph(f))return;let y=r.tinySDF;if(!y){let S="400";/bold/i.test(l)?S="900":/medium/i.test(l)?S="500":/light/i.test(l)&&(S="200"),y=r.tinySDF=new _t.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:p,fontWeight:S})}const T=y.draw(String.fromCharCode(f));return{id:f,bitmap:new o.q({width:T.width||60,height:T.height||60},T.data),metrics:{width:T.glyphWidth/2||24,height:T.glyphHeight/2||24,left:T.glyphLeft/2+.5||0,top:T.glyphTop/2-27.5||-8,advance:T.glyphAdvance/2||24,isDoubleResolution:!0}}}}_t.loadGlyphRange=function(g,r,l,f,p){const y=256*r,T=y+255,S=f.transformRequest(l.replace("{fontstack}",g).replace("{range}",`${y}-${T}`),ee.Glyphs);o.l(S,(A,F)=>{if(A)p(A);else if(F){const L={};for(const R of o.n(F))L[R.id]=R;p(null,L)}})},_t.TinySDF=class{constructor({fontSize:g=24,buffer:r=3,radius:l=8,cutoff:f=.25,fontFamily:p="sans-serif",fontWeight:y="normal",fontStyle:T="normal"}={}){this.buffer=r,this.cutoff=f,this.radius=l;const S=this.size=g+4*r,A=this._createCanvas(S),F=this.ctx=A.getContext("2d",{willReadFrequently:!0});F.font=`${T} ${y} ${g}px ${p}`,F.textBaseline="alphabetic",F.textAlign="left",F.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(g){const r=document.createElement("canvas");return r.width=r.height=g,r}draw(g){const{width:r,actualBoundingBoxAscent:l,actualBoundingBoxDescent:f,actualBoundingBoxLeft:p,actualBoundingBoxRight:y}=this.ctx.measureText(g),T=Math.ceil(l),S=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(y-p))),A=Math.min(this.size-this.buffer,T+Math.ceil(f)),F=S+2*this.buffer,L=A+2*this.buffer,R=Math.max(F*L,0),q=new Uint8ClampedArray(R),oe={data:q,width:F,height:L,glyphWidth:S,glyphHeight:A,glyphTop:T,glyphLeft:0,glyphAdvance:r};if(S===0||A===0)return oe;const{ctx:se,buffer:he,gridInner:ie,gridOuter:Pe}=this;se.clearRect(he,he,S,A),se.fillText(g,he,he+T);const $e=se.getImageData(he,he,S,A);Pe.fill(rt,0,R),ie.fill(0,0,R);for(let ye=0;ye<A;ye++)for(let Le=0;Le<S;Le++){const qe=$e.data[4*(ye*S+Le)+3]/255;if(qe===0)continue;const We=(ye+he)*F+Le+he;if(qe===1)Pe[We]=0,ie[We]=rt;else{const tt=.5-qe;Pe[We]=tt>0?tt*tt:0,ie[We]=tt<0?tt*tt:0}}ft(Pe,0,0,F,L,F,this.f,this.v,this.z),ft(ie,he,he,S,A,F,this.f,this.v,this.z);for(let ye=0;ye<R;ye++){const Le=Math.sqrt(Pe[ye])-Math.sqrt(ie[ye]);q[ye]=Math.round(255-255*(Le/this.radius+this.cutoff))}return oe}};class nt{constructor(){this.specification=o.v.light.position}possiblyEvaluate(r,l){return o.z(r.expression.evaluate(l))}interpolate(r,l,f){return{x:o.B.number(r.x,l.x,f),y:o.B.number(r.y,l.y,f),z:o.B.number(r.z,l.z,f)}}}let Kt;class He extends o.E{constructor(r){super(),Kt=Kt||new o.r({anchor:new o.D(o.v.light.anchor),position:new nt,color:new o.D(o.v.light.color),intensity:new o.D(o.v.light.intensity)}),this._transitionable=new o.T(Kt),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,l={}){if(!this._validate(o.t,r,l))for(const f in r){const p=r[f];f.endsWith("-transition")?this._transitionable.setTransition(f.slice(0,-11),p):this._transitionable.setValue(f,p)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,l,f){return(!f||f.validate!==!1)&&o.x(this,r.call(o.y,o.e({value:l,style:{glyphs:!0,sprite:!0},styleSpec:o.v})))}}class Nt{constructor(r,l){this.width=r,this.height=l,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(r,l){const f=r.join(",")+String(l);return this.dashEntry[f]||(this.dashEntry[f]=this.addDash(r,l)),this.dashEntry[f]}getDashRanges(r,l,f){const p=[];let y=r.length%2==1?-r[r.length-1]*f:0,T=r[0]*f,S=!0;p.push({left:y,right:T,isDash:S,zeroLength:r[0]===0});let A=r[0];for(let F=1;F<r.length;F++){S=!S;const L=r[F];y=A*f,A+=L,T=A*f,p.push({left:y,right:T,isDash:S,zeroLength:L===0})}return p}addRoundDash(r,l,f){const p=l/2;for(let y=-f;y<=f;y++){const T=this.width*(this.nextRow+f+y);let S=0,A=r[S];for(let F=0;F<this.width;F++){F/A.right>1&&(A=r[++S]);const L=Math.abs(F-A.left),R=Math.abs(F-A.right),q=Math.min(L,R);let oe;const se=y/f*(p+1);if(A.isDash){const he=p-Math.abs(se);oe=Math.sqrt(q*q+he*he)}else oe=p-Math.sqrt(q*q+se*se);this.data[T+F]=Math.max(0,Math.min(255,oe+128))}}}addRegularDash(r){for(let S=r.length-1;S>=0;--S){const A=r[S],F=r[S+1];A.zeroLength?r.splice(S,1):F&&F.isDash===A.isDash&&(F.left=A.left,r.splice(S,1))}const l=r[0],f=r[r.length-1];l.isDash===f.isDash&&(l.left=f.left-this.width,f.right=l.right+this.width);const p=this.width*this.nextRow;let y=0,T=r[y];for(let S=0;S<this.width;S++){S/T.right>1&&(T=r[++y]);const A=Math.abs(S-T.left),F=Math.abs(S-T.right),L=Math.min(A,F);this.data[p+S]=Math.max(0,Math.min(255,(T.isDash?L:-L)+128))}}addDash(r,l){const f=l?7:0,p=2*f+1;if(this.nextRow+p>this.height)return o.w("LineAtlas out of space"),null;let y=0;for(let S=0;S<r.length;S++)y+=r[S];if(y!==0){const S=this.width/y,A=this.getDashRanges(r,this.width,S);l?this.addRoundDash(A,S,f):this.addRegularDash(A)}const T={y:(this.nextRow+f+.5)/this.height,height:2*f/this.height,width:y};return this.nextRow+=p,this.dirty=!0,T}bind(r){const l=r.gl;this.texture?(l.bindTexture(l.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,l.texSubImage2D(l.TEXTURE_2D,0,0,0,this.width,this.height,l.ALPHA,l.UNSIGNED_BYTE,this.data))):(this.texture=l.createTexture(),l.bindTexture(l.TEXTURE_2D,this.texture),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.REPEAT),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.REPEAT),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.LINEAR),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.LINEAR),l.texImage2D(l.TEXTURE_2D,0,l.ALPHA,this.width,this.height,0,l.ALPHA,l.UNSIGNED_BYTE,this.data))}}class Mt{constructor(r,l,f){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=f;const p=this.workerPool.acquire(f);for(let y=0;y<p.length;y++){const T=new o.C(p[y],l,f);T.name=`Worker ${y}`,this.actors.push(T)}if(!this.actors.length)throw new Error("No actors found")}broadcast(r,l,f){o.o(this.actors,(p,y)=>{p.send(r,l,y)},f=f||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(r=!0){this.actors.forEach(l=>{l.remove()}),this.actors=[],r&&this.workerPool.release(this.id)}}function pe(g,r,l){const f=function(p,y){if(p)return l(p);if(y){const T=o.F(o.e(y,g),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);y.vector_layers&&(T.vectorLayers=y.vector_layers,T.vectorLayerIds=T.vectorLayers.map(S=>S.id)),l(null,T)}};return g.url?o.f(r.transformRequest(g.url,ee.Source),f):o.h.frame(()=>f(null,g))}class Ee{constructor(r,l){r&&(l?this.setSouthWest(r).setNorthEast(l):Array.isArray(r)&&(r.length===4?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1])))}setNorthEast(r){return this._ne=r instanceof o.L?new o.L(r.lng,r.lat):o.L.convert(r),this}setSouthWest(r){return this._sw=r instanceof o.L?new o.L(r.lng,r.lat):o.L.convert(r),this}extend(r){const l=this._sw,f=this._ne;let p,y;if(r instanceof o.L)p=r,y=r;else{if(!(r instanceof Ee))return Array.isArray(r)?r.length===4||r.every(Array.isArray)?this.extend(Ee.convert(r)):this.extend(o.L.convert(r)):r&&("lng"in r||"lon"in r)&&"lat"in r?this.extend(o.L.convert(r)):this;if(p=r._sw,y=r._ne,!p||!y)return this}return l||f?(l.lng=Math.min(p.lng,l.lng),l.lat=Math.min(p.lat,l.lat),f.lng=Math.max(y.lng,f.lng),f.lat=Math.max(y.lat,f.lat)):(this._sw=new o.L(p.lng,p.lat),this._ne=new o.L(y.lng,y.lat)),this}getCenter(){return new o.L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new o.L(this.getWest(),this.getNorth())}getSouthEast(){return new o.L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:l,lat:f}=o.L.convert(r);let p=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&p}static convert(r){return r instanceof Ee?r:r&&new Ee(r)}static fromLngLat(r,l=0){const f=360*l/40075017,p=f/Math.cos(Math.PI/180*r.lat);return new Ee(new o.L(r.lng-p,r.lat-f),new o.L(r.lng+p,r.lat+f))}}class Se{constructor(r,l,f){this.bounds=Ee.convert(this.validateBounds(r)),this.minzoom=l||0,this.maxzoom=f||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const l=Math.pow(2,r.z),f=Math.floor(o.G(this.bounds.getWest())*l),p=Math.floor(o.H(this.bounds.getNorth())*l),y=Math.ceil(o.G(this.bounds.getEast())*l),T=Math.ceil(o.H(this.bounds.getSouth())*l);return r.x>=f&&r.x<y&&r.y>=p&&r.y<T}}class Ie extends o.E{constructor(r,l,f,p){if(super(),this.load=()=>{this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this._tileJSONRequest=pe(this._options,this.map._requestManager,(y,T)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),y?this.fire(new o.j(y)):T&&(o.e(this,T),T.bounds&&(this.tileBounds=new Se(T.bounds,this.minzoom,this.maxzoom)),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>o.e({},this._options),this.id=r,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.e(this,o.F(l,["url","scheme","tileSize","promoteId"])),this._options=o.e({type:"vector"},l),this._collectResourceTiming=l.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p)}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}setSourceProperty(r){this._tileJSONRequest&&this._tileJSONRequest.cancel(),r(),this.load()}setTiles(r){return this.setSourceProperty(()=>{this._options.tiles=r}),this}setUrl(r){return this.setSourceProperty(()=>{this.url=r,this._options.url=r}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(r,l){const f=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p={request:this.map._requestManager.transformRequest(f,ee.Tile),uid:r.uid,tileID:r.tileID,zoom:r.tileID.overscaledZ,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function y(T,S){return delete r.request,r.aborted?l(null):T&&T.status!==404?l(T):(S&&S.resourceTiming&&(r.resourceTiming=S.resourceTiming),this.map._refreshExpiredTiles&&S&&r.setExpiryData(S),r.loadVectorData(S,this.map.painter),l(null),void(r.reloadCallback&&(this.loadTile(r,r.reloadCallback),r.reloadCallback=null)))}p.request.collectResourceTiming=this._collectResourceTiming,r.actor&&r.state!=="expired"?r.state==="loading"?r.reloadCallback=l:r.request=r.actor.send("reloadTile",p,y.bind(this)):(r.actor=this.dispatcher.getActor(),r.request=r.actor.send("loadTile",p,y.bind(this)))}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id},void 0)}unloadTile(r){r.unloadVectorData(),r.actor&&r.actor.send("removeTile",{uid:r.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Ke extends o.E{constructor(r,l,f,p){super(),this.id=r,this.dispatcher=f,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.e({type:"raster"},l),o.e(this,o.F(l,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this._tileJSONRequest=pe(this._options,this.map._requestManager,(r,l)=>{this._tileJSONRequest=null,this._loaded=!0,r?this.fire(new o.j(r)):l&&(o.e(this,l),l.bounds&&(this.tileBounds=new Se(l.bounds,this.minzoom,this.maxzoom)),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}setSourceProperty(r){this._tileJSONRequest&&this._tileJSONRequest.cancel(),r(),this.load()}setTiles(r){return this.setSourceProperty(()=>{this._options.tiles=r}),this}serialize(){return o.e({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,l){const f=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);r.request=j.getImage(this.map._requestManager.transformRequest(f,ee.Tile),(p,y,T)=>{if(delete r.request,r.aborted)r.state="unloaded",l(null);else if(p)r.state="errored",l(p);else if(y){this.map._refreshExpiredTiles&&T&&r.setExpiryData(T);const S=this.map.painter.context,A=S.gl;r.texture=this.map.painter.getTileTexture(y.width),r.texture?r.texture.update(y,{useMipmap:!0}):(r.texture=new Fe(S,y,A.RGBA,{useMipmap:!0}),r.texture.bind(A.LINEAR,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),S.extTextureFilterAnisotropic&&A.texParameterf(A.TEXTURE_2D,S.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,S.extTextureFilterAnisotropicMax)),r.state="loaded",l(null)}},this.map._refreshExpiredTiles)}abortTile(r,l){r.request&&(r.request.cancel(),delete r.request),l()}unloadTile(r,l){r.texture&&this.map.painter.saveTileTexture(r.texture),l()}hasTransition(){return!1}}class dt extends Ke{constructor(r,l,f,p){super(r,l,f,p),this.type="raster-dem",this.maxzoom=22,this._options=o.e({type:"raster-dem"},l),this.encoding=l.encoding||"mapbox",this.redFactor=l.redFactor,this.greenFactor=l.greenFactor,this.blueFactor=l.blueFactor,this.baseShift=l.baseShift}loadTile(r,l){const f=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p=this.map._requestManager.transformRequest(f,ee.Tile);function y(T,S){T&&(r.state="errored",l(T)),S&&(r.dem=S,r.needsHillshadePrepare=!0,r.needsTerrainPrepare=!0,r.state="loaded",l(null))}r.neighboringTiles=this._getNeighboringTiles(r.tileID),r.request=j.getImage(p,(T,S,A)=>o._(this,void 0,void 0,function*(){if(delete r.request,r.aborted)r.state="unloaded",l(null);else if(T)r.state="errored",l(T);else if(S){this.map._refreshExpiredTiles&&r.setExpiryData(A);const F=o.a(S)&&o.J()?S:yield function(R){return o._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&o.K()){const q=R.width+2,oe=R.height+2;try{return new o.R({width:q,height:oe},yield o.M(R,-1,-1,q,oe))}catch{}}return o.h.getImageData(R,1)})}(S),L={uid:r.uid,coord:r.tileID,source:this.id,rawImageData:F,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};r.actor&&r.state!=="expired"||(r.actor=this.dispatcher.getActor(),r.actor.send("loadDEMTile",L,y))}}),this.map._refreshExpiredTiles)}_getNeighboringTiles(r){const l=r.canonical,f=Math.pow(2,l.z),p=(l.x-1+f)%f,y=l.x===0?r.wrap-1:r.wrap,T=(l.x+1+f)%f,S=l.x+1===f?r.wrap+1:r.wrap,A={};return A[new o.O(r.overscaledZ,y,l.z,p,l.y).key]={backfilled:!1},A[new o.O(r.overscaledZ,S,l.z,T,l.y).key]={backfilled:!1},l.y>0&&(A[new o.O(r.overscaledZ,y,l.z,p,l.y-1).key]={backfilled:!1},A[new o.O(r.overscaledZ,r.wrap,l.z,l.x,l.y-1).key]={backfilled:!1},A[new o.O(r.overscaledZ,S,l.z,T,l.y-1).key]={backfilled:!1}),l.y+1<f&&(A[new o.O(r.overscaledZ,y,l.z,p,l.y+1).key]={backfilled:!1},A[new o.O(r.overscaledZ,r.wrap,l.z,l.x,l.y+1).key]={backfilled:!1},A[new o.O(r.overscaledZ,S,l.z,T,l.y+1).key]={backfilled:!1}),A}unloadTile(r){r.demTexture&&this.map.painter.saveTileTexture(r.demTexture),r.fbo&&(r.fbo.destroy(),delete r.fbo),r.dem&&delete r.dem,delete r.neighboringTiles,r.state="unloaded",r.actor&&r.actor.send("removeDEMTile",{uid:r.uid,source:this.id})}}class vt extends o.E{constructor(r,l,f,p){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>o.e({},this._options,{type:this.type,data:this._data}),this.id=r,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=f.getActor(),this.setEventedParent(p),this._data=l.data,this._options=o.e({},l),this._collectResourceTiming=l.collectResourceTiming,l.maxzoom!==void 0&&(this.maxzoom=l.maxzoom),l.type&&(this.type=l.type),l.attribution&&(this.attribution=l.attribution),this.promoteId=l.promoteId;const y=o.N/this.tileSize;this.workerOptions=o.e({source:this.id,cluster:l.cluster||!1,geojsonVtOptions:{buffer:(l.buffer!==void 0?l.buffer:128)*y,tolerance:(l.tolerance!==void 0?l.tolerance:.375)*y,extent:o.N,maxZoom:this.maxzoom,lineMetrics:l.lineMetrics||!1,generateId:l.generateId||!1},superclusterOptions:{maxZoom:l.clusterMaxZoom!==void 0?l.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,l.clusterMinPoints||2),extent:o.N,radius:(l.clusterRadius||50)*y,log:!1,generateId:l.generateId||!1},clusterProperties:l.clusterProperties,filter:l.filter},l.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(r){this.map=r,this.load()}setData(r){return this._data=r,this._updateWorkerData(),this}updateData(r){return this._updateWorkerData(r),this}setClusterOptions(r){return this.workerOptions.cluster=r.cluster,r&&(r.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=r.clusterRadius),r.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=r.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(r,l){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:r,source:this.id},l),this}getClusterChildren(r,l){return this.actor.send("geojson.getClusterChildren",{clusterId:r,source:this.id},l),this}getClusterLeaves(r,l,f,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:r,limit:l,offset:f},p),this}_updateWorkerData(r){const l=o.e({},this.workerOptions);r?l.dataDiff=r:typeof this._data=="string"?(l.request=this.map._requestManager.transformRequest(o.h.resolveURL(this._data),ee.Source),l.request.collectResourceTiming=this._collectResourceTiming):l.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new o.k("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,l,(f,p)=>{if(this._pendingLoads--,this._removed||p&&p.abandoned)return void this.fire(new o.k("dataabort",{dataType:"source"}));let y=null;if(p&&p.resourceTiming&&p.resourceTiming[this.id]&&(y=p.resourceTiming[this.id].slice(0)),f)return void this.fire(new o.j(f));const T={dataType:"source"};this._collectResourceTiming&&y&&y.length>0&&o.e(T,{resourceTiming:y}),this.fire(new o.k("data",Object.assign(Object.assign({},T),{sourceDataType:"metadata"}))),this.fire(new o.k("data",Object.assign(Object.assign({},T),{sourceDataType:"content"})))})}loaded(){return this._pendingLoads===0}loadTile(r,l){const f=r.actor?"reloadTile":"loadTile";r.actor=this.actor;const p={type:this.type,uid:r.uid,tileID:r.tileID,zoom:r.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};r.request=this.actor.send(f,p,(y,T)=>(delete r.request,r.unloadVectorData(),r.aborted?l(null):y?l(y):(r.loadVectorData(T,this.map.painter,f==="reloadTile"),l(null))))}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.aborted=!0}unloadTile(r){r.unloadVectorData(),this.actor.send("removeTile",{uid:r.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var ut=o.Q([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Qe extends o.E{constructor(r,l,f,p){super(),this.load=(y,T)=>{this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=j.getImage(this.map._requestManager.transformRequest(this.url,ee.Image),(S,A)=>{this._request=null,this._loaded=!0,S?this.fire(new o.j(S)):A&&(this.image=A,y&&(this.coordinates=y),T&&T(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;const y=this.map.painter.context,T=y.gl;this.boundsBuffer||(this.boundsBuffer=y.createVertexBuffer(this._boundsArray,ut.members)),this.boundsSegments||(this.boundsSegments=o.S.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Fe(y,this.image,T.RGBA),this.texture.bind(T.LINEAR,T.CLAMP_TO_EDGE));let S=!1;for(const A in this.tiles){const F=this.tiles[A];F.state!=="loaded"&&(F.state="loaded",F.texture=this.texture,S=!0)}S&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=r,this.dispatcher=f,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(p),this.options=l}loaded(){return this._loaded}updateImage(r){return r.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=r.url,this.load(r.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(r){this.coordinates=r;const l=r.map(o.U.fromLngLat);this.tileID=function(p){let y=1/0,T=1/0,S=-1/0,A=-1/0;for(const q of p)y=Math.min(y,q.x),T=Math.min(T,q.y),S=Math.max(S,q.x),A=Math.max(A,q.y);const F=Math.max(S-y,A-T),L=Math.max(0,Math.floor(-Math.log(F)/Math.LN2)),R=Math.pow(2,L);return new o.W(L,Math.floor((y+S)/2*R),Math.floor((T+A)/2*R))}(l),this.minzoom=this.maxzoom=this.tileID.z;const f=l.map(p=>this.tileID.getTilePoint(p)._round());return this._boundsArray=new o.V,this._boundsArray.emplaceBack(f[0].x,f[0].y,0,0),this._boundsArray.emplaceBack(f[1].x,f[1].y,o.N,0),this._boundsArray.emplaceBack(f[3].x,f[3].y,0,o.N),this._boundsArray.emplaceBack(f[2].x,f[2].y,o.N,o.N),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(r,l){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},l(null)):(r.state="errored",l(null))}hasTransition(){return!1}}class qt extends Qe{constructor(r,l,f,p){super(r,l,f,p),this.load=()=>{this._loaded=!1;const y=this.options;this.urls=[];for(const T of y.urls)this.urls.push(this.map._requestManager.transformRequest(T,ee.Source).url);o.X(this.urls,(T,S)=>{this._loaded=!0,T?this.fire(new o.j(T)):S&&(this.video=S,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const y=this.map.painter.context,T=y.gl;this.boundsBuffer||(this.boundsBuffer=y.createVertexBuffer(this._boundsArray,ut.members)),this.boundsSegments||(this.boundsSegments=o.S.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(T.LINEAR,T.CLAMP_TO_EDGE),T.texSubImage2D(T.TEXTURE_2D,0,0,0,T.RGBA,T.UNSIGNED_BYTE,this.video)):(this.texture=new Fe(y,this.video,T.RGBA),this.texture.bind(T.LINEAR,T.CLAMP_TO_EDGE));let S=!1;for(const A in this.tiles){const F=this.tiles[A];F.state!=="loaded"&&(F.state="loaded",F.texture=this.texture,S=!0)}S&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=l}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(r){if(this.video){const l=this.video.seekable;r<l.start(0)||r>l.end(0)?this.fire(new o.j(new o.Y(`sources.${this.id}`,null,`Playback for this video can be set only between the ${l.start(0)} and ${l.end(0)}-second mark.`))):this.video.currentTime=r}}getVideo(){return this.video}onAdd(r){this.map||(this.map=r,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class _e extends Qe{constructor(r,l,f,p){super(r,l,f,p),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let y=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,y=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,y=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const T=this.map.painter.context,S=T.gl;this.boundsBuffer||(this.boundsBuffer=T.createVertexBuffer(this._boundsArray,ut.members)),this.boundsSegments||(this.boundsSegments=o.S.simpleSegment(0,0,4,2)),this.texture?(y||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Fe(T,this.canvas,S.RGBA,{premultiply:!0});let A=!1;for(const F in this.tiles){const L=this.tiles[F];L.state!=="loaded"&&(L.state="loaded",L.texture=this.texture,A=!0)}A&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),l.coordinates?Array.isArray(l.coordinates)&&l.coordinates.length===4&&!l.coordinates.some(y=>!Array.isArray(y)||y.length!==2||y.some(T=>typeof T!="number"))||this.fire(new o.j(new o.Y(`sources.${r}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.j(new o.Y(`sources.${r}`,null,'missing required property "coordinates"'))),l.animate&&typeof l.animate!="boolean"&&this.fire(new o.j(new o.Y(`sources.${r}`,null,'optional "animate" property must be a boolean value'))),l.canvas?typeof l.canvas=="string"||l.canvas instanceof HTMLCanvasElement||this.fire(new o.j(new o.Y(`sources.${r}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.j(new o.Y(`sources.${r}`,null,'missing required property "canvas"'))),this.options=l,this.animate=l.animate===void 0||l.animate}getCanvas(){return this.canvas}onAdd(r){this.map=r,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const r of[this.canvas.width,this.canvas.height])if(isNaN(r)||r<=0)return!0;return!1}}const Yt={},Wt=g=>{switch(g){case"geojson":return vt;case"image":return Qe;case"raster":return Ke;case"raster-dem":return dt;case"vector":return Ie;case"video":return qt;case"canvas":return _e}return Yt[g]};function nr(g,r){const l=o.Z();return o.$(l,l,[1,1,0]),o.a0(l,l,[.5*g.width,.5*g.height,1]),o.a1(l,l,g.calculatePosMatrix(r.toUnwrapped()))}function Zt(g,r,l,f,p,y){const T=function(R,q,oe){if(R)for(const se of R){const he=q[se];if(he&&he.source===oe&&he.type==="fill-extrusion")return!0}else for(const se in q){const he=q[se];if(he.source===oe&&he.type==="fill-extrusion")return!0}return!1}(p&&p.layers,r,g.id),S=y.maxPitchScaleFactor(),A=g.tilesIn(f,S,T);A.sort(wt);const F=[];for(const R of A)F.push({wrappedTileID:R.tileID.wrapped().key,queryResults:R.tile.queryRenderedFeatures(r,l,g._state,R.queryGeometry,R.cameraQueryGeometry,R.scale,p,y,S,nr(g.transform,R.tileID))});const L=function(R){const q={},oe={};for(const se of R){const he=se.queryResults,ie=se.wrappedTileID,Pe=oe[ie]=oe[ie]||{};for(const $e in he){const ye=he[$e],Le=Pe[$e]=Pe[$e]||{},qe=q[$e]=q[$e]||[];for(const We of ye)Le[We.featureIndex]||(Le[We.featureIndex]=!0,qe.push(We))}}return q}(F);for(const R in L)L[R].forEach(q=>{const oe=q.feature,se=g.getFeatureState(oe.layer["source-layer"],oe.id);oe.source=oe.layer.source,oe.layer["source-layer"]&&(oe.sourceLayer=oe.layer["source-layer"]),oe.state=se});return L}function wt(g,r){const l=g.tileID,f=r.tileID;return l.overscaledZ-f.overscaledZ||l.canonical.y-f.canonical.y||l.wrap-f.wrap||l.canonical.x-f.canonical.x}class gr{constructor(r,l){this.timeAdded=0,this.fadeEndTime=0,this.tileID=r,this.uid=o.a2(),this.uses=0,this.tileSize=l,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(r){const l=r+this.timeAdded;l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(r){this.demTexture&&r.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(r,l,f){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=function(p,y){const T={};if(!y)return T;for(const S of p){const A=S.layerIds.map(F=>y.getLayer(F)).filter(Boolean);if(A.length!==0){S.layers=A,S.stateDependentLayerIds&&(S.stateDependentLayers=S.stateDependentLayerIds.map(F=>A.filter(L=>L.id===F)[0]));for(const F of A)T[F.id]=S}}return T}(r.buckets,l.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const y=this.buckets[p];if(y instanceof o.a4){if(this.hasSymbolBuckets=!0,!f)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const y=this.buckets[p];if(y instanceof o.a4&&y.hasRTLText){this.hasRTLText=!0,o.a5();break}}this.queryPadding=0;for(const p in this.buckets){const y=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,l.style.getLayer(p).queryRadius(y))}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage)}else this.collisionBoxArray=new o.a3}unloadVectorData(){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(r){return this.buckets[r.id]}upload(r){for(const f in this.buckets){const p=this.buckets[f];p.uploadPending()&&p.upload(r)}const l=r.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Fe(r,this.imageAtlas.image,l.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Fe(r,this.glyphAtlasImage,l.ALPHA),this.glyphAtlasImage=null)}prepare(r){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture)}queryRenderedFeatures(r,l,f,p,y,T,S,A,F,L){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:p,cameraQueryGeometry:y,scale:T,tileSize:this.tileSize,pixelPosMatrix:L,transform:A,params:S,queryPadding:this.queryPadding*F},r,l,f):{}}querySourceFeatures(r,l){const f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;const p=f.loadVTLayers(),y=l&&l.sourceLayer?l.sourceLayer:"",T=p._geojsonTileLayer||p[y];if(!T)return;const S=o.a6(l&&l.filter),{z:A,x:F,y:L}=this.tileID.canonical,R={z:A,x:F,y:L};for(let q=0;q<T.length;q++){const oe=T.feature(q);if(S.needGeometry){const ie=o.a7(oe,!0);if(!S.filter(new o.a8(this.tileID.overscaledZ),ie,this.tileID.canonical))continue}else if(!S.filter(new o.a8(this.tileID.overscaledZ),oe))continue;const se=f.getId(oe,y),he=new o.a9(oe,A,F,L,se);he.tile=R,r.push(he)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){const l=this.expirationTime;if(r.cacheControl){const f=o.aa(r.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const f=Date.now();let p=!1;if(this.expirationTime>f)p=!1;else if(l)if(this.expirationTime<l)p=!0;else{const y=this.expirationTime-l;y?this.expirationTime=f+Math.max(y,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(r,l){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(r).length===0)return;const f=this.latestFeatureIndex.loadVTLayers();for(const p in this.buckets){if(!l.style.hasLayer(p))continue;const y=this.buckets[p],T=y.layers[0].sourceLayer||"_geojsonTileLayer",S=f[T],A=r[T];if(!S||!A||Object.keys(A).length===0)continue;y.update(A,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});const F=l&&l.style&&l.style.getLayer(p);F&&(this.queryPadding=Math.max(this.queryPadding,F.queryRadius(y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.h.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=o.h.now()+r}setDependencies(r,l){const f={};for(const p of l)f[p]=!0;this.dependencies[r]=f}hasDependency(r,l){for(const f of r){const p=this.dependencies[f];if(p){for(const y of l)if(p[y])return!0}}return!1}}class Mr{constructor(r,l){this.max=r,this.onRemove=l,this.reset()}reset(){for(const r in this.data)for(const l of this.data[r])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(r,l,f){const p=r.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);const y={value:l,timeout:void 0};if(f!==void 0&&(y.timeout=setTimeout(()=>{this.remove(r,y)},f)),this.data[p].push(y),this.order.push(p),this.order.length>this.max){const T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const l=this.data[r].shift();return l.timeout&&clearTimeout(l.timeout),this.data[r].length===0&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),l.value}getByKey(r){const l=this.data[r];return l?l[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,l){if(!this.has(r))return this;const f=r.wrapped().key,p=l===void 0?0:this.data[f].indexOf(l),y=this.data[f][p];return this.data[f].splice(p,1),y.timeout&&clearTimeout(y.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(y.value),this.order.splice(this.order.indexOf(f),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(r){const l=[];for(const f in this.data)for(const p of this.data[f])r(p.value)||l.push(p);for(const f of l)this.remove(f.value.tileID,f)}}class Xe{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,l,f){const p=String(l);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][p]=this.stateChanges[r][p]||{},o.e(this.stateChanges[r][p],f),this.deletedStates[r]===null){this.deletedStates[r]={};for(const y in this.state[r])y!==p&&(this.deletedStates[r][y]=null)}else if(this.deletedStates[r]&&this.deletedStates[r][p]===null){this.deletedStates[r][p]={};for(const y in this.state[r][p])f[y]||(this.deletedStates[r][p][y]=null)}else for(const y in f)this.deletedStates[r]&&this.deletedStates[r][p]&&this.deletedStates[r][p][y]===null&&delete this.deletedStates[r][p][y]}removeFeatureState(r,l,f){if(this.deletedStates[r]===null)return;const p=String(l);if(this.deletedStates[r]=this.deletedStates[r]||{},f&&l!==void 0)this.deletedStates[r][p]!==null&&(this.deletedStates[r][p]=this.deletedStates[r][p]||{},this.deletedStates[r][p][f]=null);else if(l!==void 0)if(this.stateChanges[r]&&this.stateChanges[r][p])for(f in this.deletedStates[r][p]={},this.stateChanges[r][p])this.deletedStates[r][p][f]=null;else this.deletedStates[r][p]=null;else this.deletedStates[r]=null}getState(r,l){const f=String(l),p=o.e({},(this.state[r]||{})[f],(this.stateChanges[r]||{})[f]);if(this.deletedStates[r]===null)return{};if(this.deletedStates[r]){const y=this.deletedStates[r][l];if(y===null)return{};for(const T in y)delete p[T]}return p}initializeTileState(r,l){r.setFeatureState(this.state,l)}coalesceChanges(r,l){const f={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const y={};for(const T in this.stateChanges[p])this.state[p][T]||(this.state[p][T]={}),o.e(this.state[p][T],this.stateChanges[p][T]),y[T]=this.state[p][T];f[p]=y}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const y={};if(this.deletedStates[p]===null)for(const T in this.state[p])y[T]={},this.state[p][T]={};else for(const T in this.deletedStates[p]){if(this.deletedStates[p][T]===null)this.state[p][T]={};else for(const S of Object.keys(this.deletedStates[p][T]))delete this.state[p][T][S];y[T]=this.state[p][T]}f[p]=f[p]||{},o.e(f[p],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0)for(const p in r)r[p].setFeatureState(f,l)}}class Sr extends o.E{constructor(r,l,f){super(),this.id=r,this.dispatcher=f,this.on("data",p=>{p.dataType==="source"&&p.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&p.dataType==="source"&&p.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((p,y,T,S)=>{const A=new(Wt(y.type))(p,y,T,S);if(A.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${A.id}`);return A})(r,l,f,this),this._tiles={},this._cache=new Mr(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Xe,this._didEmitContent=!1,this._updated=!1}onAdd(r){this.map=r,this._maxTileCacheSize=r?r._maxTileCacheSize:null,this._maxTileCacheZoomLevels=r?r._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(r)}onRemove(r){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(r)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const r in this._tiles){const l=this._tiles[r];if(l.state!=="loaded"&&l.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(r,l){return this._source.loadTile(r,l)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r,()=>{})}_abortTile(r){this._source.abortTile&&this._source.abortTile(r,()=>{}),this._source.fire(new o.k("dataabort",{tile:r,coord:r.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const l in this._tiles){const f=this._tiles[l];f.upload(r),f.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(r=>r.tileID).sort(Vr).map(r=>r.key)}getRenderableIds(r){const l=[];for(const f in this._tiles)this._isIdRenderable(f,r)&&l.push(this._tiles[f]);return r?l.sort((f,p)=>{const y=f.tileID,T=p.tileID,S=new o.P(y.canonical.x,y.canonical.y)._rotate(this.transform.angle),A=new o.P(T.canonical.x,T.canonical.y)._rotate(this.transform.angle);return y.overscaledZ-T.overscaledZ||A.y-S.y||A.x-S.x}).map(f=>f.tileID.key):l.map(f=>f.tileID).sort(Vr).map(f=>f.key)}hasRenderableParent(r){const l=this.findLoadedParent(r,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(r,l){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(l||!this._tiles[r].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)this._tiles[r].state!=="errored"&&this._reloadTile(r,"reloading")}}_reloadTile(r,l){const f=this._tiles[r];f&&(f.state!=="loading"&&(f.state=l),this._loadTile(f,this._tileLoaded.bind(this,f,r,l)))}_tileLoaded(r,l,f,p){if(p)return r.state="errored",void(p.status!==404?this._source.fire(new o.j(p,{tile:r})):this.update(this.transform,this.terrain));r.timeAdded=o.h.now(),f==="expired"&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(l,r),this.getSource().type==="raster-dem"&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),r.aborted||this._source.fire(new o.k("data",{dataType:"source",tile:r,coord:r.tileID}))}_backfillDEM(r){const l=this.getRenderableIds();for(let p=0;p<l.length;p++){const y=l[p];if(r.neighboringTiles&&r.neighboringTiles[y]){const T=this.getTileByID(y);f(r,T),f(T,r)}}function f(p,y){p.needsHillshadePrepare=!0,p.needsTerrainPrepare=!0;let T=y.tileID.canonical.x-p.tileID.canonical.x;const S=y.tileID.canonical.y-p.tileID.canonical.y,A=Math.pow(2,p.tileID.canonical.z),F=y.tileID.key;T===0&&S===0||Math.abs(S)>1||(Math.abs(T)>1&&(Math.abs(T+A)===1?T+=A:Math.abs(T-A)===1&&(T-=A)),y.dem&&p.dem&&(p.dem.backfillBorder(y.dem,T,S),p.neighboringTiles&&p.neighboringTiles[F]&&(p.neighboringTiles[F].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,l,f,p){for(const y in this._tiles){let T=this._tiles[y];if(p[y]||!T.hasData()||T.tileID.overscaledZ<=l||T.tileID.overscaledZ>f)continue;let S=T.tileID;for(;T&&T.tileID.overscaledZ>l+1;){const F=T.tileID.scaledTo(T.tileID.overscaledZ-1);T=this._tiles[F.key],T&&T.hasData()&&(S=F)}let A=S;for(;A.overscaledZ>l;)if(A=A.scaledTo(A.overscaledZ-1),r[A.key]){p[S.key]=S;break}}}findLoadedParent(r,l){if(r.key in this._loadedParentTiles){const f=this._loadedParentTiles[r.key];return f&&f.tileID.overscaledZ>=l?f:null}for(let f=r.overscaledZ-1;f>=l;f--){const p=r.scaledTo(f),y=this._getLoadedTile(p);if(y)return y}}_getLoadedTile(r){const l=this._tiles[r.key];return l&&l.hasData()?l:this._cache.getByKey(r.wrapped().key)}updateCacheSize(r){const l=Math.ceil(r.width/this._source.tileSize)+1,f=Math.ceil(r.height/this._source.tileSize)+1,p=Math.floor(l*f*(this._maxTileCacheZoomLevels===null?o.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._cache.setMaxSize(y)}handleWrapJump(r){const l=Math.round((r-(this._prevLng===void 0?r:this._prevLng))/360);if(this._prevLng=r,l){const f={};for(const p in this._tiles){const y=this._tiles[p];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+l),f[y.tileID.key]=y}this._tiles=f;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(p,this._tiles[p])}}update(r,l){if(this.transform=r,this.terrain=l,!this._sourceLoaded||this._paused)return;let f;this.updateCacheSize(r),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?f=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(L=>new o.O(L.canonical.z,L.wrap,L.canonical.z,L.canonical.x,L.canonical.y)):(f=r.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:l}),this._source.hasTile&&(f=f.filter(L=>this._source.hasTile(L)))):f=[];const p=r.coveringZoomLevel(this._source),y=Math.max(p-Sr.maxOverzooming,this._source.minzoom),T=Math.max(p+Sr.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const L={};for(const R of f)if(R.canonical.z>this._source.minzoom){const q=R.scaledTo(R.canonical.z-1);L[q.key]=q;const oe=R.scaledTo(Math.max(this._source.minzoom,Math.min(R.canonical.z,5)));L[oe.key]=oe}f=f.concat(Object.values(L))}const S=f.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,S&&this.fire(new o.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const A=this._updateRetainedTiles(f,p);if(lr(this._source.type)){const L={},R={},q=Object.keys(A),oe=o.h.now();for(const se of q){const he=A[se],ie=this._tiles[se];if(!ie||ie.fadeEndTime!==0&&ie.fadeEndTime<=oe)continue;const Pe=this.findLoadedParent(he,y);Pe&&(this._addTile(Pe.tileID),L[Pe.tileID.key]=Pe.tileID),R[se]=he}this._retainLoadedChildren(R,p,T,A);for(const se in L)A[se]||(this._coveredTiles[se]=!0,A[se]=L[se]);if(l){const se={},he={};for(const ie of f)this._tiles[ie.key].hasData()?se[ie.key]=ie:he[ie.key]=ie;for(const ie in he){const Pe=he[ie].children(this._source.maxzoom);this._tiles[Pe[0].key]&&this._tiles[Pe[1].key]&&this._tiles[Pe[2].key]&&this._tiles[Pe[3].key]&&(se[Pe[0].key]=A[Pe[0].key]=Pe[0],se[Pe[1].key]=A[Pe[1].key]=Pe[1],se[Pe[2].key]=A[Pe[2].key]=Pe[2],se[Pe[3].key]=A[Pe[3].key]=Pe[3],delete he[ie])}for(const ie in he){const Pe=this.findLoadedParent(he[ie],this._source.minzoom);if(Pe){se[Pe.tileID.key]=A[Pe.tileID.key]=Pe.tileID;for(const $e in se)se[$e].isChildOf(Pe.tileID)&&delete se[$e]}}for(const ie in this._tiles)se[ie]||(this._coveredTiles[ie]=!0)}}for(const L in A)this._tiles[L].clearFadeHold();const F=o.ab(this._tiles,A);for(const L of F){const R=this._tiles[L];R.hasSymbolBuckets&&!R.holdingForFade()?R.setHoldDuration(this.map._fadeDuration):R.hasSymbolBuckets&&!R.symbolFadeFinished()||this._removeTile(L)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(r)}_updateRetainedTiles(r,l){const f={},p={},y=Math.max(l-Sr.maxOverzooming,this._source.minzoom),T=Math.max(l+Sr.maxUnderzooming,this._source.minzoom),S={};for(const A of r){const F=this._addTile(A);f[A.key]=A,F.hasData()||l<this._source.maxzoom&&(S[A.key]=A)}this._retainLoadedChildren(S,l,T,f);for(const A of r){let F=this._tiles[A.key];if(F.hasData())continue;if(l+1>this._source.maxzoom){const R=A.children(this._source.maxzoom)[0],q=this.getTile(R);if(q&&q.hasData()){f[R.key]=R;continue}}else{const R=A.children(this._source.maxzoom);if(f[R[0].key]&&f[R[1].key]&&f[R[2].key]&&f[R[3].key])continue}let L=F.wasRequested();for(let R=A.overscaledZ-1;R>=y;--R){const q=A.scaledTo(R);if(p[q.key])break;if(p[q.key]=!0,F=this.getTile(q),!F&&L&&(F=this._addTile(q)),F){const oe=F.hasData();if((L||oe)&&(f[q.key]=q),L=F.wasRequested(),oe)break}}}return f}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const l=[];let f,p=this._tiles[r].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){f=this._loadedParentTiles[p.key];break}l.push(p.key);const y=p.scaledTo(p.overscaledZ-1);if(f=this._getLoadedTile(y),f)break;p=y}for(const y of l)this._loadedParentTiles[y]=f}}_addTile(r){let l=this._tiles[r.key];if(l)return l;l=this._cache.getAndRemove(r),l&&(this._setTileReloadTimer(r.key,l),l.tileID=r,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,l)));const f=l;return l||(l=new gr(r,this._source.tileSize*r.overscaleFactor()),this._loadTile(l,this._tileLoaded.bind(this,l,r.key,l.state))),l.uses++,this._tiles[r.key]=l,f||this._source.fire(new o.k("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l}_setTileReloadTimer(r,l){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const f=l.getExpiryTimeout();f&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},f))}_removeTile(r){const l=this._tiles[r];l&&(l.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),l.uses>0||(l.hasData()&&l.state!=="reloading"?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(r);this._cache.reset()}tilesIn(r,l,f){const p=[],y=this.transform;if(!y)return p;const T=f?y.getCameraQueryGeometry(r):r,S=r.map(se=>y.pointCoordinate(se,this.terrain)),A=T.map(se=>y.pointCoordinate(se,this.terrain)),F=this.getIds();let L=1/0,R=1/0,q=-1/0,oe=-1/0;for(const se of A)L=Math.min(L,se.x),R=Math.min(R,se.y),q=Math.max(q,se.x),oe=Math.max(oe,se.y);for(let se=0;se<F.length;se++){const he=this._tiles[F[se]];if(he.holdingForFade())continue;const ie=he.tileID,Pe=Math.pow(2,y.zoom-he.tileID.overscaledZ),$e=l*he.queryPadding*o.N/he.tileSize/Pe,ye=[ie.getTilePoint(new o.U(L,R)),ie.getTilePoint(new o.U(q,oe))];if(ye[0].x-$e<o.N&&ye[0].y-$e<o.N&&ye[1].x+$e>=0&&ye[1].y+$e>=0){const Le=S.map(We=>ie.getTilePoint(We)),qe=A.map(We=>ie.getTilePoint(We));p.push({tile:he,tileID:ie,queryGeometry:Le,cameraQueryGeometry:qe,scale:Pe})}}return p}getVisibleCoordinates(r){const l=this.getRenderableIds(r).map(f=>this._tiles[f].tileID);for(const f of l)f.posMatrix=this.transform.calculatePosMatrix(f.toUnwrapped());return l}hasTransition(){if(this._source.hasTransition())return!0;if(lr(this._source.type)){const r=o.h.now();for(const l in this._tiles)if(this._tiles[l].fadeEndTime>=r)return!0}return!1}setFeatureState(r,l,f){this._state.updateState(r=r||"_geojsonTileLayer",l,f)}removeFeatureState(r,l,f){this._state.removeFeatureState(r=r||"_geojsonTileLayer",l,f)}getFeatureState(r,l){return this._state.getState(r=r||"_geojsonTileLayer",l)}setDependencies(r,l,f){const p=this._tiles[r];p&&p.setDependencies(l,f)}reloadTilesForDependencies(r,l){for(const f in this._tiles)this._tiles[f].hasDependency(r,l)&&this._reloadTile(f,"reloading");this._cache.filter(f=>!f.hasDependency(r,l))}}function Vr(g,r){const l=Math.abs(2*g.wrap)-+(g.wrap<0),f=Math.abs(2*r.wrap)-+(r.wrap<0);return g.overscaledZ-r.overscaledZ||f-l||r.canonical.y-g.canonical.y||r.canonical.x-g.canonical.x}function lr(g){return g==="raster"||g==="image"||g==="video"}Sr.maxOverzooming=10,Sr.maxUnderzooming=3;const Xt="mapboxgl_preloaded_worker_pool";class Fr{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<Fr.workerCount;)this.workers.push(new Worker(o.c.WORKER_URL));return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],this.numActive()===0&&(this.workers.forEach(l=>{l.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Xt]}numActive(){return Object.keys(this.active).length}}const Or=Math.floor(o.h.hardwareConcurrency/2);let ia;function $r(){return ia||(ia=new Fr),ia}Fr.workerCount=o.ac(globalThis)?Math.max(Math.min(Or,3),1):1;class pa{constructor(r,l){this.reset(r,l)}reset(r,l){this.points=r||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=o.ad(r,0,1);let l=1,f=this._distances[l];const p=r*this.paddedLength+this.padding;for(;f<p&&l<this._distances.length;)f=this._distances[++l];const y=l-1,T=this._distances[y],S=f-T,A=S>0?(p-T)/S:0;return this.points[y].mult(1-A).add(this.points[l].mult(A))}}function Qt(g,r){let l=!0;return g==="always"||g!=="never"&&r!=="never"||(l=!1),l}class kr{constructor(r,l,f){const p=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(r/f),this.yCellCount=Math.ceil(l/f);for(let T=0;T<this.xCellCount*this.yCellCount;T++)p.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=l,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,l,f,p,y){this._forEachCell(l,f,p,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(l),this.bboxes.push(f),this.bboxes.push(p),this.bboxes.push(y)}insertCircle(r,l,f,p){this._forEachCell(l-p,f-p,l+p,f+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(l),this.circles.push(f),this.circles.push(p)}_insertBoxCell(r,l,f,p,y,T){this.boxCells[y].push(T)}_insertCircleCell(r,l,f,p,y,T){this.circleCells[y].push(T)}_query(r,l,f,p,y,T,S){if(f<0||r>this.width||p<0||l>this.height)return[];const A=[];if(r<=0&&l<=0&&this.width<=f&&this.height<=p){if(y)return[{key:null,x1:r,y1:l,x2:f,y2:p}];for(let F=0;F<this.boxKeys.length;F++)A.push({key:this.boxKeys[F],x1:this.bboxes[4*F],y1:this.bboxes[4*F+1],x2:this.bboxes[4*F+2],y2:this.bboxes[4*F+3]});for(let F=0;F<this.circleKeys.length;F++){const L=this.circles[3*F],R=this.circles[3*F+1],q=this.circles[3*F+2];A.push({key:this.circleKeys[F],x1:L-q,y1:R-q,x2:L+q,y2:R+q})}}else this._forEachCell(r,l,f,p,this._queryCell,A,{hitTest:y,overlapMode:T,seenUids:{box:{},circle:{}}},S);return A}query(r,l,f,p){return this._query(r,l,f,p,!1,null)}hitTest(r,l,f,p,y,T){return this._query(r,l,f,p,!0,y,T).length>0}hitTestCircle(r,l,f,p,y){const T=r-f,S=r+f,A=l-f,F=l+f;if(S<0||T>this.width||F<0||A>this.height)return!1;const L=[];return this._forEachCell(T,A,S,F,this._queryCellCircle,L,{hitTest:!0,overlapMode:p,circle:{x:r,y:l,radius:f},seenUids:{box:{},circle:{}}},y),L.length>0}_queryCell(r,l,f,p,y,T,S,A){const{seenUids:F,hitTest:L,overlapMode:R}=S,q=this.boxCells[y];if(q!==null){const se=this.bboxes;for(const he of q)if(!F.box[he]){F.box[he]=!0;const ie=4*he,Pe=this.boxKeys[he];if(r<=se[ie+2]&&l<=se[ie+3]&&f>=se[ie+0]&&p>=se[ie+1]&&(!A||A(Pe))&&(!L||!Qt(R,Pe.overlapMode))&&(T.push({key:Pe,x1:se[ie],y1:se[ie+1],x2:se[ie+2],y2:se[ie+3]}),L))return!0}}const oe=this.circleCells[y];if(oe!==null){const se=this.circles;for(const he of oe)if(!F.circle[he]){F.circle[he]=!0;const ie=3*he,Pe=this.circleKeys[he];if(this._circleAndRectCollide(se[ie],se[ie+1],se[ie+2],r,l,f,p)&&(!A||A(Pe))&&(!L||!Qt(R,Pe.overlapMode))){const $e=se[ie],ye=se[ie+1],Le=se[ie+2];if(T.push({key:Pe,x1:$e-Le,y1:ye-Le,x2:$e+Le,y2:ye+Le}),L)return!0}}}return!1}_queryCellCircle(r,l,f,p,y,T,S,A){const{circle:F,seenUids:L,overlapMode:R}=S,q=this.boxCells[y];if(q!==null){const se=this.bboxes;for(const he of q)if(!L.box[he]){L.box[he]=!0;const ie=4*he,Pe=this.boxKeys[he];if(this._circleAndRectCollide(F.x,F.y,F.radius,se[ie+0],se[ie+1],se[ie+2],se[ie+3])&&(!A||A(Pe))&&!Qt(R,Pe.overlapMode))return T.push(!0),!0}}const oe=this.circleCells[y];if(oe!==null){const se=this.circles;for(const he of oe)if(!L.circle[he]){L.circle[he]=!0;const ie=3*he,Pe=this.circleKeys[he];if(this._circlesCollide(se[ie],se[ie+1],se[ie+2],F.x,F.y,F.radius)&&(!A||A(Pe))&&!Qt(R,Pe.overlapMode))return T.push(!0),!0}}}_forEachCell(r,l,f,p,y,T,S,A){const F=this._convertToXCellCoord(r),L=this._convertToYCellCoord(l),R=this._convertToXCellCoord(f),q=this._convertToYCellCoord(p);for(let oe=F;oe<=R;oe++)for(let se=L;se<=q;se++)if(y.call(this,r,l,f,p,this.xCellCount*se+oe,T,S,A))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,l,f,p,y,T){const S=p-r,A=y-l,F=f+T;return F*F>S*S+A*A}_circleAndRectCollide(r,l,f,p,y,T,S){const A=(T-p)/2,F=Math.abs(r-(p+A));if(F>A+f)return!1;const L=(S-y)/2,R=Math.abs(l-(y+L));if(R>L+f)return!1;if(F<=A||R<=L)return!0;const q=F-A,oe=R-L;return q*q+oe*oe<=f*f}}function ct(g,r,l,f,p){const y=o.Z();return r?(o.a0(y,y,[1/p,1/p,1]),l||o.ae(y,y,f.angle)):o.a1(y,f.labelPlaneMatrix,g),y}function Dt(g,r,l,f,p){if(r){const y=o.af(g);return o.a0(y,y,[p,p,1]),l||o.ae(y,y,-f.angle),y}return f.glCoordMatrix}function Vt(g,r,l){let f;l?(f=[g.x,g.y,l(g.x,g.y),1],o.ag(f,f,r)):(f=[g.x,g.y,0,1],de(f,f,r));const p=f[3];return{point:new o.P(f[0]/p,f[1]/p),signedDistanceFromCamera:p}}function xr(g,r){return .5+g/r*.5}function rr(g,r){const l=g[0]/g[3],f=g[1]/g[3];return l>=-r[0]&&l<=r[0]&&f>=-r[1]&&f<=r[1]}function st(g,r,l,f,p,y,T,S,A,F){const L=f?g.textSizeData:g.iconSizeData,R=o.ah(L,l.transform.zoom),q=[256/l.width*2+1,256/l.height*2+1],oe=f?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;oe.clear();const se=g.lineVertexArray,he=f?g.text.placedSymbolArray:g.icon.placedSymbolArray,ie=l.transform.width/l.transform.height;let Pe=!1;for(let $e=0;$e<he.length;$e++){const ye=he.get($e);if(ye.hidden||ye.writingMode===o.ai.vertical&&!Pe){te(ye.numGlyphs,oe);continue}let Le;if(Pe=!1,F?(Le=[ye.anchorX,ye.anchorY,F(ye.anchorX,ye.anchorY),1],o.ag(Le,Le,r)):(Le=[ye.anchorX,ye.anchorY,0,1],de(Le,Le,r)),!rr(Le,q)){te(ye.numGlyphs,oe);continue}const qe=xr(l.transform.cameraToCenterDistance,Le[3]),We=o.aj(L,R,ye),tt=T?We/qe:We*qe,ht=new o.P(ye.anchorX,ye.anchorY),ot=Vt(ht,p,F).point,xt={projections:{},offsets:{}},Lt=Br(ye,tt,!1,S,r,p,y,g.glyphOffsetArray,se,oe,ot,ht,xt,ie,A,F);Pe=Lt.useVertical,(Lt.notEnoughRoom||Pe||Lt.needsFlipping&&Br(ye,tt,!0,S,r,p,y,g.glyphOffsetArray,se,oe,ot,ht,xt,ie,A,F).notEnoughRoom)&&te(ye.numGlyphs,oe)}f?g.text.dynamicLayoutVertexBuffer.updateData(oe):g.icon.dynamicLayoutVertexBuffer.updateData(oe)}function Ut(g,r,l,f,p,y,T,S,A,F,L,R,q){const oe=S.glyphStartIndex+S.numGlyphs,se=S.lineStartIndex,he=S.lineStartIndex+S.lineLength,ie=r.getoffsetX(S.glyphStartIndex),Pe=r.getoffsetX(oe-1),$e=V(g*ie,l,f,p,y,T,S.segment,se,he,A,F,L,R,q);if(!$e)return null;const ye=V(g*Pe,l,f,p,y,T,S.segment,se,he,A,F,L,R,q);return ye?{first:$e,last:ye}:null}function jt(g,r,l,f){return g===o.ai.horizontal&&Math.abs(l.y-r.y)>Math.abs(l.x-r.x)*f?{useVertical:!0}:(g===o.ai.vertical?r.y<l.y:r.x>l.x)?{needsFlipping:!0}:null}function Br(g,r,l,f,p,y,T,S,A,F,L,R,q,oe,se,he){const ie=r/24,Pe=g.lineOffsetX*ie,$e=g.lineOffsetY*ie;let ye;if(g.numGlyphs>1){const Le=g.glyphStartIndex+g.numGlyphs,qe=g.lineStartIndex,We=g.lineStartIndex+g.lineLength,tt=Ut(ie,S,Pe,$e,l,L,R,g,A,y,q,se,he);if(!tt)return{notEnoughRoom:!0};const ht=Vt(tt.first.point,T,he).point,ot=Vt(tt.last.point,T,he).point;if(f&&!l){const xt=jt(g.writingMode,ht,ot,oe);if(xt)return xt}ye=[tt.first];for(let xt=g.glyphStartIndex+1;xt<Le-1;xt++)ye.push(V(ie*S.getoffsetX(xt),Pe,$e,l,L,R,g.segment,qe,We,A,y,q,se,he));ye.push(tt.last)}else{if(f&&!l){const qe=Vt(R,p,he).point,We=g.lineStartIndex+g.segment+1,tt=new o.P(A.getx(We),A.gety(We)),ht=Vt(tt,p,he),ot=ht.signedDistanceFromCamera>0?ht.point:ca(R,tt,qe,1,p,he),xt=jt(g.writingMode,qe,ot,oe);if(xt)return xt}const Le=V(ie*S.getoffsetX(g.glyphStartIndex),Pe,$e,l,L,R,g.segment,g.lineStartIndex,g.lineStartIndex+g.lineLength,A,y,q,se,he);if(!Le)return{notEnoughRoom:!0};ye=[Le]}for(const Le of ye)o.ak(F,Le.point,Le.angle);return{}}function ca(g,r,l,f,p,y){const T=Vt(g.add(g.sub(r)._unit()),p,y).point,S=l.sub(T);return l.add(S._mult(f/S.mag()))}function er(g,r){const{projectionCache:l,lineVertexArray:f,labelPlaneMatrix:p,tileAnchorPoint:y,distanceFromAnchor:T,getElevation:S,previousVertex:A,direction:F,absOffsetX:L}=r;if(l.projections[g])return l.projections[g];const R=new o.P(f.getx(g),f.gety(g)),q=Vt(R,p,S);if(q.signedDistanceFromCamera>0)return l.projections[g]=q.point,q.point;const oe=g-F;return ca(T===0?y:new o.P(f.getx(oe),f.gety(oe)),R,A,L-T+1,p,S)}function Ya(g,r,l){return g._unit()._perp()._mult(r*l)}function ce(g,r,l,f,p,y,T,S){const{projectionCache:A,direction:F}=S;if(A.offsets[g])return A.offsets[g];const L=l.add(r);if(g+F<f||g+F>=p)return A.offsets[g]=L,L;const R=er(g+F,S),q=Ya(R.sub(l),T,F),oe=l.add(q),se=R.add(q);return A.offsets[g]=o.al(y,L,oe,se)||L,A.offsets[g]}function V(g,r,l,f,p,y,T,S,A,F,L,R,q,oe){const se=f?g-r:g+r;let he=se>0?1:-1,ie=0;f&&(he*=-1,ie=Math.PI),he<0&&(ie+=Math.PI);let Pe,$e,ye=he>0?S+T:S+T+1,Le=p,qe=p,We=0,tt=0;const ht=Math.abs(se),ot=[];let xt;for(;We+tt<=ht;){if(ye+=he,ye<S||ye>=A)return null;We+=tt,qe=Le,$e=Pe;const Tt={projectionCache:R,lineVertexArray:F,labelPlaneMatrix:L,tileAnchorPoint:y,distanceFromAnchor:We,getElevation:oe,previousVertex:qe,direction:he,absOffsetX:ht};if(Le=er(ye,Tt),l===0)ot.push(qe),xt=Le.sub(qe);else{let Ht;const Ot=Le.sub(qe);Ht=Ot.mag()===0?Ya(er(ye+he,Tt).sub(Le),l,he):Ya(Ot,l,he),$e||($e=qe.add(Ht)),Pe=ce(ye,Ht,Le,S,A,$e,l,Tt),ot.push($e),xt=Pe.sub($e)}tt=xt.mag()}const Lt=xt._mult((ht-We)/tt)._add($e||qe),ur=ie+Math.atan2(Le.y-qe.y,Le.x-qe.x);return ot.push(Lt),{point:Lt,angle:q?ur:0,path:ot}}const H=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function te(g,r){for(let l=0;l<g;l++){const f=r.length;r.resize(f+4),r.float32.set(H,3*f)}}function de(g,r,l){const f=r[0],p=r[1];return g[0]=l[0]*f+l[4]*p+l[12],g[1]=l[1]*f+l[5]*p+l[13],g[3]=l[3]*f+l[7]*p+l[15],g}const xe=100;class Be{constructor(r,l=new kr(r.width+200,r.height+200,25),f=new kr(r.width+200,r.height+200,25)){this.transform=r,this.grid=l,this.ignoredGrid=f,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+xe,this.screenBottomBoundary=r.height+xe,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(r,l,f,p,y,T){const S=this.projectAndGetPerspectiveRatio(p,r.anchorPointX,r.anchorPointY,T),A=f*S.perspectiveRatio,F=r.x1*A+S.point.x,L=r.y1*A+S.point.y,R=r.x2*A+S.point.x,q=r.y2*A+S.point.y;return!this.isInsideGrid(F,L,R,q)||l!=="always"&&this.grid.hitTest(F,L,R,q,l,y)||S.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[F,L,R,q],offscreen:this.isOffscreen(F,L,R,q)}}placeCollisionCircles(r,l,f,p,y,T,S,A,F,L,R,q,oe,se){const he=[],ie=new o.P(l.anchorX,l.anchorY),Pe=Vt(ie,T,se),$e=xr(this.transform.cameraToCenterDistance,Pe.signedDistanceFromCamera),ye=(L?y/$e:y*$e)/o.ap,Le=Vt(ie,S,se).point,qe=Ut(ye,p,l.lineOffsetX*ye,l.lineOffsetY*ye,!1,Le,ie,l,f,S,{projections:{},offsets:{}},!1,se);let We=!1,tt=!1,ht=!0;if(qe){const ot=.5*q*$e+oe,xt=new o.P(-100,-100),Lt=new o.P(this.screenRightBoundary,this.screenBottomBoundary),ur=new pa,Tt=qe.first,Ht=qe.last;let Ot=[];for(let ir=Tt.path.length-1;ir>=1;ir--)Ot.push(Tt.path[ir]);for(let ir=1;ir<Ht.path.length;ir++)Ot.push(Ht.path[ir]);const Ar=2.5*ot;if(A){const ir=Ot.map(hr=>Vt(hr,A,se));Ot=ir.some(hr=>hr.signedDistanceFromCamera<=0)?[]:ir.map(hr=>hr.point)}let cr=[];if(Ot.length>0){const ir=Ot[0].clone(),hr=Ot[0].clone();for(let ea=1;ea<Ot.length;ea++)ir.x=Math.min(ir.x,Ot[ea].x),ir.y=Math.min(ir.y,Ot[ea].y),hr.x=Math.max(hr.x,Ot[ea].x),hr.y=Math.max(hr.y,Ot[ea].y);cr=ir.x>=xt.x&&hr.x<=Lt.x&&ir.y>=xt.y&&hr.y<=Lt.y?[Ot]:hr.x<xt.x||ir.x>Lt.x||hr.y<xt.y||ir.y>Lt.y?[]:o.am([Ot],xt.x,xt.y,Lt.x,Lt.y)}for(const ir of cr){ur.reset(ir,.25*ot);let hr=0;hr=ur.length<=.5*ot?1:Math.ceil(ur.paddedLength/Ar)+1;for(let ea=0;ea<hr;ea++){const Pr=ea/Math.max(hr-1,1),Ia=ur.lerp(Pr),ma=Ia.x+xe,oa=Ia.y+xe;he.push(ma,oa,ot,0);const xi=ma-ot,Lr=oa-ot,Xi=ma+ot,Ki=oa+ot;if(ht=ht&&this.isOffscreen(xi,Lr,Xi,Ki),tt=tt||this.isInsideGrid(xi,Lr,Xi,Ki),r!=="always"&&this.grid.hitTestCircle(ma,oa,ot,r,R)&&(We=!0,!F))return{circles:[],offscreen:!1,collisionDetected:We}}}}return{circles:!F&&We||!tt||$e<this.perspectiveRatioCutoff?[]:he,offscreen:ht,collisionDetected:We}}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const l=[];let f=1/0,p=1/0,y=-1/0,T=-1/0;for(const L of r){const R=new o.P(L.x+xe,L.y+xe);f=Math.min(f,R.x),p=Math.min(p,R.y),y=Math.max(y,R.x),T=Math.max(T,R.y),l.push(R)}const S=this.grid.query(f,p,y,T).concat(this.ignoredGrid.query(f,p,y,T)),A={},F={};for(const L of S){const R=L.key;if(A[R.bucketInstanceId]===void 0&&(A[R.bucketInstanceId]={}),A[R.bucketInstanceId][R.featureIndex])continue;const q=[new o.P(L.x1,L.y1),new o.P(L.x2,L.y1),new o.P(L.x2,L.y2),new o.P(L.x1,L.y2)];o.an(l,q)&&(A[R.bucketInstanceId][R.featureIndex]=!0,F[R.bucketInstanceId]===void 0&&(F[R.bucketInstanceId]=[]),F[R.bucketInstanceId].push(R.featureIndex))}return F}insertCollisionBox(r,l,f,p,y,T){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:y,collisionGroupID:T,overlapMode:l},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,l,f,p,y,T){const S=f?this.ignoredGrid:this.grid,A={bucketInstanceId:p,featureIndex:y,collisionGroupID:T,overlapMode:l};for(let F=0;F<r.length;F+=4)S.insertCircle(A,r[F],r[F+1],r[F+2])}projectAndGetPerspectiveRatio(r,l,f,p){let y;return p?(y=[l,f,p(l,f),1],o.ag(y,y,r)):(y=[l,f,0,1],de(y,y,r)),{point:new o.P((y[0]/y[3]+1)/2*this.transform.width+xe,(-y[1]/y[3]+1)/2*this.transform.height+xe),perspectiveRatio:.5+this.transform.cameraToCenterDistance/y[3]*.5}}isOffscreen(r,l,f,p){return f<xe||r>=this.screenRightBoundary||p<xe||l>this.screenBottomBoundary}isInsideGrid(r,l,f,p){return f>=0&&r<this.gridRightBoundary&&p>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const r=o.ao([]);return o.$(r,r,[-100,-100,0]),r}}function Ae(g,r,l){return r*(o.N/(g.tileSize*Math.pow(2,l-g.tileID.overscaledZ)))}class ve{constructor(r,l,f,p){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?l:-l))):p&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class De{constructor(r,l,f,p,y){this.text=new ve(r?r.text:null,l,f,y),this.icon=new ve(r?r.icon:null,l,p,y)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Je{constructor(r,l,f){this.text=r,this.icon=l,this.skipFade=f}}class et{constructor(){this.invProjMatrix=o.Z(),this.viewportMatrix=o.Z(),this.circles=[]}}class N{constructor(r,l,f,p,y){this.bucketInstanceId=r,this.featureIndex=l,this.sourceLayerIndex=f,this.bucketIndex=p,this.tileID=y}}class J{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const l=++this.maxGroupID;this.collisionGroups[r]={ID:l,predicate:f=>f.collisionGroupID===l}}return this.collisionGroups[r]}}function Y(g,r,l,f,p){const{horizontalAlign:y,verticalAlign:T}=o.au(g);return new o.P(-(y-.5)*r+f[0]*p,-(T-.5)*l+f[1]*p)}function K(g,r,l,f,p,y){const{x1:T,x2:S,y1:A,y2:F,anchorPointX:L,anchorPointY:R}=g,q=new o.P(r,l);return f&&q._rotate(p?y:-y),{x1:T+q.x,y1:A+q.y,x2:S+q.x,y2:F+q.y,anchorPointX:L,anchorPointY:R}}class Q{constructor(r,l,f,p,y){this.transform=r.clone(),this.terrain=l,this.collisionIndex=new Be(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new J(p),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,l,f,p){const y=f.getBucket(l),T=f.latestFeatureIndex;if(!y||!T||l.id!==y.layerIds[0])return;const S=f.collisionBoxArray,A=y.layers[0].layout,F=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),L=f.tileSize/o.N,R=this.transform.calculatePosMatrix(f.tileID.toUnwrapped()),q=A.get("text-pitch-alignment")==="map",oe=A.get("text-rotation-alignment")==="map",se=Ae(f,1,this.transform.zoom),he=ct(R,q,oe,this.transform,se);let ie=null;if(q){const $e=Dt(R,q,oe,this.transform,se);ie=o.a1([],this.transform.labelPlaneMatrix,$e)}this.retainedQueryData[y.bucketInstanceId]=new N(y.bucketInstanceId,T,y.sourceLayerIndex,y.index,f.tileID);const Pe={bucket:y,layout:A,posMatrix:R,textLabelPlaneMatrix:he,labelToScreenMatrix:ie,scale:F,textPixelRatio:L,holdingForFade:f.holdingForFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:o.ah(y.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(p)for(const $e of y.sortKeyRanges){const{sortKey:ye,symbolInstanceStart:Le,symbolInstanceEnd:qe}=$e;r.push({sortKey:ye,symbolInstanceStart:Le,symbolInstanceEnd:qe,parameters:Pe})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:Pe})}attemptAnchorPlacement(r,l,f,p,y,T,S,A,F,L,R,q,oe,se,he,ie){const Pe=o.aq[r.textAnchor],$e=[r.textOffset0,r.textOffset1],ye=Y(Pe,f,p,$e,y),Le=this.collisionIndex.placeCollisionBox(K(l,ye.x,ye.y,T,S,this.transform.angle),R,A,F,L.predicate,ie);if((!he||this.collisionIndex.placeCollisionBox(K(he,ye.x,ye.y,T,S,this.transform.angle),R,A,F,L.predicate,ie).box.length!==0)&&Le.box.length>0){let qe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[q.crossTileID]&&this.prevPlacement.placements[q.crossTileID]&&this.prevPlacement.placements[q.crossTileID].text&&(qe=this.prevPlacement.variableOffsets[q.crossTileID].anchor),q.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[q.crossTileID]={textOffset:$e,width:f,height:p,anchor:Pe,textBoxScale:y,prevAnchor:qe},this.markUsedJustification(oe,Pe,q,se),oe.allowVerticalPlacement&&(this.markUsedOrientation(oe,se,q),this.placedOrientations[q.crossTileID]=se),{shift:ye,placedGlyphBoxes:Le}}}placeLayerBucketPart(r,l,f){const{bucket:p,layout:y,posMatrix:T,textLabelPlaneMatrix:S,labelToScreenMatrix:A,textPixelRatio:F,holdingForFade:L,collisionBoxArray:R,partiallyEvaluatedTextSize:q,collisionGroup:oe}=r.parameters,se=y.get("text-optional"),he=y.get("icon-optional"),ie=o.ar(y,"text-overlap","text-allow-overlap"),Pe=ie==="always",$e=o.ar(y,"icon-overlap","icon-allow-overlap"),ye=$e==="always",Le=y.get("text-rotation-alignment")==="map",qe=y.get("text-pitch-alignment")==="map",We=y.get("icon-text-fit")!=="none",tt=y.get("symbol-z-order")==="viewport-y",ht=Pe&&(ye||!p.hasIconData()||he),ot=ye&&(Pe||!p.hasTextData()||se);!p.collisionArrays&&R&&p.deserializeCollisionBoxes(R);const xt=this.retainedQueryData[p.bucketInstanceId].tileID,Lt=this.terrain?(Tt,Ht)=>this.terrain.getElevation(xt,Tt,Ht):null,ur=(Tt,Ht)=>{var Ot,Ar;if(l[Tt.crossTileID])return;if(L)return void(this.placements[Tt.crossTileID]=new Je(!1,!1,!1));let cr=!1,ir=!1,hr=!0,ea=null,Pr={box:null,offscreen:null},Ia={box:null,offscreen:null},ma=null,oa=null,xi=null,Lr=0,Xi=0,Ki=0;Ht.textFeatureIndex?Lr=Ht.textFeatureIndex:Tt.useRuntimeCollisionCircles&&(Lr=Tt.featureIndex),Ht.verticalTextFeatureIndex&&(Xi=Ht.verticalTextFeatureIndex);const Dn=Ht.textBox;if(Dn){const Ra=ta=>{let ga=o.ai.horizontal;if(p.allowVerticalPlacement&&!ta&&this.prevPlacement){const ei=this.prevPlacement.placedOrientations[Tt.crossTileID];ei&&(this.placedOrientations[Tt.crossTileID]=ei,ga=ei,this.markUsedOrientation(p,ga,Tt))}return ga},Fa=(ta,ga)=>{if(p.allowVerticalPlacement&&Tt.numVerticalGlyphVertices>0&&Ht.verticalTextBox){for(const ei of p.writingModes)if(ei===o.ai.vertical?(Pr=ga(),Ia=Pr):Pr=ta(),Pr&&Pr.box&&Pr.box.length)break}else Pr=ta()},$a=Tt.textAnchorOffsetStartIndex,Yn=Tt.textAnchorOffsetEndIndex;if(Yn===$a){const ta=(ga,ei)=>{const ra=this.collisionIndex.placeCollisionBox(ga,ie,F,T,oe.predicate,Lt);return ra&&ra.box&&ra.box.length&&(this.markUsedOrientation(p,ei,Tt),this.placedOrientations[Tt.crossTileID]=ei),ra};Fa(()=>ta(Dn,o.ai.horizontal),()=>{const ga=Ht.verticalTextBox;return p.allowVerticalPlacement&&Tt.numVerticalGlyphVertices>0&&ga?ta(ga,o.ai.vertical):{box:null,offscreen:null}}),Ra(Pr&&Pr.box&&Pr.box.length)}else{let ta=o.aq[(Ar=(Ot=this.prevPlacement)===null||Ot===void 0?void 0:Ot.variableOffsets[Tt.crossTileID])===null||Ar===void 0?void 0:Ar.anchor];const ga=(ra,Jn,tl)=>{const Xu=ra.x2-ra.x1,Ku=ra.y2-ra.y1,pf=Tt.textBoxScale,dc=We&&$e==="never"?Jn:null;let Yi={box:[],offscreen:!1},Qn=ie==="never"?1:2,Ji="never";ta&&Qn++;for(let Mi=0;Mi<Qn;Mi++){for(let Qi=$a;Qi<Yn;Qi++){const pc=p.textAnchorOffsets.get(Qi);if(ta&&pc.textAnchor!==ta)continue;const mn=this.attemptAnchorPlacement(pc,ra,Xu,Ku,pf,Le,qe,F,T,oe,Ji,Tt,p,tl,dc,Lt);if(mn&&(Yi=mn.placedGlyphBoxes,Yi&&Yi.box&&Yi.box.length))return cr=!0,ea=mn.shift,Yi}ta?ta=null:Ji=ie}return Yi};Fa(()=>ga(Dn,Ht.iconBox,o.ai.horizontal),()=>{const ra=Ht.verticalTextBox;return p.allowVerticalPlacement&&!(Pr&&Pr.box&&Pr.box.length)&&Tt.numVerticalGlyphVertices>0&&ra?ga(ra,Ht.verticalIconBox,o.ai.vertical):{box:null,offscreen:null}}),Pr&&(cr=Pr.box,hr=Pr.offscreen);const ei=Ra(Pr&&Pr.box);if(!cr&&this.prevPlacement){const ra=this.prevPlacement.variableOffsets[Tt.crossTileID];ra&&(this.variableOffsets[Tt.crossTileID]=ra,this.markUsedJustification(p,ra.anchor,Tt,ei))}}}if(ma=Pr,cr=ma&&ma.box&&ma.box.length>0,hr=ma&&ma.offscreen,Tt.useRuntimeCollisionCircles){const Ra=p.text.placedSymbolArray.get(Tt.centerJustifiedTextSymbolIndex),Fa=o.aj(p.textSizeData,q,Ra),$a=y.get("text-padding");oa=this.collisionIndex.placeCollisionCircles(ie,Ra,p.lineVertexArray,p.glyphOffsetArray,Fa,T,S,A,f,qe,oe.predicate,Tt.collisionCircleDiameter,$a,Lt),oa.circles.length&&oa.collisionDetected&&!f&&o.w("Collisions detected, but collision boxes are not shown"),cr=Pe||oa.circles.length>0&&!oa.collisionDetected,hr=hr&&oa.offscreen}if(Ht.iconFeatureIndex&&(Ki=Ht.iconFeatureIndex),Ht.iconBox){const Ra=Fa=>{const $a=We&&ea?K(Fa,ea.x,ea.y,Le,qe,this.transform.angle):Fa;return this.collisionIndex.placeCollisionBox($a,$e,F,T,oe.predicate,Lt)};Ia&&Ia.box&&Ia.box.length&&Ht.verticalIconBox?(xi=Ra(Ht.verticalIconBox),ir=xi.box.length>0):(xi=Ra(Ht.iconBox),ir=xi.box.length>0),hr=hr&&xi.offscreen}const Kn=se||Tt.numHorizontalGlyphVertices===0&&Tt.numVerticalGlyphVertices===0,ws=he||Tt.numIconVertices===0;if(Kn||ws?ws?Kn||(ir=ir&&cr):cr=ir&&cr:ir=cr=ir&&cr,cr&&ma&&ma.box&&this.collisionIndex.insertCollisionBox(ma.box,ie,y.get("text-ignore-placement"),p.bucketInstanceId,Ia&&Ia.box&&Xi?Xi:Lr,oe.ID),ir&&xi&&this.collisionIndex.insertCollisionBox(xi.box,$e,y.get("icon-ignore-placement"),p.bucketInstanceId,Ki,oe.ID),oa&&(cr&&this.collisionIndex.insertCollisionCircles(oa.circles,ie,y.get("text-ignore-placement"),p.bucketInstanceId,Lr,oe.ID),f)){const Ra=p.bucketInstanceId;let Fa=this.collisionCircleArrays[Ra];Fa===void 0&&(Fa=this.collisionCircleArrays[Ra]=new et);for(let $a=0;$a<oa.circles.length;$a+=4)Fa.circles.push(oa.circles[$a+0]),Fa.circles.push(oa.circles[$a+1]),Fa.circles.push(oa.circles[$a+2]),Fa.circles.push(oa.collisionDetected?1:0)}if(Tt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(p.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Tt.crossTileID]=new Je(cr||ht,ir||ot,hr||p.justReloaded),l[Tt.crossTileID]=!0};if(tt){if(r.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Tt=p.getSortedSymbolIndexes(this.transform.angle);for(let Ht=Tt.length-1;Ht>=0;--Ht){const Ot=Tt[Ht];ur(p.symbolInstances.get(Ot),p.collisionArrays[Ot])}}else for(let Tt=r.symbolInstanceStart;Tt<r.symbolInstanceEnd;Tt++)ur(p.symbolInstances.get(Tt),p.collisionArrays[Tt]);if(f&&p.bucketInstanceId in this.collisionCircleArrays){const Tt=this.collisionCircleArrays[p.bucketInstanceId];o.as(Tt.invProjMatrix,T),Tt.viewportMatrix=this.collisionIndex.getViewportMatrix()}p.justReloaded=!1}markUsedJustification(r,l,f,p){let y;y=p===o.ai.vertical?f.verticalPlacedTextSymbolIndex:{left:f.leftJustifiedTextSymbolIndex,center:f.centerJustifiedTextSymbolIndex,right:f.rightJustifiedTextSymbolIndex}[o.at(l)];const T=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex,f.verticalPlacedTextSymbolIndex];for(const S of T)S>=0&&(r.text.placedSymbolArray.get(S).crossTileID=y>=0&&S!==y?0:f.crossTileID)}markUsedOrientation(r,l,f){const p=l===o.ai.horizontal||l===o.ai.horizontalOnly?l:0,y=l===o.ai.vertical?l:0,T=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex];for(const S of T)r.text.placedSymbolArray.get(S).placedOrientation=p;f.verticalPlacedTextSymbolIndex&&(r.text.placedSymbolArray.get(f.verticalPlacedTextSymbolIndex).placedOrientation=y)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let f=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const p=l?l.symbolFadeChange(r):1,y=l?l.opacities:{},T=l?l.variableOffsets:{},S=l?l.placedOrientations:{};for(const A in this.placements){const F=this.placements[A],L=y[A];L?(this.opacities[A]=new De(L,p,F.text,F.icon),f=f||F.text!==L.text.placed||F.icon!==L.icon.placed):(this.opacities[A]=new De(null,p,F.text,F.icon,F.skipFade),f=f||F.text||F.icon)}for(const A in y){const F=y[A];if(!this.opacities[A]){const L=new De(F,p,!1,!1);L.isHidden()||(this.opacities[A]=L,f=f||F.text.placed||F.icon.placed)}}for(const A in T)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=T[A]);for(const A in S)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=S[A]);if(l&&l.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");f?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:r)}updateLayerOpacities(r,l){const f={};for(const p of l){const y=p.getBucket(r);y&&p.latestFeatureIndex&&r.id===y.layerIds[0]&&this.updateBucketOpacities(y,f,p.collisionBoxArray)}}updateBucketOpacities(r,l,f){r.hasTextData()&&(r.text.opacityVertexArray.clear(),r.text.hasVisibleVertices=!1),r.hasIconData()&&(r.icon.opacityVertexArray.clear(),r.icon.hasVisibleVertices=!1),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const p=r.layers[0],y=p.layout,T=new De(null,0,!1,!1,!0),S=y.get("text-allow-overlap"),A=y.get("icon-allow-overlap"),F=p._unevaluatedLayout.hasValue("text-variable-anchor")||p._unevaluatedLayout.hasValue("text-variable-anchor-offset"),L=y.get("text-rotation-alignment")==="map",R=y.get("text-pitch-alignment")==="map",q=y.get("icon-text-fit")!=="none",oe=new De(null,0,S&&(A||!r.hasIconData()||y.get("icon-optional")),A&&(S||!r.hasTextData()||y.get("text-optional")),!0);!r.collisionArrays&&f&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(f);const se=(he,ie,Pe)=>{for(let $e=0;$e<ie/4;$e++)he.opacityVertexArray.emplaceBack(Pe);he.hasVisibleVertices=he.hasVisibleVertices||Pe!==mt};for(let he=0;he<r.symbolInstances.length;he++){const ie=r.symbolInstances.get(he),{numHorizontalGlyphVertices:Pe,numVerticalGlyphVertices:$e,crossTileID:ye}=ie;let Le=this.opacities[ye];l[ye]?Le=T:Le||(Le=oe,this.opacities[ye]=Le),l[ye]=!0;const qe=ie.numIconVertices>0,We=this.placedOrientations[ie.crossTileID],tt=We===o.ai.vertical,ht=We===o.ai.horizontal||We===o.ai.horizontalOnly;if(Pe>0||$e>0){const ot=St(Le.text);se(r.text,Pe,tt?mt:ot),se(r.text,$e,ht?mt:ot);const xt=Le.text.isHidden();[ie.rightJustifiedTextSymbolIndex,ie.centerJustifiedTextSymbolIndex,ie.leftJustifiedTextSymbolIndex].forEach(Tt=>{Tt>=0&&(r.text.placedSymbolArray.get(Tt).hidden=xt||tt?1:0)}),ie.verticalPlacedTextSymbolIndex>=0&&(r.text.placedSymbolArray.get(ie.verticalPlacedTextSymbolIndex).hidden=xt||ht?1:0);const Lt=this.variableOffsets[ie.crossTileID];Lt&&this.markUsedJustification(r,Lt.anchor,ie,We);const ur=this.placedOrientations[ie.crossTileID];ur&&(this.markUsedJustification(r,"left",ie,ur),this.markUsedOrientation(r,ur,ie))}if(qe){const ot=St(Le.icon),xt=!(q&&ie.verticalPlacedIconSymbolIndex&&tt);ie.placedIconSymbolIndex>=0&&(se(r.icon,ie.numIconVertices,xt?ot:mt),r.icon.placedSymbolArray.get(ie.placedIconSymbolIndex).hidden=Le.icon.isHidden()),ie.verticalPlacedIconSymbolIndex>=0&&(se(r.icon,ie.numVerticalIconVertices,xt?mt:ot),r.icon.placedSymbolArray.get(ie.verticalPlacedIconSymbolIndex).hidden=Le.icon.isHidden())}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const ot=r.collisionArrays[he];if(ot){let xt=new o.P(0,0);if(ot.textBox||ot.verticalTextBox){let ur=!0;if(F){const Tt=this.variableOffsets[ye];Tt?(xt=Y(Tt.anchor,Tt.width,Tt.height,Tt.textOffset,Tt.textBoxScale),L&&xt._rotate(R?this.transform.angle:-this.transform.angle)):ur=!1}ot.textBox&&ae(r.textCollisionBox.collisionVertexArray,Le.text.placed,!ur||tt,xt.x,xt.y),ot.verticalTextBox&&ae(r.textCollisionBox.collisionVertexArray,Le.text.placed,!ur||ht,xt.x,xt.y)}const Lt=!!(!ht&&ot.verticalIconBox);ot.iconBox&&ae(r.iconCollisionBox.collisionVertexArray,Le.icon.placed,Lt,q?xt.x:0,q?xt.y:0),ot.verticalIconBox&&ae(r.iconCollisionBox.collisionVertexArray,Le.icon.placed,!Lt,q?xt.x:0,q?xt.y:0)}}}if(r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.text.opacityVertexArray.length!==r.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${r.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${r.text.layoutVertexArray.length}) / 4`);if(r.icon.opacityVertexArray.length!==r.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${r.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${r.icon.layoutVertexArray.length}) / 4`);if(r.bucketInstanceId in this.collisionCircleArrays){const he=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=he.invProjMatrix,r.placementViewportMatrix=he.viewportMatrix,r.collisionCircleArray=he.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,l){const f=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*f>r}setStale(){this.stale=!0}}function ae(g,r,l,f,p){g.emplaceBack(r?1:0,l?1:0,f||0,p||0),g.emplaceBack(r?1:0,l?1:0,f||0,p||0),g.emplaceBack(r?1:0,l?1:0,f||0,p||0),g.emplaceBack(r?1:0,l?1:0,f||0,p||0)}const Ve=Math.pow(2,25),Ze=Math.pow(2,24),ze=Math.pow(2,17),Ue=Math.pow(2,16),je=Math.pow(2,9),it=Math.pow(2,8),gt=Math.pow(2,1);function St(g){if(g.opacity===0&&!g.placed)return 0;if(g.opacity===1&&g.placed)return 4294967295;const r=g.placed?1:0,l=Math.floor(127*g.opacity);return l*Ve+r*Ze+l*ze+r*Ue+l*je+r*it+l*gt+r}const mt=0;class Ft{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&!r.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(r,l,f,p,y){const T=this._bucketParts;for(;this._currentTileIndex<r.length;)if(l.getBucketParts(T,p,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort((S,A)=>S.sortKey-A.sortKey));this._currentPartIndex<T.length;)if(l.placeLayerBucketPart(T[this._currentPartIndex],this._seenCrossTileIDs,f),this._currentPartIndex++,y())return!0;return!1}}class Jt{constructor(r,l,f,p,y,T,S,A){this.placement=new Q(r,l,T,S,A),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(r,l,f){const p=o.h.now(),y=()=>!this._forceFullPlacement&&o.h.now()-p>2;for(;this._currentPlacementIndex>=0;){const T=l[r[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=S)&&(!T.maxzoom||T.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new Ft(T)),this._inProgressLayer.continuePlacement(f[T.source],this.placement,this._showCollisionBoxes,T,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const Cr=512/o.N/2;class zr{constructor(r,l,f){this.tileID=r,this.bucketInstanceId=f,this._symbolsByKey={};const p=new Map;for(let y=0;y<l.length;y++){const T=l.get(y),S=T.key,A=p.get(S);A?A.push(T):p.set(S,[T])}for(const[y,T]of p){const S={positions:T.map(A=>({x:Math.floor(A.anchorX*Cr),y:Math.floor(A.anchorY*Cr)})),crossTileIDs:T.map(A=>A.crossTileID)};if(S.positions.length>128){const A=new o.av(S.positions.length,16,Uint16Array);for(const{x:F,y:L}of S.positions)A.add(F,L);A.finish(),delete S.positions,S.index=A}this._symbolsByKey[y]=S}}getScaledCoordinates(r,l){const{x:f,y:p,z:y}=this.tileID.canonical,{x:T,y:S,z:A}=l.canonical,F=Cr/Math.pow(2,A-y),L=(S*o.N+r.anchorY)*F,R=p*o.N*Cr;return{x:Math.floor((T*o.N+r.anchorX)*F-f*o.N*Cr),y:Math.floor(L-R)}}findMatches(r,l,f){const p=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z);for(let y=0;y<r.length;y++){const T=r.get(y);if(T.crossTileID)continue;const S=this._symbolsByKey[T.key];if(!S)continue;const A=this.getScaledCoordinates(T,l);if(S.index){const F=S.index.range(A.x-p,A.y-p,A.x+p,A.y+p).sort();for(const L of F){const R=S.crossTileIDs[L];if(!f[R]){f[R]=!0,T.crossTileID=R;break}}}else if(S.positions)for(let F=0;F<S.positions.length;F++){const L=S.positions[F],R=S.crossTileIDs[F];if(Math.abs(L.x-A.x)<=p&&Math.abs(L.y-A.y)<=p&&!f[R]){f[R]=!0,T.crossTileID=R;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:r})=>r)}}class tr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class cn{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const l=Math.round((r-this.lng)/360);if(l!==0)for(const f in this.indexes){const p=this.indexes[f],y={};for(const T in p){const S=p[T];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+l),y[S.tileID.key]=S}this.indexes[f]=y}this.lng=r}addBucket(r,l,f){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let y=0;y<l.symbolInstances.length;y++)l.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]={});const p=this.usedCrossTileIDs[r.overscaledZ];for(const y in this.indexes){const T=this.indexes[y];if(Number(y)>r.overscaledZ)for(const S in T){const A=T[S];A.tileID.isChildOf(r)&&A.findMatches(l.symbolInstances,r,p)}else{const S=T[r.scaledTo(Number(y)).key];S&&S.findMatches(l.symbolInstances,r,p)}}for(let y=0;y<l.symbolInstances.length;y++){const T=l.symbolInstances.get(y);T.crossTileID||(T.crossTileID=f.generate(),p[T.crossTileID]=!0)}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new zr(r,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(r,l){for(const f of l.getCrossTileIDsLists())for(const p of f)delete this.usedCrossTileIDs[r][p]}removeStaleBuckets(r){let l=!1;for(const f in this.indexes){const p=this.indexes[f];for(const y in p)r[p[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,p[y]),delete p[y],l=!0)}return l}}class Wi{constructor(){this.layerIndexes={},this.crossTileIDs=new tr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,l,f){let p=this.layerIndexes[r.id];p===void 0&&(p=this.layerIndexes[r.id]=new cn);let y=!1;const T={};p.handleWrapJump(f);for(const S of l){const A=S.getBucket(r);A&&r.id===A.layerIds[0]&&(A.bucketInstanceId||(A.bucketInstanceId=++this.maxBucketInstanceId),p.addBucket(S.tileID,A,this.crossTileIDs)&&(y=!0),T[A.bucketInstanceId]=!0)}return p.removeStaleBuckets(T)&&(y=!0),y}pruneUnusedLayers(r){const l={};r.forEach(f=>{l[f]=!0});for(const f in this.layerIndexes)l[f]||delete this.layerIndexes[f]}}const Jr=(g,r)=>o.x(g,r&&r.filter(l=>l.identifier!=="source.canvas")),na=o.F(o.ax,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),Vs=o.F(o.ax,["setCenter","setZoom","setBearing","setPitch"]),Qr=o.aw();class Aa extends o.E{constructor(r,l={}){super(),this.map=r,this.dispatcher=new Mt($r(),this,r._getMapId()),this.imageManager=new Me,this.imageManager.setEventedParent(this),this.glyphManager=new _t(r._requestManager,l.localIdeographFontFamily),this.lineAtlas=new Nt(256,512),this.crossTileSymbolIndex=new Wi,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.az());const f=this;this._rtlTextPluginCallback=Aa.registerForPluginStateChange(p=>{f.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:p.pluginStatus,pluginURL:p.pluginURL},(y,T)=>{if(o.aA(y),T&&T.every(S=>S))for(const S in f.sourceCaches){const A=f.sourceCaches[S].getSource().type;A!=="vector"&&A!=="geojson"||f.sourceCaches[S].reload()}})}),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const y=this.sourceCaches[p.sourceId];if(!y)return;const T=y.getSource();if(T&&T.vectorLayerIds)for(const S in this._layers){const A=this._layers[S];A.source===T.id&&this._validateLayer(A)}})}loadURL(r,l={},f){this.fire(new o.k("dataloading",{dataType:"style"})),l.validate=typeof l.validate!="boolean"||l.validate;const p=this.map._requestManager.transformRequest(r,ee.Style);this._request=o.f(p,(y,T)=>{this._request=null,y?this.fire(new o.j(y)):T&&this._load(T,l,f)})}loadJSON(r,l={},f){this.fire(new o.k("dataloading",{dataType:"style"})),this._request=o.h.frame(()=>{this._request=null,l.validate=l.validate!==!1,this._load(r,l,f)})}loadEmpty(){this.fire(new o.k("dataloading",{dataType:"style"})),this._load(Qr,{validate:!1})}_load(r,l,f){var p;const y=l.transformStyle?l.transformStyle(f,r):r;if(!l.validate||!Jr(this,o.y(y))){this._loaded=!0,this.stylesheet=y;for(const T in y.sources)this.addSource(T,y.sources[T],{validate:!1});y.sprite?this._loadSprite(y.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(y.glyphs),this._createLayers(),this.light=new He(this.stylesheet.light),this.map.setTerrain((p=this.stylesheet.terrain)!==null&&p!==void 0?p:null),this.fire(new o.k("data",{dataType:"style"})),this.fire(new o.k("style.load"))}}_createLayers(){const r=o.aB(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",r),this._order=r.map(l=>l.id),this._layers={},this._serializedLayers=null;for(const l of r){const f=o.aC(l);f.setEventedParent(this,{layer:{id:l.id}}),this._layers[l.id]=f}}_loadSprite(r,l=!1,f=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(p,y,T,S){const A=Ce(p),F=A.length,L=T>1?"@2x":"",R={},q={},oe={};for(const{id:se,url:he}of A){const ie=y.transformRequest(y.normalizeSpriteURL(he,L,".json"),ee.SpriteJSON),Pe=`${se}_${ie.url}`;R[Pe]=o.f(ie,(Le,qe)=>{delete R[Pe],q[se]=qe,be(S,q,oe,Le,F)});const $e=y.transformRequest(y.normalizeSpriteURL(he,L,".png"),ee.SpriteImage),ye=`${se}_${$e.url}`;R[ye]=j.getImage($e,(Le,qe)=>{delete R[ye],oe[se]=qe,be(S,q,oe,Le,F)})}return{cancel(){for(const se of Object.values(R))se.cancel()}}}(r,this.map._requestManager,this.map.getPixelRatio(),(p,y)=>{if(this._spriteRequest=null,p)this.fire(new o.j(p));else if(y)for(const T in y){this._spritesImagesIds[T]=[];const S=this._spritesImagesIds[T]?this._spritesImagesIds[T].filter(A=>!(A in y)):[];for(const A of S)this.imageManager.removeImage(A),this._changedImages[A]=!0;for(const A in y[T]){const F=T==="default"?A:`${T}:${A}`;this._spritesImagesIds[T].push(F),F in this.imageManager.images?this.imageManager.updateImage(F,y[T][A],!1):this.imageManager.addImage(F,y[T][A]),l&&(this._changedImages[F]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),l&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.k("data",{dataType:"style"})),f&&f(p)})}_unloadSprite(){for(const r of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(r),this._changedImages[r]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}_validateLayer(r){const l=this.sourceCaches[r.source];if(!l)return;const f=r.sourceLayer;if(!f)return;const p=l.getSource();(p.type==="geojson"||p.vectorLayerIds&&p.vectorLayerIds.indexOf(f)===-1)&&this.fire(new o.j(new Error(`Source layer "${f}" does not exist on source "${p.id}" as specified by style layer "${r.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const r in this.sourceCaches)if(!this.sourceCaches[r].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(r){const l=this._serializedAllLayers();if(!r||r.length===0)return Object.values(l);const f=[];for(const p of r)l[p]&&f.push(l[p]);return f}_serializedAllLayers(){let r=this._serializedLayers;if(r)return r;r=this._serializedLayers={};const l=Object.keys(this._layers);for(const f of l){const p=this._layers[f];p.type!=="custom"&&(r[f]=p.serialize())}return r}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const r in this.sourceCaches)if(this.sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(r){if(!this._loaded)return;const l=this._changed;if(this._changed){const p=Object.keys(this._updatedLayers),y=Object.keys(this._removedLayers);(p.length||y.length)&&this._updateWorkerLayers(p,y);for(const T in this._updatedSources){const S=this._updatedSources[T];if(S==="reload")this._reloadSource(T);else{if(S!=="clear")throw new Error(`Invalid action ${S}`);this._clearSource(T)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const T in this._updatedPaintProps)this._layers[T].updateTransitions(r);this.light.updateTransitions(r),this._resetUpdates()}const f={};for(const p in this.sourceCaches){const y=this.sourceCaches[p];f[p]=y.used,y.used=!1}for(const p of this._order){const y=this._layers[p];y.recalculate(r,this._availableImages),!y.isHidden(r.zoom)&&y.source&&(this.sourceCaches[y.source].used=!0)}for(const p in f){const y=this.sourceCaches[p];f[p]!==y.used&&y.fire(new o.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:p}))}this.light.recalculate(r),this.z=r.zoom,l&&this.fire(new o.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=Object.keys(this._changedImages);if(r.length){for(const l in this.sourceCaches)this.sourceCaches[l].reloadTilesForDependencies(["icons","patterns"],r);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const r in this.sourceCaches)this.sourceCaches[r].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(r,l){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(r),removedIds:l})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(r,l={}){this._checkLoaded();const f=this.serialize();if(r=l.transformStyle?l.transformStyle(f,r):r,Jr(this,o.y(r)))return!1;(r=o.aD(r)).layers=o.aB(r.layers);const p=o.aE(f,r).filter(T=>!(T.command in Vs));if(p.length===0)return!1;const y=p.filter(T=>!(T.command in na));if(y.length>0)throw new Error(`Unimplemented: ${y.map(T=>T.command).join(", ")}.`);for(const T of p)T.command!=="setTransition"&&this[T.command].apply(this,T.args);return this.stylesheet=r,this._serializedLayers=null,!0}addImage(r,l){if(this.getImage(r))return this.fire(new o.j(new Error(`An image named "${r}" already exists.`)));this.imageManager.addImage(r,l),this._afterImageUpdated(r)}updateImage(r,l){this.imageManager.updateImage(r,l)}getImage(r){return this.imageManager.getImage(r)}removeImage(r){if(!this.getImage(r))return this.fire(new o.j(new Error(`An image named "${r}" does not exist.`)));this.imageManager.removeImage(r),this._afterImageUpdated(r)}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(r,l,f={}){if(this._checkLoaded(),this.sourceCaches[r]!==void 0)throw new Error(`Source "${r}" already exists.`);if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(o.y.source,`sources.${r}`,l,null,f))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const p=this.sourceCaches[r]=new Sr(r,l,this.dispatcher);p.style=this,p.setEventedParent(this,()=>({isSourceLoaded:p.loaded(),source:p.serialize(),sourceId:r})),p.onAdd(this.map),this._changed=!0}removeSource(r){if(this._checkLoaded(),this.sourceCaches[r]===void 0)throw new Error("There is no source with this ID");for(const f in this._layers)if(this._layers[f].source===r)return this.fire(new o.j(new Error(`Source "${r}" cannot be removed while layer "${f}" is using it.`)));const l=this.sourceCaches[r];delete this.sourceCaches[r],delete this._updatedSources[r],l.fire(new o.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:r})),l.setEventedParent(null),l.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(r,l){if(this._checkLoaded(),this.sourceCaches[r]===void 0)throw new Error(`There is no source with this ID=${r}`);const f=this.sourceCaches[r].getSource();if(f.type!=="geojson")throw new Error(`geojsonSource.type is ${f.type}, which is !== 'geojson`);f.setData(l),this._changed=!0}getSource(r){return this.sourceCaches[r]&&this.sourceCaches[r].getSource()}addLayer(r,l,f={}){this._checkLoaded();const p=r.id;if(this.getLayer(p))return void this.fire(new o.j(new Error(`Layer "${p}" already exists on this map.`)));let y;if(r.type==="custom"){if(Jr(this,o.aF(r)))return;y=o.aC(r)}else{if("source"in r&&typeof r.source=="object"&&(this.addSource(p,r.source),r=o.aD(r),r=o.e(r,{source:p})),this._validate(o.y.layer,`layers.${p}`,r,{arrayIndex:-1},f))return;y=o.aC(r),this._validateLayer(y),y.setEventedParent(this,{layer:{id:p}})}const T=l?this._order.indexOf(l):this._order.length;if(l&&T===-1)this.fire(new o.j(new Error(`Cannot add layer "${p}" before non-existing layer "${l}".`)));else{if(this._order.splice(T,0,p),this._layerOrderChanged=!0,this._layers[p]=y,this._removedLayers[p]&&y.source&&y.type!=="custom"){const S=this._removedLayers[p];delete this._removedLayers[p],S.type!==y.type?this._updatedSources[y.source]="clear":(this._updatedSources[y.source]="reload",this.sourceCaches[y.source].pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map)}}moveLayer(r,l){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new o.j(new Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===l)return;const f=this._order.indexOf(r);this._order.splice(f,1);const p=l?this._order.indexOf(l):this._order.length;l&&p===-1?this.fire(new o.j(new Error(`Cannot move layer "${r}" before non-existing layer "${l}".`))):(this._order.splice(p,0,r),this._layerOrderChanged=!0)}removeLayer(r){this._checkLoaded();const l=this._layers[r];if(!l)return void this.fire(new o.j(new Error(`Cannot remove non-existing layer "${r}".`)));l.setEventedParent(null);const f=this._order.indexOf(r);this._order.splice(f,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=l,delete this._layers[r],this._serializedLayers&&delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],l.onRemove&&l.onRemove(this.map)}getLayer(r){return this._layers[r]}getLayersOrder(){return[...this._order]}hasLayer(r){return r in this._layers}setLayerZoomRange(r,l,f){this._checkLoaded();const p=this.getLayer(r);p?p.minzoom===l&&p.maxzoom===f||(l!=null&&(p.minzoom=l),f!=null&&(p.maxzoom=f),this._updateLayer(p)):this.fire(new o.j(new Error(`Cannot set the zoom range of non-existing layer "${r}".`)))}setFilter(r,l,f={}){this._checkLoaded();const p=this.getLayer(r);if(p){if(!o.aG(p.filter,l))return l==null?(p.filter=void 0,void this._updateLayer(p)):void(this._validate(o.y.filter,`layers.${p.id}.filter`,l,null,f)||(p.filter=o.aD(l),this._updateLayer(p)))}else this.fire(new o.j(new Error(`Cannot filter non-existing layer "${r}".`)))}getFilter(r){return o.aD(this.getLayer(r).filter)}setLayoutProperty(r,l,f,p={}){this._checkLoaded();const y=this.getLayer(r);y?o.aG(y.getLayoutProperty(l),f)||(y.setLayoutProperty(l,f,p),this._updateLayer(y)):this.fire(new o.j(new Error(`Cannot style non-existing layer "${r}".`)))}getLayoutProperty(r,l){const f=this.getLayer(r);if(f)return f.getLayoutProperty(l);this.fire(new o.j(new Error(`Cannot get style of non-existing layer "${r}".`)))}setPaintProperty(r,l,f,p={}){this._checkLoaded();const y=this.getLayer(r);y?o.aG(y.getPaintProperty(l),f)||(y.setPaintProperty(l,f,p)&&this._updateLayer(y),this._changed=!0,this._updatedPaintProps[r]=!0):this.fire(new o.j(new Error(`Cannot style non-existing layer "${r}".`)))}getPaintProperty(r,l){return this.getLayer(r).getPaintProperty(l)}setFeatureState(r,l){this._checkLoaded();const f=r.source,p=r.sourceLayer,y=this.sourceCaches[f];if(y===void 0)return void this.fire(new o.j(new Error(`The source '${f}' does not exist in the map's style.`)));const T=y.getSource().type;T==="geojson"&&p?this.fire(new o.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):T!=="vector"||p?(r.id===void 0&&this.fire(new o.j(new Error("The feature id parameter must be provided."))),y.setFeatureState(p,r.id,l)):this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(r,l){this._checkLoaded();const f=r.source,p=this.sourceCaches[f];if(p===void 0)return void this.fire(new o.j(new Error(`The source '${f}' does not exist in the map's style.`)));const y=p.getSource().type,T=y==="vector"?r.sourceLayer:void 0;y!=="vector"||T?l&&typeof r.id!="string"&&typeof r.id!="number"?this.fire(new o.j(new Error("A feature id is required to remove its specific state property."))):p.removeFeatureState(T,r.id,l):this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(r){this._checkLoaded();const l=r.source,f=r.sourceLayer,p=this.sourceCaches[l];if(p!==void 0)return p.getSource().type!=="vector"||f?(r.id===void 0&&this.fire(new o.j(new Error("The feature id parameter must be provided."))),p.getFeatureState(f,r.id)):void this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.j(new Error(`The source '${l}' does not exist in the map's style.`)))}getTransition(){return o.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const r=o.aH(this.sourceCaches,y=>y.serialize()),l=this._serializeByIds(this._order),f=this.map.getTerrain()||void 0,p=this.stylesheet;return o.aI({version:p.version,name:p.name,metadata:p.metadata,light:p.light,center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch,sprite:p.sprite,glyphs:p.glyphs,transition:p.transition,sources:r,layers:l,terrain:f},y=>y!==void 0)}_updateLayer(r){this._updatedLayers[r.id]=!0,r.source&&!this._updatedSources[r.source]&&this.sourceCaches[r.source].getSource().type!=="raster"&&(this._updatedSources[r.source]="reload",this.sourceCaches[r.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(r){const l=T=>this._layers[T].type==="fill-extrusion",f={},p=[];for(let T=this._order.length-1;T>=0;T--){const S=this._order[T];if(l(S)){f[S]=T;for(const A of r){const F=A[S];if(F)for(const L of F)p.push(L)}}}p.sort((T,S)=>S.intersectionZ-T.intersectionZ);const y=[];for(let T=this._order.length-1;T>=0;T--){const S=this._order[T];if(l(S))for(let A=p.length-1;A>=0;A--){const F=p[A].feature;if(f[F.layer.id]<T)break;y.push(F),p.pop()}else for(const A of r){const F=A[S];if(F)for(const L of F)y.push(L.feature)}}return y}queryRenderedFeatures(r,l,f){l&&l.filter&&this._validate(o.y.filter,"queryRenderedFeatures.filter",l.filter,null,l);const p={};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new o.j(new Error("parameters.layers must be an Array."))),[];for(const S of l.layers){const A=this._layers[S];if(!A)return this.fire(new o.j(new Error(`The layer '${S}' does not exist in the map's style and cannot be queried for features.`))),[];p[A.source]=!0}}const y=[];l.availableImages=this._availableImages;const T=this._serializedAllLayers();for(const S in this.sourceCaches)l.layers&&!p[S]||y.push(Zt(this.sourceCaches[S],this._layers,T,r,l,f));return this.placement&&y.push(function(S,A,F,L,R,q,oe){const se={},he=q.queryRenderedSymbols(L),ie=[];for(const Pe of Object.keys(he).map(Number))ie.push(oe[Pe]);ie.sort(wt);for(const Pe of ie){const $e=Pe.featureIndex.lookupSymbolFeatures(he[Pe.bucketInstanceId],A,Pe.bucketIndex,Pe.sourceLayerIndex,R.filter,R.layers,R.availableImages,S);for(const ye in $e){const Le=se[ye]=se[ye]||[],qe=$e[ye];qe.sort((We,tt)=>{const ht=Pe.featureSortOrder;if(ht){const ot=ht.indexOf(We.featureIndex);return ht.indexOf(tt.featureIndex)-ot}return tt.featureIndex-We.featureIndex});for(const We of qe)Le.push(We)}}for(const Pe in se)se[Pe].forEach($e=>{const ye=$e.feature,Le=F[S[Pe].source].getFeatureState(ye.layer["source-layer"],ye.id);ye.source=ye.layer.source,ye.layer["source-layer"]&&(ye.sourceLayer=ye.layer["source-layer"]),ye.state=Le});return se}(this._layers,T,this.sourceCaches,r,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(y)}querySourceFeatures(r,l){l&&l.filter&&this._validate(o.y.filter,"querySourceFeatures.filter",l.filter,null,l);const f=this.sourceCaches[r];return f?function(p,y){const T=p.getRenderableIds().map(F=>p.getTileByID(F)),S=[],A={};for(let F=0;F<T.length;F++){const L=T[F],R=L.tileID.canonical.key;A[R]||(A[R]=!0,L.querySourceFeatures(S,y))}return S}(f,l):[]}addSourceType(r,l,f){return Wt(r)?f(new Error(`A source type called "${r}" already exists.`)):(((p,y)=>{Yt[p]=y})(r,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:l.workerSourceURL},f):f(null,null))}getLight(){return this.light.getLight()}setLight(r,l={}){this._checkLoaded();const f=this.light.getLight();let p=!1;for(const T in r)if(!o.aG(r[T],f[T])){p=!0;break}if(!p)return;const y={now:o.h.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(r,l),this.light.updateTransitions(y)}_validate(r,l,f,p,y={}){return(!y||y.validate!==!1)&&Jr(this,r.call(o.y,o.e({key:l,style:this.serialize(),value:f,styleSpec:o.v},p)))}_remove(r=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.aJ.off("pluginStateChange",this._rtlTextPluginCallback);for(const l in this._layers)this._layers[l].setEventedParent(null);for(const l in this.sourceCaches){const f=this.sourceCaches[l];f.setEventedParent(null),f.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(r)}_clearSource(r){this.sourceCaches[r].clearTiles()}_reloadSource(r){this.sourceCaches[r].resume(),this.sourceCaches[r].reload()}_updateSources(r){for(const l in this.sourceCaches)this.sourceCaches[l].update(r,this.map.terrain)}_generateCollisionBoxes(){for(const r in this.sourceCaches)this._reloadSource(r)}_updatePlacement(r,l,f,p,y=!1){let T=!1,S=!1;const A={};for(const F of this._order){const L=this._layers[F];if(L.type!=="symbol")continue;if(!A[L.source]){const q=this.sourceCaches[L.source];A[L.source]=q.getRenderableIds(!0).map(oe=>q.getTileByID(oe)).sort((oe,se)=>se.tileID.overscaledZ-oe.tileID.overscaledZ||(oe.tileID.isLessThan(se.tileID)?-1:1))}const R=this.crossTileSymbolIndex.addLayer(L,A[L.source],r.center.lng);T=T||R}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((y=y||this._layerOrderChanged||f===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.h.now(),r.zoom))&&(this.pauseablePlacement=new Jt(r,this.map.terrain,this._order,y,l,f,p,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,A),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.h.now()),S=!0),T&&this.pauseablePlacement.placement.setStale()),S||T)for(const F of this._order){const L=this._layers[F];L.type==="symbol"&&this.placement.updateLayerOpacities(L,A[L.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.h.now())}_releaseSymbolFadeTiles(){for(const r in this.sourceCaches)this.sourceCaches[r].releaseSymbolFadeTiles()}getImages(r,l,f){this.imageManager.getImages(l.icons,f),this._updateTilesForChangedImages();const p=this.sourceCaches[l.source];p&&p.setDependencies(l.tileID.key,l.type,l.icons)}getGlyphs(r,l,f){this.glyphManager.getGlyphs(l.stacks,f);const p=this.sourceCaches[l.source];p&&p.setDependencies(l.tileID.key,l.type,[""])}getResource(r,l,f){return o.m(l,f)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(r,l={}){this._checkLoaded(),r&&this._validate(o.y.glyphs,"glyphs",r,null,l)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=r,this.glyphManager.entries={},this.glyphManager.setURL(r))}addSprite(r,l,f={},p){this._checkLoaded();const y=[{id:r,url:l}],T=[...Ce(this.stylesheet.sprite),...y];this._validate(o.y.sprite,"sprite",T,null,f)||(this.stylesheet.sprite=T,this._loadSprite(y,!0,p))}removeSprite(r){this._checkLoaded();const l=Ce(this.stylesheet.sprite);if(l.find(f=>f.id===r)){if(this._spritesImagesIds[r])for(const f of this._spritesImagesIds[r])this.imageManager.removeImage(f),this._changedImages[f]=!0;l.splice(l.findIndex(f=>f.id===r),1),this.stylesheet.sprite=l.length>0?l:void 0,delete this._spritesImagesIds[r],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}else this.fire(new o.j(new Error(`Sprite "${r}" doesn't exists on this map.`)))}getSprite(){return Ce(this.stylesheet.sprite)}setSprite(r,l={},f){this._checkLoaded(),r&&this._validate(o.y.sprite,"sprite",r,null,l)||(this.stylesheet.sprite=r,r?this._loadSprite(r,!0,f):(this._unloadSprite(),f&&f(null)))}}Aa.registerForPluginStateChange=o.aK;var Ao=o.Q([{name:"a_pos",type:"Int16",components:2}]),us="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const jr={prelude:_r(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:_r(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:_r(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:_r(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:_r("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:_r(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:_r(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:_r("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:_r("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:_r("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:_r(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:_r(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:_r(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:_r(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:_r(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:_r(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:_r(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:_r(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:_r(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:_r(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:_r(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:_r(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:_r(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:_r(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:_r(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:_r(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:_r("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",us),terrainDepth:_r("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",us),terrainCoords:_r("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",us)};function _r(g,r){const l=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,f=r.match(/attribute ([\w]+) ([\w]+)/g),p=g.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=r.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=y?y.concat(p):p,S={};return{fragmentSource:g=g.replace(l,(A,F,L,R,q)=>(S[q]=!0,F==="define"?`
#ifndef HAS_UNIFORM_u_${q}
varying ${L} ${R} ${q};
#else
uniform ${L} ${R} u_${q};
#endif
`:`
#ifdef HAS_UNIFORM_u_${q}
    ${L} ${R} ${q} = u_${q};
#endif
`)),vertexSource:r=r.replace(l,(A,F,L,R,q)=>{const oe=R==="float"?"vec2":"vec4",se=q.match(/color/)?"color":oe;return S[q]?F==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
attribute ${L} ${oe} a_${q};
varying ${L} ${R} ${q};
#else
uniform ${L} ${R} u_${q};
#endif
`:se==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = a_${q};
#else
    ${L} ${R} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = unpack_mix_${se}(a_${q}, u_${q}_t);
#else
    ${L} ${R} ${q} = u_${q};
#endif
`:F==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
attribute ${L} ${oe} a_${q};
#else
uniform ${L} ${R} u_${q};
#endif
`:se==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${L} ${R} ${q} = a_${q};
#else
    ${L} ${R} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${L} ${R} ${q} = unpack_mix_${se}(a_${q}, u_${q}_t);
#else
    ${L} ${R} ${q} = u_${q};
#endif
`}),staticAttributes:f,staticUniforms:T}}class $n{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(r,l,f,p,y,T,S,A,F){this.context=r;let L=this.boundPaintVertexBuffers.length!==p.length;for(let R=0;!L&&R<p.length;R++)this.boundPaintVertexBuffers[R]!==p[R]&&(L=!0);!this.vao||this.boundProgram!==l||this.boundLayoutVertexBuffer!==f||L||this.boundIndexBuffer!==y||this.boundVertexOffset!==T||this.boundDynamicVertexBuffer!==S||this.boundDynamicVertexBuffer2!==A||this.boundDynamicVertexBuffer3!==F?this.freshBind(l,f,p,y,T,S,A,F):(r.bindVertexArray.set(this.vao),S&&S.bind(),y&&y.dynamicDraw&&y.bind(),A&&A.bind(),F&&F.bind())}freshBind(r,l,f,p,y,T,S,A){const F=r.numAttributes,L=this.context,R=L.gl;this.vao&&this.destroy(),this.vao=L.createVertexArray(),L.bindVertexArray.set(this.vao),this.boundProgram=r,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=p,this.boundVertexOffset=y,this.boundDynamicVertexBuffer=T,this.boundDynamicVertexBuffer2=S,this.boundDynamicVertexBuffer3=A,l.enableAttributes(R,r);for(const q of f)q.enableAttributes(R,r);T&&T.enableAttributes(R,r),S&&S.enableAttributes(R,r),A&&A.enableAttributes(R,r),l.bind(),l.setVertexAttribPointers(R,r,y);for(const q of f)q.bind(),q.setVertexAttribPointers(R,r,y);T&&(T.bind(),T.setVertexAttribPointers(R,r,y)),p&&p.bind(),S&&(S.bind(),S.setVertexAttribPointers(R,r,y)),A&&(A.bind(),A.setVertexAttribPointers(R,r,y)),L.currentNumAttributes=F}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Xr(g){const r=[];for(let l=0;l<g.length;l++){if(g[l]===null)continue;const f=g[l].split(" ");r.push(f.pop())}return r}class Io{constructor(r,l,f,p,y,T){const S=r.gl;this.program=S.createProgram();const A=Xr(l.staticAttributes),F=f?f.getBinderAttributes():[],L=A.concat(F),R=jr.prelude.staticUniforms?Xr(jr.prelude.staticUniforms):[],q=l.staticUniforms?Xr(l.staticUniforms):[],oe=f?f.getBinderUniforms():[],se=R.concat(q).concat(oe),he=[];for(const We of se)he.indexOf(We)<0&&he.push(We);const ie=f?f.defines():[];y&&ie.push("#define OVERDRAW_INSPECTOR;"),T&&ie.push("#define TERRAIN3D;");const Pe=ie.concat(jr.prelude.fragmentSource,l.fragmentSource).join(`
`),$e=ie.concat(jr.prelude.vertexSource,l.vertexSource).join(`
`),ye=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);if(S.shaderSource(ye,Pe),S.compileShader(ye),!S.getShaderParameter(ye,S.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${S.getShaderInfoLog(ye)}`);S.attachShader(this.program,ye);const Le=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);if(S.shaderSource(Le,$e),S.compileShader(Le),!S.getShaderParameter(Le,S.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${S.getShaderInfoLog(Le)}`);S.attachShader(this.program,Le),this.attributes={};const qe={};this.numAttributes=L.length;for(let We=0;We<this.numAttributes;We++)L[We]&&(S.bindAttribLocation(this.program,We,L[We]),this.attributes[L[We]]=We);if(S.linkProgram(this.program),!S.getProgramParameter(this.program,S.LINK_STATUS))throw new Error(`Program failed to link: ${S.getProgramInfoLog(this.program)}`);S.deleteShader(Le),S.deleteShader(ye);for(let We=0;We<he.length;We++){const tt=he[We];if(tt&&!qe[tt]){const ht=S.getUniformLocation(this.program,tt);ht&&(qe[tt]=ht)}}this.fixedUniforms=p(r,qe),this.terrainUniforms=((We,tt)=>({u_depth:new o.aL(We,tt.u_depth),u_terrain:new o.aL(We,tt.u_terrain),u_terrain_dim:new o.aM(We,tt.u_terrain_dim),u_terrain_matrix:new o.aN(We,tt.u_terrain_matrix),u_terrain_unpack:new o.aO(We,tt.u_terrain_unpack),u_terrain_exaggeration:new o.aM(We,tt.u_terrain_exaggeration)}))(r,qe),this.binderUniforms=f?f.getUniforms(r,qe):[]}draw(r,l,f,p,y,T,S,A,F,L,R,q,oe,se,he,ie,Pe,$e){const ye=r.gl;if(this.failedToCreate)return;if(r.program.set(this.program),r.setDepthMode(f),r.setStencilMode(p),r.setColorMode(y),r.setCullFace(T),A){r.activeTexture.set(ye.TEXTURE2),ye.bindTexture(ye.TEXTURE_2D,A.depthTexture),r.activeTexture.set(ye.TEXTURE3),ye.bindTexture(ye.TEXTURE_2D,A.texture);for(const qe in this.terrainUniforms)this.terrainUniforms[qe].set(A[qe])}for(const qe in this.fixedUniforms)this.fixedUniforms[qe].set(S[qe]);he&&he.setUniforms(r,this.binderUniforms,oe,{zoom:se});let Le=0;switch(l){case ye.LINES:Le=2;break;case ye.TRIANGLES:Le=3;break;case ye.LINE_STRIP:Le=1}for(const qe of q.get()){const We=qe.vaos||(qe.vaos={});(We[F]||(We[F]=new $n)).bind(r,this,L,he?he.getPaintVertexBuffers():[],R,qe.vertexOffset,ie,Pe,$e),ye.drawElements(l,qe.primitiveLength*Le,ye.UNSIGNED_SHORT,qe.primitiveOffset*Le*2)}}}function Ai(g,r,l){const f=1/Ae(l,1,r.transform.tileZoom),p=Math.pow(2,l.tileID.overscaledZ),y=l.tileSize*Math.pow(2,r.transform.tileZoom)/p,T=y*(l.tileID.canonical.x+l.tileID.wrap*p),S=y*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture.size,u_scale:[f,g.fromScale,g.toScale],u_fade:g.t,u_pixel_coord_upper:[T>>16,S>>16],u_pixel_coord_lower:[65535&T,65535&S]}}const Cl=(g,r,l,f)=>{const p=r.style.light,y=p.properties.get("position"),T=[y.x,y.y,y.z],S=function(){var F=new o.A(9);return o.A!=Float32Array&&(F[1]=0,F[2]=0,F[3]=0,F[5]=0,F[6]=0,F[7]=0),F[0]=1,F[4]=1,F[8]=1,F}();p.properties.get("anchor")==="viewport"&&function(F,L){var R=Math.sin(L),q=Math.cos(L);F[0]=q,F[1]=R,F[2]=0,F[3]=-R,F[4]=q,F[5]=0,F[6]=0,F[7]=0,F[8]=1}(S,-r.transform.angle),function(F,L,R){var q=L[0],oe=L[1],se=L[2];F[0]=q*R[0]+oe*R[3]+se*R[6],F[1]=q*R[1]+oe*R[4]+se*R[7],F[2]=q*R[2]+oe*R[5]+se*R[8]}(T,T,S);const A=p.properties.get("color");return{u_matrix:g,u_lightpos:T,u_lightintensity:p.properties.get("intensity"),u_lightcolor:[A.r,A.g,A.b],u_vertical_gradient:+l,u_opacity:f}},Cn=(g,r,l,f,p,y,T)=>o.e(Cl(g,r,l,f),Ai(y,r,T),{u_height_factor:-Math.pow(2,p.overscaledZ)/T.tileSize/8}),fu=g=>({u_matrix:g}),Al=(g,r,l,f)=>o.e(fu(g),Ai(l,r,f)),Fo=(g,r)=>({u_matrix:g,u_world:r}),Po=(g,r,l,f,p)=>o.e(Al(g,r,l,f),{u_world:p}),An=(g,r,l,f)=>{const p=g.transform;let y,T;if(f.paint.get("circle-pitch-alignment")==="map"){const S=Ae(l,1,p.zoom);y=!0,T=[S,S]}else y=!1,T=p.pixelsToGLUnits;return{u_camera_to_center_distance:p.cameraToCenterDistance,u_scale_with_map:+(f.paint.get("circle-pitch-scale")==="map"),u_matrix:g.translatePosMatrix(r.posMatrix,l,f.paint.get("circle-translate"),f.paint.get("circle-translate-anchor")),u_pitch_with_map:+y,u_device_pixel_ratio:g.pixelRatio,u_extrude_scale:T}},Il=(g,r,l)=>{const f=Ae(l,1,r.zoom),p=Math.pow(2,r.zoom-l.tileID.overscaledZ),y=l.tileID.overscaleFactor();return{u_matrix:g,u_camera_to_center_distance:r.cameraToCenterDistance,u_pixels_to_tile_units:f,u_extrude_scale:[r.pixelsToGLUnits[0]/(f*p),r.pixelsToGLUnits[1]/(f*p)],u_overscale_factor:y}},$s=(g,r,l=1)=>({u_matrix:g,u_color:r,u_overlay:0,u_overlay_scale:l}),du=g=>({u_matrix:g}),Jh=(g,r,l,f)=>({u_matrix:g,u_extrude_scale:Ae(r,1,l),u_intensity:f});function Fl(g,r){const l=Math.pow(2,r.canonical.z),f=r.canonical.y;return[new o.U(0,f/l).toLngLat().lat,new o.U(0,(f+1)/l).toLngLat().lat]}const Pl=(g,r,l,f)=>{const p=g.transform;return{u_matrix:Mo(g,r,l,f),u_ratio:1/Ae(r,1,p.zoom),u_device_pixel_ratio:g.pixelRatio,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},pu=(g,r,l,f,p)=>o.e(Pl(g,r,l,p),{u_image:0,u_image_height:f}),Qh=(g,r,l,f,p)=>{const y=g.transform,T=gu(r,y);return{u_matrix:Mo(g,r,l,p),u_texsize:r.imageAtlasTexture.size,u_ratio:1/Ae(r,1,y.zoom),u_device_pixel_ratio:g.pixelRatio,u_image:0,u_scale:[T,f.fromScale,f.toScale],u_fade:f.t,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},mu=(g,r,l,f,p,y)=>{const T=g.lineAtlas,S=gu(r,g.transform),A=l.layout.get("line-cap")==="round",F=T.getDash(f.from,A),L=T.getDash(f.to,A),R=F.width*p.fromScale,q=L.width*p.toScale;return o.e(Pl(g,r,l,y),{u_patternscale_a:[S/R,-F.height/2],u_patternscale_b:[S/q,-L.height/2],u_sdfgamma:T.width/(256*Math.min(R,q)*g.pixelRatio)/2,u_image:0,u_tex_y_a:F.y,u_tex_y_b:L.y,u_mix:p.t})};function gu(g,r){return 1/Ae(g,1,r.tileZoom)}function Mo(g,r,l,f){return g.translatePosMatrix(f?f.posMatrix:r.tileID.posMatrix,r,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}const xu=(g,r,l,f,p)=>{return{u_matrix:g,u_tl_parent:r,u_scale_parent:l,u_buffer_scale:1,u_fade_t:f.mix,u_opacity:f.opacity*p.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:p.paint.get("raster-brightness-min"),u_brightness_high:p.paint.get("raster-brightness-max"),u_saturation_factor:(T=p.paint.get("raster-saturation"),T>0?1-1/(1.001-T):-T),u_contrast_factor:(y=p.paint.get("raster-contrast"),y>0?1/(1-y):1+y),u_spin_weights:_u(p.paint.get("raster-hue-rotate"))};var y,T};function _u(g){g*=Math.PI/180;const r=Math.sin(g),l=Math.cos(g);return[(2*l+1)/3,(-Math.sqrt(3)*r-l+1)/3,(Math.sqrt(3)*r-l+1)/3]}const Ml=(g,r,l,f,p,y,T,S,A,F)=>{const L=p.transform;return{u_is_size_zoom_constant:+(g==="constant"||g==="source"),u_is_size_feature_constant:+(g==="constant"||g==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:L.cameraToCenterDistance,u_pitch:L.pitch/360*2*Math.PI,u_rotate_symbol:+l,u_aspect_ratio:L.width/L.height,u_fade_change:p.options.fadeDuration?p.symbolFadeChange:1,u_matrix:y,u_label_plane_matrix:T,u_coord_matrix:S,u_is_text:+A,u_pitch_with_map:+f,u_texsize:F,u_texture:0}},Dl=(g,r,l,f,p,y,T,S,A,F,L)=>{const R=p.transform;return o.e(Ml(g,r,l,f,p,y,T,S,A,F),{u_gamma_scale:f?Math.cos(R._pitch)*R.cameraToCenterDistance:1,u_device_pixel_ratio:p.pixelRatio,u_is_halo:+L})},jn=(g,r,l,f,p,y,T,S,A,F)=>o.e(Dl(g,r,l,f,p,y,T,S,!0,A,!0),{u_texsize_icon:F,u_texture_icon:1}),Do=(g,r,l)=>({u_matrix:g,u_opacity:r,u_color:l}),Ii=(g,r,l,f,p,y)=>o.e(function(T,S,A,F){const L=A.imageManager.getPattern(T.from.toString()),R=A.imageManager.getPattern(T.to.toString()),{width:q,height:oe}=A.imageManager.getPixelSize(),se=Math.pow(2,F.tileID.overscaledZ),he=F.tileSize*Math.pow(2,A.transform.tileZoom)/se,ie=he*(F.tileID.canonical.x+F.tileID.wrap*se),Pe=he*F.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:L.tl,u_pattern_br_a:L.br,u_pattern_tl_b:R.tl,u_pattern_br_b:R.br,u_texsize:[q,oe],u_mix:S.t,u_pattern_size_a:L.displaySize,u_pattern_size_b:R.displaySize,u_scale_a:S.fromScale,u_scale_b:S.toScale,u_tile_units_to_pixels:1/Ae(F,1,A.transform.tileZoom),u_pixel_coord_upper:[ie>>16,Pe>>16],u_pixel_coord_lower:[65535&ie,65535&Pe]}}(f,y,l,p),{u_matrix:g,u_opacity:r}),Lo={fillExtrusion:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_lightpos:new o.aP(g,r.u_lightpos),u_lightintensity:new o.aM(g,r.u_lightintensity),u_lightcolor:new o.aP(g,r.u_lightcolor),u_vertical_gradient:new o.aM(g,r.u_vertical_gradient),u_opacity:new o.aM(g,r.u_opacity)}),fillExtrusionPattern:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_lightpos:new o.aP(g,r.u_lightpos),u_lightintensity:new o.aM(g,r.u_lightintensity),u_lightcolor:new o.aP(g,r.u_lightcolor),u_vertical_gradient:new o.aM(g,r.u_vertical_gradient),u_height_factor:new o.aM(g,r.u_height_factor),u_image:new o.aL(g,r.u_image),u_texsize:new o.aQ(g,r.u_texsize),u_pixel_coord_upper:new o.aQ(g,r.u_pixel_coord_upper),u_pixel_coord_lower:new o.aQ(g,r.u_pixel_coord_lower),u_scale:new o.aP(g,r.u_scale),u_fade:new o.aM(g,r.u_fade),u_opacity:new o.aM(g,r.u_opacity)}),fill:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix)}),fillPattern:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_image:new o.aL(g,r.u_image),u_texsize:new o.aQ(g,r.u_texsize),u_pixel_coord_upper:new o.aQ(g,r.u_pixel_coord_upper),u_pixel_coord_lower:new o.aQ(g,r.u_pixel_coord_lower),u_scale:new o.aP(g,r.u_scale),u_fade:new o.aM(g,r.u_fade)}),fillOutline:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_world:new o.aQ(g,r.u_world)}),fillOutlinePattern:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_world:new o.aQ(g,r.u_world),u_image:new o.aL(g,r.u_image),u_texsize:new o.aQ(g,r.u_texsize),u_pixel_coord_upper:new o.aQ(g,r.u_pixel_coord_upper),u_pixel_coord_lower:new o.aQ(g,r.u_pixel_coord_lower),u_scale:new o.aP(g,r.u_scale),u_fade:new o.aM(g,r.u_fade)}),circle:(g,r)=>({u_camera_to_center_distance:new o.aM(g,r.u_camera_to_center_distance),u_scale_with_map:new o.aL(g,r.u_scale_with_map),u_pitch_with_map:new o.aL(g,r.u_pitch_with_map),u_extrude_scale:new o.aQ(g,r.u_extrude_scale),u_device_pixel_ratio:new o.aM(g,r.u_device_pixel_ratio),u_matrix:new o.aN(g,r.u_matrix)}),collisionBox:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_camera_to_center_distance:new o.aM(g,r.u_camera_to_center_distance),u_pixels_to_tile_units:new o.aM(g,r.u_pixels_to_tile_units),u_extrude_scale:new o.aQ(g,r.u_extrude_scale),u_overscale_factor:new o.aM(g,r.u_overscale_factor)}),collisionCircle:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_inv_matrix:new o.aN(g,r.u_inv_matrix),u_camera_to_center_distance:new o.aM(g,r.u_camera_to_center_distance),u_viewport_size:new o.aQ(g,r.u_viewport_size)}),debug:(g,r)=>({u_color:new o.aR(g,r.u_color),u_matrix:new o.aN(g,r.u_matrix),u_overlay:new o.aL(g,r.u_overlay),u_overlay_scale:new o.aM(g,r.u_overlay_scale)}),clippingMask:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix)}),heatmap:(g,r)=>({u_extrude_scale:new o.aM(g,r.u_extrude_scale),u_intensity:new o.aM(g,r.u_intensity),u_matrix:new o.aN(g,r.u_matrix)}),heatmapTexture:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_world:new o.aQ(g,r.u_world),u_image:new o.aL(g,r.u_image),u_color_ramp:new o.aL(g,r.u_color_ramp),u_opacity:new o.aM(g,r.u_opacity)}),hillshade:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_image:new o.aL(g,r.u_image),u_latrange:new o.aQ(g,r.u_latrange),u_light:new o.aQ(g,r.u_light),u_shadow:new o.aR(g,r.u_shadow),u_highlight:new o.aR(g,r.u_highlight),u_accent:new o.aR(g,r.u_accent)}),hillshadePrepare:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_image:new o.aL(g,r.u_image),u_dimension:new o.aQ(g,r.u_dimension),u_zoom:new o.aM(g,r.u_zoom),u_unpack:new o.aO(g,r.u_unpack)}),line:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_ratio:new o.aM(g,r.u_ratio),u_device_pixel_ratio:new o.aM(g,r.u_device_pixel_ratio),u_units_to_pixels:new o.aQ(g,r.u_units_to_pixels)}),lineGradient:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_ratio:new o.aM(g,r.u_ratio),u_device_pixel_ratio:new o.aM(g,r.u_device_pixel_ratio),u_units_to_pixels:new o.aQ(g,r.u_units_to_pixels),u_image:new o.aL(g,r.u_image),u_image_height:new o.aM(g,r.u_image_height)}),linePattern:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_texsize:new o.aQ(g,r.u_texsize),u_ratio:new o.aM(g,r.u_ratio),u_device_pixel_ratio:new o.aM(g,r.u_device_pixel_ratio),u_image:new o.aL(g,r.u_image),u_units_to_pixels:new o.aQ(g,r.u_units_to_pixels),u_scale:new o.aP(g,r.u_scale),u_fade:new o.aM(g,r.u_fade)}),lineSDF:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_ratio:new o.aM(g,r.u_ratio),u_device_pixel_ratio:new o.aM(g,r.u_device_pixel_ratio),u_units_to_pixels:new o.aQ(g,r.u_units_to_pixels),u_patternscale_a:new o.aQ(g,r.u_patternscale_a),u_patternscale_b:new o.aQ(g,r.u_patternscale_b),u_sdfgamma:new o.aM(g,r.u_sdfgamma),u_image:new o.aL(g,r.u_image),u_tex_y_a:new o.aM(g,r.u_tex_y_a),u_tex_y_b:new o.aM(g,r.u_tex_y_b),u_mix:new o.aM(g,r.u_mix)}),raster:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_tl_parent:new o.aQ(g,r.u_tl_parent),u_scale_parent:new o.aM(g,r.u_scale_parent),u_buffer_scale:new o.aM(g,r.u_buffer_scale),u_fade_t:new o.aM(g,r.u_fade_t),u_opacity:new o.aM(g,r.u_opacity),u_image0:new o.aL(g,r.u_image0),u_image1:new o.aL(g,r.u_image1),u_brightness_low:new o.aM(g,r.u_brightness_low),u_brightness_high:new o.aM(g,r.u_brightness_high),u_saturation_factor:new o.aM(g,r.u_saturation_factor),u_contrast_factor:new o.aM(g,r.u_contrast_factor),u_spin_weights:new o.aP(g,r.u_spin_weights)}),symbolIcon:(g,r)=>({u_is_size_zoom_constant:new o.aL(g,r.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aL(g,r.u_is_size_feature_constant),u_size_t:new o.aM(g,r.u_size_t),u_size:new o.aM(g,r.u_size),u_camera_to_center_distance:new o.aM(g,r.u_camera_to_center_distance),u_pitch:new o.aM(g,r.u_pitch),u_rotate_symbol:new o.aL(g,r.u_rotate_symbol),u_aspect_ratio:new o.aM(g,r.u_aspect_ratio),u_fade_change:new o.aM(g,r.u_fade_change),u_matrix:new o.aN(g,r.u_matrix),u_label_plane_matrix:new o.aN(g,r.u_label_plane_matrix),u_coord_matrix:new o.aN(g,r.u_coord_matrix),u_is_text:new o.aL(g,r.u_is_text),u_pitch_with_map:new o.aL(g,r.u_pitch_with_map),u_texsize:new o.aQ(g,r.u_texsize),u_texture:new o.aL(g,r.u_texture)}),symbolSDF:(g,r)=>({u_is_size_zoom_constant:new o.aL(g,r.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aL(g,r.u_is_size_feature_constant),u_size_t:new o.aM(g,r.u_size_t),u_size:new o.aM(g,r.u_size),u_camera_to_center_distance:new o.aM(g,r.u_camera_to_center_distance),u_pitch:new o.aM(g,r.u_pitch),u_rotate_symbol:new o.aL(g,r.u_rotate_symbol),u_aspect_ratio:new o.aM(g,r.u_aspect_ratio),u_fade_change:new o.aM(g,r.u_fade_change),u_matrix:new o.aN(g,r.u_matrix),u_label_plane_matrix:new o.aN(g,r.u_label_plane_matrix),u_coord_matrix:new o.aN(g,r.u_coord_matrix),u_is_text:new o.aL(g,r.u_is_text),u_pitch_with_map:new o.aL(g,r.u_pitch_with_map),u_texsize:new o.aQ(g,r.u_texsize),u_texture:new o.aL(g,r.u_texture),u_gamma_scale:new o.aM(g,r.u_gamma_scale),u_device_pixel_ratio:new o.aM(g,r.u_device_pixel_ratio),u_is_halo:new o.aL(g,r.u_is_halo)}),symbolTextAndIcon:(g,r)=>({u_is_size_zoom_constant:new o.aL(g,r.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aL(g,r.u_is_size_feature_constant),u_size_t:new o.aM(g,r.u_size_t),u_size:new o.aM(g,r.u_size),u_camera_to_center_distance:new o.aM(g,r.u_camera_to_center_distance),u_pitch:new o.aM(g,r.u_pitch),u_rotate_symbol:new o.aL(g,r.u_rotate_symbol),u_aspect_ratio:new o.aM(g,r.u_aspect_ratio),u_fade_change:new o.aM(g,r.u_fade_change),u_matrix:new o.aN(g,r.u_matrix),u_label_plane_matrix:new o.aN(g,r.u_label_plane_matrix),u_coord_matrix:new o.aN(g,r.u_coord_matrix),u_is_text:new o.aL(g,r.u_is_text),u_pitch_with_map:new o.aL(g,r.u_pitch_with_map),u_texsize:new o.aQ(g,r.u_texsize),u_texsize_icon:new o.aQ(g,r.u_texsize_icon),u_texture:new o.aL(g,r.u_texture),u_texture_icon:new o.aL(g,r.u_texture_icon),u_gamma_scale:new o.aM(g,r.u_gamma_scale),u_device_pixel_ratio:new o.aM(g,r.u_device_pixel_ratio),u_is_halo:new o.aL(g,r.u_is_halo)}),background:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_opacity:new o.aM(g,r.u_opacity),u_color:new o.aR(g,r.u_color)}),backgroundPattern:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_opacity:new o.aM(g,r.u_opacity),u_image:new o.aL(g,r.u_image),u_pattern_tl_a:new o.aQ(g,r.u_pattern_tl_a),u_pattern_br_a:new o.aQ(g,r.u_pattern_br_a),u_pattern_tl_b:new o.aQ(g,r.u_pattern_tl_b),u_pattern_br_b:new o.aQ(g,r.u_pattern_br_b),u_texsize:new o.aQ(g,r.u_texsize),u_mix:new o.aM(g,r.u_mix),u_pattern_size_a:new o.aQ(g,r.u_pattern_size_a),u_pattern_size_b:new o.aQ(g,r.u_pattern_size_b),u_scale_a:new o.aM(g,r.u_scale_a),u_scale_b:new o.aM(g,r.u_scale_b),u_pixel_coord_upper:new o.aQ(g,r.u_pixel_coord_upper),u_pixel_coord_lower:new o.aQ(g,r.u_pixel_coord_lower),u_tile_units_to_pixels:new o.aM(g,r.u_tile_units_to_pixels)}),terrain:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_texture:new o.aL(g,r.u_texture),u_ele_delta:new o.aM(g,r.u_ele_delta)}),terrainDepth:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_ele_delta:new o.aM(g,r.u_ele_delta)}),terrainCoords:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_texture:new o.aL(g,r.u_texture),u_terrain_coords_id:new o.aM(g,r.u_terrain_coords_id),u_ele_delta:new o.aM(g,r.u_ele_delta)})};class Ro{constructor(r,l,f){this.context=r;const p=r.gl;this.buffer=p.createBuffer(),this.dynamicDraw=!!f,this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete l.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){const l=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const js={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Oo{constructor(r,l,f,p){this.length=l.length,this.attributes=f,this.itemSize=l.bytesPerElement,this.dynamicDraw=p,this.context=r;const y=r.gl;this.buffer=y.createBuffer(),r.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete l.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){if(r.length!==this.length)throw new Error(`Length of new data is ${r.length}, which doesn't match current length of ${this.length}`);const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,l){for(let f=0;f<this.attributes.length;f++){const p=l.attributes[this.attributes[f].name];p!==void 0&&r.enableVertexAttribArray(p)}}setVertexAttribPointers(r,l,f){for(let p=0;p<this.attributes.length;p++){const y=this.attributes[p],T=l.attributes[y.name];T!==void 0&&r.vertexAttribPointer(T,y.components,r[js[y.type]],!1,this.itemSize,y.offset+this.itemSize*(f||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const hs=new WeakMap;function In(g){var r;if(hs.has(g))return hs.get(g);{const l=(r=g.getParameter(g.VERSION))===null||r===void 0?void 0:r.startsWith("WebGL 2.0");return hs.set(g,l),l}}class pr{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Bo extends pr{getDefault(){return o.aT.transparent}set(r){const l=this.current;(r.r!==l.r||r.g!==l.g||r.b!==l.b||r.a!==l.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class di extends pr{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class pi extends pr{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class Ll extends pr{getDefault(){return[!0,!0,!0,!0]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||r[3]!==l[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class zo extends pr{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class No extends pr{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class Rl extends pr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const l=this.current;(r.func!==l.func||r.ref!==l.ref||r.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class Ol extends pr{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class Uo extends pr{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=r,this.dirty=!1}}class Bl extends pr{getDefault(){return[0,1]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class zl extends pr{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=r,this.dirty=!1}}class Vo extends pr{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class yu extends pr{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.BLEND):l.disable(l.BLEND),this.current=r,this.dirty=!1}}class vu extends pr{getDefault(){const r=this.gl;return[r.ONE,r.ZERO]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||this.dirty)&&(this.gl.blendFunc(r[0],r[1]),this.current=r,this.dirty=!1)}}class fs extends pr{getDefault(){return o.aT.transparent}set(r){const l=this.current;(r.r!==l.r||r.g!==l.g||r.b!==l.b||r.a!==l.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class ef extends pr{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquation(r),this.current=r,this.dirty=!1)}}class tf extends pr{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=r,this.dirty=!1}}class rf extends pr{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class af extends pr{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}class nf extends pr{getDefault(){return null}set(r){(r!==this.current||this.dirty)&&(this.gl.useProgram(r),this.current=r,this.dirty=!1)}}class sf extends pr{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class Nl extends pr{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||r[3]!==l[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class $o extends pr{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class Ul extends pr{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Vl extends pr{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class ds extends pr{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class wu extends pr{getDefault(){return null}set(r){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class bu extends pr{getDefault(){return null}set(r){var l;if(r===this.current&&!this.dirty)return;const f=this.gl;In(f)?f.bindVertexArray(r):(l=f.getExtension("OES_vertex_array_object"))===null||l===void 0||l.bindVertexArrayOES(r),this.current=r,this.dirty=!1}}class $l extends pr{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class Gn extends pr{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class Tu extends pr{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class Fn extends pr{constructor(r,l){super(r),this.context=r,this.parent=l}getDefault(){return null}}class ps extends Fn{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class Eu extends Fn{set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,l.DEPTH_ATTACHMENT,l.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class jl extends Fn{set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,l.DEPTH_STENCIL_ATTACHMENT,l.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class yr{constructor(r,l,f,p,y){this.context=r,this.width=l,this.height=f;const T=r.gl,S=this.framebuffer=T.createFramebuffer();if(this.colorAttachment=new ps(r,S),p)this.depthAttachment=y?new jl(r,S):new Eu(r,S);else if(y)throw new Error("Stencil cannot be setted without depth");if(T.checkFramebufferStatus(T.FRAMEBUFFER)!==T.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const r=this.context.gl,l=this.colorAttachment.get();if(l&&r.deleteTexture(l),this.depthAttachment){const f=this.depthAttachment.get();f&&r.deleteRenderbuffer(f)}r.deleteFramebuffer(this.framebuffer)}}class Gr{constructor(r,l,f){this.blendFunction=r,this.blendColor=l,this.mask=f}}Gr.Replace=[1,0],Gr.disabled=new Gr(Gr.Replace,o.aT.transparent,[!1,!1,!1,!1]),Gr.unblended=new Gr(Gr.Replace,o.aT.transparent,[!0,!0,!0,!0]),Gr.alphaBlended=new Gr([1,771],o.aT.transparent,[!0,!0,!0,!0]);class of{constructor(r){var l,f;if(this.gl=r,this.clearColor=new Bo(this),this.clearDepth=new di(this),this.clearStencil=new pi(this),this.colorMask=new Ll(this),this.depthMask=new zo(this),this.stencilMask=new No(this),this.stencilFunc=new Rl(this),this.stencilOp=new Ol(this),this.stencilTest=new Uo(this),this.depthRange=new Bl(this),this.depthTest=new zl(this),this.depthFunc=new Vo(this),this.blend=new yu(this),this.blendFunc=new vu(this),this.blendColor=new fs(this),this.blendEquation=new ef(this),this.cullFace=new tf(this),this.cullFaceSide=new rf(this),this.frontFace=new af(this),this.program=new nf(this),this.activeTexture=new sf(this),this.viewport=new Nl(this),this.bindFramebuffer=new $o(this),this.bindRenderbuffer=new Ul(this),this.bindTexture=new Vl(this),this.bindVertexBuffer=new ds(this),this.bindElementBuffer=new wu(this),this.bindVertexArray=new bu(this),this.pixelStoreUnpack=new $l(this),this.pixelStoreUnpackPremultiplyAlpha=new Gn(this),this.pixelStoreUnpackFlipY=new Tu(this),this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),In(r)){this.HALF_FLOAT=r.HALF_FLOAT;const p=r.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(l=r.RGBA16F)!==null&&l!==void 0?l:p?.RGBA16F_EXT,this.RGB16F=(f=r.RGB16F)!==null&&f!==void 0?f:p?.RGB16F_EXT,r.getExtension("EXT_color_buffer_float")}else{r.getExtension("EXT_color_buffer_half_float"),r.getExtension("OES_texture_half_float_linear");const p=r.getExtension("OES_texture_half_float");this.HALF_FLOAT=p?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,l){return new Ro(this,r,l)}createVertexBuffer(r,l,f){return new Oo(this,r,l,f)}createRenderbuffer(r,l,f){const p=this.gl,y=p.createRenderbuffer();return this.bindRenderbuffer.set(y),p.renderbufferStorage(p.RENDERBUFFER,r,l,f),this.bindRenderbuffer.set(null),y}createFramebuffer(r,l,f,p){return new yr(this,r,l,f,p)}clear({color:r,depth:l,stencil:f}){const p=this.gl;let y=0;r&&(y|=p.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set([!0,!0,!0,!0])),l!==void 0&&(y|=p.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),f!==void 0&&(y|=p.STENCIL_BUFFER_BIT,this.clearStencil.set(f),this.stencilMask.set(255)),p.clear(y)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){o.aG(r.blendFunction,Gr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}createVertexArray(){var r;return In(this.gl)?this.gl.createVertexArray():(r=this.gl.getExtension("OES_vertex_array_object"))===null||r===void 0?void 0:r.createVertexArrayOES()}deleteVertexArray(r){var l;return In(this.gl)?this.gl.deleteVertexArray(r):(l=this.gl.getExtension("OES_vertex_array_object"))===null||l===void 0?void 0:l.deleteVertexArrayOES(r)}unbindVAO(){this.bindVertexArray.set(null)}}class mr{constructor(r,l,f){this.func=r,this.mask=l,this.range=f}}mr.ReadOnly=!1,mr.ReadWrite=!0,mr.disabled=new mr(519,mr.ReadOnly,[0,1]);const Hn=7680;class Hr{constructor(r,l,f,p,y,T){this.test=r,this.ref=l,this.mask=f,this.fail=p,this.depthFail=y,this.pass=T}}Hr.disabled=new Hr({func:519,mask:0},0,0,Hn,Hn,Hn);class Nr{constructor(r,l,f){this.enable=r,this.mode=l,this.frontFace=f}}let Gs;function Su(g,r,l,f,p,y,T){const S=g.context,A=S.gl,F=g.useProgram("collisionBox"),L=[];let R=0,q=0;for(let ye=0;ye<f.length;ye++){const Le=f[ye],qe=r.getTile(Le),We=qe.getBucket(l);if(!We)continue;let tt=Le.posMatrix;p[0]===0&&p[1]===0||(tt=g.translatePosMatrix(Le.posMatrix,qe,p,y));const ht=T?We.textCollisionBox:We.iconCollisionBox,ot=We.collisionCircleArray;if(ot.length>0){const xt=o.Z(),Lt=tt;o.aU(xt,We.placementInvProjMatrix,g.transform.glCoordMatrix),o.aU(xt,xt,We.placementViewportMatrix),L.push({circleArray:ot,circleOffset:q,transform:Lt,invTransform:xt,coord:Le}),R+=ot.length/4,q=R}ht&&F.draw(S,A.LINES,mr.disabled,Hr.disabled,g.colorModeForRenderPass(),Nr.disabled,Il(tt,g.transform,qe),g.style.map.terrain&&g.style.map.terrain.getTerrainData(Le),l.id,ht.layoutVertexBuffer,ht.indexBuffer,ht.segments,null,g.transform.zoom,null,null,ht.collisionVertexBuffer)}if(!T||!L.length)return;const oe=g.useProgram("collisionCircle"),se=new o.aV;se.resize(4*R),se._trim();let he=0;for(const ye of L)for(let Le=0;Le<ye.circleArray.length/4;Le++){const qe=4*Le,We=ye.circleArray[qe+0],tt=ye.circleArray[qe+1],ht=ye.circleArray[qe+2],ot=ye.circleArray[qe+3];se.emplace(he++,We,tt,ht,ot,0),se.emplace(he++,We,tt,ht,ot,1),se.emplace(he++,We,tt,ht,ot,2),se.emplace(he++,We,tt,ht,ot,3)}(!Gs||Gs.length<2*R)&&(Gs=function(ye){const Le=2*ye,qe=new o.aX;qe.resize(Le),qe._trim();for(let We=0;We<Le;We++){const tt=6*We;qe.uint16[tt+0]=4*We+0,qe.uint16[tt+1]=4*We+1,qe.uint16[tt+2]=4*We+2,qe.uint16[tt+3]=4*We+2,qe.uint16[tt+4]=4*We+3,qe.uint16[tt+5]=4*We+0}return qe}(R));const ie=S.createIndexBuffer(Gs,!0),Pe=S.createVertexBuffer(se,o.aW.members,!0);for(const ye of L){const Le={u_matrix:ye.transform,u_inv_matrix:ye.invTransform,u_camera_to_center_distance:($e=g.transform).cameraToCenterDistance,u_viewport_size:[$e.width,$e.height]};oe.draw(S,A.TRIANGLES,mr.disabled,Hr.disabled,g.colorModeForRenderPass(),Nr.disabled,Le,g.style.map.terrain&&g.style.map.terrain.getTerrainData(ye.coord),l.id,Pe,ie,o.S.simpleSegment(0,2*ye.circleOffset,ye.circleArray.length,ye.circleArray.length/2),null,g.transform.zoom,null,null,null)}var $e;Pe.destroy(),ie.destroy()}Nr.disabled=new Nr(!1,1029,2305),Nr.backCCW=new Nr(!0,1029,2305);const Gl=o.ao(new Float32Array(16));function jo(g,r,l,f,p,y){const{horizontalAlign:T,verticalAlign:S}=o.au(g);return new o.P((-(T-.5)*r/p+f[0])*y,(-(S-.5)*l/p+f[1])*y)}function Go(g,r,l,f,p,y,T,S,A,F,L){const R=g.text.placedSymbolArray,q=g.text.dynamicLayoutVertexArray,oe=g.icon.dynamicLayoutVertexArray,se={};q.clear();for(let he=0;he<R.length;he++){const ie=R.get(he),Pe=ie.hidden||!ie.crossTileID||g.allowVerticalPlacement&&!ie.placedOrientation?null:f[ie.crossTileID];if(Pe){const $e=new o.P(ie.anchorX,ie.anchorY),ye=Vt($e,l?T:y,L),Le=xr(p.cameraToCenterDistance,ye.signedDistanceFromCamera);let qe=o.aj(g.textSizeData,A,ie)*Le/o.ap;l&&(qe*=g.tilePixelRatio/S);const{width:We,height:tt,anchor:ht,textOffset:ot,textBoxScale:xt}=Pe,Lt=jo(ht,We,tt,ot,xt,qe),ur=l?Vt($e.add(Lt),y,L).point:ye.point.add(r?Lt.rotate(-p.angle):Lt),Tt=g.allowVerticalPlacement&&ie.placedOrientation===o.ai.vertical?Math.PI/2:0;for(let Ht=0;Ht<ie.numGlyphs;Ht++)o.ak(q,ur,Tt);F&&ie.associatedIconIndex>=0&&(se[ie.associatedIconIndex]={shiftedAnchor:ur,angle:Tt})}else te(ie.numGlyphs,q)}if(F){oe.clear();const he=g.icon.placedSymbolArray;for(let ie=0;ie<he.length;ie++){const Pe=he.get(ie);if(Pe.hidden)te(Pe.numGlyphs,oe);else{const $e=se[ie];if($e)for(let ye=0;ye<Pe.numGlyphs;ye++)o.ak(oe,$e.shiftedAnchor,$e.angle);else te(Pe.numGlyphs,oe)}}g.icon.dynamicLayoutVertexBuffer.updateData(oe)}g.text.dynamicLayoutVertexBuffer.updateData(q)}function Hl(g,r,l){return l.iconsInText&&r?"symbolTextAndIcon":g?"symbolSDF":"symbolIcon"}function Ho(g,r,l,f,p,y,T,S,A,F,L,R){const q=g.context,oe=q.gl,se=g.transform,he=S==="map",ie=A==="map",Pe=S!=="viewport"&&l.layout.get("symbol-placement")!=="point",$e=he&&!ie&&!Pe,ye=!l.layout.get("symbol-sort-key").isConstant();let Le=!1;const qe=g.depthModeForSublayer(0,mr.ReadOnly),We=l._unevaluatedLayout.hasValue("text-variable-anchor")||l._unevaluatedLayout.hasValue("text-variable-anchor-offset"),tt=[];for(const ht of f){const ot=r.getTile(ht),xt=ot.getBucket(l);if(!xt)continue;const Lt=p?xt.text:xt.icon;if(!Lt||!Lt.segments.get().length||!Lt.hasVisibleVertices)continue;const ur=Lt.programConfigurations.get(l.id),Tt=p||xt.sdfIcons,Ht=p?xt.textSizeData:xt.iconSizeData,Ot=ie||se.pitch!==0,Ar=g.useProgram(Hl(Tt,p,xt),ur),cr=o.ah(Ht,se.zoom),ir=g.style.map.terrain&&g.style.map.terrain.getTerrainData(ht);let hr,ea,Pr,Ia,ma=[0,0],oa=null;if(p)ea=ot.glyphAtlasTexture,Pr=oe.LINEAR,hr=ot.glyphAtlasTexture.size,xt.iconsInText&&(ma=ot.imageAtlasTexture.size,oa=ot.imageAtlasTexture,Ia=Ot||g.options.rotating||g.options.zooming||Ht.kind==="composite"||Ht.kind==="camera"?oe.LINEAR:oe.NEAREST);else{const ta=l.layout.get("icon-size").constantOr(0)!==1||xt.iconsNeedLinear;ea=ot.imageAtlasTexture,Pr=Tt||g.options.rotating||g.options.zooming||ta||Ot?oe.LINEAR:oe.NEAREST,hr=ot.imageAtlasTexture.size}const xi=Ae(ot,1,g.transform.zoom),Lr=ct(ht.posMatrix,ie,he,g.transform,xi),Xi=Dt(ht.posMatrix,ie,he,g.transform,xi),Ki=We&&xt.hasTextData(),Dn=l.layout.get("icon-text-fit")!=="none"&&Ki&&xt.hasIconData();if(Pe){const ta=g.style.map.terrain?(ei,ra)=>g.style.map.terrain.getElevation(ht,ei,ra):null,ga=l.layout.get("text-rotation-alignment")==="map";st(xt,ht.posMatrix,g,p,Lr,Xi,ie,F,ga,ta)}const Kn=g.translatePosMatrix(ht.posMatrix,ot,y,T),ws=Pe||p&&We||Dn?Gl:Lr,Ra=g.translatePosMatrix(Xi,ot,y,T,!0),Fa=Tt&&l.paint.get(p?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let $a;$a=Tt?xt.iconsInText?jn(Ht.kind,cr,$e,ie,g,Kn,ws,Ra,hr,ma):Dl(Ht.kind,cr,$e,ie,g,Kn,ws,Ra,p,hr,!0):Ml(Ht.kind,cr,$e,ie,g,Kn,ws,Ra,p,hr);const Yn={program:Ar,buffers:Lt,uniformValues:$a,atlasTexture:ea,atlasTextureIcon:oa,atlasInterpolation:Pr,atlasInterpolationIcon:Ia,isSDF:Tt,hasHalo:Fa};if(ye&&xt.canOverlap){Le=!0;const ta=Lt.segments.get();for(const ga of ta)tt.push({segments:new o.S([ga]),sortKey:ga.sortKey,state:Yn,terrainData:ir})}else tt.push({segments:Lt.segments,sortKey:0,state:Yn,terrainData:ir})}Le&&tt.sort((ht,ot)=>ht.sortKey-ot.sortKey);for(const ht of tt){const ot=ht.state;if(q.activeTexture.set(oe.TEXTURE0),ot.atlasTexture.bind(ot.atlasInterpolation,oe.CLAMP_TO_EDGE),ot.atlasTextureIcon&&(q.activeTexture.set(oe.TEXTURE1),ot.atlasTextureIcon&&ot.atlasTextureIcon.bind(ot.atlasInterpolationIcon,oe.CLAMP_TO_EDGE)),ot.isSDF){const xt=ot.uniformValues;ot.hasHalo&&(xt.u_is_halo=1,ql(ot.buffers,ht.segments,l,g,ot.program,qe,L,R,xt,ht.terrainData)),xt.u_is_halo=0}ql(ot.buffers,ht.segments,l,g,ot.program,qe,L,R,ot.uniformValues,ht.terrainData)}}function ql(g,r,l,f,p,y,T,S,A,F){const L=f.context;p.draw(L,L.gl.TRIANGLES,y,T,S,Nr.disabled,A,F,l.id,g.layoutVertexBuffer,g.indexBuffer,r,l.paint,f.transform.zoom,g.programConfigurations.get(l.id),g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer)}function Hs(g,r,l,f,p){if(!l||!f||!f.imageAtlas)return;const y=f.imageAtlas.patternPositions;let T=y[l.to.toString()],S=y[l.from.toString()];if(!T&&S&&(T=S),!S&&T&&(S=T),!T||!S){const A=p.getPaintProperty(r);T=y[A],S=y[A]}T&&S&&g.setConstantPatternPositions(T,S)}function qs(g,r,l,f,p,y,T){const S=g.context.gl,A="fill-pattern",F=l.paint.get(A),L=F&&F.constantOr(1),R=l.getCrossfadeParameters();let q,oe,se,he,ie;T?(oe=L&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",q=S.LINES):(oe=L?"fillPattern":"fill",q=S.TRIANGLES);const Pe=F.constantOr(null);for(const $e of f){const ye=r.getTile($e);if(L&&!ye.patternsLoaded())continue;const Le=ye.getBucket(l);if(!Le)continue;const qe=Le.programConfigurations.get(l.id),We=g.useProgram(oe,qe),tt=g.style.map.terrain&&g.style.map.terrain.getTerrainData($e);L&&(g.context.activeTexture.set(S.TEXTURE0),ye.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),qe.updatePaintBuffers(R)),Hs(qe,A,Pe,ye,l);const ht=tt?$e:null,ot=g.translatePosMatrix(ht?ht.posMatrix:$e.posMatrix,ye,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor"));if(T){he=Le.indexBuffer2,ie=Le.segments2;const xt=[S.drawingBufferWidth,S.drawingBufferHeight];se=oe==="fillOutlinePattern"&&L?Po(ot,g,R,ye,xt):Fo(ot,xt)}else he=Le.indexBuffer,ie=Le.segments,se=L?Al(ot,g,R,ye):fu(ot);We.draw(g.context,q,p,g.stencilModeForClipping($e),y,Nr.disabled,se,tt,l.id,Le.layoutVertexBuffer,he,ie,l.paint,g.transform.zoom,qe)}}function Ws(g,r,l,f,p,y,T){const S=g.context,A=S.gl,F="fill-extrusion-pattern",L=l.paint.get(F),R=L.constantOr(1),q=l.getCrossfadeParameters(),oe=l.paint.get("fill-extrusion-opacity"),se=L.constantOr(null);for(const he of f){const ie=r.getTile(he),Pe=ie.getBucket(l);if(!Pe)continue;const $e=g.style.map.terrain&&g.style.map.terrain.getTerrainData(he),ye=Pe.programConfigurations.get(l.id),Le=g.useProgram(R?"fillExtrusionPattern":"fillExtrusion",ye);R&&(g.context.activeTexture.set(A.TEXTURE0),ie.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),ye.updatePaintBuffers(q)),Hs(ye,F,se,ie,l);const qe=g.translatePosMatrix(he.posMatrix,ie,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),We=l.paint.get("fill-extrusion-vertical-gradient"),tt=R?Cn(qe,g,We,oe,he,q,ie):Cl(qe,g,We,oe);Le.draw(S,S.gl.TRIANGLES,p,y,T,Nr.backCCW,tt,$e,l.id,Pe.layoutVertexBuffer,Pe.indexBuffer,Pe.segments,l.paint,g.transform.zoom,ye,g.style.map.terrain&&Pe.centroidVertexBuffer)}}function lf(g,r,l,f,p,y,T){const S=g.context,A=S.gl,F=l.fbo;if(!F)return;const L=g.useProgram("hillshade"),R=g.style.map.terrain&&g.style.map.terrain.getTerrainData(r);S.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,F.colorAttachment.get()),L.draw(S,A.TRIANGLES,p,y,T,Nr.disabled,((q,oe,se,he)=>{const ie=se.paint.get("hillshade-shadow-color"),Pe=se.paint.get("hillshade-highlight-color"),$e=se.paint.get("hillshade-accent-color");let ye=se.paint.get("hillshade-illumination-direction")*(Math.PI/180);se.paint.get("hillshade-illumination-anchor")==="viewport"&&(ye-=q.transform.angle);const Le=!q.options.moving;return{u_matrix:he?he.posMatrix:q.transform.calculatePosMatrix(oe.tileID.toUnwrapped(),Le),u_image:0,u_latrange:Fl(0,oe.tileID),u_light:[se.paint.get("hillshade-exaggeration"),ye],u_shadow:ie,u_highlight:Pe,u_accent:$e}})(g,l,f,R?r:null),R,f.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments)}function Wl(g,r,l,f,p,y){const T=g.context,S=T.gl,A=r.dem;if(A&&A.data){const F=A.dim,L=A.stride,R=A.getPixels();if(T.activeTexture.set(S.TEXTURE1),T.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||g.getTileTexture(L),r.demTexture){const oe=r.demTexture;oe.update(R,{premultiply:!1}),oe.bind(S.NEAREST,S.CLAMP_TO_EDGE)}else r.demTexture=new Fe(T,R,S.RGBA,{premultiply:!1}),r.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);T.activeTexture.set(S.TEXTURE0);let q=r.fbo;if(!q){const oe=new Fe(T,{width:F,height:F,data:null},S.RGBA);oe.bind(S.LINEAR,S.CLAMP_TO_EDGE),q=r.fbo=T.createFramebuffer(F,F,!0,!1),q.colorAttachment.set(oe.texture)}T.bindFramebuffer.set(q.framebuffer),T.viewport.set([0,0,F,F]),g.useProgram("hillshadePrepare").draw(T,S.TRIANGLES,f,p,y,Nr.disabled,((oe,se)=>{const he=se.stride,ie=o.Z();return o.aS(ie,0,o.N,-o.N,0,0,1),o.$(ie,ie,[0,-o.N,0]),{u_matrix:ie,u_image:1,u_dimension:[he,he],u_zoom:oe.overscaledZ,u_unpack:se.getUnpackVector()}})(r.tileID,A),null,l.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments),r.needsHillshadePrepare=!1}}function cf(g,r,l,f,p,y){const T=f.paint.get("raster-fade-duration");if(!y&&T>0){const S=o.h.now(),A=(S-g.timeAdded)/T,F=r?(S-r.timeAdded)/T:-1,L=l.getSource(),R=p.coveringZoomLevel({tileSize:L.tileSize,roundZoom:L.roundZoom}),q=!r||Math.abs(r.tileID.overscaledZ-R)>Math.abs(g.tileID.overscaledZ-R),oe=q&&g.refreshedUponExpiration?1:o.ad(q?A:1-F,0,1);return g.refreshedUponExpiration&&A>=1&&(g.refreshedUponExpiration=!1),r?{opacity:1,mix:1-oe}:{opacity:oe,mix:0}}return{opacity:1,mix:0}}const ku=new o.aT(1,0,0,1),qo=new o.aT(0,1,0,1),Zl=new o.aT(0,0,1,1),Cu=new o.aT(1,0,1,1),Au=new o.aT(0,1,1,1);function Zs(g,r,l,f){Zo(g,0,r+l/2,g.transform.width,l,f)}function Wo(g,r,l,f){Zo(g,r-l/2,0,l,g.transform.height,f)}function Zo(g,r,l,f,p,y){const T=g.context,S=T.gl;S.enable(S.SCISSOR_TEST),S.scissor(r*g.pixelRatio,l*g.pixelRatio,f*g.pixelRatio,p*g.pixelRatio),T.clear({color:y}),S.disable(S.SCISSOR_TEST)}function Iu(g,r,l){const f=g.context,p=f.gl,y=l.posMatrix,T=g.useProgram("debug"),S=mr.disabled,A=Hr.disabled,F=g.colorModeForRenderPass(),L="$debug",R=g.style.map.terrain&&g.style.map.terrain.getTerrainData(l);f.activeTexture.set(p.TEXTURE0);const q=r.getTileByID(l.key).latestRawTileData,oe=Math.floor((q&&q.byteLength||0)/1024),se=r.getTile(l).tileSize,he=512/Math.min(se,512)*(l.overscaledZ/g.transform.zoom)*.5;let ie=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(ie+=` => ${l.overscaledZ}`),function(Pe,$e){Pe.initDebugOverlayCanvas();const ye=Pe.debugOverlayCanvas,Le=Pe.context.gl,qe=Pe.debugOverlayCanvas.getContext("2d");qe.clearRect(0,0,ye.width,ye.height),qe.shadowColor="white",qe.shadowBlur=2,qe.lineWidth=1.5,qe.strokeStyle="white",qe.textBaseline="top",qe.font="bold 36px Open Sans, sans-serif",qe.fillText($e,5,5),qe.strokeText($e,5,5),Pe.debugOverlayTexture.update(ye),Pe.debugOverlayTexture.bind(Le.LINEAR,Le.CLAMP_TO_EDGE)}(g,`${ie} ${oe}kB`),T.draw(f,p.TRIANGLES,S,A,Gr.alphaBlended,Nr.disabled,$s(y,o.aT.transparent,he),null,L,g.debugBuffer,g.quadTriangleIndexBuffer,g.debugSegments),T.draw(f,p.LINE_STRIP,S,A,F,Nr.disabled,$s(y,o.aT.red),R,L,g.debugBuffer,g.tileBorderIndexBuffer,g.debugSegments)}function Kr(g,r,l){const f=g.context,p=f.gl,y=g.colorModeForRenderPass(),T=new mr(p.LEQUAL,mr.ReadWrite,g.depthRangeFor3D),S=g.useProgram("terrain"),A=r.getTerrainMesh();f.bindFramebuffer.set(null),f.viewport.set([0,0,g.width,g.height]);for(const F of l){const L=g.renderToTexture.getTexture(F),R=r.getTerrainData(F.tileID);f.activeTexture.set(p.TEXTURE0),p.bindTexture(p.TEXTURE_2D,L.texture);const q={u_matrix:g.transform.calculatePosMatrix(F.tileID.toUnwrapped()),u_texture:0,u_ele_delta:r.getMeshFrameDelta(g.transform.zoom)};S.draw(f,p.TRIANGLES,T,Hr.disabled,y,Nr.backCCW,q,R,"terrain",A.vertexBuffer,A.indexBuffer,A.segments)}}class qn{constructor(r,l){this.context=new of(r),this.transform=l,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.Z(),renderTime:0},this.setup(),this.numSublayers=Sr.maxUnderzooming+Sr.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Wi}resize(r,l,f){if(this.width=Math.floor(r*f),this.height=Math.floor(l*f),this.pixelRatio=f,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style._order)this.style._layers[p].resize()}setup(){const r=this.context,l=new o.a_;l.emplaceBack(0,0),l.emplaceBack(o.N,0),l.emplaceBack(0,o.N),l.emplaceBack(o.N,o.N),this.tileExtentBuffer=r.createVertexBuffer(l,Ao.members),this.tileExtentSegments=o.S.simpleSegment(0,0,4,2);const f=new o.a_;f.emplaceBack(0,0),f.emplaceBack(o.N,0),f.emplaceBack(0,o.N),f.emplaceBack(o.N,o.N),this.debugBuffer=r.createVertexBuffer(f,Ao.members),this.debugSegments=o.S.simpleSegment(0,0,4,5);const p=new o.V;p.emplaceBack(0,0,0,0),p.emplaceBack(o.N,0,o.N,0),p.emplaceBack(0,o.N,0,o.N),p.emplaceBack(o.N,o.N,o.N,o.N),this.rasterBoundsBuffer=r.createVertexBuffer(p,ut.members),this.rasterBoundsSegments=o.S.simpleSegment(0,0,4,2);const y=new o.a_;y.emplaceBack(0,0),y.emplaceBack(1,0),y.emplaceBack(0,1),y.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(y,Ao.members),this.viewportSegments=o.S.simpleSegment(0,0,4,2);const T=new o.a$;T.emplaceBack(0),T.emplaceBack(1),T.emplaceBack(3),T.emplaceBack(2),T.emplaceBack(0),this.tileBorderIndexBuffer=r.createIndexBuffer(T);const S=new o.b0;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(S);const A=this.context.gl;this.stencilClearMode=new Hr({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO)}clearStencil(){const r=this.context,l=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const f=o.Z();o.aS(f,0,this.width,this.height,0,0,1),o.a0(f,f,[l.drawingBufferWidth,l.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(r,l.TRIANGLES,mr.disabled,this.stencilClearMode,Gr.disabled,Nr.disabled,du(f),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(r,l){if(this.currentStencilSource===r.source||!r.isTileClipped()||!l||!l.length)return;this.currentStencilSource=r.source;const f=this.context,p=f.gl;this.nextStencilID+l.length>256&&this.clearStencil(),f.setColorMode(Gr.disabled),f.setDepthMode(mr.disabled);const y=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const T of l){const S=this._tileClippingMaskIDs[T.key]=this.nextStencilID++,A=this.style.map.terrain&&this.style.map.terrain.getTerrainData(T);y.draw(f,p.TRIANGLES,mr.disabled,new Hr({func:p.ALWAYS,mask:0},S,255,p.KEEP,p.KEEP,p.REPLACE),Gr.disabled,Nr.disabled,du(T.posMatrix),A,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,l=this.context.gl;return new Hr({func:l.NOTEQUAL,mask:255},r,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(r){const l=this.context.gl;return new Hr({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(r){const l=this.context.gl,f=r.sort((T,S)=>S.overscaledZ-T.overscaledZ),p=f[f.length-1].overscaledZ,y=f[0].overscaledZ-p+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const T={};for(let S=0;S<y;S++)T[S+p]=new Hr({func:l.GEQUAL,mask:255},S+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=y,[T,f]}return[{[p]:Hr.disabled},f]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new Gr([r.CONSTANT_COLOR,r.ONE],new o.aT(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Gr.unblended:Gr.alphaBlended}depthModeForSublayer(r,l,f){if(!this.opaquePassEnabledForLayer())return mr.disabled;const p=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new mr(f||this.context.gl.LEQUAL,l,[p,p])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,l){this.style=r,this.options=l,this.lineAtlas=r.lineAtlas,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(o.h.now()),this.imageManager.beginFrame();const f=this.style._order,p=this.style.sourceCaches,y={},T={},S={};for(const A in p){const F=p[A];F.used&&F.prepare(this.context),y[A]=F.getVisibleCoordinates(),T[A]=y[A].slice().reverse(),S[A]=F.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let A=0;A<f.length;A++)if(this.style._layers[f[A]].is3D()){this.opaquePassCutoff=A;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const A=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!o.b1(this.terrainFacilitator.matrix,this.transform.projMatrix)||A.length)&&(o.b2(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(F,L){const R=F.context,q=R.gl,oe=Gr.unblended,se=new mr(q.LEQUAL,mr.ReadWrite,[0,1]),he=L.getTerrainMesh(),ie=L.sourceCache.getRenderableTiles(),Pe=F.useProgram("terrainDepth");R.bindFramebuffer.set(L.getFramebuffer("depth").framebuffer),R.viewport.set([0,0,F.width/devicePixelRatio,F.height/devicePixelRatio]),R.clear({color:o.aT.transparent,depth:1});for(const $e of ie){const ye=L.getTerrainData($e.tileID),Le={u_matrix:F.transform.calculatePosMatrix($e.tileID.toUnwrapped()),u_ele_delta:L.getMeshFrameDelta(F.transform.zoom)};Pe.draw(R,q.TRIANGLES,se,Hr.disabled,oe,Nr.backCCW,Le,ye,"terrain",he.vertexBuffer,he.indexBuffer,he.segments)}R.bindFramebuffer.set(null),R.viewport.set([0,0,F.width,F.height])}(this,this.style.map.terrain),function(F,L){const R=F.context,q=R.gl,oe=Gr.unblended,se=new mr(q.LEQUAL,mr.ReadWrite,[0,1]),he=L.getTerrainMesh(),ie=L.getCoordsTexture(),Pe=L.sourceCache.getRenderableTiles(),$e=F.useProgram("terrainCoords");R.bindFramebuffer.set(L.getFramebuffer("coords").framebuffer),R.viewport.set([0,0,F.width/devicePixelRatio,F.height/devicePixelRatio]),R.clear({color:o.aT.transparent,depth:1}),L.coordsIndex=[];for(const ye of Pe){const Le=L.getTerrainData(ye.tileID);R.activeTexture.set(q.TEXTURE0),q.bindTexture(q.TEXTURE_2D,ie.texture);const qe={u_matrix:F.transform.calculatePosMatrix(ye.tileID.toUnwrapped()),u_terrain_coords_id:(255-L.coordsIndex.length)/255,u_texture:0,u_ele_delta:L.getMeshFrameDelta(F.transform.zoom)};$e.draw(R,q.TRIANGLES,se,Hr.disabled,oe,Nr.backCCW,qe,Le,"terrain",he.vertexBuffer,he.indexBuffer,he.segments),L.coordsIndex.push(ye.tileID.key)}R.bindFramebuffer.set(null),R.viewport.set([0,0,F.width,F.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const A of f){const F=this.style._layers[A];if(!F.hasOffscreenPass()||F.isHidden(this.transform.zoom))continue;const L=T[F.source];(F.type==="custom"||L.length)&&this.renderLayer(this,p[F.source],F,L)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:l.showOverdrawInspector?o.aT.black:o.aT.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.depthRangeFor3D=[0,1-(r._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=f.length-1;this.currentLayer>=0;this.currentLayer--){const A=this.style._layers[f[this.currentLayer]],F=p[A.source],L=y[A.source];this._renderTileClippingMasks(A,L),this.renderLayer(this,F,A,L)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<f.length;this.currentLayer++){const A=this.style._layers[f[this.currentLayer]],F=p[A.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(A))continue;const L=(A.type==="symbol"?S:T)[A.source];this._renderTileClippingMasks(A,y[A.source]),this.renderLayer(this,F,A,L)}if(this.options.showTileBoundaries){const A=function(F,L){let R=null;const q=Object.values(F._layers).flatMap(ie=>ie.source&&!ie.isHidden(L)?[F.sourceCaches[ie.source]]:[]),oe=q.filter(ie=>ie.getSource().type==="vector"),se=q.filter(ie=>ie.getSource().type!=="vector"),he=ie=>{(!R||R.getSource().maxzoom<ie.getSource().maxzoom)&&(R=ie)};return oe.forEach(ie=>he(ie)),R||se.forEach(ie=>he(ie)),R}(this.style,this.transform.zoom);A&&function(F,L,R){for(let q=0;q<R.length;q++)Iu(F,L,R[q])}(this,A,A.getVisibleCoordinates())}this.options.showPadding&&function(A){const F=A.transform.padding;Zs(A,A.transform.height-(F.top||0),3,ku),Zs(A,F.bottom||0,3,qo),Wo(A,F.left||0,3,Zl),Wo(A,A.transform.width-(F.right||0),3,Cu);const L=A.transform.centerPoint;(function(R,q,oe,se){Zo(R,q-1,oe-10,2,20,se),Zo(R,q-10,oe-1,20,2,se)})(A,L.x,A.transform.height-L.y,Au)}(this),this.context.setDefault()}renderLayer(r,l,f,p){if(!f.isHidden(this.transform.zoom)&&(f.type==="background"||f.type==="custom"||(p||[]).length))switch(this.id=f.id,f.type){case"symbol":(function(y,T,S,A,F){if(y.renderPass!=="translucent")return;const L=Hr.disabled,R=y.colorModeForRenderPass();(S._unevaluatedLayout.hasValue("text-variable-anchor")||S._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(q,oe,se,he,ie,Pe,$e){const ye=oe.transform,Le=ie==="map",qe=Pe==="map";for(const We of q){const tt=he.getTile(We),ht=tt.getBucket(se);if(!ht||!ht.text||!ht.text.segments.get().length)continue;const ot=o.ah(ht.textSizeData,ye.zoom),xt=Ae(tt,1,oe.transform.zoom),Lt=ct(We.posMatrix,qe,Le,oe.transform,xt),ur=se.layout.get("icon-text-fit")!=="none"&&ht.hasIconData();if(ot){const Tt=Math.pow(2,ye.zoom-tt.tileID.overscaledZ);Go(ht,Le,qe,$e,ye,Lt,We.posMatrix,Tt,ot,ur,oe.style.map.terrain?(Ht,Ot)=>oe.style.map.terrain.getElevation(We,Ht,Ot):null)}}}(A,y,S,T,S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),F),S.paint.get("icon-opacity").constantOr(1)!==0&&Ho(y,T,S,A,!1,S.paint.get("icon-translate"),S.paint.get("icon-translate-anchor"),S.layout.get("icon-rotation-alignment"),S.layout.get("icon-pitch-alignment"),S.layout.get("icon-keep-upright"),L,R),S.paint.get("text-opacity").constantOr(1)!==0&&Ho(y,T,S,A,!0,S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),S.layout.get("text-keep-upright"),L,R),T.map.showCollisionBoxes&&(Su(y,T,S,A,S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),!0),Su(y,T,S,A,S.paint.get("icon-translate"),S.paint.get("icon-translate-anchor"),!1))})(r,l,f,p,this.style.placement.variableOffsets);break;case"circle":(function(y,T,S,A){if(y.renderPass!=="translucent")return;const F=S.paint.get("circle-opacity"),L=S.paint.get("circle-stroke-width"),R=S.paint.get("circle-stroke-opacity"),q=!S.layout.get("circle-sort-key").isConstant();if(F.constantOr(1)===0&&(L.constantOr(1)===0||R.constantOr(1)===0))return;const oe=y.context,se=oe.gl,he=y.depthModeForSublayer(0,mr.ReadOnly),ie=Hr.disabled,Pe=y.colorModeForRenderPass(),$e=[];for(let ye=0;ye<A.length;ye++){const Le=A[ye],qe=T.getTile(Le),We=qe.getBucket(S);if(!We)continue;const tt=We.programConfigurations.get(S.id),ht=y.useProgram("circle",tt),ot=We.layoutVertexBuffer,xt=We.indexBuffer,Lt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Le),ur={programConfiguration:tt,program:ht,layoutVertexBuffer:ot,indexBuffer:xt,uniformValues:An(y,Le,qe,S),terrainData:Lt};if(q){const Tt=We.segments.get();for(const Ht of Tt)$e.push({segments:new o.S([Ht]),sortKey:Ht.sortKey,state:ur})}else $e.push({segments:We.segments,sortKey:0,state:ur})}q&&$e.sort((ye,Le)=>ye.sortKey-Le.sortKey);for(const ye of $e){const{programConfiguration:Le,program:qe,layoutVertexBuffer:We,indexBuffer:tt,uniformValues:ht,terrainData:ot}=ye.state;qe.draw(oe,se.TRIANGLES,he,ie,Pe,Nr.disabled,ht,ot,S.id,We,tt,ye.segments,S.paint,y.transform.zoom,Le)}})(r,l,f,p);break;case"heatmap":(function(y,T,S,A){if(S.paint.get("heatmap-opacity")!==0)if(y.renderPass==="offscreen"){const F=y.context,L=F.gl,R=Hr.disabled,q=new Gr([L.ONE,L.ONE],o.aT.transparent,[!0,!0,!0,!0]);(function(oe,se,he){const ie=oe.gl;oe.activeTexture.set(ie.TEXTURE1),oe.viewport.set([0,0,se.width/4,se.height/4]);let Pe=he.heatmapFbo;if(Pe)ie.bindTexture(ie.TEXTURE_2D,Pe.colorAttachment.get()),oe.bindFramebuffer.set(Pe.framebuffer);else{const $e=ie.createTexture();ie.bindTexture(ie.TEXTURE_2D,$e),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_WRAP_S,ie.CLAMP_TO_EDGE),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_WRAP_T,ie.CLAMP_TO_EDGE),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_MIN_FILTER,ie.LINEAR),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_MAG_FILTER,ie.LINEAR),Pe=he.heatmapFbo=oe.createFramebuffer(se.width/4,se.height/4,!1,!1),function(ye,Le,qe,We){var tt,ht;const ot=ye.gl,xt=(tt=ye.HALF_FLOAT)!==null&&tt!==void 0?tt:ot.UNSIGNED_BYTE,Lt=(ht=ye.RGBA16F)!==null&&ht!==void 0?ht:ot.RGBA;ot.texImage2D(ot.TEXTURE_2D,0,Lt,Le.width/4,Le.height/4,0,ot.RGBA,xt,null),We.colorAttachment.set(qe)}(oe,se,$e,Pe)}})(F,y,S),F.clear({color:o.aT.transparent});for(let oe=0;oe<A.length;oe++){const se=A[oe];if(T.hasRenderableParent(se))continue;const he=T.getTile(se),ie=he.getBucket(S);if(!ie)continue;const Pe=ie.programConfigurations.get(S.id),$e=y.useProgram("heatmap",Pe),{zoom:ye}=y.transform;$e.draw(F,L.TRIANGLES,mr.disabled,R,q,Nr.disabled,Jh(se.posMatrix,he,ye,S.paint.get("heatmap-intensity")),null,S.id,ie.layoutVertexBuffer,ie.indexBuffer,ie.segments,S.paint,y.transform.zoom,Pe)}F.viewport.set([0,0,y.width,y.height])}else y.renderPass==="translucent"&&(y.context.setColorMode(y.colorModeForRenderPass()),function(F,L){const R=F.context,q=R.gl,oe=L.heatmapFbo;if(!oe)return;R.activeTexture.set(q.TEXTURE0),q.bindTexture(q.TEXTURE_2D,oe.colorAttachment.get()),R.activeTexture.set(q.TEXTURE1);let se=L.colorRampTexture;se||(se=L.colorRampTexture=new Fe(R,L.colorRamp,q.RGBA)),se.bind(q.LINEAR,q.CLAMP_TO_EDGE),F.useProgram("heatmapTexture").draw(R,q.TRIANGLES,mr.disabled,Hr.disabled,F.colorModeForRenderPass(),Nr.disabled,((he,ie,Pe,$e)=>{const ye=o.Z();o.aS(ye,0,he.width,he.height,0,0,1);const Le=he.context.gl;return{u_matrix:ye,u_world:[Le.drawingBufferWidth,Le.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:ie.paint.get("heatmap-opacity")}})(F,L),null,L.id,F.viewportBuffer,F.quadTriangleIndexBuffer,F.viewportSegments,L.paint,F.transform.zoom)}(y,S))})(r,l,f,p);break;case"line":(function(y,T,S,A){if(y.renderPass!=="translucent")return;const F=S.paint.get("line-opacity"),L=S.paint.get("line-width");if(F.constantOr(1)===0||L.constantOr(1)===0)return;const R=y.depthModeForSublayer(0,mr.ReadOnly),q=y.colorModeForRenderPass(),oe=S.paint.get("line-dasharray"),se=S.paint.get("line-pattern"),he=se.constantOr(1),ie=S.paint.get("line-gradient"),Pe=S.getCrossfadeParameters(),$e=he?"linePattern":oe?"lineSDF":ie?"lineGradient":"line",ye=y.context,Le=ye.gl;let qe=!0;for(const We of A){const tt=T.getTile(We);if(he&&!tt.patternsLoaded())continue;const ht=tt.getBucket(S);if(!ht)continue;const ot=ht.programConfigurations.get(S.id),xt=y.context.program.get(),Lt=y.useProgram($e,ot),ur=qe||Lt.program!==xt,Tt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(We),Ht=se.constantOr(null);if(Ht&&tt.imageAtlas){const cr=tt.imageAtlas,ir=cr.patternPositions[Ht.to.toString()],hr=cr.patternPositions[Ht.from.toString()];ir&&hr&&ot.setConstantPatternPositions(ir,hr)}const Ot=Tt?We:null,Ar=he?Qh(y,tt,S,Pe,Ot):oe?mu(y,tt,S,oe,Pe,Ot):ie?pu(y,tt,S,ht.lineClipsArray.length,Ot):Pl(y,tt,S,Ot);if(he)ye.activeTexture.set(Le.TEXTURE0),tt.imageAtlasTexture.bind(Le.LINEAR,Le.CLAMP_TO_EDGE),ot.updatePaintBuffers(Pe);else if(oe&&(ur||y.lineAtlas.dirty))ye.activeTexture.set(Le.TEXTURE0),y.lineAtlas.bind(ye);else if(ie){const cr=ht.gradients[S.id];let ir=cr.texture;if(S.gradientVersion!==cr.version){let hr=256;if(S.stepInterpolant){const ea=T.getSource().maxzoom,Pr=We.canonical.z===ea?Math.ceil(1<<y.transform.maxZoom-We.canonical.z):1;hr=o.ad(o.aY(ht.maxLineLength/o.N*1024*Pr),256,ye.maxTextureSize)}cr.gradient=o.aZ({expression:S.gradientExpression(),evaluationKey:"lineProgress",resolution:hr,image:cr.gradient||void 0,clips:ht.lineClipsArray}),cr.texture?cr.texture.update(cr.gradient):cr.texture=new Fe(ye,cr.gradient,Le.RGBA),cr.version=S.gradientVersion,ir=cr.texture}ye.activeTexture.set(Le.TEXTURE0),ir.bind(S.stepInterpolant?Le.NEAREST:Le.LINEAR,Le.CLAMP_TO_EDGE)}Lt.draw(ye,Le.TRIANGLES,R,y.stencilModeForClipping(We),q,Nr.disabled,Ar,Tt,S.id,ht.layoutVertexBuffer,ht.indexBuffer,ht.segments,S.paint,y.transform.zoom,ot,ht.layoutVertexBuffer2),qe=!1}})(r,l,f,p);break;case"fill":(function(y,T,S,A){const F=S.paint.get("fill-color"),L=S.paint.get("fill-opacity");if(L.constantOr(1)===0)return;const R=y.colorModeForRenderPass(),q=S.paint.get("fill-pattern"),oe=y.opaquePassEnabledForLayer()&&!q.constantOr(1)&&F.constantOr(o.aT.transparent).a===1&&L.constantOr(0)===1?"opaque":"translucent";if(y.renderPass===oe){const se=y.depthModeForSublayer(1,y.renderPass==="opaque"?mr.ReadWrite:mr.ReadOnly);qs(y,T,S,A,se,R,!1)}if(y.renderPass==="translucent"&&S.paint.get("fill-antialias")){const se=y.depthModeForSublayer(S.getPaintProperty("fill-outline-color")?2:0,mr.ReadOnly);qs(y,T,S,A,se,R,!0)}})(r,l,f,p);break;case"fill-extrusion":(function(y,T,S,A){const F=S.paint.get("fill-extrusion-opacity");if(F!==0&&y.renderPass==="translucent"){const L=new mr(y.context.gl.LEQUAL,mr.ReadWrite,y.depthRangeFor3D);if(F!==1||S.paint.get("fill-extrusion-pattern").constantOr(1))Ws(y,T,S,A,L,Hr.disabled,Gr.disabled),Ws(y,T,S,A,L,y.stencilModeFor3D(),y.colorModeForRenderPass());else{const R=y.colorModeForRenderPass();Ws(y,T,S,A,L,Hr.disabled,R)}}})(r,l,f,p);break;case"hillshade":(function(y,T,S,A){if(y.renderPass!=="offscreen"&&y.renderPass!=="translucent")return;const F=y.context,L=y.depthModeForSublayer(0,mr.ReadOnly),R=y.colorModeForRenderPass(),[q,oe]=y.renderPass==="translucent"?y.stencilConfigForOverlap(A):[{},A];for(const se of oe){const he=T.getTile(se);he.needsHillshadePrepare!==void 0&&he.needsHillshadePrepare&&y.renderPass==="offscreen"?Wl(y,he,S,L,Hr.disabled,R):y.renderPass==="translucent"&&lf(y,se,he,S,L,q[se.overscaledZ],R)}F.viewport.set([0,0,y.width,y.height])})(r,l,f,p);break;case"raster":(function(y,T,S,A){if(y.renderPass!=="translucent"||S.paint.get("raster-opacity")===0||!A.length)return;const F=y.context,L=F.gl,R=T.getSource(),q=y.useProgram("raster"),oe=y.colorModeForRenderPass(),[se,he]=R instanceof Qe?[{},A]:y.stencilConfigForOverlap(A),ie=he[he.length-1].overscaledZ,Pe=!y.options.moving;for(const $e of he){const ye=y.depthModeForSublayer($e.overscaledZ-ie,S.paint.get("raster-opacity")===1?mr.ReadWrite:mr.ReadOnly,L.LESS),Le=T.getTile($e);Le.registerFadeDuration(S.paint.get("raster-fade-duration"));const qe=T.findLoadedParent($e,0),We=cf(Le,qe,T,S,y.transform,y.style.map.terrain);let tt,ht;const ot=S.paint.get("raster-resampling")==="nearest"?L.NEAREST:L.LINEAR;F.activeTexture.set(L.TEXTURE0),Le.texture.bind(ot,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),F.activeTexture.set(L.TEXTURE1),qe?(qe.texture.bind(ot,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),tt=Math.pow(2,qe.tileID.overscaledZ-Le.tileID.overscaledZ),ht=[Le.tileID.canonical.x*tt%1,Le.tileID.canonical.y*tt%1]):Le.texture.bind(ot,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST);const xt=y.style.map.terrain&&y.style.map.terrain.getTerrainData($e),Lt=xt?$e:null,ur=Lt?Lt.posMatrix:y.transform.calculatePosMatrix($e.toUnwrapped(),Pe),Tt=xu(ur,ht||[0,0],tt||1,We,S);R instanceof Qe?q.draw(F,L.TRIANGLES,ye,Hr.disabled,oe,Nr.disabled,Tt,xt,S.id,R.boundsBuffer,y.quadTriangleIndexBuffer,R.boundsSegments):q.draw(F,L.TRIANGLES,ye,se[$e.overscaledZ],oe,Nr.disabled,Tt,xt,S.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments)}})(r,l,f,p);break;case"background":(function(y,T,S,A){const F=S.paint.get("background-color"),L=S.paint.get("background-opacity");if(L===0)return;const R=y.context,q=R.gl,oe=y.transform,se=oe.tileSize,he=S.paint.get("background-pattern");if(y.isPatternMissing(he))return;const ie=!he&&F.a===1&&L===1&&y.opaquePassEnabledForLayer()?"opaque":"translucent";if(y.renderPass!==ie)return;const Pe=Hr.disabled,$e=y.depthModeForSublayer(0,ie==="opaque"?mr.ReadWrite:mr.ReadOnly),ye=y.colorModeForRenderPass(),Le=y.useProgram(he?"backgroundPattern":"background"),qe=A||oe.coveringTiles({tileSize:se,terrain:y.style.map.terrain});he&&(R.activeTexture.set(q.TEXTURE0),y.imageManager.bind(y.context));const We=S.getCrossfadeParameters();for(const tt of qe){const ht=A?tt.posMatrix:y.transform.calculatePosMatrix(tt.toUnwrapped()),ot=he?Ii(ht,L,y,he,{tileID:tt,tileSize:se},We):Do(ht,L,F),xt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(tt);Le.draw(R,q.TRIANGLES,$e,Pe,ye,Nr.disabled,ot,xt,S.id,y.tileExtentBuffer,y.quadTriangleIndexBuffer,y.tileExtentSegments)}})(r,0,f,p);break;case"custom":(function(y,T,S){const A=y.context,F=S.implementation;if(y.renderPass==="offscreen"){const L=F.prerender;L&&(y.setCustomLayerDefaults(),A.setColorMode(y.colorModeForRenderPass()),L.call(F,A.gl,y.transform.customLayerMatrix()),A.setDirty(),y.setBaseState())}else if(y.renderPass==="translucent"){y.setCustomLayerDefaults(),A.setColorMode(y.colorModeForRenderPass()),A.setStencilMode(Hr.disabled);const L=F.renderingMode==="3d"?new mr(y.context.gl.LEQUAL,mr.ReadWrite,y.depthRangeFor3D):y.depthModeForSublayer(0,mr.ReadOnly);A.setDepthMode(L),F.render(A.gl,y.transform.customLayerMatrix()),A.setDirty(),y.setBaseState(),A.bindFramebuffer.set(null)}})(r,0,f)}}translatePosMatrix(r,l,f,p,y){if(!f[0]&&!f[1])return r;const T=y?p==="map"?this.transform.angle:0:p==="viewport"?-this.transform.angle:0;if(T){const F=Math.sin(T),L=Math.cos(T);f=[f[0]*L-f[1]*F,f[0]*F+f[1]*L]}const S=[y?f[0]:Ae(l,f[0],this.transform.zoom),y?f[1]:Ae(l,f[1],this.transform.zoom),0],A=new Float32Array(16);return o.$(A,r,S),A}saveTileTexture(r){const l=this._tileTextures[r.size[0]];l?l.push(r):this._tileTextures[r.size[0]]=[r]}getTileTexture(r){const l=this._tileTextures[r];return l&&l.length>0?l.pop():null}isPatternMissing(r){if(!r)return!1;if(!r.from||!r.to)return!0;const l=this.imageManager.getPattern(r.from.toString()),f=this.imageManager.getPattern(r.to.toString());return!l||!f}useProgram(r,l){this.cache=this.cache||{};const f=r+(l?l.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[f]||(this.cache[f]=new Io(this.context,jr[r],l,Lo[r],this._showOverdrawInspector,this.style.map.terrain)),this.cache[f]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Fe(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:r,drawingBufferHeight:l}=this.context.gl;return this.width!==r||this.height!==l}}class Ja{constructor(r,l){this.points=r,this.planes=l}static fromInvProjectionMatrix(r,l,f){const p=Math.pow(2,f),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(S=>{const A=1/(S=o.ag([],S,r))[3]/l*p;return o.b3(S,S,[A,A,1/S[3],A])}),T=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(S=>{const A=function(q,oe){var se=oe[0],he=oe[1],ie=oe[2],Pe=se*se+he*he+ie*ie;return Pe>0&&(Pe=1/Math.sqrt(Pe)),q[0]=oe[0]*Pe,q[1]=oe[1]*Pe,q[2]=oe[2]*Pe,q}([],function(q,oe,se){var he=oe[0],ie=oe[1],Pe=oe[2],$e=se[0],ye=se[1],Le=se[2];return q[0]=ie*Le-Pe*ye,q[1]=Pe*$e-he*Le,q[2]=he*ye-ie*$e,q}([],Te([],y[S[0]],y[S[1]]),Te([],y[S[2]],y[S[1]]))),F=-((L=A)[0]*(R=y[S[1]])[0]+L[1]*R[1]+L[2]*R[2]);var L,R;return A.concat(F)});return new Ja(y,T)}}class ms{constructor(r,l){this.min=r,this.max=l,this.center=function(f,p,y){return f[0]=.5*p[0],f[1]=.5*p[1],f[2]=.5*p[2],f}([],function(f,p,y){return f[0]=p[0]+y[0],f[1]=p[1]+y[1],f[2]=p[2]+y[2],f}([],this.min,this.max))}quadrant(r){const l=[r%2==0,r<2],f=fe(this.min),p=fe(this.max);for(let y=0;y<l.length;y++)f[y]=l[y]?this.min[y]:this.center[y],p[y]=l[y]?this.center[y]:this.max[y];return p[2]=this.max[2],new ms(f,p)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}intersects(r){const l=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let f=!0;for(let p=0;p<r.planes.length;p++){const y=r.planes[p];let T=0;for(let S=0;S<l.length;S++)o.b4(y,l[S])>=0&&T++;if(T===0)return 0;T!==l.length&&(f=!1)}if(f)return 2;for(let p=0;p<3;p++){let y=Number.MAX_VALUE,T=-Number.MAX_VALUE;for(let S=0;S<r.points.length;S++){const A=r.points[S][p]-this.min[p];y=Math.min(y,A),T=Math.max(T,A)}if(T<0||y>this.max[p]-this.min[p])return 0}return 1}}class Xs{constructor(r=0,l=0,f=0,p=0){if(isNaN(r)||r<0||isNaN(l)||l<0||isNaN(f)||f<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=l,this.left=f,this.right=p}interpolate(r,l,f){return l.top!=null&&r.top!=null&&(this.top=o.B.number(r.top,l.top,f)),l.bottom!=null&&r.bottom!=null&&(this.bottom=o.B.number(r.bottom,l.bottom,f)),l.left!=null&&r.left!=null&&(this.left=o.B.number(r.left,l.left,f)),l.right!=null&&r.right!=null&&(this.right=o.B.number(r.right,l.right,f)),this}getCenter(r,l){const f=o.ad((this.left+r-this.right)/2,0,r),p=o.ad((this.top+l-this.bottom)/2,0,l);return new o.P(f,p)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new Xs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class Xo{constructor(r,l,f,p,y){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=y===void 0||!!y,this._minZoom=r||0,this._maxZoom=l||22,this._minPitch=f??0,this._maxPitch=p??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new o.L(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Xs,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const r=new Xo(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return r.apply(this),r}apply(r){this.tileSize=r.tileSize,this.latRange=r.latRange,this.width=r.width,this.height=r.height,this._center=r._center,this._elevation=r._elevation,this._minEleveationForCurrentTile=r._minEleveationForCurrentTile,this.zoom=r.zoom,this.angle=r.angle,this._fov=r._fov,this._pitch=r._pitch,this._unmodified=r._unmodified,this._edgeInsets=r._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(r){const l=-o.b5(r,-180,180)*Math.PI/180;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=function(){var f=new o.A(4);return o.A!=Float32Array&&(f[1]=0,f[2]=0),f[0]=1,f[3]=1,f}(),function(f,p,y){var T=p[0],S=p[1],A=p[2],F=p[3],L=Math.sin(y),R=Math.cos(y);f[0]=T*R+A*L,f[1]=S*R+F*L,f[2]=T*-L+A*R,f[3]=S*-L+F*R}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const l=o.ad(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=r/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(r){const l=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._zoom=l,this.tileZoom=Math.max(0,Math.floor(l)),this.scale=this.zoomScale(l),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(r){r!==this._elevation&&(this._elevation=r,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,l,f){this._unmodified=!1,this._edgeInsets.interpolate(r,l,f),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const l=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(r){const l=[new o.b6(0,r)];if(this._renderWorldCopies){const f=this.pointCoordinate(new o.P(0,0)),p=this.pointCoordinate(new o.P(this.width,0)),y=this.pointCoordinate(new o.P(this.width,this.height)),T=this.pointCoordinate(new o.P(0,this.height)),S=Math.floor(Math.min(f.x,p.x,y.x,T.x)),A=Math.floor(Math.max(f.x,p.x,y.x,T.x)),F=1;for(let L=S-F;L<=A+F;L++)L!==0&&l.push(new o.b6(L,r))}return l}coveringTiles(r){var l,f;let p=this.coveringZoomLevel(r);const y=p;if(r.minzoom!==void 0&&p<r.minzoom)return[];r.maxzoom!==void 0&&p>r.maxzoom&&(p=r.maxzoom);const T=this.pointCoordinate(this.getCameraPoint()),S=o.U.fromLngLat(this.center),A=Math.pow(2,p),F=[A*T.x,A*T.y,0],L=[A*S.x,A*S.y,0],R=Ja.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,p);let q=r.minzoom||0;!r.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(q=p);const oe=r.terrain?2/Math.min(this.tileSize,r.tileSize)*this.tileSize:3,se=ye=>({aabb:new ms([ye*A,0,0],[(ye+1)*A,A,0]),zoom:0,x:0,y:0,wrap:ye,fullyVisible:!1}),he=[],ie=[],Pe=p,$e=r.reparseOverscaled?y:p;if(this._renderWorldCopies)for(let ye=1;ye<=3;ye++)he.push(se(-ye)),he.push(se(ye));for(he.push(se(0));he.length>0;){const ye=he.pop(),Le=ye.x,qe=ye.y;let We=ye.fullyVisible;if(!We){const Lt=ye.aabb.intersects(R);if(Lt===0)continue;We=Lt===2}const tt=r.terrain?F:L,ht=ye.aabb.distanceX(tt),ot=ye.aabb.distanceY(tt),xt=Math.max(Math.abs(ht),Math.abs(ot));if(ye.zoom===Pe||xt>oe+(1<<Pe-ye.zoom)-2&&ye.zoom>=q){const Lt=Pe-ye.zoom,ur=F[0]-.5-(Le<<Lt),Tt=F[1]-.5-(qe<<Lt);ie.push({tileID:new o.O(ye.zoom===Pe?$e:ye.zoom,ye.wrap,ye.zoom,Le,qe),distanceSq:re([L[0]-.5-Le,L[1]-.5-qe]),tileDistanceToCamera:Math.sqrt(ur*ur+Tt*Tt)})}else for(let Lt=0;Lt<4;Lt++){const ur=(Le<<1)+Lt%2,Tt=(qe<<1)+(Lt>>1),Ht=ye.zoom+1;let Ot=ye.aabb.quadrant(Lt);if(r.terrain){const Ar=new o.O(Ht,ye.wrap,Ht,ur,Tt),cr=r.terrain.getMinMaxElevation(Ar),ir=(l=cr.minElevation)!==null&&l!==void 0?l:this.elevation,hr=(f=cr.maxElevation)!==null&&f!==void 0?f:this.elevation;Ot=new ms([Ot.min[0],Ot.min[1],ir],[Ot.max[0],Ot.max[1],hr])}he.push({aabb:Ot,zoom:Ht,x:ur,y:Tt,wrap:ye.wrap,fullyVisible:We})}}return ie.sort((ye,Le)=>ye.distanceSq-Le.distanceSq).map(ye=>ye.tileID)}resize(r,l){this.width=r,this.height=l,this.pixelsToGLUnits=[2/r,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const l=o.ad(r.lat,-this.maxValidLatitude,this.maxValidLatitude);return new o.P(o.G(r.lng)*this.worldSize,o.H(l)*this.worldSize)}unproject(r){return new o.U(r.x/this.worldSize,r.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(r){const l=this.pointLocation(this.centerPoint,r),f=r.getElevationForLngLatZoom(l,this.tileZoom);if(!(this.elevation-f))return;const p=this.getCameraPosition(),y=o.U.fromLngLat(p.lngLat,p.altitude),T=o.U.fromLngLat(l,f),S=y.x-T.x,A=y.y-T.y,F=y.z-T.z,L=Math.sqrt(S*S+A*A+F*F),R=this.scaleZoom(this.cameraToCenterDistance/L/this.tileSize);this._elevation=f,this._center=l,this.zoom=R}setLocationAtPoint(r,l){const f=this.pointCoordinate(l),p=this.pointCoordinate(this.centerPoint),y=this.locationCoordinate(r),T=new o.U(y.x-(f.x-p.x),y.y-(f.y-p.y));this.center=this.coordinateLocation(T),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(r,l){return l?this.coordinatePoint(this.locationCoordinate(r),l.getElevationForLngLatZoom(r,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(r))}pointLocation(r,l){return this.coordinateLocation(this.pointCoordinate(r,l))}locationCoordinate(r){return o.U.fromLngLat(r)}coordinateLocation(r){return r&&r.toLngLat()}pointCoordinate(r,l){if(l){const q=l.pointCoordinate(r);if(q!=null)return q}const f=[r.x,r.y,0,1],p=[r.x,r.y,1,1];o.ag(f,f,this.pixelMatrixInverse),o.ag(p,p,this.pixelMatrixInverse);const y=f[3],T=p[3],S=f[1]/y,A=p[1]/T,F=f[2]/y,L=p[2]/T,R=F===L?0:(0-F)/(L-F);return new o.U(o.B.number(f[0]/y,p[0]/T,R)/this.worldSize,o.B.number(S,A,R)/this.worldSize)}coordinatePoint(r,l=0,f=this.pixelMatrix){const p=[r.x*this.worldSize,r.y*this.worldSize,l,1];return o.ag(p,p,f),new o.P(p[0]/p[3],p[1]/p[3])}getBounds(){const r=Math.max(0,this.height/2-this.getHorizon());return new Ee().extend(this.pointLocation(new o.P(0,r))).extend(this.pointLocation(new o.P(this.width,r))).extend(this.pointLocation(new o.P(this.width,this.height))).extend(this.pointLocation(new o.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Ee([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(r){r?(this.lngRange=[r.getWest(),r.getEast()],this.latRange=[r.getSouth(),r.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(r,l=!1){const f=r.key,p=l?this._alignedPosMatrixCache:this._posMatrixCache;if(p[f])return p[f];const y=r.canonical,T=this.worldSize/this.zoomScale(y.z),S=y.x+Math.pow(2,y.z)*r.wrap,A=o.ao(new Float64Array(16));return o.$(A,A,[S*T,y.y*T,0]),o.a0(A,A,[T/o.N,T/o.N,1]),o.a1(A,l?this.alignedProjMatrix:this.projMatrix,A),p[f]=new Float32Array(A),p[f]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let r,l,f,p,y=-90,T=90,S=-180,A=180;const F=this.size,L=this._unmodified;if(this.latRange){const oe=this.latRange;y=o.H(oe[1])*this.worldSize,T=o.H(oe[0])*this.worldSize,r=T-y<F.y?F.y/(T-y):0}if(this.lngRange){const oe=this.lngRange;S=o.b5(o.G(oe[0])*this.worldSize,0,this.worldSize),A=o.b5(o.G(oe[1])*this.worldSize,0,this.worldSize),A<S&&(A+=this.worldSize),l=A-S<F.x?F.x/(A-S):0}const R=this.point,q=Math.max(l||0,r||0);if(q)return this.center=this.unproject(new o.P(l?(A+S)/2:R.x,r?(T+y)/2:R.y)),this.zoom+=this.scaleZoom(q),this._unmodified=L,void(this._constraining=!1);if(this.latRange){const oe=R.y,se=F.y/2;oe-se<y&&(p=y+se),oe+se>T&&(p=T-se)}if(this.lngRange){const oe=(S+A)/2,se=o.b5(R.x,oe-this.worldSize/2,oe+this.worldSize/2),he=F.x/2;se-he<S&&(f=S+he),se+he>A&&(f=A-he)}f===void 0&&p===void 0||(this.center=this.unproject(new o.P(f!==void 0?f:R.x,p!==void 0?p:R.y)).wrap()),this._unmodified=L,this._constraining=!1}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,l=this.point.x,f=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=o.b7(1,this.center.lat)*this.worldSize;let p=o.ao(new Float64Array(16));o.a0(p,p,[this.width/2,-this.height/2,1]),o.$(p,p,[1,-1,0]),this.labelPlaneMatrix=p,p=o.ao(new Float64Array(16)),o.a0(p,p,[1,-1,1]),o.$(p,p,[-1,-1,0]),o.a0(p,p,[2/this.width,2/this.height,1]),this.glCoordMatrix=p;const y=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),T=Math.min(this.elevation,this._minEleveationForCurrentTile),S=y-T*this._pixelPerMeter/Math.cos(this._pitch),A=T<0?S:y,F=Math.PI/2+this._pitch,L=this._fov*(.5+r.y/this.height),R=Math.sin(L)*A/Math.sin(o.ad(Math.PI-F-L,.01,Math.PI-.01)),q=this.getHorizon(),oe=2*Math.atan(q/this.cameraToCenterDistance)*(.5+r.y/(2*q)),se=Math.sin(oe)*A/Math.sin(o.ad(Math.PI-F-oe,.01,Math.PI-.01)),he=Math.min(R,se),ie=1.01*(Math.cos(Math.PI/2-this._pitch)*he+A),Pe=this.height/50;p=new Float64Array(16),o.b8(p,this._fov,this.width/this.height,Pe,ie),p[8]=2*-r.x/this.width,p[9]=2*r.y/this.height,o.a0(p,p,[1,-1,1]),o.$(p,p,[0,0,-this.cameraToCenterDistance]),o.b9(p,p,this._pitch),o.ae(p,p,this.angle),o.$(p,p,[-l,-f,0]),this.mercatorMatrix=o.a0([],p,[this.worldSize,this.worldSize,this.worldSize]),o.a0(p,p,[1,1,this._pixelPerMeter]),this.pixelMatrix=o.a1(new Float64Array(16),this.labelPlaneMatrix,p),o.$(p,p,[0,0,-this.elevation]),this.projMatrix=p,this.invProjMatrix=o.as([],p),this.pixelMatrix3D=o.a1(new Float64Array(16),this.labelPlaneMatrix,p);const $e=this.width%2/2,ye=this.height%2/2,Le=Math.cos(this.angle),qe=Math.sin(this.angle),We=l-Math.round(l)+Le*$e+qe*ye,tt=f-Math.round(f)+Le*ye+qe*$e,ht=new Float64Array(p);if(o.$(ht,ht,[We>.5?We-1:We,tt>.5?tt-1:tt,0]),this.alignedProjMatrix=ht,p=o.as(new Float64Array(16),this.pixelMatrix),!p)throw new Error("failed to invert matrix");this.pixelMatrixInverse=p,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const r=this.pointCoordinate(new o.P(0,0)),l=[r.x*this.worldSize,r.y*this.worldSize,0,1];return o.ag(l,l,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,r))}getCameraQueryGeometry(r){const l=this.getCameraPoint();if(r.length===1)return[r[0],l];{let f=l.x,p=l.y,y=l.x,T=l.y;for(const S of r)f=Math.min(f,S.x),p=Math.min(p,S.y),y=Math.max(y,S.x),T=Math.max(T,S.y);return[new o.P(f,p),new o.P(y,p),new o.P(y,T),new o.P(f,T),new o.P(f,p)]}}}function Wn(g,r){let l,f=!1,p=null,y=null;const T=()=>{p=null,f&&(g.apply(y,l),p=setTimeout(T,r),f=!1)};return(...S)=>(f=!0,y=this,l=S,p||T(),p)}class Ks{constructor(r){this._getCurrentHash=()=>{const l=window.location.hash.replace("#","");if(this._hashName){let f;return l.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(f=p)}),(f&&f[1]||"").split("/")}return l.split("/")},this._onHashChange=()=>{const l=this._getCurrentHash();if(l.length>=3&&!l.some(f=>isNaN(f))){const f=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(l[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:f,pitch:+(l[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const l=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,l)}catch{}},this._updateHash=Wn(this._updateHashUnthrottled,300),this._hashName=r&&encodeURIComponent(r)}addTo(r){return this._map=r,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(r){const l=this._map.getCenter(),f=Math.round(100*this._map.getZoom())/100,p=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,p),T=Math.round(l.lng*y)/y,S=Math.round(l.lat*y)/y,A=this._map.getBearing(),F=this._map.getPitch();let L="";if(L+=r?`/${T}/${S}/${f}`:`${f}/${S}/${T}`,(A||F)&&(L+="/"+Math.round(10*A)/10),F&&(L+=`/${Math.round(F)}`),this._hashName){const R=this._hashName;let q=!1;const oe=window.location.hash.slice(1).split("&").map(se=>{const he=se.split("=")[0];return he===R?(q=!0,`${he}=${L}`):se}).filter(se=>se);return q||oe.push(`${R}=${L}`),`#${oe.join("&")}`}return`#${L}`}}const gs={linearity:.3,easing:o.ba(0,0,.3,1)},Fu=o.e({deceleration:2500,maxSpeed:1400},gs),Pu=o.e({deceleration:20,maxSpeed:1400},gs),Mu=o.e({deceleration:1e3,maxSpeed:360},gs),Du=o.e({deceleration:1e3,maxSpeed:90},gs);class Lu{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.h.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,l=o.h.now();for(;r.length>0&&l-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const l={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)l.zoom+=y.zoomDelta||0,l.bearing+=y.bearingDelta||0,l.pitch+=y.pitchDelta||0,y.panDelta&&l.pan._add(y.panDelta),y.around&&(l.around=y.around),y.pinchAround&&(l.pinchAround=y.pinchAround);const f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(l.pan.mag()){const y=Ys(l.pan.mag(),f,o.e({},Fu,r||{}));p.offset=l.pan.mult(y.amount/l.pan.mag()),p.center=this._map.transform.center,Zi(p,y)}if(l.zoom){const y=Ys(l.zoom,f,Pu);p.zoom=this._map.transform.zoom+y.amount,Zi(p,y)}if(l.bearing){const y=Ys(l.bearing,f,Mu);p.bearing=this._map.transform.bearing+o.ad(y.amount,-179,179),Zi(p,y)}if(l.pitch){const y=Ys(l.pitch,f,Du);p.pitch=this._map.transform.pitch+y.amount,Zi(p,y)}if(p.zoom||p.bearing){const y=l.pinchAround===void 0?l.around:l.pinchAround;p.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),o.e(p,{noMoveStart:!0})}}function Zi(g,r){(!g.duration||g.duration<r.duration)&&(g.duration=r.duration,g.easing=r.easing)}function Ys(g,r,l){const{maxSpeed:f,linearity:p,deceleration:y}=l,T=o.ad(g*p/(r/1e3),-f,f),S=Math.abs(T)/(y*p);return{easing:l.easing,duration:1e3*S,amount:T*(S/2)}}class mi extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,f,p={}){const y=w.mousePos(l.getCanvasContainer(),f),T=l.unproject(y);super(r,o.e({point:y,lngLat:T,originalEvent:f},p)),this._defaultPrevented=!1,this.target=l}}class Js extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,f){const p=r==="touchend"?f.changedTouches:f.touches,y=w.touchPos(l.getCanvasContainer(),p),T=y.map(A=>l.unproject(A)),S=y.reduce((A,F,L,R)=>A.add(F.div(R.length)),new o.P(0,0));super(r,{points:y,point:S,lngLats:T,lngLat:l.unproject(S),originalEvent:f}),this._defaultPrevented=!1}}class Ru extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,f){super(r,{originalEvent:f}),this._defaultPrevented=!1}}class Ou{constructor(r,l){this._map=r,this._clickTolerance=l.clickTolerance}reset(){delete this._mousedownPos}wheel(r){return this._firePreventable(new Ru(r.type,this._map,r))}mousedown(r,l){return this._mousedownPos=l,this._firePreventable(new mi(r.type,this._map,r))}mouseup(r){this._map.fire(new mi(r.type,this._map,r))}click(r,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||this._map.fire(new mi(r.type,this._map,r))}dblclick(r){return this._firePreventable(new mi(r.type,this._map,r))}mouseover(r){this._map.fire(new mi(r.type,this._map,r))}mouseout(r){this._map.fire(new mi(r.type,this._map,r))}touchstart(r){return this._firePreventable(new Js(r.type,this._map,r))}touchmove(r){this._map.fire(new Js(r.type,this._map,r))}touchend(r){this._map.fire(new Js(r.type,this._map,r))}touchcancel(r){this._map.fire(new Js(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Bu{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(r){this._map.fire(new mi(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new mi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._ignoreContextMenu||this._map.fire(new mi(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class un{constructor(r){this._map=r}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(r){return this.transform.pointLocation(o.P.convert(r),this._map.terrain)}}class zu{constructor(r,l){this._map=r,this._tr=new un(r),this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,l){this.isEnabled()&&r.shiftKey&&r.button===0&&(w.disableDrag(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(r,l){if(!this._active)return;const f=l;if(this._lastPos.equals(f)||!this._box&&f.dist(this._startPos)<this._clickTolerance)return;const p=this._startPos;this._lastPos=f,this._box||(this._box=w.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",r));const y=Math.min(p.x,f.x),T=Math.max(p.x,f.x),S=Math.min(p.y,f.y),A=Math.max(p.y,f.y);w.setTransform(this._box,`translate(${y}px,${S}px)`),this._box.style.width=T-y+"px",this._box.style.height=A-S+"px"}mouseupWindow(r,l){if(!this._active||r.button!==0)return;const f=this._startPos,p=l;if(this.reset(),w.suppressClick(),f.x!==p.x||f.y!==p.y)return this._map.fire(new o.k("boxzoomend",{originalEvent:r})),{cameraAnimation:y=>y.fitScreenCoordinates(f,p,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",r)}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(w.remove(this._box),this._box=null),w.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(r,l){return this._map.fire(new o.k(r,{originalEvent:l}))}}function Fi(g,r){if(g.length!==r.length)throw new Error(`The number of touches and points are not equal - touches ${g.length}, points ${r.length}`);const l={};for(let f=0;f<g.length;f++)l[g[f].identifier]=r[f];return l}class hn{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(r,l,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=r.timeStamp),f.length===this.numTouches&&(this.centroid=function(p){const y=new o.P(0,0);for(const T of p)y._add(T);return y.div(p.length)}(l),this.touches=Fi(f,l)))}touchmove(r,l,f){if(this.aborted||!this.centroid)return;const p=Fi(f,l);for(const y in this.touches){const T=p[y];(!T||T.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(r,l,f){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){const p=!this.aborted&&this.centroid;if(this.reset(),p)return p}}}class Ko{constructor(r){this.singleTap=new hn(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(r,l,f){this.singleTap.touchstart(r,l,f)}touchmove(r,l,f){this.singleTap.touchmove(r,l,f)}touchend(r,l,f){const p=this.singleTap.touchend(r,l,f);if(p){const y=r.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(p)<30;if(y&&T||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}}}class fn{constructor(r){this._tr=new un(r),this._zoomIn=new Ko({numTouches:1,numTaps:2}),this._zoomOut=new Ko({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,l,f){this._zoomIn.touchstart(r,l,f),this._zoomOut.touchstart(r,l,f)}touchmove(r,l,f){this._zoomIn.touchmove(r,l,f),this._zoomOut.touchmove(r,l,f)}touchend(r,l,f){const p=this._zoomIn.touchend(r,l,f),y=this._zoomOut.touchend(r,l,f),T=this._tr;return p?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:T.zoom+1,around:T.unproject(p)},{originalEvent:r})}):y?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:T.zoom-1,around:T.unproject(y)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class dn{constructor(r){this._enabled=!!r.enable,this._moveStateManager=r.moveStateManager,this._clickTolerance=r.clickTolerance||1,this._moveFunction=r.move,this._activateOnStart=!!r.activateOnStart,r.assignEvents(this),this.reset()}reset(r){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(r)}_move(...r){const l=this._moveFunction(...r);if(l.bearingDelta||l.pitchDelta||l.around||l.panDelta)return this._active=!0,l}dragStart(r,l){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(r)&&(this._moveStateManager.startMove(r),this._lastPoint=l.length?l[0]:l,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(r,l){if(!this.isEnabled())return;const f=this._lastPoint;if(!f)return;if(r.preventDefault(),!this._moveStateManager.isValidMoveEvent(r))return void this.reset(r);const p=l.length?l[0]:l;return!this._moved&&p.dist(f)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=p,this._move(f,p))}dragEnd(r){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(r)&&(this._moved&&w.suppressClick(),this.reset(r))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const uf={0:1,2:2};class Xl{constructor(r){this._correctEvent=r.checkCorrectEvent}startMove(r){const l=w.mouseButton(r);this._eventButton=l}endMove(r){delete this._eventButton}isValidStartEvent(r){return this._correctEvent(r)}isValidMoveEvent(r){return!function(l,f){const p=uf[f];return l.buttons===void 0||(l.buttons&p)!==p}(r,this._eventButton)}isValidEndEvent(r){return w.mouseButton(r)===this._eventButton}}class Nu{constructor(){this._firstTouch=void 0}_isOneFingerTouch(r){return r.targetTouches.length===1}_isSameTouchEvent(r){return r.targetTouches[0].identifier===this._firstTouch}startMove(r){this._firstTouch=r.targetTouches[0].identifier}endMove(r){delete this._firstTouch}isValidStartEvent(r){return this._isOneFingerTouch(r)}isValidMoveEvent(r){return this._isOneFingerTouch(r)&&this._isSameTouchEvent(r)}isValidEndEvent(r){return this._isOneFingerTouch(r)&&this._isSameTouchEvent(r)}}const Yo=g=>{g.mousedown=g.dragStart,g.mousemoveWindow=g.dragMove,g.mouseup=g.dragEnd,g.contextmenu=function(r){r.preventDefault()}},xs=({enable:g,clickTolerance:r,bearingDegreesPerPixelMoved:l=.8})=>{const f=new Xl({checkCorrectEvent:p=>w.mouseButton(p)===0&&p.ctrlKey||w.mouseButton(p)===2});return new dn({clickTolerance:r,move:(p,y)=>({bearingDelta:(y.x-p.x)*l}),moveStateManager:f,enable:g,assignEvents:Yo})},pn=({enable:g,clickTolerance:r,pitchDegreesPerPixelMoved:l=-.5})=>{const f=new Xl({checkCorrectEvent:p=>w.mouseButton(p)===0&&p.ctrlKey||w.mouseButton(p)===2});return new dn({clickTolerance:r,move:(p,y)=>({pitchDelta:(y.y-p.y)*l}),moveStateManager:f,enable:g,assignEvents:Yo})};class It{constructor(r,l){this._minTouches=r.cooperativeGestures?2:1,this._clickTolerance=r.clickTolerance||1,this._map=l,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(r,l,f){return this._calculateTransform(r,l,f)}touchmove(r,l,f){if(this._map._cooperativeGestures&&(this._minTouches===2&&f.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(r,!1,f.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(f.length<this._minTouches))return r.preventDefault(),this._calculateTransform(r,l,f)}touchend(r,l,f){this._calculateTransform(r,l,f),this._active&&f.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,l,f){f.length>0&&(this._active=!0);const p=Fi(f,l),y=new o.P(0,0),T=new o.P(0,0);let S=0;for(const F in p){const L=p[F],R=this._touches[F];R&&(y._add(L),T._add(L.sub(R)),S++,p[F]=L)}if(this._touches=p,S<this._minTouches||!T.mag())return;const A=T.div(S);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(S),panDelta:A}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Jo{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(r,l,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([l[0],l[1]]))}touchmove(r,l,f){if(!this._firstTwoTouches)return;r.preventDefault();const[p,y]=this._firstTwoTouches,T=Pn(f,l,p),S=Pn(f,l,y);if(!T||!S)return;const A=this._aroundCenter?null:T.add(S).div(2);return this._move([T,S],A,r)}touchend(r,l,f){if(!this._firstTwoTouches)return;const[p,y]=this._firstTwoTouches,T=Pn(f,l,p),S=Pn(f,l,y);T&&S||(this._active&&w.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Pn(g,r,l){for(let f=0;f<g.length;f++)if(g[f].identifier===l)return r[f]}function _s(g,r){return Math.log(g/r)/Math.LN2}class Uu extends Jo{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,l){const f=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(_s(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:_s(this._distance,f),pinchAround:l}}}function Ct(g,r){return 180*g.angleWith(r)/Math.PI}class Kl extends Jo{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,l){const f=this._vector;if(this._vector=r[0].sub(r[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Ct(this._vector,f),pinchAround:l}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const l=25/(Math.PI*this._minDiameter)*360,f=Ct(r,this._startVector);return Math.abs(f)<l}}function Yl(g){return Math.abs(g.y)>Math.abs(g.x)}class hf extends Jo{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(r,l,f){super.touchstart(r,l,f),this._currentTouchCount=f.length}_start(r){this._lastPoints=r,Yl(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,l,f){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const p=r[0].sub(this._lastPoints[0]),y=r[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(p,y,f.timeStamp),this._valid?(this._lastPoints=r,this._active=!0,{pitchDelta:(p.y+y.y)/2*-.5}):void 0}gestureBeginsVertically(r,l,f){if(this._valid!==void 0)return this._valid;const p=r.mag()>=2,y=l.mag()>=2;if(!p&&!y)return;if(!p||!y)return this._firstMove===void 0&&(this._firstMove=f),f-this._firstMove<100&&void 0;const T=r.y>0==l.y>0;return Yl(r)&&Yl(l)&&T}}const Jl={panStep:100,bearingStep:15,pitchStep:10};class Vu{constructor(r){this._tr=new un(r);const l=Jl;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let l=0,f=0,p=0,y=0,T=0;switch(r.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:r.shiftKey?f=-1:(r.preventDefault(),y=-1);break;case 39:r.shiftKey?f=1:(r.preventDefault(),y=1);break;case 38:r.shiftKey?p=1:(r.preventDefault(),T=-1);break;case 40:r.shiftKey?p=-1:(r.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(f=0,p=0),{cameraAnimation:S=>{const A=this._tr;S.easeTo({duration:300,easeId:"keyboardHandler",easing:$u,zoom:l?Math.round(A.zoom)+l*(r.shiftKey?2:1):A.zoom,bearing:A.bearing+f*this._bearingStep,pitch:A.pitch+p*this._pitchStep,offset:[-y*this._panStep,-T*this._panStep],center:A.center},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function $u(g){return g*(2-g)}const ju=4.000244140625;class ff{constructor(r,l){this._onTimeout=f=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(f)},this._map=r,this._tr=new un(r),this._el=r.getCanvasContainer(),this._triggerRenderFrame=l,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&r.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!r[this._map._metaKey])return;r.preventDefault()}let l=r.deltaMode===WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const f=o.h.now(),p=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,l!==0&&l%ju==0?this._type="wheel":l!==0&&Math.abs(l)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=l,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(p*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),r.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=r,this._delta-=l,this._active||this._start(r)),r.preventDefault()}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=w.mousePos(this._el,r),f=this._tr;this._around=o.L.convert(this._aroundCenter?f.center:f.unproject(l)),this._aroundPoint=f.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._tr.transform;if(this._delta!==0){const S=this._type==="wheel"&&Math.abs(this._delta)>ju?this._wheelZoomRate:this._defaultZoomRate;let A=2/(1+Math.exp(-Math.abs(this._delta*S)));this._delta<0&&A!==0&&(A=1/A);const F=typeof this._targetZoom=="number"?r.zoomScale(this._targetZoom):r.scale;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(F*A))),this._type==="wheel"&&(this._startZoom=r.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const l=typeof this._targetZoom=="number"?this._targetZoom:r.zoom,f=this._startZoom,p=this._easing;let y,T=!1;if(this._type==="wheel"&&f&&p){const S=Math.min((o.h.now()-this._lastWheelEventTime)/200,1),A=p(S);y=o.B.number(f,l,A),S<1?this._frameId||(this._frameId=!0):T=!0}else y=l,T=!0;return this._active=!0,T&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!T,zoomDelta:y-r.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let l=o.bb;if(this._prevEase){const f=this._prevEase,p=(o.h.now()-f.start)/f.duration,y=f.easing(p+.01)-f.easing(p),T=.27/Math.sqrt(y*y+1e-4)*.01,S=Math.sqrt(.0729-T*T);l=o.ba(T,S,.25,1)}return this._prevEase={start:o.h.now(),duration:r,easing:l},l}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Ql{constructor(r,l){this._clickZoom=r,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ec{constructor(r){this._tr=new un(r),this.reset()}reset(){this._active=!1}dblclick(r,l){return r.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:this._tr.zoom+(r.shiftKey?-1:1),around:this._tr.unproject(l)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class tc{constructor(){this._tap=new Ko({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(r,l,f){if(!this._swipePoint)if(this._tapTime){const p=l[0],y=r.timeStamp-this._tapTime<500,T=this._tapPoint.dist(p)<30;y&&T?f.length>0&&(this._swipePoint=p,this._swipeTouch=f[0].identifier):this.reset()}else this._tap.touchstart(r,l,f)}touchmove(r,l,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;const p=l[0],y=p.y-this._swipePoint.y;return this._swipePoint=p,r.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(r,l,f)}touchend(r,l,f){if(this._tapTime)this._swipePoint&&f.length===0&&this.reset();else{const p=this._tap.touchend(r,l,f);p&&(this._tapTime=r.timeStamp,this._tapPoint=p)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class rc{constructor(r,l,f){this._el=r,this._mousePan=l,this._touchPan=f}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Qa{constructor(r,l,f){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=l,this._mousePitch=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Mn{constructor(r,l,f,p){this._el=r,this._touchZoom=l,this._touchRotate=f,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Qs=g=>g.zoom||g.drag||g.pitch||g.rotate;class ac extends o.k{}function eo(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta}class ic{constructor(r,l){this.handleWindowEvent=p=>{this.handleEvent(p,`${p.type}Window`)},this.handleEvent=(p,y)=>{if(p.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const T=p.type==="renderFrame"?void 0:p,S={needsRenderFrame:!1},A={},F={},L=p.touches,R=L?this._getMapTouches(L):void 0,q=R?w.touchPos(this._el,R):w.mousePos(this._el,p);for(const{handlerName:he,handler:ie,allowed:Pe}of this._handlers){if(!ie.isEnabled())continue;let $e;this._blockedByActive(F,Pe,he)?ie.reset():ie[y||p.type]&&($e=ie[y||p.type](p,q,R),this.mergeHandlerResult(S,A,$e,he,T),$e&&$e.needsRenderFrame&&this._triggerRenderFrame()),($e||ie.isActive())&&(F[he]=ie)}const oe={};for(const he in this._previousActiveHandlers)F[he]||(oe[he]=T);this._previousActiveHandlers=F,(Object.keys(oe).length||eo(S))&&(this._changes.push([S,A,oe]),this._triggerRenderFrame()),(Object.keys(F).length||eo(S))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:se}=S;se&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],se(this._map))},this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Lu(r),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(l);const f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[window,"blur",void 0]];for(const[p,y,T]of this._listeners)w.addEventListener(p,y,p===document?this.handleWindowEvent:this.handleEvent,T)}destroy(){for(const[r,l,f]of this._listeners)w.removeEventListener(r,l,r===document?this.handleWindowEvent:this.handleEvent,f)}_addDefaultHandlers(r){const l=this._map,f=l.getCanvasContainer();this._add("mapEvent",new Ou(l,r));const p=l.boxZoom=new zu(l,r);this._add("boxZoom",p),r.interactive&&r.boxZoom&&p.enable();const y=new fn(l),T=new ec(l);l.doubleClickZoom=new Ql(T,y),this._add("tapZoom",y),this._add("clickZoom",T),r.interactive&&r.doubleClickZoom&&l.doubleClickZoom.enable();const S=new tc;this._add("tapDragZoom",S);const A=l.touchPitch=new hf(l);this._add("touchPitch",A),r.interactive&&r.touchPitch&&l.touchPitch.enable(r.touchPitch);const F=xs(r),L=pn(r);l.dragRotate=new Qa(r,F,L),this._add("mouseRotate",F,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]),r.interactive&&r.dragRotate&&l.dragRotate.enable();const R=(({enable:Pe,clickTolerance:$e})=>{const ye=new Xl({checkCorrectEvent:Le=>w.mouseButton(Le)===0&&!Le.ctrlKey});return new dn({clickTolerance:$e,move:(Le,qe)=>({around:qe,panDelta:qe.sub(Le)}),activateOnStart:!0,moveStateManager:ye,enable:Pe,assignEvents:Yo})})(r),q=new It(r,l);l.dragPan=new rc(f,R,q),this._add("mousePan",R),this._add("touchPan",q,["touchZoom","touchRotate"]),r.interactive&&r.dragPan&&l.dragPan.enable(r.dragPan);const oe=new Kl,se=new Uu;l.touchZoomRotate=new Mn(f,se,oe,S),this._add("touchRotate",oe,["touchPan","touchZoom"]),this._add("touchZoom",se,["touchPan","touchRotate"]),r.interactive&&r.touchZoomRotate&&l.touchZoomRotate.enable(r.touchZoomRotate);const he=l.scrollZoom=new ff(l,()=>this._triggerRenderFrame());this._add("scrollZoom",he,["mousePan"]),r.interactive&&r.scrollZoom&&l.scrollZoom.enable(r.scrollZoom);const ie=l.keyboard=new Vu(l);this._add("keyboard",ie),r.interactive&&r.keyboard&&l.keyboard.enable(),this._add("blockableMapEvent",new Bu(l))}_add(r,l,f){this._handlers.push({handlerName:r,handler:l,allowed:f}),this._handlersById[r]=l}stop(r){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[]}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Qs(this._eventsInProgress)||this.isZooming()}_blockedByActive(r,l,f){for(const p in r)if(p!==f&&(!l||l.indexOf(p)<0))return!0;return!1}_getMapTouches(r){const l=[];for(const f of r)this._el.contains(f.target)&&l.push(f);return l}mergeHandlerResult(r,l,f,p,y){if(!f)return;o.e(r,f);const T={handlerName:p,originalEvent:f.originalEvent||y};f.zoomDelta!==void 0&&(l.zoom=T),f.panDelta!==void 0&&(l.drag=T),f.pitchDelta!==void 0&&(l.pitch=T),f.bearingDelta!==void 0&&(l.rotate=T)}_applyChanges(){const r={},l={},f={};for(const[p,y,T]of this._changes)p.panDelta&&(r.panDelta=(r.panDelta||new o.P(0,0))._add(p.panDelta)),p.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+p.pitchDelta),p.around!==void 0&&(r.around=p.around),p.pinchAround!==void 0&&(r.pinchAround=p.pinchAround),p.noInertia&&(r.noInertia=p.noInertia),o.e(l,y),o.e(f,T);this._updateMapTransform(r,l,f),this._changes=[]}_updateMapTransform(r,l,f){const p=this._map,y=p._getTransformForUpdate(),T=p.terrain;if(!(eo(r)||T&&this._terrainMovement))return this._fireEvents(l,f,!0);let{panDelta:S,zoomDelta:A,bearingDelta:F,pitchDelta:L,around:R,pinchAround:q}=r;q!==void 0&&(R=q),p._stop(!0),R=R||p.transform.centerPoint;const oe=y.pointLocation(S?R.sub(S):R);F&&(y.bearing+=F),L&&(y.pitch+=L),A&&(y.zoom+=A),T?this._terrainMovement||!l.drag&&!l.zoom?l.drag&&this._terrainMovement?y.center=y.pointLocation(y.centerPoint.sub(S)):y.setLocationAtPoint(oe,R):(this._terrainMovement=!0,this._map._elevationFreeze=!0,y.setLocationAtPoint(oe,R),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,y.recalculateZoom(p.terrain)})):y.setLocationAtPoint(oe,R),p._applyUpdatedTransform(y),this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(l,f,!0)}_fireEvents(r,l,f){const p=Qs(this._eventsInProgress),y=Qs(r),T={};for(const L in r){const{originalEvent:R}=r[L];this._eventsInProgress[L]||(T[`${L}start`]=R),this._eventsInProgress[L]=r[L]}!p&&y&&this._fireEvent("movestart",y.originalEvent);for(const L in T)this._fireEvent(L,T[L]);y&&this._fireEvent("move",y.originalEvent);for(const L in r){const{originalEvent:R}=r[L];this._fireEvent(L,R)}const S={};let A;for(const L in this._eventsInProgress){const{handlerName:R,originalEvent:q}=this._eventsInProgress[L];this._handlersById[R].isActive()||(delete this._eventsInProgress[L],A=l[R]||q,S[`${L}end`]=A)}for(const L in S)this._fireEvent(L,S[L]);const F=Qs(this._eventsInProgress);if(f&&(p||y)&&!F){this._updatingCamera=!0;const L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),R=q=>q!==0&&-this._bearingSnap<q&&q<this._bearingSnap;!L||!L.essential&&o.h.prefersReducedMotion?(this._map.fire(new o.k("moveend",{originalEvent:A})),R(this._map.getBearing())&&this._map.resetNorth()):(R(L.bearing||this._map.getBearing())&&(L.bearing=0),L.freezeElevation=!0,this._map.easeTo(L,{originalEvent:A})),this._updatingCamera=!1}}_fireEvent(r,l){this._map.fire(new o.k(r,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{delete this._frameId,this.handleEvent(new ac("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Gu extends o.E{constructor(r,l){super(),this._renderFrameCallback=()=>{const f=Math.min((o.h.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(f)),f<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=l.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new o.L(this.transform.center.lng,this.transform.center.lat)}setCenter(r,l){return this.jumpTo({center:r},l)}panBy(r,l,f){return r=o.P.convert(r).mult(-1),this.panTo(this.transform.center,o.e({offset:r},l),f)}panTo(r,l,f){return this.easeTo(o.e({center:r},l),f)}getZoom(){return this.transform.zoom}setZoom(r,l){return this.jumpTo({zoom:r},l),this}zoomTo(r,l,f){return this.easeTo(o.e({zoom:r},l),f)}zoomIn(r,l){return this.zoomTo(this.getZoom()+1,r,l),this}zoomOut(r,l){return this.zoomTo(this.getZoom()-1,r,l),this}getBearing(){return this.transform.bearing}setBearing(r,l){return this.jumpTo({bearing:r},l),this}getPadding(){return this.transform.padding}setPadding(r,l){return this.jumpTo({padding:r},l),this}rotateTo(r,l,f){return this.easeTo(o.e({bearing:r},l),f)}resetNorth(r,l){return this.rotateTo(0,o.e({duration:1e3},r),l),this}resetNorthPitch(r,l){return this.easeTo(o.e({bearing:0,pitch:0,duration:1e3},r),l),this}snapToNorth(r,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,l):this}getPitch(){return this.transform.pitch}setPitch(r,l){return this.jumpTo({pitch:r},l),this}cameraForBounds(r,l){r=Ee.convert(r);const f=l&&l.bearing||0;return this._cameraForBoxAndBearing(r.getNorthWest(),r.getSouthEast(),f,l)}_cameraForBoxAndBearing(r,l,f,p){const y={top:0,bottom:0,right:0,left:0};if(typeof(p=o.e({padding:y,offset:[0,0],maxZoom:this.transform.maxZoom},p)).padding=="number"){const qe=p.padding;p.padding={top:qe,bottom:qe,right:qe,left:qe}}p.padding=o.e(y,p.padding);const T=this.transform,S=T.padding,A=T.project(o.L.convert(r)),F=T.project(o.L.convert(l)),L=A.rotate(-f*Math.PI/180),R=F.rotate(-f*Math.PI/180),q=new o.P(Math.max(L.x,R.x),Math.max(L.y,R.y)),oe=new o.P(Math.min(L.x,R.x),Math.min(L.y,R.y)),se=q.sub(oe),he=(T.width-(S.left+S.right+p.padding.left+p.padding.right))/se.x,ie=(T.height-(S.top+S.bottom+p.padding.top+p.padding.bottom))/se.y;if(ie<0||he<0)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Pe=Math.min(T.scaleZoom(T.scale*Math.min(he,ie)),p.maxZoom),$e=o.P.convert(p.offset),ye=new o.P((p.padding.left-p.padding.right)/2,(p.padding.top-p.padding.bottom)/2).rotate(f*Math.PI/180),Le=$e.add(ye).mult(T.scale/T.zoomScale(Pe));return{center:T.unproject(A.add(F).div(2).sub(Le)),zoom:Pe,bearing:f}}fitBounds(r,l,f){return this._fitInternal(this.cameraForBounds(r,l),l,f)}fitScreenCoordinates(r,l,f,p,y){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(o.P.convert(r)),this.transform.pointLocation(o.P.convert(l)),f,p),p,y)}_fitInternal(r,l,f){return r?(delete(l=o.e(r,l)).padding,l.linear?this.easeTo(l,f):this.flyTo(l,f)):this}jumpTo(r,l){this.stop();const f=this._getTransformForUpdate();let p=!1,y=!1,T=!1;return"zoom"in r&&f.zoom!==+r.zoom&&(p=!0,f.zoom=+r.zoom),r.center!==void 0&&(f.center=o.L.convert(r.center)),"bearing"in r&&f.bearing!==+r.bearing&&(y=!0,f.bearing=+r.bearing),"pitch"in r&&f.pitch!==+r.pitch&&(T=!0,f.pitch=+r.pitch),r.padding==null||f.isPaddingEqual(r.padding)||(f.padding=r.padding),this._applyUpdatedTransform(f),this.fire(new o.k("movestart",l)).fire(new o.k("move",l)),p&&this.fire(new o.k("zoomstart",l)).fire(new o.k("zoom",l)).fire(new o.k("zoomend",l)),y&&this.fire(new o.k("rotatestart",l)).fire(new o.k("rotate",l)).fire(new o.k("rotateend",l)),T&&this.fire(new o.k("pitchstart",l)).fire(new o.k("pitch",l)).fire(new o.k("pitchend",l)),this.fire(new o.k("moveend",l))}calculateCameraOptionsFromTo(r,l,f,p=0){const y=o.U.fromLngLat(r,l),T=o.U.fromLngLat(f,p),S=T.x-y.x,A=T.y-y.y,F=T.z-y.z,L=Math.hypot(S,A,F);if(L===0)throw new Error("Can't calculate camera options with same From and To");const R=Math.hypot(S,A),q=this.transform.scaleZoom(this.transform.cameraToCenterDistance/L/this.transform.tileSize),oe=180*Math.atan2(S,-A)/Math.PI;let se=180*Math.acos(R/L)/Math.PI;return se=F<0?90-se:90+se,{center:T.toLngLat(),zoom:q,pitch:se,bearing:oe}}easeTo(r,l){this._stop(!1,r.easeId),((r=o.e({offset:[0,0],duration:500,easing:o.bb},r)).animate===!1||!r.essential&&o.h.prefersReducedMotion)&&(r.duration=0);const f=this._getTransformForUpdate(),p=this.getZoom(),y=this.getBearing(),T=this.getPitch(),S=this.getPadding(),A="zoom"in r?+r.zoom:p,F="bearing"in r?this._normalizeBearing(r.bearing,y):y,L="pitch"in r?+r.pitch:T,R="padding"in r?r.padding:f.padding,q=o.P.convert(r.offset);let oe=f.centerPoint.add(q);const se=f.pointLocation(oe),he=o.L.convert(r.center||se);this._normalizeCenter(he);const ie=f.project(se),Pe=f.project(he).sub(ie),$e=f.zoomScale(A-p);let ye,Le;r.around&&(ye=o.L.convert(r.around),Le=f.locationPoint(ye));const qe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||A!==p,this._rotating=this._rotating||y!==F,this._pitching=this._pitching||L!==T,this._padding=!f.isPaddingEqual(R),this._easeId=r.easeId,this._prepareEase(l,r.noMoveStart,qe),this.terrain&&this._prepareElevation(he),this._ease(We=>{if(this._zooming&&(f.zoom=o.B.number(p,A,We)),this._rotating&&(f.bearing=o.B.number(y,F,We)),this._pitching&&(f.pitch=o.B.number(T,L,We)),this._padding&&(f.interpolatePadding(S,R,We),oe=f.centerPoint.add(q)),this.terrain&&!r.freezeElevation&&this._updateElevation(We),ye)f.setLocationAtPoint(ye,Le);else{const tt=f.zoomScale(f.zoom-p),ht=A>p?Math.min(2,$e):Math.max(.5,$e),ot=Math.pow(ht,1-We),xt=f.unproject(ie.add(Pe.mult(We*ot)).mult(tt));f.setLocationAtPoint(f.renderWorldCopies?xt.wrap():xt,oe)}this._applyUpdatedTransform(f),this._fireMoveEvents(l)},We=>{this.terrain&&this._finalizeElevation(),this._afterEase(l,We)},r),this}_prepareEase(r,l,f={}){this._moving=!0,l||f.moving||this.fire(new o.k("movestart",r)),this._zooming&&!f.zooming&&this.fire(new o.k("zoomstart",r)),this._rotating&&!f.rotating&&this.fire(new o.k("rotatestart",r)),this._pitching&&!f.pitching&&this.fire(new o.k("pitchstart",r))}_prepareElevation(r){this._elevationCenter=r,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(r,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(r){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const l=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(r<1&&l!==this._elevationTarget){const f=this._elevationTarget-this._elevationStart;this._elevationStart+=r*(f-(l-(f*r+this._elevationStart))/(1-r)),this._elevationTarget=l}this.transform.elevation=o.B.number(this._elevationStart,this._elevationTarget,r)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(r){if(!this.transformCameraUpdate)return;const l=r.clone(),{center:f,zoom:p,pitch:y,bearing:T,elevation:S}=this.transformCameraUpdate(l);f&&(l.center=f),p!==void 0&&(l.zoom=p),y!==void 0&&(l.pitch=y),T!==void 0&&(l.bearing=T),S!==void 0&&(l.elevation=S),this.transform.apply(l)}_fireMoveEvents(r){this.fire(new o.k("move",r)),this._zooming&&this.fire(new o.k("zoom",r)),this._rotating&&this.fire(new o.k("rotate",r)),this._pitching&&this.fire(new o.k("pitch",r))}_afterEase(r,l){if(this._easeId&&l&&this._easeId===l)return;delete this._easeId;const f=this._zooming,p=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,f&&this.fire(new o.k("zoomend",r)),p&&this.fire(new o.k("rotateend",r)),y&&this.fire(new o.k("pitchend",r)),this.fire(new o.k("moveend",r))}flyTo(r,l){if(!r.essential&&o.h.prefersReducedMotion){const Ot=o.F(r,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ot,l)}this.stop(),r=o.e({offset:[0,0],speed:1.2,curve:1.42,easing:o.bb},r);const f=this._getTransformForUpdate(),p=this.getZoom(),y=this.getBearing(),T=this.getPitch(),S=this.getPadding(),A="zoom"in r?o.ad(+r.zoom,f.minZoom,f.maxZoom):p,F="bearing"in r?this._normalizeBearing(r.bearing,y):y,L="pitch"in r?+r.pitch:T,R="padding"in r?r.padding:f.padding,q=f.zoomScale(A-p),oe=o.P.convert(r.offset);let se=f.centerPoint.add(oe);const he=f.pointLocation(se),ie=o.L.convert(r.center||he);this._normalizeCenter(ie);const Pe=f.project(he),$e=f.project(ie).sub(Pe);let ye=r.curve;const Le=Math.max(f.width,f.height),qe=Le/q,We=$e.mag();if("minZoom"in r){const Ot=o.ad(Math.min(r.minZoom,p,A),f.minZoom,f.maxZoom),Ar=Le/f.zoomScale(Ot-p);ye=Math.sqrt(Ar/We*2)}const tt=ye*ye;function ht(Ot){const Ar=(qe*qe-Le*Le+(Ot?-1:1)*tt*tt*We*We)/(2*(Ot?qe:Le)*tt*We);return Math.log(Math.sqrt(Ar*Ar+1)-Ar)}function ot(Ot){return(Math.exp(Ot)-Math.exp(-Ot))/2}function xt(Ot){return(Math.exp(Ot)+Math.exp(-Ot))/2}const Lt=ht(!1);let ur=function(Ot){return xt(Lt)/xt(Lt+ye*Ot)},Tt=function(Ot){return Le*((xt(Lt)*(ot(Ar=Lt+ye*Ot)/xt(Ar))-ot(Lt))/tt)/We;var Ar},Ht=(ht(!0)-Lt)/ye;if(Math.abs(We)<1e-6||!isFinite(Ht)){if(Math.abs(Le-qe)<1e-6)return this.easeTo(r,l);const Ot=qe<Le?-1:1;Ht=Math.abs(Math.log(qe/Le))/ye,Tt=function(){return 0},ur=function(Ar){return Math.exp(Ot*ye*Ar)}}return r.duration="duration"in r?+r.duration:1e3*Ht/("screenSpeed"in r?+r.screenSpeed/ye:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0),this._zooming=!0,this._rotating=y!==F,this._pitching=L!==T,this._padding=!f.isPaddingEqual(R),this._prepareEase(l,!1),this.terrain&&this._prepareElevation(ie),this._ease(Ot=>{const Ar=Ot*Ht,cr=1/ur(Ar);f.zoom=Ot===1?A:p+f.scaleZoom(cr),this._rotating&&(f.bearing=o.B.number(y,F,Ot)),this._pitching&&(f.pitch=o.B.number(T,L,Ot)),this._padding&&(f.interpolatePadding(S,R,Ot),se=f.centerPoint.add(oe)),this.terrain&&!r.freezeElevation&&this._updateElevation(Ot);const ir=Ot===1?ie:f.unproject(Pe.add($e.mult(Tt(Ar))).mult(cr));f.setLocationAtPoint(f.renderWorldCopies?ir.wrap():ir,se),this._applyUpdatedTransform(f),this._fireMoveEvents(l)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(l)},r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const f=this._onEaseEnd;delete this._onEaseEnd,f.call(this,l)}if(!r){const f=this.handlers;f&&f.stop(!1)}return this}_ease(r,l,f){f.animate===!1||f.duration===0?(r(1),l()):(this._easeStart=o.h.now(),this._easeOptions=f,this._onEaseFrame=r,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(r,l){r=o.b5(r,-180,180);const f=Math.abs(r-l);return Math.abs(r-360-l)<f&&(r-=360),Math.abs(r+360-l)<f&&(r+=360),r}_normalizeCenter(r){const l=this.transform;if(!l.renderWorldCopies||l.lngRange)return;const f=r.lng-l.center.lng;r.lng+=f>180?-360:f<-180?360:0}queryTerrainElevation(r){return this.terrain?this.terrain.getElevationForLngLatZoom(o.L.convert(r),this.transform.tileZoom)-this.transform.elevation:null}}class gi{constructor(r={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=l=>{!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"&&l.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=r}getDefaultPosition(){return"bottom-right"}onAdd(r){return this._map=r,this._compact=this.options&&this.options.compact,this._container=w.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=w.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=w.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){w.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(r,l){const f=this._map._getUIString(`AttributionControl.${l}`);r.title=f,r.setAttribute("aria-label",f)}_updateAttributions(){if(!this._map.style)return;let r=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=r.concat(this.options.customAttribution.map(p=>typeof p!="string"?"":p)):typeof this.options.customAttribution=="string"&&r.push(this.options.customAttribution)),this._map.style.stylesheet){const p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}const l=this._map.style.sourceCaches;for(const p in l){const y=l[p];if(y.used||y.usedForTerrain){const T=y.getSource();T.attribution&&r.indexOf(T.attribution)<0&&r.push(T.attribution)}}r=r.filter(p=>String(p).trim()),r.sort((p,y)=>p.length-y.length),r=r.filter((p,y)=>{for(let T=y+1;T<r.length;T++)if(r[T].indexOf(p)>=0)return!1;return!0});const f=r.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,r.length?(this._innerContainer.innerHTML=f,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Dr{constructor(r={}){this._updateCompact=()=>{const l=this._container.children;if(l.length){const f=l[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&f.classList.add("maplibregl-compact"):f.classList.remove("maplibregl-compact")}},this.options=r}getDefaultPosition(){return"bottom-left"}onAdd(r){this._map=r,this._compact=this.options&&this.options.compact,this._container=w.create("div","maplibregl-ctrl");const l=w.create("a","maplibregl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://maplibre.org/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){w.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Qo{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const l=++this._id;return this._queue.push({callback:r,id:l,cancelled:!1}),l}remove(r){const l=this._currentlyRunning,f=l?this._queue.concat(l):this._queue;for(const p of f)if(p.id===r)return void(p.cancelled=!0)}run(r=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const l=this._currentlyRunning=this._queue;this._queue=[];for(const f of l)if(!f.cancelled&&(f.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const nc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var Hu=o.Q([{name:"a_pos3d",type:"Int16",components:3}]);class qu extends o.E{constructor(r){super(),this.sourceCache=r,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,r.usedForTerrain=!0,r.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(r,l){this.sourceCache.update(r,l),this._renderableTilesKeys=[];const f={};for(const p of r.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:l}))f[p.key]=!0,this._renderableTilesKeys.push(p.key),this._tiles[p.key]||(p.posMatrix=new Float64Array(16),o.aS(p.posMatrix,0,o.N,0,o.N,0,1),this._tiles[p.key]=new gr(p,this.tileSize));for(const p in this._tiles)f[p]||delete this._tiles[p]}freeRtt(r){for(const l in this._tiles){const f=this._tiles[l];(!r||f.tileID.equals(r)||f.tileID.isChildOf(r)||r.isChildOf(f.tileID))&&(f.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(r=>this.getTileByID(r))}getTileByID(r){return this._tiles[r]}getTerrainCoords(r){const l={};for(const f of this._renderableTilesKeys){const p=this._tiles[f].tileID;if(p.canonical.equals(r.canonical)){const y=r.clone();y.posMatrix=new Float64Array(16),o.aS(y.posMatrix,0,o.N,0,o.N,0,1),l[f]=y}else if(p.canonical.isChildOf(r.canonical)){const y=r.clone();y.posMatrix=new Float64Array(16);const T=p.canonical.z-r.canonical.z,S=p.canonical.x-(p.canonical.x>>T<<T),A=p.canonical.y-(p.canonical.y>>T<<T),F=o.N>>T;o.aS(y.posMatrix,0,F,0,F,0,1),o.$(y.posMatrix,y.posMatrix,[-S*F,-A*F,0]),l[f]=y}else if(r.canonical.isChildOf(p.canonical)){const y=r.clone();y.posMatrix=new Float64Array(16);const T=r.canonical.z-p.canonical.z,S=r.canonical.x-(r.canonical.x>>T<<T),A=r.canonical.y-(r.canonical.y>>T<<T),F=o.N>>T;o.aS(y.posMatrix,0,o.N,0,o.N,0,1),o.$(y.posMatrix,y.posMatrix,[S*F,A*F,0]),o.a0(y.posMatrix,y.posMatrix,[1/2**T,1/2**T,0]),l[f]=y}}return l}getSourceTile(r,l){const f=this.sourceCache._source;let p=r.overscaledZ-this.deltaZoom;if(p>f.maxzoom&&(p=f.maxzoom),p<f.minzoom)return null;this._sourceTileCache[r.key]||(this._sourceTileCache[r.key]=r.scaledTo(p).key);let y=this.sourceCache.getTileByID(this._sourceTileCache[r.key]);if((!y||!y.dem)&&l)for(;p>=f.minzoom&&(!y||!y.dem);)y=this.sourceCache.getTileByID(r.scaledTo(p--).key);return y}tilesAfterTime(r=Date.now()){return Object.values(this._tiles).filter(l=>l.timeAdded>=r)}}class Wu{constructor(r,l,f){this.painter=r,this.sourceCache=new qu(l),this.options=f,this.exaggeration=typeof f.exaggeration=="number"?f.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(r,l,f,p=o.N){var y;if(!(l>=0&&l<p&&f>=0&&f<p))return 0;const T=this.getTerrainData(r),S=(y=T.tile)===null||y===void 0?void 0:y.dem;if(!S)return 0;const A=function(se,he,ie){var Pe=he[0],$e=he[1];return se[0]=ie[0]*Pe+ie[4]*$e+ie[12],se[1]=ie[1]*Pe+ie[5]*$e+ie[13],se}([],[l/p*o.N,f/p*o.N],T.u_terrain_matrix),F=[A[0]*S.dim,A[1]*S.dim],L=Math.floor(F[0]),R=Math.floor(F[1]),q=F[0]-L,oe=F[1]-R;return S.get(L,R)*(1-q)*(1-oe)+S.get(L+1,R)*q*(1-oe)+S.get(L,R+1)*(1-q)*oe+S.get(L+1,R+1)*q*oe}getElevationForLngLatZoom(r,l){const{tileID:f,mercatorX:p,mercatorY:y}=this._getOverscaledTileIDFromLngLatZoom(r,l);return this.getElevation(f,p%o.N,y%o.N,o.N)}getElevation(r,l,f,p=o.N){return this.getDEMElevation(r,l,f,p)*this.exaggeration}getTerrainData(r){if(!this._emptyDemTexture){const p=this.painter.context,y=new o.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Fe(p,y,p.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Fe(p,new o.R({width:1,height:1}),p.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.ao([])}const l=this.sourceCache.getSourceTile(r,!0);if(l&&l.dem&&(!l.demTexture||l.needsTerrainPrepare)){const p=this.painter.context;l.demTexture=this.painter.getTileTexture(l.dem.stride),l.demTexture?l.demTexture.update(l.dem.getPixels(),{premultiply:!1}):l.demTexture=new Fe(p,l.dem.getPixels(),p.gl.RGBA,{premultiply:!1}),l.demTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),l.needsTerrainPrepare=!1}const f=l&&l+l.tileID.key+r.key;if(f&&!this._demMatrixCache[f]){const p=this.sourceCache.sourceCache._source.maxzoom;let y=r.canonical.z-l.tileID.canonical.z;r.overscaledZ>r.canonical.z&&(r.canonical.z>=p?y=r.canonical.z-p:o.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const T=r.canonical.x-(r.canonical.x>>y<<y),S=r.canonical.y-(r.canonical.y>>y<<y),A=o.bc(new Float64Array(16),[1/(o.N<<y),1/(o.N<<y),0]);o.$(A,A,[T*o.N,S*o.N,0]),this._demMatrixCache[r.key]={matrix:A,coord:r}}return{u_depth:2,u_terrain:3,u_terrain_dim:l&&l.dem&&l.dem.dim||1,u_terrain_matrix:f?this._demMatrixCache[r.key].matrix:this._emptyDemMatrix,u_terrain_unpack:l&&l.dem&&l.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(l&&l.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:l}}getFramebuffer(r){const l=this.painter,f=l.width/devicePixelRatio,p=l.height/devicePixelRatio;return!this._fbo||this._fbo.width===f&&this._fbo.height===p||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Fe(l.context,{width:f,height:p,data:null},l.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(l.context.gl.NEAREST,l.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Fe(l.context,{width:f,height:p,data:null},l.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(l.context.gl.NEAREST,l.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=l.context.createFramebuffer(f,p,!0,!1),this._fbo.depthAttachment.set(l.context.createRenderbuffer(l.context.gl.DEPTH_COMPONENT16,f,p))),this._fbo.colorAttachment.set(r==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const r=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const l=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let y=0,T=0;y<this._coordsTextureSize;y++)for(let S=0;S<this._coordsTextureSize;S++,T+=4)l[T+0]=255&S,l[T+1]=255&y,l[T+2]=S>>8<<4|y>>8,l[T+3]=0;const f=new o.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(l.buffer)),p=new Fe(r,f,r.gl.RGBA,{premultiply:!1});return p.bind(r.gl.NEAREST,r.gl.CLAMP_TO_EDGE),this._coordsTexture=p,p}pointCoordinate(r){const l=new Uint8Array(4),f=this.painter.context,p=f.gl;f.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),p.readPixels(r.x,this.painter.height/devicePixelRatio-r.y-1,1,1,p.RGBA,p.UNSIGNED_BYTE,l),f.bindFramebuffer.set(null);const y=l[0]+(l[2]>>4<<8),T=l[1]+((15&l[2])<<8),S=this.coordsIndex[255-l[3]],A=S&&this.sourceCache.getTileByID(S);if(!A)return null;const F=this._coordsTextureSize,L=(1<<A.tileID.canonical.z)*F;return new o.U(this._allowMercatorOverflow(r,(A.tileID.canonical.x*F+y)/L),(A.tileID.canonical.y*F+T)/L,this.getElevation(A.tileID,y,T,F))}getTerrainMesh(){if(this._mesh)return this._mesh;const r=this.painter.context,l=new o.bd,f=new o.b0,p=this.meshSize,y=o.N/p,T=p*p;for(let R=0;R<=p;R++)for(let q=0;q<=p;q++)l.emplaceBack(q*y,R*y,0);for(let R=0;R<T;R+=p+1)for(let q=0;q<p;q++)f.emplaceBack(q+R,p+q+R+1,p+q+R+2),f.emplaceBack(q+R,p+q+R+2,q+R+1);const S=l.length,A=S+2*(p+1);for(const R of[0,1])for(let q=0;q<=p;q++)for(const oe of[0,1])l.emplaceBack(q*y,R*o.N,oe);for(let R=0;R<2*p;R+=2)f.emplaceBack(A+R,A+R+1,A+R+3),f.emplaceBack(A+R,A+R+3,A+R+2),f.emplaceBack(S+R,S+R+3,S+R+1),f.emplaceBack(S+R,S+R+2,S+R+3);const F=l.length,L=F+2*(p+1);for(const R of[0,1])for(let q=0;q<=p;q++)for(const oe of[0,1])l.emplaceBack(R*o.N,q*y,oe);for(let R=0;R<2*p;R+=2)f.emplaceBack(F+R,F+R+1,F+R+3),f.emplaceBack(F+R,F+R+3,F+R+2),f.emplaceBack(L+R,L+R+3,L+R+1),f.emplaceBack(L+R,L+R+2,L+R+3);return this._mesh={indexBuffer:r.createIndexBuffer(f),vertexBuffer:r.createVertexBuffer(l,Hu.members),segments:o.S.simpleSegment(0,0,l.length,f.length)},this._mesh}getMeshFrameDelta(r){return 2*Math.PI*o.be/Math.pow(2,r)/5}getMinTileElevationForLngLatZoom(r,l){var f;const{tileID:p}=this._getOverscaledTileIDFromLngLatZoom(r,l);return(f=this.getMinMaxElevation(p).minElevation)!==null&&f!==void 0?f:0}getMinMaxElevation(r){const l=this.getTerrainData(r).tile,f={minElevation:null,maxElevation:null};return l&&l.dem&&(f.minElevation=l.dem.min*this.exaggeration,f.maxElevation=l.dem.max*this.exaggeration),f}_getOverscaledTileIDFromLngLatZoom(r,l){const f=o.U.fromLngLat(r.wrap()),p=(1<<l)*o.N,y=f.x*p,T=f.y*p,S=Math.floor(y/o.N),A=Math.floor(T/o.N);return{tileID:new o.O(l,0,l,S,A),mercatorX:y,mercatorY:T}}_allowMercatorOverflow(r,l){const f=r.x<this.painter.width/2;let p=o.bf(l);const y=this.painter.transform.center.lng;return f&&Math.sign(p)>0&&Math.sign(y)<0||!f&&Math.sign(p)<0&&Math.sign(y)>0?(p=360*Math.sign(y)+p,o.G(p)):l}}class df{constructor(r,l,f){this._context=r,this._size=l,this._tileSize=f,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const r of this._objects)r.texture.destroy(),r.fbo.destroy()}_createObject(r){const l=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),f=new Fe(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return f.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),l.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),l.colorAttachment.set(f.texture),{id:r,fbo:l,texture:f,stamp:-1,inUse:!1}}getObjectForId(r){return this._objects[r]}useObject(r){r.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(l=>r.id!==l),this._recentlyUsed.push(r.id)}stampObject(r){r.stamp=++this._stamp}getOrCreateFreeObject(){for(const l of this._recentlyUsed)if(!this._objects[l].inUse)return this._objects[l];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const r=this._createObject(this._objects.length);return this._objects.push(r),r}freeObject(r){r.inUse=!1}freeAllObjects(){for(const r of this._objects)this.freeObject(r)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(r=>!r.inUse)===!1}}const Va={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class el{constructor(r,l){this.painter=r,this.terrain=l,this.pool=new df(r.context,30,l.sourceCache.tileSize*l.qualityFactor)}destruct(){this.pool.destruct()}getTexture(r){return this.pool.getObjectForId(r.rtt[this._stacks.length-1].id).texture}prepareForRender(r,l){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=r._order.filter(f=>!r._layers[f].isHidden(l)),this._coordsDescendingInv={};for(const f in r.sourceCaches){this._coordsDescendingInv[f]={};const p=r.sourceCaches[f].getVisibleCoordinates();for(const y of p){const T=this.terrain.sourceCache.getTerrainCoords(y);for(const S in T)this._coordsDescendingInv[f][S]||(this._coordsDescendingInv[f][S]=[]),this._coordsDescendingInv[f][S].push(T[S])}}this._coordsDescendingInvStr={};for(const f of r._order){const p=r._layers[f],y=p.source;if(Va[p.type]&&!this._coordsDescendingInvStr[y]){this._coordsDescendingInvStr[y]={};for(const T in this._coordsDescendingInv[y])this._coordsDescendingInvStr[y][T]=this._coordsDescendingInv[y][T].map(S=>S.key).sort().join()}}for(const f of this._renderableTiles)for(const p in this._coordsDescendingInvStr){const y=this._coordsDescendingInvStr[p][f.tileID.key];y&&y!==f.rttCoords[p]&&(f.rtt=[])}}renderLayer(r){if(r.isHidden(this.painter.transform.zoom))return!1;const l=r.type,f=this.painter,p=this._renderableLayerIds[this._renderableLayerIds.length-1]===r.id;if(Va[l]&&(this._prevType&&Va[this._prevType]||this._stacks.push([]),this._prevType=l,this._stacks[this._stacks.length-1].push(r.id),!p))return!0;if(Va[this._prevType]||Va[l]&&p){this._prevType=l;const y=this._stacks.length-1,T=this._stacks[y]||[];for(const S of this._renderableTiles){if(this.pool.isFull()&&(Kr(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(S),S.rtt[y]){const F=this.pool.getObjectForId(S.rtt[y].id);if(F.stamp===S.rtt[y].stamp){this.pool.useObject(F);continue}}const A=this.pool.getOrCreateFreeObject();this.pool.useObject(A),this.pool.stampObject(A),S.rtt[y]={id:A.id,stamp:A.stamp},f.context.bindFramebuffer.set(A.fbo.framebuffer),f.context.clear({color:o.aT.transparent,stencil:0}),f.currentStencilSource=void 0;for(let F=0;F<T.length;F++){const L=f.style._layers[T[F]],R=L.source?this._coordsDescendingInv[L.source][S.tileID.key]:[S.tileID];f.context.viewport.set([0,0,A.fbo.width,A.fbo.height]),f._renderTileClippingMasks(L,R),f.renderLayer(f,f.style.sourceCaches[L.source],L,R),L.source&&(S.rttCoords[L.source]=this._coordsDescendingInvStr[L.source][S.tileID.key])}}return Kr(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Va[l]}return!1}}const zt=E,Gt={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:o.c.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},to=g=>{g.touchstart=g.dragStart,g.touchmoveWindow=g.dragMove,g.touchend=g.dragEnd},sc={showCompass:!0,showZoom:!0,visualizePitch:!1};class oc{constructor(r,l,f=!1){this.mousedown=T=>{this.startMouse(o.e({},T,{ctrlKey:!0,preventDefault:()=>T.preventDefault()}),w.mousePos(this.element,T)),w.addEventListener(window,"mousemove",this.mousemove),w.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=T=>{this.moveMouse(T,w.mousePos(this.element,T))},this.mouseup=T=>{this.mouseRotate.dragEnd(T),this.mousePitch&&this.mousePitch.dragEnd(T),this.offTemp()},this.touchstart=T=>{T.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=w.touchPos(this.element,T.targetTouches)[0],this.startTouch(T,this._startPos),w.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),w.addEventListener(window,"touchend",this.touchend))},this.touchmove=T=>{T.targetTouches.length!==1?this.reset():(this._lastPos=w.touchPos(this.element,T.targetTouches)[0],this.moveTouch(T,this._lastPos))},this.touchend=T=>{T.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const p=r.dragRotate._mouseRotate.getClickTolerance(),y=r.dragRotate._mousePitch.getClickTolerance();this.element=l,this.mouseRotate=xs({clickTolerance:p,enable:!0}),this.touchRotate=(({enable:T,clickTolerance:S,bearingDegreesPerPixelMoved:A=.8})=>{const F=new Nu;return new dn({clickTolerance:S,move:(L,R)=>({bearingDelta:(R.x-L.x)*A}),moveStateManager:F,enable:T,assignEvents:to})})({clickTolerance:p,enable:!0}),this.map=r,f&&(this.mousePitch=pn({clickTolerance:y,enable:!0}),this.touchPitch=(({enable:T,clickTolerance:S,pitchDegreesPerPixelMoved:A=-.5})=>{const F=new Nu;return new dn({clickTolerance:S,move:(L,R)=>({pitchDelta:(R.y-L.y)*A}),moveStateManager:F,enable:T,assignEvents:to})})({clickTolerance:y,enable:!0})),w.addEventListener(l,"mousedown",this.mousedown),w.addEventListener(l,"touchstart",this.touchstart,{passive:!1}),w.addEventListener(l,"touchcancel",this.reset)}startMouse(r,l){this.mouseRotate.dragStart(r,l),this.mousePitch&&this.mousePitch.dragStart(r,l),w.disableDrag()}startTouch(r,l){this.touchRotate.dragStart(r,l),this.touchPitch&&this.touchPitch.dragStart(r,l),w.disableDrag()}moveMouse(r,l){const f=this.map,{bearingDelta:p}=this.mouseRotate.dragMove(r,l)||{};if(p&&f.setBearing(f.getBearing()+p),this.mousePitch){const{pitchDelta:y}=this.mousePitch.dragMove(r,l)||{};y&&f.setPitch(f.getPitch()+y)}}moveTouch(r,l){const f=this.map,{bearingDelta:p}=this.touchRotate.dragMove(r,l)||{};if(p&&f.setBearing(f.getBearing()+p),this.touchPitch){const{pitchDelta:y}=this.touchPitch.dragMove(r,l)||{};y&&f.setPitch(f.getPitch()+y)}}off(){const r=this.element;w.removeEventListener(r,"mousedown",this.mousedown),w.removeEventListener(r,"touchstart",this.touchstart,{passive:!1}),w.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),w.removeEventListener(window,"touchend",this.touchend),w.removeEventListener(r,"touchcancel",this.reset),this.offTemp()}offTemp(){w.enableDrag(),w.removeEventListener(window,"mousemove",this.mousemove),w.removeEventListener(window,"mouseup",this.mouseup),w.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),w.removeEventListener(window,"touchend",this.touchend)}}let sa;function lc(g,r,l){if(g=new o.L(g.lng,g.lat),r){const f=new o.L(g.lng-360,g.lat),p=new o.L(g.lng+360,g.lat),y=l.locationPoint(g).distSqr(r);l.locationPoint(f).distSqr(r)<y?g=f:l.locationPoint(p).distSqr(r)<y&&(g=p)}for(;Math.abs(g.lng-l.center.lng)>180;){const f=l.locationPoint(g);if(f.x>=0&&f.y>=0&&f.x<=l.width&&f.y<=l.height)break;g.lng>l.center.lng?g.lng-=360:g.lng+=360}return g}const Pi={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Zu(g,r,l){const f=g.classList;for(const p in Pi)f.remove(`maplibregl-${l}-anchor-${p}`);f.add(`maplibregl-${l}-anchor-${r}`)}class Zn extends o.E{constructor(r){if(super(),this._onKeyPress=l=>{const f=l.code,p=l.charCode||l.keyCode;f!=="Space"&&f!=="Enter"&&p!==32&&p!==13||this.togglePopup()},this._onMapClick=l=>{const f=l.originalEvent.target,p=this._element;this._popup&&(f===p||p.contains(f))&&this.togglePopup()},this._update=l=>{if(!this._map)return;const f=this._map.loaded()&&!this._map.isMoving();(l?.type==="terrain"||l?.type==="render"&&!f)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=lc(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let p="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?p=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(p=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let y="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?y="rotateX(0deg)":this._pitchAlignment==="map"&&(y=`rotateX(${this._map.getPitch()}deg)`),l&&l.type!=="moveend"||(this._pos=this._pos.round()),w.setTransform(this._element,`${Pi[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${y} ${p}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const T=this._map.unproject(this._pos),S=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=T.distanceTo(this._lngLat)>20*S?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=l=>{if(!this._isDragging){const f=this._clickTolerance||this._map._clickTolerance;this._isDragging=l.point.dist(this._pointerdownPos)>=f}this._isDragging&&(this._pos=l.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.k("dragstart"))),this.fire(new o.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.k("dragend")),this._state="inactive"},this._addDragHandler=l=>{this._element.contains(l.originalEvent.target)&&(l.preventDefault(),this._positionDelta=l.point.sub(this._pos).add(this._offset),this._pointerdownPos=l.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment!=="auto"?r.pitchAlignment:this._rotationAlignment,r&&r.element)this._element=r.element,this._offset=o.P.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=w.create("div"),this._element.setAttribute("aria-label","Map marker");const l=w.createNS("http://www.w3.org/2000/svg","svg"),f=41,p=27;l.setAttributeNS(null,"display","block"),l.setAttributeNS(null,"height",`${f}px`),l.setAttributeNS(null,"width",`${p}px`),l.setAttributeNS(null,"viewBox",`0 0 ${p} ${f}`);const y=w.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"stroke","none"),y.setAttributeNS(null,"stroke-width","1"),y.setAttributeNS(null,"fill","none"),y.setAttributeNS(null,"fill-rule","evenodd");const T=w.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"fill-rule","nonzero");const S=w.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"transform","translate(3.0, 29.0)"),S.setAttributeNS(null,"fill","#000000");const A=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Pe of A){const $e=w.createNS("http://www.w3.org/2000/svg","ellipse");$e.setAttributeNS(null,"opacity","0.04"),$e.setAttributeNS(null,"cx","10.5"),$e.setAttributeNS(null,"cy","5.80029008"),$e.setAttributeNS(null,"rx",Pe.rx),$e.setAttributeNS(null,"ry",Pe.ry),S.appendChild($e)}const F=w.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"fill",this._color);const L=w.createNS("http://www.w3.org/2000/svg","path");L.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),F.appendChild(L);const R=w.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"opacity","0.25"),R.setAttributeNS(null,"fill","#000000");const q=w.createNS("http://www.w3.org/2000/svg","path");q.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),R.appendChild(q);const oe=w.createNS("http://www.w3.org/2000/svg","g");oe.setAttributeNS(null,"transform","translate(6.0, 7.0)"),oe.setAttributeNS(null,"fill","#FFFFFF");const se=w.createNS("http://www.w3.org/2000/svg","g");se.setAttributeNS(null,"transform","translate(8.0, 8.0)");const he=w.createNS("http://www.w3.org/2000/svg","circle");he.setAttributeNS(null,"fill","#000000"),he.setAttributeNS(null,"opacity","0.25"),he.setAttributeNS(null,"cx","5.5"),he.setAttributeNS(null,"cy","5.5"),he.setAttributeNS(null,"r","5.4999962");const ie=w.createNS("http://www.w3.org/2000/svg","circle");ie.setAttributeNS(null,"fill","#FFFFFF"),ie.setAttributeNS(null,"cx","5.5"),ie.setAttributeNS(null,"cy","5.5"),ie.setAttributeNS(null,"r","5.4999962"),se.appendChild(he),se.appendChild(ie),T.appendChild(S),T.appendChild(F),T.appendChild(R),T.appendChild(oe),T.appendChild(se),l.appendChild(T),l.setAttributeNS(null,"height",f*this._scale+"px"),l.setAttributeNS(null,"width",p*this._scale+"px"),this._element.appendChild(l),this._offset=o.P.convert(r&&r.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",l=>{l.preventDefault()}),this._element.addEventListener("mousedown",l=>{l.preventDefault()}),Zu(this._element,this._anchor,"marker"),r&&r.className)for(const l of r.className.split(" "))this._element.classList.add(l);this._popup=null}addTo(r){return this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._update),r.on("moveend",this._update),r.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),w.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=o.L.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const p=Math.abs(13.5)/Math.SQRT2;r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(38.1-13.5+p)],"bottom-right":[-p,-1*(38.1-13.5+p)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?r.remove():r.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(r){return this._offset=o.P.convert(r),this._update(),this}addClassName(r){this._element.classList.add(r)}removeClassName(r){this._element.classList.remove(r)}toggleClassName(r){return this._element.classList.toggle(r)}setDraggable(r){return this._draggable=!!r,this._map&&(r?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r&&r!=="auto"?r:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const Yr={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let qr=0,ys=!1;const ro={maxWidth:100,unit:"metric"};function ao(g,r,l){const f=l&&l.maxWidth||100,p=g._container.clientHeight/2,y=g.unproject([0,p]),T=g.unproject([f,p]),S=y.distanceTo(T);if(l&&l.unit==="imperial"){const A=3.2808*S;A>5280?Xn(r,f,A/5280,g._getUIString("ScaleControl.Miles")):Xn(r,f,A,g._getUIString("ScaleControl.Feet"))}else l&&l.unit==="nautical"?Xn(r,f,S/1852,g._getUIString("ScaleControl.NauticalMiles")):S>=1e3?Xn(r,f,S/1e3,g._getUIString("ScaleControl.Kilometers")):Xn(r,f,S,g._getUIString("ScaleControl.Meters"))}function Xn(g,r,l,f){const p=function(y){const T=Math.pow(10,`${Math.floor(y)}`.length-1);let S=y/T;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(A){const F=Math.pow(10,Math.ceil(-Math.log(A)/Math.LN10));return Math.round(A*F)/F}(S),T*S}(l);g.style.width=r*(p/l)+"px",g.innerHTML=`${p}&nbsp;${f}`}const cc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},uc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function vs(g){if(g){if(typeof g=="number"){const r=Math.round(Math.abs(g)/Math.SQRT2);return{center:new o.P(0,0),top:new o.P(0,g),"top-left":new o.P(r,r),"top-right":new o.P(-r,r),bottom:new o.P(0,-g),"bottom-left":new o.P(r,-r),"bottom-right":new o.P(-r,-r),left:new o.P(g,0),right:new o.P(-g,0)}}if(g instanceof o.P||Array.isArray(g)){const r=o.P.convert(g);return{center:r,top:r,"top-left":r,"top-right":r,bottom:r,"bottom-left":r,"bottom-right":r,left:r,right:r}}return{center:o.P.convert(g.center||[0,0]),top:o.P.convert(g.top||[0,0]),"top-left":o.P.convert(g["top-left"]||[0,0]),"top-right":o.P.convert(g["top-right"]||[0,0]),bottom:o.P.convert(g.bottom||[0,0]),"bottom-left":o.P.convert(g["bottom-left"]||[0,0]),"bottom-right":o.P.convert(g["bottom-right"]||[0,0]),left:o.P.convert(g.left||[0,0]),right:o.P.convert(g.right||[0,0])}}return vs(new o.P(0,0))}const hc={extend:(g,...r)=>o.e(g,...r),run(g){g()},logToElement(g,r=!1,l="log"){const f=window.document.getElementById(l);f&&(r&&(f.innerHTML=""),f.innerHTML+=`<br>${g}`)}},fc=E;class vr{static get version(){return fc}static get workerCount(){return Fr.workerCount}static set workerCount(r){Fr.workerCount=r}static get maxParallelImageRequests(){return o.c.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(r){o.c.MAX_PARALLEL_IMAGE_REQUESTS=r}static get workerUrl(){return o.c.WORKER_URL}static set workerUrl(r){o.c.WORKER_URL=r}static addProtocol(r,l){o.c.REGISTERED_PROTOCOLS[r]=l}static removeProtocol(r){delete o.c.REGISTERED_PROTOCOLS[r]}}return vr.Map=class extends Gu{constructor(g){if(o.bg.mark(o.bh.create),(g=o.e({},Gt,g)).minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Xo(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies),{bearingSnap:g.bearingSnap}),this._cooperativeGesturesOnWheel=r=>{this._onCooperativeGesture(r,r[this._metaKey],1)},this._contextLost=r=>{r.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.k("webglcontextlost",{originalEvent:r}))},this._contextRestored=r=>{this._setupPainter(),this.resize(),this._update(),this.fire(new o.k("webglcontextrestored",{originalEvent:r}))},this._onMapScroll=r=>{if(r.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=g.interactive,this._cooperativeGestures=g.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=g.maxTileCacheSize,this._maxTileCacheZoomLevels=g.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._crossSourceCollisions=g.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=g.collectResourceTiming,this._renderTaskQueue=new Qo,this._controls=[],this._mapId=o.a2(),this._locale=o.e({},nc,g.locale),this._clickTolerance=g.clickTolerance,this._overridePixelRatio=g.pixelRatio,this._maxCanvasSize=g.maxCanvasSize,this.transformCameraUpdate=g.transformCameraUpdate,this._imageQueueHandle=j.addThrottleControl(()=>this.isMoving()),this._requestManager=new le(g.transformRequest),typeof g.container=="string"){if(this._container=document.getElementById(g.container),!this._container)throw new Error(`Container '${g.container}' not found.`)}else{if(!(g.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(g.maxBounds&&this.setMaxBounds(g.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let r=!1;const l=Wn(f=>{this._trackResize&&!this._removed&&this.resize(f)._update()},50);this._resizeObserver=new ResizeObserver(f=>{r?l(f):r=!0}),this._resizeObserver.observe(this._container)}this.handlers=new ic(this,g),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=g.hash&&new Ks(typeof g.hash=="string"&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,o.e({},g.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=g.localIdeographFontFamily,this._validateStyle=g.validateStyle,g.style&&this.setStyle(g.style,{localIdeographFontFamily:g.localIdeographFontFamily}),g.attributionControl&&this.addControl(new gi({customAttribution:g.customAttribution})),g.maplibreLogo&&this.addControl(new Dr,g.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",r=>{this._update(r.dataType==="style"),this.fire(new o.k(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new o.k(`${r.dataType}dataloading`,r))}),this.on("dataabort",r=>{this.fire(new o.k("sourcedataabort",r))})}_getMapId(){return this._mapId}addControl(g,r){if(r===void 0&&(r=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new o.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=g.onAdd(this);this._controls.push(g);const f=this._controlPositions[r];return r.indexOf("bottom")!==-1?f.insertBefore(l,f.firstChild):f.appendChild(l),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new o.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(g);return r>-1&&this._controls.splice(r,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}calculateCameraOptionsFromTo(g,r,l,f){return f==null&&this.terrain&&(f=this.terrain.getElevationForLngLatZoom(l,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(g,r,l,f)}resize(g){var r;const l=this._containerDimensions(),f=l[0],p=l[1],y=this._getClampedPixelRatio(f,p);if(this._resizeCanvas(f,p,y),this.painter.resize(f,p,y),this.painter.overLimit()){const S=this.painter.context.gl;this._maxCanvasSize=[S.drawingBufferWidth,S.drawingBufferHeight];const A=this._getClampedPixelRatio(f,p);this._resizeCanvas(f,p,A),this.painter.resize(f,p,A)}this.transform.resize(f,p),(r=this._requestedCameraState)===null||r===void 0||r.resize(f,p);const T=!this._moving;return T&&(this.stop(),this.fire(new o.k("movestart",g)).fire(new o.k("move",g))),this.fire(new o.k("resize",g)),T&&this.fire(new o.k("moveend",g)),this}_getClampedPixelRatio(g,r){const{0:l,1:f}=this._maxCanvasSize,p=this.getPixelRatio(),y=g*p,T=r*p;return Math.min(y>l?l/y:1,T>f?f/T:1)*p}getPixelRatio(){var g;return(g=this._overridePixelRatio)!==null&&g!==void 0?g:devicePixelRatio}setPixelRatio(g){this._overridePixelRatio=g,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(g){return this.transform.setMaxBounds(Ee.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g&&this.setZoom(g),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g&&this.setZoom(g),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g&&this.setPitch(g),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g&&this.setPitch(g),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.renderWorldCopies=g,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(g){return this._cooperativeGestures=g,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(g){return this.transform.locationPoint(o.L.convert(g),this.style&&this.terrain)}unproject(g){return this.transform.pointLocation(o.P.convert(g),this.terrain)}isMoving(){var g;return this._moving||((g=this.handlers)===null||g===void 0?void 0:g.isMoving())}isZooming(){var g;return this._zooming||((g=this.handlers)===null||g===void 0?void 0:g.isZooming())}isRotating(){var g;return this._rotating||((g=this.handlers)===null||g===void 0?void 0:g.isRotating())}_createDelegatedListener(g,r,l){if(g==="mouseenter"||g==="mouseover"){let f=!1;return{layer:r,listener:l,delegates:{mousemove:y=>{const T=this.getLayer(r)?this.queryRenderedFeatures(y.point,{layers:[r]}):[];T.length?f||(f=!0,l.call(this,new mi(g,this,y.originalEvent,{features:T}))):f=!1},mouseout:()=>{f=!1}}}}if(g==="mouseleave"||g==="mouseout"){let f=!1;return{layer:r,listener:l,delegates:{mousemove:T=>{(this.getLayer(r)?this.queryRenderedFeatures(T.point,{layers:[r]}):[]).length?f=!0:f&&(f=!1,l.call(this,new mi(g,this,T.originalEvent)))},mouseout:T=>{f&&(f=!1,l.call(this,new mi(g,this,T.originalEvent)))}}}}{const f=p=>{const y=this.getLayer(r)?this.queryRenderedFeatures(p.point,{layers:[r]}):[];y.length&&(p.features=y,l.call(this,p),delete p.features)};return{layer:r,listener:l,delegates:{[g]:f}}}}on(g,r,l){if(l===void 0)return super.on(g,r);const f=this._createDelegatedListener(g,r,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(f);for(const p in f.delegates)this.on(p,f.delegates[p]);return this}once(g,r,l){if(l===void 0)return super.once(g,r);const f=this._createDelegatedListener(g,r,l);for(const p in f.delegates)this.once(p,f.delegates[p]);return this}off(g,r,l){return l===void 0?super.off(g,r):(this._delegatedListeners&&this._delegatedListeners[g]&&(f=>{const p=this._delegatedListeners[g];for(let y=0;y<p.length;y++){const T=p[y];if(T.layer===r&&T.listener===l){for(const S in T.delegates)this.off(S,T.delegates[S]);return p.splice(y,1),this}}})(),this)}queryRenderedFeatures(g,r){if(!this.style)return[];let l;const f=g instanceof o.P||Array.isArray(g),p=f?g:[[0,0],[this.transform.width,this.transform.height]];if(r=r||(f?{}:g)||{},p instanceof o.P||typeof p[0]=="number")l=[o.P.convert(p)];else{const y=o.P.convert(p[0]),T=o.P.convert(p[1]);l=[y,new o.P(T.x,y.y),T,new o.P(y.x,T.y),y]}return this.style.queryRenderedFeatures(l,r,this.transform)}querySourceFeatures(g,r){return this.style.querySourceFeatures(g,r)}setStyle(g,r){return(r=o.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},r)).diff!==!1&&r.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&g?(this._diffStyle(g,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._updateStyle(g,r))}setTransformRequest(g){return this._requestManager.setTransformRequest(g),this}_getUIString(g){const r=this._locale[g];if(r==null)throw new Error(`Missing UI string '${g}'`);return r}_updateStyle(g,r){if(r.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(g,r));const l=this.style&&r.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!g)),g?(this.style=new Aa(this,r||{}),this.style.setEventedParent(this,{style:this.style}),typeof g=="string"?this.style.loadURL(g,r,l):this.style.loadJSON(g,r,l),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Aa(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(g,r){if(typeof g=="string"){const l=this._requestManager.transformRequest(g,ee.Style);o.f(l,(f,p)=>{f?this.fire(new o.j(f)):p&&this._updateDiff(p,r)})}else typeof g=="object"&&this._updateDiff(g,r)}_updateDiff(g,r){try{this.style.setState(g,r)&&this._update(!0)}catch(l){o.w(`Unable to perform style diff: ${l.message||l.error||l}.  Rebuilding the style from scratch.`),this._updateStyle(g,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.w("There is no style added to the map.")}addSource(g,r){return this._lazyInitEmptyStyle(),this.style.addSource(g,r),this._update(!0)}isSourceLoaded(g){const r=this.style&&this.style.sourceCaches[g];if(r!==void 0)return r.loaded();this.fire(new o.j(new Error(`There is no source with ID '${g}'`)))}setTerrain(g){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),g){const r=this.style.sourceCaches[g.source];if(!r)throw new Error(`cannot load terrain, because there exists no source with ID: ${g.source}`);for(const l in this.style._layers){const f=this.style._layers[l];f.type==="hillshade"&&f.source===g.source&&o.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Wu(this.painter,r,g),this.painter.renderToTexture=new el(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=l=>{l.dataType==="style"?this.terrain.sourceCache.freeRtt():l.dataType==="source"&&l.tile&&(l.sourceId!==g.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(l.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new o.k("terrain",{terrain:g})),this}getTerrain(){var g,r;return(r=(g=this.terrain)===null||g===void 0?void 0:g.options)!==null&&r!==void 0?r:null}areTilesLoaded(){const g=this.style&&this.style.sourceCaches;for(const r in g){const l=g[r]._tiles;for(const f in l){const p=l[f];if(p.state!=="loaded"&&p.state!=="errored")return!1}}return!0}addSourceType(g,r,l){return this._lazyInitEmptyStyle(),this.style.addSourceType(g,r,l)}removeSource(g){return this.style.removeSource(g),this._update(!0)}getSource(g){return this.style.getSource(g)}addImage(g,r,l={}){const{pixelRatio:f=1,sdf:p=!1,stretchX:y,stretchY:T,content:S}=l;if(this._lazyInitEmptyStyle(),!(r instanceof HTMLImageElement||o.a(r))){if(r.width===void 0||r.height===void 0)return this.fire(new o.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:A,height:F,data:L}=r,R=r;return this.style.addImage(g,{data:new o.R({width:A,height:F},new Uint8Array(L)),pixelRatio:f,stretchX:y,stretchY:T,content:S,sdf:p,version:0,userImage:R}),R.onAdd&&R.onAdd(this,g),this}}{const{width:A,height:F,data:L}=o.h.getImageData(r);this.style.addImage(g,{data:new o.R({width:A,height:F},L),pixelRatio:f,stretchX:y,stretchY:T,content:S,sdf:p,version:0})}}updateImage(g,r){const l=this.style.getImage(g);if(!l)return this.fire(new o.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const f=r instanceof HTMLImageElement||o.a(r)?o.h.getImageData(r):r,{width:p,height:y,data:T}=f;if(p===void 0||y===void 0)return this.fire(new o.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(p!==l.data.width||y!==l.data.height)return this.fire(new o.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const S=!(r instanceof HTMLImageElement||o.a(r));return l.data.replace(T,S),this.style.updateImage(g,l),this}getImage(g){return this.style.getImage(g)}hasImage(g){return g?!!this.style.getImage(g):(this.fire(new o.j(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g,r){j.getImage(this._requestManager.transformRequest(g,ee.Image),r)}listImages(){return this.style.listImages()}addLayer(g,r){return this._lazyInitEmptyStyle(),this.style.addLayer(g,r),this._update(!0)}moveLayer(g,r){return this.style.moveLayer(g,r),this._update(!0)}removeLayer(g){return this.style.removeLayer(g),this._update(!0)}getLayer(g){return this.style.getLayer(g)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(g,r,l){return this.style.setLayerZoomRange(g,r,l),this._update(!0)}setFilter(g,r,l={}){return this.style.setFilter(g,r,l),this._update(!0)}getFilter(g){return this.style.getFilter(g)}setPaintProperty(g,r,l,f={}){return this.style.setPaintProperty(g,r,l,f),this._update(!0)}getPaintProperty(g,r){return this.style.getPaintProperty(g,r)}setLayoutProperty(g,r,l,f={}){return this.style.setLayoutProperty(g,r,l,f),this._update(!0)}getLayoutProperty(g,r){return this.style.getLayoutProperty(g,r)}setGlyphs(g,r={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(g,r),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(g,r,l={}){return this._lazyInitEmptyStyle(),this.style.addSprite(g,r,l,f=>{f||this._update(!0)}),this}removeSprite(g){return this._lazyInitEmptyStyle(),this.style.removeSprite(g),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(g,r={}){return this._lazyInitEmptyStyle(),this.style.setSprite(g,r,l=>{l||this._update(!0)}),this}setLight(g,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(g,r),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(g,r){return this.style.setFeatureState(g,r),this._update()}removeFeatureState(g,r){return this.style.removeFeatureState(g,r),this._update()}getFeatureState(g){return this.style.getFeatureState(g)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let g=0,r=0;return this._container&&(g=this._container.clientWidth||400,r=this._container.clientHeight||300),[g,r]}_setupContainer(){const g=this._container;g.classList.add("maplibregl-map");const r=this._canvasContainer=w.create("div","maplibregl-canvas-container",g);this._interactive&&r.classList.add("maplibregl-interactive"),this._canvas=w.create("canvas","maplibregl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const l=this._containerDimensions(),f=this._getClampedPixelRatio(l[0],l[1]);this._resizeCanvas(l[0],l[1],f);const p=this._controlContainer=w.create("div","maplibregl-control-container",g),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(T=>{y[T]=w.create("div",`maplibregl-ctrl-${T} `,p)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=w.create("div","maplibregl-cooperative-gesture-screen",this._container);let g=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(g=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use ⌘ + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${g}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){w.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(g,r,l){this._canvas.width=Math.floor(l*g),this._canvas.height=Math.floor(l*r),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${r}px`}_setupPainter(){const g={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let r=null;this._canvas.addEventListener("webglcontextcreationerror",f=>{r={requestedAttributes:g},f&&(r.statusMessage=f.statusMessage,r.type=f.type)},{once:!0});const l=this._canvas.getContext("webgl2",g)||this._canvas.getContext("webgl",g);if(!l){const f="Failed to initialize WebGL";throw r?(r.message=f,new Error(JSON.stringify(r))):new Error(f)}this.painter=new qn(l,this.transform),C.testSupport(l)}_onCooperativeGesture(g,r,l){return!r&&l<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(g){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_render(g){const r=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(g),this._removed)return;let l=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const p=this.transform.zoom,y=o.h.now();this.style.zoomHistory.update(p,y);const T=new o.a8(p,{now:y,fadeDuration:r,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),S=T.crossFadingFactor();S===1&&S===this._crossFadingFactor||(l=!0,this._crossFadingFactor=S),this.style.update(T)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,r,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:r,showPadding:this.showPadding}),this.fire(new o.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.bg.mark(o.bh.load),this.fire(new o.k("load"))),this.style&&(this.style.hasTransitions()||l)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const f=this._sourcesDirty||this._styleDirty||this._placementDirty;return f||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.k("idle")),!this._loaded||this._fullyLoaded||f||(this._fullyLoaded=!0,o.bg.mark(o.bh.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var g;this._hash&&this._hash.remove();for(const l of this._controls)l.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),j.removeThrottleControl(this._imageQueueHandle),(g=this._resizeObserver)===null||g===void 0||g.disconnect();const r=this.painter.context.gl.getExtension("WEBGL_lose_context");r&&r.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),w.remove(this._canvasContainer),w.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),o.bg.clearMetrics(),this._removed=!0,this.fire(new o.k("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=o.h.frame(g=>{o.bg.frame(g),this._frame=null,this._render(g)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get version(){return zt}getCameraTargetElevation(){return this.transform.elevation}},vr.NavigationControl=class{constructor(g){this._updateZoomButtons=()=>{const r=this._map.getZoom(),l=r===this._map.getMaxZoom(),f=r===this._map.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())},this._rotateCompassArrow=()=>{const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=r},this._setButtonTitle=(r,l)=>{const f=this._map._getUIString(`NavigationControl.${l}`);r.title=f,r.setAttribute("aria-label",f)},this.options=o.e({},sc,g),this._container=w.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",r=>this._map.zoomIn({},{originalEvent:r})),w.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",r=>this._map.zoomOut({},{originalEvent:r})),w.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",r=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:r}):this._map.resetNorth({},{originalEvent:r})}),this._compassIcon=w.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new oc(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){w.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(g,r){const l=w.create("button",g,this._container);return l.type="button",l.addEventListener("click",r),l}},vr.GeolocateControl=class extends o.E{constructor(g){super(),this._onSuccess=r=>{if(this._map){if(this._isOutOfMapMaxBounds(r))return this._setErrorState(),this.fire(new o.k("outofmaxbounds",r)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=r,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(r),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(r),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new o.k("geolocate",r)),this._finish()}},this._updateCamera=r=>{const l=new o.L(r.coords.longitude,r.coords.latitude),f=r.coords.accuracy,p=this._map.getBearing(),y=o.e({bearing:p},this.options.fitBoundsOptions),T=Ee.fromLngLat(l,f);this._map.fitBounds(T,y,{geolocateSource:!0})},this._updateMarker=r=>{if(r){const l=new o.L(r.coords.longitude,r.coords.latitude);this._accuracyCircleMarker.setLngLat(l).addTo(this._map),this._userLocationDotMarker.setLngLat(l).addTo(this._map),this._accuracy=r.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=r=>{if(this._map){if(this.options.trackUserLocation)if(r.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=l,this._geolocateButton.setAttribute("aria-label",l),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(r.code===3&&ys)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new o.k("error",r)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=r=>{if(this._map){if(this._container.addEventListener("contextmenu",l=>l.preventDefault()),this._geolocateButton=w.create("button","maplibregl-ctrl-geolocate",this._container),w.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",r===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=l,this._geolocateButton.setAttribute("aria-label",l)}else{const l=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=l,this._geolocateButton.setAttribute("aria-label",l)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=w.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Zn({element:this._dotElement}),this._circleElement=w.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Zn({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",l=>{l.geolocateSource||this._watchState!=="ACTIVE_LOCK"||l.originalEvent&&l.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new o.k("trackuserlocationend")))})}},this.options=o.e({},Yr,g)}onAdd(g){return this._map=g,this._container=w.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(r,l=!1){sa===void 0||l?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(f=>{sa=f.state!=="denied",r(sa)}).catch(()=>{sa=!!window.navigator.geolocation,r(sa)}):(sa=!!window.navigator.geolocation,r(sa)):r(sa)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),w.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,qr=0,ys=!1}_isOutOfMapMaxBounds(g){const r=this._map.getMaxBounds(),l=g.coords;return r&&(l.longitude<r.getWest()||l.longitude>r.getEast()||l.latitude<r.getSouth()||l.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const g=this._map.getBounds(),r=g.getSouthEast(),l=g.getNorthEast(),f=r.distanceTo(l),p=Math.ceil(this._accuracy/(f/this._map._container.clientHeight)*2);this._circleElement.style.width=`${p}px`,this._circleElement.style.height=`${p}px`}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":qr--,ys=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new o.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let g;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),qr++,qr>1?(g={maximumAge:6e5,timeout:0},ys=!0):(g=this.options.positionOptions,ys=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,g)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},vr.AttributionControl=gi,vr.LogoControl=Dr,vr.ScaleControl=class{constructor(g){this._onMove=()=>{ao(this._map,this._container,this.options)},this.setUnit=r=>{this.options.unit=r,ao(this._map,this._container,this.options)},this.options=o.e({},ro,g)}getDefaultPosition(){return"bottom-left"}onAdd(g){return this._map=g,this._container=w.create("div","maplibregl-ctrl maplibregl-ctrl-scale",g.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){w.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},vr.FullscreenControl=class extends o.E{constructor(g={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,g&&g.container&&(g.container instanceof HTMLElement?this._container=g.container:o.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=w.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){w.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const g=this._fullscreenButton=w.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);w.create("span","maplibregl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.title=g}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new o.k("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new o.k("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},vr.TerrainControl=class{constructor(g){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=g}onAdd(g){return this._map=g,this._container=w.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=w.create("button","maplibregl-ctrl-terrain",this._container),w.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){w.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},vr.Popup=class extends o.E{constructor(g){super(),this.remove=()=>(this._content&&w.remove(this._content),this._container&&(w.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new o.k("close")),this),this._onMouseUp=r=>{this._update(r.point)},this._onMouseMove=r=>{this._update(r.point)},this._onDrag=r=>{this._update(r.point)},this._update=r=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=w.create("div","maplibregl-popup",this._map.getContainer()),this._tip=w.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const T of this.options.className.split(" "))this._container.classList.add(T);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=lc(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!r)return;const l=this._pos=this._trackPointer&&r?r:this._map.project(this._lngLat);let f=this.options.anchor;const p=vs(this.options.offset);if(!f){const T=this._container.offsetWidth,S=this._container.offsetHeight;let A;A=l.y+p.bottom.y<S?["top"]:l.y>this._map.transform.height-S?["bottom"]:[],l.x<T/2?A.push("left"):l.x>this._map.transform.width-T/2&&A.push("right"),f=A.length===0?"bottom":A.join("-")}const y=l.add(p[f]).round();w.setTransform(this._container,`${Pi[f]} translate(${y.x}px,${y.y}px)`),Zu(this._container,f,"popup")},this._onClose=()=>{this.remove()},this.options=o.e(Object.create(cc),g)}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new o.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(g){return this._lngLat=o.L.convert(g),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(document.createTextNode(g))}setHTML(g){const r=document.createDocumentFragment(),l=document.createElement("body");let f;for(l.innerHTML=g;f=l.firstChild,f;)r.appendChild(f);return this.setDOMContent(r)}getMaxWidth(){var g;return(g=this._container)===null||g===void 0?void 0:g.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=w.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(g),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(g){this._container&&this._container.classList.add(g)}removeClassName(g){this._container&&this._container.classList.remove(g)}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){if(this._container)return this._container.classList.toggle(g)}_createCloseButton(){this.options.closeButton&&(this._closeButton=w.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(uc);g&&g.focus()}},vr.Marker=Zn,vr.Style=Aa,vr.LngLat=o.L,vr.LngLatBounds=Ee,vr.Point=o.P,vr.MercatorCoordinate=o.U,vr.Evented=o.E,vr.AJAXError=o.bi,vr.config=o.c,vr.CanvasSource=_e,vr.GeoJSONSource=vt,vr.ImageSource=Qe,vr.RasterDEMTileSource=dt,vr.RasterTileSource=Ke,vr.VectorTileSource=Ie,vr.VideoSource=qt,vr.setRTLTextPlugin=o.bj,vr.getRTLTextPluginStatus=o.bk,vr.prewarm=function(){$r().acquire(Xt)},vr.clearPrewarmedResources=function(){const g=ia;g&&(g.isPreloaded()&&g.numActive()===1?(g.release(Xt),ia=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},hc.extend(vr,{isSafari:o.ac,getPerformanceMetrics:o.bg.getPerformanceMetrics}),vr});var x=u;return x})})(t1);var yb=t1.exports;const vb=tv(yb);function wb({locations:e}){const[n,a]=ue.useState(!1);return Ye.jsx("div",{className:n?"fixed top-0 right-0 bottom-0 left-0 z-[9999]":"w-full h-full relative",children:Ye.jsxs(mb,{mapLib:vb,style:{width:"100%",height:" 100%",position:"relative"},mapStyle:"https://api.ekgis.vn/v2/mapstyles/style/osmplus/standard/style.json?api_key=wtpM0U1ZmE2s87LEZNSHf63Osc1a2sboaozCQNsy",children:[e.map(c=>Ye.jsx(gb,{latitude:c.latitude,longitude:c.longitude,offsetLeft:-20,offsetTop:-10,children:Ye.jsx(Aw,{des:c?.customer_name})},c.customer_name)),Ye.jsx(_b,{id:"lines",type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",properties:{color:"#F7455D"},geometry:{type:"LineString",coordinates:e.map(c=>[c.longitude,c.latitude])}}]},children:Ye.jsx(xb,{id:"lines",type:"line",paint:{"line-color":["get","color"],"line-width":3}})})]})})}const a1=(e,n,a={})=>{let c=[];return e.forEach(u=>{let m={};for(let x in u)n.includes(x)&&(m[x]=u[x]);a.isNull?c.push(m):Object.keys(m).find(o=>!m[o])||c.push(m)}),c};function bb({data:e}){const[n,a]=ue.useState([]);return ue.useEffect(()=>{a(a1(e,["customer_name","longitude","longitude"],{isNull:!1}))},[e]),Ye.jsx(Ye.Fragment,{children:Ye.jsxs(mo,{className:"h-[500px]",children:[Ye.jsx(Ti,{span:8,children:Ye.jsx($0,{columns:[{title:"Stt",dataIndex:"stt",key:"stt",render:(c,u,m)=>m+1},...H0],dataSource:e,pagination:!1})}),Ye.jsx(Ti,{span:16,className:"overflow-hidden",children:Ye.jsx(wb,{locations:n})})]})})}const{Dragger:Tb}=yw;function Eb({handleFile:e}){const n={name:"file",accept:".xls,.xlsx",action:"https://run.mocky.io/v3/435e224c-44fb-4773-9faf-380c5e6a2188",onChange(a){const{status:c}=a.file;c!=="uploading"&&console.log(a.file,a.fileList),c==="done"?Kc.success(`${a.file.name} file uploaded successfully.`):c==="error"&&Kc.error(`${a.file.name} file upload failed.`);let u=a.file.originFileObj;e(u)},onDrop(a){}};return Ye.jsxs(Tb,{...n,children:[Ye.jsx("p",{className:"ant-upload-drag-icon",children:Ye.jsx(Tw,{})}),Ye.jsx("p",{className:"ant-upload-text",children:"Kéo, thả hoặc chọn tệp để tải lên"}),Ye.jsx("p",{className:"ant-upload-hint",children:"Hỗ trợ tệp .xls, .xlsx"})]})}function Sb({form:e,filter:n,setFilter:a}){const[c,u]=ue.useState([]),[m,x]=ue.useState([]),[o,E]=ue.useState([]),[w,C]=ue.useState([]);ue.useState(""),ue.useState(""),ue.useEffect(()=>{e.setFieldsValue(n)},[n]),ue.useEffect(()=>{(async()=>{let O=await Tn.get("/api/method/frappe.desk.search.search_link",{params:{txt:"",doctype:"Customer Group",ignore_user_permissions:0,reference_doctype:"Customer"}}),U=await Tn.get("/api/method/mbw_dms.api.location.list_province");x(U.result);let{results:z}=O;u(z.map(j=>({label:j.value,value:j.value})))})()},[]);const P=async O=>{let U=m.find(z=>z.ten_tinh==O)?.ma_tinh;if(U){let z=await Tn.get("/api/method/mbw_dms.api.location.list_district",{params:{ma_tinh_thanh:Number.parseInt(U)}});E(z.result)}},M=async O=>{let U=o.find(z=>z.ten_huyen==O)?.ma_huyen;if(U){let z=await Tn.get("/api/method/mbw_dms.api.location.list_ward",{params:{ma_quan_huyen:U}});C(z.result)}};return Ye.jsxs(E0,{form:e,layout:"vertical",onFinish:a,children:[Ye.jsx(Ri,{label:"Loại khách hàng",name:"customer_type",children:Ye.jsx(zn,{options:[{label:"Tất cả",value:!1},{label:"Company",value:"Company"},{label:"Individual",value:"Individual"}]})}),Ye.jsx(Ri,{label:"Nhóm khách hàng",name:"customer_group",children:Ye.jsx(zn,{options:c})}),Ye.jsx("p",{className:"font-medium text-sm",children:"Địa chỉ"}),Ye.jsx(Ri,{label:"Tỉnh/Thành phố",name:"city",children:Ye.jsx(zn,{options:m.map(O=>({label:O.ten_tinh,value:O.ten_tinh})),onChange:P})}),Ye.jsx(Ri,{label:"Quận/huyện",name:"district",children:Ye.jsx(zn,{options:o.map(O=>({label:O.ten_huyen,value:O.ten_huyen})),disabled:o.length==0,onChange:M})}),Ye.jsx(Ri,{label:"Phường/xã",name:"ward",children:Ye.jsx(zn,{options:w.map(O=>({label:O.ten_xa,value:O.ten_xa})),disabled:w.length==0})})]})}const kb=[...H0,{title:"Loại khách hàng",dataIndex:"customer_id",key:"customer_type"},{title:"Nhóm khách hàng",dataIndex:"customer_name",key:"customer_group"},...e1],km=e=>{let n=[];for(let a in e)e[a]&&(n=[...n,{key:[Dw[a]],value:e[a],key2:a}]);return n};function Cb({selected:e,handleAdd:n,closeModal:a}){const[c]=rv(),[u,m]=ue.useState([]),[x,o]=ue.useState(Pw),[E,w]=ue.useState({}),[C,P]=ue.useState(!1),M=20,[O,U]=ue.useState(1),[z,j]=ue.useState(40),ee={selectedRowKeys:u&&u.map(me=>me.name),onChange:(me,Te)=>{m(Te)}},le=()=>{c.submit(),P(!1)},Z=me=>{if(me){let Te={...E};delete Te[me.key2],c.setFieldsValue(Te),w(re=>(delete re[me.key2],{...re}))}else c.resetFields(),w({})};ue.useEffect(()=>{(async()=>{const me=await Tn.get("/api/method/mbw_dms.api.router.get_customer",{params:{...E,page_size:M,page_number:O}});o(me?.result?.data),j(me.result?.total)})()},[E,O]);const fe=()=>{u.length>0&&n(me=>{let Te=e.map(re=>re.name);return u.forEach(re=>{Te.includes(re.name)||(me=[re,...me])}),[...me]}),a()};return ue.useEffect(()=>{m(e)},[e]),Ye.jsxs(Ye.Fragment,{children:[Ye.jsxs(mo,{className:"justify-between",children:[Ye.jsxs(Ti,{className:"inline-flex ",children:[Ye.jsx(Ri,{children:Ye.jsx(Ih,{placeholder:"Tìm kiếm khách hàng",prefix:Ye.jsx(jg,{})})}),Ye.jsxs("div",{className:"flex justify-center items-center ml-4",children:[Ye.jsx(po,{className:"flex items-center text-nowrap !text-[13px] !leading-[21px] !font-normal  border-r-[0.1px] rounded-r-none h-[36px]",icon:Ye.jsx(dv,{style:{fontSize:"20px"}}),onClick:P.bind(null,!0),children:"Filter"}),Ye.jsx(po,{className:"border-l-[0.1px] rounded-l-none h-[36px]",onClick:()=>Z(),children:Ye.jsx(pv,{style:{fontSize:"20px"}})})]})]}),Ye.jsxs(Ti,{className:"inline-flex items-center",children:[Ye.jsxs("span",{className:"mr-4",children:["Đã chọn ",u.length||0," khách hàng"]}),Ye.jsx(po,{type:"primary",onClick:fe,children:"Thêm"})]})]}),Ye.jsxs("div",{className:"py-5 px-4",children:[Ye.jsxs("span",{children:[x.length," kết quả hiển thị"]}),km(E).length>0&&Ye.jsxs(mo,{className:"items-center",children:[km(E).map(me=>Ye.jsxs(av,{closeIcon:Ye.jsx(V0,{}),onClose:()=>{Z(me)},children:[me.key,": ",me.value]})),Ye.jsx("span",{className:"cursor-pointer",onClick:()=>Z(),children:"Clear all"})]})]}),Ye.jsx($0,{rowSelection:{type:"checkbox",...ee},columns:kb,dataSource:x.map(me=>({key:me.name,...me})),pagination:!1}),Ye.jsx(mo,{className:"justify-end mt-2",children:Ye.jsx(iv,{defaultCurrent:O,pageSize:M,total:z,onChange:(me,Te)=>{U(me)}})}),Ye.jsx(S0,{width:451,title:"Bộ lọc",open:C,okText:"Áp dụng",cancelText:"Đặt lại",onCancel:P.bind(null,!1),onOk:le,children:Ye.jsx(Sb,{filter:E,setFilter:w,form:c})})]})}/*! xlsx.js (C) 2013-present SheetJS -- http://sheetjs.com */var i1=1252,Ab=[874,932,936,949,950,1250,1251,1252,1253,1254,1255,1256,1257,1258,1e4],q0={0:1252,1:65001,2:65001,77:1e4,128:932,129:949,130:1361,134:936,136:950,161:1253,162:1254,163:1258,177:1255,178:1256,186:1257,204:1251,222:874,238:1250,255:1252,69:6969},W0=function(e){Ab.indexOf(e)!=-1&&(i1=q0[0]=e)};function Ib(){W0(1252)}var En=function(e){W0(e)};function n1(){En(1200),Ib()}function Cm(e){for(var n=[],a=0,c=e.length;a<c;++a)n[a]=e.charCodeAt(a);return n}function Fb(e){for(var n=[],a=0;a<e.length>>1;++a)n[a]=String.fromCharCode(e.charCodeAt(2*a)+(e.charCodeAt(2*a+1)<<8));return n.join("")}function s1(e){for(var n=[],a=0;a<e.length>>1;++a)n[a]=String.fromCharCode(e.charCodeAt(2*a+1)+(e.charCodeAt(2*a)<<8));return n.join("")}var Lc=function(e){var n=e.charCodeAt(0),a=e.charCodeAt(1);return n==255&&a==254?Fb(e.slice(2)):n==254&&a==255?s1(e.slice(2)):n==65279?e.slice(1):e},vh=function(n){return String.fromCharCode(n)},Am=function(n){return String.fromCharCode(n)},Fs,Ms="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function Im(e){for(var n="",a=0,c=0,u=0,m=0,x=0,o=0,E=0,w=0;w<e.length;)a=e.charCodeAt(w++),m=a>>2,c=e.charCodeAt(w++),x=(a&3)<<4|c>>4,u=e.charCodeAt(w++),o=(c&15)<<2|u>>6,E=u&63,isNaN(c)?o=E=64:isNaN(u)&&(E=64),n+=Ms.charAt(m)+Ms.charAt(x)+Ms.charAt(o)+Ms.charAt(E);return n}function qi(e){var n="",a=0,c=0,u=0,m=0,x=0,o=0,E=0;e=e.replace(/[^\w\+\/\=]/g,"");for(var w=0;w<e.length;)m=Ms.indexOf(e.charAt(w++)),x=Ms.indexOf(e.charAt(w++)),a=m<<2|x>>4,n+=String.fromCharCode(a),o=Ms.indexOf(e.charAt(w++)),c=(x&15)<<4|o>>2,o!==64&&(n+=String.fromCharCode(c)),E=Ms.indexOf(e.charAt(w++)),u=(o&3)<<6|E,E!==64&&(n+=String.fromCharCode(u));return n}var wr=function(){return typeof Buffer<"u"&&typeof process<"u"&&typeof process.versions<"u"&&!!process.versions.node}(),bo=function(){if(typeof Buffer<"u"){var e=!Buffer.from;if(!e)try{Buffer.from("foo","utf8")}catch{e=!0}return e?function(n,a){return a?new Buffer(n,a):new Buffer(n)}:Buffer.from.bind(Buffer)}return function(){}}();function zs(e){return wr?Buffer.alloc?Buffer.alloc(e):new Buffer(e):typeof Uint8Array<"u"?new Uint8Array(e):new Array(e)}function Fm(e){return wr?Buffer.allocUnsafe?Buffer.allocUnsafe(e):new Buffer(e):typeof Uint8Array<"u"?new Uint8Array(e):new Array(e)}var bn=function(n){return wr?bo(n,"binary"):n.split("").map(function(a){return a.charCodeAt(0)&255})};function To(e){if(Array.isArray(e))return e.map(function(c){return String.fromCharCode(c)}).join("");for(var n=[],a=0;a<e.length;++a)n[a]=String.fromCharCode(e[a]);return n.join("")}function Z0(e){if(typeof ArrayBuffer>"u")throw new Error("Unsupported");if(e instanceof ArrayBuffer)return Z0(new Uint8Array(e));for(var n=new Array(e.length),a=0;a<e.length;++a)n[a]=e[a];return n}var Ps=wr?function(e){return Buffer.concat(e.map(function(n){return Buffer.isBuffer(n)?n:bo(n)}))}:function(e){if(typeof Uint8Array<"u"){var n=0,a=0;for(n=0;n<e.length;++n)a+=e[n].length;var c=new Uint8Array(a),u=0;for(n=0,a=0;n<e.length;a+=u,++n)if(u=e[n].length,e[n]instanceof Uint8Array)c.set(e[n],a);else{if(typeof e[n]=="string")throw"wtf";c.set(new Uint8Array(e[n]),a)}return c}return[].concat.apply([],e.map(function(m){return Array.isArray(m)?m:[].slice.call(m)}))};function Pb(e){for(var n=[],a=0,c=e.length+250,u=zs(e.length+255),m=0;m<e.length;++m){var x=e.charCodeAt(m);if(x<128)u[a++]=x;else if(x<2048)u[a++]=192|x>>6&31,u[a++]=128|x&63;else if(x>=55296&&x<57344){x=(x&1023)+64;var o=e.charCodeAt(++m)&1023;u[a++]=240|x>>8&7,u[a++]=128|x>>2&63,u[a++]=128|o>>6&15|(x&3)<<4,u[a++]=128|o&63}else u[a++]=224|x>>12&15,u[a++]=128|x>>6&63,u[a++]=128|x&63;a>c&&(n.push(u.slice(0,a)),a=0,u=zs(65535),c=65530)}return n.push(u.slice(0,a)),Ps(n)}var ki=/\u0000/g,Rc=/[\u0001-\u0006]/g;function ml(e){for(var n="",a=e.length-1;a>=0;)n+=e.charAt(a--);return n}function Sn(e,n){var a=""+e;return a.length>=n?a:fa("0",n-a.length)+a}function X0(e,n){var a=""+e;return a.length>=n?a:fa(" ",n-a.length)+a}function Lh(e,n){var a=""+e;return a.length>=n?a:a+fa(" ",n-a.length)}function Mb(e,n){var a=""+Math.round(e);return a.length>=n?a:fa("0",n-a.length)+a}function Db(e,n){var a=""+e;return a.length>=n?a:fa("0",n-a.length)+a}var Pm=Math.pow(2,32);function fl(e,n){if(e>Pm||e<-Pm)return Mb(e,n);var a=Math.round(e);return Db(a,n)}function Rh(e,n){return n=n||0,e.length>=7+n&&(e.charCodeAt(n)|32)===103&&(e.charCodeAt(n+1)|32)===101&&(e.charCodeAt(n+2)|32)===110&&(e.charCodeAt(n+3)|32)===101&&(e.charCodeAt(n+4)|32)===114&&(e.charCodeAt(n+5)|32)===97&&(e.charCodeAt(n+6)|32)===108}var Mm=[["Sun","Sunday"],["Mon","Monday"],["Tue","Tuesday"],["Wed","Wednesday"],["Thu","Thursday"],["Fri","Friday"],["Sat","Saturday"]],f0=[["J","Jan","January"],["F","Feb","February"],["M","Mar","March"],["A","Apr","April"],["M","May","May"],["J","Jun","June"],["J","Jul","July"],["A","Aug","August"],["S","Sep","September"],["O","Oct","October"],["N","Nov","November"],["D","Dec","December"]];function Lb(e){return e||(e={}),e[0]="General",e[1]="0",e[2]="0.00",e[3]="#,##0",e[4]="#,##0.00",e[9]="0%",e[10]="0.00%",e[11]="0.00E+00",e[12]="# ?/?",e[13]="# ??/??",e[14]="m/d/yy",e[15]="d-mmm-yy",e[16]="d-mmm",e[17]="mmm-yy",e[18]="h:mm AM/PM",e[19]="h:mm:ss AM/PM",e[20]="h:mm",e[21]="h:mm:ss",e[22]="m/d/yy h:mm",e[37]="#,##0 ;(#,##0)",e[38]="#,##0 ;[Red](#,##0)",e[39]="#,##0.00;(#,##0.00)",e[40]="#,##0.00;[Red](#,##0.00)",e[45]="mm:ss",e[46]="[h]:mm:ss",e[47]="mmss.0",e[48]="##0.0E+0",e[49]="@",e[56]='"上午/下午 "hh"時"mm"分"ss"秒 "',e}var fr={0:"General",1:"0",2:"0.00",3:"#,##0",4:"#,##0.00",9:"0%",10:"0.00%",11:"0.00E+00",12:"# ?/?",13:"# ??/??",14:"m/d/yy",15:"d-mmm-yy",16:"d-mmm",17:"mmm-yy",18:"h:mm AM/PM",19:"h:mm:ss AM/PM",20:"h:mm",21:"h:mm:ss",22:"m/d/yy h:mm",37:"#,##0 ;(#,##0)",38:"#,##0 ;[Red](#,##0)",39:"#,##0.00;(#,##0.00)",40:"#,##0.00;[Red](#,##0.00)",45:"mm:ss",46:"[h]:mm:ss",47:"mmss.0",48:"##0.0E+0",49:"@",56:'"上午/下午 "hh"時"mm"分"ss"秒 "'},Dm={5:37,6:38,7:39,8:40,23:0,24:0,25:0,26:0,27:14,28:14,29:14,30:14,31:14,50:14,51:14,52:14,53:14,54:14,55:14,56:14,57:14,58:14,59:1,60:2,61:3,62:4,67:9,68:10,69:12,70:13,71:14,72:14,73:15,74:16,75:17,76:20,77:21,78:22,79:45,80:46,81:47,82:0},Rb={5:'"$"#,##0_);\\("$"#,##0\\)',63:'"$"#,##0_);\\("$"#,##0\\)',6:'"$"#,##0_);[Red]\\("$"#,##0\\)',64:'"$"#,##0_);[Red]\\("$"#,##0\\)',7:'"$"#,##0.00_);\\("$"#,##0.00\\)',65:'"$"#,##0.00_);\\("$"#,##0.00\\)',8:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',66:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',41:'_(* #,##0_);_(* \\(#,##0\\);_(* "-"_);_(@_)',42:'_("$"* #,##0_);_("$"* \\(#,##0\\);_("$"* "-"_);_(@_)',43:'_(* #,##0.00_);_(* \\(#,##0.00\\);_(* "-"??_);_(@_)',44:'_("$"* #,##0.00_);_("$"* \\(#,##0.00\\);_("$"* "-"??_);_(@_)'};function Oh(e,n,a){for(var c=e<0?-1:1,u=e*c,m=0,x=1,o=0,E=1,w=0,C=0,P=Math.floor(u);w<n&&(P=Math.floor(u),o=P*x+m,C=P*w+E,!(u-P<5e-8));)u=1/(u-P),m=x,x=o,E=w,w=C;if(C>n&&(w>n?(C=E,o=m):(C=w,o=x)),!a)return[0,c*o,C];var M=Math.floor(c*o/C);return[M,c*o-M*C,C]}function fo(e,n,a){if(e>2958465||e<0)return null;var c=e|0,u=Math.floor(86400*(e-c)),m=0,x=[],o={D:c,T:u,u:86400*(e-c)-u,y:0,m:0,d:0,H:0,M:0,S:0,q:0};if(Math.abs(o.u)<1e-6&&(o.u=0),n&&n.date1904&&(c+=1462),o.u>.9999&&(o.u=0,++u==86400&&(o.T=u=0,++c,++o.D)),c===60)x=a?[1317,10,29]:[1900,2,29],m=3;else if(c===0)x=a?[1317,8,29]:[1900,1,0],m=6;else{c>60&&--c;var E=new Date(1900,0,1);E.setDate(E.getDate()+c-1),x=[E.getFullYear(),E.getMonth()+1,E.getDate()],m=E.getDay(),c<60&&(m=(m+6)%7),a&&(m=Vb(E,x))}return o.y=x[0],o.m=x[1],o.d=x[2],o.S=u%60,u=Math.floor(u/60),o.M=u%60,u=Math.floor(u/60),o.H=u,o.q=m,o}var o1=new Date(1899,11,31,0,0,0),Ob=o1.getTime(),Bb=new Date(1900,2,1,0,0,0);function l1(e,n){var a=e.getTime();return n?a-=1461*24*60*60*1e3:e>=Bb&&(a+=24*60*60*1e3),(a-(Ob+(e.getTimezoneOffset()-o1.getTimezoneOffset())*6e4))/(24*60*60*1e3)}function K0(e){return e.indexOf(".")==-1?e:e.replace(/(?:\.0*|(\.\d*[1-9])0+)$/,"$1")}function zb(e){return e.indexOf("E")==-1?e:e.replace(/(?:\.0*|(\.\d*[1-9])0+)[Ee]/,"$1E").replace(/(E[+-])(\d)$/,"$10$2")}function Nb(e){var n=e<0?12:11,a=K0(e.toFixed(12));return a.length<=n||(a=e.toPrecision(10),a.length<=n)?a:e.toExponential(5)}function Ub(e){var n=K0(e.toFixed(11));return n.length>(e<0?12:11)||n==="0"||n==="-0"?e.toPrecision(6):n}function Yc(e){var n=Math.floor(Math.log(Math.abs(e))*Math.LOG10E),a;return n>=-4&&n<=-1?a=e.toPrecision(10+n):Math.abs(n)<=9?a=Nb(e):n===10?a=e.toFixed(10).substr(0,12):a=Ub(e),K0(zb(a.toUpperCase()))}function _o(e,n){switch(typeof e){case"string":return e;case"boolean":return e?"TRUE":"FALSE";case"number":return(e|0)===e?e.toString(10):Yc(e);case"undefined":return"";case"object":if(e==null)return"";if(e instanceof Date)return on(14,l1(e,n&&n.date1904),n)}throw new Error("unsupported value in General format: "+e)}function Vb(e,n){n[0]-=581;var a=e.getDay();return e<60&&(a=(a+6)%7),a}function $b(e,n,a,c){var u="",m=0,x=0,o=a.y,E,w=0;switch(e){case 98:o=a.y+543;case 121:switch(n.length){case 1:case 2:E=o%100,w=2;break;default:E=o%1e4,w=4;break}break;case 109:switch(n.length){case 1:case 2:E=a.m,w=n.length;break;case 3:return f0[a.m-1][1];case 5:return f0[a.m-1][0];default:return f0[a.m-1][2]}break;case 100:switch(n.length){case 1:case 2:E=a.d,w=n.length;break;case 3:return Mm[a.q][0];default:return Mm[a.q][1]}break;case 104:switch(n.length){case 1:case 2:E=1+(a.H+11)%12,w=n.length;break;default:throw"bad hour format: "+n}break;case 72:switch(n.length){case 1:case 2:E=a.H,w=n.length;break;default:throw"bad hour format: "+n}break;case 77:switch(n.length){case 1:case 2:E=a.M,w=n.length;break;default:throw"bad minute format: "+n}break;case 115:if(n!="s"&&n!="ss"&&n!=".0"&&n!=".00"&&n!=".000")throw"bad second format: "+n;return a.u===0&&(n=="s"||n=="ss")?Sn(a.S,n.length):(c>=2?x=c===3?1e3:100:x=c===1?10:1,m=Math.round(x*(a.S+a.u)),m>=60*x&&(m=0),n==="s"?m===0?"0":""+m/x:(u=Sn(m,2+c),n==="ss"?u.substr(0,2):"."+u.substr(2,n.length-1)));case 90:switch(n){case"[h]":case"[hh]":E=a.D*24+a.H;break;case"[m]":case"[mm]":E=(a.D*24+a.H)*60+a.M;break;case"[s]":case"[ss]":E=((a.D*24+a.H)*60+a.M)*60+Math.round(a.S+a.u);break;default:throw"bad abstime format: "+n}w=n.length===3?1:2;break;case 101:E=o,w=1;break}var C=w>0?Sn(E,w):"";return C}function Ds(e){var n=3;if(e.length<=n)return e;for(var a=e.length%n,c=e.substr(0,a);a!=e.length;a+=n)c+=(c.length>0?",":"")+e.substr(a,n);return c}var c1=/%/g;function jb(e,n,a){var c=n.replace(c1,""),u=n.length-c.length;return ss(e,c,a*Math.pow(10,2*u))+fa("%",u)}function Gb(e,n,a){for(var c=n.length-1;n.charCodeAt(c-1)===44;)--c;return ss(e,n.substr(0,c),a/Math.pow(10,3*(n.length-c)))}function u1(e,n){var a,c=e.indexOf("E")-e.indexOf(".")-1;if(e.match(/^#+0.0E\+0$/)){if(n==0)return"0.0E+0";if(n<0)return"-"+u1(e,-n);var u=e.indexOf(".");u===-1&&(u=e.indexOf("E"));var m=Math.floor(Math.log(n)*Math.LOG10E)%u;if(m<0&&(m+=u),a=(n/Math.pow(10,m)).toPrecision(c+1+(u+m)%u),a.indexOf("e")===-1){var x=Math.floor(Math.log(n)*Math.LOG10E);for(a.indexOf(".")===-1?a=a.charAt(0)+"."+a.substr(1)+"E+"+(x-a.length+m):a+="E+"+(x-m);a.substr(0,2)==="0.";)a=a.charAt(0)+a.substr(2,u)+"."+a.substr(2+u),a=a.replace(/^0+([1-9])/,"$1").replace(/^0+\./,"0.");a=a.replace(/\+-/,"-")}a=a.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(o,E,w,C){return E+w+C.substr(0,(u+m)%u)+"."+C.substr(m)+"E"})}else a=n.toExponential(c);return e.match(/E\+00$/)&&a.match(/e[+-]\d$/)&&(a=a.substr(0,a.length-1)+"0"+a.charAt(a.length-1)),e.match(/E\-/)&&a.match(/e\+/)&&(a=a.replace(/e\+/,"e")),a.replace("e","E")}var h1=/# (\?+)( ?)\/( ?)(\d+)/;function Hb(e,n,a){var c=parseInt(e[4],10),u=Math.round(n*c),m=Math.floor(u/c),x=u-m*c,o=c;return a+(m===0?"":""+m)+" "+(x===0?fa(" ",e[1].length+1+e[4].length):X0(x,e[1].length)+e[2]+"/"+e[3]+Sn(o,e[4].length))}function qb(e,n,a){return a+(n===0?"":""+n)+fa(" ",e[1].length+2+e[4].length)}var f1=/^#*0*\.([0#]+)/,d1=/\).*[0#]/,p1=/\(###\) ###\\?-####/;function bi(e){for(var n="",a,c=0;c!=e.length;++c)switch(a=e.charCodeAt(c)){case 35:break;case 63:n+=" ";break;case 48:n+="0";break;default:n+=String.fromCharCode(a)}return n}function Lm(e,n){var a=Math.pow(10,n);return""+Math.round(e*a)/a}function Rm(e,n){var a=e-Math.floor(e),c=Math.pow(10,n);return n<(""+Math.round(a*c)).length?0:Math.round(a*c)}function Wb(e,n){return n<(""+Math.round((e-Math.floor(e))*Math.pow(10,n))).length?1:0}function Zb(e){return e<2147483647&&e>-2147483648?""+(e>=0?e|0:e-1|0):""+Math.floor(e)}function an(e,n,a){if(e.charCodeAt(0)===40&&!n.match(d1)){var c=n.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return a>=0?an("n",c,a):"("+an("n",c,-a)+")"}if(n.charCodeAt(n.length-1)===44)return Gb(e,n,a);if(n.indexOf("%")!==-1)return jb(e,n,a);if(n.indexOf("E")!==-1)return u1(n,a);if(n.charCodeAt(0)===36)return"$"+an(e,n.substr(n.charAt(1)==" "?2:1),a);var u,m,x,o,E=Math.abs(a),w=a<0?"-":"";if(n.match(/^00+$/))return w+fl(E,n.length);if(n.match(/^[#?]+$/))return u=fl(a,0),u==="0"&&(u=""),u.length>n.length?u:bi(n.substr(0,n.length-u.length))+u;if(m=n.match(h1))return Hb(m,E,w);if(n.match(/^#+0+$/))return w+fl(E,n.length-n.indexOf("0"));if(m=n.match(f1))return u=Lm(a,m[1].length).replace(/^([^\.]+)$/,"$1."+bi(m[1])).replace(/\.$/,"."+bi(m[1])).replace(/\.(\d*)$/,function(U,z){return"."+z+fa("0",bi(m[1]).length-z.length)}),n.indexOf("0.")!==-1?u:u.replace(/^0\./,".");if(n=n.replace(/^#+([0.])/,"$1"),m=n.match(/^(0*)\.(#*)$/))return w+Lm(E,m[2].length).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,m[1].length?"0.":".");if(m=n.match(/^#{1,3},##0(\.?)$/))return w+Ds(fl(E,0));if(m=n.match(/^#,##0\.([#0]*0)$/))return a<0?"-"+an(e,n,-a):Ds(""+(Math.floor(a)+Wb(a,m[1].length)))+"."+Sn(Rm(a,m[1].length),m[1].length);if(m=n.match(/^#,#*,#0/))return an(e,n.replace(/^#,#*,/,""),a);if(m=n.match(/^([0#]+)(\\?-([0#]+))+$/))return u=ml(an(e,n.replace(/[\\-]/g,""),a)),x=0,ml(ml(n.replace(/\\/g,"")).replace(/[0#]/g,function(U){return x<u.length?u.charAt(x++):U==="0"?"0":""}));if(n.match(p1))return u=an(e,"##########",a),"("+u.substr(0,3)+") "+u.substr(3,3)+"-"+u.substr(6);var C="";if(m=n.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return x=Math.min(m[4].length,7),o=Oh(E,Math.pow(10,x)-1,!1),u=""+w,C=ss("n",m[1],o[1]),C.charAt(C.length-1)==" "&&(C=C.substr(0,C.length-1)+"0"),u+=C+m[2]+"/"+m[3],C=Lh(o[2],x),C.length<m[4].length&&(C=bi(m[4].substr(m[4].length-C.length))+C),u+=C,u;if(m=n.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return x=Math.min(Math.max(m[1].length,m[4].length),7),o=Oh(E,Math.pow(10,x)-1,!0),w+(o[0]||(o[1]?"":"0"))+" "+(o[1]?X0(o[1],x)+m[2]+"/"+m[3]+Lh(o[2],x):fa(" ",2*x+1+m[2].length+m[3].length));if(m=n.match(/^[#0?]+$/))return u=fl(a,0),n.length<=u.length?u:bi(n.substr(0,n.length-u.length))+u;if(m=n.match(/^([#0?]+)\.([#0]+)$/)){u=""+a.toFixed(Math.min(m[2].length,10)).replace(/([^0])0+$/,"$1"),x=u.indexOf(".");var P=n.indexOf(".")-x,M=n.length-u.length-P;return bi(n.substr(0,P)+u+n.substr(n.length-M))}if(m=n.match(/^00,000\.([#0]*0)$/))return x=Rm(a,m[1].length),a<0?"-"+an(e,n,-a):Ds(Zb(a)).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(U){return"00,"+(U.length<3?Sn(0,3-U.length):"")+U})+"."+Sn(x,m[1].length);switch(n){case"###,##0.00":return an(e,"#,##0.00",a);case"###,###":case"##,###":case"#,###":var O=Ds(fl(E,0));return O!=="0"?w+O:"";case"###,###.00":return an(e,"###,##0.00",a).replace(/^0\./,".");case"#,###.00":return an(e,"#,##0.00",a).replace(/^0\./,".")}throw new Error("unsupported format |"+n+"|")}function Xb(e,n,a){for(var c=n.length-1;n.charCodeAt(c-1)===44;)--c;return ss(e,n.substr(0,c),a/Math.pow(10,3*(n.length-c)))}function Kb(e,n,a){var c=n.replace(c1,""),u=n.length-c.length;return ss(e,c,a*Math.pow(10,2*u))+fa("%",u)}function m1(e,n){var a,c=e.indexOf("E")-e.indexOf(".")-1;if(e.match(/^#+0.0E\+0$/)){if(n==0)return"0.0E+0";if(n<0)return"-"+m1(e,-n);var u=e.indexOf(".");u===-1&&(u=e.indexOf("E"));var m=Math.floor(Math.log(n)*Math.LOG10E)%u;if(m<0&&(m+=u),a=(n/Math.pow(10,m)).toPrecision(c+1+(u+m)%u),!a.match(/[Ee]/)){var x=Math.floor(Math.log(n)*Math.LOG10E);a.indexOf(".")===-1?a=a.charAt(0)+"."+a.substr(1)+"E+"+(x-a.length+m):a+="E+"+(x-m),a=a.replace(/\+-/,"-")}a=a.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(o,E,w,C){return E+w+C.substr(0,(u+m)%u)+"."+C.substr(m)+"E"})}else a=n.toExponential(c);return e.match(/E\+00$/)&&a.match(/e[+-]\d$/)&&(a=a.substr(0,a.length-1)+"0"+a.charAt(a.length-1)),e.match(/E\-/)&&a.match(/e\+/)&&(a=a.replace(/e\+/,"e")),a.replace("e","E")}function Bn(e,n,a){if(e.charCodeAt(0)===40&&!n.match(d1)){var c=n.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return a>=0?Bn("n",c,a):"("+Bn("n",c,-a)+")"}if(n.charCodeAt(n.length-1)===44)return Xb(e,n,a);if(n.indexOf("%")!==-1)return Kb(e,n,a);if(n.indexOf("E")!==-1)return m1(n,a);if(n.charCodeAt(0)===36)return"$"+Bn(e,n.substr(n.charAt(1)==" "?2:1),a);var u,m,x,o,E=Math.abs(a),w=a<0?"-":"";if(n.match(/^00+$/))return w+Sn(E,n.length);if(n.match(/^[#?]+$/))return u=""+a,a===0&&(u=""),u.length>n.length?u:bi(n.substr(0,n.length-u.length))+u;if(m=n.match(h1))return qb(m,E,w);if(n.match(/^#+0+$/))return w+Sn(E,n.length-n.indexOf("0"));if(m=n.match(f1))return u=(""+a).replace(/^([^\.]+)$/,"$1."+bi(m[1])).replace(/\.$/,"."+bi(m[1])),u=u.replace(/\.(\d*)$/,function(U,z){return"."+z+fa("0",bi(m[1]).length-z.length)}),n.indexOf("0.")!==-1?u:u.replace(/^0\./,".");if(n=n.replace(/^#+([0.])/,"$1"),m=n.match(/^(0*)\.(#*)$/))return w+(""+E).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,m[1].length?"0.":".");if(m=n.match(/^#{1,3},##0(\.?)$/))return w+Ds(""+E);if(m=n.match(/^#,##0\.([#0]*0)$/))return a<0?"-"+Bn(e,n,-a):Ds(""+a)+"."+fa("0",m[1].length);if(m=n.match(/^#,#*,#0/))return Bn(e,n.replace(/^#,#*,/,""),a);if(m=n.match(/^([0#]+)(\\?-([0#]+))+$/))return u=ml(Bn(e,n.replace(/[\\-]/g,""),a)),x=0,ml(ml(n.replace(/\\/g,"")).replace(/[0#]/g,function(U){return x<u.length?u.charAt(x++):U==="0"?"0":""}));if(n.match(p1))return u=Bn(e,"##########",a),"("+u.substr(0,3)+") "+u.substr(3,3)+"-"+u.substr(6);var C="";if(m=n.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return x=Math.min(m[4].length,7),o=Oh(E,Math.pow(10,x)-1,!1),u=""+w,C=ss("n",m[1],o[1]),C.charAt(C.length-1)==" "&&(C=C.substr(0,C.length-1)+"0"),u+=C+m[2]+"/"+m[3],C=Lh(o[2],x),C.length<m[4].length&&(C=bi(m[4].substr(m[4].length-C.length))+C),u+=C,u;if(m=n.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return x=Math.min(Math.max(m[1].length,m[4].length),7),o=Oh(E,Math.pow(10,x)-1,!0),w+(o[0]||(o[1]?"":"0"))+" "+(o[1]?X0(o[1],x)+m[2]+"/"+m[3]+Lh(o[2],x):fa(" ",2*x+1+m[2].length+m[3].length));if(m=n.match(/^[#0?]+$/))return u=""+a,n.length<=u.length?u:bi(n.substr(0,n.length-u.length))+u;if(m=n.match(/^([#0]+)\.([#0]+)$/)){u=""+a.toFixed(Math.min(m[2].length,10)).replace(/([^0])0+$/,"$1"),x=u.indexOf(".");var P=n.indexOf(".")-x,M=n.length-u.length-P;return bi(n.substr(0,P)+u+n.substr(n.length-M))}if(m=n.match(/^00,000\.([#0]*0)$/))return a<0?"-"+Bn(e,n,-a):Ds(""+a).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(U){return"00,"+(U.length<3?Sn(0,3-U.length):"")+U})+"."+Sn(0,m[1].length);switch(n){case"###,###":case"##,###":case"#,###":var O=Ds(""+E);return O!=="0"?w+O:"";default:if(n.match(/\.[0#?]*$/))return Bn(e,n.slice(0,n.lastIndexOf(".")),a)+bi(n.slice(n.lastIndexOf(".")))}throw new Error("unsupported format |"+n+"|")}function ss(e,n,a){return(a|0)===a?Bn(e,n,a):an(e,n,a)}function Yb(e){for(var n=[],a=!1,c=0,u=0;c<e.length;++c)switch(e.charCodeAt(c)){case 34:a=!a;break;case 95:case 42:case 92:++c;break;case 59:n[n.length]=e.substr(u,c-u),u=c+1}if(n[n.length]=e.substr(u),a===!0)throw new Error("Format |"+e+"| unterminated string ");return n}var g1=/\[[HhMmSs\u0E0A\u0E19\u0E17]*\]/;function El(e){for(var n=0,a="",c="";n<e.length;)switch(a=e.charAt(n)){case"G":Rh(e,n)&&(n+=6),n++;break;case'"':for(;e.charCodeAt(++n)!==34&&n<e.length;);++n;break;case"\\":n+=2;break;case"_":n+=2;break;case"@":++n;break;case"B":case"b":if(e.charAt(n+1)==="1"||e.charAt(n+1)==="2")return!0;case"M":case"D":case"Y":case"H":case"S":case"E":case"m":case"d":case"y":case"h":case"s":case"e":case"g":return!0;case"A":case"a":case"上":if(e.substr(n,3).toUpperCase()==="A/P"||e.substr(n,5).toUpperCase()==="AM/PM"||e.substr(n,5).toUpperCase()==="上午/下午")return!0;++n;break;case"[":for(c=a;e.charAt(n++)!=="]"&&n<e.length;)c+=e.charAt(n);if(c.match(g1))return!0;break;case".":case"0":case"#":for(;n<e.length&&("0#?.,E+-%".indexOf(a=e.charAt(++n))>-1||a=="\\"&&e.charAt(n+1)=="-"&&"0#".indexOf(e.charAt(n+2))>-1););break;case"?":for(;e.charAt(++n)===a;);break;case"*":++n,(e.charAt(n)==" "||e.charAt(n)=="*")&&++n;break;case"(":case")":++n;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(;n<e.length&&"0123456789".indexOf(e.charAt(++n))>-1;);break;case" ":++n;break;default:++n;break}return!1}function Jb(e,n,a,c){for(var u=[],m="",x=0,o="",E="t",w,C,P,M="H";x<e.length;)switch(o=e.charAt(x)){case"G":if(!Rh(e,x))throw new Error("unrecognized character "+o+" in "+e);u[u.length]={t:"G",v:"General"},x+=7;break;case'"':for(m="";(P=e.charCodeAt(++x))!==34&&x<e.length;)m+=String.fromCharCode(P);u[u.length]={t:"t",v:m},++x;break;case"\\":var O=e.charAt(++x),U=O==="("||O===")"?O:"t";u[u.length]={t:U,v:O},++x;break;case"_":u[u.length]={t:"t",v:" "},x+=2;break;case"@":u[u.length]={t:"T",v:n},++x;break;case"B":case"b":if(e.charAt(x+1)==="1"||e.charAt(x+1)==="2"){if(w==null&&(w=fo(n,a,e.charAt(x+1)==="2"),w==null))return"";u[u.length]={t:"X",v:e.substr(x,2)},E=o,x+=2;break}case"M":case"D":case"Y":case"H":case"S":case"E":o=o.toLowerCase();case"m":case"d":case"y":case"h":case"s":case"e":case"g":if(n<0||w==null&&(w=fo(n,a),w==null))return"";for(m=o;++x<e.length&&e.charAt(x).toLowerCase()===o;)m+=o;o==="m"&&E.toLowerCase()==="h"&&(o="M"),o==="h"&&(o=M),u[u.length]={t:o,v:m},E=o;break;case"A":case"a":case"上":var z={t:o,v:o};if(w==null&&(w=fo(n,a)),e.substr(x,3).toUpperCase()==="A/P"?(w!=null&&(z.v=w.H>=12?"P":"A"),z.t="T",M="h",x+=3):e.substr(x,5).toUpperCase()==="AM/PM"?(w!=null&&(z.v=w.H>=12?"PM":"AM"),z.t="T",x+=5,M="h"):e.substr(x,5).toUpperCase()==="上午/下午"?(w!=null&&(z.v=w.H>=12?"下午":"上午"),z.t="T",x+=5,M="h"):(z.t="t",++x),w==null&&z.t==="T")return"";u[u.length]=z,E=o;break;case"[":for(m=o;e.charAt(x++)!=="]"&&x<e.length;)m+=e.charAt(x);if(m.slice(-1)!=="]")throw'unterminated "[" block: |'+m+"|";if(m.match(g1)){if(w==null&&(w=fo(n,a),w==null))return"";u[u.length]={t:"Z",v:m.toLowerCase()},E=m.charAt(1)}else m.indexOf("$")>-1&&(m=(m.match(/\$([^-\[\]]*)/)||[])[1]||"$",El(e)||(u[u.length]={t:"t",v:m}));break;case".":if(w!=null){for(m=o;++x<e.length&&(o=e.charAt(x))==="0";)m+=o;u[u.length]={t:"s",v:m};break}case"0":case"#":for(m=o;++x<e.length&&"0#?.,E+-%".indexOf(o=e.charAt(x))>-1;)m+=o;u[u.length]={t:"n",v:m};break;case"?":for(m=o;e.charAt(++x)===o;)m+=o;u[u.length]={t:o,v:m},E=o;break;case"*":++x,(e.charAt(x)==" "||e.charAt(x)=="*")&&++x;break;case"(":case")":u[u.length]={t:c===1?"t":o,v:o},++x;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(m=o;x<e.length&&"0123456789".indexOf(e.charAt(++x))>-1;)m+=e.charAt(x);u[u.length]={t:"D",v:m};break;case" ":u[u.length]={t:o,v:o},++x;break;case"$":u[u.length]={t:"t",v:"$"},++x;break;default:if(",$-+/():!^&'~{}<>=€acfijklopqrtuvwxzP".indexOf(o)===-1)throw new Error("unrecognized character "+o+" in "+e);u[u.length]={t:"t",v:o},++x;break}var j=0,ee=0,le;for(x=u.length-1,E="t";x>=0;--x)switch(u[x].t){case"h":case"H":u[x].t=M,E="h",j<1&&(j=1);break;case"s":(le=u[x].v.match(/\.0+$/))&&(ee=Math.max(ee,le[0].length-1)),j<3&&(j=3);case"d":case"y":case"M":case"e":E=u[x].t;break;case"m":E==="s"&&(u[x].t="M",j<2&&(j=2));break;case"X":break;case"Z":j<1&&u[x].v.match(/[Hh]/)&&(j=1),j<2&&u[x].v.match(/[Mm]/)&&(j=2),j<3&&u[x].v.match(/[Ss]/)&&(j=3)}switch(j){case 0:break;case 1:w.u>=.5&&(w.u=0,++w.S),w.S>=60&&(w.S=0,++w.M),w.M>=60&&(w.M=0,++w.H);break;case 2:w.u>=.5&&(w.u=0,++w.S),w.S>=60&&(w.S=0,++w.M);break}var Z="",fe;for(x=0;x<u.length;++x)switch(u[x].t){case"t":case"T":case" ":case"D":break;case"X":u[x].v="",u[x].t=";";break;case"d":case"m":case"y":case"h":case"H":case"M":case"s":case"e":case"b":case"Z":u[x].v=$b(u[x].t.charCodeAt(0),u[x].v,w,ee),u[x].t="t";break;case"n":case"?":for(fe=x+1;u[fe]!=null&&((o=u[fe].t)==="?"||o==="D"||(o===" "||o==="t")&&u[fe+1]!=null&&(u[fe+1].t==="?"||u[fe+1].t==="t"&&u[fe+1].v==="/")||u[x].t==="("&&(o===" "||o==="n"||o===")")||o==="t"&&(u[fe].v==="/"||u[fe].v===" "&&u[fe+1]!=null&&u[fe+1].t=="?"));)u[x].v+=u[fe].v,u[fe]={v:"",t:";"},++fe;Z+=u[x].v,x=fe-1;break;case"G":u[x].t="t",u[x].v=_o(n,a);break}var me="",Te,re;if(Z.length>0){Z.charCodeAt(0)==40?(Te=n<0&&Z.charCodeAt(0)===45?-n:n,re=ss("n",Z,Te)):(Te=n<0&&c>1?-n:n,re=ss("n",Z,Te),Te<0&&u[0]&&u[0].t=="t"&&(re=re.substr(1),u[0].v="-"+u[0].v)),fe=re.length-1;var Ce=u.length;for(x=0;x<u.length;++x)if(u[x]!=null&&u[x].t!="t"&&u[x].v.indexOf(".")>-1){Ce=x;break}var be=u.length;if(Ce===u.length&&re.indexOf("E")===-1){for(x=u.length-1;x>=0;--x)u[x]==null||"n?".indexOf(u[x].t)===-1||(fe>=u[x].v.length-1?(fe-=u[x].v.length,u[x].v=re.substr(fe+1,u[x].v.length)):fe<0?u[x].v="":(u[x].v=re.substr(0,fe+1),fe=-1),u[x].t="t",be=x);fe>=0&&be<u.length&&(u[be].v=re.substr(0,fe+1)+u[be].v)}else if(Ce!==u.length&&re.indexOf("E")===-1){for(fe=re.indexOf(".")-1,x=Ce;x>=0;--x)if(!(u[x]==null||"n?".indexOf(u[x].t)===-1)){for(C=u[x].v.indexOf(".")>-1&&x===Ce?u[x].v.indexOf(".")-1:u[x].v.length-1,me=u[x].v.substr(C+1);C>=0;--C)fe>=0&&(u[x].v.charAt(C)==="0"||u[x].v.charAt(C)==="#")&&(me=re.charAt(fe--)+me);u[x].v=me,u[x].t="t",be=x}for(fe>=0&&be<u.length&&(u[be].v=re.substr(0,fe+1)+u[be].v),fe=re.indexOf(".")+1,x=Ce;x<u.length;++x)if(!(u[x]==null||"n?(".indexOf(u[x].t)===-1&&x!==Ce)){for(C=u[x].v.indexOf(".")>-1&&x===Ce?u[x].v.indexOf(".")+1:0,me=u[x].v.substr(0,C);C<u[x].v.length;++C)fe<re.length&&(me+=re.charAt(fe++));u[x].v=me,u[x].t="t",be=x}}}for(x=0;x<u.length;++x)u[x]!=null&&"n?".indexOf(u[x].t)>-1&&(Te=c>1&&n<0&&x>0&&u[x-1].v==="-"?-n:n,u[x].v=ss(u[x].t,u[x].v,Te),u[x].t="t");var Fe="";for(x=0;x!==u.length;++x)u[x]!=null&&(Fe+=u[x].v);return Fe}var Om=/\[(=|>[=]?|<[>=]?)(-?\d+(?:\.\d*)?)\]/;function Bm(e,n){if(n==null)return!1;var a=parseFloat(n[2]);switch(n[1]){case"=":if(e==a)return!0;break;case">":if(e>a)return!0;break;case"<":if(e<a)return!0;break;case"<>":if(e!=a)return!0;break;case">=":if(e>=a)return!0;break;case"<=":if(e<=a)return!0;break}return!1}function Qb(e,n){var a=Yb(e),c=a.length,u=a[c-1].indexOf("@");if(c<4&&u>-1&&--c,a.length>4)throw new Error("cannot find right format for |"+a.join("|")+"|");if(typeof n!="number")return[4,a.length===4||u>-1?a[a.length-1]:"@"];switch(a.length){case 1:a=u>-1?["General","General","General",a[0]]:[a[0],a[0],a[0],"@"];break;case 2:a=u>-1?[a[0],a[0],a[0],a[1]]:[a[0],a[1],a[0],"@"];break;case 3:a=u>-1?[a[0],a[1],a[0],a[2]]:[a[0],a[1],a[2],"@"];break}var m=n>0?a[0]:n<0?a[1]:a[2];if(a[0].indexOf("[")===-1&&a[1].indexOf("[")===-1)return[c,m];if(a[0].match(/\[[=<>]/)!=null||a[1].match(/\[[=<>]/)!=null){var x=a[0].match(Om),o=a[1].match(Om);return Bm(n,x)?[c,a[0]]:Bm(n,o)?[c,a[1]]:[c,a[x!=null&&o!=null?2:1]]}return[c,m]}function on(e,n,a){a==null&&(a={});var c="";switch(typeof e){case"string":e=="m/d/yy"&&a.dateNF?c=a.dateNF:c=e;break;case"number":e==14&&a.dateNF?c=a.dateNF:c=(a.table!=null?a.table:fr)[e],c==null&&(c=a.table&&a.table[Dm[e]]||fr[Dm[e]]),c==null&&(c=Rb[e]||"General");break}if(Rh(c,0))return _o(n,a);n instanceof Date&&(n=l1(n,a.date1904));var u=Qb(c,n);if(Rh(u[1]))return _o(n,a);if(n===!0)n="TRUE";else if(n===!1)n="FALSE";else if(n===""||n==null)return"";return Jb(u[1],n,a,u[0])}function go(e,n){if(typeof n!="number"){n=+n||-1;for(var a=0;a<392;++a){if(fr[a]==null){n<0&&(n=a);continue}if(fr[a]==e){n=a;break}}n<0&&(n=391)}return fr[n]=e,n}function x1(){fr=Lb()}var eT={5:'"$"#,##0_);\\("$"#,##0\\)',6:'"$"#,##0_);[Red]\\("$"#,##0\\)',7:'"$"#,##0.00_);\\("$"#,##0.00\\)',8:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',23:"General",24:"General",25:"General",26:"General",27:"m/d/yy",28:"m/d/yy",29:"m/d/yy",30:"m/d/yy",31:"m/d/yy",32:"h:mm:ss",33:"h:mm:ss",34:"h:mm:ss",35:"h:mm:ss",36:"m/d/yy",41:'_(* #,##0_);_(* (#,##0);_(* "-"_);_(@_)',42:'_("$"* #,##0_);_("$"* (#,##0);_("$"* "-"_);_(@_)',43:'_(* #,##0.00_);_(* (#,##0.00);_(* "-"??_);_(@_)',44:'_("$"* #,##0.00_);_("$"* (#,##0.00);_("$"* "-"??_);_(@_)',50:"m/d/yy",51:"m/d/yy",52:"m/d/yy",53:"m/d/yy",54:"m/d/yy",55:"m/d/yy",56:"m/d/yy",57:"m/d/yy",58:"m/d/yy",59:"0",60:"0.00",61:"#,##0",62:"#,##0.00",63:'"$"#,##0_);\\("$"#,##0\\)',64:'"$"#,##0_);[Red]\\("$"#,##0\\)',65:'"$"#,##0.00_);\\("$"#,##0.00\\)',66:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',67:"0%",68:"0.00%",69:"# ?/?",70:"# ??/??",71:"m/d/yy",72:"m/d/yy",73:"d-mmm-yy",74:"d-mmm",75:"mmm-yy",76:"h:mm",77:"h:mm:ss",78:"m/d/yy h:mm",79:"mm:ss",80:"[h]:mm:ss",81:"mmss.0"},_1=/[dD]+|[mM]+|[yYeE]+|[Hh]+|[Ss]+/g;function tT(e){var n=typeof e=="number"?fr[e]:e;return n=n.replace(_1,"(\\d+)"),new RegExp("^"+n+"$")}function rT(e,n,a){var c=-1,u=-1,m=-1,x=-1,o=-1,E=-1;(n.match(_1)||[]).forEach(function(P,M){var O=parseInt(a[M+1],10);switch(P.toLowerCase().charAt(0)){case"y":c=O;break;case"d":m=O;break;case"h":x=O;break;case"s":E=O;break;case"m":x>=0?o=O:u=O;break}}),E>=0&&o==-1&&u>=0&&(o=u,u=-1);var w=(""+(c>=0?c:new Date().getFullYear())).slice(-4)+"-"+("00"+(u>=1?u:1)).slice(-2)+"-"+("00"+(m>=1?m:1)).slice(-2);w.length==7&&(w="0"+w),w.length==8&&(w="20"+w);var C=("00"+(x>=0?x:0)).slice(-2)+":"+("00"+(o>=0?o:0)).slice(-2)+":"+("00"+(E>=0?E:0)).slice(-2);return x==-1&&o==-1&&E==-1?w:c==-1&&u==-1&&m==-1?C:w+"T"+C}var aT=function(){var e={};e.version="1.2.0";function n(){for(var re=0,Ce=new Array(256),be=0;be!=256;++be)re=be,re=re&1?-306674912^re>>>1:re>>>1,re=re&1?-306674912^re>>>1:re>>>1,re=re&1?-306674912^re>>>1:re>>>1,re=re&1?-306674912^re>>>1:re>>>1,re=re&1?-306674912^re>>>1:re>>>1,re=re&1?-306674912^re>>>1:re>>>1,re=re&1?-306674912^re>>>1:re>>>1,re=re&1?-306674912^re>>>1:re>>>1,Ce[be]=re;return typeof Int32Array<"u"?new Int32Array(Ce):Ce}var a=n();function c(re){var Ce=0,be=0,Fe=0,Oe=typeof Int32Array<"u"?new Int32Array(4096):new Array(4096);for(Fe=0;Fe!=256;++Fe)Oe[Fe]=re[Fe];for(Fe=0;Fe!=256;++Fe)for(be=re[Fe],Ce=256+Fe;Ce<4096;Ce+=256)be=Oe[Ce]=be>>>8^re[be&255];var Me=[];for(Fe=1;Fe!=16;++Fe)Me[Fe-1]=typeof Int32Array<"u"?Oe.subarray(Fe*256,Fe*256+256):Oe.slice(Fe*256,Fe*256+256);return Me}var u=c(a),m=u[0],x=u[1],o=u[2],E=u[3],w=u[4],C=u[5],P=u[6],M=u[7],O=u[8],U=u[9],z=u[10],j=u[11],ee=u[12],le=u[13],Z=u[14];function fe(re,Ce){for(var be=Ce^-1,Fe=0,Oe=re.length;Fe<Oe;)be=be>>>8^a[(be^re.charCodeAt(Fe++))&255];return~be}function me(re,Ce){for(var be=Ce^-1,Fe=re.length-15,Oe=0;Oe<Fe;)be=Z[re[Oe++]^be&255]^le[re[Oe++]^be>>8&255]^ee[re[Oe++]^be>>16&255]^j[re[Oe++]^be>>>24]^z[re[Oe++]]^U[re[Oe++]]^O[re[Oe++]]^M[re[Oe++]]^P[re[Oe++]]^C[re[Oe++]]^w[re[Oe++]]^E[re[Oe++]]^o[re[Oe++]]^x[re[Oe++]]^m[re[Oe++]]^a[re[Oe++]];for(Fe+=15;Oe<Fe;)be=be>>>8^a[(be^re[Oe++])&255];return~be}function Te(re,Ce){for(var be=Ce^-1,Fe=0,Oe=re.length,Me=0,rt=0;Fe<Oe;)Me=re.charCodeAt(Fe++),Me<128?be=be>>>8^a[(be^Me)&255]:Me<2048?(be=be>>>8^a[(be^(192|Me>>6&31))&255],be=be>>>8^a[(be^(128|Me&63))&255]):Me>=55296&&Me<57344?(Me=(Me&1023)+64,rt=re.charCodeAt(Fe++)&1023,be=be>>>8^a[(be^(240|Me>>8&7))&255],be=be>>>8^a[(be^(128|Me>>2&63))&255],be=be>>>8^a[(be^(128|rt>>6&15|(Me&3)<<4))&255],be=be>>>8^a[(be^(128|rt&63))&255]):(be=be>>>8^a[(be^(224|Me>>12&15))&255],be=be>>>8^a[(be^(128|Me>>6&63))&255],be=be>>>8^a[(be^(128|Me&63))&255]);return~be}return e.table=a,e.bstr=fe,e.buf=me,e.str=Te,e}(),br=function(){var n={};n.version="1.2.1";function a(N,J){for(var Y=N.split("/"),K=J.split("/"),Q=0,ae=0,Ve=Math.min(Y.length,K.length);Q<Ve;++Q){if(ae=Y[Q].length-K[Q].length)return ae;if(Y[Q]!=K[Q])return Y[Q]<K[Q]?-1:1}return Y.length-K.length}function c(N){if(N.charAt(N.length-1)=="/")return N.slice(0,-1).indexOf("/")===-1?N:c(N.slice(0,-1));var J=N.lastIndexOf("/");return J===-1?N:N.slice(0,J+1)}function u(N){if(N.charAt(N.length-1)=="/")return u(N.slice(0,-1));var J=N.lastIndexOf("/");return J===-1?N:N.slice(J+1)}function m(N,J){typeof J=="string"&&(J=new Date(J));var Y=J.getHours();Y=Y<<6|J.getMinutes(),Y=Y<<5|J.getSeconds()>>>1,N.write_shift(2,Y);var K=J.getFullYear()-1980;K=K<<4|J.getMonth()+1,K=K<<5|J.getDate(),N.write_shift(2,K)}function x(N){var J=N.read_shift(2)&65535,Y=N.read_shift(2)&65535,K=new Date,Q=Y&31;Y>>>=5;var ae=Y&15;Y>>>=4,K.setMilliseconds(0),K.setFullYear(Y+1980),K.setMonth(ae-1),K.setDate(Q);var Ve=J&31;J>>>=5;var Ze=J&63;return J>>>=6,K.setHours(J),K.setMinutes(Ze),K.setSeconds(Ve<<1),K}function o(N){Za(N,0);for(var J={},Y=0;N.l<=N.length-4;){var K=N.read_shift(2),Q=N.read_shift(2),ae=N.l+Q,Ve={};switch(K){case 21589:Y=N.read_shift(1),Y&1&&(Ve.mtime=N.read_shift(4)),Q>5&&(Y&2&&(Ve.atime=N.read_shift(4)),Y&4&&(Ve.ctime=N.read_shift(4))),Ve.mtime&&(Ve.mt=new Date(Ve.mtime*1e3));break}N.l=ae,J[K]=Ve}return J}var E;function w(){return E||(E={})}function C(N,J){if(N[0]==80&&N[1]==75)return Br(N,J);if((N[0]|32)==109&&(N[1]|32)==105)return xe(N,J);if(N.length<512)throw new Error("CFB file size "+N.length+" < 512");var Y=3,K=512,Q=0,ae=0,Ve=0,Ze=0,ze=0,Ue=[],je=N.slice(0,512);Za(je,0);var it=P(je);switch(Y=it[0],Y){case 3:K=512;break;case 4:K=4096;break;case 0:if(it[1]==0)return Br(N,J);default:throw new Error("Major Version: Expected 3 or 4 saw "+Y)}K!==512&&(je=N.slice(0,K),Za(je,28));var gt=N.slice(0,K);M(je,Y);var St=je.read_shift(4,"i");if(Y===3&&St!==0)throw new Error("# Directory Sectors: Expected 0 saw "+St);je.l+=4,Ve=je.read_shift(4,"i"),je.l+=4,je.chk("00100000","Mini Stream Cutoff Size: "),Ze=je.read_shift(4,"i"),Q=je.read_shift(4,"i"),ze=je.read_shift(4,"i"),ae=je.read_shift(4,"i");for(var mt=-1,Ft=0;Ft<109&&(mt=je.read_shift(4,"i"),!(mt<0));++Ft)Ue[Ft]=mt;var Jt=O(N,K);j(ze,ae,Jt,K,Ue);var Cr=le(Jt,Ve,Ue,K);Cr[Ve].name="!Directory",Q>0&&Ze!==rt&&(Cr[Ze].name="!MiniFAT"),Cr[Ue[0]].name="!FAT",Cr.fat_addrs=Ue,Cr.ssz=K;var zr={},tr=[],cn=[],Wi=[];Z(Ve,Cr,Jt,tr,Q,zr,cn,Ze),U(cn,Wi,tr),tr.shift();var Jr={FileIndex:cn,FullPaths:Wi};return J&&J.raw&&(Jr.raw={header:gt,sectors:Jt}),Jr}function P(N){if(N[N.l]==80&&N[N.l+1]==75)return[0,0];N.chk(ft,"Header Signature: "),N.l+=16;var J=N.read_shift(2,"u");return[N.read_shift(2,"u"),J]}function M(N,J){var Y=9;switch(N.l+=2,Y=N.read_shift(2)){case 9:if(J!=3)throw new Error("Sector Shift: Expected 9 saw "+Y);break;case 12:if(J!=4)throw new Error("Sector Shift: Expected 12 saw "+Y);break;default:throw new Error("Sector Shift: Expected 9 or 12 saw "+Y)}N.chk("0600","Mini Sector Shift: "),N.chk("000000000000","Reserved: ")}function O(N,J){for(var Y=Math.ceil(N.length/J)-1,K=[],Q=1;Q<Y;++Q)K[Q-1]=N.slice(Q*J,(Q+1)*J);return K[Y-1]=N.slice(Y*J),K}function U(N,J,Y){for(var K=0,Q=0,ae=0,Ve=0,Ze=0,ze=Y.length,Ue=[],je=[];K<ze;++K)Ue[K]=je[K]=K,J[K]=Y[K];for(;Ze<je.length;++Ze)K=je[Ze],Q=N[K].L,ae=N[K].R,Ve=N[K].C,Ue[K]===K&&(Q!==-1&&Ue[Q]!==Q&&(Ue[K]=Ue[Q]),ae!==-1&&Ue[ae]!==ae&&(Ue[K]=Ue[ae])),Ve!==-1&&(Ue[Ve]=K),Q!==-1&&K!=Ue[K]&&(Ue[Q]=Ue[K],je.lastIndexOf(Q)<Ze&&je.push(Q)),ae!==-1&&K!=Ue[K]&&(Ue[ae]=Ue[K],je.lastIndexOf(ae)<Ze&&je.push(ae));for(K=1;K<ze;++K)Ue[K]===K&&(ae!==-1&&Ue[ae]!==ae?Ue[K]=Ue[ae]:Q!==-1&&Ue[Q]!==Q&&(Ue[K]=Ue[Q]));for(K=1;K<ze;++K)if(N[K].type!==0){if(Ze=K,Ze!=Ue[Ze])do Ze=Ue[Ze],J[K]=J[Ze]+"/"+J[K];while(Ze!==0&&Ue[Ze]!==-1&&Ze!=Ue[Ze]);Ue[K]=-1}for(J[0]+="/",K=1;K<ze;++K)N[K].type!==2&&(J[K]+="/")}function z(N,J,Y){for(var K=N.start,Q=N.size,ae=[],Ve=K;Y&&Q>0&&Ve>=0;)ae.push(J.slice(Ve*Me,Ve*Me+Me)),Q-=Me,Ve=co(Y,Ve*4);return ae.length===0?Ma(0):Ps(ae).slice(0,N.size)}function j(N,J,Y,K,Q){var ae=rt;if(N===rt){if(J!==0)throw new Error("DIFAT chain shorter than expected")}else if(N!==-1){var Ve=Y[N],Ze=(K>>>2)-1;if(!Ve)return;for(var ze=0;ze<Ze&&(ae=co(Ve,ze*4))!==rt;++ze)Q.push(ae);j(co(Ve,K-4),J-1,Y,K,Q)}}function ee(N,J,Y,K,Q){var ae=[],Ve=[];Q||(Q=[]);var Ze=K-1,ze=0,Ue=0;for(ze=J;ze>=0;){Q[ze]=!0,ae[ae.length]=ze,Ve.push(N[ze]);var je=Y[Math.floor(ze*4/K)];if(Ue=ze*4&Ze,K<4+Ue)throw new Error("FAT boundary crossed: "+ze+" 4 "+K);if(!N[je])break;ze=co(N[je],Ue)}return{nodes:ae,data:Wm([Ve])}}function le(N,J,Y,K){var Q=N.length,ae=[],Ve=[],Ze=[],ze=[],Ue=K-1,je=0,it=0,gt=0,St=0;for(je=0;je<Q;++je)if(Ze=[],gt=je+J,gt>=Q&&(gt-=Q),!Ve[gt]){ze=[];var mt=[];for(it=gt;it>=0;){mt[it]=!0,Ve[it]=!0,Ze[Ze.length]=it,ze.push(N[it]);var Ft=Y[Math.floor(it*4/K)];if(St=it*4&Ue,K<4+St)throw new Error("FAT boundary crossed: "+it+" 4 "+K);if(!N[Ft]||(it=co(N[Ft],St),mt[it]))break}ae[gt]={nodes:Ze,data:Wm([ze])}}return ae}function Z(N,J,Y,K,Q,ae,Ve,Ze){for(var ze=0,Ue=K.length?2:0,je=J[N].data,it=0,gt=0,St;it<je.length;it+=128){var mt=je.slice(it,it+128);Za(mt,64),gt=mt.read_shift(2),St=td(mt,0,gt-Ue),K.push(St);var Ft={name:St,type:mt.read_shift(1),color:mt.read_shift(1),L:mt.read_shift(4,"i"),R:mt.read_shift(4,"i"),C:mt.read_shift(4,"i"),clsid:mt.read_shift(16),state:mt.read_shift(4,"i"),start:0,size:0},Jt=mt.read_shift(2)+mt.read_shift(2)+mt.read_shift(2)+mt.read_shift(2);Jt!==0&&(Ft.ct=fe(mt,mt.l-8));var Cr=mt.read_shift(2)+mt.read_shift(2)+mt.read_shift(2)+mt.read_shift(2);Cr!==0&&(Ft.mt=fe(mt,mt.l-8)),Ft.start=mt.read_shift(4,"i"),Ft.size=mt.read_shift(4,"i"),Ft.size<0&&Ft.start<0&&(Ft.size=Ft.type=0,Ft.start=rt,Ft.name=""),Ft.type===5?(ze=Ft.start,Q>0&&ze!==rt&&(J[ze].name="!StreamData")):Ft.size>=4096?(Ft.storage="fat",J[Ft.start]===void 0&&(J[Ft.start]=ee(Y,Ft.start,J.fat_addrs,J.ssz)),J[Ft.start].name=Ft.name,Ft.content=J[Ft.start].data.slice(0,Ft.size)):(Ft.storage="minifat",Ft.size<0?Ft.size=0:ze!==rt&&Ft.start!==rt&&J[ze]&&(Ft.content=z(Ft,J[ze].data,(J[Ze]||{}).data))),Ft.content&&Za(Ft.content,0),ae[St]=Ft,Ve.push(Ft)}}function fe(N,J){return new Date((Vi(N,J+4)/1e7*Math.pow(2,32)+Vi(N,J)/1e7-11644473600)*1e3)}function me(N,J){return w(),C(E.readFileSync(N),J)}function Te(N,J){var Y=J&&J.type;switch(Y||wr&&Buffer.isBuffer(N)&&(Y="buffer"),Y||"base64"){case"file":return me(N,J);case"base64":return C(bn(qi(N)),J);case"binary":return C(bn(N),J)}return C(N,J)}function re(N,J){var Y=J||{},K=Y.root||"Root Entry";if(N.FullPaths||(N.FullPaths=[]),N.FileIndex||(N.FileIndex=[]),N.FullPaths.length!==N.FileIndex.length)throw new Error("inconsistent CFB structure");N.FullPaths.length===0&&(N.FullPaths[0]=K+"/",N.FileIndex[0]={name:K,type:5}),Y.CLSID&&(N.FileIndex[0].clsid=Y.CLSID),Ce(N)}function Ce(N){var J="Sh33tJ5";if(!br.find(N,"/"+J)){var Y=Ma(4);Y[0]=55,Y[1]=Y[3]=50,Y[2]=54,N.FileIndex.push({name:J,type:2,content:Y,size:4,L:69,R:69,C:69}),N.FullPaths.push(N.FullPaths[0]+J),be(N)}}function be(N,J){re(N);for(var Y=!1,K=!1,Q=N.FullPaths.length-1;Q>=0;--Q){var ae=N.FileIndex[Q];switch(ae.type){case 0:K?Y=!0:(N.FileIndex.pop(),N.FullPaths.pop());break;case 1:case 2:case 5:K=!0,isNaN(ae.R*ae.L*ae.C)&&(Y=!0),ae.R>-1&&ae.L>-1&&ae.R==ae.L&&(Y=!0);break;default:Y=!0;break}}if(!(!Y&&!J)){var Ve=new Date(1987,1,19),Ze=0,ze=Object.create?Object.create(null):{},Ue=[];for(Q=0;Q<N.FullPaths.length;++Q)ze[N.FullPaths[Q]]=!0,N.FileIndex[Q].type!==0&&Ue.push([N.FullPaths[Q],N.FileIndex[Q]]);for(Q=0;Q<Ue.length;++Q){var je=c(Ue[Q][0]);K=ze[je],K||(Ue.push([je,{name:u(je).replace("/",""),type:1,clsid:_t,ct:Ve,mt:Ve,content:null}]),ze[je]=!0)}for(Ue.sort(function(St,mt){return a(St[0],mt[0])}),N.FullPaths=[],N.FileIndex=[],Q=0;Q<Ue.length;++Q)N.FullPaths[Q]=Ue[Q][0],N.FileIndex[Q]=Ue[Q][1];for(Q=0;Q<Ue.length;++Q){var it=N.FileIndex[Q],gt=N.FullPaths[Q];if(it.name=u(gt).replace("/",""),it.L=it.R=it.C=-(it.color=1),it.size=it.content?it.content.length:0,it.start=0,it.clsid=it.clsid||_t,Q===0)it.C=Ue.length>1?1:-1,it.size=0,it.type=5;else if(gt.slice(-1)=="/"){for(Ze=Q+1;Ze<Ue.length&&c(N.FullPaths[Ze])!=gt;++Ze);for(it.C=Ze>=Ue.length?-1:Ze,Ze=Q+1;Ze<Ue.length&&c(N.FullPaths[Ze])!=c(gt);++Ze);it.R=Ze>=Ue.length?-1:Ze,it.type=1}else c(N.FullPaths[Q+1]||"")==c(gt)&&(it.R=Q+1),it.type=2}}}function Fe(N,J){var Y=J||{};if(Y.fileType=="mad")return Be(N,Y);switch(be(N),Y.fileType){case"zip":return er(N,Y)}var K=function(St){for(var mt=0,Ft=0,Jt=0;Jt<St.FileIndex.length;++Jt){var Cr=St.FileIndex[Jt];if(Cr.content){var zr=Cr.content.length;zr>0&&(zr<4096?mt+=zr+63>>6:Ft+=zr+511>>9)}}for(var tr=St.FullPaths.length+3>>2,cn=mt+7>>3,Wi=mt+127>>7,Jr=cn+Ft+tr+Wi,na=Jr+127>>7,Vs=na<=109?0:Math.ceil((na-109)/127);Jr+na+Vs+127>>7>na;)Vs=++na<=109?0:Math.ceil((na-109)/127);var Qr=[1,Vs,na,Wi,tr,Ft,mt,0];return St.FileIndex[0].size=mt<<6,Qr[7]=(St.FileIndex[0].start=Qr[0]+Qr[1]+Qr[2]+Qr[3]+Qr[4]+Qr[5])+(Qr[6]+7>>3),Qr}(N),Q=Ma(K[7]<<9),ae=0,Ve=0;{for(ae=0;ae<8;++ae)Q.write_shift(1,lt[ae]);for(ae=0;ae<8;++ae)Q.write_shift(2,0);for(Q.write_shift(2,62),Q.write_shift(2,3),Q.write_shift(2,65534),Q.write_shift(2,9),Q.write_shift(2,6),ae=0;ae<3;++ae)Q.write_shift(2,0);for(Q.write_shift(4,0),Q.write_shift(4,K[2]),Q.write_shift(4,K[0]+K[1]+K[2]+K[3]-1),Q.write_shift(4,0),Q.write_shift(4,4096),Q.write_shift(4,K[3]?K[0]+K[1]+K[2]-1:rt),Q.write_shift(4,K[3]),Q.write_shift(-4,K[1]?K[0]-1:rt),Q.write_shift(4,K[1]),ae=0;ae<109;++ae)Q.write_shift(-4,ae<K[2]?K[1]+ae:-1)}if(K[1])for(Ve=0;Ve<K[1];++Ve){for(;ae<236+Ve*127;++ae)Q.write_shift(-4,ae<K[2]?K[1]+ae:-1);Q.write_shift(-4,Ve===K[1]-1?rt:Ve+1)}var Ze=function(St){for(Ve+=St;ae<Ve-1;++ae)Q.write_shift(-4,ae+1);St&&(++ae,Q.write_shift(-4,rt))};for(Ve=ae=0,Ve+=K[1];ae<Ve;++ae)Q.write_shift(-4,nt.DIFSECT);for(Ve+=K[2];ae<Ve;++ae)Q.write_shift(-4,nt.FATSECT);Ze(K[3]),Ze(K[4]);for(var ze=0,Ue=0,je=N.FileIndex[0];ze<N.FileIndex.length;++ze)je=N.FileIndex[ze],je.content&&(Ue=je.content.length,!(Ue<4096)&&(je.start=Ve,Ze(Ue+511>>9)));for(Ze(K[6]+7>>3);Q.l&511;)Q.write_shift(-4,nt.ENDOFCHAIN);for(Ve=ae=0,ze=0;ze<N.FileIndex.length;++ze)je=N.FileIndex[ze],je.content&&(Ue=je.content.length,!(!Ue||Ue>=4096)&&(je.start=Ve,Ze(Ue+63>>6)));for(;Q.l&511;)Q.write_shift(-4,nt.ENDOFCHAIN);for(ae=0;ae<K[4]<<2;++ae){var it=N.FullPaths[ae];if(!it||it.length===0){for(ze=0;ze<17;++ze)Q.write_shift(4,0);for(ze=0;ze<3;++ze)Q.write_shift(4,-1);for(ze=0;ze<12;++ze)Q.write_shift(4,0);continue}je=N.FileIndex[ae],ae===0&&(je.start=je.size?je.start-1:rt);var gt=ae===0&&Y.root||je.name;if(Ue=2*(gt.length+1),Q.write_shift(64,gt,"utf16le"),Q.write_shift(2,Ue),Q.write_shift(1,je.type),Q.write_shift(1,je.color),Q.write_shift(-4,je.L),Q.write_shift(-4,je.R),Q.write_shift(-4,je.C),je.clsid)Q.write_shift(16,je.clsid,"hex");else for(ze=0;ze<4;++ze)Q.write_shift(4,0);Q.write_shift(4,je.state||0),Q.write_shift(4,0),Q.write_shift(4,0),Q.write_shift(4,0),Q.write_shift(4,0),Q.write_shift(4,je.start),Q.write_shift(4,je.size),Q.write_shift(4,0)}for(ae=1;ae<N.FileIndex.length;++ae)if(je=N.FileIndex[ae],je.size>=4096)if(Q.l=je.start+1<<9,wr&&Buffer.isBuffer(je.content))je.content.copy(Q,Q.l,0,je.size),Q.l+=je.size+511&-512;else{for(ze=0;ze<je.size;++ze)Q.write_shift(1,je.content[ze]);for(;ze&511;++ze)Q.write_shift(1,0)}for(ae=1;ae<N.FileIndex.length;++ae)if(je=N.FileIndex[ae],je.size>0&&je.size<4096)if(wr&&Buffer.isBuffer(je.content))je.content.copy(Q,Q.l,0,je.size),Q.l+=je.size+63&-64;else{for(ze=0;ze<je.size;++ze)Q.write_shift(1,je.content[ze]);for(;ze&63;++ze)Q.write_shift(1,0)}if(wr)Q.l=Q.length;else for(;Q.l<Q.length;)Q.write_shift(1,0);return Q}function Oe(N,J){var Y=N.FullPaths.map(function(ze){return ze.toUpperCase()}),K=Y.map(function(ze){var Ue=ze.split("/");return Ue[Ue.length-(ze.slice(-1)=="/"?2:1)]}),Q=!1;J.charCodeAt(0)===47?(Q=!0,J=Y[0].slice(0,-1)+J):Q=J.indexOf("/")!==-1;var ae=J.toUpperCase(),Ve=Q===!0?Y.indexOf(ae):K.indexOf(ae);if(Ve!==-1)return N.FileIndex[Ve];var Ze=!ae.match(Rc);for(ae=ae.replace(ki,""),Ze&&(ae=ae.replace(Rc,"!")),Ve=0;Ve<Y.length;++Ve)if((Ze?Y[Ve].replace(Rc,"!"):Y[Ve]).replace(ki,"")==ae||(Ze?K[Ve].replace(Rc,"!"):K[Ve]).replace(ki,"")==ae)return N.FileIndex[Ve];return null}var Me=64,rt=-2,ft="d0cf11e0a1b11ae1",lt=[208,207,17,224,161,177,26,225],_t="00000000000000000000000000000000",nt={MAXREGSECT:-6,DIFSECT:-4,FATSECT:-3,ENDOFCHAIN:rt,FREESECT:-1,HEADER_SIGNATURE:ft,HEADER_MINOR_VERSION:"3e00",MAXREGSID:-6,NOSTREAM:-1,HEADER_CLSID:_t,EntryTypes:["unknown","storage","stream","lockbytes","property","root"]};function Kt(N,J,Y){w();var K=Fe(N,Y);E.writeFileSync(J,K)}function He(N){for(var J=new Array(N.length),Y=0;Y<N.length;++Y)J[Y]=String.fromCharCode(N[Y]);return J.join("")}function Nt(N,J){var Y=Fe(N,J);switch(J&&J.type||"buffer"){case"file":return w(),E.writeFileSync(J.filename,Y),Y;case"binary":return typeof Y=="string"?Y:He(Y);case"base64":return Im(typeof Y=="string"?Y:He(Y));case"buffer":if(wr)return Buffer.isBuffer(Y)?Y:bo(Y);case"array":return typeof Y=="string"?bn(Y):Y}return Y}var Mt;function pe(N){try{var J=N.InflateRaw,Y=new J;if(Y._processChunk(new Uint8Array([3,0]),Y._finishFlushFlag),Y.bytesRead)Mt=N;else throw new Error("zlib does not expose bytesRead")}catch(K){console.error("cannot use native zlib: "+(K.message||K))}}function Ee(N,J){if(!Mt)return Ut(N,J);var Y=Mt.InflateRaw,K=new Y,Q=K._processChunk(N.slice(N.l),K._finishFlushFlag);return N.l+=K.bytesRead,Q}function Se(N){return Mt?Mt.deflateRawSync(N):Qt(N)}var Ie=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Ke=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258],dt=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];function vt(N){var J=(N<<1|N<<11)&139536|(N<<5|N<<15)&558144;return(J>>16|J>>8|J)&255}for(var ut=typeof Uint8Array<"u",Qe=ut?new Uint8Array(256):[],qt=0;qt<256;++qt)Qe[qt]=vt(qt);function _e(N,J){var Y=Qe[N&255];return J<=8?Y>>>8-J:(Y=Y<<8|Qe[N>>8&255],J<=16?Y>>>16-J:(Y=Y<<8|Qe[N>>16&255],Y>>>24-J))}function Yt(N,J){var Y=J&7,K=J>>>3;return(N[K]|(Y<=6?0:N[K+1]<<8))>>>Y&3}function Wt(N,J){var Y=J&7,K=J>>>3;return(N[K]|(Y<=5?0:N[K+1]<<8))>>>Y&7}function nr(N,J){var Y=J&7,K=J>>>3;return(N[K]|(Y<=4?0:N[K+1]<<8))>>>Y&15}function Zt(N,J){var Y=J&7,K=J>>>3;return(N[K]|(Y<=3?0:N[K+1]<<8))>>>Y&31}function wt(N,J){var Y=J&7,K=J>>>3;return(N[K]|(Y<=1?0:N[K+1]<<8))>>>Y&127}function gr(N,J,Y){var K=J&7,Q=J>>>3,ae=(1<<Y)-1,Ve=N[Q]>>>K;return Y<8-K||(Ve|=N[Q+1]<<8-K,Y<16-K)||(Ve|=N[Q+2]<<16-K,Y<24-K)||(Ve|=N[Q+3]<<24-K),Ve&ae}function Mr(N,J,Y){var K=J&7,Q=J>>>3;return K<=5?N[Q]|=(Y&7)<<K:(N[Q]|=Y<<K&255,N[Q+1]=(Y&7)>>8-K),J+3}function Xe(N,J,Y){var K=J&7,Q=J>>>3;return Y=(Y&1)<<K,N[Q]|=Y,J+1}function Sr(N,J,Y){var K=J&7,Q=J>>>3;return Y<<=K,N[Q]|=Y&255,Y>>>=8,N[Q+1]=Y,J+8}function Vr(N,J,Y){var K=J&7,Q=J>>>3;return Y<<=K,N[Q]|=Y&255,Y>>>=8,N[Q+1]=Y&255,N[Q+2]=Y>>>8,J+16}function lr(N,J){var Y=N.length,K=2*Y>J?2*Y:J+5,Q=0;if(Y>=J)return N;if(wr){var ae=Fm(K);if(N.copy)N.copy(ae);else for(;Q<N.length;++Q)ae[Q]=N[Q];return ae}else if(ut){var Ve=new Uint8Array(K);if(Ve.set)Ve.set(N);else for(;Q<Y;++Q)Ve[Q]=N[Q];return Ve}return N.length=K,N}function Xt(N){for(var J=new Array(N),Y=0;Y<N;++Y)J[Y]=0;return J}function Fr(N,J,Y){var K=1,Q=0,ae=0,Ve=0,Ze=0,ze=N.length,Ue=ut?new Uint16Array(32):Xt(32);for(ae=0;ae<32;++ae)Ue[ae]=0;for(ae=ze;ae<Y;++ae)N[ae]=0;ze=N.length;var je=ut?new Uint16Array(ze):Xt(ze);for(ae=0;ae<ze;++ae)Ue[Q=N[ae]]++,K<Q&&(K=Q),je[ae]=0;for(Ue[0]=0,ae=1;ae<=K;++ae)Ue[ae+16]=Ze=Ze+Ue[ae-1]<<1;for(ae=0;ae<ze;++ae)Ze=N[ae],Ze!=0&&(je[ae]=Ue[Ze+16]++);var it=0;for(ae=0;ae<ze;++ae)if(it=N[ae],it!=0)for(Ze=_e(je[ae],K)>>K-it,Ve=(1<<K+4-it)-1;Ve>=0;--Ve)J[Ze|Ve<<it]=it&15|ae<<4;return K}var Or=ut?new Uint16Array(512):Xt(512),ia=ut?new Uint16Array(32):Xt(32);if(!ut){for(var $r=0;$r<512;++$r)Or[$r]=0;for($r=0;$r<32;++$r)ia[$r]=0}(function(){for(var N=[],J=0;J<32;J++)N.push(5);Fr(N,ia,32);var Y=[];for(J=0;J<=143;J++)Y.push(8);for(;J<=255;J++)Y.push(9);for(;J<=279;J++)Y.push(7);for(;J<=287;J++)Y.push(8);Fr(Y,Or,288)})();var pa=function(){for(var J=ut?new Uint8Array(32768):[],Y=0,K=0;Y<dt.length-1;++Y)for(;K<dt[Y+1];++K)J[K]=Y;for(;K<32768;++K)J[K]=29;var Q=ut?new Uint8Array(259):[];for(Y=0,K=0;Y<Ke.length-1;++Y)for(;K<Ke[Y+1];++K)Q[K]=Y;function ae(Ze,ze){for(var Ue=0;Ue<Ze.length;){var je=Math.min(65535,Ze.length-Ue),it=Ue+je==Ze.length;for(ze.write_shift(1,+it),ze.write_shift(2,je),ze.write_shift(2,~je&65535);je-- >0;)ze[ze.l++]=Ze[Ue++]}return ze.l}function Ve(Ze,ze){for(var Ue=0,je=0,it=ut?new Uint16Array(32768):[];je<Ze.length;){var gt=Math.min(65535,Ze.length-je);if(gt<10){for(Ue=Mr(ze,Ue,+(je+gt==Ze.length)),Ue&7&&(Ue+=8-(Ue&7)),ze.l=Ue/8|0,ze.write_shift(2,gt),ze.write_shift(2,~gt&65535);gt-- >0;)ze[ze.l++]=Ze[je++];Ue=ze.l*8;continue}Ue=Mr(ze,Ue,+(je+gt==Ze.length)+2);for(var St=0;gt-- >0;){var mt=Ze[je];St=(St<<5^mt)&32767;var Ft=-1,Jt=0;if((Ft=it[St])&&(Ft|=je&-32768,Ft>je&&(Ft-=32768),Ft<je))for(;Ze[Ft+Jt]==Ze[je+Jt]&&Jt<250;)++Jt;if(Jt>2){mt=Q[Jt],mt<=22?Ue=Sr(ze,Ue,Qe[mt+1]>>1)-1:(Sr(ze,Ue,3),Ue+=5,Sr(ze,Ue,Qe[mt-23]>>5),Ue+=3);var Cr=mt<8?0:mt-4>>2;Cr>0&&(Vr(ze,Ue,Jt-Ke[mt]),Ue+=Cr),mt=J[je-Ft],Ue=Sr(ze,Ue,Qe[mt]>>3),Ue-=3;var zr=mt<4?0:mt-2>>1;zr>0&&(Vr(ze,Ue,je-Ft-dt[mt]),Ue+=zr);for(var tr=0;tr<Jt;++tr)it[St]=je&32767,St=(St<<5^Ze[je])&32767,++je;gt-=Jt-1}else mt<=143?mt=mt+48:Ue=Xe(ze,Ue,1),Ue=Sr(ze,Ue,Qe[mt]),it[St]=je&32767,++je}Ue=Sr(ze,Ue,0)-1}return ze.l=(Ue+7)/8|0,ze.l}return function(ze,Ue){return ze.length<8?ae(ze,Ue):Ve(ze,Ue)}}();function Qt(N){var J=Ma(50+Math.floor(N.length*1.1)),Y=pa(N,J);return J.slice(0,Y)}var kr=ut?new Uint16Array(32768):Xt(32768),ct=ut?new Uint16Array(32768):Xt(32768),Dt=ut?new Uint16Array(128):Xt(128),Vt=1,xr=1;function rr(N,J){var Y=Zt(N,J)+257;J+=5;var K=Zt(N,J)+1;J+=5;var Q=nr(N,J)+4;J+=4;for(var ae=0,Ve=ut?new Uint8Array(19):Xt(19),Ze=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],ze=1,Ue=ut?new Uint8Array(8):Xt(8),je=ut?new Uint8Array(8):Xt(8),it=Ve.length,gt=0;gt<Q;++gt)Ve[Ie[gt]]=ae=Wt(N,J),ze<ae&&(ze=ae),Ue[ae]++,J+=3;var St=0;for(Ue[0]=0,gt=1;gt<=ze;++gt)je[gt]=St=St+Ue[gt-1]<<1;for(gt=0;gt<it;++gt)(St=Ve[gt])!=0&&(Ze[gt]=je[St]++);var mt=0;for(gt=0;gt<it;++gt)if(mt=Ve[gt],mt!=0){St=Qe[Ze[gt]]>>8-mt;for(var Ft=(1<<7-mt)-1;Ft>=0;--Ft)Dt[St|Ft<<mt]=mt&7|gt<<3}var Jt=[];for(ze=1;Jt.length<Y+K;)switch(St=Dt[wt(N,J)],J+=St&7,St>>>=3){case 16:for(ae=3+Yt(N,J),J+=2,St=Jt[Jt.length-1];ae-- >0;)Jt.push(St);break;case 17:for(ae=3+Wt(N,J),J+=3;ae-- >0;)Jt.push(0);break;case 18:for(ae=11+wt(N,J),J+=7;ae-- >0;)Jt.push(0);break;default:Jt.push(St),ze<St&&(ze=St);break}var Cr=Jt.slice(0,Y),zr=Jt.slice(Y);for(gt=Y;gt<286;++gt)Cr[gt]=0;for(gt=K;gt<30;++gt)zr[gt]=0;return Vt=Fr(Cr,kr,286),xr=Fr(zr,ct,30),J}function st(N,J){if(N[0]==3&&!(N[1]&3))return[zs(J),2];for(var Y=0,K=0,Q=Fm(J||1<<18),ae=0,Ve=Q.length>>>0,Ze=0,ze=0;!(K&1);){if(K=Wt(N,Y),Y+=3,K>>>1)K>>1==1?(Ze=9,ze=5):(Y=rr(N,Y),Ze=Vt,ze=xr);else{Y&7&&(Y+=8-(Y&7));var Ue=N[Y>>>3]|N[(Y>>>3)+1]<<8;if(Y+=32,Ue>0)for(!J&&Ve<ae+Ue&&(Q=lr(Q,ae+Ue),Ve=Q.length);Ue-- >0;)Q[ae++]=N[Y>>>3],Y+=8;continue}for(;;){!J&&Ve<ae+32767&&(Q=lr(Q,ae+32767),Ve=Q.length);var je=gr(N,Y,Ze),it=K>>>1==1?Or[je]:kr[je];if(Y+=it&15,it>>>=4,!(it>>>8&255))Q[ae++]=it;else{if(it==256)break;it-=257;var gt=it<8?0:it-4>>2;gt>5&&(gt=0);var St=ae+Ke[it];gt>0&&(St+=gr(N,Y,gt),Y+=gt),je=gr(N,Y,ze),it=K>>>1==1?ia[je]:ct[je],Y+=it&15,it>>>=4;var mt=it<4?0:it-2>>1,Ft=dt[it];for(mt>0&&(Ft+=gr(N,Y,mt),Y+=mt),!J&&Ve<St&&(Q=lr(Q,St+100),Ve=Q.length);ae<St;)Q[ae]=Q[ae-Ft],++ae}}}return J?[Q,Y+7>>>3]:[Q.slice(0,ae),Y+7>>>3]}function Ut(N,J){var Y=N.slice(N.l||0),K=st(Y,J);return N.l+=K[1],K[0]}function jt(N,J){if(N)typeof console<"u"&&console.error(J);else throw new Error(J)}function Br(N,J){var Y=N;Za(Y,0);var K=[],Q=[],ae={FileIndex:K,FullPaths:Q};re(ae,{root:J.root});for(var Ve=Y.length-4;(Y[Ve]!=80||Y[Ve+1]!=75||Y[Ve+2]!=5||Y[Ve+3]!=6)&&Ve>=0;)--Ve;Y.l=Ve+4,Y.l+=4;var Ze=Y.read_shift(2);Y.l+=6;var ze=Y.read_shift(4);for(Y.l=ze,Ve=0;Ve<Ze;++Ve){Y.l+=20;var Ue=Y.read_shift(4),je=Y.read_shift(4),it=Y.read_shift(2),gt=Y.read_shift(2),St=Y.read_shift(2);Y.l+=8;var mt=Y.read_shift(4),Ft=o(Y.slice(Y.l+it,Y.l+it+gt));Y.l+=it+gt+St;var Jt=Y.l;Y.l=mt+4,ca(Y,Ue,je,ae,Ft),Y.l=Jt}return ae}function ca(N,J,Y,K,Q){N.l+=2;var ae=N.read_shift(2),Ve=N.read_shift(2),Ze=x(N);if(ae&8257)throw new Error("Unsupported ZIP encryption");for(var ze=N.read_shift(4),Ue=N.read_shift(4),je=N.read_shift(4),it=N.read_shift(2),gt=N.read_shift(2),St="",mt=0;mt<it;++mt)St+=String.fromCharCode(N[N.l++]);if(gt){var Ft=o(N.slice(N.l,N.l+gt));(Ft[21589]||{}).mt&&(Ze=Ft[21589].mt),((Q||{})[21589]||{}).mt&&(Ze=Q[21589].mt)}N.l+=gt;var Jt=N.slice(N.l,N.l+Ue);switch(Ve){case 8:Jt=Ee(N,je);break;case 0:break;default:throw new Error("Unsupported ZIP Compression method "+Ve)}var Cr=!1;ae&8&&(ze=N.read_shift(4),ze==134695760&&(ze=N.read_shift(4),Cr=!0),Ue=N.read_shift(4),je=N.read_shift(4)),Ue!=J&&jt(Cr,"Bad compressed size: "+J+" != "+Ue),je!=Y&&jt(Cr,"Bad uncompressed size: "+Y+" != "+je),ve(K,St,Jt,{unsafe:!0,mt:Ze})}function er(N,J){var Y=J||{},K=[],Q=[],ae=Ma(1),Ve=Y.compression?8:0,Ze=0,ze=0,Ue=0,je=0,it=0,gt=N.FullPaths[0],St=gt,mt=N.FileIndex[0],Ft=[],Jt=0;for(ze=1;ze<N.FullPaths.length;++ze)if(St=N.FullPaths[ze].slice(gt.length),mt=N.FileIndex[ze],!(!mt.size||!mt.content||St=="Sh33tJ5")){var Cr=je,zr=Ma(St.length);for(Ue=0;Ue<St.length;++Ue)zr.write_shift(1,St.charCodeAt(Ue)&127);zr=zr.slice(0,zr.l),Ft[it]=aT.buf(mt.content,0);var tr=mt.content;Ve==8&&(tr=Se(tr)),ae=Ma(30),ae.write_shift(4,67324752),ae.write_shift(2,20),ae.write_shift(2,Ze),ae.write_shift(2,Ve),mt.mt?m(ae,mt.mt):ae.write_shift(4,0),ae.write_shift(-4,Ft[it]),ae.write_shift(4,tr.length),ae.write_shift(4,mt.content.length),ae.write_shift(2,zr.length),ae.write_shift(2,0),je+=ae.length,K.push(ae),je+=zr.length,K.push(zr),je+=tr.length,K.push(tr),ae=Ma(46),ae.write_shift(4,33639248),ae.write_shift(2,0),ae.write_shift(2,20),ae.write_shift(2,Ze),ae.write_shift(2,Ve),ae.write_shift(4,0),ae.write_shift(-4,Ft[it]),ae.write_shift(4,tr.length),ae.write_shift(4,mt.content.length),ae.write_shift(2,zr.length),ae.write_shift(2,0),ae.write_shift(2,0),ae.write_shift(2,0),ae.write_shift(2,0),ae.write_shift(4,0),ae.write_shift(4,Cr),Jt+=ae.l,Q.push(ae),Jt+=zr.length,Q.push(zr),++it}return ae=Ma(22),ae.write_shift(4,101010256),ae.write_shift(2,0),ae.write_shift(2,0),ae.write_shift(2,it),ae.write_shift(2,it),ae.write_shift(4,Jt),ae.write_shift(4,je),ae.write_shift(2,0),Ps([Ps(K),Ps(Q),ae])}var Ya={htm:"text/html",xml:"text/xml",gif:"image/gif",jpg:"image/jpeg",png:"image/png",mso:"application/x-mso",thmx:"application/vnd.ms-officetheme",sh33tj5:"application/octet-stream"};function ce(N,J){if(N.ctype)return N.ctype;var Y=N.name||"",K=Y.match(/\.([^\.]+)$/);return K&&Ya[K[1]]||J&&(K=(Y=J).match(/[\.\\]([^\.\\])+$/),K&&Ya[K[1]])?Ya[K[1]]:"application/octet-stream"}function V(N){for(var J=Im(N),Y=[],K=0;K<J.length;K+=76)Y.push(J.slice(K,K+76));return Y.join(`\r
`)+`\r
`}function H(N){var J=N.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF=]/g,function(Ue){var je=Ue.charCodeAt(0).toString(16).toUpperCase();return"="+(je.length==1?"0"+je:je)});J=J.replace(/ $/mg,"=20").replace(/\t$/mg,"=09"),J.charAt(0)==`
`&&(J="=0D"+J.slice(1)),J=J.replace(/\r(?!\n)/mg,"=0D").replace(/\n\n/mg,`
=0A`).replace(/([^\r\n])\n/mg,"$1=0A");for(var Y=[],K=J.split(`\r
`),Q=0;Q<K.length;++Q){var ae=K[Q];if(ae.length==0){Y.push("");continue}for(var Ve=0;Ve<ae.length;){var Ze=76,ze=ae.slice(Ve,Ve+Ze);ze.charAt(Ze-1)=="="?Ze--:ze.charAt(Ze-2)=="="?Ze-=2:ze.charAt(Ze-3)=="="&&(Ze-=3),ze=ae.slice(Ve,Ve+Ze),Ve+=Ze,Ve<ae.length&&(ze+="="),Y.push(ze)}}return Y.join(`\r
`)}function te(N){for(var J=[],Y=0;Y<N.length;++Y){for(var K=N[Y];Y<=N.length&&K.charAt(K.length-1)=="=";)K=K.slice(0,K.length-1)+N[++Y];J.push(K)}for(var Q=0;Q<J.length;++Q)J[Q]=J[Q].replace(/[=][0-9A-Fa-f]{2}/g,function(ae){return String.fromCharCode(parseInt(ae.slice(1),16))});return bn(J.join(`\r
`))}function de(N,J,Y){for(var K="",Q="",ae="",Ve,Ze=0;Ze<10;++Ze){var ze=J[Ze];if(!ze||ze.match(/^\s*$/))break;var Ue=ze.match(/^(.*?):\s*([^\s].*)$/);if(Ue)switch(Ue[1].toLowerCase()){case"content-location":K=Ue[2].trim();break;case"content-type":ae=Ue[2].trim();break;case"content-transfer-encoding":Q=Ue[2].trim();break}}switch(++Ze,Q.toLowerCase()){case"base64":Ve=bn(qi(J.slice(Ze).join("")));break;case"quoted-printable":Ve=te(J.slice(Ze));break;default:throw new Error("Unsupported Content-Transfer-Encoding "+Q)}var je=ve(N,K.slice(Y.length),Ve,{unsafe:!0});ae&&(je.ctype=ae)}function xe(N,J){if(He(N.slice(0,13)).toLowerCase()!="mime-version:")throw new Error("Unsupported MAD header");var Y=J&&J.root||"",K=(wr&&Buffer.isBuffer(N)?N.toString("binary"):He(N)).split(`\r
`),Q=0,ae="";for(Q=0;Q<K.length;++Q)if(ae=K[Q],!!/^Content-Location:/i.test(ae)&&(ae=ae.slice(ae.indexOf("file")),Y||(Y=ae.slice(0,ae.lastIndexOf("/")+1)),ae.slice(0,Y.length)!=Y))for(;Y.length>0&&(Y=Y.slice(0,Y.length-1),Y=Y.slice(0,Y.lastIndexOf("/")+1),ae.slice(0,Y.length)!=Y););var Ve=(K[1]||"").match(/boundary="(.*?)"/);if(!Ve)throw new Error("MAD cannot find boundary");var Ze="--"+(Ve[1]||""),ze=[],Ue=[],je={FileIndex:ze,FullPaths:Ue};re(je);var it,gt=0;for(Q=0;Q<K.length;++Q){var St=K[Q];St!==Ze&&St!==Ze+"--"||(gt++&&de(je,K.slice(it,Q),Y),it=Q)}return je}function Be(N,J){var Y=J||{},K=Y.boundary||"SheetJS";K="------="+K;for(var Q=["MIME-Version: 1.0",'Content-Type: multipart/related; boundary="'+K.slice(2)+'"',"","",""],ae=N.FullPaths[0],Ve=ae,Ze=N.FileIndex[0],ze=1;ze<N.FullPaths.length;++ze)if(Ve=N.FullPaths[ze].slice(ae.length),Ze=N.FileIndex[ze],!(!Ze.size||!Ze.content||Ve=="Sh33tJ5")){Ve=Ve.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF]/g,function(Jt){return"_x"+Jt.charCodeAt(0).toString(16)+"_"}).replace(/[\u0080-\uFFFF]/g,function(Jt){return"_u"+Jt.charCodeAt(0).toString(16)+"_"});for(var Ue=Ze.content,je=wr&&Buffer.isBuffer(Ue)?Ue.toString("binary"):He(Ue),it=0,gt=Math.min(1024,je.length),St=0,mt=0;mt<=gt;++mt)(St=je.charCodeAt(mt))>=32&&St<128&&++it;var Ft=it>=gt*4/5;Q.push(K),Q.push("Content-Location: "+(Y.root||"file:///C:/SheetJS/")+Ve),Q.push("Content-Transfer-Encoding: "+(Ft?"quoted-printable":"base64")),Q.push("Content-Type: "+ce(Ze,Ve)),Q.push(""),Q.push(Ft?H(je):V(je))}return Q.push(K+`--\r
`),Q.join(`\r
`)}function Ae(N){var J={};return re(J,N),J}function ve(N,J,Y,K){var Q=K&&K.unsafe;Q||re(N);var ae=!Q&&br.find(N,J);if(!ae){var Ve=N.FullPaths[0];J.slice(0,Ve.length)==Ve?Ve=J:(Ve.slice(-1)!="/"&&(Ve+="/"),Ve=(Ve+J).replace("//","/")),ae={name:u(J),type:2},N.FileIndex.push(ae),N.FullPaths.push(Ve),Q||br.utils.cfb_gc(N)}return ae.content=Y,ae.size=Y?Y.length:0,K&&(K.CLSID&&(ae.clsid=K.CLSID),K.mt&&(ae.mt=K.mt),K.ct&&(ae.ct=K.ct)),ae}function De(N,J){re(N);var Y=br.find(N,J);if(Y){for(var K=0;K<N.FileIndex.length;++K)if(N.FileIndex[K]==Y)return N.FileIndex.splice(K,1),N.FullPaths.splice(K,1),!0}return!1}function Je(N,J,Y){re(N);var K=br.find(N,J);if(K){for(var Q=0;Q<N.FileIndex.length;++Q)if(N.FileIndex[Q]==K)return N.FileIndex[Q].name=u(Y),N.FullPaths[Q]=Y,!0}return!1}function et(N){be(N,!0)}return n.find=Oe,n.read=Te,n.parse=C,n.write=Nt,n.writeFile=Kt,n.utils={cfb_new:Ae,cfb_add:ve,cfb_del:De,cfb_mov:Je,cfb_gc:et,ReadShift:zc,CheckField:V1,prep_blob:Za,bconcat:Ps,use_zlib:pe,_deflateRaw:Qt,_inflateRaw:Ut,consts:nt},n}();function iT(e){if(typeof Deno<"u")return Deno.readFileSync(e);if(typeof $<"u"&&typeof File<"u"&&typeof Folder<"u")try{var n=File(e);n.open("r"),n.encoding="binary";var a=n.read();return n.close(),a}catch(c){if(!c.message||!c.message.match(/onstruct/))throw c}throw new Error("Cannot access file "+e)}function Nn(e){for(var n=Object.keys(e),a=[],c=0;c<n.length;++c)Object.prototype.hasOwnProperty.call(e,n[c])&&a.push(n[c]);return a}function Y0(e){for(var n=[],a=Nn(e),c=0;c!==a.length;++c)n[e[a[c]]]=a[c];return n}var Bh=new Date(1899,11,30,0,0,0);function Ci(e,n){var a=e.getTime();n&&(a-=1462*24*60*60*1e3);var c=Bh.getTime()+(e.getTimezoneOffset()-Bh.getTimezoneOffset())*6e4;return(a-c)/(24*60*60*1e3)}var y1=new Date,nT=Bh.getTime()+(y1.getTimezoneOffset()-Bh.getTimezoneOffset())*6e4,zm=y1.getTimezoneOffset();function Zh(e){var n=new Date;return n.setTime(e*24*60*60*1e3+nT),n.getTimezoneOffset()!==zm&&n.setTime(n.getTime()+(n.getTimezoneOffset()-zm)*6e4),n}function sT(e){var n=0,a=0,c=!1,u=e.match(/P([0-9\.]+Y)?([0-9\.]+M)?([0-9\.]+D)?T([0-9\.]+H)?([0-9\.]+M)?([0-9\.]+S)?/);if(!u)throw new Error("|"+e+"| is not an ISO8601 Duration");for(var m=1;m!=u.length;++m)if(u[m]){switch(a=1,m>3&&(c=!0),u[m].slice(u[m].length-1)){case"Y":throw new Error("Unsupported ISO Duration Field: "+u[m].slice(u[m].length-1));case"D":a*=24;case"H":a*=60;case"M":if(c)a*=60;else throw new Error("Unsupported ISO Duration Field: M")}n+=a*parseInt(u[m],10)}return n}var Nm=new Date("2017-02-19T19:06:09.000Z"),v1=isNaN(Nm.getFullYear())?new Date("2/19/17"):Nm,oT=v1.getFullYear()==2017;function Ua(e,n){var a=new Date(e);if(oT)return n>0?a.setTime(a.getTime()+a.getTimezoneOffset()*60*1e3):n<0&&a.setTime(a.getTime()-a.getTimezoneOffset()*60*1e3),a;if(e instanceof Date)return e;if(v1.getFullYear()==1917&&!isNaN(a.getFullYear())){var c=a.getFullYear();return e.indexOf(""+c)>-1||a.setFullYear(a.getFullYear()+100),a}var u=e.match(/\d+/g)||["2017","2","19","0","0","0"],m=new Date(+u[0],+u[1]-1,+u[2],+u[3]||0,+u[4]||0,+u[5]||0);return e.indexOf("Z")>-1&&(m=new Date(m.getTime()-m.getTimezoneOffset()*60*1e3)),m}function yo(e,n){if(wr&&Buffer.isBuffer(e)){if(n){if(e[0]==255&&e[1]==254)return Bc(e.slice(2).toString("utf16le"));if(e[1]==254&&e[2]==255)return Bc(s1(e.slice(2).toString("binary")))}return e.toString("binary")}if(typeof TextDecoder<"u")try{if(n){if(e[0]==255&&e[1]==254)return Bc(new TextDecoder("utf-16le").decode(e.slice(2)));if(e[0]==254&&e[1]==255)return Bc(new TextDecoder("utf-16be").decode(e.slice(2)))}var a={"€":"","‚":"",ƒ:"","„":"","…":"","†":"","‡":"","ˆ":"","‰":"",Š:"","‹":"",Œ:"",Ž:"","‘":"","’":"","“":"","”":"","•":"","–":"","—":"","˜":"","™":"",š:"","›":"",œ:"",ž:"",Ÿ:""};return Array.isArray(e)&&(e=new Uint8Array(e)),new TextDecoder("latin1").decode(e).replace(/[€‚ƒ„…†‡ˆ‰Š‹ŒŽ‘’“”•–—˜™š›œžŸ]/g,function(m){return a[m]||m})}catch{}for(var c=[],u=0;u!=e.length;++u)c.push(String.fromCharCode(e[u]));return c.join("")}function Xa(e){if(typeof JSON<"u"&&!Array.isArray(e))return JSON.parse(JSON.stringify(e));if(typeof e!="object"||e==null)return e;if(e instanceof Date)return new Date(e.getTime());var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(n[a]=Xa(e[a]));return n}function fa(e,n){for(var a="";a.length<n;)a+=e;return a}function kn(e){var n=Number(e);if(!isNaN(n))return isFinite(n)?n:NaN;if(!/\d/.test(e))return n;var a=1,c=e.replace(/([\d]),([\d])/g,"$1$2").replace(/[$]/g,"").replace(/[%]/g,function(){return a*=100,""});return!isNaN(n=Number(c))||(c=c.replace(/[(](.*)[)]/,function(u,m){return a=-a,m}),!isNaN(n=Number(c)))?n/a:n}var lT=["january","february","march","april","may","june","july","august","september","october","november","december"];function yl(e){var n=new Date(e),a=new Date(NaN),c=n.getYear(),u=n.getMonth(),m=n.getDate();if(isNaN(m))return a;var x=e.toLowerCase();if(x.match(/jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec/)){if(x=x.replace(/[^a-z]/g,"").replace(/([^a-z]|^)[ap]m?([^a-z]|$)/,""),x.length>3&&lT.indexOf(x)==-1)return a}else if(x.match(/[a-z]/))return a;return c<0||c>8099?a:(u>0||m>1)&&c!=101?n:e.match(/[^-0-9:,\/\\]/)?a:n}var cT=function(){var e="abacaba".split(/(:?b)/i).length==5;return function(a,c,u){if(e||typeof c=="string")return a.split(c);for(var m=a.split(c),x=[m[0]],o=1;o<m.length;++o)x.push(u),x.push(m[o]);return x}}();function w1(e){return e?e.content&&e.type?yo(e.content,!0):e.data?Lc(e.data):e.asNodeBuffer&&wr?Lc(e.asNodeBuffer().toString("binary")):e.asBinary?Lc(e.asBinary()):e._data&&e._data.getContent?Lc(yo(Array.prototype.slice.call(e._data.getContent(),0))):null:null}function b1(e){if(!e)return null;if(e.data)return Cm(e.data);if(e.asNodeBuffer&&wr)return e.asNodeBuffer();if(e._data&&e._data.getContent){var n=e._data.getContent();return typeof n=="string"?Cm(n):Array.prototype.slice.call(n)}return e.content&&e.type?e.content:null}function uT(e){return e&&e.name.slice(-4)===".bin"?b1(e):w1(e)}function nn(e,n){for(var a=e.FullPaths||Nn(e.files),c=n.toLowerCase().replace(/[\/]/g,"\\"),u=c.replace(/\\/g,"/"),m=0;m<a.length;++m){var x=a[m].replace(/^Root Entry[\/]/,"").toLowerCase();if(c==x||u==x)return e.files?e.files[a[m]]:e.FileIndex[m]}return null}function J0(e,n){var a=nn(e,n);if(a==null)throw new Error("Cannot find file "+n+" in zip");return a}function ka(e,n,a){if(!a)return uT(J0(e,n));if(!n)return null;try{return ka(e,n)}catch{return null}}function ji(e,n,a){if(!a)return w1(J0(e,n));if(!n)return null;try{return ji(e,n)}catch{return null}}function T1(e,n,a){if(!a)return b1(J0(e,n));if(!n)return null;try{return T1(e,n)}catch{return null}}function Um(e){for(var n=e.FullPaths||Nn(e.files),a=[],c=0;c<n.length;++c)n[c].slice(-1)!="/"&&a.push(n[c].replace(/^Root Entry[\/]/,""));return a.sort()}function hT(e,n,a){if(e.FullPaths){if(typeof a=="string"){var c;return wr?c=bo(a):c=Pb(a),br.utils.cfb_add(e,n,c)}br.utils.cfb_add(e,n,a)}else e.file(n,a)}function E1(e,n){switch(n.type){case"base64":return br.read(e,{type:"base64"});case"binary":return br.read(e,{type:"binary"});case"buffer":case"array":return br.read(e,{type:"buffer"})}throw new Error("Unrecognized type "+n.type)}function Oc(e,n){if(e.charAt(0)=="/")return e.slice(1);var a=n.split("/");n.slice(-1)!="/"&&a.pop();for(var c=e.split("/");c.length!==0;){var u=c.shift();u===".."?a.pop():u!=="."&&a.push(u)}return a.join("/")}var S1=`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\r
`,fT=/([^"\s?>\/]+)\s*=\s*((?:")([^"]*)(?:")|(?:')([^']*)(?:')|([^'">\s]+))/g,Vm=/<[\/\?]?[a-zA-Z0-9:_-]+(?:\s+[^"\s?>\/]+\s*=\s*(?:"[^"]*"|'[^']*'|[^'">\s=]+))*\s*[\/\?]?>/mg,dT=/<[^>]*>/g,fi=S1.match(Vm)?Vm:dT,pT=/<\w*:/,mT=/<(\/?)\w+:/;function ar(e,n,a){for(var c={},u=0,m=0;u!==e.length&&!((m=e.charCodeAt(u))===32||m===10||m===13);++u);if(n||(c[0]=e.slice(0,u)),u===e.length)return c;var x=e.match(fT),o=0,E="",w=0,C="",P="",M=1;if(x)for(w=0;w!=x.length;++w){for(P=x[w],m=0;m!=P.length&&P.charCodeAt(m)!==61;++m);for(C=P.slice(0,m).trim();P.charCodeAt(m+1)==32;)++m;for(M=(u=P.charCodeAt(m+1))==34||u==39?1:0,E=P.slice(m+1+M,P.length-M),o=0;o!=C.length&&C.charCodeAt(o)!==58;++o);if(o===C.length)C.indexOf("_")>0&&(C=C.slice(0,C.indexOf("_"))),c[C]=E,a||(c[C.toLowerCase()]=E);else{var O=(o===5&&C.slice(0,5)==="xmlns"?"xmlns":"")+C.slice(o+1);if(c[O]&&C.slice(o-3,o)=="ext")continue;c[O]=E,a||(c[O.toLowerCase()]=E)}}return c}function Un(e){return e.replace(mT,"<$1")}var k1={"&quot;":'"',"&apos;":"'","&gt;":">","&lt;":"<","&amp;":"&"},gT=Y0(k1),Er=function(){var e=/&(?:quot|apos|gt|lt|amp|#x?([\da-fA-F]+));/ig,n=/_x([\da-fA-F]{4})_/ig;return function a(c){var u=c+"",m=u.indexOf("<![CDATA[");if(m==-1)return u.replace(e,function(o,E){return k1[o]||String.fromCharCode(parseInt(E,o.indexOf("x")>-1?16:10))||o}).replace(n,function(o,E){return String.fromCharCode(parseInt(E,16))});var x=u.indexOf("]]>");return a(u.slice(0,m))+u.slice(m+9,x)+a(u.slice(x+3))}}(),xT=/[&<>'"]/g,_T=/[\u0000-\u001f]/g;function Q0(e){var n=e+"";return n.replace(xT,function(a){return gT[a]}).replace(/\n/g,"<br/>").replace(_T,function(a){return"&#x"+("000"+a.charCodeAt(0).toString(16)).slice(-4)+";"})}var $m=function(){var e=/&#(\d+);/g;function n(a,c){return String.fromCharCode(parseInt(c,10))}return function(c){return c.replace(e,n)}}();function aa(e){switch(e){case 1:case!0:case"1":case"true":case"TRUE":return!0;default:return!1}}function d0(e){for(var n="",a=0,c=0,u=0,m=0,x=0,o=0;a<e.length;){if(c=e.charCodeAt(a++),c<128){n+=String.fromCharCode(c);continue}if(u=e.charCodeAt(a++),c>191&&c<224){x=(c&31)<<6,x|=u&63,n+=String.fromCharCode(x);continue}if(m=e.charCodeAt(a++),c<240){n+=String.fromCharCode((c&15)<<12|(u&63)<<6|m&63);continue}x=e.charCodeAt(a++),o=((c&7)<<18|(u&63)<<12|(m&63)<<6|x&63)-65536,n+=String.fromCharCode(55296+(o>>>10&1023)),n+=String.fromCharCode(56320+(o&1023))}return n}function jm(e){var n=zs(2*e.length),a,c,u=1,m=0,x=0,o;for(c=0;c<e.length;c+=u)u=1,(o=e.charCodeAt(c))<128?a=o:o<224?(a=(o&31)*64+(e.charCodeAt(c+1)&63),u=2):o<240?(a=(o&15)*4096+(e.charCodeAt(c+1)&63)*64+(e.charCodeAt(c+2)&63),u=3):(u=4,a=(o&7)*262144+(e.charCodeAt(c+1)&63)*4096+(e.charCodeAt(c+2)&63)*64+(e.charCodeAt(c+3)&63),a-=65536,x=55296+(a>>>10&1023),a=56320+(a&1023)),x!==0&&(n[m++]=x&255,n[m++]=x>>>8,x=0),n[m++]=a%256,n[m++]=a>>>8;return n.slice(0,m).toString("ucs2")}function Gm(e){return bo(e,"binary").toString("utf8")}var wh="foo bar bazâð£",Zr=wr&&(Gm(wh)==d0(wh)&&Gm||jm(wh)==d0(wh)&&jm)||d0,Bc=wr?function(e){return bo(e,"utf8").toString("binary")}:function(e){for(var n=[],a=0,c=0,u=0;a<e.length;)switch(c=e.charCodeAt(a++),!0){case c<128:n.push(String.fromCharCode(c));break;case c<2048:n.push(String.fromCharCode(192+(c>>6))),n.push(String.fromCharCode(128+(c&63)));break;case(c>=55296&&c<57344):c-=55296,u=e.charCodeAt(a++)-56320+(c<<10),n.push(String.fromCharCode(240+(u>>18&7))),n.push(String.fromCharCode(144+(u>>12&63))),n.push(String.fromCharCode(128+(u>>6&63))),n.push(String.fromCharCode(128+(u&63)));break;default:n.push(String.fromCharCode(224+(c>>12))),n.push(String.fromCharCode(128+(c>>6&63))),n.push(String.fromCharCode(128+(c&63)))}return n.join("")},Jc=function(){var e={};return function(a,c){var u=a+"|"+(c||"");return e[u]?e[u]:e[u]=new RegExp("<(?:\\w+:)?"+a+'(?: xml:space="preserve")?(?:[^>]*)>([\\s\\S]*?)</(?:\\w+:)?'+a+">",c||"")}}(),C1=function(){var e=[["nbsp"," "],["middot","·"],["quot",'"'],["apos","'"],["gt",">"],["lt","<"],["amp","&"]].map(function(n){return[new RegExp("&"+n[0]+";","ig"),n[1]]});return function(a){for(var c=a.replace(/^[\t\n\r ]+/,"").replace(/[\t\n\r ]+$/,"").replace(/>\s+/g,">").replace(/\s+</g,"<").replace(/[\t\n\r ]+/g," ").replace(/<\s*[bB][rR]\s*\/?>/g,`
`).replace(/<[^>]*>/g,""),u=0;u<e.length;++u)c=c.replace(e[u][0],e[u][1]);return c}}(),yT=function(){var e={};return function(a){return e[a]!==void 0?e[a]:e[a]=new RegExp("<(?:vt:)?"+a+">([\\s\\S]*?)</(?:vt:)?"+a+">","g")}}(),vT=/<\/?(?:vt:)?variant>/g,wT=/<(?:vt:)([^>]*)>([\s\S]*)</;function Hm(e,n){var a=ar(e),c=e.match(yT(a.baseType))||[],u=[];if(c.length!=a.size){if(n.WTF)throw new Error("unexpected vector length "+c.length+" != "+a.size);return u}return c.forEach(function(m){var x=m.replace(vT,"").match(wT);x&&u.push({v:Zr(x[2]),t:x[1]})}),u}var bT=/(^\s|\s$|\n)/;function TT(e){return Nn(e).map(function(n){return" "+n+'="'+e[n]+'"'}).join("")}function ET(e,n,a){return"<"+e+(a!=null?TT(a):"")+(n!=null?(n.match(bT)?' xml:space="preserve"':"")+">"+n+"</"+e:"/")+">"}function ed(e){if(wr&&Buffer.isBuffer(e))return e.toString("utf8");if(typeof e=="string")return e;if(typeof Uint8Array<"u"&&e instanceof Uint8Array)return Zr(To(Z0(e)));throw new Error("Bad input format: expected Buffer or string")}var Qc=/<(\/?)([^\s?><!\/:]*:|)([^\s?<>:\/]+)(?:[\s?:\/][^>]*)?>/mg,ST={CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/metadata/core-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/custom-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/extended-properties",CT:"http://schemas.openxmlformats.org/package/2006/content-types",RELS:"http://schemas.openxmlformats.org/package/2006/relationships",TCMNT:"http://schemas.microsoft.com/office/spreadsheetml/2018/threadedcomments",dc:"http://purl.org/dc/elements/1.1/",dcterms:"http://purl.org/dc/terms/",dcmitype:"http://purl.org/dc/dcmitype/",mx:"http://schemas.microsoft.com/office/mac/excel/2008/main",r:"http://schemas.openxmlformats.org/officeDocument/2006/relationships",sjs:"http://schemas.openxmlformats.org/package/2006/sheetjs/core-properties",vt:"http://schemas.openxmlformats.org/officeDocument/2006/docPropsVTypes",xsi:"http://www.w3.org/2001/XMLSchema-instance",xsd:"http://www.w3.org/2001/XMLSchema"},kT=["http://schemas.openxmlformats.org/spreadsheetml/2006/main","http://purl.oclc.org/ooxml/spreadsheetml/main","http://schemas.microsoft.com/office/excel/2006/main","http://schemas.microsoft.com/office/excel/2006/2"];function CT(e,n){for(var a=1-2*(e[n+7]>>>7),c=((e[n+7]&127)<<4)+(e[n+6]>>>4&15),u=e[n+6]&15,m=5;m>=0;--m)u=u*256+e[n+m];return c==2047?u==0?a*(1/0):NaN:(c==0?c=-1022:(c-=1023,u+=Math.pow(2,52)),a*Math.pow(2,c-52)*u)}function AT(e,n,a){var c=(n<0||1/n==-1/0?1:0)<<7,u=0,m=0,x=c?-n:n;isFinite(x)?x==0?u=m=0:(u=Math.floor(Math.log(x)/Math.LN2),m=x*Math.pow(2,52-u),u<=-1023&&(!isFinite(m)||m<Math.pow(2,52))?u=-1022:(m-=Math.pow(2,52),u+=1023)):(u=2047,m=isNaN(n)?26985:0);for(var o=0;o<=5;++o,m/=256)e[a+o]=m&255;e[a+6]=(u&15)<<4|m&15,e[a+7]=u>>4|c}var qm=function(e){for(var n=[],a=10240,c=0;c<e[0].length;++c)if(e[0][c])for(var u=0,m=e[0][c].length;u<m;u+=a)n.push.apply(n,e[0][c].slice(u,u+a));return n},Wm=wr?function(e){return e[0].length>0&&Buffer.isBuffer(e[0][0])?Buffer.concat(e[0].map(function(n){return Buffer.isBuffer(n)?n:bo(n)})):qm(e)}:qm,Zm=function(e,n,a){for(var c=[],u=n;u<a;u+=2)c.push(String.fromCharCode(is(e,u)));return c.join("").replace(ki,"")},td=wr?function(e,n,a){return Buffer.isBuffer(e)?e.toString("utf16le",n,a).replace(ki,""):Zm(e,n,a)}:Zm,Xm=function(e,n,a){for(var c=[],u=n;u<n+a;++u)c.push(("0"+e[u].toString(16)).slice(-2));return c.join("")},A1=wr?function(e,n,a){return Buffer.isBuffer(e)?e.toString("hex",n,n+a):Xm(e,n,a)}:Xm,Km=function(e,n,a){for(var c=[],u=n;u<a;u++)c.push(String.fromCharCode(dl(e,u)));return c.join("")},su=wr?function(n,a,c){return Buffer.isBuffer(n)?n.toString("utf8",a,c):Km(n,a,c)}:Km,I1=function(e,n){var a=Vi(e,n);return a>0?su(e,n+4,n+4+a-1):""},F1=I1,P1=function(e,n){var a=Vi(e,n);return a>0?su(e,n+4,n+4+a-1):""},M1=P1,D1=function(e,n){var a=2*Vi(e,n);return a>0?su(e,n+4,n+4+a-1):""},L1=D1,R1=function(n,a){var c=Vi(n,a);return c>0?td(n,a+4,a+4+c):""},O1=R1,B1=function(e,n){var a=Vi(e,n);return a>0?su(e,n+4,n+4+a):""},z1=B1,N1=function(e,n){return CT(e,n)},zh=N1,U1=function(n){return Array.isArray(n)||typeof Uint8Array<"u"&&n instanceof Uint8Array};wr&&(F1=function(n,a){if(!Buffer.isBuffer(n))return I1(n,a);var c=n.readUInt32LE(a);return c>0?n.toString("utf8",a+4,a+4+c-1):""},M1=function(n,a){if(!Buffer.isBuffer(n))return P1(n,a);var c=n.readUInt32LE(a);return c>0?n.toString("utf8",a+4,a+4+c-1):""},L1=function(n,a){if(!Buffer.isBuffer(n))return D1(n,a);var c=2*n.readUInt32LE(a);return n.toString("utf16le",a+4,a+4+c-1)},O1=function(n,a){if(!Buffer.isBuffer(n))return R1(n,a);var c=n.readUInt32LE(a);return n.toString("utf16le",a+4,a+4+c)},z1=function(n,a){if(!Buffer.isBuffer(n))return B1(n,a);var c=n.readUInt32LE(a);return n.toString("utf8",a+4,a+4+c)},zh=function(n,a){return Buffer.isBuffer(n)?n.readDoubleLE(a):N1(n,a)},U1=function(n){return Buffer.isBuffer(n)||Array.isArray(n)||typeof Uint8Array<"u"&&n instanceof Uint8Array});var dl=function(e,n){return e[n]},is=function(e,n){return e[n+1]*256+e[n]},IT=function(e,n){var a=e[n+1]*256+e[n];return a<32768?a:(65535-a+1)*-1},Vi=function(e,n){return e[n+3]*(1<<24)+(e[n+2]<<16)+(e[n+1]<<8)+e[n]},co=function(e,n){return e[n+3]<<24|e[n+2]<<16|e[n+1]<<8|e[n]},FT=function(e,n){return e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3]};function zc(e,n){var a="",c,u,m=[],x,o,E,w;switch(n){case"dbcs":if(w=this.l,wr&&Buffer.isBuffer(this))a=this.slice(this.l,this.l+2*e).toString("utf16le");else for(E=0;E<e;++E)a+=String.fromCharCode(is(this,w)),w+=2;e*=2;break;case"utf8":a=su(this,this.l,this.l+e);break;case"utf16le":e*=2,a=td(this,this.l,this.l+e);break;case"wstr":return zc.call(this,e,"dbcs");case"lpstr-ansi":a=F1(this,this.l),e=4+Vi(this,this.l);break;case"lpstr-cp":a=M1(this,this.l),e=4+Vi(this,this.l);break;case"lpwstr":a=L1(this,this.l),e=4+2*Vi(this,this.l);break;case"lpp4":e=4+Vi(this,this.l),a=O1(this,this.l),e&2&&(e+=2);break;case"8lpp4":e=4+Vi(this,this.l),a=z1(this,this.l),e&3&&(e+=4-(e&3));break;case"cstr":for(e=0,a="";(x=dl(this,this.l+e++))!==0;)m.push(vh(x));a=m.join("");break;case"_wstr":for(e=0,a="";(x=is(this,this.l+e))!==0;)m.push(vh(x)),e+=2;e+=2,a=m.join("");break;case"dbcs-cont":for(a="",w=this.l,E=0;E<e;++E){if(this.lens&&this.lens.indexOf(w)!==-1)return x=dl(this,w),this.l=w+1,o=zc.call(this,e-E,x?"dbcs-cont":"sbcs-cont"),m.join("")+o;m.push(vh(is(this,w))),w+=2}a=m.join(""),e*=2;break;case"cpstr":case"sbcs-cont":for(a="",w=this.l,E=0;E!=e;++E){if(this.lens&&this.lens.indexOf(w)!==-1)return x=dl(this,w),this.l=w+1,o=zc.call(this,e-E,x?"dbcs-cont":"sbcs-cont"),m.join("")+o;m.push(vh(dl(this,w))),w+=1}a=m.join("");break;default:switch(e){case 1:return c=dl(this,this.l),this.l++,c;case 2:return c=(n==="i"?IT:is)(this,this.l),this.l+=2,c;case 4:case-4:return n==="i"||!(this[this.l+3]&128)?(c=(e>0?co:FT)(this,this.l),this.l+=4,c):(u=Vi(this,this.l),this.l+=4,u);case 8:case-8:if(n==="f")return e==8?u=zh(this,this.l):u=zh([this[this.l+7],this[this.l+6],this[this.l+5],this[this.l+4],this[this.l+3],this[this.l+2],this[this.l+1],this[this.l+0]],0),this.l+=8,u;e=8;case 16:a=A1(this,this.l,e);break}}return this.l+=e,a}var PT=function(e,n,a){e[a]=n&255,e[a+1]=n>>>8&255,e[a+2]=n>>>16&255,e[a+3]=n>>>24&255},MT=function(e,n,a){e[a]=n&255,e[a+1]=n>>8&255,e[a+2]=n>>16&255,e[a+3]=n>>24&255},DT=function(e,n,a){e[a]=n&255,e[a+1]=n>>>8&255};function LT(e,n,a){var c=0,u=0;if(a==="dbcs"){for(u=0;u!=n.length;++u)DT(this,n.charCodeAt(u),this.l+2*u);c=2*n.length}else if(a==="sbcs"){for(n=n.replace(/[^\x00-\x7F]/g,"_"),u=0;u!=n.length;++u)this[this.l+u]=n.charCodeAt(u)&255;c=n.length}else if(a==="hex"){for(;u<e;++u)this[this.l++]=parseInt(n.slice(2*u,2*u+2),16)||0;return this}else if(a==="utf16le"){var m=Math.min(this.l+e,this.length);for(u=0;u<Math.min(n.length,e);++u){var x=n.charCodeAt(u);this[this.l++]=x&255,this[this.l++]=x>>8}for(;this.l<m;)this[this.l++]=0;return this}else switch(e){case 1:c=1,this[this.l]=n&255;break;case 2:c=2,this[this.l]=n&255,n>>>=8,this[this.l+1]=n&255;break;case 3:c=3,this[this.l]=n&255,n>>>=8,this[this.l+1]=n&255,n>>>=8,this[this.l+2]=n&255;break;case 4:c=4,PT(this,n,this.l);break;case 8:if(c=8,a==="f"){AT(this,n,this.l);break}case 16:break;case-4:c=4,MT(this,n,this.l);break}return this.l+=c,this}function V1(e,n){var a=A1(this,this.l,e.length>>1);if(a!==e)throw new Error(n+"Expected "+e+" saw "+a);this.l+=e.length>>1}function Za(e,n){e.l=n,e.read_shift=zc,e.chk=V1,e.write_shift=LT}function hi(e,n){e.l+=n}function Ma(e){var n=zs(e);return Za(n,0),n}function cs(e,n,a){if(e){var c,u,m;Za(e,e.l||0);for(var x=e.length,o=0,E=0;e.l<x;){o=e.read_shift(1),o&128&&(o=(o&127)+((e.read_shift(1)&127)<<7));var w=Gh[o]||Gh[65535];for(c=e.read_shift(1),m=c&127,u=1;u<4&&c&128;++u)m+=((c=e.read_shift(1))&127)<<7*u;E=e.l+m;var C=w.f&&w.f(e,m,a);if(e.l=E,n(C,w,o))return}}}function C0(){var e=[],n=wr?256:2048,a=function(w){var C=Ma(w);return Za(C,0),C},c=a(n),u=function(){c&&(c.length>c.l&&(c=c.slice(0,c.l),c.l=c.length),c.length>0&&e.push(c),c=null)},m=function(w){return c&&w<c.length-c.l?c:(u(),c=a(Math.max(w+1,n)))},x=function(){return u(),Ps(e)},o=function(w){u(),c=w,c.l==null&&(c.l=c.length),m(n)};return{next:m,push:o,end:x,_bufs:e}}function Nc(e,n,a){var c=Xa(e);if(n.s?(c.cRel&&(c.c+=n.s.c),c.rRel&&(c.r+=n.s.r)):(c.cRel&&(c.c+=n.c),c.rRel&&(c.r+=n.r)),!a||a.biff<12){for(;c.c>=256;)c.c-=256;for(;c.r>=65536;)c.r-=65536}return c}function Ym(e,n,a){var c=Xa(e);return c.s=Nc(c.s,n.s,a),c.e=Nc(c.e,n.s,a),c}function Uc(e,n){if(e.cRel&&e.c<0)for(e=Xa(e);e.c<0;)e.c+=n>8?16384:256;if(e.rRel&&e.r<0)for(e=Xa(e);e.r<0;)e.r+=n>8?1048576:n>5?65536:16384;var a=or(e);return!e.cRel&&e.cRel!=null&&(a=BT(a)),!e.rRel&&e.rRel!=null&&(a=RT(a)),a}function p0(e,n){return e.s.r==0&&!e.s.rRel&&e.e.r==(n.biff>=12?1048575:n.biff>=8?65536:16384)&&!e.e.rRel?(e.s.cRel?"":"$")+Da(e.s.c)+":"+(e.e.cRel?"":"$")+Da(e.e.c):e.s.c==0&&!e.s.cRel&&e.e.c==(n.biff>=12?16383:255)&&!e.e.cRel?(e.s.rRel?"":"$")+Ka(e.s.r)+":"+(e.e.rRel?"":"$")+Ka(e.e.r):Uc(e.s,n.biff)+":"+Uc(e.e,n.biff)}function rd(e){return parseInt(OT(e),10)-1}function Ka(e){return""+(e+1)}function RT(e){return e.replace(/([A-Z]|^)(\d+)$/,"$1$$$2")}function OT(e){return e.replace(/\$(\d+)$/,"$1")}function ad(e){for(var n=zT(e),a=0,c=0;c!==n.length;++c)a=26*a+n.charCodeAt(c)-64;return a-1}function Da(e){if(e<0)throw new Error("invalid column "+e);var n="";for(++e;e;e=Math.floor((e-1)/26))n=String.fromCharCode((e-1)%26+65)+n;return n}function BT(e){return e.replace(/^([A-Z])/,"$$$1")}function zT(e){return e.replace(/^\$([A-Z])/,"$1")}function NT(e){return e.replace(/(\$?[A-Z]*)(\$?\d*)/,"$1,$2").split(",")}function Si(e){for(var n=0,a=0,c=0;c<e.length;++c){var u=e.charCodeAt(c);u>=48&&u<=57?n=10*n+(u-48):u>=65&&u<=90&&(a=26*a+(u-64))}return{c:a-1,r:n-1}}function or(e){for(var n=e.c+1,a="";n;n=(n-1)/26|0)a=String.fromCharCode((n-1)%26+65)+a;return a+(e.r+1)}function Sl(e){var n=e.indexOf(":");return n==-1?{s:Si(e),e:Si(e)}:{s:Si(e.slice(0,n)),e:Si(e.slice(n+1))}}function Tr(e,n){return typeof n>"u"||typeof n=="number"?Tr(e.s,e.e):(typeof e!="string"&&(e=or(e)),typeof n!="string"&&(n=or(n)),e==n?e:e+":"+n)}function da(e){var n={s:{c:0,r:0},e:{c:0,r:0}},a=0,c=0,u=0,m=e.length;for(a=0;c<m&&!((u=e.charCodeAt(c)-64)<1||u>26);++c)a=26*a+u;for(n.s.c=--a,a=0;c<m&&!((u=e.charCodeAt(c)-48)<0||u>9);++c)a=10*a+u;if(n.s.r=--a,c===m||u!=10)return n.e.c=n.s.c,n.e.r=n.s.r,n;for(++c,a=0;c!=m&&!((u=e.charCodeAt(c)-64)<1||u>26);++c)a=26*a+u;for(n.e.c=--a,a=0;c!=m&&!((u=e.charCodeAt(c)-48)<0||u>9);++c)a=10*a+u;return n.e.r=--a,n}function Jm(e,n){var a=e.t=="d"&&n instanceof Date;if(e.z!=null)try{return e.w=on(e.z,a?Ci(n):n)}catch{}try{return e.w=on((e.XF||{}).numFmtId||(a?14:0),a?Ci(n):n)}catch{return""+n}}function ls(e,n,a){return e==null||e.t==null||e.t=="z"?"":e.w!==void 0?e.w:(e.t=="d"&&!e.z&&a&&a.dateNF&&(e.z=a.dateNF),e.t=="e"?ko[e.v]||e.v:n==null?Jm(e,e.v):Jm(e,n))}function Us(e,n){var a=n&&n.sheet?n.sheet:"Sheet1",c={};return c[a]=e,{SheetNames:[a],Sheets:c}}function $1(e,n,a){var c=a||{},u=e?Array.isArray(e):c.dense,m=e||(u?[]:{}),x=0,o=0;if(m&&c.origin!=null){if(typeof c.origin=="number")x=c.origin;else{var E=typeof c.origin=="string"?Si(c.origin):c.origin;x=E.r,o=E.c}m["!ref"]||(m["!ref"]="A1:A1")}var w={s:{c:1e7,r:1e7},e:{c:0,r:0}};if(m["!ref"]){var C=da(m["!ref"]);w.s.c=C.s.c,w.s.r=C.s.r,w.e.c=Math.max(w.e.c,C.e.c),w.e.r=Math.max(w.e.r,C.e.r),x==-1&&(w.e.r=x=C.e.r+1)}for(var P=0;P!=n.length;++P)if(n[P]){if(!Array.isArray(n[P]))throw new Error("aoa_to_sheet expects an array of arrays");for(var M=0;M!=n[P].length;++M)if(!(typeof n[P][M]>"u")){var O={v:n[P][M]},U=x+P,z=o+M;if(w.s.r>U&&(w.s.r=U),w.s.c>z&&(w.s.c=z),w.e.r<U&&(w.e.r=U),w.e.c<z&&(w.e.c=z),n[P][M]&&typeof n[P][M]=="object"&&!Array.isArray(n[P][M])&&!(n[P][M]instanceof Date))O=n[P][M];else if(Array.isArray(O.v)&&(O.f=n[P][M][1],O.v=O.v[0]),O.v===null)if(O.f)O.t="n";else if(c.nullError)O.t="e",O.v=0;else if(c.sheetStubs)O.t="z";else continue;else typeof O.v=="number"?O.t="n":typeof O.v=="boolean"?O.t="b":O.v instanceof Date?(O.z=c.dateNF||fr[14],c.cellDates?(O.t="d",O.w=on(O.z,Ci(O.v))):(O.t="n",O.v=Ci(O.v),O.w=on(O.z,O.v))):O.t="s";if(u)m[U]||(m[U]=[]),m[U][z]&&m[U][z].z&&(O.z=m[U][z].z),m[U][z]=O;else{var j=or({c:z,r:U});m[j]&&m[j].z&&(O.z=m[j].z),m[j]=O}}}return w.s.c<1e7&&(m["!ref"]=Tr(w)),m}function kl(e,n){return $1(null,e,n)}function UT(e){return e.read_shift(4,"i")}function ui(e){var n=e.read_shift(4);return n===0?"":e.read_shift(n,"dbcs")}function VT(e){return{ich:e.read_shift(2),ifnt:e.read_shift(2)}}function id(e,n){var a=e.l,c=e.read_shift(1),u=ui(e),m=[],x={t:u,h:u};if(c&1){for(var o=e.read_shift(4),E=0;E!=o;++E)m.push(VT(e));x.r=m}else x.r=[{ich:0,ifnt:0}];return e.l=a+n,x}var $T=id;function ln(e){var n=e.read_shift(4),a=e.read_shift(2);return a+=e.read_shift(1)<<16,e.l++,{c:n,iStyleRef:a}}function Eo(e){var n=e.read_shift(2);return n+=e.read_shift(1)<<16,e.l++,{c:-1,iStyleRef:n}}var jT=ui;function nd(e){var n=e.read_shift(4);return n===0||n===4294967295?"":e.read_shift(n,"dbcs")}var GT=ui,A0=nd;function sd(e){var n=e.slice(e.l,e.l+4),a=n[0]&1,c=n[0]&2;e.l+=4;var u=c===0?zh([0,0,0,0,n[0]&252,n[1],n[2],n[3]],0):co(n,0)>>2;return a?u/100:u}function j1(e){var n={s:{},e:{}};return n.s.r=e.read_shift(4),n.e.r=e.read_shift(4),n.s.c=e.read_shift(4),n.e.c=e.read_shift(4),n}var So=j1;function li(e){if(e.length-e.l<8)throw"XLS Xnum Buffer underflow";return e.read_shift(8,"f")}function HT(e){var n={},a=e.read_shift(1),c=a>>>1,u=e.read_shift(1),m=e.read_shift(2,"i"),x=e.read_shift(1),o=e.read_shift(1),E=e.read_shift(1);switch(e.l++,c){case 0:n.auto=1;break;case 1:n.index=u;var w=xo[u];w&&(n.rgb=tu(w));break;case 2:n.rgb=tu([x,o,E]);break;case 3:n.theme=u;break}return m!=0&&(n.tint=m>0?m/32767:m/32768),n}function qT(e){var n=e.read_shift(1);e.l++;var a={fBold:n&1,fItalic:n&2,fUnderline:n&4,fStrikeout:n&8,fOutline:n&16,fShadow:n&32,fCondense:n&64,fExtend:n&128};return a}function G1(e,n){var a={2:"BITMAP",3:"METAFILEPICT",8:"DIB",14:"ENHMETAFILE"},c=e.read_shift(4);switch(c){case 0:return"";case 4294967295:case 4294967294:return a[e.read_shift(4)]||""}if(c>400)throw new Error("Unsupported Clipboard: "+c.toString(16));return e.l-=4,e.read_shift(0,n==1?"lpstr":"lpwstr")}function WT(e){return G1(e,1)}function ZT(e){return G1(e,2)}var od=2,Li=3,bh=11,Qm=12,Nh=19,Th=64,XT=65,KT=71,YT=4108,JT=4126,Na=80,H1=81,QT=[Na,H1],eE={1:{n:"CodePage",t:od},2:{n:"Category",t:Na},3:{n:"PresentationFormat",t:Na},4:{n:"ByteCount",t:Li},5:{n:"LineCount",t:Li},6:{n:"ParagraphCount",t:Li},7:{n:"SlideCount",t:Li},8:{n:"NoteCount",t:Li},9:{n:"HiddenCount",t:Li},10:{n:"MultimediaClipCount",t:Li},11:{n:"ScaleCrop",t:bh},12:{n:"HeadingPairs",t:YT},13:{n:"TitlesOfParts",t:JT},14:{n:"Manager",t:Na},15:{n:"Company",t:Na},16:{n:"LinksUpToDate",t:bh},17:{n:"CharacterCount",t:Li},19:{n:"SharedDoc",t:bh},22:{n:"HyperlinksChanged",t:bh},23:{n:"AppVersion",t:Li,p:"version"},24:{n:"DigSig",t:XT},26:{n:"ContentType",t:Na},27:{n:"ContentStatus",t:Na},28:{n:"Language",t:Na},29:{n:"Version",t:Na},255:{},2147483648:{n:"Locale",t:Nh},2147483651:{n:"Behavior",t:Nh},1919054434:{}},tE={1:{n:"CodePage",t:od},2:{n:"Title",t:Na},3:{n:"Subject",t:Na},4:{n:"Author",t:Na},5:{n:"Keywords",t:Na},6:{n:"Comments",t:Na},7:{n:"Template",t:Na},8:{n:"LastAuthor",t:Na},9:{n:"RevNumber",t:Na},10:{n:"EditTime",t:Th},11:{n:"LastPrinted",t:Th},12:{n:"CreatedDate",t:Th},13:{n:"ModifiedDate",t:Th},14:{n:"PageCount",t:Li},15:{n:"WordCount",t:Li},16:{n:"CharCount",t:Li},17:{n:"Thumbnail",t:KT},18:{n:"Application",t:Na},19:{n:"DocSecurity",t:Li},255:{},2147483648:{n:"Locale",t:Nh},2147483651:{n:"Behavior",t:Nh},1919054434:{}},eg={1:"US",2:"CA",3:"",7:"RU",20:"EG",30:"GR",31:"NL",32:"BE",33:"FR",34:"ES",36:"HU",39:"IT",41:"CH",43:"AT",44:"GB",45:"DK",46:"SE",47:"NO",48:"PL",49:"DE",52:"MX",55:"BR",61:"AU",64:"NZ",66:"TH",81:"JP",82:"KR",84:"VN",86:"CN",90:"TR",105:"JS",213:"DZ",216:"MA",218:"LY",351:"PT",354:"IS",358:"FI",420:"CZ",886:"TW",961:"LB",962:"JO",963:"SY",964:"IQ",965:"KW",966:"SA",971:"AE",972:"IL",974:"QA",981:"IR",65535:"US"},rE=[null,"solid","mediumGray","darkGray","lightGray","darkHorizontal","darkVertical","darkDown","darkUp","darkGrid","darkTrellis","lightHorizontal","lightVertical","lightDown","lightUp","lightGrid","lightTrellis","gray125","gray0625"];function aE(e){return e.map(function(n){return[n>>16&255,n>>8&255,n&255]})}var iE=aE([0,16777215,16711680,65280,255,16776960,16711935,65535,0,16777215,16711680,65280,255,16776960,16711935,65535,8388608,32768,128,8421376,8388736,32896,12632256,8421504,10066431,10040166,16777164,13434879,6684774,16744576,26316,13421823,128,16711935,16776960,65535,8388736,8388608,32896,255,52479,13434879,13434828,16777113,10079487,16751052,13408767,16764057,3368703,3394764,10079232,16763904,16750848,16737792,6710937,9868950,13158,3381606,13056,3355392,10040064,10040166,3355545,3355443,16777215,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),xo=Xa(iE),ko={0:"#NULL!",7:"#DIV/0!",15:"#VALUE!",23:"#REF!",29:"#NAME?",36:"#NUM!",42:"#N/A",43:"#GETTING_DATA",255:"#WTF?"},q1={"#NULL!":0,"#DIV/0!":7,"#VALUE!":15,"#REF!":23,"#NAME?":29,"#NUM!":36,"#N/A":42,"#GETTING_DATA":43,"#WTF?":255},tg={"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml":"workbooks","application/vnd.ms-excel.sheet.macroEnabled.main+xml":"workbooks","application/vnd.ms-excel.sheet.binary.macroEnabled.main":"workbooks","application/vnd.ms-excel.addin.macroEnabled.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml":"sheets","application/vnd.ms-excel.worksheet":"sheets","application/vnd.ms-excel.binIndexWs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml":"charts","application/vnd.ms-excel.chartsheet":"charts","application/vnd.ms-excel.macrosheet+xml":"macros","application/vnd.ms-excel.macrosheet":"macros","application/vnd.ms-excel.intlmacrosheet":"TODO","application/vnd.ms-excel.binIndexMs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml":"dialogs","application/vnd.ms-excel.dialogsheet":"dialogs","application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml":"strs","application/vnd.ms-excel.sharedStrings":"strs","application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml":"styles","application/vnd.ms-excel.styles":"styles","application/vnd.openxmlformats-package.core-properties+xml":"coreprops","application/vnd.openxmlformats-officedocument.custom-properties+xml":"custprops","application/vnd.openxmlformats-officedocument.extended-properties+xml":"extprops","application/vnd.openxmlformats-officedocument.customXmlProperties+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.customProperty":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml":"comments","application/vnd.ms-excel.comments":"comments","application/vnd.ms-excel.threadedcomments+xml":"threadedcomments","application/vnd.ms-excel.person+xml":"people","application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml":"metadata","application/vnd.ms-excel.sheetMetadata":"metadata","application/vnd.ms-excel.pivotTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotTable+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.chart+xml":"TODO","application/vnd.ms-office.chartcolorstyle+xml":"TODO","application/vnd.ms-office.chartstyle+xml":"TODO","application/vnd.ms-office.chartex+xml":"TODO","application/vnd.ms-excel.calcChain":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.calcChain+xml":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.printerSettings":"TODO","application/vnd.ms-office.activeX":"TODO","application/vnd.ms-office.activeX+xml":"TODO","application/vnd.ms-excel.attachedToolbars":"TODO","application/vnd.ms-excel.connections":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.connections+xml":"TODO","application/vnd.ms-excel.externalLink":"links","application/vnd.openxmlformats-officedocument.spreadsheetml.externalLink+xml":"links","application/vnd.ms-excel.pivotCacheDefinition":"TODO","application/vnd.ms-excel.pivotCacheRecords":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheDefinition+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheRecords+xml":"TODO","application/vnd.ms-excel.queryTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.queryTable+xml":"TODO","application/vnd.ms-excel.userNames":"TODO","application/vnd.ms-excel.revisionHeaders":"TODO","application/vnd.ms-excel.revisionLog":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionHeaders+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionLog+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.userNames+xml":"TODO","application/vnd.ms-excel.tableSingleCells":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.tableSingleCells+xml":"TODO","application/vnd.ms-excel.slicer":"TODO","application/vnd.ms-excel.slicerCache":"TODO","application/vnd.ms-excel.slicer+xml":"TODO","application/vnd.ms-excel.slicerCache+xml":"TODO","application/vnd.ms-excel.wsSortMap":"TODO","application/vnd.ms-excel.table":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml":"TODO","application/vnd.openxmlformats-officedocument.theme+xml":"themes","application/vnd.openxmlformats-officedocument.themeOverride+xml":"TODO","application/vnd.ms-excel.Timeline+xml":"TODO","application/vnd.ms-excel.TimelineCache+xml":"TODO","application/vnd.ms-office.vbaProject":"vba","application/vnd.ms-office.vbaProjectSignature":"TODO","application/vnd.ms-office.volatileDependencies":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.volatileDependencies+xml":"TODO","application/vnd.ms-excel.controlproperties+xml":"TODO","application/vnd.openxmlformats-officedocument.model+data":"TODO","application/vnd.ms-excel.Survey+xml":"TODO","application/vnd.openxmlformats-officedocument.drawing+xml":"drawings","application/vnd.openxmlformats-officedocument.drawingml.chartshapes+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramColors+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramData+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramLayout+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramStyle+xml":"TODO","application/vnd.openxmlformats-officedocument.vmlDrawing":"TODO","application/vnd.openxmlformats-package.relationships+xml":"rels","application/vnd.openxmlformats-officedocument.oleObject":"TODO","image/png":"TODO",sheet:"js"};function nE(){return{workbooks:[],sheets:[],charts:[],dialogs:[],macros:[],rels:[],strs:[],comments:[],threadedcomments:[],links:[],coreprops:[],extprops:[],custprops:[],themes:[],styles:[],calcchains:[],vba:[],drawings:[],metadata:[],people:[],TODO:[],xmlns:""}}function sE(e){var n=nE();if(!e||!e.match)return n;var a={};if((e.match(fi)||[]).forEach(function(c){var u=ar(c);switch(u[0].replace(pT,"<")){case"<?xml":break;case"<Types":n.xmlns=u["xmlns"+(u[0].match(/<(\w+):/)||["",""])[1]];break;case"<Default":a[u.Extension]=u.ContentType;break;case"<Override":n[tg[u.ContentType]]!==void 0&&n[tg[u.ContentType]].push(u.PartName);break}}),n.xmlns!==ST.CT)throw new Error("Unknown Namespace: "+n.xmlns);return n.calcchain=n.calcchains.length>0?n.calcchains[0]:"",n.sst=n.strs.length>0?n.strs[0]:"",n.style=n.styles.length>0?n.styles[0]:"",n.defaults=a,delete n.calcchains,n}var pl={WB:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument",SHEET:"http://sheetjs.openxmlformats.org/officeDocument/2006/relationships/officeDocument",HLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink",VML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/vmlDrawing",XPATH:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLinkPath",XMISS:"http://schemas.microsoft.com/office/2006/relationships/xlExternalLinkPath/xlPathMissing",XLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLink",CXML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXml",CXMLP:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXmlProps",CMNT:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/comments",CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/custom-properties",SST:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings",STY:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles",THEME:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/theme",CHART:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chart",CHARTEX:"http://schemas.microsoft.com/office/2014/relationships/chartEx",CS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chartsheet",WS:["http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet","http://purl.oclc.org/ooxml/officeDocument/relationships/worksheet"],DS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/dialogsheet",MS:"http://schemas.microsoft.com/office/2006/relationships/xlMacrosheet",IMG:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/image",DRAW:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing",XLMETA:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sheetMetadata",TCMNT:"http://schemas.microsoft.com/office/2017/10/relationships/threadedComment",PEOPLE:"http://schemas.microsoft.com/office/2017/10/relationships/person",VBA:"http://schemas.microsoft.com/office/2006/relationships/vbaProject"};function I0(e){var n=e.lastIndexOf("/");return e.slice(0,n+1)+"_rels/"+e.slice(n+1)+".rels"}function Vc(e,n){var a={"!id":{}};if(!e)return a;n.charAt(0)!=="/"&&(n="/"+n);var c={};return(e.match(fi)||[]).forEach(function(u){var m=ar(u);if(m[0]==="<Relationship"){var x={};x.Type=m.Type,x.Target=m.Target,x.Id=m.Id,m.TargetMode&&(x.TargetMode=m.TargetMode);var o=m.TargetMode==="External"?m.Target:Oc(m.Target,n);a[o]=x,c[m.Id]=x}}),a["!id"]=c,a}var oE="application/vnd.oasis.opendocument.spreadsheet";function lE(e,n){for(var a=ed(e),c,u;c=Qc.exec(a);)switch(c[3]){case"manifest":break;case"file-entry":if(u=ar(c[0],!1),u.path=="/"&&u.type!==oE)throw new Error("This OpenDocument is not a spreadsheet");break;case"encryption-data":case"algorithm":case"start-key-generation":case"key-derivation":throw new Error("Unsupported ODS Encryption");default:if(n&&n.WTF)throw c}}var $c=[["cp:category","Category"],["cp:contentStatus","ContentStatus"],["cp:keywords","Keywords"],["cp:lastModifiedBy","LastAuthor"],["cp:lastPrinted","LastPrinted"],["cp:revision","RevNumber"],["cp:version","Version"],["dc:creator","Author"],["dc:description","Comments"],["dc:identifier","Identifier"],["dc:language","Language"],["dc:subject","Subject"],["dc:title","Title"],["dcterms:created","CreatedDate","date"],["dcterms:modified","ModifiedDate","date"]],cE=function(){for(var e=new Array($c.length),n=0;n<$c.length;++n){var a=$c[n],c="(?:"+a[0].slice(0,a[0].indexOf(":"))+":)"+a[0].slice(a[0].indexOf(":")+1);e[n]=new RegExp("<"+c+"[^>]*>([\\s\\S]*?)</"+c+">")}return e}();function W1(e){var n={};e=Zr(e);for(var a=0;a<$c.length;++a){var c=$c[a],u=e.match(cE[a]);u!=null&&u.length>0&&(n[c[1]]=Er(u[1])),c[2]==="date"&&n[c[1]]&&(n[c[1]]=Ua(n[c[1]]))}return n}var uE=[["Application","Application","string"],["AppVersion","AppVersion","string"],["Company","Company","string"],["DocSecurity","DocSecurity","string"],["Manager","Manager","string"],["HyperlinksChanged","HyperlinksChanged","bool"],["SharedDoc","SharedDoc","bool"],["LinksUpToDate","LinksUpToDate","bool"],["ScaleCrop","ScaleCrop","bool"],["HeadingPairs","HeadingPairs","raw"],["TitlesOfParts","TitlesOfParts","raw"]];function Z1(e,n,a,c){var u=[];if(typeof e=="string")u=Hm(e,c);else for(var m=0;m<e.length;++m)u=u.concat(e[m].map(function(C){return{v:C}}));var x=typeof n=="string"?Hm(n,c).map(function(C){return C.v}):n,o=0,E=0;if(x.length>0)for(var w=0;w!==u.length;w+=2){switch(E=+u[w+1].v,u[w].v){case"Worksheets":case"工作表":case"Листы":case"أوراق العمل":case"ワークシート":case"גליונות עבודה":case"Arbeitsblätter":case"Çalışma Sayfaları":case"Feuilles de calcul":case"Fogli di lavoro":case"Folhas de cálculo":case"Planilhas":case"Regneark":case"Hojas de cálculo":case"Werkbladen":a.Worksheets=E,a.SheetNames=x.slice(o,o+E);break;case"Named Ranges":case"Rangos con nombre":case"名前付き一覧":case"Benannte Bereiche":case"Navngivne områder":a.NamedRanges=E,a.DefinedNames=x.slice(o,o+E);break;case"Charts":case"Diagramme":a.Chartsheets=E,a.ChartNames=x.slice(o,o+E);break}o+=E}}function hE(e,n,a){var c={};return n||(n={}),e=Zr(e),uE.forEach(function(u){var m=(e.match(Jc(u[0]))||[])[1];switch(u[2]){case"string":m&&(n[u[1]]=Er(m));break;case"bool":n[u[1]]=m==="true";break;case"raw":var x=e.match(new RegExp("<"+u[0]+"[^>]*>([\\s\\S]*?)</"+u[0]+">"));x&&x.length>0&&(c[u[1]]=x[1]);break}}),c.HeadingPairs&&c.TitlesOfParts&&Z1(c.HeadingPairs,c.TitlesOfParts,n,a),n}var fE=/<[^>]+>[^<]*/g;function dE(e,n){var a={},c="",u=e.match(fE);if(u)for(var m=0;m!=u.length;++m){var x=u[m],o=ar(x);switch(o[0]){case"<?xml":break;case"<Properties":break;case"<property":c=Er(o.name);break;case"</property>":c=null;break;default:if(x.indexOf("<vt:")===0){var E=x.split(">"),w=E[0].slice(4),C=E[1];switch(w){case"lpstr":case"bstr":case"lpwstr":a[c]=Er(C);break;case"bool":a[c]=aa(C);break;case"i1":case"i2":case"i4":case"i8":case"int":case"uint":a[c]=parseInt(C,10);break;case"r4":case"r8":case"decimal":a[c]=parseFloat(C);break;case"filetime":case"date":a[c]=Ua(C);break;case"cy":case"error":a[c]=Er(C);break;default:if(w.slice(-1)=="/")break;n.WTF&&typeof console<"u"&&console.warn("Unexpected",x,w,E)}}else if(x.slice(0,2)!=="</"){if(n.WTF)throw new Error(x)}}}return a}var pE={Title:"Title",Subject:"Subject",Author:"Author",Keywords:"Keywords",Comments:"Description",LastAuthor:"LastAuthor",RevNumber:"Revision",Application:"AppName",LastPrinted:"LastPrinted",CreatedDate:"Created",ModifiedDate:"LastSaved",Category:"Category",Manager:"Manager",Company:"Company",AppVersion:"Version",ContentStatus:"ContentStatus",Identifier:"Identifier",Language:"Language"},m0;function mE(e,n,a){m0||(m0=Y0(pE)),n=m0[n]||n,e[n]=a}function ld(e){var n=e.read_shift(4),a=e.read_shift(4);return new Date((a/1e7*Math.pow(2,32)+n/1e7-11644473600)*1e3).toISOString().replace(/\.000/,"")}function X1(e,n,a){var c=e.l,u=e.read_shift(0,"lpstr-cp");if(a)for(;e.l-c&3;)++e.l;return u}function K1(e,n,a){var c=e.read_shift(0,"lpwstr");return a&&(e.l+=4-(c.length+1&3)&3),c}function Y1(e,n,a){return n===31?K1(e):X1(e,n,a)}function F0(e,n,a){return Y1(e,n,a===!1?0:4)}function gE(e,n){if(!n)throw new Error("VtUnalignedString must have positive length");return Y1(e,n,0)}function xE(e){for(var n=e.read_shift(4),a=[],c=0;c!=n;++c){var u=e.l;a[c]=e.read_shift(0,"lpwstr").replace(ki,""),e.l-u&2&&(e.l+=2)}return a}function _E(e){for(var n=e.read_shift(4),a=[],c=0;c!=n;++c)a[c]=e.read_shift(0,"lpstr-cp").replace(ki,"");return a}function yE(e){var n=e.l,a=Uh(e,H1);e[e.l]==0&&e[e.l+1]==0&&e.l-n&2&&(e.l+=2);var c=Uh(e,Li);return[a,c]}function vE(e){for(var n=e.read_shift(4),a=[],c=0;c<n/2;++c)a.push(yE(e));return a}function rg(e,n){for(var a=e.read_shift(4),c={},u=0;u!=a;++u){var m=e.read_shift(4),x=e.read_shift(4);c[m]=e.read_shift(x,n===1200?"utf16le":"utf8").replace(ki,"").replace(Rc,"!"),n===1200&&x%2&&(e.l+=2)}return e.l&3&&(e.l=e.l>>3<<2),c}function J1(e){var n=e.read_shift(4),a=e.slice(e.l,e.l+n);return e.l+=n,(n&3)>0&&(e.l+=4-(n&3)&3),a}function wE(e){var n={};return n.Size=e.read_shift(4),e.l+=n.Size+3-(n.Size-1)%4,n}function Uh(e,n,a){var c=e.read_shift(2),u,m=a||{};if(e.l+=2,n!==Qm&&c!==n&&QT.indexOf(n)===-1&&!((n&65534)==4126&&(c&65534)==4126))throw new Error("Expected type "+n+" saw "+c);switch(n===Qm?c:n){case 2:return u=e.read_shift(2,"i"),m.raw||(e.l+=2),u;case 3:return u=e.read_shift(4,"i"),u;case 11:return e.read_shift(4)!==0;case 19:return u=e.read_shift(4),u;case 30:return X1(e,c,4).replace(ki,"");case 31:return K1(e);case 64:return ld(e);case 65:return J1(e);case 71:return wE(e);case 80:return F0(e,c,!m.raw).replace(ki,"");case 81:return gE(e,c).replace(ki,"");case 4108:return vE(e);case 4126:case 4127:return c==4127?xE(e):_E(e);default:throw new Error("TypedPropertyValue unrecognized type "+n+" "+c)}}function ag(e,n){var a=e.l,c=e.read_shift(4),u=e.read_shift(4),m=[],x=0,o=0,E=-1,w={};for(x=0;x!=u;++x){var C=e.read_shift(4),P=e.read_shift(4);m[x]=[C,P+a]}m.sort(function(le,Z){return le[1]-Z[1]});var M={};for(x=0;x!=u;++x){if(e.l!==m[x][1]){var O=!0;if(x>0&&n)switch(n[m[x-1][0]].t){case 2:e.l+2===m[x][1]&&(e.l+=2,O=!1);break;case 80:e.l<=m[x][1]&&(e.l=m[x][1],O=!1);break;case 4108:e.l<=m[x][1]&&(e.l=m[x][1],O=!1);break}if((!n||x==0)&&e.l<=m[x][1]&&(O=!1,e.l=m[x][1]),O)throw new Error("Read Error: Expected address "+m[x][1]+" at "+e.l+" :"+x)}if(n){var U=n[m[x][0]];if(M[U.n]=Uh(e,U.t,{raw:!0}),U.p==="version"&&(M[U.n]=String(M[U.n]>>16)+"."+("0000"+String(M[U.n]&65535)).slice(-4)),U.n=="CodePage")switch(M[U.n]){case 0:M[U.n]=1252;case 874:case 932:case 936:case 949:case 950:case 1250:case 1251:case 1253:case 1254:case 1255:case 1256:case 1257:case 1258:case 1e4:case 1200:case 1201:case 1252:case 65e3:case-536:case 65001:case-535:En(o=M[U.n]>>>0&65535);break;default:throw new Error("Unsupported CodePage: "+M[U.n])}}else if(m[x][0]===1){if(o=M.CodePage=Uh(e,od),En(o),E!==-1){var z=e.l;e.l=m[E][1],w=rg(e,o),e.l=z}}else if(m[x][0]===0){if(o===0){E=x,e.l=m[x+1][1];continue}w=rg(e,o)}else{var j=w[m[x][0]],ee;switch(e[e.l]){case 65:e.l+=4,ee=J1(e);break;case 30:e.l+=4,ee=F0(e,e[e.l-4]).replace(/\u0000+$/,"");break;case 31:e.l+=4,ee=F0(e,e[e.l-4]).replace(/\u0000+$/,"");break;case 3:e.l+=4,ee=e.read_shift(4,"i");break;case 19:e.l+=4,ee=e.read_shift(4);break;case 5:e.l+=4,ee=e.read_shift(8,"f");break;case 11:e.l+=4,ee=Ta(e,4);break;case 64:e.l+=4,ee=Ua(ld(e));break;default:throw new Error("unparsed value: "+e[e.l])}M[j]=ee}}return e.l=a+c,M}function ig(e,n,a){var c=e.content;if(!c)return{};Za(c,0);var u,m,x,o,E=0;c.chk("feff","Byte Order: "),c.read_shift(2);var w=c.read_shift(4),C=c.read_shift(16);if(C!==br.utils.consts.HEADER_CLSID&&C!==a)throw new Error("Bad PropertySet CLSID "+C);if(u=c.read_shift(4),u!==1&&u!==2)throw new Error("Unrecognized #Sets: "+u);if(m=c.read_shift(16),o=c.read_shift(4),u===1&&o!==c.l)throw new Error("Length mismatch: "+o+" !== "+c.l);u===2&&(x=c.read_shift(16),E=c.read_shift(4));var P=ag(c,n),M={SystemIdentifier:w};for(var O in P)M[O]=P[O];if(M.FMTID=m,u===1)return M;if(E-c.l==2&&(c.l+=2),c.l!==E)throw new Error("Length mismatch 2: "+c.l+" !== "+E);var U;try{U=ag(c,null)}catch{}for(O in U)M[O]=U[O];return M.FMTID=[m,x],M}function Is(e,n){return e.read_shift(n),null}function bE(e,n,a){for(var c=[],u=e.l+n;e.l<u;)c.push(a(e,u-e.l));if(u!==e.l)throw new Error("Slurp error");return c}function Ta(e,n){return e.read_shift(n)===1}function Ca(e){return e.read_shift(2,"u")}function Q1(e,n){return bE(e,n,Ca)}function TE(e){var n=e.read_shift(1),a=e.read_shift(1);return a===1?n:n===1}function ou(e,n,a){var c=e.read_shift(a&&a.biff>=12?2:1),u="sbcs-cont";if(a&&a.biff>=8,!a||a.biff==8){var m=e.read_shift(1);m&&(u="dbcs-cont")}else a.biff==12&&(u="wstr");a.biff>=2&&a.biff<=5&&(u="cpstr");var x=c?e.read_shift(c,u):"";return x}function EE(e){var n=e.read_shift(2),a=e.read_shift(1),c=a&4,u=a&8,m=1+(a&1),x=0,o,E={};u&&(x=e.read_shift(2)),c&&(o=e.read_shift(4));var w=m==2?"dbcs-cont":"sbcs-cont",C=n===0?"":e.read_shift(n,w);return u&&(e.l+=4*x),c&&(e.l+=o),E.t=C,u||(E.raw="<t>"+E.t+"</t>",E.r=E.t),E}function vo(e,n,a){var c;if(a){if(a.biff>=2&&a.biff<=5)return e.read_shift(n,"cpstr");if(a.biff>=12)return e.read_shift(n,"dbcs-cont")}var u=e.read_shift(1);return u===0?c=e.read_shift(n,"sbcs-cont"):c=e.read_shift(n,"dbcs-cont"),c}function lu(e,n,a){var c=e.read_shift(a&&a.biff==2?1:2);return c===0?(e.l++,""):vo(e,c,a)}function Co(e,n,a){if(a.biff>5)return lu(e,n,a);var c=e.read_shift(1);return c===0?(e.l++,""):e.read_shift(c,a.biff<=4||!e.lens?"cpstr":"sbcs-cont")}function SE(e){var n=e.read_shift(1);e.l++;var a=e.read_shift(2);return e.l+=2,[n,a]}function kE(e){var n=e.read_shift(4),a=e.l,c=!1;n>24&&(e.l+=n-24,e.read_shift(16)==="795881f43b1d7f48af2c825dc4852763"&&(c=!0),e.l=a);var u=e.read_shift((c?n-24:n)>>1,"utf16le").replace(ki,"");return c&&(e.l+=24),u}function CE(e){for(var n=e.read_shift(2),a="";n-- >0;)a+="../";var c=e.read_shift(0,"lpstr-ansi");if(e.l+=2,e.read_shift(2)!=57005)throw new Error("Bad FileMoniker");var u=e.read_shift(4);if(u===0)return a+c.replace(/\\/g,"/");var m=e.read_shift(4);if(e.read_shift(2)!=3)throw new Error("Bad FileMoniker");var x=e.read_shift(m>>1,"utf16le").replace(ki,"");return a+x}function AE(e,n){var a=e.read_shift(16);switch(a){case"e0c9ea79f9bace118c8200aa004ba90b":return kE(e);case"0303000000000000c000000000000046":return CE(e);default:throw new Error("Unsupported Moniker "+a)}}function Eh(e){var n=e.read_shift(4),a=n>0?e.read_shift(n,"utf16le").replace(ki,""):"";return a}function IE(e,n){var a=e.l+n,c=e.read_shift(4);if(c!==2)throw new Error("Unrecognized streamVersion: "+c);var u=e.read_shift(2);e.l+=2;var m,x,o,E,w="",C,P;u&16&&(m=Eh(e,a-e.l)),u&128&&(x=Eh(e,a-e.l)),(u&257)===257&&(o=Eh(e,a-e.l)),(u&257)===1&&(E=AE(e,a-e.l)),u&8&&(w=Eh(e,a-e.l)),u&32&&(C=e.read_shift(16)),u&64&&(P=ld(e)),e.l=a;var M=x||o||E||"";M&&w&&(M+="#"+w),M||(M="#"+w),u&2&&M.charAt(0)=="/"&&M.charAt(1)!="/"&&(M="file://"+M);var O={Target:M};return C&&(O.guid=C),P&&(O.time=P),m&&(O.Tooltip=m),O}function ex(e){var n=e.read_shift(1),a=e.read_shift(1),c=e.read_shift(1),u=e.read_shift(1);return[n,a,c,u]}function tx(e,n){var a=ex(e);return a[3]=0,a}function Vn(e){var n=e.read_shift(2),a=e.read_shift(2),c=e.read_shift(2);return{r:n,c:a,ixfe:c}}function FE(e){var n=e.read_shift(2),a=e.read_shift(2);return e.l+=8,{type:n,flags:a}}function PE(e,n,a){return n===0?"":Co(e,n,a)}function ME(e,n,a){var c=a.biff>8?4:2,u=e.read_shift(c),m=e.read_shift(c,"i"),x=e.read_shift(c,"i");return[u,m,x]}function rx(e){var n=e.read_shift(2),a=sd(e);return[n,a]}function DE(e,n,a){e.l+=4,n-=4;var c=e.l+n,u=ou(e,n,a),m=e.read_shift(2);if(c-=e.l,m!==c)throw new Error("Malformed AddinUdf: padding = "+c+" != "+m);return e.l+=m,u}function Xh(e){var n=e.read_shift(2),a=e.read_shift(2),c=e.read_shift(2),u=e.read_shift(2);return{s:{c,r:n},e:{c:u,r:a}}}function ax(e){var n=e.read_shift(2),a=e.read_shift(2),c=e.read_shift(1),u=e.read_shift(1);return{s:{c,r:n},e:{c:u,r:a}}}var LE=ax;function ix(e){e.l+=4;var n=e.read_shift(2),a=e.read_shift(2),c=e.read_shift(2);return e.l+=12,[a,n,c]}function RE(e){var n={};return e.l+=4,e.l+=16,n.fSharedNote=e.read_shift(2),e.l+=4,n}function OE(e){var n={};return e.l+=4,e.cf=e.read_shift(2),n}function si(e){e.l+=2,e.l+=e.read_shift(2)}var BE={0:si,4:si,5:si,6:si,7:OE,8:si,9:si,10:si,11:si,12:si,13:RE,14:si,15:si,16:si,17:si,18:si,19:si,20:si,21:ix};function zE(e,n){for(var a=e.l+n,c=[];e.l<a;){var u=e.read_shift(2);e.l-=2;try{c.push(BE[u](e,a-e.l))}catch{return e.l=a,c}}return e.l!=a&&(e.l=a),c}function Sh(e,n){var a={BIFFVer:0,dt:0};switch(a.BIFFVer=e.read_shift(2),n-=2,n>=2&&(a.dt=e.read_shift(2),e.l-=2),a.BIFFVer){case 1536:case 1280:case 1024:case 768:case 512:case 2:case 7:break;default:if(n>6)throw new Error("Unexpected BIFF Ver "+a.BIFFVer)}return e.read_shift(n),a}function NE(e,n){return n===0||e.read_shift(2),1200}function UE(e,n,a){if(a.enc)return e.l+=n,"";var c=e.l,u=Co(e,0,a);return e.read_shift(n+c-e.l),u}function VE(e,n,a){var c=a&&a.biff==8||n==2?e.read_shift(2):(e.l+=n,0);return{fDialog:c&16,fBelow:c&64,fRight:c&128}}function $E(e,n,a){var c=e.read_shift(4),u=e.read_shift(1)&3,m=e.read_shift(1);switch(m){case 0:m="Worksheet";break;case 1:m="Macrosheet";break;case 2:m="Chartsheet";break;case 6:m="VBAModule";break}var x=ou(e,0,a);return x.length===0&&(x="Sheet1"),{pos:c,hs:u,dt:m,name:x}}function jE(e,n){for(var a=e.l+n,c=e.read_shift(4),u=e.read_shift(4),m=[],x=0;x!=u&&e.l<a;++x)m.push(EE(e));return m.Count=c,m.Unique=u,m}function GE(e,n){var a={};return a.dsst=e.read_shift(2),e.l+=n-2,a}function HE(e){var n={};n.r=e.read_shift(2),n.c=e.read_shift(2),n.cnt=e.read_shift(2)-n.c;var a=e.read_shift(2);e.l+=4;var c=e.read_shift(1);return e.l+=3,c&7&&(n.level=c&7),c&32&&(n.hidden=!0),c&64&&(n.hpt=a/20),n}function qE(e){var n=FE(e);if(n.type!=2211)throw new Error("Invalid Future Record "+n.type);var a=e.read_shift(4);return a!==0}function WE(e){return e.read_shift(2),e.read_shift(4)}function ng(e,n,a){var c=0;a&&a.biff==2||(c=e.read_shift(2));var u=e.read_shift(2);a&&a.biff==2&&(c=1-(u>>15),u&=32767);var m={Unsynced:c&1,DyZero:(c&2)>>1,ExAsc:(c&4)>>2,ExDsc:(c&8)>>3};return[m,u]}function ZE(e){var n=e.read_shift(2),a=e.read_shift(2),c=e.read_shift(2),u=e.read_shift(2),m=e.read_shift(2),x=e.read_shift(2),o=e.read_shift(2),E=e.read_shift(2),w=e.read_shift(2);return{Pos:[n,a],Dim:[c,u],Flags:m,CurTab:x,FirstTab:o,Selected:E,TabRatio:w}}function XE(e,n,a){if(a&&a.biff>=2&&a.biff<5)return{};var c=e.read_shift(2);return{RTL:c&64}}function KE(){}function YE(e,n,a){var c={dyHeight:e.read_shift(2),fl:e.read_shift(2)};switch(a&&a.biff||8){case 2:break;case 3:case 4:e.l+=2;break;default:e.l+=10;break}return c.name=ou(e,0,a),c}function JE(e){var n=Vn(e);return n.isst=e.read_shift(4),n}function QE(e,n,a){a.biffguess&&a.biff==2&&(a.biff=5);var c=e.l+n,u=Vn(e);a.biff==2&&e.l++;var m=lu(e,c-e.l,a);return u.val=m,u}function eS(e,n,a){var c=e.read_shift(2),u=Co(e,0,a);return[c,u]}var tS=Co;function sg(e,n,a){var c=e.l+n,u=a.biff==8||!a.biff?4:2,m=e.read_shift(u),x=e.read_shift(u),o=e.read_shift(2),E=e.read_shift(2);return e.l=c,{s:{r:m,c:o},e:{r:x,c:E}}}function rS(e){var n=e.read_shift(2),a=e.read_shift(2),c=rx(e);return{r:n,c:a,ixfe:c[0],rknum:c[1]}}function aS(e,n){for(var a=e.l+n-2,c=e.read_shift(2),u=e.read_shift(2),m=[];e.l<a;)m.push(rx(e));if(e.l!==a)throw new Error("MulRK read error");var x=e.read_shift(2);if(m.length!=x-u+1)throw new Error("MulRK length mismatch");return{r:c,c:u,C:x,rkrec:m}}function iS(e,n){for(var a=e.l+n-2,c=e.read_shift(2),u=e.read_shift(2),m=[];e.l<a;)m.push(e.read_shift(2));if(e.l!==a)throw new Error("MulBlank read error");var x=e.read_shift(2);if(m.length!=x-u+1)throw new Error("MulBlank length mismatch");return{r:c,c:u,C:x,ixfe:m}}function nS(e,n,a,c){var u={},m=e.read_shift(4),x=e.read_shift(4),o=e.read_shift(4),E=e.read_shift(2);return u.patternType=rE[o>>26],c.cellStyles&&(u.alc=m&7,u.fWrap=m>>3&1,u.alcV=m>>4&7,u.fJustLast=m>>7&1,u.trot=m>>8&255,u.cIndent=m>>16&15,u.fShrinkToFit=m>>20&1,u.iReadOrder=m>>22&2,u.fAtrNum=m>>26&1,u.fAtrFnt=m>>27&1,u.fAtrAlc=m>>28&1,u.fAtrBdr=m>>29&1,u.fAtrPat=m>>30&1,u.fAtrProt=m>>31&1,u.dgLeft=x&15,u.dgRight=x>>4&15,u.dgTop=x>>8&15,u.dgBottom=x>>12&15,u.icvLeft=x>>16&127,u.icvRight=x>>23&127,u.grbitDiag=x>>30&3,u.icvTop=o&127,u.icvBottom=o>>7&127,u.icvDiag=o>>14&127,u.dgDiag=o>>21&15,u.icvFore=E&127,u.icvBack=E>>7&127,u.fsxButton=E>>14&1),u}function sS(e,n,a){var c={};return c.ifnt=e.read_shift(2),c.numFmtId=e.read_shift(2),c.flags=e.read_shift(2),c.fStyle=c.flags>>2&1,n-=6,c.data=nS(e,n,c.fStyle,a),c}function oS(e){e.l+=4;var n=[e.read_shift(2),e.read_shift(2)];if(n[0]!==0&&n[0]--,n[1]!==0&&n[1]--,n[0]>7||n[1]>7)throw new Error("Bad Gutters: "+n.join("|"));return n}function og(e,n,a){var c=Vn(e);(a.biff==2||n==9)&&++e.l;var u=TE(e);return c.val=u,c.t=u===!0||u===!1?"b":"e",c}function lS(e,n,a){a.biffguess&&a.biff==2&&(a.biff=5);var c=Vn(e),u=li(e);return c.val=u,c}var lg=PE;function cS(e,n,a){var c=e.l+n,u=e.read_shift(2),m=e.read_shift(2);if(a.sbcch=m,m==1025||m==14849)return[m,u];if(m<1||m>255)throw new Error("Unexpected SupBook type: "+m);for(var x=vo(e,m),o=[];c>e.l;)o.push(lu(e));return[m,u,x,o]}function cg(e,n,a){var c=e.read_shift(2),u,m={fBuiltIn:c&1,fWantAdvise:c>>>1&1,fWantPict:c>>>2&1,fOle:c>>>3&1,fOleLink:c>>>4&1,cf:c>>>5&1023,fIcon:c>>>15&1};return a.sbcch===14849&&(u=DE(e,n-2,a)),m.body=u||e.read_shift(n-2),typeof u=="string"&&(m.Name=u),m}var uS=["_xlnm.Consolidate_Area","_xlnm.Auto_Open","_xlnm.Auto_Close","_xlnm.Extract","_xlnm.Database","_xlnm.Criteria","_xlnm.Print_Area","_xlnm.Print_Titles","_xlnm.Recorder","_xlnm.Data_Form","_xlnm.Auto_Activate","_xlnm.Auto_Deactivate","_xlnm.Sheet_Title","_xlnm._FilterDatabase"];function ug(e,n,a){var c=e.l+n,u=e.read_shift(2),m=e.read_shift(1),x=e.read_shift(1),o=e.read_shift(a&&a.biff==2?1:2),E=0;(!a||a.biff>=5)&&(a.biff!=5&&(e.l+=2),E=e.read_shift(2),a.biff==5&&(e.l+=2),e.l+=4);var w=vo(e,x,a);u&32&&(w=uS[w.charCodeAt(0)]);var C=c-e.l;a&&a.biff==2&&--C;var P=c==e.l||o===0||!(C>0)?[]:H4(e,C,a,o);return{chKey:m,Name:w,itab:E,rgce:P}}function nx(e,n,a){if(a.biff<8)return hS(e,n,a);for(var c=[],u=e.l+n,m=e.read_shift(a.biff>8?4:2);m--!==0;)c.push(ME(e,a.biff>8?12:6,a));if(e.l!=u)throw new Error("Bad ExternSheet: "+e.l+" != "+u);return c}function hS(e,n,a){e[e.l+1]==3&&e[e.l]++;var c=ou(e,n,a);return c.charCodeAt(0)==3?c.slice(1):c}function fS(e,n,a){if(a.biff<8){e.l+=n;return}var c=e.read_shift(2),u=e.read_shift(2),m=vo(e,c,a),x=vo(e,u,a);return[m,x]}function dS(e,n,a){var c=ax(e);e.l++;var u=e.read_shift(1);return n-=8,[q4(e,n,a),u,c]}function hg(e,n,a){var c=LE(e);switch(a.biff){case 2:e.l++,n-=7;break;case 3:case 4:e.l+=2,n-=8;break;default:e.l+=6,n-=12}return[c,j4(e,n,a)]}function pS(e){var n=e.read_shift(4)!==0,a=e.read_shift(4)!==0,c=e.read_shift(4);return[n,a,c]}function mS(e,n,a){if(!(a.biff<8)){var c=e.read_shift(2),u=e.read_shift(2),m=e.read_shift(2),x=e.read_shift(2),o=Co(e,0,a);return a.biff<8&&e.read_shift(1),[{r:c,c:u},o,x,m]}}function gS(e,n,a){return mS(e,n,a)}function xS(e,n){for(var a=[],c=e.read_shift(2);c--;)a.push(Xh(e));return a}function _S(e,n,a){if(a&&a.biff<8)return vS(e,n,a);var c=ix(e),u=zE(e,n-22,c[1]);return{cmo:c,ft:u}}var yS={8:function(e,n){var a=e.l+n;e.l+=10;var c=e.read_shift(2);e.l+=4,e.l+=2,e.l+=2,e.l+=2,e.l+=4;var u=e.read_shift(1);return e.l+=u,e.l=a,{fmt:c}}};function vS(e,n,a){e.l+=4;var c=e.read_shift(2),u=e.read_shift(2),m=e.read_shift(2);e.l+=2,e.l+=2,e.l+=2,e.l+=2,e.l+=2,e.l+=2,e.l+=2,e.l+=2,e.l+=2,e.l+=6,n-=36;var x=[];return x.push((yS[c]||hi)(e,n,a)),{cmo:[u,c,m],ft:x}}function wS(e,n,a){var c=e.l,u="";try{e.l+=4;var m=(a.lastobj||{cmo:[0,0]}).cmo[1],x;[0,5,7,11,12,14].indexOf(m)==-1?e.l+=6:x=SE(e,6,a);var o=e.read_shift(2);e.read_shift(2),Ca(e,2);var E=e.read_shift(2);e.l+=E;for(var w=1;w<e.lens.length-1;++w){if(e.l-c!=e.lens[w])throw new Error("TxO: bad continue record");var C=e[e.l],P=vo(e,e.lens[w+1]-e.lens[w]-1);if(u+=P,u.length>=(C?o:2*o))break}if(u.length!==o&&u.length!==o*2)throw new Error("cchText: "+o+" != "+u.length);return e.l=c+n,{t:u}}catch{return e.l=c+n,{t:u}}}function bS(e,n){var a=Xh(e);e.l+=16;var c=IE(e,n-24);return[a,c]}function TS(e,n){e.read_shift(2);var a=Xh(e),c=e.read_shift((n-10)/2,"dbcs-cont");return c=c.replace(ki,""),[a,c]}function ES(e){var n=[0,0],a;return a=e.read_shift(2),n[0]=eg[a]||a,a=e.read_shift(2),n[1]=eg[a]||a,n}function SS(e){for(var n=e.read_shift(2),a=[];n-- >0;)a.push(tx(e));return a}function kS(e){for(var n=e.read_shift(2),a=[];n-- >0;)a.push(tx(e));return a}function CS(e){e.l+=2;var n={cxfs:0,crc:0};return n.cxfs=e.read_shift(2),n.crc=e.read_shift(4),n}function sx(e,n,a){if(!a.cellStyles)return hi(e,n);var c=a&&a.biff>=12?4:2,u=e.read_shift(c),m=e.read_shift(c),x=e.read_shift(c),o=e.read_shift(c),E=e.read_shift(2);c==2&&(e.l+=2);var w={s:u,e:m,w:x,ixfe:o,flags:E};return(a.biff>=5||!a.biff)&&(w.level=E>>8&7),w}function AS(e,n){var a={};return n<32||(e.l+=16,a.header=li(e),a.footer=li(e),e.l+=2),a}function IS(e,n,a){var c={area:!1};if(a.biff!=5)return e.l+=n,c;var u=e.read_shift(1);return e.l+=3,u&16&&(c.area=!0),c}var FS=Vn,PS=Q1,MS=lu;function DS(e){var n=e.read_shift(2),a=e.read_shift(2),c=e.read_shift(4),u={fmt:n,env:a,len:c,data:e.slice(e.l,e.l+c)};return e.l+=c,u}function LS(e,n,a){a.biffguess&&a.biff==5&&(a.biff=2);var c=Vn(e);++e.l;var u=Co(e,n-7,a);return c.t="str",c.val=u,c}function RS(e){var n=Vn(e);++e.l;var a=li(e);return n.t="n",n.val=a,n}function OS(e){var n=Vn(e);++e.l;var a=e.read_shift(2);return n.t="n",n.val=a,n}function BS(e){var n=e.read_shift(1);return n===0?(e.l++,""):e.read_shift(n,"sbcs-cont")}function zS(e,n){e.l+=6,e.l+=2,e.l+=1,e.l+=3,e.l+=1,e.l+=n-13}function NS(e,n,a){var c=e.l+n,u=Vn(e),m=e.read_shift(2),x=vo(e,m,a);return e.l=c,u.t="str",u.val=x,u}var US=[2,3,48,49,131,139,140,245],fg=function(){var e={1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127,8:865,9:437,10:850,11:437,13:437,14:850,15:437,16:850,17:437,18:850,19:932,20:850,21:437,22:850,23:865,24:437,25:437,26:850,27:437,28:863,29:850,31:852,34:852,35:852,36:860,37:850,38:866,55:850,64:852,77:936,78:949,79:950,80:874,87:1252,88:1252,89:1252,108:863,134:737,135:852,136:857,204:1257,255:16969},n=Y0({1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127});function a(o,E){var w=[],C=zs(1);switch(E.type){case"base64":C=bn(qi(o));break;case"binary":C=bn(o);break;case"buffer":case"array":C=o;break}Za(C,0);var P=C.read_shift(1),M=!!(P&136),O=!1,U=!1;switch(P){case 2:break;case 3:break;case 48:O=!0,M=!0;break;case 49:O=!0,M=!0;break;case 131:break;case 139:break;case 140:U=!0;break;case 245:break;default:throw new Error("DBF Unsupported Version: "+P.toString(16))}var z=0,j=521;P==2&&(z=C.read_shift(2)),C.l+=3,P!=2&&(z=C.read_shift(4)),z>1048576&&(z=1e6),P!=2&&(j=C.read_shift(2));var ee=C.read_shift(2),le=E.codepage||1252;P!=2&&(C.l+=16,C.read_shift(1),C[C.l]!==0&&(le=e[C[C.l]]),C.l+=1,C.l+=2),U&&(C.l+=36);for(var Z=[],fe={},me=Math.min(C.length,P==2?521:j-10-(O?264:0)),Te=U?32:11;C.l<me&&C[C.l]!=13;)switch(fe={},fe.name=Fs.utils.decode(le,C.slice(C.l,C.l+Te)).replace(/[\u0000\r\n].*$/g,""),C.l+=Te,fe.type=String.fromCharCode(C.read_shift(1)),P!=2&&!U&&(fe.offset=C.read_shift(4)),fe.len=C.read_shift(1),P==2&&(fe.offset=C.read_shift(2)),fe.dec=C.read_shift(1),fe.name.length&&Z.push(fe),P!=2&&(C.l+=U?13:14),fe.type){case"B":(!O||fe.len!=8)&&E.WTF&&console.log("Skipping "+fe.name+":"+fe.type);break;case"G":case"P":E.WTF&&console.log("Skipping "+fe.name+":"+fe.type);break;case"+":case"0":case"@":case"C":case"D":case"F":case"I":case"L":case"M":case"N":case"O":case"T":case"Y":break;default:throw new Error("Unknown Field Type: "+fe.type)}if(C[C.l]!==13&&(C.l=j-1),C.read_shift(1)!==13)throw new Error("DBF Terminator not found "+C.l+" "+C[C.l]);C.l=j;var re=0,Ce=0;for(w[0]=[],Ce=0;Ce!=Z.length;++Ce)w[0][Ce]=Z[Ce].name;for(;z-- >0;){if(C[C.l]===42){C.l+=ee;continue}for(++C.l,w[++re]=[],Ce=0,Ce=0;Ce!=Z.length;++Ce){var be=C.slice(C.l,C.l+Z[Ce].len);C.l+=Z[Ce].len,Za(be,0);var Fe=Fs.utils.decode(le,be);switch(Z[Ce].type){case"C":Fe.trim().length&&(w[re][Ce]=Fe.replace(/\s+$/,""));break;case"D":Fe.length===8?w[re][Ce]=new Date(+Fe.slice(0,4),+Fe.slice(4,6)-1,+Fe.slice(6,8)):w[re][Ce]=Fe;break;case"F":w[re][Ce]=parseFloat(Fe.trim());break;case"+":case"I":w[re][Ce]=U?be.read_shift(-4,"i")^2147483648:be.read_shift(4,"i");break;case"L":switch(Fe.trim().toUpperCase()){case"Y":case"T":w[re][Ce]=!0;break;case"N":case"F":w[re][Ce]=!1;break;case"":case"?":break;default:throw new Error("DBF Unrecognized L:|"+Fe+"|")}break;case"M":if(!M)throw new Error("DBF Unexpected MEMO for type "+P.toString(16));w[re][Ce]="##MEMO##"+(U?parseInt(Fe.trim(),10):be.read_shift(4));break;case"N":Fe=Fe.replace(/\u0000/g,"").trim(),Fe&&Fe!="."&&(w[re][Ce]=+Fe||0);break;case"@":w[re][Ce]=new Date(be.read_shift(-8,"f")-621356832e5);break;case"T":w[re][Ce]=new Date((be.read_shift(4)-2440588)*864e5+be.read_shift(4));break;case"Y":w[re][Ce]=be.read_shift(4,"i")/1e4+be.read_shift(4,"i")/1e4*Math.pow(2,32);break;case"O":w[re][Ce]=-be.read_shift(-8,"f");break;case"B":if(O&&Z[Ce].len==8){w[re][Ce]=be.read_shift(8,"f");break}case"G":case"P":be.l+=Z[Ce].len;break;case"0":if(Z[Ce].name==="_NullFlags")break;default:throw new Error("DBF Unsupported data type "+Z[Ce].type)}}}if(P!=2&&C.l<C.length&&C[C.l++]!=26)throw new Error("DBF EOF Marker missing "+(C.l-1)+" of "+C.length+" "+C[C.l-1].toString(16));return E&&E.sheetRows&&(w=w.slice(0,E.sheetRows)),E.DBF=Z,w}function c(o,E){var w=E||{};w.dateNF||(w.dateNF="yyyymmdd");var C=kl(a(o,w),w);return C["!cols"]=w.DBF.map(function(P){return{wch:P.len,DBF:P}}),delete w.DBF,C}function u(o,E){try{return Us(c(o,E),E)}catch(w){if(E&&E.WTF)throw w}return{SheetNames:[],Sheets:{}}}var m={B:8,C:250,L:1,D:8,"?":0,"":0};function x(o,E){var w=E||{};if(+w.codepage>=0&&En(+w.codepage),w.type=="string")throw new Error("Cannot write DBF to JS string");var C=C0(),P=B0(o,{header:1,raw:!0,cellDates:!0}),M=P[0],O=P.slice(1),U=o["!cols"]||[],z=0,j=0,ee=0,le=1;for(z=0;z<M.length;++z){if(((U[z]||{}).DBF||{}).name){M[z]=U[z].DBF.name,++ee;continue}if(M[z]!=null){if(++ee,typeof M[z]=="number"&&(M[z]=M[z].toString(10)),typeof M[z]!="string")throw new Error("DBF Invalid column name "+M[z]+" |"+typeof M[z]+"|");if(M.indexOf(M[z])!==z){for(j=0;j<1024;++j)if(M.indexOf(M[z]+"_"+j)==-1){M[z]+="_"+j;break}}}}var Z=da(o["!ref"]),fe=[],me=[],Te=[];for(z=0;z<=Z.e.c-Z.s.c;++z){var re="",Ce="",be=0,Fe=[];for(j=0;j<O.length;++j)O[j][z]!=null&&Fe.push(O[j][z]);if(Fe.length==0||M[z]==null){fe[z]="?";continue}for(j=0;j<Fe.length;++j){switch(typeof Fe[j]){case"number":Ce="B";break;case"string":Ce="C";break;case"boolean":Ce="L";break;case"object":Ce=Fe[j]instanceof Date?"D":"C";break;default:Ce="C"}be=Math.max(be,String(Fe[j]).length),re=re&&re!=Ce?"C":Ce}be>250&&(be=250),Ce=((U[z]||{}).DBF||{}).type,Ce=="C"&&U[z].DBF.len>be&&(be=U[z].DBF.len),re=="B"&&Ce=="N"&&(re="N",Te[z]=U[z].DBF.dec,be=U[z].DBF.len),me[z]=re=="C"||Ce=="N"?be:m[re]||0,le+=me[z],fe[z]=re}var Oe=C.next(32);for(Oe.write_shift(4,318902576),Oe.write_shift(4,O.length),Oe.write_shift(2,296+32*ee),Oe.write_shift(2,le),z=0;z<4;++z)Oe.write_shift(4,0);for(Oe.write_shift(4,0|(+n[i1]||3)<<8),z=0,j=0;z<M.length;++z)if(M[z]!=null){var Me=C.next(32),rt=(M[z].slice(-10)+"\0\0\0\0\0\0\0\0\0\0\0").slice(0,11);Me.write_shift(1,rt,"sbcs"),Me.write_shift(1,fe[z]=="?"?"C":fe[z],"sbcs"),Me.write_shift(4,j),Me.write_shift(1,me[z]||m[fe[z]]||0),Me.write_shift(1,Te[z]||0),Me.write_shift(1,2),Me.write_shift(4,0),Me.write_shift(1,0),Me.write_shift(4,0),Me.write_shift(4,0),j+=me[z]||m[fe[z]]||0}var ft=C.next(264);for(ft.write_shift(4,13),z=0;z<65;++z)ft.write_shift(4,0);for(z=0;z<O.length;++z){var lt=C.next(le);for(lt.write_shift(1,0),j=0;j<M.length;++j)if(M[j]!=null)switch(fe[j]){case"L":lt.write_shift(1,O[z][j]==null?63:O[z][j]?84:70);break;case"B":lt.write_shift(8,O[z][j]||0,"f");break;case"N":var _t="0";for(typeof O[z][j]=="number"&&(_t=O[z][j].toFixed(Te[j]||0)),ee=0;ee<me[j]-_t.length;++ee)lt.write_shift(1,32);lt.write_shift(1,_t,"sbcs");break;case"D":O[z][j]?(lt.write_shift(4,("0000"+O[z][j].getFullYear()).slice(-4),"sbcs"),lt.write_shift(2,("00"+(O[z][j].getMonth()+1)).slice(-2),"sbcs"),lt.write_shift(2,("00"+O[z][j].getDate()).slice(-2),"sbcs")):lt.write_shift(8,"00000000","sbcs");break;case"C":var nt=String(O[z][j]!=null?O[z][j]:"").slice(0,me[j]);for(lt.write_shift(1,nt,"sbcs"),ee=0;ee<me[j]-nt.length;++ee)lt.write_shift(1,32);break}}return C.next(1).write_shift(1,26),C.end()}return{to_workbook:u,to_sheet:c,from_sheet:x}}(),VS=function(){var e={AA:"À",BA:"Á",CA:"Â",DA:195,HA:"Ä",JA:197,AE:"È",BE:"É",CE:"Ê",HE:"Ë",AI:"Ì",BI:"Í",CI:"Î",HI:"Ï",AO:"Ò",BO:"Ó",CO:"Ô",DO:213,HO:"Ö",AU:"Ù",BU:"Ú",CU:"Û",HU:"Ü",Aa:"à",Ba:"á",Ca:"â",Da:227,Ha:"ä",Ja:229,Ae:"è",Be:"é",Ce:"ê",He:"ë",Ai:"ì",Bi:"í",Ci:"î",Hi:"ï",Ao:"ò",Bo:"ó",Co:"ô",Do:245,Ho:"ö",Au:"ù",Bu:"ú",Cu:"û",Hu:"ü",KC:"Ç",Kc:"ç",q:"æ",z:"œ",a:"Æ",j:"Œ",DN:209,Dn:241,Hy:255,S:169,c:170,R:174,"B ":180,0:176,1:177,2:178,3:179,5:181,6:182,7:183,Q:185,k:186,b:208,i:216,l:222,s:240,y:248,"!":161,'"':162,"#":163,"(":164,"%":165,"'":167,"H ":168,"+":171,";":187,"<":188,"=":189,">":190,"?":191,"{":223},n=new RegExp("\x1BN("+Nn(e).join("|").replace(/\|\|\|/,"|\\||").replace(/([?()+])/g,"\\$1")+"|\\|)","gm"),a=function(M,O){var U=e[O];return typeof U=="number"?Am(U):U},c=function(M,O,U){var z=O.charCodeAt(0)-32<<4|U.charCodeAt(0)-48;return z==59?M:Am(z)};e["|"]=254;function u(M,O){switch(O.type){case"base64":return m(qi(M),O);case"binary":return m(M,O);case"buffer":return m(wr&&Buffer.isBuffer(M)?M.toString("binary"):To(M),O);case"array":return m(yo(M),O)}throw new Error("Unrecognized type "+O.type)}function m(M,O){var U=M.split(/[\n\r]+/),z=-1,j=-1,ee=0,le=0,Z=[],fe=[],me=null,Te={},re=[],Ce=[],be=[],Fe=0,Oe;for(+O.codepage>=0&&En(+O.codepage);ee!==U.length;++ee){Fe=0;var Me=U[ee].trim().replace(/\x1B([\x20-\x2F])([\x30-\x3F])/g,c).replace(n,a),rt=Me.replace(/;;/g,"\0").split(";").map(function(Ie){return Ie.replace(/\u0000/g,";")}),ft=rt[0],lt;if(Me.length>0)switch(ft){case"ID":break;case"E":break;case"B":break;case"O":break;case"W":break;case"P":rt[1].charAt(0)=="P"&&fe.push(Me.slice(3).replace(/;;/g,";"));break;case"C":var _t=!1,nt=!1,Kt=!1,He=!1,Nt=-1,Mt=-1;for(le=1;le<rt.length;++le)switch(rt[le].charAt(0)){case"A":break;case"X":j=parseInt(rt[le].slice(1))-1,nt=!0;break;case"Y":for(z=parseInt(rt[le].slice(1))-1,nt||(j=0),Oe=Z.length;Oe<=z;++Oe)Z[Oe]=[];break;case"K":lt=rt[le].slice(1),lt.charAt(0)==='"'?lt=lt.slice(1,lt.length-1):lt==="TRUE"?lt=!0:lt==="FALSE"?lt=!1:isNaN(kn(lt))?isNaN(yl(lt).getDate())||(lt=Ua(lt)):(lt=kn(lt),me!==null&&El(me)&&(lt=Zh(lt))),_t=!0;break;case"E":He=!0;var pe=gl(rt[le].slice(1),{r:z,c:j});Z[z][j]=[Z[z][j],pe];break;case"S":Kt=!0,Z[z][j]=[Z[z][j],"S5S"];break;case"G":break;case"R":Nt=parseInt(rt[le].slice(1))-1;break;case"C":Mt=parseInt(rt[le].slice(1))-1;break;default:if(O&&O.WTF)throw new Error("SYLK bad record "+Me)}if(_t&&(Z[z][j]&&Z[z][j].length==2?Z[z][j][0]=lt:Z[z][j]=lt,me=null),Kt){if(He)throw new Error("SYLK shared formula cannot have own formula");var Ee=Nt>-1&&Z[Nt][Mt];if(!Ee||!Ee[1])throw new Error("SYLK shared formula cannot find base");Z[z][j][1]=gx(Ee[1],{r:z-Nt,c:j-Mt})}break;case"F":var Se=0;for(le=1;le<rt.length;++le)switch(rt[le].charAt(0)){case"X":j=parseInt(rt[le].slice(1))-1,++Se;break;case"Y":for(z=parseInt(rt[le].slice(1))-1,Oe=Z.length;Oe<=z;++Oe)Z[Oe]=[];break;case"M":Fe=parseInt(rt[le].slice(1))/20;break;case"F":break;case"G":break;case"P":me=fe[parseInt(rt[le].slice(1))];break;case"S":break;case"D":break;case"N":break;case"W":for(be=rt[le].slice(1).split(" "),Oe=parseInt(be[0],10);Oe<=parseInt(be[1],10);++Oe)Fe=parseInt(be[2],10),Ce[Oe-1]=Fe===0?{hidden:!0}:{wch:Fe},vl(Ce[Oe-1]);break;case"C":j=parseInt(rt[le].slice(1))-1,Ce[j]||(Ce[j]={});break;case"R":z=parseInt(rt[le].slice(1))-1,re[z]||(re[z]={}),Fe>0?(re[z].hpt=Fe,re[z].hpx=ru(Fe)):Fe===0&&(re[z].hidden=!0);break;default:if(O&&O.WTF)throw new Error("SYLK bad record "+Me)}Se<1&&(me=null);break;default:if(O&&O.WTF)throw new Error("SYLK bad record "+Me)}}return re.length>0&&(Te["!rows"]=re),Ce.length>0&&(Te["!cols"]=Ce),O&&O.sheetRows&&(Z=Z.slice(0,O.sheetRows)),[Z,Te]}function x(M,O){var U=u(M,O),z=U[0],j=U[1],ee=kl(z,O);return Nn(j).forEach(function(le){ee[le]=j[le]}),ee}function o(M,O){return Us(x(M,O),O)}function E(M,O,U,z){var j="C;Y"+(U+1)+";X"+(z+1)+";K";switch(M.t){case"n":j+=M.v||0,M.f&&!M.F&&(j+=";E"+CC(M.f,{r:U,c:z}));break;case"b":j+=M.v?"TRUE":"FALSE";break;case"e":j+=M.w||M.v;break;case"d":j+='"'+(M.w||M.v)+'"';break;case"s":j+='"'+M.v.replace(/"/g,"").replace(/;/g,";;")+'"';break}return j}function w(M,O){O.forEach(function(U,z){var j="F;W"+(z+1)+" "+(z+1)+" ";U.hidden?j+="0":(typeof U.width=="number"&&!U.wpx&&(U.wpx=$h(U.width)),typeof U.wpx=="number"&&!U.wch&&(U.wch=jh(U.wpx)),typeof U.wch=="number"&&(j+=Math.round(U.wch))),j.charAt(j.length-1)!=" "&&M.push(j)})}function C(M,O){O.forEach(function(U,z){var j="F;";U.hidden?j+="M0;":U.hpt?j+="M"+20*U.hpt+";":U.hpx&&(j+="M"+20*dx(U.hpx)+";"),j.length>2&&M.push(j+"R"+(z+1))})}function P(M,O){var U=["ID;PWXL;N;E"],z=[],j=da(M["!ref"]),ee,le=Array.isArray(M),Z=`\r
`;U.push("P;PGeneral"),U.push("F;P0;DG0G8;M255"),M["!cols"]&&w(U,M["!cols"]),M["!rows"]&&C(U,M["!rows"]),U.push("B;Y"+(j.e.r-j.s.r+1)+";X"+(j.e.c-j.s.c+1)+";D"+[j.s.c,j.s.r,j.e.c,j.e.r].join(" "));for(var fe=j.s.r;fe<=j.e.r;++fe)for(var me=j.s.c;me<=j.e.c;++me){var Te=or({r:fe,c:me});ee=le?(M[fe]||[])[me]:M[Te],!(!ee||ee.v==null&&(!ee.f||ee.F))&&z.push(E(ee,M,fe,me))}return U.join(Z)+Z+z.join(Z)+Z+"E"+Z}return{to_workbook:o,to_sheet:x,from_sheet:P}}(),$S=function(){function e(m,x){switch(x.type){case"base64":return n(qi(m),x);case"binary":return n(m,x);case"buffer":return n(wr&&Buffer.isBuffer(m)?m.toString("binary"):To(m),x);case"array":return n(yo(m),x)}throw new Error("Unrecognized type "+x.type)}function n(m,x){for(var o=m.split(`
`),E=-1,w=-1,C=0,P=[];C!==o.length;++C){if(o[C].trim()==="BOT"){P[++E]=[],w=0;continue}if(!(E<0)){var M=o[C].trim().split(","),O=M[0],U=M[1];++C;for(var z=o[C]||"";(z.match(/["]/g)||[]).length&1&&C<o.length-1;)z+=`
`+o[++C];switch(z=z.trim(),+O){case-1:if(z==="BOT"){P[++E]=[],w=0;continue}else if(z!=="EOD")throw new Error("Unrecognized DIF special command "+z);break;case 0:z==="TRUE"?P[E][w]=!0:z==="FALSE"?P[E][w]=!1:isNaN(kn(U))?isNaN(yl(U).getDate())?P[E][w]=U:P[E][w]=Ua(U):P[E][w]=kn(U),++w;break;case 1:z=z.slice(1,z.length-1),z=z.replace(/""/g,'"'),z&&z.match(/^=".*"$/)&&(z=z.slice(2,-1)),P[E][w++]=z!==""?z:null;break}if(z==="EOD")break}}return x&&x.sheetRows&&(P=P.slice(0,x.sheetRows)),P}function a(m,x){return kl(e(m,x),x)}function c(m,x){return Us(a(m,x),x)}var u=function(){var m=function(E,w,C,P,M){E.push(w),E.push(C+","+P),E.push('"'+M.replace(/"/g,'""')+'"')},x=function(E,w,C,P){E.push(w+","+C),E.push(w==1?'"'+P.replace(/"/g,'""')+'"':P)};return function(E){var w=[],C=da(E["!ref"]),P,M=Array.isArray(E);m(w,"TABLE",0,1,"sheetjs"),m(w,"VECTORS",0,C.e.r-C.s.r+1,""),m(w,"TUPLES",0,C.e.c-C.s.c+1,""),m(w,"DATA",0,0,"");for(var O=C.s.r;O<=C.e.r;++O){x(w,-1,0,"BOT");for(var U=C.s.c;U<=C.e.c;++U){var z=or({r:O,c:U});if(P=M?(E[O]||[])[U]:E[z],!P){x(w,1,0,"");continue}switch(P.t){case"n":var j=P.w;!j&&P.v!=null&&(j=P.v),j==null?P.f&&!P.F?x(w,1,0,"="+P.f):x(w,1,0,""):x(w,0,j,"V");break;case"b":x(w,0,P.v?1:0,P.v?"TRUE":"FALSE");break;case"s":x(w,1,0,isNaN(P.v)?P.v:'="'+P.v+'"');break;case"d":P.w||(P.w=on(P.z||fr[14],Ci(Ua(P.v)))),x(w,0,P.w,"V");break;default:x(w,1,0,"")}}}x(w,-1,0,"EOD");var ee=`\r
`,le=w.join(ee);return le}}();return{to_workbook:c,to_sheet:a,from_sheet:u}}(),jS=function(){function e(P){return P.replace(/\\b/g,"\\").replace(/\\c/g,":").replace(/\\n/g,`
`)}function n(P){return P.replace(/\\/g,"\\b").replace(/:/g,"\\c").replace(/\n/g,"\\n")}function a(P,M){for(var O=P.split(`
`),U=-1,z=-1,j=0,ee=[];j!==O.length;++j){var le=O[j].trim().split(":");if(le[0]==="cell"){var Z=Si(le[1]);if(ee.length<=Z.r)for(U=ee.length;U<=Z.r;++U)ee[U]||(ee[U]=[]);switch(U=Z.r,z=Z.c,le[2]){case"t":ee[U][z]=e(le[3]);break;case"v":ee[U][z]=+le[3];break;case"vtf":var fe=le[le.length-1];case"vtc":switch(le[3]){case"nl":ee[U][z]=!!+le[4];break;default:ee[U][z]=+le[4];break}le[2]=="vtf"&&(ee[U][z]=[ee[U][z],fe])}}}return M&&M.sheetRows&&(ee=ee.slice(0,M.sheetRows)),ee}function c(P,M){return kl(a(P,M),M)}function u(P,M){return Us(c(P,M),M)}var m=["socialcalc:version:1.5","MIME-Version: 1.0","Content-Type: multipart/mixed; boundary=SocialCalcSpreadsheetControlSave"].join(`
`),x=["--SocialCalcSpreadsheetControlSave","Content-type: text/plain; charset=UTF-8"].join(`
`)+`
`,o=["# SocialCalc Spreadsheet Control Save","part:sheet"].join(`
`),E="--SocialCalcSpreadsheetControlSave--";function w(P){if(!P||!P["!ref"])return"";for(var M=[],O=[],U,z="",j=Sl(P["!ref"]),ee=Array.isArray(P),le=j.s.r;le<=j.e.r;++le)for(var Z=j.s.c;Z<=j.e.c;++Z)if(z=or({r:le,c:Z}),U=ee?(P[le]||[])[Z]:P[z],!(!U||U.v==null||U.t==="z")){switch(O=["cell",z,"t"],U.t){case"s":case"str":O.push(n(U.v));break;case"n":U.f?(O[2]="vtf",O[3]="n",O[4]=U.v,O[5]=n(U.f)):(O[2]="v",O[3]=U.v);break;case"b":O[2]="vt"+(U.f?"f":"c"),O[3]="nl",O[4]=U.v?"1":"0",O[5]=n(U.f||(U.v?"TRUE":"FALSE"));break;case"d":var fe=Ci(Ua(U.v));O[2]="vtc",O[3]="nd",O[4]=""+fe,O[5]=U.w||on(U.z||fr[14],fe);break;case"e":continue}M.push(O.join(":"))}return M.push("sheet:c:"+(j.e.c-j.s.c+1)+":r:"+(j.e.r-j.s.r+1)+":tvf:1"),M.push("valueformat:1:text-wiki"),M.join(`
`)}function C(P){return[m,x,o,x,w(P),E].join(`
`)}return{to_workbook:u,to_sheet:c,from_sheet:C}}(),eu=function(){function e(C,P,M,O,U){U.raw?P[M][O]=C:C===""||(C==="TRUE"?P[M][O]=!0:C==="FALSE"?P[M][O]=!1:isNaN(kn(C))?isNaN(yl(C).getDate())?P[M][O]=C:P[M][O]=Ua(C):P[M][O]=kn(C))}function n(C,P){var M=P||{},O=[];if(!C||C.length===0)return O;for(var U=C.split(/[\r\n]/),z=U.length-1;z>=0&&U[z].length===0;)--z;for(var j=10,ee=0,le=0;le<=z;++le)ee=U[le].indexOf(" "),ee==-1?ee=U[le].length:ee++,j=Math.max(j,ee);for(le=0;le<=z;++le){O[le]=[];var Z=0;for(e(U[le].slice(0,j).trim(),O,le,Z,M),Z=1;Z<=(U[le].length-j)/10+1;++Z)e(U[le].slice(j+(Z-1)*10,j+Z*10).trim(),O,le,Z,M)}return M.sheetRows&&(O=O.slice(0,M.sheetRows)),O}var a={44:",",9:"	",59:";",124:"|"},c={44:3,9:2,59:1,124:0};function u(C){for(var P={},M=!1,O=0,U=0;O<C.length;++O)(U=C.charCodeAt(O))==34?M=!M:!M&&U in a&&(P[U]=(P[U]||0)+1);U=[];for(O in P)Object.prototype.hasOwnProperty.call(P,O)&&U.push([P[O],O]);if(!U.length){P=c;for(O in P)Object.prototype.hasOwnProperty.call(P,O)&&U.push([P[O],O])}return U.sort(function(z,j){return z[0]-j[0]||c[z[1]]-c[j[1]]}),a[U.pop()[1]]||44}function m(C,P){var M=P||{},O="",U=M.dense?[]:{},z={s:{c:0,r:0},e:{c:0,r:0}};C.slice(0,4)=="sep="?C.charCodeAt(5)==13&&C.charCodeAt(6)==10?(O=C.charAt(4),C=C.slice(7)):C.charCodeAt(5)==13||C.charCodeAt(5)==10?(O=C.charAt(4),C=C.slice(6)):O=u(C.slice(0,1024)):M&&M.FS?O=M.FS:O=u(C.slice(0,1024));var j=0,ee=0,le=0,Z=0,fe=0,me=O.charCodeAt(0),Te=!1,re=0,Ce=C.charCodeAt(0);C=C.replace(/\r\n/mg,`
`);var be=M.dateNF!=null?tT(M.dateNF):null;function Fe(){var Oe=C.slice(Z,fe),Me={};if(Oe.charAt(0)=='"'&&Oe.charAt(Oe.length-1)=='"'&&(Oe=Oe.slice(1,-1).replace(/""/g,'"')),Oe.length===0)Me.t="z";else if(M.raw)Me.t="s",Me.v=Oe;else if(Oe.trim().length===0)Me.t="s",Me.v=Oe;else if(Oe.charCodeAt(0)==61)Oe.charCodeAt(1)==34&&Oe.charCodeAt(Oe.length-1)==34?(Me.t="s",Me.v=Oe.slice(2,-1).replace(/""/g,'"')):IC(Oe)?(Me.t="n",Me.f=Oe.slice(1)):(Me.t="s",Me.v=Oe);else if(Oe=="TRUE")Me.t="b",Me.v=!0;else if(Oe=="FALSE")Me.t="b",Me.v=!1;else if(!isNaN(le=kn(Oe)))Me.t="n",M.cellText!==!1&&(Me.w=Oe),Me.v=le;else if(!isNaN(yl(Oe).getDate())||be&&Oe.match(be)){Me.z=M.dateNF||fr[14];var rt=0;be&&Oe.match(be)&&(Oe=rT(Oe,M.dateNF,Oe.match(be)||[]),rt=1),M.cellDates?(Me.t="d",Me.v=Ua(Oe,rt)):(Me.t="n",Me.v=Ci(Ua(Oe,rt))),M.cellText!==!1&&(Me.w=on(Me.z,Me.v instanceof Date?Ci(Me.v):Me.v)),M.cellNF||delete Me.z}else Me.t="s",Me.v=Oe;if(Me.t=="z"||(M.dense?(U[j]||(U[j]=[]),U[j][ee]=Me):U[or({c:ee,r:j})]=Me),Z=fe+1,Ce=C.charCodeAt(Z),z.e.c<ee&&(z.e.c=ee),z.e.r<j&&(z.e.r=j),re==me)++ee;else if(ee=0,++j,M.sheetRows&&M.sheetRows<=j)return!0}e:for(;fe<C.length;++fe)switch(re=C.charCodeAt(fe)){case 34:Ce===34&&(Te=!Te);break;case me:case 10:case 13:if(!Te&&Fe())break e;break}return fe-Z>0&&Fe(),U["!ref"]=Tr(z),U}function x(C,P){return!(P&&P.PRN)||P.FS||C.slice(0,4)=="sep="||C.indexOf("	")>=0||C.indexOf(",")>=0||C.indexOf(";")>=0?m(C,P):kl(n(C,P),P)}function o(C,P){var M="",O=P.type=="string"?[0,0,0,0]:gd(C,P);switch(P.type){case"base64":M=qi(C);break;case"binary":M=C;break;case"buffer":P.codepage==65001?M=C.toString("utf8"):P.codepage&&typeof Fs<"u"?M=Fs.utils.decode(P.codepage,C):M=wr&&Buffer.isBuffer(C)?C.toString("binary"):To(C);break;case"array":M=yo(C);break;case"string":M=C;break;default:throw new Error("Unrecognized type "+P.type)}return O[0]==239&&O[1]==187&&O[2]==191?M=Zr(M.slice(3)):P.type!="string"&&P.type!="buffer"&&P.codepage==65001?M=Zr(M):P.type=="binary"&&typeof Fs<"u"&&P.codepage&&(M=Fs.utils.decode(P.codepage,Fs.utils.encode(28591,M))),M.slice(0,19)=="socialcalc:version:"?jS.to_sheet(P.type=="string"?M:Zr(M),P):x(M,P)}function E(C,P){return Us(o(C,P),P)}function w(C){for(var P=[],M=da(C["!ref"]),O,U=Array.isArray(C),z=M.s.r;z<=M.e.r;++z){for(var j=[],ee=M.s.c;ee<=M.e.c;++ee){var le=or({r:z,c:ee});if(O=U?(C[z]||[])[ee]:C[le],!O||O.v==null){j.push("          ");continue}for(var Z=(O.w||(ls(O),O.w)||"").slice(0,10);Z.length<10;)Z+=" ";j.push(Z+(ee===0?" ":""))}P.push(j.join(""))}return P.join(`
`)}return{to_workbook:E,to_sheet:o,from_sheet:w}}();function GS(e,n){var a=n||{},c=!!a.WTF;a.WTF=!0;try{var u=VS.to_workbook(e,a);return a.WTF=c,u}catch(m){if(a.WTF=c,!m.message.match(/SYLK bad record ID/)&&c)throw m;return eu.to_workbook(e,n)}}var jc=function(){function e(pe,Ee,Se){if(pe){Za(pe,pe.l||0);for(var Ie=Se.Enum||Nt;pe.l<pe.length;){var Ke=pe.read_shift(2),dt=Ie[Ke]||Ie[65535],vt=pe.read_shift(2),ut=pe.l+vt,Qe=dt.f&&dt.f(pe,vt,Se);if(pe.l=ut,Ee(Qe,dt,Ke))return}}}function n(pe,Ee){switch(Ee.type){case"base64":return a(bn(qi(pe)),Ee);case"binary":return a(bn(pe),Ee);case"buffer":case"array":return a(pe,Ee)}throw"Unsupported type "+Ee.type}function a(pe,Ee){if(!pe)return pe;var Se=Ee||{},Ie=Se.dense?[]:{},Ke="Sheet1",dt="",vt=0,ut={},Qe=[],qt=[],_e={s:{r:0,c:0},e:{r:0,c:0}},Yt=Se.sheetRows||0;if(pe[2]==0&&(pe[3]==8||pe[3]==9)&&pe.length>=16&&pe[14]==5&&pe[15]===108)throw new Error("Unsupported Works 3 for Mac file");if(pe[2]==2)Se.Enum=Nt,e(pe,function(wt,gr,Mr){switch(Mr){case 0:Se.vers=wt,wt>=4096&&(Se.qpro=!0);break;case 6:_e=wt;break;case 204:wt&&(dt=wt);break;case 222:dt=wt;break;case 15:case 51:Se.qpro||(wt[1].v=wt[1].v.slice(1));case 13:case 14:case 16:Mr==14&&(wt[2]&112)==112&&(wt[2]&15)>1&&(wt[2]&15)<15&&(wt[1].z=Se.dateNF||fr[14],Se.cellDates&&(wt[1].t="d",wt[1].v=Zh(wt[1].v))),Se.qpro&&wt[3]>vt&&(Ie["!ref"]=Tr(_e),ut[Ke]=Ie,Qe.push(Ke),Ie=Se.dense?[]:{},_e={s:{r:0,c:0},e:{r:0,c:0}},vt=wt[3],Ke=dt||"Sheet"+(vt+1),dt="");var Xe=Se.dense?(Ie[wt[0].r]||[])[wt[0].c]:Ie[or(wt[0])];if(Xe){Xe.t=wt[1].t,Xe.v=wt[1].v,wt[1].z!=null&&(Xe.z=wt[1].z),wt[1].f!=null&&(Xe.f=wt[1].f);break}Se.dense?(Ie[wt[0].r]||(Ie[wt[0].r]=[]),Ie[wt[0].r][wt[0].c]=wt[1]):Ie[or(wt[0])]=wt[1];break}},Se);else if(pe[2]==26||pe[2]==14)Se.Enum=Mt,pe[2]==14&&(Se.qpro=!0,pe.l=0),e(pe,function(wt,gr,Mr){switch(Mr){case 204:Ke=wt;break;case 22:wt[1].v=wt[1].v.slice(1);case 23:case 24:case 25:case 37:case 39:case 40:if(wt[3]>vt&&(Ie["!ref"]=Tr(_e),ut[Ke]=Ie,Qe.push(Ke),Ie=Se.dense?[]:{},_e={s:{r:0,c:0},e:{r:0,c:0}},vt=wt[3],Ke="Sheet"+(vt+1)),Yt>0&&wt[0].r>=Yt)break;Se.dense?(Ie[wt[0].r]||(Ie[wt[0].r]=[]),Ie[wt[0].r][wt[0].c]=wt[1]):Ie[or(wt[0])]=wt[1],_e.e.c<wt[0].c&&(_e.e.c=wt[0].c),_e.e.r<wt[0].r&&(_e.e.r=wt[0].r);break;case 27:wt[14e3]&&(qt[wt[14e3][0]]=wt[14e3][1]);break;case 1537:qt[wt[0]]=wt[1],wt[0]==vt&&(Ke=wt[1]);break}},Se);else throw new Error("Unrecognized LOTUS BOF "+pe[2]);if(Ie["!ref"]=Tr(_e),ut[dt||Ke]=Ie,Qe.push(dt||Ke),!qt.length)return{SheetNames:Qe,Sheets:ut};for(var Wt={},nr=[],Zt=0;Zt<qt.length;++Zt)ut[Qe[Zt]]?(nr.push(qt[Zt]||Qe[Zt]),Wt[qt[Zt]]=ut[qt[Zt]]||ut[Qe[Zt]]):(nr.push(qt[Zt]),Wt[qt[Zt]]={"!ref":"A1"});return{SheetNames:nr,Sheets:Wt}}function c(pe,Ee){var Se=Ee||{};if(+Se.codepage>=0&&En(+Se.codepage),Se.type=="string")throw new Error("Cannot write WK1 to JS string");var Ie=C0(),Ke=da(pe["!ref"]),dt=Array.isArray(pe),vt=[];wn(Ie,0,m(1030)),wn(Ie,6,E(Ke));for(var ut=Math.min(Ke.e.r,8191),Qe=Ke.s.r;Qe<=ut;++Qe)for(var qt=Ka(Qe),_e=Ke.s.c;_e<=Ke.e.c;++_e){Qe===Ke.s.r&&(vt[_e]=Da(_e));var Yt=vt[_e]+qt,Wt=dt?(pe[Qe]||[])[_e]:pe[Yt];if(!(!Wt||Wt.t=="z"))if(Wt.t=="n")(Wt.v|0)==Wt.v&&Wt.v>=-32768&&Wt.v<=32767?wn(Ie,13,O(Qe,_e,Wt.v)):wn(Ie,14,z(Qe,_e,Wt.v));else{var nr=ls(Wt);wn(Ie,15,P(Qe,_e,nr.slice(0,239)))}}return wn(Ie,1),Ie.end()}function u(pe,Ee){var Se=Ee||{};if(+Se.codepage>=0&&En(+Se.codepage),Se.type=="string")throw new Error("Cannot write WK3 to JS string");var Ie=C0();wn(Ie,0,x(pe));for(var Ke=0,dt=0;Ke<pe.SheetNames.length;++Ke)(pe.Sheets[pe.SheetNames[Ke]]||{})["!ref"]&&wn(Ie,27,He(pe.SheetNames[Ke],dt++));var vt=0;for(Ke=0;Ke<pe.SheetNames.length;++Ke){var ut=pe.Sheets[pe.SheetNames[Ke]];if(!(!ut||!ut["!ref"])){for(var Qe=da(ut["!ref"]),qt=Array.isArray(ut),_e=[],Yt=Math.min(Qe.e.r,8191),Wt=Qe.s.r;Wt<=Yt;++Wt)for(var nr=Ka(Wt),Zt=Qe.s.c;Zt<=Qe.e.c;++Zt){Wt===Qe.s.r&&(_e[Zt]=Da(Zt));var wt=_e[Zt]+nr,gr=qt?(ut[Wt]||[])[Zt]:ut[wt];if(!(!gr||gr.t=="z"))if(gr.t=="n")wn(Ie,23,Fe(Wt,Zt,vt,gr.v));else{var Mr=ls(gr);wn(Ie,22,re(Wt,Zt,vt,Mr.slice(0,239)))}}++vt}}return wn(Ie,1),Ie.end()}function m(pe){var Ee=Ma(2);return Ee.write_shift(2,pe),Ee}function x(pe){var Ee=Ma(26);Ee.write_shift(2,4096),Ee.write_shift(2,4),Ee.write_shift(4,0);for(var Se=0,Ie=0,Ke=0,dt=0;dt<pe.SheetNames.length;++dt){var vt=pe.SheetNames[dt],ut=pe.Sheets[vt];if(!(!ut||!ut["!ref"])){++Ke;var Qe=Sl(ut["!ref"]);Se<Qe.e.r&&(Se=Qe.e.r),Ie<Qe.e.c&&(Ie=Qe.e.c)}}return Se>8191&&(Se=8191),Ee.write_shift(2,Se),Ee.write_shift(1,Ke),Ee.write_shift(1,Ie),Ee.write_shift(2,0),Ee.write_shift(2,0),Ee.write_shift(1,1),Ee.write_shift(1,2),Ee.write_shift(4,0),Ee.write_shift(4,0),Ee}function o(pe,Ee,Se){var Ie={s:{c:0,r:0},e:{c:0,r:0}};return Ee==8&&Se.qpro?(Ie.s.c=pe.read_shift(1),pe.l++,Ie.s.r=pe.read_shift(2),Ie.e.c=pe.read_shift(1),pe.l++,Ie.e.r=pe.read_shift(2),Ie):(Ie.s.c=pe.read_shift(2),Ie.s.r=pe.read_shift(2),Ee==12&&Se.qpro&&(pe.l+=2),Ie.e.c=pe.read_shift(2),Ie.e.r=pe.read_shift(2),Ee==12&&Se.qpro&&(pe.l+=2),Ie.s.c==65535&&(Ie.s.c=Ie.e.c=Ie.s.r=Ie.e.r=0),Ie)}function E(pe){var Ee=Ma(8);return Ee.write_shift(2,pe.s.c),Ee.write_shift(2,pe.s.r),Ee.write_shift(2,pe.e.c),Ee.write_shift(2,pe.e.r),Ee}function w(pe,Ee,Se){var Ie=[{c:0,r:0},{t:"n",v:0},0,0];return Se.qpro&&Se.vers!=20768?(Ie[0].c=pe.read_shift(1),Ie[3]=pe.read_shift(1),Ie[0].r=pe.read_shift(2),pe.l+=2):(Ie[2]=pe.read_shift(1),Ie[0].c=pe.read_shift(2),Ie[0].r=pe.read_shift(2)),Ie}function C(pe,Ee,Se){var Ie=pe.l+Ee,Ke=w(pe,Ee,Se);if(Ke[1].t="s",Se.vers==20768){pe.l++;var dt=pe.read_shift(1);return Ke[1].v=pe.read_shift(dt,"utf8"),Ke}return Se.qpro&&pe.l++,Ke[1].v=pe.read_shift(Ie-pe.l,"cstr"),Ke}function P(pe,Ee,Se){var Ie=Ma(7+Se.length);Ie.write_shift(1,255),Ie.write_shift(2,Ee),Ie.write_shift(2,pe),Ie.write_shift(1,39);for(var Ke=0;Ke<Ie.length;++Ke){var dt=Se.charCodeAt(Ke);Ie.write_shift(1,dt>=128?95:dt)}return Ie.write_shift(1,0),Ie}function M(pe,Ee,Se){var Ie=w(pe,Ee,Se);return Ie[1].v=pe.read_shift(2,"i"),Ie}function O(pe,Ee,Se){var Ie=Ma(7);return Ie.write_shift(1,255),Ie.write_shift(2,Ee),Ie.write_shift(2,pe),Ie.write_shift(2,Se,"i"),Ie}function U(pe,Ee,Se){var Ie=w(pe,Ee,Se);return Ie[1].v=pe.read_shift(8,"f"),Ie}function z(pe,Ee,Se){var Ie=Ma(13);return Ie.write_shift(1,255),Ie.write_shift(2,Ee),Ie.write_shift(2,pe),Ie.write_shift(8,Se,"f"),Ie}function j(pe,Ee,Se){var Ie=pe.l+Ee,Ke=w(pe,Ee,Se);if(Ke[1].v=pe.read_shift(8,"f"),Se.qpro)pe.l=Ie;else{var dt=pe.read_shift(2);fe(pe.slice(pe.l,pe.l+dt),Ke),pe.l+=dt}return Ke}function ee(pe,Ee,Se){var Ie=Ee&32768;return Ee&=-32769,Ee=(Ie?pe:0)+(Ee>=8192?Ee-16384:Ee),(Ie?"":"$")+(Se?Da(Ee):Ka(Ee))}var le={51:["FALSE",0],52:["TRUE",0],70:["LEN",1],80:["SUM",69],81:["AVERAGEA",69],82:["COUNTA",69],83:["MINA",69],84:["MAXA",69],111:["T",1]},Z=["","","","","","","","","","+","-","*","/","^","=","<>","<=",">=","<",">","","","","","&","","","","","","",""];function fe(pe,Ee){Za(pe,0);for(var Se=[],Ie=0,Ke="",dt="",vt="",ut="";pe.l<pe.length;){var Qe=pe[pe.l++];switch(Qe){case 0:Se.push(pe.read_shift(8,"f"));break;case 1:dt=ee(Ee[0].c,pe.read_shift(2),!0),Ke=ee(Ee[0].r,pe.read_shift(2),!1),Se.push(dt+Ke);break;case 2:{var qt=ee(Ee[0].c,pe.read_shift(2),!0),_e=ee(Ee[0].r,pe.read_shift(2),!1);dt=ee(Ee[0].c,pe.read_shift(2),!0),Ke=ee(Ee[0].r,pe.read_shift(2),!1),Se.push(qt+_e+":"+dt+Ke)}break;case 3:if(pe.l<pe.length){console.error("WK1 premature formula end");return}break;case 4:Se.push("("+Se.pop()+")");break;case 5:Se.push(pe.read_shift(2));break;case 6:{for(var Yt="";Qe=pe[pe.l++];)Yt+=String.fromCharCode(Qe);Se.push('"'+Yt.replace(/"/g,'""')+'"')}break;case 8:Se.push("-"+Se.pop());break;case 23:Se.push("+"+Se.pop());break;case 22:Se.push("NOT("+Se.pop()+")");break;case 20:case 21:ut=Se.pop(),vt=Se.pop(),Se.push(["AND","OR"][Qe-20]+"("+vt+","+ut+")");break;default:if(Qe<32&&Z[Qe])ut=Se.pop(),vt=Se.pop(),Se.push(vt+Z[Qe]+ut);else if(le[Qe]){if(Ie=le[Qe][1],Ie==69&&(Ie=pe[pe.l++]),Ie>Se.length){console.error("WK1 bad formula parse 0x"+Qe.toString(16)+":|"+Se.join("|")+"|");return}var Wt=Se.slice(-Ie);Se.length-=Ie,Se.push(le[Qe][0]+"("+Wt.join(",")+")")}else return Qe<=7?console.error("WK1 invalid opcode "+Qe.toString(16)):Qe<=24?console.error("WK1 unsupported op "+Qe.toString(16)):Qe<=30?console.error("WK1 invalid opcode "+Qe.toString(16)):Qe<=115?console.error("WK1 unsupported function opcode "+Qe.toString(16)):console.error("WK1 unrecognized opcode "+Qe.toString(16))}}Se.length==1?Ee[1].f=""+Se[0]:console.error("WK1 bad formula parse |"+Se.join("|")+"|")}function me(pe){var Ee=[{c:0,r:0},{t:"n",v:0},0];return Ee[0].r=pe.read_shift(2),Ee[3]=pe[pe.l++],Ee[0].c=pe[pe.l++],Ee}function Te(pe,Ee){var Se=me(pe);return Se[1].t="s",Se[1].v=pe.read_shift(Ee-4,"cstr"),Se}function re(pe,Ee,Se,Ie){var Ke=Ma(6+Ie.length);Ke.write_shift(2,pe),Ke.write_shift(1,Se),Ke.write_shift(1,Ee),Ke.write_shift(1,39);for(var dt=0;dt<Ie.length;++dt){var vt=Ie.charCodeAt(dt);Ke.write_shift(1,vt>=128?95:vt)}return Ke.write_shift(1,0),Ke}function Ce(pe,Ee){var Se=me(pe);Se[1].v=pe.read_shift(2);var Ie=Se[1].v>>1;if(Se[1].v&1)switch(Ie&7){case 0:Ie=(Ie>>3)*5e3;break;case 1:Ie=(Ie>>3)*500;break;case 2:Ie=(Ie>>3)/20;break;case 3:Ie=(Ie>>3)/200;break;case 4:Ie=(Ie>>3)/2e3;break;case 5:Ie=(Ie>>3)/2e4;break;case 6:Ie=(Ie>>3)/16;break;case 7:Ie=(Ie>>3)/64;break}return Se[1].v=Ie,Se}function be(pe,Ee){var Se=me(pe),Ie=pe.read_shift(4),Ke=pe.read_shift(4),dt=pe.read_shift(2);if(dt==65535)return Ie===0&&Ke===3221225472?(Se[1].t="e",Se[1].v=15):Ie===0&&Ke===3489660928?(Se[1].t="e",Se[1].v=42):Se[1].v=0,Se;var vt=dt&32768;return dt=(dt&32767)-16446,Se[1].v=(1-vt*2)*(Ke*Math.pow(2,dt+32)+Ie*Math.pow(2,dt)),Se}function Fe(pe,Ee,Se,Ie){var Ke=Ma(14);if(Ke.write_shift(2,pe),Ke.write_shift(1,Se),Ke.write_shift(1,Ee),Ie==0)return Ke.write_shift(4,0),Ke.write_shift(4,0),Ke.write_shift(2,65535),Ke;var dt=0,vt=0,ut=0,Qe=0;return Ie<0&&(dt=1,Ie=-Ie),vt=Math.log2(Ie)|0,Ie/=Math.pow(2,vt-31),Qe=Ie>>>0,Qe&2147483648||(Ie/=2,++vt,Qe=Ie>>>0),Ie-=Qe,Qe|=2147483648,Qe>>>=0,Ie*=Math.pow(2,32),ut=Ie>>>0,Ke.write_shift(4,ut),Ke.write_shift(4,Qe),vt+=16383+(dt?32768:0),Ke.write_shift(2,vt),Ke}function Oe(pe,Ee){var Se=be(pe);return pe.l+=Ee-14,Se}function Me(pe,Ee){var Se=me(pe),Ie=pe.read_shift(4);return Se[1].v=Ie>>6,Se}function rt(pe,Ee){var Se=me(pe),Ie=pe.read_shift(8,"f");return Se[1].v=Ie,Se}function ft(pe,Ee){var Se=rt(pe);return pe.l+=Ee-10,Se}function lt(pe,Ee){return pe[pe.l+Ee-1]==0?pe.read_shift(Ee,"cstr"):""}function _t(pe,Ee){var Se=pe[pe.l++];Se>Ee-1&&(Se=Ee-1);for(var Ie="";Ie.length<Se;)Ie+=String.fromCharCode(pe[pe.l++]);return Ie}function nt(pe,Ee,Se){if(!(!Se.qpro||Ee<21)){var Ie=pe.read_shift(1);pe.l+=17,pe.l+=1,pe.l+=2;var Ke=pe.read_shift(Ee-21,"cstr");return[Ie,Ke]}}function Kt(pe,Ee){for(var Se={},Ie=pe.l+Ee;pe.l<Ie;){var Ke=pe.read_shift(2);if(Ke==14e3){for(Se[Ke]=[0,""],Se[Ke][0]=pe.read_shift(2);pe[pe.l];)Se[Ke][1]+=String.fromCharCode(pe[pe.l]),pe.l++;pe.l++}}return Se}function He(pe,Ee){var Se=Ma(5+pe.length);Se.write_shift(2,14e3),Se.write_shift(2,Ee);for(var Ie=0;Ie<pe.length;++Ie){var Ke=pe.charCodeAt(Ie);Se[Se.l++]=Ke>127?95:Ke}return Se[Se.l++]=0,Se}var Nt={0:{n:"BOF",f:Ca},1:{n:"EOF"},2:{n:"CALCMODE"},3:{n:"CALCORDER"},4:{n:"SPLIT"},5:{n:"SYNC"},6:{n:"RANGE",f:o},7:{n:"WINDOW1"},8:{n:"COLW1"},9:{n:"WINTWO"},10:{n:"COLW2"},11:{n:"NAME"},12:{n:"BLANK"},13:{n:"INTEGER",f:M},14:{n:"NUMBER",f:U},15:{n:"LABEL",f:C},16:{n:"FORMULA",f:j},24:{n:"TABLE"},25:{n:"ORANGE"},26:{n:"PRANGE"},27:{n:"SRANGE"},28:{n:"FRANGE"},29:{n:"KRANGE1"},32:{n:"HRANGE"},35:{n:"KRANGE2"},36:{n:"PROTEC"},37:{n:"FOOTER"},38:{n:"HEADER"},39:{n:"SETUP"},40:{n:"MARGINS"},41:{n:"LABELFMT"},42:{n:"TITLES"},43:{n:"SHEETJS"},45:{n:"GRAPH"},46:{n:"NGRAPH"},47:{n:"CALCCOUNT"},48:{n:"UNFORMATTED"},49:{n:"CURSORW12"},50:{n:"WINDOW"},51:{n:"STRING",f:C},55:{n:"PASSWORD"},56:{n:"LOCKED"},60:{n:"QUERY"},61:{n:"QUERYNAME"},62:{n:"PRINT"},63:{n:"PRINTNAME"},64:{n:"GRAPH2"},65:{n:"GRAPHNAME"},66:{n:"ZOOM"},67:{n:"SYMSPLIT"},68:{n:"NSROWS"},69:{n:"NSCOLS"},70:{n:"RULER"},71:{n:"NNAME"},72:{n:"ACOMM"},73:{n:"AMACRO"},74:{n:"PARSE"},102:{n:"PRANGES??"},103:{n:"RRANGES??"},104:{n:"FNAME??"},105:{n:"MRANGES??"},204:{n:"SHEETNAMECS",f:lt},222:{n:"SHEETNAMELP",f:_t},65535:{n:""}},Mt={0:{n:"BOF"},1:{n:"EOF"},2:{n:"PASSWORD"},3:{n:"CALCSET"},4:{n:"WINDOWSET"},5:{n:"SHEETCELLPTR"},6:{n:"SHEETLAYOUT"},7:{n:"COLUMNWIDTH"},8:{n:"HIDDENCOLUMN"},9:{n:"USERRANGE"},10:{n:"SYSTEMRANGE"},11:{n:"ZEROFORCE"},12:{n:"SORTKEYDIR"},13:{n:"FILESEAL"},14:{n:"DATAFILLNUMS"},15:{n:"PRINTMAIN"},16:{n:"PRINTSTRING"},17:{n:"GRAPHMAIN"},18:{n:"GRAPHSTRING"},19:{n:"??"},20:{n:"ERRCELL"},21:{n:"NACELL"},22:{n:"LABEL16",f:Te},23:{n:"NUMBER17",f:be},24:{n:"NUMBER18",f:Ce},25:{n:"FORMULA19",f:Oe},26:{n:"FORMULA1A"},27:{n:"XFORMAT",f:Kt},28:{n:"DTLABELMISC"},29:{n:"DTLABELCELL"},30:{n:"GRAPHWINDOW"},31:{n:"CPA"},32:{n:"LPLAUTO"},33:{n:"QUERY"},34:{n:"HIDDENSHEET"},35:{n:"??"},37:{n:"NUMBER25",f:Me},38:{n:"??"},39:{n:"NUMBER27",f:rt},40:{n:"FORMULA28",f:ft},142:{n:"??"},147:{n:"??"},150:{n:"??"},151:{n:"??"},152:{n:"??"},153:{n:"??"},154:{n:"??"},155:{n:"??"},156:{n:"??"},163:{n:"??"},174:{n:"??"},175:{n:"??"},176:{n:"??"},177:{n:"??"},184:{n:"??"},185:{n:"??"},186:{n:"??"},187:{n:"??"},188:{n:"??"},195:{n:"??"},201:{n:"??"},204:{n:"SHEETNAMECS",f:lt},205:{n:"??"},206:{n:"??"},207:{n:"??"},208:{n:"??"},256:{n:"??"},259:{n:"??"},260:{n:"??"},261:{n:"??"},262:{n:"??"},263:{n:"??"},265:{n:"??"},266:{n:"??"},267:{n:"??"},268:{n:"??"},270:{n:"??"},271:{n:"??"},384:{n:"??"},389:{n:"??"},390:{n:"??"},393:{n:"??"},396:{n:"??"},512:{n:"??"},514:{n:"??"},513:{n:"??"},516:{n:"??"},517:{n:"??"},640:{n:"??"},641:{n:"??"},642:{n:"??"},643:{n:"??"},644:{n:"??"},645:{n:"??"},646:{n:"??"},647:{n:"??"},648:{n:"??"},658:{n:"??"},659:{n:"??"},660:{n:"??"},661:{n:"??"},662:{n:"??"},665:{n:"??"},666:{n:"??"},768:{n:"??"},772:{n:"??"},1537:{n:"SHEETINFOQP",f:nt},1600:{n:"??"},1602:{n:"??"},1793:{n:"??"},1794:{n:"??"},1795:{n:"??"},1796:{n:"??"},1920:{n:"??"},2048:{n:"??"},2049:{n:"??"},2052:{n:"??"},2688:{n:"??"},10998:{n:"??"},12849:{n:"??"},28233:{n:"??"},28484:{n:"??"},65535:{n:""}};return{sheet_to_wk1:c,book_to_wk3:u,to_workbook:n}}();function HS(e){var n={},a=e.match(fi),c=0,u=!1;if(a)for(;c!=a.length;++c){var m=ar(a[c]);switch(m[0].replace(/\w*:/g,"")){case"<condense":break;case"<extend":break;case"<shadow":if(!m.val)break;case"<shadow>":case"<shadow/>":n.shadow=1;break;case"</shadow>":break;case"<charset":if(m.val=="1")break;n.cp=q0[parseInt(m.val,10)];break;case"<outline":if(!m.val)break;case"<outline>":case"<outline/>":n.outline=1;break;case"</outline>":break;case"<rFont":n.name=m.val;break;case"<sz":n.sz=m.val;break;case"<strike":if(!m.val)break;case"<strike>":case"<strike/>":n.strike=1;break;case"</strike>":break;case"<u":if(!m.val)break;switch(m.val){case"double":n.uval="double";break;case"singleAccounting":n.uval="single-accounting";break;case"doubleAccounting":n.uval="double-accounting";break}case"<u>":case"<u/>":n.u=1;break;case"</u>":break;case"<b":if(m.val=="0")break;case"<b>":case"<b/>":n.b=1;break;case"</b>":break;case"<i":if(m.val=="0")break;case"<i>":case"<i/>":n.i=1;break;case"</i>":break;case"<color":m.rgb&&(n.color=m.rgb.slice(2,8));break;case"<color>":case"<color/>":case"</color>":break;case"<family":n.family=m.val;break;case"<family>":case"<family/>":case"</family>":break;case"<vertAlign":n.valign=m.val;break;case"<vertAlign>":case"<vertAlign/>":case"</vertAlign>":break;case"<scheme":break;case"<scheme>":case"<scheme/>":case"</scheme>":break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":u=!0;break;case"</ext>":u=!1;break;default:if(m[0].charCodeAt(1)!==47&&!u)throw new Error("Unrecognized rich format "+m[0])}}return n}var qS=function(){var e=Jc("t"),n=Jc("rPr");function a(m){var x=m.match(e);if(!x)return{t:"s",v:""};var o={t:"s",v:Er(x[1])},E=m.match(n);return E&&(o.s=HS(E[1])),o}var c=/<(?:\w+:)?r>/g,u=/<\/(?:\w+:)?r>/;return function(x){return x.replace(c,"").split(u).map(a).filter(function(o){return o.v})}}(),WS=function(){var n=/(\r\n|\n)/g;function a(u,m,x){var o=[];u.u&&o.push("text-decoration: underline;"),u.uval&&o.push("text-underline-style:"+u.uval+";"),u.sz&&o.push("font-size:"+u.sz+"pt;"),u.outline&&o.push("text-effect: outline;"),u.shadow&&o.push("text-shadow: auto;"),m.push('<span style="'+o.join("")+'">'),u.b&&(m.push("<b>"),x.push("</b>")),u.i&&(m.push("<i>"),x.push("</i>")),u.strike&&(m.push("<s>"),x.push("</s>"));var E=u.valign||"";return E=="superscript"||E=="super"?E="sup":E=="subscript"&&(E="sub"),E!=""&&(m.push("<"+E+">"),x.push("</"+E+">")),x.push("</span>"),u}function c(u){var m=[[],u.v,[]];return u.v?(u.s&&a(u.s,m[0],m[2]),m[0].join("")+m[1].replace(n,"<br/>")+m[2].join("")):""}return function(m){return m.map(c).join("")}}(),ZS=/<(?:\w+:)?t[^>]*>([^<]*)<\/(?:\w+:)?t>/g,XS=/<(?:\w+:)?r>/,KS=/<(?:\w+:)?rPh.*?>([\s\S]*?)<\/(?:\w+:)?rPh>/g;function cd(e,n){var a=n?n.cellHTML:!0,c={};return e?(e.match(/^\s*<(?:\w+:)?t[^>]*>/)?(c.t=Er(Zr(e.slice(e.indexOf(">")+1).split(/<\/(?:\w+:)?t>/)[0]||"")),c.r=Zr(e),a&&(c.h=Q0(c.t))):e.match(XS)&&(c.r=Zr(e),c.t=Er(Zr((e.replace(KS,"").match(ZS)||[]).join("").replace(fi,""))),a&&(c.h=WS(qS(c.r)))),c):{t:""}}var YS=/<(?:\w+:)?sst([^>]*)>([\s\S]*)<\/(?:\w+:)?sst>/,JS=/<(?:\w+:)?(?:si|sstItem)>/g,QS=/<\/(?:\w+:)?(?:si|sstItem)>/;function ek(e,n){var a=[],c="";if(!e)return a;var u=e.match(YS);if(u){c=u[2].replace(JS,"").split(QS);for(var m=0;m!=c.length;++m){var x=cd(c[m].trim(),n);x!=null&&(a[a.length]=x)}u=ar(u[1]),a.Count=u.count,a.Unique=u.uniqueCount}return a}function tk(e){return[e.read_shift(4),e.read_shift(4)]}function rk(e,n){var a=[],c=!1;return cs(e,function(m,x,o){switch(o){case 159:a.Count=m[0],a.Unique=m[1];break;case 19:a.push(m);break;case 160:return!0;case 35:c=!0;break;case 36:c=!1;break;default:if(x.T,!c||n.WTF)throw new Error("Unexpected record 0x"+o.toString(16))}}),a}function ox(e){for(var n=[],a=e.split(""),c=0;c<a.length;++c)n[c]=a[c].charCodeAt(0);return n}function os(e,n){var a={};return a.Major=e.read_shift(2),a.Minor=e.read_shift(2),n>=4&&(e.l+=n-4),a}function ak(e){var n={};return n.id=e.read_shift(0,"lpp4"),n.R=os(e,4),n.U=os(e,4),n.W=os(e,4),n}function ik(e){for(var n=e.read_shift(4),a=e.l+n-4,c={},u=e.read_shift(4),m=[];u-- >0;)m.push({t:e.read_shift(4),v:e.read_shift(0,"lpp4")});if(c.name=e.read_shift(0,"lpp4"),c.comps=m,e.l!=a)throw new Error("Bad DataSpaceMapEntry: "+e.l+" != "+a);return c}function nk(e){var n=[];e.l+=4;for(var a=e.read_shift(4);a-- >0;)n.push(ik(e));return n}function sk(e){var n=[];e.l+=4;for(var a=e.read_shift(4);a-- >0;)n.push(e.read_shift(0,"lpp4"));return n}function ok(e){var n={};return e.read_shift(4),e.l+=4,n.id=e.read_shift(0,"lpp4"),n.name=e.read_shift(0,"lpp4"),n.R=os(e,4),n.U=os(e,4),n.W=os(e,4),n}function lk(e){var n=ok(e);if(n.ename=e.read_shift(0,"8lpp4"),n.blksz=e.read_shift(4),n.cmode=e.read_shift(4),e.read_shift(4)!=4)throw new Error("Bad !Primary record");return n}function lx(e,n){var a=e.l+n,c={};c.Flags=e.read_shift(4)&63,e.l+=4,c.AlgID=e.read_shift(4);var u=!1;switch(c.AlgID){case 26126:case 26127:case 26128:u=c.Flags==36;break;case 26625:u=c.Flags==4;break;case 0:u=c.Flags==16||c.Flags==4||c.Flags==36;break;default:throw"Unrecognized encryption algorithm: "+c.AlgID}if(!u)throw new Error("Encryption Flags/AlgID mismatch");return c.AlgIDHash=e.read_shift(4),c.KeySize=e.read_shift(4),c.ProviderType=e.read_shift(4),e.l+=8,c.CSPName=e.read_shift(a-e.l>>1,"utf16le"),e.l=a,c}function cx(e,n){var a={},c=e.l+n;return e.l+=4,a.Salt=e.slice(e.l,e.l+16),e.l+=16,a.Verifier=e.slice(e.l,e.l+16),e.l+=16,e.read_shift(4),a.VerifierHash=e.slice(e.l,c),e.l=c,a}function ck(e){var n=os(e);switch(n.Minor){case 2:return[n.Minor,uk(e)];case 3:return[n.Minor,hk()];case 4:return[n.Minor,fk(e)]}throw new Error("ECMA-376 Encrypted file unrecognized Version: "+n.Minor)}function uk(e){var n=e.read_shift(4);if((n&63)!=36)throw new Error("EncryptionInfo mismatch");var a=e.read_shift(4),c=lx(e,a),u=cx(e,e.length-e.l);return{t:"Std",h:c,v:u}}function hk(){throw new Error("File is password-protected: ECMA-376 Extensible")}function fk(e){var n=["saltSize","blockSize","keyBits","hashSize","cipherAlgorithm","cipherChaining","hashAlgorithm","saltValue"];e.l+=4;var a=e.read_shift(e.length-e.l,"utf8"),c={};return a.replace(fi,function(m){var x=ar(m);switch(Un(x[0])){case"<?xml":break;case"<encryption":case"</encryption>":break;case"<keyData":n.forEach(function(o){c[o]=x[o]});break;case"<dataIntegrity":c.encryptedHmacKey=x.encryptedHmacKey,c.encryptedHmacValue=x.encryptedHmacValue;break;case"<keyEncryptors>":case"<keyEncryptors":c.encs=[];break;case"</keyEncryptors>":break;case"<keyEncryptor":c.uri=x.uri;break;case"</keyEncryptor>":break;case"<encryptedKey":c.encs.push(x);break;default:throw x[0]}}),c}function dk(e,n){var a={},c=a.EncryptionVersionInfo=os(e,4);if(n-=4,c.Minor!=2)throw new Error("unrecognized minor version code: "+c.Minor);if(c.Major>4||c.Major<2)throw new Error("unrecognized major version code: "+c.Major);a.Flags=e.read_shift(4),n-=4;var u=e.read_shift(4);return n-=4,a.EncryptionHeader=lx(e,u),n-=u,a.EncryptionVerifier=cx(e,n),a}function pk(e){var n={},a=n.EncryptionVersionInfo=os(e,4);if(a.Major!=1||a.Minor!=1)throw"unrecognized version code "+a.Major+" : "+a.Minor;return n.Salt=e.read_shift(16),n.EncryptedVerifier=e.read_shift(16),n.EncryptedVerifierHash=e.read_shift(16),n}function mk(e){var n=0,a,c=ox(e),u=c.length+1,m,x,o,E,w;for(a=zs(u),a[0]=c.length,m=1;m!=u;++m)a[m]=c[m-1];for(m=u-1;m>=0;--m)x=a[m],o=n&16384?1:0,E=n<<1&32767,w=o|E,n=w^x;return n^52811}var ux=function(){var e=[187,255,255,186,255,255,185,128,0,190,15,0,191,15,0],n=[57840,7439,52380,33984,4364,3600,61902,12606,6258,57657,54287,34041,10252,43370,20163],a=[44796,19929,39858,10053,20106,40212,10761,31585,63170,64933,60267,50935,40399,11199,17763,35526,1453,2906,5812,11624,23248,885,1770,3540,7080,14160,28320,56640,55369,41139,20807,41614,21821,43642,17621,28485,56970,44341,19019,38038,14605,29210,60195,50791,40175,10751,21502,43004,24537,18387,36774,3949,7898,15796,31592,63184,47201,24803,49606,37805,14203,28406,56812,17824,35648,1697,3394,6788,13576,27152,43601,17539,35078,557,1114,2228,4456,30388,60776,51953,34243,7079,14158,28316,14128,28256,56512,43425,17251,34502,7597,13105,26210,52420,35241,883,1766,3532,4129,8258,16516,33032,4657,9314,18628],c=function(x){return(x/2|x*128)&255},u=function(x,o){return c(x^o)},m=function(x){for(var o=n[x.length-1],E=104,w=x.length-1;w>=0;--w)for(var C=x[w],P=0;P!=7;++P)C&64&&(o^=a[E]),C*=2,--E;return o};return function(x){for(var o=ox(x),E=m(o),w=o.length,C=zs(16),P=0;P!=16;++P)C[P]=0;var M,O,U;for((w&1)===1&&(M=E>>8,C[w]=u(e[0],M),--w,M=E&255,O=o[o.length-1],C[w]=u(O,M));w>0;)--w,M=E>>8,C[w]=u(o[w],M),--w,M=E&255,C[w]=u(o[w],M);for(w=15,U=15-o.length;U>0;)M=E>>8,C[w]=u(e[U],M),--w,--U,M=E&255,C[w]=u(o[w],M),--w,--U;return C}}(),gk=function(e,n,a,c,u){u||(u=n),c||(c=ux(e));var m,x;for(m=0;m!=n.length;++m)x=n[m],x^=c[a],x=(x>>5|x<<3)&255,u[m]=x,++a;return[u,a,c]},xk=function(e){var n=0,a=ux(e);return function(c){var u=gk("",c,n,a);return n=u[1],u[0]}};function _k(e,n,a,c){var u={key:Ca(e),verificationBytes:Ca(e)};return a.password&&(u.verifier=mk(a.password)),c.valid=u.verificationBytes===u.verifier,c.valid&&(c.insitu=xk(a.password)),u}function yk(e,n,a){var c=a||{};return c.Info=e.read_shift(2),e.l-=2,c.Info===1?c.Data=pk(e):c.Data=dk(e,n),c}function vk(e,n,a){var c={Type:a.biff>=8?e.read_shift(2):0};return c.Type?yk(e,n-2,c):_k(e,a.biff>=8?n:n-2,a,c),c}var wk=function(){function e(u,m){switch(m.type){case"base64":return n(qi(u),m);case"binary":return n(u,m);case"buffer":return n(wr&&Buffer.isBuffer(u)?u.toString("binary"):To(u),m);case"array":return n(yo(u),m)}throw new Error("Unrecognized type "+m.type)}function n(u,m){var x=m||{},o=x.dense?[]:{},E=u.match(/\\trowd.*?\\row\b/g);if(!E.length)throw new Error("RTF missing table");var w={s:{c:0,r:0},e:{c:0,r:E.length-1}};return E.forEach(function(C,P){Array.isArray(o)&&(o[P]=[]);for(var M=/\\\w+\b/g,O=0,U,z=-1;U=M.exec(C);){switch(U[0]){case"\\cell":var j=C.slice(O,M.lastIndex-U[0].length);if(j[0]==" "&&(j=j.slice(1)),++z,j.length){var ee={v:j,t:"s"};Array.isArray(o)?o[P][z]=ee:o[or({r:P,c:z})]=ee}break}O=M.lastIndex}z>w.e.c&&(w.e.c=z)}),o["!ref"]=Tr(w),o}function a(u,m){return Us(e(u,m),m)}function c(u){for(var m=["{\\rtf1\\ansi"],x=da(u["!ref"]),o,E=Array.isArray(u),w=x.s.r;w<=x.e.r;++w){m.push("\\trowd\\trautofit1");for(var C=x.s.c;C<=x.e.c;++C)m.push("\\cellx"+(C+1));for(m.push("\\pard\\intbl"),C=x.s.c;C<=x.e.c;++C){var P=or({r:w,c:C});o=E?(u[w]||[])[C]:u[P],!(!o||o.v==null&&(!o.f||o.F))&&(m.push(" "+(o.w||(ls(o),o.w))),m.push("\\cell"))}m.push("\\pard\\intbl\\row")}return m.join("")+"}"}return{to_workbook:a,to_sheet:e,from_sheet:c}}();function bk(e){var n=e.slice(e[0]==="#"?1:0).slice(0,6);return[parseInt(n.slice(0,2),16),parseInt(n.slice(2,4),16),parseInt(n.slice(4,6),16)]}function tu(e){for(var n=0,a=1;n!=3;++n)a=a*256+(e[n]>255?255:e[n]<0?0:e[n]);return a.toString(16).toUpperCase().slice(1)}function Tk(e){var n=e[0]/255,a=e[1]/255,c=e[2]/255,u=Math.max(n,a,c),m=Math.min(n,a,c),x=u-m;if(x===0)return[0,0,n];var o=0,E=0,w=u+m;switch(E=x/(w>1?2-w:w),u){case n:o=((a-c)/x+6)%6;break;case a:o=(c-n)/x+2;break;case c:o=(n-a)/x+4;break}return[o/6,E,w/2]}function Ek(e){var n=e[0],a=e[1],c=e[2],u=a*2*(c<.5?c:1-c),m=c-u/2,x=[m,m,m],o=6*n,E;if(a!==0)switch(o|0){case 0:case 6:E=u*o,x[0]+=u,x[1]+=E;break;case 1:E=u*(2-o),x[0]+=E,x[1]+=u;break;case 2:E=u*(o-2),x[1]+=u,x[2]+=E;break;case 3:E=u*(4-o),x[1]+=E,x[2]+=u;break;case 4:E=u*(o-4),x[2]+=u,x[0]+=E;break;case 5:E=u*(6-o),x[2]+=E,x[0]+=u;break}for(var w=0;w!=3;++w)x[w]=Math.round(x[w]*255);return x}function Vh(e,n){if(n===0)return e;var a=Tk(bk(e));return n<0?a[2]=a[2]*(1+n):a[2]=1-(1-a[2])*(1-n),tu(Ek(a))}var hx=6,Sk=15,kk=1,Ei=hx;function $h(e){return Math.floor((e+Math.round(128/Ei)/256)*Ei)}function jh(e){return Math.floor((e-5)/Ei*100+.5)/100}function P0(e){return Math.round((e*Ei+5)/Ei*256)/256}function g0(e){return P0(jh($h(e)))}function ud(e){var n=Math.abs(e-g0(e)),a=Ei;if(n>.005)for(Ei=kk;Ei<Sk;++Ei)Math.abs(e-g0(e))<=n&&(n=Math.abs(e-g0(e)),a=Ei);Ei=a}function vl(e){e.width?(e.wpx=$h(e.width),e.wch=jh(e.wpx),e.MDW=Ei):e.wpx?(e.wch=jh(e.wpx),e.width=P0(e.wch),e.MDW=Ei):typeof e.wch=="number"&&(e.width=P0(e.wch),e.wpx=$h(e.width),e.MDW=Ei),e.customWidth&&delete e.customWidth}var Ck=96,fx=Ck;function dx(e){return e*96/fx}function ru(e){return e*fx/96}var Ak={None:"none",Solid:"solid",Gray50:"mediumGray",Gray75:"darkGray",Gray25:"lightGray",HorzStripe:"darkHorizontal",VertStripe:"darkVertical",ReverseDiagStripe:"darkDown",DiagStripe:"darkUp",DiagCross:"darkGrid",ThickDiagCross:"darkTrellis",ThinHorzStripe:"lightHorizontal",ThinVertStripe:"lightVertical",ThinReverseDiagStripe:"lightDown",ThinHorzCross:"lightGrid"};function Ik(e,n,a,c){n.Borders=[];var u={},m=!1;(e[0].match(fi)||[]).forEach(function(x){var o=ar(x);switch(Un(o[0])){case"<borders":case"<borders>":case"</borders>":break;case"<border":case"<border>":case"<border/>":u={},o.diagonalUp&&(u.diagonalUp=aa(o.diagonalUp)),o.diagonalDown&&(u.diagonalDown=aa(o.diagonalDown)),n.Borders.push(u);break;case"</border>":break;case"<left/>":break;case"<left":case"<left>":break;case"</left>":break;case"<right/>":break;case"<right":case"<right>":break;case"</right>":break;case"<top/>":break;case"<top":case"<top>":break;case"</top>":break;case"<bottom/>":break;case"<bottom":case"<bottom>":break;case"</bottom>":break;case"<diagonal":case"<diagonal>":case"<diagonal/>":break;case"</diagonal>":break;case"<horizontal":case"<horizontal>":case"<horizontal/>":break;case"</horizontal>":break;case"<vertical":case"<vertical>":case"<vertical/>":break;case"</vertical>":break;case"<start":case"<start>":case"<start/>":break;case"</start>":break;case"<end":case"<end>":case"<end/>":break;case"</end>":break;case"<color":case"<color>":break;case"<color/>":case"</color>":break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":m=!0;break;case"</ext>":m=!1;break;default:if(c&&c.WTF&&!m)throw new Error("unrecognized "+o[0]+" in borders")}})}function Fk(e,n,a,c){n.Fills=[];var u={},m=!1;(e[0].match(fi)||[]).forEach(function(x){var o=ar(x);switch(Un(o[0])){case"<fills":case"<fills>":case"</fills>":break;case"<fill>":case"<fill":case"<fill/>":u={},n.Fills.push(u);break;case"</fill>":break;case"<gradientFill>":break;case"<gradientFill":case"</gradientFill>":n.Fills.push(u),u={};break;case"<patternFill":case"<patternFill>":o.patternType&&(u.patternType=o.patternType);break;case"<patternFill/>":case"</patternFill>":break;case"<bgColor":u.bgColor||(u.bgColor={}),o.indexed&&(u.bgColor.indexed=parseInt(o.indexed,10)),o.theme&&(u.bgColor.theme=parseInt(o.theme,10)),o.tint&&(u.bgColor.tint=parseFloat(o.tint)),o.rgb&&(u.bgColor.rgb=o.rgb.slice(-6));break;case"<bgColor/>":case"</bgColor>":break;case"<fgColor":u.fgColor||(u.fgColor={}),o.theme&&(u.fgColor.theme=parseInt(o.theme,10)),o.tint&&(u.fgColor.tint=parseFloat(o.tint)),o.rgb!=null&&(u.fgColor.rgb=o.rgb.slice(-6));break;case"<fgColor/>":case"</fgColor>":break;case"<stop":case"<stop/>":break;case"</stop>":break;case"<color":case"<color/>":break;case"</color>":break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":m=!0;break;case"</ext>":m=!1;break;default:if(c&&c.WTF&&!m)throw new Error("unrecognized "+o[0]+" in fills")}})}function Pk(e,n,a,c){n.Fonts=[];var u={},m=!1;(e[0].match(fi)||[]).forEach(function(x){var o=ar(x);switch(Un(o[0])){case"<fonts":case"<fonts>":case"</fonts>":break;case"<font":case"<font>":break;case"</font>":case"<font/>":n.Fonts.push(u),u={};break;case"<name":o.val&&(u.name=Zr(o.val));break;case"<name/>":case"</name>":break;case"<b":u.bold=o.val?aa(o.val):1;break;case"<b/>":u.bold=1;break;case"<i":u.italic=o.val?aa(o.val):1;break;case"<i/>":u.italic=1;break;case"<u":switch(o.val){case"none":u.underline=0;break;case"single":u.underline=1;break;case"double":u.underline=2;break;case"singleAccounting":u.underline=33;break;case"doubleAccounting":u.underline=34;break}break;case"<u/>":u.underline=1;break;case"<strike":u.strike=o.val?aa(o.val):1;break;case"<strike/>":u.strike=1;break;case"<outline":u.outline=o.val?aa(o.val):1;break;case"<outline/>":u.outline=1;break;case"<shadow":u.shadow=o.val?aa(o.val):1;break;case"<shadow/>":u.shadow=1;break;case"<condense":u.condense=o.val?aa(o.val):1;break;case"<condense/>":u.condense=1;break;case"<extend":u.extend=o.val?aa(o.val):1;break;case"<extend/>":u.extend=1;break;case"<sz":o.val&&(u.sz=+o.val);break;case"<sz/>":case"</sz>":break;case"<vertAlign":o.val&&(u.vertAlign=o.val);break;case"<vertAlign/>":case"</vertAlign>":break;case"<family":o.val&&(u.family=parseInt(o.val,10));break;case"<family/>":case"</family>":break;case"<scheme":o.val&&(u.scheme=o.val);break;case"<scheme/>":case"</scheme>":break;case"<charset":if(o.val=="1")break;o.codepage=q0[parseInt(o.val,10)];break;case"<color":if(u.color||(u.color={}),o.auto&&(u.color.auto=aa(o.auto)),o.rgb)u.color.rgb=o.rgb.slice(-6);else if(o.indexed){u.color.index=parseInt(o.indexed,10);var E=xo[u.color.index];u.color.index==81&&(E=xo[1]),E||(E=xo[1]),u.color.rgb=E[0].toString(16)+E[1].toString(16)+E[2].toString(16)}else o.theme&&(u.color.theme=parseInt(o.theme,10),o.tint&&(u.color.tint=parseFloat(o.tint)),o.theme&&a.themeElements&&a.themeElements.clrScheme&&(u.color.rgb=Vh(a.themeElements.clrScheme[u.color.theme].rgb,u.color.tint||0)));break;case"<color/>":case"</color>":break;case"<AlternateContent":m=!0;break;case"</AlternateContent>":m=!1;break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":m=!0;break;case"</ext>":m=!1;break;default:if(c&&c.WTF&&!m)throw new Error("unrecognized "+o[0]+" in fonts")}})}function Mk(e,n,a){n.NumberFmt=[];for(var c=Nn(fr),u=0;u<c.length;++u)n.NumberFmt[c[u]]=fr[c[u]];var m=e[0].match(fi);if(m)for(u=0;u<m.length;++u){var x=ar(m[u]);switch(Un(x[0])){case"<numFmts":case"</numFmts>":case"<numFmts/>":case"<numFmts>":break;case"<numFmt":{var o=Er(Zr(x.formatCode)),E=parseInt(x.numFmtId,10);if(n.NumberFmt[E]=o,E>0){if(E>392){for(E=392;E>60&&n.NumberFmt[E]!=null;--E);n.NumberFmt[E]=o}go(o,E)}}break;case"</numFmt>":break;default:if(a.WTF)throw new Error("unrecognized "+x[0]+" in numFmts")}}}var kh=["numFmtId","fillId","fontId","borderId","xfId"],Ch=["applyAlignment","applyBorder","applyFill","applyFont","applyNumberFormat","applyProtection","pivotButton","quotePrefix"];function Dk(e,n,a){n.CellXf=[];var c,u=!1;(e[0].match(fi)||[]).forEach(function(m){var x=ar(m),o=0;switch(Un(x[0])){case"<cellXfs":case"<cellXfs>":case"<cellXfs/>":case"</cellXfs>":break;case"<xf":case"<xf/>":for(c=x,delete c[0],o=0;o<kh.length;++o)c[kh[o]]&&(c[kh[o]]=parseInt(c[kh[o]],10));for(o=0;o<Ch.length;++o)c[Ch[o]]&&(c[Ch[o]]=aa(c[Ch[o]]));if(n.NumberFmt&&c.numFmtId>392){for(o=392;o>60;--o)if(n.NumberFmt[c.numFmtId]==n.NumberFmt[o]){c.numFmtId=o;break}}n.CellXf.push(c);break;case"</xf>":break;case"<alignment":case"<alignment/>":var E={};x.vertical&&(E.vertical=x.vertical),x.horizontal&&(E.horizontal=x.horizontal),x.textRotation!=null&&(E.textRotation=x.textRotation),x.indent&&(E.indent=x.indent),x.wrapText&&(E.wrapText=aa(x.wrapText)),c.alignment=E;break;case"</alignment>":break;case"<protection":break;case"</protection>":case"<protection/>":break;case"<AlternateContent":u=!0;break;case"</AlternateContent>":u=!1;break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":u=!0;break;case"</ext>":u=!1;break;default:if(a&&a.WTF&&!u)throw new Error("unrecognized "+x[0]+" in cellXfs")}})}var Lk=function(){var n=/<(?:\w+:)?numFmts([^>]*)>[\S\s]*?<\/(?:\w+:)?numFmts>/,a=/<(?:\w+:)?cellXfs([^>]*)>[\S\s]*?<\/(?:\w+:)?cellXfs>/,c=/<(?:\w+:)?fills([^>]*)>[\S\s]*?<\/(?:\w+:)?fills>/,u=/<(?:\w+:)?fonts([^>]*)>[\S\s]*?<\/(?:\w+:)?fonts>/,m=/<(?:\w+:)?borders([^>]*)>[\S\s]*?<\/(?:\w+:)?borders>/;return function(o,E,w){var C={};if(!o)return C;o=o.replace(/<!--([\s\S]*?)-->/mg,"").replace(/<!DOCTYPE[^\[]*\[[^\]]*\]>/gm,"");var P;return(P=o.match(n))&&Mk(P,C,w),(P=o.match(u))&&Pk(P,C,E,w),(P=o.match(c))&&Fk(P,C,E,w),(P=o.match(m))&&Ik(P,C,E,w),(P=o.match(a))&&Dk(P,C,w),C}}();function Rk(e,n){var a=e.read_shift(2),c=ui(e);return[a,c]}function Ok(e,n,a){var c={};c.sz=e.read_shift(2)/20;var u=qT(e);u.fItalic&&(c.italic=1),u.fCondense&&(c.condense=1),u.fExtend&&(c.extend=1),u.fShadow&&(c.shadow=1),u.fOutline&&(c.outline=1),u.fStrikeout&&(c.strike=1);var m=e.read_shift(2);switch(m===700&&(c.bold=1),e.read_shift(2)){case 1:c.vertAlign="superscript";break;case 2:c.vertAlign="subscript";break}var x=e.read_shift(1);x!=0&&(c.underline=x);var o=e.read_shift(1);o>0&&(c.family=o);var E=e.read_shift(1);switch(E>0&&(c.charset=E),e.l++,c.color=HT(e),e.read_shift(1)){case 1:c.scheme="major";break;case 2:c.scheme="minor";break}return c.name=ui(e),c}var Bk=hi;function zk(e,n){var a=e.l+n,c=e.read_shift(2),u=e.read_shift(2);return e.l=a,{ixfe:c,numFmtId:u}}var Nk=hi;function Uk(e,n,a){var c={};c.NumberFmt=[];for(var u in fr)c.NumberFmt[u]=fr[u];c.CellXf=[],c.Fonts=[];var m=[],x=!1;return cs(e,function(E,w,C){switch(C){case 44:c.NumberFmt[E[0]]=E[1],go(E[1],E[0]);break;case 43:c.Fonts.push(E),E.color.theme!=null&&n&&n.themeElements&&n.themeElements.clrScheme&&(E.color.rgb=Vh(n.themeElements.clrScheme[E.color.theme].rgb,E.color.tint||0));break;case 1025:break;case 45:break;case 46:break;case 47:m[m.length-1]==617&&c.CellXf.push(E);break;case 48:case 507:case 572:case 475:break;case 1171:case 2102:case 1130:case 512:case 2095:case 3072:break;case 35:x=!0;break;case 36:x=!1;break;case 37:m.push(C),x=!0;break;case 38:m.pop(),x=!1;break;default:if(w.T>0)m.push(C);else if(w.T<0)m.pop();else if(!x||a.WTF&&m[m.length-1]!=37)throw new Error("Unexpected record 0x"+C.toString(16))}}),c}var Vk=["</a:lt1>","</a:dk1>","</a:lt2>","</a:dk2>","</a:accent1>","</a:accent2>","</a:accent3>","</a:accent4>","</a:accent5>","</a:accent6>","</a:hlink>","</a:folHlink>"];function $k(e,n,a){n.themeElements.clrScheme=[];var c={};(e[0].match(fi)||[]).forEach(function(u){var m=ar(u);switch(m[0]){case"<a:clrScheme":case"</a:clrScheme>":break;case"<a:srgbClr":c.rgb=m.val;break;case"<a:sysClr":c.rgb=m.lastClr;break;case"<a:dk1>":case"</a:dk1>":case"<a:lt1>":case"</a:lt1>":case"<a:dk2>":case"</a:dk2>":case"<a:lt2>":case"</a:lt2>":case"<a:accent1>":case"</a:accent1>":case"<a:accent2>":case"</a:accent2>":case"<a:accent3>":case"</a:accent3>":case"<a:accent4>":case"</a:accent4>":case"<a:accent5>":case"</a:accent5>":case"<a:accent6>":case"</a:accent6>":case"<a:hlink>":case"</a:hlink>":case"<a:folHlink>":case"</a:folHlink>":m[0].charAt(1)==="/"?(n.themeElements.clrScheme[Vk.indexOf(m[0])]=c,c={}):c.name=m[0].slice(3,m[0].length-1);break;default:if(a&&a.WTF)throw new Error("Unrecognized "+m[0]+" in clrScheme")}})}function jk(){}function Gk(){}var Hk=/<a:clrScheme([^>]*)>[\s\S]*<\/a:clrScheme>/,qk=/<a:fontScheme([^>]*)>[\s\S]*<\/a:fontScheme>/,Wk=/<a:fmtScheme([^>]*)>[\s\S]*<\/a:fmtScheme>/;function Zk(e,n,a){n.themeElements={};var c;[["clrScheme",Hk,$k],["fontScheme",qk,jk],["fmtScheme",Wk,Gk]].forEach(function(u){if(!(c=e.match(u[1])))throw new Error(u[0]+" not found in themeElements");u[2](c,n,a)})}var Xk=/<a:themeElements([^>]*)>[\s\S]*<\/a:themeElements>/;function px(e,n){(!e||e.length===0)&&(e=Kk());var a,c={};if(!(a=e.match(Xk)))throw new Error("themeElements not found in theme");return Zk(a[0],c,n),c.raw=e,c}function Kk(e,n){if(n&&n.themeXLSX)return n.themeXLSX;if(e&&typeof e.raw=="string")return e.raw;var a=[S1];return a[a.length]='<a:theme xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" name="Office Theme">',a[a.length]="<a:themeElements>",a[a.length]='<a:clrScheme name="Office">',a[a.length]='<a:dk1><a:sysClr val="windowText" lastClr="000000"/></a:dk1>',a[a.length]='<a:lt1><a:sysClr val="window" lastClr="FFFFFF"/></a:lt1>',a[a.length]='<a:dk2><a:srgbClr val="1F497D"/></a:dk2>',a[a.length]='<a:lt2><a:srgbClr val="EEECE1"/></a:lt2>',a[a.length]='<a:accent1><a:srgbClr val="4F81BD"/></a:accent1>',a[a.length]='<a:accent2><a:srgbClr val="C0504D"/></a:accent2>',a[a.length]='<a:accent3><a:srgbClr val="9BBB59"/></a:accent3>',a[a.length]='<a:accent4><a:srgbClr val="8064A2"/></a:accent4>',a[a.length]='<a:accent5><a:srgbClr val="4BACC6"/></a:accent5>',a[a.length]='<a:accent6><a:srgbClr val="F79646"/></a:accent6>',a[a.length]='<a:hlink><a:srgbClr val="0000FF"/></a:hlink>',a[a.length]='<a:folHlink><a:srgbClr val="800080"/></a:folHlink>',a[a.length]="</a:clrScheme>",a[a.length]='<a:fontScheme name="Office">',a[a.length]="<a:majorFont>",a[a.length]='<a:latin typeface="Cambria"/>',a[a.length]='<a:ea typeface=""/>',a[a.length]='<a:cs typeface=""/>',a[a.length]='<a:font script="Jpan" typeface="ＭＳ Ｐゴシック"/>',a[a.length]='<a:font script="Hang" typeface="맑은 고딕"/>',a[a.length]='<a:font script="Hans" typeface="宋体"/>',a[a.length]='<a:font script="Hant" typeface="新細明體"/>',a[a.length]='<a:font script="Arab" typeface="Times New Roman"/>',a[a.length]='<a:font script="Hebr" typeface="Times New Roman"/>',a[a.length]='<a:font script="Thai" typeface="Tahoma"/>',a[a.length]='<a:font script="Ethi" typeface="Nyala"/>',a[a.length]='<a:font script="Beng" typeface="Vrinda"/>',a[a.length]='<a:font script="Gujr" typeface="Shruti"/>',a[a.length]='<a:font script="Khmr" typeface="MoolBoran"/>',a[a.length]='<a:font script="Knda" typeface="Tunga"/>',a[a.length]='<a:font script="Guru" typeface="Raavi"/>',a[a.length]='<a:font script="Cans" typeface="Euphemia"/>',a[a.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',a[a.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',a[a.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',a[a.length]='<a:font script="Thaa" typeface="MV Boli"/>',a[a.length]='<a:font script="Deva" typeface="Mangal"/>',a[a.length]='<a:font script="Telu" typeface="Gautami"/>',a[a.length]='<a:font script="Taml" typeface="Latha"/>',a[a.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',a[a.length]='<a:font script="Orya" typeface="Kalinga"/>',a[a.length]='<a:font script="Mlym" typeface="Kartika"/>',a[a.length]='<a:font script="Laoo" typeface="DokChampa"/>',a[a.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',a[a.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',a[a.length]='<a:font script="Viet" typeface="Times New Roman"/>',a[a.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',a[a.length]='<a:font script="Geor" typeface="Sylfaen"/>',a[a.length]="</a:majorFont>",a[a.length]="<a:minorFont>",a[a.length]='<a:latin typeface="Calibri"/>',a[a.length]='<a:ea typeface=""/>',a[a.length]='<a:cs typeface=""/>',a[a.length]='<a:font script="Jpan" typeface="ＭＳ Ｐゴシック"/>',a[a.length]='<a:font script="Hang" typeface="맑은 고딕"/>',a[a.length]='<a:font script="Hans" typeface="宋体"/>',a[a.length]='<a:font script="Hant" typeface="新細明體"/>',a[a.length]='<a:font script="Arab" typeface="Arial"/>',a[a.length]='<a:font script="Hebr" typeface="Arial"/>',a[a.length]='<a:font script="Thai" typeface="Tahoma"/>',a[a.length]='<a:font script="Ethi" typeface="Nyala"/>',a[a.length]='<a:font script="Beng" typeface="Vrinda"/>',a[a.length]='<a:font script="Gujr" typeface="Shruti"/>',a[a.length]='<a:font script="Khmr" typeface="DaunPenh"/>',a[a.length]='<a:font script="Knda" typeface="Tunga"/>',a[a.length]='<a:font script="Guru" typeface="Raavi"/>',a[a.length]='<a:font script="Cans" typeface="Euphemia"/>',a[a.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',a[a.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',a[a.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',a[a.length]='<a:font script="Thaa" typeface="MV Boli"/>',a[a.length]='<a:font script="Deva" typeface="Mangal"/>',a[a.length]='<a:font script="Telu" typeface="Gautami"/>',a[a.length]='<a:font script="Taml" typeface="Latha"/>',a[a.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',a[a.length]='<a:font script="Orya" typeface="Kalinga"/>',a[a.length]='<a:font script="Mlym" typeface="Kartika"/>',a[a.length]='<a:font script="Laoo" typeface="DokChampa"/>',a[a.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',a[a.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',a[a.length]='<a:font script="Viet" typeface="Arial"/>',a[a.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',a[a.length]='<a:font script="Geor" typeface="Sylfaen"/>',a[a.length]="</a:minorFont>",a[a.length]="</a:fontScheme>",a[a.length]='<a:fmtScheme name="Office">',a[a.length]="<a:fillStyleLst>",a[a.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',a[a.length]='<a:gradFill rotWithShape="1">',a[a.length]="<a:gsLst>",a[a.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="50000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',a[a.length]='<a:gs pos="35000"><a:schemeClr val="phClr"><a:tint val="37000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',a[a.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="15000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',a[a.length]="</a:gsLst>",a[a.length]='<a:lin ang="16200000" scaled="1"/>',a[a.length]="</a:gradFill>",a[a.length]='<a:gradFill rotWithShape="1">',a[a.length]="<a:gsLst>",a[a.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="100000"/><a:shade val="100000"/><a:satMod val="130000"/></a:schemeClr></a:gs>',a[a.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="50000"/><a:shade val="100000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',a[a.length]="</a:gsLst>",a[a.length]='<a:lin ang="16200000" scaled="0"/>',a[a.length]="</a:gradFill>",a[a.length]="</a:fillStyleLst>",a[a.length]="<a:lnStyleLst>",a[a.length]='<a:ln w="9525" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"><a:shade val="95000"/><a:satMod val="105000"/></a:schemeClr></a:solidFill><a:prstDash val="solid"/></a:ln>',a[a.length]='<a:ln w="25400" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',a[a.length]='<a:ln w="38100" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',a[a.length]="</a:lnStyleLst>",a[a.length]="<a:effectStyleLst>",a[a.length]="<a:effectStyle>",a[a.length]="<a:effectLst>",a[a.length]='<a:outerShdw blurRad="40000" dist="20000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="38000"/></a:srgbClr></a:outerShdw>',a[a.length]="</a:effectLst>",a[a.length]="</a:effectStyle>",a[a.length]="<a:effectStyle>",a[a.length]="<a:effectLst>",a[a.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',a[a.length]="</a:effectLst>",a[a.length]="</a:effectStyle>",a[a.length]="<a:effectStyle>",a[a.length]="<a:effectLst>",a[a.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',a[a.length]="</a:effectLst>",a[a.length]='<a:scene3d><a:camera prst="orthographicFront"><a:rot lat="0" lon="0" rev="0"/></a:camera><a:lightRig rig="threePt" dir="t"><a:rot lat="0" lon="0" rev="1200000"/></a:lightRig></a:scene3d>',a[a.length]='<a:sp3d><a:bevelT w="63500" h="25400"/></a:sp3d>',a[a.length]="</a:effectStyle>",a[a.length]="</a:effectStyleLst>",a[a.length]="<a:bgFillStyleLst>",a[a.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',a[a.length]='<a:gradFill rotWithShape="1">',a[a.length]="<a:gsLst>",a[a.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="40000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',a[a.length]='<a:gs pos="40000"><a:schemeClr val="phClr"><a:tint val="45000"/><a:shade val="99000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',a[a.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="20000"/><a:satMod val="255000"/></a:schemeClr></a:gs>',a[a.length]="</a:gsLst>",a[a.length]='<a:path path="circle"><a:fillToRect l="50000" t="-80000" r="50000" b="180000"/></a:path>',a[a.length]="</a:gradFill>",a[a.length]='<a:gradFill rotWithShape="1">',a[a.length]="<a:gsLst>",a[a.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="80000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',a[a.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="30000"/><a:satMod val="200000"/></a:schemeClr></a:gs>',a[a.length]="</a:gsLst>",a[a.length]='<a:path path="circle"><a:fillToRect l="50000" t="50000" r="50000" b="50000"/></a:path>',a[a.length]="</a:gradFill>",a[a.length]="</a:bgFillStyleLst>",a[a.length]="</a:fmtScheme>",a[a.length]="</a:themeElements>",a[a.length]="<a:objectDefaults>",a[a.length]="<a:spDef>",a[a.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="1"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="3"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="2"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="lt1"/></a:fontRef></a:style>',a[a.length]="</a:spDef>",a[a.length]="<a:lnDef>",a[a.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="2"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="0"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="1"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="tx1"/></a:fontRef></a:style>',a[a.length]="</a:lnDef>",a[a.length]="</a:objectDefaults>",a[a.length]="<a:extraClrSchemeLst/>",a[a.length]="</a:theme>",a.join("")}function Yk(e,n,a){var c=e.l+n,u=e.read_shift(4);if(u!==124226){if(!a.cellStyles){e.l=c;return}var m=e.slice(e.l);e.l=c;var x;try{x=E1(m,{type:"array"})}catch{return}var o=ji(x,"theme/theme/theme1.xml",!0);if(o)return px(o,a)}}function Jk(e){return e.read_shift(4)}function Qk(e){var n={};switch(n.xclrType=e.read_shift(2),n.nTintShade=e.read_shift(2),n.xclrType){case 0:e.l+=4;break;case 1:n.xclrValue=eC(e,4);break;case 2:n.xclrValue=ex(e);break;case 3:n.xclrValue=Jk(e);break;case 4:e.l+=4;break}return e.l+=8,n}function eC(e,n){return hi(e,n)}function tC(e,n){return hi(e,n)}function rC(e){var n=e.read_shift(2),a=e.read_shift(2)-4,c=[n];switch(n){case 4:case 5:case 7:case 8:case 9:case 10:case 11:case 13:c[1]=Qk(e);break;case 6:c[1]=tC(e,a);break;case 14:case 15:c[1]=e.read_shift(a===1?1:2);break;default:throw new Error("Unrecognized ExtProp type: "+n+" "+a)}return c}function aC(e,n){var a=e.l+n;e.l+=2;var c=e.read_shift(2);e.l+=2;for(var u=e.read_shift(2),m=[];u-- >0;)m.push(rC(e,a-e.l));return{ixfe:c,ext:m}}function iC(e,n){n.forEach(function(a){switch(a[0]){}})}function nC(e,n){return{flags:e.read_shift(4),version:e.read_shift(4),name:ui(e)}}function sC(e){for(var n=[],a=e.read_shift(4);a-- >0;)n.push([e.read_shift(4),e.read_shift(4)]);return n}function oC(e){return e.l+=4,e.read_shift(4)!=0}function lC(e,n,a){var c={Types:[],Cell:[],Value:[]},u=a||{},m=[],x=!1,o=2;return cs(e,function(E,w,C){switch(C){case 335:c.Types.push({name:E.name});break;case 51:E.forEach(function(P){o==1?c.Cell.push({type:c.Types[P[0]-1].name,index:P[1]}):o==0&&c.Value.push({type:c.Types[P[0]-1].name,index:P[1]})});break;case 337:o=E?1:0;break;case 338:o=2;break;case 35:m.push(C),x=!0;break;case 36:m.pop(),x=!1;break;default:if(!w.T){if(!x||u.WTF&&m[m.length-1]!=35)throw new Error("Unexpected record 0x"+C.toString(16))}}}),c}function cC(e,n,a){var c={Types:[],Cell:[],Value:[]};if(!e)return c;var u=!1,m=2,x;return e.replace(fi,function(o){var E=ar(o);switch(Un(E[0])){case"<?xml":break;case"<metadata":case"</metadata>":break;case"<metadataTypes":case"</metadataTypes>":break;case"<metadataType":c.Types.push({name:E.name});break;case"</metadataType>":break;case"<futureMetadata":for(var w=0;w<c.Types.length;++w)c.Types[w].name==E.name&&(x=c.Types[w]);break;case"</futureMetadata>":break;case"<bk>":break;case"</bk>":break;case"<rc":m==1?c.Cell.push({type:c.Types[E.t-1].name,index:+E.v}):m==0&&c.Value.push({type:c.Types[E.t-1].name,index:+E.v});break;case"</rc>":break;case"<cellMetadata":m=1;break;case"</cellMetadata>":m=2;break;case"<valueMetadata":m=0;break;case"</valueMetadata>":m=2;break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":u=!0;break;case"</ext>":u=!1;break;case"<rvb":if(!x)break;x.offsets||(x.offsets=[]),x.offsets.push(+E.i);break;default:if(!u&&a.WTF)throw new Error("unrecognized "+E[0]+" in metadata")}return o}),c}function uC(e){var n=[];if(!e)return n;var a=1;return(e.match(fi)||[]).forEach(function(c){var u=ar(c);switch(u[0]){case"<?xml":break;case"<calcChain":case"<calcChain>":case"</calcChain>":break;case"<c":delete u[0],u.i?a=u.i:u.i=a,n.push(u);break}}),n}function hC(e){var n={};n.i=e.read_shift(4);var a={};a.r=e.read_shift(4),a.c=e.read_shift(4),n.r=or(a);var c=e.read_shift(1);return c&2&&(n.l="1"),c&8&&(n.a="1"),n}function fC(e,n,a){var c=[];return cs(e,function(m,x,o){switch(o){case 63:c.push(m);break;default:if(!x.T)throw new Error("Unexpected record 0x"+o.toString(16))}}),c}function dC(e,n,a,c){if(!e)return e;var u=c||{},m=!1;cs(e,function(o,E,w){switch(w){case 359:case 363:case 364:case 366:case 367:case 368:case 369:case 370:case 371:case 472:case 577:case 578:case 579:case 580:case 581:case 582:case 583:case 584:case 585:case 586:case 587:break;case 35:m=!0;break;case 36:m=!1;break;default:if(!E.T){if(!m||u.WTF)throw new Error("Unexpected record 0x"+w.toString(16))}}},u)}function pC(e,n){if(!e)return"??";var a=(e.match(/<c:chart [^>]*r:id="([^"]*)"/)||["",""])[1];return n["!id"][a].Target}function dg(e,n,a,c){var u=Array.isArray(e),m;n.forEach(function(x){var o=Si(x.ref);if(u?(e[o.r]||(e[o.r]=[]),m=e[o.r][o.c]):m=e[x.ref],!m){m={t:"z"},u?e[o.r][o.c]=m:e[x.ref]=m;var E=da(e["!ref"]||"BDWGO1000001:A1");E.s.r>o.r&&(E.s.r=o.r),E.e.r<o.r&&(E.e.r=o.r),E.s.c>o.c&&(E.s.c=o.c),E.e.c<o.c&&(E.e.c=o.c);var w=Tr(E);w!==e["!ref"]&&(e["!ref"]=w)}m.c||(m.c=[]);var C={a:x.author,t:x.t,r:x.r,T:a};x.h&&(C.h=x.h);for(var P=m.c.length-1;P>=0;--P){if(!a&&m.c[P].T)return;a&&!m.c[P].T&&m.c.splice(P,1)}if(a&&c){for(P=0;P<c.length;++P)if(C.a==c[P].id){C.a=c[P].name||C.a;break}}m.c.push(C)})}function mC(e,n){if(e.match(/<(?:\w+:)?comments *\/>/))return[];var a=[],c=[],u=e.match(/<(?:\w+:)?authors>([\s\S]*)<\/(?:\w+:)?authors>/);u&&u[1]&&u[1].split(/<\/\w*:?author>/).forEach(function(x){if(!(x===""||x.trim()==="")){var o=x.match(/<(?:\w+:)?author[^>]*>(.*)/);o&&a.push(o[1])}});var m=e.match(/<(?:\w+:)?commentList>([\s\S]*)<\/(?:\w+:)?commentList>/);return m&&m[1]&&m[1].split(/<\/\w*:?comment>/).forEach(function(x){if(!(x===""||x.trim()==="")){var o=x.match(/<(?:\w+:)?comment[^>]*>/);if(o){var E=ar(o[0]),w={author:E.authorId&&a[E.authorId]||"sheetjsghost",ref:E.ref,guid:E.guid},C=Si(E.ref);if(!(n.sheetRows&&n.sheetRows<=C.r)){var P=x.match(/<(?:\w+:)?text>([\s\S]*)<\/(?:\w+:)?text>/),M=!!P&&!!P[1]&&cd(P[1])||{r:"",t:"",h:""};w.r=M.r,M.r=="<t></t>"&&(M.t=M.h=""),w.t=(M.t||"").replace(/\r\n/g,`
`).replace(/\r/g,`
`),n.cellHTML&&(w.h=M.h),c.push(w)}}}}),c}function gC(e,n){var a=[],c=!1,u={},m=0;return e.replace(fi,function(o,E){var w=ar(o);switch(Un(w[0])){case"<?xml":break;case"<ThreadedComments":break;case"</ThreadedComments>":break;case"<threadedComment":u={author:w.personId,guid:w.id,ref:w.ref,T:1};break;case"</threadedComment>":u.t!=null&&a.push(u);break;case"<text>":case"<text":m=E+o.length;break;case"</text>":u.t=e.slice(m,E).replace(/\r\n/g,`
`).replace(/\r/g,`
`);break;case"<mentions":case"<mentions>":c=!0;break;case"</mentions>":c=!1;break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":c=!0;break;case"</ext>":c=!1;break;default:if(!c&&n.WTF)throw new Error("unrecognized "+w[0]+" in threaded comments")}return o}),a}function xC(e,n){var a=[],c=!1;return e.replace(fi,function(m){var x=ar(m);switch(Un(x[0])){case"<?xml":break;case"<personList":break;case"</personList>":break;case"<person":a.push({name:x.displayname,id:x.id});break;case"</person>":break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":c=!0;break;case"</ext>":c=!1;break;default:if(!c&&n.WTF)throw new Error("unrecognized "+x[0]+" in threaded comments")}return m}),a}function _C(e){var n={};n.iauthor=e.read_shift(4);var a=So(e);return n.rfx=a.s,n.ref=or(a.s),e.l+=16,n}var yC=ui;function vC(e,n){var a=[],c=[],u={},m=!1;return cs(e,function(o,E,w){switch(w){case 632:c.push(o);break;case 635:u=o;break;case 637:u.t=o.t,u.h=o.h,u.r=o.r;break;case 636:if(u.author=c[u.iauthor],delete u.iauthor,n.sheetRows&&u.rfx&&n.sheetRows<=u.rfx.r)break;u.t||(u.t=""),delete u.rfx,a.push(u);break;case 3072:break;case 35:m=!0;break;case 36:m=!1;break;case 37:break;case 38:break;default:if(!E.T){if(!m||n.WTF)throw new Error("Unexpected record 0x"+w.toString(16))}}}),a}var wC="application/vnd.ms-office.vbaProject";function bC(e){var n=br.utils.cfb_new({root:"R"});return e.FullPaths.forEach(function(a,c){if(!(a.slice(-1)==="/"||!a.match(/_VBA_PROJECT_CUR/))){var u=a.replace(/^[^\/]*/,"R").replace(/\/_VBA_PROJECT_CUR\u0000*/,"");br.utils.cfb_add(n,u,e.FileIndex[c].content)}}),br.write(n)}function TC(){return{"!type":"dialog"}}function EC(){return{"!type":"dialog"}}function SC(){return{"!type":"macro"}}function kC(){return{"!type":"macro"}}var gl=function(){var e=/(^|[^A-Za-z_])R(\[?-?\d+\]|[1-9]\d*|)C(\[?-?\d+\]|[1-9]\d*|)(?![A-Za-z0-9_])/g,n={r:0,c:0};function a(c,u,m,x){var o=!1,E=!1;m.length==0?E=!0:m.charAt(0)=="["&&(E=!0,m=m.slice(1,-1)),x.length==0?o=!0:x.charAt(0)=="["&&(o=!0,x=x.slice(1,-1));var w=m.length>0?parseInt(m,10)|0:0,C=x.length>0?parseInt(x,10)|0:0;return o?C+=n.c:--C,E?w+=n.r:--w,u+(o?"":"$")+Da(C)+(E?"":"$")+Ka(w)}return function(u,m){return n=m,u.replace(e,a)}}(),mx=/(^|[^._A-Z0-9])([$]?)([A-Z]{1,2}|[A-W][A-Z]{2}|X[A-E][A-Z]|XF[A-D])([$]?)(10[0-3]\d{4}|104[0-7]\d{3}|1048[0-4]\d{2}|10485[0-6]\d|104857[0-6]|[1-9]\d{0,5})(?![_.\(A-Za-z0-9])/g,CC=function(){return function(n,a){return n.replace(mx,function(c,u,m,x,o,E){var w=ad(x)-(m?0:a.c),C=rd(E)-(o?0:a.r),P=C==0?"":o?C+1:"["+C+"]",M=w==0?"":m?w+1:"["+w+"]";return u+"R"+P+"C"+M})}}();function gx(e,n){return e.replace(mx,function(a,c,u,m,x,o){return c+(u=="$"?u+m:Da(ad(m)+n.c))+(x=="$"?x+o:Ka(rd(o)+n.r))})}function AC(e,n,a){var c=Sl(n),u=c.s,m=Si(a),x={r:m.r-u.r,c:m.c-u.c};return gx(e,x)}function IC(e){return e.length!=1}function pg(e){return e.replace(/_xlfn\./g,"")}function Ea(e){e.l+=1}function Ns(e,n){var a=e.read_shift(n==1?1:2);return[a&16383,a>>14&1,a>>15&1]}function xx(e,n,a){var c=2;if(a){if(a.biff>=2&&a.biff<=5)return _x(e);a.biff==12&&(c=4)}var u=e.read_shift(c),m=e.read_shift(c),x=Ns(e,2),o=Ns(e,2);return{s:{r:u,c:x[0],cRel:x[1],rRel:x[2]},e:{r:m,c:o[0],cRel:o[1],rRel:o[2]}}}function _x(e){var n=Ns(e,2),a=Ns(e,2),c=e.read_shift(1),u=e.read_shift(1);return{s:{r:n[0],c,cRel:n[1],rRel:n[2]},e:{r:a[0],c:u,cRel:a[1],rRel:a[2]}}}function FC(e,n,a){if(a.biff<8)return _x(e);var c=e.read_shift(a.biff==12?4:2),u=e.read_shift(a.biff==12?4:2),m=Ns(e,2),x=Ns(e,2);return{s:{r:c,c:m[0],cRel:m[1],rRel:m[2]},e:{r:u,c:x[0],cRel:x[1],rRel:x[2]}}}function yx(e,n,a){if(a&&a.biff>=2&&a.biff<=5)return PC(e);var c=e.read_shift(a&&a.biff==12?4:2),u=Ns(e,2);return{r:c,c:u[0],cRel:u[1],rRel:u[2]}}function PC(e){var n=Ns(e,2),a=e.read_shift(1);return{r:n[0],c:a,cRel:n[1],rRel:n[2]}}function MC(e){var n=e.read_shift(2),a=e.read_shift(2);return{r:n,c:a&255,fQuoted:!!(a&16384),cRel:a>>15,rRel:a>>15}}function DC(e,n,a){var c=a&&a.biff?a.biff:8;if(c>=2&&c<=5)return LC(e);var u=e.read_shift(c>=12?4:2),m=e.read_shift(2),x=(m&16384)>>14,o=(m&32768)>>15;if(m&=16383,o==1)for(;u>524287;)u-=1048576;if(x==1)for(;m>8191;)m=m-16384;return{r:u,c:m,cRel:x,rRel:o}}function LC(e){var n=e.read_shift(2),a=e.read_shift(1),c=(n&32768)>>15,u=(n&16384)>>14;return n&=16383,c==1&&n>=8192&&(n=n-16384),u==1&&a>=128&&(a=a-256),{r:n,c:a,cRel:u,rRel:c}}function RC(e,n,a){var c=(e[e.l++]&96)>>5,u=xx(e,a.biff>=2&&a.biff<=5?6:8,a);return[c,u]}function OC(e,n,a){var c=(e[e.l++]&96)>>5,u=e.read_shift(2,"i"),m=8;if(a)switch(a.biff){case 5:e.l+=12,m=6;break;case 12:m=12;break}var x=xx(e,m,a);return[c,u,x]}function BC(e,n,a){var c=(e[e.l++]&96)>>5;return e.l+=a&&a.biff>8?12:a.biff<8?6:8,[c]}function zC(e,n,a){var c=(e[e.l++]&96)>>5,u=e.read_shift(2),m=8;if(a)switch(a.biff){case 5:e.l+=12,m=6;break;case 12:m=12;break}return e.l+=m,[c,u]}function NC(e,n,a){var c=(e[e.l++]&96)>>5,u=FC(e,n-1,a);return[c,u]}function UC(e,n,a){var c=(e[e.l++]&96)>>5;return e.l+=a.biff==2?6:a.biff==12?14:7,[c]}function mg(e){var n=e[e.l+1]&1,a=1;return e.l+=4,[n,a]}function VC(e,n,a){e.l+=2;for(var c=e.read_shift(a&&a.biff==2?1:2),u=[],m=0;m<=c;++m)u.push(e.read_shift(a&&a.biff==2?1:2));return u}function $C(e,n,a){var c=e[e.l+1]&255?1:0;return e.l+=2,[c,e.read_shift(a&&a.biff==2?1:2)]}function jC(e,n,a){var c=e[e.l+1]&255?1:0;return e.l+=2,[c,e.read_shift(a&&a.biff==2?1:2)]}function GC(e){var n=e[e.l+1]&255?1:0;return e.l+=2,[n,e.read_shift(2)]}function HC(e,n,a){var c=e[e.l+1]&255?1:0;return e.l+=a&&a.biff==2?3:4,[c]}function vx(e){var n=e.read_shift(1),a=e.read_shift(1);return[n,a]}function qC(e){return e.read_shift(2),vx(e)}function WC(e){return e.read_shift(2),vx(e)}function ZC(e,n,a){var c=(e[e.l]&96)>>5;e.l+=1;var u=yx(e,0,a);return[c,u]}function XC(e,n,a){var c=(e[e.l]&96)>>5;e.l+=1;var u=DC(e,0,a);return[c,u]}function KC(e,n,a){var c=(e[e.l]&96)>>5;e.l+=1;var u=e.read_shift(2);a&&a.biff==5&&(e.l+=12);var m=yx(e,0,a);return[c,u,m]}function YC(e,n,a){var c=(e[e.l]&96)>>5;e.l+=1;var u=e.read_shift(a&&a.biff<=3?1:2);return[J4[u],Tx[u],c]}function JC(e,n,a){var c=e[e.l++],u=e.read_shift(1),m=a&&a.biff<=3?[c==88?-1:0,e.read_shift(1)]:QC(e);return[u,(m[0]===0?Tx:Y4)[m[1]]]}function QC(e){return[e[e.l+1]>>7,e.read_shift(2)&32767]}function e4(e,n,a){e.l+=a&&a.biff==2?3:4}function t4(e,n,a){if(e.l++,a&&a.biff==12)return[e.read_shift(4,"i"),0];var c=e.read_shift(2),u=e.read_shift(a&&a.biff==2?1:2);return[c,u]}function r4(e){return e.l++,ko[e.read_shift(1)]}function a4(e){return e.l++,e.read_shift(2)}function i4(e){return e.l++,e.read_shift(1)!==0}function n4(e){return e.l++,li(e)}function s4(e,n,a){return e.l++,ou(e,n-1,a)}function o4(e,n){var a=[e.read_shift(1)];if(n==12)switch(a[0]){case 2:a[0]=4;break;case 4:a[0]=16;break;case 0:a[0]=1;break;case 1:a[0]=2;break}switch(a[0]){case 4:a[1]=Ta(e,1)?"TRUE":"FALSE",n!=12&&(e.l+=7);break;case 37:case 16:a[1]=ko[e[e.l]],e.l+=n==12?4:8;break;case 0:e.l+=8;break;case 1:a[1]=li(e);break;case 2:a[1]=Co(e,0,{biff:n>0&&n<8?2:n});break;default:throw new Error("Bad SerAr: "+a[0])}return a}function l4(e,n,a){for(var c=e.read_shift(a.biff==12?4:2),u=[],m=0;m!=c;++m)u.push((a.biff==12?So:Xh)(e));return u}function c4(e,n,a){var c=0,u=0;a.biff==12?(c=e.read_shift(4),u=e.read_shift(4)):(u=1+e.read_shift(1),c=1+e.read_shift(2)),a.biff>=2&&a.biff<8&&(--c,--u==0&&(u=256));for(var m=0,x=[];m!=c&&(x[m]=[]);++m)for(var o=0;o!=u;++o)x[m][o]=o4(e,a.biff);return x}function u4(e,n,a){var c=e.read_shift(1)>>>5&3,u=!a||a.biff>=8?4:2,m=e.read_shift(u);switch(a.biff){case 2:e.l+=5;break;case 3:case 4:e.l+=8;break;case 5:e.l+=12;break}return[c,0,m]}function h4(e,n,a){if(a.biff==5)return f4(e);var c=e.read_shift(1)>>>5&3,u=e.read_shift(2),m=e.read_shift(4);return[c,u,m]}function f4(e){var n=e.read_shift(1)>>>5&3,a=e.read_shift(2,"i");e.l+=8;var c=e.read_shift(2);return e.l+=12,[n,a,c]}function d4(e,n,a){var c=e.read_shift(1)>>>5&3;e.l+=a&&a.biff==2?3:4;var u=e.read_shift(a&&a.biff==2?1:2);return[c,u]}function p4(e,n,a){var c=e.read_shift(1)>>>5&3,u=e.read_shift(a&&a.biff==2?1:2);return[c,u]}function m4(e,n,a){var c=e.read_shift(1)>>>5&3;return e.l+=4,a.biff<8&&e.l--,a.biff==12&&(e.l+=2),[c]}function g4(e,n,a){var c=(e[e.l++]&96)>>5,u=e.read_shift(2),m=4;if(a)switch(a.biff){case 5:m=15;break;case 12:m=6;break}return e.l+=m,[c,u]}var x4=hi,_4=hi,y4=hi;function cu(e,n,a){return e.l+=2,[MC(e)]}function hd(e){return e.l+=6,[]}var v4=cu,w4=hd,b4=hd,T4=cu;function wx(e){return e.l+=2,[Ca(e),e.read_shift(2)&1]}var E4=cu,S4=wx,k4=hd,C4=cu,A4=cu,I4=["Data","All","Headers","??","?Data2","??","?DataHeaders","??","Totals","??","??","??","?DataTotals","??","??","??","?Current"];function F4(e){e.l+=2;var n=e.read_shift(2),a=e.read_shift(2),c=e.read_shift(4),u=e.read_shift(2),m=e.read_shift(2),x=I4[a>>2&31];return{ixti:n,coltype:a&3,rt:x,idx:c,c:u,C:m}}function P4(e){return e.l+=2,[e.read_shift(4)]}function M4(e,n,a){return e.l+=5,e.l+=2,e.l+=a.biff==2?1:4,["PTGSHEET"]}function D4(e,n,a){return e.l+=a.biff==2?4:5,["PTGENDSHEET"]}function L4(e){var n=e.read_shift(1)>>>5&3,a=e.read_shift(2);return[n,a]}function R4(e){var n=e.read_shift(1)>>>5&3,a=e.read_shift(2);return[n,a]}function O4(e){return e.l+=4,[0,0]}var gg={1:{n:"PtgExp",f:t4},2:{n:"PtgTbl",f:y4},3:{n:"PtgAdd",f:Ea},4:{n:"PtgSub",f:Ea},5:{n:"PtgMul",f:Ea},6:{n:"PtgDiv",f:Ea},7:{n:"PtgPower",f:Ea},8:{n:"PtgConcat",f:Ea},9:{n:"PtgLt",f:Ea},10:{n:"PtgLe",f:Ea},11:{n:"PtgEq",f:Ea},12:{n:"PtgGe",f:Ea},13:{n:"PtgGt",f:Ea},14:{n:"PtgNe",f:Ea},15:{n:"PtgIsect",f:Ea},16:{n:"PtgUnion",f:Ea},17:{n:"PtgRange",f:Ea},18:{n:"PtgUplus",f:Ea},19:{n:"PtgUminus",f:Ea},20:{n:"PtgPercent",f:Ea},21:{n:"PtgParen",f:Ea},22:{n:"PtgMissArg",f:Ea},23:{n:"PtgStr",f:s4},26:{n:"PtgSheet",f:M4},27:{n:"PtgEndSheet",f:D4},28:{n:"PtgErr",f:r4},29:{n:"PtgBool",f:i4},30:{n:"PtgInt",f:a4},31:{n:"PtgNum",f:n4},32:{n:"PtgArray",f:UC},33:{n:"PtgFunc",f:YC},34:{n:"PtgFuncVar",f:JC},35:{n:"PtgName",f:u4},36:{n:"PtgRef",f:ZC},37:{n:"PtgArea",f:RC},38:{n:"PtgMemArea",f:d4},39:{n:"PtgMemErr",f:x4},40:{n:"PtgMemNoMem",f:_4},41:{n:"PtgMemFunc",f:p4},42:{n:"PtgRefErr",f:m4},43:{n:"PtgAreaErr",f:BC},44:{n:"PtgRefN",f:XC},45:{n:"PtgAreaN",f:NC},46:{n:"PtgMemAreaN",f:L4},47:{n:"PtgMemNoMemN",f:R4},57:{n:"PtgNameX",f:h4},58:{n:"PtgRef3d",f:KC},59:{n:"PtgArea3d",f:OC},60:{n:"PtgRefErr3d",f:g4},61:{n:"PtgAreaErr3d",f:zC},255:{}},B4={64:32,96:32,65:33,97:33,66:34,98:34,67:35,99:35,68:36,100:36,69:37,101:37,70:38,102:38,71:39,103:39,72:40,104:40,73:41,105:41,74:42,106:42,75:43,107:43,76:44,108:44,77:45,109:45,78:46,110:46,79:47,111:47,88:34,120:34,89:57,121:57,90:58,122:58,91:59,123:59,92:60,124:60,93:61,125:61},z4={1:{n:"PtgElfLel",f:wx},2:{n:"PtgElfRw",f:C4},3:{n:"PtgElfCol",f:v4},6:{n:"PtgElfRwV",f:A4},7:{n:"PtgElfColV",f:T4},10:{n:"PtgElfRadical",f:E4},11:{n:"PtgElfRadicalS",f:k4},13:{n:"PtgElfColS",f:w4},15:{n:"PtgElfColSV",f:b4},16:{n:"PtgElfRadicalLel",f:S4},25:{n:"PtgList",f:F4},29:{n:"PtgSxName",f:P4},255:{}},N4={0:{n:"PtgAttrNoop",f:O4},1:{n:"PtgAttrSemi",f:HC},2:{n:"PtgAttrIf",f:jC},4:{n:"PtgAttrChoose",f:VC},8:{n:"PtgAttrGoto",f:$C},16:{n:"PtgAttrSum",f:e4},32:{n:"PtgAttrBaxcel",f:mg},33:{n:"PtgAttrBaxcel",f:mg},64:{n:"PtgAttrSpace",f:qC},65:{n:"PtgAttrSpaceSemi",f:WC},128:{n:"PtgAttrIfError",f:GC},255:{}};function uu(e,n,a,c){if(c.biff<8)return hi(e,n);for(var u=e.l+n,m=[],x=0;x!==a.length;++x)switch(a[x][0]){case"PtgArray":a[x][1]=c4(e,0,c),m.push(a[x][1]);break;case"PtgMemArea":a[x][2]=l4(e,a[x][1],c),m.push(a[x][2]);break;case"PtgExp":c&&c.biff==12&&(a[x][1][1]=e.read_shift(4),m.push(a[x][1]));break;case"PtgList":case"PtgElfRadicalS":case"PtgElfColS":case"PtgElfColSV":throw"Unsupported "+a[x][0]}return n=u-e.l,n!==0&&m.push(hi(e,n)),m}function hu(e,n,a){for(var c=e.l+n,u,m,x=[];c!=e.l;)n=c-e.l,m=e[e.l],u=gg[m]||gg[B4[m]],(m===24||m===25)&&(u=(m===24?z4:N4)[e[e.l+1]]),!u||!u.f?hi(e,n):x.push([u.n,u.f(e,n,a)]);return x}function U4(e){for(var n=[],a=0;a<e.length;++a){for(var c=e[a],u=[],m=0;m<c.length;++m){var x=c[m];if(x)switch(x[0]){case 2:u.push('"'+x[1].replace(/"/g,'""')+'"');break;default:u.push(x[1])}else u.push("")}n.push(u.join(","))}return n.join(";")}var V4={PtgAdd:"+",PtgConcat:"&",PtgDiv:"/",PtgEq:"=",PtgGe:">=",PtgGt:">",PtgLe:"<=",PtgLt:"<",PtgMul:"*",PtgNe:"<>",PtgPower:"^",PtgSub:"-"};function $4(e,n){if(!e&&!(n&&n.biff<=5&&n.biff>=2))throw new Error("empty sheet name");return/[^\w\u4E00-\u9FFF\u3040-\u30FF]/.test(e)?"'"+e+"'":e}function bx(e,n,a){if(!e)return"SH33TJSERR0";if(a.biff>8&&(!e.XTI||!e.XTI[n]))return e.SheetNames[n];if(!e.XTI)return"SH33TJSERR6";var c=e.XTI[n];if(a.biff<8)return n>1e4&&(n-=65536),n<0&&(n=-n),n==0?"":e.XTI[n-1];if(!c)return"SH33TJSERR1";var u="";if(a.biff>8)switch(e[c[0]][0]){case 357:return u=c[1]==-1?"#REF":e.SheetNames[c[1]],c[1]==c[2]?u:u+":"+e.SheetNames[c[2]];case 358:return a.SID!=null?e.SheetNames[a.SID]:"SH33TJSSAME"+e[c[0]][0];case 355:default:return"SH33TJSSRC"+e[c[0]][0]}switch(e[c[0]][0][0]){case 1025:return u=c[1]==-1?"#REF":e.SheetNames[c[1]]||"SH33TJSERR3",c[1]==c[2]?u:u+":"+e.SheetNames[c[2]];case 14849:return e[c[0]].slice(1).map(function(m){return m.Name}).join(";;");default:return e[c[0]][0][3]?(u=c[1]==-1?"#REF":e[c[0]][0][3][c[1]]||"SH33TJSERR4",c[1]==c[2]?u:u+":"+e[c[0]][0][3][c[2]]):"SH33TJSERR2"}}function xg(e,n,a){var c=bx(e,n,a);return c=="#REF"?c:$4(c,a)}function oi(e,n,a,c,u){var m=u&&u.biff||8,x={s:{c:0,r:0},e:{c:0,r:0}},o=[],E,w,C,P=0,M=0,O,U="";if(!e[0]||!e[0][0])return"";for(var z=-1,j="",ee=0,le=e[0].length;ee<le;++ee){var Z=e[0][ee];switch(Z[0]){case"PtgUminus":o.push("-"+o.pop());break;case"PtgUplus":o.push("+"+o.pop());break;case"PtgPercent":o.push(o.pop()+"%");break;case"PtgAdd":case"PtgConcat":case"PtgDiv":case"PtgEq":case"PtgGe":case"PtgGt":case"PtgLe":case"PtgLt":case"PtgMul":case"PtgNe":case"PtgPower":case"PtgSub":if(E=o.pop(),w=o.pop(),z>=0){switch(e[0][z][1][0]){case 0:j=fa(" ",e[0][z][1][1]);break;case 1:j=fa("\r",e[0][z][1][1]);break;default:if(j="",u.WTF)throw new Error("Unexpected PtgAttrSpaceType "+e[0][z][1][0])}w=w+j,z=-1}o.push(w+V4[Z[0]]+E);break;case"PtgIsect":E=o.pop(),w=o.pop(),o.push(w+" "+E);break;case"PtgUnion":E=o.pop(),w=o.pop(),o.push(w+","+E);break;case"PtgRange":E=o.pop(),w=o.pop(),o.push(w+":"+E);break;case"PtgAttrChoose":break;case"PtgAttrGoto":break;case"PtgAttrIf":break;case"PtgAttrIfError":break;case"PtgRef":C=Nc(Z[1][1],x,u),o.push(Uc(C,m));break;case"PtgRefN":C=a?Nc(Z[1][1],a,u):Z[1][1],o.push(Uc(C,m));break;case"PtgRef3d":P=Z[1][1],C=Nc(Z[1][2],x,u),U=xg(c,P,u),o.push(U+"!"+Uc(C,m));break;case"PtgFunc":case"PtgFuncVar":var fe=Z[1][0],me=Z[1][1];fe||(fe=0),fe&=127;var Te=fe==0?[]:o.slice(-fe);o.length-=fe,me==="User"&&(me=Te.shift()),o.push(me+"("+Te.join(",")+")");break;case"PtgBool":o.push(Z[1]?"TRUE":"FALSE");break;case"PtgInt":o.push(Z[1]);break;case"PtgNum":o.push(String(Z[1]));break;case"PtgStr":o.push('"'+Z[1].replace(/"/g,'""')+'"');break;case"PtgErr":o.push(Z[1]);break;case"PtgAreaN":O=Ym(Z[1][1],a?{s:a}:x,u),o.push(p0(O,u));break;case"PtgArea":O=Ym(Z[1][1],x,u),o.push(p0(O,u));break;case"PtgArea3d":P=Z[1][1],O=Z[1][2],U=xg(c,P,u),o.push(U+"!"+p0(O,u));break;case"PtgAttrSum":o.push("SUM("+o.pop()+")");break;case"PtgAttrBaxcel":case"PtgAttrSemi":break;case"PtgName":M=Z[1][2];var re=(c.names||[])[M-1]||(c[0]||[])[M],Ce=re?re.Name:"SH33TJSNAME"+String(M);Ce&&Ce.slice(0,6)=="_xlfn."&&!u.xlfn&&(Ce=Ce.slice(6)),o.push(Ce);break;case"PtgNameX":var be=Z[1][1];M=Z[1][2];var Fe;if(u.biff<=5)be<0&&(be=-be),c[be]&&(Fe=c[be][M]);else{var Oe="";if(((c[be]||[])[0]||[])[0]==14849||(((c[be]||[])[0]||[])[0]==1025?c[be][M]&&c[be][M].itab>0&&(Oe=c.SheetNames[c[be][M].itab-1]+"!"):Oe=c.SheetNames[M-1]+"!"),c[be]&&c[be][M])Oe+=c[be][M].Name;else if(c[0]&&c[0][M])Oe+=c[0][M].Name;else{var Me=(bx(c,be,u)||"").split(";;");Me[M-1]?Oe=Me[M-1]:Oe+="SH33TJSERRX"}o.push(Oe);break}Fe||(Fe={Name:"SH33TJSERRY"}),o.push(Fe.Name);break;case"PtgParen":var rt="(",ft=")";if(z>=0){switch(j="",e[0][z][1][0]){case 2:rt=fa(" ",e[0][z][1][1])+rt;break;case 3:rt=fa("\r",e[0][z][1][1])+rt;break;case 4:ft=fa(" ",e[0][z][1][1])+ft;break;case 5:ft=fa("\r",e[0][z][1][1])+ft;break;default:if(u.WTF)throw new Error("Unexpected PtgAttrSpaceType "+e[0][z][1][0])}z=-1}o.push(rt+o.pop()+ft);break;case"PtgRefErr":o.push("#REF!");break;case"PtgRefErr3d":o.push("#REF!");break;case"PtgExp":C={c:Z[1][1],r:Z[1][0]};var lt={c:a.c,r:a.r};if(c.sharedf[or(C)]){var _t=c.sharedf[or(C)];o.push(oi(_t,x,lt,c,u))}else{var nt=!1;for(E=0;E!=c.arrayf.length;++E)if(w=c.arrayf[E],!(C.c<w[0].s.c||C.c>w[0].e.c)&&!(C.r<w[0].s.r||C.r>w[0].e.r)){o.push(oi(w[1],x,lt,c,u)),nt=!0;break}nt||o.push(Z[1])}break;case"PtgArray":o.push("{"+U4(Z[1])+"}");break;case"PtgMemArea":break;case"PtgAttrSpace":case"PtgAttrSpaceSemi":z=ee;break;case"PtgTbl":break;case"PtgMemErr":break;case"PtgMissArg":o.push("");break;case"PtgAreaErr":o.push("#REF!");break;case"PtgAreaErr3d":o.push("#REF!");break;case"PtgList":o.push("Table"+Z[1].idx+"[#"+Z[1].rt+"]");break;case"PtgMemAreaN":case"PtgMemNoMemN":case"PtgAttrNoop":case"PtgSheet":case"PtgEndSheet":break;case"PtgMemFunc":break;case"PtgMemNoMem":break;case"PtgElfCol":case"PtgElfColS":case"PtgElfColSV":case"PtgElfColV":case"PtgElfLel":case"PtgElfRadical":case"PtgElfRadicalLel":case"PtgElfRadicalS":case"PtgElfRw":case"PtgElfRwV":throw new Error("Unsupported ELFs");case"PtgSxName":throw new Error("Unrecognized Formula Token: "+String(Z));default:throw new Error("Unrecognized Formula Token: "+String(Z))}var Kt=["PtgAttrSpace","PtgAttrSpaceSemi","PtgAttrGoto"];if(u.biff!=3&&z>=0&&Kt.indexOf(e[0][ee][0])==-1){Z=e[0][z];var He=!0;switch(Z[1][0]){case 4:He=!1;case 0:j=fa(" ",Z[1][1]);break;case 5:He=!1;case 1:j=fa("\r",Z[1][1]);break;default:if(j="",u.WTF)throw new Error("Unexpected PtgAttrSpaceType "+Z[1][0])}o.push((He?j:"")+o.pop()+(He?"":j)),z=-1}}if(o.length>1&&u.WTF)throw new Error("bad formula stack");return o[0]}function j4(e,n,a){var c=e.l+n,u=a.biff==2?1:2,m,x=e.read_shift(u);if(x==65535)return[[],hi(e,n-2)];var o=hu(e,x,a);return n!==x+u&&(m=uu(e,n-x-u,o,a)),e.l=c,[o,m]}function G4(e,n,a){var c=e.l+n,u=a.biff==2?1:2,m,x=e.read_shift(u);if(x==65535)return[[],hi(e,n-2)];var o=hu(e,x,a);return n!==x+u&&(m=uu(e,n-x-u,o,a)),e.l=c,[o,m]}function H4(e,n,a,c){var u=e.l+n,m=hu(e,c,a),x;return u!==e.l&&(x=uu(e,u-e.l,m,a)),[m,x]}function q4(e,n,a){var c=e.l+n,u,m=e.read_shift(2),x=hu(e,m,a);return m==65535?[[],hi(e,n-2)]:(n!==m+2&&(u=uu(e,c-m-2,x,a)),[x,u])}function W4(e){var n;if(is(e,e.l+6)!==65535)return[li(e),"n"];switch(e[e.l]){case 0:return e.l+=8,["String","s"];case 1:return n=e[e.l+2]===1,e.l+=8,[n,"b"];case 2:return n=e[e.l+2],e.l+=8,[n,"e"];case 3:return e.l+=8,["","s"]}return[]}function x0(e,n,a){var c=e.l+n,u=Vn(e);a.biff==2&&++e.l;var m=W4(e),x=e.read_shift(1);a.biff!=2&&(e.read_shift(1),a.biff>=5&&e.read_shift(4));var o=G4(e,c-e.l,a);return{cell:u,val:m[0],formula:o,shared:x>>3&1,tt:m[1]}}function Kh(e,n,a){var c=e.read_shift(4),u=hu(e,c,a),m=e.read_shift(4),x=m>0?uu(e,m,u,a):null;return[u,x]}var Z4=Kh,Yh=Kh,X4=Kh,K4=Kh,Y4={0:"BEEP",1:"OPEN",2:"OPEN.LINKS",3:"CLOSE.ALL",4:"SAVE",5:"SAVE.AS",6:"FILE.DELETE",7:"PAGE.SETUP",8:"PRINT",9:"PRINTER.SETUP",10:"QUIT",11:"NEW.WINDOW",12:"ARRANGE.ALL",13:"WINDOW.SIZE",14:"WINDOW.MOVE",15:"FULL",16:"CLOSE",17:"RUN",22:"SET.PRINT.AREA",23:"SET.PRINT.TITLES",24:"SET.PAGE.BREAK",25:"REMOVE.PAGE.BREAK",26:"FONT",27:"DISPLAY",28:"PROTECT.DOCUMENT",29:"PRECISION",30:"A1.R1C1",31:"CALCULATE.NOW",32:"CALCULATION",34:"DATA.FIND",35:"EXTRACT",36:"DATA.DELETE",37:"SET.DATABASE",38:"SET.CRITERIA",39:"SORT",40:"DATA.SERIES",41:"TABLE",42:"FORMAT.NUMBER",43:"ALIGNMENT",44:"STYLE",45:"BORDER",46:"CELL.PROTECTION",47:"COLUMN.WIDTH",48:"UNDO",49:"CUT",50:"COPY",51:"PASTE",52:"CLEAR",53:"PASTE.SPECIAL",54:"EDIT.DELETE",55:"INSERT",56:"FILL.RIGHT",57:"FILL.DOWN",61:"DEFINE.NAME",62:"CREATE.NAMES",63:"FORMULA.GOTO",64:"FORMULA.FIND",65:"SELECT.LAST.CELL",66:"SHOW.ACTIVE.CELL",67:"GALLERY.AREA",68:"GALLERY.BAR",69:"GALLERY.COLUMN",70:"GALLERY.LINE",71:"GALLERY.PIE",72:"GALLERY.SCATTER",73:"COMBINATION",74:"PREFERRED",75:"ADD.OVERLAY",76:"GRIDLINES",77:"SET.PREFERRED",78:"AXES",79:"LEGEND",80:"ATTACH.TEXT",81:"ADD.ARROW",82:"SELECT.CHART",83:"SELECT.PLOT.AREA",84:"PATTERNS",85:"MAIN.CHART",86:"OVERLAY",87:"SCALE",88:"FORMAT.LEGEND",89:"FORMAT.TEXT",90:"EDIT.REPEAT",91:"PARSE",92:"JUSTIFY",93:"HIDE",94:"UNHIDE",95:"WORKSPACE",96:"FORMULA",97:"FORMULA.FILL",98:"FORMULA.ARRAY",99:"DATA.FIND.NEXT",100:"DATA.FIND.PREV",101:"FORMULA.FIND.NEXT",102:"FORMULA.FIND.PREV",103:"ACTIVATE",104:"ACTIVATE.NEXT",105:"ACTIVATE.PREV",106:"UNLOCKED.NEXT",107:"UNLOCKED.PREV",108:"COPY.PICTURE",109:"SELECT",110:"DELETE.NAME",111:"DELETE.FORMAT",112:"VLINE",113:"HLINE",114:"VPAGE",115:"HPAGE",116:"VSCROLL",117:"HSCROLL",118:"ALERT",119:"NEW",120:"CANCEL.COPY",121:"SHOW.CLIPBOARD",122:"MESSAGE",124:"PASTE.LINK",125:"APP.ACTIVATE",126:"DELETE.ARROW",127:"ROW.HEIGHT",128:"FORMAT.MOVE",129:"FORMAT.SIZE",130:"FORMULA.REPLACE",131:"SEND.KEYS",132:"SELECT.SPECIAL",133:"APPLY.NAMES",134:"REPLACE.FONT",135:"FREEZE.PANES",136:"SHOW.INFO",137:"SPLIT",138:"ON.WINDOW",139:"ON.DATA",140:"DISABLE.INPUT",142:"OUTLINE",143:"LIST.NAMES",144:"FILE.CLOSE",145:"SAVE.WORKBOOK",146:"DATA.FORM",147:"COPY.CHART",148:"ON.TIME",149:"WAIT",150:"FORMAT.FONT",151:"FILL.UP",152:"FILL.LEFT",153:"DELETE.OVERLAY",155:"SHORT.MENUS",159:"SET.UPDATE.STATUS",161:"COLOR.PALETTE",162:"DELETE.STYLE",163:"WINDOW.RESTORE",164:"WINDOW.MAXIMIZE",166:"CHANGE.LINK",167:"CALCULATE.DOCUMENT",168:"ON.KEY",169:"APP.RESTORE",170:"APP.MOVE",171:"APP.SIZE",172:"APP.MINIMIZE",173:"APP.MAXIMIZE",174:"BRING.TO.FRONT",175:"SEND.TO.BACK",185:"MAIN.CHART.TYPE",186:"OVERLAY.CHART.TYPE",187:"SELECT.END",188:"OPEN.MAIL",189:"SEND.MAIL",190:"STANDARD.FONT",191:"CONSOLIDATE",192:"SORT.SPECIAL",193:"GALLERY.3D.AREA",194:"GALLERY.3D.COLUMN",195:"GALLERY.3D.LINE",196:"GALLERY.3D.PIE",197:"VIEW.3D",198:"GOAL.SEEK",199:"WORKGROUP",200:"FILL.GROUP",201:"UPDATE.LINK",202:"PROMOTE",203:"DEMOTE",204:"SHOW.DETAIL",206:"UNGROUP",207:"OBJECT.PROPERTIES",208:"SAVE.NEW.OBJECT",209:"SHARE",210:"SHARE.NAME",211:"DUPLICATE",212:"APPLY.STYLE",213:"ASSIGN.TO.OBJECT",214:"OBJECT.PROTECTION",215:"HIDE.OBJECT",216:"SET.EXTRACT",217:"CREATE.PUBLISHER",218:"SUBSCRIBE.TO",219:"ATTRIBUTES",220:"SHOW.TOOLBAR",222:"PRINT.PREVIEW",223:"EDIT.COLOR",224:"SHOW.LEVELS",225:"FORMAT.MAIN",226:"FORMAT.OVERLAY",227:"ON.RECALC",228:"EDIT.SERIES",229:"DEFINE.STYLE",240:"LINE.PRINT",243:"ENTER.DATA",249:"GALLERY.RADAR",250:"MERGE.STYLES",251:"EDITION.OPTIONS",252:"PASTE.PICTURE",253:"PASTE.PICTURE.LINK",254:"SPELLING",256:"ZOOM",259:"INSERT.OBJECT",260:"WINDOW.MINIMIZE",265:"SOUND.NOTE",266:"SOUND.PLAY",267:"FORMAT.SHAPE",268:"EXTEND.POLYGON",269:"FORMAT.AUTO",272:"GALLERY.3D.BAR",273:"GALLERY.3D.SURFACE",274:"FILL.AUTO",276:"CUSTOMIZE.TOOLBAR",277:"ADD.TOOL",278:"EDIT.OBJECT",279:"ON.DOUBLECLICK",280:"ON.ENTRY",281:"WORKBOOK.ADD",282:"WORKBOOK.MOVE",283:"WORKBOOK.COPY",284:"WORKBOOK.OPTIONS",285:"SAVE.WORKSPACE",288:"CHART.WIZARD",289:"DELETE.TOOL",290:"MOVE.TOOL",291:"WORKBOOK.SELECT",292:"WORKBOOK.ACTIVATE",293:"ASSIGN.TO.TOOL",295:"COPY.TOOL",296:"RESET.TOOL",297:"CONSTRAIN.NUMERIC",298:"PASTE.TOOL",302:"WORKBOOK.NEW",305:"SCENARIO.CELLS",306:"SCENARIO.DELETE",307:"SCENARIO.ADD",308:"SCENARIO.EDIT",309:"SCENARIO.SHOW",310:"SCENARIO.SHOW.NEXT",311:"SCENARIO.SUMMARY",312:"PIVOT.TABLE.WIZARD",313:"PIVOT.FIELD.PROPERTIES",314:"PIVOT.FIELD",315:"PIVOT.ITEM",316:"PIVOT.ADD.FIELDS",318:"OPTIONS.CALCULATION",319:"OPTIONS.EDIT",320:"OPTIONS.VIEW",321:"ADDIN.MANAGER",322:"MENU.EDITOR",323:"ATTACH.TOOLBARS",324:"VBAActivate",325:"OPTIONS.CHART",328:"VBA.INSERT.FILE",330:"VBA.PROCEDURE.DEFINITION",336:"ROUTING.SLIP",338:"ROUTE.DOCUMENT",339:"MAIL.LOGON",342:"INSERT.PICTURE",343:"EDIT.TOOL",344:"GALLERY.DOUGHNUT",350:"CHART.TREND",352:"PIVOT.ITEM.PROPERTIES",354:"WORKBOOK.INSERT",355:"OPTIONS.TRANSITION",356:"OPTIONS.GENERAL",370:"FILTER.ADVANCED",373:"MAIL.ADD.MAILER",374:"MAIL.DELETE.MAILER",375:"MAIL.REPLY",376:"MAIL.REPLY.ALL",377:"MAIL.FORWARD",378:"MAIL.NEXT.LETTER",379:"DATA.LABEL",380:"INSERT.TITLE",381:"FONT.PROPERTIES",382:"MACRO.OPTIONS",383:"WORKBOOK.HIDE",384:"WORKBOOK.UNHIDE",385:"WORKBOOK.DELETE",386:"WORKBOOK.NAME",388:"GALLERY.CUSTOM",390:"ADD.CHART.AUTOFORMAT",391:"DELETE.CHART.AUTOFORMAT",392:"CHART.ADD.DATA",393:"AUTO.OUTLINE",394:"TAB.ORDER",395:"SHOW.DIALOG",396:"SELECT.ALL",397:"UNGROUP.SHEETS",398:"SUBTOTAL.CREATE",399:"SUBTOTAL.REMOVE",400:"RENAME.OBJECT",412:"WORKBOOK.SCROLL",413:"WORKBOOK.NEXT",414:"WORKBOOK.PREV",415:"WORKBOOK.TAB.SPLIT",416:"FULL.SCREEN",417:"WORKBOOK.PROTECT",420:"SCROLLBAR.PROPERTIES",421:"PIVOT.SHOW.PAGES",422:"TEXT.TO.COLUMNS",423:"FORMAT.CHARTTYPE",424:"LINK.FORMAT",425:"TRACER.DISPLAY",430:"TRACER.NAVIGATE",431:"TRACER.CLEAR",432:"TRACER.ERROR",433:"PIVOT.FIELD.GROUP",434:"PIVOT.FIELD.UNGROUP",435:"CHECKBOX.PROPERTIES",436:"LABEL.PROPERTIES",437:"LISTBOX.PROPERTIES",438:"EDITBOX.PROPERTIES",439:"PIVOT.REFRESH",440:"LINK.COMBO",441:"OPEN.TEXT",442:"HIDE.DIALOG",443:"SET.DIALOG.FOCUS",444:"ENABLE.OBJECT",445:"PUSHBUTTON.PROPERTIES",446:"SET.DIALOG.DEFAULT",447:"FILTER",448:"FILTER.SHOW.ALL",449:"CLEAR.OUTLINE",450:"FUNCTION.WIZARD",451:"ADD.LIST.ITEM",452:"SET.LIST.ITEM",453:"REMOVE.LIST.ITEM",454:"SELECT.LIST.ITEM",455:"SET.CONTROL.VALUE",456:"SAVE.COPY.AS",458:"OPTIONS.LISTS.ADD",459:"OPTIONS.LISTS.DELETE",460:"SERIES.AXES",461:"SERIES.X",462:"SERIES.Y",463:"ERRORBAR.X",464:"ERRORBAR.Y",465:"FORMAT.CHART",466:"SERIES.ORDER",467:"MAIL.LOGOFF",468:"CLEAR.ROUTING.SLIP",469:"APP.ACTIVATE.MICROSOFT",470:"MAIL.EDIT.MAILER",471:"ON.SHEET",472:"STANDARD.WIDTH",473:"SCENARIO.MERGE",474:"SUMMARY.INFO",475:"FIND.FILE",476:"ACTIVE.CELL.FONT",477:"ENABLE.TIPWIZARD",478:"VBA.MAKE.ADDIN",480:"INSERTDATATABLE",481:"WORKGROUP.OPTIONS",482:"MAIL.SEND.MAILER",485:"AUTOCORRECT",489:"POST.DOCUMENT",491:"PICKLIST",493:"VIEW.SHOW",494:"VIEW.DEFINE",495:"VIEW.DELETE",509:"SHEET.BACKGROUND",510:"INSERT.MAP.OBJECT",511:"OPTIONS.MENONO",517:"MSOCHECKS",518:"NORMAL",519:"LAYOUT",520:"RM.PRINT.AREA",521:"CLEAR.PRINT.AREA",522:"ADD.PRINT.AREA",523:"MOVE.BRK",545:"HIDECURR.NOTE",546:"HIDEALL.NOTES",547:"DELETE.NOTE",548:"TRAVERSE.NOTES",549:"ACTIVATE.NOTES",620:"PROTECT.REVISIONS",621:"UNPROTECT.REVISIONS",647:"OPTIONS.ME",653:"WEB.PUBLISH",667:"NEWWEBQUERY",673:"PIVOT.TABLE.CHART",753:"OPTIONS.SAVE",755:"OPTIONS.SPELL",808:"HIDEALL.INKANNOTS"},Tx={0:"COUNT",1:"IF",2:"ISNA",3:"ISERROR",4:"SUM",5:"AVERAGE",6:"MIN",7:"MAX",8:"ROW",9:"COLUMN",10:"NA",11:"NPV",12:"STDEV",13:"DOLLAR",14:"FIXED",15:"SIN",16:"COS",17:"TAN",18:"ATAN",19:"PI",20:"SQRT",21:"EXP",22:"LN",23:"LOG10",24:"ABS",25:"INT",26:"SIGN",27:"ROUND",28:"LOOKUP",29:"INDEX",30:"REPT",31:"MID",32:"LEN",33:"VALUE",34:"TRUE",35:"FALSE",36:"AND",37:"OR",38:"NOT",39:"MOD",40:"DCOUNT",41:"DSUM",42:"DAVERAGE",43:"DMIN",44:"DMAX",45:"DSTDEV",46:"VAR",47:"DVAR",48:"TEXT",49:"LINEST",50:"TREND",51:"LOGEST",52:"GROWTH",53:"GOTO",54:"HALT",55:"RETURN",56:"PV",57:"FV",58:"NPER",59:"PMT",60:"RATE",61:"MIRR",62:"IRR",63:"RAND",64:"MATCH",65:"DATE",66:"TIME",67:"DAY",68:"MONTH",69:"YEAR",70:"WEEKDAY",71:"HOUR",72:"MINUTE",73:"SECOND",74:"NOW",75:"AREAS",76:"ROWS",77:"COLUMNS",78:"OFFSET",79:"ABSREF",80:"RELREF",81:"ARGUMENT",82:"SEARCH",83:"TRANSPOSE",84:"ERROR",85:"STEP",86:"TYPE",87:"ECHO",88:"SET.NAME",89:"CALLER",90:"DEREF",91:"WINDOWS",92:"SERIES",93:"DOCUMENTS",94:"ACTIVE.CELL",95:"SELECTION",96:"RESULT",97:"ATAN2",98:"ASIN",99:"ACOS",100:"CHOOSE",101:"HLOOKUP",102:"VLOOKUP",103:"LINKS",104:"INPUT",105:"ISREF",106:"GET.FORMULA",107:"GET.NAME",108:"SET.VALUE",109:"LOG",110:"EXEC",111:"CHAR",112:"LOWER",113:"UPPER",114:"PROPER",115:"LEFT",116:"RIGHT",117:"EXACT",118:"TRIM",119:"REPLACE",120:"SUBSTITUTE",121:"CODE",122:"NAMES",123:"DIRECTORY",124:"FIND",125:"CELL",126:"ISERR",127:"ISTEXT",128:"ISNUMBER",129:"ISBLANK",130:"T",131:"N",132:"FOPEN",133:"FCLOSE",134:"FSIZE",135:"FREADLN",136:"FREAD",137:"FWRITELN",138:"FWRITE",139:"FPOS",140:"DATEVALUE",141:"TIMEVALUE",142:"SLN",143:"SYD",144:"DDB",145:"GET.DEF",146:"REFTEXT",147:"TEXTREF",148:"INDIRECT",149:"REGISTER",150:"CALL",151:"ADD.BAR",152:"ADD.MENU",153:"ADD.COMMAND",154:"ENABLE.COMMAND",155:"CHECK.COMMAND",156:"RENAME.COMMAND",157:"SHOW.BAR",158:"DELETE.MENU",159:"DELETE.COMMAND",160:"GET.CHART.ITEM",161:"DIALOG.BOX",162:"CLEAN",163:"MDETERM",164:"MINVERSE",165:"MMULT",166:"FILES",167:"IPMT",168:"PPMT",169:"COUNTA",170:"CANCEL.KEY",171:"FOR",172:"WHILE",173:"BREAK",174:"NEXT",175:"INITIATE",176:"REQUEST",177:"POKE",178:"EXECUTE",179:"TERMINATE",180:"RESTART",181:"HELP",182:"GET.BAR",183:"PRODUCT",184:"FACT",185:"GET.CELL",186:"GET.WORKSPACE",187:"GET.WINDOW",188:"GET.DOCUMENT",189:"DPRODUCT",190:"ISNONTEXT",191:"GET.NOTE",192:"NOTE",193:"STDEVP",194:"VARP",195:"DSTDEVP",196:"DVARP",197:"TRUNC",198:"ISLOGICAL",199:"DCOUNTA",200:"DELETE.BAR",201:"UNREGISTER",204:"USDOLLAR",205:"FINDB",206:"SEARCHB",207:"REPLACEB",208:"LEFTB",209:"RIGHTB",210:"MIDB",211:"LENB",212:"ROUNDUP",213:"ROUNDDOWN",214:"ASC",215:"DBCS",216:"RANK",219:"ADDRESS",220:"DAYS360",221:"TODAY",222:"VDB",223:"ELSE",224:"ELSE.IF",225:"END.IF",226:"FOR.CELL",227:"MEDIAN",228:"SUMPRODUCT",229:"SINH",230:"COSH",231:"TANH",232:"ASINH",233:"ACOSH",234:"ATANH",235:"DGET",236:"CREATE.OBJECT",237:"VOLATILE",238:"LAST.ERROR",239:"CUSTOM.UNDO",240:"CUSTOM.REPEAT",241:"FORMULA.CONVERT",242:"GET.LINK.INFO",243:"TEXT.BOX",244:"INFO",245:"GROUP",246:"GET.OBJECT",247:"DB",248:"PAUSE",251:"RESUME",252:"FREQUENCY",253:"ADD.TOOLBAR",254:"DELETE.TOOLBAR",255:"User",256:"RESET.TOOLBAR",257:"EVALUATE",258:"GET.TOOLBAR",259:"GET.TOOL",260:"SPELLING.CHECK",261:"ERROR.TYPE",262:"APP.TITLE",263:"WINDOW.TITLE",264:"SAVE.TOOLBAR",265:"ENABLE.TOOL",266:"PRESS.TOOL",267:"REGISTER.ID",268:"GET.WORKBOOK",269:"AVEDEV",270:"BETADIST",271:"GAMMALN",272:"BETAINV",273:"BINOMDIST",274:"CHIDIST",275:"CHIINV",276:"COMBIN",277:"CONFIDENCE",278:"CRITBINOM",279:"EVEN",280:"EXPONDIST",281:"FDIST",282:"FINV",283:"FISHER",284:"FISHERINV",285:"FLOOR",286:"GAMMADIST",287:"GAMMAINV",288:"CEILING",289:"HYPGEOMDIST",290:"LOGNORMDIST",291:"LOGINV",292:"NEGBINOMDIST",293:"NORMDIST",294:"NORMSDIST",295:"NORMINV",296:"NORMSINV",297:"STANDARDIZE",298:"ODD",299:"PERMUT",300:"POISSON",301:"TDIST",302:"WEIBULL",303:"SUMXMY2",304:"SUMX2MY2",305:"SUMX2PY2",306:"CHITEST",307:"CORREL",308:"COVAR",309:"FORECAST",310:"FTEST",311:"INTERCEPT",312:"PEARSON",313:"RSQ",314:"STEYX",315:"SLOPE",316:"TTEST",317:"PROB",318:"DEVSQ",319:"GEOMEAN",320:"HARMEAN",321:"SUMSQ",322:"KURT",323:"SKEW",324:"ZTEST",325:"LARGE",326:"SMALL",327:"QUARTILE",328:"PERCENTILE",329:"PERCENTRANK",330:"MODE",331:"TRIMMEAN",332:"TINV",334:"MOVIE.COMMAND",335:"GET.MOVIE",336:"CONCATENATE",337:"POWER",338:"PIVOT.ADD.DATA",339:"GET.PIVOT.TABLE",340:"GET.PIVOT.FIELD",341:"GET.PIVOT.ITEM",342:"RADIANS",343:"DEGREES",344:"SUBTOTAL",345:"SUMIF",346:"COUNTIF",347:"COUNTBLANK",348:"SCENARIO.GET",349:"OPTIONS.LISTS.GET",350:"ISPMT",351:"DATEDIF",352:"DATESTRING",353:"NUMBERSTRING",354:"ROMAN",355:"OPEN.DIALOG",356:"SAVE.DIALOG",357:"VIEW.GET",358:"GETPIVOTDATA",359:"HYPERLINK",360:"PHONETIC",361:"AVERAGEA",362:"MAXA",363:"MINA",364:"STDEVPA",365:"VARPA",366:"STDEVA",367:"VARA",368:"BAHTTEXT",369:"THAIDAYOFWEEK",370:"THAIDIGIT",371:"THAIMONTHOFYEAR",372:"THAINUMSOUND",373:"THAINUMSTRING",374:"THAISTRINGLENGTH",375:"ISTHAIDIGIT",376:"ROUNDBAHTDOWN",377:"ROUNDBAHTUP",378:"THAIYEAR",379:"RTD",380:"CUBEVALUE",381:"CUBEMEMBER",382:"CUBEMEMBERPROPERTY",383:"CUBERANKEDMEMBER",384:"HEX2BIN",385:"HEX2DEC",386:"HEX2OCT",387:"DEC2BIN",388:"DEC2HEX",389:"DEC2OCT",390:"OCT2BIN",391:"OCT2HEX",392:"OCT2DEC",393:"BIN2DEC",394:"BIN2OCT",395:"BIN2HEX",396:"IMSUB",397:"IMDIV",398:"IMPOWER",399:"IMABS",400:"IMSQRT",401:"IMLN",402:"IMLOG2",403:"IMLOG10",404:"IMSIN",405:"IMCOS",406:"IMEXP",407:"IMARGUMENT",408:"IMCONJUGATE",409:"IMAGINARY",410:"IMREAL",411:"COMPLEX",412:"IMSUM",413:"IMPRODUCT",414:"SERIESSUM",415:"FACTDOUBLE",416:"SQRTPI",417:"QUOTIENT",418:"DELTA",419:"GESTEP",420:"ISEVEN",421:"ISODD",422:"MROUND",423:"ERF",424:"ERFC",425:"BESSELJ",426:"BESSELK",427:"BESSELY",428:"BESSELI",429:"XIRR",430:"XNPV",431:"PRICEMAT",432:"YIELDMAT",433:"INTRATE",434:"RECEIVED",435:"DISC",436:"PRICEDISC",437:"YIELDDISC",438:"TBILLEQ",439:"TBILLPRICE",440:"TBILLYIELD",441:"PRICE",442:"YIELD",443:"DOLLARDE",444:"DOLLARFR",445:"NOMINAL",446:"EFFECT",447:"CUMPRINC",448:"CUMIPMT",449:"EDATE",450:"EOMONTH",451:"YEARFRAC",452:"COUPDAYBS",453:"COUPDAYS",454:"COUPDAYSNC",455:"COUPNCD",456:"COUPNUM",457:"COUPPCD",458:"DURATION",459:"MDURATION",460:"ODDLPRICE",461:"ODDLYIELD",462:"ODDFPRICE",463:"ODDFYIELD",464:"RANDBETWEEN",465:"WEEKNUM",466:"AMORDEGRC",467:"AMORLINC",468:"CONVERT",724:"SHEETJS",469:"ACCRINT",470:"ACCRINTM",471:"WORKDAY",472:"NETWORKDAYS",473:"GCD",474:"MULTINOMIAL",475:"LCM",476:"FVSCHEDULE",477:"CUBEKPIMEMBER",478:"CUBESET",479:"CUBESETCOUNT",480:"IFERROR",481:"COUNTIFS",482:"SUMIFS",483:"AVERAGEIF",484:"AVERAGEIFS"},J4={2:1,3:1,10:0,15:1,16:1,17:1,18:1,19:0,20:1,21:1,22:1,23:1,24:1,25:1,26:1,27:2,30:2,31:3,32:1,33:1,34:0,35:0,38:1,39:2,40:3,41:3,42:3,43:3,44:3,45:3,47:3,48:2,53:1,61:3,63:0,65:3,66:3,67:1,68:1,69:1,70:1,71:1,72:1,73:1,74:0,75:1,76:1,77:1,79:2,80:2,83:1,85:0,86:1,89:0,90:1,94:0,95:0,97:2,98:1,99:1,101:3,102:3,105:1,106:1,108:2,111:1,112:1,113:1,114:1,117:2,118:1,119:4,121:1,126:1,127:1,128:1,129:1,130:1,131:1,133:1,134:1,135:1,136:2,137:2,138:2,140:1,141:1,142:3,143:4,144:4,161:1,162:1,163:1,164:1,165:2,172:1,175:2,176:2,177:3,178:2,179:1,184:1,186:1,189:3,190:1,195:3,196:3,197:1,198:1,199:3,201:1,207:4,210:3,211:1,212:2,213:2,214:1,215:1,225:0,229:1,230:1,231:1,232:1,233:1,234:1,235:3,244:1,247:4,252:2,257:1,261:1,271:1,273:4,274:2,275:2,276:2,277:3,278:3,279:1,280:3,281:3,282:3,283:1,284:1,285:2,286:4,287:3,288:2,289:4,290:3,291:3,292:3,293:4,294:1,295:3,296:1,297:3,298:1,299:2,300:3,301:3,302:4,303:2,304:2,305:2,306:2,307:2,308:2,309:3,310:2,311:2,312:2,313:2,314:2,315:2,316:4,325:2,326:2,327:2,328:2,331:2,332:2,337:2,342:1,343:1,346:2,347:1,350:4,351:3,352:1,353:2,360:1,368:1,369:1,370:1,371:1,372:1,373:1,374:1,375:1,376:1,377:1,378:1,382:3,385:1,392:1,393:1,396:2,397:2,398:2,399:1,400:1,401:1,402:1,403:1,404:1,405:1,406:1,407:1,408:1,409:1,410:1,414:4,415:1,416:1,417:2,420:1,421:1,422:2,424:1,425:2,426:2,427:2,428:2,430:3,438:3,439:3,440:3,443:2,444:2,445:2,446:2,447:6,448:6,449:2,450:2,464:2,468:3,476:2,479:1,480:2,65535:0};function _g(e){return e.slice(0,3)=="of:"&&(e=e.slice(3)),e.charCodeAt(0)==61&&(e=e.slice(1),e.charCodeAt(0)==61&&(e=e.slice(1))),e=e.replace(/COM\.MICROSOFT\./g,""),e=e.replace(/\[((?:\.[A-Z]+[0-9]+)(?::\.[A-Z]+[0-9]+)?)\]/g,function(n,a){return a.replace(/\./g,"")}),e=e.replace(/\[.(#[A-Z]*[?!])\]/g,"$1"),e.replace(/[;~]/g,",").replace(/\|/g,";")}function _0(e){var n=e.split(":"),a=n[0].split(".")[0];return[a,n[0].split(".")[1]+(n.length>1?":"+(n[1].split(".")[1]||n[1].split(".")[0]):"")]}var Gc={},xl={};function Hc(e,n){if(e){var a=[.7,.7,.75,.75,.3,.3];n=="xlml"&&(a=[1,1,1,1,.5,.5]),e.left==null&&(e.left=a[0]),e.right==null&&(e.right=a[1]),e.top==null&&(e.top=a[2]),e.bottom==null&&(e.bottom=a[3]),e.header==null&&(e.header=a[4]),e.footer==null&&(e.footer=a[5])}}function Ex(e,n,a,c,u,m){try{c.cellNF&&(e.z=fr[n])}catch(o){if(c.WTF)throw o}if(!(e.t==="z"&&!c.cellStyles)){if(e.t==="d"&&typeof e.v=="string"&&(e.v=Ua(e.v)),(!c||c.cellText!==!1)&&e.t!=="z")try{if(fr[n]==null&&go(eT[n]||"General",n),e.t==="e")e.w=e.w||ko[e.v];else if(n===0)if(e.t==="n")(e.v|0)===e.v?e.w=e.v.toString(10):e.w=Yc(e.v);else if(e.t==="d"){var x=Ci(e.v);(x|0)===x?e.w=x.toString(10):e.w=Yc(x)}else{if(e.v===void 0)return"";e.w=_o(e.v,xl)}else e.t==="d"?e.w=on(n,Ci(e.v),xl):e.w=on(n,e.v,xl)}catch(o){if(c.WTF)throw o}if(c.cellStyles&&a!=null)try{e.s=m.Fills[a],e.s.fgColor&&e.s.fgColor.theme&&!e.s.fgColor.rgb&&(e.s.fgColor.rgb=Vh(u.themeElements.clrScheme[e.s.fgColor.theme].rgb,e.s.fgColor.tint||0),c.WTF&&(e.s.fgColor.raw_rgb=u.themeElements.clrScheme[e.s.fgColor.theme].rgb)),e.s.bgColor&&e.s.bgColor.theme&&(e.s.bgColor.rgb=Vh(u.themeElements.clrScheme[e.s.bgColor.theme].rgb,e.s.bgColor.tint||0),c.WTF&&(e.s.bgColor.raw_rgb=u.themeElements.clrScheme[e.s.bgColor.theme].rgb))}catch(o){if(c.WTF&&m.Fills)throw o}}}function Q4(e,n){var a=da(n);a.s.r<=a.e.r&&a.s.c<=a.e.c&&a.s.r>=0&&a.s.c>=0&&(e["!ref"]=Tr(a))}var e3=/<(?:\w:)?mergeCell ref="[A-Z0-9:]+"\s*[\/]?>/g,t3=/<(?:\w+:)?sheetData[^>]*>([\s\S]*)<\/(?:\w+:)?sheetData>/,r3=/<(?:\w:)?hyperlink [^>]*>/mg,a3=/"(\w*:\w*)"/,i3=/<(?:\w:)?col\b[^>]*[\/]?>/g,n3=/<(?:\w:)?autoFilter[^>]*([\/]|>([\s\S]*)<\/(?:\w:)?autoFilter)>/g,s3=/<(?:\w:)?pageMargins[^>]*\/>/g,Sx=/<(?:\w:)?sheetPr\b(?:[^>a-z][^>]*)?\/>/,o3=/<(?:\w:)?sheetPr[^>]*(?:[\/]|>([\s\S]*)<\/(?:\w:)?sheetPr)>/,l3=/<(?:\w:)?sheetViews[^>]*(?:[\/]|>([\s\S]*)<\/(?:\w:)?sheetViews)>/;function c3(e,n,a,c,u,m,x){if(!e)return e;c||(c={"!id":{}});var o=n.dense?[]:{},E={s:{r:2e6,c:2e6},e:{r:0,c:0}},w="",C="",P=e.match(t3);P?(w=e.slice(0,P.index),C=e.slice(P.index+P[0].length)):w=C=e;var M=w.match(Sx);M?fd(M[0],o,u,a):(M=w.match(o3))&&u3(M[0],M[1]||"",o,u,a);var O=(w.match(/<(?:\w*:)?dimension/)||{index:-1}).index;if(O>0){var U=w.slice(O,O+50).match(a3);U&&Q4(o,U[1])}var z=w.match(l3);z&&z[1]&&g3(z[1],u);var j=[];if(n.cellStyles){var ee=w.match(i3);ee&&d3(j,ee)}P&&x3(P[1],o,n,E,m,x);var le=C.match(n3);le&&(o["!autofilter"]=p3(le[0]));var Z=[],fe=C.match(e3);if(fe)for(O=0;O!=fe.length;++O)Z[O]=da(fe[O].slice(fe[O].indexOf('"')+1));var me=C.match(r3);me&&h3(o,me,c);var Te=C.match(s3);if(Te&&(o["!margins"]=f3(ar(Te[0]))),!o["!ref"]&&E.e.c>=E.s.c&&E.e.r>=E.s.r&&(o["!ref"]=Tr(E)),n.sheetRows>0&&o["!ref"]){var re=da(o["!ref"]);n.sheetRows<=+re.e.r&&(re.e.r=n.sheetRows-1,re.e.r>E.e.r&&(re.e.r=E.e.r),re.e.r<re.s.r&&(re.s.r=re.e.r),re.e.c>E.e.c&&(re.e.c=E.e.c),re.e.c<re.s.c&&(re.s.c=re.e.c),o["!fullref"]=o["!ref"],o["!ref"]=Tr(re))}return j.length>0&&(o["!cols"]=j),Z.length>0&&(o["!merges"]=Z),o}function fd(e,n,a,c){var u=ar(e);a.Sheets[c]||(a.Sheets[c]={}),u.codeName&&(a.Sheets[c].CodeName=Er(Zr(u.codeName)))}function u3(e,n,a,c,u){fd(e.slice(0,e.indexOf(">")),a,c,u)}function h3(e,n,a){for(var c=Array.isArray(e),u=0;u!=n.length;++u){var m=ar(Zr(n[u]),!0);if(!m.ref)return;var x=((a||{})["!id"]||[])[m.id];x?(m.Target=x.Target,m.location&&(m.Target+="#"+Er(m.location))):(m.Target="#"+Er(m.location),x={Target:m.Target,TargetMode:"Internal"}),m.Rel=x,m.tooltip&&(m.Tooltip=m.tooltip,delete m.tooltip);for(var o=da(m.ref),E=o.s.r;E<=o.e.r;++E)for(var w=o.s.c;w<=o.e.c;++w){var C=or({c:w,r:E});c?(e[E]||(e[E]=[]),e[E][w]||(e[E][w]={t:"z",v:void 0}),e[E][w].l=m):(e[C]||(e[C]={t:"z",v:void 0}),e[C].l=m)}}}function f3(e){var n={};return["left","right","top","bottom","header","footer"].forEach(function(a){e[a]&&(n[a]=parseFloat(e[a]))}),n}function d3(e,n){for(var a=!1,c=0;c!=n.length;++c){var u=ar(n[c],!0);u.hidden&&(u.hidden=aa(u.hidden));var m=parseInt(u.min,10)-1,x=parseInt(u.max,10)-1;for(u.outlineLevel&&(u.level=+u.outlineLevel||0),delete u.min,delete u.max,u.width=+u.width,!a&&u.width&&(a=!0,ud(u.width)),vl(u);m<=x;)e[m++]=Xa(u)}}function p3(e){var n={ref:(e.match(/ref="([^"]*)"/)||[])[1]};return n}var m3=/<(?:\w:)?sheetView(?:[^>a-z][^>]*)?\/?>/;function g3(e,n){n.Views||(n.Views=[{}]),(e.match(m3)||[]).forEach(function(a,c){var u=ar(a);n.Views[c]||(n.Views[c]={}),+u.zoomScale&&(n.Views[c].zoom=+u.zoomScale),aa(u.rightToLeft)&&(n.Views[c].RTL=!0)})}var x3=function(){var e=/<(?:\w+:)?c[ \/>]/,n=/<\/(?:\w+:)?row>/,a=/r=["']([^"']*)["']/,c=/<(?:\w+:)?is>([\S\s]*?)<\/(?:\w+:)?is>/,u=/ref=["']([^"']*)["']/,m=Jc("v"),x=Jc("f");return function(E,w,C,P,M,O){for(var U=0,z="",j=[],ee=[],le=0,Z=0,fe=0,me="",Te,re,Ce=0,be=0,Fe,Oe,Me=0,rt=0,ft=Array.isArray(O.CellXf),lt,_t=[],nt=[],Kt=Array.isArray(w),He=[],Nt={},Mt=!1,pe=!!C.sheetStubs,Ee=E.split(n),Se=0,Ie=Ee.length;Se!=Ie;++Se){z=Ee[Se].trim();var Ke=z.length;if(Ke!==0){var dt=0;e:for(U=0;U<Ke;++U)switch(z[U]){case">":if(z[U-1]!="/"){++U;break e}if(C&&C.cellStyles){if(re=ar(z.slice(dt,U),!0),Ce=re.r!=null?parseInt(re.r,10):Ce+1,be=-1,C.sheetRows&&C.sheetRows<Ce)continue;Nt={},Mt=!1,re.ht&&(Mt=!0,Nt.hpt=parseFloat(re.ht),Nt.hpx=ru(Nt.hpt)),re.hidden=="1"&&(Mt=!0,Nt.hidden=!0),re.outlineLevel!=null&&(Mt=!0,Nt.level=+re.outlineLevel),Mt&&(He[Ce-1]=Nt)}break;case"<":dt=U;break}if(dt>=U)break;if(re=ar(z.slice(dt,U),!0),Ce=re.r!=null?parseInt(re.r,10):Ce+1,be=-1,!(C.sheetRows&&C.sheetRows<Ce)){P.s.r>Ce-1&&(P.s.r=Ce-1),P.e.r<Ce-1&&(P.e.r=Ce-1),C&&C.cellStyles&&(Nt={},Mt=!1,re.ht&&(Mt=!0,Nt.hpt=parseFloat(re.ht),Nt.hpx=ru(Nt.hpt)),re.hidden=="1"&&(Mt=!0,Nt.hidden=!0),re.outlineLevel!=null&&(Mt=!0,Nt.level=+re.outlineLevel),Mt&&(He[Ce-1]=Nt)),j=z.slice(U).split(e);for(var vt=0;vt!=j.length&&j[vt].trim().charAt(0)=="<";++vt);for(j=j.slice(vt),U=0;U!=j.length;++U)if(z=j[U].trim(),z.length!==0){if(ee=z.match(a),le=U,Z=0,fe=0,z="<c "+(z.slice(0,1)=="<"?">":"")+z,ee!=null&&ee.length===2){for(le=0,me=ee[1],Z=0;Z!=me.length&&!((fe=me.charCodeAt(Z)-64)<1||fe>26);++Z)le=26*le+fe;--le,be=le}else++be;for(Z=0;Z!=z.length&&z.charCodeAt(Z)!==62;++Z);if(++Z,re=ar(z.slice(0,Z),!0),re.r||(re.r=or({r:Ce-1,c:be})),me=z.slice(Z),Te={t:""},(ee=me.match(m))!=null&&ee[1]!==""&&(Te.v=Er(ee[1])),C.cellFormula){if((ee=me.match(x))!=null&&ee[1]!==""){if(Te.f=Er(Zr(ee[1])).replace(/\r\n/g,`
`),C.xlfn||(Te.f=pg(Te.f)),ee[0].indexOf('t="array"')>-1)Te.F=(me.match(u)||[])[1],Te.F.indexOf(":")>-1&&_t.push([da(Te.F),Te.F]);else if(ee[0].indexOf('t="shared"')>-1){Oe=ar(ee[0]);var ut=Er(Zr(ee[1]));C.xlfn||(ut=pg(ut)),nt[parseInt(Oe.si,10)]=[Oe,ut,re.r]}}else(ee=me.match(/<f[^>]*\/>/))&&(Oe=ar(ee[0]),nt[Oe.si]&&(Te.f=AC(nt[Oe.si][1],nt[Oe.si][2],re.r)));var Qe=Si(re.r);for(Z=0;Z<_t.length;++Z)Qe.r>=_t[Z][0].s.r&&Qe.r<=_t[Z][0].e.r&&Qe.c>=_t[Z][0].s.c&&Qe.c<=_t[Z][0].e.c&&(Te.F=_t[Z][1])}if(re.t==null&&Te.v===void 0)if(Te.f||Te.F)Te.v=0,Te.t="n";else if(pe)Te.t="z";else continue;else Te.t=re.t||"n";switch(P.s.c>be&&(P.s.c=be),P.e.c<be&&(P.e.c=be),Te.t){case"n":if(Te.v==""||Te.v==null){if(!pe)continue;Te.t="z"}else Te.v=parseFloat(Te.v);break;case"s":if(typeof Te.v>"u"){if(!pe)continue;Te.t="z"}else Fe=Gc[parseInt(Te.v,10)],Te.v=Fe.t,Te.r=Fe.r,C.cellHTML&&(Te.h=Fe.h);break;case"str":Te.t="s",Te.v=Te.v!=null?Zr(Te.v):"",C.cellHTML&&(Te.h=Q0(Te.v));break;case"inlineStr":ee=me.match(c),Te.t="s",ee!=null&&(Fe=cd(ee[1]))?(Te.v=Fe.t,C.cellHTML&&(Te.h=Fe.h)):Te.v="";break;case"b":Te.v=aa(Te.v);break;case"d":C.cellDates?Te.v=Ua(Te.v,1):(Te.v=Ci(Ua(Te.v,1)),Te.t="n");break;case"e":(!C||C.cellText!==!1)&&(Te.w=Te.v),Te.v=q1[Te.v];break}if(Me=rt=0,lt=null,ft&&re.s!==void 0&&(lt=O.CellXf[re.s],lt!=null&&(lt.numFmtId!=null&&(Me=lt.numFmtId),C.cellStyles&&lt.fillId!=null&&(rt=lt.fillId))),Ex(Te,Me,rt,C,M,O),C.cellDates&&ft&&Te.t=="n"&&El(fr[Me])&&(Te.t="d",Te.v=Zh(Te.v)),re.cm&&C.xlmeta){var qt=(C.xlmeta.Cell||[])[+re.cm-1];qt&&qt.type=="XLDAPR"&&(Te.D=!0)}if(Kt){var _e=Si(re.r);w[_e.r]||(w[_e.r]=[]),w[_e.r][_e.c]=Te}else w[re.r]=Te}}}}He.length>0&&(w["!rows"]=He)}}();function _3(e,n){var a={},c=e.l+n;a.r=e.read_shift(4),e.l+=4;var u=e.read_shift(2);e.l+=1;var m=e.read_shift(1);return e.l=c,m&7&&(a.level=m&7),m&16&&(a.hidden=!0),m&32&&(a.hpt=u/20),a}var y3=So;function v3(){}function w3(e,n){var a={},c=e[e.l];return++e.l,a.above=!(c&64),a.left=!(c&128),e.l+=18,a.name=jT(e),a}function b3(e){var n=ln(e);return[n]}function T3(e){var n=Eo(e);return[n]}function E3(e){var n=ln(e),a=e.read_shift(1);return[n,a,"b"]}function S3(e){var n=Eo(e),a=e.read_shift(1);return[n,a,"b"]}function k3(e){var n=ln(e),a=e.read_shift(1);return[n,a,"e"]}function C3(e){var n=Eo(e),a=e.read_shift(1);return[n,a,"e"]}function A3(e){var n=ln(e),a=e.read_shift(4);return[n,a,"s"]}function I3(e){var n=Eo(e),a=e.read_shift(4);return[n,a,"s"]}function F3(e){var n=ln(e),a=li(e);return[n,a,"n"]}function kx(e){var n=Eo(e),a=li(e);return[n,a,"n"]}function P3(e){var n=ln(e),a=sd(e);return[n,a,"n"]}function M3(e){var n=Eo(e),a=sd(e);return[n,a,"n"]}function D3(e){var n=ln(e),a=id(e);return[n,a,"is"]}function L3(e){var n=ln(e),a=ui(e);return[n,a,"str"]}function R3(e){var n=Eo(e),a=ui(e);return[n,a,"str"]}function O3(e,n,a){var c=e.l+n,u=ln(e);u.r=a["!row"];var m=e.read_shift(1),x=[u,m,"b"];if(a.cellFormula){e.l+=2;var o=Yh(e,c-e.l,a);x[3]=oi(o,null,u,a.supbooks,a)}else e.l=c;return x}function B3(e,n,a){var c=e.l+n,u=ln(e);u.r=a["!row"];var m=e.read_shift(1),x=[u,m,"e"];if(a.cellFormula){e.l+=2;var o=Yh(e,c-e.l,a);x[3]=oi(o,null,u,a.supbooks,a)}else e.l=c;return x}function z3(e,n,a){var c=e.l+n,u=ln(e);u.r=a["!row"];var m=li(e),x=[u,m,"n"];if(a.cellFormula){e.l+=2;var o=Yh(e,c-e.l,a);x[3]=oi(o,null,u,a.supbooks,a)}else e.l=c;return x}function N3(e,n,a){var c=e.l+n,u=ln(e);u.r=a["!row"];var m=ui(e),x=[u,m,"str"];if(a.cellFormula){e.l+=2;var o=Yh(e,c-e.l,a);x[3]=oi(o,null,u,a.supbooks,a)}else e.l=c;return x}var U3=So;function V3(e,n){var a=e.l+n,c=So(e),u=nd(e),m=ui(e),x=ui(e),o=ui(e);e.l=a;var E={rfx:c,relId:u,loc:m,display:o};return x&&(E.Tooltip=x),E}function $3(){}function j3(e,n,a){var c=e.l+n,u=j1(e),m=e.read_shift(1),x=[u];if(x[2]=m,a.cellFormula){var o=Z4(e,c-e.l,a);x[1]=o}else e.l=c;return x}function G3(e,n,a){var c=e.l+n,u=So(e),m=[u];if(a.cellFormula){var x=K4(e,c-e.l,a);m[1]=x,e.l=c}else e.l=c;return m}var H3=["left","right","top","bottom","header","footer"];function q3(e){var n={};return H3.forEach(function(a){n[a]=li(e)}),n}function W3(e){var n=e.read_shift(2);return e.l+=28,{RTL:n&32}}function Z3(){}function X3(){}function K3(e,n,a,c,u,m,x){if(!e)return e;var o=n||{};c||(c={"!id":{}});var E=o.dense?[]:{},w,C={s:{r:2e6,c:2e6},e:{r:0,c:0}},P=!1,M=!1,O,U,z,j,ee,le,Z,fe,me,Te=[];o.biff=12,o["!row"]=0;var re=0,Ce=!1,be=[],Fe={},Oe=o.supbooks||u.supbooks||[[]];if(Oe.sharedf=Fe,Oe.arrayf=be,Oe.SheetNames=u.SheetNames||u.Sheets.map(function(Kt){return Kt.name}),!o.supbooks&&(o.supbooks=Oe,u.Names))for(var Me=0;Me<u.Names.length;++Me)Oe[0][Me+1]=u.Names[Me];var rt=[],ft=[],lt=!1;Gh[16]={n:"BrtShortReal",f:kx};var _t;if(cs(e,function(He,Nt,Mt){if(!M)switch(Mt){case 148:w=He;break;case 0:O=He,o.sheetRows&&o.sheetRows<=O.r&&(M=!0),fe=Ka(j=O.r),o["!row"]=O.r,(He.hidden||He.hpt||He.level!=null)&&(He.hpt&&(He.hpx=ru(He.hpt)),ft[He.r]=He);break;case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 13:case 14:case 15:case 16:case 17:case 18:case 62:switch(U={t:He[2]},He[2]){case"n":U.v=He[1];break;case"s":Z=Gc[He[1]],U.v=Z.t,U.r=Z.r;break;case"b":U.v=!!He[1];break;case"e":U.v=He[1],o.cellText!==!1&&(U.w=ko[U.v]);break;case"str":U.t="s",U.v=He[1];break;case"is":U.t="s",U.v=He[1].t;break}if((z=x.CellXf[He[0].iStyleRef])&&Ex(U,z.numFmtId,null,o,m,x),ee=He[0].c==-1?ee+1:He[0].c,o.dense?(E[j]||(E[j]=[]),E[j][ee]=U):E[Da(ee)+fe]=U,o.cellFormula){for(Ce=!1,re=0;re<be.length;++re){var pe=be[re];O.r>=pe[0].s.r&&O.r<=pe[0].e.r&&ee>=pe[0].s.c&&ee<=pe[0].e.c&&(U.F=Tr(pe[0]),Ce=!0)}!Ce&&He.length>3&&(U.f=He[3])}if(C.s.r>O.r&&(C.s.r=O.r),C.s.c>ee&&(C.s.c=ee),C.e.r<O.r&&(C.e.r=O.r),C.e.c<ee&&(C.e.c=ee),o.cellDates&&z&&U.t=="n"&&El(fr[z.numFmtId])){var Ee=fo(U.v);Ee&&(U.t="d",U.v=new Date(Ee.y,Ee.m-1,Ee.d,Ee.H,Ee.M,Ee.S,Ee.u))}_t&&(_t.type=="XLDAPR"&&(U.D=!0),_t=void 0);break;case 1:case 12:if(!o.sheetStubs||P)break;U={t:"z",v:void 0},ee=He[0].c==-1?ee+1:He[0].c,o.dense?(E[j]||(E[j]=[]),E[j][ee]=U):E[Da(ee)+fe]=U,C.s.r>O.r&&(C.s.r=O.r),C.s.c>ee&&(C.s.c=ee),C.e.r<O.r&&(C.e.r=O.r),C.e.c<ee&&(C.e.c=ee),_t&&(_t.type=="XLDAPR"&&(U.D=!0),_t=void 0);break;case 176:Te.push(He);break;case 49:_t=((o.xlmeta||{}).Cell||[])[He-1];break;case 494:var Se=c["!id"][He.relId];for(Se?(He.Target=Se.Target,He.loc&&(He.Target+="#"+He.loc),He.Rel=Se):He.relId==""&&(He.Target="#"+He.loc),j=He.rfx.s.r;j<=He.rfx.e.r;++j)for(ee=He.rfx.s.c;ee<=He.rfx.e.c;++ee)o.dense?(E[j]||(E[j]=[]),E[j][ee]||(E[j][ee]={t:"z",v:void 0}),E[j][ee].l=He):(le=or({c:ee,r:j}),E[le]||(E[le]={t:"z",v:void 0}),E[le].l=He);break;case 426:if(!o.cellFormula)break;be.push(He),me=o.dense?E[j][ee]:E[Da(ee)+fe],me.f=oi(He[1],C,{r:O.r,c:ee},Oe,o),me.F=Tr(He[0]);break;case 427:if(!o.cellFormula)break;Fe[or(He[0].s)]=He[1],me=o.dense?E[j][ee]:E[Da(ee)+fe],me.f=oi(He[1],C,{r:O.r,c:ee},Oe,o);break;case 60:if(!o.cellStyles)break;for(;He.e>=He.s;)rt[He.e--]={width:He.w/256,hidden:!!(He.flags&1),level:He.level},lt||(lt=!0,ud(He.w/256)),vl(rt[He.e+1]);break;case 161:E["!autofilter"]={ref:Tr(He)};break;case 476:E["!margins"]=He;break;case 147:u.Sheets[a]||(u.Sheets[a]={}),He.name&&(u.Sheets[a].CodeName=He.name),(He.above||He.left)&&(E["!outline"]={above:He.above,left:He.left});break;case 137:u.Views||(u.Views=[{}]),u.Views[0]||(u.Views[0]={}),He.RTL&&(u.Views[0].RTL=!0);break;case 485:break;case 64:case 1053:break;case 151:break;case 152:case 175:case 644:case 625:case 562:case 396:case 1112:case 1146:case 471:case 1050:case 649:case 1105:case 589:case 607:case 564:case 1055:case 168:case 174:case 1180:case 499:case 507:case 550:case 171:case 167:case 1177:case 169:case 1181:case 551:case 552:case 661:case 639:case 478:case 537:case 477:case 536:case 1103:case 680:case 1104:case 1024:case 663:case 535:case 678:case 504:case 1043:case 428:case 170:case 3072:case 50:case 2070:case 1045:break;case 35:P=!0;break;case 36:P=!1;break;case 37:P=!0;break;case 38:P=!1;break;default:if(!Nt.T){if(!P||o.WTF)throw new Error("Unexpected record 0x"+Mt.toString(16))}}},o),delete o.supbooks,delete o["!row"],!E["!ref"]&&(C.s.r<2e6||w&&(w.e.r>0||w.e.c>0||w.s.r>0||w.s.c>0))&&(E["!ref"]=Tr(w||C)),o.sheetRows&&E["!ref"]){var nt=da(E["!ref"]);o.sheetRows<=+nt.e.r&&(nt.e.r=o.sheetRows-1,nt.e.r>C.e.r&&(nt.e.r=C.e.r),nt.e.r<nt.s.r&&(nt.s.r=nt.e.r),nt.e.c>C.e.c&&(nt.e.c=C.e.c),nt.e.c<nt.s.c&&(nt.s.c=nt.e.c),E["!fullref"]=E["!ref"],E["!ref"]=Tr(nt))}return Te.length>0&&(E["!merges"]=Te),rt.length>0&&(E["!cols"]=rt),ft.length>0&&(E["!rows"]=ft),E}function Y3(e){var n=[],a=e.match(/^<c:numCache>/),c;(e.match(/<c:pt idx="(\d*)">(.*?)<\/c:pt>/mg)||[]).forEach(function(m){var x=m.match(/<c:pt idx="(\d*?)"><c:v>(.*)<\/c:v><\/c:pt>/);x&&(n[+x[1]]=a?+x[2]:x[2])});var u=Er((e.match(/<c:formatCode>([\s\S]*?)<\/c:formatCode>/)||["","General"])[1]);return(e.match(/<c:f>(.*?)<\/c:f>/mg)||[]).forEach(function(m){c=m.replace(/<.*?>/g,"")}),[n,u,c]}function J3(e,n,a,c,u,m){var x=m||{"!type":"chart"};if(!e)return m;var o=0,E=0,w="A",C={s:{r:2e6,c:2e6},e:{r:0,c:0}};return(e.match(/<c:numCache>[\s\S]*?<\/c:numCache>/gm)||[]).forEach(function(P){var M=Y3(P);C.s.r=C.s.c=0,C.e.c=o,w=Da(o),M[0].forEach(function(O,U){x[w+Ka(U)]={t:"n",v:O,z:M[1]},E=U}),C.e.r<E&&(C.e.r=E),++o}),o>0&&(x["!ref"]=Tr(C)),x}function Q3(e,n,a,c,u){if(!e)return e;c||(c={"!id":{}});var m={"!type":"chart","!drawel":null,"!rel":""},x,o=e.match(Sx);return o&&fd(o[0],m,u,a),(x=e.match(/drawing r:id="(.*?)"/))&&(m["!rel"]=x[1]),c["!id"][m["!rel"]]&&(m["!drawel"]=c["!id"][m["!rel"]]),m}function eA(e,n){e.l+=10;var a=ui(e);return{name:a}}function tA(e,n,a,c,u){if(!e)return e;c||(c={"!id":{}});var m={"!type":"chart","!drawel":null,"!rel":""},x=!1;return cs(e,function(E,w,C){switch(C){case 550:m["!rel"]=E;break;case 651:u.Sheets[a]||(u.Sheets[a]={}),E.name&&(u.Sheets[a].CodeName=E.name);break;case 562:case 652:case 669:case 679:case 551:case 552:case 476:case 3072:break;case 35:x=!0;break;case 36:x=!1;break;case 37:break;case 38:break;default:if(!(w.T>0)){if(!(w.T<0)){if(!x||n.WTF)throw new Error("Unexpected record 0x"+C.toString(16))}}}},n),c["!id"][m["!rel"]]&&(m["!drawel"]=c["!id"][m["!rel"]]),m}var Cx=[["allowRefreshQuery",!1,"bool"],["autoCompressPictures",!0,"bool"],["backupFile",!1,"bool"],["checkCompatibility",!1,"bool"],["CodeName",""],["date1904",!1,"bool"],["defaultThemeVersion",0,"int"],["filterPrivacy",!1,"bool"],["hidePivotFieldList",!1,"bool"],["promptedSolutions",!1,"bool"],["publishItems",!1,"bool"],["refreshAllConnections",!1,"bool"],["saveExternalLinkValues",!0,"bool"],["showBorderUnselectedTables",!0,"bool"],["showInkAnnotation",!0,"bool"],["showObjects","all"],["showPivotChartFilter",!1,"bool"],["updateLinks","userSet"]],rA=[["activeTab",0,"int"],["autoFilterDateGrouping",!0,"bool"],["firstSheet",0,"int"],["minimized",!1,"bool"],["showHorizontalScroll",!0,"bool"],["showSheetTabs",!0,"bool"],["showVerticalScroll",!0,"bool"],["tabRatio",600,"int"],["visibility","visible"]],aA=[],iA=[["calcCompleted","true"],["calcMode","auto"],["calcOnSave","true"],["concurrentCalc","true"],["fullCalcOnLoad","false"],["fullPrecision","true"],["iterate","false"],["iterateCount","100"],["iterateDelta","0.001"],["refMode","A1"]];function yg(e,n){for(var a=0;a!=e.length;++a)for(var c=e[a],u=0;u!=n.length;++u){var m=n[u];if(c[m[0]]==null)c[m[0]]=m[1];else switch(m[2]){case"bool":typeof c[m[0]]=="string"&&(c[m[0]]=aa(c[m[0]]));break;case"int":typeof c[m[0]]=="string"&&(c[m[0]]=parseInt(c[m[0]],10));break}}}function vg(e,n){for(var a=0;a!=n.length;++a){var c=n[a];if(e[c[0]]==null)e[c[0]]=c[1];else switch(c[2]){case"bool":typeof e[c[0]]=="string"&&(e[c[0]]=aa(e[c[0]]));break;case"int":typeof e[c[0]]=="string"&&(e[c[0]]=parseInt(e[c[0]],10));break}}}function Ax(e){vg(e.WBProps,Cx),vg(e.CalcPr,iA),yg(e.WBView,rA),yg(e.Sheets,aA),xl.date1904=aa(e.WBProps.date1904)}var nA="][*?/\\".split("");function sA(e,n){if(e.length>31){if(n)return!1;throw new Error("Sheet names cannot exceed 31 chars")}var a=!0;return nA.forEach(function(c){if(e.indexOf(c)!=-1){if(!n)throw new Error("Sheet name cannot contain : \\ / ? * [ ]");a=!1}}),a}var oA=/<\w+:workbook/;function lA(e,n){if(!e)throw new Error("Could not find file");var a={AppVersion:{},WBProps:{},WBView:[],Sheets:[],CalcPr:{},Names:[],xmlns:""},c=!1,u="xmlns",m={},x=0;if(e.replace(fi,function(E,w){var C=ar(E);switch(Un(C[0])){case"<?xml":break;case"<workbook":E.match(oA)&&(u="xmlns"+E.match(/<(\w+):/)[1]),a.xmlns=C[u];break;case"</workbook>":break;case"<fileVersion":delete C[0],a.AppVersion=C;break;case"<fileVersion/>":case"</fileVersion>":break;case"<fileSharing":break;case"<fileSharing/>":break;case"<workbookPr":case"<workbookPr/>":Cx.forEach(function(P){if(C[P[0]]!=null)switch(P[2]){case"bool":a.WBProps[P[0]]=aa(C[P[0]]);break;case"int":a.WBProps[P[0]]=parseInt(C[P[0]],10);break;default:a.WBProps[P[0]]=C[P[0]]}}),C.codeName&&(a.WBProps.CodeName=Zr(C.codeName));break;case"</workbookPr>":break;case"<workbookProtection":break;case"<workbookProtection/>":break;case"<bookViews":case"<bookViews>":case"</bookViews>":break;case"<workbookView":case"<workbookView/>":delete C[0],a.WBView.push(C);break;case"</workbookView>":break;case"<sheets":case"<sheets>":case"</sheets>":break;case"<sheet":switch(C.state){case"hidden":C.Hidden=1;break;case"veryHidden":C.Hidden=2;break;default:C.Hidden=0}delete C.state,C.name=Er(Zr(C.name)),delete C[0],a.Sheets.push(C);break;case"</sheet>":break;case"<functionGroups":case"<functionGroups/>":break;case"<functionGroup":break;case"<externalReferences":case"</externalReferences>":case"<externalReferences>":break;case"<externalReference":break;case"<definedNames/>":break;case"<definedNames>":case"<definedNames":c=!0;break;case"</definedNames>":c=!1;break;case"<definedName":m={},m.Name=Zr(C.name),C.comment&&(m.Comment=C.comment),C.localSheetId&&(m.Sheet=+C.localSheetId),aa(C.hidden||"0")&&(m.Hidden=!0),x=w+E.length;break;case"</definedName>":m.Ref=Er(Zr(e.slice(x,w))),a.Names.push(m);break;case"<definedName/>":break;case"<calcPr":delete C[0],a.CalcPr=C;break;case"<calcPr/>":delete C[0],a.CalcPr=C;break;case"</calcPr>":break;case"<oleSize":break;case"<customWorkbookViews>":case"</customWorkbookViews>":case"<customWorkbookViews":break;case"<customWorkbookView":case"</customWorkbookView>":break;case"<pivotCaches>":case"</pivotCaches>":case"<pivotCaches":break;case"<pivotCache":break;case"<smartTagPr":case"<smartTagPr/>":break;case"<smartTagTypes":case"<smartTagTypes>":case"</smartTagTypes>":break;case"<smartTagType":break;case"<webPublishing":case"<webPublishing/>":break;case"<fileRecoveryPr":case"<fileRecoveryPr/>":break;case"<webPublishObjects>":case"<webPublishObjects":case"</webPublishObjects>":break;case"<webPublishObject":break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":c=!0;break;case"</ext>":c=!1;break;case"<ArchID":break;case"<AlternateContent":case"<AlternateContent>":c=!0;break;case"</AlternateContent>":c=!1;break;case"<revisionPtr":break;default:if(!c&&n.WTF)throw new Error("unrecognized "+C[0]+" in workbook")}return E}),kT.indexOf(a.xmlns)===-1)throw new Error("Unknown Namespace: "+a.xmlns);return Ax(a),a}function cA(e,n){var a={};return a.Hidden=e.read_shift(4),a.iTabID=e.read_shift(4),a.strRelID=A0(e),a.name=ui(e),a}function uA(e,n){var a={},c=e.read_shift(4);a.defaultThemeVersion=e.read_shift(4);var u=n>8?ui(e):"";return u.length>0&&(a.CodeName=u),a.autoCompressPictures=!!(c&65536),a.backupFile=!!(c&64),a.checkCompatibility=!!(c&4096),a.date1904=!!(c&1),a.filterPrivacy=!!(c&8),a.hidePivotFieldList=!!(c&1024),a.promptedSolutions=!!(c&16),a.publishItems=!!(c&2048),a.refreshAllConnections=!!(c&262144),a.saveExternalLinkValues=!!(c&128),a.showBorderUnselectedTables=!!(c&4),a.showInkAnnotation=!!(c&32),a.showObjects=["all","placeholders","none"][c>>13&3],a.showPivotChartFilter=!!(c&32768),a.updateLinks=["userSet","never","always"][c>>8&3],a}function hA(e,n){var a={};return e.read_shift(4),a.ArchID=e.read_shift(4),e.l+=n-8,a}function fA(e,n,a){var c=e.l+n;e.l+=4,e.l+=1;var u=e.read_shift(4),m=GT(e),x=X4(e,0,a),o=nd(e);e.l=c;var E={Name:m,Ptg:x};return u<268435455&&(E.Sheet=u),o&&(E.Comment=o),E}function dA(e,n){var a={AppVersion:{},WBProps:{},WBView:[],Sheets:[],CalcPr:{},xmlns:""},c=[],u=!1;n||(n={}),n.biff=12;var m=[],x=[[]];return x.SheetNames=[],x.XTI=[],Gh[16]={n:"BrtFRTArchID$",f:hA},cs(e,function(E,w,C){switch(C){case 156:x.SheetNames.push(E.name),a.Sheets.push(E);break;case 153:a.WBProps=E;break;case 39:E.Sheet!=null&&(n.SID=E.Sheet),E.Ref=oi(E.Ptg,null,null,x,n),delete n.SID,delete E.Ptg,m.push(E);break;case 1036:break;case 357:case 358:case 355:case 667:x[0].length?x.push([C,E]):x[0]=[C,E],x[x.length-1].XTI=[];break;case 362:x.length===0&&(x[0]=[],x[0].XTI=[]),x[x.length-1].XTI=x[x.length-1].XTI.concat(E),x.XTI=x.XTI.concat(E);break;case 361:break;case 2071:case 158:case 143:case 664:case 353:break;case 3072:case 3073:case 534:case 677:case 157:case 610:case 2050:case 155:case 548:case 676:case 128:case 665:case 2128:case 2125:case 549:case 2053:case 596:case 2076:case 2075:case 2082:case 397:case 154:case 1117:case 553:case 2091:break;case 35:c.push(C),u=!0;break;case 36:c.pop(),u=!1;break;case 37:c.push(C),u=!0;break;case 38:c.pop(),u=!1;break;case 16:break;default:if(!w.T){if(!u||n.WTF&&c[c.length-1]!=37&&c[c.length-1]!=35)throw new Error("Unexpected record 0x"+C.toString(16))}}},n),Ax(a),a.Names=m,a.supbooks=x,a}function pA(e,n,a){return n.slice(-4)===".bin"?dA(e,a):lA(e,a)}function mA(e,n,a,c,u,m,x,o){return n.slice(-4)===".bin"?K3(e,c,a,u,m,x,o):c3(e,c,a,u,m,x,o)}function gA(e,n,a,c,u,m,x,o){return n.slice(-4)===".bin"?tA(e,c,a,u,m):Q3(e,c,a,u,m)}function xA(e,n,a,c,u,m,x,o){return n.slice(-4)===".bin"?SC():kC()}function _A(e,n,a,c,u,m,x,o){return n.slice(-4)===".bin"?TC():EC()}function yA(e,n,a,c){return n.slice(-4)===".bin"?Uk(e,a,c):Lk(e,a,c)}function vA(e,n,a){return px(e,a)}function wA(e,n,a){return n.slice(-4)===".bin"?rk(e,a):ek(e,a)}function bA(e,n,a){return n.slice(-4)===".bin"?vC(e,a):mC(e,a)}function TA(e,n,a){return n.slice(-4)===".bin"?fC(e):uC(e)}function EA(e,n,a,c){return a.slice(-4)===".bin"?dC(e,n,a,c):void 0}function SA(e,n,a){return n.slice(-4)===".bin"?lC(e,n,a):cC(e,n,a)}var Ix=/([\w:]+)=((?:")([^"]*)(?:")|(?:')([^']*)(?:'))/g,Fx=/([\w:]+)=((?:")(?:[^"]*)(?:")|(?:')(?:[^']*)(?:'))/;function vn(e,n){var a=e.split(/\s+/),c=[];if(n||(c[0]=a[0]),a.length===1)return c;var u=e.match(Ix),m,x,o,E;if(u)for(E=0;E!=u.length;++E)m=u[E].match(Fx),(x=m[1].indexOf(":"))===-1?c[m[1]]=m[2].slice(1,m[2].length-1):(m[1].slice(0,6)==="xmlns:"?o="xmlns"+m[1].slice(6):o=m[1].slice(x+1),c[o]=m[2].slice(1,m[2].length-1));return c}function kA(e){var n=e.split(/\s+/),a={};if(n.length===1)return a;var c=e.match(Ix),u,m,x,o;if(c)for(o=0;o!=c.length;++o)u=c[o].match(Fx),(m=u[1].indexOf(":"))===-1?a[u[1]]=u[2].slice(1,u[2].length-1):(u[1].slice(0,6)==="xmlns:"?x="xmlns"+u[1].slice(6):x=u[1].slice(m+1),a[x]=u[2].slice(1,u[2].length-1));return a}var qc;function CA(e,n){var a=qc[e]||Er(e);return a==="General"?_o(n):on(a,n)}function AA(e,n,a,c){var u=c;switch((a[0].match(/dt:dt="([\w.]+)"/)||["",""])[1]){case"boolean":u=aa(c);break;case"i2":case"int":u=parseInt(c,10);break;case"r4":case"float":u=parseFloat(c);break;case"date":case"dateTime.tz":u=Ua(c);break;case"i8":case"string":case"fixed":case"uuid":case"bin.base64":break;default:throw new Error("bad custprop:"+a[0])}e[Er(n)]=u}function IA(e,n,a){if(e.t!=="z"){if(!a||a.cellText!==!1)try{e.t==="e"?e.w=e.w||ko[e.v]:n==="General"?e.t==="n"?(e.v|0)===e.v?e.w=e.v.toString(10):e.w=Yc(e.v):e.w=_o(e.v):e.w=CA(n||"General",e.v)}catch(m){if(a.WTF)throw m}try{var c=qc[n]||n||"General";if(a.cellNF&&(e.z=c),a.cellDates&&e.t=="n"&&El(c)){var u=fo(e.v);u&&(e.t="d",e.v=new Date(u.y,u.m-1,u.d,u.H,u.M,u.S,u.u))}}catch(m){if(a.WTF)throw m}}}function FA(e,n,a){if(a.cellStyles&&n.Interior){var c=n.Interior;c.Pattern&&(c.patternType=Ak[c.Pattern]||c.Pattern)}e[n.ID]=n}function PA(e,n,a,c,u,m,x,o,E,w){var C="General",P=c.StyleID,M={};w=w||{};var O=[],U=0;for(P===void 0&&o&&(P=o.StyleID),P===void 0&&x&&(P=x.StyleID);m[P]!==void 0&&(m[P].nf&&(C=m[P].nf),m[P].Interior&&O.push(m[P].Interior),!!m[P].Parent);)P=m[P].Parent;switch(a.Type){case"Boolean":c.t="b",c.v=aa(e);break;case"String":c.t="s",c.r=$m(Er(e)),c.v=e.indexOf("<")>-1?Er(n||e).replace(/<.*?>/g,""):c.r;break;case"DateTime":e.slice(-1)!="Z"&&(e+="Z"),c.v=(Ua(e)-new Date(Date.UTC(1899,11,30)))/(24*60*60*1e3),c.v!==c.v?c.v=Er(e):c.v<60&&(c.v=c.v-1),(!C||C=="General")&&(C="yyyy-mm-dd");case"Number":c.v===void 0&&(c.v=+e),c.t||(c.t="n");break;case"Error":c.t="e",c.v=q1[e],w.cellText!==!1&&(c.w=e);break;default:e==""&&n==""?c.t="z":(c.t="s",c.v=$m(n||e));break}if(IA(c,C,w),w.cellFormula!==!1)if(c.Formula){var z=Er(c.Formula);z.charCodeAt(0)==61&&(z=z.slice(1)),c.f=gl(z,u),delete c.Formula,c.ArrayRange=="RC"?c.F=gl("RC:RC",u):c.ArrayRange&&(c.F=gl(c.ArrayRange,u),E.push([da(c.F),c.F]))}else for(U=0;U<E.length;++U)u.r>=E[U][0].s.r&&u.r<=E[U][0].e.r&&u.c>=E[U][0].s.c&&u.c<=E[U][0].e.c&&(c.F=E[U][1]);w.cellStyles&&(O.forEach(function(j){!M.patternType&&j.patternType&&(M.patternType=j.patternType)}),c.s=M),c.StyleID!==void 0&&(c.ixfe=c.StyleID)}function MA(e){e.t=e.v||"",e.t=e.t.replace(/\r\n/g,`
`).replace(/\r/g,`
`),e.v=e.w=e.ixfe=void 0}function y0(e,n){var a=n||{};x1();var c=Lc(ed(e));(a.type=="binary"||a.type=="array"||a.type=="base64")&&(c=Zr(c));var u=c.slice(0,1024).toLowerCase(),m=!1;if(u=u.replace(/".*?"/g,""),(u.indexOf(">")&1023)>Math.min(u.indexOf(",")&1023,u.indexOf(";")&1023)){var x=Xa(a);return x.type="string",eu.to_workbook(c,x)}if(u.indexOf("<?xml")==-1&&["html","table","head","meta","script","style","div"].forEach(function(gr){u.indexOf("<"+gr)>=0&&(m=!0)}),m)return VA(c,a);qc={"General Number":"General","General Date":fr[22],"Long Date":"dddd, mmmm dd, yyyy","Medium Date":fr[15],"Short Date":fr[14],"Long Time":fr[19],"Medium Time":fr[18],"Short Time":fr[20],Currency:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',Fixed:fr[2],Standard:fr[4],Percent:fr[10],Scientific:fr[11],"Yes/No":'"Yes";"Yes";"No";@',"True/False":'"True";"True";"False";@',"On/Off":'"Yes";"Yes";"No";@'};var o,E=[],w,C={},P=[],M=a.dense?[]:{},O="",U={},z={},j=vn('<Data ss:Type="String">'),ee=0,le=0,Z=0,fe={s:{r:2e6,c:2e6},e:{r:0,c:0}},me={},Te={},re="",Ce=0,be=[],Fe={},Oe={},Me=0,rt=[],ft=[],lt={},_t=[],nt,Kt=!1,He=[],Nt=[],Mt={},pe=0,Ee=0,Se={Sheets:[],WBProps:{date1904:!1}},Ie={};Qc.lastIndex=0,c=c.replace(/<!--([\s\S]*?)-->/mg,"");for(var Ke="";o=Qc.exec(c);)switch(o[3]=(Ke=o[3]).toLowerCase()){case"data":if(Ke=="data"){if(o[1]==="/"){if((w=E.pop())[0]!==o[3])throw new Error("Bad state: "+w.join("|"))}else o[0].charAt(o[0].length-2)!=="/"&&E.push([o[3],!0]);break}if(E[E.length-1][1])break;o[1]==="/"?PA(c.slice(ee,o.index),re,j,E[E.length-1][0]=="comment"?lt:U,{c:le,r:Z},me,_t[le],z,He,a):(re="",j=vn(o[0]),ee=o.index+o[0].length);break;case"cell":if(o[1]==="/")if(ft.length>0&&(U.c=ft),(!a.sheetRows||a.sheetRows>Z)&&U.v!==void 0&&(a.dense?(M[Z]||(M[Z]=[]),M[Z][le]=U):M[Da(le)+Ka(Z)]=U),U.HRef&&(U.l={Target:Er(U.HRef)},U.HRefScreenTip&&(U.l.Tooltip=U.HRefScreenTip),delete U.HRef,delete U.HRefScreenTip),(U.MergeAcross||U.MergeDown)&&(pe=le+(parseInt(U.MergeAcross,10)|0),Ee=Z+(parseInt(U.MergeDown,10)|0),be.push({s:{c:le,r:Z},e:{c:pe,r:Ee}})),!a.sheetStubs)U.MergeAcross?le=pe+1:++le;else if(U.MergeAcross||U.MergeDown){for(var dt=le;dt<=pe;++dt)for(var vt=Z;vt<=Ee;++vt)(dt>le||vt>Z)&&(a.dense?(M[vt]||(M[vt]=[]),M[vt][dt]={t:"z"}):M[Da(dt)+Ka(vt)]={t:"z"});le=pe+1}else++le;else U=kA(o[0]),U.Index&&(le=+U.Index-1),le<fe.s.c&&(fe.s.c=le),le>fe.e.c&&(fe.e.c=le),o[0].slice(-2)==="/>"&&++le,ft=[];break;case"row":o[1]==="/"||o[0].slice(-2)==="/>"?(Z<fe.s.r&&(fe.s.r=Z),Z>fe.e.r&&(fe.e.r=Z),o[0].slice(-2)==="/>"&&(z=vn(o[0]),z.Index&&(Z=+z.Index-1)),le=0,++Z):(z=vn(o[0]),z.Index&&(Z=+z.Index-1),Mt={},(z.AutoFitHeight=="0"||z.Height)&&(Mt.hpx=parseInt(z.Height,10),Mt.hpt=dx(Mt.hpx),Nt[Z]=Mt),z.Hidden=="1"&&(Mt.hidden=!0,Nt[Z]=Mt));break;case"worksheet":if(o[1]==="/"){if((w=E.pop())[0]!==o[3])throw new Error("Bad state: "+w.join("|"));P.push(O),fe.s.r<=fe.e.r&&fe.s.c<=fe.e.c&&(M["!ref"]=Tr(fe),a.sheetRows&&a.sheetRows<=fe.e.r&&(M["!fullref"]=M["!ref"],fe.e.r=a.sheetRows-1,M["!ref"]=Tr(fe))),be.length&&(M["!merges"]=be),_t.length>0&&(M["!cols"]=_t),Nt.length>0&&(M["!rows"]=Nt),C[O]=M}else fe={s:{r:2e6,c:2e6},e:{r:0,c:0}},Z=le=0,E.push([o[3],!1]),w=vn(o[0]),O=Er(w.Name),M=a.dense?[]:{},be=[],He=[],Nt=[],Ie={name:O,Hidden:0},Se.Sheets.push(Ie);break;case"table":if(o[1]==="/"){if((w=E.pop())[0]!==o[3])throw new Error("Bad state: "+w.join("|"))}else{if(o[0].slice(-2)=="/>")break;E.push([o[3],!1]),_t=[],Kt=!1}break;case"style":o[1]==="/"?FA(me,Te,a):Te=vn(o[0]);break;case"numberformat":Te.nf=Er(vn(o[0]).Format||"General"),qc[Te.nf]&&(Te.nf=qc[Te.nf]);for(var ut=0;ut!=392&&fr[ut]!=Te.nf;++ut);if(ut==392){for(ut=57;ut!=392;++ut)if(fr[ut]==null){go(Te.nf,ut);break}}break;case"column":if(E[E.length-1][0]!=="table")break;if(nt=vn(o[0]),nt.Hidden&&(nt.hidden=!0,delete nt.Hidden),nt.Width&&(nt.wpx=parseInt(nt.Width,10)),!Kt&&nt.wpx>10){Kt=!0,Ei=hx;for(var Qe=0;Qe<_t.length;++Qe)_t[Qe]&&vl(_t[Qe])}Kt&&vl(nt),_t[nt.Index-1||_t.length]=nt;for(var qt=0;qt<+nt.Span;++qt)_t[_t.length]=Xa(nt);break;case"namedrange":if(o[1]==="/")break;Se.Names||(Se.Names=[]);var _e=ar(o[0]),Yt={Name:_e.Name,Ref:gl(_e.RefersTo.slice(1),{r:0,c:0})};Se.Sheets.length>0&&(Yt.Sheet=Se.Sheets.length-1),Se.Names.push(Yt);break;case"namedcell":break;case"b":break;case"i":break;case"u":break;case"s":break;case"em":break;case"h2":break;case"h3":break;case"sub":break;case"sup":break;case"span":break;case"alignment":break;case"borders":break;case"border":break;case"font":if(o[0].slice(-2)==="/>")break;o[1]==="/"?re+=c.slice(Ce,o.index):Ce=o.index+o[0].length;break;case"interior":if(!a.cellStyles)break;Te.Interior=vn(o[0]);break;case"protection":break;case"author":case"title":case"description":case"created":case"keywords":case"subject":case"category":case"company":case"lastauthor":case"lastsaved":case"lastprinted":case"version":case"revision":case"totaltime":case"hyperlinkbase":case"manager":case"contentstatus":case"identifier":case"language":case"appname":if(o[0].slice(-2)==="/>")break;o[1]==="/"?mE(Fe,Ke,c.slice(Me,o.index)):Me=o.index+o[0].length;break;case"paragraphs":break;case"styles":case"workbook":if(o[1]==="/"){if((w=E.pop())[0]!==o[3])throw new Error("Bad state: "+w.join("|"))}else E.push([o[3],!1]);break;case"comment":if(o[1]==="/"){if((w=E.pop())[0]!==o[3])throw new Error("Bad state: "+w.join("|"));MA(lt),ft.push(lt)}else E.push([o[3],!1]),w=vn(o[0]),lt={a:w.Author};break;case"autofilter":if(o[1]==="/"){if((w=E.pop())[0]!==o[3])throw new Error("Bad state: "+w.join("|"))}else if(o[0].charAt(o[0].length-2)!=="/"){var Wt=vn(o[0]);M["!autofilter"]={ref:gl(Wt.Range).replace(/\$/g,"")},E.push([o[3],!0])}break;case"name":break;case"datavalidation":if(o[1]==="/"){if((w=E.pop())[0]!==o[3])throw new Error("Bad state: "+w.join("|"))}else o[0].charAt(o[0].length-2)!=="/"&&E.push([o[3],!0]);break;case"pixelsperinch":break;case"componentoptions":case"documentproperties":case"customdocumentproperties":case"officedocumentsettings":case"pivottable":case"pivotcache":case"names":case"mapinfo":case"pagebreaks":case"querytable":case"sorting":case"schema":case"conditionalformatting":case"smarttagtype":case"smarttags":case"excelworkbook":case"workbookoptions":case"worksheetoptions":if(o[1]==="/"){if((w=E.pop())[0]!==o[3])throw new Error("Bad state: "+w.join("|"))}else o[0].charAt(o[0].length-2)!=="/"&&E.push([o[3],!0]);break;case"null":break;default:if(E.length==0&&o[3]=="document"||E.length==0&&o[3]=="uof")return kg(c,a);var nr=!0;switch(E[E.length-1][0]){case"officedocumentsettings":switch(o[3]){case"allowpng":break;case"removepersonalinformation":break;case"downloadcomponents":break;case"locationofcomponents":break;case"colors":break;case"color":break;case"index":break;case"rgb":break;case"targetscreensize":break;case"readonlyrecommended":break;default:nr=!1}break;case"componentoptions":switch(o[3]){case"toolbar":break;case"hideofficelogo":break;case"spreadsheetautofit":break;case"label":break;case"caption":break;case"maxheight":break;case"maxwidth":break;case"nextsheetnumber":break;default:nr=!1}break;case"excelworkbook":switch(o[3]){case"date1904":Se.WBProps.date1904=!0;break;case"windowheight":break;case"windowwidth":break;case"windowtopx":break;case"windowtopy":break;case"tabratio":break;case"protectstructure":break;case"protectwindow":break;case"protectwindows":break;case"activesheet":break;case"displayinknotes":break;case"firstvisiblesheet":break;case"supbook":break;case"sheetname":break;case"sheetindex":break;case"sheetindexfirst":break;case"sheetindexlast":break;case"dll":break;case"acceptlabelsinformulas":break;case"donotsavelinkvalues":break;case"iteration":break;case"maxiterations":break;case"maxchange":break;case"path":break;case"xct":break;case"count":break;case"selectedsheets":break;case"calculation":break;case"uncalced":break;case"startupprompt":break;case"crn":break;case"externname":break;case"formula":break;case"colfirst":break;case"collast":break;case"wantadvise":break;case"boolean":break;case"error":break;case"text":break;case"ole":break;case"noautorecover":break;case"publishobjects":break;case"donotcalculatebeforesave":break;case"number":break;case"refmoder1c1":break;case"embedsavesmarttags":break;default:nr=!1}break;case"workbookoptions":switch(o[3]){case"owcversion":break;case"height":break;case"width":break;default:nr=!1}break;case"worksheetoptions":switch(o[3]){case"visible":if(o[0].slice(-2)!=="/>")if(o[1]==="/")switch(c.slice(Me,o.index)){case"SheetHidden":Ie.Hidden=1;break;case"SheetVeryHidden":Ie.Hidden=2;break}else Me=o.index+o[0].length;break;case"header":M["!margins"]||Hc(M["!margins"]={},"xlml"),isNaN(+ar(o[0]).Margin)||(M["!margins"].header=+ar(o[0]).Margin);break;case"footer":M["!margins"]||Hc(M["!margins"]={},"xlml"),isNaN(+ar(o[0]).Margin)||(M["!margins"].footer=+ar(o[0]).Margin);break;case"pagemargins":var Zt=ar(o[0]);M["!margins"]||Hc(M["!margins"]={},"xlml"),isNaN(+Zt.Top)||(M["!margins"].top=+Zt.Top),isNaN(+Zt.Left)||(M["!margins"].left=+Zt.Left),isNaN(+Zt.Right)||(M["!margins"].right=+Zt.Right),isNaN(+Zt.Bottom)||(M["!margins"].bottom=+Zt.Bottom);break;case"displayrighttoleft":Se.Views||(Se.Views=[]),Se.Views[0]||(Se.Views[0]={}),Se.Views[0].RTL=!0;break;case"freezepanes":break;case"frozennosplit":break;case"splithorizontal":case"splitvertical":break;case"donotdisplaygridlines":break;case"activerow":break;case"activecol":break;case"toprowbottompane":break;case"leftcolumnrightpane":break;case"unsynced":break;case"print":break;case"printerrors":break;case"panes":break;case"scale":break;case"pane":break;case"number":break;case"layout":break;case"pagesetup":break;case"selected":break;case"protectobjects":break;case"enableselection":break;case"protectscenarios":break;case"validprinterinfo":break;case"horizontalresolution":break;case"verticalresolution":break;case"numberofcopies":break;case"activepane":break;case"toprowvisible":break;case"leftcolumnvisible":break;case"fittopage":break;case"rangeselection":break;case"papersizeindex":break;case"pagelayoutzoom":break;case"pagebreakzoom":break;case"filteron":break;case"fitwidth":break;case"fitheight":break;case"commentslayout":break;case"zoom":break;case"lefttoright":break;case"gridlines":break;case"allowsort":break;case"allowfilter":break;case"allowinsertrows":break;case"allowdeleterows":break;case"allowinsertcols":break;case"allowdeletecols":break;case"allowinserthyperlinks":break;case"allowformatcells":break;case"allowsizecols":break;case"allowsizerows":break;case"nosummaryrowsbelowdetail":M["!outline"]||(M["!outline"]={}),M["!outline"].above=!0;break;case"tabcolorindex":break;case"donotdisplayheadings":break;case"showpagelayoutzoom":break;case"nosummarycolumnsrightdetail":M["!outline"]||(M["!outline"]={}),M["!outline"].left=!0;break;case"blackandwhite":break;case"donotdisplayzeros":break;case"displaypagebreak":break;case"rowcolheadings":break;case"donotdisplayoutline":break;case"noorientation":break;case"allowusepivottables":break;case"zeroheight":break;case"viewablerange":break;case"selection":break;case"protectcontents":break;default:nr=!1}break;case"pivottable":case"pivotcache":switch(o[3]){case"immediateitemsondrop":break;case"showpagemultipleitemlabel":break;case"compactrowindent":break;case"location":break;case"pivotfield":break;case"orientation":break;case"layoutform":break;case"layoutsubtotallocation":break;case"layoutcompactrow":break;case"position":break;case"pivotitem":break;case"datatype":break;case"datafield":break;case"sourcename":break;case"parentfield":break;case"ptlineitems":break;case"ptlineitem":break;case"countofsameitems":break;case"item":break;case"itemtype":break;case"ptsource":break;case"cacheindex":break;case"consolidationreference":break;case"filename":break;case"reference":break;case"nocolumngrand":break;case"norowgrand":break;case"blanklineafteritems":break;case"hidden":break;case"subtotal":break;case"basefield":break;case"mapchilditems":break;case"function":break;case"refreshonfileopen":break;case"printsettitles":break;case"mergelabels":break;case"defaultversion":break;case"refreshname":break;case"refreshdate":break;case"refreshdatecopy":break;case"versionlastrefresh":break;case"versionlastupdate":break;case"versionupdateablemin":break;case"versionrefreshablemin":break;case"calculation":break;default:nr=!1}break;case"pagebreaks":switch(o[3]){case"colbreaks":break;case"colbreak":break;case"rowbreaks":break;case"rowbreak":break;case"colstart":break;case"colend":break;case"rowend":break;default:nr=!1}break;case"autofilter":switch(o[3]){case"autofiltercolumn":break;case"autofiltercondition":break;case"autofilterand":break;case"autofilteror":break;default:nr=!1}break;case"querytable":switch(o[3]){case"id":break;case"autoformatfont":break;case"autoformatpattern":break;case"querysource":break;case"querytype":break;case"enableredirections":break;case"refreshedinxl9":break;case"urlstring":break;case"htmltables":break;case"connection":break;case"commandtext":break;case"refreshinfo":break;case"notitles":break;case"nextid":break;case"columninfo":break;case"overwritecells":break;case"donotpromptforfile":break;case"textwizardsettings":break;case"source":break;case"number":break;case"decimal":break;case"thousandseparator":break;case"trailingminusnumbers":break;case"formatsettings":break;case"fieldtype":break;case"delimiters":break;case"tab":break;case"comma":break;case"autoformatname":break;case"versionlastedit":break;case"versionlastrefresh":break;default:nr=!1}break;case"datavalidation":switch(o[3]){case"range":break;case"type":break;case"min":break;case"max":break;case"sort":break;case"descending":break;case"order":break;case"casesensitive":break;case"value":break;case"errorstyle":break;case"errormessage":break;case"errortitle":break;case"inputmessage":break;case"inputtitle":break;case"combohide":break;case"inputhide":break;case"condition":break;case"qualifier":break;case"useblank":break;case"value1":break;case"value2":break;case"format":break;case"cellrangelist":break;default:nr=!1}break;case"sorting":case"conditionalformatting":switch(o[3]){case"range":break;case"type":break;case"min":break;case"max":break;case"sort":break;case"descending":break;case"order":break;case"casesensitive":break;case"value":break;case"errorstyle":break;case"errormessage":break;case"errortitle":break;case"cellrangelist":break;case"inputmessage":break;case"inputtitle":break;case"combohide":break;case"inputhide":break;case"condition":break;case"qualifier":break;case"useblank":break;case"value1":break;case"value2":break;case"format":break;default:nr=!1}break;case"mapinfo":case"schema":case"data":switch(o[3]){case"map":break;case"entry":break;case"range":break;case"xpath":break;case"field":break;case"xsdtype":break;case"filteron":break;case"aggregate":break;case"elementtype":break;case"attributetype":break;case"schema":case"element":case"complextype":case"datatype":case"all":case"attribute":case"extends":break;case"row":break;default:nr=!1}break;case"smarttags":break;default:nr=!1;break}if(nr||o[3].match(/!\[CDATA/))break;if(!E[E.length-1][1])throw"Unrecognized tag: "+o[3]+"|"+E.join("|");if(E[E.length-1][0]==="customdocumentproperties"){if(o[0].slice(-2)==="/>")break;o[1]==="/"?AA(Oe,Ke,rt,c.slice(Me,o.index)):(rt=o,Me=o.index+o[0].length);break}if(a.WTF)throw"Unrecognized tag: "+o[3]+"|"+E.join("|")}var wt={};return!a.bookSheets&&!a.bookProps&&(wt.Sheets=C),wt.SheetNames=P,wt.Workbook=Se,wt.SSF=Xa(fr),wt.Props=Fe,wt.Custprops=Oe,wt}function M0(e,n){switch(md(n=n||{}),n.type||"base64"){case"base64":return y0(qi(e),n);case"binary":case"buffer":case"file":return y0(e,n);case"array":return y0(To(e),n)}}function DA(e){var n={},a=e.content;if(a.l=28,n.AnsiUserType=a.read_shift(0,"lpstr-ansi"),n.AnsiClipboardFormat=WT(a),a.length-a.l<=4)return n;var c=a.read_shift(4);if(c==0||c>40||(a.l-=4,n.Reserved1=a.read_shift(0,"lpstr-ansi"),a.length-a.l<=4)||(c=a.read_shift(4),c!==1907505652)||(n.UnicodeClipboardFormat=ZT(a),c=a.read_shift(4),c==0||c>40))return n;a.l-=4,n.Reserved2=a.read_shift(0,"lpwstr")}var LA=[60,1084,2066,2165,2175];function RA(e,n,a,c,u){var m=c,x=[],o=a.slice(a.l,a.l+m);if(u&&u.enc&&u.enc.insitu&&o.length>0)switch(e){case 9:case 521:case 1033:case 2057:case 47:case 405:case 225:case 406:case 312:case 404:case 10:break;case 133:break;default:u.enc.insitu(o)}x.push(o),a.l+=m;for(var E=is(a,a.l),w=D0[E],C=0;w!=null&&LA.indexOf(E)>-1;)m=is(a,a.l+2),C=a.l+4,E==2066?C+=4:(E==2165||E==2175)&&(C+=12),o=a.slice(C,a.l+4+m),x.push(o),a.l+=4+m,w=D0[E=is(a,a.l)];var P=Ps(x);Za(P,0);var M=0;P.lens=[];for(var O=0;O<x.length;++O)P.lens.push(M),M+=x[O].length;if(P.length<c)throw"XLS Record 0x"+e.toString(16)+" Truncated: "+P.length+" < "+c;return n.f(P,P.length,u)}function On(e,n,a){if(e.t!=="z"&&e.XF){var c=0;try{c=e.z||e.XF.numFmtId||0,n.cellNF&&(e.z=fr[c])}catch(m){if(n.WTF)throw m}if(!n||n.cellText!==!1)try{e.t==="e"?e.w=e.w||ko[e.v]:c===0||c=="General"?e.t==="n"?(e.v|0)===e.v?e.w=e.v.toString(10):e.w=Yc(e.v):e.w=_o(e.v):e.w=on(c,e.v,{date1904:!!a,dateNF:n&&n.dateNF})}catch(m){if(n.WTF)throw m}if(n.cellDates&&c&&e.t=="n"&&El(fr[c]||String(c))){var u=fo(e.v);u&&(e.t="d",e.v=new Date(u.y,u.m-1,u.d,u.H,u.M,u.S,u.u))}}}function Ah(e,n,a){return{v:e,ixfe:n,t:a}}function OA(e,n){var a={opts:{}},c={},u=n.dense?[]:{},m={},x={},o=null,E=[],w="",C={},P,M="",O,U,z,j,ee={},le=[],Z,fe,me=[],Te=[],re={Sheets:[],WBProps:{date1904:!1},Views:[{}]},Ce={},be=function(Qt){return Qt<8?xo[Qt]:Qt<64&&Te[Qt-8]||xo[Qt]},Fe=function(Qt,kr,ct){var Dt=kr.XF.data;if(!(!Dt||!Dt.patternType||!ct||!ct.cellStyles)){kr.s={},kr.s.patternType=Dt.patternType;var Vt;(Vt=tu(be(Dt.icvFore)))&&(kr.s.fgColor={rgb:Vt}),(Vt=tu(be(Dt.icvBack)))&&(kr.s.bgColor={rgb:Vt})}},Oe=function(Qt,kr,ct){if(!(Mt>1)&&!(ct.sheetRows&&Qt.r>=ct.sheetRows)){if(ct.cellStyles&&kr.XF&&kr.XF.data&&Fe(Qt,kr,ct),delete kr.ixfe,delete kr.XF,P=Qt,M=or(Qt),(!x||!x.s||!x.e)&&(x={s:{r:0,c:0},e:{r:0,c:0}}),Qt.r<x.s.r&&(x.s.r=Qt.r),Qt.c<x.s.c&&(x.s.c=Qt.c),Qt.r+1>x.e.r&&(x.e.r=Qt.r+1),Qt.c+1>x.e.c&&(x.e.c=Qt.c+1),ct.cellFormula&&kr.f){for(var Dt=0;Dt<le.length;++Dt)if(!(le[Dt][0].s.c>Qt.c||le[Dt][0].s.r>Qt.r)&&!(le[Dt][0].e.c<Qt.c||le[Dt][0].e.r<Qt.r)){kr.F=Tr(le[Dt][0]),(le[Dt][0].s.c!=Qt.c||le[Dt][0].s.r!=Qt.r)&&delete kr.f,kr.f&&(kr.f=""+oi(le[Dt][1],x,Qt,He,Me));break}}ct.dense?(u[Qt.r]||(u[Qt.r]=[]),u[Qt.r][Qt.c]=kr):u[M]=kr}},Me={enc:!1,sbcch:0,snames:[],sharedf:ee,arrayf:le,rrtabid:[],lastuser:"",biff:8,codepage:0,winlocked:0,cellStyles:!!n&&!!n.cellStyles,WTF:!!n&&!!n.wtf};n.password&&(Me.password=n.password);var rt,ft=[],lt=[],_t=[],nt=[],Kt=!1,He=[];He.SheetNames=Me.snames,He.sharedf=Me.sharedf,He.arrayf=Me.arrayf,He.names=[],He.XTI=[];var Nt=0,Mt=0,pe=0,Ee=[],Se=[],Ie;Me.codepage=1200,En(1200);for(var Ke=!1;e.l<e.length-1;){var dt=e.l,vt=e.read_shift(2);if(vt===0&&Nt===10)break;var ut=e.l===e.length?0:e.read_shift(2),Qe=D0[vt];if(Qe&&Qe.f){if(n.bookSheets&&Nt===133&&vt!==133)break;if(Nt=vt,Qe.r===2||Qe.r==12){var qt=e.read_shift(2);if(ut-=2,!Me.enc&&qt!==vt&&((qt&255)<<8|qt>>8)!==vt)throw new Error("rt mismatch: "+qt+"!="+vt);Qe.r==12&&(e.l+=10,ut-=10)}var _e={};if(vt===10?_e=Qe.f(e,ut,Me):_e=RA(vt,Qe,e,ut,Me),Mt==0&&[9,521,1033,2057].indexOf(Nt)===-1)continue;switch(vt){case 34:a.opts.Date1904=re.WBProps.date1904=_e;break;case 134:a.opts.WriteProtect=!0;break;case 47:if(Me.enc||(e.l=0),Me.enc=_e,!n.password)throw new Error("File is password-protected");if(_e.valid==null)throw new Error("Encryption scheme unsupported");if(!_e.valid)throw new Error("Password is incorrect");break;case 92:Me.lastuser=_e;break;case 66:var Yt=Number(_e);switch(Yt){case 21010:Yt=1200;break;case 32768:Yt=1e4;break;case 32769:Yt=1252;break}En(Me.codepage=Yt),Ke=!0;break;case 317:Me.rrtabid=_e;break;case 25:Me.winlocked=_e;break;case 439:a.opts.RefreshAll=_e;break;case 12:a.opts.CalcCount=_e;break;case 16:a.opts.CalcDelta=_e;break;case 17:a.opts.CalcIter=_e;break;case 13:a.opts.CalcMode=_e;break;case 14:a.opts.CalcPrecision=_e;break;case 95:a.opts.CalcSaveRecalc=_e;break;case 15:Me.CalcRefMode=_e;break;case 2211:a.opts.FullCalc=_e;break;case 129:_e.fDialog&&(u["!type"]="dialog"),_e.fBelow||((u["!outline"]||(u["!outline"]={})).above=!0),_e.fRight||((u["!outline"]||(u["!outline"]={})).left=!0);break;case 224:me.push(_e);break;case 430:He.push([_e]),He[He.length-1].XTI=[];break;case 35:case 547:He[He.length-1].push(_e);break;case 24:case 536:Ie={Name:_e.Name,Ref:oi(_e.rgce,x,null,He,Me)},_e.itab>0&&(Ie.Sheet=_e.itab-1),He.names.push(Ie),He[0]||(He[0]=[],He[0].XTI=[]),He[He.length-1].push(_e),_e.Name=="_xlnm._FilterDatabase"&&_e.itab>0&&_e.rgce&&_e.rgce[0]&&_e.rgce[0][0]&&_e.rgce[0][0][0]=="PtgArea3d"&&(Se[_e.itab-1]={ref:Tr(_e.rgce[0][0][1][2])});break;case 22:Me.ExternCount=_e;break;case 23:He.length==0&&(He[0]=[],He[0].XTI=[]),He[He.length-1].XTI=He[He.length-1].XTI.concat(_e),He.XTI=He.XTI.concat(_e);break;case 2196:if(Me.biff<8)break;Ie!=null&&(Ie.Comment=_e[1]);break;case 18:u["!protect"]=_e;break;case 19:_e!==0&&Me.WTF&&console.error("Password verifier: "+_e);break;case 133:m[_e.pos]=_e,Me.snames.push(_e.name);break;case 10:{if(--Mt)break;if(x.e){if(x.e.r>0&&x.e.c>0){if(x.e.r--,x.e.c--,u["!ref"]=Tr(x),n.sheetRows&&n.sheetRows<=x.e.r){var Wt=x.e.r;x.e.r=n.sheetRows-1,u["!fullref"]=u["!ref"],u["!ref"]=Tr(x),x.e.r=Wt}x.e.r++,x.e.c++}ft.length>0&&(u["!merges"]=ft),lt.length>0&&(u["!objects"]=lt),_t.length>0&&(u["!cols"]=_t),nt.length>0&&(u["!rows"]=nt),re.Sheets.push(Ce)}w===""?C=u:c[w]=u,u=n.dense?[]:{}}break;case 9:case 521:case 1033:case 2057:{if(Me.biff===8&&(Me.biff={9:2,521:3,1033:4}[vt]||{512:2,768:3,1024:4,1280:5,1536:8,2:2,7:2}[_e.BIFFVer]||8),Me.biffguess=_e.BIFFVer==0,_e.BIFFVer==0&&_e.dt==4096&&(Me.biff=5,Ke=!0,En(Me.codepage=28591)),Me.biff==8&&_e.BIFFVer==0&&_e.dt==16&&(Me.biff=2),Mt++)break;if(u=n.dense?[]:{},Me.biff<8&&!Ke&&(Ke=!0,En(Me.codepage=n.codepage||1252)),Me.biff<5||_e.BIFFVer==0&&_e.dt==4096){w===""&&(w="Sheet1"),x={s:{r:0,c:0},e:{r:0,c:0}};var nr={pos:e.l-ut,name:w};m[nr.pos]=nr,Me.snames.push(w)}else w=(m[dt]||{name:""}).name;_e.dt==32&&(u["!type"]="chart"),_e.dt==64&&(u["!type"]="macro"),ft=[],lt=[],Me.arrayf=le=[],_t=[],nt=[],Kt=!1,Ce={Hidden:(m[dt]||{hs:0}).hs,name:w}}break;case 515:case 3:case 2:u["!type"]=="chart"&&(n.dense?(u[_e.r]||[])[_e.c]:u[or({c:_e.c,r:_e.r})])&&++_e.c,Z={ixfe:_e.ixfe,XF:me[_e.ixfe]||{},v:_e.val,t:"n"},pe>0&&(Z.z=Ee[Z.ixfe>>8&63]),On(Z,n,a.opts.Date1904),Oe({c:_e.c,r:_e.r},Z,n);break;case 5:case 517:Z={ixfe:_e.ixfe,XF:me[_e.ixfe],v:_e.val,t:_e.t},pe>0&&(Z.z=Ee[Z.ixfe>>8&63]),On(Z,n,a.opts.Date1904),Oe({c:_e.c,r:_e.r},Z,n);break;case 638:Z={ixfe:_e.ixfe,XF:me[_e.ixfe],v:_e.rknum,t:"n"},pe>0&&(Z.z=Ee[Z.ixfe>>8&63]),On(Z,n,a.opts.Date1904),Oe({c:_e.c,r:_e.r},Z,n);break;case 189:for(var Zt=_e.c;Zt<=_e.C;++Zt){var wt=_e.rkrec[Zt-_e.c][0];Z={ixfe:wt,XF:me[wt],v:_e.rkrec[Zt-_e.c][1],t:"n"},pe>0&&(Z.z=Ee[Z.ixfe>>8&63]),On(Z,n,a.opts.Date1904),Oe({c:Zt,r:_e.r},Z,n)}break;case 6:case 518:case 1030:{if(_e.val=="String"){o=_e;break}if(Z=Ah(_e.val,_e.cell.ixfe,_e.tt),Z.XF=me[Z.ixfe],n.cellFormula){var gr=_e.formula;if(gr&&gr[0]&&gr[0][0]&&gr[0][0][0]=="PtgExp"){var Mr=gr[0][0][1][0],Xe=gr[0][0][1][1],Sr=or({r:Mr,c:Xe});ee[Sr]?Z.f=""+oi(_e.formula,x,_e.cell,He,Me):Z.F=((n.dense?(u[Mr]||[])[Xe]:u[Sr])||{}).F}else Z.f=""+oi(_e.formula,x,_e.cell,He,Me)}pe>0&&(Z.z=Ee[Z.ixfe>>8&63]),On(Z,n,a.opts.Date1904),Oe(_e.cell,Z,n),o=_e}break;case 7:case 519:if(o)o.val=_e,Z=Ah(_e,o.cell.ixfe,"s"),Z.XF=me[Z.ixfe],n.cellFormula&&(Z.f=""+oi(o.formula,x,o.cell,He,Me)),pe>0&&(Z.z=Ee[Z.ixfe>>8&63]),On(Z,n,a.opts.Date1904),Oe(o.cell,Z,n),o=null;else throw new Error("String record expects Formula");break;case 33:case 545:{le.push(_e);var Vr=or(_e[0].s);if(O=n.dense?(u[_e[0].s.r]||[])[_e[0].s.c]:u[Vr],n.cellFormula&&O){if(!o||!Vr||!O)break;O.f=""+oi(_e[1],x,_e[0],He,Me),O.F=Tr(_e[0])}}break;case 1212:{if(!n.cellFormula)break;if(M){if(!o)break;ee[or(o.cell)]=_e[0],O=n.dense?(u[o.cell.r]||[])[o.cell.c]:u[or(o.cell)],(O||{}).f=""+oi(_e[0],x,P,He,Me)}}break;case 253:Z=Ah(E[_e.isst].t,_e.ixfe,"s"),E[_e.isst].h&&(Z.h=E[_e.isst].h),Z.XF=me[Z.ixfe],pe>0&&(Z.z=Ee[Z.ixfe>>8&63]),On(Z,n,a.opts.Date1904),Oe({c:_e.c,r:_e.r},Z,n);break;case 513:n.sheetStubs&&(Z={ixfe:_e.ixfe,XF:me[_e.ixfe],t:"z"},pe>0&&(Z.z=Ee[Z.ixfe>>8&63]),On(Z,n,a.opts.Date1904),Oe({c:_e.c,r:_e.r},Z,n));break;case 190:if(n.sheetStubs)for(var lr=_e.c;lr<=_e.C;++lr){var Xt=_e.ixfe[lr-_e.c];Z={ixfe:Xt,XF:me[Xt],t:"z"},pe>0&&(Z.z=Ee[Z.ixfe>>8&63]),On(Z,n,a.opts.Date1904),Oe({c:lr,r:_e.r},Z,n)}break;case 214:case 516:case 4:Z=Ah(_e.val,_e.ixfe,"s"),Z.XF=me[Z.ixfe],pe>0&&(Z.z=Ee[Z.ixfe>>8&63]),On(Z,n,a.opts.Date1904),Oe({c:_e.c,r:_e.r},Z,n);break;case 0:case 512:Mt===1&&(x=_e);break;case 252:E=_e;break;case 1054:if(Me.biff==4){Ee[pe++]=_e[1];for(var Fr=0;Fr<pe+163&&fr[Fr]!=_e[1];++Fr);Fr>=163&&go(_e[1],pe+163)}else go(_e[1],_e[0]);break;case 30:{Ee[pe++]=_e;for(var Or=0;Or<pe+163&&fr[Or]!=_e;++Or);Or>=163&&go(_e,pe+163)}break;case 229:ft=ft.concat(_e);break;case 93:lt[_e.cmo[0]]=Me.lastobj=_e;break;case 438:Me.lastobj.TxO=_e;break;case 127:Me.lastobj.ImData=_e;break;case 440:for(j=_e[0].s.r;j<=_e[0].e.r;++j)for(z=_e[0].s.c;z<=_e[0].e.c;++z)O=n.dense?(u[j]||[])[z]:u[or({c:z,r:j})],O&&(O.l=_e[1]);break;case 2048:for(j=_e[0].s.r;j<=_e[0].e.r;++j)for(z=_e[0].s.c;z<=_e[0].e.c;++z)O=n.dense?(u[j]||[])[z]:u[or({c:z,r:j})],O&&O.l&&(O.l.Tooltip=_e[1]);break;case 28:{if(Me.biff<=5&&Me.biff>=2)break;O=n.dense?(u[_e[0].r]||[])[_e[0].c]:u[or(_e[0])];var ia=lt[_e[2]];O||(n.dense?(u[_e[0].r]||(u[_e[0].r]=[]),O=u[_e[0].r][_e[0].c]={t:"z"}):O=u[or(_e[0])]={t:"z"},x.e.r=Math.max(x.e.r,_e[0].r),x.s.r=Math.min(x.s.r,_e[0].r),x.e.c=Math.max(x.e.c,_e[0].c),x.s.c=Math.min(x.s.c,_e[0].c)),O.c||(O.c=[]),U={a:_e[1],t:ia.TxO.t},O.c.push(U)}break;case 2173:iC(me[_e.ixfe],_e.ext);break;case 125:{if(!Me.cellStyles)break;for(;_e.e>=_e.s;)_t[_e.e--]={width:_e.w/256,level:_e.level||0,hidden:!!(_e.flags&1)},Kt||(Kt=!0,ud(_e.w/256)),vl(_t[_e.e+1])}break;case 520:{var $r={};_e.level!=null&&(nt[_e.r]=$r,$r.level=_e.level),_e.hidden&&(nt[_e.r]=$r,$r.hidden=!0),_e.hpt&&(nt[_e.r]=$r,$r.hpt=_e.hpt,$r.hpx=ru(_e.hpt))}break;case 38:case 39:case 40:case 41:u["!margins"]||Hc(u["!margins"]={}),u["!margins"][{38:"left",39:"right",40:"top",41:"bottom"}[vt]]=_e;break;case 161:u["!margins"]||Hc(u["!margins"]={}),u["!margins"].header=_e.header,u["!margins"].footer=_e.footer;break;case 574:_e.RTL&&(re.Views[0].RTL=!0);break;case 146:Te=_e;break;case 2198:rt=_e;break;case 140:fe=_e;break;case 442:w?Ce.CodeName=_e||Ce.name:re.WBProps.CodeName=_e||"ThisWorkbook";break}}else Qe||console.error("Missing Info for XLS Record 0x"+vt.toString(16)),e.l+=ut}return a.SheetNames=Nn(m).sort(function(pa,Qt){return Number(pa)-Number(Qt)}).map(function(pa){return m[pa].name}),n.bookSheets||(a.Sheets=c),!a.SheetNames.length&&C["!ref"]?(a.SheetNames.push("Sheet1"),a.Sheets&&(a.Sheets.Sheet1=C)):a.Preamble=C,a.Sheets&&Se.forEach(function(pa,Qt){a.Sheets[a.SheetNames[Qt]]["!autofilter"]=pa}),a.Strings=E,a.SSF=Xa(fr),Me.enc&&(a.Encryption=Me.enc),rt&&(a.Themes=rt),a.Metadata={},fe!==void 0&&(a.Metadata.Country=fe),He.names.length>0&&(re.Names=He.names),a.Workbook=re,a}var wg={SI:"e0859ff2f94f6810ab9108002b27b3d9",DSI:"02d5cdd59c2e1b10939708002b2cf9ae",UDI:"05d5cdd59c2e1b10939708002b2cf9ae"};function BA(e,n,a){var c=br.find(e,"/!DocumentSummaryInformation");if(c&&c.size>0)try{var u=ig(c,eE,wg.DSI);for(var m in u)n[m]=u[m]}catch(w){if(a.WTF)throw w}var x=br.find(e,"/!SummaryInformation");if(x&&x.size>0)try{var o=ig(x,tE,wg.SI);for(var E in o)n[E]==null&&(n[E]=o[E])}catch(w){if(a.WTF)throw w}n.HeadingPairs&&n.TitlesOfParts&&(Z1(n.HeadingPairs,n.TitlesOfParts,n,a),delete n.HeadingPairs,delete n.TitlesOfParts)}function Px(e,n){n||(n={}),md(n),n1(),n.codepage&&W0(n.codepage);var a,c;if(e.FullPaths){if(br.find(e,"/encryption"))throw new Error("File is password-protected");a=br.find(e,"!CompObj"),c=br.find(e,"/Workbook")||br.find(e,"/Book")}else{switch(n.type){case"base64":e=bn(qi(e));break;case"binary":e=bn(e);break;case"buffer":break;case"array":Array.isArray(e)||(e=Array.prototype.slice.call(e));break}Za(e,0),c={content:e}}var u,m;if(a&&DA(a),n.bookProps&&!n.bookSheets)u={};else{var x=wr?"buffer":"array";if(c&&c.content)u=OA(c.content,n);else if((m=br.find(e,"PerfectOffice_MAIN"))&&m.content)u=jc.to_workbook(m.content,(n.type=x,n));else if((m=br.find(e,"NativeContent_MAIN"))&&m.content)u=jc.to_workbook(m.content,(n.type=x,n));else throw(m=br.find(e,"MN0"))&&m.content?new Error("Unsupported Works 4 for Mac file"):new Error("Cannot find Workbook stream");n.bookVBA&&e.FullPaths&&br.find(e,"/_VBA_PROJECT_CUR/VBA/dir")&&(u.vbaraw=bC(e))}var o={};return e.FullPaths&&BA(e,o,n),u.Props=u.Custprops=o,n.bookFiles&&(u.cfb=e),u}var Gh={0:{f:_3},1:{f:b3},2:{f:P3},3:{f:k3},4:{f:E3},5:{f:F3},6:{f:L3},7:{f:A3},8:{f:N3},9:{f:z3},10:{f:O3},11:{f:B3},12:{f:T3},13:{f:M3},14:{f:C3},15:{f:S3},16:{f:kx},17:{f:R3},18:{f:I3},19:{f:id},20:{},21:{},22:{},23:{},24:{},25:{},26:{},27:{},28:{},29:{},30:{},31:{},32:{},33:{},34:{},35:{T:1},36:{T:-1},37:{T:1},38:{T:-1},39:{f:fA},40:{},42:{},43:{f:Ok},44:{f:Rk},45:{f:Bk},46:{f:Nk},47:{f:zk},48:{},49:{f:UT},50:{},51:{f:sC},52:{T:1},53:{T:-1},54:{T:1},55:{T:-1},56:{T:1},57:{T:-1},58:{},59:{},60:{f:sx},62:{f:D3},63:{f:hC},64:{f:Z3},65:{},66:{},67:{},68:{},69:{},70:{},128:{},129:{T:1},130:{T:-1},131:{T:1,f:hi,p:0},132:{T:-1},133:{T:1},134:{T:-1},135:{T:1},136:{T:-1},137:{T:1,f:W3},138:{T:-1},139:{T:1},140:{T:-1},141:{T:1},142:{T:-1},143:{T:1},144:{T:-1},145:{T:1},146:{T:-1},147:{f:w3},148:{f:y3,p:16},151:{f:$3},152:{},153:{f:uA},154:{},155:{},156:{f:cA},157:{},158:{},159:{T:1,f:tk},160:{T:-1},161:{T:1,f:So},162:{T:-1},163:{T:1},164:{T:-1},165:{T:1},166:{T:-1},167:{},168:{},169:{},170:{},171:{},172:{T:1},173:{T:-1},174:{},175:{},176:{f:U3},177:{T:1},178:{T:-1},179:{T:1},180:{T:-1},181:{T:1},182:{T:-1},183:{T:1},184:{T:-1},185:{T:1},186:{T:-1},187:{T:1},188:{T:-1},189:{T:1},190:{T:-1},191:{T:1},192:{T:-1},193:{T:1},194:{T:-1},195:{T:1},196:{T:-1},197:{T:1},198:{T:-1},199:{T:1},200:{T:-1},201:{T:1},202:{T:-1},203:{T:1},204:{T:-1},205:{T:1},206:{T:-1},207:{T:1},208:{T:-1},209:{T:1},210:{T:-1},211:{T:1},212:{T:-1},213:{T:1},214:{T:-1},215:{T:1},216:{T:-1},217:{T:1},218:{T:-1},219:{T:1},220:{T:-1},221:{T:1},222:{T:-1},223:{T:1},224:{T:-1},225:{T:1},226:{T:-1},227:{T:1},228:{T:-1},229:{T:1},230:{T:-1},231:{T:1},232:{T:-1},233:{T:1},234:{T:-1},235:{T:1},236:{T:-1},237:{T:1},238:{T:-1},239:{T:1},240:{T:-1},241:{T:1},242:{T:-1},243:{T:1},244:{T:-1},245:{T:1},246:{T:-1},247:{T:1},248:{T:-1},249:{T:1},250:{T:-1},251:{T:1},252:{T:-1},253:{T:1},254:{T:-1},255:{T:1},256:{T:-1},257:{T:1},258:{T:-1},259:{T:1},260:{T:-1},261:{T:1},262:{T:-1},263:{T:1},264:{T:-1},265:{T:1},266:{T:-1},267:{T:1},268:{T:-1},269:{T:1},270:{T:-1},271:{T:1},272:{T:-1},273:{T:1},274:{T:-1},275:{T:1},276:{T:-1},277:{},278:{T:1},279:{T:-1},280:{T:1},281:{T:-1},282:{T:1},283:{T:1},284:{T:-1},285:{T:1},286:{T:-1},287:{T:1},288:{T:-1},289:{T:1},290:{T:-1},291:{T:1},292:{T:-1},293:{T:1},294:{T:-1},295:{T:1},296:{T:-1},297:{T:1},298:{T:-1},299:{T:1},300:{T:-1},301:{T:1},302:{T:-1},303:{T:1},304:{T:-1},305:{T:1},306:{T:-1},307:{T:1},308:{T:-1},309:{T:1},310:{T:-1},311:{T:1},312:{T:-1},313:{T:-1},314:{T:1},315:{T:-1},316:{T:1},317:{T:-1},318:{T:1},319:{T:-1},320:{T:1},321:{T:-1},322:{T:1},323:{T:-1},324:{T:1},325:{T:-1},326:{T:1},327:{T:-1},328:{T:1},329:{T:-1},330:{T:1},331:{T:-1},332:{T:1},333:{T:-1},334:{T:1},335:{f:nC},336:{T:-1},337:{f:oC,T:1},338:{T:-1},339:{T:1},340:{T:-1},341:{T:1},342:{T:-1},343:{T:1},344:{T:-1},345:{T:1},346:{T:-1},347:{T:1},348:{T:-1},349:{T:1},350:{T:-1},351:{},352:{},353:{T:1},354:{T:-1},355:{f:A0},357:{},358:{},359:{},360:{T:1},361:{},362:{f:nx},363:{},364:{},366:{},367:{},368:{},369:{},370:{},371:{},372:{T:1},373:{T:-1},374:{T:1},375:{T:-1},376:{T:1},377:{T:-1},378:{T:1},379:{T:-1},380:{T:1},381:{T:-1},382:{T:1},383:{T:-1},384:{T:1},385:{T:-1},386:{T:1},387:{T:-1},388:{T:1},389:{T:-1},390:{T:1},391:{T:-1},392:{T:1},393:{T:-1},394:{T:1},395:{T:-1},396:{},397:{},398:{},399:{},400:{},401:{T:1},403:{},404:{},405:{},406:{},407:{},408:{},409:{},410:{},411:{},412:{},413:{},414:{},415:{},416:{},417:{},418:{},419:{},420:{},421:{},422:{T:1},423:{T:1},424:{T:-1},425:{T:-1},426:{f:j3},427:{f:G3},428:{},429:{T:1},430:{T:-1},431:{T:1},432:{T:-1},433:{T:1},434:{T:-1},435:{T:1},436:{T:-1},437:{T:1},438:{T:-1},439:{T:1},440:{T:-1},441:{T:1},442:{T:-1},443:{T:1},444:{T:-1},445:{T:1},446:{T:-1},447:{T:1},448:{T:-1},449:{T:1},450:{T:-1},451:{T:1},452:{T:-1},453:{T:1},454:{T:-1},455:{T:1},456:{T:-1},457:{T:1},458:{T:-1},459:{T:1},460:{T:-1},461:{T:1},462:{T:-1},463:{T:1},464:{T:-1},465:{T:1},466:{T:-1},467:{T:1},468:{T:-1},469:{T:1},470:{T:-1},471:{},472:{},473:{T:1},474:{T:-1},475:{},476:{f:q3},477:{},478:{},479:{T:1},480:{T:-1},481:{T:1},482:{T:-1},483:{T:1},484:{T:-1},485:{f:v3},486:{T:1},487:{T:-1},488:{T:1},489:{T:-1},490:{T:1},491:{T:-1},492:{T:1},493:{T:-1},494:{f:V3},495:{T:1},496:{T:-1},497:{T:1},498:{T:-1},499:{},500:{T:1},501:{T:-1},502:{T:1},503:{T:-1},504:{},505:{T:1},506:{T:-1},507:{},508:{T:1},509:{T:-1},510:{T:1},511:{T:-1},512:{},513:{},514:{T:1},515:{T:-1},516:{T:1},517:{T:-1},518:{T:1},519:{T:-1},520:{T:1},521:{T:-1},522:{},523:{},524:{},525:{},526:{},527:{},528:{T:1},529:{T:-1},530:{T:1},531:{T:-1},532:{T:1},533:{T:-1},534:{},535:{},536:{},537:{},538:{T:1},539:{T:-1},540:{T:1},541:{T:-1},542:{T:1},548:{},549:{},550:{f:A0},551:{},552:{},553:{},554:{T:1},555:{T:-1},556:{T:1},557:{T:-1},558:{T:1},559:{T:-1},560:{T:1},561:{T:-1},562:{},564:{},565:{T:1},566:{T:-1},569:{T:1},570:{T:-1},572:{},573:{T:1},574:{T:-1},577:{},578:{},579:{},580:{},581:{},582:{},583:{},584:{},585:{},586:{},587:{},588:{T:-1},589:{},590:{T:1},591:{T:-1},592:{T:1},593:{T:-1},594:{T:1},595:{T:-1},596:{},597:{T:1},598:{T:-1},599:{T:1},600:{T:-1},601:{T:1},602:{T:-1},603:{T:1},604:{T:-1},605:{T:1},606:{T:-1},607:{},608:{T:1},609:{T:-1},610:{},611:{T:1},612:{T:-1},613:{T:1},614:{T:-1},615:{T:1},616:{T:-1},617:{T:1},618:{T:-1},619:{T:1},620:{T:-1},625:{},626:{T:1},627:{T:-1},628:{T:1},629:{T:-1},630:{T:1},631:{T:-1},632:{f:yC},633:{T:1},634:{T:-1},635:{T:1,f:_C},636:{T:-1},637:{f:$T},638:{T:1},639:{},640:{T:-1},641:{T:1},642:{T:-1},643:{T:1},644:{},645:{T:-1},646:{T:1},648:{T:1},649:{},650:{T:-1},651:{f:eA},652:{},653:{T:1},654:{T:-1},655:{T:1},656:{T:-1},657:{T:1},658:{T:-1},659:{},660:{T:1},661:{},662:{T:-1},663:{},664:{T:1},665:{},666:{T:-1},667:{},668:{},669:{},671:{T:1},672:{T:-1},673:{T:1},674:{T:-1},675:{},676:{},677:{},678:{},679:{},680:{},681:{},1024:{},1025:{},1026:{T:1},1027:{T:-1},1028:{T:1},1029:{T:-1},1030:{},1031:{T:1},1032:{T:-1},1033:{T:1},1034:{T:-1},1035:{},1036:{},1037:{},1038:{T:1},1039:{T:-1},1040:{},1041:{T:1},1042:{T:-1},1043:{},1044:{},1045:{},1046:{T:1},1047:{T:-1},1048:{T:1},1049:{T:-1},1050:{},1051:{T:1},1052:{T:1},1053:{f:X3},1054:{T:1},1055:{},1056:{T:1},1057:{T:-1},1058:{T:1},1059:{T:-1},1061:{},1062:{T:1},1063:{T:-1},1064:{T:1},1065:{T:-1},1066:{T:1},1067:{T:-1},1068:{T:1},1069:{T:-1},1070:{T:1},1071:{T:-1},1072:{T:1},1073:{T:-1},1075:{T:1},1076:{T:-1},1077:{T:1},1078:{T:-1},1079:{T:1},1080:{T:-1},1081:{T:1},1082:{T:-1},1083:{T:1},1084:{T:-1},1085:{},1086:{T:1},1087:{T:-1},1088:{T:1},1089:{T:-1},1090:{T:1},1091:{T:-1},1092:{T:1},1093:{T:-1},1094:{T:1},1095:{T:-1},1096:{},1097:{T:1},1098:{},1099:{T:-1},1100:{T:1},1101:{T:-1},1102:{},1103:{},1104:{},1105:{},1111:{},1112:{},1113:{T:1},1114:{T:-1},1115:{T:1},1116:{T:-1},1117:{},1118:{T:1},1119:{T:-1},1120:{T:1},1121:{T:-1},1122:{T:1},1123:{T:-1},1124:{T:1},1125:{T:-1},1126:{},1128:{T:1},1129:{T:-1},1130:{},1131:{T:1},1132:{T:-1},1133:{T:1},1134:{T:-1},1135:{T:1},1136:{T:-1},1137:{T:1},1138:{T:-1},1139:{T:1},1140:{T:-1},1141:{},1142:{T:1},1143:{T:-1},1144:{T:1},1145:{T:-1},1146:{},1147:{T:1},1148:{T:-1},1149:{T:1},1150:{T:-1},1152:{T:1},1153:{T:-1},1154:{T:-1},1155:{T:-1},1156:{T:-1},1157:{T:1},1158:{T:-1},1159:{T:1},1160:{T:-1},1161:{T:1},1162:{T:-1},1163:{T:1},1164:{T:-1},1165:{T:1},1166:{T:-1},1167:{T:1},1168:{T:-1},1169:{T:1},1170:{T:-1},1171:{},1172:{T:1},1173:{T:-1},1177:{},1178:{T:1},1180:{},1181:{},1182:{},2048:{T:1},2049:{T:-1},2050:{},2051:{T:1},2052:{T:-1},2053:{},2054:{},2055:{T:1},2056:{T:-1},2057:{T:1},2058:{T:-1},2060:{},2067:{},2068:{T:1},2069:{T:-1},2070:{},2071:{},2072:{T:1},2073:{T:-1},2075:{},2076:{},2077:{T:1},2078:{T:-1},2079:{},2080:{T:1},2081:{T:-1},2082:{},2083:{T:1},2084:{T:-1},2085:{T:1},2086:{T:-1},2087:{T:1},2088:{T:-1},2089:{T:1},2090:{T:-1},2091:{},2092:{},2093:{T:1},2094:{T:-1},2095:{},2096:{T:1},2097:{T:-1},2098:{T:1},2099:{T:-1},2100:{T:1},2101:{T:-1},2102:{},2103:{T:1},2104:{T:-1},2105:{},2106:{T:1},2107:{T:-1},2108:{},2109:{T:1},2110:{T:-1},2111:{T:1},2112:{T:-1},2113:{T:1},2114:{T:-1},2115:{},2116:{},2117:{},2118:{T:1},2119:{T:-1},2120:{},2121:{T:1},2122:{T:-1},2123:{T:1},2124:{T:-1},2125:{},2126:{T:1},2127:{T:-1},2128:{},2129:{T:1},2130:{T:-1},2131:{T:1},2132:{T:-1},2133:{T:1},2134:{},2135:{},2136:{},2137:{T:1},2138:{T:-1},2139:{T:1},2140:{T:-1},2141:{},3072:{},3073:{},4096:{T:1},4097:{T:-1},5002:{T:1},5003:{T:-1},5081:{T:1},5082:{T:-1},5083:{},5084:{T:1},5085:{T:-1},5086:{T:1},5087:{T:-1},5088:{},5089:{},5090:{},5092:{T:1},5093:{T:-1},5094:{},5095:{T:1},5096:{T:-1},5097:{},5099:{},65535:{n:""}},D0={6:{f:x0},10:{f:Is},12:{f:Ca},13:{f:Ca},14:{f:Ta},15:{f:Ta},16:{f:li},17:{f:Ta},18:{f:Ta},19:{f:Ca},20:{f:lg},21:{f:lg},23:{f:nx},24:{f:ug},25:{f:Ta},26:{},27:{},28:{f:gS},29:{},34:{f:Ta},35:{f:cg},38:{f:li},39:{f:li},40:{f:li},41:{f:li},42:{f:Ta},43:{f:Ta},47:{f:vk},49:{f:YE},51:{f:Ca},60:{},61:{f:ZE},64:{f:Ta},65:{f:KE},66:{f:Ca},77:{},80:{},81:{},82:{},85:{f:Ca},89:{},90:{},91:{},92:{f:UE},93:{f:_S},94:{},95:{f:Ta},96:{},97:{},99:{f:Ta},125:{f:sx},128:{f:oS},129:{f:VE},130:{f:Ca},131:{f:Ta},132:{f:Ta},133:{f:$E},134:{},140:{f:ES},141:{f:Ca},144:{},146:{f:kS},151:{},152:{},153:{},154:{},155:{},156:{f:Ca},157:{},158:{},160:{f:PS},161:{f:AS},174:{},175:{},176:{},177:{},178:{},180:{},181:{},182:{},184:{},185:{},189:{f:aS},190:{f:iS},193:{f:Is},197:{},198:{},199:{},200:{},201:{},202:{f:Ta},203:{},204:{},205:{},206:{},207:{},208:{},209:{},210:{},211:{},213:{},215:{},216:{},217:{},218:{f:Ca},220:{},221:{f:Ta},222:{},224:{f:sS},225:{f:NE},226:{f:Is},227:{},229:{f:xS},233:{},235:{},236:{},237:{},239:{},240:{},241:{},242:{},244:{},245:{},246:{},247:{},248:{},249:{},251:{},252:{f:jE},253:{f:JE},255:{f:GE},256:{},259:{},290:{},311:{},312:{},315:{},317:{f:Q1},318:{},319:{},320:{},330:{},331:{},333:{},334:{},335:{},336:{},337:{},338:{},339:{},340:{},351:{},352:{f:Ta},353:{f:Is},401:{},402:{},403:{},404:{},405:{},406:{},407:{},408:{},425:{},426:{},427:{},428:{},429:{},430:{f:cS},431:{f:Ta},432:{},433:{},434:{},437:{},438:{f:wS},439:{f:Ta},440:{f:bS},441:{},442:{f:lu},443:{},444:{f:Ca},445:{},446:{},448:{f:Is},449:{f:WE,r:2},450:{f:Is},512:{f:sg},513:{f:FS},515:{f:lS},516:{f:QE},517:{f:og},519:{f:MS},520:{f:HE},523:{},545:{f:hg},549:{f:ng},566:{},574:{f:XE},638:{f:rS},659:{},1048:{},1054:{f:eS},1084:{},1212:{f:dS},2048:{f:TS},2049:{},2050:{},2051:{},2052:{},2053:{},2054:{},2055:{},2056:{},2057:{f:Sh},2058:{},2059:{},2060:{},2061:{},2062:{},2063:{},2064:{},2066:{},2067:{},2128:{},2129:{},2130:{},2131:{},2132:{},2133:{},2134:{},2135:{},2136:{},2137:{},2138:{},2146:{},2147:{r:12},2148:{},2149:{},2150:{},2151:{f:Is},2152:{},2154:{},2155:{},2156:{},2161:{},2162:{},2164:{},2165:{},2166:{},2167:{},2168:{},2169:{},2170:{},2171:{},2172:{f:CS,r:12},2173:{f:aC,r:12},2174:{},2175:{},2180:{},2181:{},2182:{},2183:{},2184:{},2185:{},2186:{},2187:{},2188:{f:Ta,r:12},2189:{},2190:{r:12},2191:{},2192:{},2194:{},2195:{},2196:{f:fS,r:12},2197:{},2198:{f:Yk,r:12},2199:{},2200:{},2201:{},2202:{f:pS,r:12},2203:{f:Is},2204:{},2205:{},2206:{},2207:{},2211:{f:qE},2212:{},2213:{},2214:{},2215:{},4097:{},4098:{},4099:{},4102:{},4103:{},4105:{},4106:{},4107:{},4108:{},4109:{},4116:{},4117:{},4118:{},4119:{},4120:{},4121:{},4122:{},4123:{},4124:{},4125:{},4126:{},4127:{},4128:{},4129:{},4130:{},4132:{},4133:{},4134:{f:Ca},4135:{},4146:{},4147:{},4148:{},4149:{},4154:{},4156:{},4157:{},4158:{},4159:{},4160:{},4161:{},4163:{},4164:{f:IS},4165:{},4166:{},4168:{},4170:{},4171:{},4174:{},4175:{},4176:{},4177:{},4187:{},4188:{f:SS},4189:{},4191:{},4192:{},4193:{},4194:{},4195:{},4196:{},4197:{},4198:{},4199:{},4200:{},0:{f:sg},1:{},2:{f:OS},3:{f:RS},4:{f:LS},5:{f:og},7:{f:BS},8:{},9:{f:Sh},11:{},22:{f:Ca},30:{f:tS},31:{},32:{},33:{f:hg},36:{},37:{f:ng},50:{f:zS},62:{},52:{},67:{},68:{f:Ca},69:{},86:{},126:{},127:{f:DS},135:{},136:{},137:{},145:{},148:{},149:{},150:{},169:{},171:{},188:{},191:{},192:{},194:{},195:{},214:{f:NS},223:{},234:{},354:{},421:{},518:{f:x0},521:{f:Sh},536:{f:ug},547:{f:cg},561:{},579:{},1030:{f:x0},1033:{f:Sh},1091:{},2157:{},2163:{},2177:{},2240:{},2241:{},2242:{},2243:{},2244:{},2245:{},2246:{},2247:{},2248:{},2249:{},2250:{},2251:{},2262:{r:12},29282:{}};function wn(e,n,a,c){var u=n;if(!isNaN(u)){var m=c||(a||[]).length||0,x=e.next(4);x.write_shift(2,u),x.write_shift(2,m),m>0&&U1(a)&&e.push(a)}}function bg(e,n){var a=n||{},c=a.dense?[]:{};e=e.replace(/<!--.*?-->/g,"");var u=e.match(/<table/i);if(!u)throw new Error("Invalid HTML: could not find <table>");var m=e.match(/<\/table/i),x=u.index,o=m&&m.index||e.length,E=cT(e.slice(x,o),/(:?<tr[^>]*>)/i,"<tr>"),w=-1,C=0,P=0,M=0,O={s:{r:1e7,c:1e7},e:{r:0,c:0}},U=[];for(x=0;x<E.length;++x){var z=E[x].trim(),j=z.slice(0,3).toLowerCase();if(j=="<tr"){if(++w,a.sheetRows&&a.sheetRows<=w){--w;break}C=0;continue}if(!(j!="<td"&&j!="<th")){var ee=z.split(/<\/t[dh]>/i);for(o=0;o<ee.length;++o){var le=ee[o].trim();if(le.match(/<t[dh]/i)){for(var Z=le,fe=0;Z.charAt(0)=="<"&&(fe=Z.indexOf(">"))>-1;)Z=Z.slice(fe+1);for(var me=0;me<U.length;++me){var Te=U[me];Te.s.c==C&&Te.s.r<w&&w<=Te.e.r&&(C=Te.e.c+1,me=-1)}var re=ar(le.slice(0,le.indexOf(">")));M=re.colspan?+re.colspan:1,((P=+re.rowspan)>1||M>1)&&U.push({s:{r:w,c:C},e:{r:w+(P||1)-1,c:C+M-1}});var Ce=re.t||re["data-t"]||"";if(!Z.length){C+=M;continue}if(Z=C1(Z),O.s.r>w&&(O.s.r=w),O.e.r<w&&(O.e.r=w),O.s.c>C&&(O.s.c=C),O.e.c<C&&(O.e.c=C),!Z.length){C+=M;continue}var be={t:"s",v:Z};a.raw||!Z.trim().length||Ce=="s"||(Z==="TRUE"?be={t:"b",v:!0}:Z==="FALSE"?be={t:"b",v:!1}:isNaN(kn(Z))?isNaN(yl(Z).getDate())||(be={t:"d",v:Ua(Z)},a.cellDates||(be={t:"n",v:Ci(be.v)}),be.z=a.dateNF||fr[14]):be={t:"n",v:kn(Z)}),a.dense?(c[w]||(c[w]=[]),c[w][C]=be):c[or({r:w,c:C})]=be,C+=M}}}}return c["!ref"]=Tr(O),U.length&&(c["!merges"]=U),c}function zA(e,n,a,c){for(var u=e["!merges"]||[],m=[],x=n.s.c;x<=n.e.c;++x){for(var o=0,E=0,w=0;w<u.length;++w)if(!(u[w].s.r>a||u[w].s.c>x)&&!(u[w].e.r<a||u[w].e.c<x)){if(u[w].s.r<a||u[w].s.c<x){o=-1;break}o=u[w].e.r-u[w].s.r+1,E=u[w].e.c-u[w].s.c+1;break}if(!(o<0)){var C=or({r:a,c:x}),P=c.dense?(e[a]||[])[x]:e[C],M=P&&P.v!=null&&(P.h||Q0(P.w||(ls(P),P.w)||""))||"",O={};o>1&&(O.rowspan=o),E>1&&(O.colspan=E),c.editable?M='<span contenteditable="true">'+M+"</span>":P&&(O["data-t"]=P&&P.t||"z",P.v!=null&&(O["data-v"]=P.v),P.z!=null&&(O["data-z"]=P.z),P.l&&(P.l.Target||"#").charAt(0)!="#"&&(M='<a href="'+P.l.Target+'">'+M+"</a>")),O.id=(c.id||"sjs")+"-"+C,m.push(ET("td",M,O))}}var U="<tr>";return U+m.join("")+"</tr>"}var NA='<html><head><meta charset="utf-8"/><title>SheetJS Table Export</title></head><body>',UA="</body></html>";function VA(e,n){var a=e.match(/<table[\s\S]*?>[\s\S]*?<\/table>/gi);if(!a||a.length==0)throw new Error("Invalid HTML: could not find <table>");if(a.length==1)return Us(bg(a[0],n),n);var c=xd();return a.forEach(function(u,m){_d(c,bg(u,n),"Sheet"+(m+1))}),c}function $A(e,n,a){var c=[];return c.join("")+"<table"+(a&&a.id?' id="'+a.id+'"':"")+">"}function jA(e,n){var a=n||{},c=a.header!=null?a.header:NA,u=a.footer!=null?a.footer:UA,m=[c],x=Sl(e["!ref"]);a.dense=Array.isArray(e),m.push($A(e,x,a));for(var o=x.s.r;o<=x.e.r;++o)m.push(zA(e,x,o,a));return m.push("</table>"+u),m.join("")}function Mx(e,n,a){var c=a||{},u=0,m=0;if(c.origin!=null)if(typeof c.origin=="number")u=c.origin;else{var x=typeof c.origin=="string"?Si(c.origin):c.origin;u=x.r,m=x.c}var o=n.getElementsByTagName("tr"),E=Math.min(c.sheetRows||1e7,o.length),w={s:{r:0,c:0},e:{r:u,c:m}};if(e["!ref"]){var C=Sl(e["!ref"]);w.s.r=Math.min(w.s.r,C.s.r),w.s.c=Math.min(w.s.c,C.s.c),w.e.r=Math.max(w.e.r,C.e.r),w.e.c=Math.max(w.e.c,C.e.c),u==-1&&(w.e.r=u=C.e.r+1)}var P=[],M=0,O=e["!rows"]||(e["!rows"]=[]),U=0,z=0,j=0,ee=0,le=0,Z=0;for(e["!cols"]||(e["!cols"]=[]);U<o.length&&z<E;++U){var fe=o[U];if(Tg(fe)){if(c.display)continue;O[z]={hidden:!0}}var me=fe.children;for(j=ee=0;j<me.length;++j){var Te=me[j];if(!(c.display&&Tg(Te))){var re=Te.hasAttribute("data-v")?Te.getAttribute("data-v"):Te.hasAttribute("v")?Te.getAttribute("v"):C1(Te.innerHTML),Ce=Te.getAttribute("data-z")||Te.getAttribute("z");for(M=0;M<P.length;++M){var be=P[M];be.s.c==ee+m&&be.s.r<z+u&&z+u<=be.e.r&&(ee=be.e.c+1-m,M=-1)}Z=+Te.getAttribute("colspan")||1,((le=+Te.getAttribute("rowspan")||1)>1||Z>1)&&P.push({s:{r:z+u,c:ee+m},e:{r:z+u+(le||1)-1,c:ee+m+(Z||1)-1}});var Fe={t:"s",v:re},Oe=Te.getAttribute("data-t")||Te.getAttribute("t")||"";re!=null&&(re.length==0?Fe.t=Oe||"z":c.raw||re.trim().length==0||Oe=="s"||(re==="TRUE"?Fe={t:"b",v:!0}:re==="FALSE"?Fe={t:"b",v:!1}:isNaN(kn(re))?isNaN(yl(re).getDate())||(Fe={t:"d",v:Ua(re)},c.cellDates||(Fe={t:"n",v:Ci(Fe.v)}),Fe.z=c.dateNF||fr[14]):Fe={t:"n",v:kn(re)})),Fe.z===void 0&&Ce!=null&&(Fe.z=Ce);var Me="",rt=Te.getElementsByTagName("A");if(rt&&rt.length)for(var ft=0;ft<rt.length&&!(rt[ft].hasAttribute("href")&&(Me=rt[ft].getAttribute("href"),Me.charAt(0)!="#"));++ft);Me&&Me.charAt(0)!="#"&&(Fe.l={Target:Me}),c.dense?(e[z+u]||(e[z+u]=[]),e[z+u][ee+m]=Fe):e[or({c:ee+m,r:z+u})]=Fe,w.e.c<ee+m&&(w.e.c=ee+m),ee+=Z}}++z}return P.length&&(e["!merges"]=(e["!merges"]||[]).concat(P)),w.e.r=Math.max(w.e.r,z-1+u),e["!ref"]=Tr(w),z>=E&&(e["!fullref"]=Tr((w.e.r=o.length-U+z-1+u,w))),e}function Dx(e,n){var a=n||{},c=a.dense?[]:{};return Mx(c,e,n)}function GA(e,n){return Us(Dx(e,n),n)}function Tg(e){var n="",a=HA(e);return a&&(n=a(e).getPropertyValue("display")),n||(n=e.style&&e.style.display),n==="none"}function HA(e){return e.ownerDocument.defaultView&&typeof e.ownerDocument.defaultView.getComputedStyle=="function"?e.ownerDocument.defaultView.getComputedStyle:typeof getComputedStyle=="function"?getComputedStyle:null}function qA(e){var n=e.replace(/[\t\r\n]/g," ").trim().replace(/ +/g," ").replace(/<text:s\/>/g," ").replace(/<text:s text:c="(\d+)"\/>/g,function(c,u){return Array(parseInt(u,10)+1).join(" ")}).replace(/<text:tab[^>]*\/>/g,"	").replace(/<text:line-break\/>/g,`
`),a=Er(n.replace(/<[^>]*>/g,""));return[a]}var Eg={day:["d","dd"],month:["m","mm"],year:["y","yy"],hours:["h","hh"],minutes:["m","mm"],seconds:["s","ss"],"am-pm":["A/P","AM/PM"],"day-of-week":["ddd","dddd"],era:["e","ee"],quarter:["\\Qm",'m\\"th quarter"']};function Lx(e,n){var a=n||{},c=ed(e),u=[],m,x,o={name:""},E="",w=0,C,P,M={},O=[],U=a.dense?[]:{},z,j,ee={value:""},le="",Z=0,fe=[],me=-1,Te=-1,re={s:{r:1e6,c:1e7},e:{r:0,c:0}},Ce=0,be={},Fe=[],Oe={},Me=0,rt=0,ft=[],lt=1,_t=1,nt=[],Kt={Names:[]},He={},Nt=["",""],Mt=[],pe={},Ee="",Se=0,Ie=!1,Ke=!1,dt=0;for(Qc.lastIndex=0,c=c.replace(/<!--([\s\S]*?)-->/mg,"").replace(/<!DOCTYPE[^\[]*\[[^\]]*\]>/gm,"");z=Qc.exec(c);)switch(z[3]=z[3].replace(/_.*$/,"")){case"table":case"工作表":z[1]==="/"?(re.e.c>=re.s.c&&re.e.r>=re.s.r?U["!ref"]=Tr(re):U["!ref"]="A1:A1",a.sheetRows>0&&a.sheetRows<=re.e.r&&(U["!fullref"]=U["!ref"],re.e.r=a.sheetRows-1,U["!ref"]=Tr(re)),Fe.length&&(U["!merges"]=Fe),ft.length&&(U["!rows"]=ft),C.name=C.名称||C.name,typeof JSON<"u"&&JSON.stringify(C),O.push(C.name),M[C.name]=U,Ke=!1):z[0].charAt(z[0].length-2)!=="/"&&(C=ar(z[0],!1),me=Te=-1,re.s.r=re.s.c=1e7,re.e.r=re.e.c=0,U=a.dense?[]:{},Fe=[],ft=[],Ke=!0);break;case"table-row-group":z[1]==="/"?--Ce:++Ce;break;case"table-row":case"行":if(z[1]==="/"){me+=lt,lt=1;break}if(P=ar(z[0],!1),P.行号?me=P.行号-1:me==-1&&(me=0),lt=+P["number-rows-repeated"]||1,lt<10)for(dt=0;dt<lt;++dt)Ce>0&&(ft[me+dt]={level:Ce});Te=-1;break;case"covered-table-cell":z[1]!=="/"&&++Te,a.sheetStubs&&(a.dense?(U[me]||(U[me]=[]),U[me][Te]={t:"z"}):U[or({r:me,c:Te})]={t:"z"}),le="",fe=[];break;case"table-cell":case"数据":if(z[0].charAt(z[0].length-2)==="/")++Te,ee=ar(z[0],!1),_t=parseInt(ee["number-columns-repeated"]||"1",10),j={t:"z",v:null},ee.formula&&a.cellFormula!=!1&&(j.f=_g(Er(ee.formula))),(ee.数据类型||ee["value-type"])=="string"&&(j.t="s",j.v=Er(ee["string-value"]||""),a.dense?(U[me]||(U[me]=[]),U[me][Te]=j):U[or({r:me,c:Te})]=j),Te+=_t-1;else if(z[1]!=="/"){++Te,le="",Z=0,fe=[],_t=1;var vt=lt?me+lt-1:me;if(Te>re.e.c&&(re.e.c=Te),Te<re.s.c&&(re.s.c=Te),me<re.s.r&&(re.s.r=me),vt>re.e.r&&(re.e.r=vt),ee=ar(z[0],!1),Mt=[],pe={},j={t:ee.数据类型||ee["value-type"],v:null},a.cellFormula)if(ee.formula&&(ee.formula=Er(ee.formula)),ee["number-matrix-columns-spanned"]&&ee["number-matrix-rows-spanned"]&&(Me=parseInt(ee["number-matrix-rows-spanned"],10)||0,rt=parseInt(ee["number-matrix-columns-spanned"],10)||0,Oe={s:{r:me,c:Te},e:{r:me+Me-1,c:Te+rt-1}},j.F=Tr(Oe),nt.push([Oe,j.F])),ee.formula)j.f=_g(ee.formula);else for(dt=0;dt<nt.length;++dt)me>=nt[dt][0].s.r&&me<=nt[dt][0].e.r&&Te>=nt[dt][0].s.c&&Te<=nt[dt][0].e.c&&(j.F=nt[dt][1]);switch((ee["number-columns-spanned"]||ee["number-rows-spanned"])&&(Me=parseInt(ee["number-rows-spanned"],10)||0,rt=parseInt(ee["number-columns-spanned"],10)||0,Oe={s:{r:me,c:Te},e:{r:me+Me-1,c:Te+rt-1}},Fe.push(Oe)),ee["number-columns-repeated"]&&(_t=parseInt(ee["number-columns-repeated"],10)),j.t){case"boolean":j.t="b",j.v=aa(ee["boolean-value"]);break;case"float":j.t="n",j.v=parseFloat(ee.value);break;case"percentage":j.t="n",j.v=parseFloat(ee.value);break;case"currency":j.t="n",j.v=parseFloat(ee.value);break;case"date":j.t="d",j.v=Ua(ee["date-value"]),a.cellDates||(j.t="n",j.v=Ci(j.v)),j.z="m/d/yy";break;case"time":j.t="n",j.v=sT(ee["time-value"])/86400,a.cellDates&&(j.t="d",j.v=Zh(j.v)),j.z="HH:MM:SS";break;case"number":j.t="n",j.v=parseFloat(ee.数据数值);break;default:if(j.t==="string"||j.t==="text"||!j.t)j.t="s",ee["string-value"]!=null&&(le=Er(ee["string-value"]),fe=[]);else throw new Error("Unsupported value type "+j.t)}}else{if(Ie=!1,j.t==="s"&&(j.v=le||"",fe.length&&(j.R=fe),Ie=Z==0),He.Target&&(j.l=He),Mt.length>0&&(j.c=Mt,Mt=[]),le&&a.cellText!==!1&&(j.w=le),Ie&&(j.t="z",delete j.v),(!Ie||a.sheetStubs)&&!(a.sheetRows&&a.sheetRows<=me))for(var ut=0;ut<lt;++ut){if(_t=parseInt(ee["number-columns-repeated"]||"1",10),a.dense)for(U[me+ut]||(U[me+ut]=[]),U[me+ut][Te]=ut==0?j:Xa(j);--_t>0;)U[me+ut][Te+_t]=Xa(j);else for(U[or({r:me+ut,c:Te})]=j;--_t>0;)U[or({r:me+ut,c:Te+_t})]=Xa(j);re.e.c<=Te&&(re.e.c=Te)}_t=parseInt(ee["number-columns-repeated"]||"1",10),Te+=_t-1,_t=0,j={},le="",fe=[]}He={};break;case"document":case"document-content":case"电子表格文档":case"spreadsheet":case"主体":case"scripts":case"styles":case"font-face-decls":case"master-styles":if(z[1]==="/"){if((m=u.pop())[0]!==z[3])throw"Bad state: "+m}else z[0].charAt(z[0].length-2)!=="/"&&u.push([z[3],!0]);break;case"annotation":if(z[1]==="/"){if((m=u.pop())[0]!==z[3])throw"Bad state: "+m;pe.t=le,fe.length&&(pe.R=fe),pe.a=Ee,Mt.push(pe)}else z[0].charAt(z[0].length-2)!=="/"&&u.push([z[3],!1]);Ee="",Se=0,le="",Z=0,fe=[];break;case"creator":z[1]==="/"?Ee=c.slice(Se,z.index):Se=z.index+z[0].length;break;case"meta":case"元数据":case"settings":case"config-item-set":case"config-item-map-indexed":case"config-item-map-entry":case"config-item-map-named":case"shapes":case"frame":case"text-box":case"image":case"data-pilot-tables":case"list-style":case"form":case"dde-links":case"event-listeners":case"chart":if(z[1]==="/"){if((m=u.pop())[0]!==z[3])throw"Bad state: "+m}else z[0].charAt(z[0].length-2)!=="/"&&u.push([z[3],!1]);le="",Z=0,fe=[];break;case"scientific-number":break;case"currency-symbol":break;case"currency-style":break;case"number-style":case"percentage-style":case"date-style":case"time-style":if(z[1]==="/"){if(be[o.name]=E,(m=u.pop())[0]!==z[3])throw"Bad state: "+m}else z[0].charAt(z[0].length-2)!=="/"&&(E="",o=ar(z[0],!1),u.push([z[3],!0]));break;case"script":break;case"libraries":break;case"automatic-styles":break;case"default-style":case"page-layout":break;case"style":break;case"map":break;case"font-face":break;case"paragraph-properties":break;case"table-properties":break;case"table-column-properties":break;case"table-row-properties":break;case"table-cell-properties":break;case"number":switch(u[u.length-1][0]){case"time-style":case"date-style":x=ar(z[0],!1),E+=Eg[z[3]][x.style==="long"?1:0];break}break;case"fraction":break;case"day":case"month":case"year":case"era":case"day-of-week":case"week-of-year":case"quarter":case"hours":case"minutes":case"seconds":case"am-pm":switch(u[u.length-1][0]){case"time-style":case"date-style":x=ar(z[0],!1),E+=Eg[z[3]][x.style==="long"?1:0];break}break;case"boolean-style":break;case"boolean":break;case"text-style":break;case"text":if(z[0].slice(-2)==="/>")break;if(z[1]==="/")switch(u[u.length-1][0]){case"number-style":case"date-style":case"time-style":E+=c.slice(w,z.index);break}else w=z.index+z[0].length;break;case"named-range":x=ar(z[0],!1),Nt=_0(x["cell-range-address"]);var Qe={Name:x.name,Ref:Nt[0]+"!"+Nt[1]};Ke&&(Qe.Sheet=O.length),Kt.Names.push(Qe);break;case"text-content":break;case"text-properties":break;case"embedded-text":break;case"body":case"电子表格":break;case"forms":break;case"table-column":break;case"table-header-rows":break;case"table-rows":break;case"table-column-group":break;case"table-header-columns":break;case"table-columns":break;case"null-date":break;case"graphic-properties":break;case"calculation-settings":break;case"named-expressions":break;case"label-range":break;case"label-ranges":break;case"named-expression":break;case"sort":break;case"sort-by":break;case"sort-groups":break;case"tab":break;case"line-break":break;case"span":break;case"p":case"文本串":if(["master-styles"].indexOf(u[u.length-1][0])>-1)break;if(z[1]==="/"&&(!ee||!ee["string-value"])){var qt=qA(c.slice(Z,z.index));le=(le.length>0?le+`
`:"")+qt[0]}else ar(z[0],!1),Z=z.index+z[0].length;break;case"s":break;case"database-range":if(z[1]==="/")break;try{Nt=_0(ar(z[0])["target-range-address"]),M[Nt[0]]["!autofilter"]={ref:Nt[1]}}catch{}break;case"date":break;case"object":break;case"title":case"标题":break;case"desc":break;case"binary-data":break;case"table-source":break;case"scenario":break;case"iteration":break;case"content-validations":break;case"content-validation":break;case"help-message":break;case"error-message":break;case"database-ranges":break;case"filter":break;case"filter-and":break;case"filter-or":break;case"filter-condition":break;case"list-level-style-bullet":break;case"list-level-style-number":break;case"list-level-properties":break;case"sender-firstname":case"sender-lastname":case"sender-initials":case"sender-title":case"sender-position":case"sender-email":case"sender-phone-private":case"sender-fax":case"sender-company":case"sender-phone-work":case"sender-street":case"sender-city":case"sender-postal-code":case"sender-country":case"sender-state-or-province":case"author-name":case"author-initials":case"chapter":case"file-name":case"template-name":case"sheet-name":break;case"event-listener":break;case"initial-creator":case"creation-date":case"print-date":case"generator":case"document-statistic":case"user-defined":case"editing-duration":case"editing-cycles":break;case"config-item":break;case"page-number":break;case"page-count":break;case"time":break;case"cell-range-source":break;case"detective":break;case"operation":break;case"highlighted-range":break;case"data-pilot-table":case"source-cell-range":case"source-service":case"data-pilot-field":case"data-pilot-level":case"data-pilot-subtotals":case"data-pilot-subtotal":case"data-pilot-members":case"data-pilot-member":case"data-pilot-display-info":case"data-pilot-sort-info":case"data-pilot-layout-info":case"data-pilot-field-reference":case"data-pilot-groups":case"data-pilot-group":case"data-pilot-group-member":break;case"rect":break;case"dde-connection-decls":case"dde-connection-decl":case"dde-link":case"dde-source":break;case"properties":break;case"property":break;case"a":if(z[1]!=="/"){if(He=ar(z[0],!1),!He.href)break;He.Target=Er(He.href),delete He.href,He.Target.charAt(0)=="#"&&He.Target.indexOf(".")>-1?(Nt=_0(He.Target.slice(1)),He.Target="#"+Nt[0]+"!"+Nt[1]):He.Target.match(/^\.\.[\\\/]/)&&(He.Target=He.Target.slice(3))}break;case"table-protection":break;case"data-pilot-grand-total":break;case"office-document-common-attrs":break;default:switch(z[2]){case"dc:":case"calcext:":case"loext:":case"ooo:":case"chartooo:":case"draw:":case"style:":case"chart:":case"form:":case"uof:":case"表:":case"字:":break;default:if(a.WTF)throw new Error(z)}}var _e={Sheets:M,SheetNames:O,Workbook:Kt};return a.bookSheets&&delete _e.Sheets,_e}function Sg(e,n){n=n||{},nn(e,"META-INF/manifest.xml")&&lE(ka(e,"META-INF/manifest.xml"),n);var a=ji(e,"content.xml");if(!a)throw new Error("Missing content.xml in ODS / UOF file");var c=Lx(Zr(a),n);return nn(e,"meta.xml")&&(c.Props=W1(ka(e,"meta.xml"))),c}function kg(e,n){return Lx(e,n)}/*! sheetjs (C) 2013-present SheetJS -- http://sheetjs.com */function dd(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function L0(e){return typeof TextDecoder<"u"?new TextDecoder().decode(e):Zr(To(e))}function R0(e){var n=e.reduce(function(u,m){return u+m.length},0),a=new Uint8Array(n),c=0;return e.forEach(function(u){a.set(u,c),c+=u.length}),a}function Cg(e){return e-=e>>1&1431655765,e=(e&858993459)+(e>>2&858993459),(e+(e>>4)&252645135)*16843009>>>24}function WA(e,n){for(var a=(e[n+15]&127)<<7|e[n+14]>>1,c=e[n+14]&1,u=n+13;u>=n;--u)c=c*256+e[u];return(e[n+15]&128?-c:c)*Math.pow(10,a-6176)}function au(e,n){var a=n?n[0]:0,c=e[a]&127;e:if(e[a++]>=128&&(c|=(e[a]&127)<<7,e[a++]<128||(c|=(e[a]&127)<<14,e[a++]<128)||(c|=(e[a]&127)<<21,e[a++]<128)||(c+=(e[a]&127)*Math.pow(2,28),++a,e[a++]<128)||(c+=(e[a]&127)*Math.pow(2,35),++a,e[a++]<128)||(c+=(e[a]&127)*Math.pow(2,42),++a,e[a++]<128)))break e;return n&&(n[0]=a),c}function La(e){var n=0,a=e[n]&127;e:if(e[n++]>=128){if(a|=(e[n]&127)<<7,e[n++]<128||(a|=(e[n]&127)<<14,e[n++]<128)||(a|=(e[n]&127)<<21,e[n++]<128))break e;a|=(e[n]&127)<<28}return a}function ci(e){for(var n=[],a=[0];a[0]<e.length;){var c=a[0],u=au(e,a),m=u&7;u=Math.floor(u/8);var x=0,o;if(u==0)break;switch(m){case 0:{for(var E=a[0];e[a[0]++]>=128;);o=e.slice(E,a[0])}break;case 5:x=4,o=e.slice(a[0],a[0]+x),a[0]+=x;break;case 1:x=8,o=e.slice(a[0],a[0]+x),a[0]+=x;break;case 2:x=au(e,a),o=e.slice(a[0],a[0]+x),a[0]+=x;break;case 3:case 4:default:throw new Error("PB Type ".concat(m," for Field ").concat(u," at offset ").concat(c))}var w={data:o,type:m};n[u]==null?n[u]=[w]:n[u].push(w)}return n}function pd(e,n){return e?.map(function(a){return n(a.data)})||[]}function ZA(e){for(var n,a=[],c=[0];c[0]<e.length;){var u=au(e,c),m=ci(e.slice(c[0],c[0]+u));c[0]+=u;var x={id:La(m[1][0].data),messages:[]};m[2].forEach(function(o){var E=ci(o.data),w=La(E[3][0].data);x.messages.push({meta:E,data:e.slice(c[0],c[0]+w)}),c[0]+=w}),(n=m[3])!=null&&n[0]&&(x.merge=La(m[3][0].data)>>>0>0),a.push(x)}return a}function XA(e,n){if(e!=0)throw new Error("Unexpected Snappy chunk type ".concat(e));for(var a=[0],c=au(n,a),u=[];a[0]<n.length;){var m=n[a[0]]&3;if(m==0){var x=n[a[0]++]>>2;if(x<60)++x;else{var o=x-59;x=n[a[0]],o>1&&(x|=n[a[0]+1]<<8),o>2&&(x|=n[a[0]+2]<<16),o>3&&(x|=n[a[0]+3]<<24),x>>>=0,x++,a[0]+=o}u.push(n.slice(a[0],a[0]+x)),a[0]+=x;continue}else{var E=0,w=0;if(m==1?(w=(n[a[0]]>>2&7)+4,E=(n[a[0]++]&224)<<3,E|=n[a[0]++]):(w=(n[a[0]++]>>2)+1,m==2?(E=n[a[0]]|n[a[0]+1]<<8,a[0]+=2):(E=(n[a[0]]|n[a[0]+1]<<8|n[a[0]+2]<<16|n[a[0]+3]<<24)>>>0,a[0]+=4)),u=[R0(u)],E==0)throw new Error("Invalid offset 0");if(E>u[0].length)throw new Error("Invalid offset beyond length");if(w>=E)for(u.push(u[0].slice(-E)),w-=E;w>=u[u.length-1].length;)u.push(u[u.length-1]),w-=u[u.length-1].length;u.push(u[0].slice(-E,-E+w))}}var C=R0(u);if(C.length!=c)throw new Error("Unexpected length: ".concat(C.length," != ").concat(c));return C}function KA(e){for(var n=[],a=0;a<e.length;){var c=e[a++],u=e[a]|e[a+1]<<8|e[a+2]<<16;a+=3,n.push(XA(c,e.slice(a,a+u))),a+=u}if(a!==e.length)throw new Error("data is not a valid framed stream!");return R0(n)}function YA(e,n,a,c){var u=dd(e),m=u.getUint32(4,!0),x=(c>1?12:8)+Cg(m&(c>1?3470:398))*4,o=-1,E=-1,w=NaN,C=new Date(2001,0,1);m&512&&(o=u.getUint32(x,!0),x+=4),x+=Cg(m&(c>1?12288:4096))*4,m&16&&(E=u.getUint32(x,!0),x+=4),m&32&&(w=u.getFloat64(x,!0),x+=8),m&64&&(C.setTime(C.getTime()+u.getFloat64(x,!0)*1e3),x+=8);var P;switch(e[2]){case 0:break;case 2:P={t:"n",v:w};break;case 3:P={t:"s",v:n[E]};break;case 5:P={t:"d",v:C};break;case 6:P={t:"b",v:w>0};break;case 7:P={t:"n",v:w/86400};break;case 8:P={t:"e",v:0};break;case 9:if(o>-1)P={t:"s",v:a[o]};else if(E>-1)P={t:"s",v:n[E]};else if(!isNaN(w))P={t:"n",v:w};else throw new Error("Unsupported cell type ".concat(e.slice(0,4)));break;default:throw new Error("Unsupported cell type ".concat(e.slice(0,4)))}return P}function JA(e,n,a){var c=dd(e),u=c.getUint32(8,!0),m=12,x=-1,o=-1,E=NaN,w=NaN,C=new Date(2001,0,1);u&1&&(E=WA(e,m),m+=16),u&2&&(w=c.getFloat64(m,!0),m+=8),u&4&&(C.setTime(C.getTime()+c.getFloat64(m,!0)*1e3),m+=8),u&8&&(o=c.getUint32(m,!0),m+=4),u&16&&(x=c.getUint32(m,!0),m+=4);var P;switch(e[1]){case 0:break;case 2:P={t:"n",v:E};break;case 3:P={t:"s",v:n[o]};break;case 5:P={t:"d",v:C};break;case 6:P={t:"b",v:w>0};break;case 7:P={t:"n",v:w/86400};break;case 8:P={t:"e",v:0};break;case 9:if(x>-1)P={t:"s",v:a[x]};else throw new Error("Unsupported cell type ".concat(e[1]," : ").concat(u&31," : ").concat(e.slice(0,4)));break;case 10:P={t:"n",v:E};break;default:throw new Error("Unsupported cell type ".concat(e[1]," : ").concat(u&31," : ").concat(e.slice(0,4)))}return P}function QA(e,n,a){switch(e[0]){case 0:case 1:case 2:case 3:return YA(e,n,a,e[0]);case 5:return JA(e,n,a);default:throw new Error("Unsupported payload version ".concat(e[0]))}}function Bs(e){var n=ci(e);return au(n[1][0].data)}function Ag(e,n){var a=ci(n.data),c=La(a[1][0].data),u=a[3],m=[];return(u||[]).forEach(function(x){var o=ci(x.data),E=La(o[1][0].data)>>>0;switch(c){case 1:m[E]=L0(o[3][0].data);break;case 8:{var w=e[Bs(o[9][0].data)][0],C=ci(w.data),P=e[Bs(C[1][0].data)][0],M=La(P.meta[1][0].data);if(M!=2001)throw new Error("2000 unexpected reference to ".concat(M));var O=ci(P.data);m[E]=O[3].map(function(U){return L0(U.data)}).join("")}break}}),m}function eI(e,n){var a,c,u,m,x,o,E,w,C,P,M,O,U,z,j=ci(e),ee=La(j[1][0].data)>>>0,le=La(j[2][0].data)>>>0,Z=((c=(a=j[8])==null?void 0:a[0])==null?void 0:c.data)&&La(j[8][0].data)>0||!1,fe,me;if((m=(u=j[7])==null?void 0:u[0])!=null&&m.data&&n!=0)fe=(o=(x=j[7])==null?void 0:x[0])==null?void 0:o.data,me=(w=(E=j[6])==null?void 0:E[0])==null?void 0:w.data;else if((P=(C=j[4])==null?void 0:C[0])!=null&&P.data&&n!=1)fe=(O=(M=j[4])==null?void 0:M[0])==null?void 0:O.data,me=(z=(U=j[3])==null?void 0:U[0])==null?void 0:z.data;else throw"NUMBERS Tile missing ".concat(n," cell storage");for(var Te=Z?4:1,re=dd(fe),Ce=[],be=0;be<fe.length/2;++be){var Fe=re.getUint16(be*2,!0);Fe<65535&&Ce.push([be,Fe])}if(Ce.length!=le)throw"Expected ".concat(le," cells, found ").concat(Ce.length);var Oe=[];for(be=0;be<Ce.length-1;++be)Oe[Ce[be][0]]=me.subarray(Ce[be][1]*Te,Ce[be+1][1]*Te);return Ce.length>=1&&(Oe[Ce[Ce.length-1][0]]=me.subarray(Ce[Ce.length-1][1]*Te)),{R:ee,cells:Oe}}function tI(e,n){var a,c=ci(n.data),u=(a=c?.[7])!=null&&a[0]?La(c[7][0].data)>>>0>0?1:0:-1,m=pd(c[5],function(x){return eI(x,u)});return{nrows:La(c[4][0].data)>>>0,data:m.reduce(function(x,o){return x[o.R]||(x[o.R]=[]),o.cells.forEach(function(E,w){if(x[o.R][w])throw new Error("Duplicate cell r=".concat(o.R," c=").concat(w));x[o.R][w]=E}),x},[])}}function rI(e,n,a){var c,u=ci(n.data),m={s:{r:0,c:0},e:{r:0,c:0}};if(m.e.r=(La(u[6][0].data)>>>0)-1,m.e.r<0)throw new Error("Invalid row varint ".concat(u[6][0].data));if(m.e.c=(La(u[7][0].data)>>>0)-1,m.e.c<0)throw new Error("Invalid col varint ".concat(u[7][0].data));a["!ref"]=Tr(m);var x=ci(u[4][0].data),o=Ag(e,e[Bs(x[4][0].data)][0]),E=(c=x[17])!=null&&c[0]?Ag(e,e[Bs(x[17][0].data)][0]):[],w=ci(x[3][0].data),C=0;w[1].forEach(function(P){var M=ci(P.data),O=e[Bs(M[2][0].data)][0],U=La(O.meta[1][0].data);if(U!=6002)throw new Error("6001 unexpected reference to ".concat(U));var z=tI(e,O);z.data.forEach(function(j,ee){j.forEach(function(le,Z){var fe=or({r:C+ee,c:Z}),me=QA(le,o,E);me&&(a[fe]=me)})}),C+=z.nrows})}function aI(e,n){var a=ci(n.data),c={"!ref":"A1"},u=e[Bs(a[2][0].data)],m=La(u[0].meta[1][0].data);if(m!=6001)throw new Error("6000 unexpected reference to ".concat(m));return rI(e,u[0],c),c}function iI(e,n){var a,c=ci(n.data),u={name:(a=c[1])!=null&&a[0]?L0(c[1][0].data):"",sheets:[]},m=pd(c[2],Bs);return m.forEach(function(x){e[x].forEach(function(o){var E=La(o.meta[1][0].data);E==6e3&&u.sheets.push(aI(e,o))})}),u}function nI(e,n){var a=xd(),c=ci(n.data),u=pd(c[1],Bs);if(u.forEach(function(m){e[m].forEach(function(x){var o=La(x.meta[1][0].data);if(o==2){var E=iI(e,x);E.sheets.forEach(function(w,C){_d(a,w,C==0?E.name:E.name+"_"+C,!0)})}})}),a.SheetNames.length==0)throw new Error("Empty NUMBERS file");return a}function v0(e){var n,a,c,u,m={},x=[];if(e.FullPaths.forEach(function(E){if(E.match(/\.iwpv2/))throw new Error("Unsupported password protection")}),e.FileIndex.forEach(function(E){if(E.name.match(/\.iwa$/)){var w;try{w=KA(E.content)}catch(P){return console.log("?? "+E.content.length+" "+(P.message||P))}var C;try{C=ZA(w)}catch(P){return console.log("## "+(P.message||P))}C.forEach(function(P){m[P.id]=P.messages,x.push(P.id)})}}),!x.length)throw new Error("File has no messages");var o=((u=(c=(a=(n=m?.[1])==null?void 0:n[0])==null?void 0:a.meta)==null?void 0:c[1])==null?void 0:u[0].data)&&La(m[1][0].meta[1][0].data)==1&&m[1][0];if(o||x.forEach(function(E){m[E].forEach(function(w){var C=La(w.meta[1][0].data)>>>0;if(C==1)if(!o)o=w;else throw new Error("Document has multiple roots")})}),!o)throw new Error("Cannot find Document root");return nI(m,o)}function sI(e){return function(a){for(var c=0;c!=e.length;++c){var u=e[c];a[u[0]]===void 0&&(a[u[0]]=u[1]),u[2]==="n"&&(a[u[0]]=Number(a[u[0]]))}}}function md(e){sI([["cellNF",!1],["cellHTML",!0],["cellFormula",!0],["cellStyles",!1],["cellText",!0],["cellDates",!1],["sheetStubs",!1],["sheetRows",0,"n"],["bookDeps",!1],["bookSheets",!1],["bookProps",!1],["bookFiles",!1],["bookVBA",!1],["password",""],["WTF",!1]])(e)}function oI(e){return pl.WS.indexOf(e)>-1?"sheet":e==pl.CS?"chart":e==pl.DS?"dialog":e==pl.MS?"macro":e&&e.length?e:"sheet"}function lI(e,n){if(!e)return 0;try{e=n.map(function(c){return c.id||(c.id=c.strRelID),[c.name,e["!id"][c.id].Target,oI(e["!id"][c.id].Type)]})}catch{return null}return!e||e.length===0?null:e}function cI(e,n,a,c,u,m,x,o,E,w,C,P){try{m[c]=Vc(ji(e,a,!0),n);var M=ka(e,n),O;switch(o){case"sheet":O=mA(M,n,u,E,m[c],w,C,P);break;case"chart":if(O=gA(M,n,u,E,m[c],w,C,P),!O||!O["!drawel"])break;var U=Oc(O["!drawel"].Target,n),z=I0(U),j=pC(ji(e,U,!0),Vc(ji(e,z,!0),U)),ee=Oc(j,U),le=I0(ee);O=J3(ji(e,ee,!0),ee,E,Vc(ji(e,le,!0),ee),w,O);break;case"macro":O=xA(M,n,u,E,m[c],w,C,P);break;case"dialog":O=_A(M,n,u,E,m[c],w,C,P);break;default:throw new Error("Unrecognized sheet type "+o)}x[c]=O;var Z=[];m&&m[c]&&Nn(m[c]).forEach(function(fe){var me="";if(m[c][fe].Type==pl.CMNT){me=Oc(m[c][fe].Target,n);var Te=bA(ka(e,me,!0),me,E);if(!Te||!Te.length)return;dg(O,Te,!1)}m[c][fe].Type==pl.TCMNT&&(me=Oc(m[c][fe].Target,n),Z=Z.concat(gC(ka(e,me,!0),E)))}),Z&&Z.length&&dg(O,Z,!0,E.people||[])}catch(fe){if(E.WTF)throw fe}}function rn(e){return e.charAt(0)=="/"?e.slice(1):e}function uI(e,n){if(x1(),n=n||{},md(n),nn(e,"META-INF/manifest.xml")||nn(e,"objectdata.xml"))return Sg(e,n);if(nn(e,"Index/Document.iwa")){if(typeof Uint8Array>"u")throw new Error("NUMBERS file parsing requires Uint8Array support");if(typeof v0<"u"){if(e.FileIndex)return v0(e);var a=br.utils.cfb_new();return Um(e).forEach(function(ft){hT(a,ft,T1(e,ft))}),v0(a)}throw new Error("Unsupported NUMBERS file")}if(!nn(e,"[Content_Types].xml"))throw nn(e,"index.xml.gz")?new Error("Unsupported NUMBERS 08 file"):nn(e,"index.xml")?new Error("Unsupported NUMBERS 09 file"):new Error("Unsupported ZIP file");var c=Um(e),u=sE(ji(e,"[Content_Types].xml")),m=!1,x,o;if(u.workbooks.length===0&&(o="xl/workbook.xml",ka(e,o,!0)&&u.workbooks.push(o)),u.workbooks.length===0){if(o="xl/workbook.bin",!ka(e,o,!0))throw new Error("Could not find workbook");u.workbooks.push(o),m=!0}u.workbooks[0].slice(-3)=="bin"&&(m=!0);var E={},w={};if(!n.bookSheets&&!n.bookProps){if(Gc=[],u.sst)try{Gc=wA(ka(e,rn(u.sst)),u.sst,n)}catch(ft){if(n.WTF)throw ft}n.cellStyles&&u.themes.length&&(E=vA(ji(e,u.themes[0].replace(/^\//,""),!0)||"",u.themes[0],n)),u.style&&(w=yA(ka(e,rn(u.style)),u.style,E,n))}u.links.map(function(ft){try{var lt=Vc(ji(e,I0(rn(ft))),ft);return EA(ka(e,rn(ft)),lt,ft,n)}catch{}});var C=pA(ka(e,rn(u.workbooks[0])),u.workbooks[0],n),P={},M="";u.coreprops.length&&(M=ka(e,rn(u.coreprops[0]),!0),M&&(P=W1(M)),u.extprops.length!==0&&(M=ka(e,rn(u.extprops[0]),!0),M&&hE(M,P,n)));var O={};(!n.bookSheets||n.bookProps)&&u.custprops.length!==0&&(M=ji(e,rn(u.custprops[0]),!0),M&&(O=dE(M,n)));var U={};if((n.bookSheets||n.bookProps)&&(C.Sheets?x=C.Sheets.map(function(lt){return lt.name}):P.Worksheets&&P.SheetNames.length>0&&(x=P.SheetNames),n.bookProps&&(U.Props=P,U.Custprops=O),n.bookSheets&&typeof x<"u"&&(U.SheetNames=x),n.bookSheets?U.SheetNames:n.bookProps))return U;x={};var z={};n.bookDeps&&u.calcchain&&(z=TA(ka(e,rn(u.calcchain)),u.calcchain));var j=0,ee={},le,Z;{var fe=C.Sheets;P.Worksheets=fe.length,P.SheetNames=[];for(var me=0;me!=fe.length;++me)P.SheetNames[me]=fe[me].name}var Te=m?"bin":"xml",re=u.workbooks[0].lastIndexOf("/"),Ce=(u.workbooks[0].slice(0,re+1)+"_rels/"+u.workbooks[0].slice(re+1)+".rels").replace(/^\//,"");nn(e,Ce)||(Ce="xl/_rels/workbook."+Te+".rels");var be=Vc(ji(e,Ce,!0),Ce.replace(/_rels.*/,"s5s"));(u.metadata||[]).length>=1&&(n.xlmeta=SA(ka(e,rn(u.metadata[0])),u.metadata[0],n)),(u.people||[]).length>=1&&(n.people=xC(ka(e,rn(u.people[0])),n)),be&&(be=lI(be,C.Sheets));var Fe=ka(e,"xl/worksheets/sheet.xml",!0)?1:0;e:for(j=0;j!=P.Worksheets;++j){var Oe="sheet";if(be&&be[j]?(le="xl/"+be[j][1].replace(/[\/]?xl\//,""),nn(e,le)||(le=be[j][1]),nn(e,le)||(le=Ce.replace(/_rels\/.*$/,"")+be[j][1]),Oe=be[j][2]):(le="xl/worksheets/sheet"+(j+1-Fe)+"."+Te,le=le.replace(/sheet0\./,"sheet.")),Z=le.replace(/^(.*)(\/)([^\/]*)$/,"$1/_rels/$3.rels"),n&&n.sheets!=null)switch(typeof n.sheets){case"number":if(j!=n.sheets)continue e;break;case"string":if(P.SheetNames[j].toLowerCase()!=n.sheets.toLowerCase())continue e;break;default:if(Array.isArray&&Array.isArray(n.sheets)){for(var Me=!1,rt=0;rt!=n.sheets.length;++rt)typeof n.sheets[rt]=="number"&&n.sheets[rt]==j&&(Me=1),typeof n.sheets[rt]=="string"&&n.sheets[rt].toLowerCase()==P.SheetNames[j].toLowerCase()&&(Me=1);if(!Me)continue e}}cI(e,le,Z,P.SheetNames[j],j,ee,x,Oe,n,C,E,w)}return U={Directory:u,Workbook:C,Props:P,Custprops:O,Deps:z,Sheets:x,SheetNames:P.SheetNames,Strings:Gc,Styles:w,Themes:E,SSF:Xa(fr)},n&&n.bookFiles&&(e.files?(U.keys=c,U.files=e.files):(U.keys=[],U.files={},e.FullPaths.forEach(function(ft,lt){ft=ft.replace(/^Root Entry[\/]/,""),U.keys.push(ft),U.files[ft]=e.FileIndex[lt]}))),n&&n.bookVBA&&(u.vba.length>0?U.vbaraw=ka(e,rn(u.vba[0]),!0):u.defaults&&u.defaults.bin===wC&&(U.vbaraw=ka(e,"xl/vbaProject.bin",!0))),U}function hI(e,n){var a=n||{},c="Workbook",u=br.find(e,c);try{if(c="/!DataSpaces/Version",u=br.find(e,c),!u||!u.content)throw new Error("ECMA-376 Encrypted file missing "+c);if(ak(u.content),c="/!DataSpaces/DataSpaceMap",u=br.find(e,c),!u||!u.content)throw new Error("ECMA-376 Encrypted file missing "+c);var m=nk(u.content);if(m.length!==1||m[0].comps.length!==1||m[0].comps[0].t!==0||m[0].name!=="StrongEncryptionDataSpace"||m[0].comps[0].v!=="EncryptedPackage")throw new Error("ECMA-376 Encrypted file bad "+c);if(c="/!DataSpaces/DataSpaceInfo/StrongEncryptionDataSpace",u=br.find(e,c),!u||!u.content)throw new Error("ECMA-376 Encrypted file missing "+c);var x=sk(u.content);if(x.length!=1||x[0]!="StrongEncryptionTransform")throw new Error("ECMA-376 Encrypted file bad "+c);if(c="/!DataSpaces/TransformInfo/StrongEncryptionTransform/!Primary",u=br.find(e,c),!u||!u.content)throw new Error("ECMA-376 Encrypted file missing "+c);lk(u.content)}catch{}if(c="/EncryptionInfo",u=br.find(e,c),!u||!u.content)throw new Error("ECMA-376 Encrypted file missing "+c);var o=ck(u.content);if(c="/EncryptedPackage",u=br.find(e,c),!u||!u.content)throw new Error("ECMA-376 Encrypted file missing "+c);if(o[0]==4&&typeof decrypt_agile<"u")return decrypt_agile(o[1],u.content,a.password||"",a);if(o[0]==2&&typeof decrypt_std76<"u")return decrypt_std76(o[1],u.content,a.password||"",a);throw new Error("File is password-protected")}function gd(e,n){var a="";switch((n||{}).type||"base64"){case"buffer":return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]];case"base64":a=qi(e.slice(0,12));break;case"binary":a=e;break;case"array":return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]];default:throw new Error("Unrecognized type "+(n&&n.type||"undefined"))}return[a.charCodeAt(0),a.charCodeAt(1),a.charCodeAt(2),a.charCodeAt(3),a.charCodeAt(4),a.charCodeAt(5),a.charCodeAt(6),a.charCodeAt(7)]}function fI(e,n){return br.find(e,"EncryptedPackage")?hI(e,n):Px(e,n)}function dI(e,n){var a,c=e,u=n||{};return u.type||(u.type=wr&&Buffer.isBuffer(e)?"buffer":"base64"),a=E1(c,u),uI(a,u)}function Rx(e,n){var a=0;e:for(;a<e.length;)switch(e.charCodeAt(a)){case 10:case 13:case 32:++a;break;case 60:return M0(e.slice(a),n);default:break e}return eu.to_workbook(e,n)}function pI(e,n){var a="",c=gd(e,n);switch(n.type){case"base64":a=qi(e);break;case"binary":a=e;break;case"buffer":a=e.toString("binary");break;case"array":a=yo(e);break;default:throw new Error("Unrecognized type "+n.type)}return c[0]==239&&c[1]==187&&c[2]==191&&(a=Zr(a)),n.type="binary",Rx(a,n)}function mI(e,n){var a=e;return n.type=="base64"&&(a=qi(a)),a=Fs.utils.decode(1200,a.slice(2),"str"),n.type="binary",Rx(a,n)}function gI(e){return e.match(/[^\x00-\x7F]/)?Bc(e):e}function w0(e,n,a,c){return c?(a.type="string",eu.to_workbook(e,a)):eu.to_workbook(n,a)}function O0(e,n){n1();var a=n||{};if(typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer)return O0(new Uint8Array(e),(a=Xa(a),a.type="array",a));typeof Uint8Array<"u"&&e instanceof Uint8Array&&!a.type&&(a.type=typeof Deno<"u"?"buffer":"array");var c=e,u=[0,0,0,0],m=!1;if(a.cellStyles&&(a.cellNF=!0,a.sheetStubs=!0),xl={},a.dateNF&&(xl.dateNF=a.dateNF),a.type||(a.type=wr&&Buffer.isBuffer(e)?"buffer":"base64"),a.type=="file"&&(a.type=wr?"buffer":"binary",c=iT(e),typeof Uint8Array<"u"&&!wr&&(a.type="array")),a.type=="string"&&(m=!0,a.type="binary",a.codepage=65001,c=gI(e)),a.type=="array"&&typeof Uint8Array<"u"&&e instanceof Uint8Array&&typeof ArrayBuffer<"u"){var x=new ArrayBuffer(3),o=new Uint8Array(x);if(o.foo="bar",!o.foo)return a=Xa(a),a.type="array",O0(Z0(c),a)}switch((u=gd(c,a))[0]){case 208:if(u[1]===207&&u[2]===17&&u[3]===224&&u[4]===161&&u[5]===177&&u[6]===26&&u[7]===225)return fI(br.read(c,a),a);break;case 9:if(u[1]<=8)return Px(c,a);break;case 60:return M0(c,a);case 73:if(u[1]===73&&u[2]===42&&u[3]===0)throw new Error("TIFF Image File is not a spreadsheet");if(u[1]===68)return GS(c,a);break;case 84:if(u[1]===65&&u[2]===66&&u[3]===76)return $S.to_workbook(c,a);break;case 80:return u[1]===75&&u[2]<9&&u[3]<9?dI(c,a):w0(e,c,a,m);case 239:return u[3]===60?M0(c,a):w0(e,c,a,m);case 255:if(u[1]===254)return mI(c,a);if(u[1]===0&&u[2]===2&&u[3]===0)return jc.to_workbook(c,a);break;case 0:if(u[1]===0&&(u[2]>=2&&u[3]===0||u[2]===0&&(u[3]===8||u[3]===9)))return jc.to_workbook(c,a);break;case 3:case 131:case 139:case 140:return fg.to_workbook(c,a);case 123:if(u[1]===92&&u[2]===114&&u[3]===116)return wk.to_workbook(c,a);break;case 10:case 13:case 32:return pI(c,a);case 137:if(u[1]===80&&u[2]===78&&u[3]===71)throw new Error("PNG Image File is not a spreadsheet");break}return US.indexOf(u[0])>-1&&u[2]<=12&&u[3]<=31?fg.to_workbook(c,a):w0(e,c,a,m)}function xI(e,n,a,c,u,m,x,o){var E=Ka(a),w=o.defval,C=o.raw||!Object.prototype.hasOwnProperty.call(o,"raw"),P=!0,M=u===1?[]:{};if(u!==1)if(Object.defineProperty)try{Object.defineProperty(M,"__rowNum__",{value:a,enumerable:!1})}catch{M.__rowNum__=a}else M.__rowNum__=a;if(!x||e[a])for(var O=n.s.c;O<=n.e.c;++O){var U=x?e[a][O]:e[c[O]+E];if(U===void 0||U.t===void 0){if(w===void 0)continue;m[O]!=null&&(M[m[O]]=w);continue}var z=U.v;switch(U.t){case"z":if(z==null)break;continue;case"e":z=z==0?null:void 0;break;case"s":case"d":case"b":case"n":break;default:throw new Error("unrecognized type "+U.t)}if(m[O]!=null){if(z==null)if(U.t=="e"&&z===null)M[m[O]]=null;else if(w!==void 0)M[m[O]]=w;else if(C&&z===null)M[m[O]]=null;else continue;else M[m[O]]=C&&(U.t!=="n"||U.t==="n"&&o.rawNumbers!==!1)?z:ls(U,z,o);z!=null&&(P=!1)}}return{row:M,isempty:P}}function B0(e,n){if(e==null||e["!ref"]==null)return[];var a={t:"n",v:0},c=0,u=1,m=[],x=0,o="",E={s:{r:0,c:0},e:{r:0,c:0}},w=n||{},C=w.range!=null?w.range:e["!ref"];switch(w.header===1?c=1:w.header==="A"?c=2:Array.isArray(w.header)?c=3:w.header==null&&(c=0),typeof C){case"string":E=da(C);break;case"number":E=da(e["!ref"]),E.s.r=C;break;default:E=C}c>0&&(u=0);var P=Ka(E.s.r),M=[],O=[],U=0,z=0,j=Array.isArray(e),ee=E.s.r,le=0,Z={};j&&!e[ee]&&(e[ee]=[]);var fe=w.skipHidden&&e["!cols"]||[],me=w.skipHidden&&e["!rows"]||[];for(le=E.s.c;le<=E.e.c;++le)if(!(fe[le]||{}).hidden)switch(M[le]=Da(le),a=j?e[ee][le]:e[M[le]+P],c){case 1:m[le]=le-E.s.c;break;case 2:m[le]=M[le];break;case 3:m[le]=w.header[le-E.s.c];break;default:if(a==null&&(a={w:"__EMPTY",t:"s"}),o=x=ls(a,null,w),z=Z[x]||0,!z)Z[x]=1;else{do o=x+"_"+z++;while(Z[o]);Z[x]=z,Z[o]=1}m[le]=o}for(ee=E.s.r+u;ee<=E.e.r;++ee)if(!(me[ee]||{}).hidden){var Te=xI(e,E,ee,M,c,m,j,w);(Te.isempty===!1||(c===1?w.blankrows!==!1:w.blankrows))&&(O[U++]=Te.row)}return O.length=U,O}var Ig=/"/g;function _I(e,n,a,c,u,m,x,o){for(var E=!0,w=[],C="",P=Ka(a),M=n.s.c;M<=n.e.c;++M)if(c[M]){var O=o.dense?(e[a]||[])[M]:e[c[M]+P];if(O==null)C="";else if(O.v!=null){E=!1,C=""+(o.rawNumbers&&O.t=="n"?O.v:ls(O,null,o));for(var U=0,z=0;U!==C.length;++U)if((z=C.charCodeAt(U))===u||z===m||z===34||o.forceQuotes){C='"'+C.replace(Ig,'""')+'"';break}C=="ID"&&(C='"ID"')}else O.f!=null&&!O.F?(E=!1,C="="+O.f,C.indexOf(",")>=0&&(C='"'+C.replace(Ig,'""')+'"')):C="";w.push(C)}return o.blankrows===!1&&E?null:w.join(x)}function Ox(e,n){var a=[],c=n??{};if(e==null||e["!ref"]==null)return"";var u=da(e["!ref"]),m=c.FS!==void 0?c.FS:",",x=m.charCodeAt(0),o=c.RS!==void 0?c.RS:`
`,E=o.charCodeAt(0),w=new RegExp((m=="|"?"\\|":m)+"+$"),C="",P=[];c.dense=Array.isArray(e);for(var M=c.skipHidden&&e["!cols"]||[],O=c.skipHidden&&e["!rows"]||[],U=u.s.c;U<=u.e.c;++U)(M[U]||{}).hidden||(P[U]=Da(U));for(var z=0,j=u.s.r;j<=u.e.r;++j)(O[j]||{}).hidden||(C=_I(e,u,j,P,x,E,m,c),C!=null&&(c.strip&&(C=C.replace(w,"")),(C||c.blankrows!==!1)&&a.push((z++?o:"")+C)));return delete c.dense,a.join("")}function yI(e,n){n||(n={}),n.FS="	",n.RS=`
`;var a=Ox(e,n);return a}function vI(e){var n="",a,c="";if(e==null||e["!ref"]==null)return[];var u=da(e["!ref"]),m="",x=[],o,E=[],w=Array.isArray(e);for(o=u.s.c;o<=u.e.c;++o)x[o]=Da(o);for(var C=u.s.r;C<=u.e.r;++C)for(m=Ka(C),o=u.s.c;o<=u.e.c;++o)if(n=x[o]+m,a=w?(e[C]||[])[o]:e[n],c="",a!==void 0){if(a.F!=null){if(n=a.F,!a.f)continue;c=a.f,n.indexOf(":")==-1&&(n=n+":"+n)}if(a.f!=null)c=a.f;else{if(a.t=="z")continue;if(a.t=="n"&&a.v!=null)c=""+a.v;else if(a.t=="b")c=a.v?"TRUE":"FALSE";else if(a.w!==void 0)c="'"+a.w;else{if(a.v===void 0)continue;a.t=="s"?c="'"+a.v:c=""+a.v}}E[E.length]=n+"="+c}return E}function Bx(e,n,a){var c=a||{},u=+!c.skipHeader,m=e||{},x=0,o=0;if(m&&c.origin!=null)if(typeof c.origin=="number")x=c.origin;else{var E=typeof c.origin=="string"?Si(c.origin):c.origin;x=E.r,o=E.c}var w,C={s:{c:0,r:0},e:{c:o,r:x+n.length-1+u}};if(m["!ref"]){var P=da(m["!ref"]);C.e.c=Math.max(C.e.c,P.e.c),C.e.r=Math.max(C.e.r,P.e.r),x==-1&&(x=P.e.r+1,C.e.r=x+n.length-1+u)}else x==-1&&(x=0,C.e.r=n.length-1+u);var M=c.header||[],O=0;n.forEach(function(z,j){Nn(z).forEach(function(ee){(O=M.indexOf(ee))==-1&&(M[O=M.length]=ee);var le=z[ee],Z="z",fe="",me=or({c:o+O,r:x+j+u});w=iu(m,me),le&&typeof le=="object"&&!(le instanceof Date)?m[me]=le:(typeof le=="number"?Z="n":typeof le=="boolean"?Z="b":typeof le=="string"?Z="s":le instanceof Date?(Z="d",c.cellDates||(Z="n",le=Ci(le)),fe=c.dateNF||fr[14]):le===null&&c.nullError&&(Z="e",le=0),w?(w.t=Z,w.v=le,delete w.w,delete w.R,fe&&(w.z=fe)):m[me]=w={t:Z,v:le},fe&&(w.z=fe))})}),C.e.c=Math.max(C.e.c,o+M.length-1);var U=Ka(x);if(u)for(O=0;O<M.length;++O)m[Da(O+o)+U]={t:"s",v:M[O]};return m["!ref"]=Tr(C),m}function wI(e,n){return Bx(null,e,n)}function iu(e,n,a){if(typeof n=="string"){if(Array.isArray(e)){var c=Si(n);return e[c.r]||(e[c.r]=[]),e[c.r][c.c]||(e[c.r][c.c]={t:"z"})}return e[n]||(e[n]={t:"z"})}return typeof n!="number"?iu(e,or(n)):iu(e,or({r:n,c:a||0}))}function bI(e,n){if(typeof n=="number"){if(n>=0&&e.SheetNames.length>n)return n;throw new Error("Cannot find sheet # "+n)}else if(typeof n=="string"){var a=e.SheetNames.indexOf(n);if(a>-1)return a;throw new Error("Cannot find sheet name |"+n+"|")}else throw new Error("Cannot find sheet |"+n+"|")}function xd(){return{SheetNames:[],Sheets:{}}}function _d(e,n,a,c){var u=1;if(!a)for(;u<=65535&&e.SheetNames.indexOf(a="Sheet"+u)!=-1;++u,a=void 0);if(!a||e.SheetNames.length>=65535)throw new Error("Too many worksheets");if(c&&e.SheetNames.indexOf(a)>=0){var m=a.match(/(^.*?)(\d+)$/);u=m&&+m[2]||0;var x=m&&m[1]||a;for(++u;u<=65535&&e.SheetNames.indexOf(a=x+u)!=-1;++u);}if(sA(a),e.SheetNames.indexOf(a)>=0)throw new Error("Worksheet with name |"+a+"| already exists!");return e.SheetNames.push(a),e.Sheets[a]=n,a}function TI(e,n,a){e.Workbook||(e.Workbook={}),e.Workbook.Sheets||(e.Workbook.Sheets=[]);var c=bI(e,n);switch(e.Workbook.Sheets[c]||(e.Workbook.Sheets[c]={}),a){case 0:case 1:case 2:break;default:throw new Error("Bad sheet visibility setting "+a)}e.Workbook.Sheets[c].Hidden=a}function EI(e,n){return e.z=n,e}function zx(e,n,a){return n?(e.l={Target:n},a&&(e.l.Tooltip=a)):delete e.l,e}function SI(e,n,a){return zx(e,"#"+n,a)}function kI(e,n,a){e.c||(e.c=[]),e.c.push({t:n,a:a||"SheetJS"})}function CI(e,n,a,c){for(var u=typeof n!="string"?n:da(n),m=typeof n=="string"?n:Tr(n),x=u.s.r;x<=u.e.r;++x)for(var o=u.s.c;o<=u.e.c;++o){var E=iu(e,x,o);E.t="n",E.F=m,delete E.v,x==u.s.r&&o==u.s.c&&(E.f=a,c&&(E.D=!0))}return e}var AI={encode_col:Da,encode_row:Ka,encode_cell:or,encode_range:Tr,decode_col:ad,decode_row:rd,split_cell:NT,decode_cell:Si,decode_range:Sl,format_cell:ls,sheet_add_aoa:$1,sheet_add_json:Bx,sheet_add_dom:Mx,aoa_to_sheet:kl,json_to_sheet:wI,table_to_sheet:Dx,table_to_book:GA,sheet_to_csv:Ox,sheet_to_txt:yI,sheet_to_json:B0,sheet_to_html:jA,sheet_to_formulae:vI,sheet_to_row_object_array:B0,sheet_get_cell:iu,book_new:xd,book_append_sheet:_d,book_set_sheet_visibility:TI,cell_set_number_format:EI,cell_set_hyperlink:zx,cell_set_internal_link:SI,cell_add_comment:kI,sheet_set_array_formula:CI,consts:{SHEET_VISIBLE:0,SHEET_HIDDEN:1,SHEET_VERY_HIDDEN:2}};function II({listCustomer:e,handleCustomer:n}){const[a,c]=Kc.useMessage(),[u,m]=ue.useState("list"),[x,o]=ue.useState(!1),[E,w]=ue.useState(!1);ue.useState();const[C,P]=ue.useState([]),M=le=>{a.open({type:"warning",content:le})},O=()=>{a.open({type:"error",content:"Error"})},U=le=>{switch(le){case"Choose":o(!1);break;case"Import":w(!1);break;default:o(!1),w(!1)}},z=le=>{switch(le){case"Choose":o(!0);break;case"Import":w(!0);break}},j=async le=>{const Z=new FileReader;Z.onload=fe=>{const me=new Uint8Array(fe.target.result),Te=O0(me,{type:"array"}),re=Te.SheetNames[0],Ce=Te.Sheets[re],be=AI.sheet_to_json(Ce);console.log("json_data",be),P(be)},Z.readAsArrayBuffer(le)},ee=async()=>{const Z=a1(C,["Mã khách hàng","Thứ tự VT","Tần suất"],{isNull:!1}).map(fe=>fe["Mã khách hàng"]).filter(fe=>!!fe&&!e.map(me=>me.customer_code).includes(fe));try{const fe=await Tn.post("/api/method/mbw_dms.api.router.get_customer_import",{customer_codes:Z});console.log("rsImport:::",fe),n(me=>[...me,...fe.result]),M(fe.message),w(!1)}catch{O()}};return Ye.jsxs(Ye.Fragment,{children:[Ye.jsxs(mo,{gutter:16,className:"justify-between p-4 pb-5 pt-10 mt-0",children:[Ye.jsx(Ti,{children:Ye.jsxs(mo,{gutter:8,children:[Ye.jsx(Ti,{span:9,className:"text-[#1677ff]",children:Ye.jsx(Ri,{children:Ye.jsx(nv,{defaultValue:"add",options:Fw,onSelect:z})})}),Ye.jsx(Ti,{span:7,children:Ye.jsx(po,{className:"w-full flex items-center text-[#1677ff] bg-[#1877f214] h-[36px]",icon:Ye.jsx(Ew,{}),children:"Tối ưu tuyến"})}),Ye.jsx(Ti,{span:8,children:Ye.jsx(Ri,{children:Ye.jsx(Ih,{placeholder:"Tìm kiếm khách hàng",prefix:Ye.jsx(jg,{})})})})]})}),Ye.jsxs(Ti,{children:[" ",Ye.jsxs(i0.Group,{defaultValue:u,onChange:le=>m(le.target.value),size:"middle",children:[Ye.jsx(i0.Button,{value:"list",children:Ye.jsx(kw,{size:28})}),Ye.jsx(i0.Button,{value:"map",children:Ye.jsx(Sw,{size:28})})]})]})]}),Ye.jsx("div",{children:u=="list"?Ye.jsx(Ow,{data:e,handleData:n}):Ye.jsx(bb,{data:e})}),Ye.jsx(S0,{width:1240,open:x,onCancel:U.bind(null,"Choose"),title:Ye.jsx("strong",{className:"text-xl",children:"Chọn khách hàng"}),footer:!1,children:Ye.jsx(Cb,{selected:e,handleAdd:n,closeModal:o.bind(null,!1)})}),Ye.jsx(S0,{width:777,open:E,onCancel:U.bind(null,"Import"),okText:"Tiếp tục",cancelText:"Hủy",title:Ye.jsxs(Ye.Fragment,{children:[Ye.jsx("strong",{className:"text-xl",children:"Nhập dữ liệu khách hàng"}),Ye.jsx("br",{}),Ye.jsxs(po,{type:"link",className:"px-0",children:["Tải về file mẫu ",Ye.jsx(Jg,{})]})]}),onOk:ee,children:Ye.jsx(Eb,{handleFile:j})})]})}function FI(){const[e]=E0.useForm(),n=sv(),{type:a}=ov(),[c,u]=ue.useState([]),[m,x]=Kc.useMessage(),[o,E]=ue.useState(),w=()=>{m.open({type:"success",content:"Success!!"})},C=()=>{m.open({type:"error",content:"Something was wrong"})},P=ue.useCallback(async O=>{O={...O,customers:c.map(U=>{let z=["customer_id","customer_name","display_address","phone_number","customer","frequency"];for(let j in U)z.includes(j)||delete U[j];return U})};try{await Tn.post("/api/method/mbw_dms.api.router.create_router",O),w(),n("/")}catch(U){C(),console.log("error create",U)}},[c]),M=ue.useCallback(async O=>{O={...O,customers:c.map(U=>{let z=["customer_id","customer_name","display_address","phone_number","customer","frequency"];for(let j in U)z.includes(j)||delete U[j];return U})};try{await Tn.patch("/api/method/mbw_dms.api.router.update_router",{name:a,...O}),w(),n("/router-control")}catch(U){C(),console.log("error create",U)}},[c]);return ue.useEffect(()=>{a!=="create-dms-router"&&(async()=>{const O=await Tn.get("/api/method/mbw_dms.api.router.get_router",{params:{id:a}});E(O.result),O.result&&e.setFieldsValue(O.result),u(O.result?.customers||[])})()},[a]),Ye.jsxs(Ye.Fragment,{children:[x,Ye.jsx(mv,{title:"Thêm tuyến",buttons:[o?{label:"Lưu",action:e.submit,type:"primary"}:{label:"Thêm",action:e.submit,type:"primary"}]}),Ye.jsx("div",{className:"bg-white rounded-md",children:Ye.jsx(E0,{layout:"vertical",form:e,onFinish:o?M:P,children:Ye.jsx(fv,{defaultActiveKey:"1",items:[{label:Ye.jsx("p",{className:"px-4 mb-0",children:" Thông tin chung"}),key:"1",children:Ye.jsx(Rw,{form:e})},{label:Ye.jsx("p",{className:"px-4 mb-0",children:"Khách hàng"}),key:"2",children:Ye.jsx(II,{handleCustomer:u,listCustomer:c})}],indicatorSize:O=>O-18})})})]})}function OI(){return Ye.jsxs(Ye.Fragment,{children:[Ye.jsx(lv,{children:Ye.jsx("title",{children:" RouterControll"})}),Ye.jsx(FI,{})]})}export{OI as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/mapbox-gl-lA8sAnvA.js","assets/index-KwWGhUjE.js","assets/index-7NPlJOl2.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
