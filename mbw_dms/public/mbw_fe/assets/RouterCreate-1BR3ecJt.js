import{r as k,V as La,k as mi,_ as ii,h as _t,f as si,K as ln,R as ti,l as Hn,ac as hm,ad as za,j as ri,a as qi,ae as hl,y as es,z as ts,af as vn,D as ao,ag as Fh,X as xn,Z as oo,ah as jc,a7 as Vc,ai as Nh,aj as Ah,ak as so,al as dm,am as R_,W as ha,an as pm,ao as fm,ap as fl,aq as $_,v as mm,ar as Fp,as as O_,at as gm,x as ym,a2 as Uc,au as _m,av as B_,aw as F_,ax as N_,E as nt,ay as jh,az as j_,a4 as V_,aA as U_,aB as q_,aC as G_,aD as dl,aE as vm,aF as Vh,aG as Uh,aH as xm,aI as Z_,aJ as qh,aK as ml,aL as bm,w as Np,aM as H_,aN as W_,aO as X_,aP as K_,aQ as nh,aR as Y_,m as kh,aS as J_,O as jp,N as Gh,$ as Q_,aT as ev,aU as tv,aV as zh,aW as wm,aX as iv,aY as rv,d as nv,o as Sm,p as Cm,q as Tm,s as sn,t as Em,aZ as av,a_ as Vp,a$ as Up,b0 as ov,b1 as sv,b2 as lv,b3 as cv,b4 as qp,b5 as Gp,a0 as uv,a9 as Pe,b6 as no,g as Im,b7 as Ur,b8 as Qr,b9 as Rc,ba as zn,bb as Zh,bc as hv,c as dv,bd as Lh,be as pv,bf as Pm,bg as fv,bh as mv,bi as ah,bj as gv,ab as yv}from"./index-PSZGKfBk.js";import{L as _v,a as vv}from"./index.esm-3bFrInlX.js";import{H as xv}from"./header-page-koL6qljG.js";var bv={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm32 664c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V456c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v272zm-32-344a48.01 48.01 0 010-96 48.01 48.01 0 010 96z"}}]},name:"info-circle",theme:"filled"};const wv=bv;var Sv=function(h,y){return k.createElement(La,mi({},h,{ref:y,icon:wv}))};const Hh=k.forwardRef(Sv);var Wh=k.forwardRef(function(s,h){var y=s.prefixCls,x=s.style,w=s.className,E=s.duration,z=E===void 0?4.5:E,o=s.eventKey,O=s.content,L=s.closable,V=s.closeIcon,q=V===void 0?"x":V,Q=s.props,ae=s.onClick,fe=s.onNoticeClose,me=s.times,xe=s.hovering,ve=k.useState(!1),be=ii(ve,2),ge=be[0],ce=be[1],Se=xe||ge,ze=function(){fe(o)},Be=function(Ce){(Ce.key==="Enter"||Ce.code==="Enter"||Ce.keyCode===ln.ENTER)&&ze()};k.useEffect(function(){if(!Se&&z>0){var De=setTimeout(function(){ze()},z*1e3);return function(){clearTimeout(De)}}},[z,Se,me]);var $e="".concat(y,"-notice");return k.createElement("div",mi({},Q,{ref:h,className:_t($e,w,si({},"".concat($e,"-closable"),L)),style:x,onMouseEnter:function(Ce){var je;ce(!0),Q==null||(je=Q.onMouseEnter)===null||je===void 0||je.call(Q,Ce)},onMouseLeave:function(Ce){var je;ce(!1),Q==null||(je=Q.onMouseLeave)===null||je===void 0||je.call(Q,Ce)},onClick:ae}),k.createElement("div",{className:"".concat($e,"-content")},O),L&&k.createElement("a",{tabIndex:0,className:"".concat($e,"-close"),onKeyDown:Be,onClick:function(Ce){Ce.preventDefault(),Ce.stopPropagation(),ze()}},q))}),Mm=ti.createContext({}),Am=function(h){var y=h.children,x=h.classNames;return ti.createElement(Mm.Provider,{value:{classNames:x}},y)},Zp=8,Hp=3,Wp=16,Cv=function(h){var y={offset:Zp,threshold:Hp,gap:Wp};if(h&&Hn(h)==="object"){var x,w,E;y.offset=(x=h.offset)!==null&&x!==void 0?x:Zp,y.threshold=(w=h.threshold)!==null&&w!==void 0?w:Hp,y.gap=(E=h.gap)!==null&&E!==void 0?E:Wp}return[!!h,y]},Tv=["className","style","classNames","styles"],Ev=function(h){var y,x=h.configList,w=h.placement,E=h.prefixCls,z=h.className,o=h.style,O=h.motion,L=h.onAllNoticeRemoved,V=h.onNoticeClose,q=h.stack,Q=k.useContext(Mm),ae=Q.classNames,fe=k.useRef({}),me=k.useState(null),xe=ii(me,2),ve=xe[0],be=xe[1],ge=k.useState([]),ce=ii(ge,2),Se=ce[0],ze=ce[1],Be=x.map(function(st){return{config:st,key:String(st.key)}}),$e=Cv(q),De=ii($e,2),Ce=De[0],je=De[1],Ge=je.offset,tt=je.threshold,He=je.gap,ot=Ce&&(Se.length>0||Be.length<=tt),Tt=typeof O=="function"?O(w):O;return k.useEffect(function(){Ce&&Se.length>1&&ze(function(st){return st.filter(function(jt){return Be.some(function(At){var Qt=At.key;return jt===Qt})})})},[Se,Be,Ce]),k.useEffect(function(){var st;if(Ce&&fe.current[(st=Be[Be.length-1])===null||st===void 0?void 0:st.key]){var jt;be(fe.current[(jt=Be[Be.length-1])===null||jt===void 0?void 0:jt.key])}},[Be,Ce]),ti.createElement(hm,mi({key:w,className:_t(E,"".concat(E,"-").concat(w),ae?.list,z,(y={},si(y,"".concat(E,"-stack"),!!Ce),si(y,"".concat(E,"-stack-expanded"),ot),y)),style:o,keys:Be,motionAppear:!0},Tt,{onAllRemoved:function(){L(w)}}),function(st,jt){var At=st.config,Qt=st.className,Gt=st.style,ft=st.index,Oe=At,gt=Oe.key,Bt=Oe.times,wt=String(gt),$t=At,Yt=$t.className,ei=$t.style,kt=$t.classNames,gi=$t.styles,pi=za($t,Tv),Pt=Be.findIndex(function(Gi){return Gi.key===wt}),li={};if(Ce){var Xi=Be.length-1-(Pt>-1?Pt:ft-1),Ht=w==="top"||w==="bottom"?"-50%":"0";if(Xi>0){var Mi,Fi,gr;li.height=ot?(Mi=fe.current[wt])===null||Mi===void 0?void 0:Mi.offsetHeight:ve?.offsetHeight;for(var Te=0,bi=0;bi<Xi;bi++){var Li;Te+=((Li=fe.current[Be[Be.length-1-bi].key])===null||Li===void 0?void 0:Li.offsetHeight)+He}var Wt=(ot?Te:Xi*Ge)*(w.startsWith("top")?1:-1),Ft=!ot&&ve!==null&&ve!==void 0&&ve.offsetWidth&&(Fi=fe.current[wt])!==null&&Fi!==void 0&&Fi.offsetWidth?(ve?.offsetWidth-Ge*2*(Xi<3?Xi:3))/((gr=fe.current[wt])===null||gr===void 0?void 0:gr.offsetWidth):1;li.transform="translate3d(".concat(Ht,", ").concat(Wt,"px, 0) scaleX(").concat(Ft,")")}else li.transform="translate3d(".concat(Ht,", 0, 0)")}return ti.createElement("div",{ref:jt,className:_t("".concat(E,"-notice-wrapper"),Qt,kt?.wrapper),style:ri(ri(ri({},Gt),li),gi?.wrapper),onMouseEnter:function(){return ze(function(Ki){return Ki.includes(wt)?Ki:[].concat(qi(Ki),[wt])})},onMouseLeave:function(){return ze(function(Ki){return Ki.filter(function(yi){return yi!==wt})})}},ti.createElement(Wh,mi({},pi,{ref:function(Ki){Pt>-1?fe.current[wt]=Ki:delete fe.current[wt]},prefixCls:E,classNames:kt,styles:gi,className:_t(Yt,ae?.notice),style:ei,times:Bt,key:gt,eventKey:gt,onNoticeClose:V,hovering:Ce&&Se.length>0})))})},Iv=k.forwardRef(function(s,h){var y=s.prefixCls,x=y===void 0?"rc-notification":y,w=s.container,E=s.motion,z=s.maxCount,o=s.className,O=s.style,L=s.onAllRemoved,V=s.stack,q=s.renderNotifications,Q=k.useState([]),ae=ii(Q,2),fe=ae[0],me=ae[1],xe=function(De){var Ce,je=fe.find(function(Ge){return Ge.key===De});je==null||(Ce=je.onClose)===null||Ce===void 0||Ce.call(je),me(function(Ge){return Ge.filter(function(tt){return tt.key!==De})})};k.useImperativeHandle(h,function(){return{open:function(De){me(function(Ce){var je=qi(Ce),Ge=je.findIndex(function(ot){return ot.key===De.key}),tt=ri({},De);if(Ge>=0){var He;tt.times=(((He=Ce[Ge])===null||He===void 0?void 0:He.times)||0)+1,je[Ge]=tt}else tt.times=0,je.push(tt);return z>0&&je.length>z&&(je=je.slice(-z)),je})},close:function(De){xe(De)},destroy:function(){me([])}}});var ve=k.useState({}),be=ii(ve,2),ge=be[0],ce=be[1];k.useEffect(function(){var $e={};fe.forEach(function(De){var Ce=De.placement,je=Ce===void 0?"topRight":Ce;je&&($e[je]=$e[je]||[],$e[je].push(De))}),Object.keys(ge).forEach(function(De){$e[De]=$e[De]||[]}),ce($e)},[fe]);var Se=function(De){ce(function(Ce){var je=ri({},Ce),Ge=je[De]||[];return Ge.length||delete je[De],je})},ze=k.useRef(!1);if(k.useEffect(function(){Object.keys(ge).length>0?ze.current=!0:ze.current&&(L?.(),ze.current=!1)},[ge]),!w)return null;var Be=Object.keys(ge);return hl.createPortal(k.createElement(k.Fragment,null,Be.map(function($e){var De=ge[$e],Ce=k.createElement(Ev,{key:$e,configList:De,placement:$e,prefixCls:x,className:o?.($e),style:O?.($e),motion:E,onNoticeClose:xe,onAllNoticeRemoved:Se,stack:V});return q?q(Ce,{prefixCls:x,key:$e}):Ce})),w)}),Pv=["getContainer","motion","prefixCls","maxCount","className","style","onAllRemoved","stack","renderNotifications"],Mv=function(){return document.body},Xp=0;function Av(){for(var s={},h=arguments.length,y=new Array(h),x=0;x<h;x++)y[x]=arguments[x];return y.forEach(function(w){w&&Object.keys(w).forEach(function(E){var z=w[E];z!==void 0&&(s[E]=z)})}),s}function km(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},h=s.getContainer,y=h===void 0?Mv:h,x=s.motion,w=s.prefixCls,E=s.maxCount,z=s.className,o=s.style,O=s.onAllRemoved,L=s.stack,V=s.renderNotifications,q=za(s,Pv),Q=k.useState(),ae=ii(Q,2),fe=ae[0],me=ae[1],xe=k.useRef(),ve=k.createElement(Iv,{container:fe,ref:xe,prefixCls:w,motion:x,maxCount:E,className:z,style:o,onAllRemoved:O,stack:L,renderNotifications:V}),be=k.useState([]),ge=ii(be,2),ce=ge[0],Se=ge[1],ze=k.useMemo(function(){return{open:function($e){var De=Av(q,$e);(De.key===null||De.key===void 0)&&(De.key="rc-notification-".concat(Xp),Xp+=1),Se(function(Ce){return[].concat(qi(Ce),[{type:"open",config:De}])})},close:function($e){Se(function(De){return[].concat(qi(De),[{type:"close",key:$e}])})},destroy:function(){Se(function($e){return[].concat(qi($e),[{type:"destroy"}])})}}},[]);return k.useEffect(function(){me(y())}),k.useEffect(function(){xe.current&&ce.length&&(ce.forEach(function(Be){switch(Be.type){case"open":xe.current.open(Be.config);break;case"close":xe.current.close(Be.key);break;case"destroy":xe.current.destroy();break}}),Se(function(Be){return Be.filter(function($e){return!ce.includes($e)})}))},[ce]),[ze,ve]}const kv=s=>{const{componentCls:h,iconCls:y,boxShadow:x,colorText:w,colorSuccess:E,colorError:z,colorWarning:o,colorInfo:O,fontSizeLG:L,motionEaseInOutCirc:V,motionDurationSlow:q,marginXS:Q,paddingXS:ae,borderRadiusLG:fe,zIndexPopup:me,contentPadding:xe,contentBg:ve}=s,be=`${h}-notice`,ge=new vn("MessageMoveIn",{"0%":{padding:0,transform:"translateY(-100%)",opacity:0},"100%":{padding:ae,transform:"translateY(0)",opacity:1}}),ce=new vn("MessageMoveOut",{"0%":{maxHeight:s.height,padding:ae,opacity:1},"100%":{maxHeight:0,padding:0,opacity:0}}),Se={padding:ae,textAlign:"center",[`${h}-custom-content > ${y}`]:{verticalAlign:"text-bottom",marginInlineEnd:Q,fontSize:L},[`${be}-content`]:{display:"inline-block",padding:xe,background:ve,borderRadius:fe,boxShadow:x,pointerEvents:"all"},[`${h}-success > ${y}`]:{color:E},[`${h}-error > ${y}`]:{color:z},[`${h}-warning > ${y}`]:{color:o},[`${h}-info > ${y},
      ${h}-loading > ${y}`]:{color:O}};return[{[h]:Object.assign(Object.assign({},ao(s)),{color:w,position:"fixed",top:Q,width:"100%",pointerEvents:"none",zIndex:me,[`${h}-move-up`]:{animationFillMode:"forwards"},[`
        ${h}-move-up-appear,
        ${h}-move-up-enter
      `]:{animationName:ge,animationDuration:q,animationPlayState:"paused",animationTimingFunction:V},[`
        ${h}-move-up-appear${h}-move-up-appear-active,
        ${h}-move-up-enter${h}-move-up-enter-active
      `]:{animationPlayState:"running"},[`${h}-move-up-leave`]:{animationName:ce,animationDuration:q,animationPlayState:"paused",animationTimingFunction:V},[`${h}-move-up-leave${h}-move-up-leave-active`]:{animationPlayState:"running"},"&-rtl":{direction:"rtl",span:{direction:"rtl"}}})},{[h]:{[`${be}-wrapper`]:Object.assign({},Se)}},{[`${h}-notice-pure-panel`]:Object.assign(Object.assign({},Se),{padding:0,textAlign:"start"})}]},zv=s=>({zIndexPopup:s.zIndexPopupBase+Fh+10,contentBg:s.colorBgElevated,contentPadding:`${(s.controlHeightLG-s.fontSize*s.lineHeight)/2}px ${s.paddingSM}px`}),zm=es("Message",s=>{const h=ts(s,{height:150});return[kv(h)]},zv);var Lv=function(s,h){var y={};for(var x in s)Object.prototype.hasOwnProperty.call(s,x)&&h.indexOf(x)<0&&(y[x]=s[x]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var w=0,x=Object.getOwnPropertySymbols(s);w<x.length;w++)h.indexOf(x[w])<0&&Object.prototype.propertyIsEnumerable.call(s,x[w])&&(y[x[w]]=s[x[w]]);return y};const Dv={info:k.createElement(Hh,null),success:k.createElement(jc,null),error:k.createElement(Vc,null),warning:k.createElement(Nh,null),loading:k.createElement(Ah,null)},Lm=s=>{let{prefixCls:h,type:y,icon:x,children:w}=s;return k.createElement("div",{className:_t(`${h}-custom-content`,`${h}-${y}`)},x||Dv[y],k.createElement("span",null,w))},Rv=s=>{const{prefixCls:h,className:y,type:x,icon:w,content:E}=s,z=Lv(s,["prefixCls","className","type","icon","content"]),{getPrefixCls:o}=k.useContext(xn),O=h||o("message"),L=oo(O),[V,q,Q]=zm(O,L);return V(k.createElement(Wh,Object.assign({},z,{prefixCls:O,className:_t(y,q,`${O}-notice-pure-panel`,Q,L),eventKey:"pure",duration:null,content:k.createElement(Lm,{prefixCls:O,type:x,icon:w},E)})))},$v=Rv;function Ov(s,h){return{motionName:h??`${s}-move-up`}}function Xh(s){let h;const y=new Promise(w=>{h=s(()=>{w(!0)})}),x=()=>{h?.()};return x.then=(w,E)=>y.then(w,E),x.promise=y,x}var Bv=function(s,h){var y={};for(var x in s)Object.prototype.hasOwnProperty.call(s,x)&&h.indexOf(x)<0&&(y[x]=s[x]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var w=0,x=Object.getOwnPropertySymbols(s);w<x.length;w++)h.indexOf(x[w])<0&&Object.prototype.propertyIsEnumerable.call(s,x[w])&&(y[x[w]]=s[x[w]]);return y};const Fv=8,Nv=3,jv=s=>{let{children:h,prefixCls:y}=s;const x=oo(y),[w,E,z]=zm(y,x);return w(k.createElement(Am,{classNames:{list:_t(E,z,x)}},h))},Vv=(s,h)=>{let{prefixCls:y,key:x}=h;return k.createElement(jv,{prefixCls:y,key:x},s)},Uv=k.forwardRef((s,h)=>{const{top:y,prefixCls:x,getContainer:w,maxCount:E,duration:z=Nv,rtl:o,transitionName:O,onAllRemoved:L}=s,{getPrefixCls:V,getPopupContainer:q,message:Q}=k.useContext(xn),ae=x||V("message"),fe=()=>({left:"50%",transform:"translateX(-50%)",top:y??Fv}),me=()=>_t({[`${ae}-rtl`]:o}),xe=()=>Ov(ae,O),ve=k.createElement("span",{className:`${ae}-close-x`},k.createElement(so,{className:`${ae}-close-icon`})),[be,ge]=km({prefixCls:ae,style:fe,className:me,motion:xe,closable:!1,closeIcon:ve,duration:z,getContainer:()=>w?.()||q?.()||document.body,maxCount:E,onAllRemoved:L,renderNotifications:Vv});return k.useImperativeHandle(h,()=>Object.assign(Object.assign({},be),{prefixCls:ae,message:Q})),ge});let Kp=0;function Dm(s){const h=k.useRef(null);return dm(),[k.useMemo(()=>{const x=O=>{var L;(L=h.current)===null||L===void 0||L.close(O)},w=O=>{if(!h.current){const ze=()=>{};return ze.then=()=>{},ze}const{open:L,prefixCls:V,message:q}=h.current,Q=`${V}-notice`,{content:ae,icon:fe,type:me,key:xe,className:ve,style:be,onClose:ge}=O,ce=Bv(O,["content","icon","type","key","className","style","onClose"]);let Se=xe;return Se==null&&(Kp+=1,Se=`antd-message-${Kp}`),Xh(ze=>(L(Object.assign(Object.assign({},ce),{key:Se,content:k.createElement(Lm,{prefixCls:V,type:me,icon:fe},ae),placement:"top",className:_t(me&&`${Q}-${me}`,ve,q?.className),style:Object.assign(Object.assign({},q?.style),be),onClose:()=>{ge?.(),ze()}})),()=>{x(Se)}))},z={open:w,destroy:O=>{var L;O!==void 0?x(O):(L=h.current)===null||L===void 0||L.destroy()}};return["info","success","warning","error","loading"].forEach(O=>{const L=(V,q,Q)=>{let ae;V&&typeof V=="object"&&"content"in V?ae=V:ae={content:V};let fe,me;typeof q=="function"?me=q:(fe=q,me=Q);const xe=Object.assign(Object.assign({onClose:me,duration:fe},ae),{type:O});return w(xe)};z[O]=L}),z},[]),k.createElement(Uv,Object.assign({key:"message-holder"},s,{ref:h}))]}function qv(s){return Dm(s)}function Gv(){const[s,h]=k.useState([]),y=k.useCallback(x=>(h(w=>[].concat(qi(w),[x])),()=>{h(w=>w.filter(E=>E!==x))}),[]);return[s,y]}function Yp(s){return!!(s&&s.then)}const Zv=s=>{const{type:h,children:y,prefixCls:x,buttonProps:w,close:E,autoFocus:z,emitEvent:o,isSilent:O,quitOnNullishReturnValue:L,actionFn:V}=s,q=k.useRef(!1),Q=k.useRef(null),[ae,fe]=R_(!1),me=function(){E?.apply(void 0,arguments)};k.useEffect(()=>{let be=null;return z&&(be=setTimeout(()=>{var ge;(ge=Q.current)===null||ge===void 0||ge.focus()})),()=>{be&&clearTimeout(be)}},[]);const xe=be=>{Yp(be)&&(fe(!0),be.then(function(){fe(!1,!0),me.apply(void 0,arguments),q.current=!1},ge=>{if(fe(!1,!0),q.current=!1,!O?.())return Promise.reject(ge)}))},ve=be=>{if(q.current)return;if(q.current=!0,!V){me();return}let ge;if(o){if(ge=V(be),L&&!Yp(ge)){q.current=!1,me(be);return}}else if(V.length)ge=V(E),q.current=!1;else if(ge=V(),!ge){me();return}xe(ge)};return k.createElement(ha,Object.assign({},pm(h),{onClick:ve,loading:ae,prefixCls:x},w,{ref:Q}),y)},Rm=Zv,gl=ti.createContext({}),{Provider:$m}=gl,Hv=()=>{const{autoFocusButton:s,cancelButtonProps:h,cancelTextLocale:y,isSilent:x,mergedOkCancel:w,rootPrefixCls:E,close:z,onCancel:o,onConfirm:O}=k.useContext(gl);return w?ti.createElement(Rm,{isSilent:x,actionFn:o,close:function(){z?.apply(void 0,arguments),O?.(!1)},autoFocus:s==="cancel",buttonProps:h,prefixCls:`${E}-btn`},y):null},Jp=Hv,Wv=()=>{const{autoFocusButton:s,close:h,isSilent:y,okButtonProps:x,rootPrefixCls:w,okTextLocale:E,okType:z,onConfirm:o,onOk:O}=k.useContext(gl);return ti.createElement(Rm,{isSilent:y,type:z||"primary",actionFn:O,close:function(){h?.apply(void 0,arguments),o?.(!0)},autoFocus:s==="ok",buttonProps:x,prefixCls:`${w}-btn`},E)},Qp=Wv;var Om=k.createContext({});function ef(s,h,y){var x=h;return!x&&y&&(x="".concat(s,"-").concat(y)),x}function tf(s,h){var y=s["page".concat(h?"Y":"X","Offset")],x="scroll".concat(h?"Top":"Left");if(typeof y!="number"){var w=s.document;y=w.documentElement[x],typeof y!="number"&&(y=w.body[x])}return y}function Xv(s){var h=s.getBoundingClientRect(),y={left:h.left,top:h.top},x=s.ownerDocument,w=x.defaultView||x.parentWindow;return y.left+=tf(w),y.top+=tf(w,!0),y}const Kv=k.memo(function(s){var h=s.children;return h},function(s,h){var y=h.shouldUpdate;return!y});var rf={width:0,height:0,overflow:"hidden",outline:"none"},Bm=ti.forwardRef(function(s,h){var y=s.prefixCls,x=s.className,w=s.style,E=s.title,z=s.ariaId,o=s.footer,O=s.closable,L=s.closeIcon,V=s.onClose,q=s.children,Q=s.bodyStyle,ae=s.bodyProps,fe=s.modalRender,me=s.onMouseDown,xe=s.onMouseUp,ve=s.holderRef,be=s.visible,ge=s.forceRender,ce=s.width,Se=s.height,ze=s.classNames,Be=s.styles,$e=ti.useContext(Om),De=$e.panel,Ce=fm(ve,De),je=k.useRef(),Ge=k.useRef();ti.useImperativeHandle(h,function(){return{focus:function(){var At;(At=je.current)===null||At===void 0||At.focus()},changeActive:function(At){var Qt=document,Gt=Qt.activeElement;At&&Gt===Ge.current?je.current.focus():!At&&Gt===je.current&&Ge.current.focus()}}});var tt={};ce!==void 0&&(tt.width=ce),Se!==void 0&&(tt.height=Se);var He;o&&(He=ti.createElement("div",{className:_t("".concat(y,"-footer"),ze?.footer),style:ri({},Be?.footer)},o));var ot;E&&(ot=ti.createElement("div",{className:_t("".concat(y,"-header"),ze?.header),style:ri({},Be?.header)},ti.createElement("div",{className:"".concat(y,"-title"),id:z},E)));var Tt;O&&(Tt=ti.createElement("button",{type:"button",onClick:V,"aria-label":"Close",className:"".concat(y,"-close")},L||ti.createElement("span",{className:"".concat(y,"-close-x")})));var st=ti.createElement("div",{className:_t("".concat(y,"-content"),ze?.content),style:Be?.content},Tt,ot,ti.createElement("div",mi({className:_t("".concat(y,"-body"),ze?.body),style:ri(ri({},Q),Be?.body)},ae),q),He);return ti.createElement("div",{key:"dialog-element",role:"dialog","aria-labelledby":E?z:null,"aria-modal":"true",ref:Ce,style:ri(ri({},w),tt),className:_t(y,x),onMouseDown:me,onMouseUp:xe},ti.createElement("div",{tabIndex:0,ref:je,style:rf,"aria-hidden":"true"}),ti.createElement(Kv,{shouldUpdate:be||ge},fe?fe(st):st),ti.createElement("div",{tabIndex:0,ref:Ge,style:rf,"aria-hidden":"true"}))}),Fm=k.forwardRef(function(s,h){var y=s.prefixCls,x=s.title,w=s.style,E=s.className,z=s.visible,o=s.forceRender,O=s.destroyOnClose,L=s.motionName,V=s.ariaId,q=s.onVisibleChanged,Q=s.mousePosition,ae=k.useRef(),fe=k.useState(),me=ii(fe,2),xe=me[0],ve=me[1],be={};xe&&(be.transformOrigin=xe);function ge(){var ce=Xv(ae.current);ve(Q?"".concat(Q.x-ce.left,"px ").concat(Q.y-ce.top,"px"):"")}return k.createElement(fl,{visible:z,onVisibleChanged:q,onAppearPrepare:ge,onEnterPrepare:ge,forceRender:o,motionName:L,removeOnLeave:O,ref:ae},function(ce,Se){var ze=ce.className,Be=ce.style;return k.createElement(Bm,mi({},s,{ref:h,title:x,ariaId:V,prefixCls:y,holderRef:Se,style:ri(ri(ri({},Be),w),be),className:_t(E,ze)}))})});Fm.displayName="Content";function Yv(s){var h=s.prefixCls,y=s.style,x=s.visible,w=s.maskProps,E=s.motionName,z=s.className;return k.createElement(fl,{key:"mask",visible:x,motionName:E,leavedClassName:"".concat(h,"-mask-hidden")},function(o,O){var L=o.className,V=o.style;return k.createElement("div",mi({ref:O,style:ri(ri({},V),y),className:_t("".concat(h,"-mask"),L,z)},w))})}function Jv(s){var h=s.prefixCls,y=h===void 0?"rc-dialog":h,x=s.zIndex,w=s.visible,E=w===void 0?!1:w,z=s.keyboard,o=z===void 0?!0:z,O=s.focusTriggerAfterClose,L=O===void 0?!0:O,V=s.wrapStyle,q=s.wrapClassName,Q=s.wrapProps,ae=s.onClose,fe=s.afterOpenChange,me=s.afterClose,xe=s.transitionName,ve=s.animation,be=s.closable,ge=be===void 0?!0:be,ce=s.mask,Se=ce===void 0?!0:ce,ze=s.maskTransitionName,Be=s.maskAnimation,$e=s.maskClosable,De=$e===void 0?!0:$e,Ce=s.maskStyle,je=s.maskProps,Ge=s.rootClassName,tt=s.classNames,He=s.styles,ot=k.useRef(),Tt=k.useRef(),st=k.useRef(),jt=k.useState(E),At=ii(jt,2),Qt=At[0],Gt=At[1],ft=$_();function Oe(){Fp(Tt.current,document.activeElement)||(ot.current=document.activeElement)}function gt(){if(!Fp(Tt.current,document.activeElement)){var Pt;(Pt=st.current)===null||Pt===void 0||Pt.focus()}}function Bt(Pt){if(Pt)gt();else{if(Gt(!1),Se&&ot.current&&L){try{ot.current.focus({preventScroll:!0})}catch{}ot.current=null}Qt&&me?.()}fe?.(Pt)}function wt(Pt){ae?.(Pt)}var $t=k.useRef(!1),Yt=k.useRef(),ei=function(){clearTimeout(Yt.current),$t.current=!0},kt=function(){Yt.current=setTimeout(function(){$t.current=!1})},gi=null;De&&(gi=function(li){$t.current?$t.current=!1:Tt.current===li.target&&wt(li)});function pi(Pt){if(o&&Pt.keyCode===ln.ESC){Pt.stopPropagation(),wt(Pt);return}E&&Pt.keyCode===ln.TAB&&st.current.changeActive(!Pt.shiftKey)}return k.useEffect(function(){E&&(Gt(!0),Oe())},[E]),k.useEffect(function(){return function(){clearTimeout(Yt.current)}},[]),k.createElement("div",mi({className:_t("".concat(y,"-root"),Ge)},mm(s,{data:!0})),k.createElement(Yv,{prefixCls:y,visible:Se&&E,motionName:ef(y,ze,Be),style:ri(ri({zIndex:x},Ce),He?.mask),maskProps:je,className:tt?.mask}),k.createElement("div",mi({tabIndex:-1,onKeyDown:pi,className:_t("".concat(y,"-wrap"),q,tt?.wrapper),ref:Tt,onClick:gi,style:ri(ri(ri({zIndex:x},V),He?.wrapper),{},{display:Qt?null:"none"})},Q),k.createElement(Fm,mi({},s,{onMouseDown:ei,onMouseUp:kt,ref:st,closable:ge,ariaId:ft,prefixCls:y,visible:E&&Qt,onClose:wt,onVisibleChanged:Bt,motionName:ef(y,xe,ve)}))))}var Nm=function(h){var y=h.visible,x=h.getContainer,w=h.forceRender,E=h.destroyOnClose,z=E===void 0?!1:E,o=h.afterClose,O=h.panelRef,L=k.useState(y),V=ii(L,2),q=V[0],Q=V[1],ae=k.useMemo(function(){return{panel:O}},[O]);return k.useEffect(function(){y&&Q(!0)},[y]),!w&&z&&!q?null:k.createElement(Om.Provider,{value:ae},k.createElement(O_,{open:y||w||q,autoDestroy:!1,getContainer:x,autoLock:y||q},k.createElement(Jv,mi({},h,{destroyOnClose:z,afterClose:function(){o?.(),Q(!1)}}))))};Nm.displayName="Dialog";const Qv=()=>gm()&&window.document.documentElement;function nf(){}const e0=k.createContext({add:nf,remove:nf});function t0(s){const h=k.useContext(e0),y=k.useRef();return ym(w=>{if(w){const E=s?w.querySelector(s):w;h.add(E),y.current=E}else h.remove(y.current)})}const i0=()=>{const{cancelButtonProps:s,cancelTextLocale:h,onCancel:y}=k.useContext(gl);return ti.createElement(ha,Object.assign({onClick:y},s),h)},af=i0,r0=()=>{const{confirmLoading:s,okButtonProps:h,okType:y,okTextLocale:x,onOk:w}=k.useContext(gl);return ti.createElement(ha,Object.assign({},pm(y),{loading:s,onClick:w},h),x)},of=r0;function jm(s,h){return ti.createElement("span",{className:`${s}-close-x`},h||ti.createElement(so,{className:`${s}-close-icon`}))}const Vm=s=>{const{okText:h,okType:y="primary",cancelText:x,confirmLoading:w,onOk:E,onCancel:z,okButtonProps:o,cancelButtonProps:O,footer:L}=s,[V]=Uc("Modal",_m()),q=h||V?.okText,Q=x||V?.cancelText,ae={confirmLoading:w,okButtonProps:o,cancelButtonProps:O,okTextLocale:q,cancelTextLocale:Q,okType:y,onOk:E,onCancel:z},fe=ti.useMemo(()=>ae,qi(Object.values(ae)));let me;return typeof L=="function"||typeof L>"u"?(me=ti.createElement(ti.Fragment,null,ti.createElement(af,null),ti.createElement(of,null)),typeof L=="function"&&(me=L(me,{OkBtn:of,CancelBtn:af})),me=ti.createElement($m,{value:fe},me)):me=L,ti.createElement(B_,{disabled:!1},me)},n0=new vn("antFadeIn",{"0%":{opacity:0},"100%":{opacity:1}}),a0=new vn("antFadeOut",{"0%":{opacity:1},"100%":{opacity:0}}),Um=function(s){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const{antCls:y}=s,x=`${y}-fade`,w=h?"&":"";return[F_(x,n0,a0,s.motionDurationMid,h),{[`
        ${w}${x}-enter,
        ${w}${x}-appear
      `]:{opacity:0,animationTimingFunction:"linear"},[`${w}${x}-leave`]:{animationTimingFunction:"linear"}}]};function sf(s){return{position:s,inset:0}}const o0=s=>{const{componentCls:h,antCls:y}=s;return[{[`${h}-root`]:{[`${h}${y}-zoom-enter, ${h}${y}-zoom-appear`]:{transform:"none",opacity:0,animationDuration:s.motionDurationSlow,userSelect:"none"},[`${h}${y}-zoom-leave ${h}-content`]:{pointerEvents:"none"},[`${h}-mask`]:Object.assign(Object.assign({},sf("fixed")),{zIndex:s.zIndexPopupBase,height:"100%",backgroundColor:s.colorBgMask,pointerEvents:"none",[`${h}-hidden`]:{display:"none"}}),[`${h}-wrap`]:Object.assign(Object.assign({},sf("fixed")),{zIndex:s.zIndexPopupBase,overflow:"auto",outline:0,WebkitOverflowScrolling:"touch",[`&:has(${h}${y}-zoom-enter), &:has(${h}${y}-zoom-appear)`]:{pointerEvents:"none"}})}},{[`${h}-root`]:Um(s)}]},s0=s=>{const{componentCls:h}=s;return[{[`${h}-root`]:{[`${h}-wrap-rtl`]:{direction:"rtl"},[`${h}-centered`]:{textAlign:"center","&::before":{display:"inline-block",width:0,height:"100%",verticalAlign:"middle",content:'""'},[h]:{top:0,display:"inline-block",paddingBottom:0,textAlign:"start",verticalAlign:"middle"}},[`@media (max-width: ${s.screenSMMax}px)`]:{[h]:{maxWidth:"calc(100vw - 16px)",margin:`${nt(s.marginXS)} auto`},[`${h}-centered`]:{[h]:{flex:1}}}}},{[h]:Object.assign(Object.assign({},ao(s)),{pointerEvents:"none",position:"relative",top:100,width:"auto",maxWidth:`calc(100vw - ${nt(s.calc(s.margin).mul(2).equal())})`,margin:"0 auto",paddingBottom:s.paddingLG,[`${h}-title`]:{margin:0,color:s.titleColor,fontWeight:s.fontWeightStrong,fontSize:s.titleFontSize,lineHeight:s.titleLineHeight,wordWrap:"break-word"},[`${h}-content`]:{position:"relative",backgroundColor:s.contentBg,backgroundClip:"padding-box",border:0,borderRadius:s.borderRadiusLG,boxShadow:s.boxShadow,pointerEvents:"auto",padding:s.contentPadding},[`${h}-close`]:Object.assign({position:"absolute",top:s.calc(s.modalHeaderHeight).sub(s.modalCloseBtnSize).div(2).equal(),insetInlineEnd:s.calc(s.modalHeaderHeight).sub(s.modalCloseBtnSize).div(2).equal(),zIndex:s.calc(s.zIndexPopupBase).add(10).equal(),padding:0,color:s.modalCloseIconColor,fontWeight:s.fontWeightStrong,lineHeight:1,textDecoration:"none",background:"transparent",borderRadius:s.borderRadiusSM,width:s.modalCloseBtnSize,height:s.modalCloseBtnSize,border:0,outline:0,cursor:"pointer",transition:`color ${s.motionDurationMid}, background-color ${s.motionDurationMid}`,"&-x":{display:"flex",fontSize:s.fontSizeLG,fontStyle:"normal",lineHeight:`${nt(s.modalCloseBtnSize)}`,justifyContent:"center",textTransform:"none",textRendering:"auto"},"&:hover":{color:s.modalIconHoverColor,backgroundColor:s.closeBtnHoverBg,textDecoration:"none"},"&:active":{backgroundColor:s.closeBtnActiveBg}},jh(s)),[`${h}-header`]:{color:s.colorText,background:s.headerBg,borderRadius:`${nt(s.borderRadiusLG)} ${nt(s.borderRadiusLG)} 0 0`,marginBottom:s.headerMarginBottom,padding:s.headerPadding,borderBottom:s.headerBorderBottom},[`${h}-body`]:{fontSize:s.fontSize,lineHeight:s.lineHeight,wordWrap:"break-word",padding:s.bodyPadding},[`${h}-footer`]:{textAlign:"end",background:s.footerBg,marginTop:s.footerMarginTop,padding:s.footerPadding,borderTop:s.footerBorderTop,borderRadius:s.footerBorderRadius,[`> ${s.antCls}-btn + ${s.antCls}-btn`]:{marginInlineStart:s.marginXS}},[`${h}-open`]:{overflow:"hidden"}})},{[`${h}-pure-panel`]:{top:"auto",padding:0,display:"flex",flexDirection:"column",[`${h}-content,
          ${h}-body,
          ${h}-confirm-body-wrapper`]:{display:"flex",flexDirection:"column",flex:"auto"},[`${h}-confirm-body`]:{marginBottom:"auto"}}}]},l0=s=>{const{componentCls:h}=s;return{[`${h}-root`]:{[`${h}-wrap-rtl`]:{direction:"rtl",[`${h}-confirm-body`]:{direction:"rtl"}}}}},qm=s=>{const h=s.padding,y=s.fontSizeHeading5,x=s.lineHeightHeading5;return ts(s,{modalHeaderHeight:s.calc(s.calc(x).mul(y).equal()).add(s.calc(h).mul(2).equal()).equal(),modalFooterBorderColorSplit:s.colorSplit,modalFooterBorderStyle:s.lineType,modalFooterBorderWidth:s.lineWidth,modalIconHoverColor:s.colorIconHover,modalCloseIconColor:s.colorIcon,modalCloseBtnSize:s.fontHeight,modalConfirmIconSize:s.fontHeight,modalTitleHeight:s.calc(s.titleFontSize).mul(s.titleLineHeight).equal()})},Gm=s=>({footerBg:"transparent",headerBg:s.colorBgElevated,titleLineHeight:s.lineHeightHeading5,titleFontSize:s.fontSizeHeading5,contentBg:s.colorBgElevated,titleColor:s.colorTextHeading,closeBtnHoverBg:s.wireframe?"transparent":s.colorFillContent,closeBtnActiveBg:s.wireframe?"transparent":s.colorFillContentHover,contentPadding:s.wireframe?0:`${nt(s.paddingMD)} ${nt(s.paddingContentHorizontalLG)}`,headerPadding:s.wireframe?`${nt(s.padding)} ${nt(s.paddingLG)}`:0,headerBorderBottom:s.wireframe?`${nt(s.lineWidth)} ${s.lineType} ${s.colorSplit}`:"none",headerMarginBottom:s.wireframe?0:s.marginXS,bodyPadding:s.wireframe?s.paddingLG:0,footerPadding:s.wireframe?`${nt(s.paddingXS)} ${nt(s.padding)}`:0,footerBorderTop:s.wireframe?`${nt(s.lineWidth)} ${s.lineType} ${s.colorSplit}`:"none",footerBorderRadius:s.wireframe?`0 0 ${nt(s.borderRadiusLG)} ${nt(s.borderRadiusLG)}`:0,footerMarginTop:s.wireframe?0:s.marginSM,confirmBodyPadding:s.wireframe?`${nt(s.padding*2)} ${nt(s.padding*2)} ${nt(s.paddingLG)}`:0,confirmIconMarginInlineEnd:s.wireframe?s.margin:s.marginSM,confirmBtnsMarginTop:s.wireframe?s.marginLG:s.marginSM}),Zm=es("Modal",s=>{const h=qm(s);return[s0(h),l0(h),o0(h),N_(h,"zoom")]},Gm,{unitless:{titleLineHeight:!0}});var c0=function(s,h){var y={};for(var x in s)Object.prototype.hasOwnProperty.call(s,x)&&h.indexOf(x)<0&&(y[x]=s[x]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var w=0,x=Object.getOwnPropertySymbols(s);w<x.length;w++)h.indexOf(x[w])<0&&Object.prototype.propertyIsEnumerable.call(s,x[w])&&(y[x[w]]=s[x[w]]);return y};let Dh;const u0=s=>{Dh={x:s.pageX,y:s.pageY},setTimeout(()=>{Dh=null},100)};Qv()&&document.documentElement.addEventListener("click",u0,!0);const h0=s=>{var h;const{getPopupContainer:y,getPrefixCls:x,direction:w,modal:E}=k.useContext(xn),z=ft=>{const{onCancel:Oe}=s;Oe?.(ft)},o=ft=>{const{onOk:Oe}=s;Oe?.(ft)},{prefixCls:O,className:L,rootClassName:V,open:q,wrapClassName:Q,centered:ae,getContainer:fe,closeIcon:me,closable:xe,focusTriggerAfterClose:ve=!0,style:be,visible:ge,width:ce=520,footer:Se,classNames:ze,styles:Be}=s,$e=c0(s,["prefixCls","className","rootClassName","open","wrapClassName","centered","getContainer","closeIcon","closable","focusTriggerAfterClose","style","visible","width","footer","classNames","styles"]),De=x("modal",O),Ce=x(),je=oo(De),[Ge,tt,He]=Zm(De,je),ot=_t(Q,{[`${De}-centered`]:!!ae,[`${De}-wrap-rtl`]:w==="rtl"}),Tt=Se!==null&&k.createElement(Vm,Object.assign({},s,{onOk:o,onCancel:z})),[st,jt]=j_(xe,me,ft=>jm(De,ft),k.createElement(so,{className:`${De}-close-icon`}),!0),At=t0(`.${De}-content`),[Qt,Gt]=V_("Modal",$e.zIndex);return Ge(k.createElement(U_,null,k.createElement(q_,{status:!0,override:!0},k.createElement(G_.Provider,{value:Gt},k.createElement(Nm,Object.assign({width:ce},$e,{zIndex:Qt,getContainer:fe===void 0?y:fe,prefixCls:De,rootClassName:_t(tt,V,He,je),footer:Tt,visible:q??ge,mousePosition:(h=$e.mousePosition)!==null&&h!==void 0?h:Dh,onClose:z,closable:st,closeIcon:jt,focusTriggerAfterClose:ve,transitionName:dl(Ce,"zoom",s.transitionName),maskTransitionName:dl(Ce,"fade",s.maskTransitionName),className:_t(tt,L,E?.className),style:Object.assign(Object.assign({},E?.style),be),classNames:Object.assign(Object.assign({wrapper:ot},E?.classNames),ze),styles:Object.assign(Object.assign({},E?.styles),Be),panelRef:At}))))))},Hm=h0,d0=s=>{const{componentCls:h,titleFontSize:y,titleLineHeight:x,modalConfirmIconSize:w,fontSize:E,lineHeight:z,modalTitleHeight:o,fontHeight:O,confirmBodyPadding:L}=s,V=`${h}-confirm`;return{[V]:{"&-rtl":{direction:"rtl"},[`${s.antCls}-modal-header`]:{display:"none"},[`${V}-body-wrapper`]:Object.assign({},Vh()),[`&${h} ${h}-body`]:{padding:L},[`${V}-body`]:{display:"flex",flexWrap:"nowrap",alignItems:"start",[`> ${s.iconCls}`]:{flex:"none",fontSize:w,marginInlineEnd:s.confirmIconMarginInlineEnd,marginTop:s.calc(s.calc(O).sub(w).equal()).div(2).equal()},[`&-has-title > ${s.iconCls}`]:{marginTop:s.calc(s.calc(o).sub(w).equal()).div(2).equal()}},[`${V}-paragraph`]:{display:"flex",flexDirection:"column",flex:"auto",rowGap:s.marginXS,maxWidth:`calc(100% - ${nt(s.calc(s.modalConfirmIconSize).add(s.marginSM).equal())})`},[`${V}-title`]:{color:s.colorTextHeading,fontWeight:s.fontWeightStrong,fontSize:y,lineHeight:x},[`${V}-content`]:{color:s.colorText,fontSize:E,lineHeight:z},[`${V}-btns`]:{textAlign:"end",marginTop:s.confirmBtnsMarginTop,[`${s.antCls}-btn + ${s.antCls}-btn`]:{marginBottom:0,marginInlineStart:s.marginXS}}},[`${V}-error ${V}-body > ${s.iconCls}`]:{color:s.colorError},[`${V}-warning ${V}-body > ${s.iconCls},
        ${V}-confirm ${V}-body > ${s.iconCls}`]:{color:s.colorWarning},[`${V}-info ${V}-body > ${s.iconCls}`]:{color:s.colorInfo},[`${V}-success ${V}-body > ${s.iconCls}`]:{color:s.colorSuccess}}},p0=vm(["Modal","confirm"],s=>{const h=qm(s);return[d0(h)]},Gm,{order:-1e3});var f0=function(s,h){var y={};for(var x in s)Object.prototype.hasOwnProperty.call(s,x)&&h.indexOf(x)<0&&(y[x]=s[x]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var w=0,x=Object.getOwnPropertySymbols(s);w<x.length;w++)h.indexOf(x[w])<0&&Object.prototype.propertyIsEnumerable.call(s,x[w])&&(y[x[w]]=s[x[w]]);return y};function Wm(s){const{prefixCls:h,icon:y,okText:x,cancelText:w,confirmPrefixCls:E,type:z,okCancel:o,footer:O,locale:L}=s,V=f0(s,["prefixCls","icon","okText","cancelText","confirmPrefixCls","type","okCancel","footer","locale"]);let q=y;if(!y&&y!==null)switch(z){case"info":q=k.createElement(Hh,null);break;case"success":q=k.createElement(jc,null);break;case"error":q=k.createElement(Vc,null);break;default:q=k.createElement(Nh,null)}const Q=o??z==="confirm",ae=s.autoFocusButton===null?!1:s.autoFocusButton||"ok",[fe]=Uc("Modal"),me=L||fe,xe=x||(Q?me?.okText:me?.justOkText),ve=w||me?.cancelText,be=Object.assign({autoFocusButton:ae,cancelTextLocale:ve,okTextLocale:xe,mergedOkCancel:Q},V),ge=k.useMemo(()=>be,qi(Object.values(be))),ce=k.createElement(k.Fragment,null,k.createElement(Jp,null),k.createElement(Qp,null)),Se=s.title!==void 0&&s.title!==null,ze=`${E}-body`;return k.createElement("div",{className:`${E}-body-wrapper`},k.createElement("div",{className:_t(ze,{[`${ze}-has-title`]:Se})},q,k.createElement("div",{className:`${E}-paragraph`},Se&&k.createElement("span",{className:`${E}-title`},s.title),k.createElement("div",{className:`${E}-content`},s.content))),O===void 0||typeof O=="function"?k.createElement($m,{value:ge},k.createElement("div",{className:`${E}-btns`},typeof O=="function"?O(ce,{OkBtn:Qp,CancelBtn:Jp}):ce)):O,k.createElement(p0,{prefixCls:h}))}const m0=s=>{const{close:h,zIndex:y,afterClose:x,open:w,keyboard:E,centered:z,getContainer:o,maskStyle:O,direction:L,prefixCls:V,wrapClassName:q,rootPrefixCls:Q,bodyStyle:ae,closable:fe=!1,closeIcon:me,modalRender:xe,focusTriggerAfterClose:ve,onConfirm:be,styles:ge}=s,ce=`${V}-confirm`,Se=s.width||416,ze=s.style||{},Be=s.mask===void 0?!0:s.mask,$e=s.maskClosable===void 0?!1:s.maskClosable,De=_t(ce,`${ce}-${s.type}`,{[`${ce}-rtl`]:L==="rtl"},s.className),[,Ce]=xm(),je=k.useMemo(()=>y!==void 0?y:Ce.zIndexPopupBase+Fh,[y,Ce]);return k.createElement(Hm,{prefixCls:V,className:De,wrapClassName:_t({[`${ce}-centered`]:!!s.centered},q),onCancel:()=>{h?.({triggerCancel:!0}),be?.(!1)},open:w,title:"",footer:null,transitionName:dl(Q||"","zoom",s.transitionName),maskTransitionName:dl(Q||"","fade",s.maskTransitionName),mask:Be,maskClosable:$e,style:ze,styles:Object.assign({body:ae,mask:O},ge),width:Se,zIndex:je,afterClose:x,keyboard:E,centered:z,getContainer:o,closable:fe,closeIcon:me,modalRender:xe,focusTriggerAfterClose:ve},k.createElement(Wm,Object.assign({},s,{confirmPrefixCls:ce})))},g0=s=>{const{rootPrefixCls:h,iconPrefixCls:y,direction:x,theme:w}=s;return k.createElement(Uh,{prefixCls:h,iconPrefixCls:y,direction:x,theme:w},k.createElement(m0,Object.assign({},s)))},Xm=g0,io=[];var y0=function(s,h){var y={};for(var x in s)Object.prototype.hasOwnProperty.call(s,x)&&h.indexOf(x)<0&&(y[x]=s[x]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var w=0,x=Object.getOwnPropertySymbols(s);w<x.length;w++)h.indexOf(x[w])<0&&Object.prototype.propertyIsEnumerable.call(s,x[w])&&(y[x[w]]=s[x[w]]);return y};let Km="";function _0(){return Km}function yl(s){const h=document.createDocumentFragment();let y=Object.assign(Object.assign({},s),{close:z,open:!0}),x;function w(){for(var O=arguments.length,L=new Array(O),V=0;V<O;V++)L[V]=arguments[V];const q=L.some(Q=>Q&&Q.triggerCancel);s.onCancel&&q&&s.onCancel.apply(s,[()=>{}].concat(qi(L.slice(1))));for(let Q=0;Q<io.length;Q++)if(io[Q]===z){io.splice(Q,1);break}Z_(h)}function E(O){var{okText:L,cancelText:V,prefixCls:q,getContainer:Q}=O,ae=y0(O,["okText","cancelText","prefixCls","getContainer"]);clearTimeout(x),x=setTimeout(()=>{const fe=_m(),{getPrefixCls:me,getIconPrefixCls:xe,getTheme:ve}=ml(),be=me(void 0,_0()),ge=q||`${be}-modal`,ce=xe(),Se=ve();let ze=Q;ze===!1&&(ze=void 0),qh(k.createElement(Xm,Object.assign({},ae,{getContainer:ze,prefixCls:ge,rootPrefixCls:be,iconPrefixCls:ce,okText:L,locale:fe,theme:Se,cancelText:V||fe.cancelText})),h)})}function z(){for(var O=arguments.length,L=new Array(O),V=0;V<O;V++)L[V]=arguments[V];y=Object.assign(Object.assign({},y),{open:!1,afterClose:()=>{typeof s.afterClose=="function"&&s.afterClose(),w.apply(this,L)}}),y.visible&&delete y.visible,E(y)}function o(O){typeof O=="function"?y=O(y):y=Object.assign(Object.assign({},y),O),E(y)}return E(y),io.push(z),{destroy:z,update:o}}function Ym(s){return Object.assign(Object.assign({},s),{type:"warning"})}function Jm(s){return Object.assign(Object.assign({},s),{type:"info"})}function Qm(s){return Object.assign(Object.assign({},s),{type:"success"})}function eg(s){return Object.assign(Object.assign({},s),{type:"error"})}function tg(s){return Object.assign(Object.assign({},s),{type:"confirm"})}function v0(s){let{rootPrefixCls:h}=s;Km=h}var x0=function(s,h){var y={};for(var x in s)Object.prototype.hasOwnProperty.call(s,x)&&h.indexOf(x)<0&&(y[x]=s[x]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var w=0,x=Object.getOwnPropertySymbols(s);w<x.length;w++)h.indexOf(x[w])<0&&Object.prototype.propertyIsEnumerable.call(s,x[w])&&(y[x[w]]=s[x[w]]);return y};const b0=(s,h)=>{var y,{afterClose:x,config:w}=s,E=x0(s,["afterClose","config"]);const[z,o]=k.useState(!0),[O,L]=k.useState(w),{direction:V,getPrefixCls:q}=k.useContext(xn),Q=q("modal"),ae=q(),fe=()=>{var be;x(),(be=O.afterClose)===null||be===void 0||be.call(O)},me=function(){o(!1);for(var be=arguments.length,ge=new Array(be),ce=0;ce<be;ce++)ge[ce]=arguments[ce];const Se=ge.some(ze=>ze&&ze.triggerCancel);O.onCancel&&Se&&O.onCancel.apply(O,[()=>{}].concat(qi(ge.slice(1))))};k.useImperativeHandle(h,()=>({destroy:me,update:be=>{L(ge=>Object.assign(Object.assign({},ge),be))}}));const xe=(y=O.okCancel)!==null&&y!==void 0?y:O.type==="confirm",[ve]=Uc("Modal",bm.Modal);return k.createElement(Xm,Object.assign({prefixCls:Q,rootPrefixCls:ae},O,{close:me,open:z,afterClose:fe,okText:O.okText||(xe?ve?.okText:ve?.justOkText),direction:O.direction||V,cancelText:O.cancelText||ve?.cancelText},E))},w0=k.forwardRef(b0);let lf=0;const S0=k.memo(k.forwardRef((s,h)=>{const[y,x]=Gv();return k.useImperativeHandle(h,()=>({patchElement:x}),[]),k.createElement(k.Fragment,null,y)}));function C0(){const s=k.useRef(null),[h,y]=k.useState([]);k.useEffect(()=>{h.length&&(qi(h).forEach(z=>{z()}),y([]))},[h]);const x=k.useCallback(E=>function(o){var O;lf+=1;const L=k.createRef();let V;const q=new Promise(xe=>{V=xe});let Q=!1,ae;const fe=k.createElement(w0,{key:`modal-${lf}`,config:E(o),ref:L,afterClose:()=>{ae?.()},isSilent:()=>Q,onConfirm:xe=>{V(xe)}});return ae=(O=s.current)===null||O===void 0?void 0:O.patchElement(fe),ae&&io.push(ae),{destroy:()=>{function xe(){var ve;(ve=L.current)===null||ve===void 0||ve.destroy()}L.current?xe():y(ve=>[].concat(qi(ve),[xe]))},update:xe=>{function ve(){var be;(be=L.current)===null||be===void 0||be.update(xe)}L.current?ve():y(be=>[].concat(qi(be),[ve]))},then:xe=>(Q=!0,q.then(xe))}},[]);return[k.useMemo(()=>({info:x(Jm),success:x(Qm),error:x(eg),warning:x(Ym),confirm:x(tg)}),[]),k.createElement(S0,{key:"modal-holder",ref:s})]}const T0=s=>{const{componentCls:h,notificationMarginEdge:y,animationMaxHeight:x}=s,w=`${h}-notice`,E=new vn("antNotificationFadeIn",{"0%":{transform:"translate3d(100%, 0, 0)",opacity:0},"100%":{transform:"translate3d(0, 0, 0)",opacity:1}}),z=new vn("antNotificationTopFadeIn",{"0%":{top:-x,opacity:0},"100%":{top:0,opacity:1}}),o=new vn("antNotificationBottomFadeIn",{"0%":{bottom:s.calc(x).mul(-1).equal(),opacity:0},"100%":{bottom:0,opacity:1}}),O=new vn("antNotificationLeftFadeIn",{"0%":{transform:"translate3d(-100%, 0, 0)",opacity:0},"100%":{transform:"translate3d(0, 0, 0)",opacity:1}});return{[h]:{[`&${h}-top, &${h}-bottom`]:{marginInline:0,[w]:{marginInline:"auto auto"}},[`&${h}-top`]:{[`${h}-fade-enter${h}-fade-enter-active, ${h}-fade-appear${h}-fade-appear-active`]:{animationName:z}},[`&${h}-bottom`]:{[`${h}-fade-enter${h}-fade-enter-active, ${h}-fade-appear${h}-fade-appear-active`]:{animationName:o}},[`&${h}-topRight, &${h}-bottomRight`]:{[`${h}-fade-enter${h}-fade-enter-active, ${h}-fade-appear${h}-fade-appear-active`]:{animationName:E}},[`&${h}-topLeft, &${h}-bottomLeft`]:{marginRight:{value:0,_skip_check_:!0},marginLeft:{value:y,_skip_check_:!0},[w]:{marginInlineEnd:"auto",marginInlineStart:0},[`${h}-fade-enter${h}-fade-enter-active, ${h}-fade-appear${h}-fade-appear-active`]:{animationName:O}}}}},E0=T0,I0=["top","topLeft","topRight","bottom","bottomLeft","bottomRight"],P0={topLeft:"left",topRight:"right",bottomLeft:"left",bottomRight:"right",top:"left",bottom:"left"},M0=(s,h)=>{const{componentCls:y}=s;return{[`${y}-${h}`]:{[`&${y}-stack > ${y}-notice-wrapper`]:{[h.startsWith("top")?"top":"bottom"]:0,[P0[h]]:{value:0,_skip_check_:!0}}}}},A0=s=>{const h={};for(let y=1;y<s.notificationStackLayer;y++)h[`&:nth-last-child(${y+1})`]={overflow:"hidden",[`& > ${s.componentCls}-notice`]:{opacity:0,transition:`opacity ${s.motionDurationMid}`}};return Object.assign({[`&:not(:nth-last-child(-n+${s.notificationStackLayer}))`]:{opacity:0,overflow:"hidden",color:"transparent",pointerEvents:"none"}},h)},k0=s=>{const h={};for(let y=1;y<s.notificationStackLayer;y++)h[`&:nth-last-child(${y+1})`]={background:s.colorBgBlur,backdropFilter:"blur(10px)","-webkit-backdrop-filter":"blur(10px)"};return Object.assign({},h)},z0=s=>{const{componentCls:h}=s;return Object.assign({[`${h}-stack`]:{[`& > ${h}-notice-wrapper`]:Object.assign({transition:`all ${s.motionDurationSlow}, backdrop-filter 0s`,position:"absolute"},A0(s))},[`${h}-stack:not(${h}-stack-expanded)`]:{[`& > ${h}-notice-wrapper`]:Object.assign({},k0(s))},[`${h}-stack${h}-stack-expanded`]:{[`& > ${h}-notice-wrapper`]:{"&:not(:nth-last-child(-n + 1))":{opacity:1,overflow:"unset",color:"inherit",pointerEvents:"auto",[`& > ${s.componentCls}-notice`]:{opacity:1}},"&:after":{content:'""',position:"absolute",height:s.margin,width:"100%",insetInline:0,bottom:s.calc(s.margin).mul(-1).equal(),background:"transparent",pointerEvents:"auto"}}}},I0.map(y=>M0(s,y)).reduce((y,x)=>Object.assign(Object.assign({},y),x),{}))},L0=z0,ig=s=>{const{iconCls:h,componentCls:y,boxShadow:x,fontSizeLG:w,notificationMarginBottom:E,borderRadiusLG:z,colorSuccess:o,colorInfo:O,colorWarning:L,colorError:V,colorTextHeading:q,notificationBg:Q,notificationPadding:ae,notificationMarginEdge:fe,fontSize:me,lineHeight:xe,width:ve,notificationIconSize:be,colorText:ge}=s,ce=`${y}-notice`;return{position:"relative",marginBottom:E,marginInlineStart:"auto",background:Q,borderRadius:z,boxShadow:x,[ce]:{padding:ae,width:ve,maxWidth:`calc(100vw - ${nt(s.calc(fe).mul(2).equal())})`,overflow:"hidden",lineHeight:xe,wordWrap:"break-word"},[`${y}-close-icon`]:{fontSize:me,cursor:"pointer"},[`${ce}-message`]:{marginBottom:s.marginXS,color:q,fontSize:w,lineHeight:s.lineHeightLG},[`${ce}-description`]:{fontSize:me,color:ge},[`${ce}-closable ${ce}-message`]:{paddingInlineEnd:s.paddingLG},[`${ce}-with-icon ${ce}-message`]:{marginBottom:s.marginXS,marginInlineStart:s.calc(s.marginSM).add(be).equal(),fontSize:w},[`${ce}-with-icon ${ce}-description`]:{marginInlineStart:s.calc(s.marginSM).add(be).equal(),fontSize:me},[`${ce}-icon`]:{position:"absolute",fontSize:be,lineHeight:1,[`&-success${h}`]:{color:o},[`&-info${h}`]:{color:O},[`&-warning${h}`]:{color:L},[`&-error${h}`]:{color:V}},[`${ce}-close`]:{position:"absolute",top:s.notificationPaddingVertical,insetInlineEnd:s.notificationPaddingHorizontal,color:s.colorIcon,outline:"none",width:s.notificationCloseButtonSize,height:s.notificationCloseButtonSize,borderRadius:s.borderRadiusSM,transition:`background-color ${s.motionDurationMid}, color ${s.motionDurationMid}`,display:"flex",alignItems:"center",justifyContent:"center","&:hover":{color:s.colorIconHover,backgroundColor:s.closeBtnHoverBg}},[`${ce}-btn`]:{float:"right",marginTop:s.marginSM}}},D0=s=>{const{componentCls:h,notificationMarginBottom:y,notificationMarginEdge:x,motionDurationMid:w,motionEaseInOut:E}=s,z=`${h}-notice`,o=new vn("antNotificationFadeOut",{"0%":{maxHeight:s.animationMaxHeight,marginBottom:y},"100%":{maxHeight:0,marginBottom:0,paddingTop:0,paddingBottom:0,opacity:0}});return[{[h]:Object.assign(Object.assign({},ao(s)),{position:"fixed",zIndex:s.zIndexPopup,marginRight:{value:x,_skip_check_:!0},[`${h}-hook-holder`]:{position:"relative"},[`${h}-fade-appear-prepare`]:{opacity:"0 !important"},[`${h}-fade-enter, ${h}-fade-appear`]:{animationDuration:s.motionDurationMid,animationTimingFunction:E,animationFillMode:"both",opacity:0,animationPlayState:"paused"},[`${h}-fade-leave`]:{animationTimingFunction:E,animationFillMode:"both",animationDuration:w,animationPlayState:"paused"},[`${h}-fade-enter${h}-fade-enter-active, ${h}-fade-appear${h}-fade-appear-active`]:{animationPlayState:"running"},[`${h}-fade-leave${h}-fade-leave-active`]:{animationName:o,animationPlayState:"running"},"&-rtl":{direction:"rtl",[`${z}-btn`]:{float:"left"}}})},{[h]:{[`${z}-wrapper`]:Object.assign({},ig(s))}}]},rg=s=>({zIndexPopup:s.zIndexPopupBase+Fh+50,width:384,closeBtnHoverBg:s.wireframe?"transparent":s.colorFillContent}),ng=s=>{const h=s.paddingMD,y=s.paddingLG;return ts(s,{notificationBg:s.colorBgElevated,notificationPaddingVertical:h,notificationPaddingHorizontal:y,notificationIconSize:s.calc(s.fontSizeLG).mul(s.lineHeightLG).equal(),notificationCloseButtonSize:s.calc(s.controlHeightLG).mul(.55).equal(),notificationMarginBottom:s.margin,notificationPadding:`${nt(s.paddingMD)} ${nt(s.paddingContentHorizontalLG)}`,notificationMarginEdge:s.marginLG,animationMaxHeight:150,notificationStackLayer:3})},ag=es("Notification",s=>{const h=ng(s);return[D0(h),E0(h),L0(h)]},rg),R0=vm(["Notification","PurePanel"],s=>{const h=`${s.componentCls}-notice`,y=ng(s);return{[`${h}-pure-panel`]:Object.assign(Object.assign({},ig(y)),{width:y.width,maxWidth:`calc(100vw - ${nt(s.calc(y.notificationMarginEdge).mul(2).equal())})`,margin:0})}},rg);var $0=function(s,h){var y={};for(var x in s)Object.prototype.hasOwnProperty.call(s,x)&&h.indexOf(x)<0&&(y[x]=s[x]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var w=0,x=Object.getOwnPropertySymbols(s);w<x.length;w++)h.indexOf(x[w])<0&&Object.prototype.propertyIsEnumerable.call(s,x[w])&&(y[x[w]]=s[x[w]]);return y};function Kh(s,h){return h===null||h===!1?null:h||k.createElement("span",{className:`${s}-close-x`},k.createElement(so,{className:`${s}-close-icon`}))}const O0={success:jc,info:Hh,error:Vc,warning:Nh},og=s=>{const{prefixCls:h,icon:y,type:x,message:w,description:E,btn:z,role:o="alert"}=s;let O=null;return y?O=k.createElement("span",{className:`${h}-icon`},y):x&&(O=k.createElement(O0[x]||null,{className:_t(`${h}-icon`,`${h}-icon-${x}`)})),k.createElement("div",{className:_t({[`${h}-with-icon`]:O}),role:o},O,k.createElement("div",{className:`${h}-message`},w),k.createElement("div",{className:`${h}-description`},E),z&&k.createElement("div",{className:`${h}-btn`},z))},B0=s=>{const{prefixCls:h,className:y,icon:x,type:w,message:E,description:z,btn:o,closable:O=!0,closeIcon:L,className:V}=s,q=$0(s,["prefixCls","className","icon","type","message","description","btn","closable","closeIcon","className"]),{getPrefixCls:Q}=k.useContext(xn),ae=h||Q("notification"),fe=`${ae}-notice`,me=oo(ae),[xe,ve,be]=ag(ae,me);return xe(k.createElement("div",{className:_t(`${fe}-pure-panel`,ve,y,be,me)},k.createElement(R0,{prefixCls:ae}),k.createElement(Wh,Object.assign({},q,{prefixCls:ae,eventKey:"pure",duration:null,closable:O,className:_t({notificationClassName:V}),closeIcon:Kh(ae,L),content:k.createElement(og,{prefixCls:fe,icon:x,type:w,message:E,description:z,btn:o})}))))},F0=B0;function N0(s,h,y){let x;switch(s){case"top":x={left:"50%",transform:"translateX(-50%)",right:"auto",top:h,bottom:"auto"};break;case"topLeft":x={left:0,top:h,bottom:"auto"};break;case"topRight":x={right:0,top:h,bottom:"auto"};break;case"bottom":x={left:"50%",transform:"translateX(-50%)",right:"auto",top:"auto",bottom:y};break;case"bottomLeft":x={left:0,top:"auto",bottom:y};break;default:x={right:0,top:"auto",bottom:y};break}return x}function j0(s){return{motionName:`${s}-fade`}}var V0=function(s,h){var y={};for(var x in s)Object.prototype.hasOwnProperty.call(s,x)&&h.indexOf(x)<0&&(y[x]=s[x]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var w=0,x=Object.getOwnPropertySymbols(s);w<x.length;w++)h.indexOf(x[w])<0&&Object.prototype.propertyIsEnumerable.call(s,x[w])&&(y[x[w]]=s[x[w]]);return y};const cf=24,U0=4.5,q0="topRight",G0=s=>{let{children:h,prefixCls:y}=s;const x=oo(y),[w,E,z]=ag(y,x);return w(k.createElement(Am,{classNames:{list:_t(E,z,x)}},h))},Z0=(s,h)=>{let{prefixCls:y,key:x}=h;return k.createElement(G0,{prefixCls:y,key:x},s)},H0=k.forwardRef((s,h)=>{const{top:y,bottom:x,prefixCls:w,getContainer:E,maxCount:z,rtl:o,onAllRemoved:O,stack:L}=s,{getPrefixCls:V,getPopupContainer:q,notification:Q}=k.useContext(xn),[,ae]=xm(),fe=w||V("notification"),me=ce=>N0(ce,y??cf,x??cf),xe=()=>_t({[`${fe}-rtl`]:o}),ve=()=>j0(fe),[be,ge]=km({prefixCls:fe,style:me,className:xe,motion:ve,closable:!0,closeIcon:Kh(fe),duration:U0,getContainer:()=>E?.()||q?.()||document.body,maxCount:z,onAllRemoved:O,renderNotifications:Z0,stack:L===!1?!1:{threshold:typeof L=="object"?L?.threshold:void 0,offset:8,gap:ae.margin}});return k.useImperativeHandle(h,()=>Object.assign(Object.assign({},be),{prefixCls:fe,notification:Q})),ge});function sg(s){const h=k.useRef(null);return dm(),[k.useMemo(()=>{const x=o=>{var O;if(!h.current)return;const{open:L,prefixCls:V,notification:q}=h.current,Q=`${V}-notice`,{message:ae,description:fe,icon:me,type:xe,btn:ve,className:be,style:ge,role:ce="alert",closeIcon:Se}=o,ze=V0(o,["message","description","icon","type","btn","className","style","role","closeIcon"]),Be=Kh(Q,Se);return L(Object.assign(Object.assign({placement:(O=s?.placement)!==null&&O!==void 0?O:q0},ze),{content:k.createElement(og,{prefixCls:Q,icon:me,type:xe,message:ae,description:fe,btn:ve,role:ce}),className:_t(xe&&`${Q}-${xe}`,be,q?.className),style:Object.assign(Object.assign({},q?.style),ge),closeIcon:Be,closable:!!Be}))},E={open:x,destroy:o=>{var O,L;o!==void 0?(O=h.current)===null||O===void 0||O.close(o):(L=h.current)===null||L===void 0||L.destroy()}};return["success","info","warning","error"].forEach(o=>{E[o]=O=>x(Object.assign(Object.assign({},O),{type:o}))}),E},[]),k.createElement(H0,Object.assign({key:"notification-holder"},s,{ref:h}))]}function W0(s){return sg(s)}var X0={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M482 152h60q8 0 8 8v704q0 8-8 8h-60q-8 0-8-8V160q0-8 8-8z"}},{tag:"path",attrs:{d:"M192 474h672q8 0 8 8v60q0 8-8 8H160q-8 0-8-8v-60q0-8 8-8z"}}]},name:"plus",theme:"outlined"};const K0=X0;var Y0=function(h,y){return k.createElement(La,mi({},h,{ref:y,icon:K0}))};const J0=k.forwardRef(Y0);function Q0(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{inkBar:!0,tabPane:!1},h;return s===!1?h={inkBar:!1,tabPane:!1}:s===!0?h={inkBar:!0,tabPane:!1}:h=ri({inkBar:!0},Hn(s)==="object"?s:{}),h.tabPaneMotion&&h.tabPane===void 0&&(h.tabPane=!0),!h.tabPaneMotion&&h.tabPane&&(h.tabPane=!1),h}const qc=k.createContext(null);var ex=function(h){var y=h.activeTabOffset,x=h.horizontal,w=h.rtl,E=h.indicatorSize,z=k.useState(),o=ii(z,2),O=o[0],L=o[1],V=k.useRef(),q=function(fe){return typeof E=="function"?E(fe):typeof E=="number"?E:fe};function Q(){Np.cancel(V.current)}return k.useEffect(function(){var ae={};return y&&(x?(w?(ae.right=y.right+y.width/2,ae.transform="translateX(50%)"):(ae.left=y.left+y.width/2,ae.transform="translateX(-50%)"),ae.width=q(y.width)):(ae.top=y.top+y.height/2,ae.transform="translateY(-50%)",ae.height=q(y.height))),Q(),V.current=Np(function(){L(ae)}),Q},[y,x,w,E]),{style:O}},uf={width:0,height:0,left:0,top:0};function tx(s,h,y){return k.useMemo(function(){for(var x,w=new Map,E=h.get((x=s[0])===null||x===void 0?void 0:x.key)||uf,z=E.left+E.width,o=0;o<s.length;o+=1){var O=s[o].key,L=h.get(O);if(!L){var V;L=h.get((V=s[o-1])===null||V===void 0?void 0:V.key)||uf}var q=w.get(O)||ri({},L);q.right=z-q.left-q.width,w.set(O,q)}return w},[s.map(function(x){return x.key}).join("_"),h,y])}function hf(s,h){var y=k.useRef(s),x=k.useState({}),w=ii(x,2),E=w[1];function z(o){var O=typeof o=="function"?o(y.current):o;O!==y.current&&h(O,y.current),y.current=O,E({})}return[y.current,z]}var ix=.1,df=.01,kc=20,pf=Math.pow(.995,kc);function rx(s,h){var y=k.useState(),x=ii(y,2),w=x[0],E=x[1],z=k.useState(0),o=ii(z,2),O=o[0],L=o[1],V=k.useState(0),q=ii(V,2),Q=q[0],ae=q[1],fe=k.useState(),me=ii(fe,2),xe=me[0],ve=me[1],be=k.useRef();function ge(De){var Ce=De.touches[0],je=Ce.screenX,Ge=Ce.screenY;E({x:je,y:Ge}),window.clearInterval(be.current)}function ce(De){if(w){De.preventDefault();var Ce=De.touches[0],je=Ce.screenX,Ge=Ce.screenY;E({x:je,y:Ge});var tt=je-w.x,He=Ge-w.y;h(tt,He);var ot=Date.now();L(ot),ae(ot-O),ve({x:tt,y:He})}}function Se(){if(w&&(E(null),ve(null),xe)){var De=xe.x/Q,Ce=xe.y/Q,je=Math.abs(De),Ge=Math.abs(Ce);if(Math.max(je,Ge)<ix)return;var tt=De,He=Ce;be.current=window.setInterval(function(){if(Math.abs(tt)<df&&Math.abs(He)<df){window.clearInterval(be.current);return}tt*=pf,He*=pf,h(tt*kc,He*kc)},kc)}}var ze=k.useRef();function Be(De){var Ce=De.deltaX,je=De.deltaY,Ge=0,tt=Math.abs(Ce),He=Math.abs(je);tt===He?Ge=ze.current==="x"?Ce:je:tt>He?(Ge=Ce,ze.current="x"):(Ge=je,ze.current="y"),h(-Ge,-Ge)&&De.preventDefault()}var $e=k.useRef(null);$e.current={onTouchStart:ge,onTouchMove:ce,onTouchEnd:Se,onWheel:Be},k.useEffect(function(){function De(tt){$e.current.onTouchStart(tt)}function Ce(tt){$e.current.onTouchMove(tt)}function je(tt){$e.current.onTouchEnd(tt)}function Ge(tt){$e.current.onWheel(tt)}return document.addEventListener("touchmove",Ce,{passive:!1}),document.addEventListener("touchend",je,{passive:!1}),s.current.addEventListener("touchstart",De,{passive:!1}),s.current.addEventListener("wheel",Ge),function(){document.removeEventListener("touchmove",Ce),document.removeEventListener("touchend",je)}},[])}function lg(s){var h=k.useState(0),y=ii(h,2),x=y[0],w=y[1],E=k.useRef(0),z=k.useRef();return z.current=s,H_(function(){var o;(o=z.current)===null||o===void 0||o.call(z)},[x]),function(){E.current===x&&(E.current+=1,w(E.current))}}function nx(s){var h=k.useRef([]),y=k.useState({}),x=ii(y,2),w=x[1],E=k.useRef(typeof s=="function"?s():s),z=lg(function(){var O=E.current;h.current.forEach(function(L){O=L(O)}),h.current=[],E.current=O,w({})});function o(O){h.current.push(O),z()}return[E.current,o]}var ff={width:0,height:0,left:0,top:0,right:0};function ax(s,h,y,x,w,E,z){var o=z.tabs,O=z.tabPosition,L=z.rtl,V,q,Q;return["top","bottom"].includes(O)?(V="width",q=L?"right":"left",Q=Math.abs(y)):(V="height",q="top",Q=-y),k.useMemo(function(){if(!o.length)return[0,0];for(var ae=o.length,fe=ae,me=0;me<ae;me+=1){var xe=s.get(o[me].key)||ff;if(xe[q]+xe[V]>Q+h){fe=me-1;break}}for(var ve=0,be=ae-1;be>=0;be-=1){var ge=s.get(o[be].key)||ff;if(ge[q]<Q){ve=be+1;break}}return ve>=fe?[0,0]:[ve,fe]},[s,h,x,w,E,Q,O,o.map(function(ae){return ae.key}).join("_"),L])}function mf(s){var h;return s instanceof Map?(h={},s.forEach(function(y,x){h[x]=y})):h=s,JSON.stringify(h)}var ox="TABS_DQ";function cg(s){return String(s).replace(/"/g,ox)}function ug(s,h,y,x){return!(!y||x||s===!1||s===void 0&&(h===!1||h===null))}var hg=k.forwardRef(function(s,h){var y=s.prefixCls,x=s.editable,w=s.locale,E=s.style;return!x||x.showAdd===!1?null:k.createElement("button",{ref:h,type:"button",className:"".concat(y,"-nav-add"),style:E,"aria-label":w?.addAriaLabel||"Add tab",onClick:function(o){x.onEdit("add",{event:o})}},x.addIcon||"+")}),gf=k.forwardRef(function(s,h){var y=s.position,x=s.prefixCls,w=s.extra;if(!w)return null;var E,z={};return Hn(w)==="object"&&!k.isValidElement(w)?z=w:z.right=w,y==="right"&&(E=z.right),y==="left"&&(E=z.left),E?k.createElement("div",{className:"".concat(x,"-extra-content"),ref:h},E):null}),sx=k.forwardRef(function(s,h){var y=s.prefixCls,x=s.id,w=s.tabs,E=s.locale,z=s.mobile,o=s.moreIcon,O=o===void 0?"More":o,L=s.moreTransitionName,V=s.style,q=s.className,Q=s.editable,ae=s.tabBarGutter,fe=s.rtl,me=s.removeAriaLabel,xe=s.onTabClick,ve=s.getPopupContainer,be=s.popupClassName,ge=k.useState(!1),ce=ii(ge,2),Se=ce[0],ze=ce[1],Be=k.useState(null),$e=ii(Be,2),De=$e[0],Ce=$e[1],je="".concat(x,"-more-popup"),Ge="".concat(y,"-dropdown"),tt=De!==null?"".concat(je,"-").concat(De):null,He=E?.dropdownAriaLabel;function ot(ft,Oe){ft.preventDefault(),ft.stopPropagation(),Q.onEdit("remove",{key:Oe,event:ft})}var Tt=k.createElement(W_,{onClick:function(Oe){var gt=Oe.key,Bt=Oe.domEvent;xe(gt,Bt),ze(!1)},prefixCls:"".concat(Ge,"-menu"),id:je,tabIndex:-1,role:"listbox","aria-activedescendant":tt,selectedKeys:[De],"aria-label":He!==void 0?He:"expanded dropdown"},w.map(function(ft){var Oe=ft.closable,gt=ft.disabled,Bt=ft.closeIcon,wt=ft.key,$t=ft.label,Yt=ug(Oe,Bt,Q,gt);return k.createElement(X_,{key:wt,id:"".concat(je,"-").concat(wt),role:"option","aria-controls":x&&"".concat(x,"-panel-").concat(wt),disabled:gt},k.createElement("span",null,$t),Yt&&k.createElement("button",{type:"button","aria-label":me||"remove",tabIndex:0,className:"".concat(Ge,"-menu-item-remove"),onClick:function(kt){kt.stopPropagation(),ot(kt,wt)}},Bt||Q.removeIcon||"×"))}));function st(ft){for(var Oe=w.filter(function(Yt){return!Yt.disabled}),gt=Oe.findIndex(function(Yt){return Yt.key===De})||0,Bt=Oe.length,wt=0;wt<Bt;wt+=1){gt=(gt+ft+Bt)%Bt;var $t=Oe[gt];if(!$t.disabled){Ce($t.key);return}}}function jt(ft){var Oe=ft.which;if(!Se){[ln.DOWN,ln.SPACE,ln.ENTER].includes(Oe)&&(ze(!0),ft.preventDefault());return}switch(Oe){case ln.UP:st(-1),ft.preventDefault();break;case ln.DOWN:st(1),ft.preventDefault();break;case ln.ESC:ze(!1);break;case ln.SPACE:case ln.ENTER:De!==null&&xe(De,ft);break}}k.useEffect(function(){var ft=document.getElementById(tt);ft&&ft.scrollIntoView&&ft.scrollIntoView(!1)},[De]),k.useEffect(function(){Se||Ce(null)},[Se]);var At=si({},fe?"marginRight":"marginLeft",ae);w.length||(At.visibility="hidden",At.order=1);var Qt=_t(si({},"".concat(Ge,"-rtl"),fe)),Gt=z?null:k.createElement(K_,{prefixCls:Ge,overlay:Tt,trigger:["hover"],visible:w.length?Se:!1,transitionName:L,onVisibleChange:ze,overlayClassName:_t(Qt,be),mouseEnterDelay:.1,mouseLeaveDelay:.1,getPopupContainer:ve},k.createElement("button",{type:"button",className:"".concat(y,"-nav-more"),style:At,tabIndex:-1,"aria-hidden":"true","aria-haspopup":"listbox","aria-controls":je,id:"".concat(x,"-more"),"aria-expanded":Se,onKeyDown:jt},O));return k.createElement("div",{className:_t("".concat(y,"-nav-operations"),q),style:V,ref:h},Gt,k.createElement(hg,{prefixCls:y,locale:E,editable:Q}))});const lx=k.memo(sx,function(s,h){return h.tabMoving});var cx=function(h){var y,x=h.prefixCls,w=h.id,E=h.active,z=h.tab,o=z.key,O=z.label,L=z.disabled,V=z.closeIcon,q=z.icon,Q=h.closable,ae=h.renderWrapper,fe=h.removeAriaLabel,me=h.editable,xe=h.onClick,ve=h.onFocus,be=h.style,ge="".concat(x,"-tab"),ce=ug(Q,V,me,L);function Se(De){L||xe(De)}function ze(De){De.preventDefault(),De.stopPropagation(),me.onEdit("remove",{key:o,event:De})}var Be=k.useMemo(function(){return q&&typeof O=="string"?k.createElement("span",null,O):O},[O,q]),$e=k.createElement("div",{key:o,"data-node-key":cg(o),className:_t(ge,(y={},si(y,"".concat(ge,"-with-remove"),ce),si(y,"".concat(ge,"-active"),E),si(y,"".concat(ge,"-disabled"),L),y)),style:be,onClick:Se},k.createElement("div",{role:"tab","aria-selected":E,id:w&&"".concat(w,"-tab-").concat(o),className:"".concat(ge,"-btn"),"aria-controls":w&&"".concat(w,"-panel-").concat(o),"aria-disabled":L,tabIndex:L?null:0,onClick:function(Ce){Ce.stopPropagation(),Se(Ce)},onKeyDown:function(Ce){[ln.SPACE,ln.ENTER].includes(Ce.which)&&(Ce.preventDefault(),Se(Ce))},onFocus:ve},q&&k.createElement("span",{className:"".concat(ge,"-icon")},q),O&&Be),ce&&k.createElement("button",{type:"button","aria-label":fe||"remove",tabIndex:0,className:"".concat(ge,"-remove"),onClick:function(Ce){Ce.stopPropagation(),ze(Ce)}},V||me.removeIcon||"×"));return ae?ae($e):$e},ux=function(h,y){var x=h.offsetWidth,w=h.offsetHeight,E=h.offsetTop,z=h.offsetLeft,o=h.getBoundingClientRect(),O=o.width,L=o.height,V=o.x,q=o.y;return Math.abs(O-x)<1?[O,L,V-y.x,q-y.y]:[x,w,z,E]},Ko=function(h){var y=h.current||{},x=y.offsetWidth,w=x===void 0?0:x,E=y.offsetHeight,z=E===void 0?0:E;if(h.current){var o=h.current.getBoundingClientRect(),O=o.width,L=o.height;if(Math.abs(O-w)<1)return[O,L]}return[w,z]},Ic=function(h,y){return h[y?0:1]},yf=k.forwardRef(function(s,h){var y,x=s.className,w=s.style,E=s.id,z=s.animated,o=s.activeKey,O=s.rtl,L=s.extra,V=s.editable,q=s.locale,Q=s.tabPosition,ae=s.tabBarGutter,fe=s.children,me=s.onTabClick,xe=s.onTabScroll,ve=s.indicatorSize,be=k.useContext(qc),ge=be.prefixCls,ce=be.tabs,Se=k.useRef(null),ze=k.useRef(null),Be=k.useRef(null),$e=k.useRef(null),De=k.useRef(null),Ce=k.useRef(null),je=k.useRef(null),Ge=Q==="top"||Q==="bottom",tt=hf(0,function(Ke,Ye){Ge&&xe&&xe({direction:Ke>Ye?"left":"right"})}),He=ii(tt,2),ot=He[0],Tt=He[1],st=hf(0,function(Ke,Ye){!Ge&&xe&&xe({direction:Ke>Ye?"top":"bottom"})}),jt=ii(st,2),At=jt[0],Qt=jt[1],Gt=k.useState([0,0]),ft=ii(Gt,2),Oe=ft[0],gt=ft[1],Bt=k.useState([0,0]),wt=ii(Bt,2),$t=wt[0],Yt=wt[1],ei=k.useState([0,0]),kt=ii(ei,2),gi=kt[0],pi=kt[1],Pt=k.useState([0,0]),li=ii(Pt,2),Xi=li[0],Ht=li[1],Mi=nx(new Map),Fi=ii(Mi,2),gr=Fi[0],Te=Fi[1],bi=tx(ce,gr,$t[0]),Li=Ic(Oe,Ge),Wt=Ic($t,Ge),Ft=Ic(gi,Ge),Gi=Ic(Xi,Ge),Ki=Li<Wt+Ft,yi=Ki?Li-Gi:Li-Ft,cn="".concat(ge,"-nav-operations-hidden"),or=0,ar=0;Ge&&O?(or=0,ar=Math.max(0,Wt-yi)):(or=Math.min(0,yi-Wt),ar=0);function qr(Ke){return Ke<or?or:Ke>ar?ar:Ke}var Ve=k.useRef(null),Et=k.useState(),St=ii(Et,2),Jt=St[0],zt=St[1];function Le(){zt(Date.now())}function mt(){Ve.current&&clearTimeout(Ve.current)}rx($e,function(Ke,Ye){function It(Ot,Rt){Ot(function(Lt){var Ni=qr(Lt+Rt);return Ni})}return Ki?(Ge?It(Tt,Ke):It(Qt,Ye),mt(),Le(),!0):!1}),k.useEffect(function(){return mt(),Jt&&(Ve.current=setTimeout(function(){zt(0)},100)),mt},[Jt]);var vt=ax(bi,yi,Ge?ot:At,Wt,Ft,Gi,ri(ri({},s),{},{tabs:ce})),wi=ii(vt,2),Zi=wi[0],Mt=wi[1],Gr=ym(function(){var Ke=arguments.length>0&&arguments[0]!==void 0?arguments[0]:o,Ye=bi.get(Ke)||{width:0,height:0,left:0,right:0,top:0};if(Ge){var It=ot;O?Ye.right<ot?It=Ye.right:Ye.right+Ye.width>ot+yi&&(It=Ye.right+Ye.width-yi):Ye.left<-ot?It=-Ye.left:Ye.left+Ye.width>-ot+yi&&(It=-(Ye.left+Ye.width-yi)),Qt(0),Tt(qr(It))}else{var Ot=At;Ye.top<-At?Ot=-Ye.top:Ye.top+Ye.height>-At+yi&&(Ot=-(Ye.top+Ye.height-yi)),Tt(0),Qt(qr(Ot))}}),W={};Q==="top"||Q==="bottom"?W[O?"marginRight":"marginLeft"]=ae:W.marginTop=ae;var D=ce.map(function(Ke,Ye){var It=Ke.key;return k.createElement(cx,{id:E,prefixCls:ge,key:It,tab:Ke,style:Ye===0?void 0:W,closable:Ke.closable,editable:V,active:It===o,renderWrapper:fe,removeAriaLabel:q?.removeAriaLabel,onClick:function(Rt){me(It,Rt)},onFocus:function(){Gr(It),Le(),$e.current&&(O||($e.current.scrollLeft=0),$e.current.scrollTop=0)}})}),$=function(){return Te(function(){var Ye,It=new Map,Ot=(Ye=De.current)===null||Ye===void 0?void 0:Ye.getBoundingClientRect();return ce.forEach(function(Rt){var Lt,Ni=Rt.key,ci=(Lt=De.current)===null||Lt===void 0?void 0:Lt.querySelector('[data-node-key="'.concat(cg(Ni),'"]'));if(ci){var Di=ux(ci,Ot),Ri=ii(Di,4),Cr=Ri[0],co=Ri[1],Rn=Ri[2],$n=Ri[3];It.set(Ni,{width:Cr,height:co,left:Rn,top:$n})}}),It})};k.useEffect(function(){$()},[ce.map(function(Ke){return Ke.key}).join("_")]);var j=lg(function(){var Ke=Ko(Se),Ye=Ko(ze),It=Ko(Be);gt([Ke[0]-Ye[0]-It[0],Ke[1]-Ye[1]-It[1]]);var Ot=Ko(je);pi(Ot);var Rt=Ko(Ce);Ht(Rt);var Lt=Ko(De);Yt([Lt[0]-Ot[0],Lt[1]-Ot[1]]),$()}),K=ce.slice(0,Zi),J=ce.slice(Mt+1),he=[].concat(qi(K),qi(J)),ne=bi.get(o),te=ex({activeTabOffset:ne,horizontal:Ge,rtl:O,indicatorSize:ve}),se=te.style;k.useEffect(function(){Gr()},[o,or,ar,mf(ne),mf(bi),Ge]),k.useEffect(function(){j()},[O]);var Ee=!!he.length,Ie="".concat(ge,"-nav-wrap"),Ae,dt,Ct,at;return Ge?O?(dt=ot>0,Ae=ot!==ar):(Ae=ot<0,dt=ot!==or):(Ct=At<0,at=At!==or),k.createElement(nh,{onResize:j},k.createElement("div",{ref:fm(h,Se),role:"tablist",className:_t("".concat(ge,"-nav"),x),style:w,onKeyDown:function(){Le()}},k.createElement(gf,{ref:ze,position:"left",extra:L,prefixCls:ge}),k.createElement(nh,{onResize:j},k.createElement("div",{className:_t(Ie,(y={},si(y,"".concat(Ie,"-ping-left"),Ae),si(y,"".concat(Ie,"-ping-right"),dt),si(y,"".concat(Ie,"-ping-top"),Ct),si(y,"".concat(Ie,"-ping-bottom"),at),y)),ref:$e},k.createElement(nh,{onResize:j},k.createElement("div",{ref:De,className:"".concat(ge,"-nav-list"),style:{transform:"translate(".concat(ot,"px, ").concat(At,"px)"),transition:Jt?"none":void 0}},D,k.createElement(hg,{ref:je,prefixCls:ge,locale:q,editable:V,style:ri(ri({},D.length===0?void 0:W),{},{visibility:Ee?"hidden":null})}),k.createElement("div",{className:_t("".concat(ge,"-ink-bar"),si({},"".concat(ge,"-ink-bar-animated"),z.inkBar)),style:se}))))),k.createElement(lx,mi({},s,{removeAriaLabel:q?.removeAriaLabel,ref:Ce,prefixCls:ge,tabs:he,className:!Ee&&cn,tabMoving:!!Jt})),k.createElement(gf,{ref:Be,position:"right",extra:L,prefixCls:ge})))}),dg=k.forwardRef(function(s,h){var y=s.prefixCls,x=s.className,w=s.style,E=s.id,z=s.active,o=s.tabKey,O=s.children;return k.createElement("div",{id:E&&"".concat(E,"-panel-").concat(o),role:"tabpanel",tabIndex:z?0:-1,"aria-labelledby":E&&"".concat(E,"-tab-").concat(o),"aria-hidden":!z,style:w,className:_t(y,z&&"".concat(y,"-active"),x),ref:h},O)}),hx=["renderTabBar"],dx=["label","key"],px=function(h){var y=h.renderTabBar,x=za(h,hx),w=k.useContext(qc),E=w.tabs;if(y){var z=ri(ri({},x),{},{panes:E.map(function(o){var O=o.label,L=o.key,V=za(o,dx);return k.createElement(dg,mi({tab:O,key:L,tabKey:L},V))})});return y(z,yf)}return k.createElement(yf,x)},fx=["key","forceRender","style","className","destroyInactiveTabPane"],mx=function(h){var y=h.id,x=h.activeKey,w=h.animated,E=h.tabPosition,z=h.destroyInactiveTabPane,o=k.useContext(qc),O=o.prefixCls,L=o.tabs,V=w.tabPane,q="".concat(O,"-tabpane");return k.createElement("div",{className:_t("".concat(O,"-content-holder"))},k.createElement("div",{className:_t("".concat(O,"-content"),"".concat(O,"-content-").concat(E),si({},"".concat(O,"-content-animated"),V))},L.map(function(Q){var ae=Q.key,fe=Q.forceRender,me=Q.style,xe=Q.className,ve=Q.destroyInactiveTabPane,be=za(Q,fx),ge=ae===x;return k.createElement(fl,mi({key:ae,visible:ge,forceRender:fe,removeOnLeave:!!(z||ve),leavedClassName:"".concat(q,"-hidden")},w.tabPaneMotion),function(ce,Se){var ze=ce.style,Be=ce.className;return k.createElement(dg,mi({},be,{prefixCls:q,id:y,tabKey:ae,animated:V,active:ge,style:ri(ri({},me),ze),className:_t(xe,Be),ref:Se}))})})))},gx=["id","prefixCls","className","items","direction","activeKey","defaultActiveKey","editable","animated","tabPosition","tabBarGutter","tabBarStyle","tabBarExtraContent","locale","moreIcon","moreTransitionName","destroyInactiveTabPane","renderTabBar","onChange","onTabClick","onTabScroll","getPopupContainer","popupClassName","indicatorSize"],_f=0,yx=k.forwardRef(function(s,h){var y,x=s.id,w=s.prefixCls,E=w===void 0?"rc-tabs":w,z=s.className,o=s.items,O=s.direction,L=s.activeKey,V=s.defaultActiveKey,q=s.editable,Q=s.animated,ae=s.tabPosition,fe=ae===void 0?"top":ae,me=s.tabBarGutter,xe=s.tabBarStyle,ve=s.tabBarExtraContent,be=s.locale,ge=s.moreIcon,ce=s.moreTransitionName,Se=s.destroyInactiveTabPane,ze=s.renderTabBar,Be=s.onChange,$e=s.onTabClick,De=s.onTabScroll,Ce=s.getPopupContainer,je=s.popupClassName,Ge=s.indicatorSize,tt=za(s,gx),He=k.useMemo(function(){return(o||[]).filter(function(Ht){return Ht&&Hn(Ht)==="object"&&"key"in Ht})},[o]),ot=O==="rtl",Tt=Q0(Q),st=k.useState(!1),jt=ii(st,2),At=jt[0],Qt=jt[1];k.useEffect(function(){Qt(Y_())},[]);var Gt=kh(function(){var Ht;return(Ht=He[0])===null||Ht===void 0?void 0:Ht.key},{value:L,defaultValue:V}),ft=ii(Gt,2),Oe=ft[0],gt=ft[1],Bt=k.useState(function(){return He.findIndex(function(Ht){return Ht.key===Oe})}),wt=ii(Bt,2),$t=wt[0],Yt=wt[1];k.useEffect(function(){var Ht=He.findIndex(function(Fi){return Fi.key===Oe});if(Ht===-1){var Mi;Ht=Math.max(0,Math.min($t,He.length-1)),gt((Mi=He[Ht])===null||Mi===void 0?void 0:Mi.key)}Yt(Ht)},[He.map(function(Ht){return Ht.key}).join("_"),Oe,$t]);var ei=kh(null,{value:x}),kt=ii(ei,2),gi=kt[0],pi=kt[1];k.useEffect(function(){x||(pi("rc-tabs-".concat(_f)),_f+=1)},[]);function Pt(Ht,Mi){$e?.(Ht,Mi);var Fi=Ht!==Oe;gt(Ht),Fi&&Be?.(Ht)}var li={id:gi,activeKey:Oe,animated:Tt,tabPosition:fe,rtl:ot,mobile:At},Xi=ri(ri({},li),{},{editable:q,locale:be,moreIcon:ge,moreTransitionName:ce,tabBarGutter:me,onTabClick:Pt,onTabScroll:De,extra:ve,style:xe,panes:null,getPopupContainer:Ce,popupClassName:je,indicatorSize:Ge});return k.createElement(qc.Provider,{value:{tabs:He,prefixCls:E}},k.createElement("div",mi({ref:h,id:x,className:_t(E,"".concat(E,"-").concat(fe),(y={},si(y,"".concat(E,"-mobile"),At),si(y,"".concat(E,"-editable"),q),si(y,"".concat(E,"-rtl"),ot),y),z)},tt),k.createElement(px,mi({},Xi,{renderTabBar:ze})),k.createElement(mx,mi({destroyInactiveTabPane:Se},li,{animated:Tt}))))});const _x={motionAppear:!1,motionEnter:!0,motionLeave:!0};function vx(s){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{inkBar:!0,tabPane:!1},y;return h===!1?y={inkBar:!1,tabPane:!1}:h===!0?y={inkBar:!0,tabPane:!0}:y=Object.assign({inkBar:!0},typeof h=="object"?h:{}),y.tabPane&&(y.tabPaneMotion=Object.assign(Object.assign({},_x),{motionName:dl(s,"switch")})),y}var xx=function(s,h){var y={};for(var x in s)Object.prototype.hasOwnProperty.call(s,x)&&h.indexOf(x)<0&&(y[x]=s[x]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var w=0,x=Object.getOwnPropertySymbols(s);w<x.length;w++)h.indexOf(x[w])<0&&Object.prototype.propertyIsEnumerable.call(s,x[w])&&(y[x[w]]=s[x[w]]);return y};function bx(s){return s.filter(h=>h)}function wx(s,h){if(s)return s;const y=J_(h).map(x=>{if(k.isValidElement(x)){const{key:w,props:E}=x,z=E||{},{tab:o}=z,O=xx(z,["tab"]);return Object.assign(Object.assign({key:String(w)},O),{label:o})}return null});return bx(y)}const Sx=s=>{const{componentCls:h,motionDurationSlow:y}=s;return[{[h]:{[`${h}-switch`]:{"&-appear, &-enter":{transition:"none","&-start":{opacity:0},"&-active":{opacity:1,transition:`opacity ${y}`}},"&-leave":{position:"absolute",transition:"none",inset:0,"&-start":{opacity:1},"&-active":{opacity:0,transition:`opacity ${y}`}}}}},[jp(s,"slide-up"),jp(s,"slide-down")]]},Cx=Sx,Tx=s=>{const{componentCls:h,tabsCardPadding:y,cardBg:x,cardGutter:w,colorBorderSecondary:E,itemSelectedColor:z}=s;return{[`${h}-card`]:{[`> ${h}-nav, > div > ${h}-nav`]:{[`${h}-tab`]:{margin:0,padding:y,background:x,border:`${nt(s.lineWidth)} ${s.lineType} ${E}`,transition:`all ${s.motionDurationSlow} ${s.motionEaseInOut}`},[`${h}-tab-active`]:{color:z,background:s.colorBgContainer},[`${h}-ink-bar`]:{visibility:"hidden"}},[`&${h}-top, &${h}-bottom`]:{[`> ${h}-nav, > div > ${h}-nav`]:{[`${h}-tab + ${h}-tab`]:{marginLeft:{_skip_check_:!0,value:nt(w)}}}},[`&${h}-top`]:{[`> ${h}-nav, > div > ${h}-nav`]:{[`${h}-tab`]:{borderRadius:`${nt(s.borderRadiusLG)} ${nt(s.borderRadiusLG)} 0 0`},[`${h}-tab-active`]:{borderBottomColor:s.colorBgContainer}}},[`&${h}-bottom`]:{[`> ${h}-nav, > div > ${h}-nav`]:{[`${h}-tab`]:{borderRadius:`0 0 ${nt(s.borderRadiusLG)} ${nt(s.borderRadiusLG)}`},[`${h}-tab-active`]:{borderTopColor:s.colorBgContainer}}},[`&${h}-left, &${h}-right`]:{[`> ${h}-nav, > div > ${h}-nav`]:{[`${h}-tab + ${h}-tab`]:{marginTop:nt(w)}}},[`&${h}-left`]:{[`> ${h}-nav, > div > ${h}-nav`]:{[`${h}-tab`]:{borderRadius:{_skip_check_:!0,value:`${nt(s.borderRadiusLG)} 0 0 ${nt(s.borderRadiusLG)}`}},[`${h}-tab-active`]:{borderRightColor:{_skip_check_:!0,value:s.colorBgContainer}}}},[`&${h}-right`]:{[`> ${h}-nav, > div > ${h}-nav`]:{[`${h}-tab`]:{borderRadius:{_skip_check_:!0,value:`0 ${nt(s.borderRadiusLG)} ${nt(s.borderRadiusLG)} 0`}},[`${h}-tab-active`]:{borderLeftColor:{_skip_check_:!0,value:s.colorBgContainer}}}}}}},Ex=s=>{const{componentCls:h,itemHoverColor:y,dropdownEdgeChildVerticalPadding:x}=s;return{[`${h}-dropdown`]:Object.assign(Object.assign({},ao(s)),{position:"absolute",top:-9999,left:{_skip_check_:!0,value:-9999},zIndex:s.zIndexPopup,display:"block","&-hidden":{display:"none"},[`${h}-dropdown-menu`]:{maxHeight:s.tabsDropdownHeight,margin:0,padding:`${nt(x)} 0`,overflowX:"hidden",overflowY:"auto",textAlign:{_skip_check_:!0,value:"left"},listStyleType:"none",backgroundColor:s.colorBgContainer,backgroundClip:"padding-box",borderRadius:s.borderRadiusLG,outline:"none",boxShadow:s.boxShadowSecondary,"&-item":Object.assign(Object.assign({},Gh),{display:"flex",alignItems:"center",minWidth:s.tabsDropdownWidth,margin:0,padding:`${nt(s.paddingXXS)} ${nt(s.paddingSM)}`,color:s.colorText,fontWeight:"normal",fontSize:s.fontSize,lineHeight:s.lineHeight,cursor:"pointer",transition:`all ${s.motionDurationSlow}`,"> span":{flex:1,whiteSpace:"nowrap"},"&-remove":{flex:"none",marginLeft:{_skip_check_:!0,value:s.marginSM},color:s.colorTextDescription,fontSize:s.fontSizeSM,background:"transparent",border:0,cursor:"pointer","&:hover":{color:y}},"&:hover":{background:s.controlItemBgHover},"&-disabled":{"&, &:hover":{color:s.colorTextDisabled,background:"transparent",cursor:"not-allowed"}}})}})}},Ix=s=>{const{componentCls:h,margin:y,colorBorderSecondary:x,horizontalMargin:w,verticalItemPadding:E,verticalItemMargin:z,calc:o}=s;return{[`${h}-top, ${h}-bottom`]:{flexDirection:"column",[`> ${h}-nav, > div > ${h}-nav`]:{margin:w,"&::before":{position:"absolute",right:{_skip_check_:!0,value:0},left:{_skip_check_:!0,value:0},borderBottom:`${nt(s.lineWidth)} ${s.lineType} ${x}`,content:"''"},[`${h}-ink-bar`]:{height:s.lineWidthBold,"&-animated":{transition:`width ${s.motionDurationSlow}, left ${s.motionDurationSlow},
            right ${s.motionDurationSlow}`}},[`${h}-nav-wrap`]:{"&::before, &::after":{top:0,bottom:0,width:s.controlHeight},"&::before":{left:{_skip_check_:!0,value:0},boxShadow:s.boxShadowTabsOverflowLeft},"&::after":{right:{_skip_check_:!0,value:0},boxShadow:s.boxShadowTabsOverflowRight},[`&${h}-nav-wrap-ping-left::before`]:{opacity:1},[`&${h}-nav-wrap-ping-right::after`]:{opacity:1}}}},[`${h}-top`]:{[`> ${h}-nav,
        > div > ${h}-nav`]:{"&::before":{bottom:0},[`${h}-ink-bar`]:{bottom:0}}},[`${h}-bottom`]:{[`> ${h}-nav, > div > ${h}-nav`]:{order:1,marginTop:y,marginBottom:0,"&::before":{top:0},[`${h}-ink-bar`]:{top:0}},[`> ${h}-content-holder, > div > ${h}-content-holder`]:{order:0}},[`${h}-left, ${h}-right`]:{[`> ${h}-nav, > div > ${h}-nav`]:{flexDirection:"column",minWidth:o(s.controlHeight).mul(1.25).equal(),[`${h}-tab`]:{padding:E,textAlign:"center"},[`${h}-tab + ${h}-tab`]:{margin:z},[`${h}-nav-wrap`]:{flexDirection:"column","&::before, &::after":{right:{_skip_check_:!0,value:0},left:{_skip_check_:!0,value:0},height:s.controlHeight},"&::before":{top:0,boxShadow:s.boxShadowTabsOverflowTop},"&::after":{bottom:0,boxShadow:s.boxShadowTabsOverflowBottom},[`&${h}-nav-wrap-ping-top::before`]:{opacity:1},[`&${h}-nav-wrap-ping-bottom::after`]:{opacity:1}},[`${h}-ink-bar`]:{width:s.lineWidthBold,"&-animated":{transition:`height ${s.motionDurationSlow}, top ${s.motionDurationSlow}`}},[`${h}-nav-list, ${h}-nav-operations`]:{flex:"1 0 auto",flexDirection:"column"}}},[`${h}-left`]:{[`> ${h}-nav, > div > ${h}-nav`]:{[`${h}-ink-bar`]:{right:{_skip_check_:!0,value:0}}},[`> ${h}-content-holder, > div > ${h}-content-holder`]:{marginLeft:{_skip_check_:!0,value:nt(o(s.lineWidth).mul(-1).equal())},borderLeft:{_skip_check_:!0,value:`${nt(s.lineWidth)} ${s.lineType} ${s.colorBorder}`},[`> ${h}-content > ${h}-tabpane`]:{paddingLeft:{_skip_check_:!0,value:s.paddingLG}}}},[`${h}-right`]:{[`> ${h}-nav, > div > ${h}-nav`]:{order:1,[`${h}-ink-bar`]:{left:{_skip_check_:!0,value:0}}},[`> ${h}-content-holder, > div > ${h}-content-holder`]:{order:0,marginRight:{_skip_check_:!0,value:o(s.lineWidth).mul(-1).equal()},borderRight:{_skip_check_:!0,value:`${nt(s.lineWidth)} ${s.lineType} ${s.colorBorder}`},[`> ${h}-content > ${h}-tabpane`]:{paddingRight:{_skip_check_:!0,value:s.paddingLG}}}}}},Px=s=>{const{componentCls:h,cardPaddingSM:y,cardPaddingLG:x,horizontalItemPaddingSM:w,horizontalItemPaddingLG:E}=s;return{[h]:{"&-small":{[`> ${h}-nav`]:{[`${h}-tab`]:{padding:w,fontSize:s.titleFontSizeSM}}},"&-large":{[`> ${h}-nav`]:{[`${h}-tab`]:{padding:E,fontSize:s.titleFontSizeLG}}}},[`${h}-card`]:{[`&${h}-small`]:{[`> ${h}-nav`]:{[`${h}-tab`]:{padding:y}},[`&${h}-bottom`]:{[`> ${h}-nav ${h}-tab`]:{borderRadius:`0 0 ${nt(s.borderRadius)} ${nt(s.borderRadius)}`}},[`&${h}-top`]:{[`> ${h}-nav ${h}-tab`]:{borderRadius:`${nt(s.borderRadius)} ${nt(s.borderRadius)} 0 0`}},[`&${h}-right`]:{[`> ${h}-nav ${h}-tab`]:{borderRadius:{_skip_check_:!0,value:`0 ${nt(s.borderRadius)} ${nt(s.borderRadius)} 0`}}},[`&${h}-left`]:{[`> ${h}-nav ${h}-tab`]:{borderRadius:{_skip_check_:!0,value:`${nt(s.borderRadius)} 0 0 ${nt(s.borderRadius)}`}}}},[`&${h}-large`]:{[`> ${h}-nav`]:{[`${h}-tab`]:{padding:x}}}}}},Mx=s=>{const{componentCls:h,itemActiveColor:y,itemHoverColor:x,iconCls:w,tabsHorizontalItemMargin:E,horizontalItemPadding:z,itemSelectedColor:o,itemColor:O}=s,L=`${h}-tab`;return{[L]:{position:"relative",WebkitTouchCallout:"none",WebkitTapHighlightColor:"transparent",display:"inline-flex",alignItems:"center",padding:z,fontSize:s.titleFontSize,background:"transparent",border:0,outline:"none",cursor:"pointer",color:O,"&-btn, &-remove":Object.assign({"&:focus:not(:focus-visible), &:active":{color:y}},jh(s)),"&-btn":{outline:"none",transition:"all 0.3s",[`${L}-icon:not(:last-child)`]:{marginInlineEnd:s.marginSM}},"&-remove":{flex:"none",marginRight:{_skip_check_:!0,value:s.calc(s.marginXXS).mul(-1).equal()},marginLeft:{_skip_check_:!0,value:s.marginXS},color:s.colorTextDescription,fontSize:s.fontSizeSM,background:"transparent",border:"none",outline:"none",cursor:"pointer",transition:`all ${s.motionDurationSlow}`,"&:hover":{color:s.colorTextHeading}},"&:hover":{color:x},[`&${L}-active ${L}-btn`]:{color:o,textShadow:s.tabsActiveTextShadow},[`&${L}-disabled`]:{color:s.colorTextDisabled,cursor:"not-allowed"},[`&${L}-disabled ${L}-btn, &${L}-disabled ${h}-remove`]:{"&:focus, &:active":{color:s.colorTextDisabled}},[`& ${L}-remove ${w}`]:{margin:0},[`${w}:not(:last-child)`]:{marginRight:{_skip_check_:!0,value:s.marginSM}}},[`${L} + ${L}`]:{margin:{_skip_check_:!0,value:E}}}},Ax=s=>{const{componentCls:h,tabsHorizontalItemMarginRTL:y,iconCls:x,cardGutter:w,calc:E}=s;return{[`${h}-rtl`]:{direction:"rtl",[`${h}-nav`]:{[`${h}-tab`]:{margin:{_skip_check_:!0,value:y},[`${h}-tab:last-of-type`]:{marginLeft:{_skip_check_:!0,value:0}},[x]:{marginRight:{_skip_check_:!0,value:0},marginLeft:{_skip_check_:!0,value:nt(s.marginSM)}},[`${h}-tab-remove`]:{marginRight:{_skip_check_:!0,value:nt(s.marginXS)},marginLeft:{_skip_check_:!0,value:nt(E(s.marginXXS).mul(-1).equal())},[x]:{margin:0}}}},[`&${h}-left`]:{[`> ${h}-nav`]:{order:1},[`> ${h}-content-holder`]:{order:0}},[`&${h}-right`]:{[`> ${h}-nav`]:{order:0},[`> ${h}-content-holder`]:{order:1}},[`&${h}-card${h}-top, &${h}-card${h}-bottom`]:{[`> ${h}-nav, > div > ${h}-nav`]:{[`${h}-tab + ${h}-tab`]:{marginRight:{_skip_check_:!0,value:w},marginLeft:{_skip_check_:!0,value:0}}}}},[`${h}-dropdown-rtl`]:{direction:"rtl"},[`${h}-menu-item`]:{[`${h}-dropdown-rtl`]:{textAlign:{_skip_check_:!0,value:"right"}}}}},kx=s=>{const{componentCls:h,tabsCardPadding:y,cardHeight:x,cardGutter:w,itemHoverColor:E,itemActiveColor:z,colorBorderSecondary:o}=s;return{[h]:Object.assign(Object.assign(Object.assign(Object.assign({},ao(s)),{display:"flex",[`> ${h}-nav, > div > ${h}-nav`]:{position:"relative",display:"flex",flex:"none",alignItems:"center",[`${h}-nav-wrap`]:{position:"relative",display:"flex",flex:"auto",alignSelf:"stretch",overflow:"hidden",whiteSpace:"nowrap",transform:"translate(0)","&::before, &::after":{position:"absolute",zIndex:1,opacity:0,transition:`opacity ${s.motionDurationSlow}`,content:"''",pointerEvents:"none"}},[`${h}-nav-list`]:{position:"relative",display:"flex",transition:`opacity ${s.motionDurationSlow}`},[`${h}-nav-operations`]:{display:"flex",alignSelf:"stretch"},[`${h}-nav-operations-hidden`]:{position:"absolute",visibility:"hidden",pointerEvents:"none"},[`${h}-nav-more`]:{position:"relative",padding:y,background:"transparent",border:0,color:s.colorText,"&::after":{position:"absolute",right:{_skip_check_:!0,value:0},bottom:0,left:{_skip_check_:!0,value:0},height:s.calc(s.controlHeightLG).div(8).equal(),transform:"translateY(100%)",content:"''"}},[`${h}-nav-add`]:Object.assign({minWidth:x,minHeight:x,marginLeft:{_skip_check_:!0,value:w},padding:`0 ${nt(s.paddingXS)}`,background:"transparent",border:`${nt(s.lineWidth)} ${s.lineType} ${o}`,borderRadius:`${nt(s.borderRadiusLG)} ${nt(s.borderRadiusLG)} 0 0`,outline:"none",cursor:"pointer",color:s.colorText,transition:`all ${s.motionDurationSlow} ${s.motionEaseInOut}`,"&:hover":{color:E},"&:active, &:focus:not(:focus-visible)":{color:z}},jh(s))},[`${h}-extra-content`]:{flex:"none"},[`${h}-ink-bar`]:{position:"absolute",background:s.inkBarColor,pointerEvents:"none"}}),Mx(s)),{[`${h}-content`]:{position:"relative",width:"100%"},[`${h}-content-holder`]:{flex:"auto",minWidth:0,minHeight:0},[`${h}-tabpane`]:{outline:"none","&-hidden":{display:"none"}}}),[`${h}-centered`]:{[`> ${h}-nav, > div > ${h}-nav`]:{[`${h}-nav-wrap`]:{[`&:not([class*='${h}-nav-wrap-ping'])`]:{justifyContent:"center"}}}}}},zx=s=>{const h=s.controlHeightLG;return{zIndexPopup:s.zIndexPopupBase+50,cardBg:s.colorFillAlter,cardHeight:h,cardPadding:`${(h-Math.round(s.fontSize*s.lineHeight))/2-s.lineWidth}px ${s.padding}px`,cardPaddingSM:`${s.paddingXXS*1.5}px ${s.padding}px`,cardPaddingLG:`${s.paddingXS}px ${s.padding}px ${s.paddingXXS*1.5}px`,titleFontSize:s.fontSize,titleFontSizeLG:s.fontSizeLG,titleFontSizeSM:s.fontSize,inkBarColor:s.colorPrimary,horizontalMargin:`0 0 ${s.margin}px 0`,horizontalItemGutter:32,horizontalItemMargin:"",horizontalItemMarginRTL:"",horizontalItemPadding:`${s.paddingSM}px 0`,horizontalItemPaddingSM:`${s.paddingXS}px 0`,horizontalItemPaddingLG:`${s.padding}px 0`,verticalItemPadding:`${s.paddingXS}px ${s.paddingLG}px`,verticalItemMargin:`${s.margin}px 0 0 0`,itemColor:s.colorText,itemSelectedColor:s.colorPrimary,itemHoverColor:s.colorPrimaryHover,itemActiveColor:s.colorPrimaryActive,cardGutter:s.marginXXS/2}},Lx=es("Tabs",s=>{const h=ts(s,{tabsCardPadding:s.cardPadding,dropdownEdgeChildVerticalPadding:s.paddingXXS,tabsActiveTextShadow:"0 0 0.25px currentcolor",tabsDropdownHeight:200,tabsDropdownWidth:120,tabsHorizontalItemMargin:`0 0 0 ${nt(s.horizontalItemGutter)}`,tabsHorizontalItemMarginRTL:`0 0 0 ${nt(s.horizontalItemGutter)}`});return[Px(h),Ax(h),Ix(h),Ex(h),Tx(h),kx(h),Cx(h)]},zx),Dx=()=>null,Rx=Dx;var $x=function(s,h){var y={};for(var x in s)Object.prototype.hasOwnProperty.call(s,x)&&h.indexOf(x)<0&&(y[x]=s[x]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var w=0,x=Object.getOwnPropertySymbols(s);w<x.length;w++)h.indexOf(x[w])<0&&Object.prototype.propertyIsEnumerable.call(s,x[w])&&(y[x[w]]=s[x[w]]);return y};const pg=s=>{const{type:h,className:y,rootClassName:x,size:w,onEdit:E,hideAdd:z,centered:o,addIcon:O,popupClassName:L,children:V,items:q,animated:Q,style:ae,indicatorSize:fe}=s,me=$x(s,["type","className","rootClassName","size","onEdit","hideAdd","centered","addIcon","popupClassName","children","items","animated","style","indicatorSize"]),{prefixCls:xe,moreIcon:ve=k.createElement(ev,null)}=me,{direction:be,tabs:ge,getPrefixCls:ce,getPopupContainer:Se}=k.useContext(xn),ze=ce("tabs",xe),Be=oo(ze),[$e,De,Ce]=Lx(ze,Be);let je;h==="editable-card"&&(je={onEdit:(st,jt)=>{let{key:At,event:Qt}=jt;E?.(st==="add"?Qt:At,st)},removeIcon:k.createElement(so,null),addIcon:O||k.createElement(J0,null),showAdd:z!==!0});const Ge=ce(),tt=wx(q,V),He=vx(ze,Q),ot=Q_(w),Tt=Object.assign(Object.assign({},ge?.style),ae);return $e(k.createElement(yx,Object.assign({direction:be,getPopupContainer:Se,moreTransitionName:`${Ge}-slide-up`},me,{items:tt,className:_t({[`${ze}-${ot}`]:ot,[`${ze}-card`]:["card","editable-card"].includes(h),[`${ze}-editable-card`]:h==="editable-card",[`${ze}-centered`]:o},ge?.className,y,x,De,Ce,Be),popupClassName:_t(L,De,Ce,Be),style:Tt,editable:je,moreIcon:ve,prefixCls:ze,animated:He,indicatorSize:fe??ge?.indicatorSize})))};pg.TabPane=Rx;const Ox=pg;let _n=null,ro=s=>s(),pl=[],$c={};function vf(){const{prefixCls:s,getContainer:h,duration:y,rtl:x,maxCount:w,top:E}=$c,z=s??ml().getPrefixCls("message"),o=h?.()||document.body;return{prefixCls:z,getContainer:()=>o,duration:y,rtl:x,maxCount:w,top:E}}const Bx=k.forwardRef((s,h)=>{const[y,x]=k.useState(vf),[w,E]=Dm(y),z=ml(),o=z.getRootPrefixCls(),O=z.getIconPrefixCls(),L=z.getTheme(),V=()=>{x(vf)};return k.useEffect(V,[]),k.useImperativeHandle(h,()=>{const q=Object.assign({},w);return Object.keys(q).forEach(Q=>{q[Q]=function(){return V(),w[Q].apply(w,arguments)}}),{instance:q,sync:V}}),k.createElement(Uh,{prefixCls:o,iconPrefixCls:O,theme:L},E)});function Gc(){if(!_n){const s=document.createDocumentFragment(),h={fragment:s};_n=h,ro(()=>{qh(k.createElement(Bx,{ref:y=>{const{instance:x,sync:w}=y||{};Promise.resolve().then(()=>{!h.instance&&x&&(h.instance=x,h.sync=w,Gc())})}}),s)});return}_n.instance&&(pl.forEach(s=>{const{type:h,skipped:y}=s;if(!y)switch(h){case"open":{ro(()=>{const x=_n.instance.open(Object.assign(Object.assign({},$c),s.config));x?.then(s.resolve),s.setCloseFn(x)});break}case"destroy":ro(()=>{_n?.instance.destroy(s.key)});break;default:ro(()=>{var x;const w=(x=_n.instance)[h].apply(x,qi(s.args));w?.then(s.resolve),s.setCloseFn(w)})}}),pl=[])}function Fx(s){$c=Object.assign(Object.assign({},$c),s),ro(()=>{var h;(h=_n?.sync)===null||h===void 0||h.call(_n)})}function Nx(s){const h=Xh(y=>{let x;const w={type:"open",config:s,resolve:y,setCloseFn:E=>{x=E}};return pl.push(w),()=>{x?ro(()=>{x()}):w.skipped=!0}});return Gc(),h}function jx(s,h){const y=Xh(x=>{let w;const E={type:s,args:h,resolve:x,setCloseFn:z=>{w=z}};return pl.push(E),()=>{w?ro(()=>{w()}):E.skipped=!0}});return Gc(),y}function Vx(s){pl.push({type:"destroy",key:s}),Gc()}const Ux=["success","info","warning","error","loading"],qx={open:Nx,destroy:Vx,config:Fx,useMessage:qv,_InternalPanelDoNotUseOrYouWillBeFired:$v},fg=qx;Ux.forEach(s=>{fg[s]=function(){for(var h=arguments.length,y=new Array(h),x=0;x<h;x++)y[x]=arguments[x];return jx(s,y)}});const xf=fg;var Gx=function(s,h){var y={};for(var x in s)Object.prototype.hasOwnProperty.call(s,x)&&h.indexOf(x)<0&&(y[x]=s[x]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var w=0,x=Object.getOwnPropertySymbols(s);w<x.length;w++)h.indexOf(x[w])<0&&Object.prototype.propertyIsEnumerable.call(s,x[w])&&(y[x[w]]=s[x[w]]);return y};const Zx=s=>{const{prefixCls:h,className:y,closeIcon:x,closable:w,type:E,title:z,children:o,footer:O}=s,L=Gx(s,["prefixCls","className","closeIcon","closable","type","title","children","footer"]),{getPrefixCls:V}=k.useContext(xn),q=V(),Q=h||V("modal"),ae=oo(q),[fe,me,xe]=Zm(Q,ae),ve=`${Q}-confirm`;let be={};return E?be={closable:w??!1,title:"",footer:"",children:k.createElement(Wm,Object.assign({},s,{prefixCls:Q,confirmPrefixCls:ve,rootPrefixCls:q,content:o}))}:be={closable:w??!0,title:z,footer:O!==null&&k.createElement(Vm,Object.assign({},s)),children:o},fe(k.createElement(Bm,Object.assign({prefixCls:Q,className:_t(me,`${Q}-pure-panel`,E&&ve,E&&`${ve}-${E}`,y,xe,ae)},L,{closeIcon:jm(Q,x),closable:w},be)))},Hx=tv(Zx);function mg(s){return yl(Ym(s))}const Dn=Hm;Dn.useModal=C0;Dn.info=function(h){return yl(Jm(h))};Dn.success=function(h){return yl(Qm(h))};Dn.error=function(h){return yl(eg(h))};Dn.warning=mg;Dn.warn=mg;Dn.confirm=function(h){return yl(tg(h))};Dn.destroyAll=function(){for(;io.length;){const h=io.pop();h&&h()}};Dn.config=v0;Dn._InternalPanelDoNotUseOrYouWillBeFired=Hx;const Rh=Dn;let kn=null,zc=s=>s(),Oc=[],Bc={};function bf(){const{prefixCls:s,getContainer:h,rtl:y,maxCount:x,top:w,bottom:E}=Bc,z=s??ml().getPrefixCls("notification"),o=h?.()||document.body;return{prefixCls:z,getContainer:()=>o,rtl:y,maxCount:x,top:w,bottom:E}}const Wx=k.forwardRef((s,h)=>{const[y,x]=k.useState(bf),[w,E]=sg(y),z=ml(),o=z.getRootPrefixCls(),O=z.getIconPrefixCls(),L=z.getTheme(),V=()=>{x(bf)};return k.useEffect(V,[]),k.useImperativeHandle(h,()=>{const q=Object.assign({},w);return Object.keys(q).forEach(Q=>{q[Q]=function(){return V(),w[Q].apply(w,arguments)}}),{instance:q,sync:V}}),k.createElement(Uh,{prefixCls:o,iconPrefixCls:O,theme:L},E)});function Yh(){if(!kn){const s=document.createDocumentFragment(),h={fragment:s};kn=h,zc(()=>{qh(k.createElement(Wx,{ref:y=>{const{instance:x,sync:w}=y||{};Promise.resolve().then(()=>{!h.instance&&x&&(h.instance=x,h.sync=w,Yh())})}}),s)});return}kn.instance&&(Oc.forEach(s=>{switch(s.type){case"open":{zc(()=>{kn.instance.open(Object.assign(Object.assign({},Bc),s.config))});break}case"destroy":zc(()=>{kn?.instance.destroy(s.key)});break}}),Oc=[])}function Xx(s){Bc=Object.assign(Object.assign({},Bc),s),zc(()=>{var h;(h=kn?.sync)===null||h===void 0||h.call(kn)})}function gg(s){Oc.push({type:"open",config:s}),Yh()}function Kx(s){Oc.push({type:"destroy",key:s}),Yh()}const Yx=["success","info","warning","error"],Jx={open:gg,destroy:Kx,config:Xx,useNotification:W0,_InternalPanelDoNotUseOrYouWillBeFired:F0},yg=Jx;Yx.forEach(s=>{yg[s]=h=>gg(Object.assign(Object.assign({},h),{type:s}))});var Qx={percent:0,prefixCls:"rc-progress",strokeColor:"#2db7f5",strokeLinecap:"round",strokeWidth:1,trailColor:"#D9D9D9",trailWidth:1,gapPosition:"bottom"},eb=function(){var h=k.useRef([]),y=k.useRef(null);return k.useEffect(function(){var x=Date.now(),w=!1;h.current.forEach(function(E){if(E){w=!0;var z=E.style;z.transitionDuration=".3s, .3s, .3s, .06s",y.current&&x-y.current<100&&(z.transitionDuration="0s, 0s")}}),w&&(y.current=Date.now())}),h.current},wf=0,tb=gm();function ib(){var s;return tb?(s=wf,wf+=1):s="TEST_OR_SSR",s}const rb=function(s){var h=k.useState(),y=ii(h,2),x=y[0],w=y[1];return k.useEffect(function(){w("rc_progress_".concat(ib()))},[]),s||x};var Sf=function(h){var y=h.bg,x=h.children;return k.createElement("div",{style:{width:"100%",height:"100%",background:y}},x)};function Cf(s,h){return Object.keys(s).map(function(y){var x=parseFloat(y),w="".concat(Math.floor(x*h),"%");return"".concat(s[y]," ").concat(w)})}var nb=k.forwardRef(function(s,h){var y=s.prefixCls,x=s.color,w=s.gradientId,E=s.radius,z=s.style,o=s.ptg,O=s.strokeLinecap,L=s.strokeWidth,V=s.size,q=s.gapDegree,Q=x&&Hn(x)==="object",ae=Q?"#FFF":void 0,fe=V/2,me=k.createElement("circle",{className:"".concat(y,"-circle-path"),r:E,cx:fe,cy:fe,stroke:ae,strokeLinecap:O,strokeWidth:L,opacity:o===0?0:1,style:z,ref:h});if(!Q)return me;var xe="".concat(w,"-conic"),ve=q?"".concat(180+q/2,"deg"):"0deg",be=Cf(x,(360-q)/360),ge=Cf(x,1),ce="conic-gradient(from ".concat(ve,", ").concat(be.join(", "),")"),Se="linear-gradient(to ".concat(q?"bottom":"top",", ").concat(ge.join(", "),")");return k.createElement(k.Fragment,null,k.createElement("mask",{id:xe},me),k.createElement("foreignObject",{x:0,y:0,width:V,height:V,mask:"url(#".concat(xe,")")},k.createElement(Sf,{bg:Se},k.createElement(Sf,{bg:ce}))))}),ll=100,oh=function(h,y,x,w,E,z,o,O,L,V){var q=arguments.length>10&&arguments[10]!==void 0?arguments[10]:0,Q=x/100*360*((360-z)/360),ae=z===0?0:{bottom:0,top:180,left:90,right:-90}[o],fe=(100-w)/100*y;L==="round"&&w!==100&&(fe+=V/2,fe>=y&&(fe=y-.01));var me=ll/2;return{stroke:typeof O=="string"?O:void 0,strokeDasharray:"".concat(y,"px ").concat(h),strokeDashoffset:fe+q,transform:"rotate(".concat(E+Q+ae,"deg)"),transformOrigin:"".concat(me,"px ").concat(me,"px"),transition:"stroke-dashoffset .3s ease 0s, stroke-dasharray .3s ease 0s, stroke .3s, stroke-width .06s ease .3s, opacity .3s ease 0s",fillOpacity:0}},ab=["id","prefixCls","steps","strokeWidth","trailWidth","gapDegree","gapPosition","trailColor","strokeLinecap","style","className","strokeColor","percent"];function Tf(s){var h=s??[];return Array.isArray(h)?h:[h]}var ob=function(h){var y=ri(ri({},Qx),h),x=y.id,w=y.prefixCls,E=y.steps,z=y.strokeWidth,o=y.trailWidth,O=y.gapDegree,L=O===void 0?0:O,V=y.gapPosition,q=y.trailColor,Q=y.strokeLinecap,ae=y.style,fe=y.className,me=y.strokeColor,xe=y.percent,ve=za(y,ab),be=ll/2,ge=rb(x),ce="".concat(ge,"-gradient"),Se=be-z/2,ze=Math.PI*2*Se,Be=L>0?90+L/2:-90,$e=ze*((360-L)/360),De=Hn(E)==="object"?E:{count:E,space:2},Ce=De.count,je=De.space,Ge=Tf(xe),tt=Tf(me),He=tt.find(function(Gt){return Gt&&Hn(Gt)==="object"}),ot=He&&Hn(He)==="object",Tt=ot?"butt":Q,st=oh(ze,$e,0,100,Be,L,V,q,Tt,z),jt=eb(),At=function(){var ft=0;return Ge.map(function(Oe,gt){var Bt=tt[gt]||tt[tt.length-1],wt=oh(ze,$e,ft,Oe,Be,L,V,Bt,Tt,z);return ft+=Oe,k.createElement(nb,{key:gt,color:Bt,ptg:Oe,radius:Se,prefixCls:w,gradientId:ce,style:wt,strokeLinecap:Tt,strokeWidth:z,gapDegree:L,ref:function(Yt){jt[gt]=Yt},size:ll})}).reverse()},Qt=function(){var ft=Math.round(Ce*(Ge[0]/100)),Oe=100/Ce,gt=0;return new Array(Ce).fill(null).map(function(Bt,wt){var $t=wt<=ft-1?tt[0]:q,Yt=$t&&Hn($t)==="object"?"url(#".concat(ce,")"):void 0,ei=oh(ze,$e,gt,Oe,Be,L,V,$t,"butt",z,je);return gt+=($e-ei.strokeDashoffset+je)*100/$e,k.createElement("circle",{key:wt,className:"".concat(w,"-circle-path"),r:Se,cx:be,cy:be,stroke:Yt,strokeWidth:z,opacity:1,style:ei,ref:function(gi){jt[wt]=gi}})})};return k.createElement("svg",mi({className:_t("".concat(w,"-circle"),fe),viewBox:"0 0 ".concat(ll," ").concat(ll),style:ae,id:x,role:"presentation"},ve),!Ce&&k.createElement("circle",{className:"".concat(w,"-circle-trail"),r:Se,cx:be,cy:be,stroke:q,strokeLinecap:Tt,strokeWidth:o||z,style:st}),Ce?Qt():At())};function ka(s){return!s||s<0?0:s>100?100:s}function Fc(s){let{success:h,successPercent:y}=s,x=y;return h&&"progress"in h&&(x=h.progress),h&&"percent"in h&&(x=h.percent),x}const sb=s=>{let{percent:h,success:y,successPercent:x}=s;const w=ka(Fc({success:y,successPercent:x}));return[w,ka(ka(h)-w)]},lb=s=>{let{success:h={},strokeColor:y}=s;const{strokeColor:x}=h;return[x||zh.green,y||null]},Zc=(s,h,y)=>{var x,w,E,z;let o=-1,O=-1;if(h==="step"){const L=y.steps,V=y.strokeWidth;typeof s=="string"||typeof s>"u"?(o=s==="small"?2:14,O=V??8):typeof s=="number"?[o,O]=[s,s]:[o=14,O=8]=s,o*=L}else if(h==="line"){const L=y?.strokeWidth;typeof s=="string"||typeof s>"u"?O=L||(s==="small"?6:8):typeof s=="number"?[o,O]=[s,s]:[o=-1,O=8]=s}else(h==="circle"||h==="dashboard")&&(typeof s=="string"||typeof s>"u"?[o,O]=s==="small"?[60,60]:[120,120]:typeof s=="number"?[o,O]=[s,s]:(o=(w=(x=s[0])!==null&&x!==void 0?x:s[1])!==null&&w!==void 0?w:120,O=(z=(E=s[0])!==null&&E!==void 0?E:s[1])!==null&&z!==void 0?z:120));return[o,O]},cb=3,ub=s=>cb/s*100,hb=s=>{const{prefixCls:h,trailColor:y=null,strokeLinecap:x="round",gapPosition:w,gapDegree:E,width:z=120,type:o,children:O,success:L,size:V=z}=s,[q,Q]=Zc(V,"circle");let{strokeWidth:ae}=s;ae===void 0&&(ae=Math.max(ub(q),6));const fe={width:q,height:Q,fontSize:q*.15+6},me=k.useMemo(()=>{if(E||E===0)return E;if(o==="dashboard")return 75},[E,o]),xe=w||o==="dashboard"&&"bottom"||void 0,ve=Object.prototype.toString.call(s.strokeColor)==="[object Object]",be=lb({success:L,strokeColor:s.strokeColor}),ge=_t(`${h}-inner`,{[`${h}-circle-gradient`]:ve}),ce=k.createElement(ob,{percent:sb(s),strokeWidth:ae,trailWidth:ae,strokeColor:be,strokeLinecap:x,trailColor:y,prefixCls:h,gapDegree:me,gapPosition:xe});return k.createElement("div",{className:ge,style:fe},q<=20?k.createElement(wm,{title:O},k.createElement("span",null,ce)):k.createElement(k.Fragment,null,ce,O))},db=hb,Nc="--progress-line-stroke-color",_g="--progress-percent",Ef=s=>{const h=s?"100%":"-100%";return new vn(`antProgress${s?"RTL":"LTR"}Active`,{"0%":{transform:`translateX(${h}) scaleX(0)`,opacity:.1},"20%":{transform:`translateX(${h}) scaleX(0)`,opacity:.5},to:{transform:"translateX(0) scaleX(1)",opacity:0}})},pb=s=>{const{componentCls:h,iconCls:y}=s;return{[h]:Object.assign(Object.assign({},ao(s)),{display:"inline-block","&-rtl":{direction:"rtl"},"&-line":{position:"relative",width:"100%",fontSize:s.fontSize,marginInlineEnd:s.marginXS,marginBottom:s.marginXS},[`${h}-outer`]:{display:"inline-block",width:"100%"},[`&${h}-show-info`]:{[`${h}-outer`]:{marginInlineEnd:`calc(-2em - ${nt(s.marginXS)})`,paddingInlineEnd:`calc(2em + ${nt(s.paddingXS)})`}},[`${h}-inner`]:{position:"relative",display:"inline-block",width:"100%",overflow:"hidden",verticalAlign:"middle",backgroundColor:s.remainingColor,borderRadius:s.lineBorderRadius},[`${h}-inner:not(${h}-circle-gradient)`]:{[`${h}-circle-path`]:{stroke:s.defaultColor}},[`${h}-success-bg, ${h}-bg`]:{position:"relative",background:s.defaultColor,borderRadius:s.lineBorderRadius,transition:`all ${s.motionDurationSlow} ${s.motionEaseInOutCirc}`},[`${h}-bg`]:{overflow:"hidden","&::after":{content:'""',background:{_multi_value_:!0,value:["inherit",`var(${Nc})`]},height:"100%",width:`calc(1 / var(${_g}) * 100%)`,display:"block"}},[`${h}-success-bg`]:{position:"absolute",insetBlockStart:0,insetInlineStart:0,backgroundColor:s.colorSuccess},[`${h}-text`]:{display:"inline-block",width:"2em",marginInlineStart:s.marginXS,color:s.colorText,lineHeight:1,whiteSpace:"nowrap",textAlign:"start",verticalAlign:"middle",wordBreak:"normal",[y]:{fontSize:s.fontSize}},[`&${h}-status-active`]:{[`${h}-bg::before`]:{position:"absolute",inset:0,backgroundColor:s.colorBgContainer,borderRadius:s.lineBorderRadius,opacity:0,animationName:Ef(),animationDuration:s.progressActiveMotionDuration,animationTimingFunction:s.motionEaseOutQuint,animationIterationCount:"infinite",content:'""'}},[`&${h}-rtl${h}-status-active`]:{[`${h}-bg::before`]:{animationName:Ef(!0)}},[`&${h}-status-exception`]:{[`${h}-bg`]:{backgroundColor:s.colorError},[`${h}-text`]:{color:s.colorError}},[`&${h}-status-exception ${h}-inner:not(${h}-circle-gradient)`]:{[`${h}-circle-path`]:{stroke:s.colorError}},[`&${h}-status-success`]:{[`${h}-bg`]:{backgroundColor:s.colorSuccess},[`${h}-text`]:{color:s.colorSuccess}},[`&${h}-status-success ${h}-inner:not(${h}-circle-gradient)`]:{[`${h}-circle-path`]:{stroke:s.colorSuccess}}})}},fb=s=>{const{componentCls:h,iconCls:y}=s;return{[h]:{[`${h}-circle-trail`]:{stroke:s.remainingColor},[`&${h}-circle ${h}-inner`]:{position:"relative",lineHeight:1,backgroundColor:"transparent"},[`&${h}-circle ${h}-text`]:{position:"absolute",insetBlockStart:"50%",insetInlineStart:0,width:"100%",margin:0,padding:0,color:s.circleTextColor,fontSize:s.circleTextFontSize,lineHeight:1,whiteSpace:"normal",textAlign:"center",transform:"translateY(-50%)",[y]:{fontSize:s.circleIconFontSize}},[`${h}-circle&-status-exception`]:{[`${h}-text`]:{color:s.colorError}},[`${h}-circle&-status-success`]:{[`${h}-text`]:{color:s.colorSuccess}}},[`${h}-inline-circle`]:{lineHeight:1,[`${h}-inner`]:{verticalAlign:"bottom"}}}},mb=s=>{const{componentCls:h}=s;return{[h]:{[`${h}-steps`]:{display:"inline-block","&-outer":{display:"flex",flexDirection:"row",alignItems:"center"},"&-item":{flexShrink:0,minWidth:s.progressStepMinWidth,marginInlineEnd:s.progressStepMarginInlineEnd,backgroundColor:s.remainingColor,transition:`all ${s.motionDurationSlow}`,"&-active":{backgroundColor:s.defaultColor}}}}}},gb=s=>{const{componentCls:h,iconCls:y}=s;return{[h]:{[`${h}-small&-line, ${h}-small&-line ${h}-text ${y}`]:{fontSize:s.fontSizeSM}}}},yb=s=>({circleTextColor:s.colorText,defaultColor:s.colorInfo,remainingColor:s.colorFillSecondary,lineBorderRadius:100,circleTextFontSize:"1em",circleIconFontSize:`${s.fontSize/s.fontSizeSM}em`}),_b=es("Progress",s=>{const h=s.calc(s.marginXXS).div(2).equal(),y=ts(s,{progressStepMarginInlineEnd:h,progressStepMinWidth:h,progressActiveMotionDuration:"2.4s"});return[pb(y),fb(y),mb(y),gb(y)]},yb);var vb=function(s,h){var y={};for(var x in s)Object.prototype.hasOwnProperty.call(s,x)&&h.indexOf(x)<0&&(y[x]=s[x]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var w=0,x=Object.getOwnPropertySymbols(s);w<x.length;w++)h.indexOf(x[w])<0&&Object.prototype.propertyIsEnumerable.call(s,x[w])&&(y[x[w]]=s[x[w]]);return y};const xb=s=>{let h=[];return Object.keys(s).forEach(y=>{const x=parseFloat(y.replace(/%/g,""));isNaN(x)||h.push({key:x,value:s[y]})}),h=h.sort((y,x)=>y.key-x.key),h.map(y=>{let{key:x,value:w}=y;return`${w} ${x}%`}).join(", ")},bb=(s,h)=>{const{from:y=zh.blue,to:x=zh.blue,direction:w=h==="rtl"?"to left":"to right"}=s,E=vb(s,["from","to","direction"]);if(Object.keys(E).length!==0){const o=xb(E),O=`linear-gradient(${w}, ${o})`;return{background:O,[Nc]:O}}const z=`linear-gradient(${w}, ${y}, ${x})`;return{background:z,[Nc]:z}},wb=s=>{const{prefixCls:h,direction:y,percent:x,size:w,strokeWidth:E,strokeColor:z,strokeLinecap:o="round",children:O,trailColor:L=null,success:V}=s,q=z&&typeof z!="string"?bb(z,y):{[Nc]:z,background:z},Q=o==="square"||o==="butt"?0:void 0,ae=w??[-1,E||(w==="small"?6:8)],[fe,me]=Zc(ae,"line",{strokeWidth:E}),xe={backgroundColor:L||void 0,borderRadius:Q},ve=Object.assign(Object.assign({width:`${ka(x)}%`,height:me,borderRadius:Q},q),{[_g]:ka(x)/100}),be=Fc(s),ge={width:`${ka(be)}%`,height:me,borderRadius:Q,backgroundColor:V?.strokeColor},ce={width:fe<0?"100%":fe,height:me};return k.createElement(k.Fragment,null,k.createElement("div",{className:`${h}-outer`,style:ce},k.createElement("div",{className:`${h}-inner`,style:xe},k.createElement("div",{className:`${h}-bg`,style:ve}),be!==void 0?k.createElement("div",{className:`${h}-success-bg`,style:ge}):null)),O)},Sb=wb,Cb=s=>{const{size:h,steps:y,percent:x=0,strokeWidth:w=8,strokeColor:E,trailColor:z=null,prefixCls:o,children:O}=s,L=Math.round(y*(x/100)),q=h??[h==="small"?2:14,w],[Q,ae]=Zc(q,"step",{steps:y,strokeWidth:w}),fe=Q/y,me=new Array(y);for(let xe=0;xe<y;xe++){const ve=Array.isArray(E)?E[xe]:E;me[xe]=k.createElement("div",{key:xe,className:_t(`${o}-steps-item`,{[`${o}-steps-item-active`]:xe<=L-1}),style:{backgroundColor:xe<=L-1?ve:z,width:fe,height:ae}})}return k.createElement("div",{className:`${o}-steps-outer`},me,O)},Tb=Cb;var Eb=function(s,h){var y={};for(var x in s)Object.prototype.hasOwnProperty.call(s,x)&&h.indexOf(x)<0&&(y[x]=s[x]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var w=0,x=Object.getOwnPropertySymbols(s);w<x.length;w++)h.indexOf(x[w])<0&&Object.prototype.propertyIsEnumerable.call(s,x[w])&&(y[x[w]]=s[x[w]]);return y};const Ib=["normal","exception","active","success"],Pb=k.forwardRef((s,h)=>{const{prefixCls:y,className:x,rootClassName:w,steps:E,strokeColor:z,percent:o=0,size:O="default",showInfo:L=!0,type:V="line",status:q,format:Q,style:ae}=s,fe=Eb(s,["prefixCls","className","rootClassName","steps","strokeColor","percent","size","showInfo","type","status","format","style"]),me=k.useMemo(()=>{var tt,He;const ot=Fc(s);return parseInt(ot!==void 0?(tt=ot??0)===null||tt===void 0?void 0:tt.toString():(He=o??0)===null||He===void 0?void 0:He.toString(),10)},[o,s.success,s.successPercent]),xe=k.useMemo(()=>!Ib.includes(q)&&me>=100?"success":q||"normal",[q,me]),{getPrefixCls:ve,direction:be,progress:ge}=k.useContext(xn),ce=ve("progress",y),[Se,ze,Be]=_b(ce),$e=k.useMemo(()=>{if(!L)return null;const tt=Fc(s);let He;const ot=Q||(st=>`${st}%`),Tt=V==="line";return Q||xe!=="exception"&&xe!=="success"?He=ot(ka(o),ka(tt)):xe==="exception"?He=Tt?k.createElement(Vc,null):k.createElement(so,null):xe==="success"&&(He=Tt?k.createElement(jc,null):k.createElement(rv,null)),k.createElement("span",{className:`${ce}-text`,title:typeof He=="string"?He:void 0},He)},[L,o,me,xe,V,ce,Q]),De=Array.isArray(z)?z[0]:z,Ce=typeof z=="string"||Array.isArray(z)?z:void 0;let je;V==="line"?je=E?k.createElement(Tb,Object.assign({},s,{strokeColor:Ce,prefixCls:ce,steps:E}),$e):k.createElement(Sb,Object.assign({},s,{strokeColor:De,prefixCls:ce,direction:be}),$e):(V==="circle"||V==="dashboard")&&(je=k.createElement(db,Object.assign({},s,{strokeColor:De,prefixCls:ce,progressStatus:xe}),$e));const Ge=_t(ce,`${ce}-status-${xe}`,`${ce}-${V==="dashboard"&&"circle"||E&&"steps"||V}`,{[`${ce}-inline-circle`]:V==="circle"&&Zc(O,"circle")[0]<=20,[`${ce}-show-info`]:L,[`${ce}-${O}`]:typeof O=="string",[`${ce}-rtl`]:be==="rtl"},ge?.className,x,w,ze,Be);return Se(k.createElement("div",Object.assign({ref:h,style:Object.assign(Object.assign({},ge?.style),ae),className:Ge,role:"progressbar","aria-valuenow":me},iv(fe,["trailColor","strokeWidth","width","gapDegree","gapPosition","strokeLinecap","success","successPercent"])),je))}),Mb=Pb;var Ab={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z"}}]},name:"delete",theme:"outlined"};const kb=Ab;var zb=function(h,y){return k.createElement(La,mi({},h,{ref:y,icon:kb}))};const vg=k.forwardRef(zb),sh=function(s,h){if(s&&h){var y=Array.isArray(h)?h:h.split(","),x=s.name||"",w=s.type||"",E=w.replace(/\/.*$/,"");return y.some(function(z){var o=z.trim();if(/^\*(\/\*)?$/.test(z))return!0;if(o.charAt(0)==="."){var O=x.toLowerCase(),L=o.toLowerCase(),V=[L];return(L===".jpg"||L===".jpeg")&&(V=[".jpg",".jpeg"]),V.some(function(q){return O.endsWith(q)})}return/\/\*$/.test(o)?E===o.replace(/\/.*$/,""):w===o?!0:/^\w+$/.test(o)?(nv(!1,"Upload takes an invalidate 'accept' type '".concat(o,"'.Skip for check.")),!0):!1})}return!0};function Lb(s,h){var y="cannot ".concat(s.method," ").concat(s.action," ").concat(h.status,"'"),x=new Error(y);return x.status=h.status,x.method=s.method,x.url=s.action,x}function If(s){var h=s.responseText||s.response;if(!h)return h;try{return JSON.parse(h)}catch{return h}}function Db(s){var h=new XMLHttpRequest;s.onProgress&&h.upload&&(h.upload.onprogress=function(E){E.total>0&&(E.percent=E.loaded/E.total*100),s.onProgress(E)});var y=new FormData;s.data&&Object.keys(s.data).forEach(function(w){var E=s.data[w];if(Array.isArray(E)){E.forEach(function(z){y.append("".concat(w,"[]"),z)});return}y.append(w,E)}),s.file instanceof Blob?y.append(s.filename,s.file,s.file.name):y.append(s.filename,s.file),h.onerror=function(E){s.onError(E)},h.onload=function(){return h.status<200||h.status>=300?s.onError(Lb(s,h),If(h)):s.onSuccess(If(h),h)},h.open(s.method,s.action,!0),s.withCredentials&&"withCredentials"in h&&(h.withCredentials=!0);var x=s.headers||{};return x["X-Requested-With"]!==null&&h.setRequestHeader("X-Requested-With","XMLHttpRequest"),Object.keys(x).forEach(function(w){x[w]!==null&&h.setRequestHeader(w,x[w])}),h.send(y),{abort:function(){h.abort()}}}function Rb(s,h){var y=s.createReader(),x=[];function w(){y.readEntries(function(E){var z=Array.prototype.slice.apply(E);x=x.concat(z);var o=!z.length;o?h(x):w()})}w()}var $b=function(h,y,x){var w=function E(z,o){z&&(z.path=o||"",z.isFile?z.file(function(O){x(O)&&(z.fullPath&&!O.webkitRelativePath&&(Object.defineProperties(O,{webkitRelativePath:{writable:!0}}),O.webkitRelativePath=z.fullPath.replace(/^\//,""),Object.defineProperties(O,{webkitRelativePath:{writable:!1}})),y([O]))}):z.isDirectory&&Rb(z,function(O){O.forEach(function(L){E(L,"".concat(o).concat(z.name,"/"))})}))};h.forEach(function(E){w(E.webkitGetAsEntry())})},Ob=+new Date,Bb=0;function lh(){return"rc-upload-".concat(Ob,"-").concat(++Bb)}var Fb=["component","prefixCls","className","classNames","disabled","id","style","styles","multiple","accept","capture","children","directory","openFileDialogOnClick","onMouseEnter","onMouseLeave","hasControlInside"],Nb=function(s){Sm(y,s);var h=Cm(y);function y(){var x;Tm(this,y);for(var w=arguments.length,E=new Array(w),z=0;z<w;z++)E[z]=arguments[z];return x=h.call.apply(h,[this].concat(E)),si(sn(x),"state",{uid:lh()}),si(sn(x),"reqs",{}),si(sn(x),"fileInput",void 0),si(sn(x),"_isMounted",void 0),si(sn(x),"onChange",function(o){var O=x.props,L=O.accept,V=O.directory,q=o.target.files,Q=qi(q).filter(function(ae){return!V||sh(ae,L)});x.uploadFiles(Q),x.reset()}),si(sn(x),"onClick",function(o){var O=x.fileInput;if(O){var L=o.target,V=x.props.onClick;if(L&&L.tagName==="BUTTON"){var q=O.parentNode;q.focus(),L.blur()}O.click(),V&&V(o)}}),si(sn(x),"onKeyDown",function(o){o.key==="Enter"&&x.onClick(o)}),si(sn(x),"onFileDrop",function(o){var O=x.props.multiple;if(o.preventDefault(),o.type!=="dragover")if(x.props.directory)$b(Array.prototype.slice.call(o.dataTransfer.items),x.uploadFiles,function(V){return sh(V,x.props.accept)});else{var L=qi(o.dataTransfer.files).filter(function(V){return sh(V,x.props.accept)});O===!1&&(L=L.slice(0,1)),x.uploadFiles(L)}}),si(sn(x),"uploadFiles",function(o){var O=qi(o),L=O.map(function(V){return V.uid=lh(),x.processFile(V,O)});Promise.all(L).then(function(V){var q=x.props.onBatchStart;q?.(V.map(function(Q){var ae=Q.origin,fe=Q.parsedFile;return{file:ae,parsedFile:fe}})),V.filter(function(Q){return Q.parsedFile!==null}).forEach(function(Q){x.post(Q)})})}),si(sn(x),"processFile",function(){var o=av(Vp().mark(function O(L,V){var q,Q,ae,fe,me,xe,ve,be,ge;return Vp().wrap(function(Se){for(;;)switch(Se.prev=Se.next){case 0:if(q=x.props.beforeUpload,Q=L,!q){Se.next=14;break}return Se.prev=3,Se.next=6,q(L,V);case 6:Q=Se.sent,Se.next=12;break;case 9:Se.prev=9,Se.t0=Se.catch(3),Q=!1;case 12:if(Q!==!1){Se.next=14;break}return Se.abrupt("return",{origin:L,parsedFile:null,action:null,data:null});case 14:if(ae=x.props.action,typeof ae!="function"){Se.next=21;break}return Se.next=18,ae(L);case 18:fe=Se.sent,Se.next=22;break;case 21:fe=ae;case 22:if(me=x.props.data,typeof me!="function"){Se.next=29;break}return Se.next=26,me(L);case 26:xe=Se.sent,Se.next=30;break;case 29:xe=me;case 30:return ve=(Hn(Q)==="object"||typeof Q=="string")&&Q?Q:L,ve instanceof File?be=ve:be=new File([ve],L.name,{type:L.type}),ge=be,ge.uid=L.uid,Se.abrupt("return",{origin:L,data:xe,parsedFile:ge,action:fe});case 35:case"end":return Se.stop()}},O,null,[[3,9]])}));return function(O,L){return o.apply(this,arguments)}}()),si(sn(x),"saveFileInput",function(o){x.fileInput=o}),x}return Em(y,[{key:"componentDidMount",value:function(){this._isMounted=!0}},{key:"componentWillUnmount",value:function(){this._isMounted=!1,this.abort()}},{key:"post",value:function(w){var E=this,z=w.data,o=w.origin,O=w.action,L=w.parsedFile;if(this._isMounted){var V=this.props,q=V.onStart,Q=V.customRequest,ae=V.name,fe=V.headers,me=V.withCredentials,xe=V.method,ve=o.uid,be=Q||Db,ge={action:O,filename:ae,data:z,file:L,headers:fe,withCredentials:me,method:xe||"post",onProgress:function(Se){var ze=E.props.onProgress;ze?.(Se,L)},onSuccess:function(Se,ze){var Be=E.props.onSuccess;Be?.(Se,L,ze),delete E.reqs[ve]},onError:function(Se,ze){var Be=E.props.onError;Be?.(Se,ze,L),delete E.reqs[ve]}};q(o),this.reqs[ve]=be(ge)}}},{key:"reset",value:function(){this.setState({uid:lh()})}},{key:"abort",value:function(w){var E=this.reqs;if(w){var z=w.uid?w.uid:w;E[z]&&E[z].abort&&E[z].abort(),delete E[z]}else Object.keys(E).forEach(function(o){E[o]&&E[o].abort&&E[o].abort(),delete E[o]})}},{key:"render",value:function(){var w,E=this.props,z=E.component,o=E.prefixCls,O=E.className,L=E.classNames,V=L===void 0?{}:L,q=E.disabled,Q=E.id,ae=E.style,fe=E.styles,me=fe===void 0?{}:fe,xe=E.multiple,ve=E.accept,be=E.capture,ge=E.children,ce=E.directory,Se=E.openFileDialogOnClick,ze=E.onMouseEnter,Be=E.onMouseLeave,$e=E.hasControlInside,De=za(E,Fb),Ce=_t((w={},si(w,o,!0),si(w,"".concat(o,"-disabled"),q),si(w,O,O),w)),je=ce?{directory:"directory",webkitdirectory:"webkitdirectory"}:{},Ge=q?{}:{onClick:Se?this.onClick:function(){},onKeyDown:Se?this.onKeyDown:function(){},onMouseEnter:ze,onMouseLeave:Be,onDrop:this.onFileDrop,onDragOver:this.onFileDrop,tabIndex:$e?void 0:"0"};return ti.createElement(z,mi({},Ge,{className:Ce,role:$e?void 0:"button",style:ae}),ti.createElement("input",mi({},mm(De,{aria:!0,data:!0}),{id:Q,disabled:q,type:"file",ref:this.saveFileInput,onClick:function(He){return He.stopPropagation()},key:this.state.uid,style:ri({display:"none"},me.input),className:V.input,accept:ve},je,{multiple:xe,onChange:this.onChange},be!=null?{capture:be}:{})),ge)}}]),y}(k.Component);function ch(){}var $h=function(s){Sm(y,s);var h=Cm(y);function y(){var x;Tm(this,y);for(var w=arguments.length,E=new Array(w),z=0;z<w;z++)E[z]=arguments[z];return x=h.call.apply(h,[this].concat(E)),si(sn(x),"uploader",void 0),si(sn(x),"saveUploader",function(o){x.uploader=o}),x}return Em(y,[{key:"abort",value:function(w){this.uploader.abort(w)}},{key:"render",value:function(){return ti.createElement(Nb,mi({},this.props,{ref:this.saveUploader}))}}]),y}(k.Component);si($h,"defaultProps",{component:"span",prefixCls:"rc-upload",data:{},headers:{},name:"file",multipart:!1,onStart:ch,onError:ch,onSuccess:ch,multiple:!1,beforeUpload:null,customRequest:null,withCredentials:!1,openFileDialogOnClick:!0,hasControlInside:!1});const jb=s=>{const{componentCls:h,iconCls:y}=s;return{[`${h}-wrapper`]:{[`${h}-drag`]:{position:"relative",width:"100%",height:"100%",textAlign:"center",background:s.colorFillAlter,border:`${nt(s.lineWidth)} dashed ${s.colorBorder}`,borderRadius:s.borderRadiusLG,cursor:"pointer",transition:`border-color ${s.motionDurationSlow}`,[h]:{padding:s.padding},[`${h}-btn`]:{display:"table",width:"100%",height:"100%",outline:"none",borderRadius:s.borderRadiusLG,"&:focus-visible":{outline:`${nt(s.lineWidthFocus)} solid ${s.colorPrimaryBorder}`}},[`${h}-drag-container`]:{display:"table-cell",verticalAlign:"middle"},[`
          &:not(${h}-disabled):hover,
          &-hover:not(${h}-disabled)
        `]:{borderColor:s.colorPrimaryHover},[`p${h}-drag-icon`]:{marginBottom:s.margin,[y]:{color:s.colorPrimary,fontSize:s.uploadThumbnailSize}},[`p${h}-text`]:{margin:`0 0 ${nt(s.marginXXS)}`,color:s.colorTextHeading,fontSize:s.fontSizeLG},[`p${h}-hint`]:{color:s.colorTextDescription,fontSize:s.fontSize},[`&${h}-disabled`]:{[`p${h}-drag-icon ${y},
            p${h}-text,
            p${h}-hint
          `]:{color:s.colorTextDisabled}}}}}},Vb=s=>{const{componentCls:h,antCls:y,iconCls:x,fontSize:w,lineHeight:E,calc:z}=s,o=`${h}-list-item`,O=`${o}-actions`,L=`${o}-action`,V=s.fontHeightSM;return{[`${h}-wrapper`]:{[`${h}-list`]:Object.assign(Object.assign({},Vh()),{lineHeight:s.lineHeight,[o]:{position:"relative",height:z(s.lineHeight).mul(w).equal(),marginTop:s.marginXS,fontSize:w,display:"flex",alignItems:"center",transition:`background-color ${s.motionDurationSlow}`,"&:hover":{backgroundColor:s.controlItemBgHover},[`${o}-name`]:Object.assign(Object.assign({},Gh),{padding:`0 ${nt(s.paddingXS)}`,lineHeight:E,flex:"auto",transition:`all ${s.motionDurationSlow}`}),[O]:{[L]:{opacity:0},[x]:{color:s.actionsColor,transition:`all ${s.motionDurationSlow}`},[`
              ${L}:focus-visible,
              &.picture ${L}
            `]:{opacity:1},[`${L}${y}-btn`]:{height:V,border:0,lineHeight:1}},[`${h}-icon ${x}`]:{color:s.colorTextDescription,fontSize:w},[`${o}-progress`]:{position:"absolute",bottom:s.calc(s.uploadProgressOffset).mul(-1).equal(),width:"100%",paddingInlineStart:z(w).add(s.paddingXS).equal(),fontSize:w,lineHeight:0,pointerEvents:"none","> div":{margin:0}}},[`${o}:hover ${L}`]:{opacity:1},[`${o}-error`]:{color:s.colorError,[`${o}-name, ${h}-icon ${x}`]:{color:s.colorError},[O]:{[`${x}, ${x}:hover`]:{color:s.colorError},[L]:{opacity:1}}},[`${h}-list-item-container`]:{transition:`opacity ${s.motionDurationSlow}, height ${s.motionDurationSlow}`,"&::before":{display:"table",width:0,height:0,content:'""'}}})}}},Pf=new vn("uploadAnimateInlineIn",{from:{width:0,height:0,margin:0,padding:0,opacity:0}}),Mf=new vn("uploadAnimateInlineOut",{to:{width:0,height:0,margin:0,padding:0,opacity:0}}),Ub=s=>{const{componentCls:h}=s,y=`${h}-animate-inline`;return[{[`${h}-wrapper`]:{[`${y}-appear, ${y}-enter, ${y}-leave`]:{animationDuration:s.motionDurationSlow,animationTimingFunction:s.motionEaseInOutCirc,animationFillMode:"forwards"},[`${y}-appear, ${y}-enter`]:{animationName:Pf},[`${y}-leave`]:{animationName:Mf}}},{[`${h}-wrapper`]:Um(s)},Pf,Mf]},qb=s=>{const{componentCls:h,iconCls:y,uploadThumbnailSize:x,uploadProgressOffset:w,calc:E}=s,z=`${h}-list`,o=`${z}-item`;return{[`${h}-wrapper`]:{[`
        ${z}${z}-picture,
        ${z}${z}-picture-card,
        ${z}${z}-picture-circle
      `]:{[o]:{position:"relative",height:E(x).add(E(s.lineWidth).mul(2)).add(E(s.paddingXS).mul(2)).equal(),padding:s.paddingXS,border:`${nt(s.lineWidth)} ${s.lineType} ${s.colorBorder}`,borderRadius:s.borderRadiusLG,"&:hover":{background:"transparent"},[`${o}-thumbnail`]:Object.assign(Object.assign({},Gh),{width:x,height:x,lineHeight:nt(E(x).add(s.paddingSM).equal()),textAlign:"center",flex:"none",[y]:{fontSize:s.fontSizeHeading2,color:s.colorPrimary},img:{display:"block",width:"100%",height:"100%",overflow:"hidden"}}),[`${o}-progress`]:{bottom:w,width:`calc(100% - ${nt(E(s.paddingSM).mul(2).equal())})`,marginTop:0,paddingInlineStart:E(x).add(s.paddingXS).equal()}},[`${o}-error`]:{borderColor:s.colorError,[`${o}-thumbnail ${y}`]:{[`svg path[fill='${Up[0]}']`]:{fill:s.colorErrorBg},[`svg path[fill='${Up.primary}']`]:{fill:s.colorError}}},[`${o}-uploading`]:{borderStyle:"dashed",[`${o}-name`]:{marginBottom:w}}},[`${z}${z}-picture-circle ${o}`]:{[`&, &::before, ${o}-thumbnail`]:{borderRadius:"50%"}}}}},Gb=s=>{const{componentCls:h,iconCls:y,fontSizeLG:x,colorTextLightSolid:w,calc:E}=s,z=`${h}-list`,o=`${z}-item`,O=s.uploadPicCardSize;return{[`
      ${h}-wrapper${h}-picture-card-wrapper,
      ${h}-wrapper${h}-picture-circle-wrapper
    `]:Object.assign(Object.assign({},Vh()),{display:"inline-block",width:"100%",[`${h}${h}-select`]:{width:O,height:O,marginInlineEnd:s.marginXS,marginBottom:s.marginXS,textAlign:"center",verticalAlign:"top",backgroundColor:s.colorFillAlter,border:`${nt(s.lineWidth)} dashed ${s.colorBorder}`,borderRadius:s.borderRadiusLG,cursor:"pointer",transition:`border-color ${s.motionDurationSlow}`,[`> ${h}`]:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",textAlign:"center"},[`&:not(${h}-disabled):hover`]:{borderColor:s.colorPrimary}},[`${z}${z}-picture-card, ${z}${z}-picture-circle`]:{[`${z}-item-container`]:{display:"inline-block",width:O,height:O,marginBlock:`0 ${nt(s.marginXS)}`,marginInline:`0 ${nt(s.marginXS)}`,verticalAlign:"top"},"&::after":{display:"none"},[o]:{height:"100%",margin:0,"&::before":{position:"absolute",zIndex:1,width:`calc(100% - ${nt(E(s.paddingXS).mul(2).equal())})`,height:`calc(100% - ${nt(E(s.paddingXS).mul(2).equal())})`,backgroundColor:s.colorBgMask,opacity:0,transition:`all ${s.motionDurationSlow}`,content:'" "'}},[`${o}:hover`]:{[`&::before, ${o}-actions`]:{opacity:1}},[`${o}-actions`]:{position:"absolute",insetInlineStart:0,zIndex:10,width:"100%",whiteSpace:"nowrap",textAlign:"center",opacity:0,transition:`all ${s.motionDurationSlow}`,[`
            ${y}-eye,
            ${y}-download,
            ${y}-delete
          `]:{zIndex:10,width:x,margin:`0 ${nt(s.marginXXS)}`,fontSize:x,cursor:"pointer",transition:`all ${s.motionDurationSlow}`,color:w,"&:hover":{color:w},svg:{verticalAlign:"baseline"}}},[`${o}-thumbnail, ${o}-thumbnail img`]:{position:"static",display:"block",width:"100%",height:"100%",objectFit:"contain"},[`${o}-name`]:{display:"none",textAlign:"center"},[`${o}-file + ${o}-name`]:{position:"absolute",bottom:s.margin,display:"block",width:`calc(100% - ${nt(E(s.paddingXS).mul(2).equal())})`},[`${o}-uploading`]:{[`&${o}`]:{backgroundColor:s.colorFillAlter},[`&::before, ${y}-eye, ${y}-download, ${y}-delete`]:{display:"none"}},[`${o}-progress`]:{bottom:s.marginXL,width:`calc(100% - ${nt(E(s.paddingXS).mul(2).equal())})`,paddingInlineStart:0}}}),[`${h}-wrapper${h}-picture-circle-wrapper`]:{[`${h}${h}-select`]:{borderRadius:"50%"}}}},Zb=s=>{const{componentCls:h}=s;return{[`${h}-rtl`]:{direction:"rtl"}}},Hb=s=>{const{componentCls:h,colorTextDisabled:y}=s;return{[`${h}-wrapper`]:Object.assign(Object.assign({},ao(s)),{[h]:{outline:0,"input[type='file']":{cursor:"pointer"}},[`${h}-select`]:{display:"inline-block"},[`${h}-disabled`]:{color:y,cursor:"not-allowed"}})}},Wb=s=>({actionsColor:s.colorTextDescription}),Xb=es("Upload",s=>{const{fontSizeHeading3:h,fontHeight:y,lineWidth:x,controlHeightLG:w,calc:E}=s,z=ts(s,{uploadThumbnailSize:E(h).mul(2).equal(),uploadProgressOffset:E(E(y).div(2)).add(x).equal(),uploadPicCardSize:E(w).mul(2.55).equal()});return[Hb(z),jb(z),qb(z),Gb(z),Vb(z),Ub(z),Zb(z),ov(z)]},Wb);var Kb={icon:function(h,y){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M534 352V136H232v752h560V394H576a42 42 0 01-42-42z",fill:y}},{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM602 137.8L790.2 326H602V137.8zM792 888H232V136h302v216a42 42 0 0042 42h216v494z",fill:h}}]}},name:"file",theme:"twotone"};const Yb=Kb;var Jb=function(h,y){return k.createElement(La,mi({},h,{ref:y,icon:Yb}))};const Qb=k.forwardRef(Jb);var e1={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M779.3 196.6c-94.2-94.2-247.6-94.2-341.7 0l-261 260.8c-1.7 1.7-2.6 4-2.6 6.4s.9 4.7 2.6 6.4l36.9 36.9a9 9 0 0012.7 0l261-260.8c32.4-32.4 75.5-50.2 121.3-50.2s88.9 17.8 121.2 50.2c32.4 32.4 50.2 75.5 50.2 121.2 0 45.8-17.8 88.8-50.2 121.2l-266 265.9-43.1 43.1c-40.3 40.3-105.8 40.3-146.1 0-19.5-19.5-30.2-45.4-30.2-73s10.7-53.5 30.2-73l263.9-263.8c6.7-6.6 15.5-10.3 24.9-10.3h.1c9.4 0 18.1 3.7 24.7 10.3 6.7 6.7 10.3 15.5 10.3 24.9 0 9.3-3.7 18.1-10.3 24.7L372.4 653c-1.7 1.7-2.6 4-2.6 6.4s.9 4.7 2.6 6.4l36.9 36.9a9 9 0 0012.7 0l215.6-215.6c19.9-19.9 30.8-46.3 30.8-74.4s-11-54.6-30.8-74.4c-41.1-41.1-107.9-41-149 0L463 364 224.8 602.1A172.22 172.22 0 00174 724.8c0 46.3 18.1 89.8 50.8 122.5 33.9 33.8 78.3 50.7 122.7 50.7 44.4 0 88.8-16.9 122.6-50.7l309.2-309C824.8 492.7 850 432 850 367.5c.1-64.6-25.1-125.3-70.7-170.9z"}}]},name:"paper-clip",theme:"outlined"};const t1=e1;var i1=function(h,y){return k.createElement(La,mi({},h,{ref:y,icon:t1}))};const r1=k.forwardRef(i1);var n1={icon:function(h,y){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 632H136v-39.9l138.5-164.3 150.1 178L658.1 489 888 761.6V792zm0-129.8L664.2 396.8c-3.2-3.8-9-3.8-12.2 0L424.6 666.4l-144-170.7c-3.2-3.8-9-3.8-12.2 0L136 652.7V232h752v430.2z",fill:h}},{tag:"path",attrs:{d:"M424.6 765.8l-150.1-178L136 752.1V792h752v-30.4L658.1 489z",fill:y}},{tag:"path",attrs:{d:"M136 652.7l132.4-157c3.2-3.8 9-3.8 12.2 0l144 170.7L652 396.8c3.2-3.8 9-3.8 12.2 0L888 662.2V232H136v420.7zM304 280a88 88 0 110 176 88 88 0 010-176z",fill:y}},{tag:"path",attrs:{d:"M276 368a28 28 0 1056 0 28 28 0 10-56 0z",fill:y}},{tag:"path",attrs:{d:"M304 456a88 88 0 100-176 88 88 0 000 176zm0-116c15.5 0 28 12.5 28 28s-12.5 28-28 28-28-12.5-28-28 12.5-28 28-28z",fill:h}}]}},name:"picture",theme:"twotone"};const a1=n1;var o1=function(h,y){return k.createElement(La,mi({},h,{ref:y,icon:a1}))};const s1=k.forwardRef(o1);function Pc(s){return Object.assign(Object.assign({},s),{lastModified:s.lastModified,lastModifiedDate:s.lastModifiedDate,name:s.name,size:s.size,type:s.type,uid:s.uid,percent:0,originFileObj:s})}function Mc(s,h){const y=qi(h),x=y.findIndex(w=>{let{uid:E}=w;return E===s.uid});return x===-1?y.push(s):y[x]=s,y}function uh(s,h){const y=s.uid!==void 0?"uid":"name";return h.filter(x=>x[y]===s[y])[0]}function l1(s,h){const y=s.uid!==void 0?"uid":"name",x=h.filter(w=>w[y]!==s[y]);return x.length===h.length?null:x}const c1=function(){const h=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:"").split("/"),x=h[h.length-1].split(/#|\?/)[0];return(/\.[^./\\]*$/.exec(x)||[""])[0]},xg=s=>s.indexOf("image/")===0,u1=s=>{if(s.type&&!s.thumbUrl)return xg(s.type);const h=s.thumbUrl||s.url||"",y=c1(h);return/^data:image\//.test(h)||/(webp|svg|png|gif|jpg|jpeg|jfif|bmp|dpg|ico|heic|heif)$/i.test(y)?!0:!(/^data:/.test(h)||y)},Aa=200;function h1(s){return new Promise(h=>{if(!s.type||!xg(s.type)){h("");return}const y=document.createElement("canvas");y.width=Aa,y.height=Aa,y.style.cssText=`position: fixed; left: 0; top: 0; width: ${Aa}px; height: ${Aa}px; z-index: 9999; display: none;`,document.body.appendChild(y);const x=y.getContext("2d"),w=new Image;if(w.onload=()=>{const{width:E,height:z}=w;let o=Aa,O=Aa,L=0,V=0;E>z?(O=z*(Aa/E),V=-(O-o)/2):(o=E*(Aa/z),L=-(o-O)/2),x.drawImage(w,L,V,o,O);const q=y.toDataURL();document.body.removeChild(y),window.URL.revokeObjectURL(w.src),h(q)},w.crossOrigin="anonymous",s.type.startsWith("image/svg+xml")){const E=new FileReader;E.onload=()=>{E.result&&(w.src=E.result)},E.readAsDataURL(s)}else if(s.type.startsWith("image/gif")){const E=new FileReader;E.onload=()=>{E.result&&h(E.result)},E.readAsDataURL(s)}else w.src=window.URL.createObjectURL(s)})}var d1={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M505.7 661a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9h-74.1V168c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v338.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.8zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"download",theme:"outlined"};const p1=d1;var f1=function(h,y){return k.createElement(La,mi({},h,{ref:y,icon:p1}))};const m1=k.forwardRef(f1),g1=k.forwardRef((s,h)=>{let{prefixCls:y,className:x,style:w,locale:E,listType:z,file:o,items:O,progress:L,iconRender:V,actionIconRender:q,itemRender:Q,isImgUrl:ae,showPreviewIcon:fe,showRemoveIcon:me,showDownloadIcon:xe,previewIcon:ve,removeIcon:be,downloadIcon:ge,onPreview:ce,onDownload:Se,onClose:ze}=s;var Be,$e;const{status:De}=o,[Ce,je]=k.useState(De);k.useEffect(()=>{De!=="removed"&&je(De)},[De]);const[Ge,tt]=k.useState(!1);k.useEffect(()=>{const kt=setTimeout(()=>{tt(!0)},300);return()=>{clearTimeout(kt)}},[]);const He=V(o);let ot=k.createElement("div",{className:`${y}-icon`},He);if(z==="picture"||z==="picture-card"||z==="picture-circle")if(Ce==="uploading"||!o.thumbUrl&&!o.url){const kt=_t(`${y}-list-item-thumbnail`,{[`${y}-list-item-file`]:Ce!=="uploading"});ot=k.createElement("div",{className:kt},He)}else{const kt=ae?.(o)?k.createElement("img",{src:o.thumbUrl||o.url,alt:o.name,className:`${y}-list-item-image`,crossOrigin:o.crossOrigin}):He,gi=_t(`${y}-list-item-thumbnail`,{[`${y}-list-item-file`]:ae&&!ae(o)});ot=k.createElement("a",{className:gi,onClick:pi=>ce(o,pi),href:o.url||o.thumbUrl,target:"_blank",rel:"noopener noreferrer"},kt)}const Tt=_t(`${y}-list-item`,`${y}-list-item-${Ce}`),st=typeof o.linkProps=="string"?JSON.parse(o.linkProps):o.linkProps,jt=me?q((typeof be=="function"?be(o):be)||k.createElement(vg,null),()=>ze(o),y,E.removeFile,!0):null,At=xe&&Ce==="done"?q((typeof ge=="function"?ge(o):ge)||k.createElement(m1,null),()=>Se(o),y,E.downloadFile):null,Qt=z!=="picture-card"&&z!=="picture-circle"&&k.createElement("span",{key:"download-delete",className:_t(`${y}-list-item-actions`,{picture:z==="picture"})},At,jt),Gt=_t(`${y}-list-item-name`),ft=o.url?[k.createElement("a",Object.assign({key:"view",target:"_blank",rel:"noopener noreferrer",className:Gt,title:o.name},st,{href:o.url,onClick:kt=>ce(o,kt)}),o.name),Qt]:[k.createElement("span",{key:"view",className:Gt,onClick:kt=>ce(o,kt),title:o.name},o.name),Qt],Oe=fe&&(o.url||o.thumbUrl)?k.createElement("a",{href:o.url||o.thumbUrl,target:"_blank",rel:"noopener noreferrer",onClick:kt=>ce(o,kt),title:E.previewFile},typeof ve=="function"?ve(o):ve||k.createElement(sv,null)):null,gt=(z==="picture-card"||z==="picture-circle")&&Ce!=="uploading"&&k.createElement("span",{className:`${y}-list-item-actions`},Oe,Ce==="done"&&At,jt),{getPrefixCls:Bt}=k.useContext(xn),wt=Bt(),$t=k.createElement("div",{className:Tt},ot,ft,gt,Ge&&k.createElement(fl,{motionName:`${wt}-fade`,visible:Ce==="uploading",motionDeadline:2e3},kt=>{let{className:gi}=kt;const pi="percent"in o?k.createElement(Mb,Object.assign({},L,{type:"line",percent:o.percent,"aria-label":o["aria-label"],"aria-labelledby":o["aria-labelledby"]})):null;return k.createElement("div",{className:_t(`${y}-list-item-progress`,gi)},pi)})),Yt=o.response&&typeof o.response=="string"?o.response:((Be=o.error)===null||Be===void 0?void 0:Be.statusText)||(($e=o.error)===null||$e===void 0?void 0:$e.message)||E.uploadError,ei=Ce==="error"?k.createElement(wm,{title:Yt,getPopupContainer:kt=>kt.parentNode},$t):$t;return k.createElement("div",{className:_t(`${y}-list-item-container`,x),style:w,ref:h},Q?Q(ei,o,O,{download:Se.bind(null,o),preview:ce.bind(null,o),remove:ze.bind(null,o)}):ei)}),y1=g1,_1=(s,h)=>{const{listType:y="text",previewFile:x=h1,onPreview:w,onDownload:E,onRemove:z,locale:o,iconRender:O,isImageUrl:L=u1,prefixCls:V,items:q=[],showPreviewIcon:Q=!0,showRemoveIcon:ae=!0,showDownloadIcon:fe=!1,removeIcon:me,previewIcon:xe,downloadIcon:ve,progress:be={size:[-1,2],showInfo:!1},appendAction:ge,appendActionVisible:ce=!0,itemRender:Se,disabled:ze}=s,Be=lv(),[$e,De]=k.useState(!1);k.useEffect(()=>{y!=="picture"&&y!=="picture-card"&&y!=="picture-circle"||(q||[]).forEach(Oe=>{typeof document>"u"||typeof window>"u"||!window.FileReader||!window.File||!(Oe.originFileObj instanceof File||Oe.originFileObj instanceof Blob)||Oe.thumbUrl!==void 0||(Oe.thumbUrl="",x&&x(Oe.originFileObj).then(gt=>{Oe.thumbUrl=gt||"",Be()}))})},[y,q,x]),k.useEffect(()=>{De(!0)},[]);const Ce=(Oe,gt)=>{if(w)return gt?.preventDefault(),w(Oe)},je=Oe=>{typeof E=="function"?E(Oe):Oe.url&&window.open(Oe.url)},Ge=Oe=>{z?.(Oe)},tt=Oe=>{if(O)return O(Oe,y);const gt=Oe.status==="uploading",Bt=L&&L(Oe)?k.createElement(s1,null):k.createElement(Qb,null);let wt=gt?k.createElement(Ah,null):k.createElement(r1,null);return y==="picture"?wt=gt?k.createElement(Ah,null):Bt:(y==="picture-card"||y==="picture-circle")&&(wt=gt?o.uploading:Bt),wt},He=(Oe,gt,Bt,wt,$t)=>{const Yt={type:"text",size:"small",title:wt,onClick:ei=>{gt(),Gp(Oe)&&Oe.props.onClick&&Oe.props.onClick(ei)},className:`${Bt}-list-item-action`};if($t&&(Yt.disabled=ze),Gp(Oe)){const ei=qp(Oe,Object.assign(Object.assign({},Oe.props),{onClick:()=>{}}));return k.createElement(ha,Object.assign({},Yt,{icon:ei}))}return k.createElement(ha,Object.assign({},Yt),k.createElement("span",null,Oe))};k.useImperativeHandle(h,()=>({handlePreview:Ce,handleDownload:je}));const{getPrefixCls:ot}=k.useContext(xn),Tt=ot("upload",V),st=ot(),jt=_t(`${Tt}-list`,`${Tt}-list-${y}`),At=qi(q.map(Oe=>({key:Oe.uid,file:Oe})));let Gt={motionDeadline:2e3,motionName:`${Tt}-${y==="picture-card"||y==="picture-circle"?"animate-inline":"animate"}`,keys:At,motionAppear:$e};const ft=k.useMemo(()=>{const Oe=Object.assign({},cv(st));return delete Oe.onAppearEnd,delete Oe.onEnterEnd,delete Oe.onLeaveEnd,Oe},[st]);return y!=="picture-card"&&y!=="picture-circle"&&(Gt=Object.assign(Object.assign({},ft),Gt)),k.createElement("div",{className:jt},k.createElement(hm,Object.assign({},Gt,{component:!1}),Oe=>{let{key:gt,file:Bt,className:wt,style:$t}=Oe;return k.createElement(y1,{key:gt,locale:o,prefixCls:Tt,className:wt,style:$t,file:Bt,items:q,progress:be,listType:y,isImgUrl:L,showPreviewIcon:Q,showRemoveIcon:ae,showDownloadIcon:fe,removeIcon:me,previewIcon:xe,downloadIcon:ve,iconRender:tt,actionIconRender:He,itemRender:Se,onPreview:Ce,onDownload:je,onClose:Ge})}),ge&&k.createElement(fl,Object.assign({},Gt,{visible:ce,forceRender:!0}),Oe=>{let{className:gt,style:Bt}=Oe;return qp(ge,wt=>({className:_t(wt.className,gt),style:Object.assign(Object.assign(Object.assign({},Bt),{pointerEvents:gt?"none":void 0}),wt.style)}))}))},v1=k.forwardRef(_1),x1=v1;var b1=function(s,h,y,x){function w(E){return E instanceof y?E:new y(function(z){z(E)})}return new(y||(y=Promise))(function(E,z){function o(V){try{L(x.next(V))}catch(q){z(q)}}function O(V){try{L(x.throw(V))}catch(q){z(q)}}function L(V){V.done?E(V.value):w(V.value).then(o,O)}L((x=x.apply(s,h||[])).next())})};const cl=`__LIST_IGNORE_${Date.now()}__`,w1=(s,h)=>{const{fileList:y,defaultFileList:x,onRemove:w,showUploadList:E=!0,listType:z="text",onPreview:o,onDownload:O,onChange:L,onDrop:V,previewFile:q,disabled:Q,locale:ae,iconRender:fe,isImageUrl:me,progress:xe,prefixCls:ve,className:be,type:ge="select",children:ce,style:Se,itemRender:ze,maxCount:Be,data:$e={},multiple:De=!1,hasControlInside:Ce=!0,action:je="",accept:Ge="",supportServerRender:tt=!0,rootClassName:He}=s,ot=k.useContext(uv),Tt=Q??ot,[st,jt]=kh(x||[],{value:y,postState:Et=>Et??[]}),[At,Qt]=k.useState("drop"),Gt=k.useRef(null);k.useMemo(()=>{const Et=Date.now();(y||[]).forEach((St,Jt)=>{!St.uid&&!Object.isFrozen(St)&&(St.uid=`__AUTO__${Et}_${Jt}__`)})},[y]);const ft=(Et,St,Jt)=>{let zt=qi(St),Le=!1;Be===1?zt=zt.slice(-1):Be&&(Le=zt.length>Be,zt=zt.slice(0,Be)),hl.flushSync(()=>{jt(zt)});const mt={file:Et,fileList:zt};Jt&&(mt.event=Jt),(!Le||zt.some(vt=>vt.uid===Et.uid))&&hl.flushSync(()=>{L?.(mt)})},Oe=(Et,St)=>b1(void 0,void 0,void 0,function*(){const{beforeUpload:Jt,transformFile:zt}=s;let Le=Et;if(Jt){const mt=yield Jt(Et,St);if(mt===!1)return!1;if(delete Et[cl],mt===cl)return Object.defineProperty(Et,cl,{value:!0,configurable:!0}),!1;typeof mt=="object"&&mt&&(Le=mt)}return zt&&(Le=yield zt(Le)),Le}),gt=Et=>{const St=Et.filter(Le=>!Le.file[cl]);if(!St.length)return;const Jt=St.map(Le=>Pc(Le.file));let zt=qi(st);Jt.forEach(Le=>{zt=Mc(Le,zt)}),Jt.forEach((Le,mt)=>{let vt=Le;if(St[mt].parsedFile)Le.status="uploading";else{const{originFileObj:wi}=Le;let Zi;try{Zi=new File([wi],wi.name,{type:wi.type})}catch{Zi=new Blob([wi],{type:wi.type}),Zi.name=wi.name,Zi.lastModifiedDate=new Date,Zi.lastModified=new Date().getTime()}Zi.uid=Le.uid,vt=Zi}ft(vt,zt)})},Bt=(Et,St,Jt)=>{try{typeof Et=="string"&&(Et=JSON.parse(Et))}catch{}if(!uh(St,st))return;const zt=Pc(St);zt.status="done",zt.percent=100,zt.response=Et,zt.xhr=Jt;const Le=Mc(zt,st);ft(zt,Le)},wt=(Et,St)=>{if(!uh(St,st))return;const Jt=Pc(St);Jt.status="uploading",Jt.percent=Et.percent;const zt=Mc(Jt,st);ft(Jt,zt,Et)},$t=(Et,St,Jt)=>{if(!uh(Jt,st))return;const zt=Pc(Jt);zt.error=Et,zt.response=St,zt.status="error";const Le=Mc(zt,st);ft(zt,Le)},Yt=Et=>{let St;Promise.resolve(typeof w=="function"?w(Et):w).then(Jt=>{var zt;if(Jt===!1)return;const Le=l1(Et,st);Le&&(St=Object.assign(Object.assign({},Et),{status:"removed"}),st?.forEach(mt=>{const vt=St.uid!==void 0?"uid":"name";mt[vt]===St[vt]&&!Object.isFrozen(mt)&&(mt.status="removed")}),(zt=Gt.current)===null||zt===void 0||zt.abort(St),ft(St,Le))})},ei=Et=>{Qt(Et.type),Et.type==="drop"&&V?.(Et)};k.useImperativeHandle(h,()=>({onBatchStart:gt,onSuccess:Bt,onProgress:wt,onError:$t,fileList:st,upload:Gt.current}));const{getPrefixCls:kt,direction:gi,upload:pi}=k.useContext(xn),Pt=kt("upload",ve),li=Object.assign(Object.assign({onBatchStart:gt,onError:$t,onProgress:wt,onSuccess:Bt},s),{data:$e,multiple:De,action:je,accept:Ge,supportServerRender:tt,prefixCls:Pt,disabled:Tt,beforeUpload:Oe,onChange:void 0,hasControlInside:Ce});delete li.className,delete li.style,(!ce||Tt)&&delete li.id;const Xi=`${Pt}-wrapper`,[Ht,Mi,Fi]=Xb(Pt,Xi),[gr]=Uc("Upload",bm.Upload),{showRemoveIcon:Te,showPreviewIcon:bi,showDownloadIcon:Li,removeIcon:Wt,previewIcon:Ft,downloadIcon:Gi}=typeof E=="boolean"?{}:E,Ki=typeof Te>"u"?!Tt:!!Te,yi=(Et,St)=>E?k.createElement(x1,{prefixCls:Pt,listType:z,items:st,previewFile:q,onPreview:o,onDownload:O,onRemove:Yt,showRemoveIcon:Ki,showPreviewIcon:bi,showDownloadIcon:Li,removeIcon:Wt,previewIcon:Ft,downloadIcon:Gi,iconRender:fe,locale:Object.assign(Object.assign({},gr),ae),isImageUrl:me,progress:xe,appendAction:Et,appendActionVisible:St,itemRender:ze,disabled:Tt}):Et,cn=_t(Xi,be,He,Mi,Fi,pi?.className,{[`${Pt}-rtl`]:gi==="rtl",[`${Pt}-picture-card-wrapper`]:z==="picture-card",[`${Pt}-picture-circle-wrapper`]:z==="picture-circle"}),or=Object.assign(Object.assign({},pi?.style),Se);if(ge==="drag"){const Et=_t(Mi,Pt,`${Pt}-drag`,{[`${Pt}-drag-uploading`]:st.some(St=>St.status==="uploading"),[`${Pt}-drag-hover`]:At==="dragover",[`${Pt}-disabled`]:Tt,[`${Pt}-rtl`]:gi==="rtl"});return Ht(k.createElement("span",{className:cn},k.createElement("div",{className:Et,style:or,onDrop:ei,onDragOver:ei,onDragLeave:ei},k.createElement($h,Object.assign({},li,{ref:Gt,className:`${Pt}-btn`}),k.createElement("div",{className:`${Pt}-drag-container`},ce))),yi()))}const ar=_t(Pt,`${Pt}-select`,{[`${Pt}-disabled`]:Tt}),Ve=(Et=>k.createElement("div",{className:ar,style:Et},k.createElement($h,Object.assign({},li,{ref:Gt}))))(ce?void 0:{display:"none"});return Ht(z==="picture-card"||z==="picture-circle"?k.createElement("span",{className:cn},yi(Ve,!!ce)):k.createElement("span",{className:cn},Ve,yi()))},S1=k.forwardRef(w1),bg=S1;var C1=function(s,h){var y={};for(var x in s)Object.prototype.hasOwnProperty.call(s,x)&&h.indexOf(x)<0&&(y[x]=s[x]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var w=0,x=Object.getOwnPropertySymbols(s);w<x.length;w++)h.indexOf(x[w])<0&&Object.prototype.propertyIsEnumerable.call(s,x[w])&&(y[x[w]]=s[x[w]]);return y};const T1=k.forwardRef((s,h)=>{var{style:y,height:x,hasControlInside:w=!1}=s,E=C1(s,["style","height","hasControlInside"]);return k.createElement(bg,Object.assign({ref:h,hasControlInside:w},E,{type:"drag",style:Object.assign(Object.assign({},y),{height:x})}))}),E1=T1,Jh=bg;Jh.Dragger=E1;Jh.LIST_IGNORE=cl;const I1=Jh;var P1={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M885.2 446.3l-.2-.8-112.2-285.1c-5-16.1-19.9-27.2-36.8-27.2H281.2c-17 0-32.1 11.3-36.9 27.6L139.4 443l-.3.7-.2.8c-1.3 4.9-1.7 9.9-1 14.8-.1 1.6-.2 3.2-.2 4.8V830a60.9 60.9 0 0060.8 60.8h627.2c33.5 0 60.8-27.3 60.9-60.8V464.1c0-1.3 0-2.6-.1-3.7.4-4.9 0-9.6-1.3-14.1zm-295.8-43l-.3 15.7c-.8 44.9-31.8 75.1-77.1 75.1-22.1 0-41.1-7.1-54.8-20.6S436 441.2 435.6 419l-.3-15.7H229.5L309 210h399.2l81.7 193.3H589.4zm-375 76.8h157.3c24.3 57.1 76 90.8 140.4 90.8 33.7 0 65-9.4 90.3-27.2 22.2-15.6 39.5-37.4 50.7-63.6h156.5V814H214.4V480.1z"}}]},name:"inbox",theme:"outlined"};const M1=P1;var A1=function(h,y){return k.createElement(La,mi({},h,{ref:y,icon:M1}))};const k1=k.forwardRef(A1);function hh({children:s,className:h}){return Pe.jsx(no,{gutter:38,className:"mt-3 first:mt-0 "+h,children:s})}const z1=[{label:"Hoạt động",value:"Active"},{label:"Khóa",value:"Lock"}],L1=[{label:"Thêm khách hàng",value:"add"},{label:"Chọn khách hàng",value:"Choose"},{label:"Import khách hàng",value:"Import"}],Qh=[{title:"Mã khách hàng",dataIndex:"customer_id",key:"customerid"},{title:"Tên khách hàng",dataIndex:"customer_name",key:"customername"}],wg=[{title:"Địa chỉ",dataIndex:"display_address",key:"display_address"},{title:"Số điện thoại",dataIndex:"phone_number",key:"phone_number"}],Sg=[{customer_id:"431456",customer_name:"Chu Văn A",display_address:"CT1 Chung cư bộ công an",phone_number:"0123456789",frequency:"1;2;3;4;5"},{customer_id:"4314s56",customer_name:"Chu Văn A",display_address:"CT1 Chung cư bộ công an",phone_number:"0123456789",frequency:""}],D1=[{label:"1",value:"1"},{label:"2",value:"2"},{label:"3",value:"3"},{label:"4",value:"4"},{label:"5",value:"5"}],R1={customer_type:"Loại khách hàng",customer_group:"Nhóm khách hàng",city:"Tỉnh/Thành phố",district:"Quận/huyện",ward:"Phường/xã"},$1=[{label:"Thứ 2",value:"Thứ 2"},{label:"Thứ 3",value:"Thứ 3"},{label:"Thứ 4",value:"Thứ 4"},{label:"Thứ 5",value:"Thứ 5"},{label:"Thứ 6",value:"Thứ 6"},{label:"Thứ 7",value:"Thứ 7"},{label:"Chủ nhật",value:"Chủ nhật"}];var ed={exports:{}},Cg=function(h,y){return function(){for(var w=new Array(arguments.length),E=0;E<w.length;E++)w[E]=arguments[E];return h.apply(y,w)}},O1=Cg,Da=Object.prototype.toString;function td(s){return Array.isArray(s)}function Oh(s){return typeof s>"u"}function B1(s){return s!==null&&!Oh(s)&&s.constructor!==null&&!Oh(s.constructor)&&typeof s.constructor.isBuffer=="function"&&s.constructor.isBuffer(s)}function Tg(s){return Da.call(s)==="[object ArrayBuffer]"}function F1(s){return Da.call(s)==="[object FormData]"}function N1(s){var h;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?h=ArrayBuffer.isView(s):h=s&&s.buffer&&Tg(s.buffer),h}function j1(s){return typeof s=="string"}function V1(s){return typeof s=="number"}function Eg(s){return s!==null&&typeof s=="object"}function Lc(s){if(Da.call(s)!=="[object Object]")return!1;var h=Object.getPrototypeOf(s);return h===null||h===Object.prototype}function U1(s){return Da.call(s)==="[object Date]"}function q1(s){return Da.call(s)==="[object File]"}function G1(s){return Da.call(s)==="[object Blob]"}function Ig(s){return Da.call(s)==="[object Function]"}function Z1(s){return Eg(s)&&Ig(s.pipe)}function H1(s){return Da.call(s)==="[object URLSearchParams]"}function W1(s){return s.trim?s.trim():s.replace(/^\s+|\s+$/g,"")}function X1(){return typeof navigator<"u"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window<"u"&&typeof document<"u"}function id(s,h){if(!(s===null||typeof s>"u"))if(typeof s!="object"&&(s=[s]),td(s))for(var y=0,x=s.length;y<x;y++)h.call(null,s[y],y,s);else for(var w in s)Object.prototype.hasOwnProperty.call(s,w)&&h.call(null,s[w],w,s)}function Bh(){var s={};function h(w,E){Lc(s[E])&&Lc(w)?s[E]=Bh(s[E],w):Lc(w)?s[E]=Bh({},w):td(w)?s[E]=w.slice():s[E]=w}for(var y=0,x=arguments.length;y<x;y++)id(arguments[y],h);return s}function K1(s,h,y){return id(h,function(w,E){y&&typeof w=="function"?s[E]=O1(w,y):s[E]=w}),s}function Y1(s){return s.charCodeAt(0)===65279&&(s=s.slice(1)),s}var en={isArray:td,isArrayBuffer:Tg,isBuffer:B1,isFormData:F1,isArrayBufferView:N1,isString:j1,isNumber:V1,isObject:Eg,isPlainObject:Lc,isUndefined:Oh,isDate:U1,isFile:q1,isBlob:G1,isFunction:Ig,isStream:Z1,isURLSearchParams:H1,isStandardBrowserEnv:X1,forEach:id,merge:Bh,extend:K1,trim:W1,stripBOM:Y1},Yo=en;function Af(s){return encodeURIComponent(s).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var Pg=function(h,y,x){if(!y)return h;var w;if(x)w=x(y);else if(Yo.isURLSearchParams(y))w=y.toString();else{var E=[];Yo.forEach(y,function(O,L){O===null||typeof O>"u"||(Yo.isArray(O)?L=L+"[]":O=[O],Yo.forEach(O,function(q){Yo.isDate(q)?q=q.toISOString():Yo.isObject(q)&&(q=JSON.stringify(q)),E.push(Af(L)+"="+Af(q))}))}),w=E.join("&")}if(w){var z=h.indexOf("#");z!==-1&&(h=h.slice(0,z)),h+=(h.indexOf("?")===-1?"?":"&")+w}return h},J1=en;function Hc(){this.handlers=[]}Hc.prototype.use=function(h,y,x){return this.handlers.push({fulfilled:h,rejected:y,synchronous:x?x.synchronous:!1,runWhen:x?x.runWhen:null}),this.handlers.length-1};Hc.prototype.eject=function(h){this.handlers[h]&&(this.handlers[h]=null)};Hc.prototype.forEach=function(h){J1.forEach(this.handlers,function(x){x!==null&&h(x)})};var Q1=Hc,ew=en,tw=function(h,y){ew.forEach(h,function(w,E){E!==y&&E.toUpperCase()===y.toUpperCase()&&(h[y]=w,delete h[E])})},Mg=function(h,y,x,w,E){return h.config=y,x&&(h.code=x),h.request=w,h.response=E,h.isAxiosError=!0,h.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},h},Ag={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},dh,kf;function kg(){if(kf)return dh;kf=1;var s=Mg;return dh=function(y,x,w,E,z){var o=new Error(y);return s(o,x,w,E,z)},dh}var ph,zf;function iw(){if(zf)return ph;zf=1;var s=kg();return ph=function(y,x,w){var E=w.config.validateStatus;!w.status||!E||E(w.status)?y(w):x(s("Request failed with status code "+w.status,w.config,null,w.request,w))},ph}var fh,Lf;function rw(){if(Lf)return fh;Lf=1;var s=en;return fh=s.isStandardBrowserEnv()?function(){return{write:function(x,w,E,z,o,O){var L=[];L.push(x+"="+encodeURIComponent(w)),s.isNumber(E)&&L.push("expires="+new Date(E).toGMTString()),s.isString(z)&&L.push("path="+z),s.isString(o)&&L.push("domain="+o),O===!0&&L.push("secure"),document.cookie=L.join("; ")},read:function(x){var w=document.cookie.match(new RegExp("(^|;\\s*)("+x+")=([^;]*)"));return w?decodeURIComponent(w[3]):null},remove:function(x){this.write(x,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),fh}var mh,Df;function nw(){return Df||(Df=1,mh=function(h){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(h)}),mh}var gh,Rf;function aw(){return Rf||(Rf=1,gh=function(h,y){return y?h.replace(/\/+$/,"")+"/"+y.replace(/^\/+/,""):h}),gh}var yh,$f;function ow(){if($f)return yh;$f=1;var s=nw(),h=aw();return yh=function(x,w){return x&&!s(w)?h(x,w):w},yh}var _h,Of;function sw(){if(Of)return _h;Of=1;var s=en,h=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return _h=function(x){var w={},E,z,o;return x&&s.forEach(x.split(`
`),function(L){if(o=L.indexOf(":"),E=s.trim(L.substr(0,o)).toLowerCase(),z=s.trim(L.substr(o+1)),E){if(w[E]&&h.indexOf(E)>=0)return;E==="set-cookie"?w[E]=(w[E]?w[E]:[]).concat([z]):w[E]=w[E]?w[E]+", "+z:z}}),w},_h}var vh,Bf;function lw(){if(Bf)return vh;Bf=1;var s=en;return vh=s.isStandardBrowserEnv()?function(){var y=/(msie|trident)/i.test(navigator.userAgent),x=document.createElement("a"),w;function E(z){var o=z;return y&&(x.setAttribute("href",o),o=x.href),x.setAttribute("href",o),{href:x.href,protocol:x.protocol?x.protocol.replace(/:$/,""):"",host:x.host,search:x.search?x.search.replace(/^\?/,""):"",hash:x.hash?x.hash.replace(/^#/,""):"",hostname:x.hostname,port:x.port,pathname:x.pathname.charAt(0)==="/"?x.pathname:"/"+x.pathname}}return w=E(window.location.href),function(o){var O=s.isString(o)?E(o):o;return O.protocol===w.protocol&&O.host===w.host}}():function(){return function(){return!0}}(),vh}var xh,Ff;function Wc(){if(Ff)return xh;Ff=1;function s(h){this.message=h}return s.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},s.prototype.__CANCEL__=!0,xh=s,xh}var bh,Nf;function jf(){if(Nf)return bh;Nf=1;var s=en,h=iw(),y=rw(),x=Pg,w=ow(),E=sw(),z=lw(),o=kg(),O=Ag,L=Wc();return bh=function(q){return new Promise(function(ae,fe){var me=q.data,xe=q.headers,ve=q.responseType,be;function ge(){q.cancelToken&&q.cancelToken.unsubscribe(be),q.signal&&q.signal.removeEventListener("abort",be)}s.isFormData(me)&&delete xe["Content-Type"];var ce=new XMLHttpRequest;if(q.auth){var Se=q.auth.username||"",ze=q.auth.password?unescape(encodeURIComponent(q.auth.password)):"";xe.Authorization="Basic "+btoa(Se+":"+ze)}var Be=w(q.baseURL,q.url);ce.open(q.method.toUpperCase(),x(Be,q.params,q.paramsSerializer),!0),ce.timeout=q.timeout;function $e(){if(ce){var Ce="getAllResponseHeaders"in ce?E(ce.getAllResponseHeaders()):null,je=!ve||ve==="text"||ve==="json"?ce.responseText:ce.response,Ge={data:je,status:ce.status,statusText:ce.statusText,headers:Ce,config:q,request:ce};h(function(He){ae(He),ge()},function(He){fe(He),ge()},Ge),ce=null}}if("onloadend"in ce?ce.onloadend=$e:ce.onreadystatechange=function(){!ce||ce.readyState!==4||ce.status===0&&!(ce.responseURL&&ce.responseURL.indexOf("file:")===0)||setTimeout($e)},ce.onabort=function(){ce&&(fe(o("Request aborted",q,"ECONNABORTED",ce)),ce=null)},ce.onerror=function(){fe(o("Network Error",q,null,ce)),ce=null},ce.ontimeout=function(){var je=q.timeout?"timeout of "+q.timeout+"ms exceeded":"timeout exceeded",Ge=q.transitional||O;q.timeoutErrorMessage&&(je=q.timeoutErrorMessage),fe(o(je,q,Ge.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",ce)),ce=null},s.isStandardBrowserEnv()){var De=(q.withCredentials||z(Be))&&q.xsrfCookieName?y.read(q.xsrfCookieName):void 0;De&&(xe[q.xsrfHeaderName]=De)}"setRequestHeader"in ce&&s.forEach(xe,function(je,Ge){typeof me>"u"&&Ge.toLowerCase()==="content-type"?delete xe[Ge]:ce.setRequestHeader(Ge,je)}),s.isUndefined(q.withCredentials)||(ce.withCredentials=!!q.withCredentials),ve&&ve!=="json"&&(ce.responseType=q.responseType),typeof q.onDownloadProgress=="function"&&ce.addEventListener("progress",q.onDownloadProgress),typeof q.onUploadProgress=="function"&&ce.upload&&ce.upload.addEventListener("progress",q.onUploadProgress),(q.cancelToken||q.signal)&&(be=function(Ce){ce&&(fe(!Ce||Ce&&Ce.type?new L("canceled"):Ce),ce.abort(),ce=null)},q.cancelToken&&q.cancelToken.subscribe(be),q.signal&&(q.signal.aborted?be():q.signal.addEventListener("abort",be))),me||(me=null),ce.send(me)})},bh}var Sr=en,Vf=tw,cw=Mg,uw=Ag,hw={"Content-Type":"application/x-www-form-urlencoded"};function Uf(s,h){!Sr.isUndefined(s)&&Sr.isUndefined(s["Content-Type"])&&(s["Content-Type"]=h)}function dw(){var s;return(typeof XMLHttpRequest<"u"||typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]")&&(s=jf()),s}function pw(s,h,y){if(Sr.isString(s))try{return(h||JSON.parse)(s),Sr.trim(s)}catch(x){if(x.name!=="SyntaxError")throw x}return(y||JSON.stringify)(s)}var Xc={transitional:uw,adapter:dw(),transformRequest:[function(h,y){return Vf(y,"Accept"),Vf(y,"Content-Type"),Sr.isFormData(h)||Sr.isArrayBuffer(h)||Sr.isBuffer(h)||Sr.isStream(h)||Sr.isFile(h)||Sr.isBlob(h)?h:Sr.isArrayBufferView(h)?h.buffer:Sr.isURLSearchParams(h)?(Uf(y,"application/x-www-form-urlencoded;charset=utf-8"),h.toString()):Sr.isObject(h)||y&&y["Content-Type"]==="application/json"?(Uf(y,"application/json"),pw(h)):h}],transformResponse:[function(h){var y=this.transitional||Xc.transitional,x=y&&y.silentJSONParsing,w=y&&y.forcedJSONParsing,E=!x&&this.responseType==="json";if(E||w&&Sr.isString(h)&&h.length)try{return JSON.parse(h)}catch(z){if(E)throw z.name==="SyntaxError"?cw(z,this,"E_JSON_PARSE"):z}return h}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(h){return h>=200&&h<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};Sr.forEach(["delete","get","head"],function(h){Xc.headers[h]={}});Sr.forEach(["post","put","patch"],function(h){Xc.headers[h]=Sr.merge(hw)});var rd=Xc,fw=en,mw=rd,gw=function(h,y,x){var w=this||mw;return fw.forEach(x,function(z){h=z.call(w,h,y)}),h},wh,qf;function zg(){return qf||(qf=1,wh=function(h){return!!(h&&h.__CANCEL__)}),wh}var Gf=en,Sh=gw,yw=zg(),_w=rd,vw=Wc();function Ch(s){if(s.cancelToken&&s.cancelToken.throwIfRequested(),s.signal&&s.signal.aborted)throw new vw("canceled")}var xw=function(h){Ch(h),h.headers=h.headers||{},h.data=Sh.call(h,h.data,h.headers,h.transformRequest),h.headers=Gf.merge(h.headers.common||{},h.headers[h.method]||{},h.headers),Gf.forEach(["delete","get","head","post","put","patch","common"],function(w){delete h.headers[w]});var y=h.adapter||_w.adapter;return y(h).then(function(w){return Ch(h),w.data=Sh.call(h,w.data,w.headers,h.transformResponse),w},function(w){return yw(w)||(Ch(h),w&&w.response&&(w.response.data=Sh.call(h,w.response.data,w.response.headers,h.transformResponse))),Promise.reject(w)})},on=en,Lg=function(h,y){y=y||{};var x={};function w(V,q){return on.isPlainObject(V)&&on.isPlainObject(q)?on.merge(V,q):on.isPlainObject(q)?on.merge({},q):on.isArray(q)?q.slice():q}function E(V){if(on.isUndefined(y[V])){if(!on.isUndefined(h[V]))return w(void 0,h[V])}else return w(h[V],y[V])}function z(V){if(!on.isUndefined(y[V]))return w(void 0,y[V])}function o(V){if(on.isUndefined(y[V])){if(!on.isUndefined(h[V]))return w(void 0,h[V])}else return w(void 0,y[V])}function O(V){if(V in y)return w(h[V],y[V]);if(V in h)return w(void 0,h[V])}var L={url:z,method:z,data:z,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:O};return on.forEach(Object.keys(h).concat(Object.keys(y)),function(q){var Q=L[q]||E,ae=Q(q);on.isUndefined(ae)&&Q!==O||(x[q]=ae)}),x},Th,Zf;function Dg(){return Zf||(Zf=1,Th={version:"0.26.1"}),Th}var bw=Dg().version,nd={};["object","boolean","number","function","string","symbol"].forEach(function(s,h){nd[s]=function(x){return typeof x===s||"a"+(h<1?"n ":" ")+s}});var Hf={};nd.transitional=function(h,y,x){function w(E,z){return"[Axios v"+bw+"] Transitional option '"+E+"'"+z+(x?". "+x:"")}return function(E,z,o){if(h===!1)throw new Error(w(z," has been removed"+(y?" in "+y:"")));return y&&!Hf[z]&&(Hf[z]=!0,console.warn(w(z," has been deprecated since v"+y+" and will be removed in the near future"))),h?h(E,z,o):!0}};function ww(s,h,y){if(typeof s!="object")throw new TypeError("options must be an object");for(var x=Object.keys(s),w=x.length;w-- >0;){var E=x[w],z=h[E];if(z){var o=s[E],O=o===void 0||z(o,E,s);if(O!==!0)throw new TypeError("option "+E+" must be "+O);continue}if(y!==!0)throw Error("Unknown option "+E)}}var Sw={assertOptions:ww,validators:nd},Rg=en,Cw=Pg,Wf=Q1,Xf=xw,Kc=Lg,$g=Sw,Jo=$g.validators;function _l(s){this.defaults=s,this.interceptors={request:new Wf,response:new Wf}}_l.prototype.request=function(h,y){typeof h=="string"?(y=y||{},y.url=h):y=h||{},y=Kc(this.defaults,y),y.method?y.method=y.method.toLowerCase():this.defaults.method?y.method=this.defaults.method.toLowerCase():y.method="get";var x=y.transitional;x!==void 0&&$g.assertOptions(x,{silentJSONParsing:Jo.transitional(Jo.boolean),forcedJSONParsing:Jo.transitional(Jo.boolean),clarifyTimeoutError:Jo.transitional(Jo.boolean)},!1);var w=[],E=!0;this.interceptors.request.forEach(function(ae){typeof ae.runWhen=="function"&&ae.runWhen(y)===!1||(E=E&&ae.synchronous,w.unshift(ae.fulfilled,ae.rejected))});var z=[];this.interceptors.response.forEach(function(ae){z.push(ae.fulfilled,ae.rejected)});var o;if(!E){var O=[Xf,void 0];for(Array.prototype.unshift.apply(O,w),O=O.concat(z),o=Promise.resolve(y);O.length;)o=o.then(O.shift(),O.shift());return o}for(var L=y;w.length;){var V=w.shift(),q=w.shift();try{L=V(L)}catch(Q){q(Q);break}}try{o=Xf(L)}catch(Q){return Promise.reject(Q)}for(;z.length;)o=o.then(z.shift(),z.shift());return o};_l.prototype.getUri=function(h){return h=Kc(this.defaults,h),Cw(h.url,h.params,h.paramsSerializer).replace(/^\?/,"")};Rg.forEach(["delete","get","head","options"],function(h){_l.prototype[h]=function(y,x){return this.request(Kc(x||{},{method:h,url:y,data:(x||{}).data}))}});Rg.forEach(["post","put","patch"],function(h){_l.prototype[h]=function(y,x,w){return this.request(Kc(w||{},{method:h,url:y,data:x}))}});var Tw=_l,Eh,Kf;function Ew(){if(Kf)return Eh;Kf=1;var s=Wc();function h(y){if(typeof y!="function")throw new TypeError("executor must be a function.");var x;this.promise=new Promise(function(z){x=z});var w=this;this.promise.then(function(E){if(w._listeners){var z,o=w._listeners.length;for(z=0;z<o;z++)w._listeners[z](E);w._listeners=null}}),this.promise.then=function(E){var z,o=new Promise(function(O){w.subscribe(O),z=O}).then(E);return o.cancel=function(){w.unsubscribe(z)},o},y(function(z){w.reason||(w.reason=new s(z),x(w.reason))})}return h.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},h.prototype.subscribe=function(x){if(this.reason){x(this.reason);return}this._listeners?this._listeners.push(x):this._listeners=[x]},h.prototype.unsubscribe=function(x){if(this._listeners){var w=this._listeners.indexOf(x);w!==-1&&this._listeners.splice(w,1)}},h.source=function(){var x,w=new h(function(z){x=z});return{token:w,cancel:x}},Eh=h,Eh}var Ih,Yf;function Iw(){return Yf||(Yf=1,Ih=function(h){return function(x){return h.apply(null,x)}}),Ih}var Ph,Jf;function Pw(){if(Jf)return Ph;Jf=1;var s=en;return Ph=function(y){return s.isObject(y)&&y.isAxiosError===!0},Ph}var Qf=en,Mw=Cg,Dc=Tw,Aw=Lg,kw=rd;function Og(s){var h=new Dc(s),y=Mw(Dc.prototype.request,h);return Qf.extend(y,Dc.prototype,h),Qf.extend(y,h),y.create=function(w){return Og(Aw(s,w))},y}var Wn=Og(kw);Wn.Axios=Dc;Wn.Cancel=Wc();Wn.CancelToken=Ew();Wn.isCancel=zg();Wn.VERSION=Dg().version;Wn.all=function(h){return Promise.all(h)};Wn.spread=Iw();Wn.isAxiosError=Pw();ed.exports=Wn;ed.exports.default=Wn;var zw=ed.exports,Lw=zw;const Bg=Im(Lw);var ul={VITE_SOCKET_PORT:"9006",VITE_BASE_PATH:"/mbw_desk",VITE_KEY_MAP:"wtpM0U1ZmE2s87LEZNSHf63Osc1a2sboaozCQNsy",BASE_URL:"/assets/mbw_dms/mbw_fe/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};let Ln=Bg;console.log(ul.VITE_BASE_URL);ul.VITE_BASE_URL&&(console.log("vao day"),Ln=Bg.create({baseURL:ul.VITE_BASE_URL}),Ln.interceptors.request.use(function(s){const h=`Basic ${btoa(`${ul.VITE_AUTH_KEY}:${ul.VITE_AUTH_SECRET}`)}`;return s.headers.Authorization=h,s},function(s){return Promise.reject(s)}));Ln.interceptors.response.use(function(s){return console.log("response",s),s.data},function(s){return Promise.reject(s)});let Ac;const Dw=(s,h)=>{console.log(s),Ac&&(clearTimeout(Ac),Ac=null),s?Ac=setTimeout(()=>{h(s)},300):h("")};function Rw(){const[s,h]=k.useState(""),[y,x]=k.useState([]),[w,E]=k.useState([]);k.useEffect(()=>{(async()=>{let o=await Ln.get("/api/method/mbw_dms.api.router.get_team_sale");x(o.result.map(O=>({label:O,value:O})))})()},[]),k.useEffect(()=>{(async()=>{let o=await Ln.get("/api/method/frappe.desk.search.search_link",{params:{txt:s,doctype:"Employee",ignore_user_permissions:0,reference_doctype:"Attendance",query:"erpnext.controllers.queries.employee_query"}}),{results:O}=o;E(O.map(L=>({value:L.value,label:L.description})))})()},[s]),console.log("listEmployees",w);const z=o=>{Dw(o,h)};return Pe.jsxs("div",{className:"p-4 pt-[43px] pb-[58px]",children:[Pe.jsxs(hh,{children:[Pe.jsx(Ur,{span:12,children:Pe.jsx(Qr,{label:"Mã tuyến",name:"channel_code",required:!0,children:Pe.jsx(Rc,{})})}),Pe.jsx(Ur,{span:12,children:Pe.jsx(Qr,{label:"Tên tuyến",name:"channel_name",required:!0,children:Pe.jsx(Rc,{})})})]}),Pe.jsxs(hh,{children:[Pe.jsx(Ur,{span:12,children:Pe.jsx(Qr,{label:"Team sale",name:"team_sale",required:!0,children:Pe.jsx(zn,{showSearch:!0,options:y,defaultActiveFirstOption:!1})})}),Pe.jsx(Ur,{span:12,children:Pe.jsx(Qr,{label:"Nhân viên",name:"employee",required:!0,children:Pe.jsx(zn,{showSearch:!0,notFoundContent:null,onSearch:z,options:w})})})]}),Pe.jsxs(hh,{children:[Pe.jsx(Ur,{span:12,children:Pe.jsx(Qr,{label:"Ngày đi tuyến",name:"travel_date",required:!0,children:Pe.jsx(zn,{options:$1})})}),Pe.jsx(Ur,{span:12,children:Pe.jsx(Qr,{label:"Trạng thái",name:"status",children:Pe.jsx(zn,{options:z1,defaultValue:"Active"})})})]})]})}const $w=({size:s=20})=>Pe.jsx("svg",{width:s,height:s,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:Pe.jsx("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M11.0267 1.13334C11.5534 0.501676 12.5792 0.933342 12.4959 1.75168L11.9076 7.50001H16.6667C16.8251 7.50007 16.9801 7.54524 17.1137 7.63024C17.2473 7.71523 17.3539 7.83653 17.4211 7.97993C17.4882 8.12333 17.5132 8.2829 17.4929 8.43994C17.4726 8.59698 17.4081 8.74501 17.3067 8.86668L8.97339 18.8667C8.44672 19.4983 7.42089 19.0667 7.50422 18.2483L8.09255 12.5H3.33339C3.17504 12.4999 3.01999 12.4548 2.88639 12.3698C2.75279 12.2848 2.64617 12.1635 2.57902 12.0201C2.51187 11.8767 2.48696 11.7171 2.50721 11.5601C2.52747 11.403 2.59205 11.255 2.69339 11.1333L11.0267 1.13334Z",fill:"currentColor"})}),Ow=({size:s=20})=>Pe.jsxs("svg",{width:s,height:s,viewBox:"0 0 28 28",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[Pe.jsx("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M9.83847 8.58794C10.1411 8.46187 10.4827 8.4689 10.7798 8.60732L15.0763 10.6088C15.6604 10.8809 15.9133 11.5749 15.6412 12.159C15.3691 12.7431 14.6751 12.996 14.091 12.7239L11.4888 11.5117L11.653 20.2421L15.7503 22.1045V15.7497C15.7503 15.1053 16.2727 14.583 16.917 14.583C17.5613 14.583 18.0837 15.1053 18.0837 15.7497V22.1663L22.7503 20.2219V13.4163C22.7503 12.772 23.2727 12.2497 23.917 12.2497C24.5613 12.2497 25.0837 12.772 25.0837 13.4163V20.9997C25.0837 21.4707 24.8005 21.8955 24.3657 22.0766L17.3657 24.9933C17.0666 25.1179 16.7292 25.1125 16.4342 24.9784L10.5003 22.2812L4.56643 24.9784C4.20532 25.1426 3.78555 25.112 3.45204 24.8972C3.11854 24.6825 2.91699 24.313 2.91699 23.9163V12.2497C2.91699 11.7787 3.20019 11.3539 3.63494 11.1728L9.83847 8.58794ZM9.31945 20.2549L9.15297 11.4013L5.25033 13.0275V22.1045L9.31945 20.2549Z",fill:"currentColor"}),Pe.jsx("path",{d:"M19.8337 8.61425C20.478 8.61425 21.0003 8.09192 21.0003 7.44759C21.0003 6.80326 20.478 6.28092 19.8337 6.28092C19.1893 6.28092 18.667 6.80326 18.667 7.44759C18.667 8.09192 19.1893 8.61425 19.8337 8.61425Z",fill:"currentColor"}),Pe.jsx("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M19.8337 2.33301C17.2197 2.33301 15.167 4.52385 15.167 7.1293C15.167 7.85019 15.4274 8.59094 15.7195 9.21916C16.0229 9.8717 16.4198 10.5259 16.8094 11.1056C17.5898 12.2664 18.4067 13.2245 18.579 13.4238L18.5825 13.4278C18.89 13.7803 19.3411 13.9997 19.8337 13.9997C20.3262 13.9997 20.7773 13.7803 21.0848 13.4278L21.0883 13.4238C21.2606 13.2245 22.0776 12.2664 22.8579 11.1056C23.2476 10.5259 23.6444 9.8717 23.9478 9.21916C24.2399 8.59094 24.5003 7.85019 24.5003 7.1293C24.5003 4.52385 22.4476 2.33301 19.8337 2.33301ZM17.5003 7.1293C17.5003 5.7318 18.5876 4.66634 19.8337 4.66634C21.0797 4.66634 22.167 5.7318 22.167 7.1293C22.167 7.33968 22.0764 7.70972 21.832 8.23544C21.5989 8.73683 21.2738 9.2797 20.9214 9.80382C20.5368 10.376 20.1392 10.8972 19.8337 11.2802C19.5281 10.8972 19.1305 10.376 18.7459 9.80382C18.3936 9.2797 18.0684 8.73683 17.8353 8.23544C17.5909 7.70972 17.5003 7.33968 17.5003 7.1293Z",fill:"currentColor"})]}),Bw=({size:s=20,fill:h="#1877F2"})=>Pe.jsx("svg",{width:s,height:s,viewBox:"0 0 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:Pe.jsx("path",{d:"M23.1875 5.25H10.9375C10.6094 5.25 10.3314 5.36393 10.1035 5.5918C9.87565 5.81966 9.76172 6.09766 9.76172 6.42578C9.76172 6.73568 9.87565 7.00456 10.1035 7.23242C10.3314 7.46029 10.6094 7.57422 10.9375 7.57422H23.1875C23.4974 7.57422 23.7663 7.46029 23.9941 7.23242C24.222 7.00456 24.3359 6.73568 24.3359 6.42578C24.3359 6.09766 24.222 5.81966 23.9941 5.5918C23.7663 5.36393 23.4974 5.25 23.1875 5.25ZM23.1875 12.25H10.9375C10.6094 12.25 10.3314 12.3639 10.1035 12.5918C9.87565 12.8197 9.76172 13.0977 9.76172 13.4258C9.76172 13.7357 9.87565 14.0046 10.1035 14.2324C10.3314 14.4603 10.6094 14.5742 10.9375 14.5742H23.1875C23.4974 14.5742 23.7663 14.4603 23.9941 14.2324C24.222 14.0046 24.3359 13.7357 24.3359 13.4258C24.3359 13.0977 24.222 12.8197 23.9941 12.5918C23.7663 12.3639 23.4974 12.25 23.1875 12.25ZM23.1875 19.25H10.9375C10.6094 19.25 10.3314 19.3639 10.1035 19.5918C9.87565 19.8197 9.76172 20.0977 9.76172 20.4258C9.76172 20.7357 9.87565 21.0046 10.1035 21.2324C10.3314 21.4603 10.6094 21.5742 10.9375 21.5742H23.1875C23.4974 21.5742 23.7663 21.4603 23.9941 21.2324C24.222 21.0046 24.3359 20.7357 24.3359 20.4258C24.3359 20.0977 24.222 19.8197 23.9941 19.5918C23.7663 19.3639 23.4974 19.25 23.1875 19.25ZM5.25 18.6758C5.72396 18.6758 6.13411 18.8444 6.48047 19.1816C6.82682 19.5189 7 19.9336 7 20.4258C7 20.8997 6.82682 21.3099 6.48047 21.6562C6.13411 22.0026 5.72396 22.1758 5.25 22.1758C4.75781 22.1758 4.3431 22.0026 4.00586 21.6562C3.66862 21.3099 3.5 20.8997 3.5 20.4258C3.5 19.9336 3.66862 19.5189 4.00586 19.1816C4.3431 18.8444 4.75781 18.6758 5.25 18.6758ZM5.25 15.1758C4.75781 15.1758 4.3431 15.0026 4.00586 14.6562C3.66862 14.3099 3.5 13.8997 3.5 13.4258C3.5 12.9336 3.66862 12.5189 4.00586 12.1816C4.3431 11.8444 4.75781 11.6758 5.25 11.6758C5.72396 11.6758 6.13411 11.8444 6.48047 12.1816C6.82682 12.5189 7 12.9336 7 13.4258C7 13.8997 6.82682 14.3099 6.48047 14.6562C6.13411 15.0026 5.72396 15.1758 5.25 15.1758ZM5.25 8.17578C4.75781 8.17578 4.3431 8.0026 4.00586 7.65625C3.66862 7.3099 3.5 6.89974 3.5 6.42578C3.5 5.93359 3.66862 5.51888 4.00586 5.18164C4.3431 4.8444 4.75781 4.67578 5.25 4.67578C5.72396 4.67578 6.13411 4.8444 6.48047 5.18164C6.82682 5.51888 7 5.93359 7 6.42578C7 6.89974 6.82682 7.3099 6.48047 7.65625C6.13411 8.0026 5.72396 8.17578 5.25 8.17578Z",fill:"currentColor"})});function Fw({data:s,handleData:h}){const y=[{title:"Stt",dataIndex:"stt",key:"stt",render:(x,w,E)=>E+1},...Qh,...wg,{title:"Tần suất",dataIndex:"frequency",key:"frequency",render:(x,w)=>Pe.jsx(zn,{mode:"multiple",options:D1,style:{width:"100%"},placeholder:"Chọn tần suất",onChange:E=>{h(z=>z.map(o=>(o.customer_id==w.customer_id&&(o.frequency=E.toString().replaceAll(",",";")),o)))},defaultValue:x?x.split(";"):[]})},{title:"Hành động",dataIndex:"",key:"action",render:(x,w)=>Pe.jsx("div",{className:"flex justify-center",onClick:()=>{h(E=>[...E.filter(z=>z.customer_id!=w.customer_id)])},children:Pe.jsx(vg,{})})}];return Pe.jsx("div",{className:"p-4",children:Pe.jsx(Zh,{columns:y,dataSource:s,pagination:!1})})}const Nw=k.createContext(null);function jw(s,h){const y=Array.isArray(s)?s[0]:s?s.x:0,x=Array.isArray(s)?s[1]:s?s.y:0,w=Array.isArray(h)?h[0]:h?h.x:0,E=Array.isArray(h)?h[1]:h?h.y:0;return y===w&&x===E}function Zn(s,h){if(s===h)return!0;if(!s||!h)return!1;if(Array.isArray(s)){if(!Array.isArray(h)||s.length!==h.length)return!1;for(let y=0;y<s.length;y++)if(!Zn(s[y],h[y]))return!1;return!0}else if(Array.isArray(h))return!1;if(typeof s=="object"&&typeof h=="object"){const y=Object.keys(s),x=Object.keys(h);if(y.length!==x.length)return!1;for(const w of y)if(!h.hasOwnProperty(w)||!Zn(s[w],h[w]))return!1;return!0}return!1}function Vw(s){const h=s.clone();return h.pixelsToGLUnits=s.pixelsToGLUnits,h}function em(s,h){if(!s.getProjection)return;const y=s.getProjection(),x=h.getProjection();Zn(y,x)||h.setProjection(y)}function tm(s){return{longitude:s.center.lng,latitude:s.center.lat,zoom:s.zoom,pitch:s.pitch,bearing:s.bearing,padding:s.padding}}function im(s,h){const y=h.viewState||h;let x=!1;if("longitude"in y&&"latitude"in y){const w=s.center;s.center=new w.constructor(y.longitude,y.latitude),x=x||w!==s.center}if("zoom"in y){const w=s.zoom;s.zoom=y.zoom,x=x||w!==s.zoom}if("bearing"in y){const w=s.bearing;s.bearing=y.bearing,x=x||w!==s.bearing}if("pitch"in y){const w=s.pitch;s.pitch=y.pitch,x=x||w!==s.pitch}return y.padding&&!s.isPaddingEqual(y.padding)&&(x=!0,s.padding=y.padding),x}const Uw=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function rm(s){if(!s)return null;if(typeof s=="string"||("toJS"in s&&(s=s.toJS()),!s.layers))return s;const h={};for(const x of s.layers)h[x.id]=x;const y=s.layers.map(x=>{let w=null;"interactive"in x&&(w=Object.assign({},x),delete w.interactive);const E=h[x.ref];if(E){w=w||Object.assign({},x),delete w.ref;for(const z of Uw)z in E&&(w[z]=E[z])}return w||x});return{...s,layers:y}}var nm={};const am={version:8,sources:{},layers:[]},om={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},Mh={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},sm={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},qw=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],Gw=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class Qo{constructor(h,y,x){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=w=>{const E=this.props[sm[w.type]];E?E(w):w.type==="error"&&console.error(w.error)},this._onPointerEvent=w=>{(w.type==="mousemove"||w.type==="mouseout")&&this._updateHover(w);const E=this.props[om[w.type]];E&&(this.props.interactiveLayerIds&&w.type!=="mouseover"&&w.type!=="mouseout"&&(w.features=this._hoveredFeatures||this._queryRenderedFeatures(w.point)),E(w),delete w.features)},this._onCameraEvent=w=>{if(!this._internalUpdate){const E=this.props[Mh[w.type]];E&&E(w)}w.type in this._deferredEvents&&(this._deferredEvents[w.type]=!1)},this._MapClass=h,this.props=y,this._initialize(x)}get map(){return this._map}get transform(){return this._renderTransform}setProps(h){const y=this.props;this.props=h;const x=this._updateSettings(h,y);x&&this._createShadowTransform(this._map);const w=this._updateSize(h),E=this._updateViewState(h,!0);this._updateStyle(h,y),this._updateStyleComponents(h,y),this._updateHandlers(h,y),(x||w||E&&!this._map.isMoving())&&this.redraw()}static reuse(h,y){const x=Qo.savedMaps.pop();if(!x)return null;const w=x.map,E=w.getContainer();for(y.className=E.className;E.childNodes.length>0;)y.appendChild(E.childNodes[0]);w._container=y;const z=w._resizeObserver;z&&(z.disconnect(),z.observe(y)),x.setProps({...h,styleDiffing:!1}),w.resize();const{initialViewState:o}=h;return o&&(o.bounds?w.fitBounds(o.bounds,{...o.fitBoundsOptions,duration:0}):x._updateViewState(o,!1)),w.isStyleLoaded()?w.fire("load"):w.once("styledata",()=>w.fire("load")),w._update(),x}_initialize(h){const{props:y}=this,{mapStyle:x=am}=y,w={...y,...y.initialViewState,accessToken:y.mapboxAccessToken||Zw()||null,container:h,style:rm(x)},E=w.initialViewState||w.viewState||w;if(Object.assign(w,{center:[E.longitude||0,E.latitude||0],zoom:E.zoom||0,pitch:E.pitch||0,bearing:E.bearing||0}),y.gl){const V=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=V,y.gl)}const z=new this._MapClass(w);E.padding&&z.setPadding(E.padding),y.cursor&&(z.getCanvas().style.cursor=y.cursor),this._createShadowTransform(z);const o=z._render;z._render=V=>{this._inRender=!0,o.call(z,V),this._inRender=!1};const O=z._renderTaskQueue.run;z._renderTaskQueue.run=V=>{O.call(z._renderTaskQueue,V),this._onBeforeRepaint()},z.on("render",()=>this._onAfterRepaint());const L=z.fire;z.fire=this._fireEvent.bind(this,L),z.on("resize",()=>{this._renderTransform.resize(z.transform.width,z.transform.height)}),z.on("styledata",()=>{this._updateStyleComponents(this.props,{}),em(z.transform,this._renderTransform)}),z.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const V in om)z.on(V,this._onPointerEvent);for(const V in Mh)z.on(V,this._onCameraEvent);for(const V in sm)z.on(V,this._onEvent);this._map=z}recycle(){const y=this.map.getContainer().querySelector("[mapboxgl-children]");y?.remove(),Qo.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const h=this._map;!this._inRender&&h.style&&(h._frame&&(h._frame.cancel(),h._frame=null),h._render())}_createShadowTransform(h){const y=Vw(h.transform);h.painter.transform=y,this._renderTransform=y}_updateSize(h){const{viewState:y}=h;if(y){const x=this._map;if(y.width!==x.transform.width||y.height!==x.transform.height)return x.resize(),!0}return!1}_updateViewState(h,y){if(this._internalUpdate)return!1;const x=this._map,w=this._renderTransform,{zoom:E,pitch:z,bearing:o}=w,O=x.isMoving();O&&(w.cameraElevationReference="sea");const L=im(w,{...tm(x.transform),...h});if(O&&(w.cameraElevationReference="ground"),L&&y){const V=this._deferredEvents;V.move=!0,V.zoom||(V.zoom=E!==w.zoom),V.rotate||(V.rotate=o!==w.bearing),V.pitch||(V.pitch=z!==w.pitch)}return O||im(x.transform,h),L}_updateSettings(h,y){const x=this._map;let w=!1;for(const E of qw)if(E in h&&!Zn(h[E],y[E])){w=!0;const z=x[`set${E[0].toUpperCase()}${E.slice(1)}`];z?.call(x,h[E])}return w}_updateStyle(h,y){if(h.cursor!==y.cursor&&(this._map.getCanvas().style.cursor=h.cursor||""),h.mapStyle!==y.mapStyle){const{mapStyle:x=am,styleDiffing:w=!0}=h,E={diff:w};return"localIdeographFontFamily"in h&&(E.localIdeographFontFamily=h.localIdeographFontFamily),this._map.setStyle(rm(x),E),!0}return!1}_updateStyleComponents(h,y){const x=this._map;let w=!1;return x.isStyleLoaded()&&("light"in h&&x.setLight&&!Zn(h.light,y.light)&&(w=!0,x.setLight(h.light)),"fog"in h&&x.setFog&&!Zn(h.fog,y.fog)&&(w=!0,x.setFog(h.fog)),"terrain"in h&&x.setTerrain&&!Zn(h.terrain,y.terrain)&&(!h.terrain||x.getSource(h.terrain.source))&&(w=!0,x.setTerrain(h.terrain))),w}_updateHandlers(h,y){var x,w;const E=this._map;let z=!1;for(const o of Gw){const O=(x=h[o])!==null&&x!==void 0?x:!0,L=(w=y[o])!==null&&w!==void 0?w:!0;Zn(O,L)||(z=!0,O?E[o].enable(O):E[o].disable())}return z}_queryRenderedFeatures(h){const y=this._map,x=y.transform,{interactiveLayerIds:w=[]}=this.props;try{return y.transform=this._renderTransform,y.queryRenderedFeatures(h,{layers:w.filter(y.getLayer.bind(y))})}catch{return[]}finally{y.transform=x}}_updateHover(h){var y;const{props:x}=this;if(x.interactiveLayerIds&&(x.onMouseMove||x.onMouseEnter||x.onMouseLeave)){const E=h.type,z=((y=this._hoveredFeatures)===null||y===void 0?void 0:y.length)>0,o=this._queryRenderedFeatures(h.point),O=o.length>0;!O&&z&&(h.type="mouseleave",this._onPointerEvent(h)),this._hoveredFeatures=o,O&&!z&&(h.type="mouseenter",this._onPointerEvent(h)),h.type=E}else this._hoveredFeatures=null}_fireEvent(h,y,x){const w=this._map,E=w.transform,z=typeof y=="string"?y:y.type;return z==="move"&&this._updateViewState(this.props,!1),z in Mh&&(typeof y=="object"&&(y.viewState=tm(E)),this._map.isMoving())?(w.transform=this._renderTransform,h.call(w,y,x),w.transform=E,w):(h.call(w,y,x),w)}_onBeforeRepaint(){const h=this._map;this._internalUpdate=!0;for(const x in this._deferredEvents)this._deferredEvents[x]&&h.fire(x);this._internalUpdate=!1;const y=this._map.transform;h.transform=this._renderTransform,this._onAfterRepaint=()=>{em(this._renderTransform,y),h.transform=y}}}Qo.savedMaps=[];function Zw(){let s=null;if(typeof location<"u"){const h=/access_token=([^&\/]*)/.exec(location.search);s=h&&h[1]}try{s=s||nm.MapboxAccessToken}catch{}try{s=s||nm.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return s}const Hw=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function Ww(s){if(!s)return null;const h=s.map,y={getMap:()=>h,getCenter:()=>s.transform.center,getZoom:()=>s.transform.zoom,getBearing:()=>s.transform.bearing,getPitch:()=>s.transform.pitch,getPadding:()=>s.transform.padding,getBounds:()=>s.transform.getBounds(),project:x=>{const w=h.transform;h.transform=s.transform;const E=h.project(x);return h.transform=w,E},unproject:x=>{const w=h.transform;h.transform=s.transform;const E=h.unproject(x);return h.transform=w,E},queryTerrainElevation:(x,w)=>{const E=h.transform;h.transform=s.transform;const z=h.queryTerrainElevation(x,w);return h.transform=E,z},queryRenderedFeatures:(x,w)=>{const E=h.transform;h.transform=s.transform;const z=h.queryRenderedFeatures(x,w);return h.transform=E,z}};for(const x of Xw(h))!(x in y)&&!Hw.includes(x)&&(y[x]=h[x].bind(h));return y}function Xw(s){const h=new Set;let y=s;for(;y;){for(const x of Object.getOwnPropertyNames(y))x[0]!=="_"&&typeof s[x]=="function"&&x!=="fire"&&x!=="setEventedParent"&&h.add(x);y=Object.getPrototypeOf(y)}return Array.from(h)}const Kw=typeof document<"u"?k.useLayoutEffect:k.useEffect,Yw=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function Jw(s,h){for(const x of Yw)x in h&&(s[x]=h[x]);const{RTLTextPlugin:y="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=h;y&&s.getRTLTextPluginStatus&&s.getRTLTextPluginStatus()==="unavailable"&&s.setRTLTextPlugin(y,x=>{x&&console.error(x)},!0)}const vl=k.createContext(null);function Qw(s,h,y){const x=k.useContext(Nw),[w,E]=k.useState(null),z=k.useRef(),{current:o}=k.useRef({mapLib:null,map:null});k.useEffect(()=>{const V=s.mapLib;let q=!0,Q;return Promise.resolve(V||y).then(ae=>{if(!q)return;if(!ae)throw new Error("Invalid mapLib");const fe="Map"in ae?ae:ae.default;if(!fe.Map)throw new Error("Invalid mapLib");if(Jw(fe,s),!fe.supported||fe.supported(s))s.reuseMaps&&(Q=Qo.reuse(s,z.current)),Q||(Q=new Qo(fe.Map,s,z.current)),o.map=Ww(Q),o.mapLib=fe,E(Q),x?.onMapMount(o.map,s.id);else throw new Error("Map is not supported by this browser")}).catch(ae=>{const{onError:fe}=s;fe?fe({type:"error",target:null,originalEvent:null,error:ae}):console.error(ae)}),()=>{q=!1,Q&&(x?.onMapUnmount(s.id),s.reuseMaps?Q.recycle():Q.destroy())}},[]),Kw(()=>{w&&w.setProps(s)}),k.useImperativeHandle(h,()=>o.map,[w]);const O=k.useMemo(()=>({position:"relative",width:"100%",height:"100%",...s.style}),[s.style]),L={height:"100%"};return k.createElement("div",{id:s.id,ref:z,style:O},w&&k.createElement(vl.Provider,{value:o},k.createElement("div",{"mapboxgl-children":"",style:L},s.children)))}const e2=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function lo(s,h){if(!s||!h)return;const y=s.style;for(const x in h){const w=h[x];Number.isFinite(w)&&!e2.test(x)?y[x]=`${w}px`:y[x]=w}}function t2(s,h){const{map:y,mapLib:x}=k.useContext(vl),w=k.useRef({props:s});w.current.props=s;const E=k.useMemo(()=>{let me=!1;k.Children.forEach(s.children,be=>{be&&(me=!0)});const xe={...s,element:me?document.createElement("div"):null},ve=new x.Marker(xe);return ve.setLngLat([s.longitude,s.latitude]),ve.getElement().addEventListener("click",be=>{var ge,ce;(ce=(ge=w.current.props).onClick)===null||ce===void 0||ce.call(ge,{type:"click",target:ve,originalEvent:be})}),ve.on("dragstart",be=>{var ge,ce;const Se=be;Se.lngLat=E.getLngLat(),(ce=(ge=w.current.props).onDragStart)===null||ce===void 0||ce.call(ge,Se)}),ve.on("drag",be=>{var ge,ce;const Se=be;Se.lngLat=E.getLngLat(),(ce=(ge=w.current.props).onDrag)===null||ce===void 0||ce.call(ge,Se)}),ve.on("dragend",be=>{var ge,ce;const Se=be;Se.lngLat=E.getLngLat(),(ce=(ge=w.current.props).onDragEnd)===null||ce===void 0||ce.call(ge,Se)}),ve},[]);k.useEffect(()=>(E.addTo(y.getMap()),()=>{E.remove()}),[]);const{longitude:z,latitude:o,offset:O,style:L,draggable:V=!1,popup:q=null,rotation:Q=0,rotationAlignment:ae="auto",pitchAlignment:fe="auto"}=s;return k.useEffect(()=>{lo(E.getElement(),L)},[L]),k.useImperativeHandle(h,()=>E,[]),(E.getLngLat().lng!==z||E.getLngLat().lat!==o)&&E.setLngLat([z,o]),O&&!jw(E.getOffset(),O)&&E.setOffset(O),E.isDraggable()!==V&&E.setDraggable(V),E.getRotation()!==Q&&E.setRotation(Q),E.getRotationAlignment()!==ae&&E.setRotationAlignment(ae),E.getPitchAlignment()!==fe&&E.setPitchAlignment(fe),E.getPopup()!==q&&E.setPopup(q),hl.createPortal(s.children,E.getElement())}k.memo(k.forwardRef(t2));function lm(s){return new Set(s?s.trim().split(/\s+/):[])}function i2(s,h){const{map:y,mapLib:x}=k.useContext(vl),w=k.useMemo(()=>document.createElement("div"),[]),E=k.useRef({props:s});E.current.props=s;const z=k.useMemo(()=>{const o={...s},O=new x.Popup(o);return O.setLngLat([s.longitude,s.latitude]),O.once("open",L=>{var V,q;(q=(V=E.current.props).onOpen)===null||q===void 0||q.call(V,L)}),O},[]);if(k.useEffect(()=>{const o=O=>{var L,V;(V=(L=E.current.props).onClose)===null||V===void 0||V.call(L,O)};return z.on("close",o),z.setDOMContent(w).addTo(y.getMap()),()=>{z.off("close",o),z.isOpen()&&z.remove()}},[]),k.useEffect(()=>{lo(z.getElement(),s.style)},[s.style]),k.useImperativeHandle(h,()=>z,[]),z.isOpen()&&((z.getLngLat().lng!==s.longitude||z.getLngLat().lat!==s.latitude)&&z.setLngLat([s.longitude,s.latitude]),s.offset&&!Zn(z.options.offset,s.offset)&&z.setOffset(s.offset),(z.options.anchor!==s.anchor||z.options.maxWidth!==s.maxWidth)&&(z.options.anchor=s.anchor,z.setMaxWidth(s.maxWidth)),z.options.className!==s.className)){const o=lm(z.options.className),O=lm(s.className);for(const L of o)O.has(L)||z.removeClassName(L);for(const L of O)o.has(L)||z.addClassName(L);z.options.className=s.className}return hl.createPortal(s.children,w)}k.memo(k.forwardRef(i2));function xl(s,h,y,x){const w=k.useContext(vl),E=k.useMemo(()=>s(w),[]);return k.useEffect(()=>{const z=x||y||h,o=typeof h=="function"&&typeof y=="function"?h:null,O=typeof y=="function"?y:typeof h=="function"?h:null,{map:L}=w;return L.hasControl(E)||(L.addControl(E,z?.position),o&&o(w)),()=>{O&&O(w),L.hasControl(E)&&L.removeControl(E)}},[]),E}function r2(s){const h=xl(({mapLib:y})=>new y.AttributionControl(s),{position:s.position});return k.useEffect(()=>{lo(h._container,s.style)},[s.style]),null}k.memo(r2);function n2(s){const h=xl(({mapLib:y})=>new y.FullscreenControl({container:s.containerId&&document.getElementById(s.containerId)}),{position:s.position});return k.useEffect(()=>{lo(h._controlContainer,s.style)},[s.style]),null}k.memo(n2);function a2(s,h){const y=k.useRef({props:s}),x=xl(({mapLib:w})=>{const E=new w.GeolocateControl(s),z=E._setupUI;return E._setupUI=o=>{E._container.hasChildNodes()||z(o)},E.on("geolocate",o=>{var O,L;(L=(O=y.current.props).onGeolocate)===null||L===void 0||L.call(O,o)}),E.on("error",o=>{var O,L;(L=(O=y.current.props).onError)===null||L===void 0||L.call(O,o)}),E.on("outofmaxbounds",o=>{var O,L;(L=(O=y.current.props).onOutOfMaxBounds)===null||L===void 0||L.call(O,o)}),E.on("trackuserlocationstart",o=>{var O,L;(L=(O=y.current.props).onTrackUserLocationStart)===null||L===void 0||L.call(O,o)}),E.on("trackuserlocationend",o=>{var O,L;(L=(O=y.current.props).onTrackUserLocationEnd)===null||L===void 0||L.call(O,o)}),E},{position:s.position});return y.current.props=s,k.useImperativeHandle(h,()=>x,[]),k.useEffect(()=>{lo(x._container,s.style)},[s.style]),null}k.memo(k.forwardRef(a2));function o2(s){const h=xl(({mapLib:y})=>new y.NavigationControl(s),{position:s.position});return k.useEffect(()=>{lo(h._container,s.style)},[s.style]),null}k.memo(o2);function s2(s){const h=xl(({mapLib:E})=>new E.ScaleControl(s),{position:s.position}),y=k.useRef(s),x=y.current;y.current=s;const{style:w}=s;return s.maxWidth!==void 0&&s.maxWidth!==x.maxWidth&&(h.options.maxWidth=s.maxWidth),s.unit!==void 0&&s.unit!==x.unit&&h.setUnit(s.unit),k.useEffect(()=>{lo(h._container,w)},[w]),null}k.memo(s2);function cm(s,h){if(!s)throw new Error(h)}let l2=0;function c2(s,h,y){if(s.style&&s.style._loaded){const x={...y};return delete x.id,delete x.children,s.addSource(h,x),s.getSource(h)}return null}function u2(s,h,y){cm(h.id===y.id,"source id changed"),cm(h.type===y.type,"source type changed");let x="",w=0;for(const z in h)z!=="children"&&z!=="id"&&!Zn(y[z],h[z])&&(x=z,w++);if(!w)return;const E=h.type;if(E==="geojson")s.setData(h.data);else if(E==="image")s.updateImage({url:h.url,coordinates:h.coordinates});else if("setCoordinates"in s&&w===1&&x==="coordinates")s.setCoordinates(h.coordinates);else if("setUrl"in s)switch(x){case"url":s.setUrl(h.url);break;case"tiles":s.setTiles(h.tiles);break}else console.warn(`Unable to update <Source> prop: ${x}`)}function h2(s){const h=k.useContext(vl).map.getMap(),y=k.useRef(s),[,x]=k.useState(0),w=k.useMemo(()=>s.id||`jsx-source-${l2++}`,[]);k.useEffect(()=>{if(h){const z=()=>setTimeout(()=>x(o=>o+1),0);return h.on("styledata",z),z(),()=>{var o;if(h.off("styledata",z),h.style&&h.style._loaded&&h.getSource(w)){const O=(o=h.getStyle())===null||o===void 0?void 0:o.layers;if(O)for(const L of O)L.source===w&&h.removeLayer(L.id);h.removeSource(w)}}}},[h]);let E=h&&h.style&&h.getSource(w);return E?u2(E,s,y.current):E=c2(h,w,s),y.current=s,E&&k.Children.map(s.children,z=>z&&k.cloneElement(z,{source:w}))||null}const d2=hv(()=>import("./mapbox-gl-KgDI0fj8.js").then(s=>s.m),__vite__mapDeps([0,1,2])),p2=k.forwardRef(function(h,y){return Qw(h,y,d2)}),f2=h2;var Fg={exports:{}};(function(s,h){(function(y,x){s.exports=x()})(dv,function(){var y,x,w;function E(o,O){if(!y)y=O;else if(!x)x=O;else{var L="var sharedChunk = {}; ("+y+")(sharedChunk); ("+x+")(sharedChunk);",V={};y(V),w=O(V),typeof window<"u"&&(w.workerUrl=window.URL.createObjectURL(new Blob([L],{type:"text/javascript"})))}}E(["exports"],function(o){function O(i,e,r,a){return new(r||(r=Promise))(function(c,p){function m(C){try{b(a.next(C))}catch(I){p(I)}}function g(C){try{b(a.throw(C))}catch(I){p(I)}}function b(C){var I;C.done?c(C.value):(I=C.value,I instanceof r?I:new r(function(A){A(I)})).then(m,g)}b((a=a.apply(i,e||[])).next())})}function L(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}typeof SuppressedError=="function"&&SuppressedError;var V=q;function q(i,e){this.x=i,this.y=e}q.prototype={clone:function(){return new q(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,r=i.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),r=Math.sin(i),a=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=a,this},_rotateAround:function(i,e){var r=Math.cos(i),a=Math.sin(i),c=e.y+a*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-a*(this.y-e.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},q.convert=function(i){return i instanceof q?i:Array.isArray(i)?new q(i[0],i[1]):i};var Q=L(V),ae=fe;function fe(i,e,r,a){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(a-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=r,this.p2y=a}fe.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,a=0;a<8;a++){var c=this.sampleCurveX(r)-i;if(Math.abs(c)<e)return r;var p=this.sampleCurveDerivativeX(r);if(Math.abs(p)<1e-6)break;r-=c/p}var m=0,g=1;for(r=i,a=0;a<20&&(c=this.sampleCurveX(r),!(Math.abs(c-i)<e));a++)i>c?m=r:g=r,r=.5*(g-m)+m;return r},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};var me=L(ae);let xe,ve;function be(){return xe==null&&(xe=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),xe}function ge(){if(ve==null&&(ve=!1,be())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let a=0;a<5*5;a++){const c=4*a;e.fillStyle=`rgb(${c},${c+1},${c+2})`,e.fillRect(a%5,Math.floor(a/5),1,1)}const r=e.getImageData(0,0,5,5).data;for(let a=0;a<5*5*4;a++)if(a%4!=3&&r[a]!==a){ve=!0;break}}}return ve||!1}function ce(i,e,r,a){const c=new me(i,e,r,a);return function(p){return c.solve(p)}}const Se=ce(.25,.1,.25,1);function ze(i,e,r){return Math.min(r,Math.max(e,i))}function Be(i,e,r){const a=r-e,c=((i-e)%a+a)%a+e;return c===e?r:c}function $e(i,...e){for(const r of e)for(const a in r)i[a]=r[a];return i}let De=1;function Ce(i,e,r){const a={};for(const c in i)a[c]=e.call(r||this,i[c],c,i);return a}function je(i,e,r){const a={};for(const c in i)e.call(r||this,i[c],c,i)&&(a[c]=i[c]);return a}function Ge(i){return Array.isArray(i)?i.map(Ge):typeof i=="object"&&i?Ce(i,Ge):i}const tt={};function He(i){tt[i]||(typeof console<"u"&&console.warn(i),tt[i]=!0)}function ot(i,e,r){return(r.y-i.y)*(e.x-i.x)>(e.y-i.y)*(r.x-i.x)}function Tt(i){let e=0;for(let r,a,c=0,p=i.length,m=p-1;c<p;m=c++)r=i[c],a=i[m],e+=(a.x-r.x)*(r.y+a.y);return e}function st(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let jt=null;function At(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const Qt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Gt(i,e,r,a,c){return O(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const p=new VideoFrame(i,{timestamp:0});try{const m=p?.format;if(!m||!m.startsWith("BGR")&&!m.startsWith("RGB"))throw new Error(`Unrecognized format ${m}`);const g=m.startsWith("BGR"),b=new Uint8ClampedArray(a*c*4);if(yield p.copyTo(b,function(C,I,A,R,F){const N=4*Math.max(-I,0),G=(Math.max(0,A)-A)*R*4+N,Y=4*R,ie=Math.max(0,I),ue=Math.max(0,A);return{rect:{x:ie,y:ue,width:Math.min(C.width,I+R)-ie,height:Math.min(C.height,A+F)-ue},layout:[{offset:G,stride:Y}]}}(i,e,r,a,c)),g)for(let C=0;C<b.length;C+=4){const I=b[C];b[C]=b[C+2],b[C+2]=I}return b}finally{p.close()}})}let ft,Oe,gt,Bt;const wt={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(i){const e=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(i,e=0){return this.getImageCanvasContext(i).getImageData(-e,-e,i.width+2*e,i.height+2*e)},getImageCanvasContext(i){const e=window.document.createElement("canvas"),r=e.getContext("2d",{willReadFrequently:!0});if(!r)throw new Error("failed to create canvas 2d context");return e.width=i.width,e.height=i.height,r.drawImage(i,0,0,i.width,i.height),r},resolveURL:i=>(gt||(gt=document.createElement("a")),gt.href=i,gt.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Bt==null&&(Bt=matchMedia("(prefers-reduced-motion: reduce)")),Bt.matches)}},$t={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class Yt extends Error{constructor(e,r,a,c){super(`AJAXError: ${r} (${e}): ${a}`),this.status=e,this.statusText=r,this.url=a,this.body=c}}const ei=st()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,kt=i=>$t.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))];function gi(i,e){const r=new AbortController,a=new Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,cache:i.cache,referrer:ei(),signal:r.signal});let c=!1,p=!1;return i.type==="json"&&a.headers.set("Accept","application/json"),p||fetch(a).then(m=>m.ok?(g=>{(i.type==="arrayBuffer"||i.type==="image"?g.arrayBuffer():i.type==="json"?g.json():g.text()).then(b=>{p||(c=!0,e(null,b,g.headers.get("Cache-Control"),g.headers.get("Expires")))}).catch(b=>{p||e(new Error(b.message))})})(m):m.blob().then(g=>e(new Yt(m.status,m.statusText,i.url,g)))).catch(m=>{m.code!==20&&e(new Error(m.message))}),{cancel:()=>{p=!0,c||r.abort()}}}const pi=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){if(st()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e);if(!st())return(kt(i.url)||gi)(i,e)}if(!(/^file:/.test(r=i.url)||/^file:/.test(ei())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return gi(i,e);if(st()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var r;return function(a,c){const p=new XMLHttpRequest;p.open(a.method||"GET",a.url,!0),a.type!=="arrayBuffer"&&a.type!=="image"||(p.responseType="arraybuffer");for(const m in a.headers)p.setRequestHeader(m,a.headers[m]);return a.type==="json"&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials=a.credentials==="include",p.onerror=()=>{c(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||p.status===0)&&p.response!==null){let m=p.response;if(a.type==="json")try{m=JSON.parse(p.response)}catch(g){return c(g)}c(null,m,p.getResponseHeader("Cache-Control"),p.getResponseHeader("Expires"))}else{const m=new Blob([p.response],{type:p.getResponseHeader("Content-Type")});c(new Yt(p.status,p.statusText,a.url,m))}},p.send(a.body),{cancel:()=>p.abort()}}(i,e)},Pt=function(i,e){return pi($e(i,{type:"arrayBuffer"}),e)};function li(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const e=new URL(i),r=window.location;return e.protocol===r.protocol&&e.host===r.host}function Xi(i,e,r){r[i]&&r[i].indexOf(e)!==-1||(r[i]=r[i]||[],r[i].push(e))}function Ht(i,e,r){if(r&&r[i]){const a=r[i].indexOf(e);a!==-1&&r[i].splice(a,1)}}class Mi{constructor(e,r={}){$e(this,r),this.type=e}}class Fi extends Mi{constructor(e,r={}){super("error",$e({error:e},r))}}class gr{on(e,r){return this._listeners=this._listeners||{},Xi(e,r,this._listeners),this}off(e,r){return Ht(e,r,this._listeners),Ht(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Xi(e,r,this._oneTimeListeners),this):new Promise(a=>this.once(e,a))}fire(e,r){typeof e=="string"&&(e=new Mi(e,r||{}));const a=e.type;if(this.listens(a)){e.target=this;const c=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const g of c)g.call(this,e);const p=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const g of p)Ht(a,g,this._oneTimeListeners),g.call(this,e);const m=this._eventedParent;m&&($e(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),m.fire(e))}else e instanceof Fi&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var Te={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const bi=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Li(i,e){const r={};for(const a in i)a!=="ref"&&(r[a]=i[a]);return bi.forEach(a=>{a in e&&(r[a]=e[a])}),r}function Wt(i,e){if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let r=0;r<i.length;r++)if(!Wt(i[r],e[r]))return!1;return!0}if(typeof i=="object"&&i!==null&&e!==null){if(typeof e!="object"||Object.keys(i).length!==Object.keys(e).length)return!1;for(const r in i)if(!Wt(i[r],e[r]))return!1;return!0}return i===e}const Ft={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Gi(i,e,r){r.push({command:Ft.addSource,args:[i,e[i]]})}function Ki(i,e,r){e.push({command:Ft.removeSource,args:[i]}),r[i]=!0}function yi(i,e,r,a){Ki(i,r,a),Gi(i,e,r)}function cn(i,e,r){let a;for(a in i[r])if(Object.prototype.hasOwnProperty.call(i[r],a)&&a!=="data"&&!Wt(i[r][a],e[r][a]))return!1;for(a in e[r])if(Object.prototype.hasOwnProperty.call(e[r],a)&&a!=="data"&&!Wt(i[r][a],e[r][a]))return!1;return!0}function or(i,e,r,a,c,p){let m;for(m in e=e||{},i=i||{})Object.prototype.hasOwnProperty.call(i,m)&&(Wt(i[m],e[m])||r.push({command:p,args:[a,m,e[m],c]}));for(m in e)Object.prototype.hasOwnProperty.call(e,m)&&!Object.prototype.hasOwnProperty.call(i,m)&&(Wt(i[m],e[m])||r.push({command:p,args:[a,m,e[m],c]}))}function ar(i){return i.id}function qr(i,e){return i[e.id]=e,i}class Ve{constructor(e,r,a,c){this.message=(e?`${e}: `:"")+a,c&&(this.identifier=c),r!=null&&r.__line__&&(this.line=r.__line__)}}function Et(i,...e){for(const r of e)for(const a in r)i[a]=r[a];return i}class St extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class Jt{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[a,c]of r)this.bindings[a]=c}concat(e){return new Jt(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const zt={kind:"null"},Le={kind:"number"},mt={kind:"string"},vt={kind:"boolean"},wi={kind:"color"},Zi={kind:"object"},Mt={kind:"value"},Gr={kind:"collator"},W={kind:"formatted"},D={kind:"padding"},$={kind:"resolvedImage"},j={kind:"variableAnchorOffsetCollection"};function K(i,e){return{kind:"array",itemType:i,N:e}}function J(i){if(i.kind==="array"){const e=J(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const he=[zt,Le,mt,vt,wi,W,Zi,K(Mt),D,$,j];function ne(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ne(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const r of he)if(!ne(r,e))return null}}return`Expected ${J(i)} but found ${J(e)} instead.`}function te(i,e){return e.some(r=>r.kind===i.kind)}function se(i,e){return e.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}function Ee(i,e){return i.kind==="array"&&e.kind==="array"?i.itemType.kind===e.itemType.kind&&typeof i.N=="number":i.kind===e.kind}const Ie=.96422,Ae=.82521,dt=4/29,Ct=6/29,at=3*Ct*Ct,Ke=Ct*Ct*Ct,Ye=Math.PI/180,It=180/Math.PI;function Ot(i){return(i%=360)<0&&(i+=360),i}function Rt([i,e,r,a]){let c,p;const m=Ni((.2225045*(i=Lt(i))+.7168786*(e=Lt(e))+.0606169*(r=Lt(r)))/1);i===e&&e===r?c=p=m:(c=Ni((.4360747*i+.3850649*e+.1430804*r)/Ie),p=Ni((.0139322*i+.0971045*e+.7141733*r)/Ae));const g=116*m-16;return[g<0?0:g,500*(c-m),200*(m-p),a]}function Lt(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Ni(i){return i>Ke?Math.pow(i,1/3):i/at+dt}function ci([i,e,r,a]){let c=(i+16)/116,p=isNaN(e)?c:c+e/500,m=isNaN(r)?c:c-r/200;return c=1*Ri(c),p=Ie*Ri(p),m=Ae*Ri(m),[Di(3.1338561*p-1.6168667*c-.4906146*m),Di(-.9787684*p+1.9161415*c+.033454*m),Di(.0719453*p-.2289914*c+1.4052427*m),a]}function Di(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function Ri(i){return i>Ct?i*i*i:at*(i-dt)}function Cr(i){return parseInt(i.padEnd(2,i),16)/255}function co(i,e){return Rn(e?i/100:i,0,1)}function Rn(i,e,r){return Math.min(Math.max(e,i),r)}function $n(i){return!i.some(Number.isNaN)}const Yc={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class ui{constructor(e,r,a,c=1,p=!0){this.r=e,this.g=r,this.b=a,this.a=c,p||(this.r*=c,this.g*=c,this.b*=c,c||this.overwriteGetter("rgb",[e,r,a,c]))}static parse(e){if(e instanceof ui)return e;if(typeof e!="string")return;const r=function(a){if((a=a.toLowerCase().trim())==="transparent")return[0,0,0,0];const c=Yc[a];if(c){const[m,g,b]=c;return[m/255,g/255,b/255,1]}if(a.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(a)){const m=a.length<6?1:2;let g=1;return[Cr(a.slice(g,g+=m)),Cr(a.slice(g,g+=m)),Cr(a.slice(g,g+=m)),Cr(a.slice(g,g+m)||"ff")]}if(a.startsWith("rgb")){const m=a.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(m){const[g,b,C,I,A,R,F,N,G,Y,ie,ue]=m,re=[I||" ",F||" ",Y].join("");if(re==="  "||re==="  /"||re===",,"||re===",,,"){const de=[C,R,G].join(""),ye=de==="%%%"?100:de===""?255:0;if(ye){const ke=[Rn(+b/ye,0,1),Rn(+A/ye,0,1),Rn(+N/ye,0,1),ie?co(+ie,ue):1];if($n(ke))return ke}}return}}const p=a.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(p){const[m,g,b,C,I,A,R,F,N]=p,G=[b||" ",I||" ",R].join("");if(G==="  "||G==="  /"||G===",,"||G===",,,"){const Y=[+g,Rn(+C,0,100),Rn(+A,0,100),F?co(+F,N):1];if($n(Y))return function([ie,ue,re,de]){function ye(ke){const et=(ke+ie/30)%12,ct=ue*Math.min(re,1-re);return re-ct*Math.max(-1,Math.min(et-3,9-et,1))}return ie=Ot(ie),ue/=100,re/=100,[ye(0),ye(8),ye(4),de]}(Y)}}}(e);return r?new ui(...r,!1):void 0}get rgb(){const{r:e,g:r,b:a,a:c}=this,p=c||1/0;return this.overwriteGetter("rgb",[e/p,r/p,a/p,c])}get hcl(){return this.overwriteGetter("hcl",function(e){const[r,a,c,p]=Rt(e),m=Math.sqrt(a*a+c*c);return[Math.round(1e4*m)?Ot(Math.atan2(c,a)*It):NaN,m,r,p]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Rt(this.rgb))}overwriteGetter(e,r){return Object.defineProperty(this,e,{value:r}),r}toString(){const[e,r,a,c]=this.rgb;return`rgba(${[e,r,a].map(p=>Math.round(255*p)).join(",")},${c})`}}ui.black=new ui(0,0,0,1),ui.white=new ui(1,1,1,1),ui.transparent=new ui(0,0,0,0),ui.red=new ui(1,0,0,1);class is{constructor(e,r,a){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class uo{constructor(e,r,a,c,p){this.text=e,this.image=r,this.scale=a,this.fontStack=c,this.textColor=p}}class hr{constructor(e){this.sections=e}static fromString(e){return new hr([new uo(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof hr?e:hr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class Lr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Lr)return e;if(typeof e=="number")return new Lr([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const r of e)if(typeof r!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new Lr(e)}}toString(){return JSON.stringify(this.values)}}const Jc=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Zr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Zr)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let r=0;r<e.length;r+=2){const a=e[r],c=e[r+1];if(typeof a!="string"||!Jc.has(a)||!Array.isArray(c)||c.length!==2||typeof c[0]!="number"||typeof c[1]!="number")return}return new Zr(e)}}toString(){return JSON.stringify(this.values)}}class sr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new sr({name:e,available:!1}):null}}function ho(i,e,r,a){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[i,e,r,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[i,e,r,a]:[i,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function da(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof ui||i instanceof is||i instanceof hr||i instanceof Lr||i instanceof Zr||i instanceof sr)return!0;if(Array.isArray(i)){for(const e of i)if(!da(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!da(i[e]))return!1;return!0}return!1}function Ti(i){if(i===null)return zt;if(typeof i=="string")return mt;if(typeof i=="boolean")return vt;if(typeof i=="number")return Le;if(i instanceof ui)return wi;if(i instanceof is)return Gr;if(i instanceof hr)return W;if(i instanceof Lr)return D;if(i instanceof Zr)return j;if(i instanceof sr)return $;if(Array.isArray(i)){const e=i.length;let r;for(const a of i){const c=Ti(a);if(r){if(r===c)continue;r=Mt;break}r=c}return K(r||Mt,e)}return Zi}function ni(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof ui||i instanceof hr||i instanceof Lr||i instanceof Zr||i instanceof sr?i.toString():JSON.stringify(i)}class Xn{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!da(e[1]))return r.error("invalid value");const a=e[1];let c=Ti(a);const p=r.expectedType;return c.kind!=="array"||c.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(c=p),new Xn(c,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Ai{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const po={string:mt,number:Le,boolean:vt,object:Zi};class Hr{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let a,c=1;const p=e[0];if(p==="array"){let g,b;if(e.length>2){const C=e[1];if(typeof C!="string"||!(C in po)||C==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);g=po[C],c++}else g=Mt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);b=e[2],c++}a=K(g,b)}else{if(!po[p])throw new Error(`Types doesn't contain name = ${p}`);a=po[p]}const m=[];for(;c<e.length;c++){const g=r.parse(e[c],c,Mt);if(!g)return null;m.push(g)}return new Hr(a,m)}evaluate(e){for(let r=0;r<this.args.length;r++){const a=this.args[r].evaluate(e);if(!ne(this.type,Ti(a)))return a;if(r===this.args.length-1)throw new Ai(`Expected value to be of type ${J(this.type)}, but found ${J(Ti(a))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const rs={"to-boolean":vt,"to-color":wi,"to-number":Le,"to-string":mt};class On{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const a=e[0];if(!rs[a])throw new Error(`Can't parse ${a} as it is not part of the known types`);if((a==="to-boolean"||a==="to-string")&&e.length!==2)return r.error("Expected one argument.");const c=rs[a],p=[];for(let m=1;m<e.length;m++){const g=r.parse(e[m],m,Mt);if(!g)return null;p.push(g)}return new On(c,p)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let r,a;for(const c of this.args){if(r=c.evaluate(e),a=null,r instanceof ui)return r;if(typeof r=="string"){const p=e.parseColor(r);if(p)return p}else if(Array.isArray(r)&&(a=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:ho(r[0],r[1],r[2],r[3]),!a))return new ui(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Ai(a||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const a of this.args){r=a.evaluate(e);const c=Lr.parse(r);if(c)return c}throw new Ai(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const a of this.args){r=a.evaluate(e);const c=Zr.parse(r);if(c)return c}throw new Ai(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const a of this.args){if(r=a.evaluate(e),r===null)return 0;const c=Number(r);if(!isNaN(c))return c}throw new Ai(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return hr.fromString(ni(this.args[0].evaluate(e)));case"resolvedImage":return sr.fromString(ni(this.args[0].evaluate(e)));default:return ni(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const bl=["Unknown","Point","LineString","Polygon"];class ns{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?bl[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=ui.parse(e)),r}}class fo{constructor(e,r,a=[],c,p=new Jt,m=[]){this.registry=e,this.path=a,this.key=a.map(g=>`[${g}]`).join(""),this.scope=p,this.errors=m,this.expectedType=c,this._isConstant=r}parse(e,r,a,c,p={}){return r?this.concat(r,a,c)._parse(e,p):this._parse(e,p)}_parse(e,r){function a(c,p,m){return m==="assert"?new Hr(p,[c]):m==="coerce"?new On(p,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=e[0];if(typeof c!="string")return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const p=this.registry[c];if(p){let m=p.parse(e,this);if(!m)return null;if(this.expectedType){const g=this.expectedType,b=m.type;if(g.kind!=="string"&&g.kind!=="number"&&g.kind!=="boolean"&&g.kind!=="object"&&g.kind!=="array"||b.kind!=="value")if(g.kind!=="color"&&g.kind!=="formatted"&&g.kind!=="resolvedImage"||b.kind!=="value"&&b.kind!=="string")if(g.kind!=="padding"||b.kind!=="value"&&b.kind!=="number"&&b.kind!=="array")if(g.kind!=="variableAnchorOffsetCollection"||b.kind!=="value"&&b.kind!=="array"){if(this.checkSubtype(g,b))return null}else m=a(m,g,r.typeAnnotation||"coerce");else m=a(m,g,r.typeAnnotation||"coerce");else m=a(m,g,r.typeAnnotation||"coerce");else m=a(m,g,r.typeAnnotation||"assert")}if(!(m instanceof Xn)&&m.type.kind!=="resolvedImage"&&this._isConstant(m)){const g=new ns;try{m=new Xn(m.type,m.evaluate(g))}catch(b){return this.error(b.message),null}}return m}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,a){const c=typeof e=="number"?this.path.concat(e):this.path,p=a?this.scope.concat(a):this.scope;return new fo(this.registry,this._isConstant,c,r||null,p,this.errors)}error(e,...r){const a=`${this.key}${r.map(c=>`[${c}]`).join("")}`;this.errors.push(new St(a,e))}checkSubtype(e,r){const a=ne(e,r);return a&&this.error(a),a}}class mo{constructor(e,r,a){this.type=Gr,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const a=e[1];if(typeof a!="object"||Array.isArray(a))return r.error("Collator options argument must be an object.");const c=r.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,vt);if(!c)return null;const p=r.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,vt);if(!p)return null;let m=null;return a.locale&&(m=r.parse(a.locale,1,mt),!m)?null:new mo(c,p,m)}evaluate(e){return new is(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}const Bn=8192;function as(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function Ra(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function wl(i,e){const r=(180+i[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(r*c*Bn),Math.round(a*c*Bn)]}function Qc(i,e,r){const a=i[0]-e[0],c=i[1]-e[1],p=i[0]-r[0],m=i[1]-r[1];return a*m-p*c==0&&a*p<=0&&c*m<=0}function os(i,e){let r=!1;for(let m=0,g=e.length;m<g;m++){const b=e[m];for(let C=0,I=b.length;C<I-1;C++){if(Qc(i,b[C],b[C+1]))return!1;(c=b[C])[1]>(a=i)[1]!=(p=b[C+1])[1]>a[1]&&a[0]<(p[0]-c[0])*(a[1]-c[1])/(p[1]-c[1])+c[0]&&(r=!r)}}var a,c,p;return r}function ss(i,e){for(let r=0;r<e.length;r++)if(os(i,e[r]))return!0;return!1}function Sl(i,e,r,a){const c=a[0]-r[0],p=a[1]-r[1],m=(i[0]-r[0])*p-c*(i[1]-r[1]),g=(e[0]-r[0])*p-c*(e[1]-r[1]);return m>0&&g<0||m<0&&g>0}function eu(i,e,r){for(const C of r)for(let I=0;I<C.length-1;++I)if((g=[(m=C[I+1])[0]-(p=C[I])[0],m[1]-p[1]])[0]*(b=[(c=e)[0]-(a=i)[0],c[1]-a[1]])[1]-g[1]*b[0]!=0&&Sl(a,c,p,m)&&Sl(p,m,a,c))return!0;var a,c,p,m,g,b;return!1}function Cl(i,e){for(let r=0;r<i.length;++r)if(!os(i[r],e))return!1;for(let r=0;r<i.length-1;++r)if(eu(i[r],i[r+1],e))return!1;return!0}function Tl(i,e){for(let r=0;r<e.length;r++)if(Cl(i,e[r]))return!0;return!1}function go(i,e,r){const a=[];for(let c=0;c<i.length;c++){const p=[];for(let m=0;m<i[c].length;m++){const g=wl(i[c][m],r);as(e,g),p.push(g)}a.push(p)}return a}function El(i,e,r){const a=[];for(let c=0;c<i.length;c++){const p=go(i[c],e,r);a.push(p)}return a}function Il(i,e,r,a){if(i[0]<r[0]||i[0]>r[2]){const c=.5*a;let p=i[0]-r[0]>c?-a:r[0]-i[0]>c?a:0;p===0&&(p=i[0]-r[2]>c?-a:r[2]-i[0]>c?a:0),i[0]+=p}as(e,i)}function ls(i,e,r,a){const c=Math.pow(2,a.z)*Bn,p=[a.x*Bn,a.y*Bn],m=[];for(const g of i)for(const b of g){const C=[b.x+p[0],b.y+p[1]];Il(C,e,r,c),m.push(C)}return m}function cs(i,e,r,a){const c=Math.pow(2,a.z)*Bn,p=[a.x*Bn,a.y*Bn],m=[];for(const b of i){const C=[];for(const I of b){const A=[I.x+p[0],I.y+p[1]];as(e,A),C.push(A)}m.push(C)}if(e[2]-e[0]<=c/2){(g=e)[0]=g[1]=1/0,g[2]=g[3]=-1/0;for(const b of m)for(const C of b)Il(C,e,r,c)}var g;return m}class Kn{constructor(e,r){this.type=vt,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(da(e[1])){const a=e[1];if(a.type==="FeatureCollection")for(let c=0;c<a.features.length;++c){const p=a.features[c].geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new Kn(a,a.features[c].geometry)}else if(a.type==="Feature"){const c=a.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new Kn(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new Kn(a,a)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,a){const c=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],m=r.canonicalID();if(a.type==="Polygon"){const g=go(a.coordinates,p,m),b=ls(r.geometry(),c,p,m);if(!Ra(c,p))return!1;for(const C of b)if(!os(C,g))return!1}if(a.type==="MultiPolygon"){const g=El(a.coordinates,p,m),b=ls(r.geometry(),c,p,m);if(!Ra(c,p))return!1;for(const C of b)if(!ss(C,g))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,a){const c=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],m=r.canonicalID();if(a.type==="Polygon"){const g=go(a.coordinates,p,m),b=cs(r.geometry(),c,p,m);if(!Ra(c,p))return!1;for(const C of b)if(!Cl(C,g))return!1}if(a.type==="MultiPolygon"){const g=El(a.coordinates,p,m),b=cs(r.geometry(),c,p,m);if(!Ra(c,p))return!1;for(const C of b)if(!Tl(C,g))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class yo{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const a=e[1];return r.scope.has(a)?new yo(a,r.scope.get(a)):r.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class Wr{constructor(e,r,a,c){this.name=e,this.type=r,this._evaluate=a,this.args=c}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,r){const a=e[0],c=Wr.definitions[a];if(!c)return r.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(c)?c[0]:c.type,m=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,g=m.filter(([C])=>!Array.isArray(C)||C.length===e.length-1);let b=null;for(const[C,I]of g){b=new fo(r.registry,_o,r.path,null,r.scope);const A=[];let R=!1;for(let F=1;F<e.length;F++){const N=e[F],G=Array.isArray(C)?C[F-1]:C.type,Y=b.parse(N,1+A.length,G);if(!Y){R=!0;break}A.push(Y)}if(!R)if(Array.isArray(C)&&C.length!==A.length)b.error(`Expected ${C.length} arguments, but found ${A.length} instead.`);else{for(let F=0;F<A.length;F++){const N=Array.isArray(C)?C[F]:C.type,G=A[F];b.concat(F+1).checkSubtype(N,G.type)}if(b.errors.length===0)return new Wr(a,p,I,A)}}if(g.length===1)r.errors.push(...b.errors);else{const C=(g.length?g:m).map(([A])=>{return R=A,Array.isArray(R)?`(${R.map(J).join(", ")})`:`(${J(R.type)}...)`;var R}).join(" | "),I=[];for(let A=1;A<e.length;A++){const R=r.parse(e[A],1+I.length);if(!R)return null;I.push(J(R.type))}r.error(`Expected arguments of type ${C}, but found (${I.join(", ")}) instead.`)}return null}static register(e,r){Wr.definitions=r;for(const a in r)e[a]=Wr}}function _o(i){if(i instanceof yo)return _o(i.boundExpression);if(i instanceof Wr&&i.name==="error"||i instanceof mo||i instanceof Kn)return!1;const e=i instanceof On||i instanceof Hr;let r=!0;return i.eachChild(a=>{r=e?r&&_o(a):r&&a instanceof Xn}),!!r&&vo(i)&&xo(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function vo(i){if(i instanceof Wr&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Kn)return!1;let e=!0;return i.eachChild(r=>{e&&!vo(r)&&(e=!1)}),e}function $a(i){if(i instanceof Wr&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(r=>{e&&!$a(r)&&(e=!1)}),e}function xo(i,e){if(i instanceof Wr&&e.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(a=>{r&&!xo(a,e)&&(r=!1)}),r}function pa(i,e){const r=i.length-1;let a,c,p=0,m=r,g=0;for(;p<=m;)if(g=Math.floor((p+m)/2),a=i[g],c=i[g+1],a<=e){if(g===r||e<c)return g;p=g+1}else{if(!(a>e))throw new Ai("Input is not a number.");m=g-1}return 0}class Fn{constructor(e,r,a){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[c,p]of a)this.labels.push(c),this.outputs.push(p)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const a=r.parse(e[1],1,Le);if(!a)return null;const c=[];let p=null;r.expectedType&&r.expectedType.kind!=="value"&&(p=r.expectedType);for(let m=1;m<e.length;m+=2){const g=m===1?-1/0:e[m],b=e[m+1],C=m,I=m+1;if(typeof g!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(c.length&&c[c.length-1][0]>=g)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',C);const A=r.parse(b,I,p);if(!A)return null;p=p||A.type,c.push([g,A])}return new Fn(p,a,c)}evaluate(e){const r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(e);const c=this.input.evaluate(e);if(c<=r[0])return a[0].evaluate(e);const p=r.length;return c>=r[p-1]?a[p-1].evaluate(e):a[pa(r,c)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Xt(i,e,r){return i+r*(e-i)}function bo(i,e,r){return i.map((a,c)=>Xt(a,e[c],r))}const Dr={number:Xt,color:function(i,e,r,a="rgb"){switch(a){case"rgb":{const[c,p,m,g]=bo(i.rgb,e.rgb,r);return new ui(c,p,m,g,!1)}case"hcl":{const[c,p,m,g]=i.hcl,[b,C,I,A]=e.hcl;let R,F;if(isNaN(c)||isNaN(b))isNaN(c)?isNaN(b)?R=NaN:(R=b,m!==1&&m!==0||(F=C)):(R=c,I!==1&&I!==0||(F=p));else{let ue=b-c;b>c&&ue>180?ue-=360:b<c&&c-b>180&&(ue+=360),R=c+r*ue}const[N,G,Y,ie]=function([ue,re,de,ye]){return ue=isNaN(ue)?0:ue*Ye,ci([de,Math.cos(ue)*re,Math.sin(ue)*re,ye])}([R,F??Xt(p,C,r),Xt(m,I,r),Xt(g,A,r)]);return new ui(N,G,Y,ie,!1)}case"lab":{const[c,p,m,g]=ci(bo(i.lab,e.lab,r));return new ui(c,p,m,g,!1)}}},array:bo,padding:function(i,e,r){return new Lr(bo(i.values,e.values,r))},variableAnchorOffsetCollection:function(i,e,r){const a=i.values,c=e.values;if(a.length!==c.length)throw new Ai(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${e.toString()}`);const p=[];for(let m=0;m<a.length;m+=2){if(a[m]!==c[m])throw new Ai(`Cannot interpolate values containing mismatched anchors. from[${m}]: ${a[m]}, to[${m}]: ${c[m]}`);p.push(a[m]);const[g,b]=a[m+1],[C,I]=c[m+1];p.push([Xt(g,C,r),Xt(b,I,r)])}return new Zr(p)}};class Rr{constructor(e,r,a,c,p){this.type=e,this.operator=r,this.interpolation=a,this.input=c,this.labels=[],this.outputs=[];for(const[m,g]of p)this.labels.push(m),this.outputs.push(g)}static interpolationFactor(e,r,a,c){let p=0;if(e.name==="exponential")p=us(r,e.base,a,c);else if(e.name==="linear")p=us(r,1,a,c);else if(e.name==="cubic-bezier"){const m=e.controlPoints;p=new me(m[0],m[1],m[2],m[3]).solve(us(r,1,a,c))}return p}static parse(e,r){let[a,c,p,...m]=e;if(!Array.isArray(c)||c.length===0)return r.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const C=c[1];if(typeof C!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:C}}else{if(c[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const C=c.slice(1);if(C.length!==4||C.some(I=>typeof I!="number"||I<0||I>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:C}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(p=r.parse(p,2,Le),!p)return null;const g=[];let b=null;a==="interpolate-hcl"||a==="interpolate-lab"?b=wi:r.expectedType&&r.expectedType.kind!=="value"&&(b=r.expectedType);for(let C=0;C<m.length;C+=2){const I=m[C],A=m[C+1],R=C+3,F=C+4;if(typeof I!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(g.length&&g[g.length-1][0]>=I)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',R);const N=r.parse(A,F,b);if(!N)return null;b=b||N.type,g.push([I,N])}return Ee(b,Le)||Ee(b,wi)||Ee(b,D)||Ee(b,j)||Ee(b,K(Le))?new Rr(b,a,c,p,g):r.error(`Type ${J(b)} is not interpolatable.`)}evaluate(e){const r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(e);const c=this.input.evaluate(e);if(c<=r[0])return a[0].evaluate(e);const p=r.length;if(c>=r[p-1])return a[p-1].evaluate(e);const m=pa(r,c),g=Rr.interpolationFactor(this.interpolation,c,r[m],r[m+1]),b=a[m].evaluate(e),C=a[m+1].evaluate(e);switch(this.operator){case"interpolate":return Dr[this.type.kind](b,C,g);case"interpolate-hcl":return Dr.color(b,C,g,"hcl");case"interpolate-lab":return Dr.color(b,C,g,"lab")}}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function us(i,e,r,a){const c=a-r,p=i-r;return c===0?0:e===1?p/c:(Math.pow(e,p)-1)/(Math.pow(e,c)-1)}class wo{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let a=null;const c=r.expectedType;c&&c.kind!=="value"&&(a=c);const p=[];for(const g of e.slice(1)){const b=r.parse(g,1+p.length,a,void 0,{typeAnnotation:"omit"});if(!b)return null;a=a||b.type,p.push(b)}if(!a)throw new Error("No output type");const m=c&&p.some(g=>ne(c,g.type));return new wo(m?Mt:a,p)}evaluate(e){let r,a=null,c=0;for(const p of this.args)if(c++,a=p.evaluate(e),a&&a instanceof sr&&!a.available&&(r||(r=a.name),a=null,c===this.args.length&&(a=r)),a!==null)break;return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class So{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let p=1;p<e.length-1;p+=2){const m=e[p];if(typeof m!="string")return r.error(`Expected string, but found ${typeof m} instead.`,p);if(/[^a-zA-Z0-9_]/.test(m))return r.error("Variable names must contain only alphanumeric characters or '_'.",p);const g=r.parse(e[p+1],p+1);if(!g)return null;a.push([m,g])}const c=r.parse(e[e.length-1],e.length-1,r.expectedType,a);return c?new So(a,c):null}outputDefined(){return this.result.outputDefined()}}class hs{constructor(e,r,a){this.type=e,this.index=r,this.input=a}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,Le),c=r.parse(e[2],2,K(r.expectedType||Mt));return a&&c?new hs(c.type.itemType,a,c):null}evaluate(e){const r=this.index.evaluate(e),a=this.input.evaluate(e);if(r<0)throw new Ai(`Array index out of bounds: ${r} < 0.`);if(r>=a.length)throw new Ai(`Array index out of bounds: ${r} > ${a.length-1}.`);if(r!==Math.floor(r))throw new Ai(`Array index must be an integer, but found ${r} instead.`);return a[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class ds{constructor(e,r){this.type=vt,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,Mt),c=r.parse(e[2],2,Mt);return a&&c?te(a.type,[vt,mt,Le,zt,Mt])?new ds(a,c):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${J(a.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!a)return!1;if(!se(r,["boolean","string","number","null"]))throw new Ai(`Expected first argument to be of type boolean, string, number or null, but found ${J(Ti(r))} instead.`);if(!se(a,["string","array"]))throw new Ai(`Expected second argument to be of type array or string, but found ${J(Ti(a))} instead.`);return a.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class Co{constructor(e,r,a){this.type=Le,this.needle=e,this.haystack=r,this.fromIndex=a}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,Mt),c=r.parse(e[2],2,Mt);if(!a||!c)return null;if(!te(a.type,[vt,mt,Le,zt,Mt]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${J(a.type)} instead`);if(e.length===4){const p=r.parse(e[3],3,Le);return p?new Co(a,c,p):null}return new Co(a,c)}evaluate(e){const r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!se(r,["boolean","string","number","null"]))throw new Ai(`Expected first argument to be of type boolean, string, number or null, but found ${J(Ti(r))} instead.`);if(!se(a,["string","array"]))throw new Ai(`Expected second argument to be of type array or string, but found ${J(Ti(a))} instead.`);if(this.fromIndex){const c=this.fromIndex.evaluate(e);return a.indexOf(r,c)}return a.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class ps{constructor(e,r,a,c,p,m){this.inputType=e,this.type=r,this.input=a,this.cases=c,this.outputs=p,this.otherwise=m}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let a,c;r.expectedType&&r.expectedType.kind!=="value"&&(c=r.expectedType);const p={},m=[];for(let C=2;C<e.length-1;C+=2){let I=e[C];const A=e[C+1];Array.isArray(I)||(I=[I]);const R=r.concat(C);if(I.length===0)return R.error("Expected at least one branch label.");for(const N of I){if(typeof N!="number"&&typeof N!="string")return R.error("Branch labels must be numbers or strings.");if(typeof N=="number"&&Math.abs(N)>Number.MAX_SAFE_INTEGER)return R.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof N=="number"&&Math.floor(N)!==N)return R.error("Numeric branch labels must be integer values.");if(a){if(R.checkSubtype(a,Ti(N)))return null}else a=Ti(N);if(p[String(N)]!==void 0)return R.error("Branch labels must be unique.");p[String(N)]=m.length}const F=r.parse(A,C,c);if(!F)return null;c=c||F.type,m.push(F)}const g=r.parse(e[1],1,Mt);if(!g)return null;const b=r.parse(e[e.length-1],e.length-1,c);return b?g.type.kind!=="value"&&r.concat(1).checkSubtype(a,g.type)?null:new ps(a,c,g,p,m,b):null}evaluate(e){const r=this.input.evaluate(e);return(Ti(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class fs{constructor(e,r,a){this.type=e,this.branches=r,this.otherwise=a}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let a;r.expectedType&&r.expectedType.kind!=="value"&&(a=r.expectedType);const c=[];for(let m=1;m<e.length-1;m+=2){const g=r.parse(e[m],m,vt);if(!g)return null;const b=r.parse(e[m+1],m+1,a);if(!b)return null;c.push([g,b]),a=a||b.type}const p=r.parse(e[e.length-1],e.length-1,a);if(!p)return null;if(!a)throw new Error("Can't infer output type");return new fs(a,c,p)}evaluate(e){for(const[r,a]of this.branches)if(r.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,a]of this.branches)e(r),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class To{constructor(e,r,a,c){this.type=e,this.input=r,this.beginIndex=a,this.endIndex=c}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,Mt),c=r.parse(e[2],2,Le);if(!a||!c)return null;if(!te(a.type,[K(Mt),mt,Mt]))return r.error(`Expected first argument to be of type array or string, but found ${J(a.type)} instead`);if(e.length===4){const p=r.parse(e[3],3,Le);return p?new To(a.type,a,c,p):null}return new To(a.type,a,c)}evaluate(e){const r=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!se(r,["string","array"]))throw new Ai(`Expected first argument to be of type array or string, but found ${J(Ti(r))} instead.`);if(this.endIndex){const c=this.endIndex.evaluate(e);return r.slice(a,c)}return r.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function Pl(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Ml(i,e,r,a){return a.compare(e,r)===0}function fa(i,e,r){const a=i!=="=="&&i!=="!=";return class Ng{constructor(p,m,g){this.type=vt,this.lhs=p,this.rhs=m,this.collator=g,this.hasUntypedArgument=p.type.kind==="value"||m.type.kind==="value"}static parse(p,m){if(p.length!==3&&p.length!==4)return m.error("Expected two or three arguments.");const g=p[0];let b=m.parse(p[1],1,Mt);if(!b)return null;if(!Pl(g,b.type))return m.concat(1).error(`"${g}" comparisons are not supported for type '${J(b.type)}'.`);let C=m.parse(p[2],2,Mt);if(!C)return null;if(!Pl(g,C.type))return m.concat(2).error(`"${g}" comparisons are not supported for type '${J(C.type)}'.`);if(b.type.kind!==C.type.kind&&b.type.kind!=="value"&&C.type.kind!=="value")return m.error(`Cannot compare types '${J(b.type)}' and '${J(C.type)}'.`);a&&(b.type.kind==="value"&&C.type.kind!=="value"?b=new Hr(C.type,[b]):b.type.kind!=="value"&&C.type.kind==="value"&&(C=new Hr(b.type,[C])));let I=null;if(p.length===4){if(b.type.kind!=="string"&&C.type.kind!=="string"&&b.type.kind!=="value"&&C.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(I=m.parse(p[3],3,Gr),!I)return null}return new Ng(b,C,I)}evaluate(p){const m=this.lhs.evaluate(p),g=this.rhs.evaluate(p);if(a&&this.hasUntypedArgument){const b=Ti(m),C=Ti(g);if(b.kind!==C.kind||b.kind!=="string"&&b.kind!=="number")throw new Ai(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${b.kind}, ${C.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const b=Ti(m),C=Ti(g);if(b.kind!=="string"||C.kind!=="string")return e(p,m,g)}return this.collator?r(p,m,g,this.collator.evaluate(p)):e(p,m,g)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}}}const tu=fa("==",function(i,e,r){return e===r},Ml),iu=fa("!=",function(i,e,r){return e!==r},function(i,e,r,a){return!Ml(0,e,r,a)}),ru=fa("<",function(i,e,r){return e<r},function(i,e,r,a){return a.compare(e,r)<0}),nu=fa(">",function(i,e,r){return e>r},function(i,e,r,a){return a.compare(e,r)>0}),au=fa("<=",function(i,e,r){return e<=r},function(i,e,r,a){return a.compare(e,r)<=0}),ou=fa(">=",function(i,e,r){return e>=r},function(i,e,r,a){return a.compare(e,r)>=0});class ms{constructor(e,r,a,c,p){this.type=mt,this.number=e,this.locale=r,this.currency=a,this.minFractionDigits=c,this.maxFractionDigits=p}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const a=r.parse(e[1],1,Le);if(!a)return null;const c=e[2];if(typeof c!="object"||Array.isArray(c))return r.error("NumberFormat options argument must be an object.");let p=null;if(c.locale&&(p=r.parse(c.locale,1,mt),!p))return null;let m=null;if(c.currency&&(m=r.parse(c.currency,1,mt),!m))return null;let g=null;if(c["min-fraction-digits"]&&(g=r.parse(c["min-fraction-digits"],1,Le),!g))return null;let b=null;return c["max-fraction-digits"]&&(b=r.parse(c["max-fraction-digits"],1,Le),!b)?null:new ms(a,p,m,g,b)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class Eo{constructor(e){this.type=W,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&typeof a=="object")return r.error("First argument must be an image or text section.");const c=[];let p=!1;for(let m=1;m<=e.length-1;++m){const g=e[m];if(p&&typeof g=="object"&&!Array.isArray(g)){p=!1;let b=null;if(g["font-scale"]&&(b=r.parse(g["font-scale"],1,Le),!b))return null;let C=null;if(g["text-font"]&&(C=r.parse(g["text-font"],1,K(mt)),!C))return null;let I=null;if(g["text-color"]&&(I=r.parse(g["text-color"],1,wi),!I))return null;const A=c[c.length-1];A.scale=b,A.font=C,A.textColor=I}else{const b=r.parse(e[m],1,Mt);if(!b)return null;const C=b.type.kind;if(C!=="string"&&C!=="value"&&C!=="null"&&C!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,c.push({content:b,scale:null,font:null,textColor:null})}}return new Eo(c)}evaluate(e){return new hr(this.sections.map(r=>{const a=r.content.evaluate(e);return Ti(a)===$?new uo("",a,null,null,null):new uo(ni(a),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}}class gs{constructor(e){this.type=$,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const a=r.parse(e[1],1,mt);return a?new gs(a):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),a=sr.fromString(r);return a&&e.availableImages&&(a.available=e.availableImages.indexOf(r)>-1),a}eachChild(e){e(this.input)}outputDefined(){return!1}}class ys{constructor(e){this.type=Le,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=r.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${J(a.type)} instead.`):new ys(a):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new Ai(`Expected value to be of type string or array, but found ${J(Ti(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const ma={"==":tu,"!=":iu,">":nu,"<":ru,">=":ou,"<=":au,array:Hr,at:hs,boolean:Hr,case:fs,coalesce:wo,collator:mo,format:Eo,image:gs,in:ds,"index-of":Co,interpolate:Rr,"interpolate-hcl":Rr,"interpolate-lab":Rr,length:ys,let:So,literal:Xn,match:ps,number:Hr,"number-format":ms,object:Hr,slice:To,step:Fn,string:Hr,"to-boolean":On,"to-color":On,"to-number":On,"to-string":On,var:yo,within:Kn};function Al(i,[e,r,a,c]){e=e.evaluate(i),r=r.evaluate(i),a=a.evaluate(i);const p=c?c.evaluate(i):1,m=ho(e,r,a,p);if(m)throw new Ai(m);return new ui(e/255,r/255,a/255,p,!1)}function kl(i,e){return i in e}function _s(i,e){const r=e[i];return r===void 0?null:r}function Yn(i){return{type:i}}function zl(i){return{result:"success",value:i}}function Nn(i){return{result:"error",value:i}}function ga(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Ll(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function vs(i){return!!i.expression&&i.expression.interpolated}function ai(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Ei(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function su(i){return i}function Kt(i,e){const r=e.type==="color",a=i.stops&&typeof i.stops[0][0]=="object",c=a||!(a||i.property!==void 0),p=i.type||(vs(e)?"exponential":"interval");if(r||e.type==="padding"){const I=r?ui.parse:Lr.parse;(i=Et({},i)).stops&&(i.stops=i.stops.map(A=>[A[0],I(A[1])])),i.default=I(i.default?i.default:e.default)}if(i.colorSpace&&(m=i.colorSpace)!=="rgb"&&m!=="hcl"&&m!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var m;let g,b,C;if(p==="exponential")g=Oa;else if(p==="interval")g=Si;else if(p==="categorical"){g=Ii,b=Object.create(null);for(const I of i.stops)b[I[0]]=I[1];C=typeof i.stops[0][0]}else{if(p!=="identity")throw new Error(`Unknown function type "${p}"`);g=Dl}if(a){const I={},A=[];for(let N=0;N<i.stops.length;N++){const G=i.stops[N],Y=G[0].zoom;I[Y]===void 0&&(I[Y]={zoom:Y,type:i.type,property:i.property,default:i.default,stops:[]},A.push(Y)),I[Y].stops.push([G[0].value,G[1]])}const R=[];for(const N of A)R.push([I[N].zoom,Kt(I[N],e)]);const F={name:"linear"};return{kind:"composite",interpolationType:F,interpolationFactor:Rr.interpolationFactor.bind(void 0,F),zoomStops:R.map(N=>N[0]),evaluate:({zoom:N},G)=>Oa({stops:R,base:i.base},e,N).evaluate(N,G)}}if(c){const I=p==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:I,interpolationFactor:Rr.interpolationFactor.bind(void 0,I),zoomStops:i.stops.map(A=>A[0]),evaluate:({zoom:A})=>g(i,e,A,b,C)}}return{kind:"source",evaluate(I,A){const R=A&&A.properties?A.properties[i.property]:void 0;return R===void 0?Jn(i.default,e.default):g(i,e,R,b,C)}}}function Jn(i,e,r){return i!==void 0?i:e!==void 0?e:r!==void 0?r:void 0}function Ii(i,e,r,a,c){return Jn(typeof r===c?a[r]:void 0,i.default,e.default)}function Si(i,e,r){if(ai(r)!=="number")return Jn(i.default,e.default);const a=i.stops.length;if(a===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[a-1][0])return i.stops[a-1][1];const c=pa(i.stops.map(p=>p[0]),r);return i.stops[c][1]}function Oa(i,e,r){const a=i.base!==void 0?i.base:1;if(ai(r)!=="number")return Jn(i.default,e.default);const c=i.stops.length;if(c===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[c-1][0])return i.stops[c-1][1];const p=pa(i.stops.map(I=>I[0]),r),m=function(I,A,R,F){const N=F-R,G=I-R;return N===0?0:A===1?G/N:(Math.pow(A,G)-1)/(Math.pow(A,N)-1)}(r,a,i.stops[p][0],i.stops[p+1][0]),g=i.stops[p][1],b=i.stops[p+1][1],C=Dr[e.type]||su;return typeof g.evaluate=="function"?{evaluate(...I){const A=g.evaluate.apply(void 0,I),R=b.evaluate.apply(void 0,I);if(A!==void 0&&R!==void 0)return C(A,R,m,i.colorSpace)}}:C(g,b,m,i.colorSpace)}function Dl(i,e,r){switch(e.type){case"color":r=ui.parse(r);break;case"formatted":r=hr.fromString(r.toString());break;case"resolvedImage":r=sr.fromString(r.toString());break;case"padding":r=Lr.parse(r);break;default:ai(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0)}return Jn(r,i.default,e.default)}Wr.register(ma,{error:[{kind:"error"},[mt],(i,[e])=>{throw new Ai(e.evaluate(i))}],typeof:[mt,[Mt],(i,[e])=>J(Ti(e.evaluate(i)))],"to-rgba":[K(Le,4),[wi],(i,[e])=>{const[r,a,c,p]=e.evaluate(i).rgb;return[255*r,255*a,255*c,p]}],rgb:[wi,[Le,Le,Le],Al],rgba:[wi,[Le,Le,Le,Le],Al],has:{type:vt,overloads:[[[mt],(i,[e])=>kl(e.evaluate(i),i.properties())],[[mt,Zi],(i,[e,r])=>kl(e.evaluate(i),r.evaluate(i))]]},get:{type:Mt,overloads:[[[mt],(i,[e])=>_s(e.evaluate(i),i.properties())],[[mt,Zi],(i,[e,r])=>_s(e.evaluate(i),r.evaluate(i))]]},"feature-state":[Mt,[mt],(i,[e])=>_s(e.evaluate(i),i.featureState||{})],properties:[Zi,[],i=>i.properties()],"geometry-type":[mt,[],i=>i.geometryType()],id:[Mt,[],i=>i.id()],zoom:[Le,[],i=>i.globals.zoom],"heatmap-density":[Le,[],i=>i.globals.heatmapDensity||0],"line-progress":[Le,[],i=>i.globals.lineProgress||0],accumulated:[Mt,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Le,Yn(Le),(i,e)=>{let r=0;for(const a of e)r+=a.evaluate(i);return r}],"*":[Le,Yn(Le),(i,e)=>{let r=1;for(const a of e)r*=a.evaluate(i);return r}],"-":{type:Le,overloads:[[[Le,Le],(i,[e,r])=>e.evaluate(i)-r.evaluate(i)],[[Le],(i,[e])=>-e.evaluate(i)]]},"/":[Le,[Le,Le],(i,[e,r])=>e.evaluate(i)/r.evaluate(i)],"%":[Le,[Le,Le],(i,[e,r])=>e.evaluate(i)%r.evaluate(i)],ln2:[Le,[],()=>Math.LN2],pi:[Le,[],()=>Math.PI],e:[Le,[],()=>Math.E],"^":[Le,[Le,Le],(i,[e,r])=>Math.pow(e.evaluate(i),r.evaluate(i))],sqrt:[Le,[Le],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[Le,[Le],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[Le,[Le],(i,[e])=>Math.log(e.evaluate(i))],log2:[Le,[Le],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[Le,[Le],(i,[e])=>Math.sin(e.evaluate(i))],cos:[Le,[Le],(i,[e])=>Math.cos(e.evaluate(i))],tan:[Le,[Le],(i,[e])=>Math.tan(e.evaluate(i))],asin:[Le,[Le],(i,[e])=>Math.asin(e.evaluate(i))],acos:[Le,[Le],(i,[e])=>Math.acos(e.evaluate(i))],atan:[Le,[Le],(i,[e])=>Math.atan(e.evaluate(i))],min:[Le,Yn(Le),(i,e)=>Math.min(...e.map(r=>r.evaluate(i)))],max:[Le,Yn(Le),(i,e)=>Math.max(...e.map(r=>r.evaluate(i)))],abs:[Le,[Le],(i,[e])=>Math.abs(e.evaluate(i))],round:[Le,[Le],(i,[e])=>{const r=e.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[Le,[Le],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[Le,[Le],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[vt,[mt,Mt],(i,[e,r])=>i.properties()[e.value]===r.value],"filter-id-==":[vt,[Mt],(i,[e])=>i.id()===e.value],"filter-type-==":[vt,[mt],(i,[e])=>i.geometryType()===e.value],"filter-<":[vt,[mt,Mt],(i,[e,r])=>{const a=i.properties()[e.value],c=r.value;return typeof a==typeof c&&a<c}],"filter-id-<":[vt,[Mt],(i,[e])=>{const r=i.id(),a=e.value;return typeof r==typeof a&&r<a}],"filter->":[vt,[mt,Mt],(i,[e,r])=>{const a=i.properties()[e.value],c=r.value;return typeof a==typeof c&&a>c}],"filter-id->":[vt,[Mt],(i,[e])=>{const r=i.id(),a=e.value;return typeof r==typeof a&&r>a}],"filter-<=":[vt,[mt,Mt],(i,[e,r])=>{const a=i.properties()[e.value],c=r.value;return typeof a==typeof c&&a<=c}],"filter-id-<=":[vt,[Mt],(i,[e])=>{const r=i.id(),a=e.value;return typeof r==typeof a&&r<=a}],"filter->=":[vt,[mt,Mt],(i,[e,r])=>{const a=i.properties()[e.value],c=r.value;return typeof a==typeof c&&a>=c}],"filter-id->=":[vt,[Mt],(i,[e])=>{const r=i.id(),a=e.value;return typeof r==typeof a&&r>=a}],"filter-has":[vt,[Mt],(i,[e])=>e.value in i.properties()],"filter-has-id":[vt,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[vt,[K(mt)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[vt,[K(Mt)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[vt,[mt,K(Mt)],(i,[e,r])=>r.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[vt,[mt,K(Mt)],(i,[e,r])=>function(a,c,p,m){for(;p<=m;){const g=p+m>>1;if(c[g]===a)return!0;c[g]>a?m=g-1:p=g+1}return!1}(i.properties()[e.value],r.value,0,r.value.length-1)],all:{type:vt,overloads:[[[vt,vt],(i,[e,r])=>e.evaluate(i)&&r.evaluate(i)],[Yn(vt),(i,e)=>{for(const r of e)if(!r.evaluate(i))return!1;return!0}]]},any:{type:vt,overloads:[[[vt,vt],(i,[e,r])=>e.evaluate(i)||r.evaluate(i)],[Yn(vt),(i,e)=>{for(const r of e)if(r.evaluate(i))return!0;return!1}]]},"!":[vt,[vt],(i,[e])=>!e.evaluate(i)],"is-supported-script":[vt,[mt],(i,[e])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(e.evaluate(i))}],upcase:[mt,[mt],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[mt,[mt],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[mt,Yn(Mt),(i,e)=>e.map(r=>ni(r.evaluate(i))).join("")],"resolved-locale":[mt,[Gr],(i,[e])=>e.evaluate(i).resolvedLocale()]});class xs{constructor(e,r){var a;this.expression=e,this._warningHistory={},this._evaluator=new ns,this._defaultValue=r?(a=r).type==="color"&&Ei(a.default)?new ui(0,0,0,0):a.type==="color"?ui.parse(a.default)||null:a.type==="padding"?Lr.parse(a.default)||null:a.type==="variableAnchorOffsetCollection"?Zr.parse(a.default)||null:a.default===void 0?null:a.default:null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,a,c,p,m){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=a,this._evaluator.canonical=c,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=m,this.expression.evaluate(this._evaluator)}evaluate(e,r,a,c,p,m){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=a||null,this._evaluator.canonical=c,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=m||null;try{const g=this.expression.evaluate(this._evaluator);if(g==null||typeof g=="number"&&g!=g)return this._defaultValue;if(this._enumValues&&!(g in this._enumValues))throw new Ai(`Expected value to be one of ${Object.keys(this._enumValues).map(b=>JSON.stringify(b)).join(", ")}, but found ${JSON.stringify(g)} instead.`);return g}catch(g){return this._warningHistory[g.message]||(this._warningHistory[g.message]=!0,typeof console<"u"&&console.warn(g.message)),this._defaultValue}}}function Io(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in ma}function Po(i,e){const r=new fo(ma,_o,[],e?function(c){const p={color:wi,string:mt,number:Le,enum:mt,boolean:vt,formatted:W,padding:D,resolvedImage:$,variableAnchorOffsetCollection:j};return c.type==="array"?K(p[c.value]||Mt,c.length):p[c.type]}(e):void 0),a=r.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?zl(new xs(a,e)):Nn(r.errors)}class bs{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!$a(r.expression)}evaluateWithoutErrorHandling(e,r,a,c,p,m){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,c,p,m)}evaluate(e,r,a,c,p,m){return this._styleExpression.evaluate(e,r,a,c,p,m)}}class Mo{constructor(e,r,a,c){this.kind=e,this.zoomStops=a,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!$a(r.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,r,a,c,p,m){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,c,p,m)}evaluate(e,r,a,c,p,m){return this._styleExpression.evaluate(e,r,a,c,p,m)}interpolationFactor(e,r,a){return this.interpolationType?Rr.interpolationFactor(this.interpolationType,e,r,a):0}}function ws(i,e){const r=Po(i,e);if(r.result==="error")return r;const a=r.value.expression,c=vo(a);if(!c&&!ga(e))return Nn([new St("","data expressions not supported")]);const p=xo(a,["zoom"]);if(!p&&!Ll(e))return Nn([new St("","zoom expressions not supported")]);const m=Fa(a);return m||p?m instanceof St?Nn([m]):m instanceof Rr&&!vs(e)?Nn([new St("",'"interpolate" expressions cannot be used with this property')]):zl(m?new Mo(c?"camera":"composite",r.value,m.labels,m instanceof Rr?m.interpolation:void 0):new bs(c?"constant":"source",r.value)):Nn([new St("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ba{constructor(e,r){this._parameters=e,this._specification=r,Et(this,Kt(this._parameters,this._specification))}static deserialize(e){return new Ba(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Fa(i){let e=null;if(i instanceof So)e=Fa(i.result);else if(i instanceof wo){for(const r of i.args)if(e=Fa(r),e)break}else(i instanceof Fn||i instanceof Rr)&&i.input instanceof Wr&&i.input.name==="zoom"&&(e=i);return e instanceof St||i.eachChild(r=>{const a=Fa(r);a instanceof St?e=a:!e&&a?e=new St("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&a&&e!==a&&(e=new St("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Na(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!Na(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const lu={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ss(i){if(i==null)return{filter:()=>!0,needGeometry:!1};Na(i)||(i=Ao(i));const e=Po(i,lu);if(e.result==="error")throw new Error(e.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,a,c)=>e.value.evaluate(r,a,{},c),needGeometry:Rl(i)}}function cu(i,e){return i<e?-1:i>e?1:0}function Rl(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(Rl(i[e]))return!0;return!1}function Ao(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?Cs(i[1],i[2],"=="):e==="!="?ja(Cs(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Cs(i[1],i[2],e):e==="any"?(r=i.slice(1),["any"].concat(r.map(Ao))):e==="all"?["all"].concat(i.slice(1).map(Ao)):e==="none"?["all"].concat(i.slice(1).map(Ao).map(ja)):e==="in"?$l(i[1],i.slice(2)):e==="!in"?ja($l(i[1],i.slice(2))):e==="has"?Ol(i[1]):e==="!has"?ja(Ol(i[1])):e!=="within"||i;var r}function Cs(i,e,r){switch(i){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,i,e]}}function $l(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",i,["literal",e.sort(cu)]]:["filter-in-small",i,["literal",e]]}}function Ol(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function ja(i){return["!",i]}function ko(i){const e=typeof i;if(e==="number"||e==="boolean"||e==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let c="[";for(const p of i)c+=`${ko(p)},`;return`${c}]`}const r=Object.keys(i).sort();let a="{";for(let c=0;c<r.length;c++)a+=`${JSON.stringify(r[c])}:${ko(i[r[c]])},`;return`${a}}`}function zo(i){let e="";for(const r of bi)e+=`/${ko(i[r])}`;return e}function Bl(i){const e=i.value;return e?[new Ve(i.key,e,"constants have been deprecated as of v8")]:[]}function ki(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Qn(i){if(Array.isArray(i))return i.map(Qn);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const r in i)e[r]=Qn(i[r]);return e}return ki(i)}function Tr(i){const e=i.key,r=i.value,a=i.valueSpec||{},c=i.objectElementValidators||{},p=i.style,m=i.styleSpec,g=i.validateSpec;let b=[];const C=ai(r);if(C!=="object")return[new Ve(e,r,`object expected, ${C} found`)];for(const I in r){const A=I.split(".")[0],R=a[A]||a["*"];let F;if(c[A])F=c[A];else if(a[A])F=g;else if(c["*"])F=c["*"];else{if(!a["*"]){b.push(new Ve(e,r[I],`unknown property "${I}"`));continue}F=g}b=b.concat(F({key:(e&&`${e}.`)+I,value:r[I],valueSpec:R,style:p,styleSpec:m,object:r,objectKey:I,validateSpec:g},r))}for(const I in a)c[I]||a[I].required&&a[I].default===void 0&&r[I]===void 0&&b.push(new Ve(e,r,`missing required property "${I}"`));return b}function ya(i){const e=i.value,r=i.valueSpec,a=i.style,c=i.styleSpec,p=i.key,m=i.arrayElementValidator||i.validateSpec;if(ai(e)!=="array")return[new Ve(p,e,`array expected, ${ai(e)} found`)];if(r.length&&e.length!==r.length)return[new Ve(p,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new Ve(p,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let g={type:r.value,values:r.values};c.$version<7&&(g.function=r.function),ai(r.value)==="object"&&(g=r.value);let b=[];for(let C=0;C<e.length;C++)b=b.concat(m({array:e,arrayIndex:C,value:e[C],valueSpec:g,validateSpec:i.validateSpec,style:a,styleSpec:c,key:`${p}[${C}]`}));return b}function Va(i){const e=i.key,r=i.value,a=i.valueSpec;let c=ai(r);return c==="number"&&r!=r&&(c="NaN"),c!=="number"?[new Ve(e,r,`number expected, ${c} found`)]:"minimum"in a&&r<a.minimum?[new Ve(e,r,`${r} is less than the minimum value ${a.minimum}`)]:"maximum"in a&&r>a.maximum?[new Ve(e,r,`${r} is greater than the maximum value ${a.maximum}`)]:[]}function Lo(i){const e=i.valueSpec,r=ki(i.value.type);let a,c,p,m={};const g=r!=="categorical"&&i.value.property===void 0,b=!g,C=ai(i.value.stops)==="array"&&ai(i.value.stops[0])==="array"&&ai(i.value.stops[0][0])==="object",I=Tr({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(F){if(r==="identity")return[new Ve(F.key,F.value,'identity function may not have a "stops" property')];let N=[];const G=F.value;return N=N.concat(ya({key:F.key,value:G,valueSpec:F.valueSpec,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,arrayElementValidator:A})),ai(G)==="array"&&G.length===0&&N.push(new Ve(F.key,G,"array must have at least one stop")),N},default:function(F){return F.validateSpec({key:F.key,value:F.value,valueSpec:e,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec})}}});return r==="identity"&&g&&I.push(new Ve(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||I.push(new Ve(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!vs(i.valueSpec)&&I.push(new Ve(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(b&&!ga(i.valueSpec)?I.push(new Ve(i.key,i.value,"property functions not supported")):g&&!Ll(i.valueSpec)&&I.push(new Ve(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!C||i.value.property!==void 0||I.push(new Ve(i.key,i.value,'"property" property is required')),I;function A(F){let N=[];const G=F.value,Y=F.key;if(ai(G)!=="array")return[new Ve(Y,G,`array expected, ${ai(G)} found`)];if(G.length!==2)return[new Ve(Y,G,`array length 2 expected, length ${G.length} found`)];if(C){if(ai(G[0])!=="object")return[new Ve(Y,G,`object expected, ${ai(G[0])} found`)];if(G[0].zoom===void 0)return[new Ve(Y,G,"object stop key must have zoom")];if(G[0].value===void 0)return[new Ve(Y,G,"object stop key must have value")];if(p&&p>ki(G[0].zoom))return[new Ve(Y,G[0].zoom,"stop zoom values must appear in ascending order")];ki(G[0].zoom)!==p&&(p=ki(G[0].zoom),c=void 0,m={}),N=N.concat(Tr({key:`${Y}[0]`,value:G[0],valueSpec:{zoom:{}},validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,objectElementValidators:{zoom:Va,value:R}}))}else N=N.concat(R({key:`${Y}[0]`,value:G[0],valueSpec:{},validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec},G));return Io(Qn(G[1]))?N.concat([new Ve(`${Y}[1]`,G[1],"expressions are not allowed in function stops.")]):N.concat(F.validateSpec({key:`${Y}[1]`,value:G[1],valueSpec:e,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec}))}function R(F,N){const G=ai(F.value),Y=ki(F.value),ie=F.value!==null?F.value:N;if(a){if(G!==a)return[new Ve(F.key,ie,`${G} stop domain type must match previous stop domain type ${a}`)]}else a=G;if(G!=="number"&&G!=="string"&&G!=="boolean")return[new Ve(F.key,ie,"stop domain value must be a number, string, or boolean")];if(G!=="number"&&r!=="categorical"){let ue=`number expected, ${G} found`;return ga(e)&&r===void 0&&(ue+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ve(F.key,ie,ue)]}return r!=="categorical"||G!=="number"||isFinite(Y)&&Math.floor(Y)===Y?r!=="categorical"&&G==="number"&&c!==void 0&&Y<c?[new Ve(F.key,ie,"stop domain values must appear in ascending order")]:(c=Y,r==="categorical"&&Y in m?[new Ve(F.key,ie,"stop domain values must be unique")]:(m[Y]=!0,[])):[new Ve(F.key,ie,`integer expected, found ${Y}`)]}}function ea(i){const e=(i.expressionContext==="property"?ws:Po)(Qn(i.value),i.valueSpec);if(e.result==="error")return e.value.map(a=>new Ve(`${i.key}${a.key}`,i.value,a.message));const r=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new Ve(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!$a(r))return[new Ve(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!$a(r))return[new Ve(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!xo(r,["zoom","feature-state"]))return[new Ve(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!vo(r))return[new Ve(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ua(i){const e=i.key,r=i.value,a=i.valueSpec,c=[];return Array.isArray(a.values)?a.values.indexOf(ki(r))===-1&&c.push(new Ve(e,r,`expected one of [${a.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(a.values).indexOf(ki(r))===-1&&c.push(new Ve(e,r,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(r)} found`)),c}function _a(i){return Na(Qn(i.value))?ea(Et({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Fl(i)}function Fl(i){const e=i.value,r=i.key;if(ai(e)!=="array")return[new Ve(r,e,`array expected, ${ai(e)} found`)];const a=i.styleSpec;let c,p=[];if(e.length<1)return[new Ve(r,e,"filter array must have at least 1 element")];switch(p=p.concat(Ua({key:`${r}[0]`,value:e[0],valueSpec:a.filter_operator,style:i.style,styleSpec:i.styleSpec})),ki(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&ki(e[1])==="$type"&&p.push(new Ve(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&p.push(new Ve(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(c=ai(e[1]),c!=="string"&&p.push(new Ve(`${r}[1]`,e[1],`string expected, ${c} found`)));for(let m=2;m<e.length;m++)c=ai(e[m]),ki(e[1])==="$type"?p=p.concat(Ua({key:`${r}[${m}]`,value:e[m],valueSpec:a.geometry_type,style:i.style,styleSpec:i.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&p.push(new Ve(`${r}[${m}]`,e[m],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let m=1;m<e.length;m++)p=p.concat(Fl({key:`${r}[${m}]`,value:e[m],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":c=ai(e[1]),e.length!==2?p.push(new Ve(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="string"&&p.push(new Ve(`${r}[1]`,e[1],`string expected, ${c} found`));break;case"within":c=ai(e[1]),e.length!==2?p.push(new Ve(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="object"&&p.push(new Ve(`${r}[1]`,e[1],`object expected, ${c} found`))}return p}function Nl(i,e){const r=i.key,a=i.validateSpec,c=i.style,p=i.styleSpec,m=i.value,g=i.objectKey,b=p[`${e}_${i.layerType}`];if(!b)return[];const C=g.match(/^(.*)-transition$/);if(e==="paint"&&C&&b[C[1]]&&b[C[1]].transition)return a({key:r,value:m,valueSpec:p.transition,style:c,styleSpec:p});const I=i.valueSpec||b[g];if(!I)return[new Ve(r,m,`unknown property "${g}"`)];let A;if(ai(m)==="string"&&ga(I)&&!I.tokens&&(A=/^{([^}]+)}$/.exec(m)))return[new Ve(r,m,`"${g}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(A[1])} }\`.`)];const R=[];return i.layerType==="symbol"&&(g==="text-field"&&c&&!c.glyphs&&R.push(new Ve(r,m,'use of "text-field" requires a style "glyphs" property')),g==="text-font"&&Ei(Qn(m))&&ki(m.type)==="identity"&&R.push(new Ve(r,m,'"text-font" does not support identity functions'))),R.concat(a({key:i.key,value:m,valueSpec:I,style:c,styleSpec:p,expressionContext:"property",propertyType:e,propertyKey:g}))}function jl(i){return Nl(i,"paint")}function Vl(i){return Nl(i,"layout")}function Ul(i){let e=[];const r=i.value,a=i.key,c=i.style,p=i.styleSpec;r.type||r.ref||e.push(new Ve(a,r,'either "type" or "ref" is required'));let m=ki(r.type);const g=ki(r.ref);if(r.id){const b=ki(r.id);for(let C=0;C<i.arrayIndex;C++){const I=c.layers[C];ki(I.id)===b&&e.push(new Ve(a,r.id,`duplicate layer id "${r.id}", previously used at line ${I.id.__line__}`))}}if("ref"in r){let b;["type","source","source-layer","filter","layout"].forEach(C=>{C in r&&e.push(new Ve(a,r[C],`"${C}" is prohibited for ref layers`))}),c.layers.forEach(C=>{ki(C.id)===g&&(b=C)}),b?b.ref?e.push(new Ve(a,r.ref,"ref cannot reference another ref layer")):m=ki(b.type):e.push(new Ve(a,r.ref,`ref layer "${g}" not found`))}else if(m!=="background")if(r.source){const b=c.sources&&c.sources[r.source],C=b&&ki(b.type);b?C==="vector"&&m==="raster"?e.push(new Ve(a,r.source,`layer "${r.id}" requires a raster source`)):C!=="raster-dem"&&m==="hillshade"?e.push(new Ve(a,r.source,`layer "${r.id}" requires a raster-dem source`)):C==="raster"&&m!=="raster"?e.push(new Ve(a,r.source,`layer "${r.id}" requires a vector source`)):C!=="vector"||r["source-layer"]?C==="raster-dem"&&m!=="hillshade"?e.push(new Ve(a,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):m!=="line"||!r.paint||!r.paint["line-gradient"]||C==="geojson"&&b.lineMetrics||e.push(new Ve(a,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Ve(a,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new Ve(a,r.source,`source "${r.source}" not found`))}else e.push(new Ve(a,r,'missing required property "source"'));return e=e.concat(Tr({key:a,value:r,valueSpec:p.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${a}.type`,value:r.type,valueSpec:p.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:r,objectKey:"type"}),filter:_a,layout:b=>Tr({layer:r,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,validateSpec:b.validateSpec,objectElementValidators:{"*":C=>Vl(Et({layerType:m},C))}}),paint:b=>Tr({layer:r,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,validateSpec:b.validateSpec,objectElementValidators:{"*":C=>jl(Et({layerType:m},C))}})}})),e}function un(i){const e=i.value,r=i.key,a=ai(e);return a!=="string"?[new Ve(r,e,`string expected, ${a} found`)]:[]}const qa={promoteId:function({key:i,value:e}){if(ai(e)==="string")return un({key:i,value:e});{const r=[];for(const a in e)r.push(...un({key:`${i}.${a}`,value:e[a]}));return r}}};function $r(i){const e=i.value,r=i.key,a=i.styleSpec,c=i.style,p=i.validateSpec;if(!e.type)return[new Ve(r,e,'"type" is required')];const m=ki(e.type);let g;switch(m){case"vector":case"raster":return g=Tr({key:r,value:e,valueSpec:a[`source_${m.replace("-","_")}`],style:i.style,styleSpec:a,objectElementValidators:qa,validateSpec:p}),g;case"raster-dem":return g=function(b){var C;const I=(C=b.sourceName)!==null&&C!==void 0?C:"",A=b.value,R=b.styleSpec,F=R.source_raster_dem,N=b.style;let G=[];const Y=ai(A);if(A===void 0)return G;if(Y!=="object")return G.push(new Ve("source_raster_dem",A,`object expected, ${Y} found`)),G;const ie=ki(A.encoding)==="custom",ue=["redFactor","greenFactor","blueFactor","baseShift"],re=b.value.encoding?`"${b.value.encoding}"`:"Default";for(const de in A)!ie&&ue.includes(de)?G.push(new Ve(de,A[de],`In "${I}": "${de}" is only valid when "encoding" is set to "custom". ${re} encoding found`)):F[de]?G=G.concat(b.validateSpec({key:de,value:A[de],valueSpec:F[de],validateSpec:b.validateSpec,style:N,styleSpec:R})):G.push(new Ve(de,A[de],`unknown property "${de}"`));return G}({sourceName:r,value:e,style:i.style,styleSpec:a,validateSpec:p}),g;case"geojson":if(g=Tr({key:r,value:e,valueSpec:a.source_geojson,style:c,styleSpec:a,validateSpec:p,objectElementValidators:qa}),e.cluster)for(const b in e.clusterProperties){const[C,I]=e.clusterProperties[b],A=typeof C=="string"?[C,["accumulated"],["get",b]]:C;g.push(...ea({key:`${r}.${b}.map`,value:I,validateSpec:p,expressionContext:"cluster-map"})),g.push(...ea({key:`${r}.${b}.reduce`,value:A,validateSpec:p,expressionContext:"cluster-reduce"}))}return g;case"video":return Tr({key:r,value:e,valueSpec:a.source_video,style:c,validateSpec:p,styleSpec:a});case"image":return Tr({key:r,value:e,valueSpec:a.source_image,style:c,validateSpec:p,styleSpec:a});case"canvas":return[new Ve(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ua({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:c,validateSpec:p,styleSpec:a})}}function Ga(i){const e=i.value,r=i.styleSpec,a=r.light,c=i.style;let p=[];const m=ai(e);if(e===void 0)return p;if(m!=="object")return p=p.concat([new Ve("light",e,`object expected, ${m} found`)]),p;for(const g in e){const b=g.match(/^(.*)-transition$/);p=p.concat(b&&a[b[1]]&&a[b[1]].transition?i.validateSpec({key:g,value:e[g],valueSpec:r.transition,validateSpec:i.validateSpec,style:c,styleSpec:r}):a[g]?i.validateSpec({key:g,value:e[g],valueSpec:a[g],validateSpec:i.validateSpec,style:c,styleSpec:r}):[new Ve(g,e[g],`unknown property "${g}"`)])}return p}function ql(i){const e=i.value,r=i.styleSpec,a=r.terrain,c=i.style;let p=[];const m=ai(e);if(e===void 0)return p;if(m!=="object")return p=p.concat([new Ve("terrain",e,`object expected, ${m} found`)]),p;for(const g in e)p=p.concat(a[g]?i.validateSpec({key:g,value:e[g],valueSpec:a[g],validateSpec:i.validateSpec,style:c,styleSpec:r}):[new Ve(g,e[g],`unknown property "${g}"`)]);return p}function Gl(i){let e=[];const r=i.value,a=i.key;if(Array.isArray(r)){const c=[],p=[];for(const m in r)r[m].id&&c.includes(r[m].id)&&e.push(new Ve(a,r,`all the sprites' ids must be unique, but ${r[m].id} is duplicated`)),c.push(r[m].id),r[m].url&&p.includes(r[m].url)&&e.push(new Ve(a,r,`all the sprites' URLs must be unique, but ${r[m].url} is duplicated`)),p.push(r[m].url),e=e.concat(Tr({key:`${a}[${m}]`,value:r[m],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return e}return un({key:a,value:r})}const Zl={"*":()=>[],array:ya,boolean:function(i){const e=i.value,r=i.key,a=ai(e);return a!=="boolean"?[new Ve(r,e,`boolean expected, ${a} found`)]:[]},number:Va,color:function(i){const e=i.key,r=i.value,a=ai(r);return a!=="string"?[new Ve(e,r,`color expected, ${a} found`)]:ui.parse(String(r))?[]:[new Ve(e,r,`color expected, "${r}" found`)]},constants:Bl,enum:Ua,filter:_a,function:Lo,layer:Ul,object:Tr,source:$r,light:Ga,terrain:ql,string:un,formatted:function(i){return un(i).length===0?[]:ea(i)},resolvedImage:function(i){return un(i).length===0?[]:ea(i)},padding:function(i){const e=i.key,r=i.value;if(ai(r)==="array"){if(r.length<1||r.length>4)return[new Ve(e,r,`padding requires 1 to 4 values; ${r.length} values found`)];const a={type:"number"};let c=[];for(let p=0;p<r.length;p++)c=c.concat(i.validateSpec({key:`${e}[${p}]`,value:r[p],validateSpec:i.validateSpec,valueSpec:a}));return c}return Va({key:e,value:r,valueSpec:{}})},variableAnchorOffsetCollection:function(i){const e=i.key,r=i.value,a=ai(r),c=i.styleSpec;if(a!=="array"||r.length<1||r.length%2!=0)return[new Ve(e,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let p=[];for(let m=0;m<r.length;m+=2)p=p.concat(Ua({key:`${e}[${m}]`,value:r[m],valueSpec:c.layout_symbol["text-anchor"]})),p=p.concat(ya({key:`${e}[${m+1}]`,value:r[m+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:c}));return p},sprite:Gl};function bn(i){const e=i.value,r=i.valueSpec,a=i.styleSpec;return i.validateSpec=bn,r.expression&&Ei(ki(e))?Lo(i):r.expression&&Io(Qn(e))?ea(i):r.type&&Zl[r.type]?Zl[r.type](i):Tr(Et({},i,{valueSpec:r.type?a[r.type]:r}))}function Hl(i){const e=i.value,r=i.key,a=un(i);return a.length||(e.indexOf("{fontstack}")===-1&&a.push(new Ve(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&a.push(new Ve(r,e,'"glyphs" url must include a "{range}" token'))),a}function Xr(i,e=Te){let r=[];return r=r.concat(bn({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,validateSpec:bn,objectElementValidators:{glyphs:Hl,"*":()=>[]}})),i.constants&&(r=r.concat(Bl({key:"constants",value:i.constants,style:i,styleSpec:e,validateSpec:bn}))),Do(r)}function wn(i){return function(e){return i({...e,validateSpec:bn})}}function Do(i){return[].concat(i).sort((e,r)=>e.line-r.line)}function Sn(i){return function(...e){return Do(i.apply(this,e))}}Xr.source=Sn(wn($r)),Xr.sprite=Sn(wn(Gl)),Xr.glyphs=Sn(wn(Hl)),Xr.light=Sn(wn(Ga)),Xr.terrain=Sn(wn(ql)),Xr.layer=Sn(wn(Ul)),Xr.filter=Sn(wn(_a)),Xr.paintProperty=Sn(wn(jl)),Xr.layoutProperty=Sn(wn(Vl));const Cn=Xr,uu=Cn.light,Ts=Cn.paintProperty,Wl=Cn.layoutProperty;function Ro(i,e){let r=!1;if(e&&e.length)for(const a of e)i.fire(new Fi(new Error(a.message))),r=!0;return r}class va{constructor(e,r,a){const c=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const m=new Int32Array(this.arrayBuffer);e=m[0],this.d=(r=m[1])+2*(a=m[2]);for(let b=0;b<this.d*this.d;b++){const C=m[3+b],I=m[3+b+1];c.push(C===I?null:m.subarray(C,I))}const g=m[3+c.length+1];this.keys=m.subarray(m[3+c.length],g),this.bboxes=m.subarray(g),this.insert=this._insertReadonly}else{this.d=r+2*a;for(let m=0;m<this.d*this.d;m++)c.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=e,this.padding=a,this.scale=r/e,this.uid=0;const p=a/r*e;this.min=-p,this.max=e+p}insert(e,r,a,c,p){this._forEachCell(r,a,c,p,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(c),this.bboxes.push(p)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,r,a,c,p,m){this.cells[p].push(m)}query(e,r,a,c,p){const m=this.min,g=this.max;if(e<=m&&r<=m&&g<=a&&g<=c&&!p)return Array.prototype.slice.call(this.keys);{const b=[];return this._forEachCell(e,r,a,c,this._queryCell,b,{},p),b}}_queryCell(e,r,a,c,p,m,g,b){const C=this.cells[p];if(C!==null){const I=this.keys,A=this.bboxes;for(let R=0;R<C.length;R++){const F=C[R];if(g[F]===void 0){const N=4*F;(b?b(A[N+0],A[N+1],A[N+2],A[N+3]):e<=A[N+2]&&r<=A[N+3]&&a>=A[N+0]&&c>=A[N+1])?(g[F]=!0,m.push(I[F])):g[F]=!1}}}}_forEachCell(e,r,a,c,p,m,g,b){const C=this._convertToCellCoord(e),I=this._convertToCellCoord(r),A=this._convertToCellCoord(a),R=this._convertToCellCoord(c);for(let F=C;F<=A;F++)for(let N=I;N<=R;N++){const G=this.d*N+F;if((!b||b(this._convertFromCellCoord(F),this._convertFromCellCoord(N),this._convertFromCellCoord(F+1),this._convertFromCellCoord(N+1)))&&p.call(this,e,r,a,c,G,m,g,b))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,r=3+this.cells.length+1+1;let a=0;for(let m=0;m<this.cells.length;m++)a+=this.cells[m].length;const c=new Int32Array(r+a+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;let p=r;for(let m=0;m<e.length;m++){const g=e[m];c[3+m]=p,c.set(g,p),p+=g.length}return c[3+e.length]=p,c.set(this.keys,p),p+=this.keys.length,c[3+e.length+1]=p,c.set(this.bboxes,p),p+=this.bboxes.length,c.buffer}static serialize(e,r){const a=e.toArrayBuffer();return r&&r.push(a),{buffer:a}}static deserialize(e){return new va(e.buffer)}}const Tn={};function it(i,e,r={}){if(Tn[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),Tn[i]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}it("Object",Object),it("TransferableGridIndex",va),it("Color",ui),it("Error",Error),it("AJAXError",Yt),it("ResolvedImage",sr),it("StylePropertyFunction",Ba),it("StyleExpression",xs,{omit:["_evaluator"]}),it("ZoomDependentExpression",Mo),it("ZoomConstantExpression",bs),it("CompoundExpression",Wr,{omit:["_evaluate"]});for(const i in ma)ma[i]._classRegistryKey||it(`Expression_${i}`,ma[i]);function $o(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function jn(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob)return i;if($o(i)||At(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const r=i;return e&&e.push(r.buffer),r}if(i instanceof ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const r=[];for(const a of i)r.push(jn(a,e));return r}if(typeof i=="object"){const r=i.constructor,a=r._classRegistryKey;if(!a)throw new Error("can't serialize object of unregistered class");if(!Tn[a])throw new Error(`${a} is not registered.`);const c=r.serialize?r.serialize(i,e):{};if(r.serialize){if(e&&c===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const p in i){if(!i.hasOwnProperty(p)||Tn[a].omit.indexOf(p)>=0)continue;const m=i[p];c[p]=Tn[a].shallow.indexOf(p)>=0?m:jn(m,e)}i instanceof Error&&(c.message=i.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(c.$name=a),c}throw new Error("can't serialize object of type "+typeof i)}function xa(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||$o(i)||At(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(xa);if(typeof i=="object"){const e=i.$name||"Object";if(!Tn[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:r}=Tn[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(i);const a=Object.create(r.prototype);for(const c of Object.keys(i)){if(c==="$name")continue;const p=i[c];a[c]=Tn[e].shallow.indexOf(c)>=0?p:xa(p)}return a}throw new Error("can't deserialize object of type "+typeof i)}class Xl{constructor(){this.first=!0}update(e,r){const a=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=a,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=a,!0):(this.lastFloorZoom>a?(this.lastIntegerZoom=a+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<a&&(this.lastIntegerZoom=a,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=a,!0))}}const Qe={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function Es(i){for(const e of i)if(Ps(e.charCodeAt(0)))return!0;return!1}function Is(i){for(const e of i)if(!hu(e.charCodeAt(0)))return!1;return!0}function hu(i){return!(Qe.Arabic(i)||Qe["Arabic Supplement"](i)||Qe["Arabic Extended-A"](i)||Qe["Arabic Presentation Forms-A"](i)||Qe["Arabic Presentation Forms-B"](i))}function Ps(i){return!(i!==746&&i!==747&&(i<4352||!(Qe["Bopomofo Extended"](i)||Qe.Bopomofo(i)||Qe["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||Qe["CJK Compatibility Ideographs"](i)||Qe["CJK Compatibility"](i)||Qe["CJK Radicals Supplement"](i)||Qe["CJK Strokes"](i)||!(!Qe["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Qe["CJK Unified Ideographs Extension A"](i)||Qe["CJK Unified Ideographs"](i)||Qe["Enclosed CJK Letters and Months"](i)||Qe["Hangul Compatibility Jamo"](i)||Qe["Hangul Jamo Extended-A"](i)||Qe["Hangul Jamo Extended-B"](i)||Qe["Hangul Jamo"](i)||Qe["Hangul Syllables"](i)||Qe.Hiragana(i)||Qe["Ideographic Description Characters"](i)||Qe.Kanbun(i)||Qe["Kangxi Radicals"](i)||Qe["Katakana Phonetic Extensions"](i)||Qe.Katakana(i)&&i!==12540||!(!Qe["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Qe["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||Qe["Unified Canadian Aboriginal Syllabics"](i)||Qe["Unified Canadian Aboriginal Syllabics Extended"](i)||Qe["Vertical Forms"](i)||Qe["Yijing Hexagram Symbols"](i)||Qe["Yi Syllables"](i)||Qe["Yi Radicals"](i))))}function Kl(i){return!(Ps(i)||function(e){return!!(Qe["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Qe["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Qe["Letterlike Symbols"](e)||Qe["Number Forms"](e)||Qe["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Qe["Control Pictures"](e)&&e!==9251||Qe["Optical Character Recognition"](e)||Qe["Enclosed Alphanumerics"](e)||Qe["Geometric Shapes"](e)||Qe["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Qe["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Qe["CJK Symbols and Punctuation"](e)||Qe.Katakana(e)||Qe["Private Use Area"](e)||Qe["CJK Compatibility Forms"](e)||Qe["Small Form Variants"](e)||Qe["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function Yl(i){return i>=1424&&i<=2303||Qe["Arabic Presentation Forms-A"](i)||Qe["Arabic Presentation Forms-B"](i)}function Jl(i,e){return!(!e&&Yl(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||Qe.Khmer(i))}function du(i){for(const e of i)if(Yl(e.charCodeAt(0)))return!0;return!1}const Ms="deferred",As="loading",ks="loaded";let zs=null,Er="unavailable",Vn=null;const Za=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(Er="error"),zs&&zs(i)};function Ls(){Ha.fire(new Mi("pluginStateChange",{pluginStatus:Er,pluginURL:Vn}))}const Ha=new gr,Ds=function(){return Er},Ql=function(){if(Er!==Ms||!Vn)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Er=As,Ls(),Vn&&Pt({url:Vn},i=>{i?Za(i):(Er=ks,Ls())})},Or={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Er===ks||Or.applyArabicShaping!=null,isLoading:()=>Er===As,setState(i){if(!st())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Er=i.pluginStatus,Vn=i.pluginURL},isParsed(){if(!st())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return Or.applyArabicShaping!=null&&Or.processBidirectionalText!=null&&Or.processStyledBidirectionalText!=null},getPluginURL(){if(!st())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Vn}};class _i{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Xl,this.transition={})}isSupportedScript(e){return function(r,a){for(const c of r)if(!Jl(c.charCodeAt(0),a))return!1;return!0}(e,Or.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),a=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*a}:{fromScale:.5,toScale:1,t:1-(1-a)*r}}}class Oo{constructor(e,r){this.property=e,this.value=r,this.expression=function(a,c){if(Ei(a))return new Ba(a,c);if(Io(a)){const p=ws(a,c);if(p.result==="error")throw new Error(p.value.map(m=>`${m.key}: ${m.message}`).join(", "));return p.value}{let p=a;return c.type==="color"&&typeof a=="string"?p=ui.parse(a):c.type!=="padding"||typeof a!="number"&&!Array.isArray(a)?c.type==="variableAnchorOffsetCollection"&&Array.isArray(a)&&(p=Zr.parse(a)):p=Lr.parse(a),{kind:"constant",evaluate:()=>p}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,a){return this.property.possiblyEvaluate(this,e,r,a)}}class Rs{constructor(e){this.property=e,this.value=new Oo(e,void 0)}transitioned(e,r){return new tc(this.property,this.value,r,$e({},e.transition,this.transition),e.now)}untransitioned(){return new tc(this.property,this.value,null,{},0)}}class ec{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Ge(this._values[e].value.value)}setValue(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Rs(this._values[e].property)),this._values[e].value=new Oo(this._values[e].property,r===null?void 0:Ge(r))}getTransition(e){return Ge(this._values[e].transition)}setTransition(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Rs(this._values[e].property)),this._values[e].transition=Ge(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const a=this.getValue(r);a!==void 0&&(e[r]=a);const c=this.getTransition(r);c!==void 0&&(e[`${r}-transition`]=c)}return e}transitioned(e,r){const a=new ic(this._properties);for(const c of Object.keys(this._values))a._values[c]=this._values[c].transitioned(e,r._values[c]);return a}untransitioned(){const e=new ic(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class tc{constructor(e,r,a,c,p){this.property=e,this.value=r,this.begin=p+c.delay||0,this.end=this.begin+c.duration||0,e.specification.transition&&(c.delay||c.duration)&&(this.prior=a)}possiblyEvaluate(e,r,a){const c=e.now||0,p=this.value.possiblyEvaluate(e,r,a),m=this.prior;if(m){if(c>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(c<this.begin)return m.possiblyEvaluate(e,r,a);{const g=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(e,r,a),p,function(b){if(b<=0)return 0;if(b>=1)return 1;const C=b*b,I=C*b;return 4*(b<.5?I:3*(b-C)+I-.75)}(g))}}return p}}class ic{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,a){const c=new Bo(this._properties);for(const p of Object.keys(this._values))c._values[p]=this._values[p].possiblyEvaluate(e,r,a);return c}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class pu{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}hasValue(e){return this._values[e].value!==void 0}getValue(e){return Ge(this._values[e].value)}setValue(e,r){this._values[e]=new Oo(this._values[e].property,r===null?void 0:Ge(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const a=this.getValue(r);a!==void 0&&(e[r]=a)}return e}possiblyEvaluate(e,r,a){const c=new Bo(this._properties);for(const p of Object.keys(this._values))c._values[p]=this._values[p].possiblyEvaluate(e,r,a);return c}}class yr{constructor(e,r,a){this.property=e,this.value=r,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,a,c){return this.property.evaluate(this.value,this.parameters,e,r,a,c)}}class Bo{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class pt{constructor(e){this.specification=e}possiblyEvaluate(e,r){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(r)}interpolate(e,r,a){const c=Dr[this.specification.type];return c?c(e,r,a):e}}class xt{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,a,c){return new yr(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},a,c)}:e.expression,r)}interpolate(e,r,a){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new yr(this,{kind:"constant",value:void 0},e.parameters);const c=Dr[this.specification.type];if(c){const p=c(e.value.value,r.value.value,a);return new yr(this,{kind:"constant",value:p},e.parameters)}return e}evaluate(e,r,a,c,p,m){return e.kind==="constant"?e.value:e.evaluate(r,a,c,p,m)}}class Wa extends xt{possiblyEvaluate(e,r,a,c){if(e.value===void 0)return new yr(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const p=e.expression.evaluate(r,null,{},a,c),m=e.property.specification.type==="resolvedImage"&&typeof p!="string"?p.name:p,g=this._calculate(m,m,m,r);return new yr(this,{kind:"constant",value:g},r)}if(e.expression.kind==="camera"){const p=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new yr(this,{kind:"constant",value:p},r)}return new yr(this,e.expression,r)}evaluate(e,r,a,c,p,m){if(e.kind==="source"){const g=e.evaluate(r,a,c,p,m);return this._calculate(g,g,g,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},a,c),e.evaluate({zoom:Math.floor(r.zoom)},a,c),e.evaluate({zoom:Math.floor(r.zoom)+1},a,c),r):e.value}_calculate(e,r,a,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:a,to:r}}interpolate(e){return e}}class $s{constructor(e){this.specification=e}possiblyEvaluate(e,r,a,c){if(e.value!==void 0){if(e.expression.kind==="constant"){const p=e.expression.evaluate(r,null,{},a,c);return this._calculate(p,p,p,r)}return this._calculate(e.expression.evaluate(new _i(Math.floor(r.zoom-1),r)),e.expression.evaluate(new _i(Math.floor(r.zoom),r)),e.expression.evaluate(new _i(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,a,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:a,to:r}}interpolate(e){return e}}class Os{constructor(e){this.specification=e}possiblyEvaluate(e,r,a,c){return!!e.expression.evaluate(r,null,{},a,c)}interpolate(){return!1}}class ji{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const a=e[r];a.specification.overridable&&this.overridableProperties.push(r);const c=this.defaultPropertyValues[r]=new Oo(a,void 0),p=this.defaultTransitionablePropertyValues[r]=new Rs(a);this.defaultTransitioningPropertyValues[r]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=c.possiblyEvaluate({})}}}it("DataDrivenProperty",xt),it("DataConstantProperty",pt),it("CrossFadedDataDrivenProperty",Wa),it("CrossFadedProperty",$s),it("ColorRampProperty",Os);const Bs="-transition";class Kr extends gr{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new pu(r.layout)),r.paint)){this._transitionablePaint=new ec(r.paint);for(const a in e.paint)this.setPaintProperty(a,e.paint[a],{validate:!1});for(const a in e.layout)this.setLayoutProperty(a,e.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Bo(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,a={}){r!=null&&this._validate(Wl,`layers.${this.id}.layout.${e}`,e,r,a)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return e.endsWith(Bs)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,a={}){if(r!=null&&this._validate(Ts,`layers.${this.id}.paint.${e}`,e,r,a))return!1;if(e.endsWith(Bs))return this._transitionablePaint.setTransition(e.slice(0,-11),r||void 0),!1;{const c=this._transitionablePaint._values[e],p=c.property.specification["property-type"]==="cross-faded-data-driven",m=c.value.isDataDriven(),g=c.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const b=this._transitionablePaint._values[e].value;return b.isDataDriven()||m||p||this._handleOverridablePaintPropertyUpdate(e,g,b)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,r,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),je(e,(r,a)=>!(r===void 0||a==="layout"&&!Object.keys(r).length||a==="paint"&&!Object.keys(r).length))}_validate(e,r,a,c,p={}){return(!p||p.validate!==!1)&&Ro(this,e.call(Cn,{key:r,layerType:this.type,objectKey:a,value:c,styleSpec:Te,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof yr&&ga(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const rc={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ta{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class zi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Pi(i,e=1){let r=0,a=0;return{members:i.map(c=>{const p=rc[c.type].BYTES_PER_ELEMENT,m=r=ba(r,Math.max(e,p)),g=c.components||1;return a=Math.max(a,p),r+=p*g,{name:c.name,type:c.type,components:g,offset:m}}),size:ba(r,Math.max(a,e)),alignment:e}}function ba(i,e){return Math.ceil(i/e)*e}class Xa extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const c=2*e;return this.int16[c+0]=r,this.int16[c+1]=a,e}}Xa.prototype.bytesPerElement=4,it("StructArrayLayout2i4",Xa);class Ka extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,a)}emplace(e,r,a,c){const p=3*e;return this.int16[p+0]=r,this.int16[p+1]=a,this.int16[p+2]=c,e}}Ka.prototype.bytesPerElement=6,it("StructArrayLayout3i6",Ka);class ia extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,c){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,a,c)}emplace(e,r,a,c,p){const m=4*e;return this.int16[m+0]=r,this.int16[m+1]=a,this.int16[m+2]=c,this.int16[m+3]=p,e}}ia.prototype.bytesPerElement=8,it("StructArrayLayout4i8",ia);class Fs extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,c,p,m){const g=this.length;return this.resize(g+1),this.emplace(g,e,r,a,c,p,m)}emplace(e,r,a,c,p,m,g){const b=6*e;return this.int16[b+0]=r,this.int16[b+1]=a,this.int16[b+2]=c,this.int16[b+3]=p,this.int16[b+4]=m,this.int16[b+5]=g,e}}Fs.prototype.bytesPerElement=12,it("StructArrayLayout2i4i12",Fs);class Ns extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,c,p,m){const g=this.length;return this.resize(g+1),this.emplace(g,e,r,a,c,p,m)}emplace(e,r,a,c,p,m,g){const b=4*e,C=8*e;return this.int16[b+0]=r,this.int16[b+1]=a,this.uint8[C+4]=c,this.uint8[C+5]=p,this.uint8[C+6]=m,this.uint8[C+7]=g,e}}Ns.prototype.bytesPerElement=8,it("StructArrayLayout2i4ub8",Ns);class wa extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const c=2*e;return this.float32[c+0]=r,this.float32[c+1]=a,e}}wa.prototype.bytesPerElement=8,it("StructArrayLayout2f8",wa);class js extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,c,p,m,g,b,C,I){const A=this.length;return this.resize(A+1),this.emplace(A,e,r,a,c,p,m,g,b,C,I)}emplace(e,r,a,c,p,m,g,b,C,I,A){const R=10*e;return this.uint16[R+0]=r,this.uint16[R+1]=a,this.uint16[R+2]=c,this.uint16[R+3]=p,this.uint16[R+4]=m,this.uint16[R+5]=g,this.uint16[R+6]=b,this.uint16[R+7]=C,this.uint16[R+8]=I,this.uint16[R+9]=A,e}}js.prototype.bytesPerElement=20,it("StructArrayLayout10ui20",js);class Vs extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,c,p,m,g,b,C,I,A,R){const F=this.length;return this.resize(F+1),this.emplace(F,e,r,a,c,p,m,g,b,C,I,A,R)}emplace(e,r,a,c,p,m,g,b,C,I,A,R,F){const N=12*e;return this.int16[N+0]=r,this.int16[N+1]=a,this.int16[N+2]=c,this.int16[N+3]=p,this.uint16[N+4]=m,this.uint16[N+5]=g,this.uint16[N+6]=b,this.uint16[N+7]=C,this.int16[N+8]=I,this.int16[N+9]=A,this.int16[N+10]=R,this.int16[N+11]=F,e}}Vs.prototype.bytesPerElement=24,it("StructArrayLayout4i4ui4i24",Vs);class oi extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,a)}emplace(e,r,a,c){const p=3*e;return this.float32[p+0]=r,this.float32[p+1]=a,this.float32[p+2]=c,e}}oi.prototype.bytesPerElement=12,it("StructArrayLayout3f12",oi);class d extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}d.prototype.bytesPerElement=4,it("StructArrayLayout1ul4",d);class t extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,c,p,m,g,b,C){const I=this.length;return this.resize(I+1),this.emplace(I,e,r,a,c,p,m,g,b,C)}emplace(e,r,a,c,p,m,g,b,C,I){const A=10*e,R=5*e;return this.int16[A+0]=r,this.int16[A+1]=a,this.int16[A+2]=c,this.int16[A+3]=p,this.int16[A+4]=m,this.int16[A+5]=g,this.uint32[R+3]=b,this.uint16[A+8]=C,this.uint16[A+9]=I,e}}t.prototype.bytesPerElement=20,it("StructArrayLayout6i1ul2ui20",t);class n extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,c,p,m){const g=this.length;return this.resize(g+1),this.emplace(g,e,r,a,c,p,m)}emplace(e,r,a,c,p,m,g){const b=6*e;return this.int16[b+0]=r,this.int16[b+1]=a,this.int16[b+2]=c,this.int16[b+3]=p,this.int16[b+4]=m,this.int16[b+5]=g,e}}n.prototype.bytesPerElement=12,it("StructArrayLayout2i2i2i12",n);class l extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,c,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,a,c,p)}emplace(e,r,a,c,p,m){const g=4*e,b=8*e;return this.float32[g+0]=r,this.float32[g+1]=a,this.float32[g+2]=c,this.int16[b+6]=p,this.int16[b+7]=m,e}}l.prototype.bytesPerElement=16,it("StructArrayLayout2f1f2i16",l);class u extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,c){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,a,c)}emplace(e,r,a,c,p){const m=12*e,g=3*e;return this.uint8[m+0]=r,this.uint8[m+1]=a,this.float32[g+1]=c,this.float32[g+2]=p,e}}u.prototype.bytesPerElement=12,it("StructArrayLayout2ub2f12",u);class f extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,a)}emplace(e,r,a,c){const p=3*e;return this.uint16[p+0]=r,this.uint16[p+1]=a,this.uint16[p+2]=c,e}}f.prototype.bytesPerElement=6,it("StructArrayLayout3ui6",f);class _ extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,c,p,m,g,b,C,I,A,R,F,N,G,Y,ie){const ue=this.length;return this.resize(ue+1),this.emplace(ue,e,r,a,c,p,m,g,b,C,I,A,R,F,N,G,Y,ie)}emplace(e,r,a,c,p,m,g,b,C,I,A,R,F,N,G,Y,ie,ue){const re=24*e,de=12*e,ye=48*e;return this.int16[re+0]=r,this.int16[re+1]=a,this.uint16[re+2]=c,this.uint16[re+3]=p,this.uint32[de+2]=m,this.uint32[de+3]=g,this.uint32[de+4]=b,this.uint16[re+10]=C,this.uint16[re+11]=I,this.uint16[re+12]=A,this.float32[de+7]=R,this.float32[de+8]=F,this.uint8[ye+36]=N,this.uint8[ye+37]=G,this.uint8[ye+38]=Y,this.uint32[de+10]=ie,this.int16[re+22]=ue,e}}_.prototype.bytesPerElement=48,it("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",_);class v extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,c,p,m,g,b,C,I,A,R,F,N,G,Y,ie,ue,re,de,ye,ke,et,ct,Je,Xe,qe,rt){const Ze=this.length;return this.resize(Ze+1),this.emplace(Ze,e,r,a,c,p,m,g,b,C,I,A,R,F,N,G,Y,ie,ue,re,de,ye,ke,et,ct,Je,Xe,qe,rt)}emplace(e,r,a,c,p,m,g,b,C,I,A,R,F,N,G,Y,ie,ue,re,de,ye,ke,et,ct,Je,Xe,qe,rt,Ze){const Ne=32*e,yt=16*e;return this.int16[Ne+0]=r,this.int16[Ne+1]=a,this.int16[Ne+2]=c,this.int16[Ne+3]=p,this.int16[Ne+4]=m,this.int16[Ne+5]=g,this.int16[Ne+6]=b,this.int16[Ne+7]=C,this.uint16[Ne+8]=I,this.uint16[Ne+9]=A,this.uint16[Ne+10]=R,this.uint16[Ne+11]=F,this.uint16[Ne+12]=N,this.uint16[Ne+13]=G,this.uint16[Ne+14]=Y,this.uint16[Ne+15]=ie,this.uint16[Ne+16]=ue,this.uint16[Ne+17]=re,this.uint16[Ne+18]=de,this.uint16[Ne+19]=ye,this.uint16[Ne+20]=ke,this.uint16[Ne+21]=et,this.uint16[Ne+22]=ct,this.uint32[yt+12]=Je,this.float32[yt+13]=Xe,this.float32[yt+14]=qe,this.uint16[Ne+30]=rt,this.uint16[Ne+31]=Ze,e}}v.prototype.bytesPerElement=64,it("StructArrayLayout8i15ui1ul2f2ui64",v);class S extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}S.prototype.bytesPerElement=4,it("StructArrayLayout1f4",S);class T extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,a)}emplace(e,r,a,c){const p=3*e;return this.uint16[6*e+0]=r,this.float32[p+1]=a,this.float32[p+2]=c,e}}T.prototype.bytesPerElement=12,it("StructArrayLayout1ui2f12",T);class P extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,a)}emplace(e,r,a,c){const p=4*e;return this.uint32[2*e+0]=r,this.uint16[p+2]=a,this.uint16[p+3]=c,e}}P.prototype.bytesPerElement=8,it("StructArrayLayout1ul2ui8",P);class M extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const c=2*e;return this.uint16[c+0]=r,this.uint16[c+1]=a,e}}M.prototype.bytesPerElement=4,it("StructArrayLayout2ui4",M);class B extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}B.prototype.bytesPerElement=2,it("StructArrayLayout1ui2",B);class H extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,c){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,a,c)}emplace(e,r,a,c,p){const m=4*e;return this.float32[m+0]=r,this.float32[m+1]=a,this.float32[m+2]=c,this.float32[m+3]=p,e}}H.prototype.bytesPerElement=16,it("StructArrayLayout4f16",H);class Z extends ta{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new Q(this.anchorPointX,this.anchorPointY)}}Z.prototype.size=20;class X extends t{get(e){return new Z(this,e)}}it("CollisionBoxArray",X);class U extends ta{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}U.prototype.size=48;class oe extends _{get(e){return new U(this,e)}}it("PlacedSymbolArray",oe);class pe extends ta{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}pe.prototype.size=64;class ee extends v{get(e){return new pe(this,e)}}it("SymbolInstanceArray",ee);class le extends S{getoffsetX(e){return this.float32[1*e+0]}}it("GlyphOffsetArray",le);class _e extends Ka{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}it("SymbolLineVertexArray",_e);class we extends ta{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}we.prototype.size=12;class Me extends T{get(e){return new we(this,e)}}it("TextAnchorOffsetArray",Me);class Fe extends ta{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Fe.prototype.size=8;class Re extends P{get(e){return new Fe(this,e)}}it("FeatureIndexArray",Re);class Ue extends Xa{}class lt extends Xa{}class Ut extends Xa{}class We extends Fs{}class bt extends Ns{}class ut extends wa{}class hi extends js{}class Vt extends Vs{}class Dt extends oi{}class qt extends d{}class $i extends n{}class fi extends u{}class lr extends f{}class Yi extends M{}const Vi=Pi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Br}=Vi;class vi{constructor(e=[]){this.segments=e}prepareSegment(e,r,a,c){let p=this.segments[this.segments.length-1];return e>vi.MAX_VERTEX_ARRAY_LENGTH&&He(`Max vertices per segment is ${vi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!p||p.vertexLength+e>vi.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==c)&&(p={vertexOffset:r.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},c!==void 0&&(p.sortKey=c),this.segments.push(p)),p}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,a,c){return new vi([{vertexOffset:e,primitiveOffset:r,vertexLength:a,primitiveLength:c,vaos:{},sortKey:0}])}}function hn(i,e){return 256*(i=ze(Math.floor(i),0,255))+ze(Math.floor(e),0,255)}vi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,it("SegmentVector",vi);const dn=Pi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Un={exports:{}},ra={exports:{}};ra.exports=function(i,e){var r,a,c,p,m,g,b,C;for(a=i.length-(r=3&i.length),c=e,m=3432918353,g=461845907,C=0;C<a;)b=255&i.charCodeAt(C)|(255&i.charCodeAt(++C))<<8|(255&i.charCodeAt(++C))<<16|(255&i.charCodeAt(++C))<<24,++C,c=27492+(65535&(p=5*(65535&(c=(c^=b=(65535&(b=(b=(65535&b)*m+(((b>>>16)*m&65535)<<16)&4294967295)<<15|b>>>17))*g+(((b>>>16)*g&65535)<<16)&4294967295)<<13|c>>>19))+((5*(c>>>16)&65535)<<16)&4294967295))+((58964+(p>>>16)&65535)<<16);switch(b=0,r){case 3:b^=(255&i.charCodeAt(C+2))<<16;case 2:b^=(255&i.charCodeAt(C+1))<<8;case 1:c^=b=(65535&(b=(b=(65535&(b^=255&i.charCodeAt(C)))*m+(((b>>>16)*m&65535)<<16)&4294967295)<<15|b>>>17))*g+(((b>>>16)*g&65535)<<16)&4294967295}return c^=i.length,c=2246822507*(65535&(c^=c>>>16))+((2246822507*(c>>>16)&65535)<<16)&4294967295,c=3266489909*(65535&(c^=c>>>13))+((3266489909*(c>>>16)&65535)<<16)&4294967295,(c^=c>>>16)>>>0};var Sa=ra.exports,dr={exports:{}};dr.exports=function(i,e){for(var r,a=i.length,c=e^a,p=0;a>=4;)r=1540483477*(65535&(r=255&i.charCodeAt(p)|(255&i.charCodeAt(++p))<<8|(255&i.charCodeAt(++p))<<16|(255&i.charCodeAt(++p))<<24))+((1540483477*(r>>>16)&65535)<<16),c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),a-=4,++p;switch(a){case 3:c^=(255&i.charCodeAt(p+2))<<16;case 2:c^=(255&i.charCodeAt(p+1))<<8;case 1:c=1540483477*(65535&(c^=255&i.charCodeAt(p)))+((1540483477*(c>>>16)&65535)<<16)}return c=1540483477*(65535&(c^=c>>>13))+((1540483477*(c>>>16)&65535)<<16),(c^=c>>>15)>>>0};var cr=Sa,_r=dr.exports;Un.exports=cr,Un.exports.murmur3=cr,Un.exports.murmur2=_r;var na=L(Un.exports);class Oi{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,a,c){this.ids.push(Ji(e)),this.positions.push(r,a,c)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=Ji(e);let a=0,c=this.ids.length-1;for(;a<c;){const m=a+c>>1;this.ids[m]>=r?c=m:a=m+1}const p=[];for(;this.ids[a]===r;)p.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return p}static serialize(e,r){const a=new Float64Array(e.ids),c=new Uint32Array(e.positions);return Ir(a,c,0,a.length-1),r&&r.push(a.buffer,c.buffer),{ids:a,positions:c}}static deserialize(e){const r=new Oi;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function Ji(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:na(String(i))}function Ir(i,e,r,a){for(;r<a;){const c=i[r+a>>1];let p=r-1,m=a+1;for(;;){do p++;while(i[p]<c);do m--;while(i[m]>c);if(p>=m)break;Bi(i,p,m),Bi(e,3*p,3*m),Bi(e,3*p+1,3*m+1),Bi(e,3*p+2,3*m+2)}m-r<a-m?(Ir(i,e,r,m),r=m+1):(Ir(i,e,m+1,a),a=m)}}function Bi(i,e,r){const a=i[e];i[e]=i[r],i[r]=a}it("FeaturePositionMap",Oi);class aa{constructor(e,r){this.gl=e.gl,this.location=r}}class Fo extends aa{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class nc extends aa{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class ac extends aa{constructor(e,r){super(e,r),this.current=ui.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const fu=new Float32Array(16);function Us(i){return[hn(255*i.r,255*i.g),hn(255*i.b,255*i.a)]}class pn{constructor(e,r,a){this.value=e,this.uniformNames=r.map(c=>`u_${c}`),this.type=a}setUniform(e,r,a){e.set(a.constantOr(this.value))}getBinding(e,r,a){return this.type==="color"?new ac(e,r):new Fo(e,r)}}class oa{constructor(e,r){this.uniformNames=r.map(a=>`u_${a}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=e.tlbr}setUniform(e,r,a,c){const p=c==="u_pattern_to"?this.patternTo:c==="u_pattern_from"?this.patternFrom:c==="u_pixel_ratio_to"?this.pixelRatioTo:c==="u_pixel_ratio_from"?this.pixelRatioFrom:null;p&&e.set(p)}getBinding(e,r,a){return a.substr(0,9)==="u_pattern"?new nc(e,r):new Fo(e,r)}}class fn{constructor(e,r,a,c){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=r.map(p=>({name:`a_${p}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,r,a,c,p){const m=this.paintVertexArray.length,g=this.expression.evaluate(new _i(0),r,{},c,[],p);this.paintVertexArray.resize(e),this._setPaintValue(m,e,g)}updatePaintArray(e,r,a,c){const p=this.expression.evaluate({zoom:0},a,c);this._setPaintValue(e,r,p)}_setPaintValue(e,r,a){if(this.type==="color"){const c=Us(a);for(let p=e;p<r;p++)this.paintVertexArray.emplace(p,c[0],c[1])}else{for(let c=e;c<r;c++)this.paintVertexArray.emplace(c,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Yr{constructor(e,r,a,c,p,m){this.expression=e,this.uniformNames=r.map(g=>`u_${g}_t`),this.type=a,this.useIntegerZoom=c,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=r.map(g=>({name:`a_${g}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(e,r,a,c,p){const m=this.expression.evaluate(new _i(this.zoom),r,{},c,[],p),g=this.expression.evaluate(new _i(this.zoom+1),r,{},c,[],p),b=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(b,e,m,g)}updatePaintArray(e,r,a,c){const p=this.expression.evaluate({zoom:this.zoom},a,c),m=this.expression.evaluate({zoom:this.zoom+1},a,c);this._setPaintValue(e,r,p,m)}_setPaintValue(e,r,a,c){if(this.type==="color"){const p=Us(a),m=Us(c);for(let g=e;g<r;g++)this.paintVertexArray.emplace(g,p[0],p[1],m[0],m[1])}else{for(let p=e;p<r;p++)this.paintVertexArray.emplace(p,a,c);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const a=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,c=ze(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);e.set(c)}getBinding(e,r,a){return new Fo(e,r)}}class mn{constructor(e,r,a,c,p,m){this.expression=e,this.type=r,this.useIntegerZoom=a,this.zoom=c,this.layerId=m,this.zoomInPaintVertexArray=new p,this.zoomOutPaintVertexArray=new p}populatePaintArray(e,r,a){const c=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(c,e,r.patterns&&r.patterns[this.layerId],a)}updatePaintArray(e,r,a,c,p){this._setPaintValues(e,r,a.patterns&&a.patterns[this.layerId],p)}_setPaintValues(e,r,a,c){if(!c||!a)return;const{min:p,mid:m,max:g}=a,b=c[p],C=c[m],I=c[g];if(b&&C&&I)for(let A=e;A<r;A++)this.zoomInPaintVertexArray.emplace(A,C.tl[0],C.tl[1],C.br[0],C.br[1],b.tl[0],b.tl[1],b.br[0],b.br[1],C.pixelRatio,b.pixelRatio),this.zoomOutPaintVertexArray.emplace(A,C.tl[0],C.tl[1],C.br[0],C.br[1],I.tl[0],I.tl[1],I.br[0],I.br[1],C.pixelRatio,I.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,dn.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,dn.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class qs{constructor(e,r,a){this.binders={},this._buffers=[];const c=[];for(const p in e.paint._values){if(!a(p))continue;const m=e.paint.get(p);if(!(m instanceof yr&&ga(m.property.specification)))continue;const g=jg(p,e.type),b=m.value,C=m.property.specification.type,I=m.property.useIntegerZoom,A=m.property.specification["property-type"],R=A==="cross-faded"||A==="cross-faded-data-driven";if(b.kind==="constant")this.binders[p]=R?new oa(b.value,g):new pn(b.value,g,C),c.push(`/u_${p}`);else if(b.kind==="source"||R){const F=ad(p,C,"source");this.binders[p]=R?new mn(b,C,I,r,F,e.id):new fn(b,g,C,F),c.push(`/a_${p}`)}else{const F=ad(p,C,"composite");this.binders[p]=new Yr(b,g,C,I,r,F),c.push(`/z_${p}`)}}this.cacheKey=c.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof fn||r instanceof Yr?r.maxValue:0}populatePaintArrays(e,r,a,c,p){for(const m in this.binders){const g=this.binders[m];(g instanceof fn||g instanceof Yr||g instanceof mn)&&g.populatePaintArray(e,r,a,c,p)}}setConstantPatternPositions(e,r){for(const a in this.binders){const c=this.binders[a];c instanceof oa&&c.setConstantPatternPositions(e,r)}}updatePaintArrays(e,r,a,c,p){let m=!1;for(const g in e){const b=r.getPositions(g);for(const C of b){const I=a.feature(C.index);for(const A in this.binders){const R=this.binders[A];if((R instanceof fn||R instanceof Yr||R instanceof mn)&&R.expression.isStateDependent===!0){const F=c.paint.get(A);R.expression=F.value,R.updatePaintArray(C.start,C.end,I,e[g],p),m=!0}}}}return m}defines(){const e=[];for(const r in this.binders){const a=this.binders[r];(a instanceof pn||a instanceof oa)&&e.push(...a.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof fn||a instanceof Yr)for(let c=0;c<a.paintVertexAttributes.length;c++)e.push(a.paintVertexAttributes[c].name);else if(a instanceof mn)for(let c=0;c<dn.members.length;c++)e.push(dn.members[c].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof pn||a instanceof oa||a instanceof Yr)for(const c of a.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const a=[];for(const c in this.binders){const p=this.binders[c];if(p instanceof pn||p instanceof oa||p instanceof Yr){for(const m of p.uniformNames)if(r[m]){const g=p.getBinding(e,r[m],m);a.push({name:m,property:c,binding:g})}}}return a}setUniforms(e,r,a,c){for(const{name:p,property:m,binding:g}of r)this.binders[m].setUniform(g,c,a.get(m),p)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const a=this.binders[r];if(e&&a instanceof mn){const c=e.fromScale===2?a.zoomInPaintVertexBuffer:a.zoomOutPaintVertexBuffer;c&&this._buffers.push(c)}else(a instanceof fn||a instanceof Yr)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(e){for(const r in this.binders){const a=this.binders[r];(a instanceof fn||a instanceof Yr||a instanceof mn)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof fn||r instanceof Yr||r instanceof mn)&&r.destroy()}}}class En{constructor(e,r,a=()=>!0){this.programConfigurations={};for(const c of e)this.programConfigurations[c.id]=new qs(c,r,a);this.needsUpload=!1,this._featureMap=new Oi,this._bufferOffset=0}populatePaintArrays(e,r,a,c,p,m){for(const g in this.programConfigurations)this.programConfigurations[g].populatePaintArrays(e,r,c,p,m);r.id!==void 0&&this._featureMap.add(r.id,a,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,a,c){for(const p of a)this.needsUpload=this.programConfigurations[p.id].updatePaintArrays(e,this._featureMap,r,p,c)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function jg(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function ad(i,e,r){const a={color:{source:wa,composite:H},number:{source:S,composite:wa}},c=function(p){return{"line-pattern":{source:hi,composite:hi},"fill-pattern":{source:hi,composite:hi},"fill-extrusion-pattern":{source:hi,composite:hi}}[p]}(i);return c&&c[r]||a[e][r]}it("ConstantBinder",pn),it("CrossFadedConstantBinder",oa),it("SourceExpressionBinder",fn),it("CrossFadedCompositeBinder",mn),it("CompositeExpressionBinder",Yr),it("ProgramConfiguration",qs,{omit:["_buffers"]}),it("ProgramConfigurationSet",En);const Hi=8192,mu=Math.pow(2,14)-1,od=-mu-1;function Ya(i){const e=Hi/i.extent,r=i.loadGeometry();for(let a=0;a<r.length;a++){const c=r[a];for(let p=0;p<c.length;p++){const m=c[p],g=Math.round(m.x*e),b=Math.round(m.y*e);m.x=ze(g,od,mu),m.y=ze(b,od,mu),(g<m.x||g>m.x+1||b<m.y||b>m.y+1)&&He("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function Ja(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?Ya(i):[]}}function oc(i,e,r,a,c){i.emplaceBack(2*e+(a+1)/2,2*r+(c+1)/2)}class gu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new lt,this.indexArray=new lr,this.segments=new vi,this.programConfigurations=new En(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a){const c=this.layers[0],p=[];let m=null,g=!1;c.type==="circle"&&(m=c.layout.get("circle-sort-key"),g=!m.isConstant());for(const{feature:b,id:C,index:I,sourceLayerIndex:A}of e){const R=this.layers[0]._featureFilter.needGeometry,F=Ja(b,R);if(!this.layers[0]._featureFilter.filter(new _i(this.zoom),F,a))continue;const N=g?m.evaluate(F,{},a):void 0,G={id:C,properties:b.properties,type:b.type,sourceLayerIndex:A,index:I,geometry:R?F.geometry:Ya(b),patterns:{},sortKey:N};p.push(G)}g&&p.sort((b,C)=>b.sortKey-C.sortKey);for(const b of p){const{geometry:C,index:I,sourceLayerIndex:A}=b,R=e[I].feature;this.addFeature(b,C,I,a),r.featureIndex.insert(R,C,I,A,this.index)}}update(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Br),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,a,c){for(const p of r)for(const m of p){const g=m.x,b=m.y;if(g<0||g>=Hi||b<0||b>=Hi)continue;const C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),I=C.vertexLength;oc(this.layoutVertexArray,g,b,-1,-1),oc(this.layoutVertexArray,g,b,1,-1),oc(this.layoutVertexArray,g,b,1,1),oc(this.layoutVertexArray,g,b,-1,1),this.indexArray.emplaceBack(I,I+1,I+2),this.indexArray.emplaceBack(I,I+3,I+2),C.vertexLength+=4,C.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},c)}}function sd(i,e){for(let r=0;r<i.length;r++)if(No(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(No(i,e[r]))return!0;return!!yu(i,e)}function Vg(i,e,r){return!!No(i,e)||!!_u(e,i,r)}function ld(i,e){if(i.length===1)return ud(e,i[0]);for(let r=0;r<e.length;r++){const a=e[r];for(let c=0;c<a.length;c++)if(No(i,a[c]))return!0}for(let r=0;r<i.length;r++)if(ud(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(yu(i,e[r]))return!0;return!1}function Ug(i,e,r){if(i.length>1){if(yu(i,e))return!0;for(let a=0;a<e.length;a++)if(_u(e[a],i,r))return!0}for(let a=0;a<i.length;a++)if(_u(i[a],e,r))return!0;return!1}function yu(i,e){if(i.length===0||e.length===0)return!1;for(let r=0;r<i.length-1;r++){const a=i[r],c=i[r+1];for(let p=0;p<e.length-1;p++)if(qg(a,c,e[p],e[p+1]))return!0}return!1}function qg(i,e,r,a){return ot(i,r,a)!==ot(e,r,a)&&ot(i,e,r)!==ot(i,e,a)}function _u(i,e,r){const a=r*r;if(e.length===1)return i.distSqr(e[0])<a;for(let c=1;c<e.length;c++)if(cd(i,e[c-1],e[c])<a)return!0;return!1}function cd(i,e,r){const a=e.distSqr(r);if(a===0)return i.distSqr(e);const c=((i.x-e.x)*(r.x-e.x)+(i.y-e.y)*(r.y-e.y))/a;return i.distSqr(c<0?e:c>1?r:r.sub(e)._mult(c)._add(e))}function ud(i,e){let r,a,c,p=!1;for(let m=0;m<i.length;m++){r=i[m];for(let g=0,b=r.length-1;g<r.length;b=g++)a=r[g],c=r[b],a.y>e.y!=c.y>e.y&&e.x<(c.x-a.x)*(e.y-a.y)/(c.y-a.y)+a.x&&(p=!p)}return p}function No(i,e){let r=!1;for(let a=0,c=i.length-1;a<i.length;c=a++){const p=i[a],m=i[c];p.y>e.y!=m.y>e.y&&e.x<(m.x-p.x)*(e.y-p.y)/(m.y-p.y)+p.x&&(r=!r)}return r}function Gg(i,e,r){const a=r[0],c=r[2];if(i.x<a.x&&e.x<a.x||i.x>c.x&&e.x>c.x||i.y<a.y&&e.y<a.y||i.y>c.y&&e.y>c.y)return!1;const p=ot(i,e,r[0]);return p!==ot(i,e,r[1])||p!==ot(i,e,r[2])||p!==ot(i,e,r[3])}function Gs(i,e,r){const a=e.paint.get(i).value;return a.kind==="constant"?a.value:r.programConfigurations.get(e.id).getMaxValue(i)}function sc(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function lc(i,e,r,a,c){if(!e[0]&&!e[1])return i;const p=Q.convert(e)._mult(c);r==="viewport"&&p._rotate(-a);const m=[];for(let g=0;g<i.length;g++)m.push(i[g].sub(p));return m}let hd,dd;it("CircleBucket",gu,{omit:["layers"]});var Zg={get paint(){return dd=dd||new ji({"circle-radius":new xt(Te.paint_circle["circle-radius"]),"circle-color":new xt(Te.paint_circle["circle-color"]),"circle-blur":new xt(Te.paint_circle["circle-blur"]),"circle-opacity":new xt(Te.paint_circle["circle-opacity"]),"circle-translate":new pt(Te.paint_circle["circle-translate"]),"circle-translate-anchor":new pt(Te.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new pt(Te.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new pt(Te.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new xt(Te.paint_circle["circle-stroke-width"]),"circle-stroke-color":new xt(Te.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new xt(Te.paint_circle["circle-stroke-opacity"])})},get layout(){return hd=hd||new ji({"circle-sort-key":new xt(Te.layout_circle["circle-sort-key"])})}},Pr=1e-6,jo=typeof Float32Array<"u"?Float32Array:Array;function vu(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function pd(i,e,r){var a=e[0],c=e[1],p=e[2],m=e[3],g=e[4],b=e[5],C=e[6],I=e[7],A=e[8],R=e[9],F=e[10],N=e[11],G=e[12],Y=e[13],ie=e[14],ue=e[15],re=r[0],de=r[1],ye=r[2],ke=r[3];return i[0]=re*a+de*g+ye*A+ke*G,i[1]=re*c+de*b+ye*R+ke*Y,i[2]=re*p+de*C+ye*F+ke*ie,i[3]=re*m+de*I+ye*N+ke*ue,i[4]=(re=r[4])*a+(de=r[5])*g+(ye=r[6])*A+(ke=r[7])*G,i[5]=re*c+de*b+ye*R+ke*Y,i[6]=re*p+de*C+ye*F+ke*ie,i[7]=re*m+de*I+ye*N+ke*ue,i[8]=(re=r[8])*a+(de=r[9])*g+(ye=r[10])*A+(ke=r[11])*G,i[9]=re*c+de*b+ye*R+ke*Y,i[10]=re*p+de*C+ye*F+ke*ie,i[11]=re*m+de*I+ye*N+ke*ue,i[12]=(re=r[12])*a+(de=r[13])*g+(ye=r[14])*A+(ke=r[15])*G,i[13]=re*c+de*b+ye*R+ke*Y,i[14]=re*p+de*C+ye*F+ke*ie,i[15]=re*m+de*I+ye*N+ke*ue,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var Zs,Hg=pd;function cc(i,e,r){var a=e[0],c=e[1],p=e[2],m=e[3];return i[0]=r[0]*a+r[4]*c+r[8]*p+r[12]*m,i[1]=r[1]*a+r[5]*c+r[9]*p+r[13]*m,i[2]=r[2]*a+r[6]*c+r[10]*p+r[14]*m,i[3]=r[3]*a+r[7]*c+r[11]*p+r[15]*m,i}Zs=new jo(4),jo!=Float32Array&&(Zs[0]=0,Zs[1]=0,Zs[2]=0,Zs[3]=0);class Wg extends Kr{constructor(e){super(e,Zg)}createBucket(e){return new gu(e)}queryRadius(e){const r=e;return Gs("circle-radius",this,r)+Gs("circle-stroke-width",this,r)+sc(this.paint.get("circle-translate"))}queryIntersectsFeature(e,r,a,c,p,m,g,b){const C=lc(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,g),I=this.paint.get("circle-radius").evaluate(r,a)+this.paint.get("circle-stroke-width").evaluate(r,a),A=this.paint.get("circle-pitch-alignment")==="map",R=A?C:function(N,G){return N.map(Y=>fd(Y,G))}(C,b),F=A?I*g:I;for(const N of c)for(const G of N){const Y=A?G:fd(G,b);let ie=F;const ue=cc([],[G.x,G.y,0,1],b);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ie*=ue[3]/m.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ie*=m.cameraToCenterDistance/ue[3]),Vg(R,Y,ie))return!0}return!1}}function fd(i,e){const r=cc([],[i.x,i.y,0,1],e);return new Q(r[0]/r[3],r[1]/r[3])}class md extends gu{}let gd;it("HeatmapBucket",md,{omit:["layers"]});var Xg={get paint(){return gd=gd||new ji({"heatmap-radius":new xt(Te.paint_heatmap["heatmap-radius"]),"heatmap-weight":new xt(Te.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new pt(Te.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Os(Te.paint_heatmap["heatmap-color"]),"heatmap-opacity":new pt(Te.paint_heatmap["heatmap-opacity"])})}};function xu(i,{width:e,height:r},a,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*r*a)throw new RangeError(`mismatched image size. expected: ${c.length} but got: ${e*r*a}`)}else c=new Uint8Array(e*r*a);return i.width=e,i.height=r,i.data=c,i}function yd(i,{width:e,height:r},a){if(e===i.width&&r===i.height)return;const c=xu({},{width:e,height:r},a);bu(i,c,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,r)},a),i.width=e,i.height=r,i.data=c.data}function bu(i,e,r,a,c,p){if(c.width===0||c.height===0)return e;if(c.width>i.width||c.height>i.height||r.x>i.width-c.width||r.y>i.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||a.x>e.width-c.width||a.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const m=i.data,g=e.data;if(m===g)throw new Error("srcData equals dstData, so image is already copied");for(let b=0;b<c.height;b++){const C=((r.y+b)*i.width+r.x)*p,I=((a.y+b)*e.width+a.x)*p;for(let A=0;A<c.width*p;A++)g[I+A]=m[C+A]}return e}class Hs{constructor(e,r){xu(this,e,1,r)}resize(e){yd(this,e,1)}clone(){return new Hs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,a,c,p){bu(e,r,a,c,p,1)}}class tn{constructor(e,r){xu(this,e,4,r)}resize(e){yd(this,e,4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new tn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,a,c,p){bu(e,r,a,c,p,4)}}function _d(i){const e={},r=i.resolution||256,a=i.clips?i.clips.length:1,c=i.image||new tn({width:r,height:a});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const p=(m,g,b)=>{e[i.evaluationKey]=b;const C=i.expression.evaluate(e);c.data[m+g+0]=Math.floor(255*C.r/C.a),c.data[m+g+1]=Math.floor(255*C.g/C.a),c.data[m+g+2]=Math.floor(255*C.b/C.a),c.data[m+g+3]=Math.floor(255*C.a)};if(i.clips)for(let m=0,g=0;m<a;++m,g+=4*r)for(let b=0,C=0;b<r;b++,C+=4){const I=b/(r-1),{start:A,end:R}=i.clips[m];p(g,C,A*(1-I)+R*I)}else for(let m=0,g=0;m<r;m++,g+=4)p(0,g,m/(r-1));return c}it("AlphaImage",Hs),it("RGBAImage",tn);class Kg extends Kr{createBucket(e){return new md(e)}constructor(e){super(e,Xg),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=_d({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let vd;var Yg={get paint(){return vd=vd||new ji({"hillshade-illumination-direction":new pt(Te.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new pt(Te.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new pt(Te.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new pt(Te.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new pt(Te.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new pt(Te.paint_hillshade["hillshade-accent-color"])})}};class Jg extends Kr{constructor(e){super(e,Yg)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Qg=Pi([{name:"a_pos",components:2,type:"Int16"}],4),{members:ey}=Qg;var wu={exports:{}};function uc(i,e,r){r=r||2;var a,c,p,m,g,b,C,I=e&&e.length,A=I?e[0]*r:i.length,R=xd(i,0,A,r,!0),F=[];if(!R||R.next===R.prev)return F;if(I&&(R=function(G,Y,ie,ue){var re,de,ye,ke=[];for(re=0,de=Y.length;re<de;re++)(ye=xd(G,Y[re]*ue,re<de-1?Y[re+1]*ue:G.length,ue,!1))===ye.next&&(ye.steiner=!0),ke.push(ly(ye));for(ke.sort(ay),re=0;re<ke.length;re++)ie=oy(ke[re],ie);return ie}(i,e,R,r)),i.length>80*r){a=p=i[0],c=m=i[1];for(var N=r;N<A;N+=r)(g=i[N])<a&&(a=g),(b=i[N+1])<c&&(c=b),g>p&&(p=g),b>m&&(m=b);C=(C=Math.max(p-a,m-c))!==0?32767/C:0}return Ws(R,F,r,a,c,C,0),F}function xd(i,e,r,a,c){var p,m;if(c===Tu(i,e,r,a)>0)for(p=e;p<r;p+=a)m=Sd(p,i[p],i[p+1],m);else for(p=r-a;p>=e;p-=a)m=Sd(p,i[p],i[p+1],m);return m&&hc(m,m.next)&&(Ks(m),m=m.next),m}function Qa(i,e){if(!i)return i;e||(e=i);var r,a=i;do if(r=!1,a.steiner||!hc(a,a.next)&&Ui(a.prev,a,a.next)!==0)a=a.next;else{if(Ks(a),(a=e=a.prev)===a.next)break;r=!0}while(r||a!==e);return e}function Ws(i,e,r,a,c,p,m){if(i){!m&&p&&function(I,A,R,F){var N=I;do N.z===0&&(N.z=Su(N.x,N.y,A,R,F)),N.prevZ=N.prev,N.nextZ=N.next,N=N.next;while(N!==I);N.prevZ.nextZ=null,N.prevZ=null,function(G){var Y,ie,ue,re,de,ye,ke,et,ct=1;do{for(ie=G,G=null,de=null,ye=0;ie;){for(ye++,ue=ie,ke=0,Y=0;Y<ct&&(ke++,ue=ue.nextZ);Y++);for(et=ct;ke>0||et>0&&ue;)ke!==0&&(et===0||!ue||ie.z<=ue.z)?(re=ie,ie=ie.nextZ,ke--):(re=ue,ue=ue.nextZ,et--),de?de.nextZ=re:G=re,re.prevZ=de,de=re;ie=ue}de.nextZ=null,ct*=2}while(ye>1)}(N)}(i,a,c,p);for(var g,b,C=i;i.prev!==i.next;)if(g=i.prev,b=i.next,p?iy(i,a,c,p):ty(i))e.push(g.i/r|0),e.push(i.i/r|0),e.push(b.i/r|0),Ks(i),i=b.next,C=b.next;else if((i=b)===C){m?m===1?Ws(i=ry(Qa(i),e,r),e,r,a,c,p,2):m===2&&ny(i,e,r,a,c,p):Ws(Qa(i),e,r,a,c,p,1);break}}}function ty(i){var e=i.prev,r=i,a=i.next;if(Ui(e,r,a)>=0)return!1;for(var c=e.x,p=r.x,m=a.x,g=e.y,b=r.y,C=a.y,I=c<p?c<m?c:m:p<m?p:m,A=g<b?g<C?g:C:b<C?b:C,R=c>p?c>m?c:m:p>m?p:m,F=g>b?g>C?g:C:b>C?b:C,N=a.next;N!==e;){if(N.x>=I&&N.x<=R&&N.y>=A&&N.y<=F&&Vo(c,g,p,b,m,C,N.x,N.y)&&Ui(N.prev,N,N.next)>=0)return!1;N=N.next}return!0}function iy(i,e,r,a){var c=i.prev,p=i,m=i.next;if(Ui(c,p,m)>=0)return!1;for(var g=c.x,b=p.x,C=m.x,I=c.y,A=p.y,R=m.y,F=g<b?g<C?g:C:b<C?b:C,N=I<A?I<R?I:R:A<R?A:R,G=g>b?g>C?g:C:b>C?b:C,Y=I>A?I>R?I:R:A>R?A:R,ie=Su(F,N,e,r,a),ue=Su(G,Y,e,r,a),re=i.prevZ,de=i.nextZ;re&&re.z>=ie&&de&&de.z<=ue;){if(re.x>=F&&re.x<=G&&re.y>=N&&re.y<=Y&&re!==c&&re!==m&&Vo(g,I,b,A,C,R,re.x,re.y)&&Ui(re.prev,re,re.next)>=0||(re=re.prevZ,de.x>=F&&de.x<=G&&de.y>=N&&de.y<=Y&&de!==c&&de!==m&&Vo(g,I,b,A,C,R,de.x,de.y)&&Ui(de.prev,de,de.next)>=0))return!1;de=de.nextZ}for(;re&&re.z>=ie;){if(re.x>=F&&re.x<=G&&re.y>=N&&re.y<=Y&&re!==c&&re!==m&&Vo(g,I,b,A,C,R,re.x,re.y)&&Ui(re.prev,re,re.next)>=0)return!1;re=re.prevZ}for(;de&&de.z<=ue;){if(de.x>=F&&de.x<=G&&de.y>=N&&de.y<=Y&&de!==c&&de!==m&&Vo(g,I,b,A,C,R,de.x,de.y)&&Ui(de.prev,de,de.next)>=0)return!1;de=de.nextZ}return!0}function ry(i,e,r){var a=i;do{var c=a.prev,p=a.next.next;!hc(c,p)&&bd(c,a,a.next,p)&&Xs(c,p)&&Xs(p,c)&&(e.push(c.i/r|0),e.push(a.i/r|0),e.push(p.i/r|0),Ks(a),Ks(a.next),a=i=p),a=a.next}while(a!==i);return Qa(a)}function ny(i,e,r,a,c,p){var m=i;do{for(var g=m.next.next;g!==m.prev;){if(m.i!==g.i&&cy(m,g)){var b=wd(m,g);return m=Qa(m,m.next),b=Qa(b,b.next),Ws(m,e,r,a,c,p,0),void Ws(b,e,r,a,c,p,0)}g=g.next}m=m.next}while(m!==i)}function ay(i,e){return i.x-e.x}function oy(i,e){var r=function(c,p){var m,g=p,b=c.x,C=c.y,I=-1/0;do{if(C<=g.y&&C>=g.next.y&&g.next.y!==g.y){var A=g.x+(C-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(A<=b&&A>I&&(I=A,m=g.x<g.next.x?g:g.next,A===b))return m}g=g.next}while(g!==p);if(!m)return null;var R,F=m,N=m.x,G=m.y,Y=1/0;g=m;do b>=g.x&&g.x>=N&&b!==g.x&&Vo(C<G?b:I,C,N,G,C<G?I:b,C,g.x,g.y)&&(R=Math.abs(C-g.y)/(b-g.x),Xs(g,c)&&(R<Y||R===Y&&(g.x>m.x||g.x===m.x&&sy(m,g)))&&(m=g,Y=R)),g=g.next;while(g!==F);return m}(i,e);if(!r)return e;var a=wd(r,i);return Qa(a,a.next),Qa(r,r.next)}function sy(i,e){return Ui(i.prev,i,e.prev)<0&&Ui(e.next,i,i.next)<0}function Su(i,e,r,a,c){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*c|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function ly(i){var e=i,r=i;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==i);return r}function Vo(i,e,r,a,c,p,m,g){return(c-m)*(e-g)>=(i-m)*(p-g)&&(i-m)*(a-g)>=(r-m)*(e-g)&&(r-m)*(p-g)>=(c-m)*(a-g)}function cy(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(r,a){var c=r;do{if(c.i!==r.i&&c.next.i!==r.i&&c.i!==a.i&&c.next.i!==a.i&&bd(c,c.next,r,a))return!0;c=c.next}while(c!==r);return!1}(i,e)&&(Xs(i,e)&&Xs(e,i)&&function(r,a){var c=r,p=!1,m=(r.x+a.x)/2,g=(r.y+a.y)/2;do c.y>g!=c.next.y>g&&c.next.y!==c.y&&m<(c.next.x-c.x)*(g-c.y)/(c.next.y-c.y)+c.x&&(p=!p),c=c.next;while(c!==r);return p}(i,e)&&(Ui(i.prev,i,e.prev)||Ui(i,e.prev,e))||hc(i,e)&&Ui(i.prev,i,i.next)>0&&Ui(e.prev,e,e.next)>0)}function Ui(i,e,r){return(e.y-i.y)*(r.x-e.x)-(e.x-i.x)*(r.y-e.y)}function hc(i,e){return i.x===e.x&&i.y===e.y}function bd(i,e,r,a){var c=pc(Ui(i,e,r)),p=pc(Ui(i,e,a)),m=pc(Ui(r,a,i)),g=pc(Ui(r,a,e));return c!==p&&m!==g||!(c!==0||!dc(i,r,e))||!(p!==0||!dc(i,a,e))||!(m!==0||!dc(r,i,a))||!(g!==0||!dc(r,e,a))}function dc(i,e,r){return e.x<=Math.max(i.x,r.x)&&e.x>=Math.min(i.x,r.x)&&e.y<=Math.max(i.y,r.y)&&e.y>=Math.min(i.y,r.y)}function pc(i){return i>0?1:i<0?-1:0}function Xs(i,e){return Ui(i.prev,i,i.next)<0?Ui(i,e,i.next)>=0&&Ui(i,i.prev,e)>=0:Ui(i,e,i.prev)<0||Ui(i,i.next,e)<0}function wd(i,e){var r=new Cu(i.i,i.x,i.y),a=new Cu(e.i,e.x,e.y),c=i.next,p=e.prev;return i.next=e,e.prev=i,r.next=c,c.prev=r,a.next=r,r.prev=a,p.next=a,a.prev=p,a}function Sd(i,e,r,a){var c=new Cu(i,e,r);return a?(c.next=a.next,c.prev=a,a.next.prev=c,a.next=c):(c.prev=c,c.next=c),c}function Ks(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Cu(i,e,r){this.i=i,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Tu(i,e,r,a){for(var c=0,p=e,m=r-a;p<r;p+=a)c+=(i[m]-i[p])*(i[p+1]+i[m+1]),m=p;return c}wu.exports=uc,wu.exports.default=uc,uc.deviation=function(i,e,r,a){var c=e&&e.length,p=Math.abs(Tu(i,0,c?e[0]*r:i.length,r));if(c)for(var m=0,g=e.length;m<g;m++)p-=Math.abs(Tu(i,e[m]*r,m<g-1?e[m+1]*r:i.length,r));var b=0;for(m=0;m<a.length;m+=3){var C=a[m]*r,I=a[m+1]*r,A=a[m+2]*r;b+=Math.abs((i[C]-i[A])*(i[I+1]-i[C+1])-(i[C]-i[I])*(i[A+1]-i[C+1]))}return p===0&&b===0?0:Math.abs((b-p)/p)},uc.flatten=function(i){for(var e=i[0][0].length,r={vertices:[],holes:[],dimensions:e},a=0,c=0;c<i.length;c++){for(var p=0;p<i[c].length;p++)for(var m=0;m<e;m++)r.vertices.push(i[c][p][m]);c>0&&r.holes.push(a+=i[c-1].length)}return r};var Cd=L(wu.exports);function uy(i,e,r,a,c){Td(i,e,r||0,a||i.length-1,c||hy)}function Td(i,e,r,a,c){for(;a>r;){if(a-r>600){var p=a-r+1,m=e-r+1,g=Math.log(p),b=.5*Math.exp(2*g/3),C=.5*Math.sqrt(g*b*(p-b)/p)*(m-p/2<0?-1:1);Td(i,e,Math.max(r,Math.floor(e-m*b/p+C)),Math.min(a,Math.floor(e+(p-m)*b/p+C)),c)}var I=i[e],A=r,R=a;for(Ys(i,r,e),c(i[a],I)>0&&Ys(i,r,a);A<R;){for(Ys(i,A,R),A++,R--;c(i[A],I)<0;)A++;for(;c(i[R],I)>0;)R--}c(i[r],I)===0?Ys(i,r,R):Ys(i,++R,a),R<=e&&(r=R+1),e<=R&&(a=R-1)}}function Ys(i,e,r){var a=i[e];i[e]=i[r],i[r]=a}function hy(i,e){return i<e?-1:i>e?1:0}function Eu(i,e){const r=i.length;if(r<=1)return[i];const a=[];let c,p;for(let m=0;m<r;m++){const g=Tt(i[m]);g!==0&&(i[m].area=Math.abs(g),p===void 0&&(p=g<0),p===g<0?(c&&a.push(c),c=[i[m]]):c.push(i[m]))}if(c&&a.push(c),e>1)for(let m=0;m<a.length;m++)a[m].length<=e||(uy(a[m],e,1,a[m].length-1,dy),a[m]=a[m].slice(0,e));return a}function dy(i,e){return e.area-i.area}function Iu(i,e,r){const a=r.patternDependencies;let c=!1;for(const p of e){const m=p.paint.get(`${i}-pattern`);m.isConstant()||(c=!0);const g=m.constantOr(null);g&&(c=!0,a[g.to]=!0,a[g.from]=!0)}return c}function Pu(i,e,r,a,c){const p=c.patternDependencies;for(const m of e){const g=m.paint.get(`${i}-pattern`).value;if(g.kind!=="constant"){let b=g.evaluate({zoom:a-1},r,{},c.availableImages),C=g.evaluate({zoom:a},r,{},c.availableImages),I=g.evaluate({zoom:a+1},r,{},c.availableImages);b=b&&b.name?b.name:b,C=C&&C.name?C.name:C,I=I&&I.name?I.name:I,p[b]=!0,p[C]=!0,p[I]=!0,r.patterns[m.id]={min:b,mid:C,max:I}}}return r}class Mu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ut,this.indexArray=new lr,this.indexArray2=new Yi,this.programConfigurations=new En(e.layers,e.zoom),this.segments=new vi,this.segments2=new vi,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a){this.hasPattern=Iu("fill",this.layers,r);const c=this.layers[0].layout.get("fill-sort-key"),p=!c.isConstant(),m=[];for(const{feature:g,id:b,index:C,sourceLayerIndex:I}of e){const A=this.layers[0]._featureFilter.needGeometry,R=Ja(g,A);if(!this.layers[0]._featureFilter.filter(new _i(this.zoom),R,a))continue;const F=p?c.evaluate(R,{},a,r.availableImages):void 0,N={id:b,properties:g.properties,type:g.type,sourceLayerIndex:I,index:C,geometry:A?R.geometry:Ya(g),patterns:{},sortKey:F};m.push(N)}p&&m.sort((g,b)=>g.sortKey-b.sortKey);for(const g of m){const{geometry:b,index:C,sourceLayerIndex:I}=g;if(this.hasPattern){const A=Pu("fill",this.layers,g,this.zoom,r);this.patternFeatures.push(A)}else this.addFeature(g,b,C,a,{});r.featureIndex.insert(e[C].feature,b,C,I,this.index)}}update(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a)}addFeatures(e,r,a){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,r,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ey),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,a,c,p){for(const m of Eu(r,500)){let g=0;for(const F of m)g+=F.length;const b=this.segments.prepareSegment(g,this.layoutVertexArray,this.indexArray),C=b.vertexLength,I=[],A=[];for(const F of m){if(F.length===0)continue;F!==m[0]&&A.push(I.length/2);const N=this.segments2.prepareSegment(F.length,this.layoutVertexArray,this.indexArray2),G=N.vertexLength;this.layoutVertexArray.emplaceBack(F[0].x,F[0].y),this.indexArray2.emplaceBack(G+F.length-1,G),I.push(F[0].x),I.push(F[0].y);for(let Y=1;Y<F.length;Y++)this.layoutVertexArray.emplaceBack(F[Y].x,F[Y].y),this.indexArray2.emplaceBack(G+Y-1,G+Y),I.push(F[Y].x),I.push(F[Y].y);N.vertexLength+=F.length,N.primitiveLength+=F.length}const R=Cd(I,A);for(let F=0;F<R.length;F+=3)this.indexArray.emplaceBack(C+R[F],C+R[F+1],C+R[F+2]);b.vertexLength+=g,b.primitiveLength+=R.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,p,c)}}let Ed,Id;it("FillBucket",Mu,{omit:["layers","patternFeatures"]});var py={get paint(){return Id=Id||new ji({"fill-antialias":new pt(Te.paint_fill["fill-antialias"]),"fill-opacity":new xt(Te.paint_fill["fill-opacity"]),"fill-color":new xt(Te.paint_fill["fill-color"]),"fill-outline-color":new xt(Te.paint_fill["fill-outline-color"]),"fill-translate":new pt(Te.paint_fill["fill-translate"]),"fill-translate-anchor":new pt(Te.paint_fill["fill-translate-anchor"]),"fill-pattern":new Wa(Te.paint_fill["fill-pattern"])})},get layout(){return Ed=Ed||new ji({"fill-sort-key":new xt(Te.layout_fill["fill-sort-key"])})}};class fy extends Kr{constructor(e){super(e,py)}recalculate(e,r){super.recalculate(e,r);const a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Mu(e)}queryRadius(){return sc(this.paint.get("fill-translate"))}queryIntersectsFeature(e,r,a,c,p,m,g){return ld(lc(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,g),c)}isTileClipped(){return!0}}const my=Pi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),gy=Pi([{name:"a_centroid",components:2,type:"Int16"}],4),{members:yy}=my;var Ca={},_y=V,Pd=Uo;function Uo(i,e,r,a,c){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=a,this._values=c,i.readFields(vy,this,e)}function vy(i,e,r){i==1?e.id=r.readVarint():i==2?function(a,c){for(var p=a.readVarint()+a.pos;a.pos<p;){var m=c._keys[a.readVarint()],g=c._values[a.readVarint()];c.properties[m]=g}}(r,e):i==3?e.type=r.readVarint():i==4&&(e._geometry=r.pos)}function xy(i){for(var e,r,a=0,c=0,p=i.length,m=p-1;c<p;m=c++)a+=((r=i[m]).x-(e=i[c]).x)*(e.y+r.y);return a}Uo.types=["Unknown","Point","LineString","Polygon"],Uo.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,r=i.readVarint()+i.pos,a=1,c=0,p=0,m=0,g=[];i.pos<r;){if(c<=0){var b=i.readVarint();a=7&b,c=b>>3}if(c--,a===1||a===2)p+=i.readSVarint(),m+=i.readSVarint(),a===1&&(e&&g.push(e),e=[]),e.push(new _y(p,m));else{if(a!==7)throw new Error("unknown command "+a);e&&e.push(e[0].clone())}}return e&&g.push(e),g},Uo.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,r=1,a=0,c=0,p=0,m=1/0,g=-1/0,b=1/0,C=-1/0;i.pos<e;){if(a<=0){var I=i.readVarint();r=7&I,a=I>>3}if(a--,r===1||r===2)(c+=i.readSVarint())<m&&(m=c),c>g&&(g=c),(p+=i.readSVarint())<b&&(b=p),p>C&&(C=p);else if(r!==7)throw new Error("unknown command "+r)}return[m,b,g,C]},Uo.prototype.toGeoJSON=function(i,e,r){var a,c,p=this.extent*Math.pow(2,r),m=this.extent*i,g=this.extent*e,b=this.loadGeometry(),C=Uo.types[this.type];function I(F){for(var N=0;N<F.length;N++){var G=F[N];F[N]=[360*(G.x+m)/p-180,360/Math.PI*Math.atan(Math.exp((180-360*(G.y+g)/p)*Math.PI/180))-90]}}switch(this.type){case 1:var A=[];for(a=0;a<b.length;a++)A[a]=b[a][0];I(b=A);break;case 2:for(a=0;a<b.length;a++)I(b[a]);break;case 3:for(b=function(F){var N=F.length;if(N<=1)return[F];for(var G,Y,ie=[],ue=0;ue<N;ue++){var re=xy(F[ue]);re!==0&&(Y===void 0&&(Y=re<0),Y===re<0?(G&&ie.push(G),G=[F[ue]]):G.push(F[ue]))}return G&&ie.push(G),ie}(b),a=0;a<b.length;a++)for(c=0;c<b[a].length;c++)I(b[a][c])}b.length===1?b=b[0]:C="Multi"+C;var R={type:"Feature",geometry:{type:C,coordinates:b},properties:this.properties};return"id"in this&&(R.id=this.id),R};var by=Pd,Md=Ad;function Ad(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(wy,this,e),this.length=this._features.length}function wy(i,e,r){i===15?e.version=r.readVarint():i===1?e.name=r.readString():i===5?e.extent=r.readVarint():i===2?e._features.push(r.pos):i===3?e._keys.push(r.readString()):i===4&&e._values.push(function(a){for(var c=null,p=a.readVarint()+a.pos;a.pos<p;){var m=a.readVarint()>>3;c=m===1?a.readString():m===2?a.readFloat():m===3?a.readDouble():m===4?a.readVarint64():m===5?a.readVarint():m===6?a.readSVarint():m===7?a.readBoolean():null}return c}(r))}Ad.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new by(this._pbf,e,this.extent,this._keys,this._values)};var Sy=Md;function Cy(i,e,r){if(i===3){var a=new Sy(r,r.readVarint()+r.pos);a.length&&(e[a.name]=a)}}Ca.VectorTile=function(i,e){this.layers=i.readFields(Cy,{},e)},Ca.VectorTileFeature=Pd,Ca.VectorTileLayer=Md;const Ty=Ca.VectorTileFeature.types,Au=Math.pow(2,13);function Js(i,e,r,a,c,p,m,g){i.emplaceBack(e,r,2*Math.floor(a*Au)+m,c*Au*2,p*Au*2,Math.round(g))}class ku{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new We,this.centroidVertexArray=new Ue,this.indexArray=new lr,this.programConfigurations=new En(e.layers,e.zoom),this.segments=new vi,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a){this.features=[],this.hasPattern=Iu("fill-extrusion",this.layers,r);for(const{feature:c,id:p,index:m,sourceLayerIndex:g}of e){const b=this.layers[0]._featureFilter.needGeometry,C=Ja(c,b);if(!this.layers[0]._featureFilter.filter(new _i(this.zoom),C,a))continue;const I={id:p,sourceLayerIndex:g,index:m,geometry:b?C.geometry:Ya(c),properties:c.properties,type:c.type,patterns:{}};this.hasPattern?this.features.push(Pu("fill-extrusion",this.layers,I,this.zoom,r)):this.addFeature(I,I.geometry,m,a,{}),r.featureIndex.insert(c,I.geometry,m,g,this.index,!0)}}addFeatures(e,r,a){for(const c of this.features){const{geometry:p}=c;this.addFeature(c,p,c.index,r,a)}}update(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,yy),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,gy.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,r,a,c,p){const m={x:0,y:0,vertexCount:0};for(const g of Eu(r,500)){let b=0;for(const N of g)b+=N.length;let C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const N of g){if(N.length===0||Iy(N))continue;let G=0;for(let Y=0;Y<N.length;Y++){const ie=N[Y];if(Y>=1){const ue=N[Y-1];if(!Ey(ie,ue)){C.vertexLength+4>vi.MAX_VERTEX_ARRAY_LENGTH&&(C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const re=ie.sub(ue)._perp()._unit(),de=ue.dist(ie);G+de>32768&&(G=0),Js(this.layoutVertexArray,ie.x,ie.y,re.x,re.y,0,0,G),Js(this.layoutVertexArray,ie.x,ie.y,re.x,re.y,0,1,G),m.x+=2*ie.x,m.y+=2*ie.y,m.vertexCount+=2,G+=de,Js(this.layoutVertexArray,ue.x,ue.y,re.x,re.y,0,0,G),Js(this.layoutVertexArray,ue.x,ue.y,re.x,re.y,0,1,G),m.x+=2*ue.x,m.y+=2*ue.y,m.vertexCount+=2;const ye=C.vertexLength;this.indexArray.emplaceBack(ye,ye+2,ye+1),this.indexArray.emplaceBack(ye+1,ye+2,ye+3),C.vertexLength+=4,C.primitiveLength+=2}}}}if(C.vertexLength+b>vi.MAX_VERTEX_ARRAY_LENGTH&&(C=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray)),Ty[e.type]!=="Polygon")continue;const I=[],A=[],R=C.vertexLength;for(const N of g)if(N.length!==0){N!==g[0]&&A.push(I.length/2);for(let G=0;G<N.length;G++){const Y=N[G];Js(this.layoutVertexArray,Y.x,Y.y,0,0,1,1,0),m.x+=Y.x,m.y+=Y.y,m.vertexCount+=1,I.push(Y.x),I.push(Y.y)}}const F=Cd(I,A);for(let N=0;N<F.length;N+=3)this.indexArray.emplaceBack(R+F[N],R+F[N+2],R+F[N+1]);C.primitiveLength+=F.length/3,C.vertexLength+=b}for(let g=0;g<m.vertexCount;g++)this.centroidVertexArray.emplaceBack(Math.floor(m.x/m.vertexCount),Math.floor(m.y/m.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,p,c)}}function Ey(i,e){return i.x===e.x&&(i.x<0||i.x>Hi)||i.y===e.y&&(i.y<0||i.y>Hi)}function Iy(i){return i.every(e=>e.x<0)||i.every(e=>e.x>Hi)||i.every(e=>e.y<0)||i.every(e=>e.y>Hi)}let kd;it("FillExtrusionBucket",ku,{omit:["layers","features"]});var Py={get paint(){return kd=kd||new ji({"fill-extrusion-opacity":new pt(Te["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new xt(Te["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new pt(Te["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new pt(Te["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Wa(Te["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new xt(Te["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new xt(Te["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new pt(Te["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class My extends Kr{constructor(e){super(e,Py)}createBucket(e){return new ku(e)}queryRadius(){return sc(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(e,r,a,c,p,m,g,b){const C=lc(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,g),I=this.paint.get("fill-extrusion-height").evaluate(r,a),A=this.paint.get("fill-extrusion-base").evaluate(r,a),R=function(N,G,Y,ie){const ue=[];for(const re of N){const de=[re.x,re.y,0,1];cc(de,de,G),ue.push(new Q(de[0]/de[3],de[1]/de[3]))}return ue}(C,b),F=function(N,G,Y,ie){const ue=[],re=[],de=ie[8]*G,ye=ie[9]*G,ke=ie[10]*G,et=ie[11]*G,ct=ie[8]*Y,Je=ie[9]*Y,Xe=ie[10]*Y,qe=ie[11]*Y;for(const rt of N){const Ze=[],Ne=[];for(const yt of rt){const ht=yt.x,Nt=yt.y,xi=ie[0]*ht+ie[4]*Nt+ie[12],Ci=ie[1]*ht+ie[5]*Nt+ie[13],er=ie[2]*ht+ie[6]*Nt+ie[14],Jr=ie[3]*ht+ie[7]*Nt+ie[15],Mr=er+ke,Wi=Jr+et,ur=xi+ct,fr=Ci+Je,Ar=er+Xe,kr=Jr+qe,tr=new Q((xi+de)/Wi,(Ci+ye)/Wi);tr.z=Mr/Wi,Ze.push(tr);const ir=new Q(ur/kr,fr/kr);ir.z=Ar/kr,Ne.push(ir)}ue.push(Ze),re.push(Ne)}return[ue,re]}(c,A,I,b);return function(N,G,Y){let ie=1/0;ld(Y,G)&&(ie=zd(Y,G[0]));for(let ue=0;ue<G.length;ue++){const re=G[ue],de=N[ue];for(let ye=0;ye<re.length-1;ye++){const ke=re[ye],et=[ke,re[ye+1],de[ye+1],de[ye],ke];sd(Y,et)&&(ie=Math.min(ie,zd(Y,et)))}}return ie!==1/0&&ie}(F[0],F[1],R)}}function Qs(i,e){return i.x*e.x+i.y*e.y}function zd(i,e){if(i.length===1){let r=0;const a=e[r++];let c;for(;!c||a.equals(c);)if(c=e[r++],!c)return 1/0;for(;r<e.length;r++){const p=e[r],m=i[0],g=c.sub(a),b=p.sub(a),C=m.sub(a),I=Qs(g,g),A=Qs(g,b),R=Qs(b,b),F=Qs(C,g),N=Qs(C,b),G=I*R-A*A,Y=(R*F-A*N)/G,ie=(I*N-A*F)/G,ue=a.z*(1-Y-ie)+c.z*Y+p.z*ie;if(isFinite(ue))return ue}return 1/0}{let r=1/0;for(const a of e)r=Math.min(r,a.z);return r}}const Ay=Pi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:ky}=Ay,zy=Pi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Ly}=zy,Dy=Ca.VectorTileFeature.types,Ry=Math.cos(Math.PI/180*37.5),Ld=Math.pow(2,14)/.5;class zu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new bt,this.layoutVertexArray2=new ut,this.indexArray=new lr,this.programConfigurations=new En(e.layers,e.zoom),this.segments=new vi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a){this.hasPattern=Iu("line",this.layers,r);const c=this.layers[0].layout.get("line-sort-key"),p=!c.isConstant(),m=[];for(const{feature:g,id:b,index:C,sourceLayerIndex:I}of e){const A=this.layers[0]._featureFilter.needGeometry,R=Ja(g,A);if(!this.layers[0]._featureFilter.filter(new _i(this.zoom),R,a))continue;const F=p?c.evaluate(R,{},a):void 0,N={id:b,properties:g.properties,type:g.type,sourceLayerIndex:I,index:C,geometry:A?R.geometry:Ya(g),patterns:{},sortKey:F};m.push(N)}p&&m.sort((g,b)=>g.sortKey-b.sortKey);for(const g of m){const{geometry:b,index:C,sourceLayerIndex:I}=g;if(this.hasPattern){const A=Pu("line",this.layers,g,this.zoom,r);this.patternFeatures.push(A)}else this.addFeature(g,b,C,a,{});r.featureIndex.insert(e[C].feature,b,C,I,this.index)}}update(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a)}addFeatures(e,r,a){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,r,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Ly)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ky),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,a,c,p){const m=this.layers[0].layout,g=m.get("line-join").evaluate(e,{}),b=m.get("line-cap"),C=m.get("line-miter-limit"),I=m.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const A of r)this.addLine(A,e,g,b,C,I);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,p,c)}addLine(e,r,a,c,p,m){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ie=0;ie<e.length-1;ie++)this.totalDistance+=e[ie].dist(e[ie+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const g=Dy[r.type]==="Polygon";let b=e.length;for(;b>=2&&e[b-1].equals(e[b-2]);)b--;let C=0;for(;C<b-1&&e[C].equals(e[C+1]);)C++;if(b<(g?3:2))return;a==="bevel"&&(p=1.05);const I=this.overscaling<=16?15*Hi/(512*this.overscaling):0,A=this.segments.prepareSegment(10*b,this.layoutVertexArray,this.indexArray);let R,F,N,G,Y;this.e1=this.e2=-1,g&&(R=e[b-2],Y=e[C].sub(R)._unit()._perp());for(let ie=C;ie<b;ie++){if(N=ie===b-1?g?e[C+1]:void 0:e[ie+1],N&&e[ie].equals(N))continue;Y&&(G=Y),R&&(F=R),R=e[ie],Y=N?N.sub(R)._unit()._perp():G,G=G||Y;let ue=G.add(Y);ue.x===0&&ue.y===0||ue._unit();const re=G.x*Y.x+G.y*Y.y,de=ue.x*Y.x+ue.y*Y.y,ye=de!==0?1/de:1/0,ke=2*Math.sqrt(2-2*de),et=de<Ry&&F&&N,ct=G.x*Y.y-G.y*Y.x>0;if(et&&ie>C){const qe=R.dist(F);if(qe>2*I){const rt=R.sub(R.sub(F)._mult(I/qe)._round());this.updateDistance(F,rt),this.addCurrentVertex(rt,G,0,0,A),F=rt}}const Je=F&&N;let Xe=Je?a:g?"butt":c;if(Je&&Xe==="round"&&(ye<m?Xe="miter":ye<=2&&(Xe="fakeround")),Xe==="miter"&&ye>p&&(Xe="bevel"),Xe==="bevel"&&(ye>2&&(Xe="flipbevel"),ye<p&&(Xe="miter")),F&&this.updateDistance(F,R),Xe==="miter")ue._mult(ye),this.addCurrentVertex(R,ue,0,0,A);else if(Xe==="flipbevel"){if(ye>100)ue=Y.mult(-1);else{const qe=ye*G.add(Y).mag()/G.sub(Y).mag();ue._perp()._mult(qe*(ct?-1:1))}this.addCurrentVertex(R,ue,0,0,A),this.addCurrentVertex(R,ue.mult(-1),0,0,A)}else if(Xe==="bevel"||Xe==="fakeround"){const qe=-Math.sqrt(ye*ye-1),rt=ct?qe:0,Ze=ct?0:qe;if(F&&this.addCurrentVertex(R,G,rt,Ze,A),Xe==="fakeround"){const Ne=Math.round(180*ke/Math.PI/20);for(let yt=1;yt<Ne;yt++){let ht=yt/Ne;if(ht!==.5){const xi=ht-.5;ht+=ht*xi*(ht-1)*((1.0904+re*(re*(3.55645-1.43519*re)-3.2452))*xi*xi+(.848013+re*(.215638*re-1.06021)))}const Nt=Y.sub(G)._mult(ht)._add(G)._unit()._mult(ct?-1:1);this.addHalfVertex(R,Nt.x,Nt.y,!1,ct,0,A)}}N&&this.addCurrentVertex(R,Y,-rt,-Ze,A)}else if(Xe==="butt")this.addCurrentVertex(R,ue,0,0,A);else if(Xe==="square"){const qe=F?1:-1;this.addCurrentVertex(R,ue,qe,qe,A)}else Xe==="round"&&(F&&(this.addCurrentVertex(R,G,0,0,A),this.addCurrentVertex(R,G,1,1,A,!0)),N&&(this.addCurrentVertex(R,Y,-1,-1,A,!0),this.addCurrentVertex(R,Y,0,0,A)));if(et&&ie<b-1){const qe=R.dist(N);if(qe>2*I){const rt=R.add(N.sub(R)._mult(I/qe)._round());this.updateDistance(R,rt),this.addCurrentVertex(rt,Y,0,0,A),R=rt}}}}addCurrentVertex(e,r,a,c,p,m=!1){const g=r.y*c-r.x,b=-r.y-r.x*c;this.addHalfVertex(e,r.x+r.y*a,r.y-r.x*a,m,!1,a,p),this.addHalfVertex(e,g,b,m,!0,-c,p),this.distance>Ld/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,r,a,c,p,m))}addHalfVertex({x:e,y:r},a,c,p,m,g,b){const C=.5*(this.lineClips?this.scaledDistance*(Ld-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(p?1:0),(r<<1)+(m?1:0),Math.round(63*a)+128,Math.round(63*c)+128,1+(g===0?0:g<0?-1:1)|(63&C)<<2,C>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const I=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,I),b.primitiveLength++),m?this.e2=I:this.e1=I}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}let Dd,Rd;it("LineBucket",zu,{omit:["layers","patternFeatures"]});var $d={get paint(){return Rd=Rd||new ji({"line-opacity":new xt(Te.paint_line["line-opacity"]),"line-color":new xt(Te.paint_line["line-color"]),"line-translate":new pt(Te.paint_line["line-translate"]),"line-translate-anchor":new pt(Te.paint_line["line-translate-anchor"]),"line-width":new xt(Te.paint_line["line-width"]),"line-gap-width":new xt(Te.paint_line["line-gap-width"]),"line-offset":new xt(Te.paint_line["line-offset"]),"line-blur":new xt(Te.paint_line["line-blur"]),"line-dasharray":new $s(Te.paint_line["line-dasharray"]),"line-pattern":new Wa(Te.paint_line["line-pattern"]),"line-gradient":new Os(Te.paint_line["line-gradient"])})},get layout(){return Dd=Dd||new ji({"line-cap":new pt(Te.layout_line["line-cap"]),"line-join":new xt(Te.layout_line["line-join"]),"line-miter-limit":new pt(Te.layout_line["line-miter-limit"]),"line-round-limit":new pt(Te.layout_line["line-round-limit"]),"line-sort-key":new xt(Te.layout_line["line-sort-key"])})}};class $y extends xt{possiblyEvaluate(e,r){return r=new _i(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(e,r)}evaluate(e,r,a,c){return r=$e({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(e,r,a,c)}}let fc;class Oy extends Kr{constructor(e){super(e,$d),this.gradientVersion=0,fc||(fc=new $y($d.paint.properties["line-width"].specification),fc.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!function(a){return a._styleExpression!==void 0}(r)&&r._styleExpression.expression instanceof Fn,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,r){super.recalculate(e,r),this.paint._values["line-floorwidth"]=fc.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new zu(e)}queryRadius(e){const r=e,a=Od(Gs("line-width",this,r),Gs("line-gap-width",this,r)),c=Gs("line-offset",this,r);return a/2+Math.abs(c)+sc(this.paint.get("line-translate"))}queryIntersectsFeature(e,r,a,c,p,m,g){const b=lc(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,g),C=g/2*Od(this.paint.get("line-width").evaluate(r,a),this.paint.get("line-gap-width").evaluate(r,a)),I=this.paint.get("line-offset").evaluate(r,a);return I&&(c=function(A,R){const F=[];for(let N=0;N<A.length;N++){const G=A[N],Y=[];for(let ie=0;ie<G.length;ie++){const ue=G[ie-1],re=G[ie],de=G[ie+1],ye=ie===0?new Q(0,0):re.sub(ue)._unit()._perp(),ke=ie===G.length-1?new Q(0,0):de.sub(re)._unit()._perp(),et=ye._add(ke)._unit(),ct=et.x*ke.x+et.y*ke.y;ct!==0&&et._mult(1/ct),Y.push(et._mult(R)._add(re))}F.push(Y)}return F}(c,I*g)),function(A,R,F){for(let N=0;N<R.length;N++){const G=R[N];if(A.length>=3){for(let Y=0;Y<G.length;Y++)if(No(A,G[Y]))return!0}if(Ug(A,G,F))return!0}return!1}(b,c,C)}isTileClipped(){return!0}}function Od(i,e){return e>0?e+2*i:i}const By=Pi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Fy=Pi([{name:"a_projected_pos",components:3,type:"Float32"}],4);Pi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Ny=Pi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Pi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Bd=Pi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),jy=Pi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Vy(i,e,r){return i.sections.forEach(a=>{a.text=function(c,p,m){const g=p.layout.get("text-transform").evaluate(m,{});return g==="uppercase"?c=c.toLocaleUpperCase():g==="lowercase"&&(c=c.toLocaleLowerCase()),Or.applyArabicShaping&&(c=Or.applyArabicShaping(c)),c}(a.text,e,r)}),i}Pi([{name:"triangle",components:3,type:"Uint16"}]),Pi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Pi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Pi([{type:"Float32",name:"offsetX"}]),Pi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Pi([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const el={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Qi=24,Fd=di,Nd=function(i,e,r,a,c){var p,m,g=8*c-a-1,b=(1<<g)-1,C=b>>1,I=-7,A=r?c-1:0,R=r?-1:1,F=i[e+A];for(A+=R,p=F&(1<<-I)-1,F>>=-I,I+=g;I>0;p=256*p+i[e+A],A+=R,I-=8);for(m=p&(1<<-I)-1,p>>=-I,I+=a;I>0;m=256*m+i[e+A],A+=R,I-=8);if(p===0)p=1-C;else{if(p===b)return m?NaN:1/0*(F?-1:1);m+=Math.pow(2,a),p-=C}return(F?-1:1)*m*Math.pow(2,p-a)},jd=function(i,e,r,a,c,p){var m,g,b,C=8*p-c-1,I=(1<<C)-1,A=I>>1,R=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,F=a?0:p-1,N=a?1:-1,G=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(g=isNaN(e)?1:0,m=I):(m=Math.floor(Math.log(e)/Math.LN2),e*(b=Math.pow(2,-m))<1&&(m--,b*=2),(e+=m+A>=1?R/b:R*Math.pow(2,1-A))*b>=2&&(m++,b/=2),m+A>=I?(g=0,m=I):m+A>=1?(g=(e*b-1)*Math.pow(2,c),m+=A):(g=e*Math.pow(2,A-1)*Math.pow(2,c),m=0));c>=8;i[r+F]=255&g,F+=N,g/=256,c-=8);for(m=m<<c|g,C+=c;C>0;i[r+F]=255&m,F+=N,m/=256,C-=8);i[r+F-N]|=128*G};function di(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}di.Varint=0,di.Fixed64=1,di.Bytes=2,di.Fixed32=5;var Lu=4294967296,Vd=1/Lu,Ud=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function sa(i){return i.type===di.Bytes?i.readVarint()+i.pos:i.pos+1}function qo(i,e,r){return r?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function qd(i,e,r){var a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(a);for(var c=r.pos-1;c>=i;c--)r.buf[c+a]=r.buf[c]}function Uy(i,e){for(var r=0;r<i.length;r++)e.writeVarint(i[r])}function qy(i,e){for(var r=0;r<i.length;r++)e.writeSVarint(i[r])}function Gy(i,e){for(var r=0;r<i.length;r++)e.writeFloat(i[r])}function Zy(i,e){for(var r=0;r<i.length;r++)e.writeDouble(i[r])}function Hy(i,e){for(var r=0;r<i.length;r++)e.writeBoolean(i[r])}function Wy(i,e){for(var r=0;r<i.length;r++)e.writeFixed32(i[r])}function Xy(i,e){for(var r=0;r<i.length;r++)e.writeSFixed32(i[r])}function Ky(i,e){for(var r=0;r<i.length;r++)e.writeFixed64(i[r])}function Yy(i,e){for(var r=0;r<i.length;r++)e.writeSFixed64(i[r])}function mc(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function Go(i,e,r){i[r]=e,i[r+1]=e>>>8,i[r+2]=e>>>16,i[r+3]=e>>>24}function Gd(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}di.prototype={destroy:function(){this.buf=null},readFields:function(i,e,r){for(r=r||this.length;this.pos<r;){var a=this.readVarint(),c=a>>3,p=this.pos;this.type=7&a,i(c,e,this),this.pos===p&&this.skip(a)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=mc(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Gd(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=mc(this.buf,this.pos)+mc(this.buf,this.pos+4)*Lu;return this.pos+=8,i},readSFixed64:function(){var i=mc(this.buf,this.pos)+Gd(this.buf,this.pos+4)*Lu;return this.pos+=8,i},readFloat:function(){var i=Nd(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Nd(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,r,a=this.buf;return e=127&(r=a[this.pos++]),r<128?e:(e|=(127&(r=a[this.pos++]))<<7,r<128?e:(e|=(127&(r=a[this.pos++]))<<14,r<128?e:(e|=(127&(r=a[this.pos++]))<<21,r<128?e:function(c,p,m){var g,b,C=m.buf;if(g=(112&(b=C[m.pos++]))>>4,b<128||(g|=(127&(b=C[m.pos++]))<<3,b<128)||(g|=(127&(b=C[m.pos++]))<<10,b<128)||(g|=(127&(b=C[m.pos++]))<<17,b<128)||(g|=(127&(b=C[m.pos++]))<<24,b<128)||(g|=(1&(b=C[m.pos++]))<<31,b<128))return qo(c,g,p);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=a[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&Ud?function(r,a,c){return Ud.decode(r.subarray(a,c))}(this.buf,e,i):function(r,a,c){for(var p="",m=a;m<c;){var g,b,C,I=r[m],A=null,R=I>239?4:I>223?3:I>191?2:1;if(m+R>c)break;R===1?I<128&&(A=I):R===2?(192&(g=r[m+1]))==128&&(A=(31&I)<<6|63&g)<=127&&(A=null):R===3?(b=r[m+2],(192&(g=r[m+1]))==128&&(192&b)==128&&((A=(15&I)<<12|(63&g)<<6|63&b)<=2047||A>=55296&&A<=57343)&&(A=null)):R===4&&(b=r[m+2],C=r[m+3],(192&(g=r[m+1]))==128&&(192&b)==128&&(192&C)==128&&((A=(15&I)<<18|(63&g)<<12|(63&b)<<6|63&C)<=65535||A>=1114112)&&(A=null)),A===null?(A=65533,R=1):A>65535&&(A-=65536,p+=String.fromCharCode(A>>>10&1023|55296),A=56320|1023&A),p+=String.fromCharCode(A),m+=R}return p}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==di.Bytes)return i.push(this.readVarint(e));var r=sa(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==di.Bytes)return i.push(this.readSVarint());var e=sa(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==di.Bytes)return i.push(this.readBoolean());var e=sa(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==di.Bytes)return i.push(this.readFloat());var e=sa(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==di.Bytes)return i.push(this.readDouble());var e=sa(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==di.Bytes)return i.push(this.readFixed32());var e=sa(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==di.Bytes)return i.push(this.readSFixed32());var e=sa(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==di.Bytes)return i.push(this.readFixed64());var e=sa(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==di.Bytes)return i.push(this.readSFixed64());var e=sa(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===di.Varint)for(;this.buf[this.pos++]>127;);else if(e===di.Bytes)this.pos=this.readVarint()+this.pos;else if(e===di.Fixed32)this.pos+=4;else{if(e!==di.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Go(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Go(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Go(this.buf,-1&i,this.pos),Go(this.buf,Math.floor(i*Vd),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Go(this.buf,-1&i,this.pos),Go(this.buf,Math.floor(i*Vd),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,r){var a,c;if(e>=0?(a=e%4294967296|0,c=e/4294967296|0):(c=~(-e/4294967296),4294967295^(a=~(-e%4294967296))?a=a+1|0:(a=0,c=c+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(p,m,g){g.buf[g.pos++]=127&p|128,p>>>=7,g.buf[g.pos++]=127&p|128,p>>>=7,g.buf[g.pos++]=127&p|128,p>>>=7,g.buf[g.pos++]=127&p|128,g.buf[g.pos]=127&(p>>>=7)}(a,0,r),function(p,m){var g=(7&p)<<4;m.buf[m.pos++]|=g|((p>>>=3)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p)))))}(c,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(a,c,p){for(var m,g,b=0;b<c.length;b++){if((m=c.charCodeAt(b))>55295&&m<57344){if(!g){m>56319||b+1===c.length?(a[p++]=239,a[p++]=191,a[p++]=189):g=m;continue}if(m<56320){a[p++]=239,a[p++]=191,a[p++]=189,g=m;continue}m=g-55296<<10|m-56320|65536,g=null}else g&&(a[p++]=239,a[p++]=191,a[p++]=189,g=null);m<128?a[p++]=m:(m<2048?a[p++]=m>>6|192:(m<65536?a[p++]=m>>12|224:(a[p++]=m>>18|240,a[p++]=m>>12&63|128),a[p++]=m>>6&63|128),a[p++]=63&m|128)}return p}(this.buf,i,this.pos);var r=this.pos-e;r>=128&&qd(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),jd(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),jd(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,e){this.pos++;var r=this.pos;i(e,this);var a=this.pos-r;a>=128&&qd(r,a,this),this.pos=r-1,this.writeVarint(a),this.pos+=a},writeMessage:function(i,e,r){this.writeTag(i,di.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,Uy,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,qy,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,Hy,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,Gy,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,Zy,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,Wy,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,Xy,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,Ky,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,Yy,e)},writeBytesField:function(i,e){this.writeTag(i,di.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,di.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,di.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,di.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,di.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,di.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,di.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,di.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,di.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,di.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,!!e)}};var Du=L(Fd);const Ru=3;function Jy(i,e,r){i===1&&r.readMessage(Qy,e)}function Qy(i,e,r){if(i===3){const{id:a,bitmap:c,width:p,height:m,left:g,top:b,advance:C}=r.readMessage(e_,{});e.push({id:a,bitmap:new Hs({width:p+2*Ru,height:m+2*Ru},c),metrics:{width:p,height:m,left:g,top:b,advance:C}})}}function e_(i,e,r){i===1?e.id=r.readVarint():i===2?e.bitmap=r.readBytes():i===3?e.width=r.readVarint():i===4?e.height=r.readVarint():i===5?e.left=r.readSVarint():i===6?e.top=r.readSVarint():i===7&&(e.advance=r.readVarint())}const Zd=Ru;function Hd(i){let e=0,r=0;for(const m of i)e+=m.w*m.h,r=Math.max(r,m.w);i.sort((m,g)=>g.h-m.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let c=0,p=0;for(const m of i)for(let g=a.length-1;g>=0;g--){const b=a[g];if(!(m.w>b.w||m.h>b.h)){if(m.x=b.x,m.y=b.y,p=Math.max(p,m.y+m.h),c=Math.max(c,m.x+m.w),m.w===b.w&&m.h===b.h){const C=a.pop();g<a.length&&(a[g]=C)}else m.h===b.h?(b.x+=m.w,b.w-=m.w):m.w===b.w?(b.y+=m.h,b.h-=m.h):(a.push({x:b.x+m.w,y:b.y,w:b.w-m.w,h:m.h}),b.y+=m.h,b.h-=m.h);break}}return{w:c,h:p,fill:e/(c*p)||0}}const Fr=1;class $u{constructor(e,{pixelRatio:r,version:a,stretchX:c,stretchY:p,content:m}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=c,this.stretchY=p,this.content=m,this.version=a}get tl(){return[this.paddedRect.x+Fr,this.paddedRect.y+Fr]}get br(){return[this.paddedRect.x+this.paddedRect.w-Fr,this.paddedRect.y+this.paddedRect.h-Fr]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Fr)/this.pixelRatio,(this.paddedRect.h-2*Fr)/this.pixelRatio]}}class Wd{constructor(e,r){const a={},c={};this.haveRenderCallbacks=[];const p=[];this.addImages(e,a,p),this.addImages(r,c,p);const{w:m,h:g}=Hd(p),b=new tn({width:m||1,height:g||1});for(const C in e){const I=e[C],A=a[C].paddedRect;tn.copy(I.data,b,{x:0,y:0},{x:A.x+Fr,y:A.y+Fr},I.data)}for(const C in r){const I=r[C],A=c[C].paddedRect,R=A.x+Fr,F=A.y+Fr,N=I.data.width,G=I.data.height;tn.copy(I.data,b,{x:0,y:0},{x:R,y:F},I.data),tn.copy(I.data,b,{x:0,y:G-1},{x:R,y:F-1},{width:N,height:1}),tn.copy(I.data,b,{x:0,y:0},{x:R,y:F+G},{width:N,height:1}),tn.copy(I.data,b,{x:N-1,y:0},{x:R-1,y:F},{width:1,height:G}),tn.copy(I.data,b,{x:0,y:0},{x:R+N,y:F},{width:1,height:G})}this.image=b,this.iconPositions=a,this.patternPositions=c}addImages(e,r,a){for(const c in e){const p=e[c],m={x:0,y:0,w:p.data.width+2*Fr,h:p.data.height+2*Fr};a.push(m),r[c]=new $u(m,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(e,r){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const a in e.updatedImages)this.patchUpdatedImage(this.iconPositions[a],e.getImage(a),r),this.patchUpdatedImage(this.patternPositions[a],e.getImage(a),r)}patchUpdatedImage(e,r,a){if(!e||!r||e.version===r.version)return;e.version=r.version;const[c,p]=e.tl;a.update(r.data,void 0,{x:c,y:p})}}var Ta;it("ImagePosition",$u),it("ImageAtlas",Wd),o.ai=void 0,(Ta=o.ai||(o.ai={}))[Ta.none=0]="none",Ta[Ta.horizontal=1]="horizontal",Ta[Ta.vertical=2]="vertical",Ta[Ta.horizontalOnly=3]="horizontalOnly";const tl=-17;class il{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const a=new il;return a.scale=e||1,a.fontStack=r,a}static forImage(e){const r=new il;return r.imageName=e,r}}class Zo{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const a=new Zo;for(let c=0;c<e.sections.length;c++){const p=e.sections[c];p.image?a.addImageSection(p):a.addTextSection(p,r)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let r="";for(let a=0;a<e.length;a++){const c=e.charCodeAt(a+1)||null,p=e.charCodeAt(a-1)||null;r+=c&&Kl(c)&&!el[e[a+1]]||p&&Kl(p)&&!el[e[a-1]]||!el[e[a]]?e[a]:el[e[a]]}return r}(this.text)}trim(){let e=0;for(let a=0;a<this.text.length&&yc[this.text.charCodeAt(a)];a++)e++;let r=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&yc[this.text.charCodeAt(a)];a--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const a=new Zo;return a.text=this.text.substring(e,r),a.sectionIndex=this.sectionIndex.slice(e,r),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(il.forText(e.scale,e.fontStack||r));const a=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(a)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void He("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(il.forImage(r)),this.sectionIndex.push(this.sections.length-1)):He("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function gc(i,e,r,a,c,p,m,g,b,C,I,A,R,F,N,G){const Y=Zo.fromFeature(i,c);let ie;A===o.ai.vertical&&Y.verticalizePunctuation();const{processBidirectionalText:ue,processStyledBidirectionalText:re}=Or;if(ue&&Y.sections.length===1){ie=[];const ke=ue(Y.toString(),Ou(Y,C,p,e,a,F,N));for(const et of ke){const ct=new Zo;ct.text=et,ct.sections=Y.sections;for(let Je=0;Je<et.length;Je++)ct.sectionIndex.push(0);ie.push(ct)}}else if(re){ie=[];const ke=re(Y.text,Y.sectionIndex,Ou(Y,C,p,e,a,F,N));for(const et of ke){const ct=new Zo;ct.text=et[0],ct.sectionIndex=et[1],ct.sections=Y.sections,ie.push(ct)}}else ie=function(ke,et){const ct=[],Je=ke.text;let Xe=0;for(const qe of et)ct.push(ke.substring(Xe,qe)),Xe=qe;return Xe<Je.length&&ct.push(ke.substring(Xe,Je.length)),ct}(Y,Ou(Y,C,p,e,a,F,N));const de=[],ye={positionedLines:de,text:Y.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:A,iconsInText:!1,verticalizable:!1};return function(ke,et,ct,Je,Xe,qe,rt,Ze,Ne,yt,ht,Nt){let xi=0,Ci=tl,er=0,Jr=0;const Mr=Ze==="right"?1:Ze==="left"?0:.5;let Wi=0;for(const tr of Xe){tr.trim();const ir=tr.getMaxScale(),vr=(ir-1)*Qi,zr={positionedGlyphs:[],lineOffset:0};ke.positionedLines[Wi]=zr;const xr=zr.positionedGlyphs;let Nr=0;if(!tr.length()){Ci+=qe,++Wi;continue}for(let rr=0;rr<tr.length();rr++){const Zt=tr.getSection(rr),br=tr.getSectionIndex(rr),mr=tr.getCharCode(rr);let nr=0,gn=null,In=null,Pn=null,la=Qi;const yn=!(Ne===o.ai.horizontal||!ht&&!Ps(mr)||ht&&(yc[mr]||(ur=mr,Qe.Arabic(ur)||Qe["Arabic Supplement"](ur)||Qe["Arabic Extended-A"](ur)||Qe["Arabic Presentation Forms-A"](ur)||Qe["Arabic Presentation Forms-B"](ur))));if(Zt.imageName){const nn=Je[Zt.imageName];if(!nn)continue;Pn=Zt.imageName,ke.iconsInText=ke.iconsInText||!0,In=nn.paddedRect;const Vr=nn.displaySize;Zt.scale=Zt.scale*Qi/Nt,gn={width:Vr[0],height:Vr[1],left:Fr,top:-Zd,advance:yn?Vr[1]:Vr[0]},nr=vr+(Qi-Vr[1]*Zt.scale),la=gn.advance;const ca=yn?Vr[0]*Zt.scale-Qi*ir:Vr[1]*Zt.scale-Qi*ir;ca>0&&ca>Nr&&(Nr=ca)}else{const nn=ct[Zt.fontStack],Vr=nn&&nn[mr];if(Vr&&Vr.rect)In=Vr.rect,gn=Vr.metrics;else{const ca=et[Zt.fontStack],sl=ca&&ca[mr];if(!sl)continue;gn=sl.metrics}nr=(ir-Zt.scale)*Qi}yn?(ke.verticalizable=!0,xr.push({glyph:mr,imageName:Pn,x:xi,y:Ci+nr,vertical:yn,scale:Zt.scale,fontStack:Zt.fontStack,sectionIndex:br,metrics:gn,rect:In}),xi+=la*Zt.scale+yt):(xr.push({glyph:mr,imageName:Pn,x:xi,y:Ci+nr,vertical:yn,scale:Zt.scale,fontStack:Zt.fontStack,sectionIndex:br,metrics:gn,rect:In}),xi+=gn.advance*Zt.scale+yt)}xr.length!==0&&(er=Math.max(xi-yt,er),r_(xr,0,xr.length-1,Mr,Nr)),xi=0;const jr=qe*ir+Nr;zr.lineOffset=Math.max(Nr,vr),Ci+=jr,Jr=Math.max(jr,Jr),++Wi}var ur;const fr=Ci-tl,{horizontalAlign:Ar,verticalAlign:kr}=Bu(rt);(function(tr,ir,vr,zr,xr,Nr,jr,rr,Zt){const br=(ir-vr)*xr;let mr=0;mr=Nr!==jr?-rr*zr-tl:(-zr*Zt+.5)*jr;for(const nr of tr)for(const gn of nr.positionedGlyphs)gn.x+=br,gn.y+=mr})(ke.positionedLines,Mr,Ar,kr,er,Jr,qe,fr,Xe.length),ke.top+=-kr*fr,ke.bottom=ke.top+fr,ke.left+=-Ar*er,ke.right=ke.left+er}(ye,e,r,a,ie,m,g,b,A,C,R,G),!function(ke){for(const et of ke)if(et.positionedGlyphs.length!==0)return!1;return!0}(de)&&ye}const yc={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},t_={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Xd(i,e,r,a,c,p){if(e.imageName){const m=a[e.imageName];return m?m.displaySize[0]*e.scale*Qi/p+c:0}{const m=r[e.fontStack],g=m&&m[i];return g?g.metrics.advance*e.scale+c:0}}function Kd(i,e,r,a){const c=Math.pow(i-e,2);return a?i<e?c/2:2*c:c+Math.abs(r)*r}function i_(i,e,r){let a=0;return i===10&&(a-=1e4),r&&(a+=150),i!==40&&i!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function Yd(i,e,r,a,c,p){let m=null,g=Kd(e,r,c,p);for(const b of a){const C=Kd(e-b.x,r,c,p)+b.badness;C<=g&&(m=b,g=C)}return{index:i,x:e,priorBreak:m,badness:g}}function Jd(i){return i?Jd(i.priorBreak).concat(i.index):[]}function Ou(i,e,r,a,c,p,m){if(p!=="point")return[];if(!i)return[];const g=[],b=function(R,F,N,G,Y,ie){let ue=0;for(let re=0;re<R.length();re++){const de=R.getSection(re);ue+=Xd(R.getCharCode(re),de,G,Y,F,ie)}return ue/Math.max(1,Math.ceil(ue/N))}(i,e,r,a,c,m),C=i.text.indexOf("​")>=0;let I=0;for(let R=0;R<i.length();R++){const F=i.getSection(R),N=i.getCharCode(R);if(yc[N]||(I+=Xd(N,F,a,c,e,m)),R<i.length()-1){const G=!((A=N)<11904||!(Qe["Bopomofo Extended"](A)||Qe.Bopomofo(A)||Qe["CJK Compatibility Forms"](A)||Qe["CJK Compatibility Ideographs"](A)||Qe["CJK Compatibility"](A)||Qe["CJK Radicals Supplement"](A)||Qe["CJK Strokes"](A)||Qe["CJK Symbols and Punctuation"](A)||Qe["CJK Unified Ideographs Extension A"](A)||Qe["CJK Unified Ideographs"](A)||Qe["Enclosed CJK Letters and Months"](A)||Qe["Halfwidth and Fullwidth Forms"](A)||Qe.Hiragana(A)||Qe["Ideographic Description Characters"](A)||Qe["Kangxi Radicals"](A)||Qe["Katakana Phonetic Extensions"](A)||Qe.Katakana(A)||Qe["Vertical Forms"](A)||Qe["Yi Radicals"](A)||Qe["Yi Syllables"](A)));(t_[N]||G||F.imageName)&&g.push(Yd(R+1,I,b,g,i_(N,i.getCharCode(R+1),G&&C),!1))}}var A;return Jd(Yd(i.length(),I,b,g,0,!0))}function Bu(i){let e=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function r_(i,e,r,a,c){if(!a&&!c)return;const p=i[r],m=(i[r].x+p.metrics.advance*p.scale)*a;for(let g=e;g<=r;g++)i[g].x-=m,i[g].y+=c}function n_(i,e,r){const{horizontalAlign:a,verticalAlign:c}=Bu(r),p=e[0]-i.displaySize[0]*a,m=e[1]-i.displaySize[1]*c;return{image:i,top:m,bottom:m+i.displaySize[1],left:p,right:p+i.displaySize[0]}}function Qd(i,e,r,a,c,p){const m=i.image;let g;if(m.content){const Y=m.content,ie=m.pixelRatio||1;g=[Y[0]/ie,Y[1]/ie,m.displaySize[0]-Y[2]/ie,m.displaySize[1]-Y[3]/ie]}const b=e.left*p,C=e.right*p;let I,A,R,F;r==="width"||r==="both"?(F=c[0]+b-a[3],A=c[0]+C+a[1]):(F=c[0]+(b+C-m.displaySize[0])/2,A=F+m.displaySize[0]);const N=e.top*p,G=e.bottom*p;return r==="height"||r==="both"?(I=c[1]+N-a[0],R=c[1]+G+a[2]):(I=c[1]+(N+G-m.displaySize[1])/2,R=I+m.displaySize[1]),{image:m,top:I,right:A,bottom:R,left:F,collisionPadding:g}}const rl=255,qn=128,Ea=rl*qn;function ep(i,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new _i(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:c}=r;let p=0;for(;p<a.length&&a[p]<=i;)p++;p=Math.max(0,p-1);let m=p;for(;m<a.length&&a[m]<i+1;)m++;m=Math.min(a.length-1,m);const g=a[p],b=a[m];return r.kind==="composite"?{kind:"composite",minZoom:g,maxZoom:b,interpolationType:c}:{kind:"camera",minZoom:g,maxZoom:b,minSize:r.evaluate(new _i(g)),maxSize:r.evaluate(new _i(b)),interpolationType:c}}}function Fu(i,e,r){let a="never";const c=i.get(e);return c?a=c:i.get(r)&&(a="always"),a}const a_=Ca.VectorTileFeature.types,o_=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function _c(i,e,r,a,c,p,m,g,b,C,I,A,R){const F=g?Math.min(Ea,Math.round(g[0])):0,N=g?Math.min(Ea,Math.round(g[1])):0;i.emplaceBack(e,r,Math.round(32*a),Math.round(32*c),p,m,(F<<1)+(b?1:0),N,16*C,16*I,256*A,256*R)}function Nu(i,e,r){i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r)}function s_(i){for(const e of i.sections)if(du(e.text))return!0;return!1}class ju{constructor(e){this.layoutVertexArray=new Vt,this.indexArray=new lr,this.programConfigurations=e,this.segments=new vi,this.dynamicLayoutVertexArray=new Dt,this.opacityVertexArray=new qt,this.hasVisibleVertices=!1,this.placedSymbolArray=new oe}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,a,c){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,By.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Fy.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,o_,!0),this.opacityVertexBuffer.itemSize=1),(a||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}it("SymbolBuffers",ju);class Vu{constructor(e,r,a){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new a,this.segments=new vi,this.collisionVertexArray=new fi}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Ny.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}it("CollisionBuffers",Vu);class Ho{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(m=>m.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=vu([]),this.placementViewportMatrix=vu([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ep(this.zoom,r["text-size"]),this.iconSizeData=ep(this.zoom,r["icon-size"]);const a=this.layers[0].layout,c=a.get("symbol-sort-key"),p=a.get("symbol-z-order");this.canOverlap=Fu(a,"text-overlap","text-allow-overlap")!=="never"||Fu(a,"icon-overlap","icon-allow-overlap")!=="never"||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&!c.isConstant(),this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,a.get("symbol-placement")==="point"&&(this.writingModes=a.get("text-writing-mode").map(m=>o.ai[m])),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=e.sourceID}createArrays(){this.text=new ju(new En(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new ju(new En(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new le,this.lineVertexArray=new _e,this.symbolInstances=new ee,this.textAnchorOffsets=new Me}calculateGlyphDependencies(e,r,a,c,p){for(let m=0;m<e.length;m++)if(r[e.charCodeAt(m)]=!0,(a||c)&&p){const g=el[e.charAt(m)];g&&(r[g.charCodeAt(0)]=!0)}}populate(e,r,a){const c=this.layers[0],p=c.layout,m=p.get("text-font"),g=p.get("text-field"),b=p.get("icon-image"),C=(g.value.kind!=="constant"||g.value.value instanceof hr&&!g.value.value.isEmpty()||g.value.value.toString().length>0)&&(m.value.kind!=="constant"||m.value.value.length>0),I=b.value.kind!=="constant"||!!b.value.value||Object.keys(b.parameters).length>0,A=p.get("symbol-sort-key");if(this.features=[],!C&&!I)return;const R=r.iconDependencies,F=r.glyphDependencies,N=r.availableImages,G=new _i(this.zoom);for(const{feature:Y,id:ie,index:ue,sourceLayerIndex:re}of e){const de=c._featureFilter.needGeometry,ye=Ja(Y,de);if(!c._featureFilter.filter(G,ye,a))continue;let ke,et;if(de||(ye.geometry=Ya(Y)),C){const Je=c.getValueAndResolveTokens("text-field",ye,a,N),Xe=hr.factory(Je);s_(Xe)&&(this.hasRTLText=!0),(!this.hasRTLText||Ds()==="unavailable"||this.hasRTLText&&Or.isParsed())&&(ke=Vy(Xe,c,ye))}if(I){const Je=c.getValueAndResolveTokens("icon-image",ye,a,N);et=Je instanceof sr?Je:sr.fromString(Je)}if(!ke&&!et)continue;const ct=this.sortFeaturesByKey?A.evaluate(ye,{},a):void 0;if(this.features.push({id:ie,text:ke,icon:et,index:ue,sourceLayerIndex:re,geometry:ye.geometry,properties:Y.properties,type:a_[Y.type],sortKey:ct}),et&&(R[et.name]=!0),ke){const Je=m.evaluate(ye,{},a).join(","),Xe=p.get("text-rotation-alignment")!=="viewport"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(o.ai.vertical)>=0;for(const qe of ke.sections)if(qe.image)R[qe.image.name]=!0;else{const rt=Es(ke.toString()),Ze=qe.fontStack||Je,Ne=F[Ze]=F[Ze]||{};this.calculateGlyphDependencies(qe.text,Ne,Xe,this.allowVerticalPlacement,rt)}}}p.get("symbol-placement")==="line"&&(this.features=function(Y){const ie={},ue={},re=[];let de=0;function ye(Je){re.push(Y[Je]),de++}function ke(Je,Xe,qe){const rt=ue[Je];return delete ue[Je],ue[Xe]=rt,re[rt].geometry[0].pop(),re[rt].geometry[0]=re[rt].geometry[0].concat(qe[0]),rt}function et(Je,Xe,qe){const rt=ie[Xe];return delete ie[Xe],ie[Je]=rt,re[rt].geometry[0].shift(),re[rt].geometry[0]=qe[0].concat(re[rt].geometry[0]),rt}function ct(Je,Xe,qe){const rt=qe?Xe[0][Xe[0].length-1]:Xe[0][0];return`${Je}:${rt.x}:${rt.y}`}for(let Je=0;Je<Y.length;Je++){const Xe=Y[Je],qe=Xe.geometry,rt=Xe.text?Xe.text.toString():null;if(!rt){ye(Je);continue}const Ze=ct(rt,qe),Ne=ct(rt,qe,!0);if(Ze in ue&&Ne in ie&&ue[Ze]!==ie[Ne]){const yt=et(Ze,Ne,qe),ht=ke(Ze,Ne,re[yt].geometry);delete ie[Ze],delete ue[Ne],ue[ct(rt,re[ht].geometry,!0)]=ht,re[yt].geometry=null}else Ze in ue?ke(Ze,Ne,qe):Ne in ie?et(Ze,Ne,qe):(ye(Je),ie[Ze]=de-1,ue[Ne]=de-1)}return re.filter(Je=>Je.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Y,ie)=>Y.sortKey-ie.sortKey)}update(e,r,a){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,a),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,a))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const a=this.lineVertexArray.length;if(e.segment!==void 0){let c=e.dist(r[e.segment+1]),p=e.dist(r[e.segment]);const m={};for(let g=e.segment+1;g<r.length;g++)m[g]={x:r[g].x,y:r[g].y,tileUnitDistanceFromAnchor:c},g<r.length-1&&(c+=r[g+1].dist(r[g]));for(let g=e.segment||0;g>=0;g--)m[g]={x:r[g].x,y:r[g].y,tileUnitDistanceFromAnchor:p},g>0&&(p+=r[g-1].dist(r[g]));for(let g=0;g<r.length;g++){const b=m[g];this.lineVertexArray.emplaceBack(b.x,b.y,b.tileUnitDistanceFromAnchor)}}return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,r,a,c,p,m,g,b,C,I,A,R){const F=e.indexArray,N=e.layoutVertexArray,G=e.segments.prepareSegment(4*r.length,N,F,this.canOverlap?m.sortKey:void 0),Y=this.glyphOffsetArray.length,ie=G.vertexLength,ue=this.allowVerticalPlacement&&g===o.ai.vertical?Math.PI/2:0,re=m.text&&m.text.sections;for(let de=0;de<r.length;de++){const{tl:ye,tr:ke,bl:et,br:ct,tex:Je,pixelOffsetTL:Xe,pixelOffsetBR:qe,minFontScaleX:rt,minFontScaleY:Ze,glyphOffset:Ne,isSDF:yt,sectionIndex:ht}=r[de],Nt=G.vertexLength,xi=Ne[1];_c(N,b.x,b.y,ye.x,xi+ye.y,Je.x,Je.y,a,yt,Xe.x,Xe.y,rt,Ze),_c(N,b.x,b.y,ke.x,xi+ke.y,Je.x+Je.w,Je.y,a,yt,qe.x,Xe.y,rt,Ze),_c(N,b.x,b.y,et.x,xi+et.y,Je.x,Je.y+Je.h,a,yt,Xe.x,qe.y,rt,Ze),_c(N,b.x,b.y,ct.x,xi+ct.y,Je.x+Je.w,Je.y+Je.h,a,yt,qe.x,qe.y,rt,Ze),Nu(e.dynamicLayoutVertexArray,b,ue),F.emplaceBack(Nt,Nt+1,Nt+2),F.emplaceBack(Nt+1,Nt+2,Nt+3),G.vertexLength+=4,G.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ne[0]),de!==r.length-1&&ht===r[de+1].sectionIndex||e.programConfigurations.populatePaintArrays(N.length,m,m.index,{},R,re&&re[ht])}e.placedSymbolArray.emplaceBack(b.x,b.y,Y,this.glyphOffsetArray.length-Y,ie,C,I,b.segment,a?a[0]:0,a?a[1]:0,c[0],c[1],g,0,!1,0,A)}_addCollisionDebugVertex(e,r,a,c,p,m){return r.emplaceBack(0,0),e.emplaceBack(a.x,a.y,c,p,Math.round(m.x),Math.round(m.y))}addCollisionDebugVertices(e,r,a,c,p,m,g){const b=p.segments.prepareSegment(4,p.layoutVertexArray,p.indexArray),C=b.vertexLength,I=p.layoutVertexArray,A=p.collisionVertexArray,R=g.anchorX,F=g.anchorY;this._addCollisionDebugVertex(I,A,m,R,F,new Q(e,r)),this._addCollisionDebugVertex(I,A,m,R,F,new Q(a,r)),this._addCollisionDebugVertex(I,A,m,R,F,new Q(a,c)),this._addCollisionDebugVertex(I,A,m,R,F,new Q(e,c)),b.vertexLength+=4;const N=p.indexArray;N.emplaceBack(C,C+1),N.emplaceBack(C+1,C+2),N.emplaceBack(C+2,C+3),N.emplaceBack(C+3,C),b.primitiveLength+=4}addDebugCollisionBoxes(e,r,a,c){for(let p=e;p<r;p++){const m=this.collisionBoxArray.get(p);this.addCollisionDebugVertices(m.x1,m.y1,m.x2,m.y2,c?this.textCollisionBox:this.iconCollisionBox,m.anchorPoint,a)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Vu($i,Bd.members,Yi),this.iconCollisionBox=new Vu($i,Bd.members,Yi);for(let e=0;e<this.symbolInstances.length;e++){const r=this.symbolInstances.get(e);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(e,r,a,c,p,m,g,b,C){const I={};for(let A=r;A<a;A++){const R=e.get(A);I.textBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,anchorPointX:R.anchorPointX,anchorPointY:R.anchorPointY},I.textFeatureIndex=R.featureIndex;break}for(let A=c;A<p;A++){const R=e.get(A);I.verticalTextBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,anchorPointX:R.anchorPointX,anchorPointY:R.anchorPointY},I.verticalTextFeatureIndex=R.featureIndex;break}for(let A=m;A<g;A++){const R=e.get(A);I.iconBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,anchorPointX:R.anchorPointX,anchorPointY:R.anchorPointY},I.iconFeatureIndex=R.featureIndex;break}for(let A=b;A<C;A++){const R=e.get(A);I.verticalIconBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,anchorPointX:R.anchorPointX,anchorPointY:R.anchorPointY},I.verticalIconFeatureIndex=R.featureIndex;break}return I}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const a=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const a=e.placedSymbolArray.get(r),c=a.vertexStartIndex+4*a.numGlyphs;for(let p=a.vertexStartIndex;p<c;p+=4)e.indexArray.emplaceBack(p,p+1,p+2),e.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),a=Math.cos(e),c=[],p=[],m=[];for(let g=0;g<this.symbolInstances.length;++g){m.push(g);const b=this.symbolInstances.get(g);c.push(0|Math.round(r*b.anchorX+a*b.anchorY)),p.push(b.featureIndex)}return m.sort((g,b)=>c[g]-c[b]||p[b]-p[g]),m}addToSortKeyRanges(e,r){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===r?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const a=this.symbolInstances.get(r);this.featureSortOrder.push(a.featureIndex),[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach((c,p,m)=>{c>=0&&m.indexOf(c)===p&&this.addIndicesForPlacedSymbol(this.text,c)}),a.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,a.verticalPlacedTextSymbolIndex),a.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.placedIconSymbolIndex),a.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let tp,ip;it("SymbolBucket",Ho,{omit:["layers","collisionBoxArray","features","compareText"]}),Ho.MAX_GLYPHS=65535,Ho.addDynamicAttributes=Nu;var Uu={get paint(){return ip=ip||new ji({"icon-opacity":new xt(Te.paint_symbol["icon-opacity"]),"icon-color":new xt(Te.paint_symbol["icon-color"]),"icon-halo-color":new xt(Te.paint_symbol["icon-halo-color"]),"icon-halo-width":new xt(Te.paint_symbol["icon-halo-width"]),"icon-halo-blur":new xt(Te.paint_symbol["icon-halo-blur"]),"icon-translate":new pt(Te.paint_symbol["icon-translate"]),"icon-translate-anchor":new pt(Te.paint_symbol["icon-translate-anchor"]),"text-opacity":new xt(Te.paint_symbol["text-opacity"]),"text-color":new xt(Te.paint_symbol["text-color"],{runtimeType:wi,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new xt(Te.paint_symbol["text-halo-color"]),"text-halo-width":new xt(Te.paint_symbol["text-halo-width"]),"text-halo-blur":new xt(Te.paint_symbol["text-halo-blur"]),"text-translate":new pt(Te.paint_symbol["text-translate"]),"text-translate-anchor":new pt(Te.paint_symbol["text-translate-anchor"])})},get layout(){return tp=tp||new ji({"symbol-placement":new pt(Te.layout_symbol["symbol-placement"]),"symbol-spacing":new pt(Te.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new pt(Te.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new xt(Te.layout_symbol["symbol-sort-key"]),"symbol-z-order":new pt(Te.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new pt(Te.layout_symbol["icon-allow-overlap"]),"icon-overlap":new pt(Te.layout_symbol["icon-overlap"]),"icon-ignore-placement":new pt(Te.layout_symbol["icon-ignore-placement"]),"icon-optional":new pt(Te.layout_symbol["icon-optional"]),"icon-rotation-alignment":new pt(Te.layout_symbol["icon-rotation-alignment"]),"icon-size":new xt(Te.layout_symbol["icon-size"]),"icon-text-fit":new pt(Te.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new pt(Te.layout_symbol["icon-text-fit-padding"]),"icon-image":new xt(Te.layout_symbol["icon-image"]),"icon-rotate":new xt(Te.layout_symbol["icon-rotate"]),"icon-padding":new xt(Te.layout_symbol["icon-padding"]),"icon-keep-upright":new pt(Te.layout_symbol["icon-keep-upright"]),"icon-offset":new xt(Te.layout_symbol["icon-offset"]),"icon-anchor":new xt(Te.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new pt(Te.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new pt(Te.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new pt(Te.layout_symbol["text-rotation-alignment"]),"text-field":new xt(Te.layout_symbol["text-field"]),"text-font":new xt(Te.layout_symbol["text-font"]),"text-size":new xt(Te.layout_symbol["text-size"]),"text-max-width":new xt(Te.layout_symbol["text-max-width"]),"text-line-height":new pt(Te.layout_symbol["text-line-height"]),"text-letter-spacing":new xt(Te.layout_symbol["text-letter-spacing"]),"text-justify":new xt(Te.layout_symbol["text-justify"]),"text-radial-offset":new xt(Te.layout_symbol["text-radial-offset"]),"text-variable-anchor":new pt(Te.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new xt(Te.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new xt(Te.layout_symbol["text-anchor"]),"text-max-angle":new pt(Te.layout_symbol["text-max-angle"]),"text-writing-mode":new pt(Te.layout_symbol["text-writing-mode"]),"text-rotate":new xt(Te.layout_symbol["text-rotate"]),"text-padding":new pt(Te.layout_symbol["text-padding"]),"text-keep-upright":new pt(Te.layout_symbol["text-keep-upright"]),"text-transform":new xt(Te.layout_symbol["text-transform"]),"text-offset":new xt(Te.layout_symbol["text-offset"]),"text-allow-overlap":new pt(Te.layout_symbol["text-allow-overlap"]),"text-overlap":new pt(Te.layout_symbol["text-overlap"]),"text-ignore-placement":new pt(Te.layout_symbol["text-ignore-placement"]),"text-optional":new pt(Te.layout_symbol["text-optional"])})}};class rp{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:zt,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}it("FormatSectionOverride",rp,{omit:["defaultValue"]});class vc extends Kr{constructor(e){super(e,Uu)}recalculate(e,r){if(super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const a=this.layout.get("text-writing-mode");if(a){const c=[];for(const p of a)c.indexOf(p)<0&&c.push(p);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,r,a,c){const p=this.layout.get(e).evaluate(r,{},a,c),m=this._unevaluatedLayout._values[e];return m.isDataDriven()||Io(m.value)||!p?p:function(g,b){return b.replace(/{([^{}]+)}/g,(C,I)=>g&&I in g?String(g[I]):"")}(r.properties,p)}createBucket(e){return new Ho(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of Uu.paint.overridableProperties){if(!vc.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),a=new rp(r),c=new xs(a,r.property.specification);let p=null;p=r.value.kind==="constant"||r.value.kind==="source"?new bs("source",c):new Mo("composite",c,r.value.zoomStops),this.paint._values[e]=new yr(r.property,p,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,a){return!(!this.layout||r.isDataDriven()||a.isDataDriven())&&vc.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const a=e.get("text-field"),c=Uu.paint.properties[r];let p=!1;const m=g=>{for(const b of g)if(c.overrides&&c.overrides.hasOverride(b))return void(p=!0)};if(a.value.kind==="constant"&&a.value.value instanceof hr)m(a.value.value.sections);else if(a.value.kind==="source"){const g=C=>{p||(C instanceof Xn&&Ti(C.value)===W?m(C.value.sections):C instanceof Eo?m(C.sections):C.eachChild(g))},b=a.value;b._styleExpression&&g(b._styleExpression.expression)}return p}}let np;var l_={get paint(){return np=np||new ji({"background-color":new pt(Te.paint_background["background-color"]),"background-pattern":new $s(Te.paint_background["background-pattern"]),"background-opacity":new pt(Te.paint_background["background-opacity"])})}};class c_ extends Kr{constructor(e){super(e,l_)}}let ap;var u_={get paint(){return ap=ap||new ji({"raster-opacity":new pt(Te.paint_raster["raster-opacity"]),"raster-hue-rotate":new pt(Te.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new pt(Te.paint_raster["raster-brightness-min"]),"raster-brightness-max":new pt(Te.paint_raster["raster-brightness-max"]),"raster-saturation":new pt(Te.paint_raster["raster-saturation"]),"raster-contrast":new pt(Te.paint_raster["raster-contrast"]),"raster-resampling":new pt(Te.paint_raster["raster-resampling"]),"raster-fade-duration":new pt(Te.paint_raster["raster-fade-duration"])})}};class h_ extends Kr{constructor(e){super(e,u_)}}class d_ extends Kr{constructor(e){super(e,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class p_{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const qu=63710088e-1;class Ia{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ia(Be(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,a=this.lat*r,c=e.lat*r,p=Math.sin(a)*Math.sin(c)+Math.cos(a)*Math.cos(c)*Math.cos((e.lng-this.lng)*r);return qu*Math.acos(Math.min(p,1))}static convert(e){if(e instanceof Ia)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Ia(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Ia(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const op=2*Math.PI*qu;function sp(i){return op*Math.cos(i*Math.PI/180)}function lp(i){return(180+i)/360}function cp(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function up(i,e){return i/sp(e)}function hp(i){return 360*i-180}function Gu(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class xc{constructor(e,r,a=0){this.x=+e,this.y=+r,this.z=+a}static fromLngLat(e,r=0){const a=Ia.convert(e);return new xc(lp(a.lng),cp(a.lat),up(r,a.lat))}toLngLat(){return new Ia(hp(this.x),Gu(this.y))}toAltitude(){return this.z*sp(Gu(this.y))}meterInMercatorCoordinateUnits(){return 1/op*(e=Gu(this.y),1/Math.cos(e*Math.PI/180));var e}}function dp(i,e,r){var a=2*Math.PI*6378137/256/Math.pow(2,r);return[i*a-2*Math.PI*6378137/2,e*a-2*Math.PI*6378137/2]}class Zu{constructor(e,r,a){if(e<0||e>25||a<0||a>=Math.pow(2,e)||r<0||r>=Math.pow(2,e))throw new Error(`x=${r}, y=${a}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=r,this.y=a,this.key=nl(0,e,e,r,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r,a){const c=(m=this.y,g=this.z,b=dp(256*(p=this.x),256*(m=Math.pow(2,g)-m-1),g),C=dp(256*(p+1),256*(m+1),g),b[0]+","+b[1]+","+C[0]+","+C[1]);var p,m,g,b,C;const I=function(A,R,F){let N,G="";for(let Y=A;Y>0;Y--)N=1<<Y-1,G+=(R&N?1:0)+(F&N?2:0);return G}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,I).replace(/{bbox-epsg-3857}/g,c)}isChildOf(e){const r=this.z-e.z;return r>0&&e.x===this.x>>r&&e.y===this.y>>r}getTilePoint(e){const r=Math.pow(2,this.z);return new Q((e.x*r-this.x)*Hi,(e.y*r-this.y)*Hi)}toString(){return`${this.z}/${this.x}/${this.y}`}}class pp{constructor(e,r){this.wrap=e,this.canonical=r,this.key=nl(e,r.z,r.z,r.x,r.y)}}class rn{constructor(e,r,a,c,p){if(e<a)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${a}`);this.overscaledZ=e,this.wrap=r,this.canonical=new Zu(a,+c,+p),this.key=nl(r,e,a,c,p)}clone(){return new rn(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-e;return e>this.canonical.z?new rn(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new rn(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const a=this.canonical.z-e;return e>this.canonical.z?nl(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y):nl(this.wrap*+r,e,e,this.canonical.x>>a,this.canonical.y>>a)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new rn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,a=2*this.canonical.x,c=2*this.canonical.y;return[new rn(r,this.wrap,r,a,c),new rn(r,this.wrap,r,a+1,c),new rn(r,this.wrap,r,a,c+1),new rn(r,this.wrap,r,a+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new rn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new rn(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new pp(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new xc(e.x-this.wrap,e.y))}}function nl(i,e,r,a,c){(i*=2)<0&&(i=-1*i-1);const p=1<<r;return(p*p*i+p*c+a).toString(36)+r.toString(36)+e.toString(36)}it("CanonicalTileID",Zu),it("OverscaledTileID",rn,{omit:["posMatrix"]});class fp{constructor(e,r,a,c=1,p=1,m=1,g=0){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(a&&!["mapbox","terrarium","custom"].includes(a))return void He(`"${a}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const b=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),a){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=c,this.greenFactor=p,this.blueFactor=m,this.baseShift=g;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let C=0;C<b;C++)this.data[this._idx(-1,C)]=this.data[this._idx(0,C)],this.data[this._idx(b,C)]=this.data[this._idx(b-1,C)],this.data[this._idx(C,-1)]=this.data[this._idx(C,0)],this.data[this._idx(C,b)]=this.data[this._idx(C,b-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(b,-1)]=this.data[this._idx(b-1,0)],this.data[this._idx(-1,b)]=this.data[this._idx(0,b-1)],this.data[this._idx(b,b)]=this.data[this._idx(b-1,b-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let C=0;C<b;C++)for(let I=0;I<b;I++){const A=this.get(C,I);A>this.max&&(this.max=A),A<this.min&&(this.min=A)}}get(e,r){const a=new Uint8Array(this.data.buffer),c=4*this._idx(e,r);return this.unpack(a[c],a[c+1],a[c+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}unpack(e,r,a){return e*this.redFactor+r*this.greenFactor+a*this.blueFactor-this.baseShift}getPixels(){return new tn({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,r,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=r*this.dim,p=r*this.dim+this.dim,m=a*this.dim,g=a*this.dim+this.dim;switch(r){case-1:c=p-1;break;case 1:p=c+1}switch(a){case-1:m=g-1;break;case 1:g=m+1}const b=-r*this.dim,C=-a*this.dim;for(let I=m;I<g;I++)for(let A=c;A<p;A++)this.data[this._idx(A,I)]=e.data[this._idx(A+b,I+C)]}}it("DEMData",fp);class mp{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const a=e[r];this._stringToNumber[a]=r,this._numberToString[r]=a}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class gp{constructor(e,r,a,c,p){this.type="Feature",this._vectorTileFeature=e,e._z=r,e._x=a,e._y=c,this.properties=e.properties,this.id=p}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(e[r]=this[r]);return e}}class yp{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new va(Hi,16,0),this.grid3D=new va(Hi,16,0),this.featureIndexArray=new Re,this.promoteId=r}insert(e,r,a,c,p,m){const g=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,c,p);const b=m?this.grid3D:this.grid;for(let C=0;C<r.length;C++){const I=r[C],A=[1/0,1/0,-1/0,-1/0];for(let R=0;R<I.length;R++){const F=I[R];A[0]=Math.min(A[0],F.x),A[1]=Math.min(A[1],F.y),A[2]=Math.max(A[2],F.x),A[3]=Math.max(A[3],F.y)}A[0]<Hi&&A[1]<Hi&&A[2]>=0&&A[3]>=0&&b.insert(g,A[0],A[1],A[2],A[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Ca.VectorTile(new Du(this.rawTileData)).layers,this.sourceLayerCoder=new mp(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,r,a,c){this.loadVTLayers();const p=e.params||{},m=Hi/e.tileSize/e.scale,g=Ss(p.filter),b=e.queryGeometry,C=e.queryPadding*m,I=vp(b),A=this.grid.query(I.minX-C,I.minY-C,I.maxX+C,I.maxY+C),R=vp(e.cameraQueryGeometry),F=this.grid3D.query(R.minX-C,R.minY-C,R.maxX+C,R.maxY+C,(Y,ie,ue,re)=>function(de,ye,ke,et,ct){for(const Xe of de)if(ye<=Xe.x&&ke<=Xe.y&&et>=Xe.x&&ct>=Xe.y)return!0;const Je=[new Q(ye,ke),new Q(ye,ct),new Q(et,ct),new Q(et,ke)];if(de.length>2){for(const Xe of Je)if(No(de,Xe))return!0}for(let Xe=0;Xe<de.length-1;Xe++)if(Gg(de[Xe],de[Xe+1],Je))return!0;return!1}(e.cameraQueryGeometry,Y-C,ie-C,ue+C,re+C));for(const Y of F)A.push(Y);A.sort(f_);const N={};let G;for(let Y=0;Y<A.length;Y++){const ie=A[Y];if(ie===G)continue;G=ie;const ue=this.featureIndexArray.get(ie);let re=null;this.loadMatchingFeature(N,ue.bucketIndex,ue.sourceLayerIndex,ue.featureIndex,g,p.layers,p.availableImages,r,a,c,(de,ye,ke)=>(re||(re=Ya(de)),ye.queryIntersectsFeature(b,de,ke,re,this.z,e.transform,m,e.pixelPosMatrix)))}return N}loadMatchingFeature(e,r,a,c,p,m,g,b,C,I,A){const R=this.bucketLayerIDs[r];if(m&&!function(Y,ie){for(let ue=0;ue<Y.length;ue++)if(ie.indexOf(Y[ue])>=0)return!0;return!1}(m,R))return;const F=this.sourceLayerCoder.decode(a),N=this.vtLayers[F].feature(c);if(p.needGeometry){const Y=Ja(N,!0);if(!p.filter(new _i(this.tileID.overscaledZ),Y,this.tileID.canonical))return}else if(!p.filter(new _i(this.tileID.overscaledZ),N))return;const G=this.getId(N,F);for(let Y=0;Y<R.length;Y++){const ie=R[Y];if(m&&m.indexOf(ie)<0)continue;const ue=b[ie];if(!ue)continue;let re={};G&&I&&(re=I.getState(ue.sourceLayer||"_geojsonTileLayer",G));const de=$e({},C[ie]);de.paint=_p(de.paint,ue.paint,N,re,g),de.layout=_p(de.layout,ue.layout,N,re,g);const ye=!A||A(N,ue,re);if(!ye)continue;const ke=new gp(N,this.z,this.x,this.y,G);ke.layer=de;let et=e[ie];et===void 0&&(et=e[ie]=[]),et.push({featureIndex:c,feature:ke,intersectionZ:ye})}}lookupSymbolFeatures(e,r,a,c,p,m,g,b){const C={};this.loadVTLayers();const I=Ss(p);for(const A of e)this.loadMatchingFeature(C,a,c,A,I,m,g,b,r);return C}hasLayer(e){for(const r of this.bucketLayerIDs)for(const a of r)if(e===a)return!0;return!1}getId(e,r){let a=e.id;return this.promoteId&&(a=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof a=="boolean"&&(a=Number(a))),a}}function _p(i,e,r,a,c){return Ce(i,(p,m)=>{const g=e instanceof Bo?e.get(m):null;return g&&g.evaluate?g.evaluate(r,a,c):g})}function vp(i){let e=1/0,r=1/0,a=-1/0,c=-1/0;for(const p of i)e=Math.min(e,p.x),r=Math.min(r,p.y),a=Math.max(a,p.x),c=Math.max(c,p.y);return{minX:e,minY:r,maxX:a,maxY:c}}function f_(i,e){return e-i}function xp(i,e,r,a,c){const p=[];for(let m=0;m<i.length;m++){const g=i[m];let b;for(let C=0;C<g.length-1;C++){let I=g[C],A=g[C+1];I.x<e&&A.x<e||(I.x<e?I=new Q(e,I.y+(e-I.x)/(A.x-I.x)*(A.y-I.y))._round():A.x<e&&(A=new Q(e,I.y+(e-I.x)/(A.x-I.x)*(A.y-I.y))._round()),I.y<r&&A.y<r||(I.y<r?I=new Q(I.x+(r-I.y)/(A.y-I.y)*(A.x-I.x),r)._round():A.y<r&&(A=new Q(I.x+(r-I.y)/(A.y-I.y)*(A.x-I.x),r)._round()),I.x>=a&&A.x>=a||(I.x>=a?I=new Q(a,I.y+(a-I.x)/(A.x-I.x)*(A.y-I.y))._round():A.x>=a&&(A=new Q(a,I.y+(a-I.x)/(A.x-I.x)*(A.y-I.y))._round()),I.y>=c&&A.y>=c||(I.y>=c?I=new Q(I.x+(c-I.y)/(A.y-I.y)*(A.x-I.x),c)._round():A.y>=c&&(A=new Q(I.x+(c-I.y)/(A.y-I.y)*(A.x-I.x),c)._round()),b&&I.equals(b[b.length-1])||(b=[I],p.push(b)),b.push(A)))))}}return p}it("FeatureIndex",yp,{omit:["rawTileData","sourceLayerCoder"]});class Pa extends Q{constructor(e,r,a,c){super(e,r),this.angle=a,c!==void 0&&(this.segment=c)}clone(){return new Pa(this.x,this.y,this.angle,this.segment)}}function bp(i,e,r,a,c){if(e.segment===void 0||r===0)return!0;let p=e,m=e.segment+1,g=0;for(;g>-r/2;){if(m--,m<0)return!1;g-=i[m].dist(p),p=i[m]}g+=i[m].dist(i[m+1]),m++;const b=[];let C=0;for(;g<r/2;){const I=i[m],A=i[m+1];if(!A)return!1;let R=i[m-1].angleTo(I)-I.angleTo(A);for(R=Math.abs((R+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:g,angleDelta:R}),C+=R;g-b[0].distance>a;)C-=b.shift().angleDelta;if(C>c)return!1;m++,g+=I.dist(A)}return!0}function wp(i){let e=0;for(let r=0;r<i.length-1;r++)e+=i[r].dist(i[r+1]);return e}function Sp(i,e,r){return i?.6*e*r:0}function Cp(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function m_(i,e,r,a,c,p){const m=Sp(r,c,p),g=Cp(r,a)*p;let b=0;const C=wp(i)/2;for(let I=0;I<i.length-1;I++){const A=i[I],R=i[I+1],F=A.dist(R);if(b+F>C){const N=(C-b)/F,G=Dr.number(A.x,R.x,N),Y=Dr.number(A.y,R.y,N),ie=new Pa(G,Y,R.angleTo(A),I);return ie._round(),!m||bp(i,ie,g,m,e)?ie:void 0}b+=F}}function g_(i,e,r,a,c,p,m,g,b){const C=Sp(a,p,m),I=Cp(a,c),A=I*m,R=i[0].x===0||i[0].x===b||i[0].y===0||i[0].y===b;return e-A<e/4&&(e=A+e/4),Tp(i,R?e/2*g%e:(I/2+2*p)*m*g%e,e,C,r,A,R,!1,b)}function Tp(i,e,r,a,c,p,m,g,b){const C=p/2,I=wp(i);let A=0,R=e-r,F=[];for(let N=0;N<i.length-1;N++){const G=i[N],Y=i[N+1],ie=G.dist(Y),ue=Y.angleTo(G);for(;R+r<A+ie;){R+=r;const re=(R-A)/ie,de=Dr.number(G.x,Y.x,re),ye=Dr.number(G.y,Y.y,re);if(de>=0&&de<b&&ye>=0&&ye<b&&R-C>=0&&R+C<=I){const ke=new Pa(de,ye,ue,N);ke._round(),a&&!bp(i,ke,p,a,c)||F.push(ke)}}A+=ie}return g||F.length||m||(F=Tp(i,A/2,r,a,c,p,m,!0,b)),F}it("Anchor",Pa);const Wo=Fr;function Ep(i,e,r,a){const c=[],p=i.image,m=p.pixelRatio,g=p.paddedRect.w-2*Wo,b=p.paddedRect.h-2*Wo,C=i.right-i.left,I=i.bottom-i.top,A=p.stretchX||[[0,g]],R=p.stretchY||[[0,b]],F=(qe,rt)=>qe+rt[1]-rt[0],N=A.reduce(F,0),G=R.reduce(F,0),Y=g-N,ie=b-G;let ue=0,re=N,de=0,ye=G,ke=0,et=Y,ct=0,Je=ie;if(p.content&&a){const qe=p.content;ue=bc(A,0,qe[0]),de=bc(R,0,qe[1]),re=bc(A,qe[0],qe[2]),ye=bc(R,qe[1],qe[3]),ke=qe[0]-ue,ct=qe[1]-de,et=qe[2]-qe[0]-re,Je=qe[3]-qe[1]-ye}const Xe=(qe,rt,Ze,Ne)=>{const yt=wc(qe.stretch-ue,re,C,i.left),ht=Sc(qe.fixed-ke,et,qe.stretch,N),Nt=wc(rt.stretch-de,ye,I,i.top),xi=Sc(rt.fixed-ct,Je,rt.stretch,G),Ci=wc(Ze.stretch-ue,re,C,i.left),er=Sc(Ze.fixed-ke,et,Ze.stretch,N),Jr=wc(Ne.stretch-de,ye,I,i.top),Mr=Sc(Ne.fixed-ct,Je,Ne.stretch,G),Wi=new Q(yt,Nt),ur=new Q(Ci,Nt),fr=new Q(Ci,Jr),Ar=new Q(yt,Jr),kr=new Q(ht/m,xi/m),tr=new Q(er/m,Mr/m),ir=e*Math.PI/180;if(ir){const xr=Math.sin(ir),Nr=Math.cos(ir),jr=[Nr,-xr,xr,Nr];Wi._matMult(jr),ur._matMult(jr),Ar._matMult(jr),fr._matMult(jr)}const vr=qe.stretch+qe.fixed,zr=rt.stretch+rt.fixed;return{tl:Wi,tr:ur,bl:Ar,br:fr,tex:{x:p.paddedRect.x+Wo+vr,y:p.paddedRect.y+Wo+zr,w:Ze.stretch+Ze.fixed-vr,h:Ne.stretch+Ne.fixed-zr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:kr,pixelOffsetBR:tr,minFontScaleX:et/m/C,minFontScaleY:Je/m/I,isSDF:r}};if(a&&(p.stretchX||p.stretchY)){const qe=Ip(A,Y,N),rt=Ip(R,ie,G);for(let Ze=0;Ze<qe.length-1;Ze++){const Ne=qe[Ze],yt=qe[Ze+1];for(let ht=0;ht<rt.length-1;ht++)c.push(Xe(Ne,rt[ht],yt,rt[ht+1]))}}else c.push(Xe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:g+1},{fixed:0,stretch:b+1}));return c}function bc(i,e,r){let a=0;for(const c of i)a+=Math.max(e,Math.min(r,c[1]))-Math.max(e,Math.min(r,c[0]));return a}function Ip(i,e,r){const a=[{fixed:-Wo,stretch:0}];for(const[c,p]of i){const m=a[a.length-1];a.push({fixed:c-m.stretch,stretch:m.stretch}),a.push({fixed:c-m.stretch,stretch:m.stretch+(p-c)})}return a.push({fixed:e+Wo,stretch:r}),a}function wc(i,e,r,a){return i/e*r+a}function Sc(i,e,r,a){return i-e*r/a}class Cc{constructor(e,r,a,c,p,m,g,b,C,I){if(this.boxStartIndex=e.length,C){let A=m.top,R=m.bottom;const F=m.collisionPadding;F&&(A-=F[1],R+=F[3]);let N=R-A;N>0&&(N=Math.max(10,N),this.circleDiameter=N)}else{let A=m.top*g-b[0],R=m.bottom*g+b[2],F=m.left*g-b[3],N=m.right*g+b[1];const G=m.collisionPadding;if(G&&(F-=G[0]*g,A-=G[1]*g,N+=G[2]*g,R+=G[3]*g),I){const Y=new Q(F,A),ie=new Q(N,A),ue=new Q(F,R),re=new Q(N,R),de=I*Math.PI/180;Y._rotate(de),ie._rotate(de),ue._rotate(de),re._rotate(de),F=Math.min(Y.x,ie.x,ue.x,re.x),N=Math.max(Y.x,ie.x,ue.x,re.x),A=Math.min(Y.y,ie.y,ue.y,re.y),R=Math.max(Y.y,ie.y,ue.y,re.y)}e.emplaceBack(r.x,r.y,F,A,N,R,a,c,p)}this.boxEndIndex=e.length}}class y_{constructor(e=[],r=__){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:a}=this,c=r[e];for(;e>0;){const p=e-1>>1,m=r[p];if(a(c,m)>=0)break;r[e]=m,e=p}r[e]=c}_down(e){const{data:r,compare:a}=this,c=this.length>>1,p=r[e];for(;e<c;){let m=1+(e<<1),g=r[m];const b=m+1;if(b<this.length&&a(r[b],g)<0&&(m=b,g=r[b]),a(g,p)>=0)break;r[e]=g,e=m}r[e]=p}}function __(i,e){return i<e?-1:i>e?1:0}function v_(i,e=1,r=!1){let a=1/0,c=1/0,p=-1/0,m=-1/0;const g=i[0];for(let F=0;F<g.length;F++){const N=g[F];(!F||N.x<a)&&(a=N.x),(!F||N.y<c)&&(c=N.y),(!F||N.x>p)&&(p=N.x),(!F||N.y>m)&&(m=N.y)}const b=Math.min(p-a,m-c);let C=b/2;const I=new y_([],x_);if(b===0)return new Q(a,c);for(let F=a;F<p;F+=b)for(let N=c;N<m;N+=b)I.push(new Xo(F+C,N+C,C,i));let A=function(F){let N=0,G=0,Y=0;const ie=F[0];for(let ue=0,re=ie.length,de=re-1;ue<re;de=ue++){const ye=ie[ue],ke=ie[de],et=ye.x*ke.y-ke.x*ye.y;G+=(ye.x+ke.x)*et,Y+=(ye.y+ke.y)*et,N+=3*et}return new Xo(G/N,Y/N,0,F)}(i),R=I.length;for(;I.length;){const F=I.pop();(F.d>A.d||!A.d)&&(A=F,r&&console.log("found best %d after %d probes",Math.round(1e4*F.d)/1e4,R)),F.max-A.d<=e||(C=F.h/2,I.push(new Xo(F.p.x-C,F.p.y-C,C,i)),I.push(new Xo(F.p.x+C,F.p.y-C,C,i)),I.push(new Xo(F.p.x-C,F.p.y+C,C,i)),I.push(new Xo(F.p.x+C,F.p.y+C,C,i)),R+=4)}return r&&(console.log(`num probes: ${R}`),console.log(`best distance: ${A.d}`)),A.p}function x_(i,e){return e.max-i.max}function Xo(i,e,r,a){this.p=new Q(i,e),this.h=r,this.d=function(c,p){let m=!1,g=1/0;for(let b=0;b<p.length;b++){const C=p[b];for(let I=0,A=C.length,R=A-1;I<A;R=I++){const F=C[I],N=C[R];F.y>c.y!=N.y>c.y&&c.x<(N.x-F.x)*(c.y-F.y)/(N.y-F.y)+F.x&&(m=!m),g=Math.min(g,cd(c,F,N))}}return(m?1:-1)*Math.sqrt(g)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}var pr;o.aq=void 0,(pr=o.aq||(o.aq={}))[pr.center=1]="center",pr[pr.left=2]="left",pr[pr.right=3]="right",pr[pr.top=4]="top",pr[pr.bottom=5]="bottom",pr[pr["top-left"]=6]="top-left",pr[pr["top-right"]=7]="top-right",pr[pr["bottom-left"]=8]="bottom-left",pr[pr["bottom-right"]=9]="bottom-right";const Ma=7,Hu=Number.POSITIVE_INFINITY;function Pp(i,e){return e[1]!==Hu?function(r,a,c){let p=0,m=0;switch(a=Math.abs(a),c=Math.abs(c),r){case"top-right":case"top-left":case"top":m=c-Ma;break;case"bottom-right":case"bottom-left":case"bottom":m=-c+Ma}switch(r){case"top-right":case"bottom-right":case"right":p=-a;break;case"top-left":case"bottom-left":case"left":p=a}return[p,m]}(i,e[0],e[1]):function(r,a){let c=0,p=0;a<0&&(a=0);const m=a/Math.SQRT2;switch(r){case"top-right":case"top-left":p=m-Ma;break;case"bottom-right":case"bottom-left":p=-m+Ma;break;case"bottom":p=-a+Ma;break;case"top":p=a-Ma}switch(r){case"top-right":case"bottom-right":c=-m;break;case"top-left":case"bottom-left":c=m;break;case"left":c=a;break;case"right":c=-a}return[c,p]}(i,e[0])}function Mp(i,e,r){var a;const c=i.layout,p=(a=c.get("text-variable-anchor-offset"))===null||a===void 0?void 0:a.evaluate(e,{},r);if(p){const g=p.values,b=[];for(let C=0;C<g.length;C+=2){const I=b[C]=g[C],A=g[C+1].map(R=>R*Qi);I.startsWith("top")?A[1]-=Ma:I.startsWith("bottom")&&(A[1]+=Ma),b[C+1]=A}return new Zr(b)}const m=c.get("text-variable-anchor");if(m){let g;g=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[c.get("text-radial-offset").evaluate(e,{},r)*Qi,Hu]:c.get("text-offset").evaluate(e,{},r).map(C=>C*Qi);const b=[];for(const C of m)b.push(C,Pp(C,g));return new Zr(b)}return null}function Wu(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function b_(i,e,r,a,c,p,m,g,b,C,I){let A=p.textMaxSize.evaluate(e,{});A===void 0&&(A=m);const R=i.layers[0].layout,F=R.get("icon-offset").evaluate(e,{},I),N=kp(r.horizontal),G=m/24,Y=i.tilePixelRatio*G,ie=i.tilePixelRatio*A/24,ue=i.tilePixelRatio*g,re=i.tilePixelRatio*R.get("symbol-spacing"),de=R.get("text-padding")*i.tilePixelRatio,ye=function(Ne,yt,ht,Nt=1){const xi=Ne.get("icon-padding").evaluate(yt,{},ht),Ci=xi&&xi.values;return[Ci[0]*Nt,Ci[1]*Nt,Ci[2]*Nt,Ci[3]*Nt]}(R,e,I,i.tilePixelRatio),ke=R.get("text-max-angle")/180*Math.PI,et=R.get("text-rotation-alignment")!=="viewport"&&R.get("symbol-placement")!=="point",ct=R.get("icon-rotation-alignment")==="map"&&R.get("symbol-placement")!=="point",Je=R.get("symbol-placement"),Xe=re/2,qe=R.get("icon-text-fit");let rt;a&&qe!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(rt=Qd(a,r.vertical,qe,R.get("icon-text-fit-padding"),F,G)),N&&(a=Qd(a,N,qe,R.get("icon-text-fit-padding"),F,G)));const Ze=(Ne,yt)=>{yt.x<0||yt.x>=Hi||yt.y<0||yt.y>=Hi||function(ht,Nt,xi,Ci,er,Jr,Mr,Wi,ur,fr,Ar,kr,tr,ir,vr,zr,xr,Nr,jr,rr,Zt,br,mr,nr,gn){const In=ht.addToLineVertexArray(Nt,xi);let Pn,la,yn,nn,Vr=0,ca=0,sl=0,Rp=0,ih=-1,rh=-1;const ua={};let $p=na("");if(ht.allowVerticalPlacement&&Ci.vertical){const wr=Wi.layout.get("text-rotate").evaluate(Zt,{},nr)+90;yn=new Cc(ur,Nt,fr,Ar,kr,Ci.vertical,tr,ir,vr,wr),Mr&&(nn=new Cc(ur,Nt,fr,Ar,kr,Mr,xr,Nr,vr,wr))}if(er){const wr=Wi.layout.get("icon-rotate").evaluate(Zt,{}),an=Wi.layout.get("icon-text-fit")!=="none",eo=Ep(er,wr,mr,an),An=Mr?Ep(Mr,wr,mr,an):void 0;la=new Cc(ur,Nt,fr,Ar,kr,er,xr,Nr,!1,wr),Vr=4*eo.length;const to=ht.iconSizeData;let Gn=null;to.kind==="source"?(Gn=[qn*Wi.layout.get("icon-size").evaluate(Zt,{})],Gn[0]>Ea&&He(`${ht.layerIds[0]}: Value for "icon-size" is >= ${rl}. Reduce your "icon-size".`)):to.kind==="composite"&&(Gn=[qn*br.compositeIconSizes[0].evaluate(Zt,{},nr),qn*br.compositeIconSizes[1].evaluate(Zt,{},nr)],(Gn[0]>Ea||Gn[1]>Ea)&&He(`${ht.layerIds[0]}: Value for "icon-size" is >= ${rl}. Reduce your "icon-size".`)),ht.addSymbols(ht.icon,eo,Gn,rr,jr,Zt,o.ai.none,Nt,In.lineStartIndex,In.lineLength,-1,nr),ih=ht.icon.placedSymbolArray.length-1,An&&(ca=4*An.length,ht.addSymbols(ht.icon,An,Gn,rr,jr,Zt,o.ai.vertical,Nt,In.lineStartIndex,In.lineLength,-1,nr),rh=ht.icon.placedSymbolArray.length-1)}const Op=Object.keys(Ci.horizontal);for(const wr of Op){const an=Ci.horizontal[wr];if(!Pn){$p=na(an.text);const An=Wi.layout.get("text-rotate").evaluate(Zt,{},nr);Pn=new Cc(ur,Nt,fr,Ar,kr,an,tr,ir,vr,An)}const eo=an.positionedLines.length===1;if(sl+=Ap(ht,Nt,an,Jr,Wi,vr,Zt,zr,In,Ci.vertical?o.ai.horizontal:o.ai.horizontalOnly,eo?Op:[wr],ua,ih,br,nr),eo)break}Ci.vertical&&(Rp+=Ap(ht,Nt,Ci.vertical,Jr,Wi,vr,Zt,zr,In,o.ai.vertical,["vertical"],ua,rh,br,nr));const C_=Pn?Pn.boxStartIndex:ht.collisionBoxArray.length,T_=Pn?Pn.boxEndIndex:ht.collisionBoxArray.length,E_=yn?yn.boxStartIndex:ht.collisionBoxArray.length,I_=yn?yn.boxEndIndex:ht.collisionBoxArray.length,P_=la?la.boxStartIndex:ht.collisionBoxArray.length,M_=la?la.boxEndIndex:ht.collisionBoxArray.length,A_=nn?nn.boxStartIndex:ht.collisionBoxArray.length,k_=nn?nn.boxEndIndex:ht.collisionBoxArray.length;let Mn=-1;const Ec=(wr,an)=>wr&&wr.circleDiameter?Math.max(wr.circleDiameter,an):an;Mn=Ec(Pn,Mn),Mn=Ec(yn,Mn),Mn=Ec(la,Mn),Mn=Ec(nn,Mn);const Bp=Mn>-1?1:0;Bp&&(Mn*=gn/Qi),ht.glyphOffsetArray.length>=Ho.MAX_GLYPHS&&He("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Zt.sortKey!==void 0&&ht.addToSortKeyRanges(ht.symbolInstances.length,Zt.sortKey);const z_=Mp(Wi,Zt,nr),[L_,D_]=function(wr,an){const eo=wr.length,An=an?.values;if(An?.length>0)for(let to=0;to<An.length;to+=2){const Gn=An[to+1];wr.emplaceBack(o.aq[An[to]],Gn[0],Gn[1])}return[eo,wr.length]}(ht.textAnchorOffsets,z_);ht.symbolInstances.emplaceBack(Nt.x,Nt.y,ua.right>=0?ua.right:-1,ua.center>=0?ua.center:-1,ua.left>=0?ua.left:-1,ua.vertical||-1,ih,rh,$p,C_,T_,E_,I_,P_,M_,A_,k_,fr,sl,Rp,Vr,ca,Bp,0,tr,Mn,L_,D_)}(i,yt,Ne,r,a,c,rt,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,Y,[de,de,de,de],et,b,ue,ye,ct,F,e,p,C,I,m)};if(Je==="line")for(const Ne of xp(e.geometry,0,0,Hi,Hi)){const yt=g_(Ne,re,ke,r.vertical||N,a,24,ie,i.overscaling,Hi);for(const ht of yt)N&&w_(i,N.text,Xe,ht)||Ze(Ne,ht)}else if(Je==="line-center"){for(const Ne of e.geometry)if(Ne.length>1){const yt=m_(Ne,ke,r.vertical||N,a,24,ie);yt&&Ze(Ne,yt)}}else if(e.type==="Polygon")for(const Ne of Eu(e.geometry,0)){const yt=v_(Ne,16);Ze(Ne[0],new Pa(yt.x,yt.y,0))}else if(e.type==="LineString")for(const Ne of e.geometry)Ze(Ne,new Pa(Ne[0].x,Ne[0].y,0));else if(e.type==="Point")for(const Ne of e.geometry)for(const yt of Ne)Ze([yt],new Pa(yt.x,yt.y,0))}function Ap(i,e,r,a,c,p,m,g,b,C,I,A,R,F,N){const G=function(ue,re,de,ye,ke,et,ct,Je){const Xe=ye.layout.get("text-rotate").evaluate(et,{})*Math.PI/180,qe=[];for(const rt of re.positionedLines)for(const Ze of rt.positionedGlyphs){if(!Ze.rect)continue;const Ne=Ze.rect||{};let yt=Zd+1,ht=!0,Nt=1,xi=0;const Ci=(ke||Je)&&Ze.vertical,er=Ze.metrics.advance*Ze.scale/2;if(Je&&re.verticalizable&&(xi=rt.lineOffset/2-(Ze.imageName?-(Qi-Ze.metrics.width*Ze.scale)/2:(Ze.scale-1)*Qi)),Ze.imageName){const rr=ct[Ze.imageName];ht=rr.sdf,Nt=rr.pixelRatio,yt=Fr/Nt}const Jr=ke?[Ze.x+er,Ze.y]:[0,0];let Mr=ke?[0,0]:[Ze.x+er+de[0],Ze.y+de[1]-xi],Wi=[0,0];Ci&&(Wi=Mr,Mr=[0,0]);const ur=Ze.metrics.isDoubleResolution?2:1,fr=(Ze.metrics.left-yt)*Ze.scale-er+Mr[0],Ar=(-Ze.metrics.top-yt)*Ze.scale+Mr[1],kr=fr+Ne.w/ur*Ze.scale/Nt,tr=Ar+Ne.h/ur*Ze.scale/Nt,ir=new Q(fr,Ar),vr=new Q(kr,Ar),zr=new Q(fr,tr),xr=new Q(kr,tr);if(Ci){const rr=new Q(-er,er-tl),Zt=-Math.PI/2,br=Qi/2-er,mr=new Q(5-tl-br,-(Ze.imageName?br:0)),nr=new Q(...Wi);ir._rotateAround(Zt,rr)._add(mr)._add(nr),vr._rotateAround(Zt,rr)._add(mr)._add(nr),zr._rotateAround(Zt,rr)._add(mr)._add(nr),xr._rotateAround(Zt,rr)._add(mr)._add(nr)}if(Xe){const rr=Math.sin(Xe),Zt=Math.cos(Xe),br=[Zt,-rr,rr,Zt];ir._matMult(br),vr._matMult(br),zr._matMult(br),xr._matMult(br)}const Nr=new Q(0,0),jr=new Q(0,0);qe.push({tl:ir,tr:vr,bl:zr,br:xr,tex:Ne,writingMode:re.writingMode,glyphOffset:Jr,sectionIndex:Ze.sectionIndex,isSDF:ht,pixelOffsetTL:Nr,pixelOffsetBR:jr,minFontScaleX:0,minFontScaleY:0})}return qe}(0,r,g,c,p,m,a,i.allowVerticalPlacement),Y=i.textSizeData;let ie=null;Y.kind==="source"?(ie=[qn*c.layout.get("text-size").evaluate(m,{})],ie[0]>Ea&&He(`${i.layerIds[0]}: Value for "text-size" is >= ${rl}. Reduce your "text-size".`)):Y.kind==="composite"&&(ie=[qn*F.compositeTextSizes[0].evaluate(m,{},N),qn*F.compositeTextSizes[1].evaluate(m,{},N)],(ie[0]>Ea||ie[1]>Ea)&&He(`${i.layerIds[0]}: Value for "text-size" is >= ${rl}. Reduce your "text-size".`)),i.addSymbols(i.text,G,ie,g,p,m,C,e,b.lineStartIndex,b.lineLength,R,N);for(const ue of I)A[ue]=i.text.placedSymbolArray.length-1;return 4*G.length}function kp(i){for(const e in i)return i[e];return null}function w_(i,e,r,a){const c=i.compareText;if(e in c){const p=c[e];for(let m=p.length-1;m>=0;m--)if(a.dist(p[m])<r)return!0}else c[e]=[];return c[e].push(a),!1}const zp=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Xu{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,a]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const c=a>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);const p=zp[15&a];if(!p)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(e,2,1),[g]=new Uint32Array(e,4,1);return new Xu(g,m,p,e)}constructor(e,r=64,a=Float64Array,c){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=a,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const p=zp.indexOf(this.ArrayType),m=2*e*this.ArrayType.BYTES_PER_ELEMENT,g=e*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-g%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${a}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+g+b,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+m+g+b),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+g+b,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=e,this.coords[this._pos++]=r,a}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Ku(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,a,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:m,nodeSize:g}=this,b=[0,p.length-1,0],C=[];for(;b.length;){const I=b.pop()||0,A=b.pop()||0,R=b.pop()||0;if(A-R<=g){for(let Y=R;Y<=A;Y++){const ie=m[2*Y],ue=m[2*Y+1];ie>=e&&ie<=a&&ue>=r&&ue<=c&&C.push(p[Y])}continue}const F=R+A>>1,N=m[2*F],G=m[2*F+1];N>=e&&N<=a&&G>=r&&G<=c&&C.push(p[F]),(I===0?e<=N:r<=G)&&(b.push(R),b.push(F-1),b.push(1-I)),(I===0?a>=N:c>=G)&&(b.push(F+1),b.push(A),b.push(1-I))}return C}within(e,r,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:p,nodeSize:m}=this,g=[0,c.length-1,0],b=[],C=a*a;for(;g.length;){const I=g.pop()||0,A=g.pop()||0,R=g.pop()||0;if(A-R<=m){for(let Y=R;Y<=A;Y++)Dp(p[2*Y],p[2*Y+1],e,r)<=C&&b.push(c[Y]);continue}const F=R+A>>1,N=p[2*F],G=p[2*F+1];Dp(N,G,e,r)<=C&&b.push(c[F]),(I===0?e-a<=N:r-a<=G)&&(g.push(R),g.push(F-1),g.push(1-I)),(I===0?e+a>=N:r+a>=G)&&(g.push(F+1),g.push(A),g.push(1-I))}return b}}function Ku(i,e,r,a,c,p){if(c-a<=r)return;const m=a+c>>1;Lp(i,e,m,a,c,p),Ku(i,e,r,a,m-1,1-p),Ku(i,e,r,m+1,c,1-p)}function Lp(i,e,r,a,c,p){for(;c>a;){if(c-a>600){const C=c-a+1,I=r-a+1,A=Math.log(C),R=.5*Math.exp(2*A/3),F=.5*Math.sqrt(A*R*(C-R)/C)*(I-C/2<0?-1:1);Lp(i,e,r,Math.max(a,Math.floor(r-I*R/C+F)),Math.min(c,Math.floor(r+(C-I)*R/C+F)),p)}const m=e[2*r+p];let g=a,b=c;for(al(i,e,a,r),e[2*c+p]>m&&al(i,e,a,c);g<b;){for(al(i,e,g,b),g++,b--;e[2*g+p]<m;)g++;for(;e[2*b+p]>m;)b--}e[2*a+p]===m?al(i,e,a,b):(b++,al(i,e,b,c)),b<=r&&(a=b+1),r<=b&&(c=b-1)}}function al(i,e,r,a){Yu(i,r,a),Yu(e,2*r,2*a),Yu(e,2*r+1,2*a+1)}function Yu(i,e,r){const a=i[e];i[e]=i[r],i[r]=a}function Dp(i,e,r,a){const c=i-r,p=e-a;return c*c+p*p}var Ju;o.bh=void 0,(Ju=o.bh||(o.bh={})).create="create",Ju.load="load",Ju.fullLoad="fullLoad";let Tc=null,ol=[];const Qu=1e3/60,eh="loadTime",th="fullLoadTime",S_={mark(i){performance.mark(i)},frame(i){const e=i;Tc!=null&&ol.push(e-Tc),Tc=e},clearMetrics(){Tc=null,ol=[],performance.clearMeasures(eh),performance.clearMeasures(th);for(const i in o.bh)performance.clearMarks(o.bh[i])},getPerformanceMetrics(){performance.measure(eh,o.bh.create,o.bh.load),performance.measure(th,o.bh.create,o.bh.fullLoad);const i=performance.getEntriesByName(eh)[0].duration,e=performance.getEntriesByName(th)[0].duration,r=ol.length,a=1/(ol.reduce((p,m)=>p+m,0)/r/1e3),c=ol.filter(p=>p>Qu).reduce((p,m)=>p+(m-Qu)/Qu,0);return{loadTime:i,fullLoadTime:e,fps:a,percentDroppedFrames:c/(r+c)*100,totalFrames:r}}};o.$=function(i,e,r){var a,c,p,m,g,b,C,I,A,R,F,N,G=r[0],Y=r[1],ie=r[2];return e===i?(i[12]=e[0]*G+e[4]*Y+e[8]*ie+e[12],i[13]=e[1]*G+e[5]*Y+e[9]*ie+e[13],i[14]=e[2]*G+e[6]*Y+e[10]*ie+e[14],i[15]=e[3]*G+e[7]*Y+e[11]*ie+e[15]):(c=e[1],p=e[2],m=e[3],g=e[4],b=e[5],C=e[6],I=e[7],A=e[8],R=e[9],F=e[10],N=e[11],i[0]=a=e[0],i[1]=c,i[2]=p,i[3]=m,i[4]=g,i[5]=b,i[6]=C,i[7]=I,i[8]=A,i[9]=R,i[10]=F,i[11]=N,i[12]=a*G+g*Y+A*ie+e[12],i[13]=c*G+b*Y+R*ie+e[13],i[14]=p*G+C*Y+F*ie+e[14],i[15]=m*G+I*Y+N*ie+e[15]),i},o.A=jo,o.B=Dr,o.C=class{constructor(i,e,r){this.receive=a=>{const c=a.data,p=c.id;if(p&&(!c.targetMapId||this.mapId===c.targetMapId))if(c.type==="<cancel>"){delete this.tasks[p];const m=this.cancelCallbacks[p];delete this.cancelCallbacks[p],m&&m()}else st()||c.mustQueue?(this.tasks[p]=c,this.taskQueue.push(p),this.invoker.trigger()):this.processTask(p,c)},this.process=()=>{if(!this.taskQueue.length)return;const a=this.taskQueue.shift(),c=this.tasks[a];delete this.tasks[a],this.taskQueue.length&&this.invoker.trigger(),c&&this.processTask(a,c)},this.target=i,this.parent=e,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new p_(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=st()?i:window}send(i,e,r,a,c=!1){const p=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[p]=r);const m=[],g={id:p,type:i,hasCallback:!!r,targetMapId:a,mustQueue:c,sourceMapId:this.mapId,data:jn(e,m)};return this.target.postMessage(g,{transfer:m}),{cancel:()=>{r&&delete this.callbacks[p],this.target.postMessage({id:p,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}processTask(i,e){if(e.type==="<response>"){const r=this.callbacks[i];delete this.callbacks[i],r&&(e.error?r(xa(e.error)):r(null,xa(e.data)))}else{let r=!1;const a=[],c=e.hasCallback?(g,b)=>{r=!0,delete this.cancelCallbacks[i];const C={id:i,type:"<response>",sourceMapId:this.mapId,error:g?jn(g):null,data:jn(b,a)};this.target.postMessage(C,{transfer:a})}:g=>{r=!0};let p=null;const m=xa(e.data);if(this.parent[e.type])p=this.parent[e.type](e.sourceMapId,m,c);else if("getWorkerSource"in this.parent){const g=e.type.split(".");p=this.parent.getWorkerSource(e.sourceMapId,g[0],m.source)[g[1]](m,c)}else c(new Error(`Could not find function ${e.type}`));!r&&p&&p.cancel&&(this.cancelCallbacks[i]=p.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.D=pt,o.E=gr,o.F=function(i,e){const r={};for(let a=0;a<e.length;a++){const c=e[a];c in i&&(r[c]=i[c])}return r},o.G=lp,o.H=cp,o.I=$u,o.J=be,o.K=ge,o.L=Ia,o.M=Gt,o.N=Hi,o.O=rn,o.P=Q,o.Q=Pi,o.R=tn,o.S=vi,o.T=ec,o.U=xc,o.V=class extends ia{},o.W=Zu,o.X=function(i,e){const r=window.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let a=0;a<i.length;a++){const c=window.document.createElement("source");li(i[a])||(r.crossOrigin="Anonymous"),c.src=i[a],r.appendChild(c)}return{cancel:()=>{}}},o.Y=Ve,o.Z=function(){var i=new jo(16);return jo!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},o._=O,o.a=At,o.a$=class extends B{},o.a0=function(i,e,r){var a=r[0],c=r[1],p=r[2];return i[0]=e[0]*a,i[1]=e[1]*a,i[2]=e[2]*a,i[3]=e[3]*a,i[4]=e[4]*c,i[5]=e[5]*c,i[6]=e[6]*c,i[7]=e[7]*c,i[8]=e[8]*p,i[9]=e[9]*p,i[10]=e[10]*p,i[11]=e[11]*p,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},o.a1=pd,o.a2=function(){return De++},o.a3=X,o.a4=Ho,o.a5=function(){Or.isLoading()||Or.isLoaded()||Ds()!=="deferred"||Ql()},o.a6=Ss,o.a7=Ja,o.a8=_i,o.a9=gp,o.aA=Za,o.aB=function(i){i=i.slice();const e=Object.create(null);for(let r=0;r<i.length;r++)e[i[r].id]=i[r];for(let r=0;r<i.length;r++)"ref"in i[r]&&(i[r]=Li(i[r],e[i[r].ref]));return i},o.aC=function(i){if(i.type==="custom")return new d_(i);switch(i.type){case"background":return new c_(i);case"circle":return new Wg(i);case"fill":return new fy(i);case"fill-extrusion":return new My(i);case"heatmap":return new Kg(i);case"hillshade":return new Jg(i);case"line":return new Oy(i);case"raster":return new h_(i);case"symbol":return new vc(i)}},o.aD=Ge,o.aE=function(i,e){if(!i)return[{command:Ft.setStyle,args:[e]}];let r=[];try{if(!Wt(i.version,e.version))return[{command:Ft.setStyle,args:[e]}];Wt(i.center,e.center)||r.push({command:Ft.setCenter,args:[e.center]}),Wt(i.zoom,e.zoom)||r.push({command:Ft.setZoom,args:[e.zoom]}),Wt(i.bearing,e.bearing)||r.push({command:Ft.setBearing,args:[e.bearing]}),Wt(i.pitch,e.pitch)||r.push({command:Ft.setPitch,args:[e.pitch]}),Wt(i.sprite,e.sprite)||r.push({command:Ft.setSprite,args:[e.sprite]}),Wt(i.glyphs,e.glyphs)||r.push({command:Ft.setGlyphs,args:[e.glyphs]}),Wt(i.transition,e.transition)||r.push({command:Ft.setTransition,args:[e.transition]}),Wt(i.light,e.light)||r.push({command:Ft.setLight,args:[e.light]});const a={},c=[];(function(m,g,b,C){let I;for(I in g=g||{},m=m||{})Object.prototype.hasOwnProperty.call(m,I)&&(Object.prototype.hasOwnProperty.call(g,I)||Ki(I,b,C));for(I in g)Object.prototype.hasOwnProperty.call(g,I)&&(Object.prototype.hasOwnProperty.call(m,I)?Wt(m[I],g[I])||(m[I].type==="geojson"&&g[I].type==="geojson"&&cn(m,g,I)?b.push({command:Ft.setGeoJSONSourceData,args:[I,g[I].data]}):yi(I,g,b,C)):Gi(I,g,b))})(i.sources,e.sources,c,a);const p=[];i.layers&&i.layers.forEach(m=>{a[m.source]?r.push({command:Ft.removeLayer,args:[m.id]}):p.push(m)}),r=r.concat(c),function(m,g,b){g=g||[];const C=(m=m||[]).map(ar),I=g.map(ar),A=m.reduce(qr,{}),R=g.reduce(qr,{}),F=C.slice(),N=Object.create(null);let G,Y,ie,ue,re,de,ye;for(G=0,Y=0;G<C.length;G++)ie=C[G],Object.prototype.hasOwnProperty.call(R,ie)?Y++:(b.push({command:Ft.removeLayer,args:[ie]}),F.splice(F.indexOf(ie,Y),1));for(G=0,Y=0;G<I.length;G++)ie=I[I.length-1-G],F[F.length-1-G]!==ie&&(Object.prototype.hasOwnProperty.call(A,ie)?(b.push({command:Ft.removeLayer,args:[ie]}),F.splice(F.lastIndexOf(ie,F.length-Y),1)):Y++,de=F[F.length-G],b.push({command:Ft.addLayer,args:[R[ie],de]}),F.splice(F.length-G,0,ie),N[ie]=!0);for(G=0;G<I.length;G++)if(ie=I[G],ue=A[ie],re=R[ie],!N[ie]&&!Wt(ue,re))if(Wt(ue.source,re.source)&&Wt(ue["source-layer"],re["source-layer"])&&Wt(ue.type,re.type)){for(ye in or(ue.layout,re.layout,b,ie,null,Ft.setLayoutProperty),or(ue.paint,re.paint,b,ie,null,Ft.setPaintProperty),Wt(ue.filter,re.filter)||b.push({command:Ft.setFilter,args:[ie,re.filter]}),Wt(ue.minzoom,re.minzoom)&&Wt(ue.maxzoom,re.maxzoom)||b.push({command:Ft.setLayerZoomRange,args:[ie,re.minzoom,re.maxzoom]}),ue)Object.prototype.hasOwnProperty.call(ue,ye)&&ye!=="layout"&&ye!=="paint"&&ye!=="filter"&&ye!=="metadata"&&ye!=="minzoom"&&ye!=="maxzoom"&&(ye.indexOf("paint.")===0?or(ue[ye],re[ye],b,ie,ye.slice(6),Ft.setPaintProperty):Wt(ue[ye],re[ye])||b.push({command:Ft.setLayerProperty,args:[ie,ye,re[ye]]}));for(ye in re)Object.prototype.hasOwnProperty.call(re,ye)&&!Object.prototype.hasOwnProperty.call(ue,ye)&&ye!=="layout"&&ye!=="paint"&&ye!=="filter"&&ye!=="metadata"&&ye!=="minzoom"&&ye!=="maxzoom"&&(ye.indexOf("paint.")===0?or(ue[ye],re[ye],b,ie,ye.slice(6),Ft.setPaintProperty):Wt(ue[ye],re[ye])||b.push({command:Ft.setLayerProperty,args:[ie,ye,re[ye]]}))}else b.push({command:Ft.removeLayer,args:[ie]}),de=F[F.lastIndexOf(ie)+1],b.push({command:Ft.addLayer,args:[re,de]})}(p,e.layers,r)}catch(a){console.warn("Unable to compute style diff:",a),r=[{command:Ft.setStyle,args:[e]}]}return r},o.aF=function(i){const e=[],r=i.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},o.aG=function i(e,r){if(Array.isArray(e)){if(!Array.isArray(r)||e.length!==r.length)return!1;for(let a=0;a<e.length;a++)if(!i(e[a],r[a]))return!1;return!0}if(typeof e=="object"&&e!==null&&r!==null){if(typeof r!="object"||Object.keys(e).length!==Object.keys(r).length)return!1;for(const a in e)if(!i(e[a],r[a]))return!1;return!0}return e===r},o.aH=Ce,o.aI=je,o.aJ=Ha,o.aK=function(i){return i({pluginStatus:Er,pluginURL:Vn}),Ha.on("pluginStateChange",i),i},o.aL=class extends aa{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},o.aM=Fo,o.aN=class extends aa{constructor(i,e){super(i,e),this.current=fu}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},o.aO=nc,o.aP=class extends aa{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},o.aQ=class extends aa{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},o.aR=ac,o.aS=function(i,e,r,a,c,p,m){var g=1/(e-r),b=1/(a-c),C=1/(p-m);return i[0]=-2*g,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*b,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*C,i[11]=0,i[12]=(e+r)*g,i[13]=(c+a)*b,i[14]=(m+p)*C,i[15]=1,i},o.aT=ui,o.aU=Hg,o.aV=class extends l{},o.aW=jy,o.aX=class extends f{},o.aY=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},o.aZ=_d,o.a_=Ue,o.aa=function(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,a,c,p)=>{const m=c||p;return e[a]=!m||m.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e},o.ab=function(i,e){const r=[];for(const a in i)a in e||r.push(a);return r},o.ac=function(i){if(jt==null){const e=i.navigator?i.navigator.userAgent:null;jt=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return jt},o.ad=ze,o.ae=function(i,e,r){var a=Math.sin(r),c=Math.cos(r),p=e[0],m=e[1],g=e[2],b=e[3],C=e[4],I=e[5],A=e[6],R=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=p*c+C*a,i[1]=m*c+I*a,i[2]=g*c+A*a,i[3]=b*c+R*a,i[4]=C*c-p*a,i[5]=I*c-m*a,i[6]=A*c-g*a,i[7]=R*c-b*a,i},o.af=function(i){var e=new jo(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},o.ag=cc,o.ah=function(i,e){let r=0,a=0;if(i.kind==="constant")a=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:c,minZoom:p,maxZoom:m}=i,g=c?ze(Rr.interpolationFactor(c,e,p,m),0,1):0;i.kind==="camera"?a=Dr.number(i.minSize,i.maxSize,g):r=g}return{uSizeT:r,uSize:a}},o.aj=function(i,{uSize:e,uSizeT:r},{lowerSize:a,upperSize:c}){return i.kind==="source"?a/qn:i.kind==="composite"?Dr.number(a/qn,c/qn,r):e},o.ak=Nu,o.al=function(i,e,r,a){const c=e.y-i.y,p=e.x-i.x,m=a.y-r.y,g=a.x-r.x,b=m*p-g*c;if(b===0)return null;const C=(g*(i.y-r.y)-m*(i.x-r.x))/b;return new Q(i.x+C*p,i.y+C*c)},o.am=xp,o.an=sd,o.ao=vu,o.ap=Qi,o.ar=Fu,o.as=function(i,e){var r=e[0],a=e[1],c=e[2],p=e[3],m=e[4],g=e[5],b=e[6],C=e[7],I=e[8],A=e[9],R=e[10],F=e[11],N=e[12],G=e[13],Y=e[14],ie=e[15],ue=r*g-a*m,re=r*b-c*m,de=r*C-p*m,ye=a*b-c*g,ke=a*C-p*g,et=c*C-p*b,ct=I*G-A*N,Je=I*Y-R*N,Xe=I*ie-F*N,qe=A*Y-R*G,rt=A*ie-F*G,Ze=R*ie-F*Y,Ne=ue*Ze-re*rt+de*qe+ye*Xe-ke*Je+et*ct;return Ne?(i[0]=(g*Ze-b*rt+C*qe)*(Ne=1/Ne),i[1]=(c*rt-a*Ze-p*qe)*Ne,i[2]=(G*et-Y*ke+ie*ye)*Ne,i[3]=(R*ke-A*et-F*ye)*Ne,i[4]=(b*Xe-m*Ze-C*Je)*Ne,i[5]=(r*Ze-c*Xe+p*Je)*Ne,i[6]=(Y*de-N*et-ie*re)*Ne,i[7]=(I*et-R*de+F*re)*Ne,i[8]=(m*rt-g*Xe+C*ct)*Ne,i[9]=(a*Xe-r*rt-p*ct)*Ne,i[10]=(N*ke-G*de+ie*ue)*Ne,i[11]=(A*de-I*ke-F*ue)*Ne,i[12]=(g*Je-m*qe-b*ct)*Ne,i[13]=(r*qe-a*Je+c*ct)*Ne,i[14]=(G*re-N*ye-Y*ue)*Ne,i[15]=(I*ye-A*re+R*ue)*Ne,i):null},o.at=Wu,o.au=Bu,o.av=Xu,o.aw=function(){const i={},e=Te.$version;for(const r in Te.$root){const a=Te.$root[r];if(a.required){let c=null;c=r==="version"?e:a.type==="array"?[]:{},c!=null&&(i[r]=c)}}return i},o.ax=Ft,o.ay=Xl,o.az=ei,o.b=function(i,e){const r=new Blob([new Uint8Array(i)],{type:"image/png"});createImageBitmap(r).then(a=>{e(null,a)}).catch(a=>{e(new Error(`Could not load image because of ${a.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},o.b0=lr,o.b1=function(i,e){var r=i[0],a=i[1],c=i[2],p=i[3],m=i[4],g=i[5],b=i[6],C=i[7],I=i[8],A=i[9],R=i[10],F=i[11],N=i[12],G=i[13],Y=i[14],ie=i[15],ue=e[0],re=e[1],de=e[2],ye=e[3],ke=e[4],et=e[5],ct=e[6],Je=e[7],Xe=e[8],qe=e[9],rt=e[10],Ze=e[11],Ne=e[12],yt=e[13],ht=e[14],Nt=e[15];return Math.abs(r-ue)<=Pr*Math.max(1,Math.abs(r),Math.abs(ue))&&Math.abs(a-re)<=Pr*Math.max(1,Math.abs(a),Math.abs(re))&&Math.abs(c-de)<=Pr*Math.max(1,Math.abs(c),Math.abs(de))&&Math.abs(p-ye)<=Pr*Math.max(1,Math.abs(p),Math.abs(ye))&&Math.abs(m-ke)<=Pr*Math.max(1,Math.abs(m),Math.abs(ke))&&Math.abs(g-et)<=Pr*Math.max(1,Math.abs(g),Math.abs(et))&&Math.abs(b-ct)<=Pr*Math.max(1,Math.abs(b),Math.abs(ct))&&Math.abs(C-Je)<=Pr*Math.max(1,Math.abs(C),Math.abs(Je))&&Math.abs(I-Xe)<=Pr*Math.max(1,Math.abs(I),Math.abs(Xe))&&Math.abs(A-qe)<=Pr*Math.max(1,Math.abs(A),Math.abs(qe))&&Math.abs(R-rt)<=Pr*Math.max(1,Math.abs(R),Math.abs(rt))&&Math.abs(F-Ze)<=Pr*Math.max(1,Math.abs(F),Math.abs(Ze))&&Math.abs(N-Ne)<=Pr*Math.max(1,Math.abs(N),Math.abs(Ne))&&Math.abs(G-yt)<=Pr*Math.max(1,Math.abs(G),Math.abs(yt))&&Math.abs(Y-ht)<=Pr*Math.max(1,Math.abs(Y),Math.abs(ht))&&Math.abs(ie-Nt)<=Pr*Math.max(1,Math.abs(ie),Math.abs(Nt))},o.b2=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},o.b3=function(i,e,r){return i[0]=e[0]*r[0],i[1]=e[1]*r[1],i[2]=e[2]*r[2],i[3]=e[3]*r[3],i},o.b4=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]},o.b5=Be,o.b6=pp,o.b7=up,o.b8=function(i,e,r,a,c){var p,m=1/Math.tan(e/2);return i[0]=m/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=m,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,c!=null&&c!==1/0?(i[10]=(c+a)*(p=1/(a-c)),i[14]=2*c*a*p):(i[10]=-1,i[14]=-2*a),i},o.b9=function(i,e,r){var a=Math.sin(r),c=Math.cos(r),p=e[4],m=e[5],g=e[6],b=e[7],C=e[8],I=e[9],A=e[10],R=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=p*c+C*a,i[5]=m*c+I*a,i[6]=g*c+A*a,i[7]=b*c+R*a,i[8]=C*c-p*a,i[9]=I*c-m*a,i[10]=A*c-g*a,i[11]=R*c-b*a,i},o.bA=V,o.bB=Fd,o.bC=Po,o.bD=Or,o.ba=ce,o.bb=Se,o.bc=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},o.bd=class extends Ka{},o.be=qu,o.bf=hp,o.bg=S_,o.bi=Yt,o.bj=function(i,e,r=!1){if(Er===Ms||Er===As||Er===ks)throw new Error("setRTLTextPlugin cannot be called multiple times.");Vn=wt.resolveURL(i),Er=Ms,zs=e,Ls(),r||Ql()},o.bk=Ds,o.bl=function(i,e){const r={};for(let c=0;c<i.length;c++){const p=e&&e[i[c].id]||zo(i[c]);e&&(e[i[c].id]=p);let m=r[p];m||(m=r[p]=[]),m.push(i[c])}const a=[];for(const c in r)a.push(r[c]);return a},o.bm=it,o.bn=mp,o.bo=yp,o.bp=Wd,o.bq=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=Hi/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const e=i.bucket.layers[0],r=e.layout,a=e._unevaluatedLayout._values,c={layoutIconSize:a["icon-size"].possiblyEvaluate(new _i(i.bucket.zoom+1),i.canonical),layoutTextSize:a["text-size"].possiblyEvaluate(new _i(i.bucket.zoom+1),i.canonical),textMaxSize:a["text-size"].possiblyEvaluate(new _i(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:C,maxZoom:I}=i.bucket.textSizeData;c.compositeTextSizes=[a["text-size"].possiblyEvaluate(new _i(C),i.canonical),a["text-size"].possiblyEvaluate(new _i(I),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:C,maxZoom:I}=i.bucket.iconSizeData;c.compositeIconSizes=[a["icon-size"].possiblyEvaluate(new _i(C),i.canonical),a["icon-size"].possiblyEvaluate(new _i(I),i.canonical)]}const p=r.get("text-line-height")*Qi,m=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",g=r.get("text-keep-upright"),b=r.get("text-size");for(const C of i.bucket.features){const I=r.get("text-font").evaluate(C,{},i.canonical).join(","),A=b.evaluate(C,{},i.canonical),R=c.layoutTextSize.evaluate(C,{},i.canonical),F=c.layoutIconSize.evaluate(C,{},i.canonical),N={horizontal:{},vertical:void 0},G=C.text;let Y,ie=[0,0];if(G){const de=G.toString(),ye=r.get("text-letter-spacing").evaluate(C,{},i.canonical)*Qi,ke=Is(de)?ye:0,et=r.get("text-anchor").evaluate(C,{},i.canonical),ct=Mp(e,C,i.canonical);if(!ct){const Ze=r.get("text-radial-offset").evaluate(C,{},i.canonical);ie=Ze?Pp(et,[Ze*Qi,Hu]):r.get("text-offset").evaluate(C,{},i.canonical).map(Ne=>Ne*Qi)}let Je=m?"center":r.get("text-justify").evaluate(C,{},i.canonical);const Xe=r.get("symbol-placement"),qe=Xe==="point"?r.get("text-max-width").evaluate(C,{},i.canonical)*Qi:0,rt=()=>{i.bucket.allowVerticalPlacement&&Es(de)&&(N.vertical=gc(G,i.glyphMap,i.glyphPositions,i.imagePositions,I,qe,p,et,"left",ke,ie,o.ai.vertical,!0,Xe,R,A))};if(!m&&ct){const Ze=new Set;if(Je==="auto")for(let yt=0;yt<ct.values.length;yt+=2)Ze.add(Wu(ct.values[yt]));else Ze.add(Je);let Ne=!1;for(const yt of Ze)if(!N.horizontal[yt])if(Ne)N.horizontal[yt]=N.horizontal[0];else{const ht=gc(G,i.glyphMap,i.glyphPositions,i.imagePositions,I,qe,p,"center",yt,ke,ie,o.ai.horizontal,!1,Xe,R,A);ht&&(N.horizontal[yt]=ht,Ne=ht.positionedLines.length===1)}rt()}else{Je==="auto"&&(Je=Wu(et));const Ze=gc(G,i.glyphMap,i.glyphPositions,i.imagePositions,I,qe,p,et,Je,ke,ie,o.ai.horizontal,!1,Xe,R,A);Ze&&(N.horizontal[Je]=Ze),rt(),Es(de)&&m&&g&&(N.vertical=gc(G,i.glyphMap,i.glyphPositions,i.imagePositions,I,qe,p,et,Je,ke,ie,o.ai.vertical,!1,Xe,R,A))}}let ue=!1;if(C.icon&&C.icon.name){const de=i.imageMap[C.icon.name];de&&(Y=n_(i.imagePositions[C.icon.name],r.get("icon-offset").evaluate(C,{},i.canonical),r.get("icon-anchor").evaluate(C,{},i.canonical)),ue=!!de.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=ue:i.bucket.sdfIcons!==ue&&He("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(de.pixelRatio!==i.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const re=kp(N.horizontal)||N.vertical;i.bucket.iconsInText=!!re&&re.iconsInText,(re||Y)&&b_(i.bucket,C,N,Y,i.imageMap,c,R,F,ie,ue,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},o.br=zu,o.bs=Mu,o.bt=ku,o.bu=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},o.bv=Du,o.bw=Ca,o.bx=function(i,e,r,a,c){return O(this,void 0,void 0,function*(){if(ge())try{return yield Gt(i,e,r,a,c)}catch{}return function(p,m,g,b,C){const I=p.width,A=p.height;ft&&Oe||(ft=new OffscreenCanvas(I,A),Oe=ft.getContext("2d",{willReadFrequently:!0})),ft.width=I,ft.height=A,Oe.drawImage(p,0,0,I,A);const R=Oe.getImageData(m,g,b,C);return Oe.clearRect(0,0,I,A),R.data}(i,e,r,a,c)})},o.by=fp,o.bz=L,o.c=$t,o.d=function(i,e){const r=new Image;r.onload=()=>{e(null,r),URL.revokeObjectURL(r.src),r.onload=null,window.requestAnimationFrame(()=>{r.src=Qt})},r.onerror=()=>e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const a=new Blob([new Uint8Array(i)],{type:"image/png"});r.src=i.byteLength?URL.createObjectURL(a):Qt},o.e=$e,o.f=function(i,e){return pi($e(i,{type:"json"}),e)},o.g=kt,o.h=wt,o.i=st,o.j=Fi,o.k=Mi,o.l=Pt,o.m=pi,o.n=function(i){return new Du(i).readFields(Jy,[])},o.o=function(i,e,r){if(!i.length)return r(null,[]);let a=i.length;const c=new Array(i.length);let p=null;i.forEach((m,g)=>{e(m,(b,C)=>{b&&(p=b),c[g]=C,--a==0&&r(p,c)})})},o.p=Hd,o.q=Hs,o.r=ji,o.s=li,o.t=uu,o.u=Qe,o.v=Te,o.w=He,o.x=Ro,o.y=Cn,o.z=function([i,e,r]){return e+=90,e*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(r),y:i*Math.sin(e)*Math.sin(r),z:i*Math.cos(r)}}}),E(["./shared"],function(o){class O{constructor(D){this.keyCache={},D&&this.replace(D)}replace(D){this._layerConfigs={},this._layers={},this.update(D,[])}update(D,$){for(const K of D){this._layerConfigs[K.id]=K;const J=this._layers[K.id]=o.aC(K);J._featureFilter=o.a6(J.filter),this.keyCache[K.id]&&delete this.keyCache[K.id]}for(const K of $)delete this.keyCache[K],delete this._layerConfigs[K],delete this._layers[K];this.familiesBySource={};const j=o.bl(Object.values(this._layerConfigs),this.keyCache);for(const K of j){const J=K.map(Ie=>this._layers[Ie.id]),he=J[0];if(he.visibility==="none")continue;const ne=he.source||"";let te=this.familiesBySource[ne];te||(te=this.familiesBySource[ne]={});const se=he.sourceLayer||"_geojsonTileLayer";let Ee=te[se];Ee||(Ee=te[se]=[]),Ee.push(J)}}}class L{constructor(D){const $={},j=[];for(const ne in D){const te=D[ne],se=$[ne]={};for(const Ee in te){const Ie=te[+Ee];if(!Ie||Ie.bitmap.width===0||Ie.bitmap.height===0)continue;const Ae={x:0,y:0,w:Ie.bitmap.width+2,h:Ie.bitmap.height+2};j.push(Ae),se[Ee]={rect:Ae,metrics:Ie.metrics}}}const{w:K,h:J}=o.p(j),he=new o.q({width:K||1,height:J||1});for(const ne in D){const te=D[ne];for(const se in te){const Ee=te[+se];if(!Ee||Ee.bitmap.width===0||Ee.bitmap.height===0)continue;const Ie=$[ne][se].rect;o.q.copy(Ee.bitmap,he,{x:0,y:0},{x:Ie.x+1,y:Ie.y+1},Ee.bitmap)}}this.image=he,this.positions=$}}o.bm("GlyphAtlas",L);class V{constructor(D){this.tileID=new o.O(D.tileID.overscaledZ,D.tileID.wrap,D.tileID.canonical.z,D.tileID.canonical.x,D.tileID.canonical.y),this.uid=D.uid,this.zoom=D.zoom,this.pixelRatio=D.pixelRatio,this.tileSize=D.tileSize,this.source=D.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=D.showCollisionBoxes,this.collectResourceTiming=!!D.collectResourceTiming,this.returnDependencies=!!D.returnDependencies,this.promoteId=D.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(D,$,j,K,J){this.status="parsing",this.data=D,this.collisionBoxArray=new o.a3;const he=new o.bn(Object.keys(D.layers).sort()),ne=new o.bo(this.tileID,this.promoteId);ne.bucketLayerIDs=[];const te={},se={featureIndex:ne,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:j},Ee=$.familiesBySource[this.source];for(const Rt in Ee){const Lt=D.layers[Rt];if(!Lt)continue;Lt.version===1&&o.w(`Vector tile source "${this.source}" layer "${Rt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ni=he.encode(Rt),ci=[];for(let Di=0;Di<Lt.length;Di++){const Ri=Lt.feature(Di),Cr=ne.getId(Ri,Rt);ci.push({feature:Ri,id:Cr,index:Di,sourceLayerIndex:Ni})}for(const Di of Ee[Rt]){const Ri=Di[0];Ri.source!==this.source&&o.w(`layer.source = ${Ri.source} does not equal this.source = ${this.source}`),Ri.minzoom&&this.zoom<Math.floor(Ri.minzoom)||Ri.maxzoom&&this.zoom>=Ri.maxzoom||Ri.visibility!=="none"&&(q(Di,this.zoom,j),(te[Ri.id]=Ri.createBucket({index:ne.bucketLayerIDs.length,layers:Di,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ni,sourceID:this.source})).populate(ci,se,this.tileID.canonical),ne.bucketLayerIDs.push(Di.map(Cr=>Cr.id)))}}let Ie,Ae,dt,Ct;const at=o.aH(se.glyphDependencies,Rt=>Object.keys(Rt).map(Number));this.inFlightDependencies.forEach(Rt=>Rt?.cancel()),this.inFlightDependencies=[];const Ke=++this.dependencySentinel;Object.keys(at).length?this.inFlightDependencies.push(K.send("getGlyphs",{uid:this.uid,stacks:at,source:this.source,tileID:this.tileID,type:"glyphs"},(Rt,Lt)=>{Ke===this.dependencySentinel&&(Ie||(Ie=Rt,Ae=Lt,Ot.call(this)))})):Ae={};const Ye=Object.keys(se.iconDependencies);Ye.length?this.inFlightDependencies.push(K.send("getImages",{icons:Ye,source:this.source,tileID:this.tileID,type:"icons"},(Rt,Lt)=>{Ke===this.dependencySentinel&&(Ie||(Ie=Rt,dt=Lt,Ot.call(this)))})):dt={};const It=Object.keys(se.patternDependencies);function Ot(){if(Ie)return J(Ie);if(Ae&&dt&&Ct){const Rt=new L(Ae),Lt=new o.bp(dt,Ct);for(const Ni in te){const ci=te[Ni];ci instanceof o.a4?(q(ci.layers,this.zoom,j),o.bq({bucket:ci,glyphMap:Ae,glyphPositions:Rt.positions,imageMap:dt,imagePositions:Lt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):ci.hasPattern&&(ci instanceof o.br||ci instanceof o.bs||ci instanceof o.bt)&&(q(ci.layers,this.zoom,j),ci.addFeatures(se,this.tileID.canonical,Lt.patternPositions))}this.status="done",J(null,{buckets:Object.values(te).filter(Ni=>!Ni.isEmpty()),featureIndex:ne,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Rt.image,imageAtlas:Lt,glyphMap:this.returnDependencies?Ae:null,iconMap:this.returnDependencies?dt:null,glyphPositions:this.returnDependencies?Rt.positions:null})}}It.length?this.inFlightDependencies.push(K.send("getImages",{icons:It,source:this.source,tileID:this.tileID,type:"patterns"},(Rt,Lt)=>{Ke===this.dependencySentinel&&(Ie||(Ie=Rt,Ct=Lt,Ot.call(this)))})):Ct={},Ot.call(this)}}function q(W,D,$){const j=new o.a8(D);for(const K of W)K.recalculate(j,$)}function Q(W,D){const $=o.l(W.request,(j,K,J,he)=>{if(j)D(j);else if(K)try{const ne=new o.bw.VectorTile(new o.bv(K));D(null,{vectorTile:ne,rawData:K,cacheControl:J,expires:he})}catch(ne){const te=new Uint8Array(K);let se=`Unable to parse the tile at ${W.request.url}, `;se+=te[0]===31&&te[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ne.messge}`,D(new Error(se))}});return()=>{$.cancel(),D()}}class ae{constructor(D,$,j,K){this.actor=D,this.layerIndex=$,this.availableImages=j,this.loadVectorData=K||Q,this.fetching={},this.loading={},this.loaded={}}loadTile(D,$){const j=D.uid;this.loading||(this.loading={});const K=!!(D&&D.request&&D.request.collectResourceTiming)&&new o.bu(D.request),J=this.loading[j]=new V(D);J.abort=this.loadVectorData(D,(he,ne)=>{if(delete this.loading[j],he||!ne)return J.status="done",this.loaded[j]=J,$(he);const te=ne.rawData,se={};ne.expires&&(se.expires=ne.expires),ne.cacheControl&&(se.cacheControl=ne.cacheControl);const Ee={};if(K){const Ie=K.finish();Ie&&(Ee.resourceTiming=JSON.parse(JSON.stringify(Ie)))}J.vectorTile=ne.vectorTile,J.parse(ne.vectorTile,this.layerIndex,this.availableImages,this.actor,(Ie,Ae)=>{if(delete this.fetching[j],Ie||!Ae)return $(Ie);$(null,o.e({rawTileData:te.slice(0)},Ae,se,Ee))}),this.loaded=this.loaded||{},this.loaded[j]=J,this.fetching[j]={rawTileData:te,cacheControl:se,resourceTiming:Ee}})}reloadTile(D,$){const j=this.loaded,K=D.uid;if(j&&j[K]){const J=j[K];J.showCollisionBoxes=D.showCollisionBoxes,J.status==="parsing"?J.parse(J.vectorTile,this.layerIndex,this.availableImages,this.actor,(he,ne)=>{if(he||!ne)return $(he,ne);let te;if(this.fetching[K]){const{rawTileData:se,cacheControl:Ee,resourceTiming:Ie}=this.fetching[K];delete this.fetching[K],te=o.e({rawTileData:se.slice(0)},ne,Ee,Ie)}else te=ne;$(null,te)}):J.status==="done"&&(J.vectorTile?J.parse(J.vectorTile,this.layerIndex,this.availableImages,this.actor,$):$())}}abortTile(D,$){const j=this.loading,K=D.uid;j&&j[K]&&j[K].abort&&(j[K].abort(),delete j[K]),$()}removeTile(D,$){const j=this.loaded,K=D.uid;j&&j[K]&&delete j[K],$()}}class fe{constructor(){this.loaded={}}loadTile(D,$){return o._(this,void 0,void 0,function*(){const{uid:j,encoding:K,rawImageData:J,redFactor:he,greenFactor:ne,blueFactor:te,baseShift:se}=D,Ee=J.width+2,Ie=J.height+2,Ae=o.a(J)?new o.R({width:Ee,height:Ie},yield o.bx(J,-1,-1,Ee,Ie)):J,dt=new o.by(j,Ae,K,he,ne,te,se);this.loaded=this.loaded||{},this.loaded[j]=dt,$(null,dt)})}removeTile(D){const $=this.loaded,j=D.uid;$&&$[j]&&delete $[j]}}function me(W,D){if(W.length!==0){xe(W[0],D);for(var $=1;$<W.length;$++)xe(W[$],!D)}}function xe(W,D){for(var $=0,j=0,K=0,J=W.length,he=J-1;K<J;he=K++){var ne=(W[K][0]-W[he][0])*(W[he][1]+W[K][1]),te=$+ne;j+=Math.abs($)>=Math.abs(ne)?$-te+ne:ne-te+$,$=te}$+j>=0!=!!D&&W.reverse()}var ve=o.bz(function W(D,$){var j,K=D&&D.type;if(K==="FeatureCollection")for(j=0;j<D.features.length;j++)W(D.features[j],$);else if(K==="GeometryCollection")for(j=0;j<D.geometries.length;j++)W(D.geometries[j],$);else if(K==="Feature")W(D.geometry,$);else if(K==="Polygon")me(D.coordinates,$);else if(K==="MultiPolygon")for(j=0;j<D.coordinates.length;j++)me(D.coordinates[j],$);return D});const be=o.bw.VectorTileFeature.prototype.toGeoJSON;var ge={exports:{}},ce=o.bA,Se=o.bw.VectorTileFeature,ze=Be;function Be(W,D){this.options=D||{},this.features=W,this.length=W.length}function $e(W,D){this.id=typeof W.id=="number"?W.id:void 0,this.type=W.type,this.rawGeometry=W.type===1?[W.geometry]:W.geometry,this.properties=W.tags,this.extent=D||4096}Be.prototype.feature=function(W){return new $e(this.features[W],this.options.extent)},$e.prototype.loadGeometry=function(){var W=this.rawGeometry;this.geometry=[];for(var D=0;D<W.length;D++){for(var $=W[D],j=[],K=0;K<$.length;K++)j.push(new ce($[K][0],$[K][1]));this.geometry.push(j)}return this.geometry},$e.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var W=this.geometry,D=1/0,$=-1/0,j=1/0,K=-1/0,J=0;J<W.length;J++)for(var he=W[J],ne=0;ne<he.length;ne++){var te=he[ne];D=Math.min(D,te.x),$=Math.max($,te.x),j=Math.min(j,te.y),K=Math.max(K,te.y)}return[D,j,$,K]},$e.prototype.toGeoJSON=Se.prototype.toGeoJSON;var De=o.bB,Ce=ze;function je(W){var D=new De;return function($,j){for(var K in $.layers)j.writeMessage(3,Ge,$.layers[K])}(W,D),D.finish()}function Ge(W,D){var $;D.writeVarintField(15,W.version||1),D.writeStringField(1,W.name||""),D.writeVarintField(5,W.extent||4096);var j={keys:[],values:[],keycache:{},valuecache:{}};for($=0;$<W.length;$++)j.feature=W.feature($),D.writeMessage(2,tt,j);var K=j.keys;for($=0;$<K.length;$++)D.writeStringField(3,K[$]);var J=j.values;for($=0;$<J.length;$++)D.writeMessage(4,jt,J[$])}function tt(W,D){var $=W.feature;$.id!==void 0&&D.writeVarintField(1,$.id),D.writeMessage(2,He,W),D.writeVarintField(3,$.type),D.writeMessage(4,st,$)}function He(W,D){var $=W.feature,j=W.keys,K=W.values,J=W.keycache,he=W.valuecache;for(var ne in $.properties){var te=$.properties[ne],se=J[ne];if(te!==null){se===void 0&&(j.push(ne),J[ne]=se=j.length-1),D.writeVarint(se);var Ee=typeof te;Ee!=="string"&&Ee!=="boolean"&&Ee!=="number"&&(te=JSON.stringify(te));var Ie=Ee+":"+te,Ae=he[Ie];Ae===void 0&&(K.push(te),he[Ie]=Ae=K.length-1),D.writeVarint(Ae)}}}function ot(W,D){return(D<<3)+(7&W)}function Tt(W){return W<<1^W>>31}function st(W,D){for(var $=W.loadGeometry(),j=W.type,K=0,J=0,he=$.length,ne=0;ne<he;ne++){var te=$[ne],se=1;j===1&&(se=te.length),D.writeVarint(ot(1,se));for(var Ee=j===3?te.length-1:te.length,Ie=0;Ie<Ee;Ie++){Ie===1&&j!==1&&D.writeVarint(ot(2,Ee-1));var Ae=te[Ie].x-K,dt=te[Ie].y-J;D.writeVarint(Tt(Ae)),D.writeVarint(Tt(dt)),K+=Ae,J+=dt}j===3&&D.writeVarint(ot(7,1))}}function jt(W,D){var $=typeof W;$==="string"?D.writeStringField(1,W):$==="boolean"?D.writeBooleanField(7,W):$==="number"&&(W%1!=0?D.writeDoubleField(3,W):W<0?D.writeSVarintField(6,W):D.writeVarintField(5,W))}ge.exports=je,ge.exports.fromVectorTileJs=je,ge.exports.fromGeojsonVt=function(W,D){D=D||{};var $={};for(var j in W)$[j]=new Ce(W[j].features,D),$[j].name=j,$[j].version=D.version,$[j].extent=D.extent;return je({layers:$})},ge.exports.GeoJSONWrapper=Ce;var At=o.bz(ge.exports);const Qt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:W=>W},Gt=Math.fround||(ft=new Float32Array(1),W=>(ft[0]=+W,ft[0]));var ft;const Oe=3,gt=5,Bt=6;class wt{constructor(D){this.options=Object.assign(Object.create(Qt),D),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(D){const{log:$,minZoom:j,maxZoom:K}=this.options;$&&console.time("total time");const J=`prepare ${D.length} points`;$&&console.time(J),this.points=D;const he=[];for(let te=0;te<D.length;te++){const se=D[te];if(!se.geometry)continue;const[Ee,Ie]=se.geometry.coordinates,Ae=Gt(ei(Ee)),dt=Gt(kt(Ie));he.push(Ae,dt,1/0,te,-1,1),this.options.reduce&&he.push(0)}let ne=this.trees[K+1]=this._createTree(he);$&&console.timeEnd(J);for(let te=K;te>=j;te--){const se=+Date.now();ne=this.trees[te]=this._createTree(this._cluster(ne,te)),$&&console.log("z%d: %d clusters in %dms",te,ne.numItems,+Date.now()-se)}return $&&console.timeEnd("total time"),this}getClusters(D,$){let j=((D[0]+180)%360+360)%360-180;const K=Math.max(-90,Math.min(90,D[1]));let J=D[2]===180?180:((D[2]+180)%360+360)%360-180;const he=Math.max(-90,Math.min(90,D[3]));if(D[2]-D[0]>=360)j=-180,J=180;else if(j>J){const Ie=this.getClusters([j,K,180,he],$),Ae=this.getClusters([-180,K,J,he],$);return Ie.concat(Ae)}const ne=this.trees[this._limitZoom($)],te=ne.range(ei(j),kt(he),ei(J),kt(K)),se=ne.data,Ee=[];for(const Ie of te){const Ae=this.stride*Ie;Ee.push(se[Ae+gt]>1?$t(se,Ae,this.clusterProps):this.points[se[Ae+Oe]])}return Ee}getChildren(D){const $=this._getOriginId(D),j=this._getOriginZoom(D),K="No cluster with the specified id.",J=this.trees[j];if(!J)throw new Error(K);const he=J.data;if($*this.stride>=he.length)throw new Error(K);const ne=this.options.radius/(this.options.extent*Math.pow(2,j-1)),te=J.within(he[$*this.stride],he[$*this.stride+1],ne),se=[];for(const Ee of te){const Ie=Ee*this.stride;he[Ie+4]===D&&se.push(he[Ie+gt]>1?$t(he,Ie,this.clusterProps):this.points[he[Ie+Oe]])}if(se.length===0)throw new Error(K);return se}getLeaves(D,$,j){const K=[];return this._appendLeaves(K,D,$=$||10,j=j||0,0),K}getTile(D,$,j){const K=this.trees[this._limitZoom(D)],J=Math.pow(2,D),{extent:he,radius:ne}=this.options,te=ne/he,se=(j-te)/J,Ee=(j+1+te)/J,Ie={features:[]};return this._addTileFeatures(K.range(($-te)/J,se,($+1+te)/J,Ee),K.data,$,j,J,Ie),$===0&&this._addTileFeatures(K.range(1-te/J,se,1,Ee),K.data,J,j,J,Ie),$===J-1&&this._addTileFeatures(K.range(0,se,te/J,Ee),K.data,-1,j,J,Ie),Ie.features.length?Ie:null}getClusterExpansionZoom(D){let $=this._getOriginZoom(D)-1;for(;$<=this.options.maxZoom;){const j=this.getChildren(D);if($++,j.length!==1)break;D=j[0].properties.cluster_id}return $}_appendLeaves(D,$,j,K,J){const he=this.getChildren($);for(const ne of he){const te=ne.properties;if(te&&te.cluster?J+te.point_count<=K?J+=te.point_count:J=this._appendLeaves(D,te.cluster_id,j,K,J):J<K?J++:D.push(ne),D.length===j)break}return J}_createTree(D){const $=new o.av(D.length/this.stride|0,this.options.nodeSize,Float32Array);for(let j=0;j<D.length;j+=this.stride)$.add(D[j],D[j+1]);return $.finish(),$.data=D,$}_addTileFeatures(D,$,j,K,J,he){for(const ne of D){const te=ne*this.stride,se=$[te+gt]>1;let Ee,Ie,Ae;if(se)Ee=Yt($,te,this.clusterProps),Ie=$[te],Ae=$[te+1];else{const at=this.points[$[te+Oe]];Ee=at.properties;const[Ke,Ye]=at.geometry.coordinates;Ie=ei(Ke),Ae=kt(Ye)}const dt={type:1,geometry:[[Math.round(this.options.extent*(Ie*J-j)),Math.round(this.options.extent*(Ae*J-K))]],tags:Ee};let Ct;Ct=se||this.options.generateId?$[te+Oe]:this.points[$[te+Oe]].id,Ct!==void 0&&(dt.id=Ct),he.features.push(dt)}}_limitZoom(D){return Math.max(this.options.minZoom,Math.min(Math.floor(+D),this.options.maxZoom+1))}_cluster(D,$){const{radius:j,extent:K,reduce:J,minPoints:he}=this.options,ne=j/(K*Math.pow(2,$)),te=D.data,se=[],Ee=this.stride;for(let Ie=0;Ie<te.length;Ie+=Ee){if(te[Ie+2]<=$)continue;te[Ie+2]=$;const Ae=te[Ie],dt=te[Ie+1],Ct=D.within(te[Ie],te[Ie+1],ne),at=te[Ie+gt];let Ke=at;for(const Ye of Ct){const It=Ye*Ee;te[It+2]>$&&(Ke+=te[It+gt])}if(Ke>at&&Ke>=he){let Ye,It=Ae*at,Ot=dt*at,Rt=-1;const Lt=((Ie/Ee|0)<<5)+($+1)+this.points.length;for(const Ni of Ct){const ci=Ni*Ee;if(te[ci+2]<=$)continue;te[ci+2]=$;const Di=te[ci+gt];It+=te[ci]*Di,Ot+=te[ci+1]*Di,te[ci+4]=Lt,J&&(Ye||(Ye=this._map(te,Ie,!0),Rt=this.clusterProps.length,this.clusterProps.push(Ye)),J(Ye,this._map(te,ci)))}te[Ie+4]=Lt,se.push(It/Ke,Ot/Ke,1/0,Lt,-1,Ke),J&&se.push(Rt)}else{for(let Ye=0;Ye<Ee;Ye++)se.push(te[Ie+Ye]);if(Ke>1)for(const Ye of Ct){const It=Ye*Ee;if(!(te[It+2]<=$)){te[It+2]=$;for(let Ot=0;Ot<Ee;Ot++)se.push(te[It+Ot])}}}}return se}_getOriginId(D){return D-this.points.length>>5}_getOriginZoom(D){return(D-this.points.length)%32}_map(D,$,j){if(D[$+gt]>1){const he=this.clusterProps[D[$+Bt]];return j?Object.assign({},he):he}const K=this.points[D[$+Oe]].properties,J=this.options.map(K);return j&&J===K?Object.assign({},J):J}}function $t(W,D,$){return{type:"Feature",id:W[D+Oe],properties:Yt(W,D,$),geometry:{type:"Point",coordinates:[(j=W[D],360*(j-.5)),gi(W[D+1])]}};var j}function Yt(W,D,$){const j=W[D+gt],K=j>=1e4?`${Math.round(j/1e3)}k`:j>=1e3?Math.round(j/100)/10+"k":j,J=W[D+Bt],he=J===-1?{}:Object.assign({},$[J]);return Object.assign(he,{cluster:!0,cluster_id:W[D+Oe],point_count:j,point_count_abbreviated:K})}function ei(W){return W/360+.5}function kt(W){const D=Math.sin(W*Math.PI/180),$=.5-.25*Math.log((1+D)/(1-D))/Math.PI;return $<0?0:$>1?1:$}function gi(W){const D=(180-360*W)*Math.PI/180;return 360*Math.atan(Math.exp(D))/Math.PI-90}function pi(W,D,$,j){for(var K,J=j,he=$-D>>1,ne=$-D,te=W[D],se=W[D+1],Ee=W[$],Ie=W[$+1],Ae=D+3;Ae<$;Ae+=3){var dt=Pt(W[Ae],W[Ae+1],te,se,Ee,Ie);if(dt>J)K=Ae,J=dt;else if(dt===J){var Ct=Math.abs(Ae-he);Ct<ne&&(K=Ae,ne=Ct)}}J>j&&(K-D>3&&pi(W,D,K,j),W[K+2]=J,$-K>3&&pi(W,K,$,j))}function Pt(W,D,$,j,K,J){var he=K-$,ne=J-j;if(he!==0||ne!==0){var te=((W-$)*he+(D-j)*ne)/(he*he+ne*ne);te>1?($=K,j=J):te>0&&($+=he*te,j+=ne*te)}return(he=W-$)*he+(ne=D-j)*ne}function li(W,D,$,j){var K={id:W===void 0?null:W,type:D,geometry:$,tags:j,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(J){var he=J.geometry,ne=J.type;if(ne==="Point"||ne==="MultiPoint"||ne==="LineString")Xi(J,he);else if(ne==="Polygon"||ne==="MultiLineString")for(var te=0;te<he.length;te++)Xi(J,he[te]);else if(ne==="MultiPolygon")for(te=0;te<he.length;te++)for(var se=0;se<he[te].length;se++)Xi(J,he[te][se])}(K),K}function Xi(W,D){for(var $=0;$<D.length;$+=3)W.minX=Math.min(W.minX,D[$]),W.minY=Math.min(W.minY,D[$+1]),W.maxX=Math.max(W.maxX,D[$]),W.maxY=Math.max(W.maxY,D[$+1])}function Ht(W,D,$,j){if(D.geometry){var K=D.geometry.coordinates,J=D.geometry.type,he=Math.pow($.tolerance/((1<<$.maxZoom)*$.extent),2),ne=[],te=D.id;if($.promoteId?te=D.properties[$.promoteId]:$.generateId&&(te=j||0),J==="Point")Mi(K,ne);else if(J==="MultiPoint")for(var se=0;se<K.length;se++)Mi(K[se],ne);else if(J==="LineString")Fi(K,ne,he,!1);else if(J==="MultiLineString"){if($.lineMetrics){for(se=0;se<K.length;se++)Fi(K[se],ne=[],he,!1),W.push(li(te,"LineString",ne,D.properties));return}gr(K,ne,he,!1)}else if(J==="Polygon")gr(K,ne,he,!0);else{if(J!=="MultiPolygon"){if(J==="GeometryCollection"){for(se=0;se<D.geometry.geometries.length;se++)Ht(W,{id:te,geometry:D.geometry.geometries[se],properties:D.properties},$,j);return}throw new Error("Input data is not a valid GeoJSON object.")}for(se=0;se<K.length;se++){var Ee=[];gr(K[se],Ee,he,!0),ne.push(Ee)}}W.push(li(te,J,ne,D.properties))}}function Mi(W,D){D.push(Te(W[0])),D.push(bi(W[1])),D.push(0)}function Fi(W,D,$,j){for(var K,J,he=0,ne=0;ne<W.length;ne++){var te=Te(W[ne][0]),se=bi(W[ne][1]);D.push(te),D.push(se),D.push(0),ne>0&&(he+=j?(K*se-te*J)/2:Math.sqrt(Math.pow(te-K,2)+Math.pow(se-J,2))),K=te,J=se}var Ee=D.length-3;D[2]=1,pi(D,0,Ee,$),D[Ee+2]=1,D.size=Math.abs(he),D.start=0,D.end=D.size}function gr(W,D,$,j){for(var K=0;K<W.length;K++){var J=[];Fi(W[K],J,$,j),D.push(J)}}function Te(W){return W/360+.5}function bi(W){var D=Math.sin(W*Math.PI/180),$=.5-.25*Math.log((1+D)/(1-D))/Math.PI;return $<0?0:$>1?1:$}function Li(W,D,$,j,K,J,he,ne){if(j/=D,J>=($/=D)&&he<j)return W;if(he<$||J>=j)return null;for(var te=[],se=0;se<W.length;se++){var Ee=W[se],Ie=Ee.geometry,Ae=Ee.type,dt=K===0?Ee.minX:Ee.minY,Ct=K===0?Ee.maxX:Ee.maxY;if(dt>=$&&Ct<j)te.push(Ee);else if(!(Ct<$||dt>=j)){var at=[];if(Ae==="Point"||Ae==="MultiPoint")Wt(Ie,at,$,j,K);else if(Ae==="LineString")Ft(Ie,at,$,j,K,!1,ne.lineMetrics);else if(Ae==="MultiLineString")Ki(Ie,at,$,j,K,!1);else if(Ae==="Polygon")Ki(Ie,at,$,j,K,!0);else if(Ae==="MultiPolygon")for(var Ke=0;Ke<Ie.length;Ke++){var Ye=[];Ki(Ie[Ke],Ye,$,j,K,!0),Ye.length&&at.push(Ye)}if(at.length){if(ne.lineMetrics&&Ae==="LineString"){for(Ke=0;Ke<at.length;Ke++)te.push(li(Ee.id,Ae,at[Ke],Ee.tags));continue}Ae!=="LineString"&&Ae!=="MultiLineString"||(at.length===1?(Ae="LineString",at=at[0]):Ae="MultiLineString"),Ae!=="Point"&&Ae!=="MultiPoint"||(Ae=at.length===3?"Point":"MultiPoint"),te.push(li(Ee.id,Ae,at,Ee.tags))}}}return te.length?te:null}function Wt(W,D,$,j,K){for(var J=0;J<W.length;J+=3){var he=W[J+K];he>=$&&he<=j&&(D.push(W[J]),D.push(W[J+1]),D.push(W[J+2]))}}function Ft(W,D,$,j,K,J,he){for(var ne,te,se=Gi(W),Ee=K===0?cn:or,Ie=W.start,Ae=0;Ae<W.length-3;Ae+=3){var dt=W[Ae],Ct=W[Ae+1],at=W[Ae+2],Ke=W[Ae+3],Ye=W[Ae+4],It=K===0?dt:Ct,Ot=K===0?Ke:Ye,Rt=!1;he&&(ne=Math.sqrt(Math.pow(dt-Ke,2)+Math.pow(Ct-Ye,2))),It<$?Ot>$&&(te=Ee(se,dt,Ct,Ke,Ye,$),he&&(se.start=Ie+ne*te)):It>j?Ot<j&&(te=Ee(se,dt,Ct,Ke,Ye,j),he&&(se.start=Ie+ne*te)):yi(se,dt,Ct,at),Ot<$&&It>=$&&(te=Ee(se,dt,Ct,Ke,Ye,$),Rt=!0),Ot>j&&It<=j&&(te=Ee(se,dt,Ct,Ke,Ye,j),Rt=!0),!J&&Rt&&(he&&(se.end=Ie+ne*te),D.push(se),se=Gi(W)),he&&(Ie+=ne)}var Lt=W.length-3;dt=W[Lt],Ct=W[Lt+1],at=W[Lt+2],(It=K===0?dt:Ct)>=$&&It<=j&&yi(se,dt,Ct,at),Lt=se.length-3,J&&Lt>=3&&(se[Lt]!==se[0]||se[Lt+1]!==se[1])&&yi(se,se[0],se[1],se[2]),se.length&&D.push(se)}function Gi(W){var D=[];return D.size=W.size,D.start=W.start,D.end=W.end,D}function Ki(W,D,$,j,K,J){for(var he=0;he<W.length;he++)Ft(W[he],D,$,j,K,J,!1)}function yi(W,D,$,j){W.push(D),W.push($),W.push(j)}function cn(W,D,$,j,K,J){var he=(J-D)/(j-D);return W.push(J),W.push($+(K-$)*he),W.push(1),he}function or(W,D,$,j,K,J){var he=(J-$)/(K-$);return W.push(D+(j-D)*he),W.push(J),W.push(1),he}function ar(W,D){for(var $=[],j=0;j<W.length;j++){var K,J=W[j],he=J.type;if(he==="Point"||he==="MultiPoint"||he==="LineString")K=qr(J.geometry,D);else if(he==="MultiLineString"||he==="Polygon"){K=[];for(var ne=0;ne<J.geometry.length;ne++)K.push(qr(J.geometry[ne],D))}else if(he==="MultiPolygon")for(K=[],ne=0;ne<J.geometry.length;ne++){for(var te=[],se=0;se<J.geometry[ne].length;se++)te.push(qr(J.geometry[ne][se],D));K.push(te)}$.push(li(J.id,he,K,J.tags))}return $}function qr(W,D){var $=[];$.size=W.size,W.start!==void 0&&($.start=W.start,$.end=W.end);for(var j=0;j<W.length;j+=3)$.push(W[j]+D,W[j+1],W[j+2]);return $}function Ve(W,D){if(W.transformed)return W;var $,j,K,J=1<<W.z,he=W.x,ne=W.y;for($=0;$<W.features.length;$++){var te=W.features[$],se=te.geometry,Ee=te.type;if(te.geometry=[],Ee===1)for(j=0;j<se.length;j+=2)te.geometry.push(Et(se[j],se[j+1],D,J,he,ne));else for(j=0;j<se.length;j++){var Ie=[];for(K=0;K<se[j].length;K+=2)Ie.push(Et(se[j][K],se[j][K+1],D,J,he,ne));te.geometry.push(Ie)}}return W.transformed=!0,W}function Et(W,D,$,j,K,J){return[Math.round($*(W*j-K)),Math.round($*(D*j-J))]}function St(W,D,$,j,K){for(var J=D===K.maxZoom?0:K.tolerance/((1<<D)*K.extent),he={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:$,y:j,z:D,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ne=0;ne<W.length;ne++){he.numFeatures++,Jt(he,W[ne],J,K);var te=W[ne].minX,se=W[ne].minY,Ee=W[ne].maxX,Ie=W[ne].maxY;te<he.minX&&(he.minX=te),se<he.minY&&(he.minY=se),Ee>he.maxX&&(he.maxX=Ee),Ie>he.maxY&&(he.maxY=Ie)}return he}function Jt(W,D,$,j){var K=D.geometry,J=D.type,he=[];if(J==="Point"||J==="MultiPoint")for(var ne=0;ne<K.length;ne+=3)he.push(K[ne]),he.push(K[ne+1]),W.numPoints++,W.numSimplified++;else if(J==="LineString")zt(he,K,W,$,!1,!1);else if(J==="MultiLineString"||J==="Polygon")for(ne=0;ne<K.length;ne++)zt(he,K[ne],W,$,J==="Polygon",ne===0);else if(J==="MultiPolygon")for(var te=0;te<K.length;te++){var se=K[te];for(ne=0;ne<se.length;ne++)zt(he,se[ne],W,$,!0,ne===0)}if(he.length){var Ee=D.tags||null;if(J==="LineString"&&j.lineMetrics){for(var Ie in Ee={},D.tags)Ee[Ie]=D.tags[Ie];Ee.mapbox_clip_start=K.start/K.size,Ee.mapbox_clip_end=K.end/K.size}var Ae={geometry:he,type:J==="Polygon"||J==="MultiPolygon"?3:J==="LineString"||J==="MultiLineString"?2:1,tags:Ee};D.id!==null&&(Ae.id=D.id),W.features.push(Ae)}}function zt(W,D,$,j,K,J){var he=j*j;if(j>0&&D.size<(K?he:j))$.numPoints+=D.length/3;else{for(var ne=[],te=0;te<D.length;te+=3)(j===0||D[te+2]>he)&&($.numSimplified++,ne.push(D[te]),ne.push(D[te+1])),$.numPoints++;K&&function(se,Ee){for(var Ie=0,Ae=0,dt=se.length,Ct=dt-2;Ae<dt;Ct=Ae,Ae+=2)Ie+=(se[Ae]-se[Ct])*(se[Ae+1]+se[Ct+1]);if(Ie>0===Ee)for(Ae=0,dt=se.length;Ae<dt/2;Ae+=2){var at=se[Ae],Ke=se[Ae+1];se[Ae]=se[dt-2-Ae],se[Ae+1]=se[dt-1-Ae],se[dt-2-Ae]=at,se[dt-1-Ae]=Ke}}(ne,J),W.push(ne)}}function Le(W,D){var $=(D=this.options=function(K,J){for(var he in J)K[he]=J[he];return K}(Object.create(this.options),D)).debug;if($&&console.time("preprocess data"),D.maxZoom<0||D.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(D.promoteId&&D.generateId)throw new Error("promoteId and generateId cannot be used together.");var j=function(K,J){var he=[];if(K.type==="FeatureCollection")for(var ne=0;ne<K.features.length;ne++)Ht(he,K.features[ne],J,ne);else Ht(he,K.type==="Feature"?K:{geometry:K},J);return he}(W,D);this.tiles={},this.tileCoords=[],$&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",D.indexMaxZoom,D.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),j=function(K,J){var he=J.buffer/J.extent,ne=K,te=Li(K,1,-1-he,he,0,-1,2,J),se=Li(K,1,1-he,2+he,0,-1,2,J);return(te||se)&&(ne=Li(K,1,-he,1+he,0,-1,2,J)||[],te&&(ne=ar(te,1).concat(ne)),se&&(ne=ne.concat(ar(se,-1)))),ne}(j,D),j.length&&this.splitTile(j,0,0,0),$&&(j.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function mt(W,D,$){return 32*((1<<W)*$+D)+W}function vt(W,D){return D?W.properties[D]:W.id}function wi(W,D){if(W==null)return!0;if(W.type==="Feature")return vt(W,D)!=null;if(W.type==="FeatureCollection"){const $=new Set;for(const j of W.features){const K=vt(j,D);if(K==null||$.has(K))return!1;$.add(K)}return!0}return!1}function Zi(W,D){const $=new Map;if(W!=null)if(W.type==="Feature")$.set(vt(W,D),W);else for(const j of W.features)$.set(vt(j,D),j);return $}Le.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Le.prototype.splitTile=function(W,D,$,j,K,J,he){for(var ne=[W,D,$,j],te=this.options,se=te.debug;ne.length;){j=ne.pop(),$=ne.pop(),D=ne.pop(),W=ne.pop();var Ee=1<<D,Ie=mt(D,$,j),Ae=this.tiles[Ie];if(!Ae&&(se>1&&console.time("creation"),Ae=this.tiles[Ie]=St(W,D,$,j,te),this.tileCoords.push({z:D,x:$,y:j}),se)){se>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",D,$,j,Ae.numFeatures,Ae.numPoints,Ae.numSimplified),console.timeEnd("creation"));var dt="z"+D;this.stats[dt]=(this.stats[dt]||0)+1,this.total++}if(Ae.source=W,K){if(D===te.maxZoom||D===K)continue;var Ct=1<<K-D;if($!==Math.floor(J/Ct)||j!==Math.floor(he/Ct))continue}else if(D===te.indexMaxZoom||Ae.numPoints<=te.indexMaxPoints)continue;if(Ae.source=null,W.length!==0){se>1&&console.time("clipping");var at,Ke,Ye,It,Ot,Rt,Lt=.5*te.buffer/te.extent,Ni=.5-Lt,ci=.5+Lt,Di=1+Lt;at=Ke=Ye=It=null,Ot=Li(W,Ee,$-Lt,$+ci,0,Ae.minX,Ae.maxX,te),Rt=Li(W,Ee,$+Ni,$+Di,0,Ae.minX,Ae.maxX,te),W=null,Ot&&(at=Li(Ot,Ee,j-Lt,j+ci,1,Ae.minY,Ae.maxY,te),Ke=Li(Ot,Ee,j+Ni,j+Di,1,Ae.minY,Ae.maxY,te),Ot=null),Rt&&(Ye=Li(Rt,Ee,j-Lt,j+ci,1,Ae.minY,Ae.maxY,te),It=Li(Rt,Ee,j+Ni,j+Di,1,Ae.minY,Ae.maxY,te),Rt=null),se>1&&console.timeEnd("clipping"),ne.push(at||[],D+1,2*$,2*j),ne.push(Ke||[],D+1,2*$,2*j+1),ne.push(Ye||[],D+1,2*$+1,2*j),ne.push(It||[],D+1,2*$+1,2*j+1)}}},Le.prototype.getTile=function(W,D,$){var j=this.options,K=j.extent,J=j.debug;if(W<0||W>24)return null;var he=1<<W,ne=mt(W,D=(D%he+he)%he,$);if(this.tiles[ne])return Ve(this.tiles[ne],K);J>1&&console.log("drilling down to z%d-%d-%d",W,D,$);for(var te,se=W,Ee=D,Ie=$;!te&&se>0;)se--,Ee=Math.floor(Ee/2),Ie=Math.floor(Ie/2),te=this.tiles[mt(se,Ee,Ie)];return te&&te.source?(J>1&&console.log("found parent tile z%d-%d-%d",se,Ee,Ie),J>1&&console.time("drilling down"),this.splitTile(te.source,se,Ee,Ie,W,D,$),J>1&&console.timeEnd("drilling down"),this.tiles[ne]?Ve(this.tiles[ne],K):null):null};class Mt extends ae{constructor(D,$,j,K){super(D,$,j),this._dataUpdateable=new Map,this.loadGeoJSON=(J,he)=>{const{promoteId:ne}=J;if(J.request)return o.f(J.request,(te,se,Ee,Ie)=>{this._dataUpdateable=wi(se,ne)?Zi(se,ne):void 0,he(te,se,Ee,Ie)});if(typeof J.data=="string")try{const te=JSON.parse(J.data);this._dataUpdateable=wi(te,ne)?Zi(te,ne):void 0,he(null,te)}catch{he(new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`))}else J.dataDiff?this._dataUpdateable?(function(te,se,Ee){var Ie,Ae,dt,Ct;if(se.removeAll&&te.clear(),se.remove)for(const at of se.remove)te.delete(at);if(se.add)for(const at of se.add){const Ke=vt(at,Ee);Ke!=null&&te.set(Ke,at)}if(se.update)for(const at of se.update){let Ke=te.get(at.id);if(Ke==null)continue;const Ye=!at.removeAllProperties&&(((Ie=at.removeProperties)===null||Ie===void 0?void 0:Ie.length)>0||((Ae=at.addOrUpdateProperties)===null||Ae===void 0?void 0:Ae.length)>0);if((at.newGeometry||at.removeAllProperties||Ye)&&(Ke=Object.assign({},Ke),te.set(at.id,Ke),Ye&&(Ke.properties=Object.assign({},Ke.properties))),at.newGeometry&&(Ke.geometry=at.newGeometry),at.removeAllProperties)Ke.properties={};else if(((dt=at.removeProperties)===null||dt===void 0?void 0:dt.length)>0)for(const It of at.removeProperties)Object.prototype.hasOwnProperty.call(Ke.properties,It)&&delete Ke.properties[It];if(((Ct=at.addOrUpdateProperties)===null||Ct===void 0?void 0:Ct.length)>0)for(const{key:It,value:Ot}of at.addOrUpdateProperties)Ke.properties[It]=Ot}}(this._dataUpdateable,J.dataDiff,ne),he(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):he(new Error(`Cannot update existing geojson data in ${J.source}`)):he(new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},this.loadVectorData=this.loadGeoJSONTile,K&&(this.loadGeoJSON=K)}loadGeoJSONTile(D,$){const j=D.tileID.canonical;if(!this._geoJSONIndex)return $(null,null);const K=this._geoJSONIndex.getTile(j.z,j.x,j.y);if(!K)return $(null,null);const J=new class{constructor(ne){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.N,this.length=ne.length,this._features=ne}feature(ne){return new class{constructor(te){this._feature=te,this.extent=o.N,this.type=te.type,this.properties=te.tags,"id"in te&&!isNaN(te.id)&&(this.id=parseInt(te.id,10))}loadGeometry(){if(this._feature.type===1){const te=[];for(const se of this._feature.geometry)te.push([new o.P(se[0],se[1])]);return te}{const te=[];for(const se of this._feature.geometry){const Ee=[];for(const Ie of se)Ee.push(new o.P(Ie[0],Ie[1]));te.push(Ee)}return te}}toGeoJSON(te,se,Ee){return be.call(this,te,se,Ee)}}(this._features[ne])}}(K.features);let he=At(J);he.byteOffset===0&&he.byteLength===he.buffer.byteLength||(he=new Uint8Array(he)),$(null,{vectorTile:J,rawData:he.buffer})}loadData(D,$){var j;(j=this._pendingRequest)===null||j===void 0||j.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const K=!!(D&&D.request&&D.request.collectResourceTiming)&&new o.bu(D.request);this._pendingCallback=$,this._pendingRequest=this.loadGeoJSON(D,(J,he)=>{if(delete this._pendingCallback,delete this._pendingRequest,J||!he)return $(J);if(typeof he!="object")return $(new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`));{ve(he,!0);try{if(D.filter){const te=o.bC(D.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(te.result==="error")throw new Error(te.value.map(Ee=>`${Ee.key}: ${Ee.message}`).join(", "));he={type:"FeatureCollection",features:he.features.filter(Ee=>te.value.evaluate({zoom:0},Ee))}}this._geoJSONIndex=D.cluster?new wt(function({superclusterOptions:te,clusterProperties:se}){if(!se||!te)return te;const Ee={},Ie={},Ae={accumulated:null,zoom:0},dt={properties:null},Ct=Object.keys(se);for(const at of Ct){const[Ke,Ye]=se[at],It=o.bC(Ye),Ot=o.bC(typeof Ke=="string"?[Ke,["accumulated"],["get",at]]:Ke);Ee[at]=It.value,Ie[at]=Ot.value}return te.map=at=>{dt.properties=at;const Ke={};for(const Ye of Ct)Ke[Ye]=Ee[Ye].evaluate(Ae,dt);return Ke},te.reduce=(at,Ke)=>{dt.properties=Ke;for(const Ye of Ct)Ae.accumulated=at[Ye],at[Ye]=Ie[Ye].evaluate(Ae,dt)},te}(D)).load(he.features):function(te,se){return new Le(te,se)}(he,D.geojsonVtOptions)}catch(te){return $(te)}this.loaded={};const ne={};if(K){const te=K.finish();te&&(ne.resourceTiming={},ne.resourceTiming[D.source]=JSON.parse(JSON.stringify(te)))}$(null,ne)}})}reloadTile(D,$){const j=this.loaded;return j&&j[D.uid]?super.reloadTile(D,$):this.loadTile(D,$)}removeSource(D,$){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),$()}getClusterExpansionZoom(D,$){try{$(null,this._geoJSONIndex.getClusterExpansionZoom(D.clusterId))}catch(j){$(j)}}getClusterChildren(D,$){try{$(null,this._geoJSONIndex.getChildren(D.clusterId))}catch(j){$(j)}}getClusterLeaves(D,$){try{$(null,this._geoJSONIndex.getLeaves(D.clusterId,D.limit,D.offset))}catch(j){$(j)}}}class Gr{constructor(D){this.self=D,this.actor=new o.C(D,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:ae,geojson:Mt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=($,j)=>{if(this.workerSourceTypes[$])throw new Error(`Worker source with name "${$}" already registered.`);this.workerSourceTypes[$]=j},this.self.registerRTLTextPlugin=$=>{if(o.bD.isParsed())throw new Error("RTL text plugin already registered.");o.bD.applyArabicShaping=$.applyArabicShaping,o.bD.processBidirectionalText=$.processBidirectionalText,o.bD.processStyledBidirectionalText=$.processStyledBidirectionalText}}setReferrer(D,$){this.referrer=$}setImages(D,$,j){this.availableImages[D]=$;for(const K in this.workerSources[D]){const J=this.workerSources[D][K];for(const he in J)J[he].availableImages=$}j()}setLayers(D,$,j){this.getLayerIndex(D).replace($),j()}updateLayers(D,$,j){this.getLayerIndex(D).update($.layers,$.removedIds),j()}loadTile(D,$,j){this.getWorkerSource(D,$.type,$.source).loadTile($,j)}loadDEMTile(D,$,j){this.getDEMWorkerSource(D,$.source).loadTile($,j)}reloadTile(D,$,j){this.getWorkerSource(D,$.type,$.source).reloadTile($,j)}abortTile(D,$,j){this.getWorkerSource(D,$.type,$.source).abortTile($,j)}removeTile(D,$,j){this.getWorkerSource(D,$.type,$.source).removeTile($,j)}removeDEMTile(D,$){this.getDEMWorkerSource(D,$.source).removeTile($)}removeSource(D,$,j){if(!this.workerSources[D]||!this.workerSources[D][$.type]||!this.workerSources[D][$.type][$.source])return;const K=this.workerSources[D][$.type][$.source];delete this.workerSources[D][$.type][$.source],K.removeSource!==void 0?K.removeSource($,j):j()}loadWorkerSource(D,$,j){try{this.self.importScripts($.url),j()}catch(K){j(K.toString())}}syncRTLPluginState(D,$,j){try{o.bD.setState($);const K=o.bD.getPluginURL();if(o.bD.isLoaded()&&!o.bD.isParsed()&&K!=null){this.self.importScripts(K);const J=o.bD.isParsed();j(J?void 0:new Error(`RTL Text Plugin failed to import scripts from ${K}`),J)}}catch(K){j(K.toString())}}getAvailableImages(D){let $=this.availableImages[D];return $||($=[]),$}getLayerIndex(D){let $=this.layerIndexes[D];return $||($=this.layerIndexes[D]=new O),$}getWorkerSource(D,$,j){return this.workerSources[D]||(this.workerSources[D]={}),this.workerSources[D][$]||(this.workerSources[D][$]={}),this.workerSources[D][$][j]||(this.workerSources[D][$][j]=new this.workerSourceTypes[$]({send:(K,J,he)=>{this.actor.send(K,J,he,D)}},this.getLayerIndex(D),this.getAvailableImages(D))),this.workerSources[D][$][j]}getDEMWorkerSource(D,$){return this.demWorkerSources[D]||(this.demWorkerSources[D]={}),this.demWorkerSources[D][$]||(this.demWorkerSources[D][$]=new fe),this.demWorkerSources[D][$]}}return o.i()&&(self.worker=new Gr(self)),Gr}),E(["./shared"],function(o){var O="3.6.2";class L{static testProp(t){if(!L.docStyle)return t[0];for(let n=0;n<t.length;n++)if(t[n]in L.docStyle)return t[n];return t[0]}static create(t,n,l){const u=window.document.createElement(t);return n!==void 0&&(u.className=n),l&&l.appendChild(u),u}static createNS(t,n){return window.document.createElementNS(t,n)}static disableDrag(){L.docStyle&&L.selectProp&&(L.userSelect=L.docStyle[L.selectProp],L.docStyle[L.selectProp]="none")}static enableDrag(){L.docStyle&&L.selectProp&&(L.docStyle[L.selectProp]=L.userSelect)}static setTransform(t,n){t.style[L.transformProp]=n}static addEventListener(t,n,l,u={}){t.addEventListener(n,l,"passive"in u?u:u.capture)}static removeEventListener(t,n,l,u={}){t.removeEventListener(n,l,"passive"in u?u:u.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",L.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",L.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",L.suppressClickInternal,!0)},0)}static mousePos(t,n){const l=t.getBoundingClientRect();return new o.P(n.clientX-l.left-t.clientLeft,n.clientY-l.top-t.clientTop)}static touchPos(t,n){const l=t.getBoundingClientRect(),u=[];for(let f=0;f<n.length;f++)u.push(new o.P(n[f].clientX-l.left-t.clientLeft,n[f].clientY-l.top-t.clientTop));return u}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}L.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,L.selectProp=L.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),L.transformProp=L.testProp(["transform","WebkitTransform"]);const V={supported:!1,testSupport:function(d){!ae&&Q&&(fe?me(d):q=d)}};let q,Q,ae=!1,fe=!1;function me(d){const t=d.createTexture();d.bindTexture(d.TEXTURE_2D,t);try{if(d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,Q),d.isContextLost())return;V.supported=!0}catch{}d.deleteTexture(t),ae=!0}var xe,ve;typeof document<"u"&&(Q=document.createElement("img"),Q.onload=function(){q&&me(q),q=null,fe=!0},Q.onerror=function(){ae=!0,q=null},Q.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(d){let t,n,l,u;d.resetRequestQueue=()=>{t=[],n=0,l=0,u={}},d.addThrottleControl=T=>{const P=l++;return u[P]=T,P},d.removeThrottleControl=T=>{delete u[T],v()},d.getImage=(T,P,M=!0)=>{V.supported&&(T.headers||(T.headers={}),T.headers.accept="image/webp,*/*");const B={requestParameters:T,supportImageRefresh:M,callback:P,cancelled:!1,completed:!1,cancel:()=>{B.completed||B.cancelled||(B.cancelled=!0,B.innerRequest&&(B.innerRequest.cancel(),n--),v())}};return t.push(B),v(),B};const f=T=>{const{requestParameters:P,supportImageRefresh:M,callback:B}=T;return o.e(P,{type:"image"}),(M!==!1||o.i()||o.g(P.url)||P.headers&&!Object.keys(P.headers).reduce((H,Z)=>H&&Z==="accept",!0)?o.m:S)(P,(H,Z,X,U)=>{_(T,B,H,Z,X,U)})},_=(T,P,M,B,H,Z)=>{M?P(M):B instanceof HTMLImageElement||o.a(B)?P(null,B):B&&((X,U)=>{typeof createImageBitmap=="function"?o.b(X,U):o.d(X,U)})(B,(X,U)=>{X!=null?P(X):U!=null&&P(null,U,{cacheControl:H,expires:Z})}),T.cancelled||(T.completed=!0,n--,v())},v=()=>{const T=(()=>{const P=Object.keys(u);let M=!1;if(P.length>0){for(const B of P)if(M=u[B](),M)break}return M})()?o.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:o.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let P=n;P<T&&t.length>0;P++){const M=t.shift();if(M.cancelled){P--;continue}const B=f(M);n++,M.innerRequest=B}},S=(T,P)=>{const M=new Image,B=T.url;let H=!1;const Z=T.credentials;return Z&&Z==="include"?M.crossOrigin="use-credentials":(Z&&Z==="same-origin"||!o.s(B))&&(M.crossOrigin="anonymous"),M.fetchPriority="high",M.onload=()=>{P(null,M),M.onerror=M.onload=null},M.onerror=()=>{H||P(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),M.onerror=M.onload=null},M.src=B,{cancel:()=>{H=!0,M.src=""}}}}(xe||(xe={})),xe.resetRequestQueue(),function(d){d.Glyphs="Glyphs",d.Image="Image",d.Source="Source",d.SpriteImage="SpriteImage",d.SpriteJSON="SpriteJSON",d.Style="Style",d.Tile="Tile",d.Unknown="Unknown"}(ve||(ve={}));class be{constructor(t){this._transformRequestFn=t}transformRequest(t,n){return this._transformRequestFn&&this._transformRequestFn(t,n)||{url:t}}normalizeSpriteURL(t,n,l){const u=function(f){const _=f.match(ge);if(!_)throw new Error(`Unable to parse URL "${f}"`);return{protocol:_[1],authority:_[2],path:_[3]||"/",params:_[4]?_[4].split("&"):[]}}(t);return u.path+=`${n}${l}`,function(f){const _=f.params.length?`?${f.params.join("&")}`:"";return`${f.protocol}://${f.authority}${f.path}${_}`}(u)}setTransformRequest(t){this._transformRequestFn=t}}const ge=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ce(d){var t=new o.A(3);return t[0]=d[0],t[1]=d[1],t[2]=d[2],t}var Se,ze=function(d,t,n){return d[0]=t[0]-n[0],d[1]=t[1]-n[1],d[2]=t[2]-n[2],d};Se=new o.A(3),o.A!=Float32Array&&(Se[0]=0,Se[1]=0,Se[2]=0);var Be=function(d){var t=d[0],n=d[1];return t*t+n*n};function $e(d){const t=[];if(typeof d=="string")t.push({id:"default",url:d});else if(d&&d.length>0){const n=[];for(const{id:l,url:u}of d){const f=`${l}${u}`;n.indexOf(f)===-1&&(n.push(f),t.push({id:l,url:u}))}}return t}function De(d,t,n,l,u){if(l)return void d(l);if(u!==Object.values(t).length||u!==Object.values(n).length)return;const f={};for(const _ in t){f[_]={};const v=o.h.getImageCanvasContext(n[_]),S=t[_];for(const T in S){const{width:P,height:M,x:B,y:H,sdf:Z,pixelRatio:X,stretchX:U,stretchY:oe,content:pe}=S[T];f[_][T]={data:null,pixelRatio:X,sdf:Z,stretchX:U,stretchY:oe,content:pe,spriteData:{width:P,height:M,x:B,y:H,context:v}}}}d(null,f)}(function(){var d=new o.A(2);o.A!=Float32Array&&(d[0]=0,d[1]=0)})();class Ce{constructor(t,n,l,u){this.context=t,this.format=l,this.texture=t.gl.createTexture(),this.update(n,u)}update(t,n,l){const{width:u,height:f}=t,_=!(this.size&&this.size[0]===u&&this.size[1]===f||l),{context:v}=this,{gl:S}=v;if(this.useMipmap=!!(n&&n.useMipmap),S.bindTexture(S.TEXTURE_2D,this.texture),v.pixelStoreUnpackFlipY.set(!1),v.pixelStoreUnpack.set(1),v.pixelStoreUnpackPremultiplyAlpha.set(this.format===S.RGBA&&(!n||n.premultiply!==!1)),_)this.size=[u,f],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||o.a(t)?S.texImage2D(S.TEXTURE_2D,0,this.format,this.format,S.UNSIGNED_BYTE,t):S.texImage2D(S.TEXTURE_2D,0,this.format,u,f,0,this.format,S.UNSIGNED_BYTE,t.data);else{const{x:T,y:P}=l||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||o.a(t)?S.texSubImage2D(S.TEXTURE_2D,0,T,P,S.RGBA,S.UNSIGNED_BYTE,t):S.texSubImage2D(S.TEXTURE_2D,0,T,P,u,f,S.RGBA,S.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&S.generateMipmap(S.TEXTURE_2D)}bind(t,n,l){const{context:u}=this,{gl:f}=u;f.bindTexture(f.TEXTURE_2D,this.texture),l!==f.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=f.LINEAR),t!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,t),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,l||t),this.filter=t),n!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,n),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function je(d){const{userImage:t}=d;return!!(t&&t.render&&t.render())&&(d.data.replace(new Uint8Array(t.data.buffer)),!0)}class Ge extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:n,callback:l}of this.requestors)this._notify(n,l);this.requestors=[]}}getImage(t){const n=this.images[t];if(n&&!n.data&&n.spriteData){const l=n.spriteData;n.data=new o.R({width:l.width,height:l.height},l.context.getImageData(l.x,l.y,l.width,l.height).data),n.spriteData=null}return n}addImage(t,n){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,n)&&(this.images[t]=n)}_validate(t,n){let l=!0;const u=n.data||n.spriteData;return this._validateStretch(n.stretchX,u&&u.width)||(this.fire(new o.j(new Error(`Image "${t}" has invalid "stretchX" value`))),l=!1),this._validateStretch(n.stretchY,u&&u.height)||(this.fire(new o.j(new Error(`Image "${t}" has invalid "stretchY" value`))),l=!1),this._validateContent(n.content,n)||(this.fire(new o.j(new Error(`Image "${t}" has invalid "content" value`))),l=!1),l}_validateStretch(t,n){if(!t)return!0;let l=0;for(const u of t){if(u[0]<l||u[1]<u[0]||n<u[1])return!1;l=u[1]}return!0}_validateContent(t,n){if(!t)return!0;if(t.length!==4)return!1;const l=n.spriteData,u=l&&l.width||n.data.width,f=l&&l.height||n.data.height;return!(t[0]<0||u<t[0]||t[1]<0||f<t[1]||t[2]<0||u<t[2]||t[3]<0||f<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,n,l=!0){const u=this.getImage(t);if(l&&(u.data.width!==n.data.width||u.data.height!==n.data.height))throw new Error(`size mismatch between old image (${u.data.width}x${u.data.height}) and new image (${n.data.width}x${n.data.height}).`);n.version=u.version+1,this.images[t]=n,this.updatedImages[t]=!0}removeImage(t){const n=this.images[t];delete this.images[t],delete this.patterns[t],n.userImage&&n.userImage.onRemove&&n.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,n){let l=!0;if(!this.isLoaded())for(const u of t)this.images[u]||(l=!1);this.isLoaded()||l?this._notify(t,n):this.requestors.push({ids:t,callback:n})}_notify(t,n){const l={};for(const u of t){let f=this.getImage(u);f||(this.fire(new o.k("styleimagemissing",{id:u})),f=this.getImage(u)),f?l[u]={data:f.data.clone(),pixelRatio:f.pixelRatio,sdf:f.sdf,version:f.version,stretchX:f.stretchX,stretchY:f.stretchY,content:f.content,hasRenderCallback:!!(f.userImage&&f.userImage.render)}:o.w(`Image "${u}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}n(null,l)}getPixelSize(){const{width:t,height:n}=this.atlasImage;return{width:t,height:n}}getPattern(t){const n=this.patterns[t],l=this.getImage(t);if(!l)return null;if(n&&n.position.version===l.version)return n.position;if(n)n.position.version=l.version;else{const u={w:l.data.width+2,h:l.data.height+2,x:0,y:0},f=new o.I(u,l);this.patterns[t]={bin:u,position:f}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const n=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Ce(t,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const f in this.patterns)t.push(this.patterns[f].bin);const{w:n,h:l}=o.p(t),u=this.atlasImage;u.resize({width:n||1,height:l||1});for(const f in this.patterns){const{bin:_}=this.patterns[f],v=_.x+1,S=_.y+1,T=this.getImage(f).data,P=T.width,M=T.height;o.R.copy(T,u,{x:0,y:0},{x:v,y:S},{width:P,height:M}),o.R.copy(T,u,{x:0,y:M-1},{x:v,y:S-1},{width:P,height:1}),o.R.copy(T,u,{x:0,y:0},{x:v,y:S+M},{width:P,height:1}),o.R.copy(T,u,{x:P-1,y:0},{x:v-1,y:S},{width:1,height:M}),o.R.copy(T,u,{x:0,y:0},{x:v+P,y:S},{width:1,height:M})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const n of t){if(this.callbackDispatchedThisFrame[n])continue;this.callbackDispatchedThisFrame[n]=!0;const l=this.getImage(n);l||o.w(`Image with ID: "${n}" was not found`),je(l)&&this.updateImage(n,l)}}}const tt=1e20;function He(d,t,n,l,u,f,_,v,S){for(let T=t;T<t+l;T++)ot(d,n*f+T,f,u,_,v,S);for(let T=n;T<n+u;T++)ot(d,T*f+t,1,l,_,v,S)}function ot(d,t,n,l,u,f,_){f[0]=0,_[0]=-tt,_[1]=tt,u[0]=d[t];for(let v=1,S=0,T=0;v<l;v++){u[v]=d[t+v*n];const P=v*v;do{const M=f[S];T=(u[v]-u[M]+P-M*M)/(v-M)/2}while(T<=_[S]&&--S>-1);S++,f[S]=v,_[S]=T,_[S+1]=tt}for(let v=0,S=0;v<l;v++){for(;_[S+1]<v;)S++;const T=f[S],P=v-T;d[t+v*n]=u[T]+P*P}}class Tt{constructor(t,n){this.requestManager=t,this.localIdeographFontFamily=n,this.entries={}}setURL(t){this.url=t}getGlyphs(t,n){const l=[];for(const u in t)for(const f of t[u])l.push({stack:u,id:f});o.o(l,({stack:u,id:f},_)=>{let v=this.entries[u];v||(v=this.entries[u]={glyphs:{},requests:{},ranges:{}});let S=v.glyphs[f];if(S!==void 0)return void _(null,{stack:u,id:f,glyph:S});if(S=this._tinySDF(v,u,f),S)return v.glyphs[f]=S,void _(null,{stack:u,id:f,glyph:S});const T=Math.floor(f/256);if(256*T>65535)return void _(new Error("glyphs > 65535 not supported"));if(v.ranges[T])return void _(null,{stack:u,id:f,glyph:S});if(!this.url)return void _(new Error("glyphsUrl is not set"));let P=v.requests[T];P||(P=v.requests[T]=[],Tt.loadGlyphRange(u,T,this.url,this.requestManager,(M,B)=>{if(B){for(const H in B)this._doesCharSupportLocalGlyph(+H)||(v.glyphs[+H]=B[+H]);v.ranges[T]=!0}for(const H of P)H(M,B);delete v.requests[T]})),P.push((M,B)=>{M?_(M):B&&_(null,{stack:u,id:f,glyph:B[f]||null})})},(u,f)=>{if(u)n(u);else if(f){const _={};for(const{stack:v,id:S,glyph:T}of f)(_[v]||(_[v]={}))[S]=T&&{id:T.id,bitmap:T.bitmap.clone(),metrics:T.metrics};n(null,_)}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(o.u["CJK Unified Ideographs"](t)||o.u["Hangul Syllables"](t)||o.u.Hiragana(t)||o.u.Katakana(t))}_tinySDF(t,n,l){const u=this.localIdeographFontFamily;if(!u||!this._doesCharSupportLocalGlyph(l))return;let f=t.tinySDF;if(!f){let v="400";/bold/i.test(n)?v="900":/medium/i.test(n)?v="500":/light/i.test(n)&&(v="200"),f=t.tinySDF=new Tt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:u,fontWeight:v})}const _=f.draw(String.fromCharCode(l));return{id:l,bitmap:new o.q({width:_.width||60,height:_.height||60},_.data),metrics:{width:_.glyphWidth/2||24,height:_.glyphHeight/2||24,left:_.glyphLeft/2+.5||0,top:_.glyphTop/2-27.5||-8,advance:_.glyphAdvance/2||24,isDoubleResolution:!0}}}}Tt.loadGlyphRange=function(d,t,n,l,u){const f=256*t,_=f+255,v=l.transformRequest(n.replace("{fontstack}",d).replace("{range}",`${f}-${_}`),ve.Glyphs);o.l(v,(S,T)=>{if(S)u(S);else if(T){const P={};for(const M of o.n(T))P[M.id]=M;u(null,P)}})},Tt.TinySDF=class{constructor({fontSize:d=24,buffer:t=3,radius:n=8,cutoff:l=.25,fontFamily:u="sans-serif",fontWeight:f="normal",fontStyle:_="normal"}={}){this.buffer=t,this.cutoff=l,this.radius=n;const v=this.size=d+4*t,S=this._createCanvas(v),T=this.ctx=S.getContext("2d",{willReadFrequently:!0});T.font=`${_} ${f} ${d}px ${u}`,T.textBaseline="alphabetic",T.textAlign="left",T.fillStyle="black",this.gridOuter=new Float64Array(v*v),this.gridInner=new Float64Array(v*v),this.f=new Float64Array(v),this.z=new Float64Array(v+1),this.v=new Uint16Array(v)}_createCanvas(d){const t=document.createElement("canvas");return t.width=t.height=d,t}draw(d){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:l,actualBoundingBoxLeft:u,actualBoundingBoxRight:f}=this.ctx.measureText(d),_=Math.ceil(n),v=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(f-u))),S=Math.min(this.size-this.buffer,_+Math.ceil(l)),T=v+2*this.buffer,P=S+2*this.buffer,M=Math.max(T*P,0),B=new Uint8ClampedArray(M),H={data:B,width:T,height:P,glyphWidth:v,glyphHeight:S,glyphTop:_,glyphLeft:0,glyphAdvance:t};if(v===0||S===0)return H;const{ctx:Z,buffer:X,gridInner:U,gridOuter:oe}=this;Z.clearRect(X,X,v,S),Z.fillText(d,X,X+_);const pe=Z.getImageData(X,X,v,S);oe.fill(tt,0,M),U.fill(0,0,M);for(let ee=0;ee<S;ee++)for(let le=0;le<v;le++){const _e=pe.data[4*(ee*v+le)+3]/255;if(_e===0)continue;const we=(ee+X)*T+le+X;if(_e===1)oe[we]=0,U[we]=tt;else{const Me=.5-_e;oe[we]=Me>0?Me*Me:0,U[we]=Me<0?Me*Me:0}}He(oe,0,0,T,P,T,this.f,this.v,this.z),He(U,X,X,v,S,T,this.f,this.v,this.z);for(let ee=0;ee<M;ee++){const le=Math.sqrt(oe[ee])-Math.sqrt(U[ee]);B[ee]=Math.round(255-255*(le/this.radius+this.cutoff))}return H}};class st{constructor(){this.specification=o.v.light.position}possiblyEvaluate(t,n){return o.z(t.expression.evaluate(n))}interpolate(t,n,l){return{x:o.B.number(t.x,n.x,l),y:o.B.number(t.y,n.y,l),z:o.B.number(t.z,n.z,l)}}}let jt;class At extends o.E{constructor(t){super(),jt=jt||new o.r({anchor:new o.D(o.v.light.anchor),position:new st,color:new o.D(o.v.light.color),intensity:new o.D(o.v.light.intensity)}),this._transitionable=new o.T(jt),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,n={}){if(!this._validate(o.t,t,n))for(const l in t){const u=t[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),u):this._transitionable.setValue(l,u)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,l){return(!l||l.validate!==!1)&&o.x(this,t.call(o.y,o.e({value:n,style:{glyphs:!0,sprite:!0},styleSpec:o.v})))}}class Qt{constructor(t,n){this.width=t,this.height=n,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,n){const l=t.join(",")+String(n);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(t,n)),this.dashEntry[l]}getDashRanges(t,n,l){const u=[];let f=t.length%2==1?-t[t.length-1]*l:0,_=t[0]*l,v=!0;u.push({left:f,right:_,isDash:v,zeroLength:t[0]===0});let S=t[0];for(let T=1;T<t.length;T++){v=!v;const P=t[T];f=S*l,S+=P,_=S*l,u.push({left:f,right:_,isDash:v,zeroLength:P===0})}return u}addRoundDash(t,n,l){const u=n/2;for(let f=-l;f<=l;f++){const _=this.width*(this.nextRow+l+f);let v=0,S=t[v];for(let T=0;T<this.width;T++){T/S.right>1&&(S=t[++v]);const P=Math.abs(T-S.left),M=Math.abs(T-S.right),B=Math.min(P,M);let H;const Z=f/l*(u+1);if(S.isDash){const X=u-Math.abs(Z);H=Math.sqrt(B*B+X*X)}else H=u-Math.sqrt(B*B+Z*Z);this.data[_+T]=Math.max(0,Math.min(255,H+128))}}}addRegularDash(t){for(let v=t.length-1;v>=0;--v){const S=t[v],T=t[v+1];S.zeroLength?t.splice(v,1):T&&T.isDash===S.isDash&&(T.left=S.left,t.splice(v,1))}const n=t[0],l=t[t.length-1];n.isDash===l.isDash&&(n.left=l.left-this.width,l.right=n.right+this.width);const u=this.width*this.nextRow;let f=0,_=t[f];for(let v=0;v<this.width;v++){v/_.right>1&&(_=t[++f]);const S=Math.abs(v-_.left),T=Math.abs(v-_.right),P=Math.min(S,T);this.data[u+v]=Math.max(0,Math.min(255,(_.isDash?P:-P)+128))}}addDash(t,n){const l=n?7:0,u=2*l+1;if(this.nextRow+u>this.height)return o.w("LineAtlas out of space"),null;let f=0;for(let v=0;v<t.length;v++)f+=t[v];if(f!==0){const v=this.width/f,S=this.getDashRanges(t,this.width,v);n?this.addRoundDash(S,v,l):this.addRegularDash(S)}const _={y:(this.nextRow+l+.5)/this.height,height:2*l/this.height,width:f};return this.nextRow+=u,this.dirty=!0,_}bind(t){const n=t.gl;this.texture?(n.bindTexture(n.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,n.texSubImage2D(n.TEXTURE_2D,0,0,0,this.width,this.height,n.ALPHA,n.UNSIGNED_BYTE,this.data))):(this.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texImage2D(n.TEXTURE_2D,0,n.ALPHA,this.width,this.height,0,n.ALPHA,n.UNSIGNED_BYTE,this.data))}}class Gt{constructor(t,n,l){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=l;const u=this.workerPool.acquire(l);for(let f=0;f<u.length;f++){const _=new o.C(u[f],n,l);_.name=`Worker ${f}`,this.actors.push(_)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,n,l){o.o(this.actors,(u,f)=>{u.send(t,n,f)},l=l||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(n=>{n.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}}function ft(d,t,n){const l=function(u,f){if(u)return n(u);if(f){const _=o.F(o.e(f,d),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);f.vector_layers&&(_.vectorLayers=f.vector_layers,_.vectorLayerIds=_.vectorLayers.map(v=>v.id)),n(null,_)}};return d.url?o.f(t.transformRequest(d.url,ve.Source),l):o.h.frame(()=>l(null,d))}class Oe{constructor(t,n){t&&(n?this.setSouthWest(t).setNorthEast(n):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof o.L?new o.L(t.lng,t.lat):o.L.convert(t),this}setSouthWest(t){return this._sw=t instanceof o.L?new o.L(t.lng,t.lat):o.L.convert(t),this}extend(t){const n=this._sw,l=this._ne;let u,f;if(t instanceof o.L)u=t,f=t;else{if(!(t instanceof Oe))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Oe.convert(t)):this.extend(o.L.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(o.L.convert(t)):this;if(u=t._sw,f=t._ne,!u||!f)return this}return n||l?(n.lng=Math.min(u.lng,n.lng),n.lat=Math.min(u.lat,n.lat),l.lng=Math.max(f.lng,l.lng),l.lat=Math.max(f.lat,l.lat)):(this._sw=new o.L(u.lng,u.lat),this._ne=new o.L(f.lng,f.lat)),this}getCenter(){return new o.L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new o.L(this.getWest(),this.getNorth())}getSouthEast(){return new o.L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:n,lat:l}=o.L.convert(t);let u=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&u}static convert(t){return t instanceof Oe?t:t&&new Oe(t)}static fromLngLat(t,n=0){const l=360*n/40075017,u=l/Math.cos(Math.PI/180*t.lat);return new Oe(new o.L(t.lng-u,t.lat-l),new o.L(t.lng+u,t.lat+l))}}class gt{constructor(t,n,l){this.bounds=Oe.convert(this.validateBounds(t)),this.minzoom=n||0,this.maxzoom=l||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const n=Math.pow(2,t.z),l=Math.floor(o.G(this.bounds.getWest())*n),u=Math.floor(o.H(this.bounds.getNorth())*n),f=Math.ceil(o.G(this.bounds.getEast())*n),_=Math.ceil(o.H(this.bounds.getSouth())*n);return t.x>=l&&t.x<f&&t.y>=u&&t.y<_}}class Bt extends o.E{constructor(t,n,l,u){if(super(),this.load=()=>{this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this._tileJSONRequest=ft(this._options,this.map._requestManager,(f,_)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),f?this.fire(new o.j(f)):_&&(o.e(this,_),_.bounds&&(this.tileBounds=new gt(_.bounds,this.minzoom,this.maxzoom)),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>o.e({},this._options),this.id=t,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.e(this,o.F(n,["url","scheme","tileSize","promoteId"])),this._options=o.e({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(u)}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(t,n){const l=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u={request:this.map._requestManager.transformRequest(l,ve.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function f(_,v){return delete t.request,t.aborted?n(null):_&&_.status!==404?n(_):(v&&v.resourceTiming&&(t.resourceTiming=v.resourceTiming),this.map._refreshExpiredTiles&&v&&t.setExpiryData(v),t.loadVectorData(v,this.map.painter),n(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}u.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired"?t.state==="loading"?t.reloadCallback=n:t.request=t.actor.send("reloadTile",u,f.bind(this)):(t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",u,f.bind(this)))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class wt extends o.E{constructor(t,n,l,u){super(),this.id=t,this.dispatcher=l,this.setEventedParent(u),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.e({type:"raster"},n),o.e(this,o.F(n,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this._tileJSONRequest=ft(this._options,this.map._requestManager,(t,n)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new o.j(t)):n&&(o.e(this,n),n.bounds&&(this.tileBounds=new gt(n.bounds,this.minzoom,this.maxzoom)),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}serialize(){return o.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,n){const l=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.request=xe.getImage(this.map._requestManager.transformRequest(l,ve.Tile),(u,f,_)=>{if(delete t.request,t.aborted)t.state="unloaded",n(null);else if(u)t.state="errored",n(u);else if(f){this.map._refreshExpiredTiles&&_&&t.setExpiryData(_);const v=this.map.painter.context,S=v.gl;t.texture=this.map.painter.getTileTexture(f.width),t.texture?t.texture.update(f,{useMipmap:!0}):(t.texture=new Ce(v,f,S.RGBA,{useMipmap:!0}),t.texture.bind(S.LINEAR,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST),v.extTextureFilterAnisotropic&&S.texParameterf(S.TEXTURE_2D,v.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,v.extTextureFilterAnisotropicMax)),t.state="loaded",n(null)}},this.map._refreshExpiredTiles)}abortTile(t,n){t.request&&(t.request.cancel(),delete t.request),n()}unloadTile(t,n){t.texture&&this.map.painter.saveTileTexture(t.texture),n()}hasTransition(){return!1}}class $t extends wt{constructor(t,n,l,u){super(t,n,l,u),this.type="raster-dem",this.maxzoom=22,this._options=o.e({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox",this.redFactor=n.redFactor,this.greenFactor=n.greenFactor,this.blueFactor=n.blueFactor,this.baseShift=n.baseShift}loadTile(t,n){const l=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u=this.map._requestManager.transformRequest(l,ve.Tile);function f(_,v){_&&(t.state="errored",n(_)),v&&(t.dem=v,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded",n(null))}t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.request=xe.getImage(u,(_,v,S)=>o._(this,void 0,void 0,function*(){if(delete t.request,t.aborted)t.state="unloaded",n(null);else if(_)t.state="errored",n(_);else if(v){this.map._refreshExpiredTiles&&t.setExpiryData(S);const T=o.a(v)&&o.J()?v:yield function(M){return o._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&o.K()){const B=M.width+2,H=M.height+2;try{return new o.R({width:B,height:H},yield o.M(M,-1,-1,B,H))}catch{}}return o.h.getImageData(M,1)})}(v),P={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:T,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};t.actor&&t.state!=="expired"||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",P,f))}}),this.map._refreshExpiredTiles)}_getNeighboringTiles(t){const n=t.canonical,l=Math.pow(2,n.z),u=(n.x-1+l)%l,f=n.x===0?t.wrap-1:t.wrap,_=(n.x+1+l)%l,v=n.x+1===l?t.wrap+1:t.wrap,S={};return S[new o.O(t.overscaledZ,f,n.z,u,n.y).key]={backfilled:!1},S[new o.O(t.overscaledZ,v,n.z,_,n.y).key]={backfilled:!1},n.y>0&&(S[new o.O(t.overscaledZ,f,n.z,u,n.y-1).key]={backfilled:!1},S[new o.O(t.overscaledZ,t.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},S[new o.O(t.overscaledZ,v,n.z,_,n.y-1).key]={backfilled:!1}),n.y+1<l&&(S[new o.O(t.overscaledZ,f,n.z,u,n.y+1).key]={backfilled:!1},S[new o.O(t.overscaledZ,t.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},S[new o.O(t.overscaledZ,v,n.z,_,n.y+1).key]={backfilled:!1}),S}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})}}class Yt extends o.E{constructor(t,n,l,u){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>o.e({},this._options,{type:this.type,data:this._data}),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=l.getActor(),this.setEventedParent(u),this._data=n.data,this._options=o.e({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const f=o.N/this.tileSize;this.workerOptions=o.e({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*f,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*f,extent:o.N,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:o.N,radius:(n.clusterRadius||50)*f,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=t.clusterRadius),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=t.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(t,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},n),this}getClusterChildren(t,n){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},n),this}getClusterLeaves(t,n,l,u){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:n,offset:l},u),this}_updateWorkerData(t){const n=o.e({},this.workerOptions);t?n.dataDiff=t:typeof this._data=="string"?(n.request=this.map._requestManager.transformRequest(o.h.resolveURL(this._data),ve.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new o.k("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,n,(l,u)=>{if(this._pendingLoads--,this._removed||u&&u.abandoned)return void this.fire(new o.k("dataabort",{dataType:"source"}));let f=null;if(u&&u.resourceTiming&&u.resourceTiming[this.id]&&(f=u.resourceTiming[this.id].slice(0)),l)return void this.fire(new o.j(l));const _={dataType:"source"};this._collectResourceTiming&&f&&f.length>0&&o.e(_,{resourceTiming:f}),this.fire(new o.k("data",Object.assign(Object.assign({},_),{sourceDataType:"metadata"}))),this.fire(new o.k("data",Object.assign(Object.assign({},_),{sourceDataType:"content"})))})}loaded(){return this._pendingLoads===0}loadTile(t,n){const l=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const u={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.request=this.actor.send(l,u,(f,_)=>(delete t.request,t.unloadVectorData(),t.aborted?n(null):f?n(f):(t.loadVectorData(_,this.map.painter,l==="reloadTile"),n(null))))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var ei=o.Q([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class kt extends o.E{constructor(t,n,l,u){super(),this.load=(f,_)=>{this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=xe.getImage(this.map._requestManager.transformRequest(this.url,ve.Image),(v,S)=>{this._request=null,this._loaded=!0,v?this.fire(new o.j(v)):S&&(this.image=S,f&&(this.coordinates=f),_&&_(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;const f=this.map.painter.context,_=f.gl;this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,ei.members)),this.boundsSegments||(this.boundsSegments=o.S.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Ce(f,this.image,_.RGBA),this.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE));let v=!1;for(const S in this.tiles){const T=this.tiles[S];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture,v=!0)}v&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=t,this.dispatcher=l,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(u),this.options=n}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(t){this.coordinates=t;const n=t.map(o.U.fromLngLat);this.tileID=function(u){let f=1/0,_=1/0,v=-1/0,S=-1/0;for(const B of u)f=Math.min(f,B.x),_=Math.min(_,B.y),v=Math.max(v,B.x),S=Math.max(S,B.y);const T=Math.max(v-f,S-_),P=Math.max(0,Math.floor(-Math.log(T)/Math.LN2)),M=Math.pow(2,P);return new o.W(P,Math.floor((f+v)/2*M),Math.floor((_+S)/2*M))}(n),this.minzoom=this.maxzoom=this.tileID.z;const l=n.map(u=>this.tileID.getTilePoint(u)._round());return this._boundsArray=new o.V,this._boundsArray.emplaceBack(l[0].x,l[0].y,0,0),this._boundsArray.emplaceBack(l[1].x,l[1].y,o.N,0),this._boundsArray.emplaceBack(l[3].x,l[3].y,0,o.N),this._boundsArray.emplaceBack(l[2].x,l[2].y,o.N,o.N),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(t,n){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},n(null)):(t.state="errored",n(null))}hasTransition(){return!1}}class gi extends kt{constructor(t,n,l,u){super(t,n,l,u),this.load=()=>{this._loaded=!1;const f=this.options;this.urls=[];for(const _ of f.urls)this.urls.push(this.map._requestManager.transformRequest(_,ve.Source).url);o.X(this.urls,(_,v)=>{this._loaded=!0,_?this.fire(new o.j(_)):v&&(this.video=v,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const f=this.map.painter.context,_=f.gl;this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,ei.members)),this.boundsSegments||(this.boundsSegments=o.S.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE),_.texSubImage2D(_.TEXTURE_2D,0,0,0,_.RGBA,_.UNSIGNED_BYTE,this.video)):(this.texture=new Ce(f,this.video,_.RGBA),this.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE));let v=!1;for(const S in this.tiles){const T=this.tiles[S];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture,v=!0)}v&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=n}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const n=this.video.seekable;t<n.start(0)||t>n.end(0)?this.fire(new o.j(new o.Y(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class pi extends kt{constructor(t,n,l,u){super(t,n,l,u),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const _=this.map.painter.context,v=_.gl;this.boundsBuffer||(this.boundsBuffer=_.createVertexBuffer(this._boundsArray,ei.members)),this.boundsSegments||(this.boundsSegments=o.S.simpleSegment(0,0,4,2)),this.texture?(f||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Ce(_,this.canvas,v.RGBA,{premultiply:!0});let S=!1;for(const T in this.tiles){const P=this.tiles[T];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture,S=!0)}S&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(f=>!Array.isArray(f)||f.length!==2||f.some(_=>typeof _!="number"))||this.fire(new o.j(new o.Y(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.j(new o.Y(`sources.${t}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new o.j(new o.Y(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new o.j(new o.Y(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.j(new o.Y(`sources.${t}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const Pt={},li=d=>{switch(d){case"geojson":return Yt;case"image":return kt;case"raster":return wt;case"raster-dem":return $t;case"vector":return Bt;case"video":return gi;case"canvas":return pi}return Pt[d]};function Xi(d,t){const n=o.Z();return o.$(n,n,[1,1,0]),o.a0(n,n,[.5*d.width,.5*d.height,1]),o.a1(n,n,d.calculatePosMatrix(t.toUnwrapped()))}function Ht(d,t,n,l,u,f){const _=function(M,B,H){if(M)for(const Z of M){const X=B[Z];if(X&&X.source===H&&X.type==="fill-extrusion")return!0}else for(const Z in B){const X=B[Z];if(X.source===H&&X.type==="fill-extrusion")return!0}return!1}(u&&u.layers,t,d.id),v=f.maxPitchScaleFactor(),S=d.tilesIn(l,v,_);S.sort(Mi);const T=[];for(const M of S)T.push({wrappedTileID:M.tileID.wrapped().key,queryResults:M.tile.queryRenderedFeatures(t,n,d._state,M.queryGeometry,M.cameraQueryGeometry,M.scale,u,f,v,Xi(d.transform,M.tileID))});const P=function(M){const B={},H={};for(const Z of M){const X=Z.queryResults,U=Z.wrappedTileID,oe=H[U]=H[U]||{};for(const pe in X){const ee=X[pe],le=oe[pe]=oe[pe]||{},_e=B[pe]=B[pe]||[];for(const we of ee)le[we.featureIndex]||(le[we.featureIndex]=!0,_e.push(we))}}return B}(T);for(const M in P)P[M].forEach(B=>{const H=B.feature,Z=d.getFeatureState(H.layer["source-layer"],H.id);H.source=H.layer.source,H.layer["source-layer"]&&(H.sourceLayer=H.layer["source-layer"]),H.state=Z});return P}function Mi(d,t){const n=d.tileID,l=t.tileID;return n.overscaledZ-l.overscaledZ||n.canonical.y-l.canonical.y||n.wrap-l.wrap||n.canonical.x-l.canonical.x}class Fi{constructor(t,n){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=o.a2(),this.uses=0,this.tileSize=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const n=t+this.timeAdded;n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,n,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(u,f){const _={};if(!f)return _;for(const v of u){const S=v.layerIds.map(T=>f.getLayer(T)).filter(Boolean);if(S.length!==0){v.layers=S,v.stateDependentLayerIds&&(v.stateDependentLayers=v.stateDependentLayerIds.map(T=>S.filter(P=>P.id===T)[0]));for(const T of S)_[T.id]=v}}return _}(t.buckets,n.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const f=this.buckets[u];if(f instanceof o.a4){if(this.hasSymbolBuckets=!0,!l)break;f.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const f=this.buckets[u];if(f instanceof o.a4&&f.hasRTLText){this.hasRTLText=!0,o.a5();break}}this.queryPadding=0;for(const u in this.buckets){const f=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(u).queryRadius(f))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new o.a3}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const l in this.buckets){const u=this.buckets[l];u.uploadPending()&&u.upload(t)}const n=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Ce(t,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Ce(t,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,n,l,u,f,_,v,S,T,P){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:u,cameraQueryGeometry:f,scale:_,tileSize:this.tileSize,pixelPosMatrix:P,transform:S,params:v,queryPadding:this.queryPadding*T},t,n,l):{}}querySourceFeatures(t,n){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const u=l.loadVTLayers(),f=n&&n.sourceLayer?n.sourceLayer:"",_=u._geojsonTileLayer||u[f];if(!_)return;const v=o.a6(n&&n.filter),{z:S,x:T,y:P}=this.tileID.canonical,M={z:S,x:T,y:P};for(let B=0;B<_.length;B++){const H=_.feature(B);if(v.needGeometry){const U=o.a7(H,!0);if(!v.filter(new o.a8(this.tileID.overscaledZ),U,this.tileID.canonical))continue}else if(!v.filter(new o.a8(this.tileID.overscaledZ),H))continue;const Z=l.getId(H,f),X=new o.a9(H,S,T,P,Z);X.tile=M,t.push(X)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const n=this.expirationTime;if(t.cacheControl){const l=o.aa(t.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const l=Date.now();let u=!1;if(this.expirationTime>l)u=!1;else if(n)if(this.expirationTime<n)u=!0;else{const f=this.expirationTime-n;f?this.expirationTime=l+Math.max(f,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const l=this.latestFeatureIndex.loadVTLayers();for(const u in this.buckets){if(!n.style.hasLayer(u))continue;const f=this.buckets[u],_=f.layers[0].sourceLayer||"_geojsonTileLayer",v=l[_],S=t[_];if(!v||!S||Object.keys(S).length===0)continue;f.update(S,v,this.imageAtlas&&this.imageAtlas.patternPositions||{});const T=n&&n.style&&n.style.getLayer(u);T&&(this.queryPadding=Math.max(this.queryPadding,T.queryRadius(f)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.h.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=o.h.now()+t}setDependencies(t,n){const l={};for(const u of n)l[u]=!0;this.dependencies[t]=l}hasDependency(t,n){for(const l of t){const u=this.dependencies[l];if(u){for(const f of n)if(u[f])return!0}}return!1}}class gr{constructor(t,n){this.max=t,this.onRemove=n,this.reset()}reset(){for(const t in this.data)for(const n of this.data[t])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(t,n,l){const u=t.wrapped().key;this.data[u]===void 0&&(this.data[u]=[]);const f={value:n,timeout:void 0};if(l!==void 0&&(f.timeout=setTimeout(()=>{this.remove(t,f)},l)),this.data[u].push(f),this.order.push(u),this.order.length>this.max){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const n=this.data[t].shift();return n.timeout&&clearTimeout(n.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),n.value}getByKey(t){const n=this.data[t];return n?n[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,n){if(!this.has(t))return this;const l=t.wrapped().key,u=n===void 0?0:this.data[l].indexOf(n),f=this.data[l][u];return this.data[l].splice(u,1),f.timeout&&clearTimeout(f.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(f.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(t){const n=[];for(const l in this.data)for(const u of this.data[l])t(u.value)||n.push(u);for(const l of n)this.remove(l.value.tileID,l)}}class Te{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,n,l){const u=String(n);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][u]=this.stateChanges[t][u]||{},o.e(this.stateChanges[t][u],l),this.deletedStates[t]===null){this.deletedStates[t]={};for(const f in this.state[t])f!==u&&(this.deletedStates[t][f]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][u]===null){this.deletedStates[t][u]={};for(const f in this.state[t][u])l[f]||(this.deletedStates[t][u][f]=null)}else for(const f in l)this.deletedStates[t]&&this.deletedStates[t][u]&&this.deletedStates[t][u][f]===null&&delete this.deletedStates[t][u][f]}removeFeatureState(t,n,l){if(this.deletedStates[t]===null)return;const u=String(n);if(this.deletedStates[t]=this.deletedStates[t]||{},l&&n!==void 0)this.deletedStates[t][u]!==null&&(this.deletedStates[t][u]=this.deletedStates[t][u]||{},this.deletedStates[t][u][l]=null);else if(n!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][u])for(l in this.deletedStates[t][u]={},this.stateChanges[t][u])this.deletedStates[t][u][l]=null;else this.deletedStates[t][u]=null;else this.deletedStates[t]=null}getState(t,n){const l=String(n),u=o.e({},(this.state[t]||{})[l],(this.stateChanges[t]||{})[l]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const f=this.deletedStates[t][n];if(f===null)return{};for(const _ in f)delete u[_]}return u}initializeTileState(t,n){t.setFeatureState(this.state,n)}coalesceChanges(t,n){const l={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const f={};for(const _ in this.stateChanges[u])this.state[u][_]||(this.state[u][_]={}),o.e(this.state[u][_],this.stateChanges[u][_]),f[_]=this.state[u][_];l[u]=f}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const f={};if(this.deletedStates[u]===null)for(const _ in this.state[u])f[_]={},this.state[u][_]={};else for(const _ in this.deletedStates[u]){if(this.deletedStates[u][_]===null)this.state[u][_]={};else for(const v of Object.keys(this.deletedStates[u][_]))delete this.state[u][_][v];f[_]=this.state[u][_]}l[u]=l[u]||{},o.e(l[u],f)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(const u in t)t[u].setFeatureState(l,n)}}class bi extends o.E{constructor(t,n,l){super(),this.id=t,this.dispatcher=l,this.on("data",u=>{u.dataType==="source"&&u.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&u.dataType==="source"&&u.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((u,f,_,v)=>{const S=new(li(f.type))(u,f,_,v);if(S.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${S.id}`);return S})(t,n,l,this),this._tiles={},this._cache=new gr(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Te,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const n=this._tiles[t];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,n){return this._source.loadTile(t,n)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){this._source.abortTile&&this._source.abortTile(t,()=>{}),this._source.fire(new o.k("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const l=this._tiles[n];l.upload(t),l.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(Li).map(t=>t.key)}getRenderableIds(t){const n=[];for(const l in this._tiles)this._isIdRenderable(l,t)&&n.push(this._tiles[l]);return t?n.sort((l,u)=>{const f=l.tileID,_=u.tileID,v=new o.P(f.canonical.x,f.canonical.y)._rotate(this.transform.angle),S=new o.P(_.canonical.x,_.canonical.y)._rotate(this.transform.angle);return f.overscaledZ-_.overscaledZ||S.y-v.y||S.x-v.x}).map(l=>l.tileID.key):n.map(l=>l.tileID).sort(Li).map(l=>l.key)}hasRenderableParent(t){const n=this.findLoadedParent(t,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(t,n){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(n||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,n){const l=this._tiles[t];l&&(l.state!=="loading"&&(l.state=n),this._loadTile(l,this._tileLoaded.bind(this,l,t,n)))}_tileLoaded(t,n,l,u){if(u)return t.state="errored",void(u.status!==404?this._source.fire(new o.j(u,{tile:t})):this.update(this.transform,this.terrain));t.timeAdded=o.h.now(),l==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(n,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new o.k("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const n=this.getRenderableIds();for(let u=0;u<n.length;u++){const f=n[u];if(t.neighboringTiles&&t.neighboringTiles[f]){const _=this.getTileByID(f);l(t,_),l(_,t)}}function l(u,f){u.needsHillshadePrepare=!0,u.needsTerrainPrepare=!0;let _=f.tileID.canonical.x-u.tileID.canonical.x;const v=f.tileID.canonical.y-u.tileID.canonical.y,S=Math.pow(2,u.tileID.canonical.z),T=f.tileID.key;_===0&&v===0||Math.abs(v)>1||(Math.abs(_)>1&&(Math.abs(_+S)===1?_+=S:Math.abs(_-S)===1&&(_-=S)),f.dem&&u.dem&&(u.dem.backfillBorder(f.dem,_,v),u.neighboringTiles&&u.neighboringTiles[T]&&(u.neighboringTiles[T].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,n,l,u){for(const f in this._tiles){let _=this._tiles[f];if(u[f]||!_.hasData()||_.tileID.overscaledZ<=n||_.tileID.overscaledZ>l)continue;let v=_.tileID;for(;_&&_.tileID.overscaledZ>n+1;){const T=_.tileID.scaledTo(_.tileID.overscaledZ-1);_=this._tiles[T.key],_&&_.hasData()&&(v=T)}let S=v;for(;S.overscaledZ>n;)if(S=S.scaledTo(S.overscaledZ-1),t[S.key]){u[v.key]=v;break}}}findLoadedParent(t,n){if(t.key in this._loadedParentTiles){const l=this._loadedParentTiles[t.key];return l&&l.tileID.overscaledZ>=n?l:null}for(let l=t.overscaledZ-1;l>=n;l--){const u=t.scaledTo(l),f=this._getLoadedTile(u);if(f)return f}}_getLoadedTile(t){const n=this._tiles[t.key];return n&&n.hasData()?n:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const n=Math.ceil(t.width/this._source.tileSize)+1,l=Math.ceil(t.height/this._source.tileSize)+1,u=Math.floor(n*l*(this._maxTileCacheZoomLevels===null?o.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),f=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,u):u;this._cache.setMaxSize(f)}handleWrapJump(t){const n=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,n){const l={};for(const u in this._tiles){const f=this._tiles[u];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+n),l[f.tileID.key]=f}this._tiles=l;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(u,this._tiles[u])}}update(t,n){if(this.transform=t,this.terrain=n,!this._sourceLoaded||this._paused)return;let l;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(P=>new o.O(P.canonical.z,P.wrap,P.canonical.z,P.canonical.x,P.canonical.y)):(l=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:n}),this._source.hasTile&&(l=l.filter(P=>this._source.hasTile(P)))):l=[];const u=t.coveringZoomLevel(this._source),f=Math.max(u-bi.maxOverzooming,this._source.minzoom),_=Math.max(u+bi.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const P={};for(const M of l)if(M.canonical.z>this._source.minzoom){const B=M.scaledTo(M.canonical.z-1);P[B.key]=B;const H=M.scaledTo(Math.max(this._source.minzoom,Math.min(M.canonical.z,5)));P[H.key]=H}l=l.concat(Object.values(P))}const v=l.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,v&&this.fire(new o.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const S=this._updateRetainedTiles(l,u);if(Wt(this._source.type)){const P={},M={},B=Object.keys(S),H=o.h.now();for(const Z of B){const X=S[Z],U=this._tiles[Z];if(!U||U.fadeEndTime!==0&&U.fadeEndTime<=H)continue;const oe=this.findLoadedParent(X,f);oe&&(this._addTile(oe.tileID),P[oe.tileID.key]=oe.tileID),M[Z]=X}this._retainLoadedChildren(M,u,_,S);for(const Z in P)S[Z]||(this._coveredTiles[Z]=!0,S[Z]=P[Z]);if(n){const Z={},X={};for(const U of l)this._tiles[U.key].hasData()?Z[U.key]=U:X[U.key]=U;for(const U in X){const oe=X[U].children(this._source.maxzoom);this._tiles[oe[0].key]&&this._tiles[oe[1].key]&&this._tiles[oe[2].key]&&this._tiles[oe[3].key]&&(Z[oe[0].key]=S[oe[0].key]=oe[0],Z[oe[1].key]=S[oe[1].key]=oe[1],Z[oe[2].key]=S[oe[2].key]=oe[2],Z[oe[3].key]=S[oe[3].key]=oe[3],delete X[U])}for(const U in X){const oe=this.findLoadedParent(X[U],this._source.minzoom);if(oe){Z[oe.tileID.key]=S[oe.tileID.key]=oe.tileID;for(const pe in Z)Z[pe].isChildOf(oe.tileID)&&delete Z[pe]}}for(const U in this._tiles)Z[U]||(this._coveredTiles[U]=!0)}}for(const P in S)this._tiles[P].clearFadeHold();const T=o.ab(this._tiles,S);for(const P of T){const M=this._tiles[P];M.hasSymbolBuckets&&!M.holdingForFade()?M.setHoldDuration(this.map._fadeDuration):M.hasSymbolBuckets&&!M.symbolFadeFinished()||this._removeTile(P)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,n){const l={},u={},f=Math.max(n-bi.maxOverzooming,this._source.minzoom),_=Math.max(n+bi.maxUnderzooming,this._source.minzoom),v={};for(const S of t){const T=this._addTile(S);l[S.key]=S,T.hasData()||n<this._source.maxzoom&&(v[S.key]=S)}this._retainLoadedChildren(v,n,_,l);for(const S of t){let T=this._tiles[S.key];if(T.hasData())continue;if(n+1>this._source.maxzoom){const M=S.children(this._source.maxzoom)[0],B=this.getTile(M);if(B&&B.hasData()){l[M.key]=M;continue}}else{const M=S.children(this._source.maxzoom);if(l[M[0].key]&&l[M[1].key]&&l[M[2].key]&&l[M[3].key])continue}let P=T.wasRequested();for(let M=S.overscaledZ-1;M>=f;--M){const B=S.scaledTo(M);if(u[B.key])break;if(u[B.key]=!0,T=this.getTile(B),!T&&P&&(T=this._addTile(B)),T){const H=T.hasData();if((P||H)&&(l[B.key]=B),P=T.wasRequested(),H)break}}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const n=[];let l,u=this._tiles[t].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){l=this._loadedParentTiles[u.key];break}n.push(u.key);const f=u.scaledTo(u.overscaledZ-1);if(l=this._getLoadedTile(f),l)break;u=f}for(const f of n)this._loadedParentTiles[f]=l}}_addTile(t){let n=this._tiles[t.key];if(n)return n;n=this._cache.getAndRemove(t),n&&(this._setTileReloadTimer(t.key,n),n.tileID=t,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,n)));const l=n;return n||(n=new Fi(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(n,this._tileLoaded.bind(this,n,t.key,n.state))),n.uses++,this._tiles[t.key]=n,l||this._source.fire(new o.k("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(t,n){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const l=n.getExpiryTimeout();l&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},l))}_removeTile(t){const n=this._tiles[t];n&&(n.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,n,l){const u=[],f=this.transform;if(!f)return u;const _=l?f.getCameraQueryGeometry(t):t,v=t.map(Z=>f.pointCoordinate(Z,this.terrain)),S=_.map(Z=>f.pointCoordinate(Z,this.terrain)),T=this.getIds();let P=1/0,M=1/0,B=-1/0,H=-1/0;for(const Z of S)P=Math.min(P,Z.x),M=Math.min(M,Z.y),B=Math.max(B,Z.x),H=Math.max(H,Z.y);for(let Z=0;Z<T.length;Z++){const X=this._tiles[T[Z]];if(X.holdingForFade())continue;const U=X.tileID,oe=Math.pow(2,f.zoom-X.tileID.overscaledZ),pe=n*X.queryPadding*o.N/X.tileSize/oe,ee=[U.getTilePoint(new o.U(P,M)),U.getTilePoint(new o.U(B,H))];if(ee[0].x-pe<o.N&&ee[0].y-pe<o.N&&ee[1].x+pe>=0&&ee[1].y+pe>=0){const le=v.map(we=>U.getTilePoint(we)),_e=S.map(we=>U.getTilePoint(we));u.push({tile:X,tileID:U,queryGeometry:le,cameraQueryGeometry:_e,scale:oe})}}return u}getVisibleCoordinates(t){const n=this.getRenderableIds(t).map(l=>this._tiles[l].tileID);for(const l of n)l.posMatrix=this.transform.calculatePosMatrix(l.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(Wt(this._source.type)){const t=o.h.now();for(const n in this._tiles)if(this._tiles[n].fadeEndTime>=t)return!0}return!1}setFeatureState(t,n,l){this._state.updateState(t=t||"_geojsonTileLayer",n,l)}removeFeatureState(t,n,l){this._state.removeFeatureState(t=t||"_geojsonTileLayer",n,l)}getFeatureState(t,n){return this._state.getState(t=t||"_geojsonTileLayer",n)}setDependencies(t,n,l){const u=this._tiles[t];u&&u.setDependencies(n,l)}reloadTilesForDependencies(t,n){for(const l in this._tiles)this._tiles[l].hasDependency(t,n)&&this._reloadTile(l,"reloading");this._cache.filter(l=>!l.hasDependency(t,n))}}function Li(d,t){const n=Math.abs(2*d.wrap)-+(d.wrap<0),l=Math.abs(2*t.wrap)-+(t.wrap<0);return d.overscaledZ-t.overscaledZ||l-n||t.canonical.y-d.canonical.y||t.canonical.x-d.canonical.x}function Wt(d){return d==="raster"||d==="image"||d==="video"}bi.maxOverzooming=10,bi.maxUnderzooming=3;const Ft="mapboxgl_preloaded_worker_pool";class Gi{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Gi.workerCount;)this.workers.push(new Worker(o.c.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ft]}numActive(){return Object.keys(this.active).length}}const Ki=Math.floor(o.h.hardwareConcurrency/2);let yi;function cn(){return yi||(yi=new Gi),yi}Gi.workerCount=o.ac(globalThis)?Math.max(Math.min(Ki,3),1):1;class or{constructor(t,n){this.reset(t,n)}reset(t,n){this.points=t||[],this._distances=[0];for(let l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=o.ad(t,0,1);let n=1,l=this._distances[n];const u=t*this.paddedLength+this.padding;for(;l<u&&n<this._distances.length;)l=this._distances[++n];const f=n-1,_=this._distances[f],v=l-_,S=v>0?(u-_)/v:0;return this.points[f].mult(1-S).add(this.points[n].mult(S))}}function ar(d,t){let n=!0;return d==="always"||d!=="never"&&t!=="never"||(n=!1),n}class qr{constructor(t,n,l){const u=this.boxCells=[],f=this.circleCells=[];this.xCellCount=Math.ceil(t/l),this.yCellCount=Math.ceil(n/l);for(let _=0;_<this.xCellCount*this.yCellCount;_++)u.push([]),f.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=n,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,n,l,u,f){this._forEachCell(n,l,u,f,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(l),this.bboxes.push(u),this.bboxes.push(f)}insertCircle(t,n,l,u){this._forEachCell(n-u,l-u,n+u,l+u,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(n),this.circles.push(l),this.circles.push(u)}_insertBoxCell(t,n,l,u,f,_){this.boxCells[f].push(_)}_insertCircleCell(t,n,l,u,f,_){this.circleCells[f].push(_)}_query(t,n,l,u,f,_,v){if(l<0||t>this.width||u<0||n>this.height)return[];const S=[];if(t<=0&&n<=0&&this.width<=l&&this.height<=u){if(f)return[{key:null,x1:t,y1:n,x2:l,y2:u}];for(let T=0;T<this.boxKeys.length;T++)S.push({key:this.boxKeys[T],x1:this.bboxes[4*T],y1:this.bboxes[4*T+1],x2:this.bboxes[4*T+2],y2:this.bboxes[4*T+3]});for(let T=0;T<this.circleKeys.length;T++){const P=this.circles[3*T],M=this.circles[3*T+1],B=this.circles[3*T+2];S.push({key:this.circleKeys[T],x1:P-B,y1:M-B,x2:P+B,y2:M+B})}}else this._forEachCell(t,n,l,u,this._queryCell,S,{hitTest:f,overlapMode:_,seenUids:{box:{},circle:{}}},v);return S}query(t,n,l,u){return this._query(t,n,l,u,!1,null)}hitTest(t,n,l,u,f,_){return this._query(t,n,l,u,!0,f,_).length>0}hitTestCircle(t,n,l,u,f){const _=t-l,v=t+l,S=n-l,T=n+l;if(v<0||_>this.width||T<0||S>this.height)return!1;const P=[];return this._forEachCell(_,S,v,T,this._queryCellCircle,P,{hitTest:!0,overlapMode:u,circle:{x:t,y:n,radius:l},seenUids:{box:{},circle:{}}},f),P.length>0}_queryCell(t,n,l,u,f,_,v,S){const{seenUids:T,hitTest:P,overlapMode:M}=v,B=this.boxCells[f];if(B!==null){const Z=this.bboxes;for(const X of B)if(!T.box[X]){T.box[X]=!0;const U=4*X,oe=this.boxKeys[X];if(t<=Z[U+2]&&n<=Z[U+3]&&l>=Z[U+0]&&u>=Z[U+1]&&(!S||S(oe))&&(!P||!ar(M,oe.overlapMode))&&(_.push({key:oe,x1:Z[U],y1:Z[U+1],x2:Z[U+2],y2:Z[U+3]}),P))return!0}}const H=this.circleCells[f];if(H!==null){const Z=this.circles;for(const X of H)if(!T.circle[X]){T.circle[X]=!0;const U=3*X,oe=this.circleKeys[X];if(this._circleAndRectCollide(Z[U],Z[U+1],Z[U+2],t,n,l,u)&&(!S||S(oe))&&(!P||!ar(M,oe.overlapMode))){const pe=Z[U],ee=Z[U+1],le=Z[U+2];if(_.push({key:oe,x1:pe-le,y1:ee-le,x2:pe+le,y2:ee+le}),P)return!0}}}return!1}_queryCellCircle(t,n,l,u,f,_,v,S){const{circle:T,seenUids:P,overlapMode:M}=v,B=this.boxCells[f];if(B!==null){const Z=this.bboxes;for(const X of B)if(!P.box[X]){P.box[X]=!0;const U=4*X,oe=this.boxKeys[X];if(this._circleAndRectCollide(T.x,T.y,T.radius,Z[U+0],Z[U+1],Z[U+2],Z[U+3])&&(!S||S(oe))&&!ar(M,oe.overlapMode))return _.push(!0),!0}}const H=this.circleCells[f];if(H!==null){const Z=this.circles;for(const X of H)if(!P.circle[X]){P.circle[X]=!0;const U=3*X,oe=this.circleKeys[X];if(this._circlesCollide(Z[U],Z[U+1],Z[U+2],T.x,T.y,T.radius)&&(!S||S(oe))&&!ar(M,oe.overlapMode))return _.push(!0),!0}}}_forEachCell(t,n,l,u,f,_,v,S){const T=this._convertToXCellCoord(t),P=this._convertToYCellCoord(n),M=this._convertToXCellCoord(l),B=this._convertToYCellCoord(u);for(let H=T;H<=M;H++)for(let Z=P;Z<=B;Z++)if(f.call(this,t,n,l,u,this.xCellCount*Z+H,_,v,S))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,n,l,u,f,_){const v=u-t,S=f-n,T=l+_;return T*T>v*v+S*S}_circleAndRectCollide(t,n,l,u,f,_,v){const S=(_-u)/2,T=Math.abs(t-(u+S));if(T>S+l)return!1;const P=(v-f)/2,M=Math.abs(n-(f+P));if(M>P+l)return!1;if(T<=S||M<=P)return!0;const B=T-S,H=M-P;return B*B+H*H<=l*l}}function Ve(d,t,n,l,u){const f=o.Z();return t?(o.a0(f,f,[1/u,1/u,1]),n||o.ae(f,f,l.angle)):o.a1(f,l.labelPlaneMatrix,d),f}function Et(d,t,n,l,u){if(t){const f=o.af(d);return o.a0(f,f,[u,u,1]),n||o.ae(f,f,-l.angle),f}return l.glCoordMatrix}function St(d,t,n){let l;n?(l=[d.x,d.y,n(d.x,d.y),1],o.ag(l,l,t)):(l=[d.x,d.y,0,1],K(l,l,t));const u=l[3];return{point:new o.P(l[0]/u,l[1]/u),signedDistanceFromCamera:u}}function Jt(d,t){return .5+d/t*.5}function zt(d,t){const n=d[0]/d[3],l=d[1]/d[3];return n>=-t[0]&&n<=t[0]&&l>=-t[1]&&l<=t[1]}function Le(d,t,n,l,u,f,_,v,S,T){const P=l?d.textSizeData:d.iconSizeData,M=o.ah(P,n.transform.zoom),B=[256/n.width*2+1,256/n.height*2+1],H=l?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;H.clear();const Z=d.lineVertexArray,X=l?d.text.placedSymbolArray:d.icon.placedSymbolArray,U=n.transform.width/n.transform.height;let oe=!1;for(let pe=0;pe<X.length;pe++){const ee=X.get(pe);if(ee.hidden||ee.writingMode===o.ai.vertical&&!oe){j(ee.numGlyphs,H);continue}let le;if(oe=!1,T?(le=[ee.anchorX,ee.anchorY,T(ee.anchorX,ee.anchorY),1],o.ag(le,le,t)):(le=[ee.anchorX,ee.anchorY,0,1],K(le,le,t)),!zt(le,B)){j(ee.numGlyphs,H);continue}const _e=Jt(n.transform.cameraToCenterDistance,le[3]),we=o.aj(P,M,ee),Me=_?we/_e:we*_e,Fe=new o.P(ee.anchorX,ee.anchorY),Re=St(Fe,u,T).point,Ue={projections:{},offsets:{}},lt=wi(ee,Me,!1,v,t,u,f,d.glyphOffsetArray,Z,H,Re,Fe,Ue,U,S,T);oe=lt.useVertical,(lt.notEnoughRoom||oe||lt.needsFlipping&&wi(ee,Me,!0,v,t,u,f,d.glyphOffsetArray,Z,H,Re,Fe,Ue,U,S,T).notEnoughRoom)&&j(ee.numGlyphs,H)}l?d.text.dynamicLayoutVertexBuffer.updateData(H):d.icon.dynamicLayoutVertexBuffer.updateData(H)}function mt(d,t,n,l,u,f,_,v,S,T,P,M,B){const H=v.glyphStartIndex+v.numGlyphs,Z=v.lineStartIndex,X=v.lineStartIndex+v.lineLength,U=t.getoffsetX(v.glyphStartIndex),oe=t.getoffsetX(H-1),pe=D(d*U,n,l,u,f,_,v.segment,Z,X,S,T,P,M,B);if(!pe)return null;const ee=D(d*oe,n,l,u,f,_,v.segment,Z,X,S,T,P,M,B);return ee?{first:pe,last:ee}:null}function vt(d,t,n,l){return d===o.ai.horizontal&&Math.abs(n.y-t.y)>Math.abs(n.x-t.x)*l?{useVertical:!0}:(d===o.ai.vertical?t.y<n.y:t.x>n.x)?{needsFlipping:!0}:null}function wi(d,t,n,l,u,f,_,v,S,T,P,M,B,H,Z,X){const U=t/24,oe=d.lineOffsetX*U,pe=d.lineOffsetY*U;let ee;if(d.numGlyphs>1){const le=d.glyphStartIndex+d.numGlyphs,_e=d.lineStartIndex,we=d.lineStartIndex+d.lineLength,Me=mt(U,v,oe,pe,n,P,M,d,S,f,B,Z,X);if(!Me)return{notEnoughRoom:!0};const Fe=St(Me.first.point,_,X).point,Re=St(Me.last.point,_,X).point;if(l&&!n){const Ue=vt(d.writingMode,Fe,Re,H);if(Ue)return Ue}ee=[Me.first];for(let Ue=d.glyphStartIndex+1;Ue<le-1;Ue++)ee.push(D(U*v.getoffsetX(Ue),oe,pe,n,P,M,d.segment,_e,we,S,f,B,Z,X));ee.push(Me.last)}else{if(l&&!n){const _e=St(M,u,X).point,we=d.lineStartIndex+d.segment+1,Me=new o.P(S.getx(we),S.gety(we)),Fe=St(Me,u,X),Re=Fe.signedDistanceFromCamera>0?Fe.point:Zi(M,Me,_e,1,u,X),Ue=vt(d.writingMode,_e,Re,H);if(Ue)return Ue}const le=D(U*v.getoffsetX(d.glyphStartIndex),oe,pe,n,P,M,d.segment,d.lineStartIndex,d.lineStartIndex+d.lineLength,S,f,B,Z,X);if(!le)return{notEnoughRoom:!0};ee=[le]}for(const le of ee)o.ak(T,le.point,le.angle);return{}}function Zi(d,t,n,l,u,f){const _=St(d.add(d.sub(t)._unit()),u,f).point,v=n.sub(_);return n.add(v._mult(l/v.mag()))}function Mt(d,t){const{projectionCache:n,lineVertexArray:l,labelPlaneMatrix:u,tileAnchorPoint:f,distanceFromAnchor:_,getElevation:v,previousVertex:S,direction:T,absOffsetX:P}=t;if(n.projections[d])return n.projections[d];const M=new o.P(l.getx(d),l.gety(d)),B=St(M,u,v);if(B.signedDistanceFromCamera>0)return n.projections[d]=B.point,B.point;const H=d-T;return Zi(_===0?f:new o.P(l.getx(H),l.gety(H)),M,S,P-_+1,u,v)}function Gr(d,t,n){return d._unit()._perp()._mult(t*n)}function W(d,t,n,l,u,f,_,v){const{projectionCache:S,direction:T}=v;if(S.offsets[d])return S.offsets[d];const P=n.add(t);if(d+T<l||d+T>=u)return S.offsets[d]=P,P;const M=Mt(d+T,v),B=Gr(M.sub(n),_,T),H=n.add(B),Z=M.add(B);return S.offsets[d]=o.al(f,P,H,Z)||P,S.offsets[d]}function D(d,t,n,l,u,f,_,v,S,T,P,M,B,H){const Z=l?d-t:d+t;let X=Z>0?1:-1,U=0;l&&(X*=-1,U=Math.PI),X<0&&(U+=Math.PI);let oe,pe,ee=X>0?v+_:v+_+1,le=u,_e=u,we=0,Me=0;const Fe=Math.abs(Z),Re=[];let Ue;for(;we+Me<=Fe;){if(ee+=X,ee<v||ee>=S)return null;we+=Me,_e=le,pe=oe;const We={projectionCache:M,lineVertexArray:T,labelPlaneMatrix:P,tileAnchorPoint:f,distanceFromAnchor:we,getElevation:H,previousVertex:_e,direction:X,absOffsetX:Fe};if(le=Mt(ee,We),n===0)Re.push(_e),Ue=le.sub(_e);else{let bt;const ut=le.sub(_e);bt=ut.mag()===0?Gr(Mt(ee+X,We).sub(le),n,X):Gr(ut,n,X),pe||(pe=_e.add(bt)),oe=W(ee,bt,le,v,S,pe,n,We),Re.push(pe),Ue=oe.sub(pe)}Me=Ue.mag()}const lt=Ue._mult((Fe-we)/Me)._add(pe||_e),Ut=U+Math.atan2(le.y-_e.y,le.x-_e.x);return Re.push(lt),{point:lt,angle:B?Ut:0,path:Re}}const $=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function j(d,t){for(let n=0;n<d;n++){const l=t.length;t.resize(l+4),t.float32.set($,3*l)}}function K(d,t,n){const l=t[0],u=t[1];return d[0]=n[0]*l+n[4]*u+n[12],d[1]=n[1]*l+n[5]*u+n[13],d[3]=n[3]*l+n[7]*u+n[15],d}const J=100;class he{constructor(t,n=new qr(t.width+200,t.height+200,25),l=new qr(t.width+200,t.height+200,25)){this.transform=t,this.grid=n,this.ignoredGrid=l,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+J,this.screenBottomBoundary=t.height+J,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,n,l,u,f,_){const v=this.projectAndGetPerspectiveRatio(u,t.anchorPointX,t.anchorPointY,_),S=l*v.perspectiveRatio,T=t.x1*S+v.point.x,P=t.y1*S+v.point.y,M=t.x2*S+v.point.x,B=t.y2*S+v.point.y;return!this.isInsideGrid(T,P,M,B)||n!=="always"&&this.grid.hitTest(T,P,M,B,n,f)||v.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[T,P,M,B],offscreen:this.isOffscreen(T,P,M,B)}}placeCollisionCircles(t,n,l,u,f,_,v,S,T,P,M,B,H,Z){const X=[],U=new o.P(n.anchorX,n.anchorY),oe=St(U,_,Z),pe=Jt(this.transform.cameraToCenterDistance,oe.signedDistanceFromCamera),ee=(P?f/pe:f*pe)/o.ap,le=St(U,v,Z).point,_e=mt(ee,u,n.lineOffsetX*ee,n.lineOffsetY*ee,!1,le,U,n,l,v,{projections:{},offsets:{}},!1,Z);let we=!1,Me=!1,Fe=!0;if(_e){const Re=.5*B*pe+H,Ue=new o.P(-100,-100),lt=new o.P(this.screenRightBoundary,this.screenBottomBoundary),Ut=new or,We=_e.first,bt=_e.last;let ut=[];for(let Dt=We.path.length-1;Dt>=1;Dt--)ut.push(We.path[Dt]);for(let Dt=1;Dt<bt.path.length;Dt++)ut.push(bt.path[Dt]);const hi=2.5*Re;if(S){const Dt=ut.map(qt=>St(qt,S,Z));ut=Dt.some(qt=>qt.signedDistanceFromCamera<=0)?[]:Dt.map(qt=>qt.point)}let Vt=[];if(ut.length>0){const Dt=ut[0].clone(),qt=ut[0].clone();for(let $i=1;$i<ut.length;$i++)Dt.x=Math.min(Dt.x,ut[$i].x),Dt.y=Math.min(Dt.y,ut[$i].y),qt.x=Math.max(qt.x,ut[$i].x),qt.y=Math.max(qt.y,ut[$i].y);Vt=Dt.x>=Ue.x&&qt.x<=lt.x&&Dt.y>=Ue.y&&qt.y<=lt.y?[ut]:qt.x<Ue.x||Dt.x>lt.x||qt.y<Ue.y||Dt.y>lt.y?[]:o.am([ut],Ue.x,Ue.y,lt.x,lt.y)}for(const Dt of Vt){Ut.reset(Dt,.25*Re);let qt=0;qt=Ut.length<=.5*Re?1:Math.ceil(Ut.paddedLength/hi)+1;for(let $i=0;$i<qt;$i++){const fi=$i/Math.max(qt-1,1),lr=Ut.lerp(fi),Yi=lr.x+J,Vi=lr.y+J;X.push(Yi,Vi,Re,0);const Br=Yi-Re,vi=Vi-Re,hn=Yi+Re,dn=Vi+Re;if(Fe=Fe&&this.isOffscreen(Br,vi,hn,dn),Me=Me||this.isInsideGrid(Br,vi,hn,dn),t!=="always"&&this.grid.hitTestCircle(Yi,Vi,Re,t,M)&&(we=!0,!T))return{circles:[],offscreen:!1,collisionDetected:we}}}}return{circles:!T&&we||!Me||pe<this.perspectiveRatioCutoff?[]:X,offscreen:Fe,collisionDetected:we}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const n=[];let l=1/0,u=1/0,f=-1/0,_=-1/0;for(const P of t){const M=new o.P(P.x+J,P.y+J);l=Math.min(l,M.x),u=Math.min(u,M.y),f=Math.max(f,M.x),_=Math.max(_,M.y),n.push(M)}const v=this.grid.query(l,u,f,_).concat(this.ignoredGrid.query(l,u,f,_)),S={},T={};for(const P of v){const M=P.key;if(S[M.bucketInstanceId]===void 0&&(S[M.bucketInstanceId]={}),S[M.bucketInstanceId][M.featureIndex])continue;const B=[new o.P(P.x1,P.y1),new o.P(P.x2,P.y1),new o.P(P.x2,P.y2),new o.P(P.x1,P.y2)];o.an(n,B)&&(S[M.bucketInstanceId][M.featureIndex]=!0,T[M.bucketInstanceId]===void 0&&(T[M.bucketInstanceId]=[]),T[M.bucketInstanceId].push(M.featureIndex))}return T}insertCollisionBox(t,n,l,u,f,_){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:f,collisionGroupID:_,overlapMode:n},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,n,l,u,f,_){const v=l?this.ignoredGrid:this.grid,S={bucketInstanceId:u,featureIndex:f,collisionGroupID:_,overlapMode:n};for(let T=0;T<t.length;T+=4)v.insertCircle(S,t[T],t[T+1],t[T+2])}projectAndGetPerspectiveRatio(t,n,l,u){let f;return u?(f=[n,l,u(n,l),1],o.ag(f,f,t)):(f=[n,l,0,1],K(f,f,t)),{point:new o.P((f[0]/f[3]+1)/2*this.transform.width+J,(-f[1]/f[3]+1)/2*this.transform.height+J),perspectiveRatio:.5+this.transform.cameraToCenterDistance/f[3]*.5}}isOffscreen(t,n,l,u){return l<J||t>=this.screenRightBoundary||u<J||n>this.screenBottomBoundary}isInsideGrid(t,n,l,u){return l>=0&&t<this.gridRightBoundary&&u>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const t=o.ao([]);return o.$(t,t,[-100,-100,0]),t}}function ne(d,t,n){return t*(o.N/(d.tileSize*Math.pow(2,n-d.tileID.overscaledZ)))}class te{constructor(t,n,l,u){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?n:-n))):u&&l?1:0,this.placed=l}isHidden(){return this.opacity===0&&!this.placed}}class se{constructor(t,n,l,u,f){this.text=new te(t?t.text:null,n,l,f),this.icon=new te(t?t.icon:null,n,u,f)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ee{constructor(t,n,l){this.text=t,this.icon=n,this.skipFade=l}}class Ie{constructor(){this.invProjMatrix=o.Z(),this.viewportMatrix=o.Z(),this.circles=[]}}class Ae{constructor(t,n,l,u,f){this.bucketInstanceId=t,this.featureIndex=n,this.sourceLayerIndex=l,this.bucketIndex=u,this.tileID=f}}class dt{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const n=++this.maxGroupID;this.collisionGroups[t]={ID:n,predicate:l=>l.collisionGroupID===n}}return this.collisionGroups[t]}}function Ct(d,t,n,l,u){const{horizontalAlign:f,verticalAlign:_}=o.au(d);return new o.P(-(f-.5)*t+l[0]*u,-(_-.5)*n+l[1]*u)}function at(d,t,n,l,u,f){const{x1:_,x2:v,y1:S,y2:T,anchorPointX:P,anchorPointY:M}=d,B=new o.P(t,n);return l&&B._rotate(u?f:-f),{x1:_+B.x,y1:S+B.y,x2:v+B.x,y2:T+B.y,anchorPointX:P,anchorPointY:M}}class Ke{constructor(t,n,l,u,f){this.transform=t.clone(),this.terrain=n,this.collisionIndex=new he(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new dt(u),this.collisionCircleArrays={},this.prevPlacement=f,f&&(f.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,n,l,u){const f=l.getBucket(n),_=l.latestFeatureIndex;if(!f||!_||n.id!==f.layerIds[0])return;const v=l.collisionBoxArray,S=f.layers[0].layout,T=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),P=l.tileSize/o.N,M=this.transform.calculatePosMatrix(l.tileID.toUnwrapped()),B=S.get("text-pitch-alignment")==="map",H=S.get("text-rotation-alignment")==="map",Z=ne(l,1,this.transform.zoom),X=Ve(M,B,H,this.transform,Z);let U=null;if(B){const pe=Et(M,B,H,this.transform,Z);U=o.a1([],this.transform.labelPlaneMatrix,pe)}this.retainedQueryData[f.bucketInstanceId]=new Ae(f.bucketInstanceId,_,f.sourceLayerIndex,f.index,l.tileID);const oe={bucket:f,layout:S,posMatrix:M,textLabelPlaneMatrix:X,labelToScreenMatrix:U,scale:T,textPixelRatio:P,holdingForFade:l.holdingForFade(),collisionBoxArray:v,partiallyEvaluatedTextSize:o.ah(f.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(f.sourceID)};if(u)for(const pe of f.sortKeyRanges){const{sortKey:ee,symbolInstanceStart:le,symbolInstanceEnd:_e}=pe;t.push({sortKey:ee,symbolInstanceStart:le,symbolInstanceEnd:_e,parameters:oe})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:f.symbolInstances.length,parameters:oe})}attemptAnchorPlacement(t,n,l,u,f,_,v,S,T,P,M,B,H,Z,X,U){const oe=o.aq[t.textAnchor],pe=[t.textOffset0,t.textOffset1],ee=Ct(oe,l,u,pe,f),le=this.collisionIndex.placeCollisionBox(at(n,ee.x,ee.y,_,v,this.transform.angle),M,S,T,P.predicate,U);if((!X||this.collisionIndex.placeCollisionBox(at(X,ee.x,ee.y,_,v,this.transform.angle),M,S,T,P.predicate,U).box.length!==0)&&le.box.length>0){let _e;if(this.prevPlacement&&this.prevPlacement.variableOffsets[B.crossTileID]&&this.prevPlacement.placements[B.crossTileID]&&this.prevPlacement.placements[B.crossTileID].text&&(_e=this.prevPlacement.variableOffsets[B.crossTileID].anchor),B.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[B.crossTileID]={textOffset:pe,width:l,height:u,anchor:oe,textBoxScale:f,prevAnchor:_e},this.markUsedJustification(H,oe,B,Z),H.allowVerticalPlacement&&(this.markUsedOrientation(H,Z,B),this.placedOrientations[B.crossTileID]=Z),{shift:ee,placedGlyphBoxes:le}}}placeLayerBucketPart(t,n,l){const{bucket:u,layout:f,posMatrix:_,textLabelPlaneMatrix:v,labelToScreenMatrix:S,textPixelRatio:T,holdingForFade:P,collisionBoxArray:M,partiallyEvaluatedTextSize:B,collisionGroup:H}=t.parameters,Z=f.get("text-optional"),X=f.get("icon-optional"),U=o.ar(f,"text-overlap","text-allow-overlap"),oe=U==="always",pe=o.ar(f,"icon-overlap","icon-allow-overlap"),ee=pe==="always",le=f.get("text-rotation-alignment")==="map",_e=f.get("text-pitch-alignment")==="map",we=f.get("icon-text-fit")!=="none",Me=f.get("symbol-z-order")==="viewport-y",Fe=oe&&(ee||!u.hasIconData()||X),Re=ee&&(oe||!u.hasTextData()||Z);!u.collisionArrays&&M&&u.deserializeCollisionBoxes(M);const Ue=this.retainedQueryData[u.bucketInstanceId].tileID,lt=this.terrain?(We,bt)=>this.terrain.getElevation(Ue,We,bt):null,Ut=(We,bt)=>{var ut,hi;if(n[We.crossTileID])return;if(P)return void(this.placements[We.crossTileID]=new Ee(!1,!1,!1));let Vt=!1,Dt=!1,qt=!0,$i=null,fi={box:null,offscreen:null},lr={box:null,offscreen:null},Yi=null,Vi=null,Br=null,vi=0,hn=0,dn=0;bt.textFeatureIndex?vi=bt.textFeatureIndex:We.useRuntimeCollisionCircles&&(vi=We.featureIndex),bt.verticalTextFeatureIndex&&(hn=bt.verticalTextFeatureIndex);const Un=bt.textBox;if(Un){const dr=Oi=>{let Ji=o.ai.horizontal;if(u.allowVerticalPlacement&&!Oi&&this.prevPlacement){const Ir=this.prevPlacement.placedOrientations[We.crossTileID];Ir&&(this.placedOrientations[We.crossTileID]=Ir,Ji=Ir,this.markUsedOrientation(u,Ji,We))}return Ji},cr=(Oi,Ji)=>{if(u.allowVerticalPlacement&&We.numVerticalGlyphVertices>0&&bt.verticalTextBox){for(const Ir of u.writingModes)if(Ir===o.ai.vertical?(fi=Ji(),lr=fi):fi=Oi(),fi&&fi.box&&fi.box.length)break}else fi=Oi()},_r=We.textAnchorOffsetStartIndex,na=We.textAnchorOffsetEndIndex;if(na===_r){const Oi=(Ji,Ir)=>{const Bi=this.collisionIndex.placeCollisionBox(Ji,U,T,_,H.predicate,lt);return Bi&&Bi.box&&Bi.box.length&&(this.markUsedOrientation(u,Ir,We),this.placedOrientations[We.crossTileID]=Ir),Bi};cr(()=>Oi(Un,o.ai.horizontal),()=>{const Ji=bt.verticalTextBox;return u.allowVerticalPlacement&&We.numVerticalGlyphVertices>0&&Ji?Oi(Ji,o.ai.vertical):{box:null,offscreen:null}}),dr(fi&&fi.box&&fi.box.length)}else{let Oi=o.aq[(hi=(ut=this.prevPlacement)===null||ut===void 0?void 0:ut.variableOffsets[We.crossTileID])===null||hi===void 0?void 0:hi.anchor];const Ji=(Bi,aa,Fo)=>{const nc=Bi.x2-Bi.x1,ac=Bi.y2-Bi.y1,fu=We.textBoxScale,Us=we&&pe==="never"?aa:null;let pn={box:[],offscreen:!1},oa=U==="never"?1:2,fn="never";Oi&&oa++;for(let Yr=0;Yr<oa;Yr++){for(let mn=_r;mn<na;mn++){const qs=u.textAnchorOffsets.get(mn);if(Oi&&qs.textAnchor!==Oi)continue;const En=this.attemptAnchorPlacement(qs,Bi,nc,ac,fu,le,_e,T,_,H,fn,We,u,Fo,Us,lt);if(En&&(pn=En.placedGlyphBoxes,pn&&pn.box&&pn.box.length))return Vt=!0,$i=En.shift,pn}Oi?Oi=null:fn=U}return pn};cr(()=>Ji(Un,bt.iconBox,o.ai.horizontal),()=>{const Bi=bt.verticalTextBox;return u.allowVerticalPlacement&&!(fi&&fi.box&&fi.box.length)&&We.numVerticalGlyphVertices>0&&Bi?Ji(Bi,bt.verticalIconBox,o.ai.vertical):{box:null,offscreen:null}}),fi&&(Vt=fi.box,qt=fi.offscreen);const Ir=dr(fi&&fi.box);if(!Vt&&this.prevPlacement){const Bi=this.prevPlacement.variableOffsets[We.crossTileID];Bi&&(this.variableOffsets[We.crossTileID]=Bi,this.markUsedJustification(u,Bi.anchor,We,Ir))}}}if(Yi=fi,Vt=Yi&&Yi.box&&Yi.box.length>0,qt=Yi&&Yi.offscreen,We.useRuntimeCollisionCircles){const dr=u.text.placedSymbolArray.get(We.centerJustifiedTextSymbolIndex),cr=o.aj(u.textSizeData,B,dr),_r=f.get("text-padding");Vi=this.collisionIndex.placeCollisionCircles(U,dr,u.lineVertexArray,u.glyphOffsetArray,cr,_,v,S,l,_e,H.predicate,We.collisionCircleDiameter,_r,lt),Vi.circles.length&&Vi.collisionDetected&&!l&&o.w("Collisions detected, but collision boxes are not shown"),Vt=oe||Vi.circles.length>0&&!Vi.collisionDetected,qt=qt&&Vi.offscreen}if(bt.iconFeatureIndex&&(dn=bt.iconFeatureIndex),bt.iconBox){const dr=cr=>{const _r=we&&$i?at(cr,$i.x,$i.y,le,_e,this.transform.angle):cr;return this.collisionIndex.placeCollisionBox(_r,pe,T,_,H.predicate,lt)};lr&&lr.box&&lr.box.length&&bt.verticalIconBox?(Br=dr(bt.verticalIconBox),Dt=Br.box.length>0):(Br=dr(bt.iconBox),Dt=Br.box.length>0),qt=qt&&Br.offscreen}const ra=Z||We.numHorizontalGlyphVertices===0&&We.numVerticalGlyphVertices===0,Sa=X||We.numIconVertices===0;if(ra||Sa?Sa?ra||(Dt=Dt&&Vt):Vt=Dt&&Vt:Dt=Vt=Dt&&Vt,Vt&&Yi&&Yi.box&&this.collisionIndex.insertCollisionBox(Yi.box,U,f.get("text-ignore-placement"),u.bucketInstanceId,lr&&lr.box&&hn?hn:vi,H.ID),Dt&&Br&&this.collisionIndex.insertCollisionBox(Br.box,pe,f.get("icon-ignore-placement"),u.bucketInstanceId,dn,H.ID),Vi&&(Vt&&this.collisionIndex.insertCollisionCircles(Vi.circles,U,f.get("text-ignore-placement"),u.bucketInstanceId,vi,H.ID),l)){const dr=u.bucketInstanceId;let cr=this.collisionCircleArrays[dr];cr===void 0&&(cr=this.collisionCircleArrays[dr]=new Ie);for(let _r=0;_r<Vi.circles.length;_r+=4)cr.circles.push(Vi.circles[_r+0]),cr.circles.push(Vi.circles[_r+1]),cr.circles.push(Vi.circles[_r+2]),cr.circles.push(Vi.collisionDetected?1:0)}if(We.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(u.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[We.crossTileID]=new Ee(Vt||Fe,Dt||Re,qt||u.justReloaded),n[We.crossTileID]=!0};if(Me){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const We=u.getSortedSymbolIndexes(this.transform.angle);for(let bt=We.length-1;bt>=0;--bt){const ut=We[bt];Ut(u.symbolInstances.get(ut),u.collisionArrays[ut])}}else for(let We=t.symbolInstanceStart;We<t.symbolInstanceEnd;We++)Ut(u.symbolInstances.get(We),u.collisionArrays[We]);if(l&&u.bucketInstanceId in this.collisionCircleArrays){const We=this.collisionCircleArrays[u.bucketInstanceId];o.as(We.invProjMatrix,_),We.viewportMatrix=this.collisionIndex.getViewportMatrix()}u.justReloaded=!1}markUsedJustification(t,n,l,u){let f;f=u===o.ai.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[o.at(n)];const _=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];for(const v of _)v>=0&&(t.text.placedSymbolArray.get(v).crossTileID=f>=0&&v!==f?0:l.crossTileID)}markUsedOrientation(t,n,l){const u=n===o.ai.horizontal||n===o.ai.horizontalOnly?n:0,f=n===o.ai.vertical?n:0,_=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];for(const v of _)t.text.placedSymbolArray.get(v).placedOrientation=u;l.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=f)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let l=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const u=n?n.symbolFadeChange(t):1,f=n?n.opacities:{},_=n?n.variableOffsets:{},v=n?n.placedOrientations:{};for(const S in this.placements){const T=this.placements[S],P=f[S];P?(this.opacities[S]=new se(P,u,T.text,T.icon),l=l||T.text!==P.text.placed||T.icon!==P.icon.placed):(this.opacities[S]=new se(null,u,T.text,T.icon,T.skipFade),l=l||T.text||T.icon)}for(const S in f){const T=f[S];if(!this.opacities[S]){const P=new se(T,u,!1,!1);P.isHidden()||(this.opacities[S]=P,l=l||T.text.placed||T.icon.placed)}}for(const S in _)this.variableOffsets[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.variableOffsets[S]=_[S]);for(const S in v)this.placedOrientations[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.placedOrientations[S]=v[S]);if(n&&n.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");l?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:t)}updateLayerOpacities(t,n){const l={};for(const u of n){const f=u.getBucket(t);f&&u.latestFeatureIndex&&t.id===f.layerIds[0]&&this.updateBucketOpacities(f,l,u.collisionBoxArray)}}updateBucketOpacities(t,n,l){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const u=t.layers[0],f=u.layout,_=new se(null,0,!1,!1,!0),v=f.get("text-allow-overlap"),S=f.get("icon-allow-overlap"),T=u._unevaluatedLayout.hasValue("text-variable-anchor")||u._unevaluatedLayout.hasValue("text-variable-anchor-offset"),P=f.get("text-rotation-alignment")==="map",M=f.get("text-pitch-alignment")==="map",B=f.get("icon-text-fit")!=="none",H=new se(null,0,v&&(S||!t.hasIconData()||f.get("icon-optional")),S&&(v||!t.hasTextData()||f.get("text-optional")),!0);!t.collisionArrays&&l&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(l);const Z=(X,U,oe)=>{for(let pe=0;pe<U/4;pe++)X.opacityVertexArray.emplaceBack(oe);X.hasVisibleVertices=X.hasVisibleVertices||oe!==Cr};for(let X=0;X<t.symbolInstances.length;X++){const U=t.symbolInstances.get(X),{numHorizontalGlyphVertices:oe,numVerticalGlyphVertices:pe,crossTileID:ee}=U;let le=this.opacities[ee];n[ee]?le=_:le||(le=H,this.opacities[ee]=le),n[ee]=!0;const _e=U.numIconVertices>0,we=this.placedOrientations[U.crossTileID],Me=we===o.ai.vertical,Fe=we===o.ai.horizontal||we===o.ai.horizontalOnly;if(oe>0||pe>0){const Re=Ri(le.text);Z(t.text,oe,Me?Cr:Re),Z(t.text,pe,Fe?Cr:Re);const Ue=le.text.isHidden();[U.rightJustifiedTextSymbolIndex,U.centerJustifiedTextSymbolIndex,U.leftJustifiedTextSymbolIndex].forEach(We=>{We>=0&&(t.text.placedSymbolArray.get(We).hidden=Ue||Me?1:0)}),U.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(U.verticalPlacedTextSymbolIndex).hidden=Ue||Fe?1:0);const lt=this.variableOffsets[U.crossTileID];lt&&this.markUsedJustification(t,lt.anchor,U,we);const Ut=this.placedOrientations[U.crossTileID];Ut&&(this.markUsedJustification(t,"left",U,Ut),this.markUsedOrientation(t,Ut,U))}if(_e){const Re=Ri(le.icon),Ue=!(B&&U.verticalPlacedIconSymbolIndex&&Me);U.placedIconSymbolIndex>=0&&(Z(t.icon,U.numIconVertices,Ue?Re:Cr),t.icon.placedSymbolArray.get(U.placedIconSymbolIndex).hidden=le.icon.isHidden()),U.verticalPlacedIconSymbolIndex>=0&&(Z(t.icon,U.numVerticalIconVertices,Ue?Cr:Re),t.icon.placedSymbolArray.get(U.verticalPlacedIconSymbolIndex).hidden=le.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Re=t.collisionArrays[X];if(Re){let Ue=new o.P(0,0);if(Re.textBox||Re.verticalTextBox){let Ut=!0;if(T){const We=this.variableOffsets[ee];We?(Ue=Ct(We.anchor,We.width,We.height,We.textOffset,We.textBoxScale),P&&Ue._rotate(M?this.transform.angle:-this.transform.angle)):Ut=!1}Re.textBox&&Ye(t.textCollisionBox.collisionVertexArray,le.text.placed,!Ut||Me,Ue.x,Ue.y),Re.verticalTextBox&&Ye(t.textCollisionBox.collisionVertexArray,le.text.placed,!Ut||Fe,Ue.x,Ue.y)}const lt=!!(!Fe&&Re.verticalIconBox);Re.iconBox&&Ye(t.iconCollisionBox.collisionVertexArray,le.icon.placed,lt,B?Ue.x:0,B?Ue.y:0),Re.verticalIconBox&&Ye(t.iconCollisionBox.collisionVertexArray,le.icon.placed,!lt,B?Ue.x:0,B?Ue.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const X=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=X.invProjMatrix,t.placementViewportMatrix=X.viewportMatrix,t.collisionCircleArray=X.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,n){const l=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*l>t}setStale(){this.stale=!0}}function Ye(d,t,n,l,u){d.emplaceBack(t?1:0,n?1:0,l||0,u||0),d.emplaceBack(t?1:0,n?1:0,l||0,u||0),d.emplaceBack(t?1:0,n?1:0,l||0,u||0),d.emplaceBack(t?1:0,n?1:0,l||0,u||0)}const It=Math.pow(2,25),Ot=Math.pow(2,24),Rt=Math.pow(2,17),Lt=Math.pow(2,16),Ni=Math.pow(2,9),ci=Math.pow(2,8),Di=Math.pow(2,1);function Ri(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;const t=d.placed?1:0,n=Math.floor(127*d.opacity);return n*It+t*Ot+n*Rt+t*Lt+n*Ni+t*ci+n*Di+t}const Cr=0;class co{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,n,l,u,f){const _=this._bucketParts;for(;this._currentTileIndex<t.length;)if(n.getBucketParts(_,u,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,f())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,_.sort((v,S)=>v.sortKey-S.sortKey));this._currentPartIndex<_.length;)if(n.placeLayerBucketPart(_[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,f())return!0;return!1}}class Rn{constructor(t,n,l,u,f,_,v,S){this.placement=new Ke(t,n,_,v,S),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=f,this._done=!1}isDone(){return this._done}continuePlacement(t,n,l){const u=o.h.now(),f=()=>!this._forceFullPlacement&&o.h.now()-u>2;for(;this._currentPlacementIndex>=0;){const _=n[t[this._currentPlacementIndex]],v=this.placement.collisionIndex.transform.zoom;if(_.type==="symbol"&&(!_.minzoom||_.minzoom<=v)&&(!_.maxzoom||_.maxzoom>v)){if(this._inProgressLayer||(this._inProgressLayer=new co(_)),this._inProgressLayer.continuePlacement(l[_.source],this.placement,this._showCollisionBoxes,_,f))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const $n=512/o.N/2;class Yc{constructor(t,n,l){this.tileID=t,this.bucketInstanceId=l,this._symbolsByKey={};const u=new Map;for(let f=0;f<n.length;f++){const _=n.get(f),v=_.key,S=u.get(v);S?S.push(_):u.set(v,[_])}for(const[f,_]of u){const v={positions:_.map(S=>({x:Math.floor(S.anchorX*$n),y:Math.floor(S.anchorY*$n)})),crossTileIDs:_.map(S=>S.crossTileID)};if(v.positions.length>128){const S=new o.av(v.positions.length,16,Uint16Array);for(const{x:T,y:P}of v.positions)S.add(T,P);S.finish(),delete v.positions,v.index=S}this._symbolsByKey[f]=v}}getScaledCoordinates(t,n){const{x:l,y:u,z:f}=this.tileID.canonical,{x:_,y:v,z:S}=n.canonical,T=$n/Math.pow(2,S-f),P=(v*o.N+t.anchorY)*T,M=u*o.N*$n;return{x:Math.floor((_*o.N+t.anchorX)*T-l*o.N*$n),y:Math.floor(P-M)}}findMatches(t,n,l){const u=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z);for(let f=0;f<t.length;f++){const _=t.get(f);if(_.crossTileID)continue;const v=this._symbolsByKey[_.key];if(!v)continue;const S=this.getScaledCoordinates(_,n);if(v.index){const T=v.index.range(S.x-u,S.y-u,S.x+u,S.y+u).sort();for(const P of T){const M=v.crossTileIDs[P];if(!l[M]){l[M]=!0,_.crossTileID=M;break}}}else if(v.positions)for(let T=0;T<v.positions.length;T++){const P=v.positions[T],M=v.crossTileIDs[T];if(Math.abs(P.x-S.x)<=u&&Math.abs(P.y-S.y)<=u&&!l[M]){l[M]=!0,_.crossTileID=M;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class ui{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class is{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const n=Math.round((t-this.lng)/360);if(n!==0)for(const l in this.indexes){const u=this.indexes[l],f={};for(const _ in u){const v=u[_];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+n),f[v.tileID.key]=v}this.indexes[l]=f}this.lng=t}addBucket(t,n,l){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let f=0;f<n.symbolInstances.length;f++)n.symbolInstances.get(f).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const u=this.usedCrossTileIDs[t.overscaledZ];for(const f in this.indexes){const _=this.indexes[f];if(Number(f)>t.overscaledZ)for(const v in _){const S=_[v];S.tileID.isChildOf(t)&&S.findMatches(n.symbolInstances,t,u)}else{const v=_[t.scaledTo(Number(f)).key];v&&v.findMatches(n.symbolInstances,t,u)}}for(let f=0;f<n.symbolInstances.length;f++){const _=n.symbolInstances.get(f);_.crossTileID||(_.crossTileID=l.generate(),u[_.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Yc(t,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(t,n){for(const l of n.getCrossTileIDsLists())for(const u of l)delete this.usedCrossTileIDs[t][u]}removeStaleBuckets(t){let n=!1;for(const l in this.indexes){const u=this.indexes[l];for(const f in u)t[u[f].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,u[f]),delete u[f],n=!0)}return n}}class uo{constructor(){this.layerIndexes={},this.crossTileIDs=new ui,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,n,l){let u=this.layerIndexes[t.id];u===void 0&&(u=this.layerIndexes[t.id]=new is);let f=!1;const _={};u.handleWrapJump(l);for(const v of n){const S=v.getBucket(t);S&&t.id===S.layerIds[0]&&(S.bucketInstanceId||(S.bucketInstanceId=++this.maxBucketInstanceId),u.addBucket(v.tileID,S,this.crossTileIDs)&&(f=!0),_[S.bucketInstanceId]=!0)}return u.removeStaleBuckets(_)&&(f=!0),f}pruneUnusedLayers(t){const n={};t.forEach(l=>{n[l]=!0});for(const l in this.layerIndexes)n[l]||delete this.layerIndexes[l]}}const hr=(d,t)=>o.x(d,t&&t.filter(n=>n.identifier!=="source.canvas")),Lr=o.F(o.ax,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),Jc=o.F(o.ax,["setCenter","setZoom","setBearing","setPitch"]),Zr=o.aw();class sr extends o.E{constructor(t,n={}){super(),this.map=t,this.dispatcher=new Gt(cn(),this,t._getMapId()),this.imageManager=new Ge,this.imageManager.setEventedParent(this),this.glyphManager=new Tt(t._requestManager,n.localIdeographFontFamily),this.lineAtlas=new Qt(256,512),this.crossTileSymbolIndex=new uo,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.az());const l=this;this._rtlTextPluginCallback=sr.registerForPluginStateChange(u=>{l.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:u.pluginStatus,pluginURL:u.pluginURL},(f,_)=>{if(o.aA(f),_&&_.every(v=>v))for(const v in l.sourceCaches){const S=l.sourceCaches[v].getSource().type;S!=="vector"&&S!=="geojson"||l.sourceCaches[v].reload()}})}),this.on("data",u=>{if(u.dataType!=="source"||u.sourceDataType!=="metadata")return;const f=this.sourceCaches[u.sourceId];if(!f)return;const _=f.getSource();if(_&&_.vectorLayerIds)for(const v in this._layers){const S=this._layers[v];S.source===_.id&&this._validateLayer(S)}})}loadURL(t,n={},l){this.fire(new o.k("dataloading",{dataType:"style"})),n.validate=typeof n.validate!="boolean"||n.validate;const u=this.map._requestManager.transformRequest(t,ve.Style);this._request=o.f(u,(f,_)=>{this._request=null,f?this.fire(new o.j(f)):_&&this._load(_,n,l)})}loadJSON(t,n={},l){this.fire(new o.k("dataloading",{dataType:"style"})),this._request=o.h.frame(()=>{this._request=null,n.validate=n.validate!==!1,this._load(t,n,l)})}loadEmpty(){this.fire(new o.k("dataloading",{dataType:"style"})),this._load(Zr,{validate:!1})}_load(t,n,l){var u;const f=n.transformStyle?n.transformStyle(l,t):t;if(!n.validate||!hr(this,o.y(f))){this._loaded=!0,this.stylesheet=f;for(const _ in f.sources)this.addSource(_,f.sources[_],{validate:!1});f.sprite?this._loadSprite(f.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(f.glyphs),this._createLayers(),this.light=new At(this.stylesheet.light),this.map.setTerrain((u=this.stylesheet.terrain)!==null&&u!==void 0?u:null),this.fire(new o.k("data",{dataType:"style"})),this.fire(new o.k("style.load"))}}_createLayers(){const t=o.aB(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",t),this._order=t.map(n=>n.id),this._layers={},this._serializedLayers=null;for(const n of t){const l=o.aC(n);l.setEventedParent(this,{layer:{id:n.id}}),this._layers[n.id]=l}}_loadSprite(t,n=!1,l=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(u,f,_,v){const S=$e(u),T=S.length,P=_>1?"@2x":"",M={},B={},H={};for(const{id:Z,url:X}of S){const U=f.transformRequest(f.normalizeSpriteURL(X,P,".json"),ve.SpriteJSON),oe=`${Z}_${U.url}`;M[oe]=o.f(U,(le,_e)=>{delete M[oe],B[Z]=_e,De(v,B,H,le,T)});const pe=f.transformRequest(f.normalizeSpriteURL(X,P,".png"),ve.SpriteImage),ee=`${Z}_${pe.url}`;M[ee]=xe.getImage(pe,(le,_e)=>{delete M[ee],H[Z]=_e,De(v,B,H,le,T)})}return{cancel(){for(const Z of Object.values(M))Z.cancel()}}}(t,this.map._requestManager,this.map.getPixelRatio(),(u,f)=>{if(this._spriteRequest=null,u)this.fire(new o.j(u));else if(f)for(const _ in f){this._spritesImagesIds[_]=[];const v=this._spritesImagesIds[_]?this._spritesImagesIds[_].filter(S=>!(S in f)):[];for(const S of v)this.imageManager.removeImage(S),this._changedImages[S]=!0;for(const S in f[_]){const T=_==="default"?S:`${_}:${S}`;this._spritesImagesIds[_].push(T),T in this.imageManager.images?this.imageManager.updateImage(T,f[_][S],!1):this.imageManager.addImage(T,f[_][S]),n&&(this._changedImages[T]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),n&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.k("data",{dataType:"style"})),l&&l(u)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}_validateLayer(t){const n=this.sourceCaches[t.source];if(!n)return;const l=t.sourceLayer;if(!l)return;const u=n.getSource();(u.type==="geojson"||u.vectorLayerIds&&u.vectorLayerIds.indexOf(l)===-1)&&this.fire(new o.j(new Error(`Source layer "${l}" does not exist on source "${u.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t){const n=this._serializedAllLayers();if(!t||t.length===0)return Object.values(n);const l=[];for(const u of t)n[u]&&l.push(n[u]);return l}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const n=Object.keys(this._layers);for(const l of n){const u=this._layers[l];u.type!=="custom"&&(t[l]=u.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const n=this._changed;if(this._changed){const u=Object.keys(this._updatedLayers),f=Object.keys(this._removedLayers);(u.length||f.length)&&this._updateWorkerLayers(u,f);for(const _ in this._updatedSources){const v=this._updatedSources[_];if(v==="reload")this._reloadSource(_);else{if(v!=="clear")throw new Error(`Invalid action ${v}`);this._clearSource(_)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const _ in this._updatedPaintProps)this._layers[_].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const l={};for(const u in this.sourceCaches){const f=this.sourceCaches[u];l[u]=f.used,f.used=!1}for(const u of this._order){const f=this._layers[u];f.recalculate(t,this._availableImages),!f.isHidden(t.zoom)&&f.source&&(this.sourceCaches[f.source].used=!0)}for(const u in l){const f=this.sourceCaches[u];l[u]!==f.used&&f.fire(new o.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:u}))}this.light.recalculate(t),this.z=t.zoom,n&&this.fire(new o.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const n in this.sourceCaches)this.sourceCaches[n].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,n){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(t),removedIds:n})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,n={}){this._checkLoaded();const l=this.serialize();if(t=n.transformStyle?n.transformStyle(l,t):t,hr(this,o.y(t)))return!1;(t=o.aD(t)).layers=o.aB(t.layers);const u=o.aE(l,t).filter(_=>!(_.command in Jc));if(u.length===0)return!1;const f=u.filter(_=>!(_.command in Lr));if(f.length>0)throw new Error(`Unimplemented: ${f.map(_=>_.command).join(", ")}.`);for(const _ of u)_.command!=="setTransition"&&this[_.command].apply(this,_.args);return this.stylesheet=t,this._serializedLayers=null,!0}addImage(t,n){if(this.getImage(t))return this.fire(new o.j(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,n),this._afterImageUpdated(t)}updateImage(t,n){this.imageManager.updateImage(t,n)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new o.j(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,n,l={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(o.y.source,`sources.${t}`,n,null,l))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const u=this.sourceCaches[t]=new bi(t,n,this.dispatcher);u.style=this,u.setEventedParent(this,()=>({isSourceLoaded:u.loaded(),source:u.serialize(),sourceId:t})),u.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===t)return this.fire(new o.j(new Error(`Source "${t}" cannot be removed while layer "${l}" is using it.`)));const n=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],n.fire(new o.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),n.setEventedParent(null),n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,n){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const l=this.sourceCaches[t].getSource();if(l.type!=="geojson")throw new Error(`geojsonSource.type is ${l.type}, which is !== 'geojson`);l.setData(n),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,n,l={}){this._checkLoaded();const u=t.id;if(this.getLayer(u))return void this.fire(new o.j(new Error(`Layer "${u}" already exists on this map.`)));let f;if(t.type==="custom"){if(hr(this,o.aF(t)))return;f=o.aC(t)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(u,t.source),t=o.aD(t),t=o.e(t,{source:u})),this._validate(o.y.layer,`layers.${u}`,t,{arrayIndex:-1},l))return;f=o.aC(t),this._validateLayer(f),f.setEventedParent(this,{layer:{id:u}})}const _=n?this._order.indexOf(n):this._order.length;if(n&&_===-1)this.fire(new o.j(new Error(`Cannot add layer "${u}" before non-existing layer "${n}".`)));else{if(this._order.splice(_,0,u),this._layerOrderChanged=!0,this._layers[u]=f,this._removedLayers[u]&&f.source&&f.type!=="custom"){const v=this._removedLayers[u];delete this._removedLayers[u],v.type!==f.type?this._updatedSources[f.source]="clear":(this._updatedSources[f.source]="reload",this.sourceCaches[f.source].pause())}this._updateLayer(f),f.onAdd&&f.onAdd(this.map)}}moveLayer(t,n){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new o.j(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===n)return;const l=this._order.indexOf(t);this._order.splice(l,1);const u=n?this._order.indexOf(n):this._order.length;n&&u===-1?this.fire(new o.j(new Error(`Cannot move layer "${t}" before non-existing layer "${n}".`))):(this._order.splice(u,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const n=this._layers[t];if(!n)return void this.fire(new o.j(new Error(`Cannot remove non-existing layer "${t}".`)));n.setEventedParent(null);const l=this._order.indexOf(t);this._order.splice(l,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=n,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],n.onRemove&&n.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,n,l){this._checkLoaded();const u=this.getLayer(t);u?u.minzoom===n&&u.maxzoom===l||(n!=null&&(u.minzoom=n),l!=null&&(u.maxzoom=l),this._updateLayer(u)):this.fire(new o.j(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,n,l={}){this._checkLoaded();const u=this.getLayer(t);if(u){if(!o.aG(u.filter,n))return n==null?(u.filter=void 0,void this._updateLayer(u)):void(this._validate(o.y.filter,`layers.${u.id}.filter`,n,null,l)||(u.filter=o.aD(n),this._updateLayer(u)))}else this.fire(new o.j(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return o.aD(this.getLayer(t).filter)}setLayoutProperty(t,n,l,u={}){this._checkLoaded();const f=this.getLayer(t);f?o.aG(f.getLayoutProperty(n),l)||(f.setLayoutProperty(n,l,u),this._updateLayer(f)):this.fire(new o.j(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,n){const l=this.getLayer(t);if(l)return l.getLayoutProperty(n);this.fire(new o.j(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,n,l,u={}){this._checkLoaded();const f=this.getLayer(t);f?o.aG(f.getPaintProperty(n),l)||(f.setPaintProperty(n,l,u)&&this._updateLayer(f),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new o.j(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,n){return this.getLayer(t).getPaintProperty(n)}setFeatureState(t,n){this._checkLoaded();const l=t.source,u=t.sourceLayer,f=this.sourceCaches[l];if(f===void 0)return void this.fire(new o.j(new Error(`The source '${l}' does not exist in the map's style.`)));const _=f.getSource().type;_==="geojson"&&u?this.fire(new o.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):_!=="vector"||u?(t.id===void 0&&this.fire(new o.j(new Error("The feature id parameter must be provided."))),f.setFeatureState(u,t.id,n)):this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,n){this._checkLoaded();const l=t.source,u=this.sourceCaches[l];if(u===void 0)return void this.fire(new o.j(new Error(`The source '${l}' does not exist in the map's style.`)));const f=u.getSource().type,_=f==="vector"?t.sourceLayer:void 0;f!=="vector"||_?n&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new o.j(new Error("A feature id is required to remove its specific state property."))):u.removeFeatureState(_,t.id,n):this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const n=t.source,l=t.sourceLayer,u=this.sourceCaches[n];if(u!==void 0)return u.getSource().type!=="vector"||l?(t.id===void 0&&this.fire(new o.j(new Error("The feature id parameter must be provided."))),u.getFeatureState(l,t.id)):void this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.j(new Error(`The source '${n}' does not exist in the map's style.`)))}getTransition(){return o.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=o.aH(this.sourceCaches,f=>f.serialize()),n=this._serializeByIds(this._order),l=this.map.getTerrain()||void 0,u=this.stylesheet;return o.aI({version:u.version,name:u.name,metadata:u.metadata,light:u.light,center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch,sprite:u.sprite,glyphs:u.glyphs,transition:u.transition,sources:t,layers:n,terrain:l},f=>f!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const n=_=>this._layers[_].type==="fill-extrusion",l={},u=[];for(let _=this._order.length-1;_>=0;_--){const v=this._order[_];if(n(v)){l[v]=_;for(const S of t){const T=S[v];if(T)for(const P of T)u.push(P)}}}u.sort((_,v)=>v.intersectionZ-_.intersectionZ);const f=[];for(let _=this._order.length-1;_>=0;_--){const v=this._order[_];if(n(v))for(let S=u.length-1;S>=0;S--){const T=u[S].feature;if(l[T.layer.id]<_)break;f.push(T),u.pop()}else for(const S of t){const T=S[v];if(T)for(const P of T)f.push(P.feature)}}return f}queryRenderedFeatures(t,n,l){n&&n.filter&&this._validate(o.y.filter,"queryRenderedFeatures.filter",n.filter,null,n);const u={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new o.j(new Error("parameters.layers must be an Array."))),[];for(const v of n.layers){const S=this._layers[v];if(!S)return this.fire(new o.j(new Error(`The layer '${v}' does not exist in the map's style and cannot be queried for features.`))),[];u[S.source]=!0}}const f=[];n.availableImages=this._availableImages;const _=this._serializedAllLayers();for(const v in this.sourceCaches)n.layers&&!u[v]||f.push(Ht(this.sourceCaches[v],this._layers,_,t,n,l));return this.placement&&f.push(function(v,S,T,P,M,B,H){const Z={},X=B.queryRenderedSymbols(P),U=[];for(const oe of Object.keys(X).map(Number))U.push(H[oe]);U.sort(Mi);for(const oe of U){const pe=oe.featureIndex.lookupSymbolFeatures(X[oe.bucketInstanceId],S,oe.bucketIndex,oe.sourceLayerIndex,M.filter,M.layers,M.availableImages,v);for(const ee in pe){const le=Z[ee]=Z[ee]||[],_e=pe[ee];_e.sort((we,Me)=>{const Fe=oe.featureSortOrder;if(Fe){const Re=Fe.indexOf(we.featureIndex);return Fe.indexOf(Me.featureIndex)-Re}return Me.featureIndex-we.featureIndex});for(const we of _e)le.push(we)}}for(const oe in Z)Z[oe].forEach(pe=>{const ee=pe.feature,le=T[v[oe].source].getFeatureState(ee.layer["source-layer"],ee.id);ee.source=ee.layer.source,ee.layer["source-layer"]&&(ee.sourceLayer=ee.layer["source-layer"]),ee.state=le});return Z}(this._layers,_,this.sourceCaches,t,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(f)}querySourceFeatures(t,n){n&&n.filter&&this._validate(o.y.filter,"querySourceFeatures.filter",n.filter,null,n);const l=this.sourceCaches[t];return l?function(u,f){const _=u.getRenderableIds().map(T=>u.getTileByID(T)),v=[],S={};for(let T=0;T<_.length;T++){const P=_[T],M=P.tileID.canonical.key;S[M]||(S[M]=!0,P.querySourceFeatures(v,f))}return v}(l,n):[]}addSourceType(t,n,l){return li(t)?l(new Error(`A source type called "${t}" already exists.`)):(((u,f)=>{Pt[u]=f})(t,n),n.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:n.workerSourceURL},l):l(null,null))}getLight(){return this.light.getLight()}setLight(t,n={}){this._checkLoaded();const l=this.light.getLight();let u=!1;for(const _ in t)if(!o.aG(t[_],l[_])){u=!0;break}if(!u)return;const f={now:o.h.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,n),this.light.updateTransitions(f)}_validate(t,n,l,u,f={}){return(!f||f.validate!==!1)&&hr(this,t.call(o.y,o.e({key:n,style:this.serialize(),value:l,styleSpec:o.v},u)))}_remove(t=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.aJ.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this.sourceCaches){const l=this.sourceCaches[n];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const n in this.sourceCaches)this.sourceCaches[n].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,n,l,u,f=!1){let _=!1,v=!1;const S={};for(const T of this._order){const P=this._layers[T];if(P.type!=="symbol")continue;if(!S[P.source]){const B=this.sourceCaches[P.source];S[P.source]=B.getRenderableIds(!0).map(H=>B.getTileByID(H)).sort((H,Z)=>Z.tileID.overscaledZ-H.tileID.overscaledZ||(H.tileID.isLessThan(Z.tileID)?-1:1))}const M=this.crossTileSymbolIndex.addLayer(P,S[P.source],t.center.lng);_=_||M}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((f=f||this._layerOrderChanged||l===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.h.now(),t.zoom))&&(this.pauseablePlacement=new Rn(t,this.map.terrain,this._order,f,n,l,u,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,S),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.h.now()),v=!0),_&&this.pauseablePlacement.placement.setStale()),v||_)for(const T of this._order){const P=this._layers[T];P.type==="symbol"&&this.placement.updateLayerOpacities(P,S[P.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.h.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,n,l){this.imageManager.getImages(n.icons,l),this._updateTilesForChangedImages();const u=this.sourceCaches[n.source];u&&u.setDependencies(n.tileID.key,n.type,n.icons)}getGlyphs(t,n,l){this.glyphManager.getGlyphs(n.stacks,l);const u=this.sourceCaches[n.source];u&&u.setDependencies(n.tileID.key,n.type,[""])}getResource(t,n,l){return o.m(n,l)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,n={}){this._checkLoaded(),t&&this._validate(o.y.glyphs,"glyphs",t,null,n)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,n,l={},u){this._checkLoaded();const f=[{id:t,url:n}],_=[...$e(this.stylesheet.sprite),...f];this._validate(o.y.sprite,"sprite",_,null,l)||(this.stylesheet.sprite=_,this._loadSprite(f,!0,u))}removeSprite(t){this._checkLoaded();const n=$e(this.stylesheet.sprite);if(n.find(l=>l.id===t)){if(this._spritesImagesIds[t])for(const l of this._spritesImagesIds[t])this.imageManager.removeImage(l),this._changedImages[l]=!0;n.splice(n.findIndex(l=>l.id===t),1),this.stylesheet.sprite=n.length>0?n:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}else this.fire(new o.j(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return $e(this.stylesheet.sprite)}setSprite(t,n={},l){this._checkLoaded(),t&&this._validate(o.y.sprite,"sprite",t,null,n)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,l):(this._unloadSprite(),l&&l(null)))}}sr.registerForPluginStateChange=o.aK;var ho=o.Q([{name:"a_pos",type:"Int16",components:2}]),da="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const Ti={prelude:ni(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:ni(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:ni(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:ni(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:ni("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ni(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:ni(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:ni("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ni("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:ni("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:ni(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:ni(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:ni(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:ni(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:ni(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:ni(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:ni(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ni(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:ni(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:ni(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:ni(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:ni(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:ni(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:ni(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:ni(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:ni(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:ni("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",da),terrainDepth:ni("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",da),terrainCoords:ni("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",da)};function ni(d,t){const n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,l=t.match(/attribute ([\w]+) ([\w]+)/g),u=d.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),f=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),_=f?f.concat(u):u,v={};return{fragmentSource:d=d.replace(n,(S,T,P,M,B)=>(v[B]=!0,T==="define"?`
#ifndef HAS_UNIFORM_u_${B}
varying ${P} ${M} ${B};
#else
uniform ${P} ${M} u_${B};
#endif
`:`
#ifdef HAS_UNIFORM_u_${B}
    ${P} ${M} ${B} = u_${B};
#endif
`)),vertexSource:t=t.replace(n,(S,T,P,M,B)=>{const H=M==="float"?"vec2":"vec4",Z=B.match(/color/)?"color":H;return v[B]?T==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
attribute ${P} ${H} a_${B};
varying ${P} ${M} ${B};
#else
uniform ${P} ${M} u_${B};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = a_${B};
#else
    ${P} ${M} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = unpack_mix_${Z}(a_${B}, u_${B}_t);
#else
    ${P} ${M} ${B} = u_${B};
#endif
`:T==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
attribute ${P} ${H} a_${B};
#else
uniform ${P} ${M} u_${B};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${P} ${M} ${B} = a_${B};
#else
    ${P} ${M} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${P} ${M} ${B} = unpack_mix_${Z}(a_${B}, u_${B}_t);
#else
    ${P} ${M} ${B} = u_${B};
#endif
`}),staticAttributes:l,staticUniforms:_}}class Xn{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,n,l,u,f,_,v,S,T){this.context=t;let P=this.boundPaintVertexBuffers.length!==u.length;for(let M=0;!P&&M<u.length;M++)this.boundPaintVertexBuffers[M]!==u[M]&&(P=!0);!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==l||P||this.boundIndexBuffer!==f||this.boundVertexOffset!==_||this.boundDynamicVertexBuffer!==v||this.boundDynamicVertexBuffer2!==S||this.boundDynamicVertexBuffer3!==T?this.freshBind(n,l,u,f,_,v,S,T):(t.bindVertexArray.set(this.vao),v&&v.bind(),f&&f.dynamicDraw&&f.bind(),S&&S.bind(),T&&T.bind())}freshBind(t,n,l,u,f,_,v,S){const T=t.numAttributes,P=this.context,M=P.gl;this.vao&&this.destroy(),this.vao=P.createVertexArray(),P.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=u,this.boundVertexOffset=f,this.boundDynamicVertexBuffer=_,this.boundDynamicVertexBuffer2=v,this.boundDynamicVertexBuffer3=S,n.enableAttributes(M,t);for(const B of l)B.enableAttributes(M,t);_&&_.enableAttributes(M,t),v&&v.enableAttributes(M,t),S&&S.enableAttributes(M,t),n.bind(),n.setVertexAttribPointers(M,t,f);for(const B of l)B.bind(),B.setVertexAttribPointers(M,t,f);_&&(_.bind(),_.setVertexAttribPointers(M,t,f)),u&&u.bind(),v&&(v.bind(),v.setVertexAttribPointers(M,t,f)),S&&(S.bind(),S.setVertexAttribPointers(M,t,f)),P.currentNumAttributes=T}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Ai(d){const t=[];for(let n=0;n<d.length;n++){if(d[n]===null)continue;const l=d[n].split(" ");t.push(l.pop())}return t}class po{constructor(t,n,l,u,f,_){const v=t.gl;this.program=v.createProgram();const S=Ai(n.staticAttributes),T=l?l.getBinderAttributes():[],P=S.concat(T),M=Ti.prelude.staticUniforms?Ai(Ti.prelude.staticUniforms):[],B=n.staticUniforms?Ai(n.staticUniforms):[],H=l?l.getBinderUniforms():[],Z=M.concat(B).concat(H),X=[];for(const we of Z)X.indexOf(we)<0&&X.push(we);const U=l?l.defines():[];f&&U.push("#define OVERDRAW_INSPECTOR;"),_&&U.push("#define TERRAIN3D;");const oe=U.concat(Ti.prelude.fragmentSource,n.fragmentSource).join(`
`),pe=U.concat(Ti.prelude.vertexSource,n.vertexSource).join(`
`),ee=v.createShader(v.FRAGMENT_SHADER);if(v.isContextLost())return void(this.failedToCreate=!0);if(v.shaderSource(ee,oe),v.compileShader(ee),!v.getShaderParameter(ee,v.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${v.getShaderInfoLog(ee)}`);v.attachShader(this.program,ee);const le=v.createShader(v.VERTEX_SHADER);if(v.isContextLost())return void(this.failedToCreate=!0);if(v.shaderSource(le,pe),v.compileShader(le),!v.getShaderParameter(le,v.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${v.getShaderInfoLog(le)}`);v.attachShader(this.program,le),this.attributes={};const _e={};this.numAttributes=P.length;for(let we=0;we<this.numAttributes;we++)P[we]&&(v.bindAttribLocation(this.program,we,P[we]),this.attributes[P[we]]=we);if(v.linkProgram(this.program),!v.getProgramParameter(this.program,v.LINK_STATUS))throw new Error(`Program failed to link: ${v.getProgramInfoLog(this.program)}`);v.deleteShader(le),v.deleteShader(ee);for(let we=0;we<X.length;we++){const Me=X[we];if(Me&&!_e[Me]){const Fe=v.getUniformLocation(this.program,Me);Fe&&(_e[Me]=Fe)}}this.fixedUniforms=u(t,_e),this.terrainUniforms=((we,Me)=>({u_depth:new o.aL(we,Me.u_depth),u_terrain:new o.aL(we,Me.u_terrain),u_terrain_dim:new o.aM(we,Me.u_terrain_dim),u_terrain_matrix:new o.aN(we,Me.u_terrain_matrix),u_terrain_unpack:new o.aO(we,Me.u_terrain_unpack),u_terrain_exaggeration:new o.aM(we,Me.u_terrain_exaggeration)}))(t,_e),this.binderUniforms=l?l.getUniforms(t,_e):[]}draw(t,n,l,u,f,_,v,S,T,P,M,B,H,Z,X,U,oe,pe){const ee=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(l),t.setStencilMode(u),t.setColorMode(f),t.setCullFace(_),S){t.activeTexture.set(ee.TEXTURE2),ee.bindTexture(ee.TEXTURE_2D,S.depthTexture),t.activeTexture.set(ee.TEXTURE3),ee.bindTexture(ee.TEXTURE_2D,S.texture);for(const _e in this.terrainUniforms)this.terrainUniforms[_e].set(S[_e])}for(const _e in this.fixedUniforms)this.fixedUniforms[_e].set(v[_e]);X&&X.setUniforms(t,this.binderUniforms,H,{zoom:Z});let le=0;switch(n){case ee.LINES:le=2;break;case ee.TRIANGLES:le=3;break;case ee.LINE_STRIP:le=1}for(const _e of B.get()){const we=_e.vaos||(_e.vaos={});(we[T]||(we[T]=new Xn)).bind(t,this,P,X?X.getPaintVertexBuffers():[],M,_e.vertexOffset,U,oe,pe),ee.drawElements(n,_e.primitiveLength*le,ee.UNSIGNED_SHORT,_e.primitiveOffset*le*2)}}}function Hr(d,t,n){const l=1/ne(n,1,t.transform.tileZoom),u=Math.pow(2,n.tileID.overscaledZ),f=n.tileSize*Math.pow(2,t.transform.tileZoom)/u,_=f*(n.tileID.canonical.x+n.tileID.wrap*u),v=f*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[l,d.fromScale,d.toScale],u_fade:d.t,u_pixel_coord_upper:[_>>16,v>>16],u_pixel_coord_lower:[65535&_,65535&v]}}const rs=(d,t,n,l)=>{const u=t.style.light,f=u.properties.get("position"),_=[f.x,f.y,f.z],v=function(){var T=new o.A(9);return o.A!=Float32Array&&(T[1]=0,T[2]=0,T[3]=0,T[5]=0,T[6]=0,T[7]=0),T[0]=1,T[4]=1,T[8]=1,T}();u.properties.get("anchor")==="viewport"&&function(T,P){var M=Math.sin(P),B=Math.cos(P);T[0]=B,T[1]=M,T[2]=0,T[3]=-M,T[4]=B,T[5]=0,T[6]=0,T[7]=0,T[8]=1}(v,-t.transform.angle),function(T,P,M){var B=P[0],H=P[1],Z=P[2];T[0]=B*M[0]+H*M[3]+Z*M[6],T[1]=B*M[1]+H*M[4]+Z*M[7],T[2]=B*M[2]+H*M[5]+Z*M[8]}(_,_,v);const S=u.properties.get("color");return{u_matrix:d,u_lightpos:_,u_lightintensity:u.properties.get("intensity"),u_lightcolor:[S.r,S.g,S.b],u_vertical_gradient:+n,u_opacity:l}},On=(d,t,n,l,u,f,_)=>o.e(rs(d,t,n,l),Hr(f,t,_),{u_height_factor:-Math.pow(2,u.overscaledZ)/_.tileSize/8}),bl=d=>({u_matrix:d}),ns=(d,t,n,l)=>o.e(bl(d),Hr(n,t,l)),fo=(d,t)=>({u_matrix:d,u_world:t}),mo=(d,t,n,l,u)=>o.e(ns(d,t,n,l),{u_world:u}),Bn=(d,t,n,l)=>{const u=d.transform;let f,_;if(l.paint.get("circle-pitch-alignment")==="map"){const v=ne(n,1,u.zoom);f=!0,_=[v,v]}else f=!1,_=u.pixelsToGLUnits;return{u_camera_to_center_distance:u.cameraToCenterDistance,u_scale_with_map:+(l.paint.get("circle-pitch-scale")==="map"),u_matrix:d.translatePosMatrix(t.posMatrix,n,l.paint.get("circle-translate"),l.paint.get("circle-translate-anchor")),u_pitch_with_map:+f,u_device_pixel_ratio:d.pixelRatio,u_extrude_scale:_}},as=(d,t,n)=>{const l=ne(n,1,t.zoom),u=Math.pow(2,t.zoom-n.tileID.overscaledZ),f=n.tileID.overscaleFactor();return{u_matrix:d,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:l,u_extrude_scale:[t.pixelsToGLUnits[0]/(l*u),t.pixelsToGLUnits[1]/(l*u)],u_overscale_factor:f}},Ra=(d,t,n=1)=>({u_matrix:d,u_color:t,u_overlay:0,u_overlay_scale:n}),wl=d=>({u_matrix:d}),Qc=(d,t,n,l)=>({u_matrix:d,u_extrude_scale:ne(t,1,n),u_intensity:l});function os(d,t){const n=Math.pow(2,t.canonical.z),l=t.canonical.y;return[new o.U(0,l/n).toLngLat().lat,new o.U(0,(l+1)/n).toLngLat().lat]}const ss=(d,t,n,l)=>{const u=d.transform;return{u_matrix:go(d,t,n,l),u_ratio:1/ne(t,1,u.zoom),u_device_pixel_ratio:d.pixelRatio,u_units_to_pixels:[1/u.pixelsToGLUnits[0],1/u.pixelsToGLUnits[1]]}},Sl=(d,t,n,l,u)=>o.e(ss(d,t,n,u),{u_image:0,u_image_height:l}),eu=(d,t,n,l,u)=>{const f=d.transform,_=Tl(t,f);return{u_matrix:go(d,t,n,u),u_texsize:t.imageAtlasTexture.size,u_ratio:1/ne(t,1,f.zoom),u_device_pixel_ratio:d.pixelRatio,u_image:0,u_scale:[_,l.fromScale,l.toScale],u_fade:l.t,u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]]}},Cl=(d,t,n,l,u,f)=>{const _=d.lineAtlas,v=Tl(t,d.transform),S=n.layout.get("line-cap")==="round",T=_.getDash(l.from,S),P=_.getDash(l.to,S),M=T.width*u.fromScale,B=P.width*u.toScale;return o.e(ss(d,t,n,f),{u_patternscale_a:[v/M,-T.height/2],u_patternscale_b:[v/B,-P.height/2],u_sdfgamma:_.width/(256*Math.min(M,B)*d.pixelRatio)/2,u_image:0,u_tex_y_a:T.y,u_tex_y_b:P.y,u_mix:u.t})};function Tl(d,t){return 1/ne(d,1,t.tileZoom)}function go(d,t,n,l){return d.translatePosMatrix(l?l.posMatrix:t.tileID.posMatrix,t,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const El=(d,t,n,l,u)=>{return{u_matrix:d,u_tl_parent:t,u_scale_parent:n,u_buffer_scale:1,u_fade_t:l.mix,u_opacity:l.opacity*u.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:u.paint.get("raster-brightness-min"),u_brightness_high:u.paint.get("raster-brightness-max"),u_saturation_factor:(_=u.paint.get("raster-saturation"),_>0?1-1/(1.001-_):-_),u_contrast_factor:(f=u.paint.get("raster-contrast"),f>0?1/(1-f):1+f),u_spin_weights:Il(u.paint.get("raster-hue-rotate"))};var f,_};function Il(d){d*=Math.PI/180;const t=Math.sin(d),n=Math.cos(d);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}const ls=(d,t,n,l,u,f,_,v,S,T)=>{const P=u.transform;return{u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:P.cameraToCenterDistance,u_pitch:P.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:P.width/P.height,u_fade_change:u.options.fadeDuration?u.symbolFadeChange:1,u_matrix:f,u_label_plane_matrix:_,u_coord_matrix:v,u_is_text:+S,u_pitch_with_map:+l,u_texsize:T,u_texture:0}},cs=(d,t,n,l,u,f,_,v,S,T,P)=>{const M=u.transform;return o.e(ls(d,t,n,l,u,f,_,v,S,T),{u_gamma_scale:l?Math.cos(M._pitch)*M.cameraToCenterDistance:1,u_device_pixel_ratio:u.pixelRatio,u_is_halo:+P})},Kn=(d,t,n,l,u,f,_,v,S,T)=>o.e(cs(d,t,n,l,u,f,_,v,!0,S,!0),{u_texsize_icon:T,u_texture_icon:1}),yo=(d,t,n)=>({u_matrix:d,u_opacity:t,u_color:n}),Wr=(d,t,n,l,u,f)=>o.e(function(_,v,S,T){const P=S.imageManager.getPattern(_.from.toString()),M=S.imageManager.getPattern(_.to.toString()),{width:B,height:H}=S.imageManager.getPixelSize(),Z=Math.pow(2,T.tileID.overscaledZ),X=T.tileSize*Math.pow(2,S.transform.tileZoom)/Z,U=X*(T.tileID.canonical.x+T.tileID.wrap*Z),oe=X*T.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:P.tl,u_pattern_br_a:P.br,u_pattern_tl_b:M.tl,u_pattern_br_b:M.br,u_texsize:[B,H],u_mix:v.t,u_pattern_size_a:P.displaySize,u_pattern_size_b:M.displaySize,u_scale_a:v.fromScale,u_scale_b:v.toScale,u_tile_units_to_pixels:1/ne(T,1,S.transform.tileZoom),u_pixel_coord_upper:[U>>16,oe>>16],u_pixel_coord_lower:[65535&U,65535&oe]}}(l,f,n,u),{u_matrix:d,u_opacity:t}),_o={fillExtrusion:(d,t)=>({u_matrix:new o.aN(d,t.u_matrix),u_lightpos:new o.aP(d,t.u_lightpos),u_lightintensity:new o.aM(d,t.u_lightintensity),u_lightcolor:new o.aP(d,t.u_lightcolor),u_vertical_gradient:new o.aM(d,t.u_vertical_gradient),u_opacity:new o.aM(d,t.u_opacity)}),fillExtrusionPattern:(d,t)=>({u_matrix:new o.aN(d,t.u_matrix),u_lightpos:new o.aP(d,t.u_lightpos),u_lightintensity:new o.aM(d,t.u_lightintensity),u_lightcolor:new o.aP(d,t.u_lightcolor),u_vertical_gradient:new o.aM(d,t.u_vertical_gradient),u_height_factor:new o.aM(d,t.u_height_factor),u_image:new o.aL(d,t.u_image),u_texsize:new o.aQ(d,t.u_texsize),u_pixel_coord_upper:new o.aQ(d,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.aQ(d,t.u_pixel_coord_lower),u_scale:new o.aP(d,t.u_scale),u_fade:new o.aM(d,t.u_fade),u_opacity:new o.aM(d,t.u_opacity)}),fill:(d,t)=>({u_matrix:new o.aN(d,t.u_matrix)}),fillPattern:(d,t)=>({u_matrix:new o.aN(d,t.u_matrix),u_image:new o.aL(d,t.u_image),u_texsize:new o.aQ(d,t.u_texsize),u_pixel_coord_upper:new o.aQ(d,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.aQ(d,t.u_pixel_coord_lower),u_scale:new o.aP(d,t.u_scale),u_fade:new o.aM(d,t.u_fade)}),fillOutline:(d,t)=>({u_matrix:new o.aN(d,t.u_matrix),u_world:new o.aQ(d,t.u_world)}),fillOutlinePattern:(d,t)=>({u_matrix:new o.aN(d,t.u_matrix),u_world:new o.aQ(d,t.u_world),u_image:new o.aL(d,t.u_image),u_texsize:new o.aQ(d,t.u_texsize),u_pixel_coord_upper:new o.aQ(d,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.aQ(d,t.u_pixel_coord_lower),u_scale:new o.aP(d,t.u_scale),u_fade:new o.aM(d,t.u_fade)}),circle:(d,t)=>({u_camera_to_center_distance:new o.aM(d,t.u_camera_to_center_distance),u_scale_with_map:new o.aL(d,t.u_scale_with_map),u_pitch_with_map:new o.aL(d,t.u_pitch_with_map),u_extrude_scale:new o.aQ(d,t.u_extrude_scale),u_device_pixel_ratio:new o.aM(d,t.u_device_pixel_ratio),u_matrix:new o.aN(d,t.u_matrix)}),collisionBox:(d,t)=>({u_matrix:new o.aN(d,t.u_matrix),u_camera_to_center_distance:new o.aM(d,t.u_camera_to_center_distance),u_pixels_to_tile_units:new o.aM(d,t.u_pixels_to_tile_units),u_extrude_scale:new o.aQ(d,t.u_extrude_scale),u_overscale_factor:new o.aM(d,t.u_overscale_factor)}),collisionCircle:(d,t)=>({u_matrix:new o.aN(d,t.u_matrix),u_inv_matrix:new o.aN(d,t.u_inv_matrix),u_camera_to_center_distance:new o.aM(d,t.u_camera_to_center_distance),u_viewport_size:new o.aQ(d,t.u_viewport_size)}),debug:(d,t)=>({u_color:new o.aR(d,t.u_color),u_matrix:new o.aN(d,t.u_matrix),u_overlay:new o.aL(d,t.u_overlay),u_overlay_scale:new o.aM(d,t.u_overlay_scale)}),clippingMask:(d,t)=>({u_matrix:new o.aN(d,t.u_matrix)}),heatmap:(d,t)=>({u_extrude_scale:new o.aM(d,t.u_extrude_scale),u_intensity:new o.aM(d,t.u_intensity),u_matrix:new o.aN(d,t.u_matrix)}),heatmapTexture:(d,t)=>({u_matrix:new o.aN(d,t.u_matrix),u_world:new o.aQ(d,t.u_world),u_image:new o.aL(d,t.u_image),u_color_ramp:new o.aL(d,t.u_color_ramp),u_opacity:new o.aM(d,t.u_opacity)}),hillshade:(d,t)=>({u_matrix:new o.aN(d,t.u_matrix),u_image:new o.aL(d,t.u_image),u_latrange:new o.aQ(d,t.u_latrange),u_light:new o.aQ(d,t.u_light),u_shadow:new o.aR(d,t.u_shadow),u_highlight:new o.aR(d,t.u_highlight),u_accent:new o.aR(d,t.u_accent)}),hillshadePrepare:(d,t)=>({u_matrix:new o.aN(d,t.u_matrix),u_image:new o.aL(d,t.u_image),u_dimension:new o.aQ(d,t.u_dimension),u_zoom:new o.aM(d,t.u_zoom),u_unpack:new o.aO(d,t.u_unpack)}),line:(d,t)=>({u_matrix:new o.aN(d,t.u_matrix),u_ratio:new o.aM(d,t.u_ratio),u_device_pixel_ratio:new o.aM(d,t.u_device_pixel_ratio),u_units_to_pixels:new o.aQ(d,t.u_units_to_pixels)}),lineGradient:(d,t)=>({u_matrix:new o.aN(d,t.u_matrix),u_ratio:new o.aM(d,t.u_ratio),u_device_pixel_ratio:new o.aM(d,t.u_device_pixel_ratio),u_units_to_pixels:new o.aQ(d,t.u_units_to_pixels),u_image:new o.aL(d,t.u_image),u_image_height:new o.aM(d,t.u_image_height)}),linePattern:(d,t)=>({u_matrix:new o.aN(d,t.u_matrix),u_texsize:new o.aQ(d,t.u_texsize),u_ratio:new o.aM(d,t.u_ratio),u_device_pixel_ratio:new o.aM(d,t.u_device_pixel_ratio),u_image:new o.aL(d,t.u_image),u_units_to_pixels:new o.aQ(d,t.u_units_to_pixels),u_scale:new o.aP(d,t.u_scale),u_fade:new o.aM(d,t.u_fade)}),lineSDF:(d,t)=>({u_matrix:new o.aN(d,t.u_matrix),u_ratio:new o.aM(d,t.u_ratio),u_device_pixel_ratio:new o.aM(d,t.u_device_pixel_ratio),u_units_to_pixels:new o.aQ(d,t.u_units_to_pixels),u_patternscale_a:new o.aQ(d,t.u_patternscale_a),u_patternscale_b:new o.aQ(d,t.u_patternscale_b),u_sdfgamma:new o.aM(d,t.u_sdfgamma),u_image:new o.aL(d,t.u_image),u_tex_y_a:new o.aM(d,t.u_tex_y_a),u_tex_y_b:new o.aM(d,t.u_tex_y_b),u_mix:new o.aM(d,t.u_mix)}),raster:(d,t)=>({u_matrix:new o.aN(d,t.u_matrix),u_tl_parent:new o.aQ(d,t.u_tl_parent),u_scale_parent:new o.aM(d,t.u_scale_parent),u_buffer_scale:new o.aM(d,t.u_buffer_scale),u_fade_t:new o.aM(d,t.u_fade_t),u_opacity:new o.aM(d,t.u_opacity),u_image0:new o.aL(d,t.u_image0),u_image1:new o.aL(d,t.u_image1),u_brightness_low:new o.aM(d,t.u_brightness_low),u_brightness_high:new o.aM(d,t.u_brightness_high),u_saturation_factor:new o.aM(d,t.u_saturation_factor),u_contrast_factor:new o.aM(d,t.u_contrast_factor),u_spin_weights:new o.aP(d,t.u_spin_weights)}),symbolIcon:(d,t)=>({u_is_size_zoom_constant:new o.aL(d,t.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aL(d,t.u_is_size_feature_constant),u_size_t:new o.aM(d,t.u_size_t),u_size:new o.aM(d,t.u_size),u_camera_to_center_distance:new o.aM(d,t.u_camera_to_center_distance),u_pitch:new o.aM(d,t.u_pitch),u_rotate_symbol:new o.aL(d,t.u_rotate_symbol),u_aspect_ratio:new o.aM(d,t.u_aspect_ratio),u_fade_change:new o.aM(d,t.u_fade_change),u_matrix:new o.aN(d,t.u_matrix),u_label_plane_matrix:new o.aN(d,t.u_label_plane_matrix),u_coord_matrix:new o.aN(d,t.u_coord_matrix),u_is_text:new o.aL(d,t.u_is_text),u_pitch_with_map:new o.aL(d,t.u_pitch_with_map),u_texsize:new o.aQ(d,t.u_texsize),u_texture:new o.aL(d,t.u_texture)}),symbolSDF:(d,t)=>({u_is_size_zoom_constant:new o.aL(d,t.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aL(d,t.u_is_size_feature_constant),u_size_t:new o.aM(d,t.u_size_t),u_size:new o.aM(d,t.u_size),u_camera_to_center_distance:new o.aM(d,t.u_camera_to_center_distance),u_pitch:new o.aM(d,t.u_pitch),u_rotate_symbol:new o.aL(d,t.u_rotate_symbol),u_aspect_ratio:new o.aM(d,t.u_aspect_ratio),u_fade_change:new o.aM(d,t.u_fade_change),u_matrix:new o.aN(d,t.u_matrix),u_label_plane_matrix:new o.aN(d,t.u_label_plane_matrix),u_coord_matrix:new o.aN(d,t.u_coord_matrix),u_is_text:new o.aL(d,t.u_is_text),u_pitch_with_map:new o.aL(d,t.u_pitch_with_map),u_texsize:new o.aQ(d,t.u_texsize),u_texture:new o.aL(d,t.u_texture),u_gamma_scale:new o.aM(d,t.u_gamma_scale),u_device_pixel_ratio:new o.aM(d,t.u_device_pixel_ratio),u_is_halo:new o.aL(d,t.u_is_halo)}),symbolTextAndIcon:(d,t)=>({u_is_size_zoom_constant:new o.aL(d,t.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aL(d,t.u_is_size_feature_constant),u_size_t:new o.aM(d,t.u_size_t),u_size:new o.aM(d,t.u_size),u_camera_to_center_distance:new o.aM(d,t.u_camera_to_center_distance),u_pitch:new o.aM(d,t.u_pitch),u_rotate_symbol:new o.aL(d,t.u_rotate_symbol),u_aspect_ratio:new o.aM(d,t.u_aspect_ratio),u_fade_change:new o.aM(d,t.u_fade_change),u_matrix:new o.aN(d,t.u_matrix),u_label_plane_matrix:new o.aN(d,t.u_label_plane_matrix),u_coord_matrix:new o.aN(d,t.u_coord_matrix),u_is_text:new o.aL(d,t.u_is_text),u_pitch_with_map:new o.aL(d,t.u_pitch_with_map),u_texsize:new o.aQ(d,t.u_texsize),u_texsize_icon:new o.aQ(d,t.u_texsize_icon),u_texture:new o.aL(d,t.u_texture),u_texture_icon:new o.aL(d,t.u_texture_icon),u_gamma_scale:new o.aM(d,t.u_gamma_scale),u_device_pixel_ratio:new o.aM(d,t.u_device_pixel_ratio),u_is_halo:new o.aL(d,t.u_is_halo)}),background:(d,t)=>({u_matrix:new o.aN(d,t.u_matrix),u_opacity:new o.aM(d,t.u_opacity),u_color:new o.aR(d,t.u_color)}),backgroundPattern:(d,t)=>({u_matrix:new o.aN(d,t.u_matrix),u_opacity:new o.aM(d,t.u_opacity),u_image:new o.aL(d,t.u_image),u_pattern_tl_a:new o.aQ(d,t.u_pattern_tl_a),u_pattern_br_a:new o.aQ(d,t.u_pattern_br_a),u_pattern_tl_b:new o.aQ(d,t.u_pattern_tl_b),u_pattern_br_b:new o.aQ(d,t.u_pattern_br_b),u_texsize:new o.aQ(d,t.u_texsize),u_mix:new o.aM(d,t.u_mix),u_pattern_size_a:new o.aQ(d,t.u_pattern_size_a),u_pattern_size_b:new o.aQ(d,t.u_pattern_size_b),u_scale_a:new o.aM(d,t.u_scale_a),u_scale_b:new o.aM(d,t.u_scale_b),u_pixel_coord_upper:new o.aQ(d,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.aQ(d,t.u_pixel_coord_lower),u_tile_units_to_pixels:new o.aM(d,t.u_tile_units_to_pixels)}),terrain:(d,t)=>({u_matrix:new o.aN(d,t.u_matrix),u_texture:new o.aL(d,t.u_texture),u_ele_delta:new o.aM(d,t.u_ele_delta)}),terrainDepth:(d,t)=>({u_matrix:new o.aN(d,t.u_matrix),u_ele_delta:new o.aM(d,t.u_ele_delta)}),terrainCoords:(d,t)=>({u_matrix:new o.aN(d,t.u_matrix),u_texture:new o.aL(d,t.u_texture),u_terrain_coords_id:new o.aM(d,t.u_terrain_coords_id),u_ele_delta:new o.aM(d,t.u_ele_delta)})};class vo{constructor(t,n,l){this.context=t;const u=t.gl;this.buffer=u.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),u.bufferData(u.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?u.DYNAMIC_DRAW:u.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const n=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const $a={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class xo{constructor(t,n,l,u){this.length=n.length,this.attributes=l,this.itemSize=n.bytesPerElement,this.dynamicDraw=u,this.context=t;const f=t.gl;this.buffer=f.createBuffer(),t.bindVertexBuffer.set(this.buffer),f.bufferData(f.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,n){for(let l=0;l<this.attributes.length;l++){const u=n.attributes[this.attributes[l].name];u!==void 0&&t.enableVertexAttribArray(u)}}setVertexAttribPointers(t,n,l){for(let u=0;u<this.attributes.length;u++){const f=this.attributes[u],_=n.attributes[f.name];_!==void 0&&t.vertexAttribPointer(_,f.components,t[$a[f.type]],!1,this.itemSize,f.offset+this.itemSize*(l||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const pa=new WeakMap;function Fn(d){var t;if(pa.has(d))return pa.get(d);{const n=(t=d.getParameter(d.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return pa.set(d,n),n}}class Xt{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class bo extends Xt{getDefault(){return o.aT.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Dr extends Xt{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Rr extends Xt{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class us extends Xt{getDefault(){return[!0,!0,!0,!0]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class wo extends Xt{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class So extends Xt{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class hs extends Xt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const n=this.current;(t.func!==n.func||t.ref!==n.ref||t.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class ds extends Xt{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Co extends Xt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=t,this.dirty=!1}}class ps extends Xt{getDefault(){return[0,1]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class fs extends Xt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=t,this.dirty=!1}}class To extends Xt{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Pl extends Xt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.BLEND):n.disable(n.BLEND),this.current=t,this.dirty=!1}}class Ml extends Xt{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class fa extends Xt{getDefault(){return o.aT.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class tu extends Xt{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class iu extends Xt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=t,this.dirty=!1}}class ru extends Xt{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class nu extends Xt{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class au extends Xt{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class ou extends Xt{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class ms extends Xt{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Eo extends Xt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class gs extends Xt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class ys extends Xt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class ma extends Xt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Al extends Xt{getDefault(){return null}set(t){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class kl extends Xt{getDefault(){return null}set(t){var n;if(t===this.current&&!this.dirty)return;const l=this.gl;Fn(l)?l.bindVertexArray(t):(n=l.getExtension("OES_vertex_array_object"))===null||n===void 0||n.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class _s extends Xt{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Yn extends Xt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class zl extends Xt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Nn extends Xt{constructor(t,n){super(t),this.context=t,this.parent=n}getDefault(){return null}}class ga extends Nn{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Ll extends Nn{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class vs extends Nn{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class ai{constructor(t,n,l,u,f){this.context=t,this.width=n,this.height=l;const _=t.gl,v=this.framebuffer=_.createFramebuffer();if(this.colorAttachment=new ga(t,v),u)this.depthAttachment=f?new vs(t,v):new Ll(t,v);else if(f)throw new Error("Stencil cannot be setted without depth");if(_.checkFramebufferStatus(_.FRAMEBUFFER)!==_.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,n=this.colorAttachment.get();if(n&&t.deleteTexture(n),this.depthAttachment){const l=this.depthAttachment.get();l&&t.deleteRenderbuffer(l)}t.deleteFramebuffer(this.framebuffer)}}class Ei{constructor(t,n,l){this.blendFunction=t,this.blendColor=n,this.mask=l}}Ei.Replace=[1,0],Ei.disabled=new Ei(Ei.Replace,o.aT.transparent,[!1,!1,!1,!1]),Ei.unblended=new Ei(Ei.Replace,o.aT.transparent,[!0,!0,!0,!0]),Ei.alphaBlended=new Ei([1,771],o.aT.transparent,[!0,!0,!0,!0]);class su{constructor(t){var n,l;if(this.gl=t,this.clearColor=new bo(this),this.clearDepth=new Dr(this),this.clearStencil=new Rr(this),this.colorMask=new us(this),this.depthMask=new wo(this),this.stencilMask=new So(this),this.stencilFunc=new hs(this),this.stencilOp=new ds(this),this.stencilTest=new Co(this),this.depthRange=new ps(this),this.depthTest=new fs(this),this.depthFunc=new To(this),this.blend=new Pl(this),this.blendFunc=new Ml(this),this.blendColor=new fa(this),this.blendEquation=new tu(this),this.cullFace=new iu(this),this.cullFaceSide=new ru(this),this.frontFace=new nu(this),this.program=new au(this),this.activeTexture=new ou(this),this.viewport=new ms(this),this.bindFramebuffer=new Eo(this),this.bindRenderbuffer=new gs(this),this.bindTexture=new ys(this),this.bindVertexBuffer=new ma(this),this.bindElementBuffer=new Al(this),this.bindVertexArray=new kl(this),this.pixelStoreUnpack=new _s(this),this.pixelStoreUnpackPremultiplyAlpha=new Yn(this),this.pixelStoreUnpackFlipY=new zl(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),Fn(t)){this.HALF_FLOAT=t.HALF_FLOAT;const u=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(n=t.RGBA16F)!==null&&n!==void 0?n:u?.RGBA16F_EXT,this.RGB16F=(l=t.RGB16F)!==null&&l!==void 0?l:u?.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const u=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=u?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,n){return new vo(this,t,n)}createVertexBuffer(t,n,l){return new xo(this,t,n,l)}createRenderbuffer(t,n,l){const u=this.gl,f=u.createRenderbuffer();return this.bindRenderbuffer.set(f),u.renderbufferStorage(u.RENDERBUFFER,t,n,l),this.bindRenderbuffer.set(null),f}createFramebuffer(t,n,l,u){return new ai(this,t,n,l,u)}clear({color:t,depth:n,stencil:l}){const u=this.gl;let f=0;t&&(f|=u.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),n!==void 0&&(f|=u.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),l!==void 0&&(f|=u.STENCIL_BUFFER_BIT,this.clearStencil.set(l),this.stencilMask.set(255)),u.clear(f)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){o.aG(t.blendFunction,Ei.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return Fn(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var n;return Fn(this.gl)?this.gl.deleteVertexArray(t):(n=this.gl.getExtension("OES_vertex_array_object"))===null||n===void 0?void 0:n.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}class Kt{constructor(t,n,l){this.func=t,this.mask=n,this.range=l}}Kt.ReadOnly=!1,Kt.ReadWrite=!0,Kt.disabled=new Kt(519,Kt.ReadOnly,[0,1]);const Jn=7680;class Ii{constructor(t,n,l,u,f,_){this.test=t,this.ref=n,this.mask=l,this.fail=u,this.depthFail=f,this.pass=_}}Ii.disabled=new Ii({func:519,mask:0},0,0,Jn,Jn,Jn);class Si{constructor(t,n,l){this.enable=t,this.mode=n,this.frontFace=l}}let Oa;function Dl(d,t,n,l,u,f,_){const v=d.context,S=v.gl,T=d.useProgram("collisionBox"),P=[];let M=0,B=0;for(let ee=0;ee<l.length;ee++){const le=l[ee],_e=t.getTile(le),we=_e.getBucket(n);if(!we)continue;let Me=le.posMatrix;u[0]===0&&u[1]===0||(Me=d.translatePosMatrix(le.posMatrix,_e,u,f));const Fe=_?we.textCollisionBox:we.iconCollisionBox,Re=we.collisionCircleArray;if(Re.length>0){const Ue=o.Z(),lt=Me;o.aU(Ue,we.placementInvProjMatrix,d.transform.glCoordMatrix),o.aU(Ue,Ue,we.placementViewportMatrix),P.push({circleArray:Re,circleOffset:B,transform:lt,invTransform:Ue,coord:le}),M+=Re.length/4,B=M}Fe&&T.draw(v,S.LINES,Kt.disabled,Ii.disabled,d.colorModeForRenderPass(),Si.disabled,as(Me,d.transform,_e),d.style.map.terrain&&d.style.map.terrain.getTerrainData(le),n.id,Fe.layoutVertexBuffer,Fe.indexBuffer,Fe.segments,null,d.transform.zoom,null,null,Fe.collisionVertexBuffer)}if(!_||!P.length)return;const H=d.useProgram("collisionCircle"),Z=new o.aV;Z.resize(4*M),Z._trim();let X=0;for(const ee of P)for(let le=0;le<ee.circleArray.length/4;le++){const _e=4*le,we=ee.circleArray[_e+0],Me=ee.circleArray[_e+1],Fe=ee.circleArray[_e+2],Re=ee.circleArray[_e+3];Z.emplace(X++,we,Me,Fe,Re,0),Z.emplace(X++,we,Me,Fe,Re,1),Z.emplace(X++,we,Me,Fe,Re,2),Z.emplace(X++,we,Me,Fe,Re,3)}(!Oa||Oa.length<2*M)&&(Oa=function(ee){const le=2*ee,_e=new o.aX;_e.resize(le),_e._trim();for(let we=0;we<le;we++){const Me=6*we;_e.uint16[Me+0]=4*we+0,_e.uint16[Me+1]=4*we+1,_e.uint16[Me+2]=4*we+2,_e.uint16[Me+3]=4*we+2,_e.uint16[Me+4]=4*we+3,_e.uint16[Me+5]=4*we+0}return _e}(M));const U=v.createIndexBuffer(Oa,!0),oe=v.createVertexBuffer(Z,o.aW.members,!0);for(const ee of P){const le={u_matrix:ee.transform,u_inv_matrix:ee.invTransform,u_camera_to_center_distance:(pe=d.transform).cameraToCenterDistance,u_viewport_size:[pe.width,pe.height]};H.draw(v,S.TRIANGLES,Kt.disabled,Ii.disabled,d.colorModeForRenderPass(),Si.disabled,le,d.style.map.terrain&&d.style.map.terrain.getTerrainData(ee.coord),n.id,oe,U,o.S.simpleSegment(0,2*ee.circleOffset,ee.circleArray.length,ee.circleArray.length/2),null,d.transform.zoom,null,null,null)}var pe;oe.destroy(),U.destroy()}Si.disabled=new Si(!1,1029,2305),Si.backCCW=new Si(!0,1029,2305);const xs=o.ao(new Float32Array(16));function Io(d,t,n,l,u,f){const{horizontalAlign:_,verticalAlign:v}=o.au(d);return new o.P((-(_-.5)*t/u+l[0])*f,(-(v-.5)*n/u+l[1])*f)}function Po(d,t,n,l,u,f,_,v,S,T,P){const M=d.text.placedSymbolArray,B=d.text.dynamicLayoutVertexArray,H=d.icon.dynamicLayoutVertexArray,Z={};B.clear();for(let X=0;X<M.length;X++){const U=M.get(X),oe=U.hidden||!U.crossTileID||d.allowVerticalPlacement&&!U.placedOrientation?null:l[U.crossTileID];if(oe){const pe=new o.P(U.anchorX,U.anchorY),ee=St(pe,n?_:f,P),le=Jt(u.cameraToCenterDistance,ee.signedDistanceFromCamera);let _e=o.aj(d.textSizeData,S,U)*le/o.ap;n&&(_e*=d.tilePixelRatio/v);const{width:we,height:Me,anchor:Fe,textOffset:Re,textBoxScale:Ue}=oe,lt=Io(Fe,we,Me,Re,Ue,_e),Ut=n?St(pe.add(lt),f,P).point:ee.point.add(t?lt.rotate(-u.angle):lt),We=d.allowVerticalPlacement&&U.placedOrientation===o.ai.vertical?Math.PI/2:0;for(let bt=0;bt<U.numGlyphs;bt++)o.ak(B,Ut,We);T&&U.associatedIconIndex>=0&&(Z[U.associatedIconIndex]={shiftedAnchor:Ut,angle:We})}else j(U.numGlyphs,B)}if(T){H.clear();const X=d.icon.placedSymbolArray;for(let U=0;U<X.length;U++){const oe=X.get(U);if(oe.hidden)j(oe.numGlyphs,H);else{const pe=Z[U];if(pe)for(let ee=0;ee<oe.numGlyphs;ee++)o.ak(H,pe.shiftedAnchor,pe.angle);else j(oe.numGlyphs,H)}}d.icon.dynamicLayoutVertexBuffer.updateData(H)}d.text.dynamicLayoutVertexBuffer.updateData(B)}function bs(d,t,n){return n.iconsInText&&t?"symbolTextAndIcon":d?"symbolSDF":"symbolIcon"}function Mo(d,t,n,l,u,f,_,v,S,T,P,M){const B=d.context,H=B.gl,Z=d.transform,X=v==="map",U=S==="map",oe=v!=="viewport"&&n.layout.get("symbol-placement")!=="point",pe=X&&!U&&!oe,ee=!n.layout.get("symbol-sort-key").isConstant();let le=!1;const _e=d.depthModeForSublayer(0,Kt.ReadOnly),we=n._unevaluatedLayout.hasValue("text-variable-anchor")||n._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Me=[];for(const Fe of l){const Re=t.getTile(Fe),Ue=Re.getBucket(n);if(!Ue)continue;const lt=u?Ue.text:Ue.icon;if(!lt||!lt.segments.get().length||!lt.hasVisibleVertices)continue;const Ut=lt.programConfigurations.get(n.id),We=u||Ue.sdfIcons,bt=u?Ue.textSizeData:Ue.iconSizeData,ut=U||Z.pitch!==0,hi=d.useProgram(bs(We,u,Ue),Ut),Vt=o.ah(bt,Z.zoom),Dt=d.style.map.terrain&&d.style.map.terrain.getTerrainData(Fe);let qt,$i,fi,lr,Yi=[0,0],Vi=null;if(u)$i=Re.glyphAtlasTexture,fi=H.LINEAR,qt=Re.glyphAtlasTexture.size,Ue.iconsInText&&(Yi=Re.imageAtlasTexture.size,Vi=Re.imageAtlasTexture,lr=ut||d.options.rotating||d.options.zooming||bt.kind==="composite"||bt.kind==="camera"?H.LINEAR:H.NEAREST);else{const Oi=n.layout.get("icon-size").constantOr(0)!==1||Ue.iconsNeedLinear;$i=Re.imageAtlasTexture,fi=We||d.options.rotating||d.options.zooming||Oi||ut?H.LINEAR:H.NEAREST,qt=Re.imageAtlasTexture.size}const Br=ne(Re,1,d.transform.zoom),vi=Ve(Fe.posMatrix,U,X,d.transform,Br),hn=Et(Fe.posMatrix,U,X,d.transform,Br),dn=we&&Ue.hasTextData(),Un=n.layout.get("icon-text-fit")!=="none"&&dn&&Ue.hasIconData();if(oe){const Oi=d.style.map.terrain?(Ir,Bi)=>d.style.map.terrain.getElevation(Fe,Ir,Bi):null,Ji=n.layout.get("text-rotation-alignment")==="map";Le(Ue,Fe.posMatrix,d,u,vi,hn,U,T,Ji,Oi)}const ra=d.translatePosMatrix(Fe.posMatrix,Re,f,_),Sa=oe||u&&we||Un?xs:vi,dr=d.translatePosMatrix(hn,Re,f,_,!0),cr=We&&n.paint.get(u?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let _r;_r=We?Ue.iconsInText?Kn(bt.kind,Vt,pe,U,d,ra,Sa,dr,qt,Yi):cs(bt.kind,Vt,pe,U,d,ra,Sa,dr,u,qt,!0):ls(bt.kind,Vt,pe,U,d,ra,Sa,dr,u,qt);const na={program:hi,buffers:lt,uniformValues:_r,atlasTexture:$i,atlasTextureIcon:Vi,atlasInterpolation:fi,atlasInterpolationIcon:lr,isSDF:We,hasHalo:cr};if(ee&&Ue.canOverlap){le=!0;const Oi=lt.segments.get();for(const Ji of Oi)Me.push({segments:new o.S([Ji]),sortKey:Ji.sortKey,state:na,terrainData:Dt})}else Me.push({segments:lt.segments,sortKey:0,state:na,terrainData:Dt})}le&&Me.sort((Fe,Re)=>Fe.sortKey-Re.sortKey);for(const Fe of Me){const Re=Fe.state;if(B.activeTexture.set(H.TEXTURE0),Re.atlasTexture.bind(Re.atlasInterpolation,H.CLAMP_TO_EDGE),Re.atlasTextureIcon&&(B.activeTexture.set(H.TEXTURE1),Re.atlasTextureIcon&&Re.atlasTextureIcon.bind(Re.atlasInterpolationIcon,H.CLAMP_TO_EDGE)),Re.isSDF){const Ue=Re.uniformValues;Re.hasHalo&&(Ue.u_is_halo=1,ws(Re.buffers,Fe.segments,n,d,Re.program,_e,P,M,Ue,Fe.terrainData)),Ue.u_is_halo=0}ws(Re.buffers,Fe.segments,n,d,Re.program,_e,P,M,Re.uniformValues,Fe.terrainData)}}function ws(d,t,n,l,u,f,_,v,S,T){const P=l.context;u.draw(P,P.gl.TRIANGLES,f,_,v,Si.disabled,S,T,n.id,d.layoutVertexBuffer,d.indexBuffer,t,n.paint,l.transform.zoom,d.programConfigurations.get(n.id),d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer)}function Ba(d,t,n,l,u){if(!n||!l||!l.imageAtlas)return;const f=l.imageAtlas.patternPositions;let _=f[n.to.toString()],v=f[n.from.toString()];if(!_&&v&&(_=v),!v&&_&&(v=_),!_||!v){const S=u.getPaintProperty(t);_=f[S],v=f[S]}_&&v&&d.setConstantPatternPositions(_,v)}function Fa(d,t,n,l,u,f,_){const v=d.context.gl,S="fill-pattern",T=n.paint.get(S),P=T&&T.constantOr(1),M=n.getCrossfadeParameters();let B,H,Z,X,U;_?(H=P&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=v.LINES):(H=P?"fillPattern":"fill",B=v.TRIANGLES);const oe=T.constantOr(null);for(const pe of l){const ee=t.getTile(pe);if(P&&!ee.patternsLoaded())continue;const le=ee.getBucket(n);if(!le)continue;const _e=le.programConfigurations.get(n.id),we=d.useProgram(H,_e),Me=d.style.map.terrain&&d.style.map.terrain.getTerrainData(pe);P&&(d.context.activeTexture.set(v.TEXTURE0),ee.imageAtlasTexture.bind(v.LINEAR,v.CLAMP_TO_EDGE),_e.updatePaintBuffers(M)),Ba(_e,S,oe,ee,n);const Fe=Me?pe:null,Re=d.translatePosMatrix(Fe?Fe.posMatrix:pe.posMatrix,ee,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));if(_){X=le.indexBuffer2,U=le.segments2;const Ue=[v.drawingBufferWidth,v.drawingBufferHeight];Z=H==="fillOutlinePattern"&&P?mo(Re,d,M,ee,Ue):fo(Re,Ue)}else X=le.indexBuffer,U=le.segments,Z=P?ns(Re,d,M,ee):bl(Re);we.draw(d.context,B,u,d.stencilModeForClipping(pe),f,Si.disabled,Z,Me,n.id,le.layoutVertexBuffer,X,U,n.paint,d.transform.zoom,_e)}}function Na(d,t,n,l,u,f,_){const v=d.context,S=v.gl,T="fill-extrusion-pattern",P=n.paint.get(T),M=P.constantOr(1),B=n.getCrossfadeParameters(),H=n.paint.get("fill-extrusion-opacity"),Z=P.constantOr(null);for(const X of l){const U=t.getTile(X),oe=U.getBucket(n);if(!oe)continue;const pe=d.style.map.terrain&&d.style.map.terrain.getTerrainData(X),ee=oe.programConfigurations.get(n.id),le=d.useProgram(M?"fillExtrusionPattern":"fillExtrusion",ee);M&&(d.context.activeTexture.set(S.TEXTURE0),U.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),ee.updatePaintBuffers(B)),Ba(ee,T,Z,U,n);const _e=d.translatePosMatrix(X.posMatrix,U,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),we=n.paint.get("fill-extrusion-vertical-gradient"),Me=M?On(_e,d,we,H,X,B,U):rs(_e,d,we,H);le.draw(v,v.gl.TRIANGLES,u,f,_,Si.backCCW,Me,pe,n.id,oe.layoutVertexBuffer,oe.indexBuffer,oe.segments,n.paint,d.transform.zoom,ee,d.style.map.terrain&&oe.centroidVertexBuffer)}}function lu(d,t,n,l,u,f,_){const v=d.context,S=v.gl,T=n.fbo;if(!T)return;const P=d.useProgram("hillshade"),M=d.style.map.terrain&&d.style.map.terrain.getTerrainData(t);v.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,T.colorAttachment.get()),P.draw(v,S.TRIANGLES,u,f,_,Si.disabled,((B,H,Z,X)=>{const U=Z.paint.get("hillshade-shadow-color"),oe=Z.paint.get("hillshade-highlight-color"),pe=Z.paint.get("hillshade-accent-color");let ee=Z.paint.get("hillshade-illumination-direction")*(Math.PI/180);Z.paint.get("hillshade-illumination-anchor")==="viewport"&&(ee-=B.transform.angle);const le=!B.options.moving;return{u_matrix:X?X.posMatrix:B.transform.calculatePosMatrix(H.tileID.toUnwrapped(),le),u_image:0,u_latrange:os(0,H.tileID),u_light:[Z.paint.get("hillshade-exaggeration"),ee],u_shadow:U,u_highlight:oe,u_accent:pe}})(d,n,l,M?t:null),M,l.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments)}function Ss(d,t,n,l,u,f){const _=d.context,v=_.gl,S=t.dem;if(S&&S.data){const T=S.dim,P=S.stride,M=S.getPixels();if(_.activeTexture.set(v.TEXTURE1),_.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||d.getTileTexture(P),t.demTexture){const H=t.demTexture;H.update(M,{premultiply:!1}),H.bind(v.NEAREST,v.CLAMP_TO_EDGE)}else t.demTexture=new Ce(_,M,v.RGBA,{premultiply:!1}),t.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE);_.activeTexture.set(v.TEXTURE0);let B=t.fbo;if(!B){const H=new Ce(_,{width:T,height:T,data:null},v.RGBA);H.bind(v.LINEAR,v.CLAMP_TO_EDGE),B=t.fbo=_.createFramebuffer(T,T,!0,!1),B.colorAttachment.set(H.texture)}_.bindFramebuffer.set(B.framebuffer),_.viewport.set([0,0,T,T]),d.useProgram("hillshadePrepare").draw(_,v.TRIANGLES,l,u,f,Si.disabled,((H,Z)=>{const X=Z.stride,U=o.Z();return o.aS(U,0,o.N,-o.N,0,0,1),o.$(U,U,[0,-o.N,0]),{u_matrix:U,u_image:1,u_dimension:[X,X],u_zoom:H.overscaledZ,u_unpack:Z.getUnpackVector()}})(t.tileID,S),null,n.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function cu(d,t,n,l,u,f){const _=l.paint.get("raster-fade-duration");if(!f&&_>0){const v=o.h.now(),S=(v-d.timeAdded)/_,T=t?(v-t.timeAdded)/_:-1,P=n.getSource(),M=u.coveringZoomLevel({tileSize:P.tileSize,roundZoom:P.roundZoom}),B=!t||Math.abs(t.tileID.overscaledZ-M)>Math.abs(d.tileID.overscaledZ-M),H=B&&d.refreshedUponExpiration?1:o.ad(B?S:1-T,0,1);return d.refreshedUponExpiration&&S>=1&&(d.refreshedUponExpiration=!1),t?{opacity:1,mix:1-H}:{opacity:H,mix:0}}return{opacity:1,mix:0}}const Rl=new o.aT(1,0,0,1),Ao=new o.aT(0,1,0,1),Cs=new o.aT(0,0,1,1),$l=new o.aT(1,0,1,1),Ol=new o.aT(0,1,1,1);function ja(d,t,n,l){zo(d,0,t+n/2,d.transform.width,n,l)}function ko(d,t,n,l){zo(d,t-n/2,0,n,d.transform.height,l)}function zo(d,t,n,l,u,f){const _=d.context,v=_.gl;v.enable(v.SCISSOR_TEST),v.scissor(t*d.pixelRatio,n*d.pixelRatio,l*d.pixelRatio,u*d.pixelRatio),_.clear({color:f}),v.disable(v.SCISSOR_TEST)}function Bl(d,t,n){const l=d.context,u=l.gl,f=n.posMatrix,_=d.useProgram("debug"),v=Kt.disabled,S=Ii.disabled,T=d.colorModeForRenderPass(),P="$debug",M=d.style.map.terrain&&d.style.map.terrain.getTerrainData(n);l.activeTexture.set(u.TEXTURE0);const B=t.getTileByID(n.key).latestRawTileData,H=Math.floor((B&&B.byteLength||0)/1024),Z=t.getTile(n).tileSize,X=512/Math.min(Z,512)*(n.overscaledZ/d.transform.zoom)*.5;let U=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(U+=` => ${n.overscaledZ}`),function(oe,pe){oe.initDebugOverlayCanvas();const ee=oe.debugOverlayCanvas,le=oe.context.gl,_e=oe.debugOverlayCanvas.getContext("2d");_e.clearRect(0,0,ee.width,ee.height),_e.shadowColor="white",_e.shadowBlur=2,_e.lineWidth=1.5,_e.strokeStyle="white",_e.textBaseline="top",_e.font="bold 36px Open Sans, sans-serif",_e.fillText(pe,5,5),_e.strokeText(pe,5,5),oe.debugOverlayTexture.update(ee),oe.debugOverlayTexture.bind(le.LINEAR,le.CLAMP_TO_EDGE)}(d,`${U} ${H}kB`),_.draw(l,u.TRIANGLES,v,S,Ei.alphaBlended,Si.disabled,Ra(f,o.aT.transparent,X),null,P,d.debugBuffer,d.quadTriangleIndexBuffer,d.debugSegments),_.draw(l,u.LINE_STRIP,v,S,T,Si.disabled,Ra(f,o.aT.red),M,P,d.debugBuffer,d.tileBorderIndexBuffer,d.debugSegments)}function ki(d,t,n){const l=d.context,u=l.gl,f=d.colorModeForRenderPass(),_=new Kt(u.LEQUAL,Kt.ReadWrite,d.depthRangeFor3D),v=d.useProgram("terrain"),S=t.getTerrainMesh();l.bindFramebuffer.set(null),l.viewport.set([0,0,d.width,d.height]);for(const T of n){const P=d.renderToTexture.getTexture(T),M=t.getTerrainData(T.tileID);l.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,P.texture);const B={u_matrix:d.transform.calculatePosMatrix(T.tileID.toUnwrapped()),u_texture:0,u_ele_delta:t.getMeshFrameDelta(d.transform.zoom)};v.draw(l,u.TRIANGLES,_,Ii.disabled,f,Si.backCCW,B,M,"terrain",S.vertexBuffer,S.indexBuffer,S.segments)}}class Qn{constructor(t,n){this.context=new su(t),this.transform=n,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.Z(),renderTime:0},this.setup(),this.numSublayers=bi.maxUnderzooming+bi.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new uo}resize(t,n,l){if(this.width=Math.floor(t*l),this.height=Math.floor(n*l),this.pixelRatio=l,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style._order)this.style._layers[u].resize()}setup(){const t=this.context,n=new o.a_;n.emplaceBack(0,0),n.emplaceBack(o.N,0),n.emplaceBack(0,o.N),n.emplaceBack(o.N,o.N),this.tileExtentBuffer=t.createVertexBuffer(n,ho.members),this.tileExtentSegments=o.S.simpleSegment(0,0,4,2);const l=new o.a_;l.emplaceBack(0,0),l.emplaceBack(o.N,0),l.emplaceBack(0,o.N),l.emplaceBack(o.N,o.N),this.debugBuffer=t.createVertexBuffer(l,ho.members),this.debugSegments=o.S.simpleSegment(0,0,4,5);const u=new o.V;u.emplaceBack(0,0,0,0),u.emplaceBack(o.N,0,o.N,0),u.emplaceBack(0,o.N,0,o.N),u.emplaceBack(o.N,o.N,o.N,o.N),this.rasterBoundsBuffer=t.createVertexBuffer(u,ei.members),this.rasterBoundsSegments=o.S.simpleSegment(0,0,4,2);const f=new o.a_;f.emplaceBack(0,0),f.emplaceBack(1,0),f.emplaceBack(0,1),f.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(f,ho.members),this.viewportSegments=o.S.simpleSegment(0,0,4,2);const _=new o.a$;_.emplaceBack(0),_.emplaceBack(1),_.emplaceBack(3),_.emplaceBack(2),_.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(_);const v=new o.b0;v.emplaceBack(0,1,2),v.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(v);const S=this.context.gl;this.stencilClearMode=new Ii({func:S.ALWAYS,mask:0},0,255,S.ZERO,S.ZERO,S.ZERO)}clearStencil(){const t=this.context,n=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const l=o.Z();o.aS(l,0,this.width,this.height,0,0,1),o.a0(l,l,[n.drawingBufferWidth,n.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,n.TRIANGLES,Kt.disabled,this.stencilClearMode,Ei.disabled,Si.disabled,wl(l),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,n){if(this.currentStencilSource===t.source||!t.isTileClipped()||!n||!n.length)return;this.currentStencilSource=t.source;const l=this.context,u=l.gl;this.nextStencilID+n.length>256&&this.clearStencil(),l.setColorMode(Ei.disabled),l.setDepthMode(Kt.disabled);const f=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const _ of n){const v=this._tileClippingMaskIDs[_.key]=this.nextStencilID++,S=this.style.map.terrain&&this.style.map.terrain.getTerrainData(_);f.draw(l,u.TRIANGLES,Kt.disabled,new Ii({func:u.ALWAYS,mask:0},v,255,u.KEEP,u.KEEP,u.REPLACE),Ei.disabled,Si.disabled,wl(_.posMatrix),S,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,n=this.context.gl;return new Ii({func:n.NOTEQUAL,mask:255},t,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(t){const n=this.context.gl;return new Ii({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(t){const n=this.context.gl,l=t.sort((_,v)=>v.overscaledZ-_.overscaledZ),u=l[l.length-1].overscaledZ,f=l[0].overscaledZ-u+1;if(f>1){this.currentStencilSource=void 0,this.nextStencilID+f>256&&this.clearStencil();const _={};for(let v=0;v<f;v++)_[v+u]=new Ii({func:n.GEQUAL,mask:255},v+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=f,[_,l]}return[{[u]:Ii.disabled},l]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Ei([t.CONSTANT_COLOR,t.ONE],new o.aT(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ei.unblended:Ei.alphaBlended}depthModeForSublayer(t,n,l){if(!this.opaquePassEnabledForLayer())return Kt.disabled;const u=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Kt(l||this.context.gl.LEQUAL,n,[u,u])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,n){this.style=t,this.options=n,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(o.h.now()),this.imageManager.beginFrame();const l=this.style._order,u=this.style.sourceCaches,f={},_={},v={};for(const S in u){const T=u[S];T.used&&T.prepare(this.context),f[S]=T.getVisibleCoordinates(),_[S]=f[S].slice().reverse(),v[S]=T.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let S=0;S<l.length;S++)if(this.style._layers[l[S]].is3D()){this.opaquePassCutoff=S;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const S=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!o.b1(this.terrainFacilitator.matrix,this.transform.projMatrix)||S.length)&&(o.b2(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(T,P){const M=T.context,B=M.gl,H=Ei.unblended,Z=new Kt(B.LEQUAL,Kt.ReadWrite,[0,1]),X=P.getTerrainMesh(),U=P.sourceCache.getRenderableTiles(),oe=T.useProgram("terrainDepth");M.bindFramebuffer.set(P.getFramebuffer("depth").framebuffer),M.viewport.set([0,0,T.width/devicePixelRatio,T.height/devicePixelRatio]),M.clear({color:o.aT.transparent,depth:1});for(const pe of U){const ee=P.getTerrainData(pe.tileID),le={u_matrix:T.transform.calculatePosMatrix(pe.tileID.toUnwrapped()),u_ele_delta:P.getMeshFrameDelta(T.transform.zoom)};oe.draw(M,B.TRIANGLES,Z,Ii.disabled,H,Si.backCCW,le,ee,"terrain",X.vertexBuffer,X.indexBuffer,X.segments)}M.bindFramebuffer.set(null),M.viewport.set([0,0,T.width,T.height])}(this,this.style.map.terrain),function(T,P){const M=T.context,B=M.gl,H=Ei.unblended,Z=new Kt(B.LEQUAL,Kt.ReadWrite,[0,1]),X=P.getTerrainMesh(),U=P.getCoordsTexture(),oe=P.sourceCache.getRenderableTiles(),pe=T.useProgram("terrainCoords");M.bindFramebuffer.set(P.getFramebuffer("coords").framebuffer),M.viewport.set([0,0,T.width/devicePixelRatio,T.height/devicePixelRatio]),M.clear({color:o.aT.transparent,depth:1}),P.coordsIndex=[];for(const ee of oe){const le=P.getTerrainData(ee.tileID);M.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,U.texture);const _e={u_matrix:T.transform.calculatePosMatrix(ee.tileID.toUnwrapped()),u_terrain_coords_id:(255-P.coordsIndex.length)/255,u_texture:0,u_ele_delta:P.getMeshFrameDelta(T.transform.zoom)};pe.draw(M,B.TRIANGLES,Z,Ii.disabled,H,Si.backCCW,_e,le,"terrain",X.vertexBuffer,X.indexBuffer,X.segments),P.coordsIndex.push(ee.tileID.key)}M.bindFramebuffer.set(null),M.viewport.set([0,0,T.width,T.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const S of l){const T=this.style._layers[S];if(!T.hasOffscreenPass()||T.isHidden(this.transform.zoom))continue;const P=_[T.source];(T.type==="custom"||P.length)&&this.renderLayer(this,u[T.source],T,P)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?o.aT.black:o.aT.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=l.length-1;this.currentLayer>=0;this.currentLayer--){const S=this.style._layers[l[this.currentLayer]],T=u[S.source],P=f[S.source];this._renderTileClippingMasks(S,P),this.renderLayer(this,T,S,P)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<l.length;this.currentLayer++){const S=this.style._layers[l[this.currentLayer]],T=u[S.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(S))continue;const P=(S.type==="symbol"?v:_)[S.source];this._renderTileClippingMasks(S,f[S.source]),this.renderLayer(this,T,S,P)}if(this.options.showTileBoundaries){const S=function(T,P){let M=null;const B=Object.values(T._layers).flatMap(U=>U.source&&!U.isHidden(P)?[T.sourceCaches[U.source]]:[]),H=B.filter(U=>U.getSource().type==="vector"),Z=B.filter(U=>U.getSource().type!=="vector"),X=U=>{(!M||M.getSource().maxzoom<U.getSource().maxzoom)&&(M=U)};return H.forEach(U=>X(U)),M||Z.forEach(U=>X(U)),M}(this.style,this.transform.zoom);S&&function(T,P,M){for(let B=0;B<M.length;B++)Bl(T,P,M[B])}(this,S,S.getVisibleCoordinates())}this.options.showPadding&&function(S){const T=S.transform.padding;ja(S,S.transform.height-(T.top||0),3,Rl),ja(S,T.bottom||0,3,Ao),ko(S,T.left||0,3,Cs),ko(S,S.transform.width-(T.right||0),3,$l);const P=S.transform.centerPoint;(function(M,B,H,Z){zo(M,B-1,H-10,2,20,Z),zo(M,B-10,H-1,20,2,Z)})(S,P.x,S.transform.height-P.y,Ol)}(this),this.context.setDefault()}renderLayer(t,n,l,u){if(!l.isHidden(this.transform.zoom)&&(l.type==="background"||l.type==="custom"||(u||[]).length))switch(this.id=l.id,l.type){case"symbol":(function(f,_,v,S,T){if(f.renderPass!=="translucent")return;const P=Ii.disabled,M=f.colorModeForRenderPass();(v._unevaluatedLayout.hasValue("text-variable-anchor")||v._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(B,H,Z,X,U,oe,pe){const ee=H.transform,le=U==="map",_e=oe==="map";for(const we of B){const Me=X.getTile(we),Fe=Me.getBucket(Z);if(!Fe||!Fe.text||!Fe.text.segments.get().length)continue;const Re=o.ah(Fe.textSizeData,ee.zoom),Ue=ne(Me,1,H.transform.zoom),lt=Ve(we.posMatrix,_e,le,H.transform,Ue),Ut=Z.layout.get("icon-text-fit")!=="none"&&Fe.hasIconData();if(Re){const We=Math.pow(2,ee.zoom-Me.tileID.overscaledZ);Po(Fe,le,_e,pe,ee,lt,we.posMatrix,We,Re,Ut,H.style.map.terrain?(bt,ut)=>H.style.map.terrain.getElevation(we,bt,ut):null)}}}(S,f,v,_,v.layout.get("text-rotation-alignment"),v.layout.get("text-pitch-alignment"),T),v.paint.get("icon-opacity").constantOr(1)!==0&&Mo(f,_,v,S,!1,v.paint.get("icon-translate"),v.paint.get("icon-translate-anchor"),v.layout.get("icon-rotation-alignment"),v.layout.get("icon-pitch-alignment"),v.layout.get("icon-keep-upright"),P,M),v.paint.get("text-opacity").constantOr(1)!==0&&Mo(f,_,v,S,!0,v.paint.get("text-translate"),v.paint.get("text-translate-anchor"),v.layout.get("text-rotation-alignment"),v.layout.get("text-pitch-alignment"),v.layout.get("text-keep-upright"),P,M),_.map.showCollisionBoxes&&(Dl(f,_,v,S,v.paint.get("text-translate"),v.paint.get("text-translate-anchor"),!0),Dl(f,_,v,S,v.paint.get("icon-translate"),v.paint.get("icon-translate-anchor"),!1))})(t,n,l,u,this.style.placement.variableOffsets);break;case"circle":(function(f,_,v,S){if(f.renderPass!=="translucent")return;const T=v.paint.get("circle-opacity"),P=v.paint.get("circle-stroke-width"),M=v.paint.get("circle-stroke-opacity"),B=!v.layout.get("circle-sort-key").isConstant();if(T.constantOr(1)===0&&(P.constantOr(1)===0||M.constantOr(1)===0))return;const H=f.context,Z=H.gl,X=f.depthModeForSublayer(0,Kt.ReadOnly),U=Ii.disabled,oe=f.colorModeForRenderPass(),pe=[];for(let ee=0;ee<S.length;ee++){const le=S[ee],_e=_.getTile(le),we=_e.getBucket(v);if(!we)continue;const Me=we.programConfigurations.get(v.id),Fe=f.useProgram("circle",Me),Re=we.layoutVertexBuffer,Ue=we.indexBuffer,lt=f.style.map.terrain&&f.style.map.terrain.getTerrainData(le),Ut={programConfiguration:Me,program:Fe,layoutVertexBuffer:Re,indexBuffer:Ue,uniformValues:Bn(f,le,_e,v),terrainData:lt};if(B){const We=we.segments.get();for(const bt of We)pe.push({segments:new o.S([bt]),sortKey:bt.sortKey,state:Ut})}else pe.push({segments:we.segments,sortKey:0,state:Ut})}B&&pe.sort((ee,le)=>ee.sortKey-le.sortKey);for(const ee of pe){const{programConfiguration:le,program:_e,layoutVertexBuffer:we,indexBuffer:Me,uniformValues:Fe,terrainData:Re}=ee.state;_e.draw(H,Z.TRIANGLES,X,U,oe,Si.disabled,Fe,Re,v.id,we,Me,ee.segments,v.paint,f.transform.zoom,le)}})(t,n,l,u);break;case"heatmap":(function(f,_,v,S){if(v.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){const T=f.context,P=T.gl,M=Ii.disabled,B=new Ei([P.ONE,P.ONE],o.aT.transparent,[!0,!0,!0,!0]);(function(H,Z,X){const U=H.gl;H.activeTexture.set(U.TEXTURE1),H.viewport.set([0,0,Z.width/4,Z.height/4]);let oe=X.heatmapFbo;if(oe)U.bindTexture(U.TEXTURE_2D,oe.colorAttachment.get()),H.bindFramebuffer.set(oe.framebuffer);else{const pe=U.createTexture();U.bindTexture(U.TEXTURE_2D,pe),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MIN_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MAG_FILTER,U.LINEAR),oe=X.heatmapFbo=H.createFramebuffer(Z.width/4,Z.height/4,!1,!1),function(ee,le,_e,we){var Me,Fe;const Re=ee.gl,Ue=(Me=ee.HALF_FLOAT)!==null&&Me!==void 0?Me:Re.UNSIGNED_BYTE,lt=(Fe=ee.RGBA16F)!==null&&Fe!==void 0?Fe:Re.RGBA;Re.texImage2D(Re.TEXTURE_2D,0,lt,le.width/4,le.height/4,0,Re.RGBA,Ue,null),we.colorAttachment.set(_e)}(H,Z,pe,oe)}})(T,f,v),T.clear({color:o.aT.transparent});for(let H=0;H<S.length;H++){const Z=S[H];if(_.hasRenderableParent(Z))continue;const X=_.getTile(Z),U=X.getBucket(v);if(!U)continue;const oe=U.programConfigurations.get(v.id),pe=f.useProgram("heatmap",oe),{zoom:ee}=f.transform;pe.draw(T,P.TRIANGLES,Kt.disabled,M,B,Si.disabled,Qc(Z.posMatrix,X,ee,v.paint.get("heatmap-intensity")),null,v.id,U.layoutVertexBuffer,U.indexBuffer,U.segments,v.paint,f.transform.zoom,oe)}T.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(T,P){const M=T.context,B=M.gl,H=P.heatmapFbo;if(!H)return;M.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,H.colorAttachment.get()),M.activeTexture.set(B.TEXTURE1);let Z=P.colorRampTexture;Z||(Z=P.colorRampTexture=new Ce(M,P.colorRamp,B.RGBA)),Z.bind(B.LINEAR,B.CLAMP_TO_EDGE),T.useProgram("heatmapTexture").draw(M,B.TRIANGLES,Kt.disabled,Ii.disabled,T.colorModeForRenderPass(),Si.disabled,((X,U,oe,pe)=>{const ee=o.Z();o.aS(ee,0,X.width,X.height,0,0,1);const le=X.context.gl;return{u_matrix:ee,u_world:[le.drawingBufferWidth,le.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:U.paint.get("heatmap-opacity")}})(T,P),null,P.id,T.viewportBuffer,T.quadTriangleIndexBuffer,T.viewportSegments,P.paint,T.transform.zoom)}(f,v))})(t,n,l,u);break;case"line":(function(f,_,v,S){if(f.renderPass!=="translucent")return;const T=v.paint.get("line-opacity"),P=v.paint.get("line-width");if(T.constantOr(1)===0||P.constantOr(1)===0)return;const M=f.depthModeForSublayer(0,Kt.ReadOnly),B=f.colorModeForRenderPass(),H=v.paint.get("line-dasharray"),Z=v.paint.get("line-pattern"),X=Z.constantOr(1),U=v.paint.get("line-gradient"),oe=v.getCrossfadeParameters(),pe=X?"linePattern":H?"lineSDF":U?"lineGradient":"line",ee=f.context,le=ee.gl;let _e=!0;for(const we of S){const Me=_.getTile(we);if(X&&!Me.patternsLoaded())continue;const Fe=Me.getBucket(v);if(!Fe)continue;const Re=Fe.programConfigurations.get(v.id),Ue=f.context.program.get(),lt=f.useProgram(pe,Re),Ut=_e||lt.program!==Ue,We=f.style.map.terrain&&f.style.map.terrain.getTerrainData(we),bt=Z.constantOr(null);if(bt&&Me.imageAtlas){const Vt=Me.imageAtlas,Dt=Vt.patternPositions[bt.to.toString()],qt=Vt.patternPositions[bt.from.toString()];Dt&&qt&&Re.setConstantPatternPositions(Dt,qt)}const ut=We?we:null,hi=X?eu(f,Me,v,oe,ut):H?Cl(f,Me,v,H,oe,ut):U?Sl(f,Me,v,Fe.lineClipsArray.length,ut):ss(f,Me,v,ut);if(X)ee.activeTexture.set(le.TEXTURE0),Me.imageAtlasTexture.bind(le.LINEAR,le.CLAMP_TO_EDGE),Re.updatePaintBuffers(oe);else if(H&&(Ut||f.lineAtlas.dirty))ee.activeTexture.set(le.TEXTURE0),f.lineAtlas.bind(ee);else if(U){const Vt=Fe.gradients[v.id];let Dt=Vt.texture;if(v.gradientVersion!==Vt.version){let qt=256;if(v.stepInterpolant){const $i=_.getSource().maxzoom,fi=we.canonical.z===$i?Math.ceil(1<<f.transform.maxZoom-we.canonical.z):1;qt=o.ad(o.aY(Fe.maxLineLength/o.N*1024*fi),256,ee.maxTextureSize)}Vt.gradient=o.aZ({expression:v.gradientExpression(),evaluationKey:"lineProgress",resolution:qt,image:Vt.gradient||void 0,clips:Fe.lineClipsArray}),Vt.texture?Vt.texture.update(Vt.gradient):Vt.texture=new Ce(ee,Vt.gradient,le.RGBA),Vt.version=v.gradientVersion,Dt=Vt.texture}ee.activeTexture.set(le.TEXTURE0),Dt.bind(v.stepInterpolant?le.NEAREST:le.LINEAR,le.CLAMP_TO_EDGE)}lt.draw(ee,le.TRIANGLES,M,f.stencilModeForClipping(we),B,Si.disabled,hi,We,v.id,Fe.layoutVertexBuffer,Fe.indexBuffer,Fe.segments,v.paint,f.transform.zoom,Re,Fe.layoutVertexBuffer2),_e=!1}})(t,n,l,u);break;case"fill":(function(f,_,v,S){const T=v.paint.get("fill-color"),P=v.paint.get("fill-opacity");if(P.constantOr(1)===0)return;const M=f.colorModeForRenderPass(),B=v.paint.get("fill-pattern"),H=f.opaquePassEnabledForLayer()&&!B.constantOr(1)&&T.constantOr(o.aT.transparent).a===1&&P.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===H){const Z=f.depthModeForSublayer(1,f.renderPass==="opaque"?Kt.ReadWrite:Kt.ReadOnly);Fa(f,_,v,S,Z,M,!1)}if(f.renderPass==="translucent"&&v.paint.get("fill-antialias")){const Z=f.depthModeForSublayer(v.getPaintProperty("fill-outline-color")?2:0,Kt.ReadOnly);Fa(f,_,v,S,Z,M,!0)}})(t,n,l,u);break;case"fill-extrusion":(function(f,_,v,S){const T=v.paint.get("fill-extrusion-opacity");if(T!==0&&f.renderPass==="translucent"){const P=new Kt(f.context.gl.LEQUAL,Kt.ReadWrite,f.depthRangeFor3D);if(T!==1||v.paint.get("fill-extrusion-pattern").constantOr(1))Na(f,_,v,S,P,Ii.disabled,Ei.disabled),Na(f,_,v,S,P,f.stencilModeFor3D(),f.colorModeForRenderPass());else{const M=f.colorModeForRenderPass();Na(f,_,v,S,P,Ii.disabled,M)}}})(t,n,l,u);break;case"hillshade":(function(f,_,v,S){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent")return;const T=f.context,P=f.depthModeForSublayer(0,Kt.ReadOnly),M=f.colorModeForRenderPass(),[B,H]=f.renderPass==="translucent"?f.stencilConfigForOverlap(S):[{},S];for(const Z of H){const X=_.getTile(Z);X.needsHillshadePrepare!==void 0&&X.needsHillshadePrepare&&f.renderPass==="offscreen"?Ss(f,X,v,P,Ii.disabled,M):f.renderPass==="translucent"&&lu(f,Z,X,v,P,B[Z.overscaledZ],M)}T.viewport.set([0,0,f.width,f.height])})(t,n,l,u);break;case"raster":(function(f,_,v,S){if(f.renderPass!=="translucent"||v.paint.get("raster-opacity")===0||!S.length)return;const T=f.context,P=T.gl,M=_.getSource(),B=f.useProgram("raster"),H=f.colorModeForRenderPass(),[Z,X]=M instanceof kt?[{},S]:f.stencilConfigForOverlap(S),U=X[X.length-1].overscaledZ,oe=!f.options.moving;for(const pe of X){const ee=f.depthModeForSublayer(pe.overscaledZ-U,v.paint.get("raster-opacity")===1?Kt.ReadWrite:Kt.ReadOnly,P.LESS),le=_.getTile(pe);le.registerFadeDuration(v.paint.get("raster-fade-duration"));const _e=_.findLoadedParent(pe,0),we=cu(le,_e,_,v,f.transform,f.style.map.terrain);let Me,Fe;const Re=v.paint.get("raster-resampling")==="nearest"?P.NEAREST:P.LINEAR;T.activeTexture.set(P.TEXTURE0),le.texture.bind(Re,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST),T.activeTexture.set(P.TEXTURE1),_e?(_e.texture.bind(Re,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST),Me=Math.pow(2,_e.tileID.overscaledZ-le.tileID.overscaledZ),Fe=[le.tileID.canonical.x*Me%1,le.tileID.canonical.y*Me%1]):le.texture.bind(Re,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST);const Ue=f.style.map.terrain&&f.style.map.terrain.getTerrainData(pe),lt=Ue?pe:null,Ut=lt?lt.posMatrix:f.transform.calculatePosMatrix(pe.toUnwrapped(),oe),We=El(Ut,Fe||[0,0],Me||1,we,v);M instanceof kt?B.draw(T,P.TRIANGLES,ee,Ii.disabled,H,Si.disabled,We,Ue,v.id,M.boundsBuffer,f.quadTriangleIndexBuffer,M.boundsSegments):B.draw(T,P.TRIANGLES,ee,Z[pe.overscaledZ],H,Si.disabled,We,Ue,v.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}})(t,n,l,u);break;case"background":(function(f,_,v,S){const T=v.paint.get("background-color"),P=v.paint.get("background-opacity");if(P===0)return;const M=f.context,B=M.gl,H=f.transform,Z=H.tileSize,X=v.paint.get("background-pattern");if(f.isPatternMissing(X))return;const U=!X&&T.a===1&&P===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==U)return;const oe=Ii.disabled,pe=f.depthModeForSublayer(0,U==="opaque"?Kt.ReadWrite:Kt.ReadOnly),ee=f.colorModeForRenderPass(),le=f.useProgram(X?"backgroundPattern":"background"),_e=S||H.coveringTiles({tileSize:Z,terrain:f.style.map.terrain});X&&(M.activeTexture.set(B.TEXTURE0),f.imageManager.bind(f.context));const we=v.getCrossfadeParameters();for(const Me of _e){const Fe=S?Me.posMatrix:f.transform.calculatePosMatrix(Me.toUnwrapped()),Re=X?Wr(Fe,P,f,X,{tileID:Me,tileSize:Z},we):yo(Fe,P,T),Ue=f.style.map.terrain&&f.style.map.terrain.getTerrainData(Me);le.draw(M,B.TRIANGLES,pe,oe,ee,Si.disabled,Re,Ue,v.id,f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}})(t,0,l,u);break;case"custom":(function(f,_,v){const S=f.context,T=v.implementation;if(f.renderPass==="offscreen"){const P=T.prerender;P&&(f.setCustomLayerDefaults(),S.setColorMode(f.colorModeForRenderPass()),P.call(T,S.gl,f.transform.customLayerMatrix()),S.setDirty(),f.setBaseState())}else if(f.renderPass==="translucent"){f.setCustomLayerDefaults(),S.setColorMode(f.colorModeForRenderPass()),S.setStencilMode(Ii.disabled);const P=T.renderingMode==="3d"?new Kt(f.context.gl.LEQUAL,Kt.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,Kt.ReadOnly);S.setDepthMode(P),T.render(S.gl,f.transform.customLayerMatrix()),S.setDirty(),f.setBaseState(),S.bindFramebuffer.set(null)}})(t,0,l)}}translatePosMatrix(t,n,l,u,f){if(!l[0]&&!l[1])return t;const _=f?u==="map"?this.transform.angle:0:u==="viewport"?-this.transform.angle:0;if(_){const T=Math.sin(_),P=Math.cos(_);l=[l[0]*P-l[1]*T,l[0]*T+l[1]*P]}const v=[f?l[0]:ne(n,l[0],this.transform.zoom),f?l[1]:ne(n,l[1],this.transform.zoom),0],S=new Float32Array(16);return o.$(S,t,v),S}saveTileTexture(t){const n=this._tileTextures[t.size[0]];n?n.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const n=this._tileTextures[t];return n&&n.length>0?n.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const n=this.imageManager.getPattern(t.from.toString()),l=this.imageManager.getPattern(t.to.toString());return!n||!l}useProgram(t,n){this.cache=this.cache||{};const l=t+(n?n.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[l]||(this.cache[l]=new po(this.context,Ti[t],n,_o[t],this._showOverdrawInspector,this.style.map.terrain)),this.cache[l]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Ce(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:n}=this.context.gl;return this.width!==t||this.height!==n}}class Tr{constructor(t,n){this.points=t,this.planes=n}static fromInvProjectionMatrix(t,n,l){const u=Math.pow(2,l),f=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(v=>{const S=1/(v=o.ag([],v,t))[3]/n*u;return o.b3(v,v,[S,S,1/v[3],S])}),_=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(v=>{const S=function(B,H){var Z=H[0],X=H[1],U=H[2],oe=Z*Z+X*X+U*U;return oe>0&&(oe=1/Math.sqrt(oe)),B[0]=H[0]*oe,B[1]=H[1]*oe,B[2]=H[2]*oe,B}([],function(B,H,Z){var X=H[0],U=H[1],oe=H[2],pe=Z[0],ee=Z[1],le=Z[2];return B[0]=U*le-oe*ee,B[1]=oe*pe-X*le,B[2]=X*ee-U*pe,B}([],ze([],f[v[0]],f[v[1]]),ze([],f[v[2]],f[v[1]]))),T=-((P=S)[0]*(M=f[v[1]])[0]+P[1]*M[1]+P[2]*M[2]);var P,M;return S.concat(T)});return new Tr(f,_)}}class ya{constructor(t,n){this.min=t,this.max=n,this.center=function(l,u,f){return l[0]=.5*u[0],l[1]=.5*u[1],l[2]=.5*u[2],l}([],function(l,u,f){return l[0]=u[0]+f[0],l[1]=u[1]+f[1],l[2]=u[2]+f[2],l}([],this.min,this.max))}quadrant(t){const n=[t%2==0,t<2],l=ce(this.min),u=ce(this.max);for(let f=0;f<n.length;f++)l[f]=n[f]?this.min[f]:this.center[f],u[f]=n[f]?this.center[f]:this.max[f];return u[2]=this.max[2],new ya(l,u)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const n=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let l=!0;for(let u=0;u<t.planes.length;u++){const f=t.planes[u];let _=0;for(let v=0;v<n.length;v++)o.b4(f,n[v])>=0&&_++;if(_===0)return 0;_!==n.length&&(l=!1)}if(l)return 2;for(let u=0;u<3;u++){let f=Number.MAX_VALUE,_=-Number.MAX_VALUE;for(let v=0;v<t.points.length;v++){const S=t.points[v][u]-this.min[u];f=Math.min(f,S),_=Math.max(_,S)}if(_<0||f>this.max[u]-this.min[u])return 0}return 1}}class Va{constructor(t=0,n=0,l=0,u=0){if(isNaN(t)||t<0||isNaN(n)||n<0||isNaN(l)||l<0||isNaN(u)||u<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=n,this.left=l,this.right=u}interpolate(t,n,l){return n.top!=null&&t.top!=null&&(this.top=o.B.number(t.top,n.top,l)),n.bottom!=null&&t.bottom!=null&&(this.bottom=o.B.number(t.bottom,n.bottom,l)),n.left!=null&&t.left!=null&&(this.left=o.B.number(t.left,n.left,l)),n.right!=null&&t.right!=null&&(this.right=o.B.number(t.right,n.right,l)),this}getCenter(t,n){const l=o.ad((this.left+t-this.right)/2,0,t),u=o.ad((this.top+n-this.bottom)/2,0,n);return new o.P(l,u)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Va(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class Lo{constructor(t,n,l,u,f){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=f===void 0||!!f,this._minZoom=t||0,this._maxZoom=n||22,this._minPitch=l??0,this._maxPitch=u??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new o.L(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Va,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const t=new Lo(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this._minEleveationForCurrentTile=t._minEleveationForCurrentTile,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const n=-o.b5(t,-180,180)*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=function(){var l=new o.A(4);return o.A!=Float32Array&&(l[1]=0,l[2]=0),l[0]=1,l[3]=1,l}(),function(l,u,f){var _=u[0],v=u[1],S=u[2],T=u[3],P=Math.sin(f),M=Math.cos(f);l[0]=_*M+S*P,l[1]=v*M+T*P,l[2]=_*-P+S*M,l[3]=v*-P+T*M}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const n=o.ad(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const n=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==n&&(this._unmodified=!1,this._zoom=n,this.tileZoom=Math.max(0,Math.floor(n)),this.scale=this.zoomScale(n),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,n,l){this._unmodified=!1,this._edgeInsets.interpolate(t,n,l),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const n=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,n)}getVisibleUnwrappedCoordinates(t){const n=[new o.b6(0,t)];if(this._renderWorldCopies){const l=this.pointCoordinate(new o.P(0,0)),u=this.pointCoordinate(new o.P(this.width,0)),f=this.pointCoordinate(new o.P(this.width,this.height)),_=this.pointCoordinate(new o.P(0,this.height)),v=Math.floor(Math.min(l.x,u.x,f.x,_.x)),S=Math.floor(Math.max(l.x,u.x,f.x,_.x)),T=1;for(let P=v-T;P<=S+T;P++)P!==0&&n.push(new o.b6(P,t))}return n}coveringTiles(t){var n,l;let u=this.coveringZoomLevel(t);const f=u;if(t.minzoom!==void 0&&u<t.minzoom)return[];t.maxzoom!==void 0&&u>t.maxzoom&&(u=t.maxzoom);const _=this.pointCoordinate(this.getCameraPoint()),v=o.U.fromLngLat(this.center),S=Math.pow(2,u),T=[S*_.x,S*_.y,0],P=[S*v.x,S*v.y,0],M=Tr.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u);let B=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(B=u);const H=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,Z=ee=>({aabb:new ya([ee*S,0,0],[(ee+1)*S,S,0]),zoom:0,x:0,y:0,wrap:ee,fullyVisible:!1}),X=[],U=[],oe=u,pe=t.reparseOverscaled?f:u;if(this._renderWorldCopies)for(let ee=1;ee<=3;ee++)X.push(Z(-ee)),X.push(Z(ee));for(X.push(Z(0));X.length>0;){const ee=X.pop(),le=ee.x,_e=ee.y;let we=ee.fullyVisible;if(!we){const lt=ee.aabb.intersects(M);if(lt===0)continue;we=lt===2}const Me=t.terrain?T:P,Fe=ee.aabb.distanceX(Me),Re=ee.aabb.distanceY(Me),Ue=Math.max(Math.abs(Fe),Math.abs(Re));if(ee.zoom===oe||Ue>H+(1<<oe-ee.zoom)-2&&ee.zoom>=B){const lt=oe-ee.zoom,Ut=T[0]-.5-(le<<lt),We=T[1]-.5-(_e<<lt);U.push({tileID:new o.O(ee.zoom===oe?pe:ee.zoom,ee.wrap,ee.zoom,le,_e),distanceSq:Be([P[0]-.5-le,P[1]-.5-_e]),tileDistanceToCamera:Math.sqrt(Ut*Ut+We*We)})}else for(let lt=0;lt<4;lt++){const Ut=(le<<1)+lt%2,We=(_e<<1)+(lt>>1),bt=ee.zoom+1;let ut=ee.aabb.quadrant(lt);if(t.terrain){const hi=new o.O(bt,ee.wrap,bt,Ut,We),Vt=t.terrain.getMinMaxElevation(hi),Dt=(n=Vt.minElevation)!==null&&n!==void 0?n:this.elevation,qt=(l=Vt.maxElevation)!==null&&l!==void 0?l:this.elevation;ut=new ya([ut.min[0],ut.min[1],Dt],[ut.max[0],ut.max[1],qt])}X.push({aabb:ut,zoom:bt,x:Ut,y:We,wrap:ee.wrap,fullyVisible:we})}}return U.sort((ee,le)=>ee.distanceSq-le.distanceSq).map(ee=>ee.tileID)}resize(t,n){this.width=t,this.height=n,this.pixelsToGLUnits=[2/t,-2/n],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const n=o.ad(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new o.P(o.G(t.lng)*this.worldSize,o.H(n)*this.worldSize)}unproject(t){return new o.U(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const n=this.pointLocation(this.centerPoint,t),l=t.getElevationForLngLatZoom(n,this.tileZoom);if(!(this.elevation-l))return;const u=this.getCameraPosition(),f=o.U.fromLngLat(u.lngLat,u.altitude),_=o.U.fromLngLat(n,l),v=f.x-_.x,S=f.y-_.y,T=f.z-_.z,P=Math.sqrt(v*v+S*S+T*T),M=this.scaleZoom(this.cameraToCenterDistance/P/this.tileSize);this._elevation=l,this._center=n,this.zoom=M}setLocationAtPoint(t,n){const l=this.pointCoordinate(n),u=this.pointCoordinate(this.centerPoint),f=this.locationCoordinate(t),_=new o.U(f.x-(l.x-u.x),f.y-(l.y-u.y));this.center=this.coordinateLocation(_),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,n){return n?this.coordinatePoint(this.locationCoordinate(t),n.getElevationForLngLatZoom(t,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,n){return this.coordinateLocation(this.pointCoordinate(t,n))}locationCoordinate(t){return o.U.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,n){if(n){const B=n.pointCoordinate(t);if(B!=null)return B}const l=[t.x,t.y,0,1],u=[t.x,t.y,1,1];o.ag(l,l,this.pixelMatrixInverse),o.ag(u,u,this.pixelMatrixInverse);const f=l[3],_=u[3],v=l[1]/f,S=u[1]/_,T=l[2]/f,P=u[2]/_,M=T===P?0:(0-T)/(P-T);return new o.U(o.B.number(l[0]/f,u[0]/_,M)/this.worldSize,o.B.number(v,S,M)/this.worldSize)}coordinatePoint(t,n=0,l=this.pixelMatrix){const u=[t.x*this.worldSize,t.y*this.worldSize,n,1];return o.ag(u,u,l),new o.P(u[0]/u[3],u[1]/u[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new Oe().extend(this.pointLocation(new o.P(0,t))).extend(this.pointLocation(new o.P(this.width,t))).extend(this.pointLocation(new o.P(this.width,this.height))).extend(this.pointLocation(new o.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Oe([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(t,n=!1){const l=t.key,u=n?this._alignedPosMatrixCache:this._posMatrixCache;if(u[l])return u[l];const f=t.canonical,_=this.worldSize/this.zoomScale(f.z),v=f.x+Math.pow(2,f.z)*t.wrap,S=o.ao(new Float64Array(16));return o.$(S,S,[v*_,f.y*_,0]),o.a0(S,S,[_/o.N,_/o.N,1]),o.a1(S,n?this.alignedProjMatrix:this.projMatrix,S),u[l]=new Float32Array(S),u[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t,n,l,u,f=-90,_=90,v=-180,S=180;const T=this.size,P=this._unmodified;if(this.latRange){const H=this.latRange;f=o.H(H[1])*this.worldSize,_=o.H(H[0])*this.worldSize,t=_-f<T.y?T.y/(_-f):0}if(this.lngRange){const H=this.lngRange;v=o.b5(o.G(H[0])*this.worldSize,0,this.worldSize),S=o.b5(o.G(H[1])*this.worldSize,0,this.worldSize),S<v&&(S+=this.worldSize),n=S-v<T.x?T.x/(S-v):0}const M=this.point,B=Math.max(n||0,t||0);if(B)return this.center=this.unproject(new o.P(n?(S+v)/2:M.x,t?(_+f)/2:M.y)),this.zoom+=this.scaleZoom(B),this._unmodified=P,void(this._constraining=!1);if(this.latRange){const H=M.y,Z=T.y/2;H-Z<f&&(u=f+Z),H+Z>_&&(u=_-Z)}if(this.lngRange){const H=(v+S)/2,Z=o.b5(M.x,H-this.worldSize/2,H+this.worldSize/2),X=T.x/2;Z-X<v&&(l=v+X),Z+X>S&&(l=S-X)}l===void 0&&u===void 0||(this.center=this.unproject(new o.P(l!==void 0?l:M.x,u!==void 0?u:M.y)).wrap()),this._unmodified=P,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,n=this.point.x,l=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=o.b7(1,this.center.lat)*this.worldSize;let u=o.ao(new Float64Array(16));o.a0(u,u,[this.width/2,-this.height/2,1]),o.$(u,u,[1,-1,0]),this.labelPlaneMatrix=u,u=o.ao(new Float64Array(16)),o.a0(u,u,[1,-1,1]),o.$(u,u,[-1,-1,0]),o.a0(u,u,[2/this.width,2/this.height,1]),this.glCoordMatrix=u;const f=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),_=Math.min(this.elevation,this._minEleveationForCurrentTile),v=f-_*this._pixelPerMeter/Math.cos(this._pitch),S=_<0?v:f,T=Math.PI/2+this._pitch,P=this._fov*(.5+t.y/this.height),M=Math.sin(P)*S/Math.sin(o.ad(Math.PI-T-P,.01,Math.PI-.01)),B=this.getHorizon(),H=2*Math.atan(B/this.cameraToCenterDistance)*(.5+t.y/(2*B)),Z=Math.sin(H)*S/Math.sin(o.ad(Math.PI-T-H,.01,Math.PI-.01)),X=Math.min(M,Z),U=1.01*(Math.cos(Math.PI/2-this._pitch)*X+S),oe=this.height/50;u=new Float64Array(16),o.b8(u,this._fov,this.width/this.height,oe,U),u[8]=2*-t.x/this.width,u[9]=2*t.y/this.height,o.a0(u,u,[1,-1,1]),o.$(u,u,[0,0,-this.cameraToCenterDistance]),o.b9(u,u,this._pitch),o.ae(u,u,this.angle),o.$(u,u,[-n,-l,0]),this.mercatorMatrix=o.a0([],u,[this.worldSize,this.worldSize,this.worldSize]),o.a0(u,u,[1,1,this._pixelPerMeter]),this.pixelMatrix=o.a1(new Float64Array(16),this.labelPlaneMatrix,u),o.$(u,u,[0,0,-this.elevation]),this.projMatrix=u,this.invProjMatrix=o.as([],u),this.pixelMatrix3D=o.a1(new Float64Array(16),this.labelPlaneMatrix,u);const pe=this.width%2/2,ee=this.height%2/2,le=Math.cos(this.angle),_e=Math.sin(this.angle),we=n-Math.round(n)+le*pe+_e*ee,Me=l-Math.round(l)+le*ee+_e*pe,Fe=new Float64Array(u);if(o.$(Fe,Fe,[we>.5?we-1:we,Me>.5?Me-1:Me,0]),this.alignedProjMatrix=Fe,u=o.as(new Float64Array(16),this.pixelMatrix),!u)throw new Error("failed to invert matrix");this.pixelMatrixInverse=u,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new o.P(0,0)),n=[t.x*this.worldSize,t.y*this.worldSize,0,1];return o.ag(n,n,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,t))}getCameraQueryGeometry(t){const n=this.getCameraPoint();if(t.length===1)return[t[0],n];{let l=n.x,u=n.y,f=n.x,_=n.y;for(const v of t)l=Math.min(l,v.x),u=Math.min(u,v.y),f=Math.max(f,v.x),_=Math.max(_,v.y);return[new o.P(l,u),new o.P(f,u),new o.P(f,_),new o.P(l,_),new o.P(l,u)]}}}function ea(d,t){let n,l=!1,u=null,f=null;const _=()=>{u=null,l&&(d.apply(f,n),u=setTimeout(_,t),l=!1)};return(...v)=>(l=!0,f=this,n=v,u||_(),u)}class Ua{constructor(t){this._getCurrentHash=()=>{const n=window.location.hash.replace("#","");if(this._hashName){let l;return n.split("&").map(u=>u.split("=")).forEach(u=>{u[0]===this._hashName&&(l=u)}),(l&&l[1]||"").split("/")}return n.split("/")},this._onHashChange=()=>{const n=this._getCurrentHash();if(n.length>=3&&!n.some(l=>isNaN(l))){const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:l,pitch:+(n[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const n=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,n)}catch{}},this._updateHash=ea(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const n=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,u=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),f=Math.pow(10,u),_=Math.round(n.lng*f)/f,v=Math.round(n.lat*f)/f,S=this._map.getBearing(),T=this._map.getPitch();let P="";if(P+=t?`/${_}/${v}/${l}`:`${l}/${v}/${_}`,(S||T)&&(P+="/"+Math.round(10*S)/10),T&&(P+=`/${Math.round(T)}`),this._hashName){const M=this._hashName;let B=!1;const H=window.location.hash.slice(1).split("&").map(Z=>{const X=Z.split("=")[0];return X===M?(B=!0,`${X}=${P}`):Z}).filter(Z=>Z);return B||H.push(`${M}=${P}`),`#${H.join("&")}`}return`#${P}`}}const _a={linearity:.3,easing:o.ba(0,0,.3,1)},Fl=o.e({deceleration:2500,maxSpeed:1400},_a),Nl=o.e({deceleration:20,maxSpeed:1400},_a),jl=o.e({deceleration:1e3,maxSpeed:360},_a),Vl=o.e({deceleration:1e3,maxSpeed:90},_a);class Ul{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.h.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,n=o.h.now();for(;t.length>0&&n-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:f}of this._inertiaBuffer)n.zoom+=f.zoomDelta||0,n.bearing+=f.bearingDelta||0,n.pitch+=f.pitchDelta||0,f.panDelta&&n.pan._add(f.panDelta),f.around&&(n.around=f.around),f.pinchAround&&(n.pinchAround=f.pinchAround);const l=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,u={};if(n.pan.mag()){const f=qa(n.pan.mag(),l,o.e({},Fl,t||{}));u.offset=n.pan.mult(f.amount/n.pan.mag()),u.center=this._map.transform.center,un(u,f)}if(n.zoom){const f=qa(n.zoom,l,Nl);u.zoom=this._map.transform.zoom+f.amount,un(u,f)}if(n.bearing){const f=qa(n.bearing,l,jl);u.bearing=this._map.transform.bearing+o.ad(f.amount,-179,179),un(u,f)}if(n.pitch){const f=qa(n.pitch,l,Vl);u.pitch=this._map.transform.pitch+f.amount,un(u,f)}if(u.zoom||u.bearing){const f=n.pinchAround===void 0?n.around:n.pinchAround;u.around=f?this._map.unproject(f):this._map.getCenter()}return this.clear(),o.e(u,{noMoveStart:!0})}}function un(d,t){(!d.duration||d.duration<t.duration)&&(d.duration=t.duration,d.easing=t.easing)}function qa(d,t,n){const{maxSpeed:l,linearity:u,deceleration:f}=n,_=o.ad(d*u/(t/1e3),-l,l),v=Math.abs(_)/(f*u);return{easing:n.easing,duration:1e3*v,amount:_*(v/2)}}class $r extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,l,u={}){const f=L.mousePos(n.getCanvasContainer(),l),_=n.unproject(f);super(t,o.e({point:f,lngLat:_,originalEvent:l},u)),this._defaultPrevented=!1,this.target=n}}class Ga extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,l){const u=t==="touchend"?l.changedTouches:l.touches,f=L.touchPos(n.getCanvasContainer(),u),_=f.map(S=>n.unproject(S)),v=f.reduce((S,T,P,M)=>S.add(T.div(M.length)),new o.P(0,0));super(t,{points:f,point:v,lngLats:_,lngLat:n.unproject(v),originalEvent:l}),this._defaultPrevented=!1}}class ql extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,l){super(t,{originalEvent:l}),this._defaultPrevented=!1}}class Gl{constructor(t,n){this._map=t,this._clickTolerance=n.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new ql(t.type,this._map,t))}mousedown(t,n){return this._mousedownPos=n,this._firePreventable(new $r(t.type,this._map,t))}mouseup(t){this._map.fire(new $r(t.type,this._map,t))}click(t,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||this._map.fire(new $r(t.type,this._map,t))}dblclick(t){return this._firePreventable(new $r(t.type,this._map,t))}mouseover(t){this._map.fire(new $r(t.type,this._map,t))}mouseout(t){this._map.fire(new $r(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Ga(t.type,this._map,t))}touchmove(t){this._map.fire(new Ga(t.type,this._map,t))}touchend(t){this._map.fire(new Ga(t.type,this._map,t))}touchcancel(t){this._map.fire(new Ga(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Zl{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new $r(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new $r("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new $r(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class bn{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(o.P.convert(t),this._map.terrain)}}class Hl{constructor(t,n){this._map=t,this._tr=new bn(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,n){this.isEnabled()&&t.shiftKey&&t.button===0&&(L.disableDrag(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(t,n){if(!this._active)return;const l=n;if(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)return;const u=this._startPos;this._lastPos=l,this._box||(this._box=L.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const f=Math.min(u.x,l.x),_=Math.max(u.x,l.x),v=Math.min(u.y,l.y),S=Math.max(u.y,l.y);L.setTransform(this._box,`translate(${f}px,${v}px)`),this._box.style.width=_-f+"px",this._box.style.height=S-v+"px"}mouseupWindow(t,n){if(!this._active||t.button!==0)return;const l=this._startPos,u=n;if(this.reset(),L.suppressClick(),l.x!==u.x||l.y!==u.y)return this._map.fire(new o.k("boxzoomend",{originalEvent:t})),{cameraAnimation:f=>f.fitScreenCoordinates(l,u,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(L.remove(this._box),this._box=null),L.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,n){return this._map.fire(new o.k(t,{originalEvent:n}))}}function Xr(d,t){if(d.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${d.length}, points ${t.length}`);const n={};for(let l=0;l<d.length;l++)n[d[l].identifier]=t[l];return n}class wn{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,n,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),l.length===this.numTouches&&(this.centroid=function(u){const f=new o.P(0,0);for(const _ of u)f._add(_);return f.div(u.length)}(n),this.touches=Xr(l,n)))}touchmove(t,n,l){if(this.aborted||!this.centroid)return;const u=Xr(l,n);for(const f in this.touches){const _=u[f];(!_||_.dist(this.touches[f])>30)&&(this.aborted=!0)}}touchend(t,n,l){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){const u=!this.aborted&&this.centroid;if(this.reset(),u)return u}}}class Do{constructor(t){this.singleTap=new wn(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,n,l){this.singleTap.touchstart(t,n,l)}touchmove(t,n,l){this.singleTap.touchmove(t,n,l)}touchend(t,n,l){const u=this.singleTap.touchend(t,n,l);if(u){const f=t.timeStamp-this.lastTime<500,_=!this.lastTap||this.lastTap.dist(u)<30;if(f&&_||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=u,this.count===this.numTaps)return this.reset(),u}}}class Sn{constructor(t){this._tr=new bn(t),this._zoomIn=new Do({numTouches:1,numTaps:2}),this._zoomOut=new Do({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,n,l){this._zoomIn.touchstart(t,n,l),this._zoomOut.touchstart(t,n,l)}touchmove(t,n,l){this._zoomIn.touchmove(t,n,l),this._zoomOut.touchmove(t,n,l)}touchend(t,n,l){const u=this._zoomIn.touchend(t,n,l),f=this._zoomOut.touchend(t,n,l),_=this._tr;return u?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:v=>v.easeTo({duration:300,zoom:_.zoom+1,around:_.unproject(u)},{originalEvent:t})}):f?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:v=>v.easeTo({duration:300,zoom:_.zoom-1,around:_.unproject(f)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Cn{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const n=this._moveFunction(...t);if(n.bearingDelta||n.pitchDelta||n.around||n.panDelta)return this._active=!0,n}dragStart(t,n){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=n.length?n[0]:n,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,n){if(!this.isEnabled())return;const l=this._lastPoint;if(!l)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const u=n.length?n[0]:n;return!this._moved&&u.dist(l)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=u,this._move(l,u))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&L.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const uu={0:1,2:2};class Ts{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const n=L.mouseButton(t);this._eventButton=n}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(n,l){const u=uu[l];return n.buttons===void 0||(n.buttons&u)!==u}(t,this._eventButton)}isValidEndEvent(t){return L.mouseButton(t)===this._eventButton}}class Wl{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}const Ro=d=>{d.mousedown=d.dragStart,d.mousemoveWindow=d.dragMove,d.mouseup=d.dragEnd,d.contextmenu=function(t){t.preventDefault()}},va=({enable:d,clickTolerance:t,bearingDegreesPerPixelMoved:n=.8})=>{const l=new Ts({checkCorrectEvent:u=>L.mouseButton(u)===0&&u.ctrlKey||L.mouseButton(u)===2});return new Cn({clickTolerance:t,move:(u,f)=>({bearingDelta:(f.x-u.x)*n}),moveStateManager:l,enable:d,assignEvents:Ro})},Tn=({enable:d,clickTolerance:t,pitchDegreesPerPixelMoved:n=-.5})=>{const l=new Ts({checkCorrectEvent:u=>L.mouseButton(u)===0&&u.ctrlKey||L.mouseButton(u)===2});return new Cn({clickTolerance:t,move:(u,f)=>({pitchDelta:(f.y-u.y)*n}),moveStateManager:l,enable:d,assignEvents:Ro})};class it{constructor(t,n){this._minTouches=t.cooperativeGestures?2:1,this._clickTolerance=t.clickTolerance||1,this._map=n,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(t,n,l){return this._calculateTransform(t,n,l)}touchmove(t,n,l){if(this._map._cooperativeGestures&&(this._minTouches===2&&l.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(t,!1,l.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(l.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,n,l)}touchend(t,n,l){this._calculateTransform(t,n,l),this._active&&l.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,n,l){l.length>0&&(this._active=!0);const u=Xr(l,n),f=new o.P(0,0),_=new o.P(0,0);let v=0;for(const T in u){const P=u[T],M=this._touches[T];M&&(f._add(P),_._add(P.sub(M)),v++,u[T]=P)}if(this._touches=u,v<this._minTouches||!_.mag())return;const S=_.div(v);return this._sum._add(S),this._sum.mag()<this._clickTolerance?void 0:{around:f.div(v),panDelta:S}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $o{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,n,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([n[0],n[1]]))}touchmove(t,n,l){if(!this._firstTwoTouches)return;t.preventDefault();const[u,f]=this._firstTwoTouches,_=jn(l,n,u),v=jn(l,n,f);if(!_||!v)return;const S=this._aroundCenter?null:_.add(v).div(2);return this._move([_,v],S,t)}touchend(t,n,l){if(!this._firstTwoTouches)return;const[u,f]=this._firstTwoTouches,_=jn(l,n,u),v=jn(l,n,f);_&&v||(this._active&&L.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function jn(d,t,n){for(let l=0;l<d.length;l++)if(d[l].identifier===n)return t[l]}function xa(d,t){return Math.log(d/t)/Math.LN2}class Xl extends $o{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,n){const l=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(xa(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:xa(this._distance,l),pinchAround:n}}}function Qe(d,t){return 180*d.angleWith(t)/Math.PI}class Es extends $o{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,n){const l=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Qe(this._vector,l),pinchAround:n}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const n=25/(Math.PI*this._minDiameter)*360,l=Qe(t,this._startVector);return Math.abs(l)<n}}function Is(d){return Math.abs(d.y)>Math.abs(d.x)}class hu extends $o{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,n,l){super.touchstart(t,n,l),this._currentTouchCount=l.length}_start(t){this._lastPoints=t,Is(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,n,l){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const u=t[0].sub(this._lastPoints[0]),f=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(u,f,l.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(u.y+f.y)/2*-.5}):void 0}gestureBeginsVertically(t,n,l){if(this._valid!==void 0)return this._valid;const u=t.mag()>=2,f=n.mag()>=2;if(!u&&!f)return;if(!u||!f)return this._firstMove===void 0&&(this._firstMove=l),l-this._firstMove<100&&void 0;const _=t.y>0==n.y>0;return Is(t)&&Is(n)&&_}}const Ps={panStep:100,bearingStep:15,pitchStep:10};class Kl{constructor(t){this._tr=new bn(t);const n=Ps;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let n=0,l=0,u=0,f=0,_=0;switch(t.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:t.shiftKey?l=-1:(t.preventDefault(),f=-1);break;case 39:t.shiftKey?l=1:(t.preventDefault(),f=1);break;case 38:t.shiftKey?u=1:(t.preventDefault(),_=-1);break;case 40:t.shiftKey?u=-1:(t.preventDefault(),_=1);break;default:return}return this._rotationDisabled&&(l=0,u=0),{cameraAnimation:v=>{const S=this._tr;v.easeTo({duration:300,easeId:"keyboardHandler",easing:Yl,zoom:n?Math.round(S.zoom)+n*(t.shiftKey?2:1):S.zoom,bearing:S.bearing+l*this._bearingStep,pitch:S.pitch+u*this._pitchStep,offset:[-f*this._panStep,-_*this._panStep],center:S.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Yl(d){return d*(2-d)}const Jl=4.000244140625;class du{constructor(t,n){this._onTimeout=l=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},this._map=t,this._tr=new bn(t),this._el=t.getCanvasContainer(),this._triggerRenderFrame=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!t[this._map._metaKey])return;t.preventDefault()}let n=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const l=o.h.now(),u=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,n!==0&&n%Jl==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":u>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(u*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),t.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=t,this._delta-=n,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=L.mousePos(this._el,t),l=this._tr;this._around=o.L.convert(this._aroundCenter?l.center:l.unproject(n)),this._aroundPoint=l.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(this._delta!==0){const v=this._type==="wheel"&&Math.abs(this._delta)>Jl?this._wheelZoomRate:this._defaultZoomRate;let S=2/(1+Math.exp(-Math.abs(this._delta*v)));this._delta<0&&S!==0&&(S=1/S);const T=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(T*S))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const n=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,l=this._startZoom,u=this._easing;let f,_=!1;if(this._type==="wheel"&&l&&u){const v=Math.min((o.h.now()-this._lastWheelEventTime)/200,1),S=u(v);f=o.B.number(l,n,S),v<1?this._frameId||(this._frameId=!0):_=!0}else f=n,_=!0;return this._active=!0,_&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!_,zoomDelta:f-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let n=o.bb;if(this._prevEase){const l=this._prevEase,u=(o.h.now()-l.start)/l.duration,f=l.easing(u+.01)-l.easing(u),_=.27/Math.sqrt(f*f+1e-4)*.01,v=Math.sqrt(.0729-_*_);n=o.ba(_,v,.25,1)}return this._prevEase={start:o.h.now(),duration:t,easing:n},n}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Ms{constructor(t,n){this._clickZoom=t,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class As{constructor(t){this._tr=new bn(t),this.reset()}reset(){this._active=!1}dblclick(t,n){return t.preventDefault(),{cameraAnimation:l=>{l.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(n)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ks{constructor(){this._tap=new Do({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,n,l){if(!this._swipePoint)if(this._tapTime){const u=n[0],f=t.timeStamp-this._tapTime<500,_=this._tapPoint.dist(u)<30;f&&_?l.length>0&&(this._swipePoint=u,this._swipeTouch=l[0].identifier):this.reset()}else this._tap.touchstart(t,n,l)}touchmove(t,n,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;const u=n[0],f=u.y-this._swipePoint.y;return this._swipePoint=u,t.preventDefault(),this._active=!0,{zoomDelta:f/128}}}else this._tap.touchmove(t,n,l)}touchend(t,n,l){if(this._tapTime)this._swipePoint&&l.length===0&&this.reset();else{const u=this._tap.touchend(t,n,l);u&&(this._tapTime=t.timeStamp,this._tapPoint=u)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class zs{constructor(t,n,l){this._el=t,this._mousePan=n,this._touchPan=l}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Er{constructor(t,n,l){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=n,this._mousePitch=l}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Vn{constructor(t,n,l,u){this._el=t,this._touchZoom=n,this._touchRotate=l,this._tapDragZoom=u,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Za=d=>d.zoom||d.drag||d.pitch||d.rotate;class Ls extends o.k{}function Ha(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class Ds{constructor(t,n){this.handleWindowEvent=u=>{this.handleEvent(u,`${u.type}Window`)},this.handleEvent=(u,f)=>{if(u.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const _=u.type==="renderFrame"?void 0:u,v={needsRenderFrame:!1},S={},T={},P=u.touches,M=P?this._getMapTouches(P):void 0,B=M?L.touchPos(this._el,M):L.mousePos(this._el,u);for(const{handlerName:X,handler:U,allowed:oe}of this._handlers){if(!U.isEnabled())continue;let pe;this._blockedByActive(T,oe,X)?U.reset():U[f||u.type]&&(pe=U[f||u.type](u,B,M),this.mergeHandlerResult(v,S,pe,X,_),pe&&pe.needsRenderFrame&&this._triggerRenderFrame()),(pe||U.isActive())&&(T[X]=U)}const H={};for(const X in this._previousActiveHandlers)T[X]||(H[X]=_);this._previousActiveHandlers=T,(Object.keys(H).length||Ha(v))&&(this._changes.push([v,S,H]),this._triggerRenderFrame()),(Object.keys(T).length||Ha(v))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Z}=v;Z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Z(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ul(t),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(n);const l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[window,"blur",void 0]];for(const[u,f,_]of this._listeners)L.addEventListener(u,f,u===document?this.handleWindowEvent:this.handleEvent,_)}destroy(){for(const[t,n,l]of this._listeners)L.removeEventListener(t,n,t===document?this.handleWindowEvent:this.handleEvent,l)}_addDefaultHandlers(t){const n=this._map,l=n.getCanvasContainer();this._add("mapEvent",new Gl(n,t));const u=n.boxZoom=new Hl(n,t);this._add("boxZoom",u),t.interactive&&t.boxZoom&&u.enable();const f=new Sn(n),_=new As(n);n.doubleClickZoom=new Ms(_,f),this._add("tapZoom",f),this._add("clickZoom",_),t.interactive&&t.doubleClickZoom&&n.doubleClickZoom.enable();const v=new ks;this._add("tapDragZoom",v);const S=n.touchPitch=new hu(n);this._add("touchPitch",S),t.interactive&&t.touchPitch&&n.touchPitch.enable(t.touchPitch);const T=va(t),P=Tn(t);n.dragRotate=new Er(t,T,P),this._add("mouseRotate",T,["mousePitch"]),this._add("mousePitch",P,["mouseRotate"]),t.interactive&&t.dragRotate&&n.dragRotate.enable();const M=(({enable:oe,clickTolerance:pe})=>{const ee=new Ts({checkCorrectEvent:le=>L.mouseButton(le)===0&&!le.ctrlKey});return new Cn({clickTolerance:pe,move:(le,_e)=>({around:_e,panDelta:_e.sub(le)}),activateOnStart:!0,moveStateManager:ee,enable:oe,assignEvents:Ro})})(t),B=new it(t,n);n.dragPan=new zs(l,M,B),this._add("mousePan",M),this._add("touchPan",B,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&n.dragPan.enable(t.dragPan);const H=new Es,Z=new Xl;n.touchZoomRotate=new Vn(l,Z,H,v),this._add("touchRotate",H,["touchPan","touchZoom"]),this._add("touchZoom",Z,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&n.touchZoomRotate.enable(t.touchZoomRotate);const X=n.scrollZoom=new du(n,()=>this._triggerRenderFrame());this._add("scrollZoom",X,["mousePan"]),t.interactive&&t.scrollZoom&&n.scrollZoom.enable(t.scrollZoom);const U=n.keyboard=new Kl(n);this._add("keyboard",U),t.interactive&&t.keyboard&&n.keyboard.enable(),this._add("blockableMapEvent",new Zl(n))}_add(t,n,l){this._handlers.push({handlerName:t,handler:n,allowed:l}),this._handlersById[t]=n}stop(t){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Za(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,n,l){for(const u in t)if(u!==l&&(!n||n.indexOf(u)<0))return!0;return!1}_getMapTouches(t){const n=[];for(const l of t)this._el.contains(l.target)&&n.push(l);return n}mergeHandlerResult(t,n,l,u,f){if(!l)return;o.e(t,l);const _={handlerName:u,originalEvent:l.originalEvent||f};l.zoomDelta!==void 0&&(n.zoom=_),l.panDelta!==void 0&&(n.drag=_),l.pitchDelta!==void 0&&(n.pitch=_),l.bearingDelta!==void 0&&(n.rotate=_)}_applyChanges(){const t={},n={},l={};for(const[u,f,_]of this._changes)u.panDelta&&(t.panDelta=(t.panDelta||new o.P(0,0))._add(u.panDelta)),u.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+u.zoomDelta),u.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+u.bearingDelta),u.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+u.pitchDelta),u.around!==void 0&&(t.around=u.around),u.pinchAround!==void 0&&(t.pinchAround=u.pinchAround),u.noInertia&&(t.noInertia=u.noInertia),o.e(n,f),o.e(l,_);this._updateMapTransform(t,n,l),this._changes=[]}_updateMapTransform(t,n,l){const u=this._map,f=u._getTransformForUpdate(),_=u.terrain;if(!(Ha(t)||_&&this._terrainMovement))return this._fireEvents(n,l,!0);let{panDelta:v,zoomDelta:S,bearingDelta:T,pitchDelta:P,around:M,pinchAround:B}=t;B!==void 0&&(M=B),u._stop(!0),M=M||u.transform.centerPoint;const H=f.pointLocation(v?M.sub(v):M);T&&(f.bearing+=T),P&&(f.pitch+=P),S&&(f.zoom+=S),_?this._terrainMovement||!n.drag&&!n.zoom?n.drag&&this._terrainMovement?f.center=f.pointLocation(f.centerPoint.sub(v)):f.setLocationAtPoint(H,M):(this._terrainMovement=!0,this._map._elevationFreeze=!0,f.setLocationAtPoint(H,M),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,f.recalculateZoom(u.terrain)})):f.setLocationAtPoint(H,M),u._applyUpdatedTransform(f),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(n,l,!0)}_fireEvents(t,n,l){const u=Za(this._eventsInProgress),f=Za(t),_={};for(const P in t){const{originalEvent:M}=t[P];this._eventsInProgress[P]||(_[`${P}start`]=M),this._eventsInProgress[P]=t[P]}!u&&f&&this._fireEvent("movestart",f.originalEvent);for(const P in _)this._fireEvent(P,_[P]);f&&this._fireEvent("move",f.originalEvent);for(const P in t){const{originalEvent:M}=t[P];this._fireEvent(P,M)}const v={};let S;for(const P in this._eventsInProgress){const{handlerName:M,originalEvent:B}=this._eventsInProgress[P];this._handlersById[M].isActive()||(delete this._eventsInProgress[P],S=n[M]||B,v[`${P}end`]=S)}for(const P in v)this._fireEvent(P,v[P]);const T=Za(this._eventsInProgress);if(l&&(u||f)&&!T){this._updatingCamera=!0;const P=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),M=B=>B!==0&&-this._bearingSnap<B&&B<this._bearingSnap;!P||!P.essential&&o.h.prefersReducedMotion?(this._map.fire(new o.k("moveend",{originalEvent:S})),M(this._map.getBearing())&&this._map.resetNorth()):(M(P.bearing||this._map.getBearing())&&(P.bearing=0),P.freezeElevation=!0,this._map.easeTo(P,{originalEvent:S})),this._updatingCamera=!1}}_fireEvent(t,n){this._map.fire(new o.k(t,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new Ls("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Ql extends o.E{constructor(t,n){super(),this._renderFrameCallback=()=>{const l=Math.min((o.h.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(l)),l<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=n.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new o.L(this.transform.center.lng,this.transform.center.lat)}setCenter(t,n){return this.jumpTo({center:t},n)}panBy(t,n,l){return t=o.P.convert(t).mult(-1),this.panTo(this.transform.center,o.e({offset:t},n),l)}panTo(t,n,l){return this.easeTo(o.e({center:t},n),l)}getZoom(){return this.transform.zoom}setZoom(t,n){return this.jumpTo({zoom:t},n),this}zoomTo(t,n,l){return this.easeTo(o.e({zoom:t},n),l)}zoomIn(t,n){return this.zoomTo(this.getZoom()+1,t,n),this}zoomOut(t,n){return this.zoomTo(this.getZoom()-1,t,n),this}getBearing(){return this.transform.bearing}setBearing(t,n){return this.jumpTo({bearing:t},n),this}getPadding(){return this.transform.padding}setPadding(t,n){return this.jumpTo({padding:t},n),this}rotateTo(t,n,l){return this.easeTo(o.e({bearing:t},n),l)}resetNorth(t,n){return this.rotateTo(0,o.e({duration:1e3},t),n),this}resetNorthPitch(t,n){return this.easeTo(o.e({bearing:0,pitch:0,duration:1e3},t),n),this}snapToNorth(t,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,n):this}getPitch(){return this.transform.pitch}setPitch(t,n){return this.jumpTo({pitch:t},n),this}cameraForBounds(t,n){t=Oe.convert(t);const l=n&&n.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),l,n)}_cameraForBoxAndBearing(t,n,l,u){const f={top:0,bottom:0,right:0,left:0};if(typeof(u=o.e({padding:f,offset:[0,0],maxZoom:this.transform.maxZoom},u)).padding=="number"){const _e=u.padding;u.padding={top:_e,bottom:_e,right:_e,left:_e}}u.padding=o.e(f,u.padding);const _=this.transform,v=_.padding,S=_.project(o.L.convert(t)),T=_.project(o.L.convert(n)),P=S.rotate(-l*Math.PI/180),M=T.rotate(-l*Math.PI/180),B=new o.P(Math.max(P.x,M.x),Math.max(P.y,M.y)),H=new o.P(Math.min(P.x,M.x),Math.min(P.y,M.y)),Z=B.sub(H),X=(_.width-(v.left+v.right+u.padding.left+u.padding.right))/Z.x,U=(_.height-(v.top+v.bottom+u.padding.top+u.padding.bottom))/Z.y;if(U<0||X<0)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const oe=Math.min(_.scaleZoom(_.scale*Math.min(X,U)),u.maxZoom),pe=o.P.convert(u.offset),ee=new o.P((u.padding.left-u.padding.right)/2,(u.padding.top-u.padding.bottom)/2).rotate(l*Math.PI/180),le=pe.add(ee).mult(_.scale/_.zoomScale(oe));return{center:_.unproject(S.add(T).div(2).sub(le)),zoom:oe,bearing:l}}fitBounds(t,n,l){return this._fitInternal(this.cameraForBounds(t,n),n,l)}fitScreenCoordinates(t,n,l,u,f){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(o.P.convert(t)),this.transform.pointLocation(o.P.convert(n)),l,u),u,f)}_fitInternal(t,n,l){return t?(delete(n=o.e(t,n)).padding,n.linear?this.easeTo(n,l):this.flyTo(n,l)):this}jumpTo(t,n){this.stop();const l=this._getTransformForUpdate();let u=!1,f=!1,_=!1;return"zoom"in t&&l.zoom!==+t.zoom&&(u=!0,l.zoom=+t.zoom),t.center!==void 0&&(l.center=o.L.convert(t.center)),"bearing"in t&&l.bearing!==+t.bearing&&(f=!0,l.bearing=+t.bearing),"pitch"in t&&l.pitch!==+t.pitch&&(_=!0,l.pitch=+t.pitch),t.padding==null||l.isPaddingEqual(t.padding)||(l.padding=t.padding),this._applyUpdatedTransform(l),this.fire(new o.k("movestart",n)).fire(new o.k("move",n)),u&&this.fire(new o.k("zoomstart",n)).fire(new o.k("zoom",n)).fire(new o.k("zoomend",n)),f&&this.fire(new o.k("rotatestart",n)).fire(new o.k("rotate",n)).fire(new o.k("rotateend",n)),_&&this.fire(new o.k("pitchstart",n)).fire(new o.k("pitch",n)).fire(new o.k("pitchend",n)),this.fire(new o.k("moveend",n))}calculateCameraOptionsFromTo(t,n,l,u=0){const f=o.U.fromLngLat(t,n),_=o.U.fromLngLat(l,u),v=_.x-f.x,S=_.y-f.y,T=_.z-f.z,P=Math.hypot(v,S,T);if(P===0)throw new Error("Can't calculate camera options with same From and To");const M=Math.hypot(v,S),B=this.transform.scaleZoom(this.transform.cameraToCenterDistance/P/this.transform.tileSize),H=180*Math.atan2(v,-S)/Math.PI;let Z=180*Math.acos(M/P)/Math.PI;return Z=T<0?90-Z:90+Z,{center:_.toLngLat(),zoom:B,pitch:Z,bearing:H}}easeTo(t,n){this._stop(!1,t.easeId),((t=o.e({offset:[0,0],duration:500,easing:o.bb},t)).animate===!1||!t.essential&&o.h.prefersReducedMotion)&&(t.duration=0);const l=this._getTransformForUpdate(),u=this.getZoom(),f=this.getBearing(),_=this.getPitch(),v=this.getPadding(),S="zoom"in t?+t.zoom:u,T="bearing"in t?this._normalizeBearing(t.bearing,f):f,P="pitch"in t?+t.pitch:_,M="padding"in t?t.padding:l.padding,B=o.P.convert(t.offset);let H=l.centerPoint.add(B);const Z=l.pointLocation(H),X=o.L.convert(t.center||Z);this._normalizeCenter(X);const U=l.project(Z),oe=l.project(X).sub(U),pe=l.zoomScale(S-u);let ee,le;t.around&&(ee=o.L.convert(t.around),le=l.locationPoint(ee));const _e={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||S!==u,this._rotating=this._rotating||f!==T,this._pitching=this._pitching||P!==_,this._padding=!l.isPaddingEqual(M),this._easeId=t.easeId,this._prepareEase(n,t.noMoveStart,_e),this.terrain&&this._prepareElevation(X),this._ease(we=>{if(this._zooming&&(l.zoom=o.B.number(u,S,we)),this._rotating&&(l.bearing=o.B.number(f,T,we)),this._pitching&&(l.pitch=o.B.number(_,P,we)),this._padding&&(l.interpolatePadding(v,M,we),H=l.centerPoint.add(B)),this.terrain&&!t.freezeElevation&&this._updateElevation(we),ee)l.setLocationAtPoint(ee,le);else{const Me=l.zoomScale(l.zoom-u),Fe=S>u?Math.min(2,pe):Math.max(.5,pe),Re=Math.pow(Fe,1-we),Ue=l.unproject(U.add(oe.mult(we*Re)).mult(Me));l.setLocationAtPoint(l.renderWorldCopies?Ue.wrap():Ue,H)}this._applyUpdatedTransform(l),this._fireMoveEvents(n)},we=>{this.terrain&&this._finalizeElevation(),this._afterEase(n,we)},t),this}_prepareEase(t,n,l={}){this._moving=!0,n||l.moving||this.fire(new o.k("movestart",t)),this._zooming&&!l.zooming&&this.fire(new o.k("zoomstart",t)),this._rotating&&!l.rotating&&this.fire(new o.k("rotatestart",t)),this._pitching&&!l.pitching&&this.fire(new o.k("pitchstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const n=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&n!==this._elevationTarget){const l=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(l-(n-(l*t+this._elevationStart))/(1-t)),this._elevationTarget=n}this.transform.elevation=o.B.number(this._elevationStart,this._elevationTarget,t)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(t){if(!this.transformCameraUpdate)return;const n=t.clone(),{center:l,zoom:u,pitch:f,bearing:_,elevation:v}=this.transformCameraUpdate(n);l&&(n.center=l),u!==void 0&&(n.zoom=u),f!==void 0&&(n.pitch=f),_!==void 0&&(n.bearing=_),v!==void 0&&(n.elevation=v),this.transform.apply(n)}_fireMoveEvents(t){this.fire(new o.k("move",t)),this._zooming&&this.fire(new o.k("zoom",t)),this._rotating&&this.fire(new o.k("rotate",t)),this._pitching&&this.fire(new o.k("pitch",t))}_afterEase(t,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId;const l=this._zooming,u=this._rotating,f=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,l&&this.fire(new o.k("zoomend",t)),u&&this.fire(new o.k("rotateend",t)),f&&this.fire(new o.k("pitchend",t)),this.fire(new o.k("moveend",t))}flyTo(t,n){if(!t.essential&&o.h.prefersReducedMotion){const ut=o.F(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(ut,n)}this.stop(),t=o.e({offset:[0,0],speed:1.2,curve:1.42,easing:o.bb},t);const l=this._getTransformForUpdate(),u=this.getZoom(),f=this.getBearing(),_=this.getPitch(),v=this.getPadding(),S="zoom"in t?o.ad(+t.zoom,l.minZoom,l.maxZoom):u,T="bearing"in t?this._normalizeBearing(t.bearing,f):f,P="pitch"in t?+t.pitch:_,M="padding"in t?t.padding:l.padding,B=l.zoomScale(S-u),H=o.P.convert(t.offset);let Z=l.centerPoint.add(H);const X=l.pointLocation(Z),U=o.L.convert(t.center||X);this._normalizeCenter(U);const oe=l.project(X),pe=l.project(U).sub(oe);let ee=t.curve;const le=Math.max(l.width,l.height),_e=le/B,we=pe.mag();if("minZoom"in t){const ut=o.ad(Math.min(t.minZoom,u,S),l.minZoom,l.maxZoom),hi=le/l.zoomScale(ut-u);ee=Math.sqrt(hi/we*2)}const Me=ee*ee;function Fe(ut){const hi=(_e*_e-le*le+(ut?-1:1)*Me*Me*we*we)/(2*(ut?_e:le)*Me*we);return Math.log(Math.sqrt(hi*hi+1)-hi)}function Re(ut){return(Math.exp(ut)-Math.exp(-ut))/2}function Ue(ut){return(Math.exp(ut)+Math.exp(-ut))/2}const lt=Fe(!1);let Ut=function(ut){return Ue(lt)/Ue(lt+ee*ut)},We=function(ut){return le*((Ue(lt)*(Re(hi=lt+ee*ut)/Ue(hi))-Re(lt))/Me)/we;var hi},bt=(Fe(!0)-lt)/ee;if(Math.abs(we)<1e-6||!isFinite(bt)){if(Math.abs(le-_e)<1e-6)return this.easeTo(t,n);const ut=_e<le?-1:1;bt=Math.abs(Math.log(_e/le))/ee,We=function(){return 0},Ut=function(hi){return Math.exp(ut*ee*hi)}}return t.duration="duration"in t?+t.duration:1e3*bt/("screenSpeed"in t?+t.screenSpeed/ee:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=f!==T,this._pitching=P!==_,this._padding=!l.isPaddingEqual(M),this._prepareEase(n,!1),this.terrain&&this._prepareElevation(U),this._ease(ut=>{const hi=ut*bt,Vt=1/Ut(hi);l.zoom=ut===1?S:u+l.scaleZoom(Vt),this._rotating&&(l.bearing=o.B.number(f,T,ut)),this._pitching&&(l.pitch=o.B.number(_,P,ut)),this._padding&&(l.interpolatePadding(v,M,ut),Z=l.centerPoint.add(H)),this.terrain&&!t.freezeElevation&&this._updateElevation(ut);const Dt=ut===1?U:l.unproject(oe.add(pe.mult(We(hi))).mult(Vt));l.setLocationAtPoint(l.renderWorldCopies?Dt.wrap():Dt,Z),this._applyUpdatedTransform(l),this._fireMoveEvents(n)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(n)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,n){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const l=this._onEaseEnd;delete this._onEaseEnd,l.call(this,n)}if(!t){const l=this.handlers;l&&l.stop(!1)}return this}_ease(t,n,l){l.animate===!1||l.duration===0?(t(1),n()):(this._easeStart=o.h.now(),this._easeOptions=l,this._onEaseFrame=t,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,n){t=o.b5(t,-180,180);const l=Math.abs(t-n);return Math.abs(t-360-n)<l&&(t-=360),Math.abs(t+360-n)<l&&(t+=360),t}_normalizeCenter(t){const n=this.transform;if(!n.renderWorldCopies||n.lngRange)return;const l=t.lng-n.center.lng;t.lng+=l>180?-360:l<-180?360:0}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(o.L.convert(t),this.transform.tileZoom)-this.transform.elevation:null}}class Or{constructor(t={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=n=>{!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"&&n.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options&&this.options.compact,this._container=L.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=L.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=L.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){L.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,n){const l=this._map._getUIString(`AttributionControl.${n}`);t.title=l,t.setAttribute("aria-label",l)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(u=>typeof u!="string"?"":u)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const u=this._map.style.stylesheet;this.styleOwner=u.owner,this.styleId=u.id}const n=this._map.style.sourceCaches;for(const u in n){const f=n[u];if(f.used||f.usedForTerrain){const _=f.getSource();_.attribution&&t.indexOf(_.attribution)<0&&t.push(_.attribution)}}t=t.filter(u=>String(u).trim()),t.sort((u,f)=>u.length-f.length),t=t.filter((u,f)=>{for(let _=f+1;_<t.length;_++)if(t[_].indexOf(u)>=0)return!1;return!0});const l=t.join(" | ");l!==this._attribHTML&&(this._attribHTML=l,t.length?(this._innerContainer.innerHTML=l,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class _i{constructor(t={}){this._updateCompact=()=>{const n=this._container.children;if(n.length){const l=n[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact"):l.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=L.create("div","maplibregl-ctrl");const n=L.create("a","maplibregl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://maplibre.org/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){L.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Oo{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const n=++this._id;return this._queue.push({callback:t,id:n,cancelled:!1}),n}remove(t){const n=this._currentlyRunning,l=n?this._queue.concat(n):this._queue;for(const u of l)if(u.id===t)return void(u.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const n=this._currentlyRunning=this._queue;this._queue=[];for(const l of n)if(!l.cancelled&&(l.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const Rs={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var ec=o.Q([{name:"a_pos3d",type:"Int16",components:3}]);class tc extends o.E{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,n){this.sourceCache.update(t,n),this._renderableTilesKeys=[];const l={};for(const u of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:n}))l[u.key]=!0,this._renderableTilesKeys.push(u.key),this._tiles[u.key]||(u.posMatrix=new Float64Array(16),o.aS(u.posMatrix,0,o.N,0,o.N,0,1),this._tiles[u.key]=new Fi(u,this.tileSize));for(const u in this._tiles)l[u]||delete this._tiles[u]}freeRtt(t){for(const n in this._tiles){const l=this._tiles[n];(!t||l.tileID.equals(t)||l.tileID.isChildOf(t)||t.isChildOf(l.tileID))&&(l.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const n={};for(const l of this._renderableTilesKeys){const u=this._tiles[l].tileID;if(u.canonical.equals(t.canonical)){const f=t.clone();f.posMatrix=new Float64Array(16),o.aS(f.posMatrix,0,o.N,0,o.N,0,1),n[l]=f}else if(u.canonical.isChildOf(t.canonical)){const f=t.clone();f.posMatrix=new Float64Array(16);const _=u.canonical.z-t.canonical.z,v=u.canonical.x-(u.canonical.x>>_<<_),S=u.canonical.y-(u.canonical.y>>_<<_),T=o.N>>_;o.aS(f.posMatrix,0,T,0,T,0,1),o.$(f.posMatrix,f.posMatrix,[-v*T,-S*T,0]),n[l]=f}else if(t.canonical.isChildOf(u.canonical)){const f=t.clone();f.posMatrix=new Float64Array(16);const _=t.canonical.z-u.canonical.z,v=t.canonical.x-(t.canonical.x>>_<<_),S=t.canonical.y-(t.canonical.y>>_<<_),T=o.N>>_;o.aS(f.posMatrix,0,o.N,0,o.N,0,1),o.$(f.posMatrix,f.posMatrix,[v*T,S*T,0]),o.a0(f.posMatrix,f.posMatrix,[1/2**_,1/2**_,0]),n[l]=f}}return n}getSourceTile(t,n){const l=this.sourceCache._source;let u=t.overscaledZ-this.deltaZoom;if(u>l.maxzoom&&(u=l.maxzoom),u<l.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(u).key);let f=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!f||!f.dem)&&n)for(;u>=l.minzoom&&(!f||!f.dem);)f=this.sourceCache.getTileByID(t.scaledTo(u--).key);return f}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(n=>n.timeAdded>=t)}}class ic{constructor(t,n,l){this.painter=t,this.sourceCache=new tc(n),this.options=l,this.exaggeration=typeof l.exaggeration=="number"?l.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,n,l,u=o.N){var f;if(!(n>=0&&n<u&&l>=0&&l<u))return 0;const _=this.getTerrainData(t),v=(f=_.tile)===null||f===void 0?void 0:f.dem;if(!v)return 0;const S=function(Z,X,U){var oe=X[0],pe=X[1];return Z[0]=U[0]*oe+U[4]*pe+U[12],Z[1]=U[1]*oe+U[5]*pe+U[13],Z}([],[n/u*o.N,l/u*o.N],_.u_terrain_matrix),T=[S[0]*v.dim,S[1]*v.dim],P=Math.floor(T[0]),M=Math.floor(T[1]),B=T[0]-P,H=T[1]-M;return v.get(P,M)*(1-B)*(1-H)+v.get(P+1,M)*B*(1-H)+v.get(P,M+1)*(1-B)*H+v.get(P+1,M+1)*B*H}getElevationForLngLatZoom(t,n){const{tileID:l,mercatorX:u,mercatorY:f}=this._getOverscaledTileIDFromLngLatZoom(t,n);return this.getElevation(l,u%o.N,f%o.N,o.N)}getElevation(t,n,l,u=o.N){return this.getDEMElevation(t,n,l,u)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const u=this.painter.context,f=new o.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Ce(u,f,u.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Ce(u,new o.R({width:1,height:1}),u.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.ao([])}const n=this.sourceCache.getSourceTile(t,!0);if(n&&n.dem&&(!n.demTexture||n.needsTerrainPrepare)){const u=this.painter.context;n.demTexture=this.painter.getTileTexture(n.dem.stride),n.demTexture?n.demTexture.update(n.dem.getPixels(),{premultiply:!1}):n.demTexture=new Ce(u,n.dem.getPixels(),u.gl.RGBA,{premultiply:!1}),n.demTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),n.needsTerrainPrepare=!1}const l=n&&n+n.tileID.key+t.key;if(l&&!this._demMatrixCache[l]){const u=this.sourceCache.sourceCache._source.maxzoom;let f=t.canonical.z-n.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=u?f=t.canonical.z-u:o.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const _=t.canonical.x-(t.canonical.x>>f<<f),v=t.canonical.y-(t.canonical.y>>f<<f),S=o.bc(new Float64Array(16),[1/(o.N<<f),1/(o.N<<f),0]);o.$(S,S,[_*o.N,v*o.N,0]),this._demMatrixCache[t.key]={matrix:S,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:n&&n.dem&&n.dem.dim||1,u_terrain_matrix:l?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:n&&n.dem&&n.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(n&&n.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:n}}getFramebuffer(t){const n=this.painter,l=n.width/devicePixelRatio,u=n.height/devicePixelRatio;return!this._fbo||this._fbo.width===l&&this._fbo.height===u||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Ce(n.context,{width:l,height:u,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Ce(n.context,{width:l,height:u,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=n.context.createFramebuffer(l,u,!0,!1),this._fbo.depthAttachment.set(n.context.createRenderbuffer(n.context.gl.DEPTH_COMPONENT16,l,u))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const n=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let f=0,_=0;f<this._coordsTextureSize;f++)for(let v=0;v<this._coordsTextureSize;v++,_+=4)n[_+0]=255&v,n[_+1]=255&f,n[_+2]=v>>8<<4|f>>8,n[_+3]=0;const l=new o.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(n.buffer)),u=new Ce(t,l,t.gl.RGBA,{premultiply:!1});return u.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=u,u}pointCoordinate(t){const n=new Uint8Array(4),l=this.painter.context,u=l.gl;l.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),u.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,u.RGBA,u.UNSIGNED_BYTE,n),l.bindFramebuffer.set(null);const f=n[0]+(n[2]>>4<<8),_=n[1]+((15&n[2])<<8),v=this.coordsIndex[255-n[3]],S=v&&this.sourceCache.getTileByID(v);if(!S)return null;const T=this._coordsTextureSize,P=(1<<S.tileID.canonical.z)*T;return new o.U(this._allowMercatorOverflow(t,(S.tileID.canonical.x*T+f)/P),(S.tileID.canonical.y*T+_)/P,this.getElevation(S.tileID,f,_,T))}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.painter.context,n=new o.bd,l=new o.b0,u=this.meshSize,f=o.N/u,_=u*u;for(let M=0;M<=u;M++)for(let B=0;B<=u;B++)n.emplaceBack(B*f,M*f,0);for(let M=0;M<_;M+=u+1)for(let B=0;B<u;B++)l.emplaceBack(B+M,u+B+M+1,u+B+M+2),l.emplaceBack(B+M,u+B+M+2,B+M+1);const v=n.length,S=v+2*(u+1);for(const M of[0,1])for(let B=0;B<=u;B++)for(const H of[0,1])n.emplaceBack(B*f,M*o.N,H);for(let M=0;M<2*u;M+=2)l.emplaceBack(S+M,S+M+1,S+M+3),l.emplaceBack(S+M,S+M+3,S+M+2),l.emplaceBack(v+M,v+M+3,v+M+1),l.emplaceBack(v+M,v+M+2,v+M+3);const T=n.length,P=T+2*(u+1);for(const M of[0,1])for(let B=0;B<=u;B++)for(const H of[0,1])n.emplaceBack(M*o.N,B*f,H);for(let M=0;M<2*u;M+=2)l.emplaceBack(T+M,T+M+1,T+M+3),l.emplaceBack(T+M,T+M+3,T+M+2),l.emplaceBack(P+M,P+M+3,P+M+1),l.emplaceBack(P+M,P+M+2,P+M+3);return this._mesh={indexBuffer:t.createIndexBuffer(l),vertexBuffer:t.createVertexBuffer(n,ec.members),segments:o.S.simpleSegment(0,0,n.length,l.length)},this._mesh}getMeshFrameDelta(t){return 2*Math.PI*o.be/Math.pow(2,t)/5}getMinTileElevationForLngLatZoom(t,n){var l;const{tileID:u}=this._getOverscaledTileIDFromLngLatZoom(t,n);return(l=this.getMinMaxElevation(u).minElevation)!==null&&l!==void 0?l:0}getMinMaxElevation(t){const n=this.getTerrainData(t).tile,l={minElevation:null,maxElevation:null};return n&&n.dem&&(l.minElevation=n.dem.min*this.exaggeration,l.maxElevation=n.dem.max*this.exaggeration),l}_getOverscaledTileIDFromLngLatZoom(t,n){const l=o.U.fromLngLat(t.wrap()),u=(1<<n)*o.N,f=l.x*u,_=l.y*u,v=Math.floor(f/o.N),S=Math.floor(_/o.N);return{tileID:new o.O(n,0,n,v,S),mercatorX:f,mercatorY:_}}_allowMercatorOverflow(t,n){const l=t.x<this.painter.width/2;let u=o.bf(n);const f=this.painter.transform.center.lng;return l&&Math.sign(u)>0&&Math.sign(f)<0||!l&&Math.sign(u)<0&&Math.sign(f)>0?(u=360*Math.sign(f)+u,o.G(u)):n}}class pu{constructor(t,n,l){this._context=t,this._size=n,this._tileSize=l,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const n=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),l=new Ce(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return l.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),n.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),n.colorAttachment.set(l.texture),{id:t,fbo:n,texture:l,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(n=>t.id!==n),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const n of this._recentlyUsed)if(!this._objects[n].inUse)return this._objects[n];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const yr={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Bo{constructor(t,n){this.painter=t,this.terrain=n,this.pool=new pu(t.context,30,n.sourceCache.tileSize*n.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,n){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(l=>!t._layers[l].isHidden(n)),this._coordsDescendingInv={};for(const l in t.sourceCaches){this._coordsDescendingInv[l]={};const u=t.sourceCaches[l].getVisibleCoordinates();for(const f of u){const _=this.terrain.sourceCache.getTerrainCoords(f);for(const v in _)this._coordsDescendingInv[l][v]||(this._coordsDescendingInv[l][v]=[]),this._coordsDescendingInv[l][v].push(_[v])}}this._coordsDescendingInvStr={};for(const l of t._order){const u=t._layers[l],f=u.source;if(yr[u.type]&&!this._coordsDescendingInvStr[f]){this._coordsDescendingInvStr[f]={};for(const _ in this._coordsDescendingInv[f])this._coordsDescendingInvStr[f][_]=this._coordsDescendingInv[f][_].map(v=>v.key).sort().join()}}for(const l of this._renderableTiles)for(const u in this._coordsDescendingInvStr){const f=this._coordsDescendingInvStr[u][l.tileID.key];f&&f!==l.rttCoords[u]&&(l.rtt=[])}}renderLayer(t){if(t.isHidden(this.painter.transform.zoom))return!1;const n=t.type,l=this.painter,u=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(yr[n]&&(this._prevType&&yr[this._prevType]||this._stacks.push([]),this._prevType=n,this._stacks[this._stacks.length-1].push(t.id),!u))return!0;if(yr[this._prevType]||yr[n]&&u){this._prevType=n;const f=this._stacks.length-1,_=this._stacks[f]||[];for(const v of this._renderableTiles){if(this.pool.isFull()&&(ki(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(v),v.rtt[f]){const T=this.pool.getObjectForId(v.rtt[f].id);if(T.stamp===v.rtt[f].stamp){this.pool.useObject(T);continue}}const S=this.pool.getOrCreateFreeObject();this.pool.useObject(S),this.pool.stampObject(S),v.rtt[f]={id:S.id,stamp:S.stamp},l.context.bindFramebuffer.set(S.fbo.framebuffer),l.context.clear({color:o.aT.transparent,stencil:0}),l.currentStencilSource=void 0;for(let T=0;T<_.length;T++){const P=l.style._layers[_[T]],M=P.source?this._coordsDescendingInv[P.source][v.tileID.key]:[v.tileID];l.context.viewport.set([0,0,S.fbo.width,S.fbo.height]),l._renderTileClippingMasks(P,M),l.renderLayer(l,l.style.sourceCaches[P.source],P,M),P.source&&(v.rttCoords[P.source]=this._coordsDescendingInvStr[P.source][v.tileID.key])}}return ki(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),yr[n]}return!1}}const pt=O,xt={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:o.c.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},Wa=d=>{d.touchstart=d.dragStart,d.touchmoveWindow=d.dragMove,d.touchend=d.dragEnd},$s={showCompass:!0,showZoom:!0,visualizePitch:!1};class Os{constructor(t,n,l=!1){this.mousedown=_=>{this.startMouse(o.e({},_,{ctrlKey:!0,preventDefault:()=>_.preventDefault()}),L.mousePos(this.element,_)),L.addEventListener(window,"mousemove",this.mousemove),L.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=_=>{this.moveMouse(_,L.mousePos(this.element,_))},this.mouseup=_=>{this.mouseRotate.dragEnd(_),this.mousePitch&&this.mousePitch.dragEnd(_),this.offTemp()},this.touchstart=_=>{_.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=L.touchPos(this.element,_.targetTouches)[0],this.startTouch(_,this._startPos),L.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),L.addEventListener(window,"touchend",this.touchend))},this.touchmove=_=>{_.targetTouches.length!==1?this.reset():(this._lastPos=L.touchPos(this.element,_.targetTouches)[0],this.moveTouch(_,this._lastPos))},this.touchend=_=>{_.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const u=t.dragRotate._mouseRotate.getClickTolerance(),f=t.dragRotate._mousePitch.getClickTolerance();this.element=n,this.mouseRotate=va({clickTolerance:u,enable:!0}),this.touchRotate=(({enable:_,clickTolerance:v,bearingDegreesPerPixelMoved:S=.8})=>{const T=new Wl;return new Cn({clickTolerance:v,move:(P,M)=>({bearingDelta:(M.x-P.x)*S}),moveStateManager:T,enable:_,assignEvents:Wa})})({clickTolerance:u,enable:!0}),this.map=t,l&&(this.mousePitch=Tn({clickTolerance:f,enable:!0}),this.touchPitch=(({enable:_,clickTolerance:v,pitchDegreesPerPixelMoved:S=-.5})=>{const T=new Wl;return new Cn({clickTolerance:v,move:(P,M)=>({pitchDelta:(M.y-P.y)*S}),moveStateManager:T,enable:_,assignEvents:Wa})})({clickTolerance:f,enable:!0})),L.addEventListener(n,"mousedown",this.mousedown),L.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),L.addEventListener(n,"touchcancel",this.reset)}startMouse(t,n){this.mouseRotate.dragStart(t,n),this.mousePitch&&this.mousePitch.dragStart(t,n),L.disableDrag()}startTouch(t,n){this.touchRotate.dragStart(t,n),this.touchPitch&&this.touchPitch.dragStart(t,n),L.disableDrag()}moveMouse(t,n){const l=this.map,{bearingDelta:u}=this.mouseRotate.dragMove(t,n)||{};if(u&&l.setBearing(l.getBearing()+u),this.mousePitch){const{pitchDelta:f}=this.mousePitch.dragMove(t,n)||{};f&&l.setPitch(l.getPitch()+f)}}moveTouch(t,n){const l=this.map,{bearingDelta:u}=this.touchRotate.dragMove(t,n)||{};if(u&&l.setBearing(l.getBearing()+u),this.touchPitch){const{pitchDelta:f}=this.touchPitch.dragMove(t,n)||{};f&&l.setPitch(l.getPitch()+f)}}off(){const t=this.element;L.removeEventListener(t,"mousedown",this.mousedown),L.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),L.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),L.removeEventListener(window,"touchend",this.touchend),L.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){L.enableDrag(),L.removeEventListener(window,"mousemove",this.mousemove),L.removeEventListener(window,"mouseup",this.mouseup),L.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),L.removeEventListener(window,"touchend",this.touchend)}}let ji;function Bs(d,t,n){if(d=new o.L(d.lng,d.lat),t){const l=new o.L(d.lng-360,d.lat),u=new o.L(d.lng+360,d.lat),f=n.locationPoint(d).distSqr(t);n.locationPoint(l).distSqr(t)<f?d=l:n.locationPoint(u).distSqr(t)<f&&(d=u)}for(;Math.abs(d.lng-n.center.lng)>180;){const l=n.locationPoint(d);if(l.x>=0&&l.y>=0&&l.x<=n.width&&l.y<=n.height)break;d.lng>n.center.lng?d.lng-=360:d.lng+=360}return d}const Kr={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function rc(d,t,n){const l=d.classList;for(const u in Kr)l.remove(`maplibregl-${n}-anchor-${u}`);l.add(`maplibregl-${n}-anchor-${t}`)}class ta extends o.E{constructor(t){if(super(),this._onKeyPress=n=>{const l=n.code,u=n.charCode||n.keyCode;l!=="Space"&&l!=="Enter"&&u!==32&&u!==13||this.togglePopup()},this._onMapClick=n=>{const l=n.originalEvent.target,u=this._element;this._popup&&(l===u||u.contains(l))&&this.togglePopup()},this._update=n=>{if(!this._map)return;const l=this._map.loaded()&&!this._map.isMoving();(n?.type==="terrain"||n?.type==="render"&&!l)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=Bs(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let u="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?u=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(u=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let f="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?f="rotateX(0deg)":this._pitchAlignment==="map"&&(f=`rotateX(${this._map.getPitch()}deg)`),n&&n.type!=="moveend"||(this._pos=this._pos.round()),L.setTransform(this._element,`${Kr[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${f} ${u}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const _=this._map.unproject(this._pos),v=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=_.distanceTo(this._lngLat)>20*v?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=n=>{if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.k("dragstart"))),this.fire(new o.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.k("dragend")),this._state="inactive"},this._addDragHandler=n=>{this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos).add(this._offset),this._pointerdownPos=n.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=o.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=L.create("div"),this._element.setAttribute("aria-label","Map marker");const n=L.createNS("http://www.w3.org/2000/svg","svg"),l=41,u=27;n.setAttributeNS(null,"display","block"),n.setAttributeNS(null,"height",`${l}px`),n.setAttributeNS(null,"width",`${u}px`),n.setAttributeNS(null,"viewBox",`0 0 ${u} ${l}`);const f=L.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"stroke","none"),f.setAttributeNS(null,"stroke-width","1"),f.setAttributeNS(null,"fill","none"),f.setAttributeNS(null,"fill-rule","evenodd");const _=L.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"fill-rule","nonzero");const v=L.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"transform","translate(3.0, 29.0)"),v.setAttributeNS(null,"fill","#000000");const S=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const oe of S){const pe=L.createNS("http://www.w3.org/2000/svg","ellipse");pe.setAttributeNS(null,"opacity","0.04"),pe.setAttributeNS(null,"cx","10.5"),pe.setAttributeNS(null,"cy","5.80029008"),pe.setAttributeNS(null,"rx",oe.rx),pe.setAttributeNS(null,"ry",oe.ry),v.appendChild(pe)}const T=L.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"fill",this._color);const P=L.createNS("http://www.w3.org/2000/svg","path");P.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),T.appendChild(P);const M=L.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"opacity","0.25"),M.setAttributeNS(null,"fill","#000000");const B=L.createNS("http://www.w3.org/2000/svg","path");B.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),M.appendChild(B);const H=L.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"transform","translate(6.0, 7.0)"),H.setAttributeNS(null,"fill","#FFFFFF");const Z=L.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"transform","translate(8.0, 8.0)");const X=L.createNS("http://www.w3.org/2000/svg","circle");X.setAttributeNS(null,"fill","#000000"),X.setAttributeNS(null,"opacity","0.25"),X.setAttributeNS(null,"cx","5.5"),X.setAttributeNS(null,"cy","5.5"),X.setAttributeNS(null,"r","5.4999962");const U=L.createNS("http://www.w3.org/2000/svg","circle");U.setAttributeNS(null,"fill","#FFFFFF"),U.setAttributeNS(null,"cx","5.5"),U.setAttributeNS(null,"cy","5.5"),U.setAttributeNS(null,"r","5.4999962"),Z.appendChild(X),Z.appendChild(U),_.appendChild(v),_.appendChild(T),_.appendChild(M),_.appendChild(H),_.appendChild(Z),n.appendChild(_),n.setAttributeNS(null,"height",l*this._scale+"px"),n.setAttributeNS(null,"width",u*this._scale+"px"),this._element.appendChild(n),this._offset=o.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",n=>{n.preventDefault()}),this._element.addEventListener("mousedown",n=>{n.preventDefault()}),rc(this._element,this._anchor,"marker"),t&&t.className)for(const n of t.className.split(" "))this._element.classList.add(n);this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),L.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=o.L.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const u=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[u,-1*(38.1-13.5+u)],"bottom-right":[-u,-1*(38.1-13.5+u)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(t){return this._offset=o.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const zi={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Pi=0,ba=!1;const Xa={maxWidth:100,unit:"metric"};function Ka(d,t,n){const l=n&&n.maxWidth||100,u=d._container.clientHeight/2,f=d.unproject([0,u]),_=d.unproject([l,u]),v=f.distanceTo(_);if(n&&n.unit==="imperial"){const S=3.2808*v;S>5280?ia(t,l,S/5280,d._getUIString("ScaleControl.Miles")):ia(t,l,S,d._getUIString("ScaleControl.Feet"))}else n&&n.unit==="nautical"?ia(t,l,v/1852,d._getUIString("ScaleControl.NauticalMiles")):v>=1e3?ia(t,l,v/1e3,d._getUIString("ScaleControl.Kilometers")):ia(t,l,v,d._getUIString("ScaleControl.Meters"))}function ia(d,t,n,l){const u=function(f){const _=Math.pow(10,`${Math.floor(f)}`.length-1);let v=f/_;return v=v>=10?10:v>=5?5:v>=3?3:v>=2?2:v>=1?1:function(S){const T=Math.pow(10,Math.ceil(-Math.log(S)/Math.LN10));return Math.round(S*T)/T}(v),_*v}(n);d.style.width=t*(u/n)+"px",d.innerHTML=`${u}&nbsp;${l}`}const Fs={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Ns=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function wa(d){if(d){if(typeof d=="number"){const t=Math.round(Math.abs(d)/Math.SQRT2);return{center:new o.P(0,0),top:new o.P(0,d),"top-left":new o.P(t,t),"top-right":new o.P(-t,t),bottom:new o.P(0,-d),"bottom-left":new o.P(t,-t),"bottom-right":new o.P(-t,-t),left:new o.P(d,0),right:new o.P(-d,0)}}if(d instanceof o.P||Array.isArray(d)){const t=o.P.convert(d);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:o.P.convert(d.center||[0,0]),top:o.P.convert(d.top||[0,0]),"top-left":o.P.convert(d["top-left"]||[0,0]),"top-right":o.P.convert(d["top-right"]||[0,0]),bottom:o.P.convert(d.bottom||[0,0]),"bottom-left":o.P.convert(d["bottom-left"]||[0,0]),"bottom-right":o.P.convert(d["bottom-right"]||[0,0]),left:o.P.convert(d.left||[0,0]),right:o.P.convert(d.right||[0,0])}}return wa(new o.P(0,0))}const js={extend:(d,...t)=>o.e(d,...t),run(d){d()},logToElement(d,t=!1,n="log"){const l=window.document.getElementById(n);l&&(t&&(l.innerHTML=""),l.innerHTML+=`<br>${d}`)}},Vs=O;class oi{static get version(){return Vs}static get workerCount(){return Gi.workerCount}static set workerCount(t){Gi.workerCount=t}static get maxParallelImageRequests(){return o.c.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(t){o.c.MAX_PARALLEL_IMAGE_REQUESTS=t}static get workerUrl(){return o.c.WORKER_URL}static set workerUrl(t){o.c.WORKER_URL=t}static addProtocol(t,n){o.c.REGISTERED_PROTOCOLS[t]=n}static removeProtocol(t){delete o.c.REGISTERED_PROTOCOLS[t]}}return oi.Map=class extends Ql{constructor(d){if(o.bg.mark(o.bh.create),(d=o.e({},xt,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Lo(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies),{bearingSnap:d.bearingSnap}),this._cooperativeGesturesOnWheel=t=>{this._onCooperativeGesture(t,t[this._metaKey],1)},this._contextLost=t=>{t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.k("webglcontextlost",{originalEvent:t}))},this._contextRestored=t=>{this._setupPainter(),this.resize(),this._update(),this.fire(new o.k("webglcontextrestored",{originalEvent:t}))},this._onMapScroll=t=>{if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=d.interactive,this._cooperativeGestures=d.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=d.maxTileCacheSize,this._maxTileCacheZoomLevels=d.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._crossSourceCollisions=d.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=d.collectResourceTiming,this._renderTaskQueue=new Oo,this._controls=[],this._mapId=o.a2(),this._locale=o.e({},Rs,d.locale),this._clickTolerance=d.clickTolerance,this._overridePixelRatio=d.pixelRatio,this._maxCanvasSize=d.maxCanvasSize,this.transformCameraUpdate=d.transformCameraUpdate,this._imageQueueHandle=xe.addThrottleControl(()=>this.isMoving()),this._requestManager=new be(d.transformRequest),typeof d.container=="string"){if(this._container=document.getElementById(d.container),!this._container)throw new Error(`Container '${d.container}' not found.`)}else{if(!(d.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(d.maxBounds&&this.setMaxBounds(d.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let t=!1;const n=ea(l=>{this._trackResize&&!this._removed&&this.resize(l)._update()},50);this._resizeObserver=new ResizeObserver(l=>{t?n(l):t=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Ds(this,d),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=d.hash&&new Ua(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,o.e({},d.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=d.localIdeographFontFamily,this._validateStyle=d.validateStyle,d.style&&this.setStyle(d.style,{localIdeographFontFamily:d.localIdeographFontFamily}),d.attributionControl&&this.addControl(new Or({customAttribution:d.customAttribution})),d.maplibreLogo&&this.addControl(new _i,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update(t.dataType==="style"),this.fire(new o.k(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new o.k(`${t.dataType}dataloading`,t))}),this.on("dataabort",t=>{this.fire(new o.k("sourcedataabort",t))})}_getMapId(){return this._mapId}addControl(d,t){if(t===void 0&&(t=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new o.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=d.onAdd(this);this._controls.push(d);const l=this._controlPositions[t];return t.indexOf("bottom")!==-1?l.insertBefore(n,l.firstChild):l.appendChild(n),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new o.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(d);return t>-1&&this._controls.splice(t,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}calculateCameraOptionsFromTo(d,t,n,l){return l==null&&this.terrain&&(l=this.terrain.getElevationForLngLatZoom(n,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(d,t,n,l)}resize(d){var t;const n=this._containerDimensions(),l=n[0],u=n[1],f=this._getClampedPixelRatio(l,u);if(this._resizeCanvas(l,u,f),this.painter.resize(l,u,f),this.painter.overLimit()){const v=this.painter.context.gl;this._maxCanvasSize=[v.drawingBufferWidth,v.drawingBufferHeight];const S=this._getClampedPixelRatio(l,u);this._resizeCanvas(l,u,S),this.painter.resize(l,u,S)}this.transform.resize(l,u),(t=this._requestedCameraState)===null||t===void 0||t.resize(l,u);const _=!this._moving;return _&&(this.stop(),this.fire(new o.k("movestart",d)).fire(new o.k("move",d))),this.fire(new o.k("resize",d)),_&&this.fire(new o.k("moveend",d)),this}_getClampedPixelRatio(d,t){const{0:n,1:l}=this._maxCanvasSize,u=this.getPixelRatio(),f=d*u,_=t*u;return Math.min(f>n?n/f:1,_>l?l/_:1)*u}getPixelRatio(){var d;return(d=this._overridePixelRatio)!==null&&d!==void 0?d:devicePixelRatio}setPixelRatio(d){this._overridePixelRatio=d,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(d){return this.transform.setMaxBounds(Oe.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d&&this.setZoom(d),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d&&this.setZoom(d),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d&&this.setPitch(d),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d&&this.setPitch(d),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(d){return this._cooperativeGestures=d,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(d){return this.transform.locationPoint(o.L.convert(d),this.style&&this.terrain)}unproject(d){return this.transform.pointLocation(o.P.convert(d),this.terrain)}isMoving(){var d;return this._moving||((d=this.handlers)===null||d===void 0?void 0:d.isMoving())}isZooming(){var d;return this._zooming||((d=this.handlers)===null||d===void 0?void 0:d.isZooming())}isRotating(){var d;return this._rotating||((d=this.handlers)===null||d===void 0?void 0:d.isRotating())}_createDelegatedListener(d,t,n){if(d==="mouseenter"||d==="mouseover"){let l=!1;return{layer:t,listener:n,delegates:{mousemove:f=>{const _=this.getLayer(t)?this.queryRenderedFeatures(f.point,{layers:[t]}):[];_.length?l||(l=!0,n.call(this,new $r(d,this,f.originalEvent,{features:_}))):l=!1},mouseout:()=>{l=!1}}}}if(d==="mouseleave"||d==="mouseout"){let l=!1;return{layer:t,listener:n,delegates:{mousemove:_=>{(this.getLayer(t)?this.queryRenderedFeatures(_.point,{layers:[t]}):[]).length?l=!0:l&&(l=!1,n.call(this,new $r(d,this,_.originalEvent)))},mouseout:_=>{l&&(l=!1,n.call(this,new $r(d,this,_.originalEvent)))}}}}{const l=u=>{const f=this.getLayer(t)?this.queryRenderedFeatures(u.point,{layers:[t]}):[];f.length&&(u.features=f,n.call(this,u),delete u.features)};return{layer:t,listener:n,delegates:{[d]:l}}}}on(d,t,n){if(n===void 0)return super.on(d,t);const l=this._createDelegatedListener(d,t,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(l);for(const u in l.delegates)this.on(u,l.delegates[u]);return this}once(d,t,n){if(n===void 0)return super.once(d,t);const l=this._createDelegatedListener(d,t,n);for(const u in l.delegates)this.once(u,l.delegates[u]);return this}off(d,t,n){return n===void 0?super.off(d,t):(this._delegatedListeners&&this._delegatedListeners[d]&&(l=>{const u=this._delegatedListeners[d];for(let f=0;f<u.length;f++){const _=u[f];if(_.layer===t&&_.listener===n){for(const v in _.delegates)this.off(v,_.delegates[v]);return u.splice(f,1),this}}})(),this)}queryRenderedFeatures(d,t){if(!this.style)return[];let n;const l=d instanceof o.P||Array.isArray(d),u=l?d:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(l?{}:d)||{},u instanceof o.P||typeof u[0]=="number")n=[o.P.convert(u)];else{const f=o.P.convert(u[0]),_=o.P.convert(u[1]);n=[f,new o.P(_.x,f.y),_,new o.P(f.x,_.y),f]}return this.style.queryRenderedFeatures(n,t,this.transform)}querySourceFeatures(d,t){return this.style.querySourceFeatures(d,t)}setStyle(d,t){return(t=o.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&d?(this._diffStyle(d,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(d,t))}setTransformRequest(d){return this._requestManager.setTransformRequest(d),this}_getUIString(d){const t=this._locale[d];if(t==null)throw new Error(`Missing UI string '${d}'`);return t}_updateStyle(d,t){if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(d,t));const n=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!d)),d?(this.style=new sr(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d,t,n):this.style.loadJSON(d,t,n),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new sr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(d,t){if(typeof d=="string"){const n=this._requestManager.transformRequest(d,ve.Style);o.f(n,(l,u)=>{l?this.fire(new o.j(l)):u&&this._updateDiff(u,t)})}else typeof d=="object"&&this._updateDiff(d,t)}_updateDiff(d,t){try{this.style.setState(d,t)&&this._update(!0)}catch(n){o.w(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(d,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.w("There is no style added to the map.")}addSource(d,t){return this._lazyInitEmptyStyle(),this.style.addSource(d,t),this._update(!0)}isSourceLoaded(d){const t=this.style&&this.style.sourceCaches[d];if(t!==void 0)return t.loaded();this.fire(new o.j(new Error(`There is no source with ID '${d}'`)))}setTerrain(d){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),d){const t=this.style.sourceCaches[d.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${d.source}`);for(const n in this.style._layers){const l=this.style._layers[n];l.type==="hillshade"&&l.source===d.source&&o.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new ic(this.painter,t,d),this.painter.renderToTexture=new Bo(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=n=>{n.dataType==="style"?this.terrain.sourceCache.freeRtt():n.dataType==="source"&&n.tile&&(n.sourceId!==d.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(n.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new o.k("terrain",{terrain:d})),this}getTerrain(){var d,t;return(t=(d=this.terrain)===null||d===void 0?void 0:d.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const d=this.style&&this.style.sourceCaches;for(const t in d){const n=d[t]._tiles;for(const l in n){const u=n[l];if(u.state!=="loaded"&&u.state!=="errored")return!1}}return!0}addSourceType(d,t,n){return this._lazyInitEmptyStyle(),this.style.addSourceType(d,t,n)}removeSource(d){return this.style.removeSource(d),this._update(!0)}getSource(d){return this.style.getSource(d)}addImage(d,t,n={}){const{pixelRatio:l=1,sdf:u=!1,stretchX:f,stretchY:_,content:v}=n;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||o.a(t))){if(t.width===void 0||t.height===void 0)return this.fire(new o.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:S,height:T,data:P}=t,M=t;return this.style.addImage(d,{data:new o.R({width:S,height:T},new Uint8Array(P)),pixelRatio:l,stretchX:f,stretchY:_,content:v,sdf:u,version:0,userImage:M}),M.onAdd&&M.onAdd(this,d),this}}{const{width:S,height:T,data:P}=o.h.getImageData(t);this.style.addImage(d,{data:new o.R({width:S,height:T},P),pixelRatio:l,stretchX:f,stretchY:_,content:v,sdf:u,version:0})}}updateImage(d,t){const n=this.style.getImage(d);if(!n)return this.fire(new o.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const l=t instanceof HTMLImageElement||o.a(t)?o.h.getImageData(t):t,{width:u,height:f,data:_}=l;if(u===void 0||f===void 0)return this.fire(new o.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(u!==n.data.width||f!==n.data.height)return this.fire(new o.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const v=!(t instanceof HTMLImageElement||o.a(t));return n.data.replace(_,v),this.style.updateImage(d,n),this}getImage(d){return this.style.getImage(d)}hasImage(d){return d?!!this.style.getImage(d):(this.fire(new o.j(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d,t){xe.getImage(this._requestManager.transformRequest(d,ve.Image),t)}listImages(){return this.style.listImages()}addLayer(d,t){return this._lazyInitEmptyStyle(),this.style.addLayer(d,t),this._update(!0)}moveLayer(d,t){return this.style.moveLayer(d,t),this._update(!0)}removeLayer(d){return this.style.removeLayer(d),this._update(!0)}getLayer(d){return this.style.getLayer(d)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(d,t,n){return this.style.setLayerZoomRange(d,t,n),this._update(!0)}setFilter(d,t,n={}){return this.style.setFilter(d,t,n),this._update(!0)}getFilter(d){return this.style.getFilter(d)}setPaintProperty(d,t,n,l={}){return this.style.setPaintProperty(d,t,n,l),this._update(!0)}getPaintProperty(d,t){return this.style.getPaintProperty(d,t)}setLayoutProperty(d,t,n,l={}){return this.style.setLayoutProperty(d,t,n,l),this._update(!0)}getLayoutProperty(d,t){return this.style.getLayoutProperty(d,t)}setGlyphs(d,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(d,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(d,t,n={}){return this._lazyInitEmptyStyle(),this.style.addSprite(d,t,n,l=>{l||this._update(!0)}),this}removeSprite(d){return this._lazyInitEmptyStyle(),this.style.removeSprite(d),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(d,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(d,t,n=>{n||this._update(!0)}),this}setLight(d,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(d,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(d,t){return this.style.setFeatureState(d,t),this._update()}removeFeatureState(d,t){return this.style.removeFeatureState(d,t),this._update()}getFeatureState(d){return this.style.getFeatureState(d)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let d=0,t=0;return this._container&&(d=this._container.clientWidth||400,t=this._container.clientHeight||300),[d,t]}_setupContainer(){const d=this._container;d.classList.add("maplibregl-map");const t=this._canvasContainer=L.create("div","maplibregl-canvas-container",d);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=L.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const n=this._containerDimensions(),l=this._getClampedPixelRatio(n[0],n[1]);this._resizeCanvas(n[0],n[1],l);const u=this._controlContainer=L.create("div","maplibregl-control-container",d),f=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(_=>{f[_]=L.create("div",`maplibregl-ctrl-${_} `,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=L.create("div","maplibregl-cooperative-gesture-screen",this._container);let d=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(d=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use ⌘ + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${d}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){L.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(d,t,n){this._canvas.width=Math.floor(n*d),this._canvas.height=Math.floor(n*t),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const d={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let t=null;this._canvas.addEventListener("webglcontextcreationerror",l=>{t={requestedAttributes:d},l&&(t.statusMessage=l.statusMessage,t.type=l.type)},{once:!0});const n=this._canvas.getContext("webgl2",d)||this._canvas.getContext("webgl",d);if(!n){const l="Failed to initialize WebGL";throw t?(t.message=l,new Error(JSON.stringify(t))):new Error(l)}this.painter=new Qn(n,this.transform),V.testSupport(n)}_onCooperativeGesture(d,t,n){return!t&&n<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(d){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_render(d){const t=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),this._removed)return;let n=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const u=this.transform.zoom,f=o.h.now();this.style.zoomHistory.update(u,f);const _=new o.a8(u,{now:f,fadeDuration:t,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),v=_.crossFadingFactor();v===1&&v===this._crossFadingFactor||(n=!0,this._crossFadingFactor=v),this.style.update(_)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,t,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:t,showPadding:this.showPadding}),this.fire(new o.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.bg.mark(o.bh.load),this.fire(new o.k("load"))),this.style&&(this.style.hasTransitions()||n)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const l=this._sourcesDirty||this._styleDirty||this._placementDirty;return l||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.k("idle")),!this._loaded||this._fullyLoaded||l||(this._fullyLoaded=!0,o.bg.mark(o.bh.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var d;this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),xe.removeThrottleControl(this._imageQueueHandle),(d=this._resizeObserver)===null||d===void 0||d.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),L.remove(this._canvasContainer),L.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),o.bg.clearMetrics(),this._removed=!0,this.fire(new o.k("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=o.h.frame(d=>{o.bg.frame(d),this._frame=null,this._render(d)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get version(){return pt}getCameraTargetElevation(){return this.transform.elevation}},oi.NavigationControl=class{constructor(d){this._updateZoomButtons=()=>{const t=this._map.getZoom(),n=t===this._map.getMaxZoom(),l=t===this._map.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},this._rotateCompassArrow=()=>{const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t},this._setButtonTitle=(t,n)=>{const l=this._map._getUIString(`NavigationControl.${n}`);t.title=l,t.setAttribute("aria-label",l)},this.options=o.e({},$s,d),this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),L.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),L.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=L.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Os(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){L.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(d,t){const n=L.create("button",d,this._container);return n.type="button",n.addEventListener("click",t),n}},oi.GeolocateControl=class extends o.E{constructor(d){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new o.k("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new o.k("geolocate",t)),this._finish()}},this._updateCamera=t=>{const n=new o.L(t.coords.longitude,t.coords.latitude),l=t.coords.accuracy,u=this._map.getBearing(),f=o.e({bearing:u},this.options.fitBoundsOptions),_=Oe.fromLngLat(n,l);this._map.fitBounds(_,f,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const n=new o.L(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(this.options.trackUserLocation)if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&ba)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new o.k("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=t=>{if(this._map){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=L.create("button","maplibregl-ctrl-geolocate",this._container),L.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",t===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=L.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new ta({element:this._dotElement}),this._circleElement=L.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ta({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new o.k("trackuserlocationend")))})}},this.options=o.e({},zi,d)}onAdd(d){return this._map=d,this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(t,n=!1){ji===void 0||n?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(l=>{ji=l.state!=="denied",t(ji)}).catch(()=>{ji=!!window.navigator.geolocation,t(ji)}):(ji=!!window.navigator.geolocation,t(ji)):t(ji)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),L.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Pi=0,ba=!1}_isOutOfMapMaxBounds(d){const t=this._map.getMaxBounds(),n=d.coords;return t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const d=this._map.getBounds(),t=d.getSouthEast(),n=d.getNorthEast(),l=t.distanceTo(n),u=Math.ceil(this._accuracy/(l/this._map._container.clientHeight)*2);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Pi--,ba=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new o.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Pi++,Pi>1?(d={maximumAge:6e5,timeout:0},ba=!0):(d=this.options.positionOptions,ba=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,d)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},oi.AttributionControl=Or,oi.LogoControl=_i,oi.ScaleControl=class{constructor(d){this._onMove=()=>{Ka(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,Ka(this._map,this._container,this.options)},this.options=o.e({},Xa,d)}getDefaultPosition(){return"bottom-left"}onAdd(d){return this._map=d,this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-scale",d.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){L.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},oi.FullscreenControl=class extends o.E{constructor(d={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,d&&d.container&&(d.container instanceof HTMLElement?this._container=d.container:o.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=L.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){L.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const d=this._fullscreenButton=L.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);L.create("span","maplibregl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.title=d}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new o.k("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new o.k("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},oi.TerrainControl=class{constructor(d){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=d}onAdd(d){return this._map=d,this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=L.create("button","maplibregl-ctrl-terrain",this._container),L.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){L.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},oi.Popup=class extends o.E{constructor(d){super(),this.remove=()=>(this._content&&L.remove(this._content),this._container&&(L.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new o.k("close")),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=L.create("div","maplibregl-popup",this._map.getContainer()),this._tip=L.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const _ of this.options.className.split(" "))this._container.classList.add(_);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Bs(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!t)return;const n=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);let l=this.options.anchor;const u=wa(this.options.offset);if(!l){const _=this._container.offsetWidth,v=this._container.offsetHeight;let S;S=n.y+u.bottom.y<v?["top"]:n.y>this._map.transform.height-v?["bottom"]:[],n.x<_/2?S.push("left"):n.x>this._map.transform.width-_/2&&S.push("right"),l=S.length===0?"bottom":S.join("-")}const f=n.add(u[l]).round();L.setTransform(this._container,`${Kr[l]} translate(${f.x}px,${f.y}px)`),rc(this._container,l,"popup")},this._onClose=()=>{this.remove()},this.options=o.e(Object.create(Fs),d)}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new o.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(d){return this._lngLat=o.L.convert(d),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(document.createTextNode(d))}setHTML(d){const t=document.createDocumentFragment(),n=document.createElement("body");let l;for(n.innerHTML=d;l=n.firstChild,l;)t.appendChild(l);return this.setDOMContent(t)}getMaxWidth(){var d;return(d=this._container)===null||d===void 0?void 0:d.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=L.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(d),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(d){this._container&&this._container.classList.add(d)}removeClassName(d){this._container&&this._container.classList.remove(d)}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){if(this._container)return this._container.classList.toggle(d)}_createCloseButton(){this.options.closeButton&&(this._closeButton=L.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(Ns);d&&d.focus()}},oi.Marker=ta,oi.Style=sr,oi.LngLat=o.L,oi.LngLatBounds=Oe,oi.Point=o.P,oi.MercatorCoordinate=o.U,oi.Evented=o.E,oi.AJAXError=o.bi,oi.config=o.c,oi.CanvasSource=pi,oi.GeoJSONSource=Yt,oi.ImageSource=kt,oi.RasterDEMTileSource=$t,oi.RasterTileSource=wt,oi.VectorTileSource=Bt,oi.VideoSource=gi,oi.setRTLTextPlugin=o.bj,oi.getRTLTextPluginStatus=o.bk,oi.prewarm=function(){cn().acquire(Ft)},oi.clearPrewarmedResources=function(){const d=yi;d&&(d.isPreloaded()&&d.numActive()===1?(d.release(Ft),yi=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},js.extend(oi,{isSafari:o.ac,getPerformanceMetrics:o.bg.getPerformanceMetrics}),oi});var z=w;return z})})(Fg);var m2=Fg.exports;const g2=Im(m2);function y2(){const[s,h]=k.useState(!1);return Pe.jsx("div",{className:s?"fixed top-0 right-0 bottom-0 left-0 z-[9999]":"w-full h-full relative",children:Pe.jsx(p2,{mapLib:g2,style:{width:"100%",height:" 100%",position:"relative"},mapStyle:"https://api.ekgis.vn/v2/mapstyles/style/osmplus/standard/style.json?api_key=wtpM0U1ZmE2s87LEZNSHf63Osc1a2sboaozCQNsy",children:Pe.jsx(f2,{id:"raster-tiles",type:"raster",tileSize:256,tiles:["https://api.ekgis.vn/v1/maps/roadmap/{z}/{x}/{y}.png?api_key=wtpM0U1ZmE2s87LEZNSHf63Osc1a2sboaozCQNsy"]})})})}function _2({data:s}){return Pe.jsxs(no,{className:"h-[500px]",children:[Pe.jsx(Ur,{span:8,children:Pe.jsx(Zh,{columns:[{title:"Stt",dataIndex:"stt",key:"stt",render:(h,y,x)=>x+1},...Qh],dataSource:Sg,pagination:!1})}),Pe.jsx(Ur,{span:16,children:Pe.jsx(y2,{})})]})}const{Dragger:v2}=I1,x2={name:"file",multiple:!0,action:"https://run.mocky.io/v3/435e224c-44fb-4773-9faf-380c5e6a2188",onChange(s){const{status:h}=s.file;h!=="uploading"&&console.log(s.file,s.fileList),h==="done"?xf.success(`${s.file.name} file uploaded successfully.`):h==="error"&&xf.error(`${s.file.name} file upload failed.`)},onDrop(s){console.log("Dropped files",s.dataTransfer.files)}};function b2(){return Pe.jsxs(v2,{...x2,children:[Pe.jsx("p",{className:"ant-upload-drag-icon",children:Pe.jsx(k1,{})}),Pe.jsx("p",{className:"ant-upload-text",children:"Click or drag file to this area to upload"}),Pe.jsx("p",{className:"ant-upload-hint",children:"Support for a single or bulk upload. Strictly prohibited from uploading company data or other banned files."})]})}function w2({form:s,filter:h,setFilter:y}){const[x,w]=k.useState([]),[E,z]=k.useState([]),[o,O]=k.useState([]),[L,V]=k.useState([]);k.useState(""),k.useState(""),k.useEffect(()=>{s.setFieldsValue(h)},[h]),k.useEffect(()=>{(async()=>{let ae=await Ln.get("/api/method/frappe.desk.search.search_link",{params:{txt:"",doctype:"Customer Group",ignore_user_permissions:0,reference_doctype:"Customer"}}),fe=await Ln.get("/api/method/mbw_dms.api.location.list_province");z(fe.result);let{results:me}=ae;w(me.map(xe=>({label:xe.value,value:xe.value})))})()},[]);const q=async ae=>{let fe=E.find(me=>me.ten_tinh==ae)?.ma_tinh;if(fe){let me=await Ln.get("/api/method/mbw_dms.api.location.list_district",{params:{ma_tinh_thanh:Number.parseInt(fe)}});O(me.result)}},Q=async ae=>{let fe=o.find(me=>me.ten_huyen==ae)?.ma_huyen;if(fe){let me=await Ln.get("/api/method/mbw_dms.api.location.list_ward",{params:{ma_quan_huyen:fe}});V(me.result)}};return Pe.jsxs(Lh,{form:s,layout:"vertical",onFinish:y,children:[Pe.jsx(Qr,{label:"Loại khách hàng",name:"customer_type",children:Pe.jsx(zn,{options:[{label:"Tất cả",value:!1},{label:"Company",value:"Company"},{label:"Individual",value:"Individual"}]})}),Pe.jsx(Qr,{label:"Nhóm khách hàng",name:"customer_group",children:Pe.jsx(zn,{options:x})}),Pe.jsx("p",{className:"font-medium text-sm",children:"Địa chỉ"}),Pe.jsx(Qr,{label:"Tỉnh/Thành phố",name:"city",children:Pe.jsx(zn,{options:E.map(ae=>({label:ae.ten_tinh,value:ae.ten_tinh})),onChange:q})}),Pe.jsx(Qr,{label:"Quận/huyện",name:"district",children:Pe.jsx(zn,{options:o.map(ae=>({label:ae.ten_huyen,value:ae.ten_huyen})),disabled:o.length==0,onChange:Q})}),Pe.jsx(Qr,{label:"Phường/xã",name:"ward",children:Pe.jsx(zn,{options:L.map(ae=>({label:ae.ten_xa,value:ae.ten_xa})),disabled:L.length==0})})]})}const S2=[...Qh,{title:"Loại khách hàng",dataIndex:"customer_id",key:"customer_type"},{title:"Nhóm khách hàng",dataIndex:"customer_name",key:"customer_group"},...wg],um=s=>{let h=[];for(let y in s)s[y]&&(h=[...h,{key:[R1[y]],value:s[y],key2:y}]);return h};function C2({selected:s,handleAdd:h,closeModal:y}){const[x]=pv(),[w,E]=k.useState([]),[z,o]=k.useState(Sg),[O,L]=k.useState({}),[V,q]=k.useState(!1),Q=20,[ae,fe]=k.useState(1),[me,xe]=k.useState(40),ve={selectedRowKeys:w&&w.map(Se=>Se.name),onChange:(Se,ze)=>{E(ze)}},be=()=>{x.submit(),q(!1)},ge=Se=>{if(Se){let ze={...O};delete ze[Se.key2],x.setFieldsValue(ze),L(Be=>(delete Be[Se.key2],{...Be}))}else x.resetFields(),L({})};k.useEffect(()=>{(async()=>{const Se=await Ln.get("/api/method/mbw_dms.api.router.get_customer",{params:{...O,page_size:Q,page_number:ae}});o(Se?.result?.data),xe(Se.result?.total),console.log("rsCustomer",Se)})()},[O,ae]);const ce=()=>{w.length>0&&h(w),y()};return k.useEffect(()=>{E(s)},[s]),Pe.jsxs(Pe.Fragment,{children:[Pe.jsxs(no,{className:"justify-between",children:[Pe.jsxs(Ur,{className:"inline-flex ",children:[Pe.jsx(Qr,{children:Pe.jsx(Rc,{placeholder:"Tìm kiếm khách hàng",prefix:Pe.jsx(Pm,{})})}),Pe.jsxs("div",{className:"flex justify-center items-center ml-4",children:[Pe.jsx(ha,{className:"flex items-center text-nowrap !text-[13px] !leading-[21px] !font-normal  border-r-[0.1px] rounded-r-none h-[36px]",icon:Pe.jsx(_v,{style:{fontSize:"20px"}}),onClick:q.bind(null,!0),children:"Filter"}),Pe.jsx(ha,{className:"border-l-[0.1px] rounded-l-none h-[36px]",onClick:()=>ge(),children:Pe.jsx(vv,{style:{fontSize:"20px"}})})]})]}),Pe.jsxs(Ur,{className:"inline-flex items-center",children:[Pe.jsxs("span",{className:"mr-4",children:["Đã chọn ",w.length||0," khách hàng"]}),Pe.jsx(ha,{type:"primary",onClick:ce,children:"Thêm"})]})]}),Pe.jsxs("div",{className:"py-5 px-4",children:[Pe.jsxs("span",{children:[z.length," kết quả hiển thị"]}),um(O).length>0&&Pe.jsxs(no,{className:"items-center",children:[um(O).map(Se=>Pe.jsxs(fv,{closeIcon:Pe.jsx(so,{}),onClose:()=>{ge(Se)},children:[Se.key,": ",Se.value]})),Pe.jsx("span",{className:"cursor-pointer",onClick:()=>ge(),children:"Clear all"})]})]}),Pe.jsx(Zh,{rowSelection:{type:"checkbox",...ve},columns:S2,dataSource:z.map(Se=>({key:Se.name,...Se})),pagination:!1}),Pe.jsx(no,{className:"justify-end mt-2",children:Pe.jsx(mv,{defaultCurrent:ae,pageSize:Q,total:me,onChange:(Se,ze)=>{fe(Se)}})}),Pe.jsx(Rh,{width:451,title:"Bộ lọc",open:V,okText:"Áp dụng",cancelText:"Đặt lại",onCancel:q.bind(null,!1),onOk:be,children:Pe.jsx(w2,{filter:O,setFilter:L,form:x})})]})}function T2({listCustomer:s,handleCustomer:h}){const[y,x]=k.useState("list"),[w,E]=k.useState(!1),[z,o]=k.useState(!1),O=V=>{switch(V){case"Choose":E(!1);break;case"Import":o(!1);break;default:E(!1),o(!1)}},L=V=>{switch(V){case"Choose":E(!0);break;case"Import":o(!0);break}};return Pe.jsxs(Pe.Fragment,{children:[Pe.jsxs(no,{gutter:16,className:"justify-between p-4 pb-5 pt-10 mt-0",children:[Pe.jsx(Ur,{children:Pe.jsxs(no,{gutter:8,children:[Pe.jsx(Ur,{span:9,className:"text-[#1677ff]",children:Pe.jsx(Qr,{children:Pe.jsx(zn,{defaultValue:"add",options:L1,onSelect:L})})}),Pe.jsx(Ur,{span:7,children:Pe.jsx(ha,{className:"w-full flex items-center text-[#1677ff] bg-[#1877f214] h-[36px]",icon:Pe.jsx($w,{}),children:"Tối ưu tuyến"})}),Pe.jsx(Ur,{span:8,children:Pe.jsx(Qr,{children:Pe.jsx(Rc,{placeholder:"Tìm kiếm khách hàng",prefix:Pe.jsx(Pm,{})})})})]})}),Pe.jsxs(Ur,{children:[" ",Pe.jsxs(ah.Group,{defaultValue:y,onChange:V=>x(V.target.value),size:"middle",children:[Pe.jsx(ah.Button,{value:"list",children:Pe.jsx(Bw,{size:28})}),Pe.jsx(ah.Button,{value:"map",children:Pe.jsx(Ow,{size:28})})]})]})]}),Pe.jsx("div",{children:y=="list"?Pe.jsx(Fw,{data:s,handleData:h}):Pe.jsx(_2,{data:s})}),Pe.jsx(Rh,{width:1240,open:w,onCancel:O.bind(null,"Choose"),title:Pe.jsx("strong",{className:"text-xl",children:"Chọn khách hàng"}),footer:!1,children:Pe.jsx(C2,{selected:s,handleAdd:h,closeModal:E.bind(null,!1)})}),Pe.jsx(Rh,{width:777,open:z,onCancel:O.bind(null,"Import"),okText:"Tiếp tục",cancelText:"Hủy",title:Pe.jsx("strong",{className:"text-xl",children:"Nhập dữ liệu khách hàng"}),children:Pe.jsx(b2,{})})]})}function E2(){const[s]=Lh.useForm(),h=gv(),[y,x]=yg.useNotification(),[w,E]=k.useState([]),z=(O,L)=>{y.info({message:`Notification ${O}`,description:Pe.jsx("p",{children:L}),placement:O})},o=k.useCallback(async O=>{O={...O,customers:w.map(L=>{let V=["customer_id","customer_name","display_address","phone_number","customer","frequency"];for(let q in L)V.includes(q)||delete L[q];return L})};try{await Ln.post("/api/method/mbw_dms.api.router.create_router",O),z("topRight","Success"),h("/")}catch(L){z("topRight","Failure!!!"),console.log("error create",L)}},[w]);return Pe.jsxs(Pe.Fragment,{children:[Pe.jsx(xv,{title:"Thêm tuyến",buttons:[{label:"Thêm",action:s.submit,type:"primary"}]}),Pe.jsx("div",{className:"bg-white rounded-md",children:Pe.jsx(Lh,{layout:"vertical",form:s,onFinish:o,children:Pe.jsx(Ox,{defaultActiveKey:"1",items:[{label:Pe.jsx("p",{className:"px-4 mb-0",children:" Thông tin chung"}),key:"1",children:Pe.jsx(Rw,{})},{label:Pe.jsx("p",{className:"px-4 mb-0",children:"Khách hàng"}),key:"2",children:Pe.jsx(T2,{handleCustomer:E,listCustomer:w})}],indicatorSize:O=>O-18})})})]})}function A2(){return Pe.jsxs(Pe.Fragment,{children:[Pe.jsx(yv,{children:Pe.jsx("title",{children:" RouterControll"})}),Pe.jsx(E2,{})]})}export{A2 as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/mapbox-gl-KgDI0fj8.js","assets/index-PSZGKfBk.js","assets/index-9pDW2TCJ.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
