import{L as s,aT as De,a5 as c,P as e,a6 as Te,U as i,V as o,Q as J,R as l,a8 as p,a7 as Ie,W as x,a9 as Ye,bw as Ee,Y as ee,ab as Re}from"./index-xfP4zlae.js";import{D as Me}from"./index-WyAqGM3y.js";import{C as qe}from"./index-ASYRnM8O.js";import{a as Ue,b as ze}from"./index.esm-VnqPFoxf.js";import{u}from"./useDebount-YTsJ1zWI.js";import{t as Be,a as Oe}from"./index-tjI3NPcN.js";import{u as He}from"./index-3vcQx6W4.js";import{V as Ke}from"./VerticalAlignBottomOutlined-3wDcf7wH.js";import{T as Le}from"./index-Lt6ThRUv.js";import{D as h}from"./index-SE5SKN1k.js";import{I as f}from"./index-HMCl41u7.js";const Pe=[{title:e.jsx("div",{className:"relative",children:e.jsx("span",{className:"absolute -top-[11px] -left-8",children:"STT"})}),dataIndex:"stt",key:"stt",render:(b,S,m)=>m+1},{title:"Mã khách hàng",dataIndex:"customer_code",key:"customer_code"},{title:"Tên khách hàng",dataIndex:"customer_name",key:"customer_name"},{title:"Loại khách hàng",dataIndex:"customer_type",key:"customer_type",width:175},{title:"Địa chỉ",dataIndex:"customer_address",key:"customer_address"}];function Ae(){const[b,S]=s.useState([]),[m]=De(),[F,v]=s.useState(),[k,w]=s.useState(),[C,D]=s.useState(),[T,I]=s.useState(),[Y,E]=s.useState(),[R,M]=s.useState(),[q,U]=s.useState(),[z,B]=s.useState(),[te,se]=s.useState([]),[O,H]=s.useState(""),d=t=>{console.log(t)},j=20,[_,ae]=s.useState(1),[g,ne]=s.useState(0),[re,le]=s.useState(""),[K,L]=s.useState(""),[oe,ie]=s.useState([]),[ce,me]=s.useState("");let P=u(re,500),A=u(ce,500);const[de,pe]=s.useState([]),[xe,ue]=s.useState([]),[V,he]=s.useState(),[fe,je]=s.useState(""),[$,G]=s.useState();let W=u(fe);const[X,Q]=s.useState(""),[_e,ge]=s.useState([]),[ye,Ne]=s.useState("");let Z=u(ye,500);const y=s.useRef(null),N=He(),[be,Se]=s.useState(0),[Fe,ve]=s.useState(N?.h*.52);s.useEffect(()=>{ve(N.h*.52)},[N]),s.useEffect(()=>{const t=y.current;if(t){const n=new ResizeObserver(a=>{for(let r of a)Se(r.contentRect.height)});return n.observe(t),()=>n.disconnect()}},[y]);const ke=t=>{const n=[{title:e.jsx("div",{className:"text-center",children:"STT"}),dataIndex:"stt",key:"stt",render:(a,r,Ce)=>e.jsx("div",{className:"text-center",children:Ce+1})},{title:"Mã sản phẩm",dataIndex:"item_code",key:"item_code"},{title:"Tên sản phẩm",dataIndex:"item_name",key:"item_name"},{title:"Hạn sử dụng",dataIndex:"exp_time",key:"exp_time",render:(a,r)=>a?e.jsx("p",{children:ee(a*1e3).format("DD/MM/YYYY")}):e.jsx(e.Fragment,{})},{title:"Đơn vị tính",dataIndex:"item_unit",key:"item_unit"},{title:e.jsx("div",{className:"text-right",children:"Tồn"}),dataIndex:"quantity",key:"quantity",render:(a,r)=>e.jsx("div",{className:"!text-right",children:r.quantity})},{title:e.jsx("div",{className:"text-right",children:"Giá sản phẩm"}),dataIndex:"item_price",key:"item_price",render:(a,r)=>e.jsx("p",{className:"text-right",children:Intl.NumberFormat().format(r.item_price)})},{title:e.jsx("div",{className:"text-right",children:"Tổng giá trị"}),dataIndex:"total",key:"total",render:(a,r)=>e.jsx("p",{className:"text-right",children:Intl.NumberFormat().format(r.quantity*r.item_price)})},{title:"Ngày cập nhật",dataIndex:"update_at",key:"update_at",render:(a,r)=>a?e.jsx("p",{children:ee(a*1e3).format("DD/MM/YYYY")}):e.jsx(e.Fragment,{})},{title:"Người kiểm tồn",dataIndex:"update_byname",key:"update_byname",render:(a,r)=>e.jsxs(e.Fragment,{children:[e.jsx("div",{children:r.update_byname}),e.jsx("div",{className:"font-normal text-sm leading-[21px] text-[#637381]",children:r.update_bycode})]})}];return e.jsx(Ee,{bordered:!0,columns:n,dataSource:t.items.map(a=>({...a,key:a.item_code})),pagination:!1})},we=t=>{if(t.expire_from){let n=Date.parse(t.expire_from.$d)/1e3;v(n)}else v(void 0);if(t.expire_to){let n=Date.parse(t.expire_to.$d)/1e3;w(n)}else w(void 0);if(t.qty_inven_from?E(t.qty_inven_from):E(void 0),t.qty_inven_to?M(t.qty_inven_to):M(void 0),t.total_from?U(t.total_from):U(void 0),t.total_to?B(t.total_to):B(void 0),t.update_at_from){let n=Date.parse(t.update_at_from.$d)/1e3;D(n)}else D(void 0);if(t.update_at_to){let n=Date.parse(t.update_at_to.$d)/1e3;I(n)}else I(void 0)};return s.useEffect(()=>{(async()=>{let t=await c.get("/api/method/mbw_dms.api.router.get_team_sale");ue(Be({data:t.result.map(n=>({title:n.name,value:n.name,...n})),keyValue:"value",parentField:"parent_sales_person"}))})()},[]),s.useEffect(()=>{(async()=>{let t=await c.get("/api/method/mbw_dms.api.router.get_sale_person",{params:{team_sale:V,key_search:W}}),{message:n}=t;pe(n.map(a=>({value:a.employee_code,label:a.employee_name||a.employee_code})))})()},[V,W]),s.useEffect(()=>{(async()=>{let t=await c.get("/api/method/frappe.desk.search.search_link",{params:{txt:Z,doctype:"Customer",ignore_user_permissions:0,query:""}}),{message:n}=t;ge(n.map(a=>({value:a.value,label:a.value})))})()},[Z]),s.useEffect(()=>{(async()=>{let t=await c.get("/api/method/frappe.desk.search.search_link",{params:{txt:P,doctype:"Item",ignore_user_permissions:0,query:""}}),{message:n}=t;se(n.map(a=>({value:a.value,label:a.description.split(",")[0].trim(),des:a.value})))})()},[P]),s.useEffect(()=>{(async()=>{let t=await c.get("/api/method/frappe.desk.search.search_link",{params:{txt:A,doctype:"UOM",ignore_user_permissions:0,query:""}}),{message:n}=t;ie(n.map(a=>({value:a.value,label:a.value})))})()},[A]),s.useEffect(()=>{(async()=>{const t=await c.get("/api/method/mbw_dms.api.report.inventory.get_customer_inventory",{params:{expire_from:F,expire_to:k,update_at_from:C,update_at_to:T,qty_inven_from:Y,qty_inven_to:R,total_from:q,total_to:z,item_code:O,page_size:j,page_number:_,unit_product:K,employee:$,customer:X}});S(t.result),ne(t?.result?.total)})()},[F,k,Y,R,q,z,O,C,T,_,K,$,X]),e.jsx(e.Fragment,{children:e.jsx(qe,{header:e.jsx(Te,{title:"Báo cáo tồn kho khách hàng",buttons:[{label:"Xuất dữ liệu",type:"primary",icon:e.jsx(Ke,{className:"text-xl"}),size:"20px",className:"flex items-center",action:()=>{Oe("/app/data-export/Data%20Export")}}]}),children:e.jsxs("div",{className:"bg-white rounded-2xl pt-4 pb-7 border-[#DFE3E8] border-[0.2px] border-solid",children:[e.jsxs(i,{gutter:[16,16],className:"justify-between items-end w-full",children:[e.jsx(o,{children:e.jsx(i,{gutter:[8,8],children:e.jsx(o,{className:"mx-4 w-full",span:24,children:e.jsxs(J,{layout:"vertical",className:"flex flex-wrap justify-start items-center ",children:[e.jsx(l,{label:"Sản phẩm",className:"w-[200px] border-none mr-2",children:e.jsx(p,{optionFilterProp:"children",filterOption:!1,onSearch:t=>le(t),onSelect:t=>{H(t)},placeholder:e.jsx(e.Fragment,{children:"Tất cả sản phẩm"}),notFoundContent:null,options:te,allowClear:!0,onClear:()=>H(""),optionRender:t=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{role:"img","aria-label":t.data.label,className:"my-1",children:t.data.label}),e.jsx("span",{className:"text-xs !font-semibold",children:t.data.des})]})})})}),e.jsx(l,{label:"Đơn vị tính",className:"w-[200px] border-none mr-2",children:e.jsx(p,{placeholder:"Tất cả đơn vị tính",options:oe,onSelect:t=>{L(t)},onSearch:t=>{me(t)},onClear:()=>L(""),filterOption:!1,allowClear:!0})}),e.jsx(l,{label:"Nhóm bán hàng",className:"w-[200px] border-none mr-2",children:e.jsx(Le,{placeholder:"Tất cả nhóm bán hàng",allowClear:!0,treeData:xe,onChange:t=>{he(t)},dropdownStyle:{maxHeight:400,overflow:"auto",minWidth:350}})}),e.jsx(l,{label:"Người kiểm tồn",name:"employee",className:"w-[200px] border-none mr-2",children:e.jsx(p,{filterOption:!1,notFoundContent:null,allowClear:!0,placeholder:"Tất cả người kiểm tồn",onSearch:t=>{je(t)},options:de,onSelect:t=>{G(t)},onClear:()=>{G("")}})}),e.jsx(l,{label:"Khách hàng",className:"w-[200px] border-none mr-2",children:e.jsx(p,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:_e,onSelect:t=>{Q(t)},onSearch:t=>{Ne(t)},onClear:()=>Q(""),filterOption:!1,allowClear:!0,placeholder:"Tất cả khách hàng"})})]})})})}),e.jsx(o,{className:"!ml-4",children:e.jsx("div",{className:"flex flex-wrap items-center",children:e.jsxs("div",{className:"flex justify-center items-center mr-4",children:[e.jsx(Ie,{className:"!h-9",trigger:["click"],placement:"bottomRight",dropdownRender:()=>e.jsx(Me,{title:"Bộ lọc",children:e.jsx("div",{className:"pt-6",children:e.jsxs(J,{form:m,onFinish:we,children:[e.jsx("div",{className:"font-semibold text-sm leading-5 text-[#212B36]",children:"Hạn sử dụng"}),e.jsxs(i,{className:"pt-1",gutter:16,children:[e.jsxs(o,{span:12,children:[e.jsx("span",{className:"font-normal text-sm leading-5 text-[#637381]",children:"Ngày bắt đầu"}),e.jsx(l,{className:"pt-2",name:"expire_from",children:e.jsx(h,{format:"DD-MM-YYYY",className:"!bg-[#F4F6F8]",onChange:d})})]}),e.jsxs(o,{span:12,children:[e.jsx("span",{className:"font-normal text-sm leading-5 text-[#637381]",children:"Kết thúc"}),e.jsx(l,{className:"pt-2",name:"expire_to",children:e.jsx(h,{format:"DD-MM-YYYY",className:"!bg-[#F4F6F8]",onChange:d})})]})]}),e.jsx("div",{className:"pt-5 font-semibold text-sm leading-5 text-[#212B36]",children:"Ngày cập nhật"}),e.jsxs(i,{className:"pt-1",gutter:16,children:[e.jsxs(o,{span:12,children:[e.jsx("span",{className:"font-normal text-sm leading-5 text-[#637381]",children:"Ngày bắt đầu"}),e.jsx(l,{name:"update_at_from",className:"pt-2",children:e.jsx(h,{format:"DD-MM-YYYY",className:"!bg-[#F4F6F8]",onChange:d})})]}),e.jsxs(o,{span:12,children:[e.jsx("span",{className:"font-normal text-sm leading-5 text-[#637381]",children:"Kết thúc"}),e.jsx(l,{name:"update_at_to",className:"pt-2",children:e.jsx(h,{format:"DD-MM-YYYY",className:"!bg-[#F4F6F8]",onChange:d})})]})]}),e.jsx("div",{className:"pt-5 font-semibold text-sm leading-5 text-[#212B36]",children:"Số lượng tồn kho"}),e.jsxs(i,{className:"pt-1",gutter:16,children:[e.jsxs(o,{span:12,children:[e.jsx("span",{className:"font-normal text-sm leading-5 text-[#637381]",children:"Từ"}),e.jsx(l,{className:"pt-2",name:"qty_inven_from",children:e.jsx(f,{controls:!1,className:"w-full",placeholder:"0"})})]}),e.jsxs(o,{span:12,children:[e.jsx("span",{className:"font-normal text-sm leading-5 text-[#637381]",children:"Đến"}),e.jsx(l,{className:"pt-2",name:"qty_inven_to",children:e.jsx(f,{controls:!1,className:"w-full",placeholder:"0"})})]})]}),e.jsx("div",{className:"pt-5 font-semibold text-sm leading-5 text-[#212B36]",children:"Tổng giá trị"}),e.jsxs(i,{className:"pt-1",gutter:16,children:[e.jsxs(o,{span:12,children:[e.jsx("span",{className:"font-normal text-sm leading-5 text-[#637381]",children:"Từ"}),e.jsx(l,{className:"pt-2",name:"total_from",children:e.jsx(f,{controls:!1,className:"!bg-[#F5F7FA] w-full",placeholder:"0",suffix:"VND"})})]}),e.jsxs(o,{span:12,children:[e.jsx("span",{className:"font-normal text-sm leading-5 text-[#637381]",children:"Đến"}),e.jsx(l,{className:"pt-2",name:"total_to",children:e.jsx(f,{controls:!1,className:"!bg-[#F5F7FA] w-full",placeholder:"0",suffix:"VND"})})]})]}),e.jsxs(i,{className:"justify-between pt-6 pb-4",children:[e.jsx("div",{}),e.jsxs("div",{children:[e.jsx(x,{className:"mr-3",onClick:t=>{t.preventDefault(),m.resetFields()},children:"Đặt lại"}),e.jsx(x,{type:"primary",onClick:()=>{m.submit()},children:"Áp dụng"})]})]})]})})}),children:e.jsx(x,{onClick:t=>t.preventDefault(),className:"flex items-center text-nowrap !text-[13px] !leading-[21px] !font-normal  border-r-[0.1px] rounded-r-none h-9",icon:e.jsx(Ue,{style:{fontSize:"20px"}}),children:"Bộ lọc"})}),e.jsx(x,{className:"border-l-[0.1px] rounded-l-none !h-9",children:e.jsx(ze,{style:{fontSize:"20px"}})})]})})})]}),e.jsx("div",{ref:y,className:"pt-5",children:e.jsx(Ye,{columns:Pe,scroll:{x:!0,y:be<300?void 0:Fe},bordered:!0,$border:!0,expandable:{expandedRowRender:ke,defaultExpandedRowKeys:["0"]},dataSource:b?.data?.map(t=>({...t,key:t.name})),pagination:g&&g>j?{pageSize:j,showSizeChanger:!1,total:g,current:_,onChange(t){ae(t)}}:!1,rowHoverable:!1})}),e.jsx("div",{className:""})]})})})}function at(){return e.jsxs(e.Fragment,{children:[e.jsx(Re,{children:e.jsx("title",{children:" ReportCustomer"})}),e.jsx(Ae,{})]})}export{at as default};
