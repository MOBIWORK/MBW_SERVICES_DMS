import{r as H,_ as Kn,a as Kr,c as di,b as Vi,K as ym,d as ys,e as Vs,f as Kd,g as uc,h as xs,i as Xr,k as qo,l as Du,m as Lu,n as Zo,o as Ru,p as xm,q as Da,s as Yd,t as Jd,v as Qd,E as vm,w as Mu,x as Fu,y as bm,z as wm,A as Sm,D as ep,G as Cm,I as ku,J as tp,M as dr,N as Tm,O as Im,P as La,Q as Em,U as ip,V as rp,W as np,X as Wr,Y as sp,Z as Mm,$ as km,a0 as bd,a1 as ap,a2 as op,a3 as wd,a4 as Am,a5 as Pm,a6 as lp,a7 as zm,a8 as Dm,a9 as Sd,aa as Cd,B as Pa,ab as Lm,ac as Rm,ad as Fm,ae as Bm,j as ge,R as qs,C as Lr,F as Ur,af as sc,S as xn,T as Bu,ag as Om,ah as Nm,ai as $m,aj as Au,ak as jm,al as cp,am as Vm,an as Um,ao as vu,u as qm,ap as Zm,H as Gm}from"./index-AhEPQf_3.js";import{A as Dn}from"./server-cSPNWILy.js";import{I as Hm,i as Wm,M as Pu,T as Xm}from"./index-JymFgwqT.js";import{a as Km,b as Ym}from"./index.esm-Qdhw8Z2y.js";import{H as Jm}from"./header-page-7cihv_Da.js";var up=H.forwardRef(function(y,b){var E=y.prefixCls,M=y.style,D=y.className,F=y.duration,U=F===void 0?4.5:F,o=y.eventKey,ie=y.content,B=y.closable,ce=y.closeIcon,_e=ce===void 0?"x":ce,de=y.props,be=y.onClick,Me=y.onNoticeClose,Be=y.times,De=y.hovering,Ne=H.useState(!1),Qe=Kn(Ne,2),qe=Qe[0],Oe=Qe[1],Te=De||qe,at=function(){Me(o)},tt=function(Fe){(Fe.key==="Enter"||Fe.code==="Enter"||Fe.keyCode===ym.ENTER)&&at()};H.useEffect(function(){if(!Te&&U>0){var ot=setTimeout(function(){at()},U*1e3);return function(){clearTimeout(ot)}}},[U,Te,Be]);var He="".concat(E,"-notice");return H.createElement("div",Kr({},de,{ref:b,className:di(He,D,Vi({},"".concat(He,"-closable"),B)),style:M,onMouseEnter:function(Fe){var ht;Oe(!0),de==null||(ht=de.onMouseEnter)===null||ht===void 0||ht.call(de,Fe)},onMouseLeave:function(Fe){var ht;Oe(!1),de==null||(ht=de.onMouseLeave)===null||ht===void 0||ht.call(de,Fe)},onClick:be}),H.createElement("div",{className:"".concat(He,"-content")},ie),B&&H.createElement("a",{tabIndex:0,className:"".concat(He,"-close"),onKeyDown:tt,onClick:function(Fe){Fe.preventDefault(),Fe.stopPropagation(),at()}},_e))}),hp=ys.createContext({}),Qm=function(b){var E=b.children,M=b.classNames;return ys.createElement(hp.Provider,{value:{classNames:M}},E)},Td=8,Id=3,Ed=16,eg=function(b){var E={offset:Td,threshold:Id,gap:Ed};if(b&&Vs(b)==="object"){var M,D,F;E.offset=(M=b.offset)!==null&&M!==void 0?M:Td,E.threshold=(D=b.threshold)!==null&&D!==void 0?D:Id,E.gap=(F=b.gap)!==null&&F!==void 0?F:Ed}return[!!b,E]},tg=["className","style","classNames","styles"],ig=function(b){var E,M=b.configList,D=b.placement,F=b.prefixCls,U=b.className,o=b.style,ie=b.motion,B=b.onAllNoticeRemoved,ce=b.onNoticeClose,_e=b.stack,de=H.useContext(hp),be=de.classNames,Me=H.useRef({}),Be=H.useState(null),De=Kn(Be,2),Ne=De[0],Qe=De[1],qe=H.useState([]),Oe=Kn(qe,2),Te=Oe[0],at=Oe[1],tt=M.map(function(ft){return{config:ft,key:String(ft.key)}}),He=eg(_e),ot=Kn(He,2),Fe=ot[0],ht=ot[1],zt=ht.offset,Lt=ht.threshold,xt=ht.gap,Et=Fe&&(Te.length>0||tt.length<=Lt),Bt=typeof ie=="function"?ie(D):ie;return H.useEffect(function(){Fe&&Te.length>1&&at(function(ft){return ft.filter(function(ni){return tt.some(function(Ai){var Xi=Ai.key;return ni===Xi})})})},[Te,tt,Fe]),H.useEffect(function(){var ft;if(Fe&&Me.current[(ft=tt[tt.length-1])===null||ft===void 0?void 0:ft.key]){var ni;Qe(Me.current[(ni=tt[tt.length-1])===null||ni===void 0?void 0:ni.key])}},[tt,Fe]),ys.createElement(Kd,Kr({key:D,className:di(F,"".concat(F,"-").concat(D),be?.list,U,(E={},Vi(E,"".concat(F,"-stack"),!!Fe),Vi(E,"".concat(F,"-stack-expanded"),Et),E)),style:o,keys:tt,motionAppear:!0},Bt,{onAllRemoved:function(){B(D)}}),function(ft,ni){var Ai=ft.config,Xi=ft.className,si=ft.style,Xt=ft.index,Ue=Ai,_t=Ue.key,Kt=Ue.times,Mt=String(_t),Yt=Ai,gi=Yt.className,Jt=Yt.style,Rt=Yt.classNames,Pi=Yt.styles,bi=uc(Yt,tg),Wt=tt.findIndex(function(Ui){return Ui.key===Mt}),Ti={};if(Fe){var rr=tt.length-1-(Wt>-1?Wt:Xt-1),pr=D==="top"||D==="bottom"?"-50%":"0";if(rr>0){var nr,fr,Sr;Ti.height=Et?(nr=Me.current[Mt])===null||nr===void 0?void 0:nr.offsetHeight:Ne?.offsetHeight;for(var fe=0,Ii=0;Ii<rr;Ii++){var $i;fe+=(($i=Me.current[tt[tt.length-1-Ii].key])===null||$i===void 0?void 0:$i.offsetHeight)+xt}var jt=(Et?fe:rr*zt)*(D.startsWith("top")?1:-1),kt=!Et&&Ne!==null&&Ne!==void 0&&Ne.offsetWidth&&(fr=Me.current[Mt])!==null&&fr!==void 0&&fr.offsetWidth?(Ne?.offsetWidth-zt*2*(rr<3?rr:3))/((Sr=Me.current[Mt])===null||Sr===void 0?void 0:Sr.offsetWidth):1;Ti.transform="translate3d(".concat(pr,", ").concat(jt,"px, 0) scaleX(").concat(kt,")")}else Ti.transform="translate3d(".concat(pr,", 0, 0)")}return ys.createElement("div",{ref:ni,className:di("".concat(F,"-notice-wrapper"),Xi,Rt?.wrapper),style:xs(xs(xs({},si),Ti),Pi?.wrapper),onMouseEnter:function(){return at(function(Ki){return Ki.includes(Mt)?Ki:[].concat(Xr(Ki),[Mt])})},onMouseLeave:function(){return at(function(Ki){return Ki.filter(function(sr){return sr!==Mt})})}},ys.createElement(up,Kr({},bi,{ref:function(Ki){Wt>-1?Me.current[Mt]=Ki:delete Me.current[Mt]},prefixCls:F,classNames:Rt,styles:Pi,className:di(gi,be?.notice),style:Jt,times:Kt,key:_t,eventKey:_t,onNoticeClose:ce,hovering:Fe&&Te.length>0})))})},rg=H.forwardRef(function(y,b){var E=y.prefixCls,M=E===void 0?"rc-notification":E,D=y.container,F=y.motion,U=y.maxCount,o=y.className,ie=y.style,B=y.onAllRemoved,ce=y.stack,_e=y.renderNotifications,de=H.useState([]),be=Kn(de,2),Me=be[0],Be=be[1],De=function(ot){var Fe,ht=Me.find(function(zt){return zt.key===ot});ht==null||(Fe=ht.onClose)===null||Fe===void 0||Fe.call(ht),Be(function(zt){return zt.filter(function(Lt){return Lt.key!==ot})})};H.useImperativeHandle(b,function(){return{open:function(ot){Be(function(Fe){var ht=Xr(Fe),zt=ht.findIndex(function(Et){return Et.key===ot.key}),Lt=xs({},ot);if(zt>=0){var xt;Lt.times=(((xt=Fe[zt])===null||xt===void 0?void 0:xt.times)||0)+1,ht[zt]=Lt}else Lt.times=0,ht.push(Lt);return U>0&&ht.length>U&&(ht=ht.slice(-U)),ht})},close:function(ot){De(ot)},destroy:function(){Be([])}}});var Ne=H.useState({}),Qe=Kn(Ne,2),qe=Qe[0],Oe=Qe[1];H.useEffect(function(){var He={};Me.forEach(function(ot){var Fe=ot.placement,ht=Fe===void 0?"topRight":Fe;ht&&(He[ht]=He[ht]||[],He[ht].push(ot))}),Object.keys(qe).forEach(function(ot){He[ot]=He[ot]||[]}),Oe(He)},[Me]);var Te=function(ot){Oe(function(Fe){var ht=xs({},Fe),zt=ht[ot]||[];return zt.length||delete ht[ot],ht})},at=H.useRef(!1);if(H.useEffect(function(){Object.keys(qe).length>0?at.current=!0:at.current&&(B?.(),at.current=!1)},[qe]),!D)return null;var tt=Object.keys(qe);return qo.createPortal(H.createElement(H.Fragment,null,tt.map(function(He){var ot=qe[He],Fe=H.createElement(ig,{key:He,configList:ot,placement:He,prefixCls:M,className:o?.(He),style:ie?.(He),motion:F,onNoticeClose:De,onAllNoticeRemoved:Te,stack:ce});return _e?_e(Fe,{prefixCls:M,key:He}):Fe})),D)}),ng=["getContainer","motion","prefixCls","maxCount","className","style","onAllRemoved","stack","renderNotifications"],sg=function(){return document.body},Md=0;function ag(){for(var y={},b=arguments.length,E=new Array(b),M=0;M<b;M++)E[M]=arguments[M];return E.forEach(function(D){D&&Object.keys(D).forEach(function(F){var U=D[F];U!==void 0&&(y[F]=U)})}),y}function og(){var y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},b=y.getContainer,E=b===void 0?sg:b,M=y.motion,D=y.prefixCls,F=y.maxCount,U=y.className,o=y.style,ie=y.onAllRemoved,B=y.stack,ce=y.renderNotifications,_e=uc(y,ng),de=H.useState(),be=Kn(de,2),Me=be[0],Be=be[1],De=H.useRef(),Ne=H.createElement(rg,{container:Me,ref:De,prefixCls:D,motion:M,maxCount:F,className:U,style:o,onAllRemoved:ie,stack:B,renderNotifications:ce}),Qe=H.useState([]),qe=Kn(Qe,2),Oe=qe[0],Te=qe[1],at=H.useMemo(function(){return{open:function(He){var ot=ag(_e,He);(ot.key===null||ot.key===void 0)&&(ot.key="rc-notification-".concat(Md),Md+=1),Te(function(Fe){return[].concat(Xr(Fe),[{type:"open",config:ot}])})},close:function(He){Te(function(ot){return[].concat(Xr(ot),[{type:"close",key:He}])})},destroy:function(){Te(function(He){return[].concat(Xr(He),[{type:"destroy"}])})}}},[]);return H.useEffect(function(){Be(E())}),H.useEffect(function(){De.current&&Oe.length&&(Oe.forEach(function(tt){switch(tt.type){case"open":De.current.open(tt.config);break;case"close":De.current.close(tt.key);break;case"destroy":De.current.destroy();break}}),Te(function(tt){return tt.filter(function(He){return!Oe.includes(He)})}))},[Oe]),[at,Ne]}const lg=y=>{const{componentCls:b,iconCls:E,boxShadow:M,colorText:D,colorSuccess:F,colorError:U,colorWarning:o,colorInfo:ie,fontSizeLG:B,motionEaseInOutCirc:ce,motionDurationSlow:_e,marginXS:de,paddingXS:be,borderRadiusLG:Me,zIndexPopup:Be,contentPadding:De,contentBg:Ne}=y,Qe=`${b}-notice`,qe=new Zo("MessageMoveIn",{"0%":{padding:0,transform:"translateY(-100%)",opacity:0},"100%":{padding:be,transform:"translateY(0)",opacity:1}}),Oe=new Zo("MessageMoveOut",{"0%":{maxHeight:y.height,padding:be,opacity:1},"100%":{maxHeight:0,padding:0,opacity:0}}),Te={padding:be,textAlign:"center",[`${b}-custom-content > ${E}`]:{verticalAlign:"text-bottom",marginInlineEnd:de,fontSize:B},[`${Qe}-content`]:{display:"inline-block",padding:De,background:Ne,borderRadius:Me,boxShadow:M,pointerEvents:"all"},[`${b}-success > ${E}`]:{color:F},[`${b}-error > ${E}`]:{color:U},[`${b}-warning > ${E}`]:{color:o},[`${b}-info > ${E},
      ${b}-loading > ${E}`]:{color:ie}};return[{[b]:Object.assign(Object.assign({},Ru(y)),{color:D,position:"fixed",top:de,width:"100%",pointerEvents:"none",zIndex:Be,[`${b}-move-up`]:{animationFillMode:"forwards"},[`
        ${b}-move-up-appear,
        ${b}-move-up-enter
      `]:{animationName:qe,animationDuration:_e,animationPlayState:"paused",animationTimingFunction:ce},[`
        ${b}-move-up-appear${b}-move-up-appear-active,
        ${b}-move-up-enter${b}-move-up-enter-active
      `]:{animationPlayState:"running"},[`${b}-move-up-leave`]:{animationName:Oe,animationDuration:_e,animationPlayState:"paused",animationTimingFunction:ce},[`${b}-move-up-leave${b}-move-up-leave-active`]:{animationPlayState:"running"},"&-rtl":{direction:"rtl",span:{direction:"rtl"}}})},{[b]:{[`${Qe}-wrapper`]:Object.assign({},Te)}},{[`${b}-notice-pure-panel`]:Object.assign(Object.assign({},Te),{padding:0,textAlign:"start"})}]},cg=y=>({zIndexPopup:y.zIndexPopupBase+xm+10,contentBg:y.colorBgElevated,contentPadding:`${(y.controlHeightLG-y.fontSize*y.lineHeight)/2}px ${y.paddingSM}px`}),dp=Du("Message",y=>{const b=Lu(y,{height:150});return[lg(b)]},cg);var ug=function(y,b){var E={};for(var M in y)Object.prototype.hasOwnProperty.call(y,M)&&b.indexOf(M)<0&&(E[M]=y[M]);if(y!=null&&typeof Object.getOwnPropertySymbols=="function")for(var D=0,M=Object.getOwnPropertySymbols(y);D<M.length;D++)b.indexOf(M[D])<0&&Object.prototype.propertyIsEnumerable.call(y,M[D])&&(E[M[D]]=y[M[D]]);return E};const hg={info:H.createElement(Hm,null),success:H.createElement(Jd,null),error:H.createElement(Qd,null),warning:H.createElement(vm,null),loading:H.createElement(Mu,null)},pp=y=>{let{prefixCls:b,type:E,icon:M,children:D}=y;return H.createElement("div",{className:di(`${b}-custom-content`,`${b}-${E}`)},M||hg[E],H.createElement("span",null,D))},dg=y=>{const{prefixCls:b,className:E,type:M,icon:D,content:F}=y,U=ug(y,["prefixCls","className","type","icon","content"]),{getPrefixCls:o}=H.useContext(Da),ie=b||o("message"),B=Yd(ie),[ce,_e,de]=dp(ie,B);return ce(H.createElement(up,Object.assign({},U,{prefixCls:ie,className:di(E,_e,`${ie}-notice-pure-panel`,de,B),eventKey:"pure",duration:null,content:H.createElement(pp,{prefixCls:ie,type:M,icon:D},F)})))},pg=dg;function fg(y,b){return{motionName:b??`${y}-move-up`}}function Ou(y){let b;const E=new Promise(D=>{b=y(()=>{D(!0)})}),M=()=>{b?.()};return M.then=(D,F)=>E.then(D,F),M.promise=E,M}var mg=function(y,b){var E={};for(var M in y)Object.prototype.hasOwnProperty.call(y,M)&&b.indexOf(M)<0&&(E[M]=y[M]);if(y!=null&&typeof Object.getOwnPropertySymbols=="function")for(var D=0,M=Object.getOwnPropertySymbols(y);D<M.length;D++)b.indexOf(M[D])<0&&Object.prototype.propertyIsEnumerable.call(y,M[D])&&(E[M[D]]=y[M[D]]);return E};const gg=8,_g=3,yg=y=>{let{children:b,prefixCls:E}=y;const M=Yd(E),[D,F,U]=dp(E,M);return D(H.createElement(Qm,{classNames:{list:di(F,U,M)}},b))},xg=(y,b)=>{let{prefixCls:E,key:M}=b;return H.createElement(yg,{prefixCls:E,key:M},y)},vg=H.forwardRef((y,b)=>{const{top:E,prefixCls:M,getContainer:D,maxCount:F,duration:U=_g,rtl:o,transitionName:ie,onAllRemoved:B}=y,{getPrefixCls:ce,getPopupContainer:_e,message:de}=H.useContext(Da),be=M||ce("message"),Me=()=>({left:"50%",transform:"translateX(-50%)",top:E??gg}),Be=()=>di({[`${be}-rtl`]:o}),De=()=>fg(be,ie),Ne=H.createElement("span",{className:`${be}-close-x`},H.createElement(Fu,{className:`${be}-close-icon`})),[Qe,qe]=og({prefixCls:be,style:Me,className:Be,motion:De,closable:!1,closeIcon:Ne,duration:U,getContainer:()=>D?.()||_e?.()||document.body,maxCount:F,onAllRemoved:B,renderNotifications:xg});return H.useImperativeHandle(b,()=>Object.assign(Object.assign({},Qe),{prefixCls:be,message:de})),qe});let kd=0;function fp(y){const b=H.useRef(null);return bm(),[H.useMemo(()=>{const M=ie=>{var B;(B=b.current)===null||B===void 0||B.close(ie)},D=ie=>{if(!b.current){const at=()=>{};return at.then=()=>{},at}const{open:B,prefixCls:ce,message:_e}=b.current,de=`${ce}-notice`,{content:be,icon:Me,type:Be,key:De,className:Ne,style:Qe,onClose:qe}=ie,Oe=mg(ie,["content","icon","type","key","className","style","onClose"]);let Te=De;return Te==null&&(kd+=1,Te=`antd-message-${kd}`),Ou(at=>(B(Object.assign(Object.assign({},Oe),{key:Te,content:H.createElement(pp,{prefixCls:ce,type:Be,icon:Me},be),placement:"top",className:di(Be&&`${de}-${Be}`,Ne,_e?.className),style:Object.assign(Object.assign({},_e?.style),Qe),onClose:()=>{qe?.(),at()}})),()=>{M(Te)}))},U={open:D,destroy:ie=>{var B;ie!==void 0?M(ie):(B=b.current)===null||B===void 0||B.destroy()}};return["info","success","warning","error","loading"].forEach(ie=>{const B=(ce,_e,de)=>{let be;ce&&typeof ce=="object"&&"content"in ce?be=ce:be={content:ce};let Me,Be;typeof _e=="function"?Be=_e:(Me=_e,Be=de);const De=Object.assign(Object.assign({onClose:Be,duration:Me},be),{type:ie});return D(De)};U[ie]=B}),U},[]),H.createElement(vg,Object.assign({key:"message-holder"},y,{ref:b}))]}function bg(y){return fp(y)}let on=null,Us=y=>y(),Go=[],ac={};function Ad(){const{prefixCls:y,getContainer:b,duration:E,rtl:M,maxCount:D,top:F}=ac,U=y??ep().getPrefixCls("message"),o=b?.()||document.body;return{prefixCls:U,getContainer:()=>o,duration:E,rtl:M,maxCount:D,top:F}}const wg=H.forwardRef((y,b)=>{const[E,M]=H.useState(Ad),[D,F]=fp(E),U=ep(),o=U.getRootPrefixCls(),ie=U.getIconPrefixCls(),B=U.getTheme(),ce=()=>{M(Ad)};return H.useEffect(ce,[]),H.useImperativeHandle(b,()=>{const _e=Object.assign({},D);return Object.keys(_e).forEach(de=>{_e[de]=function(){return ce(),D[de].apply(D,arguments)}}),{instance:_e,sync:ce}}),H.createElement(Sm,{prefixCls:o,iconPrefixCls:ie,theme:B},F)});function hc(){if(!on){const y=document.createDocumentFragment(),b={fragment:y};on=b,Us(()=>{wm(H.createElement(wg,{ref:E=>{const{instance:M,sync:D}=E||{};Promise.resolve().then(()=>{!b.instance&&M&&(b.instance=M,b.sync=D,hc())})}}),y)});return}on.instance&&(Go.forEach(y=>{const{type:b,skipped:E}=y;if(!E)switch(b){case"open":{Us(()=>{const M=on.instance.open(Object.assign(Object.assign({},ac),y.config));M?.then(y.resolve),y.setCloseFn(M)});break}case"destroy":Us(()=>{on?.instance.destroy(y.key)});break;default:Us(()=>{var M;const D=(M=on.instance)[b].apply(M,Xr(y.args));D?.then(y.resolve),y.setCloseFn(D)})}}),Go=[])}function Sg(y){ac=Object.assign(Object.assign({},ac),y),Us(()=>{var b;(b=on?.sync)===null||b===void 0||b.call(on)})}function Cg(y){const b=Ou(E=>{let M;const D={type:"open",config:y,resolve:E,setCloseFn:F=>{M=F}};return Go.push(D),()=>{M?Us(()=>{M()}):D.skipped=!0}});return hc(),b}function Tg(y,b){const E=Ou(M=>{let D;const F={type:y,args:b,resolve:M,setCloseFn:U=>{D=U}};return Go.push(F),()=>{D?Us(()=>{D()}):F.skipped=!0}});return hc(),E}function Ig(y){Go.push({type:"destroy",key:y}),hc()}const Eg=["success","info","warning","error","loading"],Mg={open:Cg,destroy:Ig,config:Sg,useMessage:bg,_InternalPanelDoNotUseOrYouWillBeFired:pg},oc=Mg;Eg.forEach(y=>{oc[y]=function(){for(var b=arguments.length,E=new Array(b),M=0;M<b;M++)E[M]=arguments[M];return Tg(y,E)}});var kg={percent:0,prefixCls:"rc-progress",strokeColor:"#2db7f5",strokeLinecap:"round",strokeWidth:1,trailColor:"#D9D9D9",trailWidth:1,gapPosition:"bottom"},Ag=function(){var b=H.useRef([]),E=H.useRef(null);return H.useEffect(function(){var M=Date.now(),D=!1;b.current.forEach(function(F){if(F){D=!0;var U=F.style;U.transitionDuration=".3s, .3s, .3s, .06s",E.current&&M-E.current<100&&(U.transitionDuration="0s, 0s")}}),D&&(E.current=Date.now())}),b.current},Pd=0,Pg=Cm();function zg(){var y;return Pg?(y=Pd,Pd+=1):y="TEST_OR_SSR",y}const Dg=function(y){var b=H.useState(),E=Kn(b,2),M=E[0],D=E[1];return H.useEffect(function(){D("rc_progress_".concat(zg()))},[]),y||M};var zd=function(b){var E=b.bg,M=b.children;return H.createElement("div",{style:{width:"100%",height:"100%",background:E}},M)};function Dd(y,b){return Object.keys(y).map(function(E){var M=parseFloat(E),D="".concat(Math.floor(M*b),"%");return"".concat(y[E]," ").concat(D)})}var Lg=H.forwardRef(function(y,b){var E=y.prefixCls,M=y.color,D=y.gradientId,F=y.radius,U=y.style,o=y.ptg,ie=y.strokeLinecap,B=y.strokeWidth,ce=y.size,_e=y.gapDegree,de=M&&Vs(M)==="object",be=de?"#FFF":void 0,Me=ce/2,Be=H.createElement("circle",{className:"".concat(E,"-circle-path"),r:F,cx:Me,cy:Me,stroke:be,strokeLinecap:ie,strokeWidth:B,opacity:o===0?0:1,style:U,ref:b});if(!de)return Be;var De="".concat(D,"-conic"),Ne=_e?"".concat(180+_e/2,"deg"):"0deg",Qe=Dd(M,(360-_e)/360),qe=Dd(M,1),Oe="conic-gradient(from ".concat(Ne,", ").concat(Qe.join(", "),")"),Te="linear-gradient(to ".concat(_e?"bottom":"top",", ").concat(qe.join(", "),")");return H.createElement(H.Fragment,null,H.createElement("mask",{id:De},Be),H.createElement("foreignObject",{x:0,y:0,width:ce,height:ce,mask:"url(#".concat(De,")")},H.createElement(zd,{bg:Te},H.createElement(zd,{bg:Oe}))))}),Vo=100,bu=function(b,E,M,D,F,U,o,ie,B,ce){var _e=arguments.length>10&&arguments[10]!==void 0?arguments[10]:0,de=M/100*360*((360-U)/360),be=U===0?0:{bottom:0,top:180,left:90,right:-90}[o],Me=(100-D)/100*E;B==="round"&&D!==100&&(Me+=ce/2,Me>=E&&(Me=E-.01));var Be=Vo/2;return{stroke:typeof ie=="string"?ie:void 0,strokeDasharray:"".concat(E,"px ").concat(b),strokeDashoffset:Me+_e,transform:"rotate(".concat(F+de+be,"deg)"),transformOrigin:"".concat(Be,"px ").concat(Be,"px"),transition:"stroke-dashoffset .3s ease 0s, stroke-dasharray .3s ease 0s, stroke .3s, stroke-width .06s ease .3s, opacity .3s ease 0s",fillOpacity:0}},Rg=["id","prefixCls","steps","strokeWidth","trailWidth","gapDegree","gapPosition","trailColor","strokeLinecap","style","className","strokeColor","percent"];function Ld(y){var b=y??[];return Array.isArray(b)?b:[b]}var Fg=function(b){var E=xs(xs({},kg),b),M=E.id,D=E.prefixCls,F=E.steps,U=E.strokeWidth,o=E.trailWidth,ie=E.gapDegree,B=ie===void 0?0:ie,ce=E.gapPosition,_e=E.trailColor,de=E.strokeLinecap,be=E.style,Me=E.className,Be=E.strokeColor,De=E.percent,Ne=uc(E,Rg),Qe=Vo/2,qe=Dg(M),Oe="".concat(qe,"-gradient"),Te=Qe-U/2,at=Math.PI*2*Te,tt=B>0?90+B/2:-90,He=at*((360-B)/360),ot=Vs(F)==="object"?F:{count:F,space:2},Fe=ot.count,ht=ot.space,zt=Ld(De),Lt=Ld(Be),xt=Lt.find(function(si){return si&&Vs(si)==="object"}),Et=xt&&Vs(xt)==="object",Bt=Et?"butt":de,ft=bu(at,He,0,100,tt,B,ce,_e,Bt,U),ni=Ag(),Ai=function(){var Xt=0;return zt.map(function(Ue,_t){var Kt=Lt[_t]||Lt[Lt.length-1],Mt=bu(at,He,Xt,Ue,tt,B,ce,Kt,Bt,U);return Xt+=Ue,H.createElement(Lg,{key:_t,color:Kt,ptg:Ue,radius:Te,prefixCls:D,gradientId:Oe,style:Mt,strokeLinecap:Bt,strokeWidth:U,gapDegree:B,ref:function(gi){ni[_t]=gi},size:Vo})}).reverse()},Xi=function(){var Xt=Math.round(Fe*(zt[0]/100)),Ue=100/Fe,_t=0;return new Array(Fe).fill(null).map(function(Kt,Mt){var Yt=Mt<=Xt-1?Lt[0]:_e,gi=Yt&&Vs(Yt)==="object"?"url(#".concat(Oe,")"):void 0,Jt=bu(at,He,_t,Ue,tt,B,ce,Yt,"butt",U,ht);return _t+=(He-Jt.strokeDashoffset+ht)*100/He,H.createElement("circle",{key:Mt,className:"".concat(D,"-circle-path"),r:Te,cx:Qe,cy:Qe,stroke:gi,strokeWidth:U,opacity:1,style:Jt,ref:function(Pi){ni[Mt]=Pi}})})};return H.createElement("svg",Kr({className:di("".concat(D,"-circle"),Me),viewBox:"0 0 ".concat(Vo," ").concat(Vo),style:be,id:M,role:"presentation"},Ne),!Fe&&H.createElement("circle",{className:"".concat(D,"-circle-trail"),r:Te,cx:Qe,cy:Qe,stroke:_e,strokeLinecap:Bt,strokeWidth:o||U,style:ft}),Fe?Xi():Ai())};function vs(y){return!y||y<0?0:y>100?100:y}function lc(y){let{success:b,successPercent:E}=y,M=E;return b&&"progress"in b&&(M=b.progress),b&&"percent"in b&&(M=b.percent),M}const Bg=y=>{let{percent:b,success:E,successPercent:M}=y;const D=vs(lc({success:E,successPercent:M}));return[D,vs(vs(b)-D)]},Og=y=>{let{success:b={},strokeColor:E}=y;const{strokeColor:M}=b;return[M||ku.green,E||null]},dc=(y,b,E)=>{var M,D,F,U;let o=-1,ie=-1;if(b==="step"){const B=E.steps,ce=E.strokeWidth;typeof y=="string"||typeof y>"u"?(o=y==="small"?2:14,ie=ce??8):typeof y=="number"?[o,ie]=[y,y]:[o=14,ie=8]=y,o*=B}else if(b==="line"){const B=E?.strokeWidth;typeof y=="string"||typeof y>"u"?ie=B||(y==="small"?6:8):typeof y=="number"?[o,ie]=[y,y]:[o=-1,ie=8]=y}else(b==="circle"||b==="dashboard")&&(typeof y=="string"||typeof y>"u"?[o,ie]=y==="small"?[60,60]:[120,120]:typeof y=="number"?[o,ie]=[y,y]:(o=(D=(M=y[0])!==null&&M!==void 0?M:y[1])!==null&&D!==void 0?D:120,ie=(U=(F=y[0])!==null&&F!==void 0?F:y[1])!==null&&U!==void 0?U:120));return[o,ie]},Ng=3,$g=y=>Ng/y*100,jg=y=>{const{prefixCls:b,trailColor:E=null,strokeLinecap:M="round",gapPosition:D,gapDegree:F,width:U=120,type:o,children:ie,success:B,size:ce=U}=y,[_e,de]=dc(ce,"circle");let{strokeWidth:be}=y;be===void 0&&(be=Math.max($g(_e),6));const Me={width:_e,height:de,fontSize:_e*.15+6},Be=H.useMemo(()=>{if(F||F===0)return F;if(o==="dashboard")return 75},[F,o]),De=D||o==="dashboard"&&"bottom"||void 0,Ne=Object.prototype.toString.call(y.strokeColor)==="[object Object]",Qe=Og({success:B,strokeColor:y.strokeColor}),qe=di(`${b}-inner`,{[`${b}-circle-gradient`]:Ne}),Oe=H.createElement(Fg,{percent:Bg(y),strokeWidth:be,trailWidth:be,strokeColor:Qe,strokeLinecap:M,trailColor:E,prefixCls:b,gapDegree:Be,gapPosition:De});return H.createElement("div",{className:qe,style:Me},_e<=20?H.createElement(tp,{title:ie},H.createElement("span",null,Oe)):H.createElement(H.Fragment,null,Oe,ie))},Vg=jg,cc="--progress-line-stroke-color",mp="--progress-percent",Rd=y=>{const b=y?"100%":"-100%";return new Zo(`antProgress${y?"RTL":"LTR"}Active`,{"0%":{transform:`translateX(${b}) scaleX(0)`,opacity:.1},"20%":{transform:`translateX(${b}) scaleX(0)`,opacity:.5},to:{transform:"translateX(0) scaleX(1)",opacity:0}})},Ug=y=>{const{componentCls:b,iconCls:E}=y;return{[b]:Object.assign(Object.assign({},Ru(y)),{display:"inline-block","&-rtl":{direction:"rtl"},"&-line":{position:"relative",width:"100%",fontSize:y.fontSize,marginInlineEnd:y.marginXS,marginBottom:y.marginXS},[`${b}-outer`]:{display:"inline-block",width:"100%"},[`&${b}-show-info`]:{[`${b}-outer`]:{marginInlineEnd:`calc(-2em - ${dr(y.marginXS)})`,paddingInlineEnd:`calc(2em + ${dr(y.paddingXS)})`}},[`${b}-inner`]:{position:"relative",display:"inline-block",width:"100%",overflow:"hidden",verticalAlign:"middle",backgroundColor:y.remainingColor,borderRadius:y.lineBorderRadius},[`${b}-inner:not(${b}-circle-gradient)`]:{[`${b}-circle-path`]:{stroke:y.defaultColor}},[`${b}-success-bg, ${b}-bg`]:{position:"relative",background:y.defaultColor,borderRadius:y.lineBorderRadius,transition:`all ${y.motionDurationSlow} ${y.motionEaseInOutCirc}`},[`${b}-bg`]:{overflow:"hidden","&::after":{content:'""',background:{_multi_value_:!0,value:["inherit",`var(${cc})`]},height:"100%",width:`calc(1 / var(${mp}) * 100%)`,display:"block"}},[`${b}-success-bg`]:{position:"absolute",insetBlockStart:0,insetInlineStart:0,backgroundColor:y.colorSuccess},[`${b}-text`]:{display:"inline-block",width:"2em",marginInlineStart:y.marginXS,color:y.colorText,lineHeight:1,whiteSpace:"nowrap",textAlign:"start",verticalAlign:"middle",wordBreak:"normal",[E]:{fontSize:y.fontSize}},[`&${b}-status-active`]:{[`${b}-bg::before`]:{position:"absolute",inset:0,backgroundColor:y.colorBgContainer,borderRadius:y.lineBorderRadius,opacity:0,animationName:Rd(),animationDuration:y.progressActiveMotionDuration,animationTimingFunction:y.motionEaseOutQuint,animationIterationCount:"infinite",content:'""'}},[`&${b}-rtl${b}-status-active`]:{[`${b}-bg::before`]:{animationName:Rd(!0)}},[`&${b}-status-exception`]:{[`${b}-bg`]:{backgroundColor:y.colorError},[`${b}-text`]:{color:y.colorError}},[`&${b}-status-exception ${b}-inner:not(${b}-circle-gradient)`]:{[`${b}-circle-path`]:{stroke:y.colorError}},[`&${b}-status-success`]:{[`${b}-bg`]:{backgroundColor:y.colorSuccess},[`${b}-text`]:{color:y.colorSuccess}},[`&${b}-status-success ${b}-inner:not(${b}-circle-gradient)`]:{[`${b}-circle-path`]:{stroke:y.colorSuccess}}})}},qg=y=>{const{componentCls:b,iconCls:E}=y;return{[b]:{[`${b}-circle-trail`]:{stroke:y.remainingColor},[`&${b}-circle ${b}-inner`]:{position:"relative",lineHeight:1,backgroundColor:"transparent"},[`&${b}-circle ${b}-text`]:{position:"absolute",insetBlockStart:"50%",insetInlineStart:0,width:"100%",margin:0,padding:0,color:y.circleTextColor,fontSize:y.circleTextFontSize,lineHeight:1,whiteSpace:"normal",textAlign:"center",transform:"translateY(-50%)",[E]:{fontSize:y.circleIconFontSize}},[`${b}-circle&-status-exception`]:{[`${b}-text`]:{color:y.colorError}},[`${b}-circle&-status-success`]:{[`${b}-text`]:{color:y.colorSuccess}}},[`${b}-inline-circle`]:{lineHeight:1,[`${b}-inner`]:{verticalAlign:"bottom"}}}},Zg=y=>{const{componentCls:b}=y;return{[b]:{[`${b}-steps`]:{display:"inline-block","&-outer":{display:"flex",flexDirection:"row",alignItems:"center"},"&-item":{flexShrink:0,minWidth:y.progressStepMinWidth,marginInlineEnd:y.progressStepMarginInlineEnd,backgroundColor:y.remainingColor,transition:`all ${y.motionDurationSlow}`,"&-active":{backgroundColor:y.defaultColor}}}}}},Gg=y=>{const{componentCls:b,iconCls:E}=y;return{[b]:{[`${b}-small&-line, ${b}-small&-line ${b}-text ${E}`]:{fontSize:y.fontSizeSM}}}},Hg=y=>({circleTextColor:y.colorText,defaultColor:y.colorInfo,remainingColor:y.colorFillSecondary,lineBorderRadius:100,circleTextFontSize:"1em",circleIconFontSize:`${y.fontSize/y.fontSizeSM}em`}),Wg=Du("Progress",y=>{const b=y.calc(y.marginXXS).div(2).equal(),E=Lu(y,{progressStepMarginInlineEnd:b,progressStepMinWidth:b,progressActiveMotionDuration:"2.4s"});return[Ug(E),qg(E),Zg(E),Gg(E)]},Hg);var Xg=function(y,b){var E={};for(var M in y)Object.prototype.hasOwnProperty.call(y,M)&&b.indexOf(M)<0&&(E[M]=y[M]);if(y!=null&&typeof Object.getOwnPropertySymbols=="function")for(var D=0,M=Object.getOwnPropertySymbols(y);D<M.length;D++)b.indexOf(M[D])<0&&Object.prototype.propertyIsEnumerable.call(y,M[D])&&(E[M[D]]=y[M[D]]);return E};const Kg=y=>{let b=[];return Object.keys(y).forEach(E=>{const M=parseFloat(E.replace(/%/g,""));isNaN(M)||b.push({key:M,value:y[E]})}),b=b.sort((E,M)=>E.key-M.key),b.map(E=>{let{key:M,value:D}=E;return`${D} ${M}%`}).join(", ")},Yg=(y,b)=>{const{from:E=ku.blue,to:M=ku.blue,direction:D=b==="rtl"?"to left":"to right"}=y,F=Xg(y,["from","to","direction"]);if(Object.keys(F).length!==0){const o=Kg(F),ie=`linear-gradient(${D}, ${o})`;return{background:ie,[cc]:ie}}const U=`linear-gradient(${D}, ${E}, ${M})`;return{background:U,[cc]:U}},Jg=y=>{const{prefixCls:b,direction:E,percent:M,size:D,strokeWidth:F,strokeColor:U,strokeLinecap:o="round",children:ie,trailColor:B=null,success:ce}=y,_e=U&&typeof U!="string"?Yg(U,E):{[cc]:U,background:U},de=o==="square"||o==="butt"?0:void 0,be=D??[-1,F||(D==="small"?6:8)],[Me,Be]=dc(be,"line",{strokeWidth:F}),De={backgroundColor:B||void 0,borderRadius:de},Ne=Object.assign(Object.assign({width:`${vs(M)}%`,height:Be,borderRadius:de},_e),{[mp]:vs(M)/100}),Qe=lc(y),qe={width:`${vs(Qe)}%`,height:Be,borderRadius:de,backgroundColor:ce?.strokeColor},Oe={width:Me<0?"100%":Me,height:Be};return H.createElement(H.Fragment,null,H.createElement("div",{className:`${b}-outer`,style:Oe},H.createElement("div",{className:`${b}-inner`,style:De},H.createElement("div",{className:`${b}-bg`,style:Ne}),Qe!==void 0?H.createElement("div",{className:`${b}-success-bg`,style:qe}):null)),ie)},Qg=Jg,e_=y=>{const{size:b,steps:E,percent:M=0,strokeWidth:D=8,strokeColor:F,trailColor:U=null,prefixCls:o,children:ie}=y,B=Math.round(E*(M/100)),_e=b??[b==="small"?2:14,D],[de,be]=dc(_e,"step",{steps:E,strokeWidth:D}),Me=de/E,Be=new Array(E);for(let De=0;De<E;De++){const Ne=Array.isArray(F)?F[De]:F;Be[De]=H.createElement("div",{key:De,className:di(`${o}-steps-item`,{[`${o}-steps-item-active`]:De<=B-1}),style:{backgroundColor:De<=B-1?Ne:U,width:Me,height:be}})}return H.createElement("div",{className:`${o}-steps-outer`},Be,ie)},t_=e_;var i_=function(y,b){var E={};for(var M in y)Object.prototype.hasOwnProperty.call(y,M)&&b.indexOf(M)<0&&(E[M]=y[M]);if(y!=null&&typeof Object.getOwnPropertySymbols=="function")for(var D=0,M=Object.getOwnPropertySymbols(y);D<M.length;D++)b.indexOf(M[D])<0&&Object.prototype.propertyIsEnumerable.call(y,M[D])&&(E[M[D]]=y[M[D]]);return E};const r_=["normal","exception","active","success"],n_=H.forwardRef((y,b)=>{const{prefixCls:E,className:M,rootClassName:D,steps:F,strokeColor:U,percent:o=0,size:ie="default",showInfo:B=!0,type:ce="line",status:_e,format:de,style:be}=y,Me=i_(y,["prefixCls","className","rootClassName","steps","strokeColor","percent","size","showInfo","type","status","format","style"]),Be=H.useMemo(()=>{var Lt,xt;const Et=lc(y);return parseInt(Et!==void 0?(Lt=Et??0)===null||Lt===void 0?void 0:Lt.toString():(xt=o??0)===null||xt===void 0?void 0:xt.toString(),10)},[o,y.success,y.successPercent]),De=H.useMemo(()=>!r_.includes(_e)&&Be>=100?"success":_e||"normal",[_e,Be]),{getPrefixCls:Ne,direction:Qe,progress:qe}=H.useContext(Da),Oe=Ne("progress",E),[Te,at,tt]=Wg(Oe),He=H.useMemo(()=>{if(!B)return null;const Lt=lc(y);let xt;const Et=de||(ft=>`${ft}%`),Bt=ce==="line";return de||De!=="exception"&&De!=="success"?xt=Et(vs(o),vs(Lt)):De==="exception"?xt=Bt?H.createElement(Qd,null):H.createElement(Fu,null):De==="success"&&(xt=Bt?H.createElement(Jd,null):H.createElement(Im,null)),H.createElement("span",{className:`${Oe}-text`,title:typeof xt=="string"?xt:void 0},xt)},[B,o,Be,De,ce,Oe,de]),ot=Array.isArray(U)?U[0]:U,Fe=typeof U=="string"||Array.isArray(U)?U:void 0;let ht;ce==="line"?ht=F?H.createElement(t_,Object.assign({},y,{strokeColor:Fe,prefixCls:Oe,steps:F}),He):H.createElement(Qg,Object.assign({},y,{strokeColor:ot,prefixCls:Oe,direction:Qe}),He):(ce==="circle"||ce==="dashboard")&&(ht=H.createElement(Vg,Object.assign({},y,{strokeColor:ot,prefixCls:Oe,progressStatus:De}),He));const zt=di(Oe,`${Oe}-status-${De}`,`${Oe}-${ce==="dashboard"&&"circle"||F&&"steps"||ce}`,{[`${Oe}-inline-circle`]:ce==="circle"&&dc(ie,"circle")[0]<=20,[`${Oe}-show-info`]:B,[`${Oe}-${ie}`]:typeof ie=="string",[`${Oe}-rtl`]:Qe==="rtl"},qe?.className,M,D,at,tt);return Te(H.createElement("div",Object.assign({ref:b,style:Object.assign(Object.assign({},qe?.style),be),className:zt,role:"progressbar","aria-valuenow":Be},Tm(Me,["trailColor","strokeWidth","width","gapDegree","gapPosition","strokeLinecap","success","successPercent"])),ht))}),s_=n_;var a_={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z"}}]},name:"delete",theme:"outlined"};const o_=a_;var l_=function(b,E){return H.createElement(La,Kr({},b,{ref:E,icon:o_}))};const gp=H.forwardRef(l_),wu=function(y,b){if(y&&b){var E=Array.isArray(b)?b:b.split(","),M=y.name||"",D=y.type||"",F=D.replace(/\/.*$/,"");return E.some(function(U){var o=U.trim();if(/^\*(\/\*)?$/.test(U))return!0;if(o.charAt(0)==="."){var ie=M.toLowerCase(),B=o.toLowerCase(),ce=[B];return(B===".jpg"||B===".jpeg")&&(ce=[".jpg",".jpeg"]),ce.some(function(_e){return ie.endsWith(_e)})}return/\/\*$/.test(o)?F===o.replace(/\/.*$/,""):D===o?!0:/^\w+$/.test(o)?(Em(!1,"Upload takes an invalidate 'accept' type '".concat(o,"'.Skip for check.")),!0):!1})}return!0};function c_(y,b){var E="cannot ".concat(y.method," ").concat(y.action," ").concat(b.status,"'"),M=new Error(E);return M.status=b.status,M.method=y.method,M.url=y.action,M}function Fd(y){var b=y.responseText||y.response;if(!b)return b;try{return JSON.parse(b)}catch{return b}}function u_(y){var b=new XMLHttpRequest;y.onProgress&&b.upload&&(b.upload.onprogress=function(F){F.total>0&&(F.percent=F.loaded/F.total*100),y.onProgress(F)});var E=new FormData;y.data&&Object.keys(y.data).forEach(function(D){var F=y.data[D];if(Array.isArray(F)){F.forEach(function(U){E.append("".concat(D,"[]"),U)});return}E.append(D,F)}),y.file instanceof Blob?E.append(y.filename,y.file,y.file.name):E.append(y.filename,y.file),b.onerror=function(F){y.onError(F)},b.onload=function(){return b.status<200||b.status>=300?y.onError(c_(y,b),Fd(b)):y.onSuccess(Fd(b),b)},b.open(y.method,y.action,!0),y.withCredentials&&"withCredentials"in b&&(b.withCredentials=!0);var M=y.headers||{};return M["X-Requested-With"]!==null&&b.setRequestHeader("X-Requested-With","XMLHttpRequest"),Object.keys(M).forEach(function(D){M[D]!==null&&b.setRequestHeader(D,M[D])}),b.send(E),{abort:function(){b.abort()}}}function h_(y,b){var E=y.createReader(),M=[];function D(){E.readEntries(function(F){var U=Array.prototype.slice.apply(F);M=M.concat(U);var o=!U.length;o?b(M):D()})}D()}var d_=function(b,E,M){var D=function F(U,o){U&&(U.path=o||"",U.isFile?U.file(function(ie){M(ie)&&(U.fullPath&&!ie.webkitRelativePath&&(Object.defineProperties(ie,{webkitRelativePath:{writable:!0}}),ie.webkitRelativePath=U.fullPath.replace(/^\//,""),Object.defineProperties(ie,{webkitRelativePath:{writable:!1}})),E([ie]))}):U.isDirectory&&h_(U,function(ie){ie.forEach(function(B){F(B,"".concat(o).concat(U.name,"/"))})}))};b.forEach(function(F){D(F.webkitGetAsEntry())})},p_=+new Date,f_=0;function Su(){return"rc-upload-".concat(p_,"-").concat(++f_)}var m_=["component","prefixCls","className","classNames","disabled","id","style","styles","multiple","accept","capture","children","directory","openFileDialogOnClick","onMouseEnter","onMouseLeave","hasControlInside"],g_=function(y){ip(E,y);var b=rp(E);function E(){var M;np(this,E);for(var D=arguments.length,F=new Array(D),U=0;U<D;U++)F[U]=arguments[U];return M=b.call.apply(b,[this].concat(F)),Vi(Wr(M),"state",{uid:Su()}),Vi(Wr(M),"reqs",{}),Vi(Wr(M),"fileInput",void 0),Vi(Wr(M),"_isMounted",void 0),Vi(Wr(M),"onChange",function(o){var ie=M.props,B=ie.accept,ce=ie.directory,_e=o.target.files,de=Xr(_e).filter(function(be){return!ce||wu(be,B)});M.uploadFiles(de),M.reset()}),Vi(Wr(M),"onClick",function(o){var ie=M.fileInput;if(ie){var B=o.target,ce=M.props.onClick;if(B&&B.tagName==="BUTTON"){var _e=ie.parentNode;_e.focus(),B.blur()}ie.click(),ce&&ce(o)}}),Vi(Wr(M),"onKeyDown",function(o){o.key==="Enter"&&M.onClick(o)}),Vi(Wr(M),"onFileDrop",function(o){var ie=M.props.multiple;if(o.preventDefault(),o.type!=="dragover")if(M.props.directory)d_(Array.prototype.slice.call(o.dataTransfer.items),M.uploadFiles,function(ce){return wu(ce,M.props.accept)});else{var B=Xr(o.dataTransfer.files).filter(function(ce){return wu(ce,M.props.accept)});ie===!1&&(B=B.slice(0,1)),M.uploadFiles(B)}}),Vi(Wr(M),"uploadFiles",function(o){var ie=Xr(o),B=ie.map(function(ce){return ce.uid=Su(),M.processFile(ce,ie)});Promise.all(B).then(function(ce){var _e=M.props.onBatchStart;_e?.(ce.map(function(de){var be=de.origin,Me=de.parsedFile;return{file:be,parsedFile:Me}})),ce.filter(function(de){return de.parsedFile!==null}).forEach(function(de){M.post(de)})})}),Vi(Wr(M),"processFile",function(){var o=km(bd().mark(function ie(B,ce){var _e,de,be,Me,Be,De,Ne,Qe,qe;return bd().wrap(function(Te){for(;;)switch(Te.prev=Te.next){case 0:if(_e=M.props.beforeUpload,de=B,!_e){Te.next=14;break}return Te.prev=3,Te.next=6,_e(B,ce);case 6:de=Te.sent,Te.next=12;break;case 9:Te.prev=9,Te.t0=Te.catch(3),de=!1;case 12:if(de!==!1){Te.next=14;break}return Te.abrupt("return",{origin:B,parsedFile:null,action:null,data:null});case 14:if(be=M.props.action,typeof be!="function"){Te.next=21;break}return Te.next=18,be(B);case 18:Me=Te.sent,Te.next=22;break;case 21:Me=be;case 22:if(Be=M.props.data,typeof Be!="function"){Te.next=29;break}return Te.next=26,Be(B);case 26:De=Te.sent,Te.next=30;break;case 29:De=Be;case 30:return Ne=(Vs(de)==="object"||typeof de=="string")&&de?de:B,Ne instanceof File?Qe=Ne:Qe=new File([Ne],B.name,{type:B.type}),qe=Qe,qe.uid=B.uid,Te.abrupt("return",{origin:B,data:De,parsedFile:qe,action:Me});case 35:case"end":return Te.stop()}},ie,null,[[3,9]])}));return function(ie,B){return o.apply(this,arguments)}}()),Vi(Wr(M),"saveFileInput",function(o){M.fileInput=o}),M}return sp(E,[{key:"componentDidMount",value:function(){this._isMounted=!0}},{key:"componentWillUnmount",value:function(){this._isMounted=!1,this.abort()}},{key:"post",value:function(D){var F=this,U=D.data,o=D.origin,ie=D.action,B=D.parsedFile;if(this._isMounted){var ce=this.props,_e=ce.onStart,de=ce.customRequest,be=ce.name,Me=ce.headers,Be=ce.withCredentials,De=ce.method,Ne=o.uid,Qe=de||u_,qe={action:ie,filename:be,data:U,file:B,headers:Me,withCredentials:Be,method:De||"post",onProgress:function(Te){var at=F.props.onProgress;at?.(Te,B)},onSuccess:function(Te,at){var tt=F.props.onSuccess;tt?.(Te,B,at),delete F.reqs[Ne]},onError:function(Te,at){var tt=F.props.onError;tt?.(Te,at,B),delete F.reqs[Ne]}};_e(o),this.reqs[Ne]=Qe(qe)}}},{key:"reset",value:function(){this.setState({uid:Su()})}},{key:"abort",value:function(D){var F=this.reqs;if(D){var U=D.uid?D.uid:D;F[U]&&F[U].abort&&F[U].abort(),delete F[U]}else Object.keys(F).forEach(function(o){F[o]&&F[o].abort&&F[o].abort(),delete F[o]})}},{key:"render",value:function(){var D,F=this.props,U=F.component,o=F.prefixCls,ie=F.className,B=F.classNames,ce=B===void 0?{}:B,_e=F.disabled,de=F.id,be=F.style,Me=F.styles,Be=Me===void 0?{}:Me,De=F.multiple,Ne=F.accept,Qe=F.capture,qe=F.children,Oe=F.directory,Te=F.openFileDialogOnClick,at=F.onMouseEnter,tt=F.onMouseLeave,He=F.hasControlInside,ot=uc(F,m_),Fe=di((D={},Vi(D,o,!0),Vi(D,"".concat(o,"-disabled"),_e),Vi(D,ie,ie),D)),ht=Oe?{directory:"directory",webkitdirectory:"webkitdirectory"}:{},zt=_e?{}:{onClick:Te?this.onClick:function(){},onKeyDown:Te?this.onKeyDown:function(){},onMouseEnter:at,onMouseLeave:tt,onDrop:this.onFileDrop,onDragOver:this.onFileDrop,tabIndex:He?void 0:"0"};return ys.createElement(U,Kr({},zt,{className:Fe,role:He?void 0:"button",style:be}),ys.createElement("input",Kr({},Mm(ot,{aria:!0,data:!0}),{id:de,disabled:_e,type:"file",ref:this.saveFileInput,onClick:function(xt){return xt.stopPropagation()},key:this.state.uid,style:xs({display:"none"},Be.input),className:ce.input,accept:Ne},ht,{multiple:De,onChange:this.onChange},Qe!=null?{capture:Qe}:{})),qe)}}]),E}(H.Component);function Cu(){}var zu=function(y){ip(E,y);var b=rp(E);function E(){var M;np(this,E);for(var D=arguments.length,F=new Array(D),U=0;U<D;U++)F[U]=arguments[U];return M=b.call.apply(b,[this].concat(F)),Vi(Wr(M),"uploader",void 0),Vi(Wr(M),"saveUploader",function(o){M.uploader=o}),M}return sp(E,[{key:"abort",value:function(D){this.uploader.abort(D)}},{key:"render",value:function(){return ys.createElement(g_,Kr({},this.props,{ref:this.saveUploader}))}}]),E}(H.Component);Vi(zu,"defaultProps",{component:"span",prefixCls:"rc-upload",data:{},headers:{},name:"file",multipart:!1,onStart:Cu,onError:Cu,onSuccess:Cu,multiple:!1,beforeUpload:null,customRequest:null,withCredentials:!1,openFileDialogOnClick:!0,hasControlInside:!1});const __=y=>{const{componentCls:b,iconCls:E}=y;return{[`${b}-wrapper`]:{[`${b}-drag`]:{position:"relative",width:"100%",height:"100%",textAlign:"center",background:y.colorFillAlter,border:`${dr(y.lineWidth)} dashed ${y.colorBorder}`,borderRadius:y.borderRadiusLG,cursor:"pointer",transition:`border-color ${y.motionDurationSlow}`,[b]:{padding:y.padding},[`${b}-btn`]:{display:"table",width:"100%",height:"100%",outline:"none",borderRadius:y.borderRadiusLG,"&:focus-visible":{outline:`${dr(y.lineWidthFocus)} solid ${y.colorPrimaryBorder}`}},[`${b}-drag-container`]:{display:"table-cell",verticalAlign:"middle"},[`
          &:not(${b}-disabled):hover,
          &-hover:not(${b}-disabled)
        `]:{borderColor:y.colorPrimaryHover},[`p${b}-drag-icon`]:{marginBottom:y.margin,[E]:{color:y.colorPrimary,fontSize:y.uploadThumbnailSize}},[`p${b}-text`]:{margin:`0 0 ${dr(y.marginXXS)}`,color:y.colorTextHeading,fontSize:y.fontSizeLG},[`p${b}-hint`]:{color:y.colorTextDescription,fontSize:y.fontSize},[`&${b}-disabled`]:{[`p${b}-drag-icon ${E},
            p${b}-text,
            p${b}-hint
          `]:{color:y.colorTextDisabled}}}}}},y_=y=>{const{componentCls:b,antCls:E,iconCls:M,fontSize:D,lineHeight:F,calc:U}=y,o=`${b}-list-item`,ie=`${o}-actions`,B=`${o}-action`,ce=y.fontHeightSM;return{[`${b}-wrapper`]:{[`${b}-list`]:Object.assign(Object.assign({},ap()),{lineHeight:y.lineHeight,[o]:{position:"relative",height:U(y.lineHeight).mul(D).equal(),marginTop:y.marginXS,fontSize:D,display:"flex",alignItems:"center",transition:`background-color ${y.motionDurationSlow}`,"&:hover":{backgroundColor:y.controlItemBgHover},[`${o}-name`]:Object.assign(Object.assign({},op),{padding:`0 ${dr(y.paddingXS)}`,lineHeight:F,flex:"auto",transition:`all ${y.motionDurationSlow}`}),[ie]:{[B]:{opacity:0},[M]:{color:y.actionsColor,transition:`all ${y.motionDurationSlow}`},[`
              ${B}:focus-visible,
              &.picture ${B}
            `]:{opacity:1},[`${B}${E}-btn`]:{height:ce,border:0,lineHeight:1}},[`${b}-icon ${M}`]:{color:y.colorTextDescription,fontSize:D},[`${o}-progress`]:{position:"absolute",bottom:y.calc(y.uploadProgressOffset).mul(-1).equal(),width:"100%",paddingInlineStart:U(D).add(y.paddingXS).equal(),fontSize:D,lineHeight:0,pointerEvents:"none","> div":{margin:0}}},[`${o}:hover ${B}`]:{opacity:1},[`${o}-error`]:{color:y.colorError,[`${o}-name, ${b}-icon ${M}`]:{color:y.colorError},[ie]:{[`${M}, ${M}:hover`]:{color:y.colorError},[B]:{opacity:1}}},[`${b}-list-item-container`]:{transition:`opacity ${y.motionDurationSlow}, height ${y.motionDurationSlow}`,"&::before":{display:"table",width:0,height:0,content:'""'}}})}}},Bd=new Zo("uploadAnimateInlineIn",{from:{width:0,height:0,margin:0,padding:0,opacity:0}}),Od=new Zo("uploadAnimateInlineOut",{to:{width:0,height:0,margin:0,padding:0,opacity:0}}),x_=y=>{const{componentCls:b}=y,E=`${b}-animate-inline`;return[{[`${b}-wrapper`]:{[`${E}-appear, ${E}-enter, ${E}-leave`]:{animationDuration:y.motionDurationSlow,animationTimingFunction:y.motionEaseInOutCirc,animationFillMode:"forwards"},[`${E}-appear, ${E}-enter`]:{animationName:Bd},[`${E}-leave`]:{animationName:Od}}},{[`${b}-wrapper`]:Wm(y)},Bd,Od]},v_=y=>{const{componentCls:b,iconCls:E,uploadThumbnailSize:M,uploadProgressOffset:D,calc:F}=y,U=`${b}-list`,o=`${U}-item`;return{[`${b}-wrapper`]:{[`
        ${U}${U}-picture,
        ${U}${U}-picture-card,
        ${U}${U}-picture-circle
      `]:{[o]:{position:"relative",height:F(M).add(F(y.lineWidth).mul(2)).add(F(y.paddingXS).mul(2)).equal(),padding:y.paddingXS,border:`${dr(y.lineWidth)} ${y.lineType} ${y.colorBorder}`,borderRadius:y.borderRadiusLG,"&:hover":{background:"transparent"},[`${o}-thumbnail`]:Object.assign(Object.assign({},op),{width:M,height:M,lineHeight:dr(F(M).add(y.paddingSM).equal()),textAlign:"center",flex:"none",[E]:{fontSize:y.fontSizeHeading2,color:y.colorPrimary},img:{display:"block",width:"100%",height:"100%",overflow:"hidden"}}),[`${o}-progress`]:{bottom:D,width:`calc(100% - ${dr(F(y.paddingSM).mul(2).equal())})`,marginTop:0,paddingInlineStart:F(M).add(y.paddingXS).equal()}},[`${o}-error`]:{borderColor:y.colorError,[`${o}-thumbnail ${E}`]:{[`svg path[fill='${wd[0]}']`]:{fill:y.colorErrorBg},[`svg path[fill='${wd.primary}']`]:{fill:y.colorError}}},[`${o}-uploading`]:{borderStyle:"dashed",[`${o}-name`]:{marginBottom:D}}},[`${U}${U}-picture-circle ${o}`]:{[`&, &::before, ${o}-thumbnail`]:{borderRadius:"50%"}}}}},b_=y=>{const{componentCls:b,iconCls:E,fontSizeLG:M,colorTextLightSolid:D,calc:F}=y,U=`${b}-list`,o=`${U}-item`,ie=y.uploadPicCardSize;return{[`
      ${b}-wrapper${b}-picture-card-wrapper,
      ${b}-wrapper${b}-picture-circle-wrapper
    `]:Object.assign(Object.assign({},ap()),{display:"inline-block",width:"100%",[`${b}${b}-select`]:{width:ie,height:ie,marginInlineEnd:y.marginXS,marginBottom:y.marginXS,textAlign:"center",verticalAlign:"top",backgroundColor:y.colorFillAlter,border:`${dr(y.lineWidth)} dashed ${y.colorBorder}`,borderRadius:y.borderRadiusLG,cursor:"pointer",transition:`border-color ${y.motionDurationSlow}`,[`> ${b}`]:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",textAlign:"center"},[`&:not(${b}-disabled):hover`]:{borderColor:y.colorPrimary}},[`${U}${U}-picture-card, ${U}${U}-picture-circle`]:{[`${U}-item-container`]:{display:"inline-block",width:ie,height:ie,marginBlock:`0 ${dr(y.marginXS)}`,marginInline:`0 ${dr(y.marginXS)}`,verticalAlign:"top"},"&::after":{display:"none"},[o]:{height:"100%",margin:0,"&::before":{position:"absolute",zIndex:1,width:`calc(100% - ${dr(F(y.paddingXS).mul(2).equal())})`,height:`calc(100% - ${dr(F(y.paddingXS).mul(2).equal())})`,backgroundColor:y.colorBgMask,opacity:0,transition:`all ${y.motionDurationSlow}`,content:'" "'}},[`${o}:hover`]:{[`&::before, ${o}-actions`]:{opacity:1}},[`${o}-actions`]:{position:"absolute",insetInlineStart:0,zIndex:10,width:"100%",whiteSpace:"nowrap",textAlign:"center",opacity:0,transition:`all ${y.motionDurationSlow}`,[`
            ${E}-eye,
            ${E}-download,
            ${E}-delete
          `]:{zIndex:10,width:M,margin:`0 ${dr(y.marginXXS)}`,fontSize:M,cursor:"pointer",transition:`all ${y.motionDurationSlow}`,color:D,"&:hover":{color:D},svg:{verticalAlign:"baseline"}}},[`${o}-thumbnail, ${o}-thumbnail img`]:{position:"static",display:"block",width:"100%",height:"100%",objectFit:"contain"},[`${o}-name`]:{display:"none",textAlign:"center"},[`${o}-file + ${o}-name`]:{position:"absolute",bottom:y.margin,display:"block",width:`calc(100% - ${dr(F(y.paddingXS).mul(2).equal())})`},[`${o}-uploading`]:{[`&${o}`]:{backgroundColor:y.colorFillAlter},[`&::before, ${E}-eye, ${E}-download, ${E}-delete`]:{display:"none"}},[`${o}-progress`]:{bottom:y.marginXL,width:`calc(100% - ${dr(F(y.paddingXS).mul(2).equal())})`,paddingInlineStart:0}}}),[`${b}-wrapper${b}-picture-circle-wrapper`]:{[`${b}${b}-select`]:{borderRadius:"50%"}}}},w_=y=>{const{componentCls:b}=y;return{[`${b}-rtl`]:{direction:"rtl"}}},S_=y=>{const{componentCls:b,colorTextDisabled:E}=y;return{[`${b}-wrapper`]:Object.assign(Object.assign({},Ru(y)),{[b]:{outline:0,"input[type='file']":{cursor:"pointer"}},[`${b}-select`]:{display:"inline-block"},[`${b}-disabled`]:{color:E,cursor:"not-allowed"}})}},C_=y=>({actionsColor:y.colorTextDescription}),T_=Du("Upload",y=>{const{fontSizeHeading3:b,fontHeight:E,lineWidth:M,controlHeightLG:D,calc:F}=y,U=Lu(y,{uploadThumbnailSize:F(b).mul(2).equal(),uploadProgressOffset:F(F(E).div(2)).add(M).equal(),uploadPicCardSize:F(D).mul(2.55).equal()});return[S_(U),__(U),v_(U),b_(U),y_(U),x_(U),w_(U),Am(U)]},C_);var I_={icon:function(b,E){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M534 352V136H232v752h560V394H576a42 42 0 01-42-42z",fill:E}},{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM602 137.8L790.2 326H602V137.8zM792 888H232V136h302v216a42 42 0 0042 42h216v494z",fill:b}}]}},name:"file",theme:"twotone"};const E_=I_;var M_=function(b,E){return H.createElement(La,Kr({},b,{ref:E,icon:E_}))};const k_=H.forwardRef(M_);var A_={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M779.3 196.6c-94.2-94.2-247.6-94.2-341.7 0l-261 260.8c-1.7 1.7-2.6 4-2.6 6.4s.9 4.7 2.6 6.4l36.9 36.9a9 9 0 0012.7 0l261-260.8c32.4-32.4 75.5-50.2 121.3-50.2s88.9 17.8 121.2 50.2c32.4 32.4 50.2 75.5 50.2 121.2 0 45.8-17.8 88.8-50.2 121.2l-266 265.9-43.1 43.1c-40.3 40.3-105.8 40.3-146.1 0-19.5-19.5-30.2-45.4-30.2-73s10.7-53.5 30.2-73l263.9-263.8c6.7-6.6 15.5-10.3 24.9-10.3h.1c9.4 0 18.1 3.7 24.7 10.3 6.7 6.7 10.3 15.5 10.3 24.9 0 9.3-3.7 18.1-10.3 24.7L372.4 653c-1.7 1.7-2.6 4-2.6 6.4s.9 4.7 2.6 6.4l36.9 36.9a9 9 0 0012.7 0l215.6-215.6c19.9-19.9 30.8-46.3 30.8-74.4s-11-54.6-30.8-74.4c-41.1-41.1-107.9-41-149 0L463 364 224.8 602.1A172.22 172.22 0 00174 724.8c0 46.3 18.1 89.8 50.8 122.5 33.9 33.8 78.3 50.7 122.7 50.7 44.4 0 88.8-16.9 122.6-50.7l309.2-309C824.8 492.7 850 432 850 367.5c.1-64.6-25.1-125.3-70.7-170.9z"}}]},name:"paper-clip",theme:"outlined"};const P_=A_;var z_=function(b,E){return H.createElement(La,Kr({},b,{ref:E,icon:P_}))};const D_=H.forwardRef(z_);var L_={icon:function(b,E){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 632H136v-39.9l138.5-164.3 150.1 178L658.1 489 888 761.6V792zm0-129.8L664.2 396.8c-3.2-3.8-9-3.8-12.2 0L424.6 666.4l-144-170.7c-3.2-3.8-9-3.8-12.2 0L136 652.7V232h752v430.2z",fill:b}},{tag:"path",attrs:{d:"M424.6 765.8l-150.1-178L136 752.1V792h752v-30.4L658.1 489z",fill:E}},{tag:"path",attrs:{d:"M136 652.7l132.4-157c3.2-3.8 9-3.8 12.2 0l144 170.7L652 396.8c3.2-3.8 9-3.8 12.2 0L888 662.2V232H136v420.7zM304 280a88 88 0 110 176 88 88 0 010-176z",fill:E}},{tag:"path",attrs:{d:"M276 368a28 28 0 1056 0 28 28 0 10-56 0z",fill:E}},{tag:"path",attrs:{d:"M304 456a88 88 0 100-176 88 88 0 000 176zm0-116c15.5 0 28 12.5 28 28s-12.5 28-28 28-28-12.5-28-28 12.5-28 28-28z",fill:b}}]}},name:"picture",theme:"twotone"};const R_=L_;var F_=function(b,E){return H.createElement(La,Kr({},b,{ref:E,icon:R_}))};const B_=H.forwardRef(F_);function ic(y){return Object.assign(Object.assign({},y),{lastModified:y.lastModified,lastModifiedDate:y.lastModifiedDate,name:y.name,size:y.size,type:y.type,uid:y.uid,percent:0,originFileObj:y})}function rc(y,b){const E=Xr(b),M=E.findIndex(D=>{let{uid:F}=D;return F===y.uid});return M===-1?E.push(y):E[M]=y,E}function Tu(y,b){const E=y.uid!==void 0?"uid":"name";return b.filter(M=>M[E]===y[E])[0]}function O_(y,b){const E=y.uid!==void 0?"uid":"name",M=b.filter(D=>D[E]!==y[E]);return M.length===b.length?null:M}const N_=function(){const b=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:"").split("/"),M=b[b.length-1].split(/#|\?/)[0];return(/\.[^./\\]*$/.exec(M)||[""])[0]},_p=y=>y.indexOf("image/")===0,$_=y=>{if(y.type&&!y.thumbUrl)return _p(y.type);const b=y.thumbUrl||y.url||"",E=N_(b);return/^data:image\//.test(b)||/(webp|svg|png|gif|jpg|jpeg|jfif|bmp|dpg|ico|heic|heif)$/i.test(E)?!0:!(/^data:/.test(b)||E)},_s=200;function j_(y){return new Promise(b=>{if(!y.type||!_p(y.type)){b("");return}const E=document.createElement("canvas");E.width=_s,E.height=_s,E.style.cssText=`position: fixed; left: 0; top: 0; width: ${_s}px; height: ${_s}px; z-index: 9999; display: none;`,document.body.appendChild(E);const M=E.getContext("2d"),D=new Image;if(D.onload=()=>{const{width:F,height:U}=D;let o=_s,ie=_s,B=0,ce=0;F>U?(ie=U*(_s/F),ce=-(ie-o)/2):(o=F*(_s/U),B=-(o-ie)/2),M.drawImage(D,B,ce,o,ie);const _e=E.toDataURL();document.body.removeChild(E),window.URL.revokeObjectURL(D.src),b(_e)},D.crossOrigin="anonymous",y.type.startsWith("image/svg+xml")){const F=new FileReader;F.onload=()=>{F.result&&(D.src=F.result)},F.readAsDataURL(y)}else if(y.type.startsWith("image/gif")){const F=new FileReader;F.onload=()=>{F.result&&b(F.result)},F.readAsDataURL(y)}else D.src=window.URL.createObjectURL(y)})}var V_={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M505.7 661a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9h-74.1V168c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v338.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.8zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"download",theme:"outlined"};const U_=V_;var q_=function(b,E){return H.createElement(La,Kr({},b,{ref:E,icon:U_}))};const Z_=H.forwardRef(q_),G_=H.forwardRef((y,b)=>{let{prefixCls:E,className:M,style:D,locale:F,listType:U,file:o,items:ie,progress:B,iconRender:ce,actionIconRender:_e,itemRender:de,isImgUrl:be,showPreviewIcon:Me,showRemoveIcon:Be,showDownloadIcon:De,previewIcon:Ne,removeIcon:Qe,downloadIcon:qe,onPreview:Oe,onDownload:Te,onClose:at}=y;var tt,He;const{status:ot}=o,[Fe,ht]=H.useState(ot);H.useEffect(()=>{ot!=="removed"&&ht(ot)},[ot]);const[zt,Lt]=H.useState(!1);H.useEffect(()=>{const Rt=setTimeout(()=>{Lt(!0)},300);return()=>{clearTimeout(Rt)}},[]);const xt=ce(o);let Et=H.createElement("div",{className:`${E}-icon`},xt);if(U==="picture"||U==="picture-card"||U==="picture-circle")if(Fe==="uploading"||!o.thumbUrl&&!o.url){const Rt=di(`${E}-list-item-thumbnail`,{[`${E}-list-item-file`]:Fe!=="uploading"});Et=H.createElement("div",{className:Rt},xt)}else{const Rt=be?.(o)?H.createElement("img",{src:o.thumbUrl||o.url,alt:o.name,className:`${E}-list-item-image`,crossOrigin:o.crossOrigin}):xt,Pi=di(`${E}-list-item-thumbnail`,{[`${E}-list-item-file`]:be&&!be(o)});Et=H.createElement("a",{className:Pi,onClick:bi=>Oe(o,bi),href:o.url||o.thumbUrl,target:"_blank",rel:"noopener noreferrer"},Rt)}const Bt=di(`${E}-list-item`,`${E}-list-item-${Fe}`),ft=typeof o.linkProps=="string"?JSON.parse(o.linkProps):o.linkProps,ni=Be?_e((typeof Qe=="function"?Qe(o):Qe)||H.createElement(gp,null),()=>at(o),E,F.removeFile,!0):null,Ai=De&&Fe==="done"?_e((typeof qe=="function"?qe(o):qe)||H.createElement(Z_,null),()=>Te(o),E,F.downloadFile):null,Xi=U!=="picture-card"&&U!=="picture-circle"&&H.createElement("span",{key:"download-delete",className:di(`${E}-list-item-actions`,{picture:U==="picture"})},Ai,ni),si=di(`${E}-list-item-name`),Xt=o.url?[H.createElement("a",Object.assign({key:"view",target:"_blank",rel:"noopener noreferrer",className:si,title:o.name},ft,{href:o.url,onClick:Rt=>Oe(o,Rt)}),o.name),Xi]:[H.createElement("span",{key:"view",className:si,onClick:Rt=>Oe(o,Rt),title:o.name},o.name),Xi],Ue=Me&&(o.url||o.thumbUrl)?H.createElement("a",{href:o.url||o.thumbUrl,target:"_blank",rel:"noopener noreferrer",onClick:Rt=>Oe(o,Rt),title:F.previewFile},typeof Ne=="function"?Ne(o):Ne||H.createElement(Pm,null)):null,_t=(U==="picture-card"||U==="picture-circle")&&Fe!=="uploading"&&H.createElement("span",{className:`${E}-list-item-actions`},Ue,Fe==="done"&&Ai,ni),{getPrefixCls:Kt}=H.useContext(Da),Mt=Kt(),Yt=H.createElement("div",{className:Bt},Et,Xt,_t,zt&&H.createElement(lp,{motionName:`${Mt}-fade`,visible:Fe==="uploading",motionDeadline:2e3},Rt=>{let{className:Pi}=Rt;const bi="percent"in o?H.createElement(s_,Object.assign({},B,{type:"line",percent:o.percent,"aria-label":o["aria-label"],"aria-labelledby":o["aria-labelledby"]})):null;return H.createElement("div",{className:di(`${E}-list-item-progress`,Pi)},bi)})),gi=o.response&&typeof o.response=="string"?o.response:((tt=o.error)===null||tt===void 0?void 0:tt.statusText)||((He=o.error)===null||He===void 0?void 0:He.message)||F.uploadError,Jt=Fe==="error"?H.createElement(tp,{title:gi,getPopupContainer:Rt=>Rt.parentNode},Yt):Yt;return H.createElement("div",{className:di(`${E}-list-item-container`,M),style:D,ref:b},de?de(Jt,o,ie,{download:Te.bind(null,o),preview:Oe.bind(null,o),remove:at.bind(null,o)}):Jt)}),H_=G_,W_=(y,b)=>{const{listType:E="text",previewFile:M=j_,onPreview:D,onDownload:F,onRemove:U,locale:o,iconRender:ie,isImageUrl:B=$_,prefixCls:ce,items:_e=[],showPreviewIcon:de=!0,showRemoveIcon:be=!0,showDownloadIcon:Me=!1,removeIcon:Be,previewIcon:De,downloadIcon:Ne,progress:Qe={size:[-1,2],showInfo:!1},appendAction:qe,appendActionVisible:Oe=!0,itemRender:Te,disabled:at}=y,tt=zm(),[He,ot]=H.useState(!1);H.useEffect(()=>{E!=="picture"&&E!=="picture-card"&&E!=="picture-circle"||(_e||[]).forEach(Ue=>{typeof document>"u"||typeof window>"u"||!window.FileReader||!window.File||!(Ue.originFileObj instanceof File||Ue.originFileObj instanceof Blob)||Ue.thumbUrl!==void 0||(Ue.thumbUrl="",M&&M(Ue.originFileObj).then(_t=>{Ue.thumbUrl=_t||"",tt()}))})},[E,_e,M]),H.useEffect(()=>{ot(!0)},[]);const Fe=(Ue,_t)=>{if(D)return _t?.preventDefault(),D(Ue)},ht=Ue=>{typeof F=="function"?F(Ue):Ue.url&&window.open(Ue.url)},zt=Ue=>{U?.(Ue)},Lt=Ue=>{if(ie)return ie(Ue,E);const _t=Ue.status==="uploading",Kt=B&&B(Ue)?H.createElement(B_,null):H.createElement(k_,null);let Mt=_t?H.createElement(Mu,null):H.createElement(D_,null);return E==="picture"?Mt=_t?H.createElement(Mu,null):Kt:(E==="picture-card"||E==="picture-circle")&&(Mt=_t?o.uploading:Kt),Mt},xt=(Ue,_t,Kt,Mt,Yt)=>{const gi={type:"text",size:"small",title:Mt,onClick:Jt=>{_t(),Cd(Ue)&&Ue.props.onClick&&Ue.props.onClick(Jt)},className:`${Kt}-list-item-action`};if(Yt&&(gi.disabled=at),Cd(Ue)){const Jt=Sd(Ue,Object.assign(Object.assign({},Ue.props),{onClick:()=>{}}));return H.createElement(Pa,Object.assign({},gi,{icon:Jt}))}return H.createElement(Pa,Object.assign({},gi),H.createElement("span",null,Ue))};H.useImperativeHandle(b,()=>({handlePreview:Fe,handleDownload:ht}));const{getPrefixCls:Et}=H.useContext(Da),Bt=Et("upload",ce),ft=Et(),ni=di(`${Bt}-list`,`${Bt}-list-${E}`),Ai=Xr(_e.map(Ue=>({key:Ue.uid,file:Ue})));let si={motionDeadline:2e3,motionName:`${Bt}-${E==="picture-card"||E==="picture-circle"?"animate-inline":"animate"}`,keys:Ai,motionAppear:He};const Xt=H.useMemo(()=>{const Ue=Object.assign({},Dm(ft));return delete Ue.onAppearEnd,delete Ue.onEnterEnd,delete Ue.onLeaveEnd,Ue},[ft]);return E!=="picture-card"&&E!=="picture-circle"&&(si=Object.assign(Object.assign({},Xt),si)),H.createElement("div",{className:ni},H.createElement(Kd,Object.assign({},si,{component:!1}),Ue=>{let{key:_t,file:Kt,className:Mt,style:Yt}=Ue;return H.createElement(H_,{key:_t,locale:o,prefixCls:Bt,className:Mt,style:Yt,file:Kt,items:_e,progress:Qe,listType:E,isImgUrl:B,showPreviewIcon:de,showRemoveIcon:be,showDownloadIcon:Me,removeIcon:Be,previewIcon:De,downloadIcon:Ne,iconRender:Lt,actionIconRender:xt,itemRender:Te,onPreview:Fe,onDownload:ht,onClose:zt})}),qe&&H.createElement(lp,Object.assign({},si,{visible:Oe,forceRender:!0}),Ue=>{let{className:_t,style:Kt}=Ue;return Sd(qe,Mt=>({className:di(Mt.className,_t),style:Object.assign(Object.assign(Object.assign({},Kt),{pointerEvents:_t?"none":void 0}),Mt.style)}))}))},X_=H.forwardRef(W_),K_=X_;var Y_=function(y,b,E,M){function D(F){return F instanceof E?F:new E(function(U){U(F)})}return new(E||(E=Promise))(function(F,U){function o(ce){try{B(M.next(ce))}catch(_e){U(_e)}}function ie(ce){try{B(M.throw(ce))}catch(_e){U(_e)}}function B(ce){ce.done?F(ce.value):D(ce.value).then(o,ie)}B((M=M.apply(y,b||[])).next())})};const Uo=`__LIST_IGNORE_${Date.now()}__`,J_=(y,b)=>{const{fileList:E,defaultFileList:M,onRemove:D,showUploadList:F=!0,listType:U="text",onPreview:o,onDownload:ie,onChange:B,onDrop:ce,previewFile:_e,disabled:de,locale:be,iconRender:Me,isImageUrl:Be,progress:De,prefixCls:Ne,className:Qe,type:qe="select",children:Oe,style:Te,itemRender:at,maxCount:tt,data:He={},multiple:ot=!1,hasControlInside:Fe=!0,action:ht="",accept:zt="",supportServerRender:Lt=!0,rootClassName:xt}=y,Et=H.useContext(Lm),Bt=de??Et,[ft,ni]=Rm(M||[],{value:E,postState:mt=>mt??[]}),[Ai,Xi]=H.useState("drop"),si=H.useRef(null);H.useMemo(()=>{const mt=Date.now();(E||[]).forEach((dt,Ut)=>{!dt.uid&&!Object.isFrozen(dt)&&(dt.uid=`__AUTO__${mt}_${Ut}__`)})},[E]);const Xt=(mt,dt,Ut)=>{let bt=Xr(dt),Ce=!1;tt===1?bt=bt.slice(-1):tt&&(Ce=bt.length>tt,bt=bt.slice(0,tt)),qo.flushSync(()=>{ni(bt)});const nt={file:mt,fileList:bt};Ut&&(nt.event=Ut),(!Ce||bt.some(lt=>lt.uid===mt.uid))&&qo.flushSync(()=>{B?.(nt)})},Ue=(mt,dt)=>Y_(void 0,void 0,void 0,function*(){const{beforeUpload:Ut,transformFile:bt}=y;let Ce=mt;if(Ut){const nt=yield Ut(mt,dt);if(nt===!1)return!1;if(delete mt[Uo],nt===Uo)return Object.defineProperty(mt,Uo,{value:!0,configurable:!0}),!1;typeof nt=="object"&&nt&&(Ce=nt)}return bt&&(Ce=yield bt(Ce)),Ce}),_t=mt=>{const dt=mt.filter(Ce=>!Ce.file[Uo]);if(!dt.length)return;const Ut=dt.map(Ce=>ic(Ce.file));let bt=Xr(ft);Ut.forEach(Ce=>{bt=rc(Ce,bt)}),Ut.forEach((Ce,nt)=>{let lt=Ce;if(dt[nt].parsedFile)Ce.status="uploading";else{const{originFileObj:_i}=Ce;let ji;try{ji=new File([_i],_i.name,{type:_i.type})}catch{ji=new Blob([_i],{type:_i.type}),ji.name=_i.name,ji.lastModifiedDate=new Date,ji.lastModified=new Date().getTime()}ji.uid=Ce.uid,lt=ji}Xt(lt,bt)})},Kt=(mt,dt,Ut)=>{try{typeof mt=="string"&&(mt=JSON.parse(mt))}catch{}if(!Tu(dt,ft))return;const bt=ic(dt);bt.status="done",bt.percent=100,bt.response=mt,bt.xhr=Ut;const Ce=rc(bt,ft);Xt(bt,Ce)},Mt=(mt,dt)=>{if(!Tu(dt,ft))return;const Ut=ic(dt);Ut.status="uploading",Ut.percent=mt.percent;const bt=rc(Ut,ft);Xt(Ut,bt,mt)},Yt=(mt,dt,Ut)=>{if(!Tu(Ut,ft))return;const bt=ic(Ut);bt.error=mt,bt.response=dt,bt.status="error";const Ce=rc(bt,ft);Xt(bt,Ce)},gi=mt=>{let dt;Promise.resolve(typeof D=="function"?D(mt):D).then(Ut=>{var bt;if(Ut===!1)return;const Ce=O_(mt,ft);Ce&&(dt=Object.assign(Object.assign({},mt),{status:"removed"}),ft?.forEach(nt=>{const lt=dt.uid!==void 0?"uid":"name";nt[lt]===dt[lt]&&!Object.isFrozen(nt)&&(nt.status="removed")}),(bt=si.current)===null||bt===void 0||bt.abort(dt),Xt(dt,Ce))})},Jt=mt=>{Xi(mt.type),mt.type==="drop"&&ce?.(mt)};H.useImperativeHandle(b,()=>({onBatchStart:_t,onSuccess:Kt,onProgress:Mt,onError:Yt,fileList:ft,upload:si.current}));const{getPrefixCls:Rt,direction:Pi,upload:bi}=H.useContext(Da),Wt=Rt("upload",Ne),Ti=Object.assign(Object.assign({onBatchStart:_t,onError:Yt,onProgress:Mt,onSuccess:Kt},y),{data:He,multiple:ot,action:ht,accept:zt,supportServerRender:Lt,prefixCls:Wt,disabled:Bt,beforeUpload:Ue,onChange:void 0,hasControlInside:Fe});delete Ti.className,delete Ti.style,(!Oe||Bt)&&delete Ti.id;const rr=`${Wt}-wrapper`,[pr,nr,fr]=T_(Wt,rr),[Sr]=Fm("Upload",Bm.Upload),{showRemoveIcon:fe,showPreviewIcon:Ii,showDownloadIcon:$i,removeIcon:jt,previewIcon:kt,downloadIcon:Ui}=typeof F=="boolean"?{}:F,Ki=typeof fe>"u"?!Bt:!!fe,sr=(mt,dt)=>F?H.createElement(K_,{prefixCls:Wt,listType:U,items:ft,previewFile:_e,onPreview:o,onDownload:ie,onRemove:gi,showRemoveIcon:Ki,showPreviewIcon:Ii,showDownloadIcon:$i,removeIcon:jt,previewIcon:kt,downloadIcon:Ui,iconRender:Me,locale:Object.assign(Object.assign({},Sr),be),isImageUrl:Be,progress:De,appendAction:mt,appendActionVisible:dt,itemRender:at,disabled:Bt}):mt,vn=di(rr,Qe,xt,nr,fr,bi?.className,{[`${Wt}-rtl`]:Pi==="rtl",[`${Wt}-picture-card-wrapper`]:U==="picture-card",[`${Wt}-picture-circle-wrapper`]:U==="picture-circle"}),bn=Object.assign(Object.assign({},bi?.style),Te);if(qe==="drag"){const mt=di(nr,Wt,`${Wt}-drag`,{[`${Wt}-drag-uploading`]:ft.some(dt=>dt.status==="uploading"),[`${Wt}-drag-hover`]:Ai==="dragover",[`${Wt}-disabled`]:Bt,[`${Wt}-rtl`]:Pi==="rtl"});return pr(H.createElement("span",{className:vn},H.createElement("div",{className:mt,style:bn,onDrop:Jt,onDragOver:Jt,onDragLeave:Jt},H.createElement(zu,Object.assign({},Ti,{ref:si,className:`${Wt}-btn`}),H.createElement("div",{className:`${Wt}-drag-container`},Oe))),sr()))}const Yr=di(Wt,`${Wt}-select`,{[`${Wt}-disabled`]:Bt}),Ae=(mt=>H.createElement("div",{className:Yr,style:mt},H.createElement(zu,Object.assign({},Ti,{ref:si}))))(Oe?void 0:{display:"none"});return pr(U==="picture-card"||U==="picture-circle"?H.createElement("span",{className:vn},sr(Ae,!!Oe)):H.createElement("span",{className:vn},Ae,sr()))},Q_=H.forwardRef(J_),yp=Q_;var ey=function(y,b){var E={};for(var M in y)Object.prototype.hasOwnProperty.call(y,M)&&b.indexOf(M)<0&&(E[M]=y[M]);if(y!=null&&typeof Object.getOwnPropertySymbols=="function")for(var D=0,M=Object.getOwnPropertySymbols(y);D<M.length;D++)b.indexOf(M[D])<0&&Object.prototype.propertyIsEnumerable.call(y,M[D])&&(E[M[D]]=y[M[D]]);return E};const ty=H.forwardRef((y,b)=>{var{style:E,height:M,hasControlInside:D=!1}=y,F=ey(y,["style","height","hasControlInside"]);return H.createElement(yp,Object.assign({ref:b,hasControlInside:D},F,{type:"drag",style:Object.assign(Object.assign({},E),{height:M})}))}),iy=ty,Nu=yp;Nu.Dragger=iy;Nu.LIST_IGNORE=Uo;const ry=Nu;var ny={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M885.2 446.3l-.2-.8-112.2-285.1c-5-16.1-19.9-27.2-36.8-27.2H281.2c-17 0-32.1 11.3-36.9 27.6L139.4 443l-.3.7-.2.8c-1.3 4.9-1.7 9.9-1 14.8-.1 1.6-.2 3.2-.2 4.8V830a60.9 60.9 0 0060.8 60.8h627.2c33.5 0 60.8-27.3 60.9-60.8V464.1c0-1.3 0-2.6-.1-3.7.4-4.9 0-9.6-1.3-14.1zm-295.8-43l-.3 15.7c-.8 44.9-31.8 75.1-77.1 75.1-22.1 0-41.1-7.1-54.8-20.6S436 441.2 435.6 419l-.3-15.7H229.5L309 210h399.2l81.7 193.3H589.4zm-375 76.8h157.3c24.3 57.1 76 90.8 140.4 90.8 33.7 0 65-9.4 90.3-27.2 22.2-15.6 39.5-37.4 50.7-63.6h156.5V814H214.4V480.1z"}}]},name:"inbox",theme:"outlined"};const sy=ny;var ay=function(b,E){return H.createElement(La,Kr({},b,{ref:E,icon:sy}))};const oy=H.forwardRef(ay);function Iu({children:y,className:b}){return ge.jsx(qs,{gutter:38,className:"mt-3 first:mt-0 "+b,children:y})}const ly=[{label:"Hoạt động",value:"Active"},{label:"Khóa",value:"Lock"}],cy=[{label:"Thêm khách hàng",value:"add"},{label:"Chọn khách hàng",value:"Choose"},{label:"Import khách hàng",value:"Import"}],$u=[{title:"Mã khách hàng",dataIndex:"customer_code",key:"customercode"},{title:"Tên khách hàng",dataIndex:"customer_name",key:"customername"}],xp=[{title:"Địa chỉ",dataIndex:"display_address",key:"display_address"},{title:"Số điện thoại",dataIndex:"phone_number",key:"phone_number"}],vp=[{customer_id:"431456",customer_name:"Chu Văn A",display_address:"CT1 Chung cư bộ công an",phone_number:"0123456789",frequency:"1;2;3;4;5"},{customer_id:"4314s56",customer_name:"Chu Văn A",display_address:"CT1 Chung cư bộ công an",phone_number:"0123456789",frequency:""}],uy=[{label:"1",value:"1"},{label:"2",value:"2"},{label:"3",value:"3"},{label:"4",value:"4"},{label:"5",value:"5"}],hy={customer_type:"Loại khách hàng",customer_group:"Nhóm khách hàng",city:"Tỉnh/Thành phố",district:"Quận/huyện",ward:"Phường/xã"},dy=[{label:"Thứ 2",value:"Thứ 2"},{label:"Thứ 3",value:"Thứ 3"},{label:"Thứ 4",value:"Thứ 4"},{label:"Thứ 5",value:"Thứ 5"},{label:"Thứ 6",value:"Thứ 6"},{label:"Thứ 7",value:"Thứ 7"},{label:"Chủ nhật",value:"Chủ nhật"}];let nc;const py=(y,b)=>{console.log(y),nc&&(clearTimeout(nc),nc=null),y?nc=setTimeout(()=>{b(y)},300):b("")};function fy(){const[y,b]=H.useState(""),[E,M]=H.useState([]),[D,F]=H.useState([]);H.useEffect(()=>{(async()=>{let o=await Dn.get("/api/method/mbw_dms.api.router.get_team_sale");M(o.result.map(ie=>({label:ie,value:ie})))})()},[]),H.useEffect(()=>{(async()=>{let o=await Dn.get("/api/method/frappe.desk.search.search_link",{params:{txt:y,doctype:"Employee",ignore_user_permissions:0,reference_doctype:"Attendance",query:"erpnext.controllers.queries.employee_query"}}),{results:ie}=o;F(ie.map(B=>({value:B.value,label:B.description})))})()},[y]),console.log("listEmployees",D);const U=o=>{py(o,b)};return ge.jsxs("div",{className:"p-4 pt-[43px] pb-[58px]",children:[ge.jsxs(Iu,{children:[ge.jsx(Lr,{span:12,children:ge.jsx(Ur,{label:"Mã tuyến",name:"channel_code",required:!0,children:ge.jsx(sc,{})})}),ge.jsx(Lr,{span:12,children:ge.jsx(Ur,{label:"Tên tuyến",name:"channel_name",required:!0,children:ge.jsx(sc,{})})})]}),ge.jsxs(Iu,{children:[ge.jsx(Lr,{span:12,children:ge.jsx(Ur,{label:"Team sale",name:"team_sale",required:!0,children:ge.jsx(xn,{showSearch:!0,options:E,defaultActiveFirstOption:!1})})}),ge.jsx(Lr,{span:12,children:ge.jsx(Ur,{label:"Nhân viên",name:"employee",required:!0,children:ge.jsx(xn,{showSearch:!0,notFoundContent:null,onSearch:U,options:D})})})]}),ge.jsxs(Iu,{children:[ge.jsx(Lr,{span:12,children:ge.jsx(Ur,{label:"Ngày đi tuyến",name:"travel_date",required:!0,children:ge.jsx(xn,{options:dy})})}),ge.jsx(Lr,{span:12,children:ge.jsx(Ur,{label:"Trạng thái",name:"status",children:ge.jsx(xn,{options:ly,defaultValue:"Active"})})})]})]})}const my=({size:y=20})=>ge.jsx("svg",{width:y,height:y,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:ge.jsx("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M11.0267 1.13334C11.5534 0.501676 12.5792 0.933342 12.4959 1.75168L11.9076 7.50001H16.6667C16.8251 7.50007 16.9801 7.54524 17.1137 7.63024C17.2473 7.71523 17.3539 7.83653 17.4211 7.97993C17.4882 8.12333 17.5132 8.2829 17.4929 8.43994C17.4726 8.59698 17.4081 8.74501 17.3067 8.86668L8.97339 18.8667C8.44672 19.4983 7.42089 19.0667 7.50422 18.2483L8.09255 12.5H3.33339C3.17504 12.4999 3.01999 12.4548 2.88639 12.3698C2.75279 12.2848 2.64617 12.1635 2.57902 12.0201C2.51187 11.8767 2.48696 11.7171 2.50721 11.5601C2.52747 11.403 2.59205 11.255 2.69339 11.1333L11.0267 1.13334Z",fill:"currentColor"})}),gy=({size:y=20})=>ge.jsxs("svg",{width:y,height:y,viewBox:"0 0 28 28",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[ge.jsx("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M9.83847 8.58794C10.1411 8.46187 10.4827 8.4689 10.7798 8.60732L15.0763 10.6088C15.6604 10.8809 15.9133 11.5749 15.6412 12.159C15.3691 12.7431 14.6751 12.996 14.091 12.7239L11.4888 11.5117L11.653 20.2421L15.7503 22.1045V15.7497C15.7503 15.1053 16.2727 14.583 16.917 14.583C17.5613 14.583 18.0837 15.1053 18.0837 15.7497V22.1663L22.7503 20.2219V13.4163C22.7503 12.772 23.2727 12.2497 23.917 12.2497C24.5613 12.2497 25.0837 12.772 25.0837 13.4163V20.9997C25.0837 21.4707 24.8005 21.8955 24.3657 22.0766L17.3657 24.9933C17.0666 25.1179 16.7292 25.1125 16.4342 24.9784L10.5003 22.2812L4.56643 24.9784C4.20532 25.1426 3.78555 25.112 3.45204 24.8972C3.11854 24.6825 2.91699 24.313 2.91699 23.9163V12.2497C2.91699 11.7787 3.20019 11.3539 3.63494 11.1728L9.83847 8.58794ZM9.31945 20.2549L9.15297 11.4013L5.25033 13.0275V22.1045L9.31945 20.2549Z",fill:"currentColor"}),ge.jsx("path",{d:"M19.8337 8.61425C20.478 8.61425 21.0003 8.09192 21.0003 7.44759C21.0003 6.80326 20.478 6.28092 19.8337 6.28092C19.1893 6.28092 18.667 6.80326 18.667 7.44759C18.667 8.09192 19.1893 8.61425 19.8337 8.61425Z",fill:"currentColor"}),ge.jsx("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M19.8337 2.33301C17.2197 2.33301 15.167 4.52385 15.167 7.1293C15.167 7.85019 15.4274 8.59094 15.7195 9.21916C16.0229 9.8717 16.4198 10.5259 16.8094 11.1056C17.5898 12.2664 18.4067 13.2245 18.579 13.4238L18.5825 13.4278C18.89 13.7803 19.3411 13.9997 19.8337 13.9997C20.3262 13.9997 20.7773 13.7803 21.0848 13.4278L21.0883 13.4238C21.2606 13.2245 22.0776 12.2664 22.8579 11.1056C23.2476 10.5259 23.6444 9.8717 23.9478 9.21916C24.2399 8.59094 24.5003 7.85019 24.5003 7.1293C24.5003 4.52385 22.4476 2.33301 19.8337 2.33301ZM17.5003 7.1293C17.5003 5.7318 18.5876 4.66634 19.8337 4.66634C21.0797 4.66634 22.167 5.7318 22.167 7.1293C22.167 7.33968 22.0764 7.70972 21.832 8.23544C21.5989 8.73683 21.2738 9.2797 20.9214 9.80382C20.5368 10.376 20.1392 10.8972 19.8337 11.2802C19.5281 10.8972 19.1305 10.376 18.7459 9.80382C18.3936 9.2797 18.0684 8.73683 17.8353 8.23544C17.5909 7.70972 17.5003 7.33968 17.5003 7.1293Z",fill:"currentColor"})]}),_y=({size:y=20,fill:b="#1877F2"})=>ge.jsx("svg",{width:y,height:y,viewBox:"0 0 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:ge.jsx("path",{d:"M23.1875 5.25H10.9375C10.6094 5.25 10.3314 5.36393 10.1035 5.5918C9.87565 5.81966 9.76172 6.09766 9.76172 6.42578C9.76172 6.73568 9.87565 7.00456 10.1035 7.23242C10.3314 7.46029 10.6094 7.57422 10.9375 7.57422H23.1875C23.4974 7.57422 23.7663 7.46029 23.9941 7.23242C24.222 7.00456 24.3359 6.73568 24.3359 6.42578C24.3359 6.09766 24.222 5.81966 23.9941 5.5918C23.7663 5.36393 23.4974 5.25 23.1875 5.25ZM23.1875 12.25H10.9375C10.6094 12.25 10.3314 12.3639 10.1035 12.5918C9.87565 12.8197 9.76172 13.0977 9.76172 13.4258C9.76172 13.7357 9.87565 14.0046 10.1035 14.2324C10.3314 14.4603 10.6094 14.5742 10.9375 14.5742H23.1875C23.4974 14.5742 23.7663 14.4603 23.9941 14.2324C24.222 14.0046 24.3359 13.7357 24.3359 13.4258C24.3359 13.0977 24.222 12.8197 23.9941 12.5918C23.7663 12.3639 23.4974 12.25 23.1875 12.25ZM23.1875 19.25H10.9375C10.6094 19.25 10.3314 19.3639 10.1035 19.5918C9.87565 19.8197 9.76172 20.0977 9.76172 20.4258C9.76172 20.7357 9.87565 21.0046 10.1035 21.2324C10.3314 21.4603 10.6094 21.5742 10.9375 21.5742H23.1875C23.4974 21.5742 23.7663 21.4603 23.9941 21.2324C24.222 21.0046 24.3359 20.7357 24.3359 20.4258C24.3359 20.0977 24.222 19.8197 23.9941 19.5918C23.7663 19.3639 23.4974 19.25 23.1875 19.25ZM5.25 18.6758C5.72396 18.6758 6.13411 18.8444 6.48047 19.1816C6.82682 19.5189 7 19.9336 7 20.4258C7 20.8997 6.82682 21.3099 6.48047 21.6562C6.13411 22.0026 5.72396 22.1758 5.25 22.1758C4.75781 22.1758 4.3431 22.0026 4.00586 21.6562C3.66862 21.3099 3.5 20.8997 3.5 20.4258C3.5 19.9336 3.66862 19.5189 4.00586 19.1816C4.3431 18.8444 4.75781 18.6758 5.25 18.6758ZM5.25 15.1758C4.75781 15.1758 4.3431 15.0026 4.00586 14.6562C3.66862 14.3099 3.5 13.8997 3.5 13.4258C3.5 12.9336 3.66862 12.5189 4.00586 12.1816C4.3431 11.8444 4.75781 11.6758 5.25 11.6758C5.72396 11.6758 6.13411 11.8444 6.48047 12.1816C6.82682 12.5189 7 12.9336 7 13.4258C7 13.8997 6.82682 14.3099 6.48047 14.6562C6.13411 15.0026 5.72396 15.1758 5.25 15.1758ZM5.25 8.17578C4.75781 8.17578 4.3431 8.0026 4.00586 7.65625C3.66862 7.3099 3.5 6.89974 3.5 6.42578C3.5 5.93359 3.66862 5.51888 4.00586 5.18164C4.3431 4.8444 4.75781 4.67578 5.25 4.67578C5.72396 4.67578 6.13411 4.8444 6.48047 5.18164C6.82682 5.51888 7 5.93359 7 6.42578C7 6.89974 6.82682 7.3099 6.48047 7.65625C6.13411 8.0026 5.72396 8.17578 5.25 8.17578Z",fill:"currentColor"})});function yy({data:y,handleData:b}){const E=[{title:"Stt",dataIndex:"stt",key:"stt",render:(M,D,F)=>F+1},...$u,...xp,{title:"Tần suất",dataIndex:"frequency",key:"frequency",render:(M,D)=>ge.jsx(xn,{mode:"multiple",options:uy,style:{width:"100%"},placeholder:"Chọn tần suất",onChange:F=>{b(U=>U.map(o=>(o.customer_id==D.customer_id&&(o.frequency=F.toString().replaceAll(",",";")),o)))},defaultValue:M?M.split(";"):[]})},{title:"Hành động",dataIndex:"",key:"action",render:(M,D)=>ge.jsx("div",{className:"flex justify-center",onClick:()=>{b(F=>[...F.filter(U=>U.customer_id!=D.customer_id)])},children:ge.jsx(gp,{})})}];return ge.jsx("div",{className:"p-4",children:ge.jsx(Bu,{columns:E,dataSource:y,pagination:!1})})}const xy=H.createContext(null);function vy(y,b){const E=Array.isArray(y)?y[0]:y?y.x:0,M=Array.isArray(y)?y[1]:y?y.y:0,D=Array.isArray(b)?b[0]:b?b.x:0,F=Array.isArray(b)?b[1]:b?b.y:0;return E===D&&M===F}function zn(y,b){if(y===b)return!0;if(!y||!b)return!1;if(Array.isArray(y)){if(!Array.isArray(b)||y.length!==b.length)return!1;for(let E=0;E<y.length;E++)if(!zn(y[E],b[E]))return!1;return!0}else if(Array.isArray(b))return!1;if(typeof y=="object"&&typeof b=="object"){const E=Object.keys(y),M=Object.keys(b);if(E.length!==M.length)return!1;for(const D of E)if(!b.hasOwnProperty(D)||!zn(y[D],b[D]))return!1;return!0}return!1}function by(y){const b=y.clone();return b.pixelsToGLUnits=y.pixelsToGLUnits,b}function Nd(y,b){if(!y.getProjection)return;const E=y.getProjection(),M=b.getProjection();zn(E,M)||b.setProjection(E)}function $d(y){return{longitude:y.center.lng,latitude:y.center.lat,zoom:y.zoom,pitch:y.pitch,bearing:y.bearing,padding:y.padding}}function jd(y,b){const E=b.viewState||b;let M=!1;if("longitude"in E&&"latitude"in E){const D=y.center;y.center=new D.constructor(E.longitude,E.latitude),M=M||D!==y.center}if("zoom"in E){const D=y.zoom;y.zoom=E.zoom,M=M||D!==y.zoom}if("bearing"in E){const D=y.bearing;y.bearing=E.bearing,M=M||D!==y.bearing}if("pitch"in E){const D=y.pitch;y.pitch=E.pitch,M=M||D!==y.pitch}return E.padding&&!y.isPaddingEqual(E.padding)&&(M=!0,y.padding=E.padding),M}const wy=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Vd(y){if(!y)return null;if(typeof y=="string"||("toJS"in y&&(y=y.toJS()),!y.layers))return y;const b={};for(const M of y.layers)b[M.id]=M;const E=y.layers.map(M=>{let D=null;"interactive"in M&&(D=Object.assign({},M),delete D.interactive);const F=b[M.ref];if(F){D=D||Object.assign({},M),delete D.ref;for(const U of wy)U in F&&(D[U]=F[U])}return D||M});return{...y,layers:E}}var Ud={};const qd={version:8,sources:{},layers:[]},Zd={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},Eu={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},Gd={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},Sy=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],Cy=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class za{constructor(b,E,M){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=D=>{const F=this.props[Gd[D.type]];F?F(D):D.type==="error"&&console.error(D.error)},this._onPointerEvent=D=>{(D.type==="mousemove"||D.type==="mouseout")&&this._updateHover(D);const F=this.props[Zd[D.type]];F&&(this.props.interactiveLayerIds&&D.type!=="mouseover"&&D.type!=="mouseout"&&(D.features=this._hoveredFeatures||this._queryRenderedFeatures(D.point)),F(D),delete D.features)},this._onCameraEvent=D=>{if(!this._internalUpdate){const F=this.props[Eu[D.type]];F&&F(D)}D.type in this._deferredEvents&&(this._deferredEvents[D.type]=!1)},this._MapClass=b,this.props=E,this._initialize(M)}get map(){return this._map}get transform(){return this._renderTransform}setProps(b){const E=this.props;this.props=b;const M=this._updateSettings(b,E);M&&this._createShadowTransform(this._map);const D=this._updateSize(b),F=this._updateViewState(b,!0);this._updateStyle(b,E),this._updateStyleComponents(b,E),this._updateHandlers(b,E),(M||D||F&&!this._map.isMoving())&&this.redraw()}static reuse(b,E){const M=za.savedMaps.pop();if(!M)return null;const D=M.map,F=D.getContainer();for(E.className=F.className;F.childNodes.length>0;)E.appendChild(F.childNodes[0]);D._container=E;const U=D._resizeObserver;U&&(U.disconnect(),U.observe(E)),M.setProps({...b,styleDiffing:!1}),D.resize();const{initialViewState:o}=b;return o&&(o.bounds?D.fitBounds(o.bounds,{...o.fitBoundsOptions,duration:0}):M._updateViewState(o,!1)),D.isStyleLoaded()?D.fire("load"):D.once("styledata",()=>D.fire("load")),D._update(),M}_initialize(b){const{props:E}=this,{mapStyle:M=qd}=E,D={...E,...E.initialViewState,accessToken:E.mapboxAccessToken||Ty()||null,container:b,style:Vd(M)},F=D.initialViewState||D.viewState||D;if(Object.assign(D,{center:[F.longitude||0,F.latitude||0],zoom:F.zoom||0,pitch:F.pitch||0,bearing:F.bearing||0}),E.gl){const ce=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=ce,E.gl)}const U=new this._MapClass(D);F.padding&&U.setPadding(F.padding),E.cursor&&(U.getCanvas().style.cursor=E.cursor),this._createShadowTransform(U);const o=U._render;U._render=ce=>{this._inRender=!0,o.call(U,ce),this._inRender=!1};const ie=U._renderTaskQueue.run;U._renderTaskQueue.run=ce=>{ie.call(U._renderTaskQueue,ce),this._onBeforeRepaint()},U.on("render",()=>this._onAfterRepaint());const B=U.fire;U.fire=this._fireEvent.bind(this,B),U.on("resize",()=>{this._renderTransform.resize(U.transform.width,U.transform.height)}),U.on("styledata",()=>{this._updateStyleComponents(this.props,{}),Nd(U.transform,this._renderTransform)}),U.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const ce in Zd)U.on(ce,this._onPointerEvent);for(const ce in Eu)U.on(ce,this._onCameraEvent);for(const ce in Gd)U.on(ce,this._onEvent);this._map=U}recycle(){const E=this.map.getContainer().querySelector("[mapboxgl-children]");E?.remove(),za.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const b=this._map;!this._inRender&&b.style&&(b._frame&&(b._frame.cancel(),b._frame=null),b._render())}_createShadowTransform(b){const E=by(b.transform);b.painter.transform=E,this._renderTransform=E}_updateSize(b){const{viewState:E}=b;if(E){const M=this._map;if(E.width!==M.transform.width||E.height!==M.transform.height)return M.resize(),!0}return!1}_updateViewState(b,E){if(this._internalUpdate)return!1;const M=this._map,D=this._renderTransform,{zoom:F,pitch:U,bearing:o}=D,ie=M.isMoving();ie&&(D.cameraElevationReference="sea");const B=jd(D,{...$d(M.transform),...b});if(ie&&(D.cameraElevationReference="ground"),B&&E){const ce=this._deferredEvents;ce.move=!0,ce.zoom||(ce.zoom=F!==D.zoom),ce.rotate||(ce.rotate=o!==D.bearing),ce.pitch||(ce.pitch=U!==D.pitch)}return ie||jd(M.transform,b),B}_updateSettings(b,E){const M=this._map;let D=!1;for(const F of Sy)if(F in b&&!zn(b[F],E[F])){D=!0;const U=M[`set${F[0].toUpperCase()}${F.slice(1)}`];U?.call(M,b[F])}return D}_updateStyle(b,E){if(b.cursor!==E.cursor&&(this._map.getCanvas().style.cursor=b.cursor||""),b.mapStyle!==E.mapStyle){const{mapStyle:M=qd,styleDiffing:D=!0}=b,F={diff:D};return"localIdeographFontFamily"in b&&(F.localIdeographFontFamily=b.localIdeographFontFamily),this._map.setStyle(Vd(M),F),!0}return!1}_updateStyleComponents(b,E){const M=this._map;let D=!1;return M.isStyleLoaded()&&("light"in b&&M.setLight&&!zn(b.light,E.light)&&(D=!0,M.setLight(b.light)),"fog"in b&&M.setFog&&!zn(b.fog,E.fog)&&(D=!0,M.setFog(b.fog)),"terrain"in b&&M.setTerrain&&!zn(b.terrain,E.terrain)&&(!b.terrain||M.getSource(b.terrain.source))&&(D=!0,M.setTerrain(b.terrain))),D}_updateHandlers(b,E){var M,D;const F=this._map;let U=!1;for(const o of Cy){const ie=(M=b[o])!==null&&M!==void 0?M:!0,B=(D=E[o])!==null&&D!==void 0?D:!0;zn(ie,B)||(U=!0,ie?F[o].enable(ie):F[o].disable())}return U}_queryRenderedFeatures(b){const E=this._map,M=E.transform,{interactiveLayerIds:D=[]}=this.props;try{return E.transform=this._renderTransform,E.queryRenderedFeatures(b,{layers:D.filter(E.getLayer.bind(E))})}catch{return[]}finally{E.transform=M}}_updateHover(b){var E;const{props:M}=this;if(M.interactiveLayerIds&&(M.onMouseMove||M.onMouseEnter||M.onMouseLeave)){const F=b.type,U=((E=this._hoveredFeatures)===null||E===void 0?void 0:E.length)>0,o=this._queryRenderedFeatures(b.point),ie=o.length>0;!ie&&U&&(b.type="mouseleave",this._onPointerEvent(b)),this._hoveredFeatures=o,ie&&!U&&(b.type="mouseenter",this._onPointerEvent(b)),b.type=F}else this._hoveredFeatures=null}_fireEvent(b,E,M){const D=this._map,F=D.transform,U=typeof E=="string"?E:E.type;return U==="move"&&this._updateViewState(this.props,!1),U in Eu&&(typeof E=="object"&&(E.viewState=$d(F)),this._map.isMoving())?(D.transform=this._renderTransform,b.call(D,E,M),D.transform=F,D):(b.call(D,E,M),D)}_onBeforeRepaint(){const b=this._map;this._internalUpdate=!0;for(const M in this._deferredEvents)this._deferredEvents[M]&&b.fire(M);this._internalUpdate=!1;const E=this._map.transform;b.transform=this._renderTransform,this._onAfterRepaint=()=>{Nd(this._renderTransform,E),b.transform=E}}}za.savedMaps=[];function Ty(){let y=null;if(typeof location<"u"){const b=/access_token=([^&\/]*)/.exec(location.search);y=b&&b[1]}try{y=y||Ud.MapboxAccessToken}catch{}try{y=y||Ud.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return y}const Iy=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function Ey(y){if(!y)return null;const b=y.map,E={getMap:()=>b,getCenter:()=>y.transform.center,getZoom:()=>y.transform.zoom,getBearing:()=>y.transform.bearing,getPitch:()=>y.transform.pitch,getPadding:()=>y.transform.padding,getBounds:()=>y.transform.getBounds(),project:M=>{const D=b.transform;b.transform=y.transform;const F=b.project(M);return b.transform=D,F},unproject:M=>{const D=b.transform;b.transform=y.transform;const F=b.unproject(M);return b.transform=D,F},queryTerrainElevation:(M,D)=>{const F=b.transform;b.transform=y.transform;const U=b.queryTerrainElevation(M,D);return b.transform=F,U},queryRenderedFeatures:(M,D)=>{const F=b.transform;b.transform=y.transform;const U=b.queryRenderedFeatures(M,D);return b.transform=F,U}};for(const M of My(b))!(M in E)&&!Iy.includes(M)&&(E[M]=b[M].bind(b));return E}function My(y){const b=new Set;let E=y;for(;E;){for(const M of Object.getOwnPropertyNames(E))M[0]!=="_"&&typeof y[M]=="function"&&M!=="fire"&&M!=="setEventedParent"&&b.add(M);E=Object.getPrototypeOf(E)}return Array.from(b)}const ky=typeof document<"u"?H.useLayoutEffect:H.useEffect,Ay=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function Py(y,b){for(const M of Ay)M in b&&(y[M]=b[M]);const{RTLTextPlugin:E="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=b;E&&y.getRTLTextPluginStatus&&y.getRTLTextPluginStatus()==="unavailable"&&y.setRTLTextPlugin(E,M=>{M&&console.error(M)},!0)}const Ho=H.createContext(null);function zy(y,b,E){const M=H.useContext(xy),[D,F]=H.useState(null),U=H.useRef(),{current:o}=H.useRef({mapLib:null,map:null});H.useEffect(()=>{const ce=y.mapLib;let _e=!0,de;return Promise.resolve(ce||E).then(be=>{if(!_e)return;if(!be)throw new Error("Invalid mapLib");const Me="Map"in be?be:be.default;if(!Me.Map)throw new Error("Invalid mapLib");if(Py(Me,y),!Me.supported||Me.supported(y))y.reuseMaps&&(de=za.reuse(y,U.current)),de||(de=new za(Me.Map,y,U.current)),o.map=Ey(de),o.mapLib=Me,F(de),M?.onMapMount(o.map,y.id);else throw new Error("Map is not supported by this browser")}).catch(be=>{const{onError:Me}=y;Me?Me({type:"error",target:null,originalEvent:null,error:be}):console.error(be)}),()=>{_e=!1,de&&(M?.onMapUnmount(y.id),y.reuseMaps?de.recycle():de.destroy())}},[]),ky(()=>{D&&D.setProps(y)}),H.useImperativeHandle(b,()=>o.map,[D]);const ie=H.useMemo(()=>({position:"relative",width:"100%",height:"100%",...y.style}),[y.style]),B={height:"100%"};return H.createElement("div",{id:y.id,ref:U,style:ie},D&&H.createElement(Ho.Provider,{value:o},H.createElement("div",{"mapboxgl-children":"",style:B},y.children)))}const Dy=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function Zs(y,b){if(!y||!b)return;const E=y.style;for(const M in b){const D=b[M];Number.isFinite(D)&&!Dy.test(M)?E[M]=`${D}px`:E[M]=D}}function Ly(y,b){const{map:E,mapLib:M}=H.useContext(Ho),D=H.useRef({props:y});D.current.props=y;const F=H.useMemo(()=>{let Be=!1;H.Children.forEach(y.children,Qe=>{Qe&&(Be=!0)});const De={...y,element:Be?document.createElement("div"):null},Ne=new M.Marker(De);return Ne.setLngLat([y.longitude,y.latitude]),Ne.getElement().addEventListener("click",Qe=>{var qe,Oe;(Oe=(qe=D.current.props).onClick)===null||Oe===void 0||Oe.call(qe,{type:"click",target:Ne,originalEvent:Qe})}),Ne.on("dragstart",Qe=>{var qe,Oe;const Te=Qe;Te.lngLat=F.getLngLat(),(Oe=(qe=D.current.props).onDragStart)===null||Oe===void 0||Oe.call(qe,Te)}),Ne.on("drag",Qe=>{var qe,Oe;const Te=Qe;Te.lngLat=F.getLngLat(),(Oe=(qe=D.current.props).onDrag)===null||Oe===void 0||Oe.call(qe,Te)}),Ne.on("dragend",Qe=>{var qe,Oe;const Te=Qe;Te.lngLat=F.getLngLat(),(Oe=(qe=D.current.props).onDragEnd)===null||Oe===void 0||Oe.call(qe,Te)}),Ne},[]);H.useEffect(()=>(F.addTo(E.getMap()),()=>{F.remove()}),[]);const{longitude:U,latitude:o,offset:ie,style:B,draggable:ce=!1,popup:_e=null,rotation:de=0,rotationAlignment:be="auto",pitchAlignment:Me="auto"}=y;return H.useEffect(()=>{Zs(F.getElement(),B)},[B]),H.useImperativeHandle(b,()=>F,[]),(F.getLngLat().lng!==U||F.getLngLat().lat!==o)&&F.setLngLat([U,o]),ie&&!vy(F.getOffset(),ie)&&F.setOffset(ie),F.isDraggable()!==ce&&F.setDraggable(ce),F.getRotation()!==de&&F.setRotation(de),F.getRotationAlignment()!==be&&F.setRotationAlignment(be),F.getPitchAlignment()!==Me&&F.setPitchAlignment(Me),F.getPopup()!==_e&&F.setPopup(_e),qo.createPortal(y.children,F.getElement())}H.memo(H.forwardRef(Ly));function Hd(y){return new Set(y?y.trim().split(/\s+/):[])}function Ry(y,b){const{map:E,mapLib:M}=H.useContext(Ho),D=H.useMemo(()=>document.createElement("div"),[]),F=H.useRef({props:y});F.current.props=y;const U=H.useMemo(()=>{const o={...y},ie=new M.Popup(o);return ie.setLngLat([y.longitude,y.latitude]),ie.once("open",B=>{var ce,_e;(_e=(ce=F.current.props).onOpen)===null||_e===void 0||_e.call(ce,B)}),ie},[]);if(H.useEffect(()=>{const o=ie=>{var B,ce;(ce=(B=F.current.props).onClose)===null||ce===void 0||ce.call(B,ie)};return U.on("close",o),U.setDOMContent(D).addTo(E.getMap()),()=>{U.off("close",o),U.isOpen()&&U.remove()}},[]),H.useEffect(()=>{Zs(U.getElement(),y.style)},[y.style]),H.useImperativeHandle(b,()=>U,[]),U.isOpen()&&((U.getLngLat().lng!==y.longitude||U.getLngLat().lat!==y.latitude)&&U.setLngLat([y.longitude,y.latitude]),y.offset&&!zn(U.options.offset,y.offset)&&U.setOffset(y.offset),(U.options.anchor!==y.anchor||U.options.maxWidth!==y.maxWidth)&&(U.options.anchor=y.anchor,U.setMaxWidth(y.maxWidth)),U.options.className!==y.className)){const o=Hd(U.options.className),ie=Hd(y.className);for(const B of o)ie.has(B)||U.removeClassName(B);for(const B of ie)o.has(B)||U.addClassName(B);U.options.className=y.className}return qo.createPortal(y.children,D)}H.memo(H.forwardRef(Ry));function Wo(y,b,E,M){const D=H.useContext(Ho),F=H.useMemo(()=>y(D),[]);return H.useEffect(()=>{const U=M||E||b,o=typeof b=="function"&&typeof E=="function"?b:null,ie=typeof E=="function"?E:typeof b=="function"?b:null,{map:B}=D;return B.hasControl(F)||(B.addControl(F,U?.position),o&&o(D)),()=>{ie&&ie(D),B.hasControl(F)&&B.removeControl(F)}},[]),F}function Fy(y){const b=Wo(({mapLib:E})=>new E.AttributionControl(y),{position:y.position});return H.useEffect(()=>{Zs(b._container,y.style)},[y.style]),null}H.memo(Fy);function By(y){const b=Wo(({mapLib:E})=>new E.FullscreenControl({container:y.containerId&&document.getElementById(y.containerId)}),{position:y.position});return H.useEffect(()=>{Zs(b._controlContainer,y.style)},[y.style]),null}H.memo(By);function Oy(y,b){const E=H.useRef({props:y}),M=Wo(({mapLib:D})=>{const F=new D.GeolocateControl(y),U=F._setupUI;return F._setupUI=o=>{F._container.hasChildNodes()||U(o)},F.on("geolocate",o=>{var ie,B;(B=(ie=E.current.props).onGeolocate)===null||B===void 0||B.call(ie,o)}),F.on("error",o=>{var ie,B;(B=(ie=E.current.props).onError)===null||B===void 0||B.call(ie,o)}),F.on("outofmaxbounds",o=>{var ie,B;(B=(ie=E.current.props).onOutOfMaxBounds)===null||B===void 0||B.call(ie,o)}),F.on("trackuserlocationstart",o=>{var ie,B;(B=(ie=E.current.props).onTrackUserLocationStart)===null||B===void 0||B.call(ie,o)}),F.on("trackuserlocationend",o=>{var ie,B;(B=(ie=E.current.props).onTrackUserLocationEnd)===null||B===void 0||B.call(ie,o)}),F},{position:y.position});return E.current.props=y,H.useImperativeHandle(b,()=>M,[]),H.useEffect(()=>{Zs(M._container,y.style)},[y.style]),null}H.memo(H.forwardRef(Oy));function Ny(y){const b=Wo(({mapLib:E})=>new E.NavigationControl(y),{position:y.position});return H.useEffect(()=>{Zs(b._container,y.style)},[y.style]),null}H.memo(Ny);function $y(y){const b=Wo(({mapLib:F})=>new F.ScaleControl(y),{position:y.position}),E=H.useRef(y),M=E.current;E.current=y;const{style:D}=y;return y.maxWidth!==void 0&&y.maxWidth!==M.maxWidth&&(b.options.maxWidth=y.maxWidth),y.unit!==void 0&&y.unit!==M.unit&&b.setUnit(y.unit),H.useEffect(()=>{Zs(b._container,D)},[D]),null}H.memo($y);function Wd(y,b){if(!y)throw new Error(b)}let jy=0;function Vy(y,b,E){if(y.style&&y.style._loaded){const M={...E};return delete M.id,delete M.children,y.addSource(b,M),y.getSource(b)}return null}function Uy(y,b,E){Wd(b.id===E.id,"source id changed"),Wd(b.type===E.type,"source type changed");let M="",D=0;for(const U in b)U!=="children"&&U!=="id"&&!zn(E[U],b[U])&&(M=U,D++);if(!D)return;const F=b.type;if(F==="geojson")y.setData(b.data);else if(F==="image")y.updateImage({url:b.url,coordinates:b.coordinates});else if("setCoordinates"in y&&D===1&&M==="coordinates")y.setCoordinates(b.coordinates);else if("setUrl"in y)switch(M){case"url":y.setUrl(b.url);break;case"tiles":y.setTiles(b.tiles);break}else console.warn(`Unable to update <Source> prop: ${M}`)}function qy(y){const b=H.useContext(Ho).map.getMap(),E=H.useRef(y),[,M]=H.useState(0),D=H.useMemo(()=>y.id||`jsx-source-${jy++}`,[]);H.useEffect(()=>{if(b){const U=()=>setTimeout(()=>M(o=>o+1),0);return b.on("styledata",U),U(),()=>{var o;if(b.off("styledata",U),b.style&&b.style._loaded&&b.getSource(D)){const ie=(o=b.getStyle())===null||o===void 0?void 0:o.layers;if(ie)for(const B of ie)B.source===D&&b.removeLayer(B.id);b.removeSource(D)}}}},[b]);let F=b&&b.style&&b.getSource(D);return F?Uy(F,y,E.current):F=Vy(b,D,y),E.current=y,F&&H.Children.map(y.children,U=>U&&H.cloneElement(U,{source:D}))||null}const Zy=Om(()=>import("./mapbox-gl-lP4rPiBv.js").then(y=>y.m),__vite__mapDeps([0,1,2])),Gy=H.forwardRef(function(b,E){return zy(b,E,Zy)}),Hy=qy;var bp={exports:{}};(function(y,b){(function(E,M){y.exports=M()})(Nm,function(){var E,M,D;function F(o,ie){if(!E)E=ie;else if(!M)M=ie;else{var B="var sharedChunk = {}; ("+E+")(sharedChunk); ("+M+")(sharedChunk);",ce={};E(ce),D=ie(ce),typeof window<"u"&&(D.workerUrl=window.URL.createObjectURL(new Blob([B],{type:"text/javascript"})))}}F(["exports"],function(o){function ie(i,e,r,s){return new(r||(r=Promise))(function(l,h){function p(v){try{_(s.next(v))}catch(S){h(S)}}function f(v){try{_(s.throw(v))}catch(S){h(S)}}function _(v){var S;v.done?l(v.value):(S=v.value,S instanceof r?S:new r(function(I){I(S)})).then(p,f)}_((s=s.apply(i,e||[])).next())})}function B(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}typeof SuppressedError=="function"&&SuppressedError;var ce=_e;function _e(i,e){this.x=i,this.y=e}_e.prototype={clone:function(){return new _e(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,r=i.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),r=Math.sin(i),s=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=s,this},_rotateAround:function(i,e){var r=Math.cos(i),s=Math.sin(i),l=e.y+s*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-s*(this.y-e.y),this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},_e.convert=function(i){return i instanceof _e?i:Array.isArray(i)?new _e(i[0],i[1]):i};var de=B(ce),be=Me;function Me(i,e,r,s){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=r,this.p2y=s}Me.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,s=0;s<8;s++){var l=this.sampleCurveX(r)-i;if(Math.abs(l)<e)return r;var h=this.sampleCurveDerivativeX(r);if(Math.abs(h)<1e-6)break;r-=l/h}var p=0,f=1;for(r=i,s=0;s<20&&(l=this.sampleCurveX(r),!(Math.abs(l-i)<e));s++)i>l?p=r:f=r,r=.5*(f-p)+p;return r},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};var Be=B(be);let De,Ne;function Qe(){return De==null&&(De=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),De}function qe(){if(Ne==null&&(Ne=!1,Qe())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let s=0;s<5*5;s++){const l=4*s;e.fillStyle=`rgb(${l},${l+1},${l+2})`,e.fillRect(s%5,Math.floor(s/5),1,1)}const r=e.getImageData(0,0,5,5).data;for(let s=0;s<5*5*4;s++)if(s%4!=3&&r[s]!==s){Ne=!0;break}}}return Ne||!1}function Oe(i,e,r,s){const l=new Be(i,e,r,s);return function(h){return l.solve(h)}}const Te=Oe(.25,.1,.25,1);function at(i,e,r){return Math.min(r,Math.max(e,i))}function tt(i,e,r){const s=r-e,l=((i-e)%s+s)%s+e;return l===e?r:l}function He(i,...e){for(const r of e)for(const s in r)i[s]=r[s];return i}let ot=1;function Fe(i,e,r){const s={};for(const l in i)s[l]=e.call(r||this,i[l],l,i);return s}function ht(i,e,r){const s={};for(const l in i)e.call(r||this,i[l],l,i)&&(s[l]=i[l]);return s}function zt(i){return Array.isArray(i)?i.map(zt):typeof i=="object"&&i?Fe(i,zt):i}const Lt={};function xt(i){Lt[i]||(typeof console<"u"&&console.warn(i),Lt[i]=!0)}function Et(i,e,r){return(r.y-i.y)*(e.x-i.x)>(e.y-i.y)*(r.x-i.x)}function Bt(i){let e=0;for(let r,s,l=0,h=i.length,p=h-1;l<h;p=l++)r=i[l],s=i[p],e+=(s.x-r.x)*(r.y+s.y);return e}function ft(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let ni=null;function Ai(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const Xi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function si(i,e,r,s,l){return ie(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const h=new VideoFrame(i,{timestamp:0});try{const p=h?.format;if(!p||!p.startsWith("BGR")&&!p.startsWith("RGB"))throw new Error(`Unrecognized format ${p}`);const f=p.startsWith("BGR"),_=new Uint8ClampedArray(s*l*4);if(yield h.copyTo(_,function(v,S,I,A,L){const R=4*Math.max(-S,0),$=(Math.max(0,I)-I)*A*4+R,W=4*A,Y=Math.max(0,S),se=Math.max(0,I);return{rect:{x:Y,y:se,width:Math.min(v.width,S+A)-Y,height:Math.min(v.height,I+L)-se},layout:[{offset:$,stride:W}]}}(i,e,r,s,l)),f)for(let v=0;v<_.length;v+=4){const S=_[v];_[v]=_[v+2],_[v+2]=S}return _}finally{h.close()}})}let Xt,Ue,_t,Kt;const Mt={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(i){const e=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(i,e=0){return this.getImageCanvasContext(i).getImageData(-e,-e,i.width+2*e,i.height+2*e)},getImageCanvasContext(i){const e=window.document.createElement("canvas"),r=e.getContext("2d",{willReadFrequently:!0});if(!r)throw new Error("failed to create canvas 2d context");return e.width=i.width,e.height=i.height,r.drawImage(i,0,0,i.width,i.height),r},resolveURL:i=>(_t||(_t=document.createElement("a")),_t.href=i,_t.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Kt==null&&(Kt=matchMedia("(prefers-reduced-motion: reduce)")),Kt.matches)}},Yt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class gi extends Error{constructor(e,r,s,l){super(`AJAXError: ${r} (${e}): ${s}`),this.status=e,this.statusText=r,this.url=s,this.body=l}}const Jt=ft()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,Rt=i=>Yt.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))];function Pi(i,e){const r=new AbortController,s=new Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,cache:i.cache,referrer:Jt(),signal:r.signal});let l=!1,h=!1;return i.type==="json"&&s.headers.set("Accept","application/json"),h||fetch(s).then(p=>p.ok?(f=>{(i.type==="arrayBuffer"||i.type==="image"?f.arrayBuffer():i.type==="json"?f.json():f.text()).then(_=>{h||(l=!0,e(null,_,f.headers.get("Cache-Control"),f.headers.get("Expires")))}).catch(_=>{h||e(new Error(_.message))})})(p):p.blob().then(f=>e(new gi(p.status,p.statusText,i.url,f)))).catch(p=>{p.code!==20&&e(new Error(p.message))}),{cancel:()=>{h=!0,l||r.abort()}}}const bi=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){if(ft()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e);if(!ft())return(Rt(i.url)||Pi)(i,e)}if(!(/^file:/.test(r=i.url)||/^file:/.test(Jt())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return Pi(i,e);if(ft()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var r;return function(s,l){const h=new XMLHttpRequest;h.open(s.method||"GET",s.url,!0),s.type!=="arrayBuffer"&&s.type!=="image"||(h.responseType="arraybuffer");for(const p in s.headers)h.setRequestHeader(p,s.headers[p]);return s.type==="json"&&(h.responseType="text",h.setRequestHeader("Accept","application/json")),h.withCredentials=s.credentials==="include",h.onerror=()=>{l(new Error(h.statusText))},h.onload=()=>{if((h.status>=200&&h.status<300||h.status===0)&&h.response!==null){let p=h.response;if(s.type==="json")try{p=JSON.parse(h.response)}catch(f){return l(f)}l(null,p,h.getResponseHeader("Cache-Control"),h.getResponseHeader("Expires"))}else{const p=new Blob([h.response],{type:h.getResponseHeader("Content-Type")});l(new gi(h.status,h.statusText,s.url,p))}},h.send(s.body),{cancel:()=>h.abort()}}(i,e)},Wt=function(i,e){return bi(He(i,{type:"arrayBuffer"}),e)};function Ti(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const e=new URL(i),r=window.location;return e.protocol===r.protocol&&e.host===r.host}function rr(i,e,r){r[i]&&r[i].indexOf(e)!==-1||(r[i]=r[i]||[],r[i].push(e))}function pr(i,e,r){if(r&&r[i]){const s=r[i].indexOf(e);s!==-1&&r[i].splice(s,1)}}class nr{constructor(e,r={}){He(this,r),this.type=e}}class fr extends nr{constructor(e,r={}){super("error",He({error:e},r))}}class Sr{on(e,r){return this._listeners=this._listeners||{},rr(e,r,this._listeners),this}off(e,r){return pr(e,r,this._listeners),pr(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},rr(e,r,this._oneTimeListeners),this):new Promise(s=>this.once(e,s))}fire(e,r){typeof e=="string"&&(e=new nr(e,r||{}));const s=e.type;if(this.listens(s)){e.target=this;const l=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const f of l)f.call(this,e);const h=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const f of h)pr(s,f,this._oneTimeListeners),f.call(this,e);const p=this._eventedParent;p&&(He(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(e))}else e instanceof fr&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var fe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Ii=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function $i(i,e){const r={};for(const s in i)s!=="ref"&&(r[s]=i[s]);return Ii.forEach(s=>{s in e&&(r[s]=e[s])}),r}function jt(i,e){if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let r=0;r<i.length;r++)if(!jt(i[r],e[r]))return!1;return!0}if(typeof i=="object"&&i!==null&&e!==null){if(typeof e!="object"||Object.keys(i).length!==Object.keys(e).length)return!1;for(const r in i)if(!jt(i[r],e[r]))return!1;return!0}return i===e}const kt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Ui(i,e,r){r.push({command:kt.addSource,args:[i,e[i]]})}function Ki(i,e,r){e.push({command:kt.removeSource,args:[i]}),r[i]=!0}function sr(i,e,r,s){Ki(i,r,s),Ui(i,e,r)}function vn(i,e,r){let s;for(s in i[r])if(Object.prototype.hasOwnProperty.call(i[r],s)&&s!=="data"&&!jt(i[r][s],e[r][s]))return!1;for(s in e[r])if(Object.prototype.hasOwnProperty.call(e[r],s)&&s!=="data"&&!jt(i[r][s],e[r][s]))return!1;return!0}function bn(i,e,r,s,l,h){let p;for(p in e=e||{},i=i||{})Object.prototype.hasOwnProperty.call(i,p)&&(jt(i[p],e[p])||r.push({command:h,args:[s,p,e[p],l]}));for(p in e)Object.prototype.hasOwnProperty.call(e,p)&&!Object.prototype.hasOwnProperty.call(i,p)&&(jt(i[p],e[p])||r.push({command:h,args:[s,p,e[p],l]}))}function Yr(i){return i.id}function wn(i,e){return i[e.id]=e,i}class Ae{constructor(e,r,s,l){this.message=(e?`${e}: `:"")+s,l&&(this.identifier=l),r!=null&&r.__line__&&(this.line=r.__line__)}}function mt(i,...e){for(const r of e)for(const s in r)i[s]=r[s];return i}class dt extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class Ut{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[s,l]of r)this.bindings[s]=l}concat(e){return new Ut(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const bt={kind:"null"},Ce={kind:"number"},nt={kind:"string"},lt={kind:"boolean"},_i={kind:"color"},ji={kind:"object"},yt={kind:"value"},ln={kind:"collator"},q={kind:"formatted"},k={kind:"padding"},P={kind:"resolvedImage"},O={kind:"variableAnchorOffsetCollection"};function G(i,e){return{kind:"array",itemType:i,N:e}}function X(i){if(i.kind==="array"){const e=X(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const ae=[bt,Ce,nt,lt,_i,q,ji,G(yt),k,P,O];function ee(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ee(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const r of ae)if(!ee(r,e))return null}}return`Expected ${X(i)} but found ${X(e)} instead.`}function J(i,e){return e.some(r=>r.kind===i.kind)}function ne(i,e){return e.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}function me(i,e){return i.kind==="array"&&e.kind==="array"?i.itemType.kind===e.itemType.kind&&typeof i.N=="number":i.kind===e.kind}const ye=.96422,we=.82521,it=4/29,pt=6/29,We=3*pt*pt,st=pt*pt*pt,gt=Math.PI/180,Vt=180/Math.PI;function Gt(i){return(i%=360)<0&&(i+=360),i}function Ft([i,e,r,s]){let l,h;const p=Yi((.2225045*(i=Dt(i))+.7168786*(e=Dt(e))+.0606169*(r=Dt(r)))/1);i===e&&e===r?l=h=p:(l=Yi((.4360747*i+.3850649*e+.1430804*r)/ye),h=Yi((.0139322*i+.0971045*e+.7141733*r)/we));const f=116*p-16;return[f<0?0:f,500*(l-p),200*(p-h),s]}function Dt(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Yi(i){return i>st?Math.pow(i,1/3):i/We+it}function Qt([i,e,r,s]){let l=(i+16)/116,h=isNaN(e)?l:l+e/500,p=isNaN(r)?l:l-r/200;return l=1*qi(l),h=ye*qi(h),p=we*qi(p),[Ei(3.1338561*h-1.6168667*l-.4906146*p),Ei(-.9787684*h+1.9161415*l+.033454*p),Ei(.0719453*h-.2289914*l+1.4052427*p),s]}function Ei(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function qi(i){return i>pt?i*i*i:We*(i-it)}function Rr(i){return parseInt(i.padEnd(2,i),16)/255}function Xo(i,e){return Yn(e?i/100:i,0,1)}function Yn(i,e,r){return Math.min(Math.max(e,i),r)}function Jn(i){return!i.some(Number.isNaN)}const pc={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class qt{constructor(e,r,s,l=1,h=!0){this.r=e,this.g=r,this.b=s,this.a=l,h||(this.r*=l,this.g*=l,this.b*=l,l||this.overwriteGetter("rgb",[e,r,s,l]))}static parse(e){if(e instanceof qt)return e;if(typeof e!="string")return;const r=function(s){if((s=s.toLowerCase().trim())==="transparent")return[0,0,0,0];const l=pc[s];if(l){const[p,f,_]=l;return[p/255,f/255,_/255,1]}if(s.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(s)){const p=s.length<6?1:2;let f=1;return[Rr(s.slice(f,f+=p)),Rr(s.slice(f,f+=p)),Rr(s.slice(f,f+=p)),Rr(s.slice(f,f+p)||"ff")]}if(s.startsWith("rgb")){const p=s.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(p){const[f,_,v,S,I,A,L,R,$,W,Y,se]=p,Q=[S||" ",L||" ",W].join("");if(Q==="  "||Q==="  /"||Q===",,"||Q===",,,"){const oe=[v,A,$].join(""),ue=oe==="%%%"?100:oe===""?255:0;if(ue){const ve=[Yn(+_/ue,0,1),Yn(+I/ue,0,1),Yn(+R/ue,0,1),Y?Xo(+Y,se):1];if(Jn(ve))return ve}}return}}const h=s.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(h){const[p,f,_,v,S,I,A,L,R]=h,$=[_||" ",S||" ",A].join("");if($==="  "||$==="  /"||$===",,"||$===",,,"){const W=[+f,Yn(+v,0,100),Yn(+I,0,100),L?Xo(+L,R):1];if(Jn(W))return function([Y,se,Q,oe]){function ue(ve){const Ve=(ve+Y/30)%12,Ke=se*Math.min(Q,1-Q);return Q-Ke*Math.max(-1,Math.min(Ve-3,9-Ve,1))}return Y=Gt(Y),se/=100,Q/=100,[ue(0),ue(8),ue(4),oe]}(W)}}}(e);return r?new qt(...r,!1):void 0}get rgb(){const{r:e,g:r,b:s,a:l}=this,h=l||1/0;return this.overwriteGetter("rgb",[e/h,r/h,s/h,l])}get hcl(){return this.overwriteGetter("hcl",function(e){const[r,s,l,h]=Ft(e),p=Math.sqrt(s*s+l*l);return[Math.round(1e4*p)?Gt(Math.atan2(l,s)*Vt):NaN,p,r,h]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Ft(this.rgb))}overwriteGetter(e,r){return Object.defineProperty(this,e,{value:r}),r}toString(){const[e,r,s,l]=this.rgb;return`rgba(${[e,r,s].map(h=>Math.round(255*h)).join(",")},${l})`}}qt.black=new qt(0,0,0,1),qt.white=new qt(1,1,1,1),qt.transparent=new qt(0,0,0,0),qt.red=new qt(1,0,0,1);class Ra{constructor(e,r,s){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Gs{constructor(e,r,s,l,h){this.text=e,this.image=r,this.scale=s,this.fontStack=l,this.textColor=h}}class Ji{constructor(e){this.sections=e}static fromString(e){return new Ji([new Gs(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Ji?e:Ji.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class Cr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Cr)return e;if(typeof e=="number")return new Cr([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const r of e)if(typeof r!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new Cr(e)}}toString(){return JSON.stringify(this.values)}}const fc=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Fr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Fr)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let r=0;r<e.length;r+=2){const s=e[r],l=e[r+1];if(typeof s!="string"||!fc.has(s)||!Array.isArray(l)||l.length!==2||typeof l[0]!="number"||typeof l[1]!="number")return}return new Fr(e)}}toString(){return JSON.stringify(this.values)}}class Zi{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Zi({name:e,available:!1}):null}}function Hs(i,e,r,s){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[i,e,r,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[i,e,r,s]:[i,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Qn(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof qt||i instanceof Ra||i instanceof Ji||i instanceof Cr||i instanceof Fr||i instanceof Zi)return!0;if(Array.isArray(i)){for(const e of i)if(!Qn(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!Qn(i[e]))return!1;return!0}return!1}function li(i){if(i===null)return bt;if(typeof i=="string")return nt;if(typeof i=="boolean")return lt;if(typeof i=="number")return Ce;if(i instanceof qt)return _i;if(i instanceof Ra)return ln;if(i instanceof Ji)return q;if(i instanceof Cr)return k;if(i instanceof Fr)return O;if(i instanceof Zi)return P;if(Array.isArray(i)){const e=i.length;let r;for(const s of i){const l=li(s);if(r){if(r===l)continue;r=yt;break}r=l}return G(r||yt,e)}return ji}function Ot(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof qt||i instanceof Ji||i instanceof Cr||i instanceof Fr||i instanceof Zi?i.toString():JSON.stringify(i)}class Ln{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Qn(e[1]))return r.error("invalid value");const s=e[1];let l=li(s);const h=r.expectedType;return l.kind!=="array"||l.N!==0||!h||h.kind!=="array"||typeof h.N=="number"&&h.N!==0||(l=h),new Ln(l,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class pi{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Ws={string:nt,number:Ce,boolean:lt,object:ji};class Br{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let s,l=1;const h=e[0];if(h==="array"){let f,_;if(e.length>2){const v=e[1];if(typeof v!="string"||!(v in Ws)||v==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);f=Ws[v],l++}else f=yt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);_=e[2],l++}s=G(f,_)}else{if(!Ws[h])throw new Error(`Types doesn't contain name = ${h}`);s=Ws[h]}const p=[];for(;l<e.length;l++){const f=r.parse(e[l],l,yt);if(!f)return null;p.push(f)}return new Br(s,p)}evaluate(e){for(let r=0;r<this.args.length;r++){const s=this.args[r].evaluate(e);if(!ee(this.type,li(s)))return s;if(r===this.args.length-1)throw new pi(`Expected value to be of type ${X(this.type)}, but found ${X(li(s))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Fa={"to-boolean":lt,"to-color":_i,"to-number":Ce,"to-string":nt};class Sn{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const s=e[0];if(!Fa[s])throw new Error(`Can't parse ${s} as it is not part of the known types`);if((s==="to-boolean"||s==="to-string")&&e.length!==2)return r.error("Expected one argument.");const l=Fa[s],h=[];for(let p=1;p<e.length;p++){const f=r.parse(e[p],p,yt);if(!f)return null;h.push(f)}return new Sn(l,h)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let r,s;for(const l of this.args){if(r=l.evaluate(e),s=null,r instanceof qt)return r;if(typeof r=="string"){const h=e.parseColor(r);if(h)return h}else if(Array.isArray(r)&&(s=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:Hs(r[0],r[1],r[2],r[3]),!s))return new qt(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new pi(s||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const s of this.args){r=s.evaluate(e);const l=Cr.parse(r);if(l)return l}throw new pi(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const s of this.args){r=s.evaluate(e);const l=Fr.parse(r);if(l)return l}throw new pi(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const s of this.args){if(r=s.evaluate(e),r===null)return 0;const l=Number(r);if(!isNaN(l))return l}throw new pi(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return Ji.fromString(Ot(this.args[0].evaluate(e)));case"resolvedImage":return Zi.fromString(Ot(this.args[0].evaluate(e)));default:return Ot(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Ko=["Unknown","Point","LineString","Polygon"];class Ba{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ko[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=qt.parse(e)),r}}class Xs{constructor(e,r,s=[],l,h=new Ut,p=[]){this.registry=e,this.path=s,this.key=s.map(f=>`[${f}]`).join(""),this.scope=h,this.errors=p,this.expectedType=l,this._isConstant=r}parse(e,r,s,l,h={}){return r?this.concat(r,s,l)._parse(e,h):this._parse(e,h)}_parse(e,r){function s(l,h,p){return p==="assert"?new Br(h,[l]):p==="coerce"?new Sn(h,[l]):l}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const l=e[0];if(typeof l!="string")return this.error(`Expression name must be a string, but found ${typeof l} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const h=this.registry[l];if(h){let p=h.parse(e,this);if(!p)return null;if(this.expectedType){const f=this.expectedType,_=p.type;if(f.kind!=="string"&&f.kind!=="number"&&f.kind!=="boolean"&&f.kind!=="object"&&f.kind!=="array"||_.kind!=="value")if(f.kind!=="color"&&f.kind!=="formatted"&&f.kind!=="resolvedImage"||_.kind!=="value"&&_.kind!=="string")if(f.kind!=="padding"||_.kind!=="value"&&_.kind!=="number"&&_.kind!=="array")if(f.kind!=="variableAnchorOffsetCollection"||_.kind!=="value"&&_.kind!=="array"){if(this.checkSubtype(f,_))return null}else p=s(p,f,r.typeAnnotation||"coerce");else p=s(p,f,r.typeAnnotation||"coerce");else p=s(p,f,r.typeAnnotation||"coerce");else p=s(p,f,r.typeAnnotation||"assert")}if(!(p instanceof Ln)&&p.type.kind!=="resolvedImage"&&this._isConstant(p)){const f=new Ba;try{p=new Ln(p.type,p.evaluate(f))}catch(_){return this.error(_.message),null}}return p}return this.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,s){const l=typeof e=="number"?this.path.concat(e):this.path,h=s?this.scope.concat(s):this.scope;return new Xs(this.registry,this._isConstant,l,r||null,h,this.errors)}error(e,...r){const s=`${this.key}${r.map(l=>`[${l}]`).join("")}`;this.errors.push(new dt(s,e))}checkSubtype(e,r){const s=ee(e,r);return s&&this.error(s),s}}class Ks{constructor(e,r,s){this.type=ln,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const s=e[1];if(typeof s!="object"||Array.isArray(s))return r.error("Collator options argument must be an object.");const l=r.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,lt);if(!l)return null;const h=r.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,lt);if(!h)return null;let p=null;return s.locale&&(p=r.parse(s.locale,1,nt),!p)?null:new Ks(l,h,p)}evaluate(e){return new Ra(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}const Cn=8192;function Oa(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function bs(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function Yo(i,e){const r=(180+i[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,l=Math.pow(2,e.z);return[Math.round(r*l*Cn),Math.round(s*l*Cn)]}function mc(i,e,r){const s=i[0]-e[0],l=i[1]-e[1],h=i[0]-r[0],p=i[1]-r[1];return s*p-h*l==0&&s*h<=0&&l*p<=0}function Na(i,e){let r=!1;for(let p=0,f=e.length;p<f;p++){const _=e[p];for(let v=0,S=_.length;v<S-1;v++){if(mc(i,_[v],_[v+1]))return!1;(l=_[v])[1]>(s=i)[1]!=(h=_[v+1])[1]>s[1]&&s[0]<(h[0]-l[0])*(s[1]-l[1])/(h[1]-l[1])+l[0]&&(r=!r)}}var s,l,h;return r}function $a(i,e){for(let r=0;r<e.length;r++)if(Na(i,e[r]))return!0;return!1}function Jo(i,e,r,s){const l=s[0]-r[0],h=s[1]-r[1],p=(i[0]-r[0])*h-l*(i[1]-r[1]),f=(e[0]-r[0])*h-l*(e[1]-r[1]);return p>0&&f<0||p<0&&f>0}function gc(i,e,r){for(const v of r)for(let S=0;S<v.length-1;++S)if((f=[(p=v[S+1])[0]-(h=v[S])[0],p[1]-h[1]])[0]*(_=[(l=e)[0]-(s=i)[0],l[1]-s[1]])[1]-f[1]*_[0]!=0&&Jo(s,l,h,p)&&Jo(h,p,s,l))return!0;var s,l,h,p,f,_;return!1}function Qo(i,e){for(let r=0;r<i.length;++r)if(!Na(i[r],e))return!1;for(let r=0;r<i.length-1;++r)if(gc(i[r],i[r+1],e))return!1;return!0}function el(i,e){for(let r=0;r<e.length;r++)if(Qo(i,e[r]))return!0;return!1}function Ys(i,e,r){const s=[];for(let l=0;l<i.length;l++){const h=[];for(let p=0;p<i[l].length;p++){const f=Yo(i[l][p],r);Oa(e,f),h.push(f)}s.push(h)}return s}function tl(i,e,r){const s=[];for(let l=0;l<i.length;l++){const h=Ys(i[l],e,r);s.push(h)}return s}function il(i,e,r,s){if(i[0]<r[0]||i[0]>r[2]){const l=.5*s;let h=i[0]-r[0]>l?-s:r[0]-i[0]>l?s:0;h===0&&(h=i[0]-r[2]>l?-s:r[2]-i[0]>l?s:0),i[0]+=h}Oa(e,i)}function ja(i,e,r,s){const l=Math.pow(2,s.z)*Cn,h=[s.x*Cn,s.y*Cn],p=[];for(const f of i)for(const _ of f){const v=[_.x+h[0],_.y+h[1]];il(v,e,r,l),p.push(v)}return p}function Va(i,e,r,s){const l=Math.pow(2,s.z)*Cn,h=[s.x*Cn,s.y*Cn],p=[];for(const _ of i){const v=[];for(const S of _){const I=[S.x+h[0],S.y+h[1]];Oa(e,I),v.push(I)}p.push(v)}if(e[2]-e[0]<=l/2){(f=e)[0]=f[1]=1/0,f[2]=f[3]=-1/0;for(const _ of p)for(const v of _)il(v,e,r,l)}var f;return p}class Rn{constructor(e,r){this.type=lt,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Qn(e[1])){const s=e[1];if(s.type==="FeatureCollection")for(let l=0;l<s.features.length;++l){const h=s.features[l].geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new Rn(s,s.features[l].geometry)}else if(s.type==="Feature"){const l=s.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new Rn(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new Rn(s,s)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,s){const l=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],p=r.canonicalID();if(s.type==="Polygon"){const f=Ys(s.coordinates,h,p),_=ja(r.geometry(),l,h,p);if(!bs(l,h))return!1;for(const v of _)if(!Na(v,f))return!1}if(s.type==="MultiPolygon"){const f=tl(s.coordinates,h,p),_=ja(r.geometry(),l,h,p);if(!bs(l,h))return!1;for(const v of _)if(!$a(v,f))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,s){const l=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],p=r.canonicalID();if(s.type==="Polygon"){const f=Ys(s.coordinates,h,p),_=Va(r.geometry(),l,h,p);if(!bs(l,h))return!1;for(const v of _)if(!Qo(v,f))return!1}if(s.type==="MultiPolygon"){const f=tl(s.coordinates,h,p),_=Va(r.geometry(),l,h,p);if(!bs(l,h))return!1;for(const v of _)if(!el(v,f))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Js{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const s=e[1];return r.scope.has(s)?new Js(s,r.scope.get(s)):r.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class Or{constructor(e,r,s,l){this.name=e,this.type=r,this._evaluate=s,this.args=l}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,r){const s=e[0],l=Or.definitions[s];if(!l)return r.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const h=Array.isArray(l)?l[0]:l.type,p=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,f=p.filter(([v])=>!Array.isArray(v)||v.length===e.length-1);let _=null;for(const[v,S]of f){_=new Xs(r.registry,Qs,r.path,null,r.scope);const I=[];let A=!1;for(let L=1;L<e.length;L++){const R=e[L],$=Array.isArray(v)?v[L-1]:v.type,W=_.parse(R,1+I.length,$);if(!W){A=!0;break}I.push(W)}if(!A)if(Array.isArray(v)&&v.length!==I.length)_.error(`Expected ${v.length} arguments, but found ${I.length} instead.`);else{for(let L=0;L<I.length;L++){const R=Array.isArray(v)?v[L]:v.type,$=I[L];_.concat(L+1).checkSubtype(R,$.type)}if(_.errors.length===0)return new Or(s,h,S,I)}}if(f.length===1)r.errors.push(..._.errors);else{const v=(f.length?f:p).map(([I])=>{return A=I,Array.isArray(A)?`(${A.map(X).join(", ")})`:`(${X(A.type)}...)`;var A}).join(" | "),S=[];for(let I=1;I<e.length;I++){const A=r.parse(e[I],1+S.length);if(!A)return null;S.push(X(A.type))}r.error(`Expected arguments of type ${v}, but found (${S.join(", ")}) instead.`)}return null}static register(e,r){Or.definitions=r;for(const s in r)e[s]=Or}}function Qs(i){if(i instanceof Js)return Qs(i.boundExpression);if(i instanceof Or&&i.name==="error"||i instanceof Ks||i instanceof Rn)return!1;const e=i instanceof Sn||i instanceof Br;let r=!0;return i.eachChild(s=>{r=e?r&&Qs(s):r&&s instanceof Ln}),!!r&&ea(i)&&ta(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function ea(i){if(i instanceof Or&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Rn)return!1;let e=!0;return i.eachChild(r=>{e&&!ea(r)&&(e=!1)}),e}function ws(i){if(i instanceof Or&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(r=>{e&&!ws(r)&&(e=!1)}),e}function ta(i,e){if(i instanceof Or&&e.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(s=>{r&&!ta(s,e)&&(r=!1)}),r}function es(i,e){const r=i.length-1;let s,l,h=0,p=r,f=0;for(;h<=p;)if(f=Math.floor((h+p)/2),s=i[f],l=i[f+1],s<=e){if(f===r||e<l)return f;h=f+1}else{if(!(s>e))throw new pi("Input is not a number.");p=f-1}return 0}class Tn{constructor(e,r,s){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[l,h]of s)this.labels.push(l),this.outputs.push(h)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const s=r.parse(e[1],1,Ce);if(!s)return null;const l=[];let h=null;r.expectedType&&r.expectedType.kind!=="value"&&(h=r.expectedType);for(let p=1;p<e.length;p+=2){const f=p===1?-1/0:e[p],_=e[p+1],v=p,S=p+1;if(typeof f!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',v);if(l.length&&l[l.length-1][0]>=f)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',v);const I=r.parse(_,S,h);if(!I)return null;h=h||I.type,l.push([f,I])}return new Tn(h,s,l)}evaluate(e){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(e);const l=this.input.evaluate(e);if(l<=r[0])return s[0].evaluate(e);const h=r.length;return l>=r[h-1]?s[h-1].evaluate(e):s[es(r,l)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function At(i,e,r){return i+r*(e-i)}function ia(i,e,r){return i.map((s,l)=>At(s,e[l],r))}const Tr={number:At,color:function(i,e,r,s="rgb"){switch(s){case"rgb":{const[l,h,p,f]=ia(i.rgb,e.rgb,r);return new qt(l,h,p,f,!1)}case"hcl":{const[l,h,p,f]=i.hcl,[_,v,S,I]=e.hcl;let A,L;if(isNaN(l)||isNaN(_))isNaN(l)?isNaN(_)?A=NaN:(A=_,p!==1&&p!==0||(L=v)):(A=l,S!==1&&S!==0||(L=h));else{let se=_-l;_>l&&se>180?se-=360:_<l&&l-_>180&&(se+=360),A=l+r*se}const[R,$,W,Y]=function([se,Q,oe,ue]){return se=isNaN(se)?0:se*gt,Qt([oe,Math.cos(se)*Q,Math.sin(se)*Q,ue])}([A,L??At(h,v,r),At(p,S,r),At(f,I,r)]);return new qt(R,$,W,Y,!1)}case"lab":{const[l,h,p,f]=Qt(ia(i.lab,e.lab,r));return new qt(l,h,p,f,!1)}}},array:ia,padding:function(i,e,r){return new Cr(ia(i.values,e.values,r))},variableAnchorOffsetCollection:function(i,e,r){const s=i.values,l=e.values;if(s.length!==l.length)throw new pi(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${e.toString()}`);const h=[];for(let p=0;p<s.length;p+=2){if(s[p]!==l[p])throw new pi(`Cannot interpolate values containing mismatched anchors. from[${p}]: ${s[p]}, to[${p}]: ${l[p]}`);h.push(s[p]);const[f,_]=s[p+1],[v,S]=l[p+1];h.push([At(f,v,r),At(_,S,r)])}return new Fr(h)}};class Ir{constructor(e,r,s,l,h){this.type=e,this.operator=r,this.interpolation=s,this.input=l,this.labels=[],this.outputs=[];for(const[p,f]of h)this.labels.push(p),this.outputs.push(f)}static interpolationFactor(e,r,s,l){let h=0;if(e.name==="exponential")h=Ua(r,e.base,s,l);else if(e.name==="linear")h=Ua(r,1,s,l);else if(e.name==="cubic-bezier"){const p=e.controlPoints;h=new Be(p[0],p[1],p[2],p[3]).solve(Ua(r,1,s,l))}return h}static parse(e,r){let[s,l,h,...p]=e;if(!Array.isArray(l)||l.length===0)return r.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){const v=l[1];if(typeof v!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:v}}else{if(l[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(l[0])}`,1,0);{const v=l.slice(1);if(v.length!==4||v.some(S=>typeof S!="number"||S<0||S>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:v}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(h=r.parse(h,2,Ce),!h)return null;const f=[];let _=null;s==="interpolate-hcl"||s==="interpolate-lab"?_=_i:r.expectedType&&r.expectedType.kind!=="value"&&(_=r.expectedType);for(let v=0;v<p.length;v+=2){const S=p[v],I=p[v+1],A=v+3,L=v+4;if(typeof S!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(f.length&&f[f.length-1][0]>=S)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',A);const R=r.parse(I,L,_);if(!R)return null;_=_||R.type,f.push([S,R])}return me(_,Ce)||me(_,_i)||me(_,k)||me(_,O)||me(_,G(Ce))?new Ir(_,s,l,h,f):r.error(`Type ${X(_)} is not interpolatable.`)}evaluate(e){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(e);const l=this.input.evaluate(e);if(l<=r[0])return s[0].evaluate(e);const h=r.length;if(l>=r[h-1])return s[h-1].evaluate(e);const p=es(r,l),f=Ir.interpolationFactor(this.interpolation,l,r[p],r[p+1]),_=s[p].evaluate(e),v=s[p+1].evaluate(e);switch(this.operator){case"interpolate":return Tr[this.type.kind](_,v,f);case"interpolate-hcl":return Tr.color(_,v,f,"hcl");case"interpolate-lab":return Tr.color(_,v,f,"lab")}}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Ua(i,e,r,s){const l=s-r,h=i-r;return l===0?0:e===1?h/l:(Math.pow(e,h)-1)/(Math.pow(e,l)-1)}class ra{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let s=null;const l=r.expectedType;l&&l.kind!=="value"&&(s=l);const h=[];for(const f of e.slice(1)){const _=r.parse(f,1+h.length,s,void 0,{typeAnnotation:"omit"});if(!_)return null;s=s||_.type,h.push(_)}if(!s)throw new Error("No output type");const p=l&&h.some(f=>ee(l,f.type));return new ra(p?yt:s,h)}evaluate(e){let r,s=null,l=0;for(const h of this.args)if(l++,s=h.evaluate(e),s&&s instanceof Zi&&!s.available&&(r||(r=s.name),s=null,l===this.args.length&&(s=r)),s!==null)break;return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class na{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let h=1;h<e.length-1;h+=2){const p=e[h];if(typeof p!="string")return r.error(`Expected string, but found ${typeof p} instead.`,h);if(/[^a-zA-Z0-9_]/.test(p))return r.error("Variable names must contain only alphanumeric characters or '_'.",h);const f=r.parse(e[h+1],h+1);if(!f)return null;s.push([p,f])}const l=r.parse(e[e.length-1],e.length-1,r.expectedType,s);return l?new na(s,l):null}outputDefined(){return this.result.outputDefined()}}class qa{constructor(e,r,s){this.type=e,this.index=r,this.input=s}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,Ce),l=r.parse(e[2],2,G(r.expectedType||yt));return s&&l?new qa(l.type.itemType,s,l):null}evaluate(e){const r=this.index.evaluate(e),s=this.input.evaluate(e);if(r<0)throw new pi(`Array index out of bounds: ${r} < 0.`);if(r>=s.length)throw new pi(`Array index out of bounds: ${r} > ${s.length-1}.`);if(r!==Math.floor(r))throw new pi(`Array index must be an integer, but found ${r} instead.`);return s[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class Za{constructor(e,r){this.type=lt,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,yt),l=r.parse(e[2],2,yt);return s&&l?J(s.type,[lt,nt,Ce,bt,yt])?new Za(s,l):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${X(s.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!s)return!1;if(!ne(r,["boolean","string","number","null"]))throw new pi(`Expected first argument to be of type boolean, string, number or null, but found ${X(li(r))} instead.`);if(!ne(s,["string","array"]))throw new pi(`Expected second argument to be of type array or string, but found ${X(li(s))} instead.`);return s.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class sa{constructor(e,r,s){this.type=Ce,this.needle=e,this.haystack=r,this.fromIndex=s}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,yt),l=r.parse(e[2],2,yt);if(!s||!l)return null;if(!J(s.type,[lt,nt,Ce,bt,yt]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${X(s.type)} instead`);if(e.length===4){const h=r.parse(e[3],3,Ce);return h?new sa(s,l,h):null}return new sa(s,l)}evaluate(e){const r=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!ne(r,["boolean","string","number","null"]))throw new pi(`Expected first argument to be of type boolean, string, number or null, but found ${X(li(r))} instead.`);if(!ne(s,["string","array"]))throw new pi(`Expected second argument to be of type array or string, but found ${X(li(s))} instead.`);if(this.fromIndex){const l=this.fromIndex.evaluate(e);return s.indexOf(r,l)}return s.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class Ga{constructor(e,r,s,l,h,p){this.inputType=e,this.type=r,this.input=s,this.cases=l,this.outputs=h,this.otherwise=p}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let s,l;r.expectedType&&r.expectedType.kind!=="value"&&(l=r.expectedType);const h={},p=[];for(let v=2;v<e.length-1;v+=2){let S=e[v];const I=e[v+1];Array.isArray(S)||(S=[S]);const A=r.concat(v);if(S.length===0)return A.error("Expected at least one branch label.");for(const R of S){if(typeof R!="number"&&typeof R!="string")return A.error("Branch labels must be numbers or strings.");if(typeof R=="number"&&Math.abs(R)>Number.MAX_SAFE_INTEGER)return A.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof R=="number"&&Math.floor(R)!==R)return A.error("Numeric branch labels must be integer values.");if(s){if(A.checkSubtype(s,li(R)))return null}else s=li(R);if(h[String(R)]!==void 0)return A.error("Branch labels must be unique.");h[String(R)]=p.length}const L=r.parse(I,v,l);if(!L)return null;l=l||L.type,p.push(L)}const f=r.parse(e[1],1,yt);if(!f)return null;const _=r.parse(e[e.length-1],e.length-1,l);return _?f.type.kind!=="value"&&r.concat(1).checkSubtype(s,f.type)?null:new Ga(s,l,f,h,p,_):null}evaluate(e){const r=this.input.evaluate(e);return(li(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class Ha{constructor(e,r,s){this.type=e,this.branches=r,this.otherwise=s}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let s;r.expectedType&&r.expectedType.kind!=="value"&&(s=r.expectedType);const l=[];for(let p=1;p<e.length-1;p+=2){const f=r.parse(e[p],p,lt);if(!f)return null;const _=r.parse(e[p+1],p+1,s);if(!_)return null;l.push([f,_]),s=s||_.type}const h=r.parse(e[e.length-1],e.length-1,s);if(!h)return null;if(!s)throw new Error("Can't infer output type");return new Ha(s,l,h)}evaluate(e){for(const[r,s]of this.branches)if(r.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,s]of this.branches)e(r),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class aa{constructor(e,r,s,l){this.type=e,this.input=r,this.beginIndex=s,this.endIndex=l}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,yt),l=r.parse(e[2],2,Ce);if(!s||!l)return null;if(!J(s.type,[G(yt),nt,yt]))return r.error(`Expected first argument to be of type array or string, but found ${X(s.type)} instead`);if(e.length===4){const h=r.parse(e[3],3,Ce);return h?new aa(s.type,s,l,h):null}return new aa(s.type,s,l)}evaluate(e){const r=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!ne(r,["string","array"]))throw new pi(`Expected first argument to be of type array or string, but found ${X(li(r))} instead.`);if(this.endIndex){const l=this.endIndex.evaluate(e);return r.slice(s,l)}return r.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function rl(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function nl(i,e,r,s){return s.compare(e,r)===0}function ts(i,e,r){const s=i!=="=="&&i!=="!=";return class wp{constructor(h,p,f){this.type=lt,this.lhs=h,this.rhs=p,this.collator=f,this.hasUntypedArgument=h.type.kind==="value"||p.type.kind==="value"}static parse(h,p){if(h.length!==3&&h.length!==4)return p.error("Expected two or three arguments.");const f=h[0];let _=p.parse(h[1],1,yt);if(!_)return null;if(!rl(f,_.type))return p.concat(1).error(`"${f}" comparisons are not supported for type '${X(_.type)}'.`);let v=p.parse(h[2],2,yt);if(!v)return null;if(!rl(f,v.type))return p.concat(2).error(`"${f}" comparisons are not supported for type '${X(v.type)}'.`);if(_.type.kind!==v.type.kind&&_.type.kind!=="value"&&v.type.kind!=="value")return p.error(`Cannot compare types '${X(_.type)}' and '${X(v.type)}'.`);s&&(_.type.kind==="value"&&v.type.kind!=="value"?_=new Br(v.type,[_]):_.type.kind!=="value"&&v.type.kind==="value"&&(v=new Br(_.type,[v])));let S=null;if(h.length===4){if(_.type.kind!=="string"&&v.type.kind!=="string"&&_.type.kind!=="value"&&v.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(S=p.parse(h[3],3,ln),!S)return null}return new wp(_,v,S)}evaluate(h){const p=this.lhs.evaluate(h),f=this.rhs.evaluate(h);if(s&&this.hasUntypedArgument){const _=li(p),v=li(f);if(_.kind!==v.kind||_.kind!=="string"&&_.kind!=="number")throw new pi(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${_.kind}, ${v.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const _=li(p),v=li(f);if(_.kind!=="string"||v.kind!=="string")return e(h,p,f)}return this.collator?r(h,p,f,this.collator.evaluate(h)):e(h,p,f)}eachChild(h){h(this.lhs),h(this.rhs),this.collator&&h(this.collator)}outputDefined(){return!0}}}const _c=ts("==",function(i,e,r){return e===r},nl),yc=ts("!=",function(i,e,r){return e!==r},function(i,e,r,s){return!nl(0,e,r,s)}),xc=ts("<",function(i,e,r){return e<r},function(i,e,r,s){return s.compare(e,r)<0}),vc=ts(">",function(i,e,r){return e>r},function(i,e,r,s){return s.compare(e,r)>0}),bc=ts("<=",function(i,e,r){return e<=r},function(i,e,r,s){return s.compare(e,r)<=0}),wc=ts(">=",function(i,e,r){return e>=r},function(i,e,r,s){return s.compare(e,r)>=0});class Wa{constructor(e,r,s,l,h){this.type=nt,this.number=e,this.locale=r,this.currency=s,this.minFractionDigits=l,this.maxFractionDigits=h}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const s=r.parse(e[1],1,Ce);if(!s)return null;const l=e[2];if(typeof l!="object"||Array.isArray(l))return r.error("NumberFormat options argument must be an object.");let h=null;if(l.locale&&(h=r.parse(l.locale,1,nt),!h))return null;let p=null;if(l.currency&&(p=r.parse(l.currency,1,nt),!p))return null;let f=null;if(l["min-fraction-digits"]&&(f=r.parse(l["min-fraction-digits"],1,Ce),!f))return null;let _=null;return l["max-fraction-digits"]&&(_=r.parse(l["max-fraction-digits"],1,Ce),!_)?null:new Wa(s,h,p,f,_)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class oa{constructor(e){this.type=q,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&typeof s=="object")return r.error("First argument must be an image or text section.");const l=[];let h=!1;for(let p=1;p<=e.length-1;++p){const f=e[p];if(h&&typeof f=="object"&&!Array.isArray(f)){h=!1;let _=null;if(f["font-scale"]&&(_=r.parse(f["font-scale"],1,Ce),!_))return null;let v=null;if(f["text-font"]&&(v=r.parse(f["text-font"],1,G(nt)),!v))return null;let S=null;if(f["text-color"]&&(S=r.parse(f["text-color"],1,_i),!S))return null;const I=l[l.length-1];I.scale=_,I.font=v,I.textColor=S}else{const _=r.parse(e[p],1,yt);if(!_)return null;const v=_.type.kind;if(v!=="string"&&v!=="value"&&v!=="null"&&v!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");h=!0,l.push({content:_,scale:null,font:null,textColor:null})}}return new oa(l)}evaluate(e){return new Ji(this.sections.map(r=>{const s=r.content.evaluate(e);return li(s)===P?new Gs("",s,null,null,null):new Gs(Ot(s),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}}class Xa{constructor(e){this.type=P,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const s=r.parse(e[1],1,nt);return s?new Xa(s):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),s=Zi.fromString(r);return s&&e.availableImages&&(s.available=e.availableImages.indexOf(r)>-1),s}eachChild(e){e(this.input)}outputDefined(){return!1}}class Ka{constructor(e){this.type=Ce,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=r.parse(e[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${X(s.type)} instead.`):new Ka(s):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new pi(`Expected value to be of type string or array, but found ${X(li(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const is={"==":_c,"!=":yc,">":vc,"<":xc,">=":wc,"<=":bc,array:Br,at:qa,boolean:Br,case:Ha,coalesce:ra,collator:Ks,format:oa,image:Xa,in:Za,"index-of":sa,interpolate:Ir,"interpolate-hcl":Ir,"interpolate-lab":Ir,length:Ka,let:na,literal:Ln,match:Ga,number:Br,"number-format":Wa,object:Br,slice:aa,step:Tn,string:Br,"to-boolean":Sn,"to-color":Sn,"to-number":Sn,"to-string":Sn,var:Js,within:Rn};function sl(i,[e,r,s,l]){e=e.evaluate(i),r=r.evaluate(i),s=s.evaluate(i);const h=l?l.evaluate(i):1,p=Hs(e,r,s,h);if(p)throw new pi(p);return new qt(e/255,r/255,s/255,h,!1)}function al(i,e){return i in e}function Ya(i,e){const r=e[i];return r===void 0?null:r}function Fn(i){return{type:i}}function ol(i){return{result:"success",value:i}}function In(i){return{result:"error",value:i}}function rs(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function ll(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function Ja(i){return!!i.expression&&i.expression.interpolated}function Nt(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function ci(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function Sc(i){return i}function Pt(i,e){const r=e.type==="color",s=i.stops&&typeof i.stops[0][0]=="object",l=s||!(s||i.property!==void 0),h=i.type||(Ja(e)?"exponential":"interval");if(r||e.type==="padding"){const S=r?qt.parse:Cr.parse;(i=mt({},i)).stops&&(i.stops=i.stops.map(I=>[I[0],S(I[1])])),i.default=S(i.default?i.default:e.default)}if(i.colorSpace&&(p=i.colorSpace)!=="rgb"&&p!=="hcl"&&p!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var p;let f,_,v;if(h==="exponential")f=Ss;else if(h==="interval")f=ai;else if(h==="categorical"){f=ui,_=Object.create(null);for(const S of i.stops)_[S[0]]=S[1];v=typeof i.stops[0][0]}else{if(h!=="identity")throw new Error(`Unknown function type "${h}"`);f=cl}if(s){const S={},I=[];for(let R=0;R<i.stops.length;R++){const $=i.stops[R],W=$[0].zoom;S[W]===void 0&&(S[W]={zoom:W,type:i.type,property:i.property,default:i.default,stops:[]},I.push(W)),S[W].stops.push([$[0].value,$[1]])}const A=[];for(const R of I)A.push([S[R].zoom,Pt(S[R],e)]);const L={name:"linear"};return{kind:"composite",interpolationType:L,interpolationFactor:Ir.interpolationFactor.bind(void 0,L),zoomStops:A.map(R=>R[0]),evaluate:({zoom:R},$)=>Ss({stops:A,base:i.base},e,R).evaluate(R,$)}}if(l){const S=h==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:S,interpolationFactor:Ir.interpolationFactor.bind(void 0,S),zoomStops:i.stops.map(I=>I[0]),evaluate:({zoom:I})=>f(i,e,I,_,v)}}return{kind:"source",evaluate(S,I){const A=I&&I.properties?I.properties[i.property]:void 0;return A===void 0?Bn(i.default,e.default):f(i,e,A,_,v)}}}function Bn(i,e,r){return i!==void 0?i:e!==void 0?e:r!==void 0?r:void 0}function ui(i,e,r,s,l){return Bn(typeof r===l?s[r]:void 0,i.default,e.default)}function ai(i,e,r){if(Nt(r)!=="number")return Bn(i.default,e.default);const s=i.stops.length;if(s===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[s-1][0])return i.stops[s-1][1];const l=es(i.stops.map(h=>h[0]),r);return i.stops[l][1]}function Ss(i,e,r){const s=i.base!==void 0?i.base:1;if(Nt(r)!=="number")return Bn(i.default,e.default);const l=i.stops.length;if(l===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[l-1][0])return i.stops[l-1][1];const h=es(i.stops.map(S=>S[0]),r),p=function(S,I,A,L){const R=L-A,$=S-A;return R===0?0:I===1?$/R:(Math.pow(I,$)-1)/(Math.pow(I,R)-1)}(r,s,i.stops[h][0],i.stops[h+1][0]),f=i.stops[h][1],_=i.stops[h+1][1],v=Tr[e.type]||Sc;return typeof f.evaluate=="function"?{evaluate(...S){const I=f.evaluate.apply(void 0,S),A=_.evaluate.apply(void 0,S);if(I!==void 0&&A!==void 0)return v(I,A,p,i.colorSpace)}}:v(f,_,p,i.colorSpace)}function cl(i,e,r){switch(e.type){case"color":r=qt.parse(r);break;case"formatted":r=Ji.fromString(r.toString());break;case"resolvedImage":r=Zi.fromString(r.toString());break;case"padding":r=Cr.parse(r);break;default:Nt(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0)}return Bn(r,i.default,e.default)}Or.register(is,{error:[{kind:"error"},[nt],(i,[e])=>{throw new pi(e.evaluate(i))}],typeof:[nt,[yt],(i,[e])=>X(li(e.evaluate(i)))],"to-rgba":[G(Ce,4),[_i],(i,[e])=>{const[r,s,l,h]=e.evaluate(i).rgb;return[255*r,255*s,255*l,h]}],rgb:[_i,[Ce,Ce,Ce],sl],rgba:[_i,[Ce,Ce,Ce,Ce],sl],has:{type:lt,overloads:[[[nt],(i,[e])=>al(e.evaluate(i),i.properties())],[[nt,ji],(i,[e,r])=>al(e.evaluate(i),r.evaluate(i))]]},get:{type:yt,overloads:[[[nt],(i,[e])=>Ya(e.evaluate(i),i.properties())],[[nt,ji],(i,[e,r])=>Ya(e.evaluate(i),r.evaluate(i))]]},"feature-state":[yt,[nt],(i,[e])=>Ya(e.evaluate(i),i.featureState||{})],properties:[ji,[],i=>i.properties()],"geometry-type":[nt,[],i=>i.geometryType()],id:[yt,[],i=>i.id()],zoom:[Ce,[],i=>i.globals.zoom],"heatmap-density":[Ce,[],i=>i.globals.heatmapDensity||0],"line-progress":[Ce,[],i=>i.globals.lineProgress||0],accumulated:[yt,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Ce,Fn(Ce),(i,e)=>{let r=0;for(const s of e)r+=s.evaluate(i);return r}],"*":[Ce,Fn(Ce),(i,e)=>{let r=1;for(const s of e)r*=s.evaluate(i);return r}],"-":{type:Ce,overloads:[[[Ce,Ce],(i,[e,r])=>e.evaluate(i)-r.evaluate(i)],[[Ce],(i,[e])=>-e.evaluate(i)]]},"/":[Ce,[Ce,Ce],(i,[e,r])=>e.evaluate(i)/r.evaluate(i)],"%":[Ce,[Ce,Ce],(i,[e,r])=>e.evaluate(i)%r.evaluate(i)],ln2:[Ce,[],()=>Math.LN2],pi:[Ce,[],()=>Math.PI],e:[Ce,[],()=>Math.E],"^":[Ce,[Ce,Ce],(i,[e,r])=>Math.pow(e.evaluate(i),r.evaluate(i))],sqrt:[Ce,[Ce],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[Ce,[Ce],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[Ce,[Ce],(i,[e])=>Math.log(e.evaluate(i))],log2:[Ce,[Ce],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[Ce,[Ce],(i,[e])=>Math.sin(e.evaluate(i))],cos:[Ce,[Ce],(i,[e])=>Math.cos(e.evaluate(i))],tan:[Ce,[Ce],(i,[e])=>Math.tan(e.evaluate(i))],asin:[Ce,[Ce],(i,[e])=>Math.asin(e.evaluate(i))],acos:[Ce,[Ce],(i,[e])=>Math.acos(e.evaluate(i))],atan:[Ce,[Ce],(i,[e])=>Math.atan(e.evaluate(i))],min:[Ce,Fn(Ce),(i,e)=>Math.min(...e.map(r=>r.evaluate(i)))],max:[Ce,Fn(Ce),(i,e)=>Math.max(...e.map(r=>r.evaluate(i)))],abs:[Ce,[Ce],(i,[e])=>Math.abs(e.evaluate(i))],round:[Ce,[Ce],(i,[e])=>{const r=e.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[Ce,[Ce],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[Ce,[Ce],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[lt,[nt,yt],(i,[e,r])=>i.properties()[e.value]===r.value],"filter-id-==":[lt,[yt],(i,[e])=>i.id()===e.value],"filter-type-==":[lt,[nt],(i,[e])=>i.geometryType()===e.value],"filter-<":[lt,[nt,yt],(i,[e,r])=>{const s=i.properties()[e.value],l=r.value;return typeof s==typeof l&&s<l}],"filter-id-<":[lt,[yt],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r<s}],"filter->":[lt,[nt,yt],(i,[e,r])=>{const s=i.properties()[e.value],l=r.value;return typeof s==typeof l&&s>l}],"filter-id->":[lt,[yt],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r>s}],"filter-<=":[lt,[nt,yt],(i,[e,r])=>{const s=i.properties()[e.value],l=r.value;return typeof s==typeof l&&s<=l}],"filter-id-<=":[lt,[yt],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r<=s}],"filter->=":[lt,[nt,yt],(i,[e,r])=>{const s=i.properties()[e.value],l=r.value;return typeof s==typeof l&&s>=l}],"filter-id->=":[lt,[yt],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r>=s}],"filter-has":[lt,[yt],(i,[e])=>e.value in i.properties()],"filter-has-id":[lt,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[lt,[G(nt)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[lt,[G(yt)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[lt,[nt,G(yt)],(i,[e,r])=>r.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[lt,[nt,G(yt)],(i,[e,r])=>function(s,l,h,p){for(;h<=p;){const f=h+p>>1;if(l[f]===s)return!0;l[f]>s?p=f-1:h=f+1}return!1}(i.properties()[e.value],r.value,0,r.value.length-1)],all:{type:lt,overloads:[[[lt,lt],(i,[e,r])=>e.evaluate(i)&&r.evaluate(i)],[Fn(lt),(i,e)=>{for(const r of e)if(!r.evaluate(i))return!1;return!0}]]},any:{type:lt,overloads:[[[lt,lt],(i,[e,r])=>e.evaluate(i)||r.evaluate(i)],[Fn(lt),(i,e)=>{for(const r of e)if(r.evaluate(i))return!0;return!1}]]},"!":[lt,[lt],(i,[e])=>!e.evaluate(i)],"is-supported-script":[lt,[nt],(i,[e])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(e.evaluate(i))}],upcase:[nt,[nt],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[nt,[nt],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[nt,Fn(yt),(i,e)=>e.map(r=>Ot(r.evaluate(i))).join("")],"resolved-locale":[nt,[ln],(i,[e])=>e.evaluate(i).resolvedLocale()]});class Qa{constructor(e,r){var s;this.expression=e,this._warningHistory={},this._evaluator=new Ba,this._defaultValue=r?(s=r).type==="color"&&ci(s.default)?new qt(0,0,0,0):s.type==="color"?qt.parse(s.default)||null:s.type==="padding"?Cr.parse(s.default)||null:s.type==="variableAnchorOffsetCollection"?Fr.parse(s.default)||null:s.default===void 0?null:s.default:null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,s,l,h,p){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=s,this._evaluator.canonical=l,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=p,this.expression.evaluate(this._evaluator)}evaluate(e,r,s,l,h,p){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=s||null,this._evaluator.canonical=l,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=p||null;try{const f=this.expression.evaluate(this._evaluator);if(f==null||typeof f=="number"&&f!=f)return this._defaultValue;if(this._enumValues&&!(f in this._enumValues))throw new pi(`Expected value to be one of ${Object.keys(this._enumValues).map(_=>JSON.stringify(_)).join(", ")}, but found ${JSON.stringify(f)} instead.`);return f}catch(f){return this._warningHistory[f.message]||(this._warningHistory[f.message]=!0,typeof console<"u"&&console.warn(f.message)),this._defaultValue}}}function la(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in is}function ca(i,e){const r=new Xs(is,Qs,[],e?function(l){const h={color:_i,string:nt,number:Ce,enum:nt,boolean:lt,formatted:q,padding:k,resolvedImage:P,variableAnchorOffsetCollection:O};return l.type==="array"?G(h[l.value]||yt,l.length):h[l.type]}(e):void 0),s=r.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return s?ol(new Qa(s,e)):In(r.errors)}class eo{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!ws(r.expression)}evaluateWithoutErrorHandling(e,r,s,l,h,p){return this._styleExpression.evaluateWithoutErrorHandling(e,r,s,l,h,p)}evaluate(e,r,s,l,h,p){return this._styleExpression.evaluate(e,r,s,l,h,p)}}class ua{constructor(e,r,s,l){this.kind=e,this.zoomStops=s,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!ws(r.expression),this.interpolationType=l}evaluateWithoutErrorHandling(e,r,s,l,h,p){return this._styleExpression.evaluateWithoutErrorHandling(e,r,s,l,h,p)}evaluate(e,r,s,l,h,p){return this._styleExpression.evaluate(e,r,s,l,h,p)}interpolationFactor(e,r,s){return this.interpolationType?Ir.interpolationFactor(this.interpolationType,e,r,s):0}}function to(i,e){const r=ca(i,e);if(r.result==="error")return r;const s=r.value.expression,l=ea(s);if(!l&&!rs(e))return In([new dt("","data expressions not supported")]);const h=ta(s,["zoom"]);if(!h&&!ll(e))return In([new dt("","zoom expressions not supported")]);const p=Ts(s);return p||h?p instanceof dt?In([p]):p instanceof Ir&&!Ja(e)?In([new dt("",'"interpolate" expressions cannot be used with this property')]):ol(p?new ua(l?"camera":"composite",r.value,p.labels,p instanceof Ir?p.interpolation:void 0):new eo(l?"constant":"source",r.value)):In([new dt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Cs{constructor(e,r){this._parameters=e,this._specification=r,mt(this,Pt(this._parameters,this._specification))}static deserialize(e){return new Cs(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Ts(i){let e=null;if(i instanceof na)e=Ts(i.result);else if(i instanceof ra){for(const r of i.args)if(e=Ts(r),e)break}else(i instanceof Tn||i instanceof Ir)&&i.input instanceof Or&&i.input.name==="zoom"&&(e=i);return e instanceof dt||i.eachChild(r=>{const s=Ts(r);s instanceof dt?e=s:!e&&s?e=new dt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&s&&e!==s&&(e=new dt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Is(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!Is(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const Cc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function io(i){if(i==null)return{filter:()=>!0,needGeometry:!1};Is(i)||(i=ha(i));const e=ca(i,Cc);if(e.result==="error")throw new Error(e.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,s,l)=>e.value.evaluate(r,s,{},l),needGeometry:ul(i)}}function Tc(i,e){return i<e?-1:i>e?1:0}function ul(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(ul(i[e]))return!0;return!1}function ha(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?ro(i[1],i[2],"=="):e==="!="?Es(ro(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?ro(i[1],i[2],e):e==="any"?(r=i.slice(1),["any"].concat(r.map(ha))):e==="all"?["all"].concat(i.slice(1).map(ha)):e==="none"?["all"].concat(i.slice(1).map(ha).map(Es)):e==="in"?hl(i[1],i.slice(2)):e==="!in"?Es(hl(i[1],i.slice(2))):e==="has"?dl(i[1]):e==="!has"?Es(dl(i[1])):e!=="within"||i;var r}function ro(i,e,r){switch(i){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,i,e]}}function hl(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",i,["literal",e.sort(Tc)]]:["filter-in-small",i,["literal",e]]}}function dl(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Es(i){return["!",i]}function da(i){const e=typeof i;if(e==="number"||e==="boolean"||e==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let l="[";for(const h of i)l+=`${da(h)},`;return`${l}]`}const r=Object.keys(i).sort();let s="{";for(let l=0;l<r.length;l++)s+=`${JSON.stringify(r[l])}:${da(i[r[l]])},`;return`${s}}`}function pa(i){let e="";for(const r of Ii)e+=`/${da(i[r])}`;return e}function pl(i){const e=i.value;return e?[new Ae(i.key,e,"constants have been deprecated as of v8")]:[]}function fi(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function On(i){if(Array.isArray(i))return i.map(On);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const r in i)e[r]=On(i[r]);return e}return fi(i)}function mr(i){const e=i.key,r=i.value,s=i.valueSpec||{},l=i.objectElementValidators||{},h=i.style,p=i.styleSpec,f=i.validateSpec;let _=[];const v=Nt(r);if(v!=="object")return[new Ae(e,r,`object expected, ${v} found`)];for(const S in r){const I=S.split(".")[0],A=s[I]||s["*"];let L;if(l[I])L=l[I];else if(s[I])L=f;else if(l["*"])L=l["*"];else{if(!s["*"]){_.push(new Ae(e,r[S],`unknown property "${S}"`));continue}L=f}_=_.concat(L({key:(e&&`${e}.`)+S,value:r[S],valueSpec:A,style:h,styleSpec:p,object:r,objectKey:S,validateSpec:f},r))}for(const S in s)l[S]||s[S].required&&s[S].default===void 0&&r[S]===void 0&&_.push(new Ae(e,r,`missing required property "${S}"`));return _}function ns(i){const e=i.value,r=i.valueSpec,s=i.style,l=i.styleSpec,h=i.key,p=i.arrayElementValidator||i.validateSpec;if(Nt(e)!=="array")return[new Ae(h,e,`array expected, ${Nt(e)} found`)];if(r.length&&e.length!==r.length)return[new Ae(h,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new Ae(h,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let f={type:r.value,values:r.values};l.$version<7&&(f.function=r.function),Nt(r.value)==="object"&&(f=r.value);let _=[];for(let v=0;v<e.length;v++)_=_.concat(p({array:e,arrayIndex:v,value:e[v],valueSpec:f,validateSpec:i.validateSpec,style:s,styleSpec:l,key:`${h}[${v}]`}));return _}function Ms(i){const e=i.key,r=i.value,s=i.valueSpec;let l=Nt(r);return l==="number"&&r!=r&&(l="NaN"),l!=="number"?[new Ae(e,r,`number expected, ${l} found`)]:"minimum"in s&&r<s.minimum?[new Ae(e,r,`${r} is less than the minimum value ${s.minimum}`)]:"maximum"in s&&r>s.maximum?[new Ae(e,r,`${r} is greater than the maximum value ${s.maximum}`)]:[]}function fa(i){const e=i.valueSpec,r=fi(i.value.type);let s,l,h,p={};const f=r!=="categorical"&&i.value.property===void 0,_=!f,v=Nt(i.value.stops)==="array"&&Nt(i.value.stops[0])==="array"&&Nt(i.value.stops[0][0])==="object",S=mr({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(L){if(r==="identity")return[new Ae(L.key,L.value,'identity function may not have a "stops" property')];let R=[];const $=L.value;return R=R.concat(ns({key:L.key,value:$,valueSpec:L.valueSpec,validateSpec:L.validateSpec,style:L.style,styleSpec:L.styleSpec,arrayElementValidator:I})),Nt($)==="array"&&$.length===0&&R.push(new Ae(L.key,$,"array must have at least one stop")),R},default:function(L){return L.validateSpec({key:L.key,value:L.value,valueSpec:e,validateSpec:L.validateSpec,style:L.style,styleSpec:L.styleSpec})}}});return r==="identity"&&f&&S.push(new Ae(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||S.push(new Ae(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!Ja(i.valueSpec)&&S.push(new Ae(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(_&&!rs(i.valueSpec)?S.push(new Ae(i.key,i.value,"property functions not supported")):f&&!ll(i.valueSpec)&&S.push(new Ae(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!v||i.value.property!==void 0||S.push(new Ae(i.key,i.value,'"property" property is required')),S;function I(L){let R=[];const $=L.value,W=L.key;if(Nt($)!=="array")return[new Ae(W,$,`array expected, ${Nt($)} found`)];if($.length!==2)return[new Ae(W,$,`array length 2 expected, length ${$.length} found`)];if(v){if(Nt($[0])!=="object")return[new Ae(W,$,`object expected, ${Nt($[0])} found`)];if($[0].zoom===void 0)return[new Ae(W,$,"object stop key must have zoom")];if($[0].value===void 0)return[new Ae(W,$,"object stop key must have value")];if(h&&h>fi($[0].zoom))return[new Ae(W,$[0].zoom,"stop zoom values must appear in ascending order")];fi($[0].zoom)!==h&&(h=fi($[0].zoom),l=void 0,p={}),R=R.concat(mr({key:`${W}[0]`,value:$[0],valueSpec:{zoom:{}},validateSpec:L.validateSpec,style:L.style,styleSpec:L.styleSpec,objectElementValidators:{zoom:Ms,value:A}}))}else R=R.concat(A({key:`${W}[0]`,value:$[0],valueSpec:{},validateSpec:L.validateSpec,style:L.style,styleSpec:L.styleSpec},$));return la(On($[1]))?R.concat([new Ae(`${W}[1]`,$[1],"expressions are not allowed in function stops.")]):R.concat(L.validateSpec({key:`${W}[1]`,value:$[1],valueSpec:e,validateSpec:L.validateSpec,style:L.style,styleSpec:L.styleSpec}))}function A(L,R){const $=Nt(L.value),W=fi(L.value),Y=L.value!==null?L.value:R;if(s){if($!==s)return[new Ae(L.key,Y,`${$} stop domain type must match previous stop domain type ${s}`)]}else s=$;if($!=="number"&&$!=="string"&&$!=="boolean")return[new Ae(L.key,Y,"stop domain value must be a number, string, or boolean")];if($!=="number"&&r!=="categorical"){let se=`number expected, ${$} found`;return rs(e)&&r===void 0&&(se+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ae(L.key,Y,se)]}return r!=="categorical"||$!=="number"||isFinite(W)&&Math.floor(W)===W?r!=="categorical"&&$==="number"&&l!==void 0&&W<l?[new Ae(L.key,Y,"stop domain values must appear in ascending order")]:(l=W,r==="categorical"&&W in p?[new Ae(L.key,Y,"stop domain values must be unique")]:(p[W]=!0,[])):[new Ae(L.key,Y,`integer expected, found ${W}`)]}}function Nn(i){const e=(i.expressionContext==="property"?to:ca)(On(i.value),i.valueSpec);if(e.result==="error")return e.value.map(s=>new Ae(`${i.key}${s.key}`,i.value,s.message));const r=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new Ae(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!ws(r))return[new Ae(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!ws(r))return[new Ae(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!ta(r,["zoom","feature-state"]))return[new Ae(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!ea(r))return[new Ae(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ks(i){const e=i.key,r=i.value,s=i.valueSpec,l=[];return Array.isArray(s.values)?s.values.indexOf(fi(r))===-1&&l.push(new Ae(e,r,`expected one of [${s.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(s.values).indexOf(fi(r))===-1&&l.push(new Ae(e,r,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(r)} found`)),l}function ss(i){return Is(On(i.value))?Nn(mt({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):fl(i)}function fl(i){const e=i.value,r=i.key;if(Nt(e)!=="array")return[new Ae(r,e,`array expected, ${Nt(e)} found`)];const s=i.styleSpec;let l,h=[];if(e.length<1)return[new Ae(r,e,"filter array must have at least 1 element")];switch(h=h.concat(ks({key:`${r}[0]`,value:e[0],valueSpec:s.filter_operator,style:i.style,styleSpec:i.styleSpec})),fi(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&fi(e[1])==="$type"&&h.push(new Ae(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&h.push(new Ae(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(l=Nt(e[1]),l!=="string"&&h.push(new Ae(`${r}[1]`,e[1],`string expected, ${l} found`)));for(let p=2;p<e.length;p++)l=Nt(e[p]),fi(e[1])==="$type"?h=h.concat(ks({key:`${r}[${p}]`,value:e[p],valueSpec:s.geometry_type,style:i.style,styleSpec:i.styleSpec})):l!=="string"&&l!=="number"&&l!=="boolean"&&h.push(new Ae(`${r}[${p}]`,e[p],`string, number, or boolean expected, ${l} found`));break;case"any":case"all":case"none":for(let p=1;p<e.length;p++)h=h.concat(fl({key:`${r}[${p}]`,value:e[p],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":l=Nt(e[1]),e.length!==2?h.push(new Ae(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):l!=="string"&&h.push(new Ae(`${r}[1]`,e[1],`string expected, ${l} found`));break;case"within":l=Nt(e[1]),e.length!==2?h.push(new Ae(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):l!=="object"&&h.push(new Ae(`${r}[1]`,e[1],`object expected, ${l} found`))}return h}function ml(i,e){const r=i.key,s=i.validateSpec,l=i.style,h=i.styleSpec,p=i.value,f=i.objectKey,_=h[`${e}_${i.layerType}`];if(!_)return[];const v=f.match(/^(.*)-transition$/);if(e==="paint"&&v&&_[v[1]]&&_[v[1]].transition)return s({key:r,value:p,valueSpec:h.transition,style:l,styleSpec:h});const S=i.valueSpec||_[f];if(!S)return[new Ae(r,p,`unknown property "${f}"`)];let I;if(Nt(p)==="string"&&rs(S)&&!S.tokens&&(I=/^{([^}]+)}$/.exec(p)))return[new Ae(r,p,`"${f}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(I[1])} }\`.`)];const A=[];return i.layerType==="symbol"&&(f==="text-field"&&l&&!l.glyphs&&A.push(new Ae(r,p,'use of "text-field" requires a style "glyphs" property')),f==="text-font"&&ci(On(p))&&fi(p.type)==="identity"&&A.push(new Ae(r,p,'"text-font" does not support identity functions'))),A.concat(s({key:i.key,value:p,valueSpec:S,style:l,styleSpec:h,expressionContext:"property",propertyType:e,propertyKey:f}))}function gl(i){return ml(i,"paint")}function _l(i){return ml(i,"layout")}function yl(i){let e=[];const r=i.value,s=i.key,l=i.style,h=i.styleSpec;r.type||r.ref||e.push(new Ae(s,r,'either "type" or "ref" is required'));let p=fi(r.type);const f=fi(r.ref);if(r.id){const _=fi(r.id);for(let v=0;v<i.arrayIndex;v++){const S=l.layers[v];fi(S.id)===_&&e.push(new Ae(s,r.id,`duplicate layer id "${r.id}", previously used at line ${S.id.__line__}`))}}if("ref"in r){let _;["type","source","source-layer","filter","layout"].forEach(v=>{v in r&&e.push(new Ae(s,r[v],`"${v}" is prohibited for ref layers`))}),l.layers.forEach(v=>{fi(v.id)===f&&(_=v)}),_?_.ref?e.push(new Ae(s,r.ref,"ref cannot reference another ref layer")):p=fi(_.type):e.push(new Ae(s,r.ref,`ref layer "${f}" not found`))}else if(p!=="background")if(r.source){const _=l.sources&&l.sources[r.source],v=_&&fi(_.type);_?v==="vector"&&p==="raster"?e.push(new Ae(s,r.source,`layer "${r.id}" requires a raster source`)):v!=="raster-dem"&&p==="hillshade"?e.push(new Ae(s,r.source,`layer "${r.id}" requires a raster-dem source`)):v==="raster"&&p!=="raster"?e.push(new Ae(s,r.source,`layer "${r.id}" requires a vector source`)):v!=="vector"||r["source-layer"]?v==="raster-dem"&&p!=="hillshade"?e.push(new Ae(s,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):p!=="line"||!r.paint||!r.paint["line-gradient"]||v==="geojson"&&_.lineMetrics||e.push(new Ae(s,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Ae(s,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new Ae(s,r.source,`source "${r.source}" not found`))}else e.push(new Ae(s,r,'missing required property "source"'));return e=e.concat(mr({key:s,value:r,valueSpec:h.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${s}.type`,value:r.type,valueSpec:h.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:r,objectKey:"type"}),filter:ss,layout:_=>mr({layer:r,key:_.key,value:_.value,style:_.style,styleSpec:_.styleSpec,validateSpec:_.validateSpec,objectElementValidators:{"*":v=>_l(mt({layerType:p},v))}}),paint:_=>mr({layer:r,key:_.key,value:_.value,style:_.style,styleSpec:_.styleSpec,validateSpec:_.validateSpec,objectElementValidators:{"*":v=>gl(mt({layerType:p},v))}})}})),e}function Jr(i){const e=i.value,r=i.key,s=Nt(e);return s!=="string"?[new Ae(r,e,`string expected, ${s} found`)]:[]}const As={promoteId:function({key:i,value:e}){if(Nt(e)==="string")return Jr({key:i,value:e});{const r=[];for(const s in e)r.push(...Jr({key:`${i}.${s}`,value:e[s]}));return r}}};function Er(i){const e=i.value,r=i.key,s=i.styleSpec,l=i.style,h=i.validateSpec;if(!e.type)return[new Ae(r,e,'"type" is required')];const p=fi(e.type);let f;switch(p){case"vector":case"raster":return f=mr({key:r,value:e,valueSpec:s[`source_${p.replace("-","_")}`],style:i.style,styleSpec:s,objectElementValidators:As,validateSpec:h}),f;case"raster-dem":return f=function(_){var v;const S=(v=_.sourceName)!==null&&v!==void 0?v:"",I=_.value,A=_.styleSpec,L=A.source_raster_dem,R=_.style;let $=[];const W=Nt(I);if(I===void 0)return $;if(W!=="object")return $.push(new Ae("source_raster_dem",I,`object expected, ${W} found`)),$;const Y=fi(I.encoding)==="custom",se=["redFactor","greenFactor","blueFactor","baseShift"],Q=_.value.encoding?`"${_.value.encoding}"`:"Default";for(const oe in I)!Y&&se.includes(oe)?$.push(new Ae(oe,I[oe],`In "${S}": "${oe}" is only valid when "encoding" is set to "custom". ${Q} encoding found`)):L[oe]?$=$.concat(_.validateSpec({key:oe,value:I[oe],valueSpec:L[oe],validateSpec:_.validateSpec,style:R,styleSpec:A})):$.push(new Ae(oe,I[oe],`unknown property "${oe}"`));return $}({sourceName:r,value:e,style:i.style,styleSpec:s,validateSpec:h}),f;case"geojson":if(f=mr({key:r,value:e,valueSpec:s.source_geojson,style:l,styleSpec:s,validateSpec:h,objectElementValidators:As}),e.cluster)for(const _ in e.clusterProperties){const[v,S]=e.clusterProperties[_],I=typeof v=="string"?[v,["accumulated"],["get",_]]:v;f.push(...Nn({key:`${r}.${_}.map`,value:S,validateSpec:h,expressionContext:"cluster-map"})),f.push(...Nn({key:`${r}.${_}.reduce`,value:I,validateSpec:h,expressionContext:"cluster-reduce"}))}return f;case"video":return mr({key:r,value:e,valueSpec:s.source_video,style:l,validateSpec:h,styleSpec:s});case"image":return mr({key:r,value:e,valueSpec:s.source_image,style:l,validateSpec:h,styleSpec:s});case"canvas":return[new Ae(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ks({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:l,validateSpec:h,styleSpec:s})}}function Ps(i){const e=i.value,r=i.styleSpec,s=r.light,l=i.style;let h=[];const p=Nt(e);if(e===void 0)return h;if(p!=="object")return h=h.concat([new Ae("light",e,`object expected, ${p} found`)]),h;for(const f in e){const _=f.match(/^(.*)-transition$/);h=h.concat(_&&s[_[1]]&&s[_[1]].transition?i.validateSpec({key:f,value:e[f],valueSpec:r.transition,validateSpec:i.validateSpec,style:l,styleSpec:r}):s[f]?i.validateSpec({key:f,value:e[f],valueSpec:s[f],validateSpec:i.validateSpec,style:l,styleSpec:r}):[new Ae(f,e[f],`unknown property "${f}"`)])}return h}function xl(i){const e=i.value,r=i.styleSpec,s=r.terrain,l=i.style;let h=[];const p=Nt(e);if(e===void 0)return h;if(p!=="object")return h=h.concat([new Ae("terrain",e,`object expected, ${p} found`)]),h;for(const f in e)h=h.concat(s[f]?i.validateSpec({key:f,value:e[f],valueSpec:s[f],validateSpec:i.validateSpec,style:l,styleSpec:r}):[new Ae(f,e[f],`unknown property "${f}"`)]);return h}function vl(i){let e=[];const r=i.value,s=i.key;if(Array.isArray(r)){const l=[],h=[];for(const p in r)r[p].id&&l.includes(r[p].id)&&e.push(new Ae(s,r,`all the sprites' ids must be unique, but ${r[p].id} is duplicated`)),l.push(r[p].id),r[p].url&&h.includes(r[p].url)&&e.push(new Ae(s,r,`all the sprites' URLs must be unique, but ${r[p].url} is duplicated`)),h.push(r[p].url),e=e.concat(mr({key:`${s}[${p}]`,value:r[p],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return e}return Jr({key:s,value:r})}const bl={"*":()=>[],array:ns,boolean:function(i){const e=i.value,r=i.key,s=Nt(e);return s!=="boolean"?[new Ae(r,e,`boolean expected, ${s} found`)]:[]},number:Ms,color:function(i){const e=i.key,r=i.value,s=Nt(r);return s!=="string"?[new Ae(e,r,`color expected, ${s} found`)]:qt.parse(String(r))?[]:[new Ae(e,r,`color expected, "${r}" found`)]},constants:pl,enum:ks,filter:ss,function:fa,layer:yl,object:mr,source:Er,light:Ps,terrain:xl,string:Jr,formatted:function(i){return Jr(i).length===0?[]:Nn(i)},resolvedImage:function(i){return Jr(i).length===0?[]:Nn(i)},padding:function(i){const e=i.key,r=i.value;if(Nt(r)==="array"){if(r.length<1||r.length>4)return[new Ae(e,r,`padding requires 1 to 4 values; ${r.length} values found`)];const s={type:"number"};let l=[];for(let h=0;h<r.length;h++)l=l.concat(i.validateSpec({key:`${e}[${h}]`,value:r[h],validateSpec:i.validateSpec,valueSpec:s}));return l}return Ms({key:e,value:r,valueSpec:{}})},variableAnchorOffsetCollection:function(i){const e=i.key,r=i.value,s=Nt(r),l=i.styleSpec;if(s!=="array"||r.length<1||r.length%2!=0)return[new Ae(e,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let h=[];for(let p=0;p<r.length;p+=2)h=h.concat(ks({key:`${e}[${p}]`,value:r[p],valueSpec:l.layout_symbol["text-anchor"]})),h=h.concat(ns({key:`${e}[${p+1}]`,value:r[p+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:l}));return h},sprite:vl};function cn(i){const e=i.value,r=i.valueSpec,s=i.styleSpec;return i.validateSpec=cn,r.expression&&ci(fi(e))?fa(i):r.expression&&la(On(e))?Nn(i):r.type&&bl[r.type]?bl[r.type](i):mr(mt({},i,{valueSpec:r.type?s[r.type]:r}))}function wl(i){const e=i.value,r=i.key,s=Jr(i);return s.length||(e.indexOf("{fontstack}")===-1&&s.push(new Ae(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&s.push(new Ae(r,e,'"glyphs" url must include a "{range}" token'))),s}function Nr(i,e=fe){let r=[];return r=r.concat(cn({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,validateSpec:cn,objectElementValidators:{glyphs:wl,"*":()=>[]}})),i.constants&&(r=r.concat(pl({key:"constants",value:i.constants,style:i,styleSpec:e,validateSpec:cn}))),ma(r)}function un(i){return function(e){return i({...e,validateSpec:cn})}}function ma(i){return[].concat(i).sort((e,r)=>e.line-r.line)}function hn(i){return function(...e){return ma(i.apply(this,e))}}Nr.source=hn(un(Er)),Nr.sprite=hn(un(vl)),Nr.glyphs=hn(un(wl)),Nr.light=hn(un(Ps)),Nr.terrain=hn(un(xl)),Nr.layer=hn(un(yl)),Nr.filter=hn(un(ss)),Nr.paintProperty=hn(un(gl)),Nr.layoutProperty=hn(un(_l));const dn=Nr,Ic=dn.light,no=dn.paintProperty,Sl=dn.layoutProperty;function ga(i,e){let r=!1;if(e&&e.length)for(const s of e)i.fire(new fr(new Error(s.message))),r=!0;return r}class as{constructor(e,r,s){const l=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const p=new Int32Array(this.arrayBuffer);e=p[0],this.d=(r=p[1])+2*(s=p[2]);for(let _=0;_<this.d*this.d;_++){const v=p[3+_],S=p[3+_+1];l.push(v===S?null:p.subarray(v,S))}const f=p[3+l.length+1];this.keys=p.subarray(p[3+l.length],f),this.bboxes=p.subarray(f),this.insert=this._insertReadonly}else{this.d=r+2*s;for(let p=0;p<this.d*this.d;p++)l.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=e,this.padding=s,this.scale=r/e,this.uid=0;const h=s/r*e;this.min=-h,this.max=e+h}insert(e,r,s,l,h){this._forEachCell(r,s,l,h,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(r),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(h)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,r,s,l,h,p){this.cells[h].push(p)}query(e,r,s,l,h){const p=this.min,f=this.max;if(e<=p&&r<=p&&f<=s&&f<=l&&!h)return Array.prototype.slice.call(this.keys);{const _=[];return this._forEachCell(e,r,s,l,this._queryCell,_,{},h),_}}_queryCell(e,r,s,l,h,p,f,_){const v=this.cells[h];if(v!==null){const S=this.keys,I=this.bboxes;for(let A=0;A<v.length;A++){const L=v[A];if(f[L]===void 0){const R=4*L;(_?_(I[R+0],I[R+1],I[R+2],I[R+3]):e<=I[R+2]&&r<=I[R+3]&&s>=I[R+0]&&l>=I[R+1])?(f[L]=!0,p.push(S[L])):f[L]=!1}}}}_forEachCell(e,r,s,l,h,p,f,_){const v=this._convertToCellCoord(e),S=this._convertToCellCoord(r),I=this._convertToCellCoord(s),A=this._convertToCellCoord(l);for(let L=v;L<=I;L++)for(let R=S;R<=A;R++){const $=this.d*R+L;if((!_||_(this._convertFromCellCoord(L),this._convertFromCellCoord(R),this._convertFromCellCoord(L+1),this._convertFromCellCoord(R+1)))&&h.call(this,e,r,s,l,$,p,f,_))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,r=3+this.cells.length+1+1;let s=0;for(let p=0;p<this.cells.length;p++)s+=this.cells[p].length;const l=new Int32Array(r+s+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;let h=r;for(let p=0;p<e.length;p++){const f=e[p];l[3+p]=h,l.set(f,h),h+=f.length}return l[3+e.length]=h,l.set(this.keys,h),h+=this.keys.length,l[3+e.length+1]=h,l.set(this.bboxes,h),h+=this.bboxes.length,l.buffer}static serialize(e,r){const s=e.toArrayBuffer();return r&&r.push(s),{buffer:s}}static deserialize(e){return new as(e.buffer)}}const pn={};function Ze(i,e,r={}){if(pn[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),pn[i]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}Ze("Object",Object),Ze("TransferableGridIndex",as),Ze("Color",qt),Ze("Error",Error),Ze("AJAXError",gi),Ze("ResolvedImage",Zi),Ze("StylePropertyFunction",Cs),Ze("StyleExpression",Qa,{omit:["_evaluator"]}),Ze("ZoomDependentExpression",ua),Ze("ZoomConstantExpression",eo),Ze("CompoundExpression",Or,{omit:["_evaluate"]});for(const i in is)is[i]._classRegistryKey||Ze(`Expression_${i}`,is[i]);function _a(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function En(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob)return i;if(_a(i)||Ai(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const r=i;return e&&e.push(r.buffer),r}if(i instanceof ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const r=[];for(const s of i)r.push(En(s,e));return r}if(typeof i=="object"){const r=i.constructor,s=r._classRegistryKey;if(!s)throw new Error("can't serialize object of unregistered class");if(!pn[s])throw new Error(`${s} is not registered.`);const l=r.serialize?r.serialize(i,e):{};if(r.serialize){if(e&&l===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const h in i){if(!i.hasOwnProperty(h)||pn[s].omit.indexOf(h)>=0)continue;const p=i[h];l[h]=pn[s].shallow.indexOf(h)>=0?p:En(p,e)}i instanceof Error&&(l.message=i.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(l.$name=s),l}throw new Error("can't serialize object of type "+typeof i)}function os(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||_a(i)||Ai(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(os);if(typeof i=="object"){const e=i.$name||"Object";if(!pn[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:r}=pn[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(i);const s=Object.create(r.prototype);for(const l of Object.keys(i)){if(l==="$name")continue;const h=i[l];s[l]=pn[e].shallow.indexOf(l)>=0?h:os(h)}return s}throw new Error("can't deserialize object of type "+typeof i)}class Cl{constructor(){this.first=!0}update(e,r){const s=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=s,!0))}}const je={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function so(i){for(const e of i)if(oo(e.charCodeAt(0)))return!0;return!1}function ao(i){for(const e of i)if(!Ec(e.charCodeAt(0)))return!1;return!0}function Ec(i){return!(je.Arabic(i)||je["Arabic Supplement"](i)||je["Arabic Extended-A"](i)||je["Arabic Presentation Forms-A"](i)||je["Arabic Presentation Forms-B"](i))}function oo(i){return!(i!==746&&i!==747&&(i<4352||!(je["Bopomofo Extended"](i)||je.Bopomofo(i)||je["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||je["CJK Compatibility Ideographs"](i)||je["CJK Compatibility"](i)||je["CJK Radicals Supplement"](i)||je["CJK Strokes"](i)||!(!je["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||je["CJK Unified Ideographs Extension A"](i)||je["CJK Unified Ideographs"](i)||je["Enclosed CJK Letters and Months"](i)||je["Hangul Compatibility Jamo"](i)||je["Hangul Jamo Extended-A"](i)||je["Hangul Jamo Extended-B"](i)||je["Hangul Jamo"](i)||je["Hangul Syllables"](i)||je.Hiragana(i)||je["Ideographic Description Characters"](i)||je.Kanbun(i)||je["Kangxi Radicals"](i)||je["Katakana Phonetic Extensions"](i)||je.Katakana(i)&&i!==12540||!(!je["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!je["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||je["Unified Canadian Aboriginal Syllabics"](i)||je["Unified Canadian Aboriginal Syllabics Extended"](i)||je["Vertical Forms"](i)||je["Yijing Hexagram Symbols"](i)||je["Yi Syllables"](i)||je["Yi Radicals"](i))))}function Tl(i){return!(oo(i)||function(e){return!!(je["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||je["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||je["Letterlike Symbols"](e)||je["Number Forms"](e)||je["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||je["Control Pictures"](e)&&e!==9251||je["Optical Character Recognition"](e)||je["Enclosed Alphanumerics"](e)||je["Geometric Shapes"](e)||je["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||je["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||je["CJK Symbols and Punctuation"](e)||je.Katakana(e)||je["Private Use Area"](e)||je["CJK Compatibility Forms"](e)||je["Small Form Variants"](e)||je["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function Il(i){return i>=1424&&i<=2303||je["Arabic Presentation Forms-A"](i)||je["Arabic Presentation Forms-B"](i)}function El(i,e){return!(!e&&Il(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||je.Khmer(i))}function Mc(i){for(const e of i)if(Il(e.charCodeAt(0)))return!0;return!1}const lo="deferred",co="loading",uo="loaded";let ho=null,gr="unavailable",Mn=null;const zs=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(gr="error"),ho&&ho(i)};function po(){Ds.fire(new nr("pluginStateChange",{pluginStatus:gr,pluginURL:Mn}))}const Ds=new Sr,fo=function(){return gr},Ml=function(){if(gr!==lo||!Mn)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");gr=co,po(),Mn&&Wt({url:Mn},i=>{i?zs(i):(gr=uo,po())})},Mr={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>gr===uo||Mr.applyArabicShaping!=null,isLoading:()=>gr===co,setState(i){if(!ft())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");gr=i.pluginStatus,Mn=i.pluginURL},isParsed(){if(!ft())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return Mr.applyArabicShaping!=null&&Mr.processBidirectionalText!=null&&Mr.processStyledBidirectionalText!=null},getPluginURL(){if(!ft())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Mn}};class ti{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Cl,this.transition={})}isSupportedScript(e){return function(r,s){for(const l of r)if(!El(l.charCodeAt(0),s))return!1;return!0}(e,Mr.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),s=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*r}}}class ya{constructor(e,r){this.property=e,this.value=r,this.expression=function(s,l){if(ci(s))return new Cs(s,l);if(la(s)){const h=to(s,l);if(h.result==="error")throw new Error(h.value.map(p=>`${p.key}: ${p.message}`).join(", "));return h.value}{let h=s;return l.type==="color"&&typeof s=="string"?h=qt.parse(s):l.type!=="padding"||typeof s!="number"&&!Array.isArray(s)?l.type==="variableAnchorOffsetCollection"&&Array.isArray(s)&&(h=Fr.parse(s)):h=Cr.parse(s),{kind:"constant",evaluate:()=>h}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,s){return this.property.possiblyEvaluate(this,e,r,s)}}class mo{constructor(e){this.property=e,this.value=new ya(e,void 0)}transitioned(e,r){return new Al(this.property,this.value,r,He({},e.transition,this.transition),e.now)}untransitioned(){return new Al(this.property,this.value,null,{},0)}}class kl{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return zt(this._values[e].value.value)}setValue(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new mo(this._values[e].property)),this._values[e].value=new ya(this._values[e].property,r===null?void 0:zt(r))}getTransition(e){return zt(this._values[e].transition)}setTransition(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new mo(this._values[e].property)),this._values[e].transition=zt(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(e[r]=s);const l=this.getTransition(r);l!==void 0&&(e[`${r}-transition`]=l)}return e}transitioned(e,r){const s=new Pl(this._properties);for(const l of Object.keys(this._values))s._values[l]=this._values[l].transitioned(e,r._values[l]);return s}untransitioned(){const e=new Pl(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class Al{constructor(e,r,s,l,h){this.property=e,this.value=r,this.begin=h+l.delay||0,this.end=this.begin+l.duration||0,e.specification.transition&&(l.delay||l.duration)&&(this.prior=s)}possiblyEvaluate(e,r,s){const l=e.now||0,h=this.value.possiblyEvaluate(e,r,s),p=this.prior;if(p){if(l>this.end)return this.prior=null,h;if(this.value.isDataDriven())return this.prior=null,h;if(l<this.begin)return p.possiblyEvaluate(e,r,s);{const f=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,r,s),h,function(_){if(_<=0)return 0;if(_>=1)return 1;const v=_*_,S=v*_;return 4*(_<.5?S:3*(_-v)+S-.75)}(f))}}return h}}class Pl{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,s){const l=new xa(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].possiblyEvaluate(e,r,s);return l}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class kc{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}hasValue(e){return this._values[e].value!==void 0}getValue(e){return zt(this._values[e].value)}setValue(e,r){this._values[e]=new ya(this._values[e].property,r===null?void 0:zt(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(e[r]=s)}return e}possiblyEvaluate(e,r,s){const l=new xa(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].possiblyEvaluate(e,r,s);return l}}class ar{constructor(e,r,s){this.property=e,this.value=r,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,s,l){return this.property.evaluate(this.value,this.parameters,e,r,s,l)}}class xa{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class et{constructor(e){this.specification=e}possiblyEvaluate(e,r){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(r)}interpolate(e,r,s){const l=Tr[this.specification.type];return l?l(e,r,s):e}}class ct{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,s,l){return new ar(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},s,l)}:e.expression,r)}interpolate(e,r,s){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new ar(this,{kind:"constant",value:void 0},e.parameters);const l=Tr[this.specification.type];if(l){const h=l(e.value.value,r.value.value,s);return new ar(this,{kind:"constant",value:h},e.parameters)}return e}evaluate(e,r,s,l,h,p){return e.kind==="constant"?e.value:e.evaluate(r,s,l,h,p)}}class Ls extends ct{possiblyEvaluate(e,r,s,l){if(e.value===void 0)return new ar(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const h=e.expression.evaluate(r,null,{},s,l),p=e.property.specification.type==="resolvedImage"&&typeof h!="string"?h.name:h,f=this._calculate(p,p,p,r);return new ar(this,{kind:"constant",value:f},r)}if(e.expression.kind==="camera"){const h=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new ar(this,{kind:"constant",value:h},r)}return new ar(this,e.expression,r)}evaluate(e,r,s,l,h,p){if(e.kind==="source"){const f=e.evaluate(r,s,l,h,p);return this._calculate(f,f,f,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},s,l),e.evaluate({zoom:Math.floor(r.zoom)},s,l),e.evaluate({zoom:Math.floor(r.zoom)+1},s,l),r):e.value}_calculate(e,r,s,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:s,to:r}}interpolate(e){return e}}class go{constructor(e){this.specification=e}possiblyEvaluate(e,r,s,l){if(e.value!==void 0){if(e.expression.kind==="constant"){const h=e.expression.evaluate(r,null,{},s,l);return this._calculate(h,h,h,r)}return this._calculate(e.expression.evaluate(new ti(Math.floor(r.zoom-1),r)),e.expression.evaluate(new ti(Math.floor(r.zoom),r)),e.expression.evaluate(new ti(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,s,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:s,to:r}}interpolate(e){return e}}class _o{constructor(e){this.specification=e}possiblyEvaluate(e,r,s,l){return!!e.expression.evaluate(r,null,{},s,l)}interpolate(){return!1}}class wi{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const s=e[r];s.specification.overridable&&this.overridableProperties.push(r);const l=this.defaultPropertyValues[r]=new ya(s,void 0),h=this.defaultTransitionablePropertyValues[r]=new mo(s);this.defaultTransitioningPropertyValues[r]=h.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=l.possiblyEvaluate({})}}}Ze("DataDrivenProperty",ct),Ze("DataConstantProperty",et),Ze("CrossFadedDataDrivenProperty",Ls),Ze("CrossFadedProperty",go),Ze("ColorRampProperty",_o);const yo="-transition";class $r extends Sr{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new kc(r.layout)),r.paint)){this._transitionablePaint=new kl(r.paint);for(const s in e.paint)this.setPaintProperty(s,e.paint[s],{validate:!1});for(const s in e.layout)this.setLayoutProperty(s,e.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new xa(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,s={}){r!=null&&this._validate(Sl,`layers.${this.id}.layout.${e}`,e,r,s)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return e.endsWith(yo)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,s={}){if(r!=null&&this._validate(no,`layers.${this.id}.paint.${e}`,e,r,s))return!1;if(e.endsWith(yo))return this._transitionablePaint.setTransition(e.slice(0,-11),r||void 0),!1;{const l=this._transitionablePaint._values[e],h=l.property.specification["property-type"]==="cross-faded-data-driven",p=l.value.isDataDriven(),f=l.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const _=this._transitionablePaint._values[e].value;return _.isDataDriven()||p||h||this._handleOverridablePaintPropertyUpdate(e,f,_)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,r,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),ht(e,(r,s)=>!(r===void 0||s==="layout"&&!Object.keys(r).length||s==="paint"&&!Object.keys(r).length))}_validate(e,r,s,l,h={}){return(!h||h.validate!==!1)&&ga(this,e.call(dn,{key:r,layerType:this.type,objectKey:s,value:l,styleSpec:fe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof ar&&rs(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const zl={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class $n{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class mi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function hi(i,e=1){let r=0,s=0;return{members:i.map(l=>{const h=zl[l.type].BYTES_PER_ELEMENT,p=r=ls(r,Math.max(e,h)),f=l.components||1;return s=Math.max(s,h),r+=h*f,{name:l.name,type:l.type,components:f,offset:p}}),size:ls(r,Math.max(s,e)),alignment:e}}function ls(i,e){return Math.ceil(i/e)*e}class Rs extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const l=2*e;return this.int16[l+0]=r,this.int16[l+1]=s,e}}Rs.prototype.bytesPerElement=4,Ze("StructArrayLayout2i4",Rs);class Fs extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,s)}emplace(e,r,s,l){const h=3*e;return this.int16[h+0]=r,this.int16[h+1]=s,this.int16[h+2]=l,e}}Fs.prototype.bytesPerElement=6,Ze("StructArrayLayout3i6",Fs);class jn extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,s,l)}emplace(e,r,s,l,h){const p=4*e;return this.int16[p+0]=r,this.int16[p+1]=s,this.int16[p+2]=l,this.int16[p+3]=h,e}}jn.prototype.bytesPerElement=8,Ze("StructArrayLayout4i8",jn);class xo extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,l,h,p){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,s,l,h,p)}emplace(e,r,s,l,h,p,f){const _=6*e;return this.int16[_+0]=r,this.int16[_+1]=s,this.int16[_+2]=l,this.int16[_+3]=h,this.int16[_+4]=p,this.int16[_+5]=f,e}}xo.prototype.bytesPerElement=12,Ze("StructArrayLayout2i4i12",xo);class vo extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,l,h,p){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,s,l,h,p)}emplace(e,r,s,l,h,p,f){const _=4*e,v=8*e;return this.int16[_+0]=r,this.int16[_+1]=s,this.uint8[v+4]=l,this.uint8[v+5]=h,this.uint8[v+6]=p,this.uint8[v+7]=f,e}}vo.prototype.bytesPerElement=8,Ze("StructArrayLayout2i4ub8",vo);class cs extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const l=2*e;return this.float32[l+0]=r,this.float32[l+1]=s,e}}cs.prototype.bytesPerElement=8,Ze("StructArrayLayout2f8",cs);class bo extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,l,h,p,f,_,v,S){const I=this.length;return this.resize(I+1),this.emplace(I,e,r,s,l,h,p,f,_,v,S)}emplace(e,r,s,l,h,p,f,_,v,S,I){const A=10*e;return this.uint16[A+0]=r,this.uint16[A+1]=s,this.uint16[A+2]=l,this.uint16[A+3]=h,this.uint16[A+4]=p,this.uint16[A+5]=f,this.uint16[A+6]=_,this.uint16[A+7]=v,this.uint16[A+8]=S,this.uint16[A+9]=I,e}}bo.prototype.bytesPerElement=20,Ze("StructArrayLayout10ui20",bo);class wo extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,l,h,p,f,_,v,S,I,A){const L=this.length;return this.resize(L+1),this.emplace(L,e,r,s,l,h,p,f,_,v,S,I,A)}emplace(e,r,s,l,h,p,f,_,v,S,I,A,L){const R=12*e;return this.int16[R+0]=r,this.int16[R+1]=s,this.int16[R+2]=l,this.int16[R+3]=h,this.uint16[R+4]=p,this.uint16[R+5]=f,this.uint16[R+6]=_,this.uint16[R+7]=v,this.int16[R+8]=S,this.int16[R+9]=I,this.int16[R+10]=A,this.int16[R+11]=L,e}}wo.prototype.bytesPerElement=24,Ze("StructArrayLayout4i4ui4i24",wo);class $t extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,s)}emplace(e,r,s,l){const h=3*e;return this.float32[h+0]=r,this.float32[h+1]=s,this.float32[h+2]=l,e}}$t.prototype.bytesPerElement=12,Ze("StructArrayLayout3f12",$t);class u extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}u.prototype.bytesPerElement=4,Ze("StructArrayLayout1ul4",u);class t extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,l,h,p,f,_,v){const S=this.length;return this.resize(S+1),this.emplace(S,e,r,s,l,h,p,f,_,v)}emplace(e,r,s,l,h,p,f,_,v,S){const I=10*e,A=5*e;return this.int16[I+0]=r,this.int16[I+1]=s,this.int16[I+2]=l,this.int16[I+3]=h,this.int16[I+4]=p,this.int16[I+5]=f,this.uint32[A+3]=_,this.uint16[I+8]=v,this.uint16[I+9]=S,e}}t.prototype.bytesPerElement=20,Ze("StructArrayLayout6i1ul2ui20",t);class n extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,l,h,p){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,s,l,h,p)}emplace(e,r,s,l,h,p,f){const _=6*e;return this.int16[_+0]=r,this.int16[_+1]=s,this.int16[_+2]=l,this.int16[_+3]=h,this.int16[_+4]=p,this.int16[_+5]=f,e}}n.prototype.bytesPerElement=12,Ze("StructArrayLayout2i2i2i12",n);class a extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,s,l,h)}emplace(e,r,s,l,h,p){const f=4*e,_=8*e;return this.float32[f+0]=r,this.float32[f+1]=s,this.float32[f+2]=l,this.int16[_+6]=h,this.int16[_+7]=p,e}}a.prototype.bytesPerElement=16,Ze("StructArrayLayout2f1f2i16",a);class c extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,s,l)}emplace(e,r,s,l,h){const p=12*e,f=3*e;return this.uint8[p+0]=r,this.uint8[p+1]=s,this.float32[f+1]=l,this.float32[f+2]=h,e}}c.prototype.bytesPerElement=12,Ze("StructArrayLayout2ub2f12",c);class d extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,s)}emplace(e,r,s,l){const h=3*e;return this.uint16[h+0]=r,this.uint16[h+1]=s,this.uint16[h+2]=l,e}}d.prototype.bytesPerElement=6,Ze("StructArrayLayout3ui6",d);class m extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,l,h,p,f,_,v,S,I,A,L,R,$,W,Y){const se=this.length;return this.resize(se+1),this.emplace(se,e,r,s,l,h,p,f,_,v,S,I,A,L,R,$,W,Y)}emplace(e,r,s,l,h,p,f,_,v,S,I,A,L,R,$,W,Y,se){const Q=24*e,oe=12*e,ue=48*e;return this.int16[Q+0]=r,this.int16[Q+1]=s,this.uint16[Q+2]=l,this.uint16[Q+3]=h,this.uint32[oe+2]=p,this.uint32[oe+3]=f,this.uint32[oe+4]=_,this.uint16[Q+10]=v,this.uint16[Q+11]=S,this.uint16[Q+12]=I,this.float32[oe+7]=A,this.float32[oe+8]=L,this.uint8[ue+36]=R,this.uint8[ue+37]=$,this.uint8[ue+38]=W,this.uint32[oe+10]=Y,this.int16[Q+22]=se,e}}m.prototype.bytesPerElement=48,Ze("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",m);class g extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,l,h,p,f,_,v,S,I,A,L,R,$,W,Y,se,Q,oe,ue,ve,Ve,Ke,$e,Re,Pe,Ge){const ze=this.length;return this.resize(ze+1),this.emplace(ze,e,r,s,l,h,p,f,_,v,S,I,A,L,R,$,W,Y,se,Q,oe,ue,ve,Ve,Ke,$e,Re,Pe,Ge)}emplace(e,r,s,l,h,p,f,_,v,S,I,A,L,R,$,W,Y,se,Q,oe,ue,ve,Ve,Ke,$e,Re,Pe,Ge,ze){const Ee=32*e,rt=16*e;return this.int16[Ee+0]=r,this.int16[Ee+1]=s,this.int16[Ee+2]=l,this.int16[Ee+3]=h,this.int16[Ee+4]=p,this.int16[Ee+5]=f,this.int16[Ee+6]=_,this.int16[Ee+7]=v,this.uint16[Ee+8]=S,this.uint16[Ee+9]=I,this.uint16[Ee+10]=A,this.uint16[Ee+11]=L,this.uint16[Ee+12]=R,this.uint16[Ee+13]=$,this.uint16[Ee+14]=W,this.uint16[Ee+15]=Y,this.uint16[Ee+16]=se,this.uint16[Ee+17]=Q,this.uint16[Ee+18]=oe,this.uint16[Ee+19]=ue,this.uint16[Ee+20]=ve,this.uint16[Ee+21]=Ve,this.uint16[Ee+22]=Ke,this.uint32[rt+12]=$e,this.float32[rt+13]=Re,this.float32[rt+14]=Pe,this.uint16[Ee+30]=Ge,this.uint16[Ee+31]=ze,e}}g.prototype.bytesPerElement=64,Ze("StructArrayLayout8i15ui1ul2f2ui64",g);class x extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}x.prototype.bytesPerElement=4,Ze("StructArrayLayout1f4",x);class w extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,s)}emplace(e,r,s,l){const h=3*e;return this.uint16[6*e+0]=r,this.float32[h+1]=s,this.float32[h+2]=l,e}}w.prototype.bytesPerElement=12,Ze("StructArrayLayout1ui2f12",w);class C extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,s)}emplace(e,r,s,l){const h=4*e;return this.uint32[2*e+0]=r,this.uint16[h+2]=s,this.uint16[h+3]=l,e}}C.prototype.bytesPerElement=8,Ze("StructArrayLayout1ul2ui8",C);class T extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const l=2*e;return this.uint16[l+0]=r,this.uint16[l+1]=s,e}}T.prototype.bytesPerElement=4,Ze("StructArrayLayout2ui4",T);class z extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}z.prototype.bytesPerElement=2,Ze("StructArrayLayout1ui2",z);class V extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,s,l)}emplace(e,r,s,l,h){const p=4*e;return this.float32[p+0]=r,this.float32[p+1]=s,this.float32[p+2]=l,this.float32[p+3]=h,e}}V.prototype.bytesPerElement=16,Ze("StructArrayLayout4f16",V);class j extends $n{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new de(this.anchorPointX,this.anchorPointY)}}j.prototype.size=20;class Z extends t{get(e){return new j(this,e)}}Ze("CollisionBoxArray",Z);class N extends $n{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}N.prototype.size=48;class te extends m{get(e){return new N(this,e)}}Ze("PlacedSymbolArray",te);class le extends $n{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}le.prototype.size=64;class K extends g{get(e){return new le(this,e)}}Ze("SymbolInstanceArray",K);class re extends x{getoffsetX(e){return this.float32[1*e+0]}}Ze("GlyphOffsetArray",re);class he extends Fs{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Ze("SymbolLineVertexArray",he);class pe extends $n{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}pe.prototype.size=12;class xe extends w{get(e){return new pe(this,e)}}Ze("TextAnchorOffsetArray",xe);class Ie extends $n{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Ie.prototype.size=8;class Se extends C{get(e){return new Ie(this,e)}}Ze("FeatureIndexArray",Se);class ke extends Rs{}class Xe extends Rs{}class Ct extends Rs{}class Le extends xo{}class ut extends vo{}class Ye extends cs{}class Zt extends bo{}class St extends wo{}class vt extends $t{}class Tt extends u{}class yi extends n{}class ei extends c{}class Gi extends d{}class zi extends T{}const Si=hi([{name:"a_pos",components:2,type:"Int16"}],4),{members:kr}=Si;class ii{constructor(e=[]){this.segments=e}prepareSegment(e,r,s,l){let h=this.segments[this.segments.length-1];return e>ii.MAX_VERTEX_ARRAY_LENGTH&&xt(`Max vertices per segment is ${ii.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!h||h.vertexLength+e>ii.MAX_VERTEX_ARRAY_LENGTH||h.sortKey!==l)&&(h={vertexOffset:r.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},l!==void 0&&(h.sortKey=l),this.segments.push(h)),h}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,s,l){return new ii([{vertexOffset:e,primitiveOffset:r,vertexLength:s,primitiveLength:l,vaos:{},sortKey:0}])}}function Qr(i,e){return 256*(i=at(Math.floor(i),0,255))+at(Math.floor(e),0,255)}ii.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ze("SegmentVector",ii);const en=hi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var kn={exports:{}},Vn={exports:{}};Vn.exports=function(i,e){var r,s,l,h,p,f,_,v;for(s=i.length-(r=3&i.length),l=e,p=3432918353,f=461845907,v=0;v<s;)_=255&i.charCodeAt(v)|(255&i.charCodeAt(++v))<<8|(255&i.charCodeAt(++v))<<16|(255&i.charCodeAt(++v))<<24,++v,l=27492+(65535&(h=5*(65535&(l=(l^=_=(65535&(_=(_=(65535&_)*p+(((_>>>16)*p&65535)<<16)&4294967295)<<15|_>>>17))*f+(((_>>>16)*f&65535)<<16)&4294967295)<<13|l>>>19))+((5*(l>>>16)&65535)<<16)&4294967295))+((58964+(h>>>16)&65535)<<16);switch(_=0,r){case 3:_^=(255&i.charCodeAt(v+2))<<16;case 2:_^=(255&i.charCodeAt(v+1))<<8;case 1:l^=_=(65535&(_=(_=(65535&(_^=255&i.charCodeAt(v)))*p+(((_>>>16)*p&65535)<<16)&4294967295)<<15|_>>>17))*f+(((_>>>16)*f&65535)<<16)&4294967295}return l^=i.length,l=2246822507*(65535&(l^=l>>>16))+((2246822507*(l>>>16)&65535)<<16)&4294967295,l=3266489909*(65535&(l^=l>>>13))+((3266489909*(l>>>16)&65535)<<16)&4294967295,(l^=l>>>16)>>>0};var us=Vn.exports,Qi={exports:{}};Qi.exports=function(i,e){for(var r,s=i.length,l=e^s,h=0;s>=4;)r=1540483477*(65535&(r=255&i.charCodeAt(h)|(255&i.charCodeAt(++h))<<8|(255&i.charCodeAt(++h))<<16|(255&i.charCodeAt(++h))<<24))+((1540483477*(r>>>16)&65535)<<16),l=1540483477*(65535&l)+((1540483477*(l>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),s-=4,++h;switch(s){case 3:l^=(255&i.charCodeAt(h+2))<<16;case 2:l^=(255&i.charCodeAt(h+1))<<8;case 1:l=1540483477*(65535&(l^=255&i.charCodeAt(h)))+((1540483477*(l>>>16)&65535)<<16)}return l=1540483477*(65535&(l^=l>>>13))+((1540483477*(l>>>16)&65535)<<16),(l^=l>>>15)>>>0};var Hi=us,or=Qi.exports;kn.exports=Hi,kn.exports.murmur3=Hi,kn.exports.murmur2=or;var Un=B(kn.exports);class xi{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,s,l){this.ids.push(Di(e)),this.positions.push(r,s,l)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=Di(e);let s=0,l=this.ids.length-1;for(;s<l;){const p=s+l>>1;this.ids[p]>=r?l=p:s=p+1}const h=[];for(;this.ids[s]===r;)h.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return h}static serialize(e,r){const s=new Float64Array(e.ids),l=new Uint32Array(e.positions);return _r(s,l,0,s.length-1),r&&r.push(s.buffer,l.buffer),{ids:s,positions:l}}static deserialize(e){const r=new xi;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function Di(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:Un(String(i))}function _r(i,e,r,s){for(;r<s;){const l=i[r+s>>1];let h=r-1,p=s+1;for(;;){do h++;while(i[h]<l);do p--;while(i[p]>l);if(h>=p)break;vi(i,h,p),vi(e,3*h,3*p),vi(e,3*h+1,3*p+1),vi(e,3*h+2,3*p+2)}p-r<s-p?(_r(i,e,r,p),r=p+1):(_r(i,e,p+1,s),s=p)}}function vi(i,e,r){const s=i[e];i[e]=i[r],i[r]=s}Ze("FeaturePositionMap",xi);class qn{constructor(e,r){this.gl=e.gl,this.location=r}}class va extends qn{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Dl extends qn{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Ll extends qn{constructor(e,r){super(e,r),this.current=qt.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Ac=new Float32Array(16);function So(i){return[Qr(255*i.r,255*i.g),Qr(255*i.b,255*i.a)]}class tn{constructor(e,r,s){this.value=e,this.uniformNames=r.map(l=>`u_${l}`),this.type=s}setUniform(e,r,s){e.set(s.constantOr(this.value))}getBinding(e,r,s){return this.type==="color"?new Ll(e,r):new va(e,r)}}class Zn{constructor(e,r){this.uniformNames=r.map(s=>`u_${s}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=e.tlbr}setUniform(e,r,s,l){const h=l==="u_pattern_to"?this.patternTo:l==="u_pattern_from"?this.patternFrom:l==="u_pixel_ratio_to"?this.pixelRatioTo:l==="u_pixel_ratio_from"?this.pixelRatioFrom:null;h&&e.set(h)}getBinding(e,r,s){return s.substr(0,9)==="u_pattern"?new Dl(e,r):new va(e,r)}}class rn{constructor(e,r,s,l){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=r.map(h=>({name:`a_${h}`,type:"Float32",components:s==="color"?2:1,offset:0})),this.paintVertexArray=new l}populatePaintArray(e,r,s,l,h){const p=this.paintVertexArray.length,f=this.expression.evaluate(new ti(0),r,{},l,[],h);this.paintVertexArray.resize(e),this._setPaintValue(p,e,f)}updatePaintArray(e,r,s,l){const h=this.expression.evaluate({zoom:0},s,l);this._setPaintValue(e,r,h)}_setPaintValue(e,r,s){if(this.type==="color"){const l=So(s);for(let h=e;h<r;h++)this.paintVertexArray.emplace(h,l[0],l[1])}else{for(let l=e;l<r;l++)this.paintVertexArray.emplace(l,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class jr{constructor(e,r,s,l,h,p){this.expression=e,this.uniformNames=r.map(f=>`u_${f}_t`),this.type=s,this.useIntegerZoom=l,this.zoom=h,this.maxValue=0,this.paintVertexAttributes=r.map(f=>({name:`a_${f}`,type:"Float32",components:s==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,r,s,l,h){const p=this.expression.evaluate(new ti(this.zoom),r,{},l,[],h),f=this.expression.evaluate(new ti(this.zoom+1),r,{},l,[],h),_=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(_,e,p,f)}updatePaintArray(e,r,s,l){const h=this.expression.evaluate({zoom:this.zoom},s,l),p=this.expression.evaluate({zoom:this.zoom+1},s,l);this._setPaintValue(e,r,h,p)}_setPaintValue(e,r,s,l){if(this.type==="color"){const h=So(s),p=So(l);for(let f=e;f<r;f++)this.paintVertexArray.emplace(f,h[0],h[1],p[0],p[1])}else{for(let h=e;h<r;h++)this.paintVertexArray.emplace(h,s,l);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const s=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,l=at(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);e.set(l)}getBinding(e,r,s){return new va(e,r)}}class nn{constructor(e,r,s,l,h,p){this.expression=e,this.type=r,this.useIntegerZoom=s,this.zoom=l,this.layerId=p,this.zoomInPaintVertexArray=new h,this.zoomOutPaintVertexArray=new h}populatePaintArray(e,r,s){const l=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(l,e,r.patterns&&r.patterns[this.layerId],s)}updatePaintArray(e,r,s,l,h){this._setPaintValues(e,r,s.patterns&&s.patterns[this.layerId],h)}_setPaintValues(e,r,s,l){if(!l||!s)return;const{min:h,mid:p,max:f}=s,_=l[h],v=l[p],S=l[f];if(_&&v&&S)for(let I=e;I<r;I++)this.zoomInPaintVertexArray.emplace(I,v.tl[0],v.tl[1],v.br[0],v.br[1],_.tl[0],_.tl[1],_.br[0],_.br[1],v.pixelRatio,_.pixelRatio),this.zoomOutPaintVertexArray.emplace(I,v.tl[0],v.tl[1],v.br[0],v.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],v.pixelRatio,S.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,en.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,en.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Co{constructor(e,r,s){this.binders={},this._buffers=[];const l=[];for(const h in e.paint._values){if(!s(h))continue;const p=e.paint.get(h);if(!(p instanceof ar&&rs(p.property.specification)))continue;const f=Sp(h,e.type),_=p.value,v=p.property.specification.type,S=p.property.useIntegerZoom,I=p.property.specification["property-type"],A=I==="cross-faded"||I==="cross-faded-data-driven";if(_.kind==="constant")this.binders[h]=A?new Zn(_.value,f):new tn(_.value,f,v),l.push(`/u_${h}`);else if(_.kind==="source"||A){const L=ju(h,v,"source");this.binders[h]=A?new nn(_,v,S,r,L,e.id):new rn(_,f,v,L),l.push(`/a_${h}`)}else{const L=ju(h,v,"composite");this.binders[h]=new jr(_,f,v,S,r,L),l.push(`/z_${h}`)}}this.cacheKey=l.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof rn||r instanceof jr?r.maxValue:0}populatePaintArrays(e,r,s,l,h){for(const p in this.binders){const f=this.binders[p];(f instanceof rn||f instanceof jr||f instanceof nn)&&f.populatePaintArray(e,r,s,l,h)}}setConstantPatternPositions(e,r){for(const s in this.binders){const l=this.binders[s];l instanceof Zn&&l.setConstantPatternPositions(e,r)}}updatePaintArrays(e,r,s,l,h){let p=!1;for(const f in e){const _=r.getPositions(f);for(const v of _){const S=s.feature(v.index);for(const I in this.binders){const A=this.binders[I];if((A instanceof rn||A instanceof jr||A instanceof nn)&&A.expression.isStateDependent===!0){const L=l.paint.get(I);A.expression=L.value,A.updatePaintArray(v.start,v.end,S,e[f],h),p=!0}}}}return p}defines(){const e=[];for(const r in this.binders){const s=this.binders[r];(s instanceof tn||s instanceof Zn)&&e.push(...s.uniformNames.map(l=>`#define HAS_UNIFORM_${l}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof rn||s instanceof jr)for(let l=0;l<s.paintVertexAttributes.length;l++)e.push(s.paintVertexAttributes[l].name);else if(s instanceof nn)for(let l=0;l<en.members.length;l++)e.push(en.members[l].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof tn||s instanceof Zn||s instanceof jr)for(const l of s.uniformNames)e.push(l)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const s=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof tn||h instanceof Zn||h instanceof jr){for(const p of h.uniformNames)if(r[p]){const f=h.getBinding(e,r[p],p);s.push({name:p,property:l,binding:f})}}}return s}setUniforms(e,r,s,l){for(const{name:h,property:p,binding:f}of r)this.binders[p].setUniform(f,l,s.get(p),h)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const s=this.binders[r];if(e&&s instanceof nn){const l=e.fromScale===2?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;l&&this._buffers.push(l)}else(s instanceof rn||s instanceof jr)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(e){for(const r in this.binders){const s=this.binders[r];(s instanceof rn||s instanceof jr||s instanceof nn)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof rn||r instanceof jr||r instanceof nn)&&r.destroy()}}}class fn{constructor(e,r,s=()=>!0){this.programConfigurations={};for(const l of e)this.programConfigurations[l.id]=new Co(l,r,s);this.needsUpload=!1,this._featureMap=new xi,this._bufferOffset=0}populatePaintArrays(e,r,s,l,h,p){for(const f in this.programConfigurations)this.programConfigurations[f].populatePaintArrays(e,r,l,h,p);r.id!==void 0&&this._featureMap.add(r.id,s,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,s,l){for(const h of s)this.needsUpload=this.programConfigurations[h.id].updatePaintArrays(e,this._featureMap,r,h,l)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Sp(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function ju(i,e,r){const s={color:{source:cs,composite:V},number:{source:x,composite:cs}},l=function(h){return{"line-pattern":{source:Zt,composite:Zt},"fill-pattern":{source:Zt,composite:Zt},"fill-extrusion-pattern":{source:Zt,composite:Zt}}[h]}(i);return l&&l[r]||s[e][r]}Ze("ConstantBinder",tn),Ze("CrossFadedConstantBinder",Zn),Ze("SourceExpressionBinder",rn),Ze("CrossFadedCompositeBinder",nn),Ze("CompositeExpressionBinder",jr),Ze("ProgramConfiguration",Co,{omit:["_buffers"]}),Ze("ProgramConfigurationSet",fn);const Mi=8192,Pc=Math.pow(2,14)-1,Vu=-Pc-1;function Bs(i){const e=Mi/i.extent,r=i.loadGeometry();for(let s=0;s<r.length;s++){const l=r[s];for(let h=0;h<l.length;h++){const p=l[h],f=Math.round(p.x*e),_=Math.round(p.y*e);p.x=at(f,Vu,Pc),p.y=at(_,Vu,Pc),(f<p.x||f>p.x+1||_<p.y||_>p.y+1)&&xt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function Os(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?Bs(i):[]}}function Rl(i,e,r,s,l){i.emplaceBack(2*e+(s+1)/2,2*r+(l+1)/2)}class zc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Xe,this.indexArray=new Gi,this.segments=new ii,this.programConfigurations=new fn(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){const l=this.layers[0],h=[];let p=null,f=!1;l.type==="circle"&&(p=l.layout.get("circle-sort-key"),f=!p.isConstant());for(const{feature:_,id:v,index:S,sourceLayerIndex:I}of e){const A=this.layers[0]._featureFilter.needGeometry,L=Os(_,A);if(!this.layers[0]._featureFilter.filter(new ti(this.zoom),L,s))continue;const R=f?p.evaluate(L,{},s):void 0,$={id:v,properties:_.properties,type:_.type,sourceLayerIndex:I,index:S,geometry:A?L.geometry:Bs(_),patterns:{},sortKey:R};h.push($)}f&&h.sort((_,v)=>_.sortKey-v.sortKey);for(const _ of h){const{geometry:v,index:S,sourceLayerIndex:I}=_,A=e[S].feature;this.addFeature(_,v,S,s),r.featureIndex.insert(A,v,S,I,this.index)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,kr),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,s,l){for(const h of r)for(const p of h){const f=p.x,_=p.y;if(f<0||f>=Mi||_<0||_>=Mi)continue;const v=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),S=v.vertexLength;Rl(this.layoutVertexArray,f,_,-1,-1),Rl(this.layoutVertexArray,f,_,1,-1),Rl(this.layoutVertexArray,f,_,1,1),Rl(this.layoutVertexArray,f,_,-1,1),this.indexArray.emplaceBack(S,S+1,S+2),this.indexArray.emplaceBack(S,S+3,S+2),v.vertexLength+=4,v.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},l)}}function Uu(i,e){for(let r=0;r<i.length;r++)if(ba(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(ba(i,e[r]))return!0;return!!Dc(i,e)}function Cp(i,e,r){return!!ba(i,e)||!!Lc(e,i,r)}function qu(i,e){if(i.length===1)return Gu(e,i[0]);for(let r=0;r<e.length;r++){const s=e[r];for(let l=0;l<s.length;l++)if(ba(i,s[l]))return!0}for(let r=0;r<i.length;r++)if(Gu(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(Dc(i,e[r]))return!0;return!1}function Tp(i,e,r){if(i.length>1){if(Dc(i,e))return!0;for(let s=0;s<e.length;s++)if(Lc(e[s],i,r))return!0}for(let s=0;s<i.length;s++)if(Lc(i[s],e,r))return!0;return!1}function Dc(i,e){if(i.length===0||e.length===0)return!1;for(let r=0;r<i.length-1;r++){const s=i[r],l=i[r+1];for(let h=0;h<e.length-1;h++)if(Ip(s,l,e[h],e[h+1]))return!0}return!1}function Ip(i,e,r,s){return Et(i,r,s)!==Et(e,r,s)&&Et(i,e,r)!==Et(i,e,s)}function Lc(i,e,r){const s=r*r;if(e.length===1)return i.distSqr(e[0])<s;for(let l=1;l<e.length;l++)if(Zu(i,e[l-1],e[l])<s)return!0;return!1}function Zu(i,e,r){const s=e.distSqr(r);if(s===0)return i.distSqr(e);const l=((i.x-e.x)*(r.x-e.x)+(i.y-e.y)*(r.y-e.y))/s;return i.distSqr(l<0?e:l>1?r:r.sub(e)._mult(l)._add(e))}function Gu(i,e){let r,s,l,h=!1;for(let p=0;p<i.length;p++){r=i[p];for(let f=0,_=r.length-1;f<r.length;_=f++)s=r[f],l=r[_],s.y>e.y!=l.y>e.y&&e.x<(l.x-s.x)*(e.y-s.y)/(l.y-s.y)+s.x&&(h=!h)}return h}function ba(i,e){let r=!1;for(let s=0,l=i.length-1;s<i.length;l=s++){const h=i[s],p=i[l];h.y>e.y!=p.y>e.y&&e.x<(p.x-h.x)*(e.y-h.y)/(p.y-h.y)+h.x&&(r=!r)}return r}function Ep(i,e,r){const s=r[0],l=r[2];if(i.x<s.x&&e.x<s.x||i.x>l.x&&e.x>l.x||i.y<s.y&&e.y<s.y||i.y>l.y&&e.y>l.y)return!1;const h=Et(i,e,r[0]);return h!==Et(i,e,r[1])||h!==Et(i,e,r[2])||h!==Et(i,e,r[3])}function To(i,e,r){const s=e.paint.get(i).value;return s.kind==="constant"?s.value:r.programConfigurations.get(e.id).getMaxValue(i)}function Fl(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Bl(i,e,r,s,l){if(!e[0]&&!e[1])return i;const h=de.convert(e)._mult(l);r==="viewport"&&h._rotate(-s);const p=[];for(let f=0;f<i.length;f++)p.push(i[f].sub(h));return p}let Hu,Wu;Ze("CircleBucket",zc,{omit:["layers"]});var Mp={get paint(){return Wu=Wu||new wi({"circle-radius":new ct(fe.paint_circle["circle-radius"]),"circle-color":new ct(fe.paint_circle["circle-color"]),"circle-blur":new ct(fe.paint_circle["circle-blur"]),"circle-opacity":new ct(fe.paint_circle["circle-opacity"]),"circle-translate":new et(fe.paint_circle["circle-translate"]),"circle-translate-anchor":new et(fe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new et(fe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new et(fe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ct(fe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ct(fe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ct(fe.paint_circle["circle-stroke-opacity"])})},get layout(){return Hu=Hu||new wi({"circle-sort-key":new ct(fe.layout_circle["circle-sort-key"])})}},yr=1e-6,wa=typeof Float32Array<"u"?Float32Array:Array;function Rc(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Xu(i,e,r){var s=e[0],l=e[1],h=e[2],p=e[3],f=e[4],_=e[5],v=e[6],S=e[7],I=e[8],A=e[9],L=e[10],R=e[11],$=e[12],W=e[13],Y=e[14],se=e[15],Q=r[0],oe=r[1],ue=r[2],ve=r[3];return i[0]=Q*s+oe*f+ue*I+ve*$,i[1]=Q*l+oe*_+ue*A+ve*W,i[2]=Q*h+oe*v+ue*L+ve*Y,i[3]=Q*p+oe*S+ue*R+ve*se,i[4]=(Q=r[4])*s+(oe=r[5])*f+(ue=r[6])*I+(ve=r[7])*$,i[5]=Q*l+oe*_+ue*A+ve*W,i[6]=Q*h+oe*v+ue*L+ve*Y,i[7]=Q*p+oe*S+ue*R+ve*se,i[8]=(Q=r[8])*s+(oe=r[9])*f+(ue=r[10])*I+(ve=r[11])*$,i[9]=Q*l+oe*_+ue*A+ve*W,i[10]=Q*h+oe*v+ue*L+ve*Y,i[11]=Q*p+oe*S+ue*R+ve*se,i[12]=(Q=r[12])*s+(oe=r[13])*f+(ue=r[14])*I+(ve=r[15])*$,i[13]=Q*l+oe*_+ue*A+ve*W,i[14]=Q*h+oe*v+ue*L+ve*Y,i[15]=Q*p+oe*S+ue*R+ve*se,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var Io,kp=Xu;function Ol(i,e,r){var s=e[0],l=e[1],h=e[2],p=e[3];return i[0]=r[0]*s+r[4]*l+r[8]*h+r[12]*p,i[1]=r[1]*s+r[5]*l+r[9]*h+r[13]*p,i[2]=r[2]*s+r[6]*l+r[10]*h+r[14]*p,i[3]=r[3]*s+r[7]*l+r[11]*h+r[15]*p,i}Io=new wa(4),wa!=Float32Array&&(Io[0]=0,Io[1]=0,Io[2]=0,Io[3]=0);class Ap extends $r{constructor(e){super(e,Mp)}createBucket(e){return new zc(e)}queryRadius(e){const r=e;return To("circle-radius",this,r)+To("circle-stroke-width",this,r)+Fl(this.paint.get("circle-translate"))}queryIntersectsFeature(e,r,s,l,h,p,f,_){const v=Bl(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,f),S=this.paint.get("circle-radius").evaluate(r,s)+this.paint.get("circle-stroke-width").evaluate(r,s),I=this.paint.get("circle-pitch-alignment")==="map",A=I?v:function(R,$){return R.map(W=>Ku(W,$))}(v,_),L=I?S*f:S;for(const R of l)for(const $ of R){const W=I?$:Ku($,_);let Y=L;const se=Ol([],[$.x,$.y,0,1],_);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Y*=se[3]/p.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Y*=p.cameraToCenterDistance/se[3]),Cp(A,W,Y))return!0}return!1}}function Ku(i,e){const r=Ol([],[i.x,i.y,0,1],e);return new de(r[0]/r[3],r[1]/r[3])}class Yu extends zc{}let Ju;Ze("HeatmapBucket",Yu,{omit:["layers"]});var Pp={get paint(){return Ju=Ju||new wi({"heatmap-radius":new ct(fe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ct(fe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new et(fe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new _o(fe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new et(fe.paint_heatmap["heatmap-opacity"])})}};function Fc(i,{width:e,height:r},s,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==e*r*s)throw new RangeError(`mismatched image size. expected: ${l.length} but got: ${e*r*s}`)}else l=new Uint8Array(e*r*s);return i.width=e,i.height=r,i.data=l,i}function Qu(i,{width:e,height:r},s){if(e===i.width&&r===i.height)return;const l=Fc({},{width:e,height:r},s);Bc(i,l,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,r)},s),i.width=e,i.height=r,i.data=l.data}function Bc(i,e,r,s,l,h){if(l.width===0||l.height===0)return e;if(l.width>i.width||l.height>i.height||r.x>i.width-l.width||r.y>i.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>e.width||l.height>e.height||s.x>e.width-l.width||s.y>e.height-l.height)throw new RangeError("out of range destination coordinates for image copy");const p=i.data,f=e.data;if(p===f)throw new Error("srcData equals dstData, so image is already copied");for(let _=0;_<l.height;_++){const v=((r.y+_)*i.width+r.x)*h,S=((s.y+_)*e.width+s.x)*h;for(let I=0;I<l.width*h;I++)f[S+I]=p[v+I]}return e}class Eo{constructor(e,r){Fc(this,e,1,r)}resize(e){Qu(this,e,1)}clone(){return new Eo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,s,l,h){Bc(e,r,s,l,h,1)}}class qr{constructor(e,r){Fc(this,e,4,r)}resize(e){Qu(this,e,4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new qr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,s,l,h){Bc(e,r,s,l,h,4)}}function eh(i){const e={},r=i.resolution||256,s=i.clips?i.clips.length:1,l=i.image||new qr({width:r,height:s});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const h=(p,f,_)=>{e[i.evaluationKey]=_;const v=i.expression.evaluate(e);l.data[p+f+0]=Math.floor(255*v.r/v.a),l.data[p+f+1]=Math.floor(255*v.g/v.a),l.data[p+f+2]=Math.floor(255*v.b/v.a),l.data[p+f+3]=Math.floor(255*v.a)};if(i.clips)for(let p=0,f=0;p<s;++p,f+=4*r)for(let _=0,v=0;_<r;_++,v+=4){const S=_/(r-1),{start:I,end:A}=i.clips[p];h(f,v,I*(1-S)+A*S)}else for(let p=0,f=0;p<r;p++,f+=4)h(0,f,p/(r-1));return l}Ze("AlphaImage",Eo),Ze("RGBAImage",qr);class zp extends $r{createBucket(e){return new Yu(e)}constructor(e){super(e,Pp),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=eh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let th;var Dp={get paint(){return th=th||new wi({"hillshade-illumination-direction":new et(fe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new et(fe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new et(fe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new et(fe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new et(fe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new et(fe.paint_hillshade["hillshade-accent-color"])})}};class Lp extends $r{constructor(e){super(e,Dp)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Rp=hi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Fp}=Rp;var Oc={exports:{}};function Nl(i,e,r){r=r||2;var s,l,h,p,f,_,v,S=e&&e.length,I=S?e[0]*r:i.length,A=ih(i,0,I,r,!0),L=[];if(!A||A.next===A.prev)return L;if(S&&(A=function($,W,Y,se){var Q,oe,ue,ve=[];for(Q=0,oe=W.length;Q<oe;Q++)(ue=ih($,W[Q]*se,Q<oe-1?W[Q+1]*se:$.length,se,!1))===ue.next&&(ue.steiner=!0),ve.push(qp(ue));for(ve.sort(jp),Q=0;Q<ve.length;Q++)Y=Vp(ve[Q],Y);return Y}(i,e,A,r)),i.length>80*r){s=h=i[0],l=p=i[1];for(var R=r;R<I;R+=r)(f=i[R])<s&&(s=f),(_=i[R+1])<l&&(l=_),f>h&&(h=f),_>p&&(p=_);v=(v=Math.max(h-s,p-l))!==0?32767/v:0}return Mo(A,L,r,s,l,v,0),L}function ih(i,e,r,s,l){var h,p;if(l===jc(i,e,r,s)>0)for(h=e;h<r;h+=s)p=sh(h,i[h],i[h+1],p);else for(h=r-s;h>=e;h-=s)p=sh(h,i[h],i[h+1],p);return p&&$l(p,p.next)&&(Ao(p),p=p.next),p}function Ns(i,e){if(!i)return i;e||(e=i);var r,s=i;do if(r=!1,s.steiner||!$l(s,s.next)&&Ci(s.prev,s,s.next)!==0)s=s.next;else{if(Ao(s),(s=e=s.prev)===s.next)break;r=!0}while(r||s!==e);return e}function Mo(i,e,r,s,l,h,p){if(i){!p&&h&&function(S,I,A,L){var R=S;do R.z===0&&(R.z=Nc(R.x,R.y,I,A,L)),R.prevZ=R.prev,R.nextZ=R.next,R=R.next;while(R!==S);R.prevZ.nextZ=null,R.prevZ=null,function($){var W,Y,se,Q,oe,ue,ve,Ve,Ke=1;do{for(Y=$,$=null,oe=null,ue=0;Y;){for(ue++,se=Y,ve=0,W=0;W<Ke&&(ve++,se=se.nextZ);W++);for(Ve=Ke;ve>0||Ve>0&&se;)ve!==0&&(Ve===0||!se||Y.z<=se.z)?(Q=Y,Y=Y.nextZ,ve--):(Q=se,se=se.nextZ,Ve--),oe?oe.nextZ=Q:$=Q,Q.prevZ=oe,oe=Q;Y=se}oe.nextZ=null,Ke*=2}while(ue>1)}(R)}(i,s,l,h);for(var f,_,v=i;i.prev!==i.next;)if(f=i.prev,_=i.next,h?Op(i,s,l,h):Bp(i))e.push(f.i/r|0),e.push(i.i/r|0),e.push(_.i/r|0),Ao(i),i=_.next,v=_.next;else if((i=_)===v){p?p===1?Mo(i=Np(Ns(i),e,r),e,r,s,l,h,2):p===2&&$p(i,e,r,s,l,h):Mo(Ns(i),e,r,s,l,h,1);break}}}function Bp(i){var e=i.prev,r=i,s=i.next;if(Ci(e,r,s)>=0)return!1;for(var l=e.x,h=r.x,p=s.x,f=e.y,_=r.y,v=s.y,S=l<h?l<p?l:p:h<p?h:p,I=f<_?f<v?f:v:_<v?_:v,A=l>h?l>p?l:p:h>p?h:p,L=f>_?f>v?f:v:_>v?_:v,R=s.next;R!==e;){if(R.x>=S&&R.x<=A&&R.y>=I&&R.y<=L&&Sa(l,f,h,_,p,v,R.x,R.y)&&Ci(R.prev,R,R.next)>=0)return!1;R=R.next}return!0}function Op(i,e,r,s){var l=i.prev,h=i,p=i.next;if(Ci(l,h,p)>=0)return!1;for(var f=l.x,_=h.x,v=p.x,S=l.y,I=h.y,A=p.y,L=f<_?f<v?f:v:_<v?_:v,R=S<I?S<A?S:A:I<A?I:A,$=f>_?f>v?f:v:_>v?_:v,W=S>I?S>A?S:A:I>A?I:A,Y=Nc(L,R,e,r,s),se=Nc($,W,e,r,s),Q=i.prevZ,oe=i.nextZ;Q&&Q.z>=Y&&oe&&oe.z<=se;){if(Q.x>=L&&Q.x<=$&&Q.y>=R&&Q.y<=W&&Q!==l&&Q!==p&&Sa(f,S,_,I,v,A,Q.x,Q.y)&&Ci(Q.prev,Q,Q.next)>=0||(Q=Q.prevZ,oe.x>=L&&oe.x<=$&&oe.y>=R&&oe.y<=W&&oe!==l&&oe!==p&&Sa(f,S,_,I,v,A,oe.x,oe.y)&&Ci(oe.prev,oe,oe.next)>=0))return!1;oe=oe.nextZ}for(;Q&&Q.z>=Y;){if(Q.x>=L&&Q.x<=$&&Q.y>=R&&Q.y<=W&&Q!==l&&Q!==p&&Sa(f,S,_,I,v,A,Q.x,Q.y)&&Ci(Q.prev,Q,Q.next)>=0)return!1;Q=Q.prevZ}for(;oe&&oe.z<=se;){if(oe.x>=L&&oe.x<=$&&oe.y>=R&&oe.y<=W&&oe!==l&&oe!==p&&Sa(f,S,_,I,v,A,oe.x,oe.y)&&Ci(oe.prev,oe,oe.next)>=0)return!1;oe=oe.nextZ}return!0}function Np(i,e,r){var s=i;do{var l=s.prev,h=s.next.next;!$l(l,h)&&rh(l,s,s.next,h)&&ko(l,h)&&ko(h,l)&&(e.push(l.i/r|0),e.push(s.i/r|0),e.push(h.i/r|0),Ao(s),Ao(s.next),s=i=h),s=s.next}while(s!==i);return Ns(s)}function $p(i,e,r,s,l,h){var p=i;do{for(var f=p.next.next;f!==p.prev;){if(p.i!==f.i&&Zp(p,f)){var _=nh(p,f);return p=Ns(p,p.next),_=Ns(_,_.next),Mo(p,e,r,s,l,h,0),void Mo(_,e,r,s,l,h,0)}f=f.next}p=p.next}while(p!==i)}function jp(i,e){return i.x-e.x}function Vp(i,e){var r=function(l,h){var p,f=h,_=l.x,v=l.y,S=-1/0;do{if(v<=f.y&&v>=f.next.y&&f.next.y!==f.y){var I=f.x+(v-f.y)*(f.next.x-f.x)/(f.next.y-f.y);if(I<=_&&I>S&&(S=I,p=f.x<f.next.x?f:f.next,I===_))return p}f=f.next}while(f!==h);if(!p)return null;var A,L=p,R=p.x,$=p.y,W=1/0;f=p;do _>=f.x&&f.x>=R&&_!==f.x&&Sa(v<$?_:S,v,R,$,v<$?S:_,v,f.x,f.y)&&(A=Math.abs(v-f.y)/(_-f.x),ko(f,l)&&(A<W||A===W&&(f.x>p.x||f.x===p.x&&Up(p,f)))&&(p=f,W=A)),f=f.next;while(f!==L);return p}(i,e);if(!r)return e;var s=nh(r,i);return Ns(s,s.next),Ns(r,r.next)}function Up(i,e){return Ci(i.prev,i,e.prev)<0&&Ci(e.next,i,i.next)<0}function Nc(i,e,r,s,l){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*l|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*l|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function qp(i){var e=i,r=i;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==i);return r}function Sa(i,e,r,s,l,h,p,f){return(l-p)*(e-f)>=(i-p)*(h-f)&&(i-p)*(s-f)>=(r-p)*(e-f)&&(r-p)*(h-f)>=(l-p)*(s-f)}function Zp(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(r,s){var l=r;do{if(l.i!==r.i&&l.next.i!==r.i&&l.i!==s.i&&l.next.i!==s.i&&rh(l,l.next,r,s))return!0;l=l.next}while(l!==r);return!1}(i,e)&&(ko(i,e)&&ko(e,i)&&function(r,s){var l=r,h=!1,p=(r.x+s.x)/2,f=(r.y+s.y)/2;do l.y>f!=l.next.y>f&&l.next.y!==l.y&&p<(l.next.x-l.x)*(f-l.y)/(l.next.y-l.y)+l.x&&(h=!h),l=l.next;while(l!==r);return h}(i,e)&&(Ci(i.prev,i,e.prev)||Ci(i,e.prev,e))||$l(i,e)&&Ci(i.prev,i,i.next)>0&&Ci(e.prev,e,e.next)>0)}function Ci(i,e,r){return(e.y-i.y)*(r.x-e.x)-(e.x-i.x)*(r.y-e.y)}function $l(i,e){return i.x===e.x&&i.y===e.y}function rh(i,e,r,s){var l=Vl(Ci(i,e,r)),h=Vl(Ci(i,e,s)),p=Vl(Ci(r,s,i)),f=Vl(Ci(r,s,e));return l!==h&&p!==f||!(l!==0||!jl(i,r,e))||!(h!==0||!jl(i,s,e))||!(p!==0||!jl(r,i,s))||!(f!==0||!jl(r,e,s))}function jl(i,e,r){return e.x<=Math.max(i.x,r.x)&&e.x>=Math.min(i.x,r.x)&&e.y<=Math.max(i.y,r.y)&&e.y>=Math.min(i.y,r.y)}function Vl(i){return i>0?1:i<0?-1:0}function ko(i,e){return Ci(i.prev,i,i.next)<0?Ci(i,e,i.next)>=0&&Ci(i,i.prev,e)>=0:Ci(i,e,i.prev)<0||Ci(i,i.next,e)<0}function nh(i,e){var r=new $c(i.i,i.x,i.y),s=new $c(e.i,e.x,e.y),l=i.next,h=e.prev;return i.next=e,e.prev=i,r.next=l,l.prev=r,s.next=r,r.prev=s,h.next=s,s.prev=h,s}function sh(i,e,r,s){var l=new $c(i,e,r);return s?(l.next=s.next,l.prev=s,s.next.prev=l,s.next=l):(l.prev=l,l.next=l),l}function Ao(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function $c(i,e,r){this.i=i,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function jc(i,e,r,s){for(var l=0,h=e,p=r-s;h<r;h+=s)l+=(i[p]-i[h])*(i[h+1]+i[p+1]),p=h;return l}Oc.exports=Nl,Oc.exports.default=Nl,Nl.deviation=function(i,e,r,s){var l=e&&e.length,h=Math.abs(jc(i,0,l?e[0]*r:i.length,r));if(l)for(var p=0,f=e.length;p<f;p++)h-=Math.abs(jc(i,e[p]*r,p<f-1?e[p+1]*r:i.length,r));var _=0;for(p=0;p<s.length;p+=3){var v=s[p]*r,S=s[p+1]*r,I=s[p+2]*r;_+=Math.abs((i[v]-i[I])*(i[S+1]-i[v+1])-(i[v]-i[S])*(i[I+1]-i[v+1]))}return h===0&&_===0?0:Math.abs((_-h)/h)},Nl.flatten=function(i){for(var e=i[0][0].length,r={vertices:[],holes:[],dimensions:e},s=0,l=0;l<i.length;l++){for(var h=0;h<i[l].length;h++)for(var p=0;p<e;p++)r.vertices.push(i[l][h][p]);l>0&&r.holes.push(s+=i[l-1].length)}return r};var ah=B(Oc.exports);function Gp(i,e,r,s,l){oh(i,e,r||0,s||i.length-1,l||Hp)}function oh(i,e,r,s,l){for(;s>r;){if(s-r>600){var h=s-r+1,p=e-r+1,f=Math.log(h),_=.5*Math.exp(2*f/3),v=.5*Math.sqrt(f*_*(h-_)/h)*(p-h/2<0?-1:1);oh(i,e,Math.max(r,Math.floor(e-p*_/h+v)),Math.min(s,Math.floor(e+(h-p)*_/h+v)),l)}var S=i[e],I=r,A=s;for(Po(i,r,e),l(i[s],S)>0&&Po(i,r,s);I<A;){for(Po(i,I,A),I++,A--;l(i[I],S)<0;)I++;for(;l(i[A],S)>0;)A--}l(i[r],S)===0?Po(i,r,A):Po(i,++A,s),A<=e&&(r=A+1),e<=A&&(s=A-1)}}function Po(i,e,r){var s=i[e];i[e]=i[r],i[r]=s}function Hp(i,e){return i<e?-1:i>e?1:0}function Vc(i,e){const r=i.length;if(r<=1)return[i];const s=[];let l,h;for(let p=0;p<r;p++){const f=Bt(i[p]);f!==0&&(i[p].area=Math.abs(f),h===void 0&&(h=f<0),h===f<0?(l&&s.push(l),l=[i[p]]):l.push(i[p]))}if(l&&s.push(l),e>1)for(let p=0;p<s.length;p++)s[p].length<=e||(Gp(s[p],e,1,s[p].length-1,Wp),s[p]=s[p].slice(0,e));return s}function Wp(i,e){return e.area-i.area}function Uc(i,e,r){const s=r.patternDependencies;let l=!1;for(const h of e){const p=h.paint.get(`${i}-pattern`);p.isConstant()||(l=!0);const f=p.constantOr(null);f&&(l=!0,s[f.to]=!0,s[f.from]=!0)}return l}function qc(i,e,r,s,l){const h=l.patternDependencies;for(const p of e){const f=p.paint.get(`${i}-pattern`).value;if(f.kind!=="constant"){let _=f.evaluate({zoom:s-1},r,{},l.availableImages),v=f.evaluate({zoom:s},r,{},l.availableImages),S=f.evaluate({zoom:s+1},r,{},l.availableImages);_=_&&_.name?_.name:_,v=v&&v.name?v.name:v,S=S&&S.name?S.name:S,h[_]=!0,h[v]=!0,h[S]=!0,r.patterns[p.id]={min:_,mid:v,max:S}}}return r}class Zc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ct,this.indexArray=new Gi,this.indexArray2=new zi,this.programConfigurations=new fn(e.layers,e.zoom),this.segments=new ii,this.segments2=new ii,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){this.hasPattern=Uc("fill",this.layers,r);const l=this.layers[0].layout.get("fill-sort-key"),h=!l.isConstant(),p=[];for(const{feature:f,id:_,index:v,sourceLayerIndex:S}of e){const I=this.layers[0]._featureFilter.needGeometry,A=Os(f,I);if(!this.layers[0]._featureFilter.filter(new ti(this.zoom),A,s))continue;const L=h?l.evaluate(A,{},s,r.availableImages):void 0,R={id:_,properties:f.properties,type:f.type,sourceLayerIndex:S,index:v,geometry:I?A.geometry:Bs(f),patterns:{},sortKey:L};p.push(R)}h&&p.sort((f,_)=>f.sortKey-_.sortKey);for(const f of p){const{geometry:_,index:v,sourceLayerIndex:S}=f;if(this.hasPattern){const I=qc("fill",this.layers,f,this.zoom,r);this.patternFeatures.push(I)}else this.addFeature(f,_,v,s,{});r.featureIndex.insert(e[v].feature,_,v,S,this.index)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s)}addFeatures(e,r,s){for(const l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,r,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Fp),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,s,l,h){for(const p of Vc(r,500)){let f=0;for(const L of p)f+=L.length;const _=this.segments.prepareSegment(f,this.layoutVertexArray,this.indexArray),v=_.vertexLength,S=[],I=[];for(const L of p){if(L.length===0)continue;L!==p[0]&&I.push(S.length/2);const R=this.segments2.prepareSegment(L.length,this.layoutVertexArray,this.indexArray2),$=R.vertexLength;this.layoutVertexArray.emplaceBack(L[0].x,L[0].y),this.indexArray2.emplaceBack($+L.length-1,$),S.push(L[0].x),S.push(L[0].y);for(let W=1;W<L.length;W++)this.layoutVertexArray.emplaceBack(L[W].x,L[W].y),this.indexArray2.emplaceBack($+W-1,$+W),S.push(L[W].x),S.push(L[W].y);R.vertexLength+=L.length,R.primitiveLength+=L.length}const A=ah(S,I);for(let L=0;L<A.length;L+=3)this.indexArray.emplaceBack(v+A[L],v+A[L+1],v+A[L+2]);_.vertexLength+=f,_.primitiveLength+=A.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,h,l)}}let lh,ch;Ze("FillBucket",Zc,{omit:["layers","patternFeatures"]});var Xp={get paint(){return ch=ch||new wi({"fill-antialias":new et(fe.paint_fill["fill-antialias"]),"fill-opacity":new ct(fe.paint_fill["fill-opacity"]),"fill-color":new ct(fe.paint_fill["fill-color"]),"fill-outline-color":new ct(fe.paint_fill["fill-outline-color"]),"fill-translate":new et(fe.paint_fill["fill-translate"]),"fill-translate-anchor":new et(fe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ls(fe.paint_fill["fill-pattern"])})},get layout(){return lh=lh||new wi({"fill-sort-key":new ct(fe.layout_fill["fill-sort-key"])})}};class Kp extends $r{constructor(e){super(e,Xp)}recalculate(e,r){super.recalculate(e,r);const s=this.paint._values["fill-outline-color"];s.value.kind==="constant"&&s.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Zc(e)}queryRadius(){return Fl(this.paint.get("fill-translate"))}queryIntersectsFeature(e,r,s,l,h,p,f){return qu(Bl(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,f),l)}isTileClipped(){return!0}}const Yp=hi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Jp=hi([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Qp}=Yp;var hs={},ef=ce,uh=Ca;function Ca(i,e,r,s,l){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=s,this._values=l,i.readFields(tf,this,e)}function tf(i,e,r){i==1?e.id=r.readVarint():i==2?function(s,l){for(var h=s.readVarint()+s.pos;s.pos<h;){var p=l._keys[s.readVarint()],f=l._values[s.readVarint()];l.properties[p]=f}}(r,e):i==3?e.type=r.readVarint():i==4&&(e._geometry=r.pos)}function rf(i){for(var e,r,s=0,l=0,h=i.length,p=h-1;l<h;p=l++)s+=((r=i[p]).x-(e=i[l]).x)*(e.y+r.y);return s}Ca.types=["Unknown","Point","LineString","Polygon"],Ca.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,r=i.readVarint()+i.pos,s=1,l=0,h=0,p=0,f=[];i.pos<r;){if(l<=0){var _=i.readVarint();s=7&_,l=_>>3}if(l--,s===1||s===2)h+=i.readSVarint(),p+=i.readSVarint(),s===1&&(e&&f.push(e),e=[]),e.push(new ef(h,p));else{if(s!==7)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&f.push(e),f},Ca.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,r=1,s=0,l=0,h=0,p=1/0,f=-1/0,_=1/0,v=-1/0;i.pos<e;){if(s<=0){var S=i.readVarint();r=7&S,s=S>>3}if(s--,r===1||r===2)(l+=i.readSVarint())<p&&(p=l),l>f&&(f=l),(h+=i.readSVarint())<_&&(_=h),h>v&&(v=h);else if(r!==7)throw new Error("unknown command "+r)}return[p,_,f,v]},Ca.prototype.toGeoJSON=function(i,e,r){var s,l,h=this.extent*Math.pow(2,r),p=this.extent*i,f=this.extent*e,_=this.loadGeometry(),v=Ca.types[this.type];function S(L){for(var R=0;R<L.length;R++){var $=L[R];L[R]=[360*($.x+p)/h-180,360/Math.PI*Math.atan(Math.exp((180-360*($.y+f)/h)*Math.PI/180))-90]}}switch(this.type){case 1:var I=[];for(s=0;s<_.length;s++)I[s]=_[s][0];S(_=I);break;case 2:for(s=0;s<_.length;s++)S(_[s]);break;case 3:for(_=function(L){var R=L.length;if(R<=1)return[L];for(var $,W,Y=[],se=0;se<R;se++){var Q=rf(L[se]);Q!==0&&(W===void 0&&(W=Q<0),W===Q<0?($&&Y.push($),$=[L[se]]):$.push(L[se]))}return $&&Y.push($),Y}(_),s=0;s<_.length;s++)for(l=0;l<_[s].length;l++)S(_[s][l])}_.length===1?_=_[0]:v="Multi"+v;var A={type:"Feature",geometry:{type:v,coordinates:_},properties:this.properties};return"id"in this&&(A.id=this.id),A};var nf=uh,hh=dh;function dh(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(sf,this,e),this.length=this._features.length}function sf(i,e,r){i===15?e.version=r.readVarint():i===1?e.name=r.readString():i===5?e.extent=r.readVarint():i===2?e._features.push(r.pos):i===3?e._keys.push(r.readString()):i===4&&e._values.push(function(s){for(var l=null,h=s.readVarint()+s.pos;s.pos<h;){var p=s.readVarint()>>3;l=p===1?s.readString():p===2?s.readFloat():p===3?s.readDouble():p===4?s.readVarint64():p===5?s.readVarint():p===6?s.readSVarint():p===7?s.readBoolean():null}return l}(r))}dh.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new nf(this._pbf,e,this.extent,this._keys,this._values)};var af=hh;function of(i,e,r){if(i===3){var s=new af(r,r.readVarint()+r.pos);s.length&&(e[s.name]=s)}}hs.VectorTile=function(i,e){this.layers=i.readFields(of,{},e)},hs.VectorTileFeature=uh,hs.VectorTileLayer=hh;const lf=hs.VectorTileFeature.types,Gc=Math.pow(2,13);function zo(i,e,r,s,l,h,p,f){i.emplaceBack(e,r,2*Math.floor(s*Gc)+p,l*Gc*2,h*Gc*2,Math.round(f))}class Hc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Le,this.centroidVertexArray=new ke,this.indexArray=new Gi,this.programConfigurations=new fn(e.layers,e.zoom),this.segments=new ii,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){this.features=[],this.hasPattern=Uc("fill-extrusion",this.layers,r);for(const{feature:l,id:h,index:p,sourceLayerIndex:f}of e){const _=this.layers[0]._featureFilter.needGeometry,v=Os(l,_);if(!this.layers[0]._featureFilter.filter(new ti(this.zoom),v,s))continue;const S={id:h,sourceLayerIndex:f,index:p,geometry:_?v.geometry:Bs(l),properties:l.properties,type:l.type,patterns:{}};this.hasPattern?this.features.push(qc("fill-extrusion",this.layers,S,this.zoom,r)):this.addFeature(S,S.geometry,p,s,{}),r.featureIndex.insert(l,S.geometry,p,f,this.index,!0)}}addFeatures(e,r,s){for(const l of this.features){const{geometry:h}=l;this.addFeature(l,h,l.index,r,s)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Qp),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Jp.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,r,s,l,h){const p={x:0,y:0,vertexCount:0};for(const f of Vc(r,500)){let _=0;for(const R of f)_+=R.length;let v=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const R of f){if(R.length===0||uf(R))continue;let $=0;for(let W=0;W<R.length;W++){const Y=R[W];if(W>=1){const se=R[W-1];if(!cf(Y,se)){v.vertexLength+4>ii.MAX_VERTEX_ARRAY_LENGTH&&(v=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Q=Y.sub(se)._perp()._unit(),oe=se.dist(Y);$+oe>32768&&($=0),zo(this.layoutVertexArray,Y.x,Y.y,Q.x,Q.y,0,0,$),zo(this.layoutVertexArray,Y.x,Y.y,Q.x,Q.y,0,1,$),p.x+=2*Y.x,p.y+=2*Y.y,p.vertexCount+=2,$+=oe,zo(this.layoutVertexArray,se.x,se.y,Q.x,Q.y,0,0,$),zo(this.layoutVertexArray,se.x,se.y,Q.x,Q.y,0,1,$),p.x+=2*se.x,p.y+=2*se.y,p.vertexCount+=2;const ue=v.vertexLength;this.indexArray.emplaceBack(ue,ue+2,ue+1),this.indexArray.emplaceBack(ue+1,ue+2,ue+3),v.vertexLength+=4,v.primitiveLength+=2}}}}if(v.vertexLength+_>ii.MAX_VERTEX_ARRAY_LENGTH&&(v=this.segments.prepareSegment(_,this.layoutVertexArray,this.indexArray)),lf[e.type]!=="Polygon")continue;const S=[],I=[],A=v.vertexLength;for(const R of f)if(R.length!==0){R!==f[0]&&I.push(S.length/2);for(let $=0;$<R.length;$++){const W=R[$];zo(this.layoutVertexArray,W.x,W.y,0,0,1,1,0),p.x+=W.x,p.y+=W.y,p.vertexCount+=1,S.push(W.x),S.push(W.y)}}const L=ah(S,I);for(let R=0;R<L.length;R+=3)this.indexArray.emplaceBack(A+L[R],A+L[R+2],A+L[R+1]);v.primitiveLength+=L.length/3,v.vertexLength+=_}for(let f=0;f<p.vertexCount;f++)this.centroidVertexArray.emplaceBack(Math.floor(p.x/p.vertexCount),Math.floor(p.y/p.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,h,l)}}function cf(i,e){return i.x===e.x&&(i.x<0||i.x>Mi)||i.y===e.y&&(i.y<0||i.y>Mi)}function uf(i){return i.every(e=>e.x<0)||i.every(e=>e.x>Mi)||i.every(e=>e.y<0)||i.every(e=>e.y>Mi)}let ph;Ze("FillExtrusionBucket",Hc,{omit:["layers","features"]});var hf={get paint(){return ph=ph||new wi({"fill-extrusion-opacity":new et(fe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ct(fe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new et(fe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new et(fe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ls(fe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ct(fe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ct(fe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new et(fe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class df extends $r{constructor(e){super(e,hf)}createBucket(e){return new Hc(e)}queryRadius(){return Fl(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(e,r,s,l,h,p,f,_){const v=Bl(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,f),S=this.paint.get("fill-extrusion-height").evaluate(r,s),I=this.paint.get("fill-extrusion-base").evaluate(r,s),A=function(R,$,W,Y){const se=[];for(const Q of R){const oe=[Q.x,Q.y,0,1];Ol(oe,oe,$),se.push(new de(oe[0]/oe[3],oe[1]/oe[3]))}return se}(v,_),L=function(R,$,W,Y){const se=[],Q=[],oe=Y[8]*$,ue=Y[9]*$,ve=Y[10]*$,Ve=Y[11]*$,Ke=Y[8]*W,$e=Y[9]*W,Re=Y[10]*W,Pe=Y[11]*W;for(const Ge of R){const ze=[],Ee=[];for(const rt of Ge){const Je=rt.x,wt=rt.y,ri=Y[0]*Je+Y[4]*wt+Y[12],oi=Y[1]*Je+Y[5]*wt+Y[13],Ri=Y[2]*Je+Y[6]*wt+Y[14],Vr=Y[3]*Je+Y[7]*wt+Y[15],xr=Ri+ve,ki=Vr+Ve,Wi=ri+Ke,tr=oi+$e,vr=Ri+Re,br=Vr+Pe,Fi=new de((ri+oe)/ki,(oi+ue)/ki);Fi.z=xr/ki,ze.push(Fi);const Bi=new de(Wi/br,tr/br);Bi.z=vr/br,Ee.push(Bi)}se.push(ze),Q.push(Ee)}return[se,Q]}(l,I,S,_);return function(R,$,W){let Y=1/0;qu(W,$)&&(Y=fh(W,$[0]));for(let se=0;se<$.length;se++){const Q=$[se],oe=R[se];for(let ue=0;ue<Q.length-1;ue++){const ve=Q[ue],Ve=[ve,Q[ue+1],oe[ue+1],oe[ue],ve];Uu(W,Ve)&&(Y=Math.min(Y,fh(W,Ve)))}}return Y!==1/0&&Y}(L[0],L[1],A)}}function Do(i,e){return i.x*e.x+i.y*e.y}function fh(i,e){if(i.length===1){let r=0;const s=e[r++];let l;for(;!l||s.equals(l);)if(l=e[r++],!l)return 1/0;for(;r<e.length;r++){const h=e[r],p=i[0],f=l.sub(s),_=h.sub(s),v=p.sub(s),S=Do(f,f),I=Do(f,_),A=Do(_,_),L=Do(v,f),R=Do(v,_),$=S*A-I*I,W=(A*L-I*R)/$,Y=(S*R-I*L)/$,se=s.z*(1-W-Y)+l.z*W+h.z*Y;if(isFinite(se))return se}return 1/0}{let r=1/0;for(const s of e)r=Math.min(r,s.z);return r}}const pf=hi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:ff}=pf,mf=hi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:gf}=mf,_f=hs.VectorTileFeature.types,yf=Math.cos(Math.PI/180*37.5),mh=Math.pow(2,14)/.5;class Wc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new ut,this.layoutVertexArray2=new Ye,this.indexArray=new Gi,this.programConfigurations=new fn(e.layers,e.zoom),this.segments=new ii,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){this.hasPattern=Uc("line",this.layers,r);const l=this.layers[0].layout.get("line-sort-key"),h=!l.isConstant(),p=[];for(const{feature:f,id:_,index:v,sourceLayerIndex:S}of e){const I=this.layers[0]._featureFilter.needGeometry,A=Os(f,I);if(!this.layers[0]._featureFilter.filter(new ti(this.zoom),A,s))continue;const L=h?l.evaluate(A,{},s):void 0,R={id:_,properties:f.properties,type:f.type,sourceLayerIndex:S,index:v,geometry:I?A.geometry:Bs(f),patterns:{},sortKey:L};p.push(R)}h&&p.sort((f,_)=>f.sortKey-_.sortKey);for(const f of p){const{geometry:_,index:v,sourceLayerIndex:S}=f;if(this.hasPattern){const I=qc("line",this.layers,f,this.zoom,r);this.patternFeatures.push(I)}else this.addFeature(f,_,v,s,{});r.featureIndex.insert(e[v].feature,_,v,S,this.index)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s)}addFeatures(e,r,s){for(const l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,r,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,gf)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ff),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,s,l,h){const p=this.layers[0].layout,f=p.get("line-join").evaluate(e,{}),_=p.get("line-cap"),v=p.get("line-miter-limit"),S=p.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const I of r)this.addLine(I,e,f,_,v,S);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,h,l)}addLine(e,r,s,l,h,p){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Y=0;Y<e.length-1;Y++)this.totalDistance+=e[Y].dist(e[Y+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const f=_f[r.type]==="Polygon";let _=e.length;for(;_>=2&&e[_-1].equals(e[_-2]);)_--;let v=0;for(;v<_-1&&e[v].equals(e[v+1]);)v++;if(_<(f?3:2))return;s==="bevel"&&(h=1.05);const S=this.overscaling<=16?15*Mi/(512*this.overscaling):0,I=this.segments.prepareSegment(10*_,this.layoutVertexArray,this.indexArray);let A,L,R,$,W;this.e1=this.e2=-1,f&&(A=e[_-2],W=e[v].sub(A)._unit()._perp());for(let Y=v;Y<_;Y++){if(R=Y===_-1?f?e[v+1]:void 0:e[Y+1],R&&e[Y].equals(R))continue;W&&($=W),A&&(L=A),A=e[Y],W=R?R.sub(A)._unit()._perp():$,$=$||W;let se=$.add(W);se.x===0&&se.y===0||se._unit();const Q=$.x*W.x+$.y*W.y,oe=se.x*W.x+se.y*W.y,ue=oe!==0?1/oe:1/0,ve=2*Math.sqrt(2-2*oe),Ve=oe<yf&&L&&R,Ke=$.x*W.y-$.y*W.x>0;if(Ve&&Y>v){const Pe=A.dist(L);if(Pe>2*S){const Ge=A.sub(A.sub(L)._mult(S/Pe)._round());this.updateDistance(L,Ge),this.addCurrentVertex(Ge,$,0,0,I),L=Ge}}const $e=L&&R;let Re=$e?s:f?"butt":l;if($e&&Re==="round"&&(ue<p?Re="miter":ue<=2&&(Re="fakeround")),Re==="miter"&&ue>h&&(Re="bevel"),Re==="bevel"&&(ue>2&&(Re="flipbevel"),ue<h&&(Re="miter")),L&&this.updateDistance(L,A),Re==="miter")se._mult(ue),this.addCurrentVertex(A,se,0,0,I);else if(Re==="flipbevel"){if(ue>100)se=W.mult(-1);else{const Pe=ue*$.add(W).mag()/$.sub(W).mag();se._perp()._mult(Pe*(Ke?-1:1))}this.addCurrentVertex(A,se,0,0,I),this.addCurrentVertex(A,se.mult(-1),0,0,I)}else if(Re==="bevel"||Re==="fakeround"){const Pe=-Math.sqrt(ue*ue-1),Ge=Ke?Pe:0,ze=Ke?0:Pe;if(L&&this.addCurrentVertex(A,$,Ge,ze,I),Re==="fakeround"){const Ee=Math.round(180*ve/Math.PI/20);for(let rt=1;rt<Ee;rt++){let Je=rt/Ee;if(Je!==.5){const ri=Je-.5;Je+=Je*ri*(Je-1)*((1.0904+Q*(Q*(3.55645-1.43519*Q)-3.2452))*ri*ri+(.848013+Q*(.215638*Q-1.06021)))}const wt=W.sub($)._mult(Je)._add($)._unit()._mult(Ke?-1:1);this.addHalfVertex(A,wt.x,wt.y,!1,Ke,0,I)}}R&&this.addCurrentVertex(A,W,-Ge,-ze,I)}else if(Re==="butt")this.addCurrentVertex(A,se,0,0,I);else if(Re==="square"){const Pe=L?1:-1;this.addCurrentVertex(A,se,Pe,Pe,I)}else Re==="round"&&(L&&(this.addCurrentVertex(A,$,0,0,I),this.addCurrentVertex(A,$,1,1,I,!0)),R&&(this.addCurrentVertex(A,W,-1,-1,I,!0),this.addCurrentVertex(A,W,0,0,I)));if(Ve&&Y<_-1){const Pe=A.dist(R);if(Pe>2*S){const Ge=A.add(R.sub(A)._mult(S/Pe)._round());this.updateDistance(A,Ge),this.addCurrentVertex(Ge,W,0,0,I),A=Ge}}}}addCurrentVertex(e,r,s,l,h,p=!1){const f=r.y*l-r.x,_=-r.y-r.x*l;this.addHalfVertex(e,r.x+r.y*s,r.y-r.x*s,p,!1,s,h),this.addHalfVertex(e,f,_,p,!0,-l,h),this.distance>mh/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,r,s,l,h,p))}addHalfVertex({x:e,y:r},s,l,h,p,f,_){const v=.5*(this.lineClips?this.scaledDistance*(mh-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(h?1:0),(r<<1)+(p?1:0),Math.round(63*s)+128,Math.round(63*l)+128,1+(f===0?0:f<0?-1:1)|(63&v)<<2,v>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const S=_.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,S),_.primitiveLength++),p?this.e2=S:this.e1=S}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}let gh,_h;Ze("LineBucket",Wc,{omit:["layers","patternFeatures"]});var yh={get paint(){return _h=_h||new wi({"line-opacity":new ct(fe.paint_line["line-opacity"]),"line-color":new ct(fe.paint_line["line-color"]),"line-translate":new et(fe.paint_line["line-translate"]),"line-translate-anchor":new et(fe.paint_line["line-translate-anchor"]),"line-width":new ct(fe.paint_line["line-width"]),"line-gap-width":new ct(fe.paint_line["line-gap-width"]),"line-offset":new ct(fe.paint_line["line-offset"]),"line-blur":new ct(fe.paint_line["line-blur"]),"line-dasharray":new go(fe.paint_line["line-dasharray"]),"line-pattern":new Ls(fe.paint_line["line-pattern"]),"line-gradient":new _o(fe.paint_line["line-gradient"])})},get layout(){return gh=gh||new wi({"line-cap":new et(fe.layout_line["line-cap"]),"line-join":new ct(fe.layout_line["line-join"]),"line-miter-limit":new et(fe.layout_line["line-miter-limit"]),"line-round-limit":new et(fe.layout_line["line-round-limit"]),"line-sort-key":new ct(fe.layout_line["line-sort-key"])})}};class xf extends ct{possiblyEvaluate(e,r){return r=new ti(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(e,r)}evaluate(e,r,s,l){return r=He({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(e,r,s,l)}}let Ul;class vf extends $r{constructor(e){super(e,yh),this.gradientVersion=0,Ul||(Ul=new xf(yh.paint.properties["line-width"].specification),Ul.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!function(s){return s._styleExpression!==void 0}(r)&&r._styleExpression.expression instanceof Tn,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,r){super.recalculate(e,r),this.paint._values["line-floorwidth"]=Ul.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Wc(e)}queryRadius(e){const r=e,s=xh(To("line-width",this,r),To("line-gap-width",this,r)),l=To("line-offset",this,r);return s/2+Math.abs(l)+Fl(this.paint.get("line-translate"))}queryIntersectsFeature(e,r,s,l,h,p,f){const _=Bl(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,f),v=f/2*xh(this.paint.get("line-width").evaluate(r,s),this.paint.get("line-gap-width").evaluate(r,s)),S=this.paint.get("line-offset").evaluate(r,s);return S&&(l=function(I,A){const L=[];for(let R=0;R<I.length;R++){const $=I[R],W=[];for(let Y=0;Y<$.length;Y++){const se=$[Y-1],Q=$[Y],oe=$[Y+1],ue=Y===0?new de(0,0):Q.sub(se)._unit()._perp(),ve=Y===$.length-1?new de(0,0):oe.sub(Q)._unit()._perp(),Ve=ue._add(ve)._unit(),Ke=Ve.x*ve.x+Ve.y*ve.y;Ke!==0&&Ve._mult(1/Ke),W.push(Ve._mult(A)._add(Q))}L.push(W)}return L}(l,S*f)),function(I,A,L){for(let R=0;R<A.length;R++){const $=A[R];if(I.length>=3){for(let W=0;W<$.length;W++)if(ba(I,$[W]))return!0}if(Tp(I,$,L))return!0}return!1}(_,l,v)}isTileClipped(){return!0}}function xh(i,e){return e>0?e+2*i:i}const bf=hi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),wf=hi([{name:"a_projected_pos",components:3,type:"Float32"}],4);hi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Sf=hi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);hi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const vh=hi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Cf=hi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Tf(i,e,r){return i.sections.forEach(s=>{s.text=function(l,h,p){const f=h.layout.get("text-transform").evaluate(p,{});return f==="uppercase"?l=l.toLocaleUpperCase():f==="lowercase"&&(l=l.toLocaleLowerCase()),Mr.applyArabicShaping&&(l=Mr.applyArabicShaping(l)),l}(s.text,e,r)}),i}hi([{name:"triangle",components:3,type:"Uint16"}]),hi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),hi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),hi([{type:"Float32",name:"offsetX"}]),hi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),hi([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Lo={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Li=24,bh=Ht,wh=function(i,e,r,s,l){var h,p,f=8*l-s-1,_=(1<<f)-1,v=_>>1,S=-7,I=r?l-1:0,A=r?-1:1,L=i[e+I];for(I+=A,h=L&(1<<-S)-1,L>>=-S,S+=f;S>0;h=256*h+i[e+I],I+=A,S-=8);for(p=h&(1<<-S)-1,h>>=-S,S+=s;S>0;p=256*p+i[e+I],I+=A,S-=8);if(h===0)h=1-v;else{if(h===_)return p?NaN:1/0*(L?-1:1);p+=Math.pow(2,s),h-=v}return(L?-1:1)*p*Math.pow(2,h-s)},Sh=function(i,e,r,s,l,h){var p,f,_,v=8*h-l-1,S=(1<<v)-1,I=S>>1,A=l===23?Math.pow(2,-24)-Math.pow(2,-77):0,L=s?0:h-1,R=s?1:-1,$=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(f=isNaN(e)?1:0,p=S):(p=Math.floor(Math.log(e)/Math.LN2),e*(_=Math.pow(2,-p))<1&&(p--,_*=2),(e+=p+I>=1?A/_:A*Math.pow(2,1-I))*_>=2&&(p++,_/=2),p+I>=S?(f=0,p=S):p+I>=1?(f=(e*_-1)*Math.pow(2,l),p+=I):(f=e*Math.pow(2,I-1)*Math.pow(2,l),p=0));l>=8;i[r+L]=255&f,L+=R,f/=256,l-=8);for(p=p<<l|f,v+=l;v>0;i[r+L]=255&p,L+=R,p/=256,v-=8);i[r+L-R]|=128*$};function Ht(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Ht.Varint=0,Ht.Fixed64=1,Ht.Bytes=2,Ht.Fixed32=5;var Xc=4294967296,Ch=1/Xc,Th=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Gn(i){return i.type===Ht.Bytes?i.readVarint()+i.pos:i.pos+1}function Ta(i,e,r){return r?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function Ih(i,e,r){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(s);for(var l=r.pos-1;l>=i;l--)r.buf[l+s]=r.buf[l]}function If(i,e){for(var r=0;r<i.length;r++)e.writeVarint(i[r])}function Ef(i,e){for(var r=0;r<i.length;r++)e.writeSVarint(i[r])}function Mf(i,e){for(var r=0;r<i.length;r++)e.writeFloat(i[r])}function kf(i,e){for(var r=0;r<i.length;r++)e.writeDouble(i[r])}function Af(i,e){for(var r=0;r<i.length;r++)e.writeBoolean(i[r])}function Pf(i,e){for(var r=0;r<i.length;r++)e.writeFixed32(i[r])}function zf(i,e){for(var r=0;r<i.length;r++)e.writeSFixed32(i[r])}function Df(i,e){for(var r=0;r<i.length;r++)e.writeFixed64(i[r])}function Lf(i,e){for(var r=0;r<i.length;r++)e.writeSFixed64(i[r])}function ql(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function Ia(i,e,r){i[r]=e,i[r+1]=e>>>8,i[r+2]=e>>>16,i[r+3]=e>>>24}function Eh(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}Ht.prototype={destroy:function(){this.buf=null},readFields:function(i,e,r){for(r=r||this.length;this.pos<r;){var s=this.readVarint(),l=s>>3,h=this.pos;this.type=7&s,i(l,e,this),this.pos===h&&this.skip(s)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=ql(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Eh(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=ql(this.buf,this.pos)+ql(this.buf,this.pos+4)*Xc;return this.pos+=8,i},readSFixed64:function(){var i=ql(this.buf,this.pos)+Eh(this.buf,this.pos+4)*Xc;return this.pos+=8,i},readFloat:function(){var i=wh(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=wh(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,r,s=this.buf;return e=127&(r=s[this.pos++]),r<128?e:(e|=(127&(r=s[this.pos++]))<<7,r<128?e:(e|=(127&(r=s[this.pos++]))<<14,r<128?e:(e|=(127&(r=s[this.pos++]))<<21,r<128?e:function(l,h,p){var f,_,v=p.buf;if(f=(112&(_=v[p.pos++]))>>4,_<128||(f|=(127&(_=v[p.pos++]))<<3,_<128)||(f|=(127&(_=v[p.pos++]))<<10,_<128)||(f|=(127&(_=v[p.pos++]))<<17,_<128)||(f|=(127&(_=v[p.pos++]))<<24,_<128)||(f|=(1&(_=v[p.pos++]))<<31,_<128))return Ta(l,f,h);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=s[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&Th?function(r,s,l){return Th.decode(r.subarray(s,l))}(this.buf,e,i):function(r,s,l){for(var h="",p=s;p<l;){var f,_,v,S=r[p],I=null,A=S>239?4:S>223?3:S>191?2:1;if(p+A>l)break;A===1?S<128&&(I=S):A===2?(192&(f=r[p+1]))==128&&(I=(31&S)<<6|63&f)<=127&&(I=null):A===3?(_=r[p+2],(192&(f=r[p+1]))==128&&(192&_)==128&&((I=(15&S)<<12|(63&f)<<6|63&_)<=2047||I>=55296&&I<=57343)&&(I=null)):A===4&&(_=r[p+2],v=r[p+3],(192&(f=r[p+1]))==128&&(192&_)==128&&(192&v)==128&&((I=(15&S)<<18|(63&f)<<12|(63&_)<<6|63&v)<=65535||I>=1114112)&&(I=null)),I===null?(I=65533,A=1):I>65535&&(I-=65536,h+=String.fromCharCode(I>>>10&1023|55296),I=56320|1023&I),h+=String.fromCharCode(I),p+=A}return h}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==Ht.Bytes)return i.push(this.readVarint(e));var r=Gn(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==Ht.Bytes)return i.push(this.readSVarint());var e=Gn(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Ht.Bytes)return i.push(this.readBoolean());var e=Gn(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Ht.Bytes)return i.push(this.readFloat());var e=Gn(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Ht.Bytes)return i.push(this.readDouble());var e=Gn(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Ht.Bytes)return i.push(this.readFixed32());var e=Gn(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Ht.Bytes)return i.push(this.readSFixed32());var e=Gn(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Ht.Bytes)return i.push(this.readFixed64());var e=Gn(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Ht.Bytes)return i.push(this.readSFixed64());var e=Gn(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===Ht.Varint)for(;this.buf[this.pos++]>127;);else if(e===Ht.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Ht.Fixed32)this.pos+=4;else{if(e!==Ht.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Ia(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Ia(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Ia(this.buf,-1&i,this.pos),Ia(this.buf,Math.floor(i*Ch),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Ia(this.buf,-1&i,this.pos),Ia(this.buf,Math.floor(i*Ch),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,r){var s,l;if(e>=0?(s=e%4294967296|0,l=e/4294967296|0):(l=~(-e/4294967296),4294967295^(s=~(-e%4294967296))?s=s+1|0:(s=0,l=l+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(h,p,f){f.buf[f.pos++]=127&h|128,h>>>=7,f.buf[f.pos++]=127&h|128,h>>>=7,f.buf[f.pos++]=127&h|128,h>>>=7,f.buf[f.pos++]=127&h|128,f.buf[f.pos]=127&(h>>>=7)}(s,0,r),function(h,p){var f=(7&h)<<4;p.buf[p.pos++]|=f|((h>>>=3)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h)))))}(l,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(s,l,h){for(var p,f,_=0;_<l.length;_++){if((p=l.charCodeAt(_))>55295&&p<57344){if(!f){p>56319||_+1===l.length?(s[h++]=239,s[h++]=191,s[h++]=189):f=p;continue}if(p<56320){s[h++]=239,s[h++]=191,s[h++]=189,f=p;continue}p=f-55296<<10|p-56320|65536,f=null}else f&&(s[h++]=239,s[h++]=191,s[h++]=189,f=null);p<128?s[h++]=p:(p<2048?s[h++]=p>>6|192:(p<65536?s[h++]=p>>12|224:(s[h++]=p>>18|240,s[h++]=p>>12&63|128),s[h++]=p>>6&63|128),s[h++]=63&p|128)}return h}(this.buf,i,this.pos);var r=this.pos-e;r>=128&&Ih(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),Sh(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Sh(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,e){this.pos++;var r=this.pos;i(e,this);var s=this.pos-r;s>=128&&Ih(r,s,this),this.pos=r-1,this.writeVarint(s),this.pos+=s},writeMessage:function(i,e,r){this.writeTag(i,Ht.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,If,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,Ef,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,Af,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,Mf,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,kf,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,Pf,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,zf,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,Df,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,Lf,e)},writeBytesField:function(i,e){this.writeTag(i,Ht.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,Ht.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,Ht.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,Ht.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,Ht.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,Ht.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,Ht.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,Ht.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,Ht.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,Ht.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,!!e)}};var Kc=B(bh);const Yc=3;function Rf(i,e,r){i===1&&r.readMessage(Ff,e)}function Ff(i,e,r){if(i===3){const{id:s,bitmap:l,width:h,height:p,left:f,top:_,advance:v}=r.readMessage(Bf,{});e.push({id:s,bitmap:new Eo({width:h+2*Yc,height:p+2*Yc},l),metrics:{width:h,height:p,left:f,top:_,advance:v}})}}function Bf(i,e,r){i===1?e.id=r.readVarint():i===2?e.bitmap=r.readBytes():i===3?e.width=r.readVarint():i===4?e.height=r.readVarint():i===5?e.left=r.readSVarint():i===6?e.top=r.readSVarint():i===7&&(e.advance=r.readVarint())}const Mh=Yc;function kh(i){let e=0,r=0;for(const p of i)e+=p.w*p.h,r=Math.max(r,p.w);i.sort((p,f)=>f.h-p.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let l=0,h=0;for(const p of i)for(let f=s.length-1;f>=0;f--){const _=s[f];if(!(p.w>_.w||p.h>_.h)){if(p.x=_.x,p.y=_.y,h=Math.max(h,p.y+p.h),l=Math.max(l,p.x+p.w),p.w===_.w&&p.h===_.h){const v=s.pop();f<s.length&&(s[f]=v)}else p.h===_.h?(_.x+=p.w,_.w-=p.w):p.w===_.w?(_.y+=p.h,_.h-=p.h):(s.push({x:_.x+p.w,y:_.y,w:_.w-p.w,h:p.h}),_.y+=p.h,_.h-=p.h);break}}return{w:l,h,fill:e/(l*h)||0}}const Ar=1;class Jc{constructor(e,{pixelRatio:r,version:s,stretchX:l,stretchY:h,content:p}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=l,this.stretchY=h,this.content=p,this.version=s}get tl(){return[this.paddedRect.x+Ar,this.paddedRect.y+Ar]}get br(){return[this.paddedRect.x+this.paddedRect.w-Ar,this.paddedRect.y+this.paddedRect.h-Ar]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Ar)/this.pixelRatio,(this.paddedRect.h-2*Ar)/this.pixelRatio]}}class Ah{constructor(e,r){const s={},l={};this.haveRenderCallbacks=[];const h=[];this.addImages(e,s,h),this.addImages(r,l,h);const{w:p,h:f}=kh(h),_=new qr({width:p||1,height:f||1});for(const v in e){const S=e[v],I=s[v].paddedRect;qr.copy(S.data,_,{x:0,y:0},{x:I.x+Ar,y:I.y+Ar},S.data)}for(const v in r){const S=r[v],I=l[v].paddedRect,A=I.x+Ar,L=I.y+Ar,R=S.data.width,$=S.data.height;qr.copy(S.data,_,{x:0,y:0},{x:A,y:L},S.data),qr.copy(S.data,_,{x:0,y:$-1},{x:A,y:L-1},{width:R,height:1}),qr.copy(S.data,_,{x:0,y:0},{x:A,y:L+$},{width:R,height:1}),qr.copy(S.data,_,{x:R-1,y:0},{x:A-1,y:L},{width:1,height:$}),qr.copy(S.data,_,{x:0,y:0},{x:A+R,y:L},{width:1,height:$})}this.image=_,this.iconPositions=s,this.patternPositions=l}addImages(e,r,s){for(const l in e){const h=e[l],p={x:0,y:0,w:h.data.width+2*Ar,h:h.data.height+2*Ar};s.push(p),r[l]=new Jc(p,h),h.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(e,r){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in e.updatedImages)this.patchUpdatedImage(this.iconPositions[s],e.getImage(s),r),this.patchUpdatedImage(this.patternPositions[s],e.getImage(s),r)}patchUpdatedImage(e,r,s){if(!e||!r||e.version===r.version)return;e.version=r.version;const[l,h]=e.tl;s.update(r.data,void 0,{x:l,y:h})}}var ds;Ze("ImagePosition",Jc),Ze("ImageAtlas",Ah),o.ai=void 0,(ds=o.ai||(o.ai={}))[ds.none=0]="none",ds[ds.horizontal=1]="horizontal",ds[ds.vertical=2]="vertical",ds[ds.horizontalOnly=3]="horizontalOnly";const Ro=-17;class Fo{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const s=new Fo;return s.scale=e||1,s.fontStack=r,s}static forImage(e){const r=new Fo;return r.imageName=e,r}}class Ea{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const s=new Ea;for(let l=0;l<e.sections.length;l++){const h=e.sections[l];h.image?s.addImageSection(h):s.addTextSection(h,r)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let r="";for(let s=0;s<e.length;s++){const l=e.charCodeAt(s+1)||null,h=e.charCodeAt(s-1)||null;r+=l&&Tl(l)&&!Lo[e[s+1]]||h&&Tl(h)&&!Lo[e[s-1]]||!Lo[e[s]]?e[s]:Lo[e[s]]}return r}(this.text)}trim(){let e=0;for(let s=0;s<this.text.length&&Gl[this.text.charCodeAt(s)];s++)e++;let r=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&Gl[this.text.charCodeAt(s)];s--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const s=new Ea;return s.text=this.text.substring(e,r),s.sectionIndex=this.sectionIndex.slice(e,r),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(Fo.forText(e.scale,e.fontStack||r));const s=this.sections.length-1;for(let l=0;l<e.text.length;++l)this.sectionIndex.push(s)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void xt("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(Fo.forImage(r)),this.sectionIndex.push(this.sections.length-1)):xt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Zl(i,e,r,s,l,h,p,f,_,v,S,I,A,L,R,$){const W=Ea.fromFeature(i,l);let Y;I===o.ai.vertical&&W.verticalizePunctuation();const{processBidirectionalText:se,processStyledBidirectionalText:Q}=Mr;if(se&&W.sections.length===1){Y=[];const ve=se(W.toString(),Qc(W,v,h,e,s,L,R));for(const Ve of ve){const Ke=new Ea;Ke.text=Ve,Ke.sections=W.sections;for(let $e=0;$e<Ve.length;$e++)Ke.sectionIndex.push(0);Y.push(Ke)}}else if(Q){Y=[];const ve=Q(W.text,W.sectionIndex,Qc(W,v,h,e,s,L,R));for(const Ve of ve){const Ke=new Ea;Ke.text=Ve[0],Ke.sectionIndex=Ve[1],Ke.sections=W.sections,Y.push(Ke)}}else Y=function(ve,Ve){const Ke=[],$e=ve.text;let Re=0;for(const Pe of Ve)Ke.push(ve.substring(Re,Pe)),Re=Pe;return Re<$e.length&&Ke.push(ve.substring(Re,$e.length)),Ke}(W,Qc(W,v,h,e,s,L,R));const oe=[],ue={positionedLines:oe,text:W.toString(),top:S[1],bottom:S[1],left:S[0],right:S[0],writingMode:I,iconsInText:!1,verticalizable:!1};return function(ve,Ve,Ke,$e,Re,Pe,Ge,ze,Ee,rt,Je,wt){let ri=0,oi=Ro,Ri=0,Vr=0;const xr=ze==="right"?1:ze==="left"?0:.5;let ki=0;for(const Fi of Re){Fi.trim();const Bi=Fi.getMaxScale(),lr=(Bi-1)*Li,wr={positionedGlyphs:[],lineOffset:0};ve.positionedLines[ki]=wr;const cr=wr.positionedGlyphs;let Pr=0;if(!Fi.length()){oi+=Pe,++ki;continue}for(let Oi=0;Oi<Fi.length();Oi++){const It=Fi.getSection(Oi),ur=Fi.getSectionIndex(Oi),ir=Fi.getCharCode(Oi);let Ni=0,sn=null,mn=null,gn=null,Hn=Li;const an=!(Ee===o.ai.horizontal||!Je&&!oo(ir)||Je&&(Gl[ir]||(Wi=ir,je.Arabic(Wi)||je["Arabic Supplement"](Wi)||je["Arabic Extended-A"](Wi)||je["Arabic Presentation Forms-A"](Wi)||je["Arabic Presentation Forms-B"](Wi))));if(It.imageName){const Gr=$e[It.imageName];if(!Gr)continue;gn=It.imageName,ve.iconsInText=ve.iconsInText||!0,mn=Gr.paddedRect;const Dr=Gr.displaySize;It.scale=It.scale*Li/wt,sn={width:Dr[0],height:Dr[1],left:Ar,top:-Mh,advance:an?Dr[1]:Dr[0]},Ni=lr+(Li-Dr[1]*It.scale),Hn=sn.advance;const Wn=an?Dr[0]*It.scale-Li*Bi:Dr[1]*It.scale-Li*Bi;Wn>0&&Wn>Pr&&(Pr=Wn)}else{const Gr=Ke[It.fontStack],Dr=Gr&&Gr[ir];if(Dr&&Dr.rect)mn=Dr.rect,sn=Dr.metrics;else{const Wn=Ve[It.fontStack],jo=Wn&&Wn[ir];if(!jo)continue;sn=jo.metrics}Ni=(Bi-It.scale)*Li}an?(ve.verticalizable=!0,cr.push({glyph:ir,imageName:gn,x:ri,y:oi+Ni,vertical:an,scale:It.scale,fontStack:It.fontStack,sectionIndex:ur,metrics:sn,rect:mn}),ri+=Hn*It.scale+rt):(cr.push({glyph:ir,imageName:gn,x:ri,y:oi+Ni,vertical:an,scale:It.scale,fontStack:It.fontStack,sectionIndex:ur,metrics:sn,rect:mn}),ri+=sn.advance*It.scale+rt)}cr.length!==0&&(Ri=Math.max(ri-rt,Ri),$f(cr,0,cr.length-1,xr,Pr)),ri=0;const zr=Pe*Bi+Pr;wr.lineOffset=Math.max(Pr,lr),oi+=zr,Vr=Math.max(zr,Vr),++ki}var Wi;const tr=oi-Ro,{horizontalAlign:vr,verticalAlign:br}=eu(Ge);(function(Fi,Bi,lr,wr,cr,Pr,zr,Oi,It){const ur=(Bi-lr)*cr;let ir=0;ir=Pr!==zr?-Oi*wr-Ro:(-wr*It+.5)*zr;for(const Ni of Fi)for(const sn of Ni.positionedGlyphs)sn.x+=ur,sn.y+=ir})(ve.positionedLines,xr,vr,br,Ri,Vr,Pe,tr,Re.length),ve.top+=-br*tr,ve.bottom=ve.top+tr,ve.left+=-vr*Ri,ve.right=ve.left+Ri}(ue,e,r,s,Y,p,f,_,I,v,A,$),!function(ve){for(const Ve of ve)if(Ve.positionedGlyphs.length!==0)return!1;return!0}(oe)&&ue}const Gl={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Of={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Ph(i,e,r,s,l,h){if(e.imageName){const p=s[e.imageName];return p?p.displaySize[0]*e.scale*Li/h+l:0}{const p=r[e.fontStack],f=p&&p[i];return f?f.metrics.advance*e.scale+l:0}}function zh(i,e,r,s){const l=Math.pow(i-e,2);return s?i<e?l/2:2*l:l+Math.abs(r)*r}function Nf(i,e,r){let s=0;return i===10&&(s-=1e4),r&&(s+=150),i!==40&&i!==65288||(s+=50),e!==41&&e!==65289||(s+=50),s}function Dh(i,e,r,s,l,h){let p=null,f=zh(e,r,l,h);for(const _ of s){const v=zh(e-_.x,r,l,h)+_.badness;v<=f&&(p=_,f=v)}return{index:i,x:e,priorBreak:p,badness:f}}function Lh(i){return i?Lh(i.priorBreak).concat(i.index):[]}function Qc(i,e,r,s,l,h,p){if(h!=="point")return[];if(!i)return[];const f=[],_=function(A,L,R,$,W,Y){let se=0;for(let Q=0;Q<A.length();Q++){const oe=A.getSection(Q);se+=Ph(A.getCharCode(Q),oe,$,W,L,Y)}return se/Math.max(1,Math.ceil(se/R))}(i,e,r,s,l,p),v=i.text.indexOf("​")>=0;let S=0;for(let A=0;A<i.length();A++){const L=i.getSection(A),R=i.getCharCode(A);if(Gl[R]||(S+=Ph(R,L,s,l,e,p)),A<i.length()-1){const $=!((I=R)<11904||!(je["Bopomofo Extended"](I)||je.Bopomofo(I)||je["CJK Compatibility Forms"](I)||je["CJK Compatibility Ideographs"](I)||je["CJK Compatibility"](I)||je["CJK Radicals Supplement"](I)||je["CJK Strokes"](I)||je["CJK Symbols and Punctuation"](I)||je["CJK Unified Ideographs Extension A"](I)||je["CJK Unified Ideographs"](I)||je["Enclosed CJK Letters and Months"](I)||je["Halfwidth and Fullwidth Forms"](I)||je.Hiragana(I)||je["Ideographic Description Characters"](I)||je["Kangxi Radicals"](I)||je["Katakana Phonetic Extensions"](I)||je.Katakana(I)||je["Vertical Forms"](I)||je["Yi Radicals"](I)||je["Yi Syllables"](I)));(Of[R]||$||L.imageName)&&f.push(Dh(A+1,S,_,f,Nf(R,i.getCharCode(A+1),$&&v),!1))}}var I;return Lh(Dh(i.length(),S,_,f,0,!0))}function eu(i){let e=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function $f(i,e,r,s,l){if(!s&&!l)return;const h=i[r],p=(i[r].x+h.metrics.advance*h.scale)*s;for(let f=e;f<=r;f++)i[f].x-=p,i[f].y+=l}function jf(i,e,r){const{horizontalAlign:s,verticalAlign:l}=eu(r),h=e[0]-i.displaySize[0]*s,p=e[1]-i.displaySize[1]*l;return{image:i,top:p,bottom:p+i.displaySize[1],left:h,right:h+i.displaySize[0]}}function Rh(i,e,r,s,l,h){const p=i.image;let f;if(p.content){const W=p.content,Y=p.pixelRatio||1;f=[W[0]/Y,W[1]/Y,p.displaySize[0]-W[2]/Y,p.displaySize[1]-W[3]/Y]}const _=e.left*h,v=e.right*h;let S,I,A,L;r==="width"||r==="both"?(L=l[0]+_-s[3],I=l[0]+v+s[1]):(L=l[0]+(_+v-p.displaySize[0])/2,I=L+p.displaySize[0]);const R=e.top*h,$=e.bottom*h;return r==="height"||r==="both"?(S=l[1]+R-s[0],A=l[1]+$+s[2]):(S=l[1]+(R+$-p.displaySize[1])/2,A=S+p.displaySize[1]),{image:p,top:S,right:I,bottom:A,left:L,collisionPadding:f}}const Bo=255,An=128,ps=Bo*An;function Fh(i,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new ti(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:s,interpolationType:l}=r;let h=0;for(;h<s.length&&s[h]<=i;)h++;h=Math.max(0,h-1);let p=h;for(;p<s.length&&s[p]<i+1;)p++;p=Math.min(s.length-1,p);const f=s[h],_=s[p];return r.kind==="composite"?{kind:"composite",minZoom:f,maxZoom:_,interpolationType:l}:{kind:"camera",minZoom:f,maxZoom:_,minSize:r.evaluate(new ti(f)),maxSize:r.evaluate(new ti(_)),interpolationType:l}}}function tu(i,e,r){let s="never";const l=i.get(e);return l?s=l:i.get(r)&&(s="always"),s}const Vf=hs.VectorTileFeature.types,Uf=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Hl(i,e,r,s,l,h,p,f,_,v,S,I,A){const L=f?Math.min(ps,Math.round(f[0])):0,R=f?Math.min(ps,Math.round(f[1])):0;i.emplaceBack(e,r,Math.round(32*s),Math.round(32*l),h,p,(L<<1)+(_?1:0),R,16*v,16*S,256*I,256*A)}function iu(i,e,r){i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r)}function qf(i){for(const e of i.sections)if(Mc(e.text))return!0;return!1}class ru{constructor(e){this.layoutVertexArray=new St,this.indexArray=new Gi,this.programConfigurations=e,this.segments=new ii,this.dynamicLayoutVertexArray=new vt,this.opacityVertexArray=new Tt,this.hasVisibleVertices=!1,this.placedSymbolArray=new te}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,s,l){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,bf.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,wf.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Uf,!0),this.opacityVertexBuffer.itemSize=1),(s||l)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ze("SymbolBuffers",ru);class nu{constructor(e,r,s){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new s,this.segments=new ii,this.collisionVertexArray=new ei}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Sf.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ze("CollisionBuffers",nu);class Ma{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Rc([]),this.placementViewportMatrix=Rc([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Fh(this.zoom,r["text-size"]),this.iconSizeData=Fh(this.zoom,r["icon-size"]);const s=this.layers[0].layout,l=s.get("symbol-sort-key"),h=s.get("symbol-z-order");this.canOverlap=tu(s,"text-overlap","text-allow-overlap")!=="never"||tu(s,"icon-overlap","icon-allow-overlap")!=="never"||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=h!=="viewport-y"&&!l.isConstant(),this.sortFeaturesByY=(h==="viewport-y"||h==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,s.get("symbol-placement")==="point"&&(this.writingModes=s.get("text-writing-mode").map(p=>o.ai[p])),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID}createArrays(){this.text=new ru(new fn(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new ru(new fn(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new re,this.lineVertexArray=new he,this.symbolInstances=new K,this.textAnchorOffsets=new xe}calculateGlyphDependencies(e,r,s,l,h){for(let p=0;p<e.length;p++)if(r[e.charCodeAt(p)]=!0,(s||l)&&h){const f=Lo[e.charAt(p)];f&&(r[f.charCodeAt(0)]=!0)}}populate(e,r,s){const l=this.layers[0],h=l.layout,p=h.get("text-font"),f=h.get("text-field"),_=h.get("icon-image"),v=(f.value.kind!=="constant"||f.value.value instanceof Ji&&!f.value.value.isEmpty()||f.value.value.toString().length>0)&&(p.value.kind!=="constant"||p.value.value.length>0),S=_.value.kind!=="constant"||!!_.value.value||Object.keys(_.parameters).length>0,I=h.get("symbol-sort-key");if(this.features=[],!v&&!S)return;const A=r.iconDependencies,L=r.glyphDependencies,R=r.availableImages,$=new ti(this.zoom);for(const{feature:W,id:Y,index:se,sourceLayerIndex:Q}of e){const oe=l._featureFilter.needGeometry,ue=Os(W,oe);if(!l._featureFilter.filter($,ue,s))continue;let ve,Ve;if(oe||(ue.geometry=Bs(W)),v){const $e=l.getValueAndResolveTokens("text-field",ue,s,R),Re=Ji.factory($e);qf(Re)&&(this.hasRTLText=!0),(!this.hasRTLText||fo()==="unavailable"||this.hasRTLText&&Mr.isParsed())&&(ve=Tf(Re,l,ue))}if(S){const $e=l.getValueAndResolveTokens("icon-image",ue,s,R);Ve=$e instanceof Zi?$e:Zi.fromString($e)}if(!ve&&!Ve)continue;const Ke=this.sortFeaturesByKey?I.evaluate(ue,{},s):void 0;if(this.features.push({id:Y,text:ve,icon:Ve,index:se,sourceLayerIndex:Q,geometry:ue.geometry,properties:W.properties,type:Vf[W.type],sortKey:Ke}),Ve&&(A[Ve.name]=!0),ve){const $e=p.evaluate(ue,{},s).join(","),Re=h.get("text-rotation-alignment")!=="viewport"&&h.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(o.ai.vertical)>=0;for(const Pe of ve.sections)if(Pe.image)A[Pe.image.name]=!0;else{const Ge=so(ve.toString()),ze=Pe.fontStack||$e,Ee=L[ze]=L[ze]||{};this.calculateGlyphDependencies(Pe.text,Ee,Re,this.allowVerticalPlacement,Ge)}}}h.get("symbol-placement")==="line"&&(this.features=function(W){const Y={},se={},Q=[];let oe=0;function ue($e){Q.push(W[$e]),oe++}function ve($e,Re,Pe){const Ge=se[$e];return delete se[$e],se[Re]=Ge,Q[Ge].geometry[0].pop(),Q[Ge].geometry[0]=Q[Ge].geometry[0].concat(Pe[0]),Ge}function Ve($e,Re,Pe){const Ge=Y[Re];return delete Y[Re],Y[$e]=Ge,Q[Ge].geometry[0].shift(),Q[Ge].geometry[0]=Pe[0].concat(Q[Ge].geometry[0]),Ge}function Ke($e,Re,Pe){const Ge=Pe?Re[0][Re[0].length-1]:Re[0][0];return`${$e}:${Ge.x}:${Ge.y}`}for(let $e=0;$e<W.length;$e++){const Re=W[$e],Pe=Re.geometry,Ge=Re.text?Re.text.toString():null;if(!Ge){ue($e);continue}const ze=Ke(Ge,Pe),Ee=Ke(Ge,Pe,!0);if(ze in se&&Ee in Y&&se[ze]!==Y[Ee]){const rt=Ve(ze,Ee,Pe),Je=ve(ze,Ee,Q[rt].geometry);delete Y[ze],delete se[Ee],se[Ke(Ge,Q[Je].geometry,!0)]=Je,Q[rt].geometry=null}else ze in se?ve(ze,Ee,Pe):Ee in Y?Ve(ze,Ee,Pe):(ue($e),Y[ze]=oe-1,se[Ee]=oe-1)}return Q.filter($e=>$e.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((W,Y)=>W.sortKey-Y.sortKey)}update(e,r,s){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,s),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,s))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const s=this.lineVertexArray.length;if(e.segment!==void 0){let l=e.dist(r[e.segment+1]),h=e.dist(r[e.segment]);const p={};for(let f=e.segment+1;f<r.length;f++)p[f]={x:r[f].x,y:r[f].y,tileUnitDistanceFromAnchor:l},f<r.length-1&&(l+=r[f+1].dist(r[f]));for(let f=e.segment||0;f>=0;f--)p[f]={x:r[f].x,y:r[f].y,tileUnitDistanceFromAnchor:h},f>0&&(h+=r[f-1].dist(r[f]));for(let f=0;f<r.length;f++){const _=p[f];this.lineVertexArray.emplaceBack(_.x,_.y,_.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,r,s,l,h,p,f,_,v,S,I,A){const L=e.indexArray,R=e.layoutVertexArray,$=e.segments.prepareSegment(4*r.length,R,L,this.canOverlap?p.sortKey:void 0),W=this.glyphOffsetArray.length,Y=$.vertexLength,se=this.allowVerticalPlacement&&f===o.ai.vertical?Math.PI/2:0,Q=p.text&&p.text.sections;for(let oe=0;oe<r.length;oe++){const{tl:ue,tr:ve,bl:Ve,br:Ke,tex:$e,pixelOffsetTL:Re,pixelOffsetBR:Pe,minFontScaleX:Ge,minFontScaleY:ze,glyphOffset:Ee,isSDF:rt,sectionIndex:Je}=r[oe],wt=$.vertexLength,ri=Ee[1];Hl(R,_.x,_.y,ue.x,ri+ue.y,$e.x,$e.y,s,rt,Re.x,Re.y,Ge,ze),Hl(R,_.x,_.y,ve.x,ri+ve.y,$e.x+$e.w,$e.y,s,rt,Pe.x,Re.y,Ge,ze),Hl(R,_.x,_.y,Ve.x,ri+Ve.y,$e.x,$e.y+$e.h,s,rt,Re.x,Pe.y,Ge,ze),Hl(R,_.x,_.y,Ke.x,ri+Ke.y,$e.x+$e.w,$e.y+$e.h,s,rt,Pe.x,Pe.y,Ge,ze),iu(e.dynamicLayoutVertexArray,_,se),L.emplaceBack(wt,wt+1,wt+2),L.emplaceBack(wt+1,wt+2,wt+3),$.vertexLength+=4,$.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ee[0]),oe!==r.length-1&&Je===r[oe+1].sectionIndex||e.programConfigurations.populatePaintArrays(R.length,p,p.index,{},A,Q&&Q[Je])}e.placedSymbolArray.emplaceBack(_.x,_.y,W,this.glyphOffsetArray.length-W,Y,v,S,_.segment,s?s[0]:0,s?s[1]:0,l[0],l[1],f,0,!1,0,I)}_addCollisionDebugVertex(e,r,s,l,h,p){return r.emplaceBack(0,0),e.emplaceBack(s.x,s.y,l,h,Math.round(p.x),Math.round(p.y))}addCollisionDebugVertices(e,r,s,l,h,p,f){const _=h.segments.prepareSegment(4,h.layoutVertexArray,h.indexArray),v=_.vertexLength,S=h.layoutVertexArray,I=h.collisionVertexArray,A=f.anchorX,L=f.anchorY;this._addCollisionDebugVertex(S,I,p,A,L,new de(e,r)),this._addCollisionDebugVertex(S,I,p,A,L,new de(s,r)),this._addCollisionDebugVertex(S,I,p,A,L,new de(s,l)),this._addCollisionDebugVertex(S,I,p,A,L,new de(e,l)),_.vertexLength+=4;const R=h.indexArray;R.emplaceBack(v,v+1),R.emplaceBack(v+1,v+2),R.emplaceBack(v+2,v+3),R.emplaceBack(v+3,v),_.primitiveLength+=4}addDebugCollisionBoxes(e,r,s,l){for(let h=e;h<r;h++){const p=this.collisionBoxArray.get(h);this.addCollisionDebugVertices(p.x1,p.y1,p.x2,p.y2,l?this.textCollisionBox:this.iconCollisionBox,p.anchorPoint,s)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new nu(yi,vh.members,zi),this.iconCollisionBox=new nu(yi,vh.members,zi);for(let e=0;e<this.symbolInstances.length;e++){const r=this.symbolInstances.get(e);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(e,r,s,l,h,p,f,_,v){const S={};for(let I=r;I<s;I++){const A=e.get(I);S.textBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,anchorPointX:A.anchorPointX,anchorPointY:A.anchorPointY},S.textFeatureIndex=A.featureIndex;break}for(let I=l;I<h;I++){const A=e.get(I);S.verticalTextBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,anchorPointX:A.anchorPointX,anchorPointY:A.anchorPointY},S.verticalTextFeatureIndex=A.featureIndex;break}for(let I=p;I<f;I++){const A=e.get(I);S.iconBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,anchorPointX:A.anchorPointX,anchorPointY:A.anchorPointY},S.iconFeatureIndex=A.featureIndex;break}for(let I=_;I<v;I++){const A=e.get(I);S.verticalIconBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,anchorPointX:A.anchorPointX,anchorPointY:A.anchorPointY},S.verticalIconFeatureIndex=A.featureIndex;break}return S}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const s=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const s=e.placedSymbolArray.get(r),l=s.vertexStartIndex+4*s.numGlyphs;for(let h=s.vertexStartIndex;h<l;h+=4)e.indexArray.emplaceBack(h,h+1,h+2),e.indexArray.emplaceBack(h+1,h+2,h+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),s=Math.cos(e),l=[],h=[],p=[];for(let f=0;f<this.symbolInstances.length;++f){p.push(f);const _=this.symbolInstances.get(f);l.push(0|Math.round(r*_.anchorX+s*_.anchorY)),h.push(_.featureIndex)}return p.sort((f,_)=>l[f]-l[_]||h[_]-h[f]),p}addToSortKeyRanges(e,r){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===r?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const s=this.symbolInstances.get(r);this.featureSortOrder.push(s.featureIndex),[s.rightJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.leftJustifiedTextSymbolIndex].forEach((l,h,p)=>{l>=0&&p.indexOf(l)===h&&this.addIndicesForPlacedSymbol(this.text,l)}),s.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,s.verticalPlacedTextSymbolIndex),s.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.placedIconSymbolIndex),s.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Bh,Oh;Ze("SymbolBucket",Ma,{omit:["layers","collisionBoxArray","features","compareText"]}),Ma.MAX_GLYPHS=65535,Ma.addDynamicAttributes=iu;var su={get paint(){return Oh=Oh||new wi({"icon-opacity":new ct(fe.paint_symbol["icon-opacity"]),"icon-color":new ct(fe.paint_symbol["icon-color"]),"icon-halo-color":new ct(fe.paint_symbol["icon-halo-color"]),"icon-halo-width":new ct(fe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ct(fe.paint_symbol["icon-halo-blur"]),"icon-translate":new et(fe.paint_symbol["icon-translate"]),"icon-translate-anchor":new et(fe.paint_symbol["icon-translate-anchor"]),"text-opacity":new ct(fe.paint_symbol["text-opacity"]),"text-color":new ct(fe.paint_symbol["text-color"],{runtimeType:_i,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new ct(fe.paint_symbol["text-halo-color"]),"text-halo-width":new ct(fe.paint_symbol["text-halo-width"]),"text-halo-blur":new ct(fe.paint_symbol["text-halo-blur"]),"text-translate":new et(fe.paint_symbol["text-translate"]),"text-translate-anchor":new et(fe.paint_symbol["text-translate-anchor"])})},get layout(){return Bh=Bh||new wi({"symbol-placement":new et(fe.layout_symbol["symbol-placement"]),"symbol-spacing":new et(fe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new et(fe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ct(fe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new et(fe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new et(fe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new et(fe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new et(fe.layout_symbol["icon-ignore-placement"]),"icon-optional":new et(fe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new et(fe.layout_symbol["icon-rotation-alignment"]),"icon-size":new ct(fe.layout_symbol["icon-size"]),"icon-text-fit":new et(fe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new et(fe.layout_symbol["icon-text-fit-padding"]),"icon-image":new ct(fe.layout_symbol["icon-image"]),"icon-rotate":new ct(fe.layout_symbol["icon-rotate"]),"icon-padding":new ct(fe.layout_symbol["icon-padding"]),"icon-keep-upright":new et(fe.layout_symbol["icon-keep-upright"]),"icon-offset":new ct(fe.layout_symbol["icon-offset"]),"icon-anchor":new ct(fe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new et(fe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new et(fe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new et(fe.layout_symbol["text-rotation-alignment"]),"text-field":new ct(fe.layout_symbol["text-field"]),"text-font":new ct(fe.layout_symbol["text-font"]),"text-size":new ct(fe.layout_symbol["text-size"]),"text-max-width":new ct(fe.layout_symbol["text-max-width"]),"text-line-height":new et(fe.layout_symbol["text-line-height"]),"text-letter-spacing":new ct(fe.layout_symbol["text-letter-spacing"]),"text-justify":new ct(fe.layout_symbol["text-justify"]),"text-radial-offset":new ct(fe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new et(fe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new ct(fe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new ct(fe.layout_symbol["text-anchor"]),"text-max-angle":new et(fe.layout_symbol["text-max-angle"]),"text-writing-mode":new et(fe.layout_symbol["text-writing-mode"]),"text-rotate":new ct(fe.layout_symbol["text-rotate"]),"text-padding":new et(fe.layout_symbol["text-padding"]),"text-keep-upright":new et(fe.layout_symbol["text-keep-upright"]),"text-transform":new ct(fe.layout_symbol["text-transform"]),"text-offset":new ct(fe.layout_symbol["text-offset"]),"text-allow-overlap":new et(fe.layout_symbol["text-allow-overlap"]),"text-overlap":new et(fe.layout_symbol["text-overlap"]),"text-ignore-placement":new et(fe.layout_symbol["text-ignore-placement"]),"text-optional":new et(fe.layout_symbol["text-optional"])})}};class Nh{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:bt,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ze("FormatSectionOverride",Nh,{omit:["defaultValue"]});class Wl extends $r{constructor(e){super(e,su)}recalculate(e,r){if(super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const s=this.layout.get("text-writing-mode");if(s){const l=[];for(const h of s)l.indexOf(h)<0&&l.push(h);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,r,s,l){const h=this.layout.get(e).evaluate(r,{},s,l),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||la(p.value)||!h?h:function(f,_){return _.replace(/{([^{}]+)}/g,(v,S)=>f&&S in f?String(f[S]):"")}(r.properties,h)}createBucket(e){return new Ma(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of su.paint.overridableProperties){if(!Wl.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),s=new Nh(r),l=new Qa(s,r.property.specification);let h=null;h=r.value.kind==="constant"||r.value.kind==="source"?new eo("source",l):new ua("composite",l,r.value.zoomStops),this.paint._values[e]=new ar(r.property,h,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,s){return!(!this.layout||r.isDataDriven()||s.isDataDriven())&&Wl.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const s=e.get("text-field"),l=su.paint.properties[r];let h=!1;const p=f=>{for(const _ of f)if(l.overrides&&l.overrides.hasOverride(_))return void(h=!0)};if(s.value.kind==="constant"&&s.value.value instanceof Ji)p(s.value.value.sections);else if(s.value.kind==="source"){const f=v=>{h||(v instanceof Ln&&li(v.value)===q?p(v.value.sections):v instanceof oa?p(v.sections):v.eachChild(f))},_=s.value;_._styleExpression&&f(_._styleExpression.expression)}return h}}let $h;var Zf={get paint(){return $h=$h||new wi({"background-color":new et(fe.paint_background["background-color"]),"background-pattern":new go(fe.paint_background["background-pattern"]),"background-opacity":new et(fe.paint_background["background-opacity"])})}};class Gf extends $r{constructor(e){super(e,Zf)}}let jh;var Hf={get paint(){return jh=jh||new wi({"raster-opacity":new et(fe.paint_raster["raster-opacity"]),"raster-hue-rotate":new et(fe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new et(fe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new et(fe.paint_raster["raster-brightness-max"]),"raster-saturation":new et(fe.paint_raster["raster-saturation"]),"raster-contrast":new et(fe.paint_raster["raster-contrast"]),"raster-resampling":new et(fe.paint_raster["raster-resampling"]),"raster-fade-duration":new et(fe.paint_raster["raster-fade-duration"])})}};class Wf extends $r{constructor(e){super(e,Hf)}}class Xf extends $r{constructor(e){super(e,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Kf{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const au=63710088e-1;class fs{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new fs(tt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,s=this.lat*r,l=e.lat*r,h=Math.sin(s)*Math.sin(l)+Math.cos(s)*Math.cos(l)*Math.cos((e.lng-this.lng)*r);return au*Math.acos(Math.min(h,1))}static convert(e){if(e instanceof fs)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new fs(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new fs(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Vh=2*Math.PI*au;function Uh(i){return Vh*Math.cos(i*Math.PI/180)}function qh(i){return(180+i)/360}function Zh(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Gh(i,e){return i/Uh(e)}function Hh(i){return 360*i-180}function ou(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class Xl{constructor(e,r,s=0){this.x=+e,this.y=+r,this.z=+s}static fromLngLat(e,r=0){const s=fs.convert(e);return new Xl(qh(s.lng),Zh(s.lat),Gh(r,s.lat))}toLngLat(){return new fs(Hh(this.x),ou(this.y))}toAltitude(){return this.z*Uh(ou(this.y))}meterInMercatorCoordinateUnits(){return 1/Vh*(e=ou(this.y),1/Math.cos(e*Math.PI/180));var e}}function Wh(i,e,r){var s=2*Math.PI*6378137/256/Math.pow(2,r);return[i*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}class lu{constructor(e,r,s){if(e<0||e>25||s<0||s>=Math.pow(2,e)||r<0||r>=Math.pow(2,e))throw new Error(`x=${r}, y=${s}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=r,this.y=s,this.key=Oo(0,e,e,r,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r,s){const l=(p=this.y,f=this.z,_=Wh(256*(h=this.x),256*(p=Math.pow(2,f)-p-1),f),v=Wh(256*(h+1),256*(p+1),f),_[0]+","+_[1]+","+v[0]+","+v[1]);var h,p,f,_,v;const S=function(I,A,L){let R,$="";for(let W=I;W>0;W--)R=1<<W-1,$+=(A&R?1:0)+(L&R?2:0);return $}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,S).replace(/{bbox-epsg-3857}/g,l)}isChildOf(e){const r=this.z-e.z;return r>0&&e.x===this.x>>r&&e.y===this.y>>r}getTilePoint(e){const r=Math.pow(2,this.z);return new de((e.x*r-this.x)*Mi,(e.y*r-this.y)*Mi)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Xh{constructor(e,r){this.wrap=e,this.canonical=r,this.key=Oo(e,r.z,r.z,r.x,r.y)}}class Zr{constructor(e,r,s,l,h){if(e<s)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${s}`);this.overscaledZ=e,this.wrap=r,this.canonical=new lu(s,+l,+h),this.key=Oo(r,e,s,l,h)}clone(){return new Zr(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-e;return e>this.canonical.z?new Zr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Zr(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-e;return e>this.canonical.z?Oo(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y):Oo(this.wrap*+r,e,e,this.canonical.x>>s,this.canonical.y>>s)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new Zr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,s=2*this.canonical.x,l=2*this.canonical.y;return[new Zr(r,this.wrap,r,s,l),new Zr(r,this.wrap,r,s+1,l),new Zr(r,this.wrap,r,s,l+1),new Zr(r,this.wrap,r,s+1,l+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Zr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Zr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Xh(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new Xl(e.x-this.wrap,e.y))}}function Oo(i,e,r,s,l){(i*=2)<0&&(i=-1*i-1);const h=1<<r;return(h*h*i+h*l+s).toString(36)+r.toString(36)+e.toString(36)}Ze("CanonicalTileID",lu),Ze("OverscaledTileID",Zr,{omit:["posMatrix"]});class Kh{constructor(e,r,s,l=1,h=1,p=1,f=0){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(s&&!["mapbox","terrarium","custom"].includes(s))return void xt(`"${s}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const _=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),s){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=l,this.greenFactor=h,this.blueFactor=p,this.baseShift=f;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let v=0;v<_;v++)this.data[this._idx(-1,v)]=this.data[this._idx(0,v)],this.data[this._idx(_,v)]=this.data[this._idx(_-1,v)],this.data[this._idx(v,-1)]=this.data[this._idx(v,0)],this.data[this._idx(v,_)]=this.data[this._idx(v,_-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(_,-1)]=this.data[this._idx(_-1,0)],this.data[this._idx(-1,_)]=this.data[this._idx(0,_-1)],this.data[this._idx(_,_)]=this.data[this._idx(_-1,_-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let v=0;v<_;v++)for(let S=0;S<_;S++){const I=this.get(v,S);I>this.max&&(this.max=I),I<this.min&&(this.min=I)}}get(e,r){const s=new Uint8Array(this.data.buffer),l=4*this._idx(e,r);return this.unpack(s[l],s[l+1],s[l+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}unpack(e,r,s){return e*this.redFactor+r*this.greenFactor+s*this.blueFactor-this.baseShift}getPixels(){return new qr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,r,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let l=r*this.dim,h=r*this.dim+this.dim,p=s*this.dim,f=s*this.dim+this.dim;switch(r){case-1:l=h-1;break;case 1:h=l+1}switch(s){case-1:p=f-1;break;case 1:f=p+1}const _=-r*this.dim,v=-s*this.dim;for(let S=p;S<f;S++)for(let I=l;I<h;I++)this.data[this._idx(I,S)]=e.data[this._idx(I+_,S+v)]}}Ze("DEMData",Kh);class Yh{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const s=e[r];this._stringToNumber[s]=r,this._numberToString[r]=s}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class Jh{constructor(e,r,s,l,h){this.type="Feature",this._vectorTileFeature=e,e._z=r,e._x=s,e._y=l,this.properties=e.properties,this.id=h}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(e[r]=this[r]);return e}}class Qh{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new as(Mi,16,0),this.grid3D=new as(Mi,16,0),this.featureIndexArray=new Se,this.promoteId=r}insert(e,r,s,l,h,p){const f=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,l,h);const _=p?this.grid3D:this.grid;for(let v=0;v<r.length;v++){const S=r[v],I=[1/0,1/0,-1/0,-1/0];for(let A=0;A<S.length;A++){const L=S[A];I[0]=Math.min(I[0],L.x),I[1]=Math.min(I[1],L.y),I[2]=Math.max(I[2],L.x),I[3]=Math.max(I[3],L.y)}I[0]<Mi&&I[1]<Mi&&I[2]>=0&&I[3]>=0&&_.insert(f,I[0],I[1],I[2],I[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new hs.VectorTile(new Kc(this.rawTileData)).layers,this.sourceLayerCoder=new Yh(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,r,s,l){this.loadVTLayers();const h=e.params||{},p=Mi/e.tileSize/e.scale,f=io(h.filter),_=e.queryGeometry,v=e.queryPadding*p,S=td(_),I=this.grid.query(S.minX-v,S.minY-v,S.maxX+v,S.maxY+v),A=td(e.cameraQueryGeometry),L=this.grid3D.query(A.minX-v,A.minY-v,A.maxX+v,A.maxY+v,(W,Y,se,Q)=>function(oe,ue,ve,Ve,Ke){for(const Re of oe)if(ue<=Re.x&&ve<=Re.y&&Ve>=Re.x&&Ke>=Re.y)return!0;const $e=[new de(ue,ve),new de(ue,Ke),new de(Ve,Ke),new de(Ve,ve)];if(oe.length>2){for(const Re of $e)if(ba(oe,Re))return!0}for(let Re=0;Re<oe.length-1;Re++)if(Ep(oe[Re],oe[Re+1],$e))return!0;return!1}(e.cameraQueryGeometry,W-v,Y-v,se+v,Q+v));for(const W of L)I.push(W);I.sort(Yf);const R={};let $;for(let W=0;W<I.length;W++){const Y=I[W];if(Y===$)continue;$=Y;const se=this.featureIndexArray.get(Y);let Q=null;this.loadMatchingFeature(R,se.bucketIndex,se.sourceLayerIndex,se.featureIndex,f,h.layers,h.availableImages,r,s,l,(oe,ue,ve)=>(Q||(Q=Bs(oe)),ue.queryIntersectsFeature(_,oe,ve,Q,this.z,e.transform,p,e.pixelPosMatrix)))}return R}loadMatchingFeature(e,r,s,l,h,p,f,_,v,S,I){const A=this.bucketLayerIDs[r];if(p&&!function(W,Y){for(let se=0;se<W.length;se++)if(Y.indexOf(W[se])>=0)return!0;return!1}(p,A))return;const L=this.sourceLayerCoder.decode(s),R=this.vtLayers[L].feature(l);if(h.needGeometry){const W=Os(R,!0);if(!h.filter(new ti(this.tileID.overscaledZ),W,this.tileID.canonical))return}else if(!h.filter(new ti(this.tileID.overscaledZ),R))return;const $=this.getId(R,L);for(let W=0;W<A.length;W++){const Y=A[W];if(p&&p.indexOf(Y)<0)continue;const se=_[Y];if(!se)continue;let Q={};$&&S&&(Q=S.getState(se.sourceLayer||"_geojsonTileLayer",$));const oe=He({},v[Y]);oe.paint=ed(oe.paint,se.paint,R,Q,f),oe.layout=ed(oe.layout,se.layout,R,Q,f);const ue=!I||I(R,se,Q);if(!ue)continue;const ve=new Jh(R,this.z,this.x,this.y,$);ve.layer=oe;let Ve=e[Y];Ve===void 0&&(Ve=e[Y]=[]),Ve.push({featureIndex:l,feature:ve,intersectionZ:ue})}}lookupSymbolFeatures(e,r,s,l,h,p,f,_){const v={};this.loadVTLayers();const S=io(h);for(const I of e)this.loadMatchingFeature(v,s,l,I,S,p,f,_,r);return v}hasLayer(e){for(const r of this.bucketLayerIDs)for(const s of r)if(e===s)return!0;return!1}getId(e,r){let s=e.id;return this.promoteId&&(s=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof s=="boolean"&&(s=Number(s))),s}}function ed(i,e,r,s,l){return Fe(i,(h,p)=>{const f=e instanceof xa?e.get(p):null;return f&&f.evaluate?f.evaluate(r,s,l):f})}function td(i){let e=1/0,r=1/0,s=-1/0,l=-1/0;for(const h of i)e=Math.min(e,h.x),r=Math.min(r,h.y),s=Math.max(s,h.x),l=Math.max(l,h.y);return{minX:e,minY:r,maxX:s,maxY:l}}function Yf(i,e){return e-i}function id(i,e,r,s,l){const h=[];for(let p=0;p<i.length;p++){const f=i[p];let _;for(let v=0;v<f.length-1;v++){let S=f[v],I=f[v+1];S.x<e&&I.x<e||(S.x<e?S=new de(e,S.y+(e-S.x)/(I.x-S.x)*(I.y-S.y))._round():I.x<e&&(I=new de(e,S.y+(e-S.x)/(I.x-S.x)*(I.y-S.y))._round()),S.y<r&&I.y<r||(S.y<r?S=new de(S.x+(r-S.y)/(I.y-S.y)*(I.x-S.x),r)._round():I.y<r&&(I=new de(S.x+(r-S.y)/(I.y-S.y)*(I.x-S.x),r)._round()),S.x>=s&&I.x>=s||(S.x>=s?S=new de(s,S.y+(s-S.x)/(I.x-S.x)*(I.y-S.y))._round():I.x>=s&&(I=new de(s,S.y+(s-S.x)/(I.x-S.x)*(I.y-S.y))._round()),S.y>=l&&I.y>=l||(S.y>=l?S=new de(S.x+(l-S.y)/(I.y-S.y)*(I.x-S.x),l)._round():I.y>=l&&(I=new de(S.x+(l-S.y)/(I.y-S.y)*(I.x-S.x),l)._round()),_&&S.equals(_[_.length-1])||(_=[S],h.push(_)),_.push(I)))))}}return h}Ze("FeatureIndex",Qh,{omit:["rawTileData","sourceLayerCoder"]});class ms extends de{constructor(e,r,s,l){super(e,r),this.angle=s,l!==void 0&&(this.segment=l)}clone(){return new ms(this.x,this.y,this.angle,this.segment)}}function rd(i,e,r,s,l){if(e.segment===void 0||r===0)return!0;let h=e,p=e.segment+1,f=0;for(;f>-r/2;){if(p--,p<0)return!1;f-=i[p].dist(h),h=i[p]}f+=i[p].dist(i[p+1]),p++;const _=[];let v=0;for(;f<r/2;){const S=i[p],I=i[p+1];if(!I)return!1;let A=i[p-1].angleTo(S)-S.angleTo(I);for(A=Math.abs((A+3*Math.PI)%(2*Math.PI)-Math.PI),_.push({distance:f,angleDelta:A}),v+=A;f-_[0].distance>s;)v-=_.shift().angleDelta;if(v>l)return!1;p++,f+=S.dist(I)}return!0}function nd(i){let e=0;for(let r=0;r<i.length-1;r++)e+=i[r].dist(i[r+1]);return e}function sd(i,e,r){return i?.6*e*r:0}function ad(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function Jf(i,e,r,s,l,h){const p=sd(r,l,h),f=ad(r,s)*h;let _=0;const v=nd(i)/2;for(let S=0;S<i.length-1;S++){const I=i[S],A=i[S+1],L=I.dist(A);if(_+L>v){const R=(v-_)/L,$=Tr.number(I.x,A.x,R),W=Tr.number(I.y,A.y,R),Y=new ms($,W,A.angleTo(I),S);return Y._round(),!p||rd(i,Y,f,p,e)?Y:void 0}_+=L}}function Qf(i,e,r,s,l,h,p,f,_){const v=sd(s,h,p),S=ad(s,l),I=S*p,A=i[0].x===0||i[0].x===_||i[0].y===0||i[0].y===_;return e-I<e/4&&(e=I+e/4),od(i,A?e/2*f%e:(S/2+2*h)*p*f%e,e,v,r,I,A,!1,_)}function od(i,e,r,s,l,h,p,f,_){const v=h/2,S=nd(i);let I=0,A=e-r,L=[];for(let R=0;R<i.length-1;R++){const $=i[R],W=i[R+1],Y=$.dist(W),se=W.angleTo($);for(;A+r<I+Y;){A+=r;const Q=(A-I)/Y,oe=Tr.number($.x,W.x,Q),ue=Tr.number($.y,W.y,Q);if(oe>=0&&oe<_&&ue>=0&&ue<_&&A-v>=0&&A+v<=S){const ve=new ms(oe,ue,se,R);ve._round(),s&&!rd(i,ve,h,s,l)||L.push(ve)}}I+=Y}return f||L.length||p||(L=od(i,I/2,r,s,l,h,p,!0,_)),L}Ze("Anchor",ms);const ka=Ar;function ld(i,e,r,s){const l=[],h=i.image,p=h.pixelRatio,f=h.paddedRect.w-2*ka,_=h.paddedRect.h-2*ka,v=i.right-i.left,S=i.bottom-i.top,I=h.stretchX||[[0,f]],A=h.stretchY||[[0,_]],L=(Pe,Ge)=>Pe+Ge[1]-Ge[0],R=I.reduce(L,0),$=A.reduce(L,0),W=f-R,Y=_-$;let se=0,Q=R,oe=0,ue=$,ve=0,Ve=W,Ke=0,$e=Y;if(h.content&&s){const Pe=h.content;se=Kl(I,0,Pe[0]),oe=Kl(A,0,Pe[1]),Q=Kl(I,Pe[0],Pe[2]),ue=Kl(A,Pe[1],Pe[3]),ve=Pe[0]-se,Ke=Pe[1]-oe,Ve=Pe[2]-Pe[0]-Q,$e=Pe[3]-Pe[1]-ue}const Re=(Pe,Ge,ze,Ee)=>{const rt=Yl(Pe.stretch-se,Q,v,i.left),Je=Jl(Pe.fixed-ve,Ve,Pe.stretch,R),wt=Yl(Ge.stretch-oe,ue,S,i.top),ri=Jl(Ge.fixed-Ke,$e,Ge.stretch,$),oi=Yl(ze.stretch-se,Q,v,i.left),Ri=Jl(ze.fixed-ve,Ve,ze.stretch,R),Vr=Yl(Ee.stretch-oe,ue,S,i.top),xr=Jl(Ee.fixed-Ke,$e,Ee.stretch,$),ki=new de(rt,wt),Wi=new de(oi,wt),tr=new de(oi,Vr),vr=new de(rt,Vr),br=new de(Je/p,ri/p),Fi=new de(Ri/p,xr/p),Bi=e*Math.PI/180;if(Bi){const cr=Math.sin(Bi),Pr=Math.cos(Bi),zr=[Pr,-cr,cr,Pr];ki._matMult(zr),Wi._matMult(zr),vr._matMult(zr),tr._matMult(zr)}const lr=Pe.stretch+Pe.fixed,wr=Ge.stretch+Ge.fixed;return{tl:ki,tr:Wi,bl:vr,br:tr,tex:{x:h.paddedRect.x+ka+lr,y:h.paddedRect.y+ka+wr,w:ze.stretch+ze.fixed-lr,h:Ee.stretch+Ee.fixed-wr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:br,pixelOffsetBR:Fi,minFontScaleX:Ve/p/v,minFontScaleY:$e/p/S,isSDF:r}};if(s&&(h.stretchX||h.stretchY)){const Pe=cd(I,W,R),Ge=cd(A,Y,$);for(let ze=0;ze<Pe.length-1;ze++){const Ee=Pe[ze],rt=Pe[ze+1];for(let Je=0;Je<Ge.length-1;Je++)l.push(Re(Ee,Ge[Je],rt,Ge[Je+1]))}}else l.push(Re({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:f+1},{fixed:0,stretch:_+1}));return l}function Kl(i,e,r){let s=0;for(const l of i)s+=Math.max(e,Math.min(r,l[1]))-Math.max(e,Math.min(r,l[0]));return s}function cd(i,e,r){const s=[{fixed:-ka,stretch:0}];for(const[l,h]of i){const p=s[s.length-1];s.push({fixed:l-p.stretch,stretch:p.stretch}),s.push({fixed:l-p.stretch,stretch:p.stretch+(h-l)})}return s.push({fixed:e+ka,stretch:r}),s}function Yl(i,e,r,s){return i/e*r+s}function Jl(i,e,r,s){return i-e*r/s}class Ql{constructor(e,r,s,l,h,p,f,_,v,S){if(this.boxStartIndex=e.length,v){let I=p.top,A=p.bottom;const L=p.collisionPadding;L&&(I-=L[1],A+=L[3]);let R=A-I;R>0&&(R=Math.max(10,R),this.circleDiameter=R)}else{let I=p.top*f-_[0],A=p.bottom*f+_[2],L=p.left*f-_[3],R=p.right*f+_[1];const $=p.collisionPadding;if($&&(L-=$[0]*f,I-=$[1]*f,R+=$[2]*f,A+=$[3]*f),S){const W=new de(L,I),Y=new de(R,I),se=new de(L,A),Q=new de(R,A),oe=S*Math.PI/180;W._rotate(oe),Y._rotate(oe),se._rotate(oe),Q._rotate(oe),L=Math.min(W.x,Y.x,se.x,Q.x),R=Math.max(W.x,Y.x,se.x,Q.x),I=Math.min(W.y,Y.y,se.y,Q.y),A=Math.max(W.y,Y.y,se.y,Q.y)}e.emplaceBack(r.x,r.y,L,I,R,A,s,l,h)}this.boxEndIndex=e.length}}class em{constructor(e=[],r=tm){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:s}=this,l=r[e];for(;e>0;){const h=e-1>>1,p=r[h];if(s(l,p)>=0)break;r[e]=p,e=h}r[e]=l}_down(e){const{data:r,compare:s}=this,l=this.length>>1,h=r[e];for(;e<l;){let p=1+(e<<1),f=r[p];const _=p+1;if(_<this.length&&s(r[_],f)<0&&(p=_,f=r[_]),s(f,h)>=0)break;r[e]=f,e=p}r[e]=h}}function tm(i,e){return i<e?-1:i>e?1:0}function im(i,e=1,r=!1){let s=1/0,l=1/0,h=-1/0,p=-1/0;const f=i[0];for(let L=0;L<f.length;L++){const R=f[L];(!L||R.x<s)&&(s=R.x),(!L||R.y<l)&&(l=R.y),(!L||R.x>h)&&(h=R.x),(!L||R.y>p)&&(p=R.y)}const _=Math.min(h-s,p-l);let v=_/2;const S=new em([],rm);if(_===0)return new de(s,l);for(let L=s;L<h;L+=_)for(let R=l;R<p;R+=_)S.push(new Aa(L+v,R+v,v,i));let I=function(L){let R=0,$=0,W=0;const Y=L[0];for(let se=0,Q=Y.length,oe=Q-1;se<Q;oe=se++){const ue=Y[se],ve=Y[oe],Ve=ue.x*ve.y-ve.x*ue.y;$+=(ue.x+ve.x)*Ve,W+=(ue.y+ve.y)*Ve,R+=3*Ve}return new Aa($/R,W/R,0,L)}(i),A=S.length;for(;S.length;){const L=S.pop();(L.d>I.d||!I.d)&&(I=L,r&&console.log("found best %d after %d probes",Math.round(1e4*L.d)/1e4,A)),L.max-I.d<=e||(v=L.h/2,S.push(new Aa(L.p.x-v,L.p.y-v,v,i)),S.push(new Aa(L.p.x+v,L.p.y-v,v,i)),S.push(new Aa(L.p.x-v,L.p.y+v,v,i)),S.push(new Aa(L.p.x+v,L.p.y+v,v,i)),A+=4)}return r&&(console.log(`num probes: ${A}`),console.log(`best distance: ${I.d}`)),I.p}function rm(i,e){return e.max-i.max}function Aa(i,e,r,s){this.p=new de(i,e),this.h=r,this.d=function(l,h){let p=!1,f=1/0;for(let _=0;_<h.length;_++){const v=h[_];for(let S=0,I=v.length,A=I-1;S<I;A=S++){const L=v[S],R=v[A];L.y>l.y!=R.y>l.y&&l.x<(R.x-L.x)*(l.y-L.y)/(R.y-L.y)+L.x&&(p=!p),f=Math.min(f,Zu(l,L,R))}}return(p?1:-1)*Math.sqrt(f)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}var er;o.aq=void 0,(er=o.aq||(o.aq={}))[er.center=1]="center",er[er.left=2]="left",er[er.right=3]="right",er[er.top=4]="top",er[er.bottom=5]="bottom",er[er["top-left"]=6]="top-left",er[er["top-right"]=7]="top-right",er[er["bottom-left"]=8]="bottom-left",er[er["bottom-right"]=9]="bottom-right";const gs=7,cu=Number.POSITIVE_INFINITY;function ud(i,e){return e[1]!==cu?function(r,s,l){let h=0,p=0;switch(s=Math.abs(s),l=Math.abs(l),r){case"top-right":case"top-left":case"top":p=l-gs;break;case"bottom-right":case"bottom-left":case"bottom":p=-l+gs}switch(r){case"top-right":case"bottom-right":case"right":h=-s;break;case"top-left":case"bottom-left":case"left":h=s}return[h,p]}(i,e[0],e[1]):function(r,s){let l=0,h=0;s<0&&(s=0);const p=s/Math.SQRT2;switch(r){case"top-right":case"top-left":h=p-gs;break;case"bottom-right":case"bottom-left":h=-p+gs;break;case"bottom":h=-s+gs;break;case"top":h=s-gs}switch(r){case"top-right":case"bottom-right":l=-p;break;case"top-left":case"bottom-left":l=p;break;case"left":l=s;break;case"right":l=-s}return[l,h]}(i,e[0])}function hd(i,e,r){var s;const l=i.layout,h=(s=l.get("text-variable-anchor-offset"))===null||s===void 0?void 0:s.evaluate(e,{},r);if(h){const f=h.values,_=[];for(let v=0;v<f.length;v+=2){const S=_[v]=f[v],I=f[v+1].map(A=>A*Li);S.startsWith("top")?I[1]-=gs:S.startsWith("bottom")&&(I[1]+=gs),_[v+1]=I}return new Fr(_)}const p=l.get("text-variable-anchor");if(p){let f;f=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[l.get("text-radial-offset").evaluate(e,{},r)*Li,cu]:l.get("text-offset").evaluate(e,{},r).map(v=>v*Li);const _=[];for(const v of p)_.push(v,ud(v,f));return new Fr(_)}return null}function uu(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function nm(i,e,r,s,l,h,p,f,_,v,S){let I=h.textMaxSize.evaluate(e,{});I===void 0&&(I=p);const A=i.layers[0].layout,L=A.get("icon-offset").evaluate(e,{},S),R=pd(r.horizontal),$=p/24,W=i.tilePixelRatio*$,Y=i.tilePixelRatio*I/24,se=i.tilePixelRatio*f,Q=i.tilePixelRatio*A.get("symbol-spacing"),oe=A.get("text-padding")*i.tilePixelRatio,ue=function(Ee,rt,Je,wt=1){const ri=Ee.get("icon-padding").evaluate(rt,{},Je),oi=ri&&ri.values;return[oi[0]*wt,oi[1]*wt,oi[2]*wt,oi[3]*wt]}(A,e,S,i.tilePixelRatio),ve=A.get("text-max-angle")/180*Math.PI,Ve=A.get("text-rotation-alignment")!=="viewport"&&A.get("symbol-placement")!=="point",Ke=A.get("icon-rotation-alignment")==="map"&&A.get("symbol-placement")!=="point",$e=A.get("symbol-placement"),Re=Q/2,Pe=A.get("icon-text-fit");let Ge;s&&Pe!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(Ge=Rh(s,r.vertical,Pe,A.get("icon-text-fit-padding"),L,$)),R&&(s=Rh(s,R,Pe,A.get("icon-text-fit-padding"),L,$)));const ze=(Ee,rt)=>{rt.x<0||rt.x>=Mi||rt.y<0||rt.y>=Mi||function(Je,wt,ri,oi,Ri,Vr,xr,ki,Wi,tr,vr,br,Fi,Bi,lr,wr,cr,Pr,zr,Oi,It,ur,ir,Ni,sn){const mn=Je.addToLineVertexArray(wt,ri);let gn,Hn,an,Gr,Dr=0,Wn=0,jo=0,_d=0,yu=-1,xu=-1;const Xn={};let yd=Un("");if(Je.allowVerticalPlacement&&oi.vertical){const hr=ki.layout.get("text-rotate").evaluate(It,{},Ni)+90;an=new Ql(Wi,wt,tr,vr,br,oi.vertical,Fi,Bi,lr,hr),xr&&(Gr=new Ql(Wi,wt,tr,vr,br,xr,cr,Pr,lr,hr))}if(Ri){const hr=ki.layout.get("icon-rotate").evaluate(It,{}),Hr=ki.layout.get("icon-text-fit")!=="none",$s=ld(Ri,hr,ir,Hr),yn=xr?ld(xr,hr,ir,Hr):void 0;Hn=new Ql(Wi,wt,tr,vr,br,Ri,cr,Pr,!1,hr),Dr=4*$s.length;const js=Je.iconSizeData;let Pn=null;js.kind==="source"?(Pn=[An*ki.layout.get("icon-size").evaluate(It,{})],Pn[0]>ps&&xt(`${Je.layerIds[0]}: Value for "icon-size" is >= ${Bo}. Reduce your "icon-size".`)):js.kind==="composite"&&(Pn=[An*ur.compositeIconSizes[0].evaluate(It,{},Ni),An*ur.compositeIconSizes[1].evaluate(It,{},Ni)],(Pn[0]>ps||Pn[1]>ps)&&xt(`${Je.layerIds[0]}: Value for "icon-size" is >= ${Bo}. Reduce your "icon-size".`)),Je.addSymbols(Je.icon,$s,Pn,Oi,zr,It,o.ai.none,wt,mn.lineStartIndex,mn.lineLength,-1,Ni),yu=Je.icon.placedSymbolArray.length-1,yn&&(Wn=4*yn.length,Je.addSymbols(Je.icon,yn,Pn,Oi,zr,It,o.ai.vertical,wt,mn.lineStartIndex,mn.lineLength,-1,Ni),xu=Je.icon.placedSymbolArray.length-1)}const xd=Object.keys(oi.horizontal);for(const hr of xd){const Hr=oi.horizontal[hr];if(!gn){yd=Un(Hr.text);const yn=ki.layout.get("text-rotate").evaluate(It,{},Ni);gn=new Ql(Wi,wt,tr,vr,br,Hr,Fi,Bi,lr,yn)}const $s=Hr.positionedLines.length===1;if(jo+=dd(Je,wt,Hr,Vr,ki,lr,It,wr,mn,oi.vertical?o.ai.horizontal:o.ai.horizontalOnly,$s?xd:[hr],Xn,yu,ur,Ni),$s)break}oi.vertical&&(_d+=dd(Je,wt,oi.vertical,Vr,ki,lr,It,wr,mn,o.ai.vertical,["vertical"],Xn,xu,ur,Ni));const om=gn?gn.boxStartIndex:Je.collisionBoxArray.length,lm=gn?gn.boxEndIndex:Je.collisionBoxArray.length,cm=an?an.boxStartIndex:Je.collisionBoxArray.length,um=an?an.boxEndIndex:Je.collisionBoxArray.length,hm=Hn?Hn.boxStartIndex:Je.collisionBoxArray.length,dm=Hn?Hn.boxEndIndex:Je.collisionBoxArray.length,pm=Gr?Gr.boxStartIndex:Je.collisionBoxArray.length,fm=Gr?Gr.boxEndIndex:Je.collisionBoxArray.length;let _n=-1;const tc=(hr,Hr)=>hr&&hr.circleDiameter?Math.max(hr.circleDiameter,Hr):Hr;_n=tc(gn,_n),_n=tc(an,_n),_n=tc(Hn,_n),_n=tc(Gr,_n);const vd=_n>-1?1:0;vd&&(_n*=sn/Li),Je.glyphOffsetArray.length>=Ma.MAX_GLYPHS&&xt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),It.sortKey!==void 0&&Je.addToSortKeyRanges(Je.symbolInstances.length,It.sortKey);const mm=hd(ki,It,Ni),[gm,_m]=function(hr,Hr){const $s=hr.length,yn=Hr?.values;if(yn?.length>0)for(let js=0;js<yn.length;js+=2){const Pn=yn[js+1];hr.emplaceBack(o.aq[yn[js]],Pn[0],Pn[1])}return[$s,hr.length]}(Je.textAnchorOffsets,mm);Je.symbolInstances.emplaceBack(wt.x,wt.y,Xn.right>=0?Xn.right:-1,Xn.center>=0?Xn.center:-1,Xn.left>=0?Xn.left:-1,Xn.vertical||-1,yu,xu,yd,om,lm,cm,um,hm,dm,pm,fm,tr,jo,_d,Dr,Wn,vd,0,Fi,_n,gm,_m)}(i,rt,Ee,r,s,l,Ge,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,W,[oe,oe,oe,oe],Ve,_,se,ue,Ke,L,e,h,v,S,p)};if($e==="line")for(const Ee of id(e.geometry,0,0,Mi,Mi)){const rt=Qf(Ee,Q,ve,r.vertical||R,s,24,Y,i.overscaling,Mi);for(const Je of rt)R&&sm(i,R.text,Re,Je)||ze(Ee,Je)}else if($e==="line-center"){for(const Ee of e.geometry)if(Ee.length>1){const rt=Jf(Ee,ve,r.vertical||R,s,24,Y);rt&&ze(Ee,rt)}}else if(e.type==="Polygon")for(const Ee of Vc(e.geometry,0)){const rt=im(Ee,16);ze(Ee[0],new ms(rt.x,rt.y,0))}else if(e.type==="LineString")for(const Ee of e.geometry)ze(Ee,new ms(Ee[0].x,Ee[0].y,0));else if(e.type==="Point")for(const Ee of e.geometry)for(const rt of Ee)ze([rt],new ms(rt.x,rt.y,0))}function dd(i,e,r,s,l,h,p,f,_,v,S,I,A,L,R){const $=function(se,Q,oe,ue,ve,Ve,Ke,$e){const Re=ue.layout.get("text-rotate").evaluate(Ve,{})*Math.PI/180,Pe=[];for(const Ge of Q.positionedLines)for(const ze of Ge.positionedGlyphs){if(!ze.rect)continue;const Ee=ze.rect||{};let rt=Mh+1,Je=!0,wt=1,ri=0;const oi=(ve||$e)&&ze.vertical,Ri=ze.metrics.advance*ze.scale/2;if($e&&Q.verticalizable&&(ri=Ge.lineOffset/2-(ze.imageName?-(Li-ze.metrics.width*ze.scale)/2:(ze.scale-1)*Li)),ze.imageName){const Oi=Ke[ze.imageName];Je=Oi.sdf,wt=Oi.pixelRatio,rt=Ar/wt}const Vr=ve?[ze.x+Ri,ze.y]:[0,0];let xr=ve?[0,0]:[ze.x+Ri+oe[0],ze.y+oe[1]-ri],ki=[0,0];oi&&(ki=xr,xr=[0,0]);const Wi=ze.metrics.isDoubleResolution?2:1,tr=(ze.metrics.left-rt)*ze.scale-Ri+xr[0],vr=(-ze.metrics.top-rt)*ze.scale+xr[1],br=tr+Ee.w/Wi*ze.scale/wt,Fi=vr+Ee.h/Wi*ze.scale/wt,Bi=new de(tr,vr),lr=new de(br,vr),wr=new de(tr,Fi),cr=new de(br,Fi);if(oi){const Oi=new de(-Ri,Ri-Ro),It=-Math.PI/2,ur=Li/2-Ri,ir=new de(5-Ro-ur,-(ze.imageName?ur:0)),Ni=new de(...ki);Bi._rotateAround(It,Oi)._add(ir)._add(Ni),lr._rotateAround(It,Oi)._add(ir)._add(Ni),wr._rotateAround(It,Oi)._add(ir)._add(Ni),cr._rotateAround(It,Oi)._add(ir)._add(Ni)}if(Re){const Oi=Math.sin(Re),It=Math.cos(Re),ur=[It,-Oi,Oi,It];Bi._matMult(ur),lr._matMult(ur),wr._matMult(ur),cr._matMult(ur)}const Pr=new de(0,0),zr=new de(0,0);Pe.push({tl:Bi,tr:lr,bl:wr,br:cr,tex:Ee,writingMode:Q.writingMode,glyphOffset:Vr,sectionIndex:ze.sectionIndex,isSDF:Je,pixelOffsetTL:Pr,pixelOffsetBR:zr,minFontScaleX:0,minFontScaleY:0})}return Pe}(0,r,f,l,h,p,s,i.allowVerticalPlacement),W=i.textSizeData;let Y=null;W.kind==="source"?(Y=[An*l.layout.get("text-size").evaluate(p,{})],Y[0]>ps&&xt(`${i.layerIds[0]}: Value for "text-size" is >= ${Bo}. Reduce your "text-size".`)):W.kind==="composite"&&(Y=[An*L.compositeTextSizes[0].evaluate(p,{},R),An*L.compositeTextSizes[1].evaluate(p,{},R)],(Y[0]>ps||Y[1]>ps)&&xt(`${i.layerIds[0]}: Value for "text-size" is >= ${Bo}. Reduce your "text-size".`)),i.addSymbols(i.text,$,Y,f,h,p,v,e,_.lineStartIndex,_.lineLength,A,R);for(const se of S)I[se]=i.text.placedSymbolArray.length-1;return 4*$.length}function pd(i){for(const e in i)return i[e];return null}function sm(i,e,r,s){const l=i.compareText;if(e in l){const h=l[e];for(let p=h.length-1;p>=0;p--)if(s.dist(h[p])<r)return!0}else l[e]=[];return l[e].push(s),!1}const fd=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class hu{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,s]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const l=s>>4;if(l!==1)throw new Error(`Got v${l} data when expected v1.`);const h=fd[15&s];if(!h)throw new Error("Unrecognized array type.");const[p]=new Uint16Array(e,2,1),[f]=new Uint32Array(e,4,1);return new hu(f,p,h,e)}constructor(e,r=64,s=Float64Array,l){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=s,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const h=fd.indexOf(this.ArrayType),p=2*e*this.ArrayType.BYTES_PER_ELEMENT,f=e*this.IndexArrayType.BYTES_PER_ELEMENT,_=(8-f%8)%8;if(h<0)throw new Error(`Unexpected typed array class: ${s}.`);l&&l instanceof ArrayBuffer?(this.data=l,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+f+_,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+p+f+_),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+f+_,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+h]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=e,this.coords[this._pos++]=r,s}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return du(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,s,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:p,nodeSize:f}=this,_=[0,h.length-1,0],v=[];for(;_.length;){const S=_.pop()||0,I=_.pop()||0,A=_.pop()||0;if(I-A<=f){for(let W=A;W<=I;W++){const Y=p[2*W],se=p[2*W+1];Y>=e&&Y<=s&&se>=r&&se<=l&&v.push(h[W])}continue}const L=A+I>>1,R=p[2*L],$=p[2*L+1];R>=e&&R<=s&&$>=r&&$<=l&&v.push(h[L]),(S===0?e<=R:r<=$)&&(_.push(A),_.push(L-1),_.push(1-S)),(S===0?s>=R:l>=$)&&(_.push(L+1),_.push(I),_.push(1-S))}return v}within(e,r,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:l,coords:h,nodeSize:p}=this,f=[0,l.length-1,0],_=[],v=s*s;for(;f.length;){const S=f.pop()||0,I=f.pop()||0,A=f.pop()||0;if(I-A<=p){for(let W=A;W<=I;W++)gd(h[2*W],h[2*W+1],e,r)<=v&&_.push(l[W]);continue}const L=A+I>>1,R=h[2*L],$=h[2*L+1];gd(R,$,e,r)<=v&&_.push(l[L]),(S===0?e-s<=R:r-s<=$)&&(f.push(A),f.push(L-1),f.push(1-S)),(S===0?e+s>=R:r+s>=$)&&(f.push(L+1),f.push(I),f.push(1-S))}return _}}function du(i,e,r,s,l,h){if(l-s<=r)return;const p=s+l>>1;md(i,e,p,s,l,h),du(i,e,r,s,p-1,1-h),du(i,e,r,p+1,l,1-h)}function md(i,e,r,s,l,h){for(;l>s;){if(l-s>600){const v=l-s+1,S=r-s+1,I=Math.log(v),A=.5*Math.exp(2*I/3),L=.5*Math.sqrt(I*A*(v-A)/v)*(S-v/2<0?-1:1);md(i,e,r,Math.max(s,Math.floor(r-S*A/v+L)),Math.min(l,Math.floor(r+(v-S)*A/v+L)),h)}const p=e[2*r+h];let f=s,_=l;for(No(i,e,s,r),e[2*l+h]>p&&No(i,e,s,l);f<_;){for(No(i,e,f,_),f++,_--;e[2*f+h]<p;)f++;for(;e[2*_+h]>p;)_--}e[2*s+h]===p?No(i,e,s,_):(_++,No(i,e,_,l)),_<=r&&(s=_+1),r<=_&&(l=_-1)}}function No(i,e,r,s){pu(i,r,s),pu(e,2*r,2*s),pu(e,2*r+1,2*s+1)}function pu(i,e,r){const s=i[e];i[e]=i[r],i[r]=s}function gd(i,e,r,s){const l=i-r,h=e-s;return l*l+h*h}var fu;o.bh=void 0,(fu=o.bh||(o.bh={})).create="create",fu.load="load",fu.fullLoad="fullLoad";let ec=null,$o=[];const mu=1e3/60,gu="loadTime",_u="fullLoadTime",am={mark(i){performance.mark(i)},frame(i){const e=i;ec!=null&&$o.push(e-ec),ec=e},clearMetrics(){ec=null,$o=[],performance.clearMeasures(gu),performance.clearMeasures(_u);for(const i in o.bh)performance.clearMarks(o.bh[i])},getPerformanceMetrics(){performance.measure(gu,o.bh.create,o.bh.load),performance.measure(_u,o.bh.create,o.bh.fullLoad);const i=performance.getEntriesByName(gu)[0].duration,e=performance.getEntriesByName(_u)[0].duration,r=$o.length,s=1/($o.reduce((h,p)=>h+p,0)/r/1e3),l=$o.filter(h=>h>mu).reduce((h,p)=>h+(p-mu)/mu,0);return{loadTime:i,fullLoadTime:e,fps:s,percentDroppedFrames:l/(r+l)*100,totalFrames:r}}};o.$=function(i,e,r){var s,l,h,p,f,_,v,S,I,A,L,R,$=r[0],W=r[1],Y=r[2];return e===i?(i[12]=e[0]*$+e[4]*W+e[8]*Y+e[12],i[13]=e[1]*$+e[5]*W+e[9]*Y+e[13],i[14]=e[2]*$+e[6]*W+e[10]*Y+e[14],i[15]=e[3]*$+e[7]*W+e[11]*Y+e[15]):(l=e[1],h=e[2],p=e[3],f=e[4],_=e[5],v=e[6],S=e[7],I=e[8],A=e[9],L=e[10],R=e[11],i[0]=s=e[0],i[1]=l,i[2]=h,i[3]=p,i[4]=f,i[5]=_,i[6]=v,i[7]=S,i[8]=I,i[9]=A,i[10]=L,i[11]=R,i[12]=s*$+f*W+I*Y+e[12],i[13]=l*$+_*W+A*Y+e[13],i[14]=h*$+v*W+L*Y+e[14],i[15]=p*$+S*W+R*Y+e[15]),i},o.A=wa,o.B=Tr,o.C=class{constructor(i,e,r){this.receive=s=>{const l=s.data,h=l.id;if(h&&(!l.targetMapId||this.mapId===l.targetMapId))if(l.type==="<cancel>"){delete this.tasks[h];const p=this.cancelCallbacks[h];delete this.cancelCallbacks[h],p&&p()}else ft()||l.mustQueue?(this.tasks[h]=l,this.taskQueue.push(h),this.invoker.trigger()):this.processTask(h,l)},this.process=()=>{if(!this.taskQueue.length)return;const s=this.taskQueue.shift(),l=this.tasks[s];delete this.tasks[s],this.taskQueue.length&&this.invoker.trigger(),l&&this.processTask(s,l)},this.target=i,this.parent=e,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new Kf(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=ft()?i:window}send(i,e,r,s,l=!1){const h=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[h]=r);const p=[],f={id:h,type:i,hasCallback:!!r,targetMapId:s,mustQueue:l,sourceMapId:this.mapId,data:En(e,p)};return this.target.postMessage(f,{transfer:p}),{cancel:()=>{r&&delete this.callbacks[h],this.target.postMessage({id:h,type:"<cancel>",targetMapId:s,sourceMapId:this.mapId})}}}processTask(i,e){if(e.type==="<response>"){const r=this.callbacks[i];delete this.callbacks[i],r&&(e.error?r(os(e.error)):r(null,os(e.data)))}else{let r=!1;const s=[],l=e.hasCallback?(f,_)=>{r=!0,delete this.cancelCallbacks[i];const v={id:i,type:"<response>",sourceMapId:this.mapId,error:f?En(f):null,data:En(_,s)};this.target.postMessage(v,{transfer:s})}:f=>{r=!0};let h=null;const p=os(e.data);if(this.parent[e.type])h=this.parent[e.type](e.sourceMapId,p,l);else if("getWorkerSource"in this.parent){const f=e.type.split(".");h=this.parent.getWorkerSource(e.sourceMapId,f[0],p.source)[f[1]](p,l)}else l(new Error(`Could not find function ${e.type}`));!r&&h&&h.cancel&&(this.cancelCallbacks[i]=h.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.D=et,o.E=Sr,o.F=function(i,e){const r={};for(let s=0;s<e.length;s++){const l=e[s];l in i&&(r[l]=i[l])}return r},o.G=qh,o.H=Zh,o.I=Jc,o.J=Qe,o.K=qe,o.L=fs,o.M=si,o.N=Mi,o.O=Zr,o.P=de,o.Q=hi,o.R=qr,o.S=ii,o.T=kl,o.U=Xl,o.V=class extends jn{},o.W=lu,o.X=function(i,e){const r=window.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let s=0;s<i.length;s++){const l=window.document.createElement("source");Ti(i[s])||(r.crossOrigin="Anonymous"),l.src=i[s],r.appendChild(l)}return{cancel:()=>{}}},o.Y=Ae,o.Z=function(){var i=new wa(16);return wa!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},o._=ie,o.a=Ai,o.a$=class extends z{},o.a0=function(i,e,r){var s=r[0],l=r[1],h=r[2];return i[0]=e[0]*s,i[1]=e[1]*s,i[2]=e[2]*s,i[3]=e[3]*s,i[4]=e[4]*l,i[5]=e[5]*l,i[6]=e[6]*l,i[7]=e[7]*l,i[8]=e[8]*h,i[9]=e[9]*h,i[10]=e[10]*h,i[11]=e[11]*h,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},o.a1=Xu,o.a2=function(){return ot++},o.a3=Z,o.a4=Ma,o.a5=function(){Mr.isLoading()||Mr.isLoaded()||fo()!=="deferred"||Ml()},o.a6=io,o.a7=Os,o.a8=ti,o.a9=Jh,o.aA=zs,o.aB=function(i){i=i.slice();const e=Object.create(null);for(let r=0;r<i.length;r++)e[i[r].id]=i[r];for(let r=0;r<i.length;r++)"ref"in i[r]&&(i[r]=$i(i[r],e[i[r].ref]));return i},o.aC=function(i){if(i.type==="custom")return new Xf(i);switch(i.type){case"background":return new Gf(i);case"circle":return new Ap(i);case"fill":return new Kp(i);case"fill-extrusion":return new df(i);case"heatmap":return new zp(i);case"hillshade":return new Lp(i);case"line":return new vf(i);case"raster":return new Wf(i);case"symbol":return new Wl(i)}},o.aD=zt,o.aE=function(i,e){if(!i)return[{command:kt.setStyle,args:[e]}];let r=[];try{if(!jt(i.version,e.version))return[{command:kt.setStyle,args:[e]}];jt(i.center,e.center)||r.push({command:kt.setCenter,args:[e.center]}),jt(i.zoom,e.zoom)||r.push({command:kt.setZoom,args:[e.zoom]}),jt(i.bearing,e.bearing)||r.push({command:kt.setBearing,args:[e.bearing]}),jt(i.pitch,e.pitch)||r.push({command:kt.setPitch,args:[e.pitch]}),jt(i.sprite,e.sprite)||r.push({command:kt.setSprite,args:[e.sprite]}),jt(i.glyphs,e.glyphs)||r.push({command:kt.setGlyphs,args:[e.glyphs]}),jt(i.transition,e.transition)||r.push({command:kt.setTransition,args:[e.transition]}),jt(i.light,e.light)||r.push({command:kt.setLight,args:[e.light]});const s={},l=[];(function(p,f,_,v){let S;for(S in f=f||{},p=p||{})Object.prototype.hasOwnProperty.call(p,S)&&(Object.prototype.hasOwnProperty.call(f,S)||Ki(S,_,v));for(S in f)Object.prototype.hasOwnProperty.call(f,S)&&(Object.prototype.hasOwnProperty.call(p,S)?jt(p[S],f[S])||(p[S].type==="geojson"&&f[S].type==="geojson"&&vn(p,f,S)?_.push({command:kt.setGeoJSONSourceData,args:[S,f[S].data]}):sr(S,f,_,v)):Ui(S,f,_))})(i.sources,e.sources,l,s);const h=[];i.layers&&i.layers.forEach(p=>{s[p.source]?r.push({command:kt.removeLayer,args:[p.id]}):h.push(p)}),r=r.concat(l),function(p,f,_){f=f||[];const v=(p=p||[]).map(Yr),S=f.map(Yr),I=p.reduce(wn,{}),A=f.reduce(wn,{}),L=v.slice(),R=Object.create(null);let $,W,Y,se,Q,oe,ue;for($=0,W=0;$<v.length;$++)Y=v[$],Object.prototype.hasOwnProperty.call(A,Y)?W++:(_.push({command:kt.removeLayer,args:[Y]}),L.splice(L.indexOf(Y,W),1));for($=0,W=0;$<S.length;$++)Y=S[S.length-1-$],L[L.length-1-$]!==Y&&(Object.prototype.hasOwnProperty.call(I,Y)?(_.push({command:kt.removeLayer,args:[Y]}),L.splice(L.lastIndexOf(Y,L.length-W),1)):W++,oe=L[L.length-$],_.push({command:kt.addLayer,args:[A[Y],oe]}),L.splice(L.length-$,0,Y),R[Y]=!0);for($=0;$<S.length;$++)if(Y=S[$],se=I[Y],Q=A[Y],!R[Y]&&!jt(se,Q))if(jt(se.source,Q.source)&&jt(se["source-layer"],Q["source-layer"])&&jt(se.type,Q.type)){for(ue in bn(se.layout,Q.layout,_,Y,null,kt.setLayoutProperty),bn(se.paint,Q.paint,_,Y,null,kt.setPaintProperty),jt(se.filter,Q.filter)||_.push({command:kt.setFilter,args:[Y,Q.filter]}),jt(se.minzoom,Q.minzoom)&&jt(se.maxzoom,Q.maxzoom)||_.push({command:kt.setLayerZoomRange,args:[Y,Q.minzoom,Q.maxzoom]}),se)Object.prototype.hasOwnProperty.call(se,ue)&&ue!=="layout"&&ue!=="paint"&&ue!=="filter"&&ue!=="metadata"&&ue!=="minzoom"&&ue!=="maxzoom"&&(ue.indexOf("paint.")===0?bn(se[ue],Q[ue],_,Y,ue.slice(6),kt.setPaintProperty):jt(se[ue],Q[ue])||_.push({command:kt.setLayerProperty,args:[Y,ue,Q[ue]]}));for(ue in Q)Object.prototype.hasOwnProperty.call(Q,ue)&&!Object.prototype.hasOwnProperty.call(se,ue)&&ue!=="layout"&&ue!=="paint"&&ue!=="filter"&&ue!=="metadata"&&ue!=="minzoom"&&ue!=="maxzoom"&&(ue.indexOf("paint.")===0?bn(se[ue],Q[ue],_,Y,ue.slice(6),kt.setPaintProperty):jt(se[ue],Q[ue])||_.push({command:kt.setLayerProperty,args:[Y,ue,Q[ue]]}))}else _.push({command:kt.removeLayer,args:[Y]}),oe=L[L.lastIndexOf(Y)+1],_.push({command:kt.addLayer,args:[Q,oe]})}(h,e.layers,r)}catch(s){console.warn("Unable to compute style diff:",s),r=[{command:kt.setStyle,args:[e]}]}return r},o.aF=function(i){const e=[],r=i.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},o.aG=function i(e,r){if(Array.isArray(e)){if(!Array.isArray(r)||e.length!==r.length)return!1;for(let s=0;s<e.length;s++)if(!i(e[s],r[s]))return!1;return!0}if(typeof e=="object"&&e!==null&&r!==null){if(typeof r!="object"||Object.keys(e).length!==Object.keys(r).length)return!1;for(const s in e)if(!i(e[s],r[s]))return!1;return!0}return e===r},o.aH=Fe,o.aI=ht,o.aJ=Ds,o.aK=function(i){return i({pluginStatus:gr,pluginURL:Mn}),Ds.on("pluginStateChange",i),i},o.aL=class extends qn{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},o.aM=va,o.aN=class extends qn{constructor(i,e){super(i,e),this.current=Ac}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},o.aO=Dl,o.aP=class extends qn{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},o.aQ=class extends qn{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},o.aR=Ll,o.aS=function(i,e,r,s,l,h,p){var f=1/(e-r),_=1/(s-l),v=1/(h-p);return i[0]=-2*f,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*_,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*v,i[11]=0,i[12]=(e+r)*f,i[13]=(l+s)*_,i[14]=(p+h)*v,i[15]=1,i},o.aT=qt,o.aU=kp,o.aV=class extends a{},o.aW=Cf,o.aX=class extends d{},o.aY=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},o.aZ=eh,o.a_=ke,o.aa=function(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,s,l,h)=>{const p=l||h;return e[s]=!p||p.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e},o.ab=function(i,e){const r=[];for(const s in i)s in e||r.push(s);return r},o.ac=function(i){if(ni==null){const e=i.navigator?i.navigator.userAgent:null;ni=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return ni},o.ad=at,o.ae=function(i,e,r){var s=Math.sin(r),l=Math.cos(r),h=e[0],p=e[1],f=e[2],_=e[3],v=e[4],S=e[5],I=e[6],A=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=h*l+v*s,i[1]=p*l+S*s,i[2]=f*l+I*s,i[3]=_*l+A*s,i[4]=v*l-h*s,i[5]=S*l-p*s,i[6]=I*l-f*s,i[7]=A*l-_*s,i},o.af=function(i){var e=new wa(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},o.ag=Ol,o.ah=function(i,e){let r=0,s=0;if(i.kind==="constant")s=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:l,minZoom:h,maxZoom:p}=i,f=l?at(Ir.interpolationFactor(l,e,h,p),0,1):0;i.kind==="camera"?s=Tr.number(i.minSize,i.maxSize,f):r=f}return{uSizeT:r,uSize:s}},o.aj=function(i,{uSize:e,uSizeT:r},{lowerSize:s,upperSize:l}){return i.kind==="source"?s/An:i.kind==="composite"?Tr.number(s/An,l/An,r):e},o.ak=iu,o.al=function(i,e,r,s){const l=e.y-i.y,h=e.x-i.x,p=s.y-r.y,f=s.x-r.x,_=p*h-f*l;if(_===0)return null;const v=(f*(i.y-r.y)-p*(i.x-r.x))/_;return new de(i.x+v*h,i.y+v*l)},o.am=id,o.an=Uu,o.ao=Rc,o.ap=Li,o.ar=tu,o.as=function(i,e){var r=e[0],s=e[1],l=e[2],h=e[3],p=e[4],f=e[5],_=e[6],v=e[7],S=e[8],I=e[9],A=e[10],L=e[11],R=e[12],$=e[13],W=e[14],Y=e[15],se=r*f-s*p,Q=r*_-l*p,oe=r*v-h*p,ue=s*_-l*f,ve=s*v-h*f,Ve=l*v-h*_,Ke=S*$-I*R,$e=S*W-A*R,Re=S*Y-L*R,Pe=I*W-A*$,Ge=I*Y-L*$,ze=A*Y-L*W,Ee=se*ze-Q*Ge+oe*Pe+ue*Re-ve*$e+Ve*Ke;return Ee?(i[0]=(f*ze-_*Ge+v*Pe)*(Ee=1/Ee),i[1]=(l*Ge-s*ze-h*Pe)*Ee,i[2]=($*Ve-W*ve+Y*ue)*Ee,i[3]=(A*ve-I*Ve-L*ue)*Ee,i[4]=(_*Re-p*ze-v*$e)*Ee,i[5]=(r*ze-l*Re+h*$e)*Ee,i[6]=(W*oe-R*Ve-Y*Q)*Ee,i[7]=(S*Ve-A*oe+L*Q)*Ee,i[8]=(p*Ge-f*Re+v*Ke)*Ee,i[9]=(s*Re-r*Ge-h*Ke)*Ee,i[10]=(R*ve-$*oe+Y*se)*Ee,i[11]=(I*oe-S*ve-L*se)*Ee,i[12]=(f*$e-p*Pe-_*Ke)*Ee,i[13]=(r*Pe-s*$e+l*Ke)*Ee,i[14]=($*Q-R*ue-W*se)*Ee,i[15]=(S*ue-I*Q+A*se)*Ee,i):null},o.at=uu,o.au=eu,o.av=hu,o.aw=function(){const i={},e=fe.$version;for(const r in fe.$root){const s=fe.$root[r];if(s.required){let l=null;l=r==="version"?e:s.type==="array"?[]:{},l!=null&&(i[r]=l)}}return i},o.ax=kt,o.ay=Cl,o.az=Jt,o.b=function(i,e){const r=new Blob([new Uint8Array(i)],{type:"image/png"});createImageBitmap(r).then(s=>{e(null,s)}).catch(s=>{e(new Error(`Could not load image because of ${s.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},o.b0=Gi,o.b1=function(i,e){var r=i[0],s=i[1],l=i[2],h=i[3],p=i[4],f=i[5],_=i[6],v=i[7],S=i[8],I=i[9],A=i[10],L=i[11],R=i[12],$=i[13],W=i[14],Y=i[15],se=e[0],Q=e[1],oe=e[2],ue=e[3],ve=e[4],Ve=e[5],Ke=e[6],$e=e[7],Re=e[8],Pe=e[9],Ge=e[10],ze=e[11],Ee=e[12],rt=e[13],Je=e[14],wt=e[15];return Math.abs(r-se)<=yr*Math.max(1,Math.abs(r),Math.abs(se))&&Math.abs(s-Q)<=yr*Math.max(1,Math.abs(s),Math.abs(Q))&&Math.abs(l-oe)<=yr*Math.max(1,Math.abs(l),Math.abs(oe))&&Math.abs(h-ue)<=yr*Math.max(1,Math.abs(h),Math.abs(ue))&&Math.abs(p-ve)<=yr*Math.max(1,Math.abs(p),Math.abs(ve))&&Math.abs(f-Ve)<=yr*Math.max(1,Math.abs(f),Math.abs(Ve))&&Math.abs(_-Ke)<=yr*Math.max(1,Math.abs(_),Math.abs(Ke))&&Math.abs(v-$e)<=yr*Math.max(1,Math.abs(v),Math.abs($e))&&Math.abs(S-Re)<=yr*Math.max(1,Math.abs(S),Math.abs(Re))&&Math.abs(I-Pe)<=yr*Math.max(1,Math.abs(I),Math.abs(Pe))&&Math.abs(A-Ge)<=yr*Math.max(1,Math.abs(A),Math.abs(Ge))&&Math.abs(L-ze)<=yr*Math.max(1,Math.abs(L),Math.abs(ze))&&Math.abs(R-Ee)<=yr*Math.max(1,Math.abs(R),Math.abs(Ee))&&Math.abs($-rt)<=yr*Math.max(1,Math.abs($),Math.abs(rt))&&Math.abs(W-Je)<=yr*Math.max(1,Math.abs(W),Math.abs(Je))&&Math.abs(Y-wt)<=yr*Math.max(1,Math.abs(Y),Math.abs(wt))},o.b2=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},o.b3=function(i,e,r){return i[0]=e[0]*r[0],i[1]=e[1]*r[1],i[2]=e[2]*r[2],i[3]=e[3]*r[3],i},o.b4=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]},o.b5=tt,o.b6=Xh,o.b7=Gh,o.b8=function(i,e,r,s,l){var h,p=1/Math.tan(e/2);return i[0]=p/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=p,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,l!=null&&l!==1/0?(i[10]=(l+s)*(h=1/(s-l)),i[14]=2*l*s*h):(i[10]=-1,i[14]=-2*s),i},o.b9=function(i,e,r){var s=Math.sin(r),l=Math.cos(r),h=e[4],p=e[5],f=e[6],_=e[7],v=e[8],S=e[9],I=e[10],A=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=h*l+v*s,i[5]=p*l+S*s,i[6]=f*l+I*s,i[7]=_*l+A*s,i[8]=v*l-h*s,i[9]=S*l-p*s,i[10]=I*l-f*s,i[11]=A*l-_*s,i},o.bA=ce,o.bB=bh,o.bC=ca,o.bD=Mr,o.ba=Oe,o.bb=Te,o.bc=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},o.bd=class extends Fs{},o.be=au,o.bf=Hh,o.bg=am,o.bi=gi,o.bj=function(i,e,r=!1){if(gr===lo||gr===co||gr===uo)throw new Error("setRTLTextPlugin cannot be called multiple times.");Mn=Mt.resolveURL(i),gr=lo,ho=e,po(),r||Ml()},o.bk=fo,o.bl=function(i,e){const r={};for(let l=0;l<i.length;l++){const h=e&&e[i[l].id]||pa(i[l]);e&&(e[i[l].id]=h);let p=r[h];p||(p=r[h]=[]),p.push(i[l])}const s=[];for(const l in r)s.push(r[l]);return s},o.bm=Ze,o.bn=Yh,o.bo=Qh,o.bp=Ah,o.bq=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=Mi/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const e=i.bucket.layers[0],r=e.layout,s=e._unevaluatedLayout._values,l={layoutIconSize:s["icon-size"].possiblyEvaluate(new ti(i.bucket.zoom+1),i.canonical),layoutTextSize:s["text-size"].possiblyEvaluate(new ti(i.bucket.zoom+1),i.canonical),textMaxSize:s["text-size"].possiblyEvaluate(new ti(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:v,maxZoom:S}=i.bucket.textSizeData;l.compositeTextSizes=[s["text-size"].possiblyEvaluate(new ti(v),i.canonical),s["text-size"].possiblyEvaluate(new ti(S),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:v,maxZoom:S}=i.bucket.iconSizeData;l.compositeIconSizes=[s["icon-size"].possiblyEvaluate(new ti(v),i.canonical),s["icon-size"].possiblyEvaluate(new ti(S),i.canonical)]}const h=r.get("text-line-height")*Li,p=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",f=r.get("text-keep-upright"),_=r.get("text-size");for(const v of i.bucket.features){const S=r.get("text-font").evaluate(v,{},i.canonical).join(","),I=_.evaluate(v,{},i.canonical),A=l.layoutTextSize.evaluate(v,{},i.canonical),L=l.layoutIconSize.evaluate(v,{},i.canonical),R={horizontal:{},vertical:void 0},$=v.text;let W,Y=[0,0];if($){const oe=$.toString(),ue=r.get("text-letter-spacing").evaluate(v,{},i.canonical)*Li,ve=ao(oe)?ue:0,Ve=r.get("text-anchor").evaluate(v,{},i.canonical),Ke=hd(e,v,i.canonical);if(!Ke){const ze=r.get("text-radial-offset").evaluate(v,{},i.canonical);Y=ze?ud(Ve,[ze*Li,cu]):r.get("text-offset").evaluate(v,{},i.canonical).map(Ee=>Ee*Li)}let $e=p?"center":r.get("text-justify").evaluate(v,{},i.canonical);const Re=r.get("symbol-placement"),Pe=Re==="point"?r.get("text-max-width").evaluate(v,{},i.canonical)*Li:0,Ge=()=>{i.bucket.allowVerticalPlacement&&so(oe)&&(R.vertical=Zl($,i.glyphMap,i.glyphPositions,i.imagePositions,S,Pe,h,Ve,"left",ve,Y,o.ai.vertical,!0,Re,A,I))};if(!p&&Ke){const ze=new Set;if($e==="auto")for(let rt=0;rt<Ke.values.length;rt+=2)ze.add(uu(Ke.values[rt]));else ze.add($e);let Ee=!1;for(const rt of ze)if(!R.horizontal[rt])if(Ee)R.horizontal[rt]=R.horizontal[0];else{const Je=Zl($,i.glyphMap,i.glyphPositions,i.imagePositions,S,Pe,h,"center",rt,ve,Y,o.ai.horizontal,!1,Re,A,I);Je&&(R.horizontal[rt]=Je,Ee=Je.positionedLines.length===1)}Ge()}else{$e==="auto"&&($e=uu(Ve));const ze=Zl($,i.glyphMap,i.glyphPositions,i.imagePositions,S,Pe,h,Ve,$e,ve,Y,o.ai.horizontal,!1,Re,A,I);ze&&(R.horizontal[$e]=ze),Ge(),so(oe)&&p&&f&&(R.vertical=Zl($,i.glyphMap,i.glyphPositions,i.imagePositions,S,Pe,h,Ve,$e,ve,Y,o.ai.vertical,!1,Re,A,I))}}let se=!1;if(v.icon&&v.icon.name){const oe=i.imageMap[v.icon.name];oe&&(W=jf(i.imagePositions[v.icon.name],r.get("icon-offset").evaluate(v,{},i.canonical),r.get("icon-anchor").evaluate(v,{},i.canonical)),se=!!oe.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=se:i.bucket.sdfIcons!==se&&xt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(oe.pixelRatio!==i.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const Q=pd(R.horizontal)||R.vertical;i.bucket.iconsInText=!!Q&&Q.iconsInText,(Q||W)&&nm(i.bucket,v,R,W,i.imageMap,l,A,L,Y,se,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},o.br=Wc,o.bs=Zc,o.bt=Hc,o.bu=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},o.bv=Kc,o.bw=hs,o.bx=function(i,e,r,s,l){return ie(this,void 0,void 0,function*(){if(qe())try{return yield si(i,e,r,s,l)}catch{}return function(h,p,f,_,v){const S=h.width,I=h.height;Xt&&Ue||(Xt=new OffscreenCanvas(S,I),Ue=Xt.getContext("2d",{willReadFrequently:!0})),Xt.width=S,Xt.height=I,Ue.drawImage(h,0,0,S,I);const A=Ue.getImageData(p,f,_,v);return Ue.clearRect(0,0,S,I),A.data}(i,e,r,s,l)})},o.by=Kh,o.bz=B,o.c=Yt,o.d=function(i,e){const r=new Image;r.onload=()=>{e(null,r),URL.revokeObjectURL(r.src),r.onload=null,window.requestAnimationFrame(()=>{r.src=Xi})},r.onerror=()=>e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const s=new Blob([new Uint8Array(i)],{type:"image/png"});r.src=i.byteLength?URL.createObjectURL(s):Xi},o.e=He,o.f=function(i,e){return bi(He(i,{type:"json"}),e)},o.g=Rt,o.h=Mt,o.i=ft,o.j=fr,o.k=nr,o.l=Wt,o.m=bi,o.n=function(i){return new Kc(i).readFields(Rf,[])},o.o=function(i,e,r){if(!i.length)return r(null,[]);let s=i.length;const l=new Array(i.length);let h=null;i.forEach((p,f)=>{e(p,(_,v)=>{_&&(h=_),l[f]=v,--s==0&&r(h,l)})})},o.p=kh,o.q=Eo,o.r=wi,o.s=Ti,o.t=Ic,o.u=je,o.v=fe,o.w=xt,o.x=ga,o.y=dn,o.z=function([i,e,r]){return e+=90,e*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(r),y:i*Math.sin(e)*Math.sin(r),z:i*Math.cos(r)}}}),F(["./shared"],function(o){class ie{constructor(k){this.keyCache={},k&&this.replace(k)}replace(k){this._layerConfigs={},this._layers={},this.update(k,[])}update(k,P){for(const G of k){this._layerConfigs[G.id]=G;const X=this._layers[G.id]=o.aC(G);X._featureFilter=o.a6(X.filter),this.keyCache[G.id]&&delete this.keyCache[G.id]}for(const G of P)delete this.keyCache[G],delete this._layerConfigs[G],delete this._layers[G];this.familiesBySource={};const O=o.bl(Object.values(this._layerConfigs),this.keyCache);for(const G of O){const X=G.map(ye=>this._layers[ye.id]),ae=X[0];if(ae.visibility==="none")continue;const ee=ae.source||"";let J=this.familiesBySource[ee];J||(J=this.familiesBySource[ee]={});const ne=ae.sourceLayer||"_geojsonTileLayer";let me=J[ne];me||(me=J[ne]=[]),me.push(X)}}}class B{constructor(k){const P={},O=[];for(const ee in k){const J=k[ee],ne=P[ee]={};for(const me in J){const ye=J[+me];if(!ye||ye.bitmap.width===0||ye.bitmap.height===0)continue;const we={x:0,y:0,w:ye.bitmap.width+2,h:ye.bitmap.height+2};O.push(we),ne[me]={rect:we,metrics:ye.metrics}}}const{w:G,h:X}=o.p(O),ae=new o.q({width:G||1,height:X||1});for(const ee in k){const J=k[ee];for(const ne in J){const me=J[+ne];if(!me||me.bitmap.width===0||me.bitmap.height===0)continue;const ye=P[ee][ne].rect;o.q.copy(me.bitmap,ae,{x:0,y:0},{x:ye.x+1,y:ye.y+1},me.bitmap)}}this.image=ae,this.positions=P}}o.bm("GlyphAtlas",B);class ce{constructor(k){this.tileID=new o.O(k.tileID.overscaledZ,k.tileID.wrap,k.tileID.canonical.z,k.tileID.canonical.x,k.tileID.canonical.y),this.uid=k.uid,this.zoom=k.zoom,this.pixelRatio=k.pixelRatio,this.tileSize=k.tileSize,this.source=k.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=k.showCollisionBoxes,this.collectResourceTiming=!!k.collectResourceTiming,this.returnDependencies=!!k.returnDependencies,this.promoteId=k.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(k,P,O,G,X){this.status="parsing",this.data=k,this.collisionBoxArray=new o.a3;const ae=new o.bn(Object.keys(k.layers).sort()),ee=new o.bo(this.tileID,this.promoteId);ee.bucketLayerIDs=[];const J={},ne={featureIndex:ee,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:O},me=P.familiesBySource[this.source];for(const Ft in me){const Dt=k.layers[Ft];if(!Dt)continue;Dt.version===1&&o.w(`Vector tile source "${this.source}" layer "${Ft}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Yi=ae.encode(Ft),Qt=[];for(let Ei=0;Ei<Dt.length;Ei++){const qi=Dt.feature(Ei),Rr=ee.getId(qi,Ft);Qt.push({feature:qi,id:Rr,index:Ei,sourceLayerIndex:Yi})}for(const Ei of me[Ft]){const qi=Ei[0];qi.source!==this.source&&o.w(`layer.source = ${qi.source} does not equal this.source = ${this.source}`),qi.minzoom&&this.zoom<Math.floor(qi.minzoom)||qi.maxzoom&&this.zoom>=qi.maxzoom||qi.visibility!=="none"&&(_e(Ei,this.zoom,O),(J[qi.id]=qi.createBucket({index:ee.bucketLayerIDs.length,layers:Ei,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Yi,sourceID:this.source})).populate(Qt,ne,this.tileID.canonical),ee.bucketLayerIDs.push(Ei.map(Rr=>Rr.id)))}}let ye,we,it,pt;const We=o.aH(ne.glyphDependencies,Ft=>Object.keys(Ft).map(Number));this.inFlightDependencies.forEach(Ft=>Ft?.cancel()),this.inFlightDependencies=[];const st=++this.dependencySentinel;Object.keys(We).length?this.inFlightDependencies.push(G.send("getGlyphs",{uid:this.uid,stacks:We,source:this.source,tileID:this.tileID,type:"glyphs"},(Ft,Dt)=>{st===this.dependencySentinel&&(ye||(ye=Ft,we=Dt,Gt.call(this)))})):we={};const gt=Object.keys(ne.iconDependencies);gt.length?this.inFlightDependencies.push(G.send("getImages",{icons:gt,source:this.source,tileID:this.tileID,type:"icons"},(Ft,Dt)=>{st===this.dependencySentinel&&(ye||(ye=Ft,it=Dt,Gt.call(this)))})):it={};const Vt=Object.keys(ne.patternDependencies);function Gt(){if(ye)return X(ye);if(we&&it&&pt){const Ft=new B(we),Dt=new o.bp(it,pt);for(const Yi in J){const Qt=J[Yi];Qt instanceof o.a4?(_e(Qt.layers,this.zoom,O),o.bq({bucket:Qt,glyphMap:we,glyphPositions:Ft.positions,imageMap:it,imagePositions:Dt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Qt.hasPattern&&(Qt instanceof o.br||Qt instanceof o.bs||Qt instanceof o.bt)&&(_e(Qt.layers,this.zoom,O),Qt.addFeatures(ne,this.tileID.canonical,Dt.patternPositions))}this.status="done",X(null,{buckets:Object.values(J).filter(Yi=>!Yi.isEmpty()),featureIndex:ee,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ft.image,imageAtlas:Dt,glyphMap:this.returnDependencies?we:null,iconMap:this.returnDependencies?it:null,glyphPositions:this.returnDependencies?Ft.positions:null})}}Vt.length?this.inFlightDependencies.push(G.send("getImages",{icons:Vt,source:this.source,tileID:this.tileID,type:"patterns"},(Ft,Dt)=>{st===this.dependencySentinel&&(ye||(ye=Ft,pt=Dt,Gt.call(this)))})):pt={},Gt.call(this)}}function _e(q,k,P){const O=new o.a8(k);for(const G of q)G.recalculate(O,P)}function de(q,k){const P=o.l(q.request,(O,G,X,ae)=>{if(O)k(O);else if(G)try{const ee=new o.bw.VectorTile(new o.bv(G));k(null,{vectorTile:ee,rawData:G,cacheControl:X,expires:ae})}catch(ee){const J=new Uint8Array(G);let ne=`Unable to parse the tile at ${q.request.url}, `;ne+=J[0]===31&&J[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ee.messge}`,k(new Error(ne))}});return()=>{P.cancel(),k()}}class be{constructor(k,P,O,G){this.actor=k,this.layerIndex=P,this.availableImages=O,this.loadVectorData=G||de,this.fetching={},this.loading={},this.loaded={}}loadTile(k,P){const O=k.uid;this.loading||(this.loading={});const G=!!(k&&k.request&&k.request.collectResourceTiming)&&new o.bu(k.request),X=this.loading[O]=new ce(k);X.abort=this.loadVectorData(k,(ae,ee)=>{if(delete this.loading[O],ae||!ee)return X.status="done",this.loaded[O]=X,P(ae);const J=ee.rawData,ne={};ee.expires&&(ne.expires=ee.expires),ee.cacheControl&&(ne.cacheControl=ee.cacheControl);const me={};if(G){const ye=G.finish();ye&&(me.resourceTiming=JSON.parse(JSON.stringify(ye)))}X.vectorTile=ee.vectorTile,X.parse(ee.vectorTile,this.layerIndex,this.availableImages,this.actor,(ye,we)=>{if(delete this.fetching[O],ye||!we)return P(ye);P(null,o.e({rawTileData:J.slice(0)},we,ne,me))}),this.loaded=this.loaded||{},this.loaded[O]=X,this.fetching[O]={rawTileData:J,cacheControl:ne,resourceTiming:me}})}reloadTile(k,P){const O=this.loaded,G=k.uid;if(O&&O[G]){const X=O[G];X.showCollisionBoxes=k.showCollisionBoxes,X.status==="parsing"?X.parse(X.vectorTile,this.layerIndex,this.availableImages,this.actor,(ae,ee)=>{if(ae||!ee)return P(ae,ee);let J;if(this.fetching[G]){const{rawTileData:ne,cacheControl:me,resourceTiming:ye}=this.fetching[G];delete this.fetching[G],J=o.e({rawTileData:ne.slice(0)},ee,me,ye)}else J=ee;P(null,J)}):X.status==="done"&&(X.vectorTile?X.parse(X.vectorTile,this.layerIndex,this.availableImages,this.actor,P):P())}}abortTile(k,P){const O=this.loading,G=k.uid;O&&O[G]&&O[G].abort&&(O[G].abort(),delete O[G]),P()}removeTile(k,P){const O=this.loaded,G=k.uid;O&&O[G]&&delete O[G],P()}}class Me{constructor(){this.loaded={}}loadTile(k,P){return o._(this,void 0,void 0,function*(){const{uid:O,encoding:G,rawImageData:X,redFactor:ae,greenFactor:ee,blueFactor:J,baseShift:ne}=k,me=X.width+2,ye=X.height+2,we=o.a(X)?new o.R({width:me,height:ye},yield o.bx(X,-1,-1,me,ye)):X,it=new o.by(O,we,G,ae,ee,J,ne);this.loaded=this.loaded||{},this.loaded[O]=it,P(null,it)})}removeTile(k){const P=this.loaded,O=k.uid;P&&P[O]&&delete P[O]}}function Be(q,k){if(q.length!==0){De(q[0],k);for(var P=1;P<q.length;P++)De(q[P],!k)}}function De(q,k){for(var P=0,O=0,G=0,X=q.length,ae=X-1;G<X;ae=G++){var ee=(q[G][0]-q[ae][0])*(q[ae][1]+q[G][1]),J=P+ee;O+=Math.abs(P)>=Math.abs(ee)?P-J+ee:ee-J+P,P=J}P+O>=0!=!!k&&q.reverse()}var Ne=o.bz(function q(k,P){var O,G=k&&k.type;if(G==="FeatureCollection")for(O=0;O<k.features.length;O++)q(k.features[O],P);else if(G==="GeometryCollection")for(O=0;O<k.geometries.length;O++)q(k.geometries[O],P);else if(G==="Feature")q(k.geometry,P);else if(G==="Polygon")Be(k.coordinates,P);else if(G==="MultiPolygon")for(O=0;O<k.coordinates.length;O++)Be(k.coordinates[O],P);return k});const Qe=o.bw.VectorTileFeature.prototype.toGeoJSON;var qe={exports:{}},Oe=o.bA,Te=o.bw.VectorTileFeature,at=tt;function tt(q,k){this.options=k||{},this.features=q,this.length=q.length}function He(q,k){this.id=typeof q.id=="number"?q.id:void 0,this.type=q.type,this.rawGeometry=q.type===1?[q.geometry]:q.geometry,this.properties=q.tags,this.extent=k||4096}tt.prototype.feature=function(q){return new He(this.features[q],this.options.extent)},He.prototype.loadGeometry=function(){var q=this.rawGeometry;this.geometry=[];for(var k=0;k<q.length;k++){for(var P=q[k],O=[],G=0;G<P.length;G++)O.push(new Oe(P[G][0],P[G][1]));this.geometry.push(O)}return this.geometry},He.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var q=this.geometry,k=1/0,P=-1/0,O=1/0,G=-1/0,X=0;X<q.length;X++)for(var ae=q[X],ee=0;ee<ae.length;ee++){var J=ae[ee];k=Math.min(k,J.x),P=Math.max(P,J.x),O=Math.min(O,J.y),G=Math.max(G,J.y)}return[k,O,P,G]},He.prototype.toGeoJSON=Te.prototype.toGeoJSON;var ot=o.bB,Fe=at;function ht(q){var k=new ot;return function(P,O){for(var G in P.layers)O.writeMessage(3,zt,P.layers[G])}(q,k),k.finish()}function zt(q,k){var P;k.writeVarintField(15,q.version||1),k.writeStringField(1,q.name||""),k.writeVarintField(5,q.extent||4096);var O={keys:[],values:[],keycache:{},valuecache:{}};for(P=0;P<q.length;P++)O.feature=q.feature(P),k.writeMessage(2,Lt,O);var G=O.keys;for(P=0;P<G.length;P++)k.writeStringField(3,G[P]);var X=O.values;for(P=0;P<X.length;P++)k.writeMessage(4,ni,X[P])}function Lt(q,k){var P=q.feature;P.id!==void 0&&k.writeVarintField(1,P.id),k.writeMessage(2,xt,q),k.writeVarintField(3,P.type),k.writeMessage(4,ft,P)}function xt(q,k){var P=q.feature,O=q.keys,G=q.values,X=q.keycache,ae=q.valuecache;for(var ee in P.properties){var J=P.properties[ee],ne=X[ee];if(J!==null){ne===void 0&&(O.push(ee),X[ee]=ne=O.length-1),k.writeVarint(ne);var me=typeof J;me!=="string"&&me!=="boolean"&&me!=="number"&&(J=JSON.stringify(J));var ye=me+":"+J,we=ae[ye];we===void 0&&(G.push(J),ae[ye]=we=G.length-1),k.writeVarint(we)}}}function Et(q,k){return(k<<3)+(7&q)}function Bt(q){return q<<1^q>>31}function ft(q,k){for(var P=q.loadGeometry(),O=q.type,G=0,X=0,ae=P.length,ee=0;ee<ae;ee++){var J=P[ee],ne=1;O===1&&(ne=J.length),k.writeVarint(Et(1,ne));for(var me=O===3?J.length-1:J.length,ye=0;ye<me;ye++){ye===1&&O!==1&&k.writeVarint(Et(2,me-1));var we=J[ye].x-G,it=J[ye].y-X;k.writeVarint(Bt(we)),k.writeVarint(Bt(it)),G+=we,X+=it}O===3&&k.writeVarint(Et(7,1))}}function ni(q,k){var P=typeof q;P==="string"?k.writeStringField(1,q):P==="boolean"?k.writeBooleanField(7,q):P==="number"&&(q%1!=0?k.writeDoubleField(3,q):q<0?k.writeSVarintField(6,q):k.writeVarintField(5,q))}qe.exports=ht,qe.exports.fromVectorTileJs=ht,qe.exports.fromGeojsonVt=function(q,k){k=k||{};var P={};for(var O in q)P[O]=new Fe(q[O].features,k),P[O].name=O,P[O].version=k.version,P[O].extent=k.extent;return ht({layers:P})},qe.exports.GeoJSONWrapper=Fe;var Ai=o.bz(qe.exports);const Xi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:q=>q},si=Math.fround||(Xt=new Float32Array(1),q=>(Xt[0]=+q,Xt[0]));var Xt;const Ue=3,_t=5,Kt=6;class Mt{constructor(k){this.options=Object.assign(Object.create(Xi),k),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(k){const{log:P,minZoom:O,maxZoom:G}=this.options;P&&console.time("total time");const X=`prepare ${k.length} points`;P&&console.time(X),this.points=k;const ae=[];for(let J=0;J<k.length;J++){const ne=k[J];if(!ne.geometry)continue;const[me,ye]=ne.geometry.coordinates,we=si(Jt(me)),it=si(Rt(ye));ae.push(we,it,1/0,J,-1,1),this.options.reduce&&ae.push(0)}let ee=this.trees[G+1]=this._createTree(ae);P&&console.timeEnd(X);for(let J=G;J>=O;J--){const ne=+Date.now();ee=this.trees[J]=this._createTree(this._cluster(ee,J)),P&&console.log("z%d: %d clusters in %dms",J,ee.numItems,+Date.now()-ne)}return P&&console.timeEnd("total time"),this}getClusters(k,P){let O=((k[0]+180)%360+360)%360-180;const G=Math.max(-90,Math.min(90,k[1]));let X=k[2]===180?180:((k[2]+180)%360+360)%360-180;const ae=Math.max(-90,Math.min(90,k[3]));if(k[2]-k[0]>=360)O=-180,X=180;else if(O>X){const ye=this.getClusters([O,G,180,ae],P),we=this.getClusters([-180,G,X,ae],P);return ye.concat(we)}const ee=this.trees[this._limitZoom(P)],J=ee.range(Jt(O),Rt(ae),Jt(X),Rt(G)),ne=ee.data,me=[];for(const ye of J){const we=this.stride*ye;me.push(ne[we+_t]>1?Yt(ne,we,this.clusterProps):this.points[ne[we+Ue]])}return me}getChildren(k){const P=this._getOriginId(k),O=this._getOriginZoom(k),G="No cluster with the specified id.",X=this.trees[O];if(!X)throw new Error(G);const ae=X.data;if(P*this.stride>=ae.length)throw new Error(G);const ee=this.options.radius/(this.options.extent*Math.pow(2,O-1)),J=X.within(ae[P*this.stride],ae[P*this.stride+1],ee),ne=[];for(const me of J){const ye=me*this.stride;ae[ye+4]===k&&ne.push(ae[ye+_t]>1?Yt(ae,ye,this.clusterProps):this.points[ae[ye+Ue]])}if(ne.length===0)throw new Error(G);return ne}getLeaves(k,P,O){const G=[];return this._appendLeaves(G,k,P=P||10,O=O||0,0),G}getTile(k,P,O){const G=this.trees[this._limitZoom(k)],X=Math.pow(2,k),{extent:ae,radius:ee}=this.options,J=ee/ae,ne=(O-J)/X,me=(O+1+J)/X,ye={features:[]};return this._addTileFeatures(G.range((P-J)/X,ne,(P+1+J)/X,me),G.data,P,O,X,ye),P===0&&this._addTileFeatures(G.range(1-J/X,ne,1,me),G.data,X,O,X,ye),P===X-1&&this._addTileFeatures(G.range(0,ne,J/X,me),G.data,-1,O,X,ye),ye.features.length?ye:null}getClusterExpansionZoom(k){let P=this._getOriginZoom(k)-1;for(;P<=this.options.maxZoom;){const O=this.getChildren(k);if(P++,O.length!==1)break;k=O[0].properties.cluster_id}return P}_appendLeaves(k,P,O,G,X){const ae=this.getChildren(P);for(const ee of ae){const J=ee.properties;if(J&&J.cluster?X+J.point_count<=G?X+=J.point_count:X=this._appendLeaves(k,J.cluster_id,O,G,X):X<G?X++:k.push(ee),k.length===O)break}return X}_createTree(k){const P=new o.av(k.length/this.stride|0,this.options.nodeSize,Float32Array);for(let O=0;O<k.length;O+=this.stride)P.add(k[O],k[O+1]);return P.finish(),P.data=k,P}_addTileFeatures(k,P,O,G,X,ae){for(const ee of k){const J=ee*this.stride,ne=P[J+_t]>1;let me,ye,we;if(ne)me=gi(P,J,this.clusterProps),ye=P[J],we=P[J+1];else{const We=this.points[P[J+Ue]];me=We.properties;const[st,gt]=We.geometry.coordinates;ye=Jt(st),we=Rt(gt)}const it={type:1,geometry:[[Math.round(this.options.extent*(ye*X-O)),Math.round(this.options.extent*(we*X-G))]],tags:me};let pt;pt=ne||this.options.generateId?P[J+Ue]:this.points[P[J+Ue]].id,pt!==void 0&&(it.id=pt),ae.features.push(it)}}_limitZoom(k){return Math.max(this.options.minZoom,Math.min(Math.floor(+k),this.options.maxZoom+1))}_cluster(k,P){const{radius:O,extent:G,reduce:X,minPoints:ae}=this.options,ee=O/(G*Math.pow(2,P)),J=k.data,ne=[],me=this.stride;for(let ye=0;ye<J.length;ye+=me){if(J[ye+2]<=P)continue;J[ye+2]=P;const we=J[ye],it=J[ye+1],pt=k.within(J[ye],J[ye+1],ee),We=J[ye+_t];let st=We;for(const gt of pt){const Vt=gt*me;J[Vt+2]>P&&(st+=J[Vt+_t])}if(st>We&&st>=ae){let gt,Vt=we*We,Gt=it*We,Ft=-1;const Dt=((ye/me|0)<<5)+(P+1)+this.points.length;for(const Yi of pt){const Qt=Yi*me;if(J[Qt+2]<=P)continue;J[Qt+2]=P;const Ei=J[Qt+_t];Vt+=J[Qt]*Ei,Gt+=J[Qt+1]*Ei,J[Qt+4]=Dt,X&&(gt||(gt=this._map(J,ye,!0),Ft=this.clusterProps.length,this.clusterProps.push(gt)),X(gt,this._map(J,Qt)))}J[ye+4]=Dt,ne.push(Vt/st,Gt/st,1/0,Dt,-1,st),X&&ne.push(Ft)}else{for(let gt=0;gt<me;gt++)ne.push(J[ye+gt]);if(st>1)for(const gt of pt){const Vt=gt*me;if(!(J[Vt+2]<=P)){J[Vt+2]=P;for(let Gt=0;Gt<me;Gt++)ne.push(J[Vt+Gt])}}}}return ne}_getOriginId(k){return k-this.points.length>>5}_getOriginZoom(k){return(k-this.points.length)%32}_map(k,P,O){if(k[P+_t]>1){const ae=this.clusterProps[k[P+Kt]];return O?Object.assign({},ae):ae}const G=this.points[k[P+Ue]].properties,X=this.options.map(G);return O&&X===G?Object.assign({},X):X}}function Yt(q,k,P){return{type:"Feature",id:q[k+Ue],properties:gi(q,k,P),geometry:{type:"Point",coordinates:[(O=q[k],360*(O-.5)),Pi(q[k+1])]}};var O}function gi(q,k,P){const O=q[k+_t],G=O>=1e4?`${Math.round(O/1e3)}k`:O>=1e3?Math.round(O/100)/10+"k":O,X=q[k+Kt],ae=X===-1?{}:Object.assign({},P[X]);return Object.assign(ae,{cluster:!0,cluster_id:q[k+Ue],point_count:O,point_count_abbreviated:G})}function Jt(q){return q/360+.5}function Rt(q){const k=Math.sin(q*Math.PI/180),P=.5-.25*Math.log((1+k)/(1-k))/Math.PI;return P<0?0:P>1?1:P}function Pi(q){const k=(180-360*q)*Math.PI/180;return 360*Math.atan(Math.exp(k))/Math.PI-90}function bi(q,k,P,O){for(var G,X=O,ae=P-k>>1,ee=P-k,J=q[k],ne=q[k+1],me=q[P],ye=q[P+1],we=k+3;we<P;we+=3){var it=Wt(q[we],q[we+1],J,ne,me,ye);if(it>X)G=we,X=it;else if(it===X){var pt=Math.abs(we-ae);pt<ee&&(G=we,ee=pt)}}X>O&&(G-k>3&&bi(q,k,G,O),q[G+2]=X,P-G>3&&bi(q,G,P,O))}function Wt(q,k,P,O,G,X){var ae=G-P,ee=X-O;if(ae!==0||ee!==0){var J=((q-P)*ae+(k-O)*ee)/(ae*ae+ee*ee);J>1?(P=G,O=X):J>0&&(P+=ae*J,O+=ee*J)}return(ae=q-P)*ae+(ee=k-O)*ee}function Ti(q,k,P,O){var G={id:q===void 0?null:q,type:k,geometry:P,tags:O,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(X){var ae=X.geometry,ee=X.type;if(ee==="Point"||ee==="MultiPoint"||ee==="LineString")rr(X,ae);else if(ee==="Polygon"||ee==="MultiLineString")for(var J=0;J<ae.length;J++)rr(X,ae[J]);else if(ee==="MultiPolygon")for(J=0;J<ae.length;J++)for(var ne=0;ne<ae[J].length;ne++)rr(X,ae[J][ne])}(G),G}function rr(q,k){for(var P=0;P<k.length;P+=3)q.minX=Math.min(q.minX,k[P]),q.minY=Math.min(q.minY,k[P+1]),q.maxX=Math.max(q.maxX,k[P]),q.maxY=Math.max(q.maxY,k[P+1])}function pr(q,k,P,O){if(k.geometry){var G=k.geometry.coordinates,X=k.geometry.type,ae=Math.pow(P.tolerance/((1<<P.maxZoom)*P.extent),2),ee=[],J=k.id;if(P.promoteId?J=k.properties[P.promoteId]:P.generateId&&(J=O||0),X==="Point")nr(G,ee);else if(X==="MultiPoint")for(var ne=0;ne<G.length;ne++)nr(G[ne],ee);else if(X==="LineString")fr(G,ee,ae,!1);else if(X==="MultiLineString"){if(P.lineMetrics){for(ne=0;ne<G.length;ne++)fr(G[ne],ee=[],ae,!1),q.push(Ti(J,"LineString",ee,k.properties));return}Sr(G,ee,ae,!1)}else if(X==="Polygon")Sr(G,ee,ae,!0);else{if(X!=="MultiPolygon"){if(X==="GeometryCollection"){for(ne=0;ne<k.geometry.geometries.length;ne++)pr(q,{id:J,geometry:k.geometry.geometries[ne],properties:k.properties},P,O);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ne=0;ne<G.length;ne++){var me=[];Sr(G[ne],me,ae,!0),ee.push(me)}}q.push(Ti(J,X,ee,k.properties))}}function nr(q,k){k.push(fe(q[0])),k.push(Ii(q[1])),k.push(0)}function fr(q,k,P,O){for(var G,X,ae=0,ee=0;ee<q.length;ee++){var J=fe(q[ee][0]),ne=Ii(q[ee][1]);k.push(J),k.push(ne),k.push(0),ee>0&&(ae+=O?(G*ne-J*X)/2:Math.sqrt(Math.pow(J-G,2)+Math.pow(ne-X,2))),G=J,X=ne}var me=k.length-3;k[2]=1,bi(k,0,me,P),k[me+2]=1,k.size=Math.abs(ae),k.start=0,k.end=k.size}function Sr(q,k,P,O){for(var G=0;G<q.length;G++){var X=[];fr(q[G],X,P,O),k.push(X)}}function fe(q){return q/360+.5}function Ii(q){var k=Math.sin(q*Math.PI/180),P=.5-.25*Math.log((1+k)/(1-k))/Math.PI;return P<0?0:P>1?1:P}function $i(q,k,P,O,G,X,ae,ee){if(O/=k,X>=(P/=k)&&ae<O)return q;if(ae<P||X>=O)return null;for(var J=[],ne=0;ne<q.length;ne++){var me=q[ne],ye=me.geometry,we=me.type,it=G===0?me.minX:me.minY,pt=G===0?me.maxX:me.maxY;if(it>=P&&pt<O)J.push(me);else if(!(pt<P||it>=O)){var We=[];if(we==="Point"||we==="MultiPoint")jt(ye,We,P,O,G);else if(we==="LineString")kt(ye,We,P,O,G,!1,ee.lineMetrics);else if(we==="MultiLineString")Ki(ye,We,P,O,G,!1);else if(we==="Polygon")Ki(ye,We,P,O,G,!0);else if(we==="MultiPolygon")for(var st=0;st<ye.length;st++){var gt=[];Ki(ye[st],gt,P,O,G,!0),gt.length&&We.push(gt)}if(We.length){if(ee.lineMetrics&&we==="LineString"){for(st=0;st<We.length;st++)J.push(Ti(me.id,we,We[st],me.tags));continue}we!=="LineString"&&we!=="MultiLineString"||(We.length===1?(we="LineString",We=We[0]):we="MultiLineString"),we!=="Point"&&we!=="MultiPoint"||(we=We.length===3?"Point":"MultiPoint"),J.push(Ti(me.id,we,We,me.tags))}}}return J.length?J:null}function jt(q,k,P,O,G){for(var X=0;X<q.length;X+=3){var ae=q[X+G];ae>=P&&ae<=O&&(k.push(q[X]),k.push(q[X+1]),k.push(q[X+2]))}}function kt(q,k,P,O,G,X,ae){for(var ee,J,ne=Ui(q),me=G===0?vn:bn,ye=q.start,we=0;we<q.length-3;we+=3){var it=q[we],pt=q[we+1],We=q[we+2],st=q[we+3],gt=q[we+4],Vt=G===0?it:pt,Gt=G===0?st:gt,Ft=!1;ae&&(ee=Math.sqrt(Math.pow(it-st,2)+Math.pow(pt-gt,2))),Vt<P?Gt>P&&(J=me(ne,it,pt,st,gt,P),ae&&(ne.start=ye+ee*J)):Vt>O?Gt<O&&(J=me(ne,it,pt,st,gt,O),ae&&(ne.start=ye+ee*J)):sr(ne,it,pt,We),Gt<P&&Vt>=P&&(J=me(ne,it,pt,st,gt,P),Ft=!0),Gt>O&&Vt<=O&&(J=me(ne,it,pt,st,gt,O),Ft=!0),!X&&Ft&&(ae&&(ne.end=ye+ee*J),k.push(ne),ne=Ui(q)),ae&&(ye+=ee)}var Dt=q.length-3;it=q[Dt],pt=q[Dt+1],We=q[Dt+2],(Vt=G===0?it:pt)>=P&&Vt<=O&&sr(ne,it,pt,We),Dt=ne.length-3,X&&Dt>=3&&(ne[Dt]!==ne[0]||ne[Dt+1]!==ne[1])&&sr(ne,ne[0],ne[1],ne[2]),ne.length&&k.push(ne)}function Ui(q){var k=[];return k.size=q.size,k.start=q.start,k.end=q.end,k}function Ki(q,k,P,O,G,X){for(var ae=0;ae<q.length;ae++)kt(q[ae],k,P,O,G,X,!1)}function sr(q,k,P,O){q.push(k),q.push(P),q.push(O)}function vn(q,k,P,O,G,X){var ae=(X-k)/(O-k);return q.push(X),q.push(P+(G-P)*ae),q.push(1),ae}function bn(q,k,P,O,G,X){var ae=(X-P)/(G-P);return q.push(k+(O-k)*ae),q.push(X),q.push(1),ae}function Yr(q,k){for(var P=[],O=0;O<q.length;O++){var G,X=q[O],ae=X.type;if(ae==="Point"||ae==="MultiPoint"||ae==="LineString")G=wn(X.geometry,k);else if(ae==="MultiLineString"||ae==="Polygon"){G=[];for(var ee=0;ee<X.geometry.length;ee++)G.push(wn(X.geometry[ee],k))}else if(ae==="MultiPolygon")for(G=[],ee=0;ee<X.geometry.length;ee++){for(var J=[],ne=0;ne<X.geometry[ee].length;ne++)J.push(wn(X.geometry[ee][ne],k));G.push(J)}P.push(Ti(X.id,ae,G,X.tags))}return P}function wn(q,k){var P=[];P.size=q.size,q.start!==void 0&&(P.start=q.start,P.end=q.end);for(var O=0;O<q.length;O+=3)P.push(q[O]+k,q[O+1],q[O+2]);return P}function Ae(q,k){if(q.transformed)return q;var P,O,G,X=1<<q.z,ae=q.x,ee=q.y;for(P=0;P<q.features.length;P++){var J=q.features[P],ne=J.geometry,me=J.type;if(J.geometry=[],me===1)for(O=0;O<ne.length;O+=2)J.geometry.push(mt(ne[O],ne[O+1],k,X,ae,ee));else for(O=0;O<ne.length;O++){var ye=[];for(G=0;G<ne[O].length;G+=2)ye.push(mt(ne[O][G],ne[O][G+1],k,X,ae,ee));J.geometry.push(ye)}}return q.transformed=!0,q}function mt(q,k,P,O,G,X){return[Math.round(P*(q*O-G)),Math.round(P*(k*O-X))]}function dt(q,k,P,O,G){for(var X=k===G.maxZoom?0:G.tolerance/((1<<k)*G.extent),ae={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:P,y:O,z:k,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ee=0;ee<q.length;ee++){ae.numFeatures++,Ut(ae,q[ee],X,G);var J=q[ee].minX,ne=q[ee].minY,me=q[ee].maxX,ye=q[ee].maxY;J<ae.minX&&(ae.minX=J),ne<ae.minY&&(ae.minY=ne),me>ae.maxX&&(ae.maxX=me),ye>ae.maxY&&(ae.maxY=ye)}return ae}function Ut(q,k,P,O){var G=k.geometry,X=k.type,ae=[];if(X==="Point"||X==="MultiPoint")for(var ee=0;ee<G.length;ee+=3)ae.push(G[ee]),ae.push(G[ee+1]),q.numPoints++,q.numSimplified++;else if(X==="LineString")bt(ae,G,q,P,!1,!1);else if(X==="MultiLineString"||X==="Polygon")for(ee=0;ee<G.length;ee++)bt(ae,G[ee],q,P,X==="Polygon",ee===0);else if(X==="MultiPolygon")for(var J=0;J<G.length;J++){var ne=G[J];for(ee=0;ee<ne.length;ee++)bt(ae,ne[ee],q,P,!0,ee===0)}if(ae.length){var me=k.tags||null;if(X==="LineString"&&O.lineMetrics){for(var ye in me={},k.tags)me[ye]=k.tags[ye];me.mapbox_clip_start=G.start/G.size,me.mapbox_clip_end=G.end/G.size}var we={geometry:ae,type:X==="Polygon"||X==="MultiPolygon"?3:X==="LineString"||X==="MultiLineString"?2:1,tags:me};k.id!==null&&(we.id=k.id),q.features.push(we)}}function bt(q,k,P,O,G,X){var ae=O*O;if(O>0&&k.size<(G?ae:O))P.numPoints+=k.length/3;else{for(var ee=[],J=0;J<k.length;J+=3)(O===0||k[J+2]>ae)&&(P.numSimplified++,ee.push(k[J]),ee.push(k[J+1])),P.numPoints++;G&&function(ne,me){for(var ye=0,we=0,it=ne.length,pt=it-2;we<it;pt=we,we+=2)ye+=(ne[we]-ne[pt])*(ne[we+1]+ne[pt+1]);if(ye>0===me)for(we=0,it=ne.length;we<it/2;we+=2){var We=ne[we],st=ne[we+1];ne[we]=ne[it-2-we],ne[we+1]=ne[it-1-we],ne[it-2-we]=We,ne[it-1-we]=st}}(ee,X),q.push(ee)}}function Ce(q,k){var P=(k=this.options=function(G,X){for(var ae in X)G[ae]=X[ae];return G}(Object.create(this.options),k)).debug;if(P&&console.time("preprocess data"),k.maxZoom<0||k.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(k.promoteId&&k.generateId)throw new Error("promoteId and generateId cannot be used together.");var O=function(G,X){var ae=[];if(G.type==="FeatureCollection")for(var ee=0;ee<G.features.length;ee++)pr(ae,G.features[ee],X,ee);else pr(ae,G.type==="Feature"?G:{geometry:G},X);return ae}(q,k);this.tiles={},this.tileCoords=[],P&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",k.indexMaxZoom,k.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),O=function(G,X){var ae=X.buffer/X.extent,ee=G,J=$i(G,1,-1-ae,ae,0,-1,2,X),ne=$i(G,1,1-ae,2+ae,0,-1,2,X);return(J||ne)&&(ee=$i(G,1,-ae,1+ae,0,-1,2,X)||[],J&&(ee=Yr(J,1).concat(ee)),ne&&(ee=ee.concat(Yr(ne,-1)))),ee}(O,k),O.length&&this.splitTile(O,0,0,0),P&&(O.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function nt(q,k,P){return 32*((1<<q)*P+k)+q}function lt(q,k){return k?q.properties[k]:q.id}function _i(q,k){if(q==null)return!0;if(q.type==="Feature")return lt(q,k)!=null;if(q.type==="FeatureCollection"){const P=new Set;for(const O of q.features){const G=lt(O,k);if(G==null||P.has(G))return!1;P.add(G)}return!0}return!1}function ji(q,k){const P=new Map;if(q!=null)if(q.type==="Feature")P.set(lt(q,k),q);else for(const O of q.features)P.set(lt(O,k),O);return P}Ce.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ce.prototype.splitTile=function(q,k,P,O,G,X,ae){for(var ee=[q,k,P,O],J=this.options,ne=J.debug;ee.length;){O=ee.pop(),P=ee.pop(),k=ee.pop(),q=ee.pop();var me=1<<k,ye=nt(k,P,O),we=this.tiles[ye];if(!we&&(ne>1&&console.time("creation"),we=this.tiles[ye]=dt(q,k,P,O,J),this.tileCoords.push({z:k,x:P,y:O}),ne)){ne>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",k,P,O,we.numFeatures,we.numPoints,we.numSimplified),console.timeEnd("creation"));var it="z"+k;this.stats[it]=(this.stats[it]||0)+1,this.total++}if(we.source=q,G){if(k===J.maxZoom||k===G)continue;var pt=1<<G-k;if(P!==Math.floor(X/pt)||O!==Math.floor(ae/pt))continue}else if(k===J.indexMaxZoom||we.numPoints<=J.indexMaxPoints)continue;if(we.source=null,q.length!==0){ne>1&&console.time("clipping");var We,st,gt,Vt,Gt,Ft,Dt=.5*J.buffer/J.extent,Yi=.5-Dt,Qt=.5+Dt,Ei=1+Dt;We=st=gt=Vt=null,Gt=$i(q,me,P-Dt,P+Qt,0,we.minX,we.maxX,J),Ft=$i(q,me,P+Yi,P+Ei,0,we.minX,we.maxX,J),q=null,Gt&&(We=$i(Gt,me,O-Dt,O+Qt,1,we.minY,we.maxY,J),st=$i(Gt,me,O+Yi,O+Ei,1,we.minY,we.maxY,J),Gt=null),Ft&&(gt=$i(Ft,me,O-Dt,O+Qt,1,we.minY,we.maxY,J),Vt=$i(Ft,me,O+Yi,O+Ei,1,we.minY,we.maxY,J),Ft=null),ne>1&&console.timeEnd("clipping"),ee.push(We||[],k+1,2*P,2*O),ee.push(st||[],k+1,2*P,2*O+1),ee.push(gt||[],k+1,2*P+1,2*O),ee.push(Vt||[],k+1,2*P+1,2*O+1)}}},Ce.prototype.getTile=function(q,k,P){var O=this.options,G=O.extent,X=O.debug;if(q<0||q>24)return null;var ae=1<<q,ee=nt(q,k=(k%ae+ae)%ae,P);if(this.tiles[ee])return Ae(this.tiles[ee],G);X>1&&console.log("drilling down to z%d-%d-%d",q,k,P);for(var J,ne=q,me=k,ye=P;!J&&ne>0;)ne--,me=Math.floor(me/2),ye=Math.floor(ye/2),J=this.tiles[nt(ne,me,ye)];return J&&J.source?(X>1&&console.log("found parent tile z%d-%d-%d",ne,me,ye),X>1&&console.time("drilling down"),this.splitTile(J.source,ne,me,ye,q,k,P),X>1&&console.timeEnd("drilling down"),this.tiles[ee]?Ae(this.tiles[ee],G):null):null};class yt extends be{constructor(k,P,O,G){super(k,P,O),this._dataUpdateable=new Map,this.loadGeoJSON=(X,ae)=>{const{promoteId:ee}=X;if(X.request)return o.f(X.request,(J,ne,me,ye)=>{this._dataUpdateable=_i(ne,ee)?ji(ne,ee):void 0,ae(J,ne,me,ye)});if(typeof X.data=="string")try{const J=JSON.parse(X.data);this._dataUpdateable=_i(J,ee)?ji(J,ee):void 0,ae(null,J)}catch{ae(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`))}else X.dataDiff?this._dataUpdateable?(function(J,ne,me){var ye,we,it,pt;if(ne.removeAll&&J.clear(),ne.remove)for(const We of ne.remove)J.delete(We);if(ne.add)for(const We of ne.add){const st=lt(We,me);st!=null&&J.set(st,We)}if(ne.update)for(const We of ne.update){let st=J.get(We.id);if(st==null)continue;const gt=!We.removeAllProperties&&(((ye=We.removeProperties)===null||ye===void 0?void 0:ye.length)>0||((we=We.addOrUpdateProperties)===null||we===void 0?void 0:we.length)>0);if((We.newGeometry||We.removeAllProperties||gt)&&(st=Object.assign({},st),J.set(We.id,st),gt&&(st.properties=Object.assign({},st.properties))),We.newGeometry&&(st.geometry=We.newGeometry),We.removeAllProperties)st.properties={};else if(((it=We.removeProperties)===null||it===void 0?void 0:it.length)>0)for(const Vt of We.removeProperties)Object.prototype.hasOwnProperty.call(st.properties,Vt)&&delete st.properties[Vt];if(((pt=We.addOrUpdateProperties)===null||pt===void 0?void 0:pt.length)>0)for(const{key:Vt,value:Gt}of We.addOrUpdateProperties)st.properties[Vt]=Gt}}(this._dataUpdateable,X.dataDiff,ee),ae(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):ae(new Error(`Cannot update existing geojson data in ${X.source}`)):ae(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},this.loadVectorData=this.loadGeoJSONTile,G&&(this.loadGeoJSON=G)}loadGeoJSONTile(k,P){const O=k.tileID.canonical;if(!this._geoJSONIndex)return P(null,null);const G=this._geoJSONIndex.getTile(O.z,O.x,O.y);if(!G)return P(null,null);const X=new class{constructor(ee){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.N,this.length=ee.length,this._features=ee}feature(ee){return new class{constructor(J){this._feature=J,this.extent=o.N,this.type=J.type,this.properties=J.tags,"id"in J&&!isNaN(J.id)&&(this.id=parseInt(J.id,10))}loadGeometry(){if(this._feature.type===1){const J=[];for(const ne of this._feature.geometry)J.push([new o.P(ne[0],ne[1])]);return J}{const J=[];for(const ne of this._feature.geometry){const me=[];for(const ye of ne)me.push(new o.P(ye[0],ye[1]));J.push(me)}return J}}toGeoJSON(J,ne,me){return Qe.call(this,J,ne,me)}}(this._features[ee])}}(G.features);let ae=Ai(X);ae.byteOffset===0&&ae.byteLength===ae.buffer.byteLength||(ae=new Uint8Array(ae)),P(null,{vectorTile:X,rawData:ae.buffer})}loadData(k,P){var O;(O=this._pendingRequest)===null||O===void 0||O.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const G=!!(k&&k.request&&k.request.collectResourceTiming)&&new o.bu(k.request);this._pendingCallback=P,this._pendingRequest=this.loadGeoJSON(k,(X,ae)=>{if(delete this._pendingCallback,delete this._pendingRequest,X||!ae)return P(X);if(typeof ae!="object")return P(new Error(`Input data given to '${k.source}' is not a valid GeoJSON object.`));{Ne(ae,!0);try{if(k.filter){const J=o.bC(k.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(J.result==="error")throw new Error(J.value.map(me=>`${me.key}: ${me.message}`).join(", "));ae={type:"FeatureCollection",features:ae.features.filter(me=>J.value.evaluate({zoom:0},me))}}this._geoJSONIndex=k.cluster?new Mt(function({superclusterOptions:J,clusterProperties:ne}){if(!ne||!J)return J;const me={},ye={},we={accumulated:null,zoom:0},it={properties:null},pt=Object.keys(ne);for(const We of pt){const[st,gt]=ne[We],Vt=o.bC(gt),Gt=o.bC(typeof st=="string"?[st,["accumulated"],["get",We]]:st);me[We]=Vt.value,ye[We]=Gt.value}return J.map=We=>{it.properties=We;const st={};for(const gt of pt)st[gt]=me[gt].evaluate(we,it);return st},J.reduce=(We,st)=>{it.properties=st;for(const gt of pt)we.accumulated=We[gt],We[gt]=ye[gt].evaluate(we,it)},J}(k)).load(ae.features):function(J,ne){return new Ce(J,ne)}(ae,k.geojsonVtOptions)}catch(J){return P(J)}this.loaded={};const ee={};if(G){const J=G.finish();J&&(ee.resourceTiming={},ee.resourceTiming[k.source]=JSON.parse(JSON.stringify(J)))}P(null,ee)}})}reloadTile(k,P){const O=this.loaded;return O&&O[k.uid]?super.reloadTile(k,P):this.loadTile(k,P)}removeSource(k,P){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),P()}getClusterExpansionZoom(k,P){try{P(null,this._geoJSONIndex.getClusterExpansionZoom(k.clusterId))}catch(O){P(O)}}getClusterChildren(k,P){try{P(null,this._geoJSONIndex.getChildren(k.clusterId))}catch(O){P(O)}}getClusterLeaves(k,P){try{P(null,this._geoJSONIndex.getLeaves(k.clusterId,k.limit,k.offset))}catch(O){P(O)}}}class ln{constructor(k){this.self=k,this.actor=new o.C(k,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:be,geojson:yt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(P,O)=>{if(this.workerSourceTypes[P])throw new Error(`Worker source with name "${P}" already registered.`);this.workerSourceTypes[P]=O},this.self.registerRTLTextPlugin=P=>{if(o.bD.isParsed())throw new Error("RTL text plugin already registered.");o.bD.applyArabicShaping=P.applyArabicShaping,o.bD.processBidirectionalText=P.processBidirectionalText,o.bD.processStyledBidirectionalText=P.processStyledBidirectionalText}}setReferrer(k,P){this.referrer=P}setImages(k,P,O){this.availableImages[k]=P;for(const G in this.workerSources[k]){const X=this.workerSources[k][G];for(const ae in X)X[ae].availableImages=P}O()}setLayers(k,P,O){this.getLayerIndex(k).replace(P),O()}updateLayers(k,P,O){this.getLayerIndex(k).update(P.layers,P.removedIds),O()}loadTile(k,P,O){this.getWorkerSource(k,P.type,P.source).loadTile(P,O)}loadDEMTile(k,P,O){this.getDEMWorkerSource(k,P.source).loadTile(P,O)}reloadTile(k,P,O){this.getWorkerSource(k,P.type,P.source).reloadTile(P,O)}abortTile(k,P,O){this.getWorkerSource(k,P.type,P.source).abortTile(P,O)}removeTile(k,P,O){this.getWorkerSource(k,P.type,P.source).removeTile(P,O)}removeDEMTile(k,P){this.getDEMWorkerSource(k,P.source).removeTile(P)}removeSource(k,P,O){if(!this.workerSources[k]||!this.workerSources[k][P.type]||!this.workerSources[k][P.type][P.source])return;const G=this.workerSources[k][P.type][P.source];delete this.workerSources[k][P.type][P.source],G.removeSource!==void 0?G.removeSource(P,O):O()}loadWorkerSource(k,P,O){try{this.self.importScripts(P.url),O()}catch(G){O(G.toString())}}syncRTLPluginState(k,P,O){try{o.bD.setState(P);const G=o.bD.getPluginURL();if(o.bD.isLoaded()&&!o.bD.isParsed()&&G!=null){this.self.importScripts(G);const X=o.bD.isParsed();O(X?void 0:new Error(`RTL Text Plugin failed to import scripts from ${G}`),X)}}catch(G){O(G.toString())}}getAvailableImages(k){let P=this.availableImages[k];return P||(P=[]),P}getLayerIndex(k){let P=this.layerIndexes[k];return P||(P=this.layerIndexes[k]=new ie),P}getWorkerSource(k,P,O){return this.workerSources[k]||(this.workerSources[k]={}),this.workerSources[k][P]||(this.workerSources[k][P]={}),this.workerSources[k][P][O]||(this.workerSources[k][P][O]=new this.workerSourceTypes[P]({send:(G,X,ae)=>{this.actor.send(G,X,ae,k)}},this.getLayerIndex(k),this.getAvailableImages(k))),this.workerSources[k][P][O]}getDEMWorkerSource(k,P){return this.demWorkerSources[k]||(this.demWorkerSources[k]={}),this.demWorkerSources[k][P]||(this.demWorkerSources[k][P]=new Me),this.demWorkerSources[k][P]}}return o.i()&&(self.worker=new ln(self)),ln}),F(["./shared"],function(o){var ie="3.6.2";class B{static testProp(t){if(!B.docStyle)return t[0];for(let n=0;n<t.length;n++)if(t[n]in B.docStyle)return t[n];return t[0]}static create(t,n,a){const c=window.document.createElement(t);return n!==void 0&&(c.className=n),a&&a.appendChild(c),c}static createNS(t,n){return window.document.createElementNS(t,n)}static disableDrag(){B.docStyle&&B.selectProp&&(B.userSelect=B.docStyle[B.selectProp],B.docStyle[B.selectProp]="none")}static enableDrag(){B.docStyle&&B.selectProp&&(B.docStyle[B.selectProp]=B.userSelect)}static setTransform(t,n){t.style[B.transformProp]=n}static addEventListener(t,n,a,c={}){t.addEventListener(n,a,"passive"in c?c:c.capture)}static removeEventListener(t,n,a,c={}){t.removeEventListener(n,a,"passive"in c?c:c.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",B.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",B.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",B.suppressClickInternal,!0)},0)}static mousePos(t,n){const a=t.getBoundingClientRect();return new o.P(n.clientX-a.left-t.clientLeft,n.clientY-a.top-t.clientTop)}static touchPos(t,n){const a=t.getBoundingClientRect(),c=[];for(let d=0;d<n.length;d++)c.push(new o.P(n[d].clientX-a.left-t.clientLeft,n[d].clientY-a.top-t.clientTop));return c}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}B.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,B.selectProp=B.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),B.transformProp=B.testProp(["transform","WebkitTransform"]);const ce={supported:!1,testSupport:function(u){!be&&de&&(Me?Be(u):_e=u)}};let _e,de,be=!1,Me=!1;function Be(u){const t=u.createTexture();u.bindTexture(u.TEXTURE_2D,t);try{if(u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,de),u.isContextLost())return;ce.supported=!0}catch{}u.deleteTexture(t),be=!0}var De,Ne;typeof document<"u"&&(de=document.createElement("img"),de.onload=function(){_e&&Be(_e),_e=null,Me=!0},de.onerror=function(){be=!0,_e=null},de.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(u){let t,n,a,c;u.resetRequestQueue=()=>{t=[],n=0,a=0,c={}},u.addThrottleControl=w=>{const C=a++;return c[C]=w,C},u.removeThrottleControl=w=>{delete c[w],g()},u.getImage=(w,C,T=!0)=>{ce.supported&&(w.headers||(w.headers={}),w.headers.accept="image/webp,*/*");const z={requestParameters:w,supportImageRefresh:T,callback:C,cancelled:!1,completed:!1,cancel:()=>{z.completed||z.cancelled||(z.cancelled=!0,z.innerRequest&&(z.innerRequest.cancel(),n--),g())}};return t.push(z),g(),z};const d=w=>{const{requestParameters:C,supportImageRefresh:T,callback:z}=w;return o.e(C,{type:"image"}),(T!==!1||o.i()||o.g(C.url)||C.headers&&!Object.keys(C.headers).reduce((V,j)=>V&&j==="accept",!0)?o.m:x)(C,(V,j,Z,N)=>{m(w,z,V,j,Z,N)})},m=(w,C,T,z,V,j)=>{T?C(T):z instanceof HTMLImageElement||o.a(z)?C(null,z):z&&((Z,N)=>{typeof createImageBitmap=="function"?o.b(Z,N):o.d(Z,N)})(z,(Z,N)=>{Z!=null?C(Z):N!=null&&C(null,N,{cacheControl:V,expires:j})}),w.cancelled||(w.completed=!0,n--,g())},g=()=>{const w=(()=>{const C=Object.keys(c);let T=!1;if(C.length>0){for(const z of C)if(T=c[z](),T)break}return T})()?o.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:o.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let C=n;C<w&&t.length>0;C++){const T=t.shift();if(T.cancelled){C--;continue}const z=d(T);n++,T.innerRequest=z}},x=(w,C)=>{const T=new Image,z=w.url;let V=!1;const j=w.credentials;return j&&j==="include"?T.crossOrigin="use-credentials":(j&&j==="same-origin"||!o.s(z))&&(T.crossOrigin="anonymous"),T.fetchPriority="high",T.onload=()=>{C(null,T),T.onerror=T.onload=null},T.onerror=()=>{V||C(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),T.onerror=T.onload=null},T.src=z,{cancel:()=>{V=!0,T.src=""}}}}(De||(De={})),De.resetRequestQueue(),function(u){u.Glyphs="Glyphs",u.Image="Image",u.Source="Source",u.SpriteImage="SpriteImage",u.SpriteJSON="SpriteJSON",u.Style="Style",u.Tile="Tile",u.Unknown="Unknown"}(Ne||(Ne={}));class Qe{constructor(t){this._transformRequestFn=t}transformRequest(t,n){return this._transformRequestFn&&this._transformRequestFn(t,n)||{url:t}}normalizeSpriteURL(t,n,a){const c=function(d){const m=d.match(qe);if(!m)throw new Error(`Unable to parse URL "${d}"`);return{protocol:m[1],authority:m[2],path:m[3]||"/",params:m[4]?m[4].split("&"):[]}}(t);return c.path+=`${n}${a}`,function(d){const m=d.params.length?`?${d.params.join("&")}`:"";return`${d.protocol}://${d.authority}${d.path}${m}`}(c)}setTransformRequest(t){this._transformRequestFn=t}}const qe=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Oe(u){var t=new o.A(3);return t[0]=u[0],t[1]=u[1],t[2]=u[2],t}var Te,at=function(u,t,n){return u[0]=t[0]-n[0],u[1]=t[1]-n[1],u[2]=t[2]-n[2],u};Te=new o.A(3),o.A!=Float32Array&&(Te[0]=0,Te[1]=0,Te[2]=0);var tt=function(u){var t=u[0],n=u[1];return t*t+n*n};function He(u){const t=[];if(typeof u=="string")t.push({id:"default",url:u});else if(u&&u.length>0){const n=[];for(const{id:a,url:c}of u){const d=`${a}${c}`;n.indexOf(d)===-1&&(n.push(d),t.push({id:a,url:c}))}}return t}function ot(u,t,n,a,c){if(a)return void u(a);if(c!==Object.values(t).length||c!==Object.values(n).length)return;const d={};for(const m in t){d[m]={};const g=o.h.getImageCanvasContext(n[m]),x=t[m];for(const w in x){const{width:C,height:T,x:z,y:V,sdf:j,pixelRatio:Z,stretchX:N,stretchY:te,content:le}=x[w];d[m][w]={data:null,pixelRatio:Z,sdf:j,stretchX:N,stretchY:te,content:le,spriteData:{width:C,height:T,x:z,y:V,context:g}}}}u(null,d)}(function(){var u=new o.A(2);o.A!=Float32Array&&(u[0]=0,u[1]=0)})();class Fe{constructor(t,n,a,c){this.context=t,this.format=a,this.texture=t.gl.createTexture(),this.update(n,c)}update(t,n,a){const{width:c,height:d}=t,m=!(this.size&&this.size[0]===c&&this.size[1]===d||a),{context:g}=this,{gl:x}=g;if(this.useMipmap=!!(n&&n.useMipmap),x.bindTexture(x.TEXTURE_2D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!n||n.premultiply!==!1)),m)this.size=[c,d],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||o.a(t)?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,t):x.texImage2D(x.TEXTURE_2D,0,this.format,c,d,0,this.format,x.UNSIGNED_BYTE,t.data);else{const{x:w,y:C}=a||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||o.a(t)?x.texSubImage2D(x.TEXTURE_2D,0,w,C,x.RGBA,x.UNSIGNED_BYTE,t):x.texSubImage2D(x.TEXTURE_2D,0,w,C,c,d,x.RGBA,x.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&x.generateMipmap(x.TEXTURE_2D)}bind(t,n,a){const{context:c}=this,{gl:d}=c;d.bindTexture(d.TEXTURE_2D,this.texture),a!==d.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(a=d.LINEAR),t!==this.filter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,t),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,a||t),this.filter=t),n!==this.wrap&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,n),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function ht(u){const{userImage:t}=u;return!!(t&&t.render&&t.render())&&(u.data.replace(new Uint8Array(t.data.buffer)),!0)}class zt extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:n,callback:a}of this.requestors)this._notify(n,a);this.requestors=[]}}getImage(t){const n=this.images[t];if(n&&!n.data&&n.spriteData){const a=n.spriteData;n.data=new o.R({width:a.width,height:a.height},a.context.getImageData(a.x,a.y,a.width,a.height).data),n.spriteData=null}return n}addImage(t,n){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,n)&&(this.images[t]=n)}_validate(t,n){let a=!0;const c=n.data||n.spriteData;return this._validateStretch(n.stretchX,c&&c.width)||(this.fire(new o.j(new Error(`Image "${t}" has invalid "stretchX" value`))),a=!1),this._validateStretch(n.stretchY,c&&c.height)||(this.fire(new o.j(new Error(`Image "${t}" has invalid "stretchY" value`))),a=!1),this._validateContent(n.content,n)||(this.fire(new o.j(new Error(`Image "${t}" has invalid "content" value`))),a=!1),a}_validateStretch(t,n){if(!t)return!0;let a=0;for(const c of t){if(c[0]<a||c[1]<c[0]||n<c[1])return!1;a=c[1]}return!0}_validateContent(t,n){if(!t)return!0;if(t.length!==4)return!1;const a=n.spriteData,c=a&&a.width||n.data.width,d=a&&a.height||n.data.height;return!(t[0]<0||c<t[0]||t[1]<0||d<t[1]||t[2]<0||c<t[2]||t[3]<0||d<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,n,a=!0){const c=this.getImage(t);if(a&&(c.data.width!==n.data.width||c.data.height!==n.data.height))throw new Error(`size mismatch between old image (${c.data.width}x${c.data.height}) and new image (${n.data.width}x${n.data.height}).`);n.version=c.version+1,this.images[t]=n,this.updatedImages[t]=!0}removeImage(t){const n=this.images[t];delete this.images[t],delete this.patterns[t],n.userImage&&n.userImage.onRemove&&n.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,n){let a=!0;if(!this.isLoaded())for(const c of t)this.images[c]||(a=!1);this.isLoaded()||a?this._notify(t,n):this.requestors.push({ids:t,callback:n})}_notify(t,n){const a={};for(const c of t){let d=this.getImage(c);d||(this.fire(new o.k("styleimagemissing",{id:c})),d=this.getImage(c)),d?a[c]={data:d.data.clone(),pixelRatio:d.pixelRatio,sdf:d.sdf,version:d.version,stretchX:d.stretchX,stretchY:d.stretchY,content:d.content,hasRenderCallback:!!(d.userImage&&d.userImage.render)}:o.w(`Image "${c}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}n(null,a)}getPixelSize(){const{width:t,height:n}=this.atlasImage;return{width:t,height:n}}getPattern(t){const n=this.patterns[t],a=this.getImage(t);if(!a)return null;if(n&&n.position.version===a.version)return n.position;if(n)n.position.version=a.version;else{const c={w:a.data.width+2,h:a.data.height+2,x:0,y:0},d=new o.I(c,a);this.patterns[t]={bin:c,position:d}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const n=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Fe(t,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const d in this.patterns)t.push(this.patterns[d].bin);const{w:n,h:a}=o.p(t),c=this.atlasImage;c.resize({width:n||1,height:a||1});for(const d in this.patterns){const{bin:m}=this.patterns[d],g=m.x+1,x=m.y+1,w=this.getImage(d).data,C=w.width,T=w.height;o.R.copy(w,c,{x:0,y:0},{x:g,y:x},{width:C,height:T}),o.R.copy(w,c,{x:0,y:T-1},{x:g,y:x-1},{width:C,height:1}),o.R.copy(w,c,{x:0,y:0},{x:g,y:x+T},{width:C,height:1}),o.R.copy(w,c,{x:C-1,y:0},{x:g-1,y:x},{width:1,height:T}),o.R.copy(w,c,{x:0,y:0},{x:g+C,y:x},{width:1,height:T})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const n of t){if(this.callbackDispatchedThisFrame[n])continue;this.callbackDispatchedThisFrame[n]=!0;const a=this.getImage(n);a||o.w(`Image with ID: "${n}" was not found`),ht(a)&&this.updateImage(n,a)}}}const Lt=1e20;function xt(u,t,n,a,c,d,m,g,x){for(let w=t;w<t+a;w++)Et(u,n*d+w,d,c,m,g,x);for(let w=n;w<n+c;w++)Et(u,w*d+t,1,a,m,g,x)}function Et(u,t,n,a,c,d,m){d[0]=0,m[0]=-Lt,m[1]=Lt,c[0]=u[t];for(let g=1,x=0,w=0;g<a;g++){c[g]=u[t+g*n];const C=g*g;do{const T=d[x];w=(c[g]-c[T]+C-T*T)/(g-T)/2}while(w<=m[x]&&--x>-1);x++,d[x]=g,m[x]=w,m[x+1]=Lt}for(let g=0,x=0;g<a;g++){for(;m[x+1]<g;)x++;const w=d[x],C=g-w;u[t+g*n]=c[w]+C*C}}class Bt{constructor(t,n){this.requestManager=t,this.localIdeographFontFamily=n,this.entries={}}setURL(t){this.url=t}getGlyphs(t,n){const a=[];for(const c in t)for(const d of t[c])a.push({stack:c,id:d});o.o(a,({stack:c,id:d},m)=>{let g=this.entries[c];g||(g=this.entries[c]={glyphs:{},requests:{},ranges:{}});let x=g.glyphs[d];if(x!==void 0)return void m(null,{stack:c,id:d,glyph:x});if(x=this._tinySDF(g,c,d),x)return g.glyphs[d]=x,void m(null,{stack:c,id:d,glyph:x});const w=Math.floor(d/256);if(256*w>65535)return void m(new Error("glyphs > 65535 not supported"));if(g.ranges[w])return void m(null,{stack:c,id:d,glyph:x});if(!this.url)return void m(new Error("glyphsUrl is not set"));let C=g.requests[w];C||(C=g.requests[w]=[],Bt.loadGlyphRange(c,w,this.url,this.requestManager,(T,z)=>{if(z){for(const V in z)this._doesCharSupportLocalGlyph(+V)||(g.glyphs[+V]=z[+V]);g.ranges[w]=!0}for(const V of C)V(T,z);delete g.requests[w]})),C.push((T,z)=>{T?m(T):z&&m(null,{stack:c,id:d,glyph:z[d]||null})})},(c,d)=>{if(c)n(c);else if(d){const m={};for(const{stack:g,id:x,glyph:w}of d)(m[g]||(m[g]={}))[x]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics};n(null,m)}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(o.u["CJK Unified Ideographs"](t)||o.u["Hangul Syllables"](t)||o.u.Hiragana(t)||o.u.Katakana(t))}_tinySDF(t,n,a){const c=this.localIdeographFontFamily;if(!c||!this._doesCharSupportLocalGlyph(a))return;let d=t.tinySDF;if(!d){let g="400";/bold/i.test(n)?g="900":/medium/i.test(n)?g="500":/light/i.test(n)&&(g="200"),d=t.tinySDF=new Bt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:c,fontWeight:g})}const m=d.draw(String.fromCharCode(a));return{id:a,bitmap:new o.q({width:m.width||60,height:m.height||60},m.data),metrics:{width:m.glyphWidth/2||24,height:m.glyphHeight/2||24,left:m.glyphLeft/2+.5||0,top:m.glyphTop/2-27.5||-8,advance:m.glyphAdvance/2||24,isDoubleResolution:!0}}}}Bt.loadGlyphRange=function(u,t,n,a,c){const d=256*t,m=d+255,g=a.transformRequest(n.replace("{fontstack}",u).replace("{range}",`${d}-${m}`),Ne.Glyphs);o.l(g,(x,w)=>{if(x)c(x);else if(w){const C={};for(const T of o.n(w))C[T.id]=T;c(null,C)}})},Bt.TinySDF=class{constructor({fontSize:u=24,buffer:t=3,radius:n=8,cutoff:a=.25,fontFamily:c="sans-serif",fontWeight:d="normal",fontStyle:m="normal"}={}){this.buffer=t,this.cutoff=a,this.radius=n;const g=this.size=u+4*t,x=this._createCanvas(g),w=this.ctx=x.getContext("2d",{willReadFrequently:!0});w.font=`${m} ${d} ${u}px ${c}`,w.textBaseline="alphabetic",w.textAlign="left",w.fillStyle="black",this.gridOuter=new Float64Array(g*g),this.gridInner=new Float64Array(g*g),this.f=new Float64Array(g),this.z=new Float64Array(g+1),this.v=new Uint16Array(g)}_createCanvas(u){const t=document.createElement("canvas");return t.width=t.height=u,t}draw(u){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:a,actualBoundingBoxLeft:c,actualBoundingBoxRight:d}=this.ctx.measureText(u),m=Math.ceil(n),g=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(d-c))),x=Math.min(this.size-this.buffer,m+Math.ceil(a)),w=g+2*this.buffer,C=x+2*this.buffer,T=Math.max(w*C,0),z=new Uint8ClampedArray(T),V={data:z,width:w,height:C,glyphWidth:g,glyphHeight:x,glyphTop:m,glyphLeft:0,glyphAdvance:t};if(g===0||x===0)return V;const{ctx:j,buffer:Z,gridInner:N,gridOuter:te}=this;j.clearRect(Z,Z,g,x),j.fillText(u,Z,Z+m);const le=j.getImageData(Z,Z,g,x);te.fill(Lt,0,T),N.fill(0,0,T);for(let K=0;K<x;K++)for(let re=0;re<g;re++){const he=le.data[4*(K*g+re)+3]/255;if(he===0)continue;const pe=(K+Z)*w+re+Z;if(he===1)te[pe]=0,N[pe]=Lt;else{const xe=.5-he;te[pe]=xe>0?xe*xe:0,N[pe]=xe<0?xe*xe:0}}xt(te,0,0,w,C,w,this.f,this.v,this.z),xt(N,Z,Z,g,x,w,this.f,this.v,this.z);for(let K=0;K<T;K++){const re=Math.sqrt(te[K])-Math.sqrt(N[K]);z[K]=Math.round(255-255*(re/this.radius+this.cutoff))}return V}};class ft{constructor(){this.specification=o.v.light.position}possiblyEvaluate(t,n){return o.z(t.expression.evaluate(n))}interpolate(t,n,a){return{x:o.B.number(t.x,n.x,a),y:o.B.number(t.y,n.y,a),z:o.B.number(t.z,n.z,a)}}}let ni;class Ai extends o.E{constructor(t){super(),ni=ni||new o.r({anchor:new o.D(o.v.light.anchor),position:new ft,color:new o.D(o.v.light.color),intensity:new o.D(o.v.light.intensity)}),this._transitionable=new o.T(ni),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,n={}){if(!this._validate(o.t,t,n))for(const a in t){const c=t[a];a.endsWith("-transition")?this._transitionable.setTransition(a.slice(0,-11),c):this._transitionable.setValue(a,c)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,a){return(!a||a.validate!==!1)&&o.x(this,t.call(o.y,o.e({value:n,style:{glyphs:!0,sprite:!0},styleSpec:o.v})))}}class Xi{constructor(t,n){this.width=t,this.height=n,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,n){const a=t.join(",")+String(n);return this.dashEntry[a]||(this.dashEntry[a]=this.addDash(t,n)),this.dashEntry[a]}getDashRanges(t,n,a){const c=[];let d=t.length%2==1?-t[t.length-1]*a:0,m=t[0]*a,g=!0;c.push({left:d,right:m,isDash:g,zeroLength:t[0]===0});let x=t[0];for(let w=1;w<t.length;w++){g=!g;const C=t[w];d=x*a,x+=C,m=x*a,c.push({left:d,right:m,isDash:g,zeroLength:C===0})}return c}addRoundDash(t,n,a){const c=n/2;for(let d=-a;d<=a;d++){const m=this.width*(this.nextRow+a+d);let g=0,x=t[g];for(let w=0;w<this.width;w++){w/x.right>1&&(x=t[++g]);const C=Math.abs(w-x.left),T=Math.abs(w-x.right),z=Math.min(C,T);let V;const j=d/a*(c+1);if(x.isDash){const Z=c-Math.abs(j);V=Math.sqrt(z*z+Z*Z)}else V=c-Math.sqrt(z*z+j*j);this.data[m+w]=Math.max(0,Math.min(255,V+128))}}}addRegularDash(t){for(let g=t.length-1;g>=0;--g){const x=t[g],w=t[g+1];x.zeroLength?t.splice(g,1):w&&w.isDash===x.isDash&&(w.left=x.left,t.splice(g,1))}const n=t[0],a=t[t.length-1];n.isDash===a.isDash&&(n.left=a.left-this.width,a.right=n.right+this.width);const c=this.width*this.nextRow;let d=0,m=t[d];for(let g=0;g<this.width;g++){g/m.right>1&&(m=t[++d]);const x=Math.abs(g-m.left),w=Math.abs(g-m.right),C=Math.min(x,w);this.data[c+g]=Math.max(0,Math.min(255,(m.isDash?C:-C)+128))}}addDash(t,n){const a=n?7:0,c=2*a+1;if(this.nextRow+c>this.height)return o.w("LineAtlas out of space"),null;let d=0;for(let g=0;g<t.length;g++)d+=t[g];if(d!==0){const g=this.width/d,x=this.getDashRanges(t,this.width,g);n?this.addRoundDash(x,g,a):this.addRegularDash(x)}const m={y:(this.nextRow+a+.5)/this.height,height:2*a/this.height,width:d};return this.nextRow+=c,this.dirty=!0,m}bind(t){const n=t.gl;this.texture?(n.bindTexture(n.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,n.texSubImage2D(n.TEXTURE_2D,0,0,0,this.width,this.height,n.ALPHA,n.UNSIGNED_BYTE,this.data))):(this.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texImage2D(n.TEXTURE_2D,0,n.ALPHA,this.width,this.height,0,n.ALPHA,n.UNSIGNED_BYTE,this.data))}}class si{constructor(t,n,a){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=a;const c=this.workerPool.acquire(a);for(let d=0;d<c.length;d++){const m=new o.C(c[d],n,a);m.name=`Worker ${d}`,this.actors.push(m)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,n,a){o.o(this.actors,(c,d)=>{c.send(t,n,d)},a=a||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(n=>{n.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}}function Xt(u,t,n){const a=function(c,d){if(c)return n(c);if(d){const m=o.F(o.e(d,u),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);d.vector_layers&&(m.vectorLayers=d.vector_layers,m.vectorLayerIds=m.vectorLayers.map(g=>g.id)),n(null,m)}};return u.url?o.f(t.transformRequest(u.url,Ne.Source),a):o.h.frame(()=>a(null,u))}class Ue{constructor(t,n){t&&(n?this.setSouthWest(t).setNorthEast(n):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof o.L?new o.L(t.lng,t.lat):o.L.convert(t),this}setSouthWest(t){return this._sw=t instanceof o.L?new o.L(t.lng,t.lat):o.L.convert(t),this}extend(t){const n=this._sw,a=this._ne;let c,d;if(t instanceof o.L)c=t,d=t;else{if(!(t instanceof Ue))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Ue.convert(t)):this.extend(o.L.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(o.L.convert(t)):this;if(c=t._sw,d=t._ne,!c||!d)return this}return n||a?(n.lng=Math.min(c.lng,n.lng),n.lat=Math.min(c.lat,n.lat),a.lng=Math.max(d.lng,a.lng),a.lat=Math.max(d.lat,a.lat)):(this._sw=new o.L(c.lng,c.lat),this._ne=new o.L(d.lng,d.lat)),this}getCenter(){return new o.L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new o.L(this.getWest(),this.getNorth())}getSouthEast(){return new o.L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:n,lat:a}=o.L.convert(t);let c=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&c}static convert(t){return t instanceof Ue?t:t&&new Ue(t)}static fromLngLat(t,n=0){const a=360*n/40075017,c=a/Math.cos(Math.PI/180*t.lat);return new Ue(new o.L(t.lng-c,t.lat-a),new o.L(t.lng+c,t.lat+a))}}class _t{constructor(t,n,a){this.bounds=Ue.convert(this.validateBounds(t)),this.minzoom=n||0,this.maxzoom=a||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const n=Math.pow(2,t.z),a=Math.floor(o.G(this.bounds.getWest())*n),c=Math.floor(o.H(this.bounds.getNorth())*n),d=Math.ceil(o.G(this.bounds.getEast())*n),m=Math.ceil(o.H(this.bounds.getSouth())*n);return t.x>=a&&t.x<d&&t.y>=c&&t.y<m}}class Kt extends o.E{constructor(t,n,a,c){if(super(),this.load=()=>{this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Xt(this._options,this.map._requestManager,(d,m)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),d?this.fire(new o.j(d)):m&&(o.e(this,m),m.bounds&&(this.tileBounds=new _t(m.bounds,this.minzoom,this.maxzoom)),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>o.e({},this._options),this.id=t,this.dispatcher=a,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.e(this,o.F(n,["url","scheme","tileSize","promoteId"])),this._options=o.e({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(c)}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(t,n){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c={request:this.map._requestManager.transformRequest(a,Ne.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function d(m,g){return delete t.request,t.aborted?n(null):m&&m.status!==404?n(m):(g&&g.resourceTiming&&(t.resourceTiming=g.resourceTiming),this.map._refreshExpiredTiles&&g&&t.setExpiryData(g),t.loadVectorData(g,this.map.painter),n(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}c.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired"?t.state==="loading"?t.reloadCallback=n:t.request=t.actor.send("reloadTile",c,d.bind(this)):(t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",c,d.bind(this)))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Mt extends o.E{constructor(t,n,a,c){super(),this.id=t,this.dispatcher=a,this.setEventedParent(c),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.e({type:"raster"},n),o.e(this,o.F(n,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Xt(this._options,this.map._requestManager,(t,n)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new o.j(t)):n&&(o.e(this,n),n.bounds&&(this.tileBounds=new _t(n.bounds,this.minzoom,this.maxzoom)),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}serialize(){return o.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,n){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.request=De.getImage(this.map._requestManager.transformRequest(a,Ne.Tile),(c,d,m)=>{if(delete t.request,t.aborted)t.state="unloaded",n(null);else if(c)t.state="errored",n(c);else if(d){this.map._refreshExpiredTiles&&m&&t.setExpiryData(m);const g=this.map.painter.context,x=g.gl;t.texture=this.map.painter.getTileTexture(d.width),t.texture?t.texture.update(d,{useMipmap:!0}):(t.texture=new Fe(g,d,x.RGBA,{useMipmap:!0}),t.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE,x.LINEAR_MIPMAP_NEAREST),g.extTextureFilterAnisotropic&&x.texParameterf(x.TEXTURE_2D,g.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,g.extTextureFilterAnisotropicMax)),t.state="loaded",n(null)}},this.map._refreshExpiredTiles)}abortTile(t,n){t.request&&(t.request.cancel(),delete t.request),n()}unloadTile(t,n){t.texture&&this.map.painter.saveTileTexture(t.texture),n()}hasTransition(){return!1}}class Yt extends Mt{constructor(t,n,a,c){super(t,n,a,c),this.type="raster-dem",this.maxzoom=22,this._options=o.e({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox",this.redFactor=n.redFactor,this.greenFactor=n.greenFactor,this.blueFactor=n.blueFactor,this.baseShift=n.baseShift}loadTile(t,n){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c=this.map._requestManager.transformRequest(a,Ne.Tile);function d(m,g){m&&(t.state="errored",n(m)),g&&(t.dem=g,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded",n(null))}t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.request=De.getImage(c,(m,g,x)=>o._(this,void 0,void 0,function*(){if(delete t.request,t.aborted)t.state="unloaded",n(null);else if(m)t.state="errored",n(m);else if(g){this.map._refreshExpiredTiles&&t.setExpiryData(x);const w=o.a(g)&&o.J()?g:yield function(T){return o._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&o.K()){const z=T.width+2,V=T.height+2;try{return new o.R({width:z,height:V},yield o.M(T,-1,-1,z,V))}catch{}}return o.h.getImageData(T,1)})}(g),C={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:w,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};t.actor&&t.state!=="expired"||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",C,d))}}),this.map._refreshExpiredTiles)}_getNeighboringTiles(t){const n=t.canonical,a=Math.pow(2,n.z),c=(n.x-1+a)%a,d=n.x===0?t.wrap-1:t.wrap,m=(n.x+1+a)%a,g=n.x+1===a?t.wrap+1:t.wrap,x={};return x[new o.O(t.overscaledZ,d,n.z,c,n.y).key]={backfilled:!1},x[new o.O(t.overscaledZ,g,n.z,m,n.y).key]={backfilled:!1},n.y>0&&(x[new o.O(t.overscaledZ,d,n.z,c,n.y-1).key]={backfilled:!1},x[new o.O(t.overscaledZ,t.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},x[new o.O(t.overscaledZ,g,n.z,m,n.y-1).key]={backfilled:!1}),n.y+1<a&&(x[new o.O(t.overscaledZ,d,n.z,c,n.y+1).key]={backfilled:!1},x[new o.O(t.overscaledZ,t.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},x[new o.O(t.overscaledZ,g,n.z,m,n.y+1).key]={backfilled:!1}),x}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})}}class gi extends o.E{constructor(t,n,a,c){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>o.e({},this._options,{type:this.type,data:this._data}),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=a.getActor(),this.setEventedParent(c),this._data=n.data,this._options=o.e({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const d=o.N/this.tileSize;this.workerOptions=o.e({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*d,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*d,extent:o.N,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:o.N,radius:(n.clusterRadius||50)*d,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=t.clusterRadius),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=t.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(t,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},n),this}getClusterChildren(t,n){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},n),this}getClusterLeaves(t,n,a,c){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:n,offset:a},c),this}_updateWorkerData(t){const n=o.e({},this.workerOptions);t?n.dataDiff=t:typeof this._data=="string"?(n.request=this.map._requestManager.transformRequest(o.h.resolveURL(this._data),Ne.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new o.k("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,n,(a,c)=>{if(this._pendingLoads--,this._removed||c&&c.abandoned)return void this.fire(new o.k("dataabort",{dataType:"source"}));let d=null;if(c&&c.resourceTiming&&c.resourceTiming[this.id]&&(d=c.resourceTiming[this.id].slice(0)),a)return void this.fire(new o.j(a));const m={dataType:"source"};this._collectResourceTiming&&d&&d.length>0&&o.e(m,{resourceTiming:d}),this.fire(new o.k("data",Object.assign(Object.assign({},m),{sourceDataType:"metadata"}))),this.fire(new o.k("data",Object.assign(Object.assign({},m),{sourceDataType:"content"})))})}loaded(){return this._pendingLoads===0}loadTile(t,n){const a=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const c={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.request=this.actor.send(a,c,(d,m)=>(delete t.request,t.unloadVectorData(),t.aborted?n(null):d?n(d):(t.loadVectorData(m,this.map.painter,a==="reloadTile"),n(null))))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var Jt=o.Q([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Rt extends o.E{constructor(t,n,a,c){super(),this.load=(d,m)=>{this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=De.getImage(this.map._requestManager.transformRequest(this.url,Ne.Image),(g,x)=>{this._request=null,this._loaded=!0,g?this.fire(new o.j(g)):x&&(this.image=x,d&&(this.coordinates=d),m&&m(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;const d=this.map.painter.context,m=d.gl;this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,Jt.members)),this.boundsSegments||(this.boundsSegments=o.S.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Fe(d,this.image,m.RGBA),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE));let g=!1;for(const x in this.tiles){const w=this.tiles[x];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,g=!0)}g&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=t,this.dispatcher=a,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(c),this.options=n}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(t){this.coordinates=t;const n=t.map(o.U.fromLngLat);this.tileID=function(c){let d=1/0,m=1/0,g=-1/0,x=-1/0;for(const z of c)d=Math.min(d,z.x),m=Math.min(m,z.y),g=Math.max(g,z.x),x=Math.max(x,z.y);const w=Math.max(g-d,x-m),C=Math.max(0,Math.floor(-Math.log(w)/Math.LN2)),T=Math.pow(2,C);return new o.W(C,Math.floor((d+g)/2*T),Math.floor((m+x)/2*T))}(n),this.minzoom=this.maxzoom=this.tileID.z;const a=n.map(c=>this.tileID.getTilePoint(c)._round());return this._boundsArray=new o.V,this._boundsArray.emplaceBack(a[0].x,a[0].y,0,0),this._boundsArray.emplaceBack(a[1].x,a[1].y,o.N,0),this._boundsArray.emplaceBack(a[3].x,a[3].y,0,o.N),this._boundsArray.emplaceBack(a[2].x,a[2].y,o.N,o.N),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(t,n){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},n(null)):(t.state="errored",n(null))}hasTransition(){return!1}}class Pi extends Rt{constructor(t,n,a,c){super(t,n,a,c),this.load=()=>{this._loaded=!1;const d=this.options;this.urls=[];for(const m of d.urls)this.urls.push(this.map._requestManager.transformRequest(m,Ne.Source).url);o.X(this.urls,(m,g)=>{this._loaded=!0,m?this.fire(new o.j(m)):g&&(this.video=g,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const d=this.map.painter.context,m=d.gl;this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,Jt.members)),this.boundsSegments||(this.boundsSegments=o.S.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE),m.texSubImage2D(m.TEXTURE_2D,0,0,0,m.RGBA,m.UNSIGNED_BYTE,this.video)):(this.texture=new Fe(d,this.video,m.RGBA),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE));let g=!1;for(const x in this.tiles){const w=this.tiles[x];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,g=!0)}g&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=n}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const n=this.video.seekable;t<n.start(0)||t>n.end(0)?this.fire(new o.j(new o.Y(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class bi extends Rt{constructor(t,n,a,c){super(t,n,a,c),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const m=this.map.painter.context,g=m.gl;this.boundsBuffer||(this.boundsBuffer=m.createVertexBuffer(this._boundsArray,Jt.members)),this.boundsSegments||(this.boundsSegments=o.S.simpleSegment(0,0,4,2)),this.texture?(d||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Fe(m,this.canvas,g.RGBA,{premultiply:!0});let x=!1;for(const w in this.tiles){const C=this.tiles[w];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture,x=!0)}x&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(d=>!Array.isArray(d)||d.length!==2||d.some(m=>typeof m!="number"))||this.fire(new o.j(new o.Y(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.j(new o.Y(`sources.${t}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new o.j(new o.Y(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new o.j(new o.Y(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.j(new o.Y(`sources.${t}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const Wt={},Ti=u=>{switch(u){case"geojson":return gi;case"image":return Rt;case"raster":return Mt;case"raster-dem":return Yt;case"vector":return Kt;case"video":return Pi;case"canvas":return bi}return Wt[u]};function rr(u,t){const n=o.Z();return o.$(n,n,[1,1,0]),o.a0(n,n,[.5*u.width,.5*u.height,1]),o.a1(n,n,u.calculatePosMatrix(t.toUnwrapped()))}function pr(u,t,n,a,c,d){const m=function(T,z,V){if(T)for(const j of T){const Z=z[j];if(Z&&Z.source===V&&Z.type==="fill-extrusion")return!0}else for(const j in z){const Z=z[j];if(Z.source===V&&Z.type==="fill-extrusion")return!0}return!1}(c&&c.layers,t,u.id),g=d.maxPitchScaleFactor(),x=u.tilesIn(a,g,m);x.sort(nr);const w=[];for(const T of x)w.push({wrappedTileID:T.tileID.wrapped().key,queryResults:T.tile.queryRenderedFeatures(t,n,u._state,T.queryGeometry,T.cameraQueryGeometry,T.scale,c,d,g,rr(u.transform,T.tileID))});const C=function(T){const z={},V={};for(const j of T){const Z=j.queryResults,N=j.wrappedTileID,te=V[N]=V[N]||{};for(const le in Z){const K=Z[le],re=te[le]=te[le]||{},he=z[le]=z[le]||[];for(const pe of K)re[pe.featureIndex]||(re[pe.featureIndex]=!0,he.push(pe))}}return z}(w);for(const T in C)C[T].forEach(z=>{const V=z.feature,j=u.getFeatureState(V.layer["source-layer"],V.id);V.source=V.layer.source,V.layer["source-layer"]&&(V.sourceLayer=V.layer["source-layer"]),V.state=j});return C}function nr(u,t){const n=u.tileID,a=t.tileID;return n.overscaledZ-a.overscaledZ||n.canonical.y-a.canonical.y||n.wrap-a.wrap||n.canonical.x-a.canonical.x}class fr{constructor(t,n){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=o.a2(),this.uses=0,this.tileSize=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const n=t+this.timeAdded;n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,n,a){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(c,d){const m={};if(!d)return m;for(const g of c){const x=g.layerIds.map(w=>d.getLayer(w)).filter(Boolean);if(x.length!==0){g.layers=x,g.stateDependentLayerIds&&(g.stateDependentLayers=g.stateDependentLayerIds.map(w=>x.filter(C=>C.id===w)[0]));for(const w of x)m[w.id]=g}}return m}(t.buckets,n.style),this.hasSymbolBuckets=!1;for(const c in this.buckets){const d=this.buckets[c];if(d instanceof o.a4){if(this.hasSymbolBuckets=!0,!a)break;d.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const c in this.buckets){const d=this.buckets[c];if(d instanceof o.a4&&d.hasRTLText){this.hasRTLText=!0,o.a5();break}}this.queryPadding=0;for(const c in this.buckets){const d=this.buckets[c];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(c).queryRadius(d))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new o.a3}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const a in this.buckets){const c=this.buckets[a];c.uploadPending()&&c.upload(t)}const n=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Fe(t,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Fe(t,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,n,a,c,d,m,g,x,w,C){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:c,cameraQueryGeometry:d,scale:m,tileSize:this.tileSize,pixelPosMatrix:C,transform:x,params:g,queryPadding:this.queryPadding*w},t,n,a):{}}querySourceFeatures(t,n){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const c=a.loadVTLayers(),d=n&&n.sourceLayer?n.sourceLayer:"",m=c._geojsonTileLayer||c[d];if(!m)return;const g=o.a6(n&&n.filter),{z:x,x:w,y:C}=this.tileID.canonical,T={z:x,x:w,y:C};for(let z=0;z<m.length;z++){const V=m.feature(z);if(g.needGeometry){const N=o.a7(V,!0);if(!g.filter(new o.a8(this.tileID.overscaledZ),N,this.tileID.canonical))continue}else if(!g.filter(new o.a8(this.tileID.overscaledZ),V))continue;const j=a.getId(V,d),Z=new o.a9(V,x,w,C,j);Z.tile=T,t.push(Z)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const n=this.expirationTime;if(t.cacheControl){const a=o.aa(t.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const a=Date.now();let c=!1;if(this.expirationTime>a)c=!1;else if(n)if(this.expirationTime<n)c=!0;else{const d=this.expirationTime-n;d?this.expirationTime=a+Math.max(d,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const a=this.latestFeatureIndex.loadVTLayers();for(const c in this.buckets){if(!n.style.hasLayer(c))continue;const d=this.buckets[c],m=d.layers[0].sourceLayer||"_geojsonTileLayer",g=a[m],x=t[m];if(!g||!x||Object.keys(x).length===0)continue;d.update(x,g,this.imageAtlas&&this.imageAtlas.patternPositions||{});const w=n&&n.style&&n.style.getLayer(c);w&&(this.queryPadding=Math.max(this.queryPadding,w.queryRadius(d)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.h.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=o.h.now()+t}setDependencies(t,n){const a={};for(const c of n)a[c]=!0;this.dependencies[t]=a}hasDependency(t,n){for(const a of t){const c=this.dependencies[a];if(c){for(const d of n)if(c[d])return!0}}return!1}}class Sr{constructor(t,n){this.max=t,this.onRemove=n,this.reset()}reset(){for(const t in this.data)for(const n of this.data[t])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(t,n,a){const c=t.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);const d={value:n,timeout:void 0};if(a!==void 0&&(d.timeout=setTimeout(()=>{this.remove(t,d)},a)),this.data[c].push(d),this.order.push(c),this.order.length>this.max){const m=this._getAndRemoveByKey(this.order[0]);m&&this.onRemove(m)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const n=this.data[t].shift();return n.timeout&&clearTimeout(n.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),n.value}getByKey(t){const n=this.data[t];return n?n[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,n){if(!this.has(t))return this;const a=t.wrapped().key,c=n===void 0?0:this.data[a].indexOf(n),d=this.data[a][c];return this.data[a].splice(c,1),d.timeout&&clearTimeout(d.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(d.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(t){const n=[];for(const a in this.data)for(const c of this.data[a])t(c.value)||n.push(c);for(const a of n)this.remove(a.value.tileID,a)}}class fe{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,n,a){const c=String(n);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][c]=this.stateChanges[t][c]||{},o.e(this.stateChanges[t][c],a),this.deletedStates[t]===null){this.deletedStates[t]={};for(const d in this.state[t])d!==c&&(this.deletedStates[t][d]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][c]===null){this.deletedStates[t][c]={};for(const d in this.state[t][c])a[d]||(this.deletedStates[t][c][d]=null)}else for(const d in a)this.deletedStates[t]&&this.deletedStates[t][c]&&this.deletedStates[t][c][d]===null&&delete this.deletedStates[t][c][d]}removeFeatureState(t,n,a){if(this.deletedStates[t]===null)return;const c=String(n);if(this.deletedStates[t]=this.deletedStates[t]||{},a&&n!==void 0)this.deletedStates[t][c]!==null&&(this.deletedStates[t][c]=this.deletedStates[t][c]||{},this.deletedStates[t][c][a]=null);else if(n!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][c])for(a in this.deletedStates[t][c]={},this.stateChanges[t][c])this.deletedStates[t][c][a]=null;else this.deletedStates[t][c]=null;else this.deletedStates[t]=null}getState(t,n){const a=String(n),c=o.e({},(this.state[t]||{})[a],(this.stateChanges[t]||{})[a]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const d=this.deletedStates[t][n];if(d===null)return{};for(const m in d)delete c[m]}return c}initializeTileState(t,n){t.setFeatureState(this.state,n)}coalesceChanges(t,n){const a={};for(const c in this.stateChanges){this.state[c]=this.state[c]||{};const d={};for(const m in this.stateChanges[c])this.state[c][m]||(this.state[c][m]={}),o.e(this.state[c][m],this.stateChanges[c][m]),d[m]=this.state[c][m];a[c]=d}for(const c in this.deletedStates){this.state[c]=this.state[c]||{};const d={};if(this.deletedStates[c]===null)for(const m in this.state[c])d[m]={},this.state[c][m]={};else for(const m in this.deletedStates[c]){if(this.deletedStates[c][m]===null)this.state[c][m]={};else for(const g of Object.keys(this.deletedStates[c][m]))delete this.state[c][m][g];d[m]=this.state[c][m]}a[c]=a[c]||{},o.e(a[c],d)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(const c in t)t[c].setFeatureState(a,n)}}class Ii extends o.E{constructor(t,n,a){super(),this.id=t,this.dispatcher=a,this.on("data",c=>{c.dataType==="source"&&c.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&c.dataType==="source"&&c.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((c,d,m,g)=>{const x=new(Ti(d.type))(c,d,m,g);if(x.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${x.id}`);return x})(t,n,a,this),this._tiles={},this._cache=new Sr(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new fe,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const n=this._tiles[t];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,n){return this._source.loadTile(t,n)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){this._source.abortTile&&this._source.abortTile(t,()=>{}),this._source.fire(new o.k("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const a=this._tiles[n];a.upload(t),a.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort($i).map(t=>t.key)}getRenderableIds(t){const n=[];for(const a in this._tiles)this._isIdRenderable(a,t)&&n.push(this._tiles[a]);return t?n.sort((a,c)=>{const d=a.tileID,m=c.tileID,g=new o.P(d.canonical.x,d.canonical.y)._rotate(this.transform.angle),x=new o.P(m.canonical.x,m.canonical.y)._rotate(this.transform.angle);return d.overscaledZ-m.overscaledZ||x.y-g.y||x.x-g.x}).map(a=>a.tileID.key):n.map(a=>a.tileID).sort($i).map(a=>a.key)}hasRenderableParent(t){const n=this.findLoadedParent(t,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(t,n){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(n||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,n){const a=this._tiles[t];a&&(a.state!=="loading"&&(a.state=n),this._loadTile(a,this._tileLoaded.bind(this,a,t,n)))}_tileLoaded(t,n,a,c){if(c)return t.state="errored",void(c.status!==404?this._source.fire(new o.j(c,{tile:t})):this.update(this.transform,this.terrain));t.timeAdded=o.h.now(),a==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(n,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new o.k("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const n=this.getRenderableIds();for(let c=0;c<n.length;c++){const d=n[c];if(t.neighboringTiles&&t.neighboringTiles[d]){const m=this.getTileByID(d);a(t,m),a(m,t)}}function a(c,d){c.needsHillshadePrepare=!0,c.needsTerrainPrepare=!0;let m=d.tileID.canonical.x-c.tileID.canonical.x;const g=d.tileID.canonical.y-c.tileID.canonical.y,x=Math.pow(2,c.tileID.canonical.z),w=d.tileID.key;m===0&&g===0||Math.abs(g)>1||(Math.abs(m)>1&&(Math.abs(m+x)===1?m+=x:Math.abs(m-x)===1&&(m-=x)),d.dem&&c.dem&&(c.dem.backfillBorder(d.dem,m,g),c.neighboringTiles&&c.neighboringTiles[w]&&(c.neighboringTiles[w].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,n,a,c){for(const d in this._tiles){let m=this._tiles[d];if(c[d]||!m.hasData()||m.tileID.overscaledZ<=n||m.tileID.overscaledZ>a)continue;let g=m.tileID;for(;m&&m.tileID.overscaledZ>n+1;){const w=m.tileID.scaledTo(m.tileID.overscaledZ-1);m=this._tiles[w.key],m&&m.hasData()&&(g=w)}let x=g;for(;x.overscaledZ>n;)if(x=x.scaledTo(x.overscaledZ-1),t[x.key]){c[g.key]=g;break}}}findLoadedParent(t,n){if(t.key in this._loadedParentTiles){const a=this._loadedParentTiles[t.key];return a&&a.tileID.overscaledZ>=n?a:null}for(let a=t.overscaledZ-1;a>=n;a--){const c=t.scaledTo(a),d=this._getLoadedTile(c);if(d)return d}}_getLoadedTile(t){const n=this._tiles[t.key];return n&&n.hasData()?n:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const n=Math.ceil(t.width/this._source.tileSize)+1,a=Math.ceil(t.height/this._source.tileSize)+1,c=Math.floor(n*a*(this._maxTileCacheZoomLevels===null?o.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),d=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,c):c;this._cache.setMaxSize(d)}handleWrapJump(t){const n=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,n){const a={};for(const c in this._tiles){const d=this._tiles[c];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+n),a[d.tileID.key]=d}this._tiles=a;for(const c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(const c in this._tiles)this._setTileReloadTimer(c,this._tiles[c])}}update(t,n){if(this.transform=t,this.terrain=n,!this._sourceLoaded||this._paused)return;let a;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?a=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(C=>new o.O(C.canonical.z,C.wrap,C.canonical.z,C.canonical.x,C.canonical.y)):(a=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:n}),this._source.hasTile&&(a=a.filter(C=>this._source.hasTile(C)))):a=[];const c=t.coveringZoomLevel(this._source),d=Math.max(c-Ii.maxOverzooming,this._source.minzoom),m=Math.max(c+Ii.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const C={};for(const T of a)if(T.canonical.z>this._source.minzoom){const z=T.scaledTo(T.canonical.z-1);C[z.key]=z;const V=T.scaledTo(Math.max(this._source.minzoom,Math.min(T.canonical.z,5)));C[V.key]=V}a=a.concat(Object.values(C))}const g=a.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,g&&this.fire(new o.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const x=this._updateRetainedTiles(a,c);if(jt(this._source.type)){const C={},T={},z=Object.keys(x),V=o.h.now();for(const j of z){const Z=x[j],N=this._tiles[j];if(!N||N.fadeEndTime!==0&&N.fadeEndTime<=V)continue;const te=this.findLoadedParent(Z,d);te&&(this._addTile(te.tileID),C[te.tileID.key]=te.tileID),T[j]=Z}this._retainLoadedChildren(T,c,m,x);for(const j in C)x[j]||(this._coveredTiles[j]=!0,x[j]=C[j]);if(n){const j={},Z={};for(const N of a)this._tiles[N.key].hasData()?j[N.key]=N:Z[N.key]=N;for(const N in Z){const te=Z[N].children(this._source.maxzoom);this._tiles[te[0].key]&&this._tiles[te[1].key]&&this._tiles[te[2].key]&&this._tiles[te[3].key]&&(j[te[0].key]=x[te[0].key]=te[0],j[te[1].key]=x[te[1].key]=te[1],j[te[2].key]=x[te[2].key]=te[2],j[te[3].key]=x[te[3].key]=te[3],delete Z[N])}for(const N in Z){const te=this.findLoadedParent(Z[N],this._source.minzoom);if(te){j[te.tileID.key]=x[te.tileID.key]=te.tileID;for(const le in j)j[le].isChildOf(te.tileID)&&delete j[le]}}for(const N in this._tiles)j[N]||(this._coveredTiles[N]=!0)}}for(const C in x)this._tiles[C].clearFadeHold();const w=o.ab(this._tiles,x);for(const C of w){const T=this._tiles[C];T.hasSymbolBuckets&&!T.holdingForFade()?T.setHoldDuration(this.map._fadeDuration):T.hasSymbolBuckets&&!T.symbolFadeFinished()||this._removeTile(C)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,n){const a={},c={},d=Math.max(n-Ii.maxOverzooming,this._source.minzoom),m=Math.max(n+Ii.maxUnderzooming,this._source.minzoom),g={};for(const x of t){const w=this._addTile(x);a[x.key]=x,w.hasData()||n<this._source.maxzoom&&(g[x.key]=x)}this._retainLoadedChildren(g,n,m,a);for(const x of t){let w=this._tiles[x.key];if(w.hasData())continue;if(n+1>this._source.maxzoom){const T=x.children(this._source.maxzoom)[0],z=this.getTile(T);if(z&&z.hasData()){a[T.key]=T;continue}}else{const T=x.children(this._source.maxzoom);if(a[T[0].key]&&a[T[1].key]&&a[T[2].key]&&a[T[3].key])continue}let C=w.wasRequested();for(let T=x.overscaledZ-1;T>=d;--T){const z=x.scaledTo(T);if(c[z.key])break;if(c[z.key]=!0,w=this.getTile(z),!w&&C&&(w=this._addTile(z)),w){const V=w.hasData();if((C||V)&&(a[z.key]=z),C=w.wasRequested(),V)break}}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const n=[];let a,c=this._tiles[t].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){a=this._loadedParentTiles[c.key];break}n.push(c.key);const d=c.scaledTo(c.overscaledZ-1);if(a=this._getLoadedTile(d),a)break;c=d}for(const d of n)this._loadedParentTiles[d]=a}}_addTile(t){let n=this._tiles[t.key];if(n)return n;n=this._cache.getAndRemove(t),n&&(this._setTileReloadTimer(t.key,n),n.tileID=t,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,n)));const a=n;return n||(n=new fr(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(n,this._tileLoaded.bind(this,n,t.key,n.state))),n.uses++,this._tiles[t.key]=n,a||this._source.fire(new o.k("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(t,n){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const a=n.getExpiryTimeout();a&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},a))}_removeTile(t){const n=this._tiles[t];n&&(n.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,n,a){const c=[],d=this.transform;if(!d)return c;const m=a?d.getCameraQueryGeometry(t):t,g=t.map(j=>d.pointCoordinate(j,this.terrain)),x=m.map(j=>d.pointCoordinate(j,this.terrain)),w=this.getIds();let C=1/0,T=1/0,z=-1/0,V=-1/0;for(const j of x)C=Math.min(C,j.x),T=Math.min(T,j.y),z=Math.max(z,j.x),V=Math.max(V,j.y);for(let j=0;j<w.length;j++){const Z=this._tiles[w[j]];if(Z.holdingForFade())continue;const N=Z.tileID,te=Math.pow(2,d.zoom-Z.tileID.overscaledZ),le=n*Z.queryPadding*o.N/Z.tileSize/te,K=[N.getTilePoint(new o.U(C,T)),N.getTilePoint(new o.U(z,V))];if(K[0].x-le<o.N&&K[0].y-le<o.N&&K[1].x+le>=0&&K[1].y+le>=0){const re=g.map(pe=>N.getTilePoint(pe)),he=x.map(pe=>N.getTilePoint(pe));c.push({tile:Z,tileID:N,queryGeometry:re,cameraQueryGeometry:he,scale:te})}}return c}getVisibleCoordinates(t){const n=this.getRenderableIds(t).map(a=>this._tiles[a].tileID);for(const a of n)a.posMatrix=this.transform.calculatePosMatrix(a.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(jt(this._source.type)){const t=o.h.now();for(const n in this._tiles)if(this._tiles[n].fadeEndTime>=t)return!0}return!1}setFeatureState(t,n,a){this._state.updateState(t=t||"_geojsonTileLayer",n,a)}removeFeatureState(t,n,a){this._state.removeFeatureState(t=t||"_geojsonTileLayer",n,a)}getFeatureState(t,n){return this._state.getState(t=t||"_geojsonTileLayer",n)}setDependencies(t,n,a){const c=this._tiles[t];c&&c.setDependencies(n,a)}reloadTilesForDependencies(t,n){for(const a in this._tiles)this._tiles[a].hasDependency(t,n)&&this._reloadTile(a,"reloading");this._cache.filter(a=>!a.hasDependency(t,n))}}function $i(u,t){const n=Math.abs(2*u.wrap)-+(u.wrap<0),a=Math.abs(2*t.wrap)-+(t.wrap<0);return u.overscaledZ-t.overscaledZ||a-n||t.canonical.y-u.canonical.y||t.canonical.x-u.canonical.x}function jt(u){return u==="raster"||u==="image"||u==="video"}Ii.maxOverzooming=10,Ii.maxUnderzooming=3;const kt="mapboxgl_preloaded_worker_pool";class Ui{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Ui.workerCount;)this.workers.push(new Worker(o.c.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[kt]}numActive(){return Object.keys(this.active).length}}const Ki=Math.floor(o.h.hardwareConcurrency/2);let sr;function vn(){return sr||(sr=new Ui),sr}Ui.workerCount=o.ac(globalThis)?Math.max(Math.min(Ki,3),1):1;class bn{constructor(t,n){this.reset(t,n)}reset(t,n){this.points=t||[],this._distances=[0];for(let a=1;a<this.points.length;a++)this._distances[a]=this._distances[a-1]+this.points[a].dist(this.points[a-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=o.ad(t,0,1);let n=1,a=this._distances[n];const c=t*this.paddedLength+this.padding;for(;a<c&&n<this._distances.length;)a=this._distances[++n];const d=n-1,m=this._distances[d],g=a-m,x=g>0?(c-m)/g:0;return this.points[d].mult(1-x).add(this.points[n].mult(x))}}function Yr(u,t){let n=!0;return u==="always"||u!=="never"&&t!=="never"||(n=!1),n}class wn{constructor(t,n,a){const c=this.boxCells=[],d=this.circleCells=[];this.xCellCount=Math.ceil(t/a),this.yCellCount=Math.ceil(n/a);for(let m=0;m<this.xCellCount*this.yCellCount;m++)c.push([]),d.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=n,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,n,a,c,d){this._forEachCell(n,a,c,d,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(c),this.bboxes.push(d)}insertCircle(t,n,a,c){this._forEachCell(n-c,a-c,n+c,a+c,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(n),this.circles.push(a),this.circles.push(c)}_insertBoxCell(t,n,a,c,d,m){this.boxCells[d].push(m)}_insertCircleCell(t,n,a,c,d,m){this.circleCells[d].push(m)}_query(t,n,a,c,d,m,g){if(a<0||t>this.width||c<0||n>this.height)return[];const x=[];if(t<=0&&n<=0&&this.width<=a&&this.height<=c){if(d)return[{key:null,x1:t,y1:n,x2:a,y2:c}];for(let w=0;w<this.boxKeys.length;w++)x.push({key:this.boxKeys[w],x1:this.bboxes[4*w],y1:this.bboxes[4*w+1],x2:this.bboxes[4*w+2],y2:this.bboxes[4*w+3]});for(let w=0;w<this.circleKeys.length;w++){const C=this.circles[3*w],T=this.circles[3*w+1],z=this.circles[3*w+2];x.push({key:this.circleKeys[w],x1:C-z,y1:T-z,x2:C+z,y2:T+z})}}else this._forEachCell(t,n,a,c,this._queryCell,x,{hitTest:d,overlapMode:m,seenUids:{box:{},circle:{}}},g);return x}query(t,n,a,c){return this._query(t,n,a,c,!1,null)}hitTest(t,n,a,c,d,m){return this._query(t,n,a,c,!0,d,m).length>0}hitTestCircle(t,n,a,c,d){const m=t-a,g=t+a,x=n-a,w=n+a;if(g<0||m>this.width||w<0||x>this.height)return!1;const C=[];return this._forEachCell(m,x,g,w,this._queryCellCircle,C,{hitTest:!0,overlapMode:c,circle:{x:t,y:n,radius:a},seenUids:{box:{},circle:{}}},d),C.length>0}_queryCell(t,n,a,c,d,m,g,x){const{seenUids:w,hitTest:C,overlapMode:T}=g,z=this.boxCells[d];if(z!==null){const j=this.bboxes;for(const Z of z)if(!w.box[Z]){w.box[Z]=!0;const N=4*Z,te=this.boxKeys[Z];if(t<=j[N+2]&&n<=j[N+3]&&a>=j[N+0]&&c>=j[N+1]&&(!x||x(te))&&(!C||!Yr(T,te.overlapMode))&&(m.push({key:te,x1:j[N],y1:j[N+1],x2:j[N+2],y2:j[N+3]}),C))return!0}}const V=this.circleCells[d];if(V!==null){const j=this.circles;for(const Z of V)if(!w.circle[Z]){w.circle[Z]=!0;const N=3*Z,te=this.circleKeys[Z];if(this._circleAndRectCollide(j[N],j[N+1],j[N+2],t,n,a,c)&&(!x||x(te))&&(!C||!Yr(T,te.overlapMode))){const le=j[N],K=j[N+1],re=j[N+2];if(m.push({key:te,x1:le-re,y1:K-re,x2:le+re,y2:K+re}),C)return!0}}}return!1}_queryCellCircle(t,n,a,c,d,m,g,x){const{circle:w,seenUids:C,overlapMode:T}=g,z=this.boxCells[d];if(z!==null){const j=this.bboxes;for(const Z of z)if(!C.box[Z]){C.box[Z]=!0;const N=4*Z,te=this.boxKeys[Z];if(this._circleAndRectCollide(w.x,w.y,w.radius,j[N+0],j[N+1],j[N+2],j[N+3])&&(!x||x(te))&&!Yr(T,te.overlapMode))return m.push(!0),!0}}const V=this.circleCells[d];if(V!==null){const j=this.circles;for(const Z of V)if(!C.circle[Z]){C.circle[Z]=!0;const N=3*Z,te=this.circleKeys[Z];if(this._circlesCollide(j[N],j[N+1],j[N+2],w.x,w.y,w.radius)&&(!x||x(te))&&!Yr(T,te.overlapMode))return m.push(!0),!0}}}_forEachCell(t,n,a,c,d,m,g,x){const w=this._convertToXCellCoord(t),C=this._convertToYCellCoord(n),T=this._convertToXCellCoord(a),z=this._convertToYCellCoord(c);for(let V=w;V<=T;V++)for(let j=C;j<=z;j++)if(d.call(this,t,n,a,c,this.xCellCount*j+V,m,g,x))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,n,a,c,d,m){const g=c-t,x=d-n,w=a+m;return w*w>g*g+x*x}_circleAndRectCollide(t,n,a,c,d,m,g){const x=(m-c)/2,w=Math.abs(t-(c+x));if(w>x+a)return!1;const C=(g-d)/2,T=Math.abs(n-(d+C));if(T>C+a)return!1;if(w<=x||T<=C)return!0;const z=w-x,V=T-C;return z*z+V*V<=a*a}}function Ae(u,t,n,a,c){const d=o.Z();return t?(o.a0(d,d,[1/c,1/c,1]),n||o.ae(d,d,a.angle)):o.a1(d,a.labelPlaneMatrix,u),d}function mt(u,t,n,a,c){if(t){const d=o.af(u);return o.a0(d,d,[c,c,1]),n||o.ae(d,d,-a.angle),d}return a.glCoordMatrix}function dt(u,t,n){let a;n?(a=[u.x,u.y,n(u.x,u.y),1],o.ag(a,a,t)):(a=[u.x,u.y,0,1],G(a,a,t));const c=a[3];return{point:new o.P(a[0]/c,a[1]/c),signedDistanceFromCamera:c}}function Ut(u,t){return .5+u/t*.5}function bt(u,t){const n=u[0]/u[3],a=u[1]/u[3];return n>=-t[0]&&n<=t[0]&&a>=-t[1]&&a<=t[1]}function Ce(u,t,n,a,c,d,m,g,x,w){const C=a?u.textSizeData:u.iconSizeData,T=o.ah(C,n.transform.zoom),z=[256/n.width*2+1,256/n.height*2+1],V=a?u.text.dynamicLayoutVertexArray:u.icon.dynamicLayoutVertexArray;V.clear();const j=u.lineVertexArray,Z=a?u.text.placedSymbolArray:u.icon.placedSymbolArray,N=n.transform.width/n.transform.height;let te=!1;for(let le=0;le<Z.length;le++){const K=Z.get(le);if(K.hidden||K.writingMode===o.ai.vertical&&!te){O(K.numGlyphs,V);continue}let re;if(te=!1,w?(re=[K.anchorX,K.anchorY,w(K.anchorX,K.anchorY),1],o.ag(re,re,t)):(re=[K.anchorX,K.anchorY,0,1],G(re,re,t)),!bt(re,z)){O(K.numGlyphs,V);continue}const he=Ut(n.transform.cameraToCenterDistance,re[3]),pe=o.aj(C,T,K),xe=m?pe/he:pe*he,Ie=new o.P(K.anchorX,K.anchorY),Se=dt(Ie,c,w).point,ke={projections:{},offsets:{}},Xe=_i(K,xe,!1,g,t,c,d,u.glyphOffsetArray,j,V,Se,Ie,ke,N,x,w);te=Xe.useVertical,(Xe.notEnoughRoom||te||Xe.needsFlipping&&_i(K,xe,!0,g,t,c,d,u.glyphOffsetArray,j,V,Se,Ie,ke,N,x,w).notEnoughRoom)&&O(K.numGlyphs,V)}a?u.text.dynamicLayoutVertexBuffer.updateData(V):u.icon.dynamicLayoutVertexBuffer.updateData(V)}function nt(u,t,n,a,c,d,m,g,x,w,C,T,z){const V=g.glyphStartIndex+g.numGlyphs,j=g.lineStartIndex,Z=g.lineStartIndex+g.lineLength,N=t.getoffsetX(g.glyphStartIndex),te=t.getoffsetX(V-1),le=k(u*N,n,a,c,d,m,g.segment,j,Z,x,w,C,T,z);if(!le)return null;const K=k(u*te,n,a,c,d,m,g.segment,j,Z,x,w,C,T,z);return K?{first:le,last:K}:null}function lt(u,t,n,a){return u===o.ai.horizontal&&Math.abs(n.y-t.y)>Math.abs(n.x-t.x)*a?{useVertical:!0}:(u===o.ai.vertical?t.y<n.y:t.x>n.x)?{needsFlipping:!0}:null}function _i(u,t,n,a,c,d,m,g,x,w,C,T,z,V,j,Z){const N=t/24,te=u.lineOffsetX*N,le=u.lineOffsetY*N;let K;if(u.numGlyphs>1){const re=u.glyphStartIndex+u.numGlyphs,he=u.lineStartIndex,pe=u.lineStartIndex+u.lineLength,xe=nt(N,g,te,le,n,C,T,u,x,d,z,j,Z);if(!xe)return{notEnoughRoom:!0};const Ie=dt(xe.first.point,m,Z).point,Se=dt(xe.last.point,m,Z).point;if(a&&!n){const ke=lt(u.writingMode,Ie,Se,V);if(ke)return ke}K=[xe.first];for(let ke=u.glyphStartIndex+1;ke<re-1;ke++)K.push(k(N*g.getoffsetX(ke),te,le,n,C,T,u.segment,he,pe,x,d,z,j,Z));K.push(xe.last)}else{if(a&&!n){const he=dt(T,c,Z).point,pe=u.lineStartIndex+u.segment+1,xe=new o.P(x.getx(pe),x.gety(pe)),Ie=dt(xe,c,Z),Se=Ie.signedDistanceFromCamera>0?Ie.point:ji(T,xe,he,1,c,Z),ke=lt(u.writingMode,he,Se,V);if(ke)return ke}const re=k(N*g.getoffsetX(u.glyphStartIndex),te,le,n,C,T,u.segment,u.lineStartIndex,u.lineStartIndex+u.lineLength,x,d,z,j,Z);if(!re)return{notEnoughRoom:!0};K=[re]}for(const re of K)o.ak(w,re.point,re.angle);return{}}function ji(u,t,n,a,c,d){const m=dt(u.add(u.sub(t)._unit()),c,d).point,g=n.sub(m);return n.add(g._mult(a/g.mag()))}function yt(u,t){const{projectionCache:n,lineVertexArray:a,labelPlaneMatrix:c,tileAnchorPoint:d,distanceFromAnchor:m,getElevation:g,previousVertex:x,direction:w,absOffsetX:C}=t;if(n.projections[u])return n.projections[u];const T=new o.P(a.getx(u),a.gety(u)),z=dt(T,c,g);if(z.signedDistanceFromCamera>0)return n.projections[u]=z.point,z.point;const V=u-w;return ji(m===0?d:new o.P(a.getx(V),a.gety(V)),T,x,C-m+1,c,g)}function ln(u,t,n){return u._unit()._perp()._mult(t*n)}function q(u,t,n,a,c,d,m,g){const{projectionCache:x,direction:w}=g;if(x.offsets[u])return x.offsets[u];const C=n.add(t);if(u+w<a||u+w>=c)return x.offsets[u]=C,C;const T=yt(u+w,g),z=ln(T.sub(n),m,w),V=n.add(z),j=T.add(z);return x.offsets[u]=o.al(d,C,V,j)||C,x.offsets[u]}function k(u,t,n,a,c,d,m,g,x,w,C,T,z,V){const j=a?u-t:u+t;let Z=j>0?1:-1,N=0;a&&(Z*=-1,N=Math.PI),Z<0&&(N+=Math.PI);let te,le,K=Z>0?g+m:g+m+1,re=c,he=c,pe=0,xe=0;const Ie=Math.abs(j),Se=[];let ke;for(;pe+xe<=Ie;){if(K+=Z,K<g||K>=x)return null;pe+=xe,he=re,le=te;const Le={projectionCache:T,lineVertexArray:w,labelPlaneMatrix:C,tileAnchorPoint:d,distanceFromAnchor:pe,getElevation:V,previousVertex:he,direction:Z,absOffsetX:Ie};if(re=yt(K,Le),n===0)Se.push(he),ke=re.sub(he);else{let ut;const Ye=re.sub(he);ut=Ye.mag()===0?ln(yt(K+Z,Le).sub(re),n,Z):ln(Ye,n,Z),le||(le=he.add(ut)),te=q(K,ut,re,g,x,le,n,Le),Se.push(le),ke=te.sub(le)}xe=ke.mag()}const Xe=ke._mult((Ie-pe)/xe)._add(le||he),Ct=N+Math.atan2(re.y-he.y,re.x-he.x);return Se.push(Xe),{point:Xe,angle:z?Ct:0,path:Se}}const P=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function O(u,t){for(let n=0;n<u;n++){const a=t.length;t.resize(a+4),t.float32.set(P,3*a)}}function G(u,t,n){const a=t[0],c=t[1];return u[0]=n[0]*a+n[4]*c+n[12],u[1]=n[1]*a+n[5]*c+n[13],u[3]=n[3]*a+n[7]*c+n[15],u}const X=100;class ae{constructor(t,n=new wn(t.width+200,t.height+200,25),a=new wn(t.width+200,t.height+200,25)){this.transform=t,this.grid=n,this.ignoredGrid=a,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+X,this.screenBottomBoundary=t.height+X,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,n,a,c,d,m){const g=this.projectAndGetPerspectiveRatio(c,t.anchorPointX,t.anchorPointY,m),x=a*g.perspectiveRatio,w=t.x1*x+g.point.x,C=t.y1*x+g.point.y,T=t.x2*x+g.point.x,z=t.y2*x+g.point.y;return!this.isInsideGrid(w,C,T,z)||n!=="always"&&this.grid.hitTest(w,C,T,z,n,d)||g.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[w,C,T,z],offscreen:this.isOffscreen(w,C,T,z)}}placeCollisionCircles(t,n,a,c,d,m,g,x,w,C,T,z,V,j){const Z=[],N=new o.P(n.anchorX,n.anchorY),te=dt(N,m,j),le=Ut(this.transform.cameraToCenterDistance,te.signedDistanceFromCamera),K=(C?d/le:d*le)/o.ap,re=dt(N,g,j).point,he=nt(K,c,n.lineOffsetX*K,n.lineOffsetY*K,!1,re,N,n,a,g,{projections:{},offsets:{}},!1,j);let pe=!1,xe=!1,Ie=!0;if(he){const Se=.5*z*le+V,ke=new o.P(-100,-100),Xe=new o.P(this.screenRightBoundary,this.screenBottomBoundary),Ct=new bn,Le=he.first,ut=he.last;let Ye=[];for(let vt=Le.path.length-1;vt>=1;vt--)Ye.push(Le.path[vt]);for(let vt=1;vt<ut.path.length;vt++)Ye.push(ut.path[vt]);const Zt=2.5*Se;if(x){const vt=Ye.map(Tt=>dt(Tt,x,j));Ye=vt.some(Tt=>Tt.signedDistanceFromCamera<=0)?[]:vt.map(Tt=>Tt.point)}let St=[];if(Ye.length>0){const vt=Ye[0].clone(),Tt=Ye[0].clone();for(let yi=1;yi<Ye.length;yi++)vt.x=Math.min(vt.x,Ye[yi].x),vt.y=Math.min(vt.y,Ye[yi].y),Tt.x=Math.max(Tt.x,Ye[yi].x),Tt.y=Math.max(Tt.y,Ye[yi].y);St=vt.x>=ke.x&&Tt.x<=Xe.x&&vt.y>=ke.y&&Tt.y<=Xe.y?[Ye]:Tt.x<ke.x||vt.x>Xe.x||Tt.y<ke.y||vt.y>Xe.y?[]:o.am([Ye],ke.x,ke.y,Xe.x,Xe.y)}for(const vt of St){Ct.reset(vt,.25*Se);let Tt=0;Tt=Ct.length<=.5*Se?1:Math.ceil(Ct.paddedLength/Zt)+1;for(let yi=0;yi<Tt;yi++){const ei=yi/Math.max(Tt-1,1),Gi=Ct.lerp(ei),zi=Gi.x+X,Si=Gi.y+X;Z.push(zi,Si,Se,0);const kr=zi-Se,ii=Si-Se,Qr=zi+Se,en=Si+Se;if(Ie=Ie&&this.isOffscreen(kr,ii,Qr,en),xe=xe||this.isInsideGrid(kr,ii,Qr,en),t!=="always"&&this.grid.hitTestCircle(zi,Si,Se,t,T)&&(pe=!0,!w))return{circles:[],offscreen:!1,collisionDetected:pe}}}}return{circles:!w&&pe||!xe||le<this.perspectiveRatioCutoff?[]:Z,offscreen:Ie,collisionDetected:pe}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const n=[];let a=1/0,c=1/0,d=-1/0,m=-1/0;for(const C of t){const T=new o.P(C.x+X,C.y+X);a=Math.min(a,T.x),c=Math.min(c,T.y),d=Math.max(d,T.x),m=Math.max(m,T.y),n.push(T)}const g=this.grid.query(a,c,d,m).concat(this.ignoredGrid.query(a,c,d,m)),x={},w={};for(const C of g){const T=C.key;if(x[T.bucketInstanceId]===void 0&&(x[T.bucketInstanceId]={}),x[T.bucketInstanceId][T.featureIndex])continue;const z=[new o.P(C.x1,C.y1),new o.P(C.x2,C.y1),new o.P(C.x2,C.y2),new o.P(C.x1,C.y2)];o.an(n,z)&&(x[T.bucketInstanceId][T.featureIndex]=!0,w[T.bucketInstanceId]===void 0&&(w[T.bucketInstanceId]=[]),w[T.bucketInstanceId].push(T.featureIndex))}return w}insertCollisionBox(t,n,a,c,d,m){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:d,collisionGroupID:m,overlapMode:n},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,n,a,c,d,m){const g=a?this.ignoredGrid:this.grid,x={bucketInstanceId:c,featureIndex:d,collisionGroupID:m,overlapMode:n};for(let w=0;w<t.length;w+=4)g.insertCircle(x,t[w],t[w+1],t[w+2])}projectAndGetPerspectiveRatio(t,n,a,c){let d;return c?(d=[n,a,c(n,a),1],o.ag(d,d,t)):(d=[n,a,0,1],G(d,d,t)),{point:new o.P((d[0]/d[3]+1)/2*this.transform.width+X,(-d[1]/d[3]+1)/2*this.transform.height+X),perspectiveRatio:.5+this.transform.cameraToCenterDistance/d[3]*.5}}isOffscreen(t,n,a,c){return a<X||t>=this.screenRightBoundary||c<X||n>this.screenBottomBoundary}isInsideGrid(t,n,a,c){return a>=0&&t<this.gridRightBoundary&&c>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const t=o.ao([]);return o.$(t,t,[-100,-100,0]),t}}function ee(u,t,n){return t*(o.N/(u.tileSize*Math.pow(2,n-u.tileID.overscaledZ)))}class J{constructor(t,n,a,c){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?n:-n))):c&&a?1:0,this.placed=a}isHidden(){return this.opacity===0&&!this.placed}}class ne{constructor(t,n,a,c,d){this.text=new J(t?t.text:null,n,a,d),this.icon=new J(t?t.icon:null,n,c,d)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class me{constructor(t,n,a){this.text=t,this.icon=n,this.skipFade=a}}class ye{constructor(){this.invProjMatrix=o.Z(),this.viewportMatrix=o.Z(),this.circles=[]}}class we{constructor(t,n,a,c,d){this.bucketInstanceId=t,this.featureIndex=n,this.sourceLayerIndex=a,this.bucketIndex=c,this.tileID=d}}class it{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const n=++this.maxGroupID;this.collisionGroups[t]={ID:n,predicate:a=>a.collisionGroupID===n}}return this.collisionGroups[t]}}function pt(u,t,n,a,c){const{horizontalAlign:d,verticalAlign:m}=o.au(u);return new o.P(-(d-.5)*t+a[0]*c,-(m-.5)*n+a[1]*c)}function We(u,t,n,a,c,d){const{x1:m,x2:g,y1:x,y2:w,anchorPointX:C,anchorPointY:T}=u,z=new o.P(t,n);return a&&z._rotate(c?d:-d),{x1:m+z.x,y1:x+z.y,x2:g+z.x,y2:w+z.y,anchorPointX:C,anchorPointY:T}}class st{constructor(t,n,a,c,d){this.transform=t.clone(),this.terrain=n,this.collisionIndex=new ae(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new it(c),this.collisionCircleArrays={},this.prevPlacement=d,d&&(d.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,n,a,c){const d=a.getBucket(n),m=a.latestFeatureIndex;if(!d||!m||n.id!==d.layerIds[0])return;const g=a.collisionBoxArray,x=d.layers[0].layout,w=Math.pow(2,this.transform.zoom-a.tileID.overscaledZ),C=a.tileSize/o.N,T=this.transform.calculatePosMatrix(a.tileID.toUnwrapped()),z=x.get("text-pitch-alignment")==="map",V=x.get("text-rotation-alignment")==="map",j=ee(a,1,this.transform.zoom),Z=Ae(T,z,V,this.transform,j);let N=null;if(z){const le=mt(T,z,V,this.transform,j);N=o.a1([],this.transform.labelPlaneMatrix,le)}this.retainedQueryData[d.bucketInstanceId]=new we(d.bucketInstanceId,m,d.sourceLayerIndex,d.index,a.tileID);const te={bucket:d,layout:x,posMatrix:T,textLabelPlaneMatrix:Z,labelToScreenMatrix:N,scale:w,textPixelRatio:C,holdingForFade:a.holdingForFade(),collisionBoxArray:g,partiallyEvaluatedTextSize:o.ah(d.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(d.sourceID)};if(c)for(const le of d.sortKeyRanges){const{sortKey:K,symbolInstanceStart:re,symbolInstanceEnd:he}=le;t.push({sortKey:K,symbolInstanceStart:re,symbolInstanceEnd:he,parameters:te})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:d.symbolInstances.length,parameters:te})}attemptAnchorPlacement(t,n,a,c,d,m,g,x,w,C,T,z,V,j,Z,N){const te=o.aq[t.textAnchor],le=[t.textOffset0,t.textOffset1],K=pt(te,a,c,le,d),re=this.collisionIndex.placeCollisionBox(We(n,K.x,K.y,m,g,this.transform.angle),T,x,w,C.predicate,N);if((!Z||this.collisionIndex.placeCollisionBox(We(Z,K.x,K.y,m,g,this.transform.angle),T,x,w,C.predicate,N).box.length!==0)&&re.box.length>0){let he;if(this.prevPlacement&&this.prevPlacement.variableOffsets[z.crossTileID]&&this.prevPlacement.placements[z.crossTileID]&&this.prevPlacement.placements[z.crossTileID].text&&(he=this.prevPlacement.variableOffsets[z.crossTileID].anchor),z.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[z.crossTileID]={textOffset:le,width:a,height:c,anchor:te,textBoxScale:d,prevAnchor:he},this.markUsedJustification(V,te,z,j),V.allowVerticalPlacement&&(this.markUsedOrientation(V,j,z),this.placedOrientations[z.crossTileID]=j),{shift:K,placedGlyphBoxes:re}}}placeLayerBucketPart(t,n,a){const{bucket:c,layout:d,posMatrix:m,textLabelPlaneMatrix:g,labelToScreenMatrix:x,textPixelRatio:w,holdingForFade:C,collisionBoxArray:T,partiallyEvaluatedTextSize:z,collisionGroup:V}=t.parameters,j=d.get("text-optional"),Z=d.get("icon-optional"),N=o.ar(d,"text-overlap","text-allow-overlap"),te=N==="always",le=o.ar(d,"icon-overlap","icon-allow-overlap"),K=le==="always",re=d.get("text-rotation-alignment")==="map",he=d.get("text-pitch-alignment")==="map",pe=d.get("icon-text-fit")!=="none",xe=d.get("symbol-z-order")==="viewport-y",Ie=te&&(K||!c.hasIconData()||Z),Se=K&&(te||!c.hasTextData()||j);!c.collisionArrays&&T&&c.deserializeCollisionBoxes(T);const ke=this.retainedQueryData[c.bucketInstanceId].tileID,Xe=this.terrain?(Le,ut)=>this.terrain.getElevation(ke,Le,ut):null,Ct=(Le,ut)=>{var Ye,Zt;if(n[Le.crossTileID])return;if(C)return void(this.placements[Le.crossTileID]=new me(!1,!1,!1));let St=!1,vt=!1,Tt=!0,yi=null,ei={box:null,offscreen:null},Gi={box:null,offscreen:null},zi=null,Si=null,kr=null,ii=0,Qr=0,en=0;ut.textFeatureIndex?ii=ut.textFeatureIndex:Le.useRuntimeCollisionCircles&&(ii=Le.featureIndex),ut.verticalTextFeatureIndex&&(Qr=ut.verticalTextFeatureIndex);const kn=ut.textBox;if(kn){const Qi=xi=>{let Di=o.ai.horizontal;if(c.allowVerticalPlacement&&!xi&&this.prevPlacement){const _r=this.prevPlacement.placedOrientations[Le.crossTileID];_r&&(this.placedOrientations[Le.crossTileID]=_r,Di=_r,this.markUsedOrientation(c,Di,Le))}return Di},Hi=(xi,Di)=>{if(c.allowVerticalPlacement&&Le.numVerticalGlyphVertices>0&&ut.verticalTextBox){for(const _r of c.writingModes)if(_r===o.ai.vertical?(ei=Di(),Gi=ei):ei=xi(),ei&&ei.box&&ei.box.length)break}else ei=xi()},or=Le.textAnchorOffsetStartIndex,Un=Le.textAnchorOffsetEndIndex;if(Un===or){const xi=(Di,_r)=>{const vi=this.collisionIndex.placeCollisionBox(Di,N,w,m,V.predicate,Xe);return vi&&vi.box&&vi.box.length&&(this.markUsedOrientation(c,_r,Le),this.placedOrientations[Le.crossTileID]=_r),vi};Hi(()=>xi(kn,o.ai.horizontal),()=>{const Di=ut.verticalTextBox;return c.allowVerticalPlacement&&Le.numVerticalGlyphVertices>0&&Di?xi(Di,o.ai.vertical):{box:null,offscreen:null}}),Qi(ei&&ei.box&&ei.box.length)}else{let xi=o.aq[(Zt=(Ye=this.prevPlacement)===null||Ye===void 0?void 0:Ye.variableOffsets[Le.crossTileID])===null||Zt===void 0?void 0:Zt.anchor];const Di=(vi,qn,va)=>{const Dl=vi.x2-vi.x1,Ll=vi.y2-vi.y1,Ac=Le.textBoxScale,So=pe&&le==="never"?qn:null;let tn={box:[],offscreen:!1},Zn=N==="never"?1:2,rn="never";xi&&Zn++;for(let jr=0;jr<Zn;jr++){for(let nn=or;nn<Un;nn++){const Co=c.textAnchorOffsets.get(nn);if(xi&&Co.textAnchor!==xi)continue;const fn=this.attemptAnchorPlacement(Co,vi,Dl,Ll,Ac,re,he,w,m,V,rn,Le,c,va,So,Xe);if(fn&&(tn=fn.placedGlyphBoxes,tn&&tn.box&&tn.box.length))return St=!0,yi=fn.shift,tn}xi?xi=null:rn=N}return tn};Hi(()=>Di(kn,ut.iconBox,o.ai.horizontal),()=>{const vi=ut.verticalTextBox;return c.allowVerticalPlacement&&!(ei&&ei.box&&ei.box.length)&&Le.numVerticalGlyphVertices>0&&vi?Di(vi,ut.verticalIconBox,o.ai.vertical):{box:null,offscreen:null}}),ei&&(St=ei.box,Tt=ei.offscreen);const _r=Qi(ei&&ei.box);if(!St&&this.prevPlacement){const vi=this.prevPlacement.variableOffsets[Le.crossTileID];vi&&(this.variableOffsets[Le.crossTileID]=vi,this.markUsedJustification(c,vi.anchor,Le,_r))}}}if(zi=ei,St=zi&&zi.box&&zi.box.length>0,Tt=zi&&zi.offscreen,Le.useRuntimeCollisionCircles){const Qi=c.text.placedSymbolArray.get(Le.centerJustifiedTextSymbolIndex),Hi=o.aj(c.textSizeData,z,Qi),or=d.get("text-padding");Si=this.collisionIndex.placeCollisionCircles(N,Qi,c.lineVertexArray,c.glyphOffsetArray,Hi,m,g,x,a,he,V.predicate,Le.collisionCircleDiameter,or,Xe),Si.circles.length&&Si.collisionDetected&&!a&&o.w("Collisions detected, but collision boxes are not shown"),St=te||Si.circles.length>0&&!Si.collisionDetected,Tt=Tt&&Si.offscreen}if(ut.iconFeatureIndex&&(en=ut.iconFeatureIndex),ut.iconBox){const Qi=Hi=>{const or=pe&&yi?We(Hi,yi.x,yi.y,re,he,this.transform.angle):Hi;return this.collisionIndex.placeCollisionBox(or,le,w,m,V.predicate,Xe)};Gi&&Gi.box&&Gi.box.length&&ut.verticalIconBox?(kr=Qi(ut.verticalIconBox),vt=kr.box.length>0):(kr=Qi(ut.iconBox),vt=kr.box.length>0),Tt=Tt&&kr.offscreen}const Vn=j||Le.numHorizontalGlyphVertices===0&&Le.numVerticalGlyphVertices===0,us=Z||Le.numIconVertices===0;if(Vn||us?us?Vn||(vt=vt&&St):St=vt&&St:vt=St=vt&&St,St&&zi&&zi.box&&this.collisionIndex.insertCollisionBox(zi.box,N,d.get("text-ignore-placement"),c.bucketInstanceId,Gi&&Gi.box&&Qr?Qr:ii,V.ID),vt&&kr&&this.collisionIndex.insertCollisionBox(kr.box,le,d.get("icon-ignore-placement"),c.bucketInstanceId,en,V.ID),Si&&(St&&this.collisionIndex.insertCollisionCircles(Si.circles,N,d.get("text-ignore-placement"),c.bucketInstanceId,ii,V.ID),a)){const Qi=c.bucketInstanceId;let Hi=this.collisionCircleArrays[Qi];Hi===void 0&&(Hi=this.collisionCircleArrays[Qi]=new ye);for(let or=0;or<Si.circles.length;or+=4)Hi.circles.push(Si.circles[or+0]),Hi.circles.push(Si.circles[or+1]),Hi.circles.push(Si.circles[or+2]),Hi.circles.push(Si.collisionDetected?1:0)}if(Le.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(c.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Le.crossTileID]=new me(St||Ie,vt||Se,Tt||c.justReloaded),n[Le.crossTileID]=!0};if(xe){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Le=c.getSortedSymbolIndexes(this.transform.angle);for(let ut=Le.length-1;ut>=0;--ut){const Ye=Le[ut];Ct(c.symbolInstances.get(Ye),c.collisionArrays[Ye])}}else for(let Le=t.symbolInstanceStart;Le<t.symbolInstanceEnd;Le++)Ct(c.symbolInstances.get(Le),c.collisionArrays[Le]);if(a&&c.bucketInstanceId in this.collisionCircleArrays){const Le=this.collisionCircleArrays[c.bucketInstanceId];o.as(Le.invProjMatrix,m),Le.viewportMatrix=this.collisionIndex.getViewportMatrix()}c.justReloaded=!1}markUsedJustification(t,n,a,c){let d;d=c===o.ai.vertical?a.verticalPlacedTextSymbolIndex:{left:a.leftJustifiedTextSymbolIndex,center:a.centerJustifiedTextSymbolIndex,right:a.rightJustifiedTextSymbolIndex}[o.at(n)];const m=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex,a.verticalPlacedTextSymbolIndex];for(const g of m)g>=0&&(t.text.placedSymbolArray.get(g).crossTileID=d>=0&&g!==d?0:a.crossTileID)}markUsedOrientation(t,n,a){const c=n===o.ai.horizontal||n===o.ai.horizontalOnly?n:0,d=n===o.ai.vertical?n:0,m=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex];for(const g of m)t.text.placedSymbolArray.get(g).placedOrientation=c;a.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(a.verticalPlacedTextSymbolIndex).placedOrientation=d)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let a=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const c=n?n.symbolFadeChange(t):1,d=n?n.opacities:{},m=n?n.variableOffsets:{},g=n?n.placedOrientations:{};for(const x in this.placements){const w=this.placements[x],C=d[x];C?(this.opacities[x]=new ne(C,c,w.text,w.icon),a=a||w.text!==C.text.placed||w.icon!==C.icon.placed):(this.opacities[x]=new ne(null,c,w.text,w.icon,w.skipFade),a=a||w.text||w.icon)}for(const x in d){const w=d[x];if(!this.opacities[x]){const C=new ne(w,c,!1,!1);C.isHidden()||(this.opacities[x]=C,a=a||w.text.placed||w.icon.placed)}}for(const x in m)this.variableOffsets[x]||!this.opacities[x]||this.opacities[x].isHidden()||(this.variableOffsets[x]=m[x]);for(const x in g)this.placedOrientations[x]||!this.opacities[x]||this.opacities[x].isHidden()||(this.placedOrientations[x]=g[x]);if(n&&n.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");a?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:t)}updateLayerOpacities(t,n){const a={};for(const c of n){const d=c.getBucket(t);d&&c.latestFeatureIndex&&t.id===d.layerIds[0]&&this.updateBucketOpacities(d,a,c.collisionBoxArray)}}updateBucketOpacities(t,n,a){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const c=t.layers[0],d=c.layout,m=new ne(null,0,!1,!1,!0),g=d.get("text-allow-overlap"),x=d.get("icon-allow-overlap"),w=c._unevaluatedLayout.hasValue("text-variable-anchor")||c._unevaluatedLayout.hasValue("text-variable-anchor-offset"),C=d.get("text-rotation-alignment")==="map",T=d.get("text-pitch-alignment")==="map",z=d.get("icon-text-fit")!=="none",V=new ne(null,0,g&&(x||!t.hasIconData()||d.get("icon-optional")),x&&(g||!t.hasTextData()||d.get("text-optional")),!0);!t.collisionArrays&&a&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(a);const j=(Z,N,te)=>{for(let le=0;le<N/4;le++)Z.opacityVertexArray.emplaceBack(te);Z.hasVisibleVertices=Z.hasVisibleVertices||te!==Rr};for(let Z=0;Z<t.symbolInstances.length;Z++){const N=t.symbolInstances.get(Z),{numHorizontalGlyphVertices:te,numVerticalGlyphVertices:le,crossTileID:K}=N;let re=this.opacities[K];n[K]?re=m:re||(re=V,this.opacities[K]=re),n[K]=!0;const he=N.numIconVertices>0,pe=this.placedOrientations[N.crossTileID],xe=pe===o.ai.vertical,Ie=pe===o.ai.horizontal||pe===o.ai.horizontalOnly;if(te>0||le>0){const Se=qi(re.text);j(t.text,te,xe?Rr:Se),j(t.text,le,Ie?Rr:Se);const ke=re.text.isHidden();[N.rightJustifiedTextSymbolIndex,N.centerJustifiedTextSymbolIndex,N.leftJustifiedTextSymbolIndex].forEach(Le=>{Le>=0&&(t.text.placedSymbolArray.get(Le).hidden=ke||xe?1:0)}),N.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(N.verticalPlacedTextSymbolIndex).hidden=ke||Ie?1:0);const Xe=this.variableOffsets[N.crossTileID];Xe&&this.markUsedJustification(t,Xe.anchor,N,pe);const Ct=this.placedOrientations[N.crossTileID];Ct&&(this.markUsedJustification(t,"left",N,Ct),this.markUsedOrientation(t,Ct,N))}if(he){const Se=qi(re.icon),ke=!(z&&N.verticalPlacedIconSymbolIndex&&xe);N.placedIconSymbolIndex>=0&&(j(t.icon,N.numIconVertices,ke?Se:Rr),t.icon.placedSymbolArray.get(N.placedIconSymbolIndex).hidden=re.icon.isHidden()),N.verticalPlacedIconSymbolIndex>=0&&(j(t.icon,N.numVerticalIconVertices,ke?Rr:Se),t.icon.placedSymbolArray.get(N.verticalPlacedIconSymbolIndex).hidden=re.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Se=t.collisionArrays[Z];if(Se){let ke=new o.P(0,0);if(Se.textBox||Se.verticalTextBox){let Ct=!0;if(w){const Le=this.variableOffsets[K];Le?(ke=pt(Le.anchor,Le.width,Le.height,Le.textOffset,Le.textBoxScale),C&&ke._rotate(T?this.transform.angle:-this.transform.angle)):Ct=!1}Se.textBox&&gt(t.textCollisionBox.collisionVertexArray,re.text.placed,!Ct||xe,ke.x,ke.y),Se.verticalTextBox&&gt(t.textCollisionBox.collisionVertexArray,re.text.placed,!Ct||Ie,ke.x,ke.y)}const Xe=!!(!Ie&&Se.verticalIconBox);Se.iconBox&&gt(t.iconCollisionBox.collisionVertexArray,re.icon.placed,Xe,z?ke.x:0,z?ke.y:0),Se.verticalIconBox&&gt(t.iconCollisionBox.collisionVertexArray,re.icon.placed,!Xe,z?ke.x:0,z?ke.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const Z=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=Z.invProjMatrix,t.placementViewportMatrix=Z.viewportMatrix,t.collisionCircleArray=Z.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,n){const a=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*a>t}setStale(){this.stale=!0}}function gt(u,t,n,a,c){u.emplaceBack(t?1:0,n?1:0,a||0,c||0),u.emplaceBack(t?1:0,n?1:0,a||0,c||0),u.emplaceBack(t?1:0,n?1:0,a||0,c||0),u.emplaceBack(t?1:0,n?1:0,a||0,c||0)}const Vt=Math.pow(2,25),Gt=Math.pow(2,24),Ft=Math.pow(2,17),Dt=Math.pow(2,16),Yi=Math.pow(2,9),Qt=Math.pow(2,8),Ei=Math.pow(2,1);function qi(u){if(u.opacity===0&&!u.placed)return 0;if(u.opacity===1&&u.placed)return 4294967295;const t=u.placed?1:0,n=Math.floor(127*u.opacity);return n*Vt+t*Gt+n*Ft+t*Dt+n*Yi+t*Qt+n*Ei+t}const Rr=0;class Xo{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,n,a,c,d){const m=this._bucketParts;for(;this._currentTileIndex<t.length;)if(n.getBucketParts(m,c,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,d())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,m.sort((g,x)=>g.sortKey-x.sortKey));this._currentPartIndex<m.length;)if(n.placeLayerBucketPart(m[this._currentPartIndex],this._seenCrossTileIDs,a),this._currentPartIndex++,d())return!0;return!1}}class Yn{constructor(t,n,a,c,d,m,g,x){this.placement=new st(t,n,m,g,x),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=d,this._done=!1}isDone(){return this._done}continuePlacement(t,n,a){const c=o.h.now(),d=()=>!this._forceFullPlacement&&o.h.now()-c>2;for(;this._currentPlacementIndex>=0;){const m=n[t[this._currentPlacementIndex]],g=this.placement.collisionIndex.transform.zoom;if(m.type==="symbol"&&(!m.minzoom||m.minzoom<=g)&&(!m.maxzoom||m.maxzoom>g)){if(this._inProgressLayer||(this._inProgressLayer=new Xo(m)),this._inProgressLayer.continuePlacement(a[m.source],this.placement,this._showCollisionBoxes,m,d))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Jn=512/o.N/2;class pc{constructor(t,n,a){this.tileID=t,this.bucketInstanceId=a,this._symbolsByKey={};const c=new Map;for(let d=0;d<n.length;d++){const m=n.get(d),g=m.key,x=c.get(g);x?x.push(m):c.set(g,[m])}for(const[d,m]of c){const g={positions:m.map(x=>({x:Math.floor(x.anchorX*Jn),y:Math.floor(x.anchorY*Jn)})),crossTileIDs:m.map(x=>x.crossTileID)};if(g.positions.length>128){const x=new o.av(g.positions.length,16,Uint16Array);for(const{x:w,y:C}of g.positions)x.add(w,C);x.finish(),delete g.positions,g.index=x}this._symbolsByKey[d]=g}}getScaledCoordinates(t,n){const{x:a,y:c,z:d}=this.tileID.canonical,{x:m,y:g,z:x}=n.canonical,w=Jn/Math.pow(2,x-d),C=(g*o.N+t.anchorY)*w,T=c*o.N*Jn;return{x:Math.floor((m*o.N+t.anchorX)*w-a*o.N*Jn),y:Math.floor(C-T)}}findMatches(t,n,a){const c=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z);for(let d=0;d<t.length;d++){const m=t.get(d);if(m.crossTileID)continue;const g=this._symbolsByKey[m.key];if(!g)continue;const x=this.getScaledCoordinates(m,n);if(g.index){const w=g.index.range(x.x-c,x.y-c,x.x+c,x.y+c).sort();for(const C of w){const T=g.crossTileIDs[C];if(!a[T]){a[T]=!0,m.crossTileID=T;break}}}else if(g.positions)for(let w=0;w<g.positions.length;w++){const C=g.positions[w],T=g.crossTileIDs[w];if(Math.abs(C.x-x.x)<=c&&Math.abs(C.y-x.y)<=c&&!a[T]){a[T]=!0,m.crossTileID=T;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class qt{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ra{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const n=Math.round((t-this.lng)/360);if(n!==0)for(const a in this.indexes){const c=this.indexes[a],d={};for(const m in c){const g=c[m];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+n),d[g.tileID.key]=g}this.indexes[a]=d}this.lng=t}addBucket(t,n,a){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let d=0;d<n.symbolInstances.length;d++)n.symbolInstances.get(d).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const c=this.usedCrossTileIDs[t.overscaledZ];for(const d in this.indexes){const m=this.indexes[d];if(Number(d)>t.overscaledZ)for(const g in m){const x=m[g];x.tileID.isChildOf(t)&&x.findMatches(n.symbolInstances,t,c)}else{const g=m[t.scaledTo(Number(d)).key];g&&g.findMatches(n.symbolInstances,t,c)}}for(let d=0;d<n.symbolInstances.length;d++){const m=n.symbolInstances.get(d);m.crossTileID||(m.crossTileID=a.generate(),c[m.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new pc(t,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(t,n){for(const a of n.getCrossTileIDsLists())for(const c of a)delete this.usedCrossTileIDs[t][c]}removeStaleBuckets(t){let n=!1;for(const a in this.indexes){const c=this.indexes[a];for(const d in c)t[c[d].bucketInstanceId]||(this.removeBucketCrossTileIDs(a,c[d]),delete c[d],n=!0)}return n}}class Gs{constructor(){this.layerIndexes={},this.crossTileIDs=new qt,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,n,a){let c=this.layerIndexes[t.id];c===void 0&&(c=this.layerIndexes[t.id]=new Ra);let d=!1;const m={};c.handleWrapJump(a);for(const g of n){const x=g.getBucket(t);x&&t.id===x.layerIds[0]&&(x.bucketInstanceId||(x.bucketInstanceId=++this.maxBucketInstanceId),c.addBucket(g.tileID,x,this.crossTileIDs)&&(d=!0),m[x.bucketInstanceId]=!0)}return c.removeStaleBuckets(m)&&(d=!0),d}pruneUnusedLayers(t){const n={};t.forEach(a=>{n[a]=!0});for(const a in this.layerIndexes)n[a]||delete this.layerIndexes[a]}}const Ji=(u,t)=>o.x(u,t&&t.filter(n=>n.identifier!=="source.canvas")),Cr=o.F(o.ax,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),fc=o.F(o.ax,["setCenter","setZoom","setBearing","setPitch"]),Fr=o.aw();class Zi extends o.E{constructor(t,n={}){super(),this.map=t,this.dispatcher=new si(vn(),this,t._getMapId()),this.imageManager=new zt,this.imageManager.setEventedParent(this),this.glyphManager=new Bt(t._requestManager,n.localIdeographFontFamily),this.lineAtlas=new Xi(256,512),this.crossTileSymbolIndex=new Gs,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.az());const a=this;this._rtlTextPluginCallback=Zi.registerForPluginStateChange(c=>{a.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:c.pluginStatus,pluginURL:c.pluginURL},(d,m)=>{if(o.aA(d),m&&m.every(g=>g))for(const g in a.sourceCaches){const x=a.sourceCaches[g].getSource().type;x!=="vector"&&x!=="geojson"||a.sourceCaches[g].reload()}})}),this.on("data",c=>{if(c.dataType!=="source"||c.sourceDataType!=="metadata")return;const d=this.sourceCaches[c.sourceId];if(!d)return;const m=d.getSource();if(m&&m.vectorLayerIds)for(const g in this._layers){const x=this._layers[g];x.source===m.id&&this._validateLayer(x)}})}loadURL(t,n={},a){this.fire(new o.k("dataloading",{dataType:"style"})),n.validate=typeof n.validate!="boolean"||n.validate;const c=this.map._requestManager.transformRequest(t,Ne.Style);this._request=o.f(c,(d,m)=>{this._request=null,d?this.fire(new o.j(d)):m&&this._load(m,n,a)})}loadJSON(t,n={},a){this.fire(new o.k("dataloading",{dataType:"style"})),this._request=o.h.frame(()=>{this._request=null,n.validate=n.validate!==!1,this._load(t,n,a)})}loadEmpty(){this.fire(new o.k("dataloading",{dataType:"style"})),this._load(Fr,{validate:!1})}_load(t,n,a){var c;const d=n.transformStyle?n.transformStyle(a,t):t;if(!n.validate||!Ji(this,o.y(d))){this._loaded=!0,this.stylesheet=d;for(const m in d.sources)this.addSource(m,d.sources[m],{validate:!1});d.sprite?this._loadSprite(d.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(d.glyphs),this._createLayers(),this.light=new Ai(this.stylesheet.light),this.map.setTerrain((c=this.stylesheet.terrain)!==null&&c!==void 0?c:null),this.fire(new o.k("data",{dataType:"style"})),this.fire(new o.k("style.load"))}}_createLayers(){const t=o.aB(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",t),this._order=t.map(n=>n.id),this._layers={},this._serializedLayers=null;for(const n of t){const a=o.aC(n);a.setEventedParent(this,{layer:{id:n.id}}),this._layers[n.id]=a}}_loadSprite(t,n=!1,a=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(c,d,m,g){const x=He(c),w=x.length,C=m>1?"@2x":"",T={},z={},V={};for(const{id:j,url:Z}of x){const N=d.transformRequest(d.normalizeSpriteURL(Z,C,".json"),Ne.SpriteJSON),te=`${j}_${N.url}`;T[te]=o.f(N,(re,he)=>{delete T[te],z[j]=he,ot(g,z,V,re,w)});const le=d.transformRequest(d.normalizeSpriteURL(Z,C,".png"),Ne.SpriteImage),K=`${j}_${le.url}`;T[K]=De.getImage(le,(re,he)=>{delete T[K],V[j]=he,ot(g,z,V,re,w)})}return{cancel(){for(const j of Object.values(T))j.cancel()}}}(t,this.map._requestManager,this.map.getPixelRatio(),(c,d)=>{if(this._spriteRequest=null,c)this.fire(new o.j(c));else if(d)for(const m in d){this._spritesImagesIds[m]=[];const g=this._spritesImagesIds[m]?this._spritesImagesIds[m].filter(x=>!(x in d)):[];for(const x of g)this.imageManager.removeImage(x),this._changedImages[x]=!0;for(const x in d[m]){const w=m==="default"?x:`${m}:${x}`;this._spritesImagesIds[m].push(w),w in this.imageManager.images?this.imageManager.updateImage(w,d[m][x],!1):this.imageManager.addImage(w,d[m][x]),n&&(this._changedImages[w]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),n&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.k("data",{dataType:"style"})),a&&a(c)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}_validateLayer(t){const n=this.sourceCaches[t.source];if(!n)return;const a=t.sourceLayer;if(!a)return;const c=n.getSource();(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(a)===-1)&&this.fire(new o.j(new Error(`Source layer "${a}" does not exist on source "${c.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t){const n=this._serializedAllLayers();if(!t||t.length===0)return Object.values(n);const a=[];for(const c of t)n[c]&&a.push(n[c]);return a}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const n=Object.keys(this._layers);for(const a of n){const c=this._layers[a];c.type!=="custom"&&(t[a]=c.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const n=this._changed;if(this._changed){const c=Object.keys(this._updatedLayers),d=Object.keys(this._removedLayers);(c.length||d.length)&&this._updateWorkerLayers(c,d);for(const m in this._updatedSources){const g=this._updatedSources[m];if(g==="reload")this._reloadSource(m);else{if(g!=="clear")throw new Error(`Invalid action ${g}`);this._clearSource(m)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const m in this._updatedPaintProps)this._layers[m].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const a={};for(const c in this.sourceCaches){const d=this.sourceCaches[c];a[c]=d.used,d.used=!1}for(const c of this._order){const d=this._layers[c];d.recalculate(t,this._availableImages),!d.isHidden(t.zoom)&&d.source&&(this.sourceCaches[d.source].used=!0)}for(const c in a){const d=this.sourceCaches[c];a[c]!==d.used&&d.fire(new o.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:c}))}this.light.recalculate(t),this.z=t.zoom,n&&this.fire(new o.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const n in this.sourceCaches)this.sourceCaches[n].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,n){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(t),removedIds:n})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,n={}){this._checkLoaded();const a=this.serialize();if(t=n.transformStyle?n.transformStyle(a,t):t,Ji(this,o.y(t)))return!1;(t=o.aD(t)).layers=o.aB(t.layers);const c=o.aE(a,t).filter(m=>!(m.command in fc));if(c.length===0)return!1;const d=c.filter(m=>!(m.command in Cr));if(d.length>0)throw new Error(`Unimplemented: ${d.map(m=>m.command).join(", ")}.`);for(const m of c)m.command!=="setTransition"&&this[m.command].apply(this,m.args);return this.stylesheet=t,this._serializedLayers=null,!0}addImage(t,n){if(this.getImage(t))return this.fire(new o.j(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,n),this._afterImageUpdated(t)}updateImage(t,n){this.imageManager.updateImage(t,n)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new o.j(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,n,a={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(o.y.source,`sources.${t}`,n,null,a))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const c=this.sourceCaches[t]=new Ii(t,n,this.dispatcher);c.style=this,c.setEventedParent(this,()=>({isSourceLoaded:c.loaded(),source:c.serialize(),sourceId:t})),c.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const a in this._layers)if(this._layers[a].source===t)return this.fire(new o.j(new Error(`Source "${t}" cannot be removed while layer "${a}" is using it.`)));const n=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],n.fire(new o.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),n.setEventedParent(null),n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,n){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const a=this.sourceCaches[t].getSource();if(a.type!=="geojson")throw new Error(`geojsonSource.type is ${a.type}, which is !== 'geojson`);a.setData(n),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,n,a={}){this._checkLoaded();const c=t.id;if(this.getLayer(c))return void this.fire(new o.j(new Error(`Layer "${c}" already exists on this map.`)));let d;if(t.type==="custom"){if(Ji(this,o.aF(t)))return;d=o.aC(t)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(c,t.source),t=o.aD(t),t=o.e(t,{source:c})),this._validate(o.y.layer,`layers.${c}`,t,{arrayIndex:-1},a))return;d=o.aC(t),this._validateLayer(d),d.setEventedParent(this,{layer:{id:c}})}const m=n?this._order.indexOf(n):this._order.length;if(n&&m===-1)this.fire(new o.j(new Error(`Cannot add layer "${c}" before non-existing layer "${n}".`)));else{if(this._order.splice(m,0,c),this._layerOrderChanged=!0,this._layers[c]=d,this._removedLayers[c]&&d.source&&d.type!=="custom"){const g=this._removedLayers[c];delete this._removedLayers[c],g.type!==d.type?this._updatedSources[d.source]="clear":(this._updatedSources[d.source]="reload",this.sourceCaches[d.source].pause())}this._updateLayer(d),d.onAdd&&d.onAdd(this.map)}}moveLayer(t,n){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new o.j(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===n)return;const a=this._order.indexOf(t);this._order.splice(a,1);const c=n?this._order.indexOf(n):this._order.length;n&&c===-1?this.fire(new o.j(new Error(`Cannot move layer "${t}" before non-existing layer "${n}".`))):(this._order.splice(c,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const n=this._layers[t];if(!n)return void this.fire(new o.j(new Error(`Cannot remove non-existing layer "${t}".`)));n.setEventedParent(null);const a=this._order.indexOf(t);this._order.splice(a,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=n,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],n.onRemove&&n.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,n,a){this._checkLoaded();const c=this.getLayer(t);c?c.minzoom===n&&c.maxzoom===a||(n!=null&&(c.minzoom=n),a!=null&&(c.maxzoom=a),this._updateLayer(c)):this.fire(new o.j(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,n,a={}){this._checkLoaded();const c=this.getLayer(t);if(c){if(!o.aG(c.filter,n))return n==null?(c.filter=void 0,void this._updateLayer(c)):void(this._validate(o.y.filter,`layers.${c.id}.filter`,n,null,a)||(c.filter=o.aD(n),this._updateLayer(c)))}else this.fire(new o.j(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return o.aD(this.getLayer(t).filter)}setLayoutProperty(t,n,a,c={}){this._checkLoaded();const d=this.getLayer(t);d?o.aG(d.getLayoutProperty(n),a)||(d.setLayoutProperty(n,a,c),this._updateLayer(d)):this.fire(new o.j(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,n){const a=this.getLayer(t);if(a)return a.getLayoutProperty(n);this.fire(new o.j(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,n,a,c={}){this._checkLoaded();const d=this.getLayer(t);d?o.aG(d.getPaintProperty(n),a)||(d.setPaintProperty(n,a,c)&&this._updateLayer(d),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new o.j(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,n){return this.getLayer(t).getPaintProperty(n)}setFeatureState(t,n){this._checkLoaded();const a=t.source,c=t.sourceLayer,d=this.sourceCaches[a];if(d===void 0)return void this.fire(new o.j(new Error(`The source '${a}' does not exist in the map's style.`)));const m=d.getSource().type;m==="geojson"&&c?this.fire(new o.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):m!=="vector"||c?(t.id===void 0&&this.fire(new o.j(new Error("The feature id parameter must be provided."))),d.setFeatureState(c,t.id,n)):this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,n){this._checkLoaded();const a=t.source,c=this.sourceCaches[a];if(c===void 0)return void this.fire(new o.j(new Error(`The source '${a}' does not exist in the map's style.`)));const d=c.getSource().type,m=d==="vector"?t.sourceLayer:void 0;d!=="vector"||m?n&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new o.j(new Error("A feature id is required to remove its specific state property."))):c.removeFeatureState(m,t.id,n):this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const n=t.source,a=t.sourceLayer,c=this.sourceCaches[n];if(c!==void 0)return c.getSource().type!=="vector"||a?(t.id===void 0&&this.fire(new o.j(new Error("The feature id parameter must be provided."))),c.getFeatureState(a,t.id)):void this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.j(new Error(`The source '${n}' does not exist in the map's style.`)))}getTransition(){return o.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=o.aH(this.sourceCaches,d=>d.serialize()),n=this._serializeByIds(this._order),a=this.map.getTerrain()||void 0,c=this.stylesheet;return o.aI({version:c.version,name:c.name,metadata:c.metadata,light:c.light,center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch,sprite:c.sprite,glyphs:c.glyphs,transition:c.transition,sources:t,layers:n,terrain:a},d=>d!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const n=m=>this._layers[m].type==="fill-extrusion",a={},c=[];for(let m=this._order.length-1;m>=0;m--){const g=this._order[m];if(n(g)){a[g]=m;for(const x of t){const w=x[g];if(w)for(const C of w)c.push(C)}}}c.sort((m,g)=>g.intersectionZ-m.intersectionZ);const d=[];for(let m=this._order.length-1;m>=0;m--){const g=this._order[m];if(n(g))for(let x=c.length-1;x>=0;x--){const w=c[x].feature;if(a[w.layer.id]<m)break;d.push(w),c.pop()}else for(const x of t){const w=x[g];if(w)for(const C of w)d.push(C.feature)}}return d}queryRenderedFeatures(t,n,a){n&&n.filter&&this._validate(o.y.filter,"queryRenderedFeatures.filter",n.filter,null,n);const c={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new o.j(new Error("parameters.layers must be an Array."))),[];for(const g of n.layers){const x=this._layers[g];if(!x)return this.fire(new o.j(new Error(`The layer '${g}' does not exist in the map's style and cannot be queried for features.`))),[];c[x.source]=!0}}const d=[];n.availableImages=this._availableImages;const m=this._serializedAllLayers();for(const g in this.sourceCaches)n.layers&&!c[g]||d.push(pr(this.sourceCaches[g],this._layers,m,t,n,a));return this.placement&&d.push(function(g,x,w,C,T,z,V){const j={},Z=z.queryRenderedSymbols(C),N=[];for(const te of Object.keys(Z).map(Number))N.push(V[te]);N.sort(nr);for(const te of N){const le=te.featureIndex.lookupSymbolFeatures(Z[te.bucketInstanceId],x,te.bucketIndex,te.sourceLayerIndex,T.filter,T.layers,T.availableImages,g);for(const K in le){const re=j[K]=j[K]||[],he=le[K];he.sort((pe,xe)=>{const Ie=te.featureSortOrder;if(Ie){const Se=Ie.indexOf(pe.featureIndex);return Ie.indexOf(xe.featureIndex)-Se}return xe.featureIndex-pe.featureIndex});for(const pe of he)re.push(pe)}}for(const te in j)j[te].forEach(le=>{const K=le.feature,re=w[g[te].source].getFeatureState(K.layer["source-layer"],K.id);K.source=K.layer.source,K.layer["source-layer"]&&(K.sourceLayer=K.layer["source-layer"]),K.state=re});return j}(this._layers,m,this.sourceCaches,t,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(d)}querySourceFeatures(t,n){n&&n.filter&&this._validate(o.y.filter,"querySourceFeatures.filter",n.filter,null,n);const a=this.sourceCaches[t];return a?function(c,d){const m=c.getRenderableIds().map(w=>c.getTileByID(w)),g=[],x={};for(let w=0;w<m.length;w++){const C=m[w],T=C.tileID.canonical.key;x[T]||(x[T]=!0,C.querySourceFeatures(g,d))}return g}(a,n):[]}addSourceType(t,n,a){return Ti(t)?a(new Error(`A source type called "${t}" already exists.`)):(((c,d)=>{Wt[c]=d})(t,n),n.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:n.workerSourceURL},a):a(null,null))}getLight(){return this.light.getLight()}setLight(t,n={}){this._checkLoaded();const a=this.light.getLight();let c=!1;for(const m in t)if(!o.aG(t[m],a[m])){c=!0;break}if(!c)return;const d={now:o.h.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,n),this.light.updateTransitions(d)}_validate(t,n,a,c,d={}){return(!d||d.validate!==!1)&&Ji(this,t.call(o.y,o.e({key:n,style:this.serialize(),value:a,styleSpec:o.v},c)))}_remove(t=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.aJ.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this.sourceCaches){const a=this.sourceCaches[n];a.setEventedParent(null),a.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const n in this.sourceCaches)this.sourceCaches[n].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,n,a,c,d=!1){let m=!1,g=!1;const x={};for(const w of this._order){const C=this._layers[w];if(C.type!=="symbol")continue;if(!x[C.source]){const z=this.sourceCaches[C.source];x[C.source]=z.getRenderableIds(!0).map(V=>z.getTileByID(V)).sort((V,j)=>j.tileID.overscaledZ-V.tileID.overscaledZ||(V.tileID.isLessThan(j.tileID)?-1:1))}const T=this.crossTileSymbolIndex.addLayer(C,x[C.source],t.center.lng);m=m||T}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((d=d||this._layerOrderChanged||a===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.h.now(),t.zoom))&&(this.pauseablePlacement=new Yn(t,this.map.terrain,this._order,d,n,a,c,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,x),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.h.now()),g=!0),m&&this.pauseablePlacement.placement.setStale()),g||m)for(const w of this._order){const C=this._layers[w];C.type==="symbol"&&this.placement.updateLayerOpacities(C,x[C.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.h.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,n,a){this.imageManager.getImages(n.icons,a),this._updateTilesForChangedImages();const c=this.sourceCaches[n.source];c&&c.setDependencies(n.tileID.key,n.type,n.icons)}getGlyphs(t,n,a){this.glyphManager.getGlyphs(n.stacks,a);const c=this.sourceCaches[n.source];c&&c.setDependencies(n.tileID.key,n.type,[""])}getResource(t,n,a){return o.m(n,a)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,n={}){this._checkLoaded(),t&&this._validate(o.y.glyphs,"glyphs",t,null,n)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,n,a={},c){this._checkLoaded();const d=[{id:t,url:n}],m=[...He(this.stylesheet.sprite),...d];this._validate(o.y.sprite,"sprite",m,null,a)||(this.stylesheet.sprite=m,this._loadSprite(d,!0,c))}removeSprite(t){this._checkLoaded();const n=He(this.stylesheet.sprite);if(n.find(a=>a.id===t)){if(this._spritesImagesIds[t])for(const a of this._spritesImagesIds[t])this.imageManager.removeImage(a),this._changedImages[a]=!0;n.splice(n.findIndex(a=>a.id===t),1),this.stylesheet.sprite=n.length>0?n:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}else this.fire(new o.j(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return He(this.stylesheet.sprite)}setSprite(t,n={},a){this._checkLoaded(),t&&this._validate(o.y.sprite,"sprite",t,null,n)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,a):(this._unloadSprite(),a&&a(null)))}}Zi.registerForPluginStateChange=o.aK;var Hs=o.Q([{name:"a_pos",type:"Int16",components:2}]),Qn="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const li={prelude:Ot(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Ot(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Ot(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Ot(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Ot("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ot(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Ot(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Ot("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ot("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Ot("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Ot(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Ot(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Ot(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Ot(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Ot(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Ot(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Ot(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ot(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Ot(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Ot(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Ot(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Ot(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Ot(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Ot(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Ot(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Ot(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Ot("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Qn),terrainDepth:Ot("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Qn),terrainCoords:Ot("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Qn)};function Ot(u,t){const n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,a=t.match(/attribute ([\w]+) ([\w]+)/g),c=u.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),d=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),m=d?d.concat(c):c,g={};return{fragmentSource:u=u.replace(n,(x,w,C,T,z)=>(g[z]=!0,w==="define"?`
#ifndef HAS_UNIFORM_u_${z}
varying ${C} ${T} ${z};
#else
uniform ${C} ${T} u_${z};
#endif
`:`
#ifdef HAS_UNIFORM_u_${z}
    ${C} ${T} ${z} = u_${z};
#endif
`)),vertexSource:t=t.replace(n,(x,w,C,T,z)=>{const V=T==="float"?"vec2":"vec4",j=z.match(/color/)?"color":V;return g[z]?w==="define"?`
#ifndef HAS_UNIFORM_u_${z}
uniform lowp float u_${z}_t;
attribute ${C} ${V} a_${z};
varying ${C} ${T} ${z};
#else
uniform ${C} ${T} u_${z};
#endif
`:j==="vec4"?`
#ifndef HAS_UNIFORM_u_${z}
    ${z} = a_${z};
#else
    ${C} ${T} ${z} = u_${z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${z}
    ${z} = unpack_mix_${j}(a_${z}, u_${z}_t);
#else
    ${C} ${T} ${z} = u_${z};
#endif
`:w==="define"?`
#ifndef HAS_UNIFORM_u_${z}
uniform lowp float u_${z}_t;
attribute ${C} ${V} a_${z};
#else
uniform ${C} ${T} u_${z};
#endif
`:j==="vec4"?`
#ifndef HAS_UNIFORM_u_${z}
    ${C} ${T} ${z} = a_${z};
#else
    ${C} ${T} ${z} = u_${z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${z}
    ${C} ${T} ${z} = unpack_mix_${j}(a_${z}, u_${z}_t);
#else
    ${C} ${T} ${z} = u_${z};
#endif
`}),staticAttributes:a,staticUniforms:m}}class Ln{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,n,a,c,d,m,g,x,w){this.context=t;let C=this.boundPaintVertexBuffers.length!==c.length;for(let T=0;!C&&T<c.length;T++)this.boundPaintVertexBuffers[T]!==c[T]&&(C=!0);!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==a||C||this.boundIndexBuffer!==d||this.boundVertexOffset!==m||this.boundDynamicVertexBuffer!==g||this.boundDynamicVertexBuffer2!==x||this.boundDynamicVertexBuffer3!==w?this.freshBind(n,a,c,d,m,g,x,w):(t.bindVertexArray.set(this.vao),g&&g.bind(),d&&d.dynamicDraw&&d.bind(),x&&x.bind(),w&&w.bind())}freshBind(t,n,a,c,d,m,g,x){const w=t.numAttributes,C=this.context,T=C.gl;this.vao&&this.destroy(),this.vao=C.createVertexArray(),C.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=a,this.boundIndexBuffer=c,this.boundVertexOffset=d,this.boundDynamicVertexBuffer=m,this.boundDynamicVertexBuffer2=g,this.boundDynamicVertexBuffer3=x,n.enableAttributes(T,t);for(const z of a)z.enableAttributes(T,t);m&&m.enableAttributes(T,t),g&&g.enableAttributes(T,t),x&&x.enableAttributes(T,t),n.bind(),n.setVertexAttribPointers(T,t,d);for(const z of a)z.bind(),z.setVertexAttribPointers(T,t,d);m&&(m.bind(),m.setVertexAttribPointers(T,t,d)),c&&c.bind(),g&&(g.bind(),g.setVertexAttribPointers(T,t,d)),x&&(x.bind(),x.setVertexAttribPointers(T,t,d)),C.currentNumAttributes=w}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function pi(u){const t=[];for(let n=0;n<u.length;n++){if(u[n]===null)continue;const a=u[n].split(" ");t.push(a.pop())}return t}class Ws{constructor(t,n,a,c,d,m){const g=t.gl;this.program=g.createProgram();const x=pi(n.staticAttributes),w=a?a.getBinderAttributes():[],C=x.concat(w),T=li.prelude.staticUniforms?pi(li.prelude.staticUniforms):[],z=n.staticUniforms?pi(n.staticUniforms):[],V=a?a.getBinderUniforms():[],j=T.concat(z).concat(V),Z=[];for(const pe of j)Z.indexOf(pe)<0&&Z.push(pe);const N=a?a.defines():[];d&&N.push("#define OVERDRAW_INSPECTOR;"),m&&N.push("#define TERRAIN3D;");const te=N.concat(li.prelude.fragmentSource,n.fragmentSource).join(`
`),le=N.concat(li.prelude.vertexSource,n.vertexSource).join(`
`),K=g.createShader(g.FRAGMENT_SHADER);if(g.isContextLost())return void(this.failedToCreate=!0);if(g.shaderSource(K,te),g.compileShader(K),!g.getShaderParameter(K,g.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${g.getShaderInfoLog(K)}`);g.attachShader(this.program,K);const re=g.createShader(g.VERTEX_SHADER);if(g.isContextLost())return void(this.failedToCreate=!0);if(g.shaderSource(re,le),g.compileShader(re),!g.getShaderParameter(re,g.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${g.getShaderInfoLog(re)}`);g.attachShader(this.program,re),this.attributes={};const he={};this.numAttributes=C.length;for(let pe=0;pe<this.numAttributes;pe++)C[pe]&&(g.bindAttribLocation(this.program,pe,C[pe]),this.attributes[C[pe]]=pe);if(g.linkProgram(this.program),!g.getProgramParameter(this.program,g.LINK_STATUS))throw new Error(`Program failed to link: ${g.getProgramInfoLog(this.program)}`);g.deleteShader(re),g.deleteShader(K);for(let pe=0;pe<Z.length;pe++){const xe=Z[pe];if(xe&&!he[xe]){const Ie=g.getUniformLocation(this.program,xe);Ie&&(he[xe]=Ie)}}this.fixedUniforms=c(t,he),this.terrainUniforms=((pe,xe)=>({u_depth:new o.aL(pe,xe.u_depth),u_terrain:new o.aL(pe,xe.u_terrain),u_terrain_dim:new o.aM(pe,xe.u_terrain_dim),u_terrain_matrix:new o.aN(pe,xe.u_terrain_matrix),u_terrain_unpack:new o.aO(pe,xe.u_terrain_unpack),u_terrain_exaggeration:new o.aM(pe,xe.u_terrain_exaggeration)}))(t,he),this.binderUniforms=a?a.getUniforms(t,he):[]}draw(t,n,a,c,d,m,g,x,w,C,T,z,V,j,Z,N,te,le){const K=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(a),t.setStencilMode(c),t.setColorMode(d),t.setCullFace(m),x){t.activeTexture.set(K.TEXTURE2),K.bindTexture(K.TEXTURE_2D,x.depthTexture),t.activeTexture.set(K.TEXTURE3),K.bindTexture(K.TEXTURE_2D,x.texture);for(const he in this.terrainUniforms)this.terrainUniforms[he].set(x[he])}for(const he in this.fixedUniforms)this.fixedUniforms[he].set(g[he]);Z&&Z.setUniforms(t,this.binderUniforms,V,{zoom:j});let re=0;switch(n){case K.LINES:re=2;break;case K.TRIANGLES:re=3;break;case K.LINE_STRIP:re=1}for(const he of z.get()){const pe=he.vaos||(he.vaos={});(pe[w]||(pe[w]=new Ln)).bind(t,this,C,Z?Z.getPaintVertexBuffers():[],T,he.vertexOffset,N,te,le),K.drawElements(n,he.primitiveLength*re,K.UNSIGNED_SHORT,he.primitiveOffset*re*2)}}}function Br(u,t,n){const a=1/ee(n,1,t.transform.tileZoom),c=Math.pow(2,n.tileID.overscaledZ),d=n.tileSize*Math.pow(2,t.transform.tileZoom)/c,m=d*(n.tileID.canonical.x+n.tileID.wrap*c),g=d*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[a,u.fromScale,u.toScale],u_fade:u.t,u_pixel_coord_upper:[m>>16,g>>16],u_pixel_coord_lower:[65535&m,65535&g]}}const Fa=(u,t,n,a)=>{const c=t.style.light,d=c.properties.get("position"),m=[d.x,d.y,d.z],g=function(){var w=new o.A(9);return o.A!=Float32Array&&(w[1]=0,w[2]=0,w[3]=0,w[5]=0,w[6]=0,w[7]=0),w[0]=1,w[4]=1,w[8]=1,w}();c.properties.get("anchor")==="viewport"&&function(w,C){var T=Math.sin(C),z=Math.cos(C);w[0]=z,w[1]=T,w[2]=0,w[3]=-T,w[4]=z,w[5]=0,w[6]=0,w[7]=0,w[8]=1}(g,-t.transform.angle),function(w,C,T){var z=C[0],V=C[1],j=C[2];w[0]=z*T[0]+V*T[3]+j*T[6],w[1]=z*T[1]+V*T[4]+j*T[7],w[2]=z*T[2]+V*T[5]+j*T[8]}(m,m,g);const x=c.properties.get("color");return{u_matrix:u,u_lightpos:m,u_lightintensity:c.properties.get("intensity"),u_lightcolor:[x.r,x.g,x.b],u_vertical_gradient:+n,u_opacity:a}},Sn=(u,t,n,a,c,d,m)=>o.e(Fa(u,t,n,a),Br(d,t,m),{u_height_factor:-Math.pow(2,c.overscaledZ)/m.tileSize/8}),Ko=u=>({u_matrix:u}),Ba=(u,t,n,a)=>o.e(Ko(u),Br(n,t,a)),Xs=(u,t)=>({u_matrix:u,u_world:t}),Ks=(u,t,n,a,c)=>o.e(Ba(u,t,n,a),{u_world:c}),Cn=(u,t,n,a)=>{const c=u.transform;let d,m;if(a.paint.get("circle-pitch-alignment")==="map"){const g=ee(n,1,c.zoom);d=!0,m=[g,g]}else d=!1,m=c.pixelsToGLUnits;return{u_camera_to_center_distance:c.cameraToCenterDistance,u_scale_with_map:+(a.paint.get("circle-pitch-scale")==="map"),u_matrix:u.translatePosMatrix(t.posMatrix,n,a.paint.get("circle-translate"),a.paint.get("circle-translate-anchor")),u_pitch_with_map:+d,u_device_pixel_ratio:u.pixelRatio,u_extrude_scale:m}},Oa=(u,t,n)=>{const a=ee(n,1,t.zoom),c=Math.pow(2,t.zoom-n.tileID.overscaledZ),d=n.tileID.overscaleFactor();return{u_matrix:u,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:a,u_extrude_scale:[t.pixelsToGLUnits[0]/(a*c),t.pixelsToGLUnits[1]/(a*c)],u_overscale_factor:d}},bs=(u,t,n=1)=>({u_matrix:u,u_color:t,u_overlay:0,u_overlay_scale:n}),Yo=u=>({u_matrix:u}),mc=(u,t,n,a)=>({u_matrix:u,u_extrude_scale:ee(t,1,n),u_intensity:a});function Na(u,t){const n=Math.pow(2,t.canonical.z),a=t.canonical.y;return[new o.U(0,a/n).toLngLat().lat,new o.U(0,(a+1)/n).toLngLat().lat]}const $a=(u,t,n,a)=>{const c=u.transform;return{u_matrix:Ys(u,t,n,a),u_ratio:1/ee(t,1,c.zoom),u_device_pixel_ratio:u.pixelRatio,u_units_to_pixels:[1/c.pixelsToGLUnits[0],1/c.pixelsToGLUnits[1]]}},Jo=(u,t,n,a,c)=>o.e($a(u,t,n,c),{u_image:0,u_image_height:a}),gc=(u,t,n,a,c)=>{const d=u.transform,m=el(t,d);return{u_matrix:Ys(u,t,n,c),u_texsize:t.imageAtlasTexture.size,u_ratio:1/ee(t,1,d.zoom),u_device_pixel_ratio:u.pixelRatio,u_image:0,u_scale:[m,a.fromScale,a.toScale],u_fade:a.t,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},Qo=(u,t,n,a,c,d)=>{const m=u.lineAtlas,g=el(t,u.transform),x=n.layout.get("line-cap")==="round",w=m.getDash(a.from,x),C=m.getDash(a.to,x),T=w.width*c.fromScale,z=C.width*c.toScale;return o.e($a(u,t,n,d),{u_patternscale_a:[g/T,-w.height/2],u_patternscale_b:[g/z,-C.height/2],u_sdfgamma:m.width/(256*Math.min(T,z)*u.pixelRatio)/2,u_image:0,u_tex_y_a:w.y,u_tex_y_b:C.y,u_mix:c.t})};function el(u,t){return 1/ee(u,1,t.tileZoom)}function Ys(u,t,n,a){return u.translatePosMatrix(a?a.posMatrix:t.tileID.posMatrix,t,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const tl=(u,t,n,a,c)=>{return{u_matrix:u,u_tl_parent:t,u_scale_parent:n,u_buffer_scale:1,u_fade_t:a.mix,u_opacity:a.opacity*c.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:c.paint.get("raster-brightness-min"),u_brightness_high:c.paint.get("raster-brightness-max"),u_saturation_factor:(m=c.paint.get("raster-saturation"),m>0?1-1/(1.001-m):-m),u_contrast_factor:(d=c.paint.get("raster-contrast"),d>0?1/(1-d):1+d),u_spin_weights:il(c.paint.get("raster-hue-rotate"))};var d,m};function il(u){u*=Math.PI/180;const t=Math.sin(u),n=Math.cos(u);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}const ja=(u,t,n,a,c,d,m,g,x,w)=>{const C=c.transform;return{u_is_size_zoom_constant:+(u==="constant"||u==="source"),u_is_size_feature_constant:+(u==="constant"||u==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:C.cameraToCenterDistance,u_pitch:C.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:C.width/C.height,u_fade_change:c.options.fadeDuration?c.symbolFadeChange:1,u_matrix:d,u_label_plane_matrix:m,u_coord_matrix:g,u_is_text:+x,u_pitch_with_map:+a,u_texsize:w,u_texture:0}},Va=(u,t,n,a,c,d,m,g,x,w,C)=>{const T=c.transform;return o.e(ja(u,t,n,a,c,d,m,g,x,w),{u_gamma_scale:a?Math.cos(T._pitch)*T.cameraToCenterDistance:1,u_device_pixel_ratio:c.pixelRatio,u_is_halo:+C})},Rn=(u,t,n,a,c,d,m,g,x,w)=>o.e(Va(u,t,n,a,c,d,m,g,!0,x,!0),{u_texsize_icon:w,u_texture_icon:1}),Js=(u,t,n)=>({u_matrix:u,u_opacity:t,u_color:n}),Or=(u,t,n,a,c,d)=>o.e(function(m,g,x,w){const C=x.imageManager.getPattern(m.from.toString()),T=x.imageManager.getPattern(m.to.toString()),{width:z,height:V}=x.imageManager.getPixelSize(),j=Math.pow(2,w.tileID.overscaledZ),Z=w.tileSize*Math.pow(2,x.transform.tileZoom)/j,N=Z*(w.tileID.canonical.x+w.tileID.wrap*j),te=Z*w.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:C.tl,u_pattern_br_a:C.br,u_pattern_tl_b:T.tl,u_pattern_br_b:T.br,u_texsize:[z,V],u_mix:g.t,u_pattern_size_a:C.displaySize,u_pattern_size_b:T.displaySize,u_scale_a:g.fromScale,u_scale_b:g.toScale,u_tile_units_to_pixels:1/ee(w,1,x.transform.tileZoom),u_pixel_coord_upper:[N>>16,te>>16],u_pixel_coord_lower:[65535&N,65535&te]}}(a,d,n,c),{u_matrix:u,u_opacity:t}),Qs={fillExtrusion:(u,t)=>({u_matrix:new o.aN(u,t.u_matrix),u_lightpos:new o.aP(u,t.u_lightpos),u_lightintensity:new o.aM(u,t.u_lightintensity),u_lightcolor:new o.aP(u,t.u_lightcolor),u_vertical_gradient:new o.aM(u,t.u_vertical_gradient),u_opacity:new o.aM(u,t.u_opacity)}),fillExtrusionPattern:(u,t)=>({u_matrix:new o.aN(u,t.u_matrix),u_lightpos:new o.aP(u,t.u_lightpos),u_lightintensity:new o.aM(u,t.u_lightintensity),u_lightcolor:new o.aP(u,t.u_lightcolor),u_vertical_gradient:new o.aM(u,t.u_vertical_gradient),u_height_factor:new o.aM(u,t.u_height_factor),u_image:new o.aL(u,t.u_image),u_texsize:new o.aQ(u,t.u_texsize),u_pixel_coord_upper:new o.aQ(u,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.aQ(u,t.u_pixel_coord_lower),u_scale:new o.aP(u,t.u_scale),u_fade:new o.aM(u,t.u_fade),u_opacity:new o.aM(u,t.u_opacity)}),fill:(u,t)=>({u_matrix:new o.aN(u,t.u_matrix)}),fillPattern:(u,t)=>({u_matrix:new o.aN(u,t.u_matrix),u_image:new o.aL(u,t.u_image),u_texsize:new o.aQ(u,t.u_texsize),u_pixel_coord_upper:new o.aQ(u,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.aQ(u,t.u_pixel_coord_lower),u_scale:new o.aP(u,t.u_scale),u_fade:new o.aM(u,t.u_fade)}),fillOutline:(u,t)=>({u_matrix:new o.aN(u,t.u_matrix),u_world:new o.aQ(u,t.u_world)}),fillOutlinePattern:(u,t)=>({u_matrix:new o.aN(u,t.u_matrix),u_world:new o.aQ(u,t.u_world),u_image:new o.aL(u,t.u_image),u_texsize:new o.aQ(u,t.u_texsize),u_pixel_coord_upper:new o.aQ(u,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.aQ(u,t.u_pixel_coord_lower),u_scale:new o.aP(u,t.u_scale),u_fade:new o.aM(u,t.u_fade)}),circle:(u,t)=>({u_camera_to_center_distance:new o.aM(u,t.u_camera_to_center_distance),u_scale_with_map:new o.aL(u,t.u_scale_with_map),u_pitch_with_map:new o.aL(u,t.u_pitch_with_map),u_extrude_scale:new o.aQ(u,t.u_extrude_scale),u_device_pixel_ratio:new o.aM(u,t.u_device_pixel_ratio),u_matrix:new o.aN(u,t.u_matrix)}),collisionBox:(u,t)=>({u_matrix:new o.aN(u,t.u_matrix),u_camera_to_center_distance:new o.aM(u,t.u_camera_to_center_distance),u_pixels_to_tile_units:new o.aM(u,t.u_pixels_to_tile_units),u_extrude_scale:new o.aQ(u,t.u_extrude_scale),u_overscale_factor:new o.aM(u,t.u_overscale_factor)}),collisionCircle:(u,t)=>({u_matrix:new o.aN(u,t.u_matrix),u_inv_matrix:new o.aN(u,t.u_inv_matrix),u_camera_to_center_distance:new o.aM(u,t.u_camera_to_center_distance),u_viewport_size:new o.aQ(u,t.u_viewport_size)}),debug:(u,t)=>({u_color:new o.aR(u,t.u_color),u_matrix:new o.aN(u,t.u_matrix),u_overlay:new o.aL(u,t.u_overlay),u_overlay_scale:new o.aM(u,t.u_overlay_scale)}),clippingMask:(u,t)=>({u_matrix:new o.aN(u,t.u_matrix)}),heatmap:(u,t)=>({u_extrude_scale:new o.aM(u,t.u_extrude_scale),u_intensity:new o.aM(u,t.u_intensity),u_matrix:new o.aN(u,t.u_matrix)}),heatmapTexture:(u,t)=>({u_matrix:new o.aN(u,t.u_matrix),u_world:new o.aQ(u,t.u_world),u_image:new o.aL(u,t.u_image),u_color_ramp:new o.aL(u,t.u_color_ramp),u_opacity:new o.aM(u,t.u_opacity)}),hillshade:(u,t)=>({u_matrix:new o.aN(u,t.u_matrix),u_image:new o.aL(u,t.u_image),u_latrange:new o.aQ(u,t.u_latrange),u_light:new o.aQ(u,t.u_light),u_shadow:new o.aR(u,t.u_shadow),u_highlight:new o.aR(u,t.u_highlight),u_accent:new o.aR(u,t.u_accent)}),hillshadePrepare:(u,t)=>({u_matrix:new o.aN(u,t.u_matrix),u_image:new o.aL(u,t.u_image),u_dimension:new o.aQ(u,t.u_dimension),u_zoom:new o.aM(u,t.u_zoom),u_unpack:new o.aO(u,t.u_unpack)}),line:(u,t)=>({u_matrix:new o.aN(u,t.u_matrix),u_ratio:new o.aM(u,t.u_ratio),u_device_pixel_ratio:new o.aM(u,t.u_device_pixel_ratio),u_units_to_pixels:new o.aQ(u,t.u_units_to_pixels)}),lineGradient:(u,t)=>({u_matrix:new o.aN(u,t.u_matrix),u_ratio:new o.aM(u,t.u_ratio),u_device_pixel_ratio:new o.aM(u,t.u_device_pixel_ratio),u_units_to_pixels:new o.aQ(u,t.u_units_to_pixels),u_image:new o.aL(u,t.u_image),u_image_height:new o.aM(u,t.u_image_height)}),linePattern:(u,t)=>({u_matrix:new o.aN(u,t.u_matrix),u_texsize:new o.aQ(u,t.u_texsize),u_ratio:new o.aM(u,t.u_ratio),u_device_pixel_ratio:new o.aM(u,t.u_device_pixel_ratio),u_image:new o.aL(u,t.u_image),u_units_to_pixels:new o.aQ(u,t.u_units_to_pixels),u_scale:new o.aP(u,t.u_scale),u_fade:new o.aM(u,t.u_fade)}),lineSDF:(u,t)=>({u_matrix:new o.aN(u,t.u_matrix),u_ratio:new o.aM(u,t.u_ratio),u_device_pixel_ratio:new o.aM(u,t.u_device_pixel_ratio),u_units_to_pixels:new o.aQ(u,t.u_units_to_pixels),u_patternscale_a:new o.aQ(u,t.u_patternscale_a),u_patternscale_b:new o.aQ(u,t.u_patternscale_b),u_sdfgamma:new o.aM(u,t.u_sdfgamma),u_image:new o.aL(u,t.u_image),u_tex_y_a:new o.aM(u,t.u_tex_y_a),u_tex_y_b:new o.aM(u,t.u_tex_y_b),u_mix:new o.aM(u,t.u_mix)}),raster:(u,t)=>({u_matrix:new o.aN(u,t.u_matrix),u_tl_parent:new o.aQ(u,t.u_tl_parent),u_scale_parent:new o.aM(u,t.u_scale_parent),u_buffer_scale:new o.aM(u,t.u_buffer_scale),u_fade_t:new o.aM(u,t.u_fade_t),u_opacity:new o.aM(u,t.u_opacity),u_image0:new o.aL(u,t.u_image0),u_image1:new o.aL(u,t.u_image1),u_brightness_low:new o.aM(u,t.u_brightness_low),u_brightness_high:new o.aM(u,t.u_brightness_high),u_saturation_factor:new o.aM(u,t.u_saturation_factor),u_contrast_factor:new o.aM(u,t.u_contrast_factor),u_spin_weights:new o.aP(u,t.u_spin_weights)}),symbolIcon:(u,t)=>({u_is_size_zoom_constant:new o.aL(u,t.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aL(u,t.u_is_size_feature_constant),u_size_t:new o.aM(u,t.u_size_t),u_size:new o.aM(u,t.u_size),u_camera_to_center_distance:new o.aM(u,t.u_camera_to_center_distance),u_pitch:new o.aM(u,t.u_pitch),u_rotate_symbol:new o.aL(u,t.u_rotate_symbol),u_aspect_ratio:new o.aM(u,t.u_aspect_ratio),u_fade_change:new o.aM(u,t.u_fade_change),u_matrix:new o.aN(u,t.u_matrix),u_label_plane_matrix:new o.aN(u,t.u_label_plane_matrix),u_coord_matrix:new o.aN(u,t.u_coord_matrix),u_is_text:new o.aL(u,t.u_is_text),u_pitch_with_map:new o.aL(u,t.u_pitch_with_map),u_texsize:new o.aQ(u,t.u_texsize),u_texture:new o.aL(u,t.u_texture)}),symbolSDF:(u,t)=>({u_is_size_zoom_constant:new o.aL(u,t.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aL(u,t.u_is_size_feature_constant),u_size_t:new o.aM(u,t.u_size_t),u_size:new o.aM(u,t.u_size),u_camera_to_center_distance:new o.aM(u,t.u_camera_to_center_distance),u_pitch:new o.aM(u,t.u_pitch),u_rotate_symbol:new o.aL(u,t.u_rotate_symbol),u_aspect_ratio:new o.aM(u,t.u_aspect_ratio),u_fade_change:new o.aM(u,t.u_fade_change),u_matrix:new o.aN(u,t.u_matrix),u_label_plane_matrix:new o.aN(u,t.u_label_plane_matrix),u_coord_matrix:new o.aN(u,t.u_coord_matrix),u_is_text:new o.aL(u,t.u_is_text),u_pitch_with_map:new o.aL(u,t.u_pitch_with_map),u_texsize:new o.aQ(u,t.u_texsize),u_texture:new o.aL(u,t.u_texture),u_gamma_scale:new o.aM(u,t.u_gamma_scale),u_device_pixel_ratio:new o.aM(u,t.u_device_pixel_ratio),u_is_halo:new o.aL(u,t.u_is_halo)}),symbolTextAndIcon:(u,t)=>({u_is_size_zoom_constant:new o.aL(u,t.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aL(u,t.u_is_size_feature_constant),u_size_t:new o.aM(u,t.u_size_t),u_size:new o.aM(u,t.u_size),u_camera_to_center_distance:new o.aM(u,t.u_camera_to_center_distance),u_pitch:new o.aM(u,t.u_pitch),u_rotate_symbol:new o.aL(u,t.u_rotate_symbol),u_aspect_ratio:new o.aM(u,t.u_aspect_ratio),u_fade_change:new o.aM(u,t.u_fade_change),u_matrix:new o.aN(u,t.u_matrix),u_label_plane_matrix:new o.aN(u,t.u_label_plane_matrix),u_coord_matrix:new o.aN(u,t.u_coord_matrix),u_is_text:new o.aL(u,t.u_is_text),u_pitch_with_map:new o.aL(u,t.u_pitch_with_map),u_texsize:new o.aQ(u,t.u_texsize),u_texsize_icon:new o.aQ(u,t.u_texsize_icon),u_texture:new o.aL(u,t.u_texture),u_texture_icon:new o.aL(u,t.u_texture_icon),u_gamma_scale:new o.aM(u,t.u_gamma_scale),u_device_pixel_ratio:new o.aM(u,t.u_device_pixel_ratio),u_is_halo:new o.aL(u,t.u_is_halo)}),background:(u,t)=>({u_matrix:new o.aN(u,t.u_matrix),u_opacity:new o.aM(u,t.u_opacity),u_color:new o.aR(u,t.u_color)}),backgroundPattern:(u,t)=>({u_matrix:new o.aN(u,t.u_matrix),u_opacity:new o.aM(u,t.u_opacity),u_image:new o.aL(u,t.u_image),u_pattern_tl_a:new o.aQ(u,t.u_pattern_tl_a),u_pattern_br_a:new o.aQ(u,t.u_pattern_br_a),u_pattern_tl_b:new o.aQ(u,t.u_pattern_tl_b),u_pattern_br_b:new o.aQ(u,t.u_pattern_br_b),u_texsize:new o.aQ(u,t.u_texsize),u_mix:new o.aM(u,t.u_mix),u_pattern_size_a:new o.aQ(u,t.u_pattern_size_a),u_pattern_size_b:new o.aQ(u,t.u_pattern_size_b),u_scale_a:new o.aM(u,t.u_scale_a),u_scale_b:new o.aM(u,t.u_scale_b),u_pixel_coord_upper:new o.aQ(u,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.aQ(u,t.u_pixel_coord_lower),u_tile_units_to_pixels:new o.aM(u,t.u_tile_units_to_pixels)}),terrain:(u,t)=>({u_matrix:new o.aN(u,t.u_matrix),u_texture:new o.aL(u,t.u_texture),u_ele_delta:new o.aM(u,t.u_ele_delta)}),terrainDepth:(u,t)=>({u_matrix:new o.aN(u,t.u_matrix),u_ele_delta:new o.aM(u,t.u_ele_delta)}),terrainCoords:(u,t)=>({u_matrix:new o.aN(u,t.u_matrix),u_texture:new o.aL(u,t.u_texture),u_terrain_coords_id:new o.aM(u,t.u_terrain_coords_id),u_ele_delta:new o.aM(u,t.u_ele_delta)})};class ea{constructor(t,n,a){this.context=t;const c=t.gl;this.buffer=c.createBuffer(),this.dynamicDraw=!!a,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),c.bufferData(c.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?c.DYNAMIC_DRAW:c.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const n=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ws={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ta{constructor(t,n,a,c){this.length=n.length,this.attributes=a,this.itemSize=n.bytesPerElement,this.dynamicDraw=c,this.context=t;const d=t.gl;this.buffer=d.createBuffer(),t.bindVertexBuffer.set(this.buffer),d.bufferData(d.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,n){for(let a=0;a<this.attributes.length;a++){const c=n.attributes[this.attributes[a].name];c!==void 0&&t.enableVertexAttribArray(c)}}setVertexAttribPointers(t,n,a){for(let c=0;c<this.attributes.length;c++){const d=this.attributes[c],m=n.attributes[d.name];m!==void 0&&t.vertexAttribPointer(m,d.components,t[ws[d.type]],!1,this.itemSize,d.offset+this.itemSize*(a||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const es=new WeakMap;function Tn(u){var t;if(es.has(u))return es.get(u);{const n=(t=u.getParameter(u.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return es.set(u,n),n}}class At{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ia extends At{getDefault(){return o.aT.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Tr extends At{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Ir extends At{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Ua extends At{getDefault(){return[!0,!0,!0,!0]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class ra extends At{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class na extends At{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class qa extends At{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const n=this.current;(t.func!==n.func||t.ref!==n.ref||t.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Za extends At{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class sa extends At{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=t,this.dirty=!1}}class Ga extends At{getDefault(){return[0,1]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Ha extends At{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=t,this.dirty=!1}}class aa extends At{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class rl extends At{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.BLEND):n.disable(n.BLEND),this.current=t,this.dirty=!1}}class nl extends At{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class ts extends At{getDefault(){return o.aT.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class _c extends At{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class yc extends At{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=t,this.dirty=!1}}class xc extends At{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class vc extends At{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class bc extends At{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class wc extends At{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Wa extends At{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class oa extends At{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Xa extends At{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Ka extends At{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class is extends At{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class sl extends At{getDefault(){return null}set(t){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class al extends At{getDefault(){return null}set(t){var n;if(t===this.current&&!this.dirty)return;const a=this.gl;Tn(a)?a.bindVertexArray(t):(n=a.getExtension("OES_vertex_array_object"))===null||n===void 0||n.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class Ya extends At{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Fn extends At{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class ol extends At{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class In extends At{constructor(t,n){super(t),this.context=t,this.parent=n}getDefault(){return null}}class rs extends In{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class ll extends In{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Ja extends In{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Nt{constructor(t,n,a,c,d){this.context=t,this.width=n,this.height=a;const m=t.gl,g=this.framebuffer=m.createFramebuffer();if(this.colorAttachment=new rs(t,g),c)this.depthAttachment=d?new Ja(t,g):new ll(t,g);else if(d)throw new Error("Stencil cannot be setted without depth");if(m.checkFramebufferStatus(m.FRAMEBUFFER)!==m.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,n=this.colorAttachment.get();if(n&&t.deleteTexture(n),this.depthAttachment){const a=this.depthAttachment.get();a&&t.deleteRenderbuffer(a)}t.deleteFramebuffer(this.framebuffer)}}class ci{constructor(t,n,a){this.blendFunction=t,this.blendColor=n,this.mask=a}}ci.Replace=[1,0],ci.disabled=new ci(ci.Replace,o.aT.transparent,[!1,!1,!1,!1]),ci.unblended=new ci(ci.Replace,o.aT.transparent,[!0,!0,!0,!0]),ci.alphaBlended=new ci([1,771],o.aT.transparent,[!0,!0,!0,!0]);class Sc{constructor(t){var n,a;if(this.gl=t,this.clearColor=new ia(this),this.clearDepth=new Tr(this),this.clearStencil=new Ir(this),this.colorMask=new Ua(this),this.depthMask=new ra(this),this.stencilMask=new na(this),this.stencilFunc=new qa(this),this.stencilOp=new Za(this),this.stencilTest=new sa(this),this.depthRange=new Ga(this),this.depthTest=new Ha(this),this.depthFunc=new aa(this),this.blend=new rl(this),this.blendFunc=new nl(this),this.blendColor=new ts(this),this.blendEquation=new _c(this),this.cullFace=new yc(this),this.cullFaceSide=new xc(this),this.frontFace=new vc(this),this.program=new bc(this),this.activeTexture=new wc(this),this.viewport=new Wa(this),this.bindFramebuffer=new oa(this),this.bindRenderbuffer=new Xa(this),this.bindTexture=new Ka(this),this.bindVertexBuffer=new is(this),this.bindElementBuffer=new sl(this),this.bindVertexArray=new al(this),this.pixelStoreUnpack=new Ya(this),this.pixelStoreUnpackPremultiplyAlpha=new Fn(this),this.pixelStoreUnpackFlipY=new ol(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),Tn(t)){this.HALF_FLOAT=t.HALF_FLOAT;const c=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(n=t.RGBA16F)!==null&&n!==void 0?n:c?.RGBA16F_EXT,this.RGB16F=(a=t.RGB16F)!==null&&a!==void 0?a:c?.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const c=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=c?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,n){return new ea(this,t,n)}createVertexBuffer(t,n,a){return new ta(this,t,n,a)}createRenderbuffer(t,n,a){const c=this.gl,d=c.createRenderbuffer();return this.bindRenderbuffer.set(d),c.renderbufferStorage(c.RENDERBUFFER,t,n,a),this.bindRenderbuffer.set(null),d}createFramebuffer(t,n,a,c){return new Nt(this,t,n,a,c)}clear({color:t,depth:n,stencil:a}){const c=this.gl;let d=0;t&&(d|=c.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),n!==void 0&&(d|=c.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),a!==void 0&&(d|=c.STENCIL_BUFFER_BIT,this.clearStencil.set(a),this.stencilMask.set(255)),c.clear(d)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){o.aG(t.blendFunction,ci.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return Tn(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var n;return Tn(this.gl)?this.gl.deleteVertexArray(t):(n=this.gl.getExtension("OES_vertex_array_object"))===null||n===void 0?void 0:n.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}class Pt{constructor(t,n,a){this.func=t,this.mask=n,this.range=a}}Pt.ReadOnly=!1,Pt.ReadWrite=!0,Pt.disabled=new Pt(519,Pt.ReadOnly,[0,1]);const Bn=7680;class ui{constructor(t,n,a,c,d,m){this.test=t,this.ref=n,this.mask=a,this.fail=c,this.depthFail=d,this.pass=m}}ui.disabled=new ui({func:519,mask:0},0,0,Bn,Bn,Bn);class ai{constructor(t,n,a){this.enable=t,this.mode=n,this.frontFace=a}}let Ss;function cl(u,t,n,a,c,d,m){const g=u.context,x=g.gl,w=u.useProgram("collisionBox"),C=[];let T=0,z=0;for(let K=0;K<a.length;K++){const re=a[K],he=t.getTile(re),pe=he.getBucket(n);if(!pe)continue;let xe=re.posMatrix;c[0]===0&&c[1]===0||(xe=u.translatePosMatrix(re.posMatrix,he,c,d));const Ie=m?pe.textCollisionBox:pe.iconCollisionBox,Se=pe.collisionCircleArray;if(Se.length>0){const ke=o.Z(),Xe=xe;o.aU(ke,pe.placementInvProjMatrix,u.transform.glCoordMatrix),o.aU(ke,ke,pe.placementViewportMatrix),C.push({circleArray:Se,circleOffset:z,transform:Xe,invTransform:ke,coord:re}),T+=Se.length/4,z=T}Ie&&w.draw(g,x.LINES,Pt.disabled,ui.disabled,u.colorModeForRenderPass(),ai.disabled,Oa(xe,u.transform,he),u.style.map.terrain&&u.style.map.terrain.getTerrainData(re),n.id,Ie.layoutVertexBuffer,Ie.indexBuffer,Ie.segments,null,u.transform.zoom,null,null,Ie.collisionVertexBuffer)}if(!m||!C.length)return;const V=u.useProgram("collisionCircle"),j=new o.aV;j.resize(4*T),j._trim();let Z=0;for(const K of C)for(let re=0;re<K.circleArray.length/4;re++){const he=4*re,pe=K.circleArray[he+0],xe=K.circleArray[he+1],Ie=K.circleArray[he+2],Se=K.circleArray[he+3];j.emplace(Z++,pe,xe,Ie,Se,0),j.emplace(Z++,pe,xe,Ie,Se,1),j.emplace(Z++,pe,xe,Ie,Se,2),j.emplace(Z++,pe,xe,Ie,Se,3)}(!Ss||Ss.length<2*T)&&(Ss=function(K){const re=2*K,he=new o.aX;he.resize(re),he._trim();for(let pe=0;pe<re;pe++){const xe=6*pe;he.uint16[xe+0]=4*pe+0,he.uint16[xe+1]=4*pe+1,he.uint16[xe+2]=4*pe+2,he.uint16[xe+3]=4*pe+2,he.uint16[xe+4]=4*pe+3,he.uint16[xe+5]=4*pe+0}return he}(T));const N=g.createIndexBuffer(Ss,!0),te=g.createVertexBuffer(j,o.aW.members,!0);for(const K of C){const re={u_matrix:K.transform,u_inv_matrix:K.invTransform,u_camera_to_center_distance:(le=u.transform).cameraToCenterDistance,u_viewport_size:[le.width,le.height]};V.draw(g,x.TRIANGLES,Pt.disabled,ui.disabled,u.colorModeForRenderPass(),ai.disabled,re,u.style.map.terrain&&u.style.map.terrain.getTerrainData(K.coord),n.id,te,N,o.S.simpleSegment(0,2*K.circleOffset,K.circleArray.length,K.circleArray.length/2),null,u.transform.zoom,null,null,null)}var le;te.destroy(),N.destroy()}ai.disabled=new ai(!1,1029,2305),ai.backCCW=new ai(!0,1029,2305);const Qa=o.ao(new Float32Array(16));function la(u,t,n,a,c,d){const{horizontalAlign:m,verticalAlign:g}=o.au(u);return new o.P((-(m-.5)*t/c+a[0])*d,(-(g-.5)*n/c+a[1])*d)}function ca(u,t,n,a,c,d,m,g,x,w,C){const T=u.text.placedSymbolArray,z=u.text.dynamicLayoutVertexArray,V=u.icon.dynamicLayoutVertexArray,j={};z.clear();for(let Z=0;Z<T.length;Z++){const N=T.get(Z),te=N.hidden||!N.crossTileID||u.allowVerticalPlacement&&!N.placedOrientation?null:a[N.crossTileID];if(te){const le=new o.P(N.anchorX,N.anchorY),K=dt(le,n?m:d,C),re=Ut(c.cameraToCenterDistance,K.signedDistanceFromCamera);let he=o.aj(u.textSizeData,x,N)*re/o.ap;n&&(he*=u.tilePixelRatio/g);const{width:pe,height:xe,anchor:Ie,textOffset:Se,textBoxScale:ke}=te,Xe=la(Ie,pe,xe,Se,ke,he),Ct=n?dt(le.add(Xe),d,C).point:K.point.add(t?Xe.rotate(-c.angle):Xe),Le=u.allowVerticalPlacement&&N.placedOrientation===o.ai.vertical?Math.PI/2:0;for(let ut=0;ut<N.numGlyphs;ut++)o.ak(z,Ct,Le);w&&N.associatedIconIndex>=0&&(j[N.associatedIconIndex]={shiftedAnchor:Ct,angle:Le})}else O(N.numGlyphs,z)}if(w){V.clear();const Z=u.icon.placedSymbolArray;for(let N=0;N<Z.length;N++){const te=Z.get(N);if(te.hidden)O(te.numGlyphs,V);else{const le=j[N];if(le)for(let K=0;K<te.numGlyphs;K++)o.ak(V,le.shiftedAnchor,le.angle);else O(te.numGlyphs,V)}}u.icon.dynamicLayoutVertexBuffer.updateData(V)}u.text.dynamicLayoutVertexBuffer.updateData(z)}function eo(u,t,n){return n.iconsInText&&t?"symbolTextAndIcon":u?"symbolSDF":"symbolIcon"}function ua(u,t,n,a,c,d,m,g,x,w,C,T){const z=u.context,V=z.gl,j=u.transform,Z=g==="map",N=x==="map",te=g!=="viewport"&&n.layout.get("symbol-placement")!=="point",le=Z&&!N&&!te,K=!n.layout.get("symbol-sort-key").isConstant();let re=!1;const he=u.depthModeForSublayer(0,Pt.ReadOnly),pe=n._unevaluatedLayout.hasValue("text-variable-anchor")||n._unevaluatedLayout.hasValue("text-variable-anchor-offset"),xe=[];for(const Ie of a){const Se=t.getTile(Ie),ke=Se.getBucket(n);if(!ke)continue;const Xe=c?ke.text:ke.icon;if(!Xe||!Xe.segments.get().length||!Xe.hasVisibleVertices)continue;const Ct=Xe.programConfigurations.get(n.id),Le=c||ke.sdfIcons,ut=c?ke.textSizeData:ke.iconSizeData,Ye=N||j.pitch!==0,Zt=u.useProgram(eo(Le,c,ke),Ct),St=o.ah(ut,j.zoom),vt=u.style.map.terrain&&u.style.map.terrain.getTerrainData(Ie);let Tt,yi,ei,Gi,zi=[0,0],Si=null;if(c)yi=Se.glyphAtlasTexture,ei=V.LINEAR,Tt=Se.glyphAtlasTexture.size,ke.iconsInText&&(zi=Se.imageAtlasTexture.size,Si=Se.imageAtlasTexture,Gi=Ye||u.options.rotating||u.options.zooming||ut.kind==="composite"||ut.kind==="camera"?V.LINEAR:V.NEAREST);else{const xi=n.layout.get("icon-size").constantOr(0)!==1||ke.iconsNeedLinear;yi=Se.imageAtlasTexture,ei=Le||u.options.rotating||u.options.zooming||xi||Ye?V.LINEAR:V.NEAREST,Tt=Se.imageAtlasTexture.size}const kr=ee(Se,1,u.transform.zoom),ii=Ae(Ie.posMatrix,N,Z,u.transform,kr),Qr=mt(Ie.posMatrix,N,Z,u.transform,kr),en=pe&&ke.hasTextData(),kn=n.layout.get("icon-text-fit")!=="none"&&en&&ke.hasIconData();if(te){const xi=u.style.map.terrain?(_r,vi)=>u.style.map.terrain.getElevation(Ie,_r,vi):null,Di=n.layout.get("text-rotation-alignment")==="map";Ce(ke,Ie.posMatrix,u,c,ii,Qr,N,w,Di,xi)}const Vn=u.translatePosMatrix(Ie.posMatrix,Se,d,m),us=te||c&&pe||kn?Qa:ii,Qi=u.translatePosMatrix(Qr,Se,d,m,!0),Hi=Le&&n.paint.get(c?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let or;or=Le?ke.iconsInText?Rn(ut.kind,St,le,N,u,Vn,us,Qi,Tt,zi):Va(ut.kind,St,le,N,u,Vn,us,Qi,c,Tt,!0):ja(ut.kind,St,le,N,u,Vn,us,Qi,c,Tt);const Un={program:Zt,buffers:Xe,uniformValues:or,atlasTexture:yi,atlasTextureIcon:Si,atlasInterpolation:ei,atlasInterpolationIcon:Gi,isSDF:Le,hasHalo:Hi};if(K&&ke.canOverlap){re=!0;const xi=Xe.segments.get();for(const Di of xi)xe.push({segments:new o.S([Di]),sortKey:Di.sortKey,state:Un,terrainData:vt})}else xe.push({segments:Xe.segments,sortKey:0,state:Un,terrainData:vt})}re&&xe.sort((Ie,Se)=>Ie.sortKey-Se.sortKey);for(const Ie of xe){const Se=Ie.state;if(z.activeTexture.set(V.TEXTURE0),Se.atlasTexture.bind(Se.atlasInterpolation,V.CLAMP_TO_EDGE),Se.atlasTextureIcon&&(z.activeTexture.set(V.TEXTURE1),Se.atlasTextureIcon&&Se.atlasTextureIcon.bind(Se.atlasInterpolationIcon,V.CLAMP_TO_EDGE)),Se.isSDF){const ke=Se.uniformValues;Se.hasHalo&&(ke.u_is_halo=1,to(Se.buffers,Ie.segments,n,u,Se.program,he,C,T,ke,Ie.terrainData)),ke.u_is_halo=0}to(Se.buffers,Ie.segments,n,u,Se.program,he,C,T,Se.uniformValues,Ie.terrainData)}}function to(u,t,n,a,c,d,m,g,x,w){const C=a.context;c.draw(C,C.gl.TRIANGLES,d,m,g,ai.disabled,x,w,n.id,u.layoutVertexBuffer,u.indexBuffer,t,n.paint,a.transform.zoom,u.programConfigurations.get(n.id),u.dynamicLayoutVertexBuffer,u.opacityVertexBuffer)}function Cs(u,t,n,a,c){if(!n||!a||!a.imageAtlas)return;const d=a.imageAtlas.patternPositions;let m=d[n.to.toString()],g=d[n.from.toString()];if(!m&&g&&(m=g),!g&&m&&(g=m),!m||!g){const x=c.getPaintProperty(t);m=d[x],g=d[x]}m&&g&&u.setConstantPatternPositions(m,g)}function Ts(u,t,n,a,c,d,m){const g=u.context.gl,x="fill-pattern",w=n.paint.get(x),C=w&&w.constantOr(1),T=n.getCrossfadeParameters();let z,V,j,Z,N;m?(V=C&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",z=g.LINES):(V=C?"fillPattern":"fill",z=g.TRIANGLES);const te=w.constantOr(null);for(const le of a){const K=t.getTile(le);if(C&&!K.patternsLoaded())continue;const re=K.getBucket(n);if(!re)continue;const he=re.programConfigurations.get(n.id),pe=u.useProgram(V,he),xe=u.style.map.terrain&&u.style.map.terrain.getTerrainData(le);C&&(u.context.activeTexture.set(g.TEXTURE0),K.imageAtlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE),he.updatePaintBuffers(T)),Cs(he,x,te,K,n);const Ie=xe?le:null,Se=u.translatePosMatrix(Ie?Ie.posMatrix:le.posMatrix,K,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));if(m){Z=re.indexBuffer2,N=re.segments2;const ke=[g.drawingBufferWidth,g.drawingBufferHeight];j=V==="fillOutlinePattern"&&C?Ks(Se,u,T,K,ke):Xs(Se,ke)}else Z=re.indexBuffer,N=re.segments,j=C?Ba(Se,u,T,K):Ko(Se);pe.draw(u.context,z,c,u.stencilModeForClipping(le),d,ai.disabled,j,xe,n.id,re.layoutVertexBuffer,Z,N,n.paint,u.transform.zoom,he)}}function Is(u,t,n,a,c,d,m){const g=u.context,x=g.gl,w="fill-extrusion-pattern",C=n.paint.get(w),T=C.constantOr(1),z=n.getCrossfadeParameters(),V=n.paint.get("fill-extrusion-opacity"),j=C.constantOr(null);for(const Z of a){const N=t.getTile(Z),te=N.getBucket(n);if(!te)continue;const le=u.style.map.terrain&&u.style.map.terrain.getTerrainData(Z),K=te.programConfigurations.get(n.id),re=u.useProgram(T?"fillExtrusionPattern":"fillExtrusion",K);T&&(u.context.activeTexture.set(x.TEXTURE0),N.imageAtlasTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE),K.updatePaintBuffers(z)),Cs(K,w,j,N,n);const he=u.translatePosMatrix(Z.posMatrix,N,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),pe=n.paint.get("fill-extrusion-vertical-gradient"),xe=T?Sn(he,u,pe,V,Z,z,N):Fa(he,u,pe,V);re.draw(g,g.gl.TRIANGLES,c,d,m,ai.backCCW,xe,le,n.id,te.layoutVertexBuffer,te.indexBuffer,te.segments,n.paint,u.transform.zoom,K,u.style.map.terrain&&te.centroidVertexBuffer)}}function Cc(u,t,n,a,c,d,m){const g=u.context,x=g.gl,w=n.fbo;if(!w)return;const C=u.useProgram("hillshade"),T=u.style.map.terrain&&u.style.map.terrain.getTerrainData(t);g.activeTexture.set(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,w.colorAttachment.get()),C.draw(g,x.TRIANGLES,c,d,m,ai.disabled,((z,V,j,Z)=>{const N=j.paint.get("hillshade-shadow-color"),te=j.paint.get("hillshade-highlight-color"),le=j.paint.get("hillshade-accent-color");let K=j.paint.get("hillshade-illumination-direction")*(Math.PI/180);j.paint.get("hillshade-illumination-anchor")==="viewport"&&(K-=z.transform.angle);const re=!z.options.moving;return{u_matrix:Z?Z.posMatrix:z.transform.calculatePosMatrix(V.tileID.toUnwrapped(),re),u_image:0,u_latrange:Na(0,V.tileID),u_light:[j.paint.get("hillshade-exaggeration"),K],u_shadow:N,u_highlight:te,u_accent:le}})(u,n,a,T?t:null),T,a.id,u.rasterBoundsBuffer,u.quadTriangleIndexBuffer,u.rasterBoundsSegments)}function io(u,t,n,a,c,d){const m=u.context,g=m.gl,x=t.dem;if(x&&x.data){const w=x.dim,C=x.stride,T=x.getPixels();if(m.activeTexture.set(g.TEXTURE1),m.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||u.getTileTexture(C),t.demTexture){const V=t.demTexture;V.update(T,{premultiply:!1}),V.bind(g.NEAREST,g.CLAMP_TO_EDGE)}else t.demTexture=new Fe(m,T,g.RGBA,{premultiply:!1}),t.demTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE);m.activeTexture.set(g.TEXTURE0);let z=t.fbo;if(!z){const V=new Fe(m,{width:w,height:w,data:null},g.RGBA);V.bind(g.LINEAR,g.CLAMP_TO_EDGE),z=t.fbo=m.createFramebuffer(w,w,!0,!1),z.colorAttachment.set(V.texture)}m.bindFramebuffer.set(z.framebuffer),m.viewport.set([0,0,w,w]),u.useProgram("hillshadePrepare").draw(m,g.TRIANGLES,a,c,d,ai.disabled,((V,j)=>{const Z=j.stride,N=o.Z();return o.aS(N,0,o.N,-o.N,0,0,1),o.$(N,N,[0,-o.N,0]),{u_matrix:N,u_image:1,u_dimension:[Z,Z],u_zoom:V.overscaledZ,u_unpack:j.getUnpackVector()}})(t.tileID,x),null,n.id,u.rasterBoundsBuffer,u.quadTriangleIndexBuffer,u.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function Tc(u,t,n,a,c,d){const m=a.paint.get("raster-fade-duration");if(!d&&m>0){const g=o.h.now(),x=(g-u.timeAdded)/m,w=t?(g-t.timeAdded)/m:-1,C=n.getSource(),T=c.coveringZoomLevel({tileSize:C.tileSize,roundZoom:C.roundZoom}),z=!t||Math.abs(t.tileID.overscaledZ-T)>Math.abs(u.tileID.overscaledZ-T),V=z&&u.refreshedUponExpiration?1:o.ad(z?x:1-w,0,1);return u.refreshedUponExpiration&&x>=1&&(u.refreshedUponExpiration=!1),t?{opacity:1,mix:1-V}:{opacity:V,mix:0}}return{opacity:1,mix:0}}const ul=new o.aT(1,0,0,1),ha=new o.aT(0,1,0,1),ro=new o.aT(0,0,1,1),hl=new o.aT(1,0,1,1),dl=new o.aT(0,1,1,1);function Es(u,t,n,a){pa(u,0,t+n/2,u.transform.width,n,a)}function da(u,t,n,a){pa(u,t-n/2,0,n,u.transform.height,a)}function pa(u,t,n,a,c,d){const m=u.context,g=m.gl;g.enable(g.SCISSOR_TEST),g.scissor(t*u.pixelRatio,n*u.pixelRatio,a*u.pixelRatio,c*u.pixelRatio),m.clear({color:d}),g.disable(g.SCISSOR_TEST)}function pl(u,t,n){const a=u.context,c=a.gl,d=n.posMatrix,m=u.useProgram("debug"),g=Pt.disabled,x=ui.disabled,w=u.colorModeForRenderPass(),C="$debug",T=u.style.map.terrain&&u.style.map.terrain.getTerrainData(n);a.activeTexture.set(c.TEXTURE0);const z=t.getTileByID(n.key).latestRawTileData,V=Math.floor((z&&z.byteLength||0)/1024),j=t.getTile(n).tileSize,Z=512/Math.min(j,512)*(n.overscaledZ/u.transform.zoom)*.5;let N=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(N+=` => ${n.overscaledZ}`),function(te,le){te.initDebugOverlayCanvas();const K=te.debugOverlayCanvas,re=te.context.gl,he=te.debugOverlayCanvas.getContext("2d");he.clearRect(0,0,K.width,K.height),he.shadowColor="white",he.shadowBlur=2,he.lineWidth=1.5,he.strokeStyle="white",he.textBaseline="top",he.font="bold 36px Open Sans, sans-serif",he.fillText(le,5,5),he.strokeText(le,5,5),te.debugOverlayTexture.update(K),te.debugOverlayTexture.bind(re.LINEAR,re.CLAMP_TO_EDGE)}(u,`${N} ${V}kB`),m.draw(a,c.TRIANGLES,g,x,ci.alphaBlended,ai.disabled,bs(d,o.aT.transparent,Z),null,C,u.debugBuffer,u.quadTriangleIndexBuffer,u.debugSegments),m.draw(a,c.LINE_STRIP,g,x,w,ai.disabled,bs(d,o.aT.red),T,C,u.debugBuffer,u.tileBorderIndexBuffer,u.debugSegments)}function fi(u,t,n){const a=u.context,c=a.gl,d=u.colorModeForRenderPass(),m=new Pt(c.LEQUAL,Pt.ReadWrite,u.depthRangeFor3D),g=u.useProgram("terrain"),x=t.getTerrainMesh();a.bindFramebuffer.set(null),a.viewport.set([0,0,u.width,u.height]);for(const w of n){const C=u.renderToTexture.getTexture(w),T=t.getTerrainData(w.tileID);a.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,C.texture);const z={u_matrix:u.transform.calculatePosMatrix(w.tileID.toUnwrapped()),u_texture:0,u_ele_delta:t.getMeshFrameDelta(u.transform.zoom)};g.draw(a,c.TRIANGLES,m,ui.disabled,d,ai.backCCW,z,T,"terrain",x.vertexBuffer,x.indexBuffer,x.segments)}}class On{constructor(t,n){this.context=new Sc(t),this.transform=n,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.Z(),renderTime:0},this.setup(),this.numSublayers=Ii.maxUnderzooming+Ii.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Gs}resize(t,n,a){if(this.width=Math.floor(t*a),this.height=Math.floor(n*a),this.pixelRatio=a,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const c of this.style._order)this.style._layers[c].resize()}setup(){const t=this.context,n=new o.a_;n.emplaceBack(0,0),n.emplaceBack(o.N,0),n.emplaceBack(0,o.N),n.emplaceBack(o.N,o.N),this.tileExtentBuffer=t.createVertexBuffer(n,Hs.members),this.tileExtentSegments=o.S.simpleSegment(0,0,4,2);const a=new o.a_;a.emplaceBack(0,0),a.emplaceBack(o.N,0),a.emplaceBack(0,o.N),a.emplaceBack(o.N,o.N),this.debugBuffer=t.createVertexBuffer(a,Hs.members),this.debugSegments=o.S.simpleSegment(0,0,4,5);const c=new o.V;c.emplaceBack(0,0,0,0),c.emplaceBack(o.N,0,o.N,0),c.emplaceBack(0,o.N,0,o.N),c.emplaceBack(o.N,o.N,o.N,o.N),this.rasterBoundsBuffer=t.createVertexBuffer(c,Jt.members),this.rasterBoundsSegments=o.S.simpleSegment(0,0,4,2);const d=new o.a_;d.emplaceBack(0,0),d.emplaceBack(1,0),d.emplaceBack(0,1),d.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(d,Hs.members),this.viewportSegments=o.S.simpleSegment(0,0,4,2);const m=new o.a$;m.emplaceBack(0),m.emplaceBack(1),m.emplaceBack(3),m.emplaceBack(2),m.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(m);const g=new o.b0;g.emplaceBack(0,1,2),g.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(g);const x=this.context.gl;this.stencilClearMode=new ui({func:x.ALWAYS,mask:0},0,255,x.ZERO,x.ZERO,x.ZERO)}clearStencil(){const t=this.context,n=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const a=o.Z();o.aS(a,0,this.width,this.height,0,0,1),o.a0(a,a,[n.drawingBufferWidth,n.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,n.TRIANGLES,Pt.disabled,this.stencilClearMode,ci.disabled,ai.disabled,Yo(a),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,n){if(this.currentStencilSource===t.source||!t.isTileClipped()||!n||!n.length)return;this.currentStencilSource=t.source;const a=this.context,c=a.gl;this.nextStencilID+n.length>256&&this.clearStencil(),a.setColorMode(ci.disabled),a.setDepthMode(Pt.disabled);const d=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const m of n){const g=this._tileClippingMaskIDs[m.key]=this.nextStencilID++,x=this.style.map.terrain&&this.style.map.terrain.getTerrainData(m);d.draw(a,c.TRIANGLES,Pt.disabled,new ui({func:c.ALWAYS,mask:0},g,255,c.KEEP,c.KEEP,c.REPLACE),ci.disabled,ai.disabled,Yo(m.posMatrix),x,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,n=this.context.gl;return new ui({func:n.NOTEQUAL,mask:255},t,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(t){const n=this.context.gl;return new ui({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(t){const n=this.context.gl,a=t.sort((m,g)=>g.overscaledZ-m.overscaledZ),c=a[a.length-1].overscaledZ,d=a[0].overscaledZ-c+1;if(d>1){this.currentStencilSource=void 0,this.nextStencilID+d>256&&this.clearStencil();const m={};for(let g=0;g<d;g++)m[g+c]=new ui({func:n.GEQUAL,mask:255},g+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=d,[m,a]}return[{[c]:ui.disabled},a]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new ci([t.CONSTANT_COLOR,t.ONE],new o.aT(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ci.unblended:ci.alphaBlended}depthModeForSublayer(t,n,a){if(!this.opaquePassEnabledForLayer())return Pt.disabled;const c=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Pt(a||this.context.gl.LEQUAL,n,[c,c])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,n){this.style=t,this.options=n,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(o.h.now()),this.imageManager.beginFrame();const a=this.style._order,c=this.style.sourceCaches,d={},m={},g={};for(const x in c){const w=c[x];w.used&&w.prepare(this.context),d[x]=w.getVisibleCoordinates(),m[x]=d[x].slice().reverse(),g[x]=w.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let x=0;x<a.length;x++)if(this.style._layers[a[x]].is3D()){this.opaquePassCutoff=x;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const x=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!o.b1(this.terrainFacilitator.matrix,this.transform.projMatrix)||x.length)&&(o.b2(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(w,C){const T=w.context,z=T.gl,V=ci.unblended,j=new Pt(z.LEQUAL,Pt.ReadWrite,[0,1]),Z=C.getTerrainMesh(),N=C.sourceCache.getRenderableTiles(),te=w.useProgram("terrainDepth");T.bindFramebuffer.set(C.getFramebuffer("depth").framebuffer),T.viewport.set([0,0,w.width/devicePixelRatio,w.height/devicePixelRatio]),T.clear({color:o.aT.transparent,depth:1});for(const le of N){const K=C.getTerrainData(le.tileID),re={u_matrix:w.transform.calculatePosMatrix(le.tileID.toUnwrapped()),u_ele_delta:C.getMeshFrameDelta(w.transform.zoom)};te.draw(T,z.TRIANGLES,j,ui.disabled,V,ai.backCCW,re,K,"terrain",Z.vertexBuffer,Z.indexBuffer,Z.segments)}T.bindFramebuffer.set(null),T.viewport.set([0,0,w.width,w.height])}(this,this.style.map.terrain),function(w,C){const T=w.context,z=T.gl,V=ci.unblended,j=new Pt(z.LEQUAL,Pt.ReadWrite,[0,1]),Z=C.getTerrainMesh(),N=C.getCoordsTexture(),te=C.sourceCache.getRenderableTiles(),le=w.useProgram("terrainCoords");T.bindFramebuffer.set(C.getFramebuffer("coords").framebuffer),T.viewport.set([0,0,w.width/devicePixelRatio,w.height/devicePixelRatio]),T.clear({color:o.aT.transparent,depth:1}),C.coordsIndex=[];for(const K of te){const re=C.getTerrainData(K.tileID);T.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,N.texture);const he={u_matrix:w.transform.calculatePosMatrix(K.tileID.toUnwrapped()),u_terrain_coords_id:(255-C.coordsIndex.length)/255,u_texture:0,u_ele_delta:C.getMeshFrameDelta(w.transform.zoom)};le.draw(T,z.TRIANGLES,j,ui.disabled,V,ai.backCCW,he,re,"terrain",Z.vertexBuffer,Z.indexBuffer,Z.segments),C.coordsIndex.push(K.tileID.key)}T.bindFramebuffer.set(null),T.viewport.set([0,0,w.width,w.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const x of a){const w=this.style._layers[x];if(!w.hasOffscreenPass()||w.isHidden(this.transform.zoom))continue;const C=m[w.source];(w.type==="custom"||C.length)&&this.renderLayer(this,c[w.source],w,C)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?o.aT.black:o.aT.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=a.length-1;this.currentLayer>=0;this.currentLayer--){const x=this.style._layers[a[this.currentLayer]],w=c[x.source],C=d[x.source];this._renderTileClippingMasks(x,C),this.renderLayer(this,w,x,C)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<a.length;this.currentLayer++){const x=this.style._layers[a[this.currentLayer]],w=c[x.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(x))continue;const C=(x.type==="symbol"?g:m)[x.source];this._renderTileClippingMasks(x,d[x.source]),this.renderLayer(this,w,x,C)}if(this.options.showTileBoundaries){const x=function(w,C){let T=null;const z=Object.values(w._layers).flatMap(N=>N.source&&!N.isHidden(C)?[w.sourceCaches[N.source]]:[]),V=z.filter(N=>N.getSource().type==="vector"),j=z.filter(N=>N.getSource().type!=="vector"),Z=N=>{(!T||T.getSource().maxzoom<N.getSource().maxzoom)&&(T=N)};return V.forEach(N=>Z(N)),T||j.forEach(N=>Z(N)),T}(this.style,this.transform.zoom);x&&function(w,C,T){for(let z=0;z<T.length;z++)pl(w,C,T[z])}(this,x,x.getVisibleCoordinates())}this.options.showPadding&&function(x){const w=x.transform.padding;Es(x,x.transform.height-(w.top||0),3,ul),Es(x,w.bottom||0,3,ha),da(x,w.left||0,3,ro),da(x,x.transform.width-(w.right||0),3,hl);const C=x.transform.centerPoint;(function(T,z,V,j){pa(T,z-1,V-10,2,20,j),pa(T,z-10,V-1,20,2,j)})(x,C.x,x.transform.height-C.y,dl)}(this),this.context.setDefault()}renderLayer(t,n,a,c){if(!a.isHidden(this.transform.zoom)&&(a.type==="background"||a.type==="custom"||(c||[]).length))switch(this.id=a.id,a.type){case"symbol":(function(d,m,g,x,w){if(d.renderPass!=="translucent")return;const C=ui.disabled,T=d.colorModeForRenderPass();(g._unevaluatedLayout.hasValue("text-variable-anchor")||g._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(z,V,j,Z,N,te,le){const K=V.transform,re=N==="map",he=te==="map";for(const pe of z){const xe=Z.getTile(pe),Ie=xe.getBucket(j);if(!Ie||!Ie.text||!Ie.text.segments.get().length)continue;const Se=o.ah(Ie.textSizeData,K.zoom),ke=ee(xe,1,V.transform.zoom),Xe=Ae(pe.posMatrix,he,re,V.transform,ke),Ct=j.layout.get("icon-text-fit")!=="none"&&Ie.hasIconData();if(Se){const Le=Math.pow(2,K.zoom-xe.tileID.overscaledZ);ca(Ie,re,he,le,K,Xe,pe.posMatrix,Le,Se,Ct,V.style.map.terrain?(ut,Ye)=>V.style.map.terrain.getElevation(pe,ut,Ye):null)}}}(x,d,g,m,g.layout.get("text-rotation-alignment"),g.layout.get("text-pitch-alignment"),w),g.paint.get("icon-opacity").constantOr(1)!==0&&ua(d,m,g,x,!1,g.paint.get("icon-translate"),g.paint.get("icon-translate-anchor"),g.layout.get("icon-rotation-alignment"),g.layout.get("icon-pitch-alignment"),g.layout.get("icon-keep-upright"),C,T),g.paint.get("text-opacity").constantOr(1)!==0&&ua(d,m,g,x,!0,g.paint.get("text-translate"),g.paint.get("text-translate-anchor"),g.layout.get("text-rotation-alignment"),g.layout.get("text-pitch-alignment"),g.layout.get("text-keep-upright"),C,T),m.map.showCollisionBoxes&&(cl(d,m,g,x,g.paint.get("text-translate"),g.paint.get("text-translate-anchor"),!0),cl(d,m,g,x,g.paint.get("icon-translate"),g.paint.get("icon-translate-anchor"),!1))})(t,n,a,c,this.style.placement.variableOffsets);break;case"circle":(function(d,m,g,x){if(d.renderPass!=="translucent")return;const w=g.paint.get("circle-opacity"),C=g.paint.get("circle-stroke-width"),T=g.paint.get("circle-stroke-opacity"),z=!g.layout.get("circle-sort-key").isConstant();if(w.constantOr(1)===0&&(C.constantOr(1)===0||T.constantOr(1)===0))return;const V=d.context,j=V.gl,Z=d.depthModeForSublayer(0,Pt.ReadOnly),N=ui.disabled,te=d.colorModeForRenderPass(),le=[];for(let K=0;K<x.length;K++){const re=x[K],he=m.getTile(re),pe=he.getBucket(g);if(!pe)continue;const xe=pe.programConfigurations.get(g.id),Ie=d.useProgram("circle",xe),Se=pe.layoutVertexBuffer,ke=pe.indexBuffer,Xe=d.style.map.terrain&&d.style.map.terrain.getTerrainData(re),Ct={programConfiguration:xe,program:Ie,layoutVertexBuffer:Se,indexBuffer:ke,uniformValues:Cn(d,re,he,g),terrainData:Xe};if(z){const Le=pe.segments.get();for(const ut of Le)le.push({segments:new o.S([ut]),sortKey:ut.sortKey,state:Ct})}else le.push({segments:pe.segments,sortKey:0,state:Ct})}z&&le.sort((K,re)=>K.sortKey-re.sortKey);for(const K of le){const{programConfiguration:re,program:he,layoutVertexBuffer:pe,indexBuffer:xe,uniformValues:Ie,terrainData:Se}=K.state;he.draw(V,j.TRIANGLES,Z,N,te,ai.disabled,Ie,Se,g.id,pe,xe,K.segments,g.paint,d.transform.zoom,re)}})(t,n,a,c);break;case"heatmap":(function(d,m,g,x){if(g.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){const w=d.context,C=w.gl,T=ui.disabled,z=new ci([C.ONE,C.ONE],o.aT.transparent,[!0,!0,!0,!0]);(function(V,j,Z){const N=V.gl;V.activeTexture.set(N.TEXTURE1),V.viewport.set([0,0,j.width/4,j.height/4]);let te=Z.heatmapFbo;if(te)N.bindTexture(N.TEXTURE_2D,te.colorAttachment.get()),V.bindFramebuffer.set(te.framebuffer);else{const le=N.createTexture();N.bindTexture(N.TEXTURE_2D,le),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_S,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_T,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MIN_FILTER,N.LINEAR),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MAG_FILTER,N.LINEAR),te=Z.heatmapFbo=V.createFramebuffer(j.width/4,j.height/4,!1,!1),function(K,re,he,pe){var xe,Ie;const Se=K.gl,ke=(xe=K.HALF_FLOAT)!==null&&xe!==void 0?xe:Se.UNSIGNED_BYTE,Xe=(Ie=K.RGBA16F)!==null&&Ie!==void 0?Ie:Se.RGBA;Se.texImage2D(Se.TEXTURE_2D,0,Xe,re.width/4,re.height/4,0,Se.RGBA,ke,null),pe.colorAttachment.set(he)}(V,j,le,te)}})(w,d,g),w.clear({color:o.aT.transparent});for(let V=0;V<x.length;V++){const j=x[V];if(m.hasRenderableParent(j))continue;const Z=m.getTile(j),N=Z.getBucket(g);if(!N)continue;const te=N.programConfigurations.get(g.id),le=d.useProgram("heatmap",te),{zoom:K}=d.transform;le.draw(w,C.TRIANGLES,Pt.disabled,T,z,ai.disabled,mc(j.posMatrix,Z,K,g.paint.get("heatmap-intensity")),null,g.id,N.layoutVertexBuffer,N.indexBuffer,N.segments,g.paint,d.transform.zoom,te)}w.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),function(w,C){const T=w.context,z=T.gl,V=C.heatmapFbo;if(!V)return;T.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,V.colorAttachment.get()),T.activeTexture.set(z.TEXTURE1);let j=C.colorRampTexture;j||(j=C.colorRampTexture=new Fe(T,C.colorRamp,z.RGBA)),j.bind(z.LINEAR,z.CLAMP_TO_EDGE),w.useProgram("heatmapTexture").draw(T,z.TRIANGLES,Pt.disabled,ui.disabled,w.colorModeForRenderPass(),ai.disabled,((Z,N,te,le)=>{const K=o.Z();o.aS(K,0,Z.width,Z.height,0,0,1);const re=Z.context.gl;return{u_matrix:K,u_world:[re.drawingBufferWidth,re.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:N.paint.get("heatmap-opacity")}})(w,C),null,C.id,w.viewportBuffer,w.quadTriangleIndexBuffer,w.viewportSegments,C.paint,w.transform.zoom)}(d,g))})(t,n,a,c);break;case"line":(function(d,m,g,x){if(d.renderPass!=="translucent")return;const w=g.paint.get("line-opacity"),C=g.paint.get("line-width");if(w.constantOr(1)===0||C.constantOr(1)===0)return;const T=d.depthModeForSublayer(0,Pt.ReadOnly),z=d.colorModeForRenderPass(),V=g.paint.get("line-dasharray"),j=g.paint.get("line-pattern"),Z=j.constantOr(1),N=g.paint.get("line-gradient"),te=g.getCrossfadeParameters(),le=Z?"linePattern":V?"lineSDF":N?"lineGradient":"line",K=d.context,re=K.gl;let he=!0;for(const pe of x){const xe=m.getTile(pe);if(Z&&!xe.patternsLoaded())continue;const Ie=xe.getBucket(g);if(!Ie)continue;const Se=Ie.programConfigurations.get(g.id),ke=d.context.program.get(),Xe=d.useProgram(le,Se),Ct=he||Xe.program!==ke,Le=d.style.map.terrain&&d.style.map.terrain.getTerrainData(pe),ut=j.constantOr(null);if(ut&&xe.imageAtlas){const St=xe.imageAtlas,vt=St.patternPositions[ut.to.toString()],Tt=St.patternPositions[ut.from.toString()];vt&&Tt&&Se.setConstantPatternPositions(vt,Tt)}const Ye=Le?pe:null,Zt=Z?gc(d,xe,g,te,Ye):V?Qo(d,xe,g,V,te,Ye):N?Jo(d,xe,g,Ie.lineClipsArray.length,Ye):$a(d,xe,g,Ye);if(Z)K.activeTexture.set(re.TEXTURE0),xe.imageAtlasTexture.bind(re.LINEAR,re.CLAMP_TO_EDGE),Se.updatePaintBuffers(te);else if(V&&(Ct||d.lineAtlas.dirty))K.activeTexture.set(re.TEXTURE0),d.lineAtlas.bind(K);else if(N){const St=Ie.gradients[g.id];let vt=St.texture;if(g.gradientVersion!==St.version){let Tt=256;if(g.stepInterpolant){const yi=m.getSource().maxzoom,ei=pe.canonical.z===yi?Math.ceil(1<<d.transform.maxZoom-pe.canonical.z):1;Tt=o.ad(o.aY(Ie.maxLineLength/o.N*1024*ei),256,K.maxTextureSize)}St.gradient=o.aZ({expression:g.gradientExpression(),evaluationKey:"lineProgress",resolution:Tt,image:St.gradient||void 0,clips:Ie.lineClipsArray}),St.texture?St.texture.update(St.gradient):St.texture=new Fe(K,St.gradient,re.RGBA),St.version=g.gradientVersion,vt=St.texture}K.activeTexture.set(re.TEXTURE0),vt.bind(g.stepInterpolant?re.NEAREST:re.LINEAR,re.CLAMP_TO_EDGE)}Xe.draw(K,re.TRIANGLES,T,d.stencilModeForClipping(pe),z,ai.disabled,Zt,Le,g.id,Ie.layoutVertexBuffer,Ie.indexBuffer,Ie.segments,g.paint,d.transform.zoom,Se,Ie.layoutVertexBuffer2),he=!1}})(t,n,a,c);break;case"fill":(function(d,m,g,x){const w=g.paint.get("fill-color"),C=g.paint.get("fill-opacity");if(C.constantOr(1)===0)return;const T=d.colorModeForRenderPass(),z=g.paint.get("fill-pattern"),V=d.opaquePassEnabledForLayer()&&!z.constantOr(1)&&w.constantOr(o.aT.transparent).a===1&&C.constantOr(0)===1?"opaque":"translucent";if(d.renderPass===V){const j=d.depthModeForSublayer(1,d.renderPass==="opaque"?Pt.ReadWrite:Pt.ReadOnly);Ts(d,m,g,x,j,T,!1)}if(d.renderPass==="translucent"&&g.paint.get("fill-antialias")){const j=d.depthModeForSublayer(g.getPaintProperty("fill-outline-color")?2:0,Pt.ReadOnly);Ts(d,m,g,x,j,T,!0)}})(t,n,a,c);break;case"fill-extrusion":(function(d,m,g,x){const w=g.paint.get("fill-extrusion-opacity");if(w!==0&&d.renderPass==="translucent"){const C=new Pt(d.context.gl.LEQUAL,Pt.ReadWrite,d.depthRangeFor3D);if(w!==1||g.paint.get("fill-extrusion-pattern").constantOr(1))Is(d,m,g,x,C,ui.disabled,ci.disabled),Is(d,m,g,x,C,d.stencilModeFor3D(),d.colorModeForRenderPass());else{const T=d.colorModeForRenderPass();Is(d,m,g,x,C,ui.disabled,T)}}})(t,n,a,c);break;case"hillshade":(function(d,m,g,x){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent")return;const w=d.context,C=d.depthModeForSublayer(0,Pt.ReadOnly),T=d.colorModeForRenderPass(),[z,V]=d.renderPass==="translucent"?d.stencilConfigForOverlap(x):[{},x];for(const j of V){const Z=m.getTile(j);Z.needsHillshadePrepare!==void 0&&Z.needsHillshadePrepare&&d.renderPass==="offscreen"?io(d,Z,g,C,ui.disabled,T):d.renderPass==="translucent"&&Cc(d,j,Z,g,C,z[j.overscaledZ],T)}w.viewport.set([0,0,d.width,d.height])})(t,n,a,c);break;case"raster":(function(d,m,g,x){if(d.renderPass!=="translucent"||g.paint.get("raster-opacity")===0||!x.length)return;const w=d.context,C=w.gl,T=m.getSource(),z=d.useProgram("raster"),V=d.colorModeForRenderPass(),[j,Z]=T instanceof Rt?[{},x]:d.stencilConfigForOverlap(x),N=Z[Z.length-1].overscaledZ,te=!d.options.moving;for(const le of Z){const K=d.depthModeForSublayer(le.overscaledZ-N,g.paint.get("raster-opacity")===1?Pt.ReadWrite:Pt.ReadOnly,C.LESS),re=m.getTile(le);re.registerFadeDuration(g.paint.get("raster-fade-duration"));const he=m.findLoadedParent(le,0),pe=Tc(re,he,m,g,d.transform,d.style.map.terrain);let xe,Ie;const Se=g.paint.get("raster-resampling")==="nearest"?C.NEAREST:C.LINEAR;w.activeTexture.set(C.TEXTURE0),re.texture.bind(Se,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),w.activeTexture.set(C.TEXTURE1),he?(he.texture.bind(Se,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),xe=Math.pow(2,he.tileID.overscaledZ-re.tileID.overscaledZ),Ie=[re.tileID.canonical.x*xe%1,re.tileID.canonical.y*xe%1]):re.texture.bind(Se,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST);const ke=d.style.map.terrain&&d.style.map.terrain.getTerrainData(le),Xe=ke?le:null,Ct=Xe?Xe.posMatrix:d.transform.calculatePosMatrix(le.toUnwrapped(),te),Le=tl(Ct,Ie||[0,0],xe||1,pe,g);T instanceof Rt?z.draw(w,C.TRIANGLES,K,ui.disabled,V,ai.disabled,Le,ke,g.id,T.boundsBuffer,d.quadTriangleIndexBuffer,T.boundsSegments):z.draw(w,C.TRIANGLES,K,j[le.overscaledZ],V,ai.disabled,Le,ke,g.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments)}})(t,n,a,c);break;case"background":(function(d,m,g,x){const w=g.paint.get("background-color"),C=g.paint.get("background-opacity");if(C===0)return;const T=d.context,z=T.gl,V=d.transform,j=V.tileSize,Z=g.paint.get("background-pattern");if(d.isPatternMissing(Z))return;const N=!Z&&w.a===1&&C===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==N)return;const te=ui.disabled,le=d.depthModeForSublayer(0,N==="opaque"?Pt.ReadWrite:Pt.ReadOnly),K=d.colorModeForRenderPass(),re=d.useProgram(Z?"backgroundPattern":"background"),he=x||V.coveringTiles({tileSize:j,terrain:d.style.map.terrain});Z&&(T.activeTexture.set(z.TEXTURE0),d.imageManager.bind(d.context));const pe=g.getCrossfadeParameters();for(const xe of he){const Ie=x?xe.posMatrix:d.transform.calculatePosMatrix(xe.toUnwrapped()),Se=Z?Or(Ie,C,d,Z,{tileID:xe,tileSize:j},pe):Js(Ie,C,w),ke=d.style.map.terrain&&d.style.map.terrain.getTerrainData(xe);re.draw(T,z.TRIANGLES,le,te,K,ai.disabled,Se,ke,g.id,d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}})(t,0,a,c);break;case"custom":(function(d,m,g){const x=d.context,w=g.implementation;if(d.renderPass==="offscreen"){const C=w.prerender;C&&(d.setCustomLayerDefaults(),x.setColorMode(d.colorModeForRenderPass()),C.call(w,x.gl,d.transform.customLayerMatrix()),x.setDirty(),d.setBaseState())}else if(d.renderPass==="translucent"){d.setCustomLayerDefaults(),x.setColorMode(d.colorModeForRenderPass()),x.setStencilMode(ui.disabled);const C=w.renderingMode==="3d"?new Pt(d.context.gl.LEQUAL,Pt.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,Pt.ReadOnly);x.setDepthMode(C),w.render(x.gl,d.transform.customLayerMatrix()),x.setDirty(),d.setBaseState(),x.bindFramebuffer.set(null)}})(t,0,a)}}translatePosMatrix(t,n,a,c,d){if(!a[0]&&!a[1])return t;const m=d?c==="map"?this.transform.angle:0:c==="viewport"?-this.transform.angle:0;if(m){const w=Math.sin(m),C=Math.cos(m);a=[a[0]*C-a[1]*w,a[0]*w+a[1]*C]}const g=[d?a[0]:ee(n,a[0],this.transform.zoom),d?a[1]:ee(n,a[1],this.transform.zoom),0],x=new Float32Array(16);return o.$(x,t,g),x}saveTileTexture(t){const n=this._tileTextures[t.size[0]];n?n.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const n=this._tileTextures[t];return n&&n.length>0?n.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const n=this.imageManager.getPattern(t.from.toString()),a=this.imageManager.getPattern(t.to.toString());return!n||!a}useProgram(t,n){this.cache=this.cache||{};const a=t+(n?n.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[a]||(this.cache[a]=new Ws(this.context,li[t],n,Qs[t],this._showOverdrawInspector,this.style.map.terrain)),this.cache[a]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Fe(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:n}=this.context.gl;return this.width!==t||this.height!==n}}class mr{constructor(t,n){this.points=t,this.planes=n}static fromInvProjectionMatrix(t,n,a){const c=Math.pow(2,a),d=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(g=>{const x=1/(g=o.ag([],g,t))[3]/n*c;return o.b3(g,g,[x,x,1/g[3],x])}),m=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(g=>{const x=function(z,V){var j=V[0],Z=V[1],N=V[2],te=j*j+Z*Z+N*N;return te>0&&(te=1/Math.sqrt(te)),z[0]=V[0]*te,z[1]=V[1]*te,z[2]=V[2]*te,z}([],function(z,V,j){var Z=V[0],N=V[1],te=V[2],le=j[0],K=j[1],re=j[2];return z[0]=N*re-te*K,z[1]=te*le-Z*re,z[2]=Z*K-N*le,z}([],at([],d[g[0]],d[g[1]]),at([],d[g[2]],d[g[1]]))),w=-((C=x)[0]*(T=d[g[1]])[0]+C[1]*T[1]+C[2]*T[2]);var C,T;return x.concat(w)});return new mr(d,m)}}class ns{constructor(t,n){this.min=t,this.max=n,this.center=function(a,c,d){return a[0]=.5*c[0],a[1]=.5*c[1],a[2]=.5*c[2],a}([],function(a,c,d){return a[0]=c[0]+d[0],a[1]=c[1]+d[1],a[2]=c[2]+d[2],a}([],this.min,this.max))}quadrant(t){const n=[t%2==0,t<2],a=Oe(this.min),c=Oe(this.max);for(let d=0;d<n.length;d++)a[d]=n[d]?this.min[d]:this.center[d],c[d]=n[d]?this.center[d]:this.max[d];return c[2]=this.max[2],new ns(a,c)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const n=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let a=!0;for(let c=0;c<t.planes.length;c++){const d=t.planes[c];let m=0;for(let g=0;g<n.length;g++)o.b4(d,n[g])>=0&&m++;if(m===0)return 0;m!==n.length&&(a=!1)}if(a)return 2;for(let c=0;c<3;c++){let d=Number.MAX_VALUE,m=-Number.MAX_VALUE;for(let g=0;g<t.points.length;g++){const x=t.points[g][c]-this.min[c];d=Math.min(d,x),m=Math.max(m,x)}if(m<0||d>this.max[c]-this.min[c])return 0}return 1}}class Ms{constructor(t=0,n=0,a=0,c=0){if(isNaN(t)||t<0||isNaN(n)||n<0||isNaN(a)||a<0||isNaN(c)||c<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=n,this.left=a,this.right=c}interpolate(t,n,a){return n.top!=null&&t.top!=null&&(this.top=o.B.number(t.top,n.top,a)),n.bottom!=null&&t.bottom!=null&&(this.bottom=o.B.number(t.bottom,n.bottom,a)),n.left!=null&&t.left!=null&&(this.left=o.B.number(t.left,n.left,a)),n.right!=null&&t.right!=null&&(this.right=o.B.number(t.right,n.right,a)),this}getCenter(t,n){const a=o.ad((this.left+t-this.right)/2,0,t),c=o.ad((this.top+n-this.bottom)/2,0,n);return new o.P(a,c)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Ms(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class fa{constructor(t,n,a,c,d){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=d===void 0||!!d,this._minZoom=t||0,this._maxZoom=n||22,this._minPitch=a??0,this._maxPitch=c??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new o.L(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Ms,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const t=new fa(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this._minEleveationForCurrentTile=t._minEleveationForCurrentTile,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const n=-o.b5(t,-180,180)*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=function(){var a=new o.A(4);return o.A!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a}(),function(a,c,d){var m=c[0],g=c[1],x=c[2],w=c[3],C=Math.sin(d),T=Math.cos(d);a[0]=m*T+x*C,a[1]=g*T+w*C,a[2]=m*-C+x*T,a[3]=g*-C+w*T}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const n=o.ad(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const n=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==n&&(this._unmodified=!1,this._zoom=n,this.tileZoom=Math.max(0,Math.floor(n)),this.scale=this.zoomScale(n),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,n,a){this._unmodified=!1,this._edgeInsets.interpolate(t,n,a),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const n=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,n)}getVisibleUnwrappedCoordinates(t){const n=[new o.b6(0,t)];if(this._renderWorldCopies){const a=this.pointCoordinate(new o.P(0,0)),c=this.pointCoordinate(new o.P(this.width,0)),d=this.pointCoordinate(new o.P(this.width,this.height)),m=this.pointCoordinate(new o.P(0,this.height)),g=Math.floor(Math.min(a.x,c.x,d.x,m.x)),x=Math.floor(Math.max(a.x,c.x,d.x,m.x)),w=1;for(let C=g-w;C<=x+w;C++)C!==0&&n.push(new o.b6(C,t))}return n}coveringTiles(t){var n,a;let c=this.coveringZoomLevel(t);const d=c;if(t.minzoom!==void 0&&c<t.minzoom)return[];t.maxzoom!==void 0&&c>t.maxzoom&&(c=t.maxzoom);const m=this.pointCoordinate(this.getCameraPoint()),g=o.U.fromLngLat(this.center),x=Math.pow(2,c),w=[x*m.x,x*m.y,0],C=[x*g.x,x*g.y,0],T=mr.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c);let z=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(z=c);const V=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,j=K=>({aabb:new ns([K*x,0,0],[(K+1)*x,x,0]),zoom:0,x:0,y:0,wrap:K,fullyVisible:!1}),Z=[],N=[],te=c,le=t.reparseOverscaled?d:c;if(this._renderWorldCopies)for(let K=1;K<=3;K++)Z.push(j(-K)),Z.push(j(K));for(Z.push(j(0));Z.length>0;){const K=Z.pop(),re=K.x,he=K.y;let pe=K.fullyVisible;if(!pe){const Xe=K.aabb.intersects(T);if(Xe===0)continue;pe=Xe===2}const xe=t.terrain?w:C,Ie=K.aabb.distanceX(xe),Se=K.aabb.distanceY(xe),ke=Math.max(Math.abs(Ie),Math.abs(Se));if(K.zoom===te||ke>V+(1<<te-K.zoom)-2&&K.zoom>=z){const Xe=te-K.zoom,Ct=w[0]-.5-(re<<Xe),Le=w[1]-.5-(he<<Xe);N.push({tileID:new o.O(K.zoom===te?le:K.zoom,K.wrap,K.zoom,re,he),distanceSq:tt([C[0]-.5-re,C[1]-.5-he]),tileDistanceToCamera:Math.sqrt(Ct*Ct+Le*Le)})}else for(let Xe=0;Xe<4;Xe++){const Ct=(re<<1)+Xe%2,Le=(he<<1)+(Xe>>1),ut=K.zoom+1;let Ye=K.aabb.quadrant(Xe);if(t.terrain){const Zt=new o.O(ut,K.wrap,ut,Ct,Le),St=t.terrain.getMinMaxElevation(Zt),vt=(n=St.minElevation)!==null&&n!==void 0?n:this.elevation,Tt=(a=St.maxElevation)!==null&&a!==void 0?a:this.elevation;Ye=new ns([Ye.min[0],Ye.min[1],vt],[Ye.max[0],Ye.max[1],Tt])}Z.push({aabb:Ye,zoom:ut,x:Ct,y:Le,wrap:K.wrap,fullyVisible:pe})}}return N.sort((K,re)=>K.distanceSq-re.distanceSq).map(K=>K.tileID)}resize(t,n){this.width=t,this.height=n,this.pixelsToGLUnits=[2/t,-2/n],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const n=o.ad(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new o.P(o.G(t.lng)*this.worldSize,o.H(n)*this.worldSize)}unproject(t){return new o.U(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const n=this.pointLocation(this.centerPoint,t),a=t.getElevationForLngLatZoom(n,this.tileZoom);if(!(this.elevation-a))return;const c=this.getCameraPosition(),d=o.U.fromLngLat(c.lngLat,c.altitude),m=o.U.fromLngLat(n,a),g=d.x-m.x,x=d.y-m.y,w=d.z-m.z,C=Math.sqrt(g*g+x*x+w*w),T=this.scaleZoom(this.cameraToCenterDistance/C/this.tileSize);this._elevation=a,this._center=n,this.zoom=T}setLocationAtPoint(t,n){const a=this.pointCoordinate(n),c=this.pointCoordinate(this.centerPoint),d=this.locationCoordinate(t),m=new o.U(d.x-(a.x-c.x),d.y-(a.y-c.y));this.center=this.coordinateLocation(m),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,n){return n?this.coordinatePoint(this.locationCoordinate(t),n.getElevationForLngLatZoom(t,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,n){return this.coordinateLocation(this.pointCoordinate(t,n))}locationCoordinate(t){return o.U.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,n){if(n){const z=n.pointCoordinate(t);if(z!=null)return z}const a=[t.x,t.y,0,1],c=[t.x,t.y,1,1];o.ag(a,a,this.pixelMatrixInverse),o.ag(c,c,this.pixelMatrixInverse);const d=a[3],m=c[3],g=a[1]/d,x=c[1]/m,w=a[2]/d,C=c[2]/m,T=w===C?0:(0-w)/(C-w);return new o.U(o.B.number(a[0]/d,c[0]/m,T)/this.worldSize,o.B.number(g,x,T)/this.worldSize)}coordinatePoint(t,n=0,a=this.pixelMatrix){const c=[t.x*this.worldSize,t.y*this.worldSize,n,1];return o.ag(c,c,a),new o.P(c[0]/c[3],c[1]/c[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new Ue().extend(this.pointLocation(new o.P(0,t))).extend(this.pointLocation(new o.P(this.width,t))).extend(this.pointLocation(new o.P(this.width,this.height))).extend(this.pointLocation(new o.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Ue([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(t,n=!1){const a=t.key,c=n?this._alignedPosMatrixCache:this._posMatrixCache;if(c[a])return c[a];const d=t.canonical,m=this.worldSize/this.zoomScale(d.z),g=d.x+Math.pow(2,d.z)*t.wrap,x=o.ao(new Float64Array(16));return o.$(x,x,[g*m,d.y*m,0]),o.a0(x,x,[m/o.N,m/o.N,1]),o.a1(x,n?this.alignedProjMatrix:this.projMatrix,x),c[a]=new Float32Array(x),c[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t,n,a,c,d=-90,m=90,g=-180,x=180;const w=this.size,C=this._unmodified;if(this.latRange){const V=this.latRange;d=o.H(V[1])*this.worldSize,m=o.H(V[0])*this.worldSize,t=m-d<w.y?w.y/(m-d):0}if(this.lngRange){const V=this.lngRange;g=o.b5(o.G(V[0])*this.worldSize,0,this.worldSize),x=o.b5(o.G(V[1])*this.worldSize,0,this.worldSize),x<g&&(x+=this.worldSize),n=x-g<w.x?w.x/(x-g):0}const T=this.point,z=Math.max(n||0,t||0);if(z)return this.center=this.unproject(new o.P(n?(x+g)/2:T.x,t?(m+d)/2:T.y)),this.zoom+=this.scaleZoom(z),this._unmodified=C,void(this._constraining=!1);if(this.latRange){const V=T.y,j=w.y/2;V-j<d&&(c=d+j),V+j>m&&(c=m-j)}if(this.lngRange){const V=(g+x)/2,j=o.b5(T.x,V-this.worldSize/2,V+this.worldSize/2),Z=w.x/2;j-Z<g&&(a=g+Z),j+Z>x&&(a=x-Z)}a===void 0&&c===void 0||(this.center=this.unproject(new o.P(a!==void 0?a:T.x,c!==void 0?c:T.y)).wrap()),this._unmodified=C,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,n=this.point.x,a=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=o.b7(1,this.center.lat)*this.worldSize;let c=o.ao(new Float64Array(16));o.a0(c,c,[this.width/2,-this.height/2,1]),o.$(c,c,[1,-1,0]),this.labelPlaneMatrix=c,c=o.ao(new Float64Array(16)),o.a0(c,c,[1,-1,1]),o.$(c,c,[-1,-1,0]),o.a0(c,c,[2/this.width,2/this.height,1]),this.glCoordMatrix=c;const d=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),m=Math.min(this.elevation,this._minEleveationForCurrentTile),g=d-m*this._pixelPerMeter/Math.cos(this._pitch),x=m<0?g:d,w=Math.PI/2+this._pitch,C=this._fov*(.5+t.y/this.height),T=Math.sin(C)*x/Math.sin(o.ad(Math.PI-w-C,.01,Math.PI-.01)),z=this.getHorizon(),V=2*Math.atan(z/this.cameraToCenterDistance)*(.5+t.y/(2*z)),j=Math.sin(V)*x/Math.sin(o.ad(Math.PI-w-V,.01,Math.PI-.01)),Z=Math.min(T,j),N=1.01*(Math.cos(Math.PI/2-this._pitch)*Z+x),te=this.height/50;c=new Float64Array(16),o.b8(c,this._fov,this.width/this.height,te,N),c[8]=2*-t.x/this.width,c[9]=2*t.y/this.height,o.a0(c,c,[1,-1,1]),o.$(c,c,[0,0,-this.cameraToCenterDistance]),o.b9(c,c,this._pitch),o.ae(c,c,this.angle),o.$(c,c,[-n,-a,0]),this.mercatorMatrix=o.a0([],c,[this.worldSize,this.worldSize,this.worldSize]),o.a0(c,c,[1,1,this._pixelPerMeter]),this.pixelMatrix=o.a1(new Float64Array(16),this.labelPlaneMatrix,c),o.$(c,c,[0,0,-this.elevation]),this.projMatrix=c,this.invProjMatrix=o.as([],c),this.pixelMatrix3D=o.a1(new Float64Array(16),this.labelPlaneMatrix,c);const le=this.width%2/2,K=this.height%2/2,re=Math.cos(this.angle),he=Math.sin(this.angle),pe=n-Math.round(n)+re*le+he*K,xe=a-Math.round(a)+re*K+he*le,Ie=new Float64Array(c);if(o.$(Ie,Ie,[pe>.5?pe-1:pe,xe>.5?xe-1:xe,0]),this.alignedProjMatrix=Ie,c=o.as(new Float64Array(16),this.pixelMatrix),!c)throw new Error("failed to invert matrix");this.pixelMatrixInverse=c,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new o.P(0,0)),n=[t.x*this.worldSize,t.y*this.worldSize,0,1];return o.ag(n,n,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,t))}getCameraQueryGeometry(t){const n=this.getCameraPoint();if(t.length===1)return[t[0],n];{let a=n.x,c=n.y,d=n.x,m=n.y;for(const g of t)a=Math.min(a,g.x),c=Math.min(c,g.y),d=Math.max(d,g.x),m=Math.max(m,g.y);return[new o.P(a,c),new o.P(d,c),new o.P(d,m),new o.P(a,m),new o.P(a,c)]}}}function Nn(u,t){let n,a=!1,c=null,d=null;const m=()=>{c=null,a&&(u.apply(d,n),c=setTimeout(m,t),a=!1)};return(...g)=>(a=!0,d=this,n=g,c||m(),c)}class ks{constructor(t){this._getCurrentHash=()=>{const n=window.location.hash.replace("#","");if(this._hashName){let a;return n.split("&").map(c=>c.split("=")).forEach(c=>{c[0]===this._hashName&&(a=c)}),(a&&a[1]||"").split("/")}return n.split("/")},this._onHashChange=()=>{const n=this._getCurrentHash();if(n.length>=3&&!n.some(a=>isNaN(a))){const a=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:a,pitch:+(n[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const n=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,n)}catch{}},this._updateHash=Nn(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const n=this._map.getCenter(),a=Math.round(100*this._map.getZoom())/100,c=Math.ceil((a*Math.LN2+Math.log(512/360/.5))/Math.LN10),d=Math.pow(10,c),m=Math.round(n.lng*d)/d,g=Math.round(n.lat*d)/d,x=this._map.getBearing(),w=this._map.getPitch();let C="";if(C+=t?`/${m}/${g}/${a}`:`${a}/${g}/${m}`,(x||w)&&(C+="/"+Math.round(10*x)/10),w&&(C+=`/${Math.round(w)}`),this._hashName){const T=this._hashName;let z=!1;const V=window.location.hash.slice(1).split("&").map(j=>{const Z=j.split("=")[0];return Z===T?(z=!0,`${Z}=${C}`):j}).filter(j=>j);return z||V.push(`${T}=${C}`),`#${V.join("&")}`}return`#${C}`}}const ss={linearity:.3,easing:o.ba(0,0,.3,1)},fl=o.e({deceleration:2500,maxSpeed:1400},ss),ml=o.e({deceleration:20,maxSpeed:1400},ss),gl=o.e({deceleration:1e3,maxSpeed:360},ss),_l=o.e({deceleration:1e3,maxSpeed:90},ss);class yl{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.h.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,n=o.h.now();for(;t.length>0&&n-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:d}of this._inertiaBuffer)n.zoom+=d.zoomDelta||0,n.bearing+=d.bearingDelta||0,n.pitch+=d.pitchDelta||0,d.panDelta&&n.pan._add(d.panDelta),d.around&&(n.around=d.around),d.pinchAround&&(n.pinchAround=d.pinchAround);const a=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,c={};if(n.pan.mag()){const d=As(n.pan.mag(),a,o.e({},fl,t||{}));c.offset=n.pan.mult(d.amount/n.pan.mag()),c.center=this._map.transform.center,Jr(c,d)}if(n.zoom){const d=As(n.zoom,a,ml);c.zoom=this._map.transform.zoom+d.amount,Jr(c,d)}if(n.bearing){const d=As(n.bearing,a,gl);c.bearing=this._map.transform.bearing+o.ad(d.amount,-179,179),Jr(c,d)}if(n.pitch){const d=As(n.pitch,a,_l);c.pitch=this._map.transform.pitch+d.amount,Jr(c,d)}if(c.zoom||c.bearing){const d=n.pinchAround===void 0?n.around:n.pinchAround;c.around=d?this._map.unproject(d):this._map.getCenter()}return this.clear(),o.e(c,{noMoveStart:!0})}}function Jr(u,t){(!u.duration||u.duration<t.duration)&&(u.duration=t.duration,u.easing=t.easing)}function As(u,t,n){const{maxSpeed:a,linearity:c,deceleration:d}=n,m=o.ad(u*c/(t/1e3),-a,a),g=Math.abs(m)/(d*c);return{easing:n.easing,duration:1e3*g,amount:m*(g/2)}}class Er extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,a,c={}){const d=B.mousePos(n.getCanvasContainer(),a),m=n.unproject(d);super(t,o.e({point:d,lngLat:m,originalEvent:a},c)),this._defaultPrevented=!1,this.target=n}}class Ps extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,a){const c=t==="touchend"?a.changedTouches:a.touches,d=B.touchPos(n.getCanvasContainer(),c),m=d.map(x=>n.unproject(x)),g=d.reduce((x,w,C,T)=>x.add(w.div(T.length)),new o.P(0,0));super(t,{points:d,point:g,lngLats:m,lngLat:n.unproject(g),originalEvent:a}),this._defaultPrevented=!1}}class xl extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,a){super(t,{originalEvent:a}),this._defaultPrevented=!1}}class vl{constructor(t,n){this._map=t,this._clickTolerance=n.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new xl(t.type,this._map,t))}mousedown(t,n){return this._mousedownPos=n,this._firePreventable(new Er(t.type,this._map,t))}mouseup(t){this._map.fire(new Er(t.type,this._map,t))}click(t,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||this._map.fire(new Er(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Er(t.type,this._map,t))}mouseover(t){this._map.fire(new Er(t.type,this._map,t))}mouseout(t){this._map.fire(new Er(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Ps(t.type,this._map,t))}touchmove(t){this._map.fire(new Ps(t.type,this._map,t))}touchend(t){this._map.fire(new Ps(t.type,this._map,t))}touchcancel(t){this._map.fire(new Ps(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class bl{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Er(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Er("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Er(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class cn{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(o.P.convert(t),this._map.terrain)}}class wl{constructor(t,n){this._map=t,this._tr=new cn(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,n){this.isEnabled()&&t.shiftKey&&t.button===0&&(B.disableDrag(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(t,n){if(!this._active)return;const a=n;if(this._lastPos.equals(a)||!this._box&&a.dist(this._startPos)<this._clickTolerance)return;const c=this._startPos;this._lastPos=a,this._box||(this._box=B.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const d=Math.min(c.x,a.x),m=Math.max(c.x,a.x),g=Math.min(c.y,a.y),x=Math.max(c.y,a.y);B.setTransform(this._box,`translate(${d}px,${g}px)`),this._box.style.width=m-d+"px",this._box.style.height=x-g+"px"}mouseupWindow(t,n){if(!this._active||t.button!==0)return;const a=this._startPos,c=n;if(this.reset(),B.suppressClick(),a.x!==c.x||a.y!==c.y)return this._map.fire(new o.k("boxzoomend",{originalEvent:t})),{cameraAnimation:d=>d.fitScreenCoordinates(a,c,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(B.remove(this._box),this._box=null),B.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,n){return this._map.fire(new o.k(t,{originalEvent:n}))}}function Nr(u,t){if(u.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${u.length}, points ${t.length}`);const n={};for(let a=0;a<u.length;a++)n[u[a].identifier]=t[a];return n}class un{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,n,a){(this.centroid||a.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),a.length===this.numTouches&&(this.centroid=function(c){const d=new o.P(0,0);for(const m of c)d._add(m);return d.div(c.length)}(n),this.touches=Nr(a,n)))}touchmove(t,n,a){if(this.aborted||!this.centroid)return;const c=Nr(a,n);for(const d in this.touches){const m=c[d];(!m||m.dist(this.touches[d])>30)&&(this.aborted=!0)}}touchend(t,n,a){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),a.length===0){const c=!this.aborted&&this.centroid;if(this.reset(),c)return c}}}class ma{constructor(t){this.singleTap=new un(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,n,a){this.singleTap.touchstart(t,n,a)}touchmove(t,n,a){this.singleTap.touchmove(t,n,a)}touchend(t,n,a){const c=this.singleTap.touchend(t,n,a);if(c){const d=t.timeStamp-this.lastTime<500,m=!this.lastTap||this.lastTap.dist(c)<30;if(d&&m||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=c,this.count===this.numTaps)return this.reset(),c}}}class hn{constructor(t){this._tr=new cn(t),this._zoomIn=new ma({numTouches:1,numTaps:2}),this._zoomOut=new ma({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,n,a){this._zoomIn.touchstart(t,n,a),this._zoomOut.touchstart(t,n,a)}touchmove(t,n,a){this._zoomIn.touchmove(t,n,a),this._zoomOut.touchmove(t,n,a)}touchend(t,n,a){const c=this._zoomIn.touchend(t,n,a),d=this._zoomOut.touchend(t,n,a),m=this._tr;return c?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:g=>g.easeTo({duration:300,zoom:m.zoom+1,around:m.unproject(c)},{originalEvent:t})}):d?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:g=>g.easeTo({duration:300,zoom:m.zoom-1,around:m.unproject(d)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class dn{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const n=this._moveFunction(...t);if(n.bearingDelta||n.pitchDelta||n.around||n.panDelta)return this._active=!0,n}dragStart(t,n){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=n.length?n[0]:n,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,n){if(!this.isEnabled())return;const a=this._lastPoint;if(!a)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const c=n.length?n[0]:n;return!this._moved&&c.dist(a)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=c,this._move(a,c))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&B.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Ic={0:1,2:2};class no{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const n=B.mouseButton(t);this._eventButton=n}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(n,a){const c=Ic[a];return n.buttons===void 0||(n.buttons&c)!==c}(t,this._eventButton)}isValidEndEvent(t){return B.mouseButton(t)===this._eventButton}}class Sl{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}const ga=u=>{u.mousedown=u.dragStart,u.mousemoveWindow=u.dragMove,u.mouseup=u.dragEnd,u.contextmenu=function(t){t.preventDefault()}},as=({enable:u,clickTolerance:t,bearingDegreesPerPixelMoved:n=.8})=>{const a=new no({checkCorrectEvent:c=>B.mouseButton(c)===0&&c.ctrlKey||B.mouseButton(c)===2});return new dn({clickTolerance:t,move:(c,d)=>({bearingDelta:(d.x-c.x)*n}),moveStateManager:a,enable:u,assignEvents:ga})},pn=({enable:u,clickTolerance:t,pitchDegreesPerPixelMoved:n=-.5})=>{const a=new no({checkCorrectEvent:c=>B.mouseButton(c)===0&&c.ctrlKey||B.mouseButton(c)===2});return new dn({clickTolerance:t,move:(c,d)=>({pitchDelta:(d.y-c.y)*n}),moveStateManager:a,enable:u,assignEvents:ga})};class Ze{constructor(t,n){this._minTouches=t.cooperativeGestures?2:1,this._clickTolerance=t.clickTolerance||1,this._map=n,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(t,n,a){return this._calculateTransform(t,n,a)}touchmove(t,n,a){if(this._map._cooperativeGestures&&(this._minTouches===2&&a.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(t,!1,a.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(a.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,n,a)}touchend(t,n,a){this._calculateTransform(t,n,a),this._active&&a.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,n,a){a.length>0&&(this._active=!0);const c=Nr(a,n),d=new o.P(0,0),m=new o.P(0,0);let g=0;for(const w in c){const C=c[w],T=this._touches[w];T&&(d._add(C),m._add(C.sub(T)),g++,c[w]=C)}if(this._touches=c,g<this._minTouches||!m.mag())return;const x=m.div(g);return this._sum._add(x),this._sum.mag()<this._clickTolerance?void 0:{around:d.div(g),panDelta:x}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class _a{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,n,a){this._firstTwoTouches||a.length<2||(this._firstTwoTouches=[a[0].identifier,a[1].identifier],this._start([n[0],n[1]]))}touchmove(t,n,a){if(!this._firstTwoTouches)return;t.preventDefault();const[c,d]=this._firstTwoTouches,m=En(a,n,c),g=En(a,n,d);if(!m||!g)return;const x=this._aroundCenter?null:m.add(g).div(2);return this._move([m,g],x,t)}touchend(t,n,a){if(!this._firstTwoTouches)return;const[c,d]=this._firstTwoTouches,m=En(a,n,c),g=En(a,n,d);m&&g||(this._active&&B.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function En(u,t,n){for(let a=0;a<u.length;a++)if(u[a].identifier===n)return t[a]}function os(u,t){return Math.log(u/t)/Math.LN2}class Cl extends _a{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,n){const a=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(os(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:os(this._distance,a),pinchAround:n}}}function je(u,t){return 180*u.angleWith(t)/Math.PI}class so extends _a{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,n){const a=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:je(this._vector,a),pinchAround:n}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const n=25/(Math.PI*this._minDiameter)*360,a=je(t,this._startVector);return Math.abs(a)<n}}function ao(u){return Math.abs(u.y)>Math.abs(u.x)}class Ec extends _a{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,n,a){super.touchstart(t,n,a),this._currentTouchCount=a.length}_start(t){this._lastPoints=t,ao(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,n,a){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const c=t[0].sub(this._lastPoints[0]),d=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(c,d,a.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(c.y+d.y)/2*-.5}):void 0}gestureBeginsVertically(t,n,a){if(this._valid!==void 0)return this._valid;const c=t.mag()>=2,d=n.mag()>=2;if(!c&&!d)return;if(!c||!d)return this._firstMove===void 0&&(this._firstMove=a),a-this._firstMove<100&&void 0;const m=t.y>0==n.y>0;return ao(t)&&ao(n)&&m}}const oo={panStep:100,bearingStep:15,pitchStep:10};class Tl{constructor(t){this._tr=new cn(t);const n=oo;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let n=0,a=0,c=0,d=0,m=0;switch(t.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:t.shiftKey?a=-1:(t.preventDefault(),d=-1);break;case 39:t.shiftKey?a=1:(t.preventDefault(),d=1);break;case 38:t.shiftKey?c=1:(t.preventDefault(),m=-1);break;case 40:t.shiftKey?c=-1:(t.preventDefault(),m=1);break;default:return}return this._rotationDisabled&&(a=0,c=0),{cameraAnimation:g=>{const x=this._tr;g.easeTo({duration:300,easeId:"keyboardHandler",easing:Il,zoom:n?Math.round(x.zoom)+n*(t.shiftKey?2:1):x.zoom,bearing:x.bearing+a*this._bearingStep,pitch:x.pitch+c*this._pitchStep,offset:[-d*this._panStep,-m*this._panStep],center:x.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Il(u){return u*(2-u)}const El=4.000244140625;class Mc{constructor(t,n){this._onTimeout=a=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)},this._map=t,this._tr=new cn(t),this._el=t.getCanvasContainer(),this._triggerRenderFrame=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!t[this._map._metaKey])return;t.preventDefault()}let n=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const a=o.h.now(),c=a-(this._lastWheelEventTime||0);this._lastWheelEventTime=a,n!==0&&n%El==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":c>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(c*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),t.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=t,this._delta-=n,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=B.mousePos(this._el,t),a=this._tr;this._around=o.L.convert(this._aroundCenter?a.center:a.unproject(n)),this._aroundPoint=a.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(this._delta!==0){const g=this._type==="wheel"&&Math.abs(this._delta)>El?this._wheelZoomRate:this._defaultZoomRate;let x=2/(1+Math.exp(-Math.abs(this._delta*g)));this._delta<0&&x!==0&&(x=1/x);const w=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(w*x))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const n=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,a=this._startZoom,c=this._easing;let d,m=!1;if(this._type==="wheel"&&a&&c){const g=Math.min((o.h.now()-this._lastWheelEventTime)/200,1),x=c(g);d=o.B.number(a,n,x),g<1?this._frameId||(this._frameId=!0):m=!0}else d=n,m=!0;return this._active=!0,m&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!m,zoomDelta:d-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let n=o.bb;if(this._prevEase){const a=this._prevEase,c=(o.h.now()-a.start)/a.duration,d=a.easing(c+.01)-a.easing(c),m=.27/Math.sqrt(d*d+1e-4)*.01,g=Math.sqrt(.0729-m*m);n=o.ba(m,g,.25,1)}return this._prevEase={start:o.h.now(),duration:t,easing:n},n}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class lo{constructor(t,n){this._clickZoom=t,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class co{constructor(t){this._tr=new cn(t),this.reset()}reset(){this._active=!1}dblclick(t,n){return t.preventDefault(),{cameraAnimation:a=>{a.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(n)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class uo{constructor(){this._tap=new ma({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,n,a){if(!this._swipePoint)if(this._tapTime){const c=n[0],d=t.timeStamp-this._tapTime<500,m=this._tapPoint.dist(c)<30;d&&m?a.length>0&&(this._swipePoint=c,this._swipeTouch=a[0].identifier):this.reset()}else this._tap.touchstart(t,n,a)}touchmove(t,n,a){if(this._tapTime){if(this._swipePoint){if(a[0].identifier!==this._swipeTouch)return;const c=n[0],d=c.y-this._swipePoint.y;return this._swipePoint=c,t.preventDefault(),this._active=!0,{zoomDelta:d/128}}}else this._tap.touchmove(t,n,a)}touchend(t,n,a){if(this._tapTime)this._swipePoint&&a.length===0&&this.reset();else{const c=this._tap.touchend(t,n,a);c&&(this._tapTime=t.timeStamp,this._tapPoint=c)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ho{constructor(t,n,a){this._el=t,this._mousePan=n,this._touchPan=a}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class gr{constructor(t,n,a){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=n,this._mousePitch=a}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Mn{constructor(t,n,a,c){this._el=t,this._touchZoom=n,this._touchRotate=a,this._tapDragZoom=c,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const zs=u=>u.zoom||u.drag||u.pitch||u.rotate;class po extends o.k{}function Ds(u){return u.panDelta&&u.panDelta.mag()||u.zoomDelta||u.bearingDelta||u.pitchDelta}class fo{constructor(t,n){this.handleWindowEvent=c=>{this.handleEvent(c,`${c.type}Window`)},this.handleEvent=(c,d)=>{if(c.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const m=c.type==="renderFrame"?void 0:c,g={needsRenderFrame:!1},x={},w={},C=c.touches,T=C?this._getMapTouches(C):void 0,z=T?B.touchPos(this._el,T):B.mousePos(this._el,c);for(const{handlerName:Z,handler:N,allowed:te}of this._handlers){if(!N.isEnabled())continue;let le;this._blockedByActive(w,te,Z)?N.reset():N[d||c.type]&&(le=N[d||c.type](c,z,T),this.mergeHandlerResult(g,x,le,Z,m),le&&le.needsRenderFrame&&this._triggerRenderFrame()),(le||N.isActive())&&(w[Z]=N)}const V={};for(const Z in this._previousActiveHandlers)w[Z]||(V[Z]=m);this._previousActiveHandlers=w,(Object.keys(V).length||Ds(g))&&(this._changes.push([g,x,V]),this._triggerRenderFrame()),(Object.keys(w).length||Ds(g))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:j}=g;j&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],j(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new yl(t),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(n);const a=this._el;this._listeners=[[a,"touchstart",{passive:!0}],[a,"touchmove",{passive:!1}],[a,"touchend",void 0],[a,"touchcancel",void 0],[a,"mousedown",void 0],[a,"mousemove",void 0],[a,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[a,"mouseover",void 0],[a,"mouseout",void 0],[a,"dblclick",void 0],[a,"click",void 0],[a,"keydown",{capture:!1}],[a,"keyup",void 0],[a,"wheel",{passive:!1}],[a,"contextmenu",void 0],[window,"blur",void 0]];for(const[c,d,m]of this._listeners)B.addEventListener(c,d,c===document?this.handleWindowEvent:this.handleEvent,m)}destroy(){for(const[t,n,a]of this._listeners)B.removeEventListener(t,n,t===document?this.handleWindowEvent:this.handleEvent,a)}_addDefaultHandlers(t){const n=this._map,a=n.getCanvasContainer();this._add("mapEvent",new vl(n,t));const c=n.boxZoom=new wl(n,t);this._add("boxZoom",c),t.interactive&&t.boxZoom&&c.enable();const d=new hn(n),m=new co(n);n.doubleClickZoom=new lo(m,d),this._add("tapZoom",d),this._add("clickZoom",m),t.interactive&&t.doubleClickZoom&&n.doubleClickZoom.enable();const g=new uo;this._add("tapDragZoom",g);const x=n.touchPitch=new Ec(n);this._add("touchPitch",x),t.interactive&&t.touchPitch&&n.touchPitch.enable(t.touchPitch);const w=as(t),C=pn(t);n.dragRotate=new gr(t,w,C),this._add("mouseRotate",w,["mousePitch"]),this._add("mousePitch",C,["mouseRotate"]),t.interactive&&t.dragRotate&&n.dragRotate.enable();const T=(({enable:te,clickTolerance:le})=>{const K=new no({checkCorrectEvent:re=>B.mouseButton(re)===0&&!re.ctrlKey});return new dn({clickTolerance:le,move:(re,he)=>({around:he,panDelta:he.sub(re)}),activateOnStart:!0,moveStateManager:K,enable:te,assignEvents:ga})})(t),z=new Ze(t,n);n.dragPan=new ho(a,T,z),this._add("mousePan",T),this._add("touchPan",z,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&n.dragPan.enable(t.dragPan);const V=new so,j=new Cl;n.touchZoomRotate=new Mn(a,j,V,g),this._add("touchRotate",V,["touchPan","touchZoom"]),this._add("touchZoom",j,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&n.touchZoomRotate.enable(t.touchZoomRotate);const Z=n.scrollZoom=new Mc(n,()=>this._triggerRenderFrame());this._add("scrollZoom",Z,["mousePan"]),t.interactive&&t.scrollZoom&&n.scrollZoom.enable(t.scrollZoom);const N=n.keyboard=new Tl(n);this._add("keyboard",N),t.interactive&&t.keyboard&&n.keyboard.enable(),this._add("blockableMapEvent",new bl(n))}_add(t,n,a){this._handlers.push({handlerName:t,handler:n,allowed:a}),this._handlersById[t]=n}stop(t){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!zs(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,n,a){for(const c in t)if(c!==a&&(!n||n.indexOf(c)<0))return!0;return!1}_getMapTouches(t){const n=[];for(const a of t)this._el.contains(a.target)&&n.push(a);return n}mergeHandlerResult(t,n,a,c,d){if(!a)return;o.e(t,a);const m={handlerName:c,originalEvent:a.originalEvent||d};a.zoomDelta!==void 0&&(n.zoom=m),a.panDelta!==void 0&&(n.drag=m),a.pitchDelta!==void 0&&(n.pitch=m),a.bearingDelta!==void 0&&(n.rotate=m)}_applyChanges(){const t={},n={},a={};for(const[c,d,m]of this._changes)c.panDelta&&(t.panDelta=(t.panDelta||new o.P(0,0))._add(c.panDelta)),c.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+c.zoomDelta),c.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+c.bearingDelta),c.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+c.pitchDelta),c.around!==void 0&&(t.around=c.around),c.pinchAround!==void 0&&(t.pinchAround=c.pinchAround),c.noInertia&&(t.noInertia=c.noInertia),o.e(n,d),o.e(a,m);this._updateMapTransform(t,n,a),this._changes=[]}_updateMapTransform(t,n,a){const c=this._map,d=c._getTransformForUpdate(),m=c.terrain;if(!(Ds(t)||m&&this._terrainMovement))return this._fireEvents(n,a,!0);let{panDelta:g,zoomDelta:x,bearingDelta:w,pitchDelta:C,around:T,pinchAround:z}=t;z!==void 0&&(T=z),c._stop(!0),T=T||c.transform.centerPoint;const V=d.pointLocation(g?T.sub(g):T);w&&(d.bearing+=w),C&&(d.pitch+=C),x&&(d.zoom+=x),m?this._terrainMovement||!n.drag&&!n.zoom?n.drag&&this._terrainMovement?d.center=d.pointLocation(d.centerPoint.sub(g)):d.setLocationAtPoint(V,T):(this._terrainMovement=!0,this._map._elevationFreeze=!0,d.setLocationAtPoint(V,T),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,d.recalculateZoom(c.terrain)})):d.setLocationAtPoint(V,T),c._applyUpdatedTransform(d),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(n,a,!0)}_fireEvents(t,n,a){const c=zs(this._eventsInProgress),d=zs(t),m={};for(const C in t){const{originalEvent:T}=t[C];this._eventsInProgress[C]||(m[`${C}start`]=T),this._eventsInProgress[C]=t[C]}!c&&d&&this._fireEvent("movestart",d.originalEvent);for(const C in m)this._fireEvent(C,m[C]);d&&this._fireEvent("move",d.originalEvent);for(const C in t){const{originalEvent:T}=t[C];this._fireEvent(C,T)}const g={};let x;for(const C in this._eventsInProgress){const{handlerName:T,originalEvent:z}=this._eventsInProgress[C];this._handlersById[T].isActive()||(delete this._eventsInProgress[C],x=n[T]||z,g[`${C}end`]=x)}for(const C in g)this._fireEvent(C,g[C]);const w=zs(this._eventsInProgress);if(a&&(c||d)&&!w){this._updatingCamera=!0;const C=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),T=z=>z!==0&&-this._bearingSnap<z&&z<this._bearingSnap;!C||!C.essential&&o.h.prefersReducedMotion?(this._map.fire(new o.k("moveend",{originalEvent:x})),T(this._map.getBearing())&&this._map.resetNorth()):(T(C.bearing||this._map.getBearing())&&(C.bearing=0),C.freezeElevation=!0,this._map.easeTo(C,{originalEvent:x})),this._updatingCamera=!1}}_fireEvent(t,n){this._map.fire(new o.k(t,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new po("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Ml extends o.E{constructor(t,n){super(),this._renderFrameCallback=()=>{const a=Math.min((o.h.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(a)),a<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=n.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new o.L(this.transform.center.lng,this.transform.center.lat)}setCenter(t,n){return this.jumpTo({center:t},n)}panBy(t,n,a){return t=o.P.convert(t).mult(-1),this.panTo(this.transform.center,o.e({offset:t},n),a)}panTo(t,n,a){return this.easeTo(o.e({center:t},n),a)}getZoom(){return this.transform.zoom}setZoom(t,n){return this.jumpTo({zoom:t},n),this}zoomTo(t,n,a){return this.easeTo(o.e({zoom:t},n),a)}zoomIn(t,n){return this.zoomTo(this.getZoom()+1,t,n),this}zoomOut(t,n){return this.zoomTo(this.getZoom()-1,t,n),this}getBearing(){return this.transform.bearing}setBearing(t,n){return this.jumpTo({bearing:t},n),this}getPadding(){return this.transform.padding}setPadding(t,n){return this.jumpTo({padding:t},n),this}rotateTo(t,n,a){return this.easeTo(o.e({bearing:t},n),a)}resetNorth(t,n){return this.rotateTo(0,o.e({duration:1e3},t),n),this}resetNorthPitch(t,n){return this.easeTo(o.e({bearing:0,pitch:0,duration:1e3},t),n),this}snapToNorth(t,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,n):this}getPitch(){return this.transform.pitch}setPitch(t,n){return this.jumpTo({pitch:t},n),this}cameraForBounds(t,n){t=Ue.convert(t);const a=n&&n.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),a,n)}_cameraForBoxAndBearing(t,n,a,c){const d={top:0,bottom:0,right:0,left:0};if(typeof(c=o.e({padding:d,offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding=="number"){const he=c.padding;c.padding={top:he,bottom:he,right:he,left:he}}c.padding=o.e(d,c.padding);const m=this.transform,g=m.padding,x=m.project(o.L.convert(t)),w=m.project(o.L.convert(n)),C=x.rotate(-a*Math.PI/180),T=w.rotate(-a*Math.PI/180),z=new o.P(Math.max(C.x,T.x),Math.max(C.y,T.y)),V=new o.P(Math.min(C.x,T.x),Math.min(C.y,T.y)),j=z.sub(V),Z=(m.width-(g.left+g.right+c.padding.left+c.padding.right))/j.x,N=(m.height-(g.top+g.bottom+c.padding.top+c.padding.bottom))/j.y;if(N<0||Z<0)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const te=Math.min(m.scaleZoom(m.scale*Math.min(Z,N)),c.maxZoom),le=o.P.convert(c.offset),K=new o.P((c.padding.left-c.padding.right)/2,(c.padding.top-c.padding.bottom)/2).rotate(a*Math.PI/180),re=le.add(K).mult(m.scale/m.zoomScale(te));return{center:m.unproject(x.add(w).div(2).sub(re)),zoom:te,bearing:a}}fitBounds(t,n,a){return this._fitInternal(this.cameraForBounds(t,n),n,a)}fitScreenCoordinates(t,n,a,c,d){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(o.P.convert(t)),this.transform.pointLocation(o.P.convert(n)),a,c),c,d)}_fitInternal(t,n,a){return t?(delete(n=o.e(t,n)).padding,n.linear?this.easeTo(n,a):this.flyTo(n,a)):this}jumpTo(t,n){this.stop();const a=this._getTransformForUpdate();let c=!1,d=!1,m=!1;return"zoom"in t&&a.zoom!==+t.zoom&&(c=!0,a.zoom=+t.zoom),t.center!==void 0&&(a.center=o.L.convert(t.center)),"bearing"in t&&a.bearing!==+t.bearing&&(d=!0,a.bearing=+t.bearing),"pitch"in t&&a.pitch!==+t.pitch&&(m=!0,a.pitch=+t.pitch),t.padding==null||a.isPaddingEqual(t.padding)||(a.padding=t.padding),this._applyUpdatedTransform(a),this.fire(new o.k("movestart",n)).fire(new o.k("move",n)),c&&this.fire(new o.k("zoomstart",n)).fire(new o.k("zoom",n)).fire(new o.k("zoomend",n)),d&&this.fire(new o.k("rotatestart",n)).fire(new o.k("rotate",n)).fire(new o.k("rotateend",n)),m&&this.fire(new o.k("pitchstart",n)).fire(new o.k("pitch",n)).fire(new o.k("pitchend",n)),this.fire(new o.k("moveend",n))}calculateCameraOptionsFromTo(t,n,a,c=0){const d=o.U.fromLngLat(t,n),m=o.U.fromLngLat(a,c),g=m.x-d.x,x=m.y-d.y,w=m.z-d.z,C=Math.hypot(g,x,w);if(C===0)throw new Error("Can't calculate camera options with same From and To");const T=Math.hypot(g,x),z=this.transform.scaleZoom(this.transform.cameraToCenterDistance/C/this.transform.tileSize),V=180*Math.atan2(g,-x)/Math.PI;let j=180*Math.acos(T/C)/Math.PI;return j=w<0?90-j:90+j,{center:m.toLngLat(),zoom:z,pitch:j,bearing:V}}easeTo(t,n){this._stop(!1,t.easeId),((t=o.e({offset:[0,0],duration:500,easing:o.bb},t)).animate===!1||!t.essential&&o.h.prefersReducedMotion)&&(t.duration=0);const a=this._getTransformForUpdate(),c=this.getZoom(),d=this.getBearing(),m=this.getPitch(),g=this.getPadding(),x="zoom"in t?+t.zoom:c,w="bearing"in t?this._normalizeBearing(t.bearing,d):d,C="pitch"in t?+t.pitch:m,T="padding"in t?t.padding:a.padding,z=o.P.convert(t.offset);let V=a.centerPoint.add(z);const j=a.pointLocation(V),Z=o.L.convert(t.center||j);this._normalizeCenter(Z);const N=a.project(j),te=a.project(Z).sub(N),le=a.zoomScale(x-c);let K,re;t.around&&(K=o.L.convert(t.around),re=a.locationPoint(K));const he={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||x!==c,this._rotating=this._rotating||d!==w,this._pitching=this._pitching||C!==m,this._padding=!a.isPaddingEqual(T),this._easeId=t.easeId,this._prepareEase(n,t.noMoveStart,he),this.terrain&&this._prepareElevation(Z),this._ease(pe=>{if(this._zooming&&(a.zoom=o.B.number(c,x,pe)),this._rotating&&(a.bearing=o.B.number(d,w,pe)),this._pitching&&(a.pitch=o.B.number(m,C,pe)),this._padding&&(a.interpolatePadding(g,T,pe),V=a.centerPoint.add(z)),this.terrain&&!t.freezeElevation&&this._updateElevation(pe),K)a.setLocationAtPoint(K,re);else{const xe=a.zoomScale(a.zoom-c),Ie=x>c?Math.min(2,le):Math.max(.5,le),Se=Math.pow(Ie,1-pe),ke=a.unproject(N.add(te.mult(pe*Se)).mult(xe));a.setLocationAtPoint(a.renderWorldCopies?ke.wrap():ke,V)}this._applyUpdatedTransform(a),this._fireMoveEvents(n)},pe=>{this.terrain&&this._finalizeElevation(),this._afterEase(n,pe)},t),this}_prepareEase(t,n,a={}){this._moving=!0,n||a.moving||this.fire(new o.k("movestart",t)),this._zooming&&!a.zooming&&this.fire(new o.k("zoomstart",t)),this._rotating&&!a.rotating&&this.fire(new o.k("rotatestart",t)),this._pitching&&!a.pitching&&this.fire(new o.k("pitchstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const n=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&n!==this._elevationTarget){const a=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(a-(n-(a*t+this._elevationStart))/(1-t)),this._elevationTarget=n}this.transform.elevation=o.B.number(this._elevationStart,this._elevationTarget,t)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(t){if(!this.transformCameraUpdate)return;const n=t.clone(),{center:a,zoom:c,pitch:d,bearing:m,elevation:g}=this.transformCameraUpdate(n);a&&(n.center=a),c!==void 0&&(n.zoom=c),d!==void 0&&(n.pitch=d),m!==void 0&&(n.bearing=m),g!==void 0&&(n.elevation=g),this.transform.apply(n)}_fireMoveEvents(t){this.fire(new o.k("move",t)),this._zooming&&this.fire(new o.k("zoom",t)),this._rotating&&this.fire(new o.k("rotate",t)),this._pitching&&this.fire(new o.k("pitch",t))}_afterEase(t,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId;const a=this._zooming,c=this._rotating,d=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,a&&this.fire(new o.k("zoomend",t)),c&&this.fire(new o.k("rotateend",t)),d&&this.fire(new o.k("pitchend",t)),this.fire(new o.k("moveend",t))}flyTo(t,n){if(!t.essential&&o.h.prefersReducedMotion){const Ye=o.F(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ye,n)}this.stop(),t=o.e({offset:[0,0],speed:1.2,curve:1.42,easing:o.bb},t);const a=this._getTransformForUpdate(),c=this.getZoom(),d=this.getBearing(),m=this.getPitch(),g=this.getPadding(),x="zoom"in t?o.ad(+t.zoom,a.minZoom,a.maxZoom):c,w="bearing"in t?this._normalizeBearing(t.bearing,d):d,C="pitch"in t?+t.pitch:m,T="padding"in t?t.padding:a.padding,z=a.zoomScale(x-c),V=o.P.convert(t.offset);let j=a.centerPoint.add(V);const Z=a.pointLocation(j),N=o.L.convert(t.center||Z);this._normalizeCenter(N);const te=a.project(Z),le=a.project(N).sub(te);let K=t.curve;const re=Math.max(a.width,a.height),he=re/z,pe=le.mag();if("minZoom"in t){const Ye=o.ad(Math.min(t.minZoom,c,x),a.minZoom,a.maxZoom),Zt=re/a.zoomScale(Ye-c);K=Math.sqrt(Zt/pe*2)}const xe=K*K;function Ie(Ye){const Zt=(he*he-re*re+(Ye?-1:1)*xe*xe*pe*pe)/(2*(Ye?he:re)*xe*pe);return Math.log(Math.sqrt(Zt*Zt+1)-Zt)}function Se(Ye){return(Math.exp(Ye)-Math.exp(-Ye))/2}function ke(Ye){return(Math.exp(Ye)+Math.exp(-Ye))/2}const Xe=Ie(!1);let Ct=function(Ye){return ke(Xe)/ke(Xe+K*Ye)},Le=function(Ye){return re*((ke(Xe)*(Se(Zt=Xe+K*Ye)/ke(Zt))-Se(Xe))/xe)/pe;var Zt},ut=(Ie(!0)-Xe)/K;if(Math.abs(pe)<1e-6||!isFinite(ut)){if(Math.abs(re-he)<1e-6)return this.easeTo(t,n);const Ye=he<re?-1:1;ut=Math.abs(Math.log(he/re))/K,Le=function(){return 0},Ct=function(Zt){return Math.exp(Ye*K*Zt)}}return t.duration="duration"in t?+t.duration:1e3*ut/("screenSpeed"in t?+t.screenSpeed/K:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=d!==w,this._pitching=C!==m,this._padding=!a.isPaddingEqual(T),this._prepareEase(n,!1),this.terrain&&this._prepareElevation(N),this._ease(Ye=>{const Zt=Ye*ut,St=1/Ct(Zt);a.zoom=Ye===1?x:c+a.scaleZoom(St),this._rotating&&(a.bearing=o.B.number(d,w,Ye)),this._pitching&&(a.pitch=o.B.number(m,C,Ye)),this._padding&&(a.interpolatePadding(g,T,Ye),j=a.centerPoint.add(V)),this.terrain&&!t.freezeElevation&&this._updateElevation(Ye);const vt=Ye===1?N:a.unproject(te.add(le.mult(Le(Zt))).mult(St));a.setLocationAtPoint(a.renderWorldCopies?vt.wrap():vt,j),this._applyUpdatedTransform(a),this._fireMoveEvents(n)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(n)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,n){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const a=this._onEaseEnd;delete this._onEaseEnd,a.call(this,n)}if(!t){const a=this.handlers;a&&a.stop(!1)}return this}_ease(t,n,a){a.animate===!1||a.duration===0?(t(1),n()):(this._easeStart=o.h.now(),this._easeOptions=a,this._onEaseFrame=t,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,n){t=o.b5(t,-180,180);const a=Math.abs(t-n);return Math.abs(t-360-n)<a&&(t-=360),Math.abs(t+360-n)<a&&(t+=360),t}_normalizeCenter(t){const n=this.transform;if(!n.renderWorldCopies||n.lngRange)return;const a=t.lng-n.center.lng;t.lng+=a>180?-360:a<-180?360:0}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(o.L.convert(t),this.transform.tileZoom)-this.transform.elevation:null}}class Mr{constructor(t={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=n=>{!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"&&n.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options&&this.options.compact,this._container=B.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=B.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=B.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){B.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,n){const a=this._map._getUIString(`AttributionControl.${n}`);t.title=a,t.setAttribute("aria-label",a)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(c=>typeof c!="string"?"":c)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const c=this._map.style.stylesheet;this.styleOwner=c.owner,this.styleId=c.id}const n=this._map.style.sourceCaches;for(const c in n){const d=n[c];if(d.used||d.usedForTerrain){const m=d.getSource();m.attribution&&t.indexOf(m.attribution)<0&&t.push(m.attribution)}}t=t.filter(c=>String(c).trim()),t.sort((c,d)=>c.length-d.length),t=t.filter((c,d)=>{for(let m=d+1;m<t.length;m++)if(t[m].indexOf(c)>=0)return!1;return!0});const a=t.join(" | ");a!==this._attribHTML&&(this._attribHTML=a,t.length?(this._innerContainer.innerHTML=a,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class ti{constructor(t={}){this._updateCompact=()=>{const n=this._container.children;if(n.length){const a=n[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&a.classList.add("maplibregl-compact"):a.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=B.create("div","maplibregl-ctrl");const n=B.create("a","maplibregl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://maplibre.org/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){B.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class ya{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const n=++this._id;return this._queue.push({callback:t,id:n,cancelled:!1}),n}remove(t){const n=this._currentlyRunning,a=n?this._queue.concat(n):this._queue;for(const c of a)if(c.id===t)return void(c.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const n=this._currentlyRunning=this._queue;this._queue=[];for(const a of n)if(!a.cancelled&&(a.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const mo={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var kl=o.Q([{name:"a_pos3d",type:"Int16",components:3}]);class Al extends o.E{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,n){this.sourceCache.update(t,n),this._renderableTilesKeys=[];const a={};for(const c of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:n}))a[c.key]=!0,this._renderableTilesKeys.push(c.key),this._tiles[c.key]||(c.posMatrix=new Float64Array(16),o.aS(c.posMatrix,0,o.N,0,o.N,0,1),this._tiles[c.key]=new fr(c,this.tileSize));for(const c in this._tiles)a[c]||delete this._tiles[c]}freeRtt(t){for(const n in this._tiles){const a=this._tiles[n];(!t||a.tileID.equals(t)||a.tileID.isChildOf(t)||t.isChildOf(a.tileID))&&(a.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const n={};for(const a of this._renderableTilesKeys){const c=this._tiles[a].tileID;if(c.canonical.equals(t.canonical)){const d=t.clone();d.posMatrix=new Float64Array(16),o.aS(d.posMatrix,0,o.N,0,o.N,0,1),n[a]=d}else if(c.canonical.isChildOf(t.canonical)){const d=t.clone();d.posMatrix=new Float64Array(16);const m=c.canonical.z-t.canonical.z,g=c.canonical.x-(c.canonical.x>>m<<m),x=c.canonical.y-(c.canonical.y>>m<<m),w=o.N>>m;o.aS(d.posMatrix,0,w,0,w,0,1),o.$(d.posMatrix,d.posMatrix,[-g*w,-x*w,0]),n[a]=d}else if(t.canonical.isChildOf(c.canonical)){const d=t.clone();d.posMatrix=new Float64Array(16);const m=t.canonical.z-c.canonical.z,g=t.canonical.x-(t.canonical.x>>m<<m),x=t.canonical.y-(t.canonical.y>>m<<m),w=o.N>>m;o.aS(d.posMatrix,0,o.N,0,o.N,0,1),o.$(d.posMatrix,d.posMatrix,[g*w,x*w,0]),o.a0(d.posMatrix,d.posMatrix,[1/2**m,1/2**m,0]),n[a]=d}}return n}getSourceTile(t,n){const a=this.sourceCache._source;let c=t.overscaledZ-this.deltaZoom;if(c>a.maxzoom&&(c=a.maxzoom),c<a.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(c).key);let d=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!d||!d.dem)&&n)for(;c>=a.minzoom&&(!d||!d.dem);)d=this.sourceCache.getTileByID(t.scaledTo(c--).key);return d}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(n=>n.timeAdded>=t)}}class Pl{constructor(t,n,a){this.painter=t,this.sourceCache=new Al(n),this.options=a,this.exaggeration=typeof a.exaggeration=="number"?a.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,n,a,c=o.N){var d;if(!(n>=0&&n<c&&a>=0&&a<c))return 0;const m=this.getTerrainData(t),g=(d=m.tile)===null||d===void 0?void 0:d.dem;if(!g)return 0;const x=function(j,Z,N){var te=Z[0],le=Z[1];return j[0]=N[0]*te+N[4]*le+N[12],j[1]=N[1]*te+N[5]*le+N[13],j}([],[n/c*o.N,a/c*o.N],m.u_terrain_matrix),w=[x[0]*g.dim,x[1]*g.dim],C=Math.floor(w[0]),T=Math.floor(w[1]),z=w[0]-C,V=w[1]-T;return g.get(C,T)*(1-z)*(1-V)+g.get(C+1,T)*z*(1-V)+g.get(C,T+1)*(1-z)*V+g.get(C+1,T+1)*z*V}getElevationForLngLatZoom(t,n){const{tileID:a,mercatorX:c,mercatorY:d}=this._getOverscaledTileIDFromLngLatZoom(t,n);return this.getElevation(a,c%o.N,d%o.N,o.N)}getElevation(t,n,a,c=o.N){return this.getDEMElevation(t,n,a,c)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const c=this.painter.context,d=new o.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Fe(c,d,c.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Fe(c,new o.R({width:1,height:1}),c.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.ao([])}const n=this.sourceCache.getSourceTile(t,!0);if(n&&n.dem&&(!n.demTexture||n.needsTerrainPrepare)){const c=this.painter.context;n.demTexture=this.painter.getTileTexture(n.dem.stride),n.demTexture?n.demTexture.update(n.dem.getPixels(),{premultiply:!1}):n.demTexture=new Fe(c,n.dem.getPixels(),c.gl.RGBA,{premultiply:!1}),n.demTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),n.needsTerrainPrepare=!1}const a=n&&n+n.tileID.key+t.key;if(a&&!this._demMatrixCache[a]){const c=this.sourceCache.sourceCache._source.maxzoom;let d=t.canonical.z-n.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=c?d=t.canonical.z-c:o.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const m=t.canonical.x-(t.canonical.x>>d<<d),g=t.canonical.y-(t.canonical.y>>d<<d),x=o.bc(new Float64Array(16),[1/(o.N<<d),1/(o.N<<d),0]);o.$(x,x,[m*o.N,g*o.N,0]),this._demMatrixCache[t.key]={matrix:x,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:n&&n.dem&&n.dem.dim||1,u_terrain_matrix:a?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:n&&n.dem&&n.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(n&&n.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:n}}getFramebuffer(t){const n=this.painter,a=n.width/devicePixelRatio,c=n.height/devicePixelRatio;return!this._fbo||this._fbo.width===a&&this._fbo.height===c||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Fe(n.context,{width:a,height:c,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Fe(n.context,{width:a,height:c,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=n.context.createFramebuffer(a,c,!0,!1),this._fbo.depthAttachment.set(n.context.createRenderbuffer(n.context.gl.DEPTH_COMPONENT16,a,c))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const n=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let d=0,m=0;d<this._coordsTextureSize;d++)for(let g=0;g<this._coordsTextureSize;g++,m+=4)n[m+0]=255&g,n[m+1]=255&d,n[m+2]=g>>8<<4|d>>8,n[m+3]=0;const a=new o.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(n.buffer)),c=new Fe(t,a,t.gl.RGBA,{premultiply:!1});return c.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=c,c}pointCoordinate(t){const n=new Uint8Array(4),a=this.painter.context,c=a.gl;a.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),c.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,c.RGBA,c.UNSIGNED_BYTE,n),a.bindFramebuffer.set(null);const d=n[0]+(n[2]>>4<<8),m=n[1]+((15&n[2])<<8),g=this.coordsIndex[255-n[3]],x=g&&this.sourceCache.getTileByID(g);if(!x)return null;const w=this._coordsTextureSize,C=(1<<x.tileID.canonical.z)*w;return new o.U(this._allowMercatorOverflow(t,(x.tileID.canonical.x*w+d)/C),(x.tileID.canonical.y*w+m)/C,this.getElevation(x.tileID,d,m,w))}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.painter.context,n=new o.bd,a=new o.b0,c=this.meshSize,d=o.N/c,m=c*c;for(let T=0;T<=c;T++)for(let z=0;z<=c;z++)n.emplaceBack(z*d,T*d,0);for(let T=0;T<m;T+=c+1)for(let z=0;z<c;z++)a.emplaceBack(z+T,c+z+T+1,c+z+T+2),a.emplaceBack(z+T,c+z+T+2,z+T+1);const g=n.length,x=g+2*(c+1);for(const T of[0,1])for(let z=0;z<=c;z++)for(const V of[0,1])n.emplaceBack(z*d,T*o.N,V);for(let T=0;T<2*c;T+=2)a.emplaceBack(x+T,x+T+1,x+T+3),a.emplaceBack(x+T,x+T+3,x+T+2),a.emplaceBack(g+T,g+T+3,g+T+1),a.emplaceBack(g+T,g+T+2,g+T+3);const w=n.length,C=w+2*(c+1);for(const T of[0,1])for(let z=0;z<=c;z++)for(const V of[0,1])n.emplaceBack(T*o.N,z*d,V);for(let T=0;T<2*c;T+=2)a.emplaceBack(w+T,w+T+1,w+T+3),a.emplaceBack(w+T,w+T+3,w+T+2),a.emplaceBack(C+T,C+T+3,C+T+1),a.emplaceBack(C+T,C+T+2,C+T+3);return this._mesh={indexBuffer:t.createIndexBuffer(a),vertexBuffer:t.createVertexBuffer(n,kl.members),segments:o.S.simpleSegment(0,0,n.length,a.length)},this._mesh}getMeshFrameDelta(t){return 2*Math.PI*o.be/Math.pow(2,t)/5}getMinTileElevationForLngLatZoom(t,n){var a;const{tileID:c}=this._getOverscaledTileIDFromLngLatZoom(t,n);return(a=this.getMinMaxElevation(c).minElevation)!==null&&a!==void 0?a:0}getMinMaxElevation(t){const n=this.getTerrainData(t).tile,a={minElevation:null,maxElevation:null};return n&&n.dem&&(a.minElevation=n.dem.min*this.exaggeration,a.maxElevation=n.dem.max*this.exaggeration),a}_getOverscaledTileIDFromLngLatZoom(t,n){const a=o.U.fromLngLat(t.wrap()),c=(1<<n)*o.N,d=a.x*c,m=a.y*c,g=Math.floor(d/o.N),x=Math.floor(m/o.N);return{tileID:new o.O(n,0,n,g,x),mercatorX:d,mercatorY:m}}_allowMercatorOverflow(t,n){const a=t.x<this.painter.width/2;let c=o.bf(n);const d=this.painter.transform.center.lng;return a&&Math.sign(c)>0&&Math.sign(d)<0||!a&&Math.sign(c)<0&&Math.sign(d)>0?(c=360*Math.sign(d)+c,o.G(c)):n}}class kc{constructor(t,n,a){this._context=t,this._size=n,this._tileSize=a,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const n=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),a=new Fe(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return a.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),n.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),n.colorAttachment.set(a.texture),{id:t,fbo:n,texture:a,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(n=>t.id!==n),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const n of this._recentlyUsed)if(!this._objects[n].inUse)return this._objects[n];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const ar={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class xa{constructor(t,n){this.painter=t,this.terrain=n,this.pool=new kc(t.context,30,n.sourceCache.tileSize*n.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,n){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(a=>!t._layers[a].isHidden(n)),this._coordsDescendingInv={};for(const a in t.sourceCaches){this._coordsDescendingInv[a]={};const c=t.sourceCaches[a].getVisibleCoordinates();for(const d of c){const m=this.terrain.sourceCache.getTerrainCoords(d);for(const g in m)this._coordsDescendingInv[a][g]||(this._coordsDescendingInv[a][g]=[]),this._coordsDescendingInv[a][g].push(m[g])}}this._coordsDescendingInvStr={};for(const a of t._order){const c=t._layers[a],d=c.source;if(ar[c.type]&&!this._coordsDescendingInvStr[d]){this._coordsDescendingInvStr[d]={};for(const m in this._coordsDescendingInv[d])this._coordsDescendingInvStr[d][m]=this._coordsDescendingInv[d][m].map(g=>g.key).sort().join()}}for(const a of this._renderableTiles)for(const c in this._coordsDescendingInvStr){const d=this._coordsDescendingInvStr[c][a.tileID.key];d&&d!==a.rttCoords[c]&&(a.rtt=[])}}renderLayer(t){if(t.isHidden(this.painter.transform.zoom))return!1;const n=t.type,a=this.painter,c=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(ar[n]&&(this._prevType&&ar[this._prevType]||this._stacks.push([]),this._prevType=n,this._stacks[this._stacks.length-1].push(t.id),!c))return!0;if(ar[this._prevType]||ar[n]&&c){this._prevType=n;const d=this._stacks.length-1,m=this._stacks[d]||[];for(const g of this._renderableTiles){if(this.pool.isFull()&&(fi(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(g),g.rtt[d]){const w=this.pool.getObjectForId(g.rtt[d].id);if(w.stamp===g.rtt[d].stamp){this.pool.useObject(w);continue}}const x=this.pool.getOrCreateFreeObject();this.pool.useObject(x),this.pool.stampObject(x),g.rtt[d]={id:x.id,stamp:x.stamp},a.context.bindFramebuffer.set(x.fbo.framebuffer),a.context.clear({color:o.aT.transparent,stencil:0}),a.currentStencilSource=void 0;for(let w=0;w<m.length;w++){const C=a.style._layers[m[w]],T=C.source?this._coordsDescendingInv[C.source][g.tileID.key]:[g.tileID];a.context.viewport.set([0,0,x.fbo.width,x.fbo.height]),a._renderTileClippingMasks(C,T),a.renderLayer(a,a.style.sourceCaches[C.source],C,T),C.source&&(g.rttCoords[C.source]=this._coordsDescendingInvStr[C.source][g.tileID.key])}}return fi(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),ar[n]}return!1}}const et=ie,ct={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:o.c.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},Ls=u=>{u.touchstart=u.dragStart,u.touchmoveWindow=u.dragMove,u.touchend=u.dragEnd},go={showCompass:!0,showZoom:!0,visualizePitch:!1};class _o{constructor(t,n,a=!1){this.mousedown=m=>{this.startMouse(o.e({},m,{ctrlKey:!0,preventDefault:()=>m.preventDefault()}),B.mousePos(this.element,m)),B.addEventListener(window,"mousemove",this.mousemove),B.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=m=>{this.moveMouse(m,B.mousePos(this.element,m))},this.mouseup=m=>{this.mouseRotate.dragEnd(m),this.mousePitch&&this.mousePitch.dragEnd(m),this.offTemp()},this.touchstart=m=>{m.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=B.touchPos(this.element,m.targetTouches)[0],this.startTouch(m,this._startPos),B.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),B.addEventListener(window,"touchend",this.touchend))},this.touchmove=m=>{m.targetTouches.length!==1?this.reset():(this._lastPos=B.touchPos(this.element,m.targetTouches)[0],this.moveTouch(m,this._lastPos))},this.touchend=m=>{m.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const c=t.dragRotate._mouseRotate.getClickTolerance(),d=t.dragRotate._mousePitch.getClickTolerance();this.element=n,this.mouseRotate=as({clickTolerance:c,enable:!0}),this.touchRotate=(({enable:m,clickTolerance:g,bearingDegreesPerPixelMoved:x=.8})=>{const w=new Sl;return new dn({clickTolerance:g,move:(C,T)=>({bearingDelta:(T.x-C.x)*x}),moveStateManager:w,enable:m,assignEvents:Ls})})({clickTolerance:c,enable:!0}),this.map=t,a&&(this.mousePitch=pn({clickTolerance:d,enable:!0}),this.touchPitch=(({enable:m,clickTolerance:g,pitchDegreesPerPixelMoved:x=-.5})=>{const w=new Sl;return new dn({clickTolerance:g,move:(C,T)=>({pitchDelta:(T.y-C.y)*x}),moveStateManager:w,enable:m,assignEvents:Ls})})({clickTolerance:d,enable:!0})),B.addEventListener(n,"mousedown",this.mousedown),B.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),B.addEventListener(n,"touchcancel",this.reset)}startMouse(t,n){this.mouseRotate.dragStart(t,n),this.mousePitch&&this.mousePitch.dragStart(t,n),B.disableDrag()}startTouch(t,n){this.touchRotate.dragStart(t,n),this.touchPitch&&this.touchPitch.dragStart(t,n),B.disableDrag()}moveMouse(t,n){const a=this.map,{bearingDelta:c}=this.mouseRotate.dragMove(t,n)||{};if(c&&a.setBearing(a.getBearing()+c),this.mousePitch){const{pitchDelta:d}=this.mousePitch.dragMove(t,n)||{};d&&a.setPitch(a.getPitch()+d)}}moveTouch(t,n){const a=this.map,{bearingDelta:c}=this.touchRotate.dragMove(t,n)||{};if(c&&a.setBearing(a.getBearing()+c),this.touchPitch){const{pitchDelta:d}=this.touchPitch.dragMove(t,n)||{};d&&a.setPitch(a.getPitch()+d)}}off(){const t=this.element;B.removeEventListener(t,"mousedown",this.mousedown),B.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),B.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),B.removeEventListener(window,"touchend",this.touchend),B.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){B.enableDrag(),B.removeEventListener(window,"mousemove",this.mousemove),B.removeEventListener(window,"mouseup",this.mouseup),B.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),B.removeEventListener(window,"touchend",this.touchend)}}let wi;function yo(u,t,n){if(u=new o.L(u.lng,u.lat),t){const a=new o.L(u.lng-360,u.lat),c=new o.L(u.lng+360,u.lat),d=n.locationPoint(u).distSqr(t);n.locationPoint(a).distSqr(t)<d?u=a:n.locationPoint(c).distSqr(t)<d&&(u=c)}for(;Math.abs(u.lng-n.center.lng)>180;){const a=n.locationPoint(u);if(a.x>=0&&a.y>=0&&a.x<=n.width&&a.y<=n.height)break;u.lng>n.center.lng?u.lng-=360:u.lng+=360}return u}const $r={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function zl(u,t,n){const a=u.classList;for(const c in $r)a.remove(`maplibregl-${n}-anchor-${c}`);a.add(`maplibregl-${n}-anchor-${t}`)}class $n extends o.E{constructor(t){if(super(),this._onKeyPress=n=>{const a=n.code,c=n.charCode||n.keyCode;a!=="Space"&&a!=="Enter"&&c!==32&&c!==13||this.togglePopup()},this._onMapClick=n=>{const a=n.originalEvent.target,c=this._element;this._popup&&(a===c||c.contains(a))&&this.togglePopup()},this._update=n=>{if(!this._map)return;const a=this._map.loaded()&&!this._map.isMoving();(n?.type==="terrain"||n?.type==="render"&&!a)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=yo(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let c="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?c=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(c=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let d="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?d="rotateX(0deg)":this._pitchAlignment==="map"&&(d=`rotateX(${this._map.getPitch()}deg)`),n&&n.type!=="moveend"||(this._pos=this._pos.round()),B.setTransform(this._element,`${$r[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${d} ${c}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const m=this._map.unproject(this._pos),g=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=m.distanceTo(this._lngLat)>20*g?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=n=>{if(!this._isDragging){const a=this._clickTolerance||this._map._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=a}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.k("dragstart"))),this.fire(new o.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.k("dragend")),this._state="inactive"},this._addDragHandler=n=>{this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos).add(this._offset),this._pointerdownPos=n.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=o.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=B.create("div"),this._element.setAttribute("aria-label","Map marker");const n=B.createNS("http://www.w3.org/2000/svg","svg"),a=41,c=27;n.setAttributeNS(null,"display","block"),n.setAttributeNS(null,"height",`${a}px`),n.setAttributeNS(null,"width",`${c}px`),n.setAttributeNS(null,"viewBox",`0 0 ${c} ${a}`);const d=B.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"stroke","none"),d.setAttributeNS(null,"stroke-width","1"),d.setAttributeNS(null,"fill","none"),d.setAttributeNS(null,"fill-rule","evenodd");const m=B.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"fill-rule","nonzero");const g=B.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"transform","translate(3.0, 29.0)"),g.setAttributeNS(null,"fill","#000000");const x=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const te of x){const le=B.createNS("http://www.w3.org/2000/svg","ellipse");le.setAttributeNS(null,"opacity","0.04"),le.setAttributeNS(null,"cx","10.5"),le.setAttributeNS(null,"cy","5.80029008"),le.setAttributeNS(null,"rx",te.rx),le.setAttributeNS(null,"ry",te.ry),g.appendChild(le)}const w=B.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"fill",this._color);const C=B.createNS("http://www.w3.org/2000/svg","path");C.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),w.appendChild(C);const T=B.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"opacity","0.25"),T.setAttributeNS(null,"fill","#000000");const z=B.createNS("http://www.w3.org/2000/svg","path");z.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),T.appendChild(z);const V=B.createNS("http://www.w3.org/2000/svg","g");V.setAttributeNS(null,"transform","translate(6.0, 7.0)"),V.setAttributeNS(null,"fill","#FFFFFF");const j=B.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Z=B.createNS("http://www.w3.org/2000/svg","circle");Z.setAttributeNS(null,"fill","#000000"),Z.setAttributeNS(null,"opacity","0.25"),Z.setAttributeNS(null,"cx","5.5"),Z.setAttributeNS(null,"cy","5.5"),Z.setAttributeNS(null,"r","5.4999962");const N=B.createNS("http://www.w3.org/2000/svg","circle");N.setAttributeNS(null,"fill","#FFFFFF"),N.setAttributeNS(null,"cx","5.5"),N.setAttributeNS(null,"cy","5.5"),N.setAttributeNS(null,"r","5.4999962"),j.appendChild(Z),j.appendChild(N),m.appendChild(g),m.appendChild(w),m.appendChild(T),m.appendChild(V),m.appendChild(j),n.appendChild(m),n.setAttributeNS(null,"height",a*this._scale+"px"),n.setAttributeNS(null,"width",c*this._scale+"px"),this._element.appendChild(n),this._offset=o.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",n=>{n.preventDefault()}),this._element.addEventListener("mousedown",n=>{n.preventDefault()}),zl(this._element,this._anchor,"marker"),t&&t.className)for(const n of t.className.split(" "))this._element.classList.add(n);this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),B.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=o.L.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const c=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[c,-1*(38.1-13.5+c)],"bottom-right":[-c,-1*(38.1-13.5+c)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(t){return this._offset=o.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const mi={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let hi=0,ls=!1;const Rs={maxWidth:100,unit:"metric"};function Fs(u,t,n){const a=n&&n.maxWidth||100,c=u._container.clientHeight/2,d=u.unproject([0,c]),m=u.unproject([a,c]),g=d.distanceTo(m);if(n&&n.unit==="imperial"){const x=3.2808*g;x>5280?jn(t,a,x/5280,u._getUIString("ScaleControl.Miles")):jn(t,a,x,u._getUIString("ScaleControl.Feet"))}else n&&n.unit==="nautical"?jn(t,a,g/1852,u._getUIString("ScaleControl.NauticalMiles")):g>=1e3?jn(t,a,g/1e3,u._getUIString("ScaleControl.Kilometers")):jn(t,a,g,u._getUIString("ScaleControl.Meters"))}function jn(u,t,n,a){const c=function(d){const m=Math.pow(10,`${Math.floor(d)}`.length-1);let g=d/m;return g=g>=10?10:g>=5?5:g>=3?3:g>=2?2:g>=1?1:function(x){const w=Math.pow(10,Math.ceil(-Math.log(x)/Math.LN10));return Math.round(x*w)/w}(g),m*g}(n);u.style.width=t*(c/n)+"px",u.innerHTML=`${c}&nbsp;${a}`}const xo={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},vo=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function cs(u){if(u){if(typeof u=="number"){const t=Math.round(Math.abs(u)/Math.SQRT2);return{center:new o.P(0,0),top:new o.P(0,u),"top-left":new o.P(t,t),"top-right":new o.P(-t,t),bottom:new o.P(0,-u),"bottom-left":new o.P(t,-t),"bottom-right":new o.P(-t,-t),left:new o.P(u,0),right:new o.P(-u,0)}}if(u instanceof o.P||Array.isArray(u)){const t=o.P.convert(u);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:o.P.convert(u.center||[0,0]),top:o.P.convert(u.top||[0,0]),"top-left":o.P.convert(u["top-left"]||[0,0]),"top-right":o.P.convert(u["top-right"]||[0,0]),bottom:o.P.convert(u.bottom||[0,0]),"bottom-left":o.P.convert(u["bottom-left"]||[0,0]),"bottom-right":o.P.convert(u["bottom-right"]||[0,0]),left:o.P.convert(u.left||[0,0]),right:o.P.convert(u.right||[0,0])}}return cs(new o.P(0,0))}const bo={extend:(u,...t)=>o.e(u,...t),run(u){u()},logToElement(u,t=!1,n="log"){const a=window.document.getElementById(n);a&&(t&&(a.innerHTML=""),a.innerHTML+=`<br>${u}`)}},wo=ie;class $t{static get version(){return wo}static get workerCount(){return Ui.workerCount}static set workerCount(t){Ui.workerCount=t}static get maxParallelImageRequests(){return o.c.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(t){o.c.MAX_PARALLEL_IMAGE_REQUESTS=t}static get workerUrl(){return o.c.WORKER_URL}static set workerUrl(t){o.c.WORKER_URL=t}static addProtocol(t,n){o.c.REGISTERED_PROTOCOLS[t]=n}static removeProtocol(t){delete o.c.REGISTERED_PROTOCOLS[t]}}return $t.Map=class extends Ml{constructor(u){if(o.bg.mark(o.bh.create),(u=o.e({},ct,u)).minZoom!=null&&u.maxZoom!=null&&u.minZoom>u.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(u.minPitch!=null&&u.maxPitch!=null&&u.minPitch>u.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(u.minPitch!=null&&u.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(u.maxPitch!=null&&u.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new fa(u.minZoom,u.maxZoom,u.minPitch,u.maxPitch,u.renderWorldCopies),{bearingSnap:u.bearingSnap}),this._cooperativeGesturesOnWheel=t=>{this._onCooperativeGesture(t,t[this._metaKey],1)},this._contextLost=t=>{t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.k("webglcontextlost",{originalEvent:t}))},this._contextRestored=t=>{this._setupPainter(),this.resize(),this._update(),this.fire(new o.k("webglcontextrestored",{originalEvent:t}))},this._onMapScroll=t=>{if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=u.interactive,this._cooperativeGestures=u.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=u.maxTileCacheSize,this._maxTileCacheZoomLevels=u.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=u.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=u.preserveDrawingBuffer,this._antialias=u.antialias,this._trackResize=u.trackResize,this._bearingSnap=u.bearingSnap,this._refreshExpiredTiles=u.refreshExpiredTiles,this._fadeDuration=u.fadeDuration,this._crossSourceCollisions=u.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=u.collectResourceTiming,this._renderTaskQueue=new ya,this._controls=[],this._mapId=o.a2(),this._locale=o.e({},mo,u.locale),this._clickTolerance=u.clickTolerance,this._overridePixelRatio=u.pixelRatio,this._maxCanvasSize=u.maxCanvasSize,this.transformCameraUpdate=u.transformCameraUpdate,this._imageQueueHandle=De.addThrottleControl(()=>this.isMoving()),this._requestManager=new Qe(u.transformRequest),typeof u.container=="string"){if(this._container=document.getElementById(u.container),!this._container)throw new Error(`Container '${u.container}' not found.`)}else{if(!(u.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=u.container}if(u.maxBounds&&this.setMaxBounds(u.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let t=!1;const n=Nn(a=>{this._trackResize&&!this._removed&&this.resize(a)._update()},50);this._resizeObserver=new ResizeObserver(a=>{t?n(a):t=!0}),this._resizeObserver.observe(this._container)}this.handlers=new fo(this,u),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=u.hash&&new ks(typeof u.hash=="string"&&u.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch}),u.bounds&&(this.resize(),this.fitBounds(u.bounds,o.e({},u.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=u.localIdeographFontFamily,this._validateStyle=u.validateStyle,u.style&&this.setStyle(u.style,{localIdeographFontFamily:u.localIdeographFontFamily}),u.attributionControl&&this.addControl(new Mr({customAttribution:u.customAttribution})),u.maplibreLogo&&this.addControl(new ti,u.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update(t.dataType==="style"),this.fire(new o.k(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new o.k(`${t.dataType}dataloading`,t))}),this.on("dataabort",t=>{this.fire(new o.k("sourcedataabort",t))})}_getMapId(){return this._mapId}addControl(u,t){if(t===void 0&&(t=u.getDefaultPosition?u.getDefaultPosition():"top-right"),!u||!u.onAdd)return this.fire(new o.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=u.onAdd(this);this._controls.push(u);const a=this._controlPositions[t];return t.indexOf("bottom")!==-1?a.insertBefore(n,a.firstChild):a.appendChild(n),this}removeControl(u){if(!u||!u.onRemove)return this.fire(new o.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(u);return t>-1&&this._controls.splice(t,1),u.onRemove(this),this}hasControl(u){return this._controls.indexOf(u)>-1}calculateCameraOptionsFromTo(u,t,n,a){return a==null&&this.terrain&&(a=this.terrain.getElevationForLngLatZoom(n,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(u,t,n,a)}resize(u){var t;const n=this._containerDimensions(),a=n[0],c=n[1],d=this._getClampedPixelRatio(a,c);if(this._resizeCanvas(a,c,d),this.painter.resize(a,c,d),this.painter.overLimit()){const g=this.painter.context.gl;this._maxCanvasSize=[g.drawingBufferWidth,g.drawingBufferHeight];const x=this._getClampedPixelRatio(a,c);this._resizeCanvas(a,c,x),this.painter.resize(a,c,x)}this.transform.resize(a,c),(t=this._requestedCameraState)===null||t===void 0||t.resize(a,c);const m=!this._moving;return m&&(this.stop(),this.fire(new o.k("movestart",u)).fire(new o.k("move",u))),this.fire(new o.k("resize",u)),m&&this.fire(new o.k("moveend",u)),this}_getClampedPixelRatio(u,t){const{0:n,1:a}=this._maxCanvasSize,c=this.getPixelRatio(),d=u*c,m=t*c;return Math.min(d>n?n/d:1,m>a?a/m:1)*c}getPixelRatio(){var u;return(u=this._overridePixelRatio)!==null&&u!==void 0?u:devicePixelRatio}setPixelRatio(u){this._overridePixelRatio=u,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(u){return this.transform.setMaxBounds(Ue.convert(u)),this._update()}setMinZoom(u){if((u=u??-2)>=-2&&u<=this.transform.maxZoom)return this.transform.minZoom=u,this._update(),this.getZoom()<u&&this.setZoom(u),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(u){if((u=u??22)>=this.transform.minZoom)return this.transform.maxZoom=u,this._update(),this.getZoom()>u&&this.setZoom(u),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(u){if((u=u??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(u>=0&&u<=this.transform.maxPitch)return this.transform.minPitch=u,this._update(),this.getPitch()<u&&this.setPitch(u),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(u){if((u=u??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(u>=this.transform.minPitch)return this.transform.maxPitch=u,this._update(),this.getPitch()>u&&this.setPitch(u),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(u){return this.transform.renderWorldCopies=u,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(u){return this._cooperativeGestures=u,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(u){return this.transform.locationPoint(o.L.convert(u),this.style&&this.terrain)}unproject(u){return this.transform.pointLocation(o.P.convert(u),this.terrain)}isMoving(){var u;return this._moving||((u=this.handlers)===null||u===void 0?void 0:u.isMoving())}isZooming(){var u;return this._zooming||((u=this.handlers)===null||u===void 0?void 0:u.isZooming())}isRotating(){var u;return this._rotating||((u=this.handlers)===null||u===void 0?void 0:u.isRotating())}_createDelegatedListener(u,t,n){if(u==="mouseenter"||u==="mouseover"){let a=!1;return{layer:t,listener:n,delegates:{mousemove:d=>{const m=this.getLayer(t)?this.queryRenderedFeatures(d.point,{layers:[t]}):[];m.length?a||(a=!0,n.call(this,new Er(u,this,d.originalEvent,{features:m}))):a=!1},mouseout:()=>{a=!1}}}}if(u==="mouseleave"||u==="mouseout"){let a=!1;return{layer:t,listener:n,delegates:{mousemove:m=>{(this.getLayer(t)?this.queryRenderedFeatures(m.point,{layers:[t]}):[]).length?a=!0:a&&(a=!1,n.call(this,new Er(u,this,m.originalEvent)))},mouseout:m=>{a&&(a=!1,n.call(this,new Er(u,this,m.originalEvent)))}}}}{const a=c=>{const d=this.getLayer(t)?this.queryRenderedFeatures(c.point,{layers:[t]}):[];d.length&&(c.features=d,n.call(this,c),delete c.features)};return{layer:t,listener:n,delegates:{[u]:a}}}}on(u,t,n){if(n===void 0)return super.on(u,t);const a=this._createDelegatedListener(u,t,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[u]=this._delegatedListeners[u]||[],this._delegatedListeners[u].push(a);for(const c in a.delegates)this.on(c,a.delegates[c]);return this}once(u,t,n){if(n===void 0)return super.once(u,t);const a=this._createDelegatedListener(u,t,n);for(const c in a.delegates)this.once(c,a.delegates[c]);return this}off(u,t,n){return n===void 0?super.off(u,t):(this._delegatedListeners&&this._delegatedListeners[u]&&(a=>{const c=this._delegatedListeners[u];for(let d=0;d<c.length;d++){const m=c[d];if(m.layer===t&&m.listener===n){for(const g in m.delegates)this.off(g,m.delegates[g]);return c.splice(d,1),this}}})(),this)}queryRenderedFeatures(u,t){if(!this.style)return[];let n;const a=u instanceof o.P||Array.isArray(u),c=a?u:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(a?{}:u)||{},c instanceof o.P||typeof c[0]=="number")n=[o.P.convert(c)];else{const d=o.P.convert(c[0]),m=o.P.convert(c[1]);n=[d,new o.P(m.x,d.y),m,new o.P(d.x,m.y),d]}return this.style.queryRenderedFeatures(n,t,this.transform)}querySourceFeatures(u,t){return this.style.querySourceFeatures(u,t)}setStyle(u,t){return(t=o.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&u?(this._diffStyle(u,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(u,t))}setTransformRequest(u){return this._requestManager.setTransformRequest(u),this}_getUIString(u){const t=this._locale[u];if(t==null)throw new Error(`Missing UI string '${u}'`);return t}_updateStyle(u,t){if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(u,t));const n=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!u)),u?(this.style=new Zi(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof u=="string"?this.style.loadURL(u,t,n):this.style.loadJSON(u,t,n),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Zi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(u,t){if(typeof u=="string"){const n=this._requestManager.transformRequest(u,Ne.Style);o.f(n,(a,c)=>{a?this.fire(new o.j(a)):c&&this._updateDiff(c,t)})}else typeof u=="object"&&this._updateDiff(u,t)}_updateDiff(u,t){try{this.style.setState(u,t)&&this._update(!0)}catch(n){o.w(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(u,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.w("There is no style added to the map.")}addSource(u,t){return this._lazyInitEmptyStyle(),this.style.addSource(u,t),this._update(!0)}isSourceLoaded(u){const t=this.style&&this.style.sourceCaches[u];if(t!==void 0)return t.loaded();this.fire(new o.j(new Error(`There is no source with ID '${u}'`)))}setTerrain(u){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),u){const t=this.style.sourceCaches[u.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${u.source}`);for(const n in this.style._layers){const a=this.style._layers[n];a.type==="hillshade"&&a.source===u.source&&o.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Pl(this.painter,t,u),this.painter.renderToTexture=new xa(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=n=>{n.dataType==="style"?this.terrain.sourceCache.freeRtt():n.dataType==="source"&&n.tile&&(n.sourceId!==u.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(n.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new o.k("terrain",{terrain:u})),this}getTerrain(){var u,t;return(t=(u=this.terrain)===null||u===void 0?void 0:u.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const u=this.style&&this.style.sourceCaches;for(const t in u){const n=u[t]._tiles;for(const a in n){const c=n[a];if(c.state!=="loaded"&&c.state!=="errored")return!1}}return!0}addSourceType(u,t,n){return this._lazyInitEmptyStyle(),this.style.addSourceType(u,t,n)}removeSource(u){return this.style.removeSource(u),this._update(!0)}getSource(u){return this.style.getSource(u)}addImage(u,t,n={}){const{pixelRatio:a=1,sdf:c=!1,stretchX:d,stretchY:m,content:g}=n;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||o.a(t))){if(t.width===void 0||t.height===void 0)return this.fire(new o.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:x,height:w,data:C}=t,T=t;return this.style.addImage(u,{data:new o.R({width:x,height:w},new Uint8Array(C)),pixelRatio:a,stretchX:d,stretchY:m,content:g,sdf:c,version:0,userImage:T}),T.onAdd&&T.onAdd(this,u),this}}{const{width:x,height:w,data:C}=o.h.getImageData(t);this.style.addImage(u,{data:new o.R({width:x,height:w},C),pixelRatio:a,stretchX:d,stretchY:m,content:g,sdf:c,version:0})}}updateImage(u,t){const n=this.style.getImage(u);if(!n)return this.fire(new o.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const a=t instanceof HTMLImageElement||o.a(t)?o.h.getImageData(t):t,{width:c,height:d,data:m}=a;if(c===void 0||d===void 0)return this.fire(new o.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(c!==n.data.width||d!==n.data.height)return this.fire(new o.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const g=!(t instanceof HTMLImageElement||o.a(t));return n.data.replace(m,g),this.style.updateImage(u,n),this}getImage(u){return this.style.getImage(u)}hasImage(u){return u?!!this.style.getImage(u):(this.fire(new o.j(new Error("Missing required image id"))),!1)}removeImage(u){this.style.removeImage(u)}loadImage(u,t){De.getImage(this._requestManager.transformRequest(u,Ne.Image),t)}listImages(){return this.style.listImages()}addLayer(u,t){return this._lazyInitEmptyStyle(),this.style.addLayer(u,t),this._update(!0)}moveLayer(u,t){return this.style.moveLayer(u,t),this._update(!0)}removeLayer(u){return this.style.removeLayer(u),this._update(!0)}getLayer(u){return this.style.getLayer(u)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(u,t,n){return this.style.setLayerZoomRange(u,t,n),this._update(!0)}setFilter(u,t,n={}){return this.style.setFilter(u,t,n),this._update(!0)}getFilter(u){return this.style.getFilter(u)}setPaintProperty(u,t,n,a={}){return this.style.setPaintProperty(u,t,n,a),this._update(!0)}getPaintProperty(u,t){return this.style.getPaintProperty(u,t)}setLayoutProperty(u,t,n,a={}){return this.style.setLayoutProperty(u,t,n,a),this._update(!0)}getLayoutProperty(u,t){return this.style.getLayoutProperty(u,t)}setGlyphs(u,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(u,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(u,t,n={}){return this._lazyInitEmptyStyle(),this.style.addSprite(u,t,n,a=>{a||this._update(!0)}),this}removeSprite(u){return this._lazyInitEmptyStyle(),this.style.removeSprite(u),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(u,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(u,t,n=>{n||this._update(!0)}),this}setLight(u,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(u,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(u,t){return this.style.setFeatureState(u,t),this._update()}removeFeatureState(u,t){return this.style.removeFeatureState(u,t),this._update()}getFeatureState(u){return this.style.getFeatureState(u)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let u=0,t=0;return this._container&&(u=this._container.clientWidth||400,t=this._container.clientHeight||300),[u,t]}_setupContainer(){const u=this._container;u.classList.add("maplibregl-map");const t=this._canvasContainer=B.create("div","maplibregl-canvas-container",u);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=B.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const n=this._containerDimensions(),a=this._getClampedPixelRatio(n[0],n[1]);this._resizeCanvas(n[0],n[1],a);const c=this._controlContainer=B.create("div","maplibregl-control-container",u),d=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(m=>{d[m]=B.create("div",`maplibregl-ctrl-${m} `,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=B.create("div","maplibregl-cooperative-gesture-screen",this._container);let u=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(u=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use ⌘ + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${u}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){B.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(u,t,n){this._canvas.width=Math.floor(n*u),this._canvas.height=Math.floor(n*t),this._canvas.style.width=`${u}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const u={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let t=null;this._canvas.addEventListener("webglcontextcreationerror",a=>{t={requestedAttributes:u},a&&(t.statusMessage=a.statusMessage,t.type=a.type)},{once:!0});const n=this._canvas.getContext("webgl2",u)||this._canvas.getContext("webgl",u);if(!n){const a="Failed to initialize WebGL";throw t?(t.message=a,new Error(JSON.stringify(t))):new Error(a)}this.painter=new On(n,this.transform),ce.testSupport(n)}_onCooperativeGesture(u,t,n){return!t&&n<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(u){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||u,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(u){return this._update(),this._renderTaskQueue.add(u)}_cancelRenderFrame(u){this._renderTaskQueue.remove(u)}_render(u){const t=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(u),this._removed)return;let n=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const c=this.transform.zoom,d=o.h.now();this.style.zoomHistory.update(c,d);const m=new o.a8(c,{now:d,fadeDuration:t,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),g=m.crossFadingFactor();g===1&&g===this._crossFadingFactor||(n=!0,this._crossFadingFactor=g),this.style.update(m)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,t,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:t,showPadding:this.showPadding}),this.fire(new o.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.bg.mark(o.bh.load),this.fire(new o.k("load"))),this.style&&(this.style.hasTransitions()||n)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const a=this._sourcesDirty||this._styleDirty||this._placementDirty;return a||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.k("idle")),!this._loaded||this._fullyLoaded||a||(this._fullyLoaded=!0,o.bg.mark(o.bh.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var u;this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),De.removeThrottleControl(this._imageQueueHandle),(u=this._resizeObserver)===null||u===void 0||u.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),B.remove(this._canvasContainer),B.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),o.bg.clearMetrics(),this._removed=!0,this.fire(new o.k("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=o.h.frame(u=>{o.bg.frame(u),this._frame=null,this._render(u)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(u){this._showTileBoundaries!==u&&(this._showTileBoundaries=u,this._update())}get showPadding(){return!!this._showPadding}set showPadding(u){this._showPadding!==u&&(this._showPadding=u,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(u){this._showCollisionBoxes!==u&&(this._showCollisionBoxes=u,u?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(u){this._showOverdrawInspector!==u&&(this._showOverdrawInspector=u,this._update())}get repaint(){return!!this._repaint}set repaint(u){this._repaint!==u&&(this._repaint=u,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(u){this._vertices=u,this._update()}get version(){return et}getCameraTargetElevation(){return this.transform.elevation}},$t.NavigationControl=class{constructor(u){this._updateZoomButtons=()=>{const t=this._map.getZoom(),n=t===this._map.getMaxZoom(),a=t===this._map.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=a,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",a.toString())},this._rotateCompassArrow=()=>{const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t},this._setButtonTitle=(t,n)=>{const a=this._map._getUIString(`NavigationControl.${n}`);t.title=a,t.setAttribute("aria-label",a)},this.options=o.e({},go,u),this._container=B.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),B.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),B.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=B.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(u){return this._map=u,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new _o(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){B.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(u,t){const n=B.create("button",u,this._container);return n.type="button",n.addEventListener("click",t),n}},$t.GeolocateControl=class extends o.E{constructor(u){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new o.k("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new o.k("geolocate",t)),this._finish()}},this._updateCamera=t=>{const n=new o.L(t.coords.longitude,t.coords.latitude),a=t.coords.accuracy,c=this._map.getBearing(),d=o.e({bearing:c},this.options.fitBoundsOptions),m=Ue.fromLngLat(n,a);this._map.fitBounds(m,d,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const n=new o.L(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(this.options.trackUserLocation)if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&ls)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new o.k("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=t=>{if(this._map){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=B.create("button","maplibregl-ctrl-geolocate",this._container),B.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",t===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=B.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new $n({element:this._dotElement}),this._circleElement=B.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new $n({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new o.k("trackuserlocationend")))})}},this.options=o.e({},mi,u)}onAdd(u){return this._map=u,this._container=B.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(t,n=!1){wi===void 0||n?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(a=>{wi=a.state!=="denied",t(wi)}).catch(()=>{wi=!!window.navigator.geolocation,t(wi)}):(wi=!!window.navigator.geolocation,t(wi)):t(wi)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),B.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,hi=0,ls=!1}_isOutOfMapMaxBounds(u){const t=this._map.getMaxBounds(),n=u.coords;return t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const u=this._map.getBounds(),t=u.getSouthEast(),n=u.getNorthEast(),a=t.distanceTo(n),c=Math.ceil(this._accuracy/(a/this._map._container.clientHeight)*2);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":hi--,ls=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new o.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let u;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),hi++,hi>1?(u={maximumAge:6e5,timeout:0},ls=!0):(u=this.options.positionOptions,ls=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,u)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},$t.AttributionControl=Mr,$t.LogoControl=ti,$t.ScaleControl=class{constructor(u){this._onMove=()=>{Fs(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,Fs(this._map,this._container,this.options)},this.options=o.e({},Rs,u)}getDefaultPosition(){return"bottom-left"}onAdd(u){return this._map=u,this._container=B.create("div","maplibregl-ctrl maplibregl-ctrl-scale",u.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){B.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},$t.FullscreenControl=class extends o.E{constructor(u={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,u&&u.container&&(u.container instanceof HTMLElement?this._container=u.container:o.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(u){return this._map=u,this._container||(this._container=this._map.getContainer()),this._controlContainer=B.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){B.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const u=this._fullscreenButton=B.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);B.create("span","maplibregl-ctrl-icon",u).setAttribute("aria-hidden","true"),u.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const u=this._getTitle();this._fullscreenButton.setAttribute("aria-label",u),this._fullscreenButton.title=u}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new o.k("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new o.k("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},$t.TerrainControl=class{constructor(u){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=u}onAdd(u){return this._map=u,this._container=B.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=B.create("button","maplibregl-ctrl-terrain",this._container),B.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){B.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},$t.Popup=class extends o.E{constructor(u){super(),this.remove=()=>(this._content&&B.remove(this._content),this._container&&(B.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new o.k("close")),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=B.create("div","maplibregl-popup",this._map.getContainer()),this._tip=B.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const m of this.options.className.split(" "))this._container.classList.add(m);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=yo(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!t)return;const n=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);let a=this.options.anchor;const c=cs(this.options.offset);if(!a){const m=this._container.offsetWidth,g=this._container.offsetHeight;let x;x=n.y+c.bottom.y<g?["top"]:n.y>this._map.transform.height-g?["bottom"]:[],n.x<m/2?x.push("left"):n.x>this._map.transform.width-m/2&&x.push("right"),a=x.length===0?"bottom":x.join("-")}const d=n.add(c[a]).round();B.setTransform(this._container,`${$r[a]} translate(${d.x}px,${d.y}px)`),zl(this._container,a,"popup")},this._onClose=()=>{this.remove()},this.options=o.e(Object.create(xo),u)}addTo(u){return this._map&&this.remove(),this._map=u,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new o.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(u){return this._lngLat=o.L.convert(u),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(u){return this.setDOMContent(document.createTextNode(u))}setHTML(u){const t=document.createDocumentFragment(),n=document.createElement("body");let a;for(n.innerHTML=u;a=n.firstChild,a;)t.appendChild(a);return this.setDOMContent(t)}getMaxWidth(){var u;return(u=this._container)===null||u===void 0?void 0:u.style.maxWidth}setMaxWidth(u){return this.options.maxWidth=u,this._update(),this}setDOMContent(u){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=B.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(u),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(u){this._container&&this._container.classList.add(u)}removeClassName(u){this._container&&this._container.classList.remove(u)}setOffset(u){return this.options.offset=u,this._update(),this}toggleClassName(u){if(this._container)return this._container.classList.toggle(u)}_createCloseButton(){this.options.closeButton&&(this._closeButton=B.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const u=this._container.querySelector(vo);u&&u.focus()}},$t.Marker=$n,$t.Style=Zi,$t.LngLat=o.L,$t.LngLatBounds=Ue,$t.Point=o.P,$t.MercatorCoordinate=o.U,$t.Evented=o.E,$t.AJAXError=o.bi,$t.config=o.c,$t.CanvasSource=bi,$t.GeoJSONSource=gi,$t.ImageSource=Rt,$t.RasterDEMTileSource=Yt,$t.RasterTileSource=Mt,$t.VectorTileSource=Kt,$t.VideoSource=Pi,$t.setRTLTextPlugin=o.bj,$t.getRTLTextPluginStatus=o.bk,$t.prewarm=function(){vn().acquire(kt)},$t.clearPrewarmedResources=function(){const u=sr;u&&(u.isPreloaded()&&u.numActive()===1?(u.release(kt),sr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},bo.extend($t,{isSafari:o.ac,getPerformanceMetrics:o.bg.getPerformanceMetrics}),$t});var U=D;return U})})(bp);var Wy=bp.exports;const Xy=$m(Wy);function Ky(){const[y,b]=H.useState(!1);return ge.jsx("div",{className:y?"fixed top-0 right-0 bottom-0 left-0 z-[9999]":"w-full h-full relative",children:ge.jsx(Gy,{mapLib:Xy,style:{width:"100%",height:" 100%",position:"relative"},mapStyle:"https://api.ekgis.vn/v2/mapstyles/style/osmplus/standard/style.json?api_key=wtpM0U1ZmE2s87LEZNSHf63Osc1a2sboaozCQNsy",children:ge.jsx(Hy,{id:"raster-tiles",type:"raster",tileSize:256,tiles:["https://api.ekgis.vn/v1/maps/roadmap/{z}/{x}/{y}.png?api_key=wtpM0U1ZmE2s87LEZNSHf63Osc1a2sboaozCQNsy"]})})})}function Yy({data:y}){return ge.jsxs(qs,{className:"h-[500px]",children:[ge.jsx(Lr,{span:8,children:ge.jsx(Bu,{columns:[{title:"Stt",dataIndex:"stt",key:"stt",render:(b,E,M)=>M+1},...$u],dataSource:vp,pagination:!1})}),ge.jsx(Lr,{span:16,children:ge.jsx(Ky,{})})]})}const{Dragger:Jy}=ry,Qy={name:"file",multiple:!0,action:"https://run.mocky.io/v3/435e224c-44fb-4773-9faf-380c5e6a2188",onChange(y){const{status:b}=y.file;b!=="uploading"&&console.log(y.file,y.fileList),b==="done"?oc.success(`${y.file.name} file uploaded successfully.`):b==="error"&&oc.error(`${y.file.name} file upload failed.`)},onDrop(y){console.log("Dropped files",y.dataTransfer.files)}};function e0(){return ge.jsxs(Jy,{...Qy,children:[ge.jsx("p",{className:"ant-upload-drag-icon",children:ge.jsx(oy,{})}),ge.jsx("p",{className:"ant-upload-text",children:"Click or drag file to this area to upload"}),ge.jsx("p",{className:"ant-upload-hint",children:"Support for a single or bulk upload. Strictly prohibited from uploading company data or other banned files."})]})}function t0({form:y,filter:b,setFilter:E}){const[M,D]=H.useState([]),[F,U]=H.useState([]),[o,ie]=H.useState([]),[B,ce]=H.useState([]);H.useState(""),H.useState(""),H.useEffect(()=>{y.setFieldsValue(b)},[b]),H.useEffect(()=>{(async()=>{let be=await Dn.get("/api/method/frappe.desk.search.search_link",{params:{txt:"",doctype:"Customer Group",ignore_user_permissions:0,reference_doctype:"Customer"}}),Me=await Dn.get("/api/method/mbw_dms.api.location.list_province");U(Me.result);let{results:Be}=be;D(Be.map(De=>({label:De.value,value:De.value})))})()},[]);const _e=async be=>{let Me=F.find(Be=>Be.ten_tinh==be)?.ma_tinh;if(Me){let Be=await Dn.get("/api/method/mbw_dms.api.location.list_district",{params:{ma_tinh_thanh:Number.parseInt(Me)}});ie(Be.result)}},de=async be=>{let Me=o.find(Be=>Be.ten_huyen==be)?.ma_huyen;if(Me){let Be=await Dn.get("/api/method/mbw_dms.api.location.list_ward",{params:{ma_quan_huyen:Me}});ce(Be.result)}};return ge.jsxs(Au,{form:y,layout:"vertical",onFinish:E,children:[ge.jsx(Ur,{label:"Loại khách hàng",name:"customer_type",children:ge.jsx(xn,{options:[{label:"Tất cả",value:!1},{label:"Company",value:"Company"},{label:"Individual",value:"Individual"}]})}),ge.jsx(Ur,{label:"Nhóm khách hàng",name:"customer_group",children:ge.jsx(xn,{options:M})}),ge.jsx("p",{className:"font-medium text-sm",children:"Địa chỉ"}),ge.jsx(Ur,{label:"Tỉnh/Thành phố",name:"city",children:ge.jsx(xn,{options:F.map(be=>({label:be.ten_tinh,value:be.ten_tinh})),onChange:_e})}),ge.jsx(Ur,{label:"Quận/huyện",name:"district",children:ge.jsx(xn,{options:o.map(be=>({label:be.ten_huyen,value:be.ten_huyen})),disabled:o.length==0,onChange:de})}),ge.jsx(Ur,{label:"Phường/xã",name:"ward",children:ge.jsx(xn,{options:B.map(be=>({label:be.ten_xa,value:be.ten_xa})),disabled:B.length==0})})]})}const i0=[...$u,{title:"Loại khách hàng",dataIndex:"customer_id",key:"customer_type"},{title:"Nhóm khách hàng",dataIndex:"customer_name",key:"customer_group"},...xp],Xd=y=>{let b=[];for(let E in y)y[E]&&(b=[...b,{key:[hy[E]],value:y[E],key2:E}]);return b};function r0({selected:y,handleAdd:b,closeModal:E}){const[M]=jm(),[D,F]=H.useState([]),[U,o]=H.useState(vp),[ie,B]=H.useState({}),[ce,_e]=H.useState(!1),de=20,[be,Me]=H.useState(1),[Be,De]=H.useState(40),Ne={selectedRowKeys:D&&D.map(Te=>Te.name),onChange:(Te,at)=>{F(at)}},Qe=()=>{M.submit(),_e(!1)},qe=Te=>{if(Te){let at={...ie};delete at[Te.key2],M.setFieldsValue(at),B(tt=>(delete tt[Te.key2],{...tt}))}else M.resetFields(),B({})};H.useEffect(()=>{(async()=>{const Te=await Dn.get("/api/method/mbw_dms.api.router.get_customer",{params:{...ie,page_size:de,page_number:be}});o(Te?.result?.data),De(Te.result?.total),console.log("rsCustomer",Te)})()},[ie,be]);const Oe=()=>{D.length>0&&b(D),E()};return H.useEffect(()=>{F(y)},[y]),ge.jsxs(ge.Fragment,{children:[ge.jsxs(qs,{className:"justify-between",children:[ge.jsxs(Lr,{className:"inline-flex ",children:[ge.jsx(Ur,{children:ge.jsx(sc,{placeholder:"Tìm kiếm khách hàng",prefix:ge.jsx(cp,{})})}),ge.jsxs("div",{className:"flex justify-center items-center ml-4",children:[ge.jsx(Pa,{className:"flex items-center text-nowrap !text-[13px] !leading-[21px] !font-normal  border-r-[0.1px] rounded-r-none h-[36px]",icon:ge.jsx(Km,{style:{fontSize:"20px"}}),onClick:_e.bind(null,!0),children:"Filter"}),ge.jsx(Pa,{className:"border-l-[0.1px] rounded-l-none h-[36px]",onClick:()=>qe(),children:ge.jsx(Ym,{style:{fontSize:"20px"}})})]})]}),ge.jsxs(Lr,{className:"inline-flex items-center",children:[ge.jsxs("span",{className:"mr-4",children:["Đã chọn ",D.length||0," khách hàng"]}),ge.jsx(Pa,{type:"primary",onClick:Oe,children:"Thêm"})]})]}),ge.jsxs("div",{className:"py-5 px-4",children:[ge.jsxs("span",{children:[U.length," kết quả hiển thị"]}),Xd(ie).length>0&&ge.jsxs(qs,{className:"items-center",children:[Xd(ie).map(Te=>ge.jsxs(Vm,{closeIcon:ge.jsx(Fu,{}),onClose:()=>{qe(Te)},children:[Te.key,": ",Te.value]})),ge.jsx("span",{className:"cursor-pointer",onClick:()=>qe(),children:"Clear all"})]})]}),ge.jsx(Bu,{rowSelection:{type:"checkbox",...Ne},columns:i0,dataSource:U.map(Te=>({key:Te.name,...Te})),pagination:!1}),ge.jsx(qs,{className:"justify-end mt-2",children:ge.jsx(Um,{defaultCurrent:be,pageSize:de,total:Be,onChange:(Te,at)=>{Me(Te)}})}),ge.jsx(Pu,{width:451,title:"Bộ lọc",open:ce,okText:"Áp dụng",cancelText:"Đặt lại",onCancel:_e.bind(null,!1),onOk:Qe,children:ge.jsx(t0,{filter:ie,setFilter:B,form:M})})]})}function n0({listCustomer:y,handleCustomer:b}){const[E,M]=H.useState("list"),[D,F]=H.useState(!1),[U,o]=H.useState(!1),ie=ce=>{switch(ce){case"Choose":F(!1);break;case"Import":o(!1);break;default:F(!1),o(!1)}},B=ce=>{switch(ce){case"Choose":F(!0);break;case"Import":o(!0);break}};return ge.jsxs(ge.Fragment,{children:[ge.jsxs(qs,{gutter:16,className:"justify-between p-4 pb-5 pt-10 mt-0",children:[ge.jsx(Lr,{children:ge.jsxs(qs,{gutter:8,children:[ge.jsx(Lr,{span:9,className:"text-[#1677ff]",children:ge.jsx(Ur,{children:ge.jsx(xn,{defaultValue:"add",options:cy,onSelect:B})})}),ge.jsx(Lr,{span:7,children:ge.jsx(Pa,{className:"w-full flex items-center text-[#1677ff] bg-[#1877f214] h-[36px]",icon:ge.jsx(my,{}),children:"Tối ưu tuyến"})}),ge.jsx(Lr,{span:8,children:ge.jsx(Ur,{children:ge.jsx(sc,{placeholder:"Tìm kiếm khách hàng",prefix:ge.jsx(cp,{})})})})]})}),ge.jsxs(Lr,{children:[" ",ge.jsxs(vu.Group,{defaultValue:E,onChange:ce=>M(ce.target.value),size:"middle",children:[ge.jsx(vu.Button,{value:"list",children:ge.jsx(_y,{size:28})}),ge.jsx(vu.Button,{value:"map",children:ge.jsx(gy,{size:28})})]})]})]}),ge.jsx("div",{children:E=="list"?ge.jsx(yy,{data:y,handleData:b}):ge.jsx(Yy,{data:y})}),ge.jsx(Pu,{width:1240,open:D,onCancel:ie.bind(null,"Choose"),title:ge.jsx("strong",{className:"text-xl",children:"Chọn khách hàng"}),footer:!1,children:ge.jsx(r0,{selected:y,handleAdd:b,closeModal:F.bind(null,!1)})}),ge.jsx(Pu,{width:777,open:U,onCancel:ie.bind(null,"Import"),okText:"Tiếp tục",cancelText:"Hủy",title:ge.jsx("strong",{className:"text-xl",children:"Nhập dữ liệu khách hàng"}),children:ge.jsx(e0,{})})]})}function s0(){const[y]=Au.useForm(),b=qm(),{type:E}=Zm(),[M,D]=H.useState([]),[F,U]=oc.useMessage(),[o,ie]=H.useState(),B=()=>{F.open({type:"success",content:"Success!!"})},ce=()=>{F.open({type:"error",content:"Something was wrong"})},_e=H.useCallback(async be=>{be={...be,customers:M.map(Me=>{let Be=["customer_id","customer_name","display_address","phone_number","customer","frequency"];for(let De in Me)Be.includes(De)||delete Me[De];return Me})};try{await Dn.post("/api/method/mbw_dms.api.router.create_router",be),B(),b("/")}catch(Me){ce(),console.log("error create",Me)}},[M]),de=H.useCallback(async be=>{be={...be,customers:M.map(Me=>{let Be=["customer_id","customer_name","display_address","phone_number","customer","frequency"];for(let De in Me)Be.includes(De)||delete Me[De];return Me})};try{await Dn.post("/api/method/mbw_dms.api.router.update_router",{name:E,...be}),B(),b("/")}catch(Me){ce(),console.log("error create",Me)}},[M]);return H.useEffect(()=>{E!=="create-dms-router"&&(async()=>{const be=await Dn.get("/api/method/mbw_dms.api.router.get_router",{params:{id:E}});ie(be.result),be.result&&y.setFieldsValue(be.result)})()},[E]),ge.jsxs(ge.Fragment,{children:[U,ge.jsx(Jm,{title:"Thêm tuyến",buttons:[o?{label:"Lưu",action:y.submit,type:"primary"}:{label:"Thêm",action:y.submit,type:"primary"}]}),ge.jsx("div",{className:"bg-white rounded-md",children:ge.jsx(Au,{layout:"vertical",form:y,onFinish:o?de:_e,children:ge.jsx(Xm,{defaultActiveKey:"1",items:[{label:ge.jsx("p",{className:"px-4 mb-0",children:" Thông tin chung"}),key:"1",children:ge.jsx(fy,{})},{label:ge.jsx("p",{className:"px-4 mb-0",children:"Khách hàng"}),key:"2",children:ge.jsx(n0,{handleCustomer:D,listCustomer:M})}],indicatorSize:be=>be-18})})})]})}function h0(){return ge.jsxs(ge.Fragment,{children:[ge.jsx(Gm,{children:ge.jsx("title",{children:" RouterControll"})}),ge.jsx(s0,{})]})}export{h0 as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/mapbox-gl-lP4rPiBv.js","assets/index-AhEPQf_3.js","assets/index-n032A96x.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
