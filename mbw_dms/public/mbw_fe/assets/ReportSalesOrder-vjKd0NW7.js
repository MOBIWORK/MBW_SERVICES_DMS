import{Y as a,a3 as d,L as e,N as ue,R as he,O as m,a5 as c,a6 as pe,bv as o,V as y,aR as q,a8 as xe}from"./index-diwCb8Hq.js";import{H as ye}from"./header-page-nAdL1FFk.js";import{C as ge}from"./index-1WmXdaNi.js";import{u}from"./useDebount-TYGsy433.js";import{a as fe}from"./index-v6yy1zdl.js";import{D as M}from"./index-W9ACibL3.js";import{V as _e}from"./VerticalAlignBottomOutlined-diBKv2y8.js";const h=y().startOf("month"),p=y().endOf("month");let je=Date.parse(h.$d)/1e3,be=Date.parse(p.$d)/1e3;const Se=[{title:e.jsx("div",{className:"relative",children:e.jsx("span",{className:"absolute -top-[11px] -left-8",children:"STT"})}),dataIndex:"stt",key:"stt",render:(n,r,x)=>x+1},{title:"Đơn đặt",dataIndex:"name",key:"name",render:(n,r)=>e.jsx("div",{children:e.jsx("a",{className:"text-[#212B36]",href:`app/sales-order/${r.name}`,target:"_blank",children:r.name})})},{title:"Khách hàng",dataIndex:"customer",key:"customer",render:(n,r)=>e.jsx("div",{children:r.customer})},{title:"Khu vực",dataIndex:"territory",key:"territory",render:(n,r)=>e.jsx("div",{children:r.territory})},{title:"Kho",dataIndex:"set_warehouse",key:"set_warehouse"},{title:"Ngày tạo",dataIndex:"transaction_date",key:"transaction_date",render:n=>n?e.jsx("p",{children:y(n*1e3).format("DD/MM/YYYY")}):e.jsx(e.Fragment,{})},{title:"Nhân viên",dataIndex:"employee",key:"employee",render:(n,r)=>e.jsx("div",{className:"!w-[150px]",children:r.employee})},{title:"Thành tiền (VNĐ)",dataIndex:"total",key:"total",render:(n,r)=>e.jsx("div",{className:"!text-right",children:Intl.NumberFormat().format(r.total)})},{title:"Tiền VAT (VNĐ)",dataIndex:"tax_amount",key:"tax_amount",render:(n,r)=>e.jsx("div",{className:"!text-right",children:Intl.NumberFormat().format(r.tax_amount)})},{title:"Chiết khấu (VNĐ)",dataIndex:"discount_amount",key:"discount_amount",render:(n,r)=>e.jsx("div",{className:"!text-right",children:Intl.NumberFormat().format(r.discount_amount)})},{title:"Tổng tiền (VNĐ)",dataIndex:"grand_total",key:"grand_total",render:(n,r)=>e.jsx("div",{className:"!text-right",children:Intl.NumberFormat().format(r.grand_total)})}];function Ne(){const[n,r]=a.useState([]),[x,W]=a.useState(0),g=20,[f,L]=a.useState(1),[P,A]=a.useState([]),[_,j]=a.useState(""),[$,z]=a.useState(""),[b,S]=a.useState(""),[B,H]=a.useState([]),[G,U]=a.useState(""),[N,F]=a.useState(""),[X,Z]=a.useState([]),[J,Q]=a.useState(""),[k,C]=a.useState(je),[v,I]=a.useState(be),[T,w]=a.useState(""),[ee,te]=a.useState([]),[ae,se]=a.useState(""),[D,E]=a.useState(""),[re,ne]=a.useState([]),[le,oe]=a.useState("");let O=u($,500),Y=u(G,500),K=u(J,500),V=u(ae,500),R=u(le,500);const ie=t=>{const l=[{title:"STT",dataIndex:"stt",key:"stt",render:(s,i,ce)=>ce+1},{title:"Mã sản phẩm",dataIndex:"item_code",key:"item_code"},{title:"Tên sản phẩm",dataIndex:"item_name",key:"item_name"},{title:"Nhóm sản phẩm",dataIndex:"item_group",key:"item_group"},{title:"Nhãn hàng",dataIndex:"brand",key:"brand"},{title:"Đơn giá",dataIndex:"rate",key:"rate",render:(s,i)=>e.jsx("div",{className:"!text-right",children:Intl.NumberFormat().format(i.rate)})},{title:"Số lượng",dataIndex:"qty",key:"qty",render:(s,i)=>e.jsx("div",{className:"!text-right",children:i.qty})},{title:"Chiết khấu (%)",dataIndex:"discount_percentage",key:"discount_percentage",render:(s,i)=>e.jsx("div",{className:"!text-right",children:Intl.NumberFormat().format(i.discount_percentage)})},{title:"Tiền chiết khấu",dataIndex:"discount_amount",key:"discount_amount",render:(s,i)=>e.jsx("div",{className:"!text-right",children:Intl.NumberFormat().format(i.discount_amount)})},{title:"Tổng tiền (VNĐ)",dataIndex:"amount",key:"amount",render:(s,i)=>e.jsx("div",{className:"!text-right",children:Intl.NumberFormat().format(i.amount)})}];return e.jsx(o,{columns:l,dataSource:t.items.map(s=>({...s,key:s.item_code})),pagination:!1})};a.useEffect(()=>{(async()=>{let t=await d.get("/api/method/frappe.desk.search.search_link",{params:{txt:O,doctype:"Company",ignore_user_permissions:0,query:""}}),{message:l}=t;A(l.map(s=>({value:s.value,label:s.value})))})()},[O]),a.useEffect(()=>{(async()=>{let t=await d.get("/api/method/frappe.desk.search.search_link",{params:{txt:K,doctype:"Customer",ignore_user_permissions:0,query:""}}),{message:l}=t;Z(l.map(s=>({value:s.value,label:s.value})))})()},[K]),a.useEffect(()=>{(async()=>{let t=await d.get("/api/method/frappe.desk.search.search_link",{params:{txt:V,doctype:"Warehouse",ignore_user_permissions:0,query:""}}),{message:l}=t;te(l.map(s=>({value:s.value,label:s.value})))})()},[V]),a.useEffect(()=>{(async()=>{let t=await d.get("/api/method/frappe.desk.search.search_link",{params:{txt:Y,doctype:"Territory",ignore_user_permissions:0,query:""}}),{message:l}=t;H(l.map(s=>({value:s.value,label:s.value})))})()},[Y]),a.useEffect(()=>{(async()=>{let t=await d.get("/api/method/frappe.desk.search.search_link",{params:{txt:R,doctype:"Employee",ignore_user_permissions:0,query:"mbw_dms.api.report.so_report.employee_query"}}),{message:l}=t;ne(l.map(s=>({value:s.description.split(",")[1].trim(),label:s.description.split(",")[0].trim()})))})()},[R]),a.useEffect(()=>{(async()=>{const t=await d.get("/api/method/mbw_dms.api.report.so_report.so_report",{params:{page_size:g,page_number:f,company:_,territory:b,customer:N,from_date:k,to_date:v,warehouse:T,employee:D}});let{result:l}=t;r(l),W(l?.totals)})()},[f,_,b,N,k,v,T,D]);const me=t=>{if(t==null)C("");else if(p&&t&&t.isAfter(p,"day"))q.error("Từ ngày phải nhỏ hơn hoặc bằng Đến ngày");else{let l=Date.parse(t.$d)/1e3;C(l)}},de=t=>{if(t==null)I("");else if(h&&t&&t.isBefore(h,"day"))q.error("Đến ngày phải lớn hơn hoặc bằng Từ ngày");else{let l=Date.parse(t.$d)/1e3;I(l)}};return e.jsx(e.Fragment,{children:e.jsx(ge,{header:e.jsx(ye,{title:"Báo cáo tổng hợp đặt hàng",buttons:[{label:"Xuất dữ liệu",type:"primary",icon:e.jsx(_e,{className:"text-xl"}),size:"20px",className:"flex items-center",action:()=>{fe("/app/data-export/Data%20Export")}}]}),children:e.jsxs("div",{className:"bg-white rounded-md pt-4 pb-7 border-[#DFE3E8] border-[0.2px] border-solid",children:[e.jsx(ue,{layout:"vertical",className:"flex flex-wrap justify-start items-center px-4",children:e.jsxs(he,{className:"",gutter:[8,8],children:[e.jsx(m,{label:"Công ty",className:"w-[175px] border-none mr-2",children:e.jsx(c,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:P,onSelect:t=>{j(t)},onSearch:t=>{z(t)},onClear:()=>j(""),filterOption:!1,allowClear:!0,placeholder:"Tất cả công ty"})}),e.jsx(m,{label:"Khác hàng",className:"w-[175px] border-none mr-2",children:e.jsx(c,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:X,onSelect:t=>{F(t)},onSearch:t=>{Q(t)},onClear:()=>F(""),filterOption:!1,allowClear:!0,placeholder:"Tất cả khách hàng"})}),e.jsx(m,{label:"Khu vực",className:"w-[175px] border-none mr-2",children:e.jsx(c,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:B,onSelect:t=>{S(t)},onSearch:t=>{U(t)},onClear:()=>S(""),filterOption:!1,allowClear:!0,placeholder:"Tất cẩ khu vực"})}),e.jsx(m,{label:"Từ ngày",className:"w-[175px] border-none mr-2",children:e.jsx(M,{format:"DD-MM-YYYY",className:"!bg-[#F4F6F8] !h-8",placeholder:"Từ ngày",onChange:me,defaultValue:h})}),e.jsx(m,{label:"Đến ngày",className:"w-[175px] border-none mr-2",children:e.jsx(M,{format:"DD-MM-YYYY",className:"!bg-[#F4F6F8] !h-8",onChange:de,placeholder:"Đến ngày",defaultValue:p})}),e.jsx(m,{label:"Kho",className:"w-[175px] border-none mr-2",children:e.jsx(c,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:ee,onSelect:t=>{w(t)},onSearch:t=>{se(t)},onClear:()=>w(""),filterOption:!1,allowClear:!0,placeholder:"Tất cả kho"})}),e.jsx(m,{label:"Nhân viên",className:"w-[175px] border-none mr-2",children:e.jsx(c,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:re,onSelect:t=>{E(t)},onSearch:t=>{oe(t)},onClear:()=>E(""),filterOption:!1,allowClear:!0,placeholder:"Tất cả nhân viên"})})]})}),e.jsx("div",{className:"pt-5",children:e.jsx(pe,{dataSource:n?.data?.map(t=>({...t,key:t.name})),expandable:{expandedRowRender:ie,defaultExpandedRowKeys:["0"]},bordered:!0,columns:Se,scroll:{x:!0},pagination:{defaultPageSize:g,total:x,showSizeChanger:!1,onChange(t){L(t)}},summary:()=>(console.log("sale",n),e.jsxs(o.Summary.Row,{children:[e.jsx(o.Summary.Cell,{index:0}),e.jsx(o.Summary.Cell,{index:1,children:"Tổng"}),e.jsx(o.Summary.Cell,{index:2}),e.jsx(o.Summary.Cell,{index:3}),e.jsx(o.Summary.Cell,{index:4}),e.jsx(o.Summary.Cell,{index:5}),e.jsx(o.Summary.Cell,{index:6}),e.jsx(o.Summary.Cell,{index:7}),e.jsx(o.Summary.Cell,{index:8,children:e.jsx("div",{className:"text-right",children:Intl.NumberFormat().format(n?.sum?.sum_total)})}),e.jsx(o.Summary.Cell,{index:9,children:e.jsx("div",{className:"text-right",children:Intl.NumberFormat().format(n?.sum?.sum_vat)})}),e.jsx(o.Summary.Cell,{index:10,children:e.jsx("div",{className:"text-right",children:Intl.NumberFormat().format(n?.sum?.sum_discount_amount)})}),e.jsx(o.Summary.Cell,{index:11,children:e.jsx("div",{className:"text-right",children:Intl.NumberFormat().format(n?.sum?.sum_grand_total)})})]}))})})]})})})}function De(){return e.jsxs(e.Fragment,{children:[e.jsx(xe,{children:e.jsx("title",{children:" ReportSalesOrder"})}),e.jsx(Ne,{})]})}export{De as default};
