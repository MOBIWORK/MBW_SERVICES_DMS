import{L as a,aS as je,a5 as d,P as e,U as j,V as f,Q as P,R as m,a7 as c,a6 as fe,W as h,a8 as Ne,bv as o,Y as N,aR as z,aa as _e}from"./index-AFmgeI67.js";import{H as be}from"./header-page-I_RE-Vww.js";import{D as Se}from"./index-WMPzWW0T.js";import{C as ve}from"./index-wjFOqjVA.js";import{u}from"./useDebount-oIQ9QM_J.js";import{t as Fe,a as ke}from"./index-BVYJhLpl.js";import{a as Ce,b as we}from"./index.esm-YrH-n0Td.js";import{D as A}from"./index-qfS0tZ9w.js";import{T as Te}from"./index-yy0pY6aw.js";import{V as Ie}from"./VerticalAlignBottomOutlined-tXkHF-Oc.js";const x=N().startOf("month"),p=N().endOf("month");let De=Date.parse(x.$d)/1e3,Ee=Date.parse(p.$d)/1e3;const Ve=[{title:e.jsx("div",{className:"relative",children:e.jsx("span",{className:"absolute -top-[11px] -left-8",children:"STT"})}),dataIndex:"stt",key:"stt",render:(l,r,y)=>y+1},{title:"Đơn đặt",dataIndex:"name",key:"name",render:(l,r)=>e.jsx("div",{children:e.jsx("a",{className:"text-[#212B36]",href:`/app/sales-invoice/${r.name}`,target:"_blank",children:r.name})})},{title:"Khách hàng",dataIndex:"customer",key:"customer",render:(l,r)=>e.jsx("div",{children:r.customer})},{title:"Khu vực",dataIndex:"territory",key:"territory",render:(l,r)=>e.jsx("div",{children:r.territory})},{title:"Kho",dataIndex:"set_warehouse",key:"set_warehouse",render:(l,r)=>e.jsx("div",{children:r.set_warehouse})},{title:"Ngày tạo",dataIndex:"posting_date",key:"posting_date",render:(l,r)=>e.jsx("div",{children:N(r.posting_date*1e3).format("DD/MM/YYYY")})},{title:"Nhân viên",dataIndex:"employee",key:"employee",render:(l,r)=>e.jsx("div",{children:r.employee})},{title:e.jsx("div",{className:"text-right",children:"Thành tiền (VNĐ)"}),dataIndex:"total",key:"total",render:(l,r)=>e.jsx("div",{className:"!text-right",children:Intl.NumberFormat().format(r.total)})},{title:e.jsx("div",{className:"text-right",children:"Tiền VAT (VNĐ)"}),dataIndex:"tax_amount",key:"tax_amount",render:(l,r)=>e.jsx("div",{className:"text-right",children:Intl.NumberFormat().format(r.tax_amount)})},{title:e.jsx("div",{className:"text-right",children:"Chiết khấu (VNĐ)"}),dataIndex:"discount_amount",key:"discount_amount",render:(l,r)=>e.jsx("div",{className:"text-right",children:Intl.NumberFormat().format(r.discount_amount)})},{title:e.jsx("div",{className:"text-right",children:"Tổng tiền (VNĐ)"}),dataIndex:"grand_total",key:"grand_total",render:(l,r)=>e.jsx("div",{className:"text-right",children:Intl.NumberFormat().format(r.grand_total)})}];function Ye(){const[l,r]=a.useState([]),[y,$]=a.useState(0),_=20,[g]=je(),[b,H]=a.useState(1),[U,X]=a.useState([]),[S,v]=a.useState(""),[G,Ke]=a.useState(""),[F,k]=a.useState(""),[Q,Z]=a.useState([]),[J,Re]=a.useState(""),[C,w]=a.useState(""),[ee,te]=a.useState([]),[ae,We]=a.useState(""),[T,I]=a.useState(De),[D,E]=a.useState(Ee),[V,Y]=a.useState(""),[se,re]=a.useState([]),[ne,Le]=a.useState(""),[K,R]=a.useState(""),[le,oe]=a.useState([]);let W=u(G,500),L=u(J,500),M=u(ae,500),O=u(ne,500);const[ie,me]=a.useState("");let q=u(ie);const[de,ce]=a.useState([]),[B,ue]=a.useState(),he=t=>{const n=[{title:e.jsx("div",{className:"text-center",children:"STT"}),dataIndex:"stt",key:"stt",render:(s,i,ge)=>e.jsx("div",{className:"text-center",children:ge+1})},{title:"Mã sản phẩm",dataIndex:"item_code",key:"item_code"},{title:"Tên sản phẩm",dataIndex:"item_name",key:"item_name"},{title:"Nhóm sản phẩm",dataIndex:"item_group",key:"item_group"},{title:"Nhãn hàng",dataIndex:"brand",key:"brand"},{title:e.jsx("div",{className:"text-right",children:"Đơn giá"}),dataIndex:"rate",key:"rate",render:(s,i)=>e.jsx("div",{className:"!text-right",children:Intl.NumberFormat().format(i.rate)})},{title:e.jsx("div",{className:"text-right",children:"Số lượng"}),dataIndex:"qty",key:"qty",render:(s,i)=>e.jsx("div",{className:"!text-right",children:i.qty})},{title:e.jsx("div",{className:"text-right",children:"Chiết khấu (%)"}),dataIndex:"discount_percentage",key:"discount_percentage",render:(s,i)=>e.jsx("div",{className:"!text-right",children:Intl.NumberFormat().format(i.discount_percentage)})},{title:e.jsx("div",{className:"text-right",children:"Tiền chiết khấu (VNĐ)"}),dataIndex:"discount_amount",key:"discount_amount",render:(s,i)=>e.jsx("div",{className:"!text-right",children:Intl.NumberFormat().format(i.discount_amount)})},{title:e.jsx("div",{className:"text-right",children:"Tổng tiền (VNĐ)"}),dataIndex:"amount",key:"amount",render:(s,i)=>e.jsx("div",{className:"!text-right",children:Intl.NumberFormat().format(i.amount)})}];return e.jsx(o,{columns:n,dataSource:t.items.map(s=>({...s,key:s.item_code})),pagination:!1})};a.useEffect(()=>{(async()=>{let t=await d.get("/api/method/frappe.desk.search.search_link",{params:{txt:W,doctype:"Company",ignore_user_permissions:0,query:""}}),{message:n}=t;X(n.map(s=>({value:s.value,label:s.value})))})()},[W]),a.useEffect(()=>{(async()=>{let t=await d.get("/api/method/frappe.desk.search.search_link",{params:{txt:M,doctype:"Customer",ignore_user_permissions:0,query:""}}),{message:n}=t;te(n.map(s=>({value:s.value,label:s.value})))})()},[M]),a.useEffect(()=>{(async()=>{let t=await d.get("/api/method/frappe.desk.search.search_link",{params:{txt:O,doctype:"Warehouse",ignore_user_permissions:0,query:""}}),{message:n}=t;re(n.map(s=>({value:s.value,label:s.value})))})()},[O]),a.useEffect(()=>{(async()=>{let t=await d.get("/api/method/frappe.desk.search.search_link",{params:{txt:L,doctype:"Territory",ignore_user_permissions:0,query:""}}),{message:n}=t;Z(n.map(s=>({value:s.value,label:s.value})))})()},[L]),a.useEffect(()=>{(async()=>{let t=await d.get("/api/method/mbw_dms.api.router.get_team_sale");ce(Fe({data:t.result.map(n=>({title:n.name,value:n.name,...n})),keyValue:"value",parentField:"parent_sales_person"}))})()},[]),a.useEffect(()=>{(async()=>{let t=await d.get("/api/method/mbw_dms.api.router.get_sale_person",{params:{team_sale:B,key_search:q}}),{message:n}=t;oe(n.map(s=>({value:s.employee_code,label:s.employee_name||s.employee_code})))})()},[B,q]),a.useEffect(()=>{(async()=>{const t=await d.get("/api/method/mbw_dms.api.report.so_report.si_report",{params:{page_size:_,page_number:b,company:S,territory:F,customer:C,from_date:T,to_date:D,warehouse:V,employee:K}});let{result:n}=t;r(n),$(n?.totals)})()},[b,S,F,C,T,D,V,K]);const xe=t=>{if(t==null)I("");else if(p&&t&&t.isAfter(p,"day"))z.error("Từ ngày phải nhỏ hơn hoặc bằng Đến ngày");else{let n=Date.parse(t.$d)/1e3;I(n)}},pe=t=>{if(t==null)E("");else if(x&&t&&t.isBefore(x,"day"))z.error("Đến ngày phải lớn hơn hoặc bằng Từ ngày");else{let n=Date.parse(t.$d)/1e3;E(n)}},ye=t=>{t.company?v(t.company):v(""),t.customer?w(t.customer):w(""),t.territory?k(t.territory):k(""),t.warehouse?Y(t.warehouse):Y("")};return e.jsx(e.Fragment,{children:e.jsx(ve,{header:e.jsx(be,{title:"Báo cáo tổng hợp bán hàng",buttons:[{label:"Xuất dữ liệu",type:"primary",icon:e.jsx(Ie,{className:"text-xl"}),size:"20px",className:"flex items-center",action:()=>{ke("/app/data-export/Data%20Export")}}]}),children:e.jsxs("div",{className:"bg-white rounded-2xl pt-4 pb-7 border-[#DFE3E8] border-[0.2px] border-solid",children:[e.jsxs(j,{gutter:[16,16],className:"justify-between items-end w-full",children:[e.jsx(f,{children:e.jsx(j,{gutter:[8,8],children:e.jsx(f,{className:"mx-4 w-full",span:24,children:e.jsxs(P,{layout:"vertical",className:"flex flex-wrap justify-start items-center ",children:[e.jsx(m,{label:"Từ ngày",className:"w-[200px] border-none mr-2",children:e.jsx(A,{format:"DD-MM-YYYY",className:"!bg-[#F4F6F8] !h-7 rounded-lg mt-[-2px]",placeholder:"Từ ngày",onChange:xe,defaultValue:x})}),e.jsx(m,{label:"Đến ngày",className:"w-[200px] border-none mr-2",children:e.jsx(A,{format:"DD-MM-YYYY",className:"!bg-[#F4F6F8] !h-7 rounded-lg mt-[-2px]",onChange:pe,placeholder:"Đến ngày",defaultValue:p})}),e.jsx(m,{label:"Nhóm bán hàng",className:"border-none mr-2 w-[200px]",children:e.jsx(Te,{placeholder:"Tất cả nhóm bán hàng",allowClear:!0,treeData:de,onChange:t=>{ue(t)},dropdownStyle:{maxHeight:400,overflow:"auto",minWidth:400}})}),e.jsx(m,{label:"Nhân viên",className:"border-none mr-2 w-[200px]",name:"employee",children:e.jsx(c,{filterOption:!1,notFoundContent:null,allowClear:!0,placeholder:"Tất cả nhân viên",onSearch:t=>{me(t)},options:le,onSelect:t=>{R(t)},onClear:()=>{R("")}})})]})})})}),e.jsx(f,{className:"!ml-4",children:e.jsx("div",{className:"flex flex-wrap items-center",children:e.jsxs("div",{className:"flex justify-center items-center mr-4",children:[e.jsx(fe,{className:"!h-9",placement:"bottomRight",trigger:["click"],dropdownRender:()=>e.jsxs(Se,{title:"Bộ lọc",children:[e.jsx("div",{className:"",children:e.jsxs(P,{layout:"vertical",form:g,onFinish:ye,children:[e.jsx(m,{name:"company",label:"Công ty",className:"w-[468px] border-none",children:e.jsx(c,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:U,allowClear:!0,placeholder:"Tất cả công ty"})}),e.jsx(m,{name:"customer",label:"Khách hàng",className:"w-[468px] border-none pt-2",children:e.jsx(c,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:ee,filterOption:!1,allowClear:!0,placeholder:"Tất cả khách hàng"})}),e.jsx(m,{name:"territory",label:"Khu vực",className:"w-[468px] border-none pt-2",children:e.jsx(c,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:Q,allowClear:!0,placeholder:"Tất cẩ khu vực"})}),e.jsx(m,{name:"warehouse",label:"Kho",className:"w-[468px] border-none pt-2",children:e.jsx(c,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:se,allowClear:!0,placeholder:"Tất cả kho"})})]})}),e.jsxs(j,{className:"justify-between pt-6 pb-4",children:[e.jsx("div",{}),e.jsxs("div",{children:[e.jsx(h,{className:"mr-3",onClick:t=>{t.preventDefault(),g.resetFields()},children:"Đặt lại"}),e.jsx(h,{type:"primary",onClick:()=>{g.submit()},children:"Áp dụng"})]})]})]}),children:e.jsx(h,{onClick:t=>t.preventDefault(),className:"flex items-center text-nowrap !text-[13px] !leading-[21px] !font-normal  border-r-[0.1px] rounded-r-none h-9",icon:e.jsx(Ce,{style:{fontSize:"20px"}}),children:"Bộ lọc"})}),e.jsx(h,{className:"border-l-[0.1px] rounded-l-none !h-9",children:e.jsx(we,{style:{fontSize:"20px"}})})]})})})]}),e.jsx("div",{className:"pt-5",children:e.jsx(Ne,{dataSource:l?.data?.map(t=>({...t,key:t.name})),expandable:{expandedRowRender:he,defaultExpandedRowKeys:["0"]},bordered:!0,columns:Ve,scroll:{x:!0},pagination:{defaultPageSize:_,total:y,showSizeChanger:!1,onChange(t){H(t)}},summary:()=>e.jsxs(o.Summary.Row,{children:[e.jsx(o.Summary.Cell,{index:0,className:"!border-r-0"}),e.jsx(o.Summary.Cell,{index:1}),e.jsx(o.Summary.Cell,{index:2,children:"Tổng"}),e.jsx(o.Summary.Cell,{index:3}),e.jsx(o.Summary.Cell,{index:4}),e.jsx(o.Summary.Cell,{index:5}),e.jsx(o.Summary.Cell,{index:6}),e.jsx(o.Summary.Cell,{index:7}),e.jsx(o.Summary.Cell,{index:8,children:e.jsx("div",{className:"text-right",children:Intl.NumberFormat().format(l?.sum?.sum_total)})}),e.jsx(o.Summary.Cell,{index:9,children:e.jsx("div",{className:"text-right",children:Intl.NumberFormat().format(l?.sum?.sum_vat)})}),e.jsx(o.Summary.Cell,{index:10,children:e.jsx("div",{className:"text-right",children:Intl.NumberFormat().format(l?.sum?.sum_discount_amount)})}),e.jsx(o.Summary.Cell,{index:11,children:e.jsx("div",{className:"text-right",children:Intl.NumberFormat().format(l?.sum?.sum_grand_total)})})]})})})]})})})}function Xe(){return e.jsxs(e.Fragment,{children:[e.jsx(_e,{children:e.jsx("title",{children:" ReportSales"})}),e.jsx(Ye,{})]})}export{Xe as default};
