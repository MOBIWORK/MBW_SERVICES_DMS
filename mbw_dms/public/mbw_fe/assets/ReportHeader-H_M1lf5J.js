import{Y as a,ct as C,cu as Qe,cv as ee,V as j,L as e,P as _,a2 as f,cw as ce,a1 as y,a6 as ie,aa as ue,cx as I,cy as he,cz as v,cA as $,cB as R,aZ as Ue,cC as L,cD as M,cE as O,a_ as Ze,a9 as Je,N as x,R as Xe,Q as H,cF as se,cG as te,cH as ae,cI as re,cJ as le,cK as ne,cL as oe,a7 as Pe,bD as es}from"./index-Y-ucsyP6.js";import{D as ss,S as ts}from"./index-ExY6TDth.js";import{a as as}from"./index.esm-28P13q3d.js";import{e as rs,f as ls}from"./data-u-VkVTNg.js";import{D as q}from"./index-WbcQA3c1.js";import{V as ns}from"./VerticalAlignBottomOutlined-bKQSSZ0o.js";function pe(){var t=a.useContext(C);return t}function me(t){t===void 0&&(t=C);var l=t===C?pe:function(){return a.useContext(t)};return function(){var r=l(),c=r.store;return c}}var os=me();function cs(t){t===void 0&&(t=C);var l=t===C?os:me(t);return function(){var r=l();return r.dispatch}}var w=cs(),is=function(l,n){return l===n};function us(t,l,n,r){var c=a.useReducer(function(b){return b+1},0),m=c[1],i=a.useMemo(function(){return Qe(n,r)},[n,r]),o=a.useRef(),h=a.useRef(),S=a.useRef(),g=a.useRef(),N=n.getState(),F;try{if(t!==h.current||N!==S.current||o.current){var D=t(N);g.current===void 0||!l(D,g.current)?F=D:F=g.current}else F=g.current}catch(b){throw o.current&&(b.message+=`
The error may be correlated with this previous error:
`+o.current.stack+`

`),b}return ee(function(){h.current=t,S.current=N,g.current=F,o.current=void 0}),ee(function(){function b(){try{var k=n.getState();if(k===S.current)return;var T=h.current(k);if(l(T,g.current))return;g.current=T,S.current=k}catch(E){o.current=E}m()}return i.onStateChange=b,i.trySubscribe(),b(),function(){return i.tryUnsubscribe()}},[n,i]),F}function hs(t){t===void 0&&(t=C);var l=t===C?pe:function(){return a.useContext(t)};return function(r,c){c===void 0&&(c=is);var m=l(),i=m.store,o=m.subscription,h=us(r,c,i,o);return a.useDebugValue(h),h}}var B=hs();const K="(max-width: 1062px)",Rs="(min-width: 1200px)",ps=[{label:"Tháng 1",value:"1"},{label:"Tháng 2",value:"2"},{label:"Tháng 3",value:"3"},{label:"Tháng 4",value:"4"},{label:"Tháng 5",value:"5"},{label:"Tháng 6",value:"6"},{label:"Tháng 7",value:"7"},{label:"Tháng 8",value:"8"},{label:"Tháng 9",value:"9"},{label:"Tháng 10",value:"10"},{label:"Tháng 11",value:"11"},{label:"Tháng 12",value:"12"}],Ls=20,V=t=>{const[l,n]=a.useState(!1);return a.useEffect(()=>{const r=window.matchMedia(t);r.matches!==l&&n(r.matches);const c=()=>n(r.matches);return window.addEventListener("resize",c),()=>window.removeEventListener("resize",c)},[l,t]),l},ms=(j().month()+1).toString(),de=({setPage:t})=>{const l=w(),n=V(`${K}`);return e.jsxs(_,{className:`min-w-[130px] ${n?"w-full":" w-[20%]"}`,children:[e.jsx("label",{className:"text-xs font-normal leading-[21px] pl-1 ",children:"Tháng"}),e.jsx(f,{className:"!bg-[#F4F6F8] ",defaultValue:ms,options:ps,onChange:r=>{l(ce(r)),t&&t(1)}})]})},ds=()=>{const t=w(),[l,n]=a.useState([]);return a.useEffect(()=>{(async()=>{let r=await y.get("/api/method/mbw_dms.api.router.get_team_sale");n(ie({data:r.result.map(c=>({title:c.name,value:c.name,...c})),keyValue:"value",parentField:"parent_sales_person"}))})()},[]),e.jsxs(_,{className:"min-w-[130px]  w-[20%]",children:[e.jsx("label",{className:"text-xs font-normal leading-[21px] pl-1 ",children:"Nhóm bán hàng"}),e.jsx(ue,{placeholder:"Tất cả nhóm bán hàng",allowClear:!0,showSearch:!0,treeData:l,onChange:r=>{t(I(r))},dropdownStyle:{maxHeight:400,overflow:"auto",minWidth:350}})]})},xe=()=>{const t=w(),l=r=>{t(he(r?.$y.toString()))},n=V(`${K}`);return e.jsxs(_,{className:`min-w-[130px] ${n?"w-full":" w-[20%]"}`,children:[e.jsx("label",{className:"text-xs font-normal leading-[21px] pl-1 ",children:"Năm"}),e.jsx(q,{className:"!bg-[#F4F6F8] w-full rounded-lg h-7",onChange:l,placeholder:"Chọn năm",picker:"year",allowClear:!1,defaultValue:j().startOf("year")})]})},xs=({setPage:t,matchMedia:l})=>{const[n,r]=a.useState([]),[c,m]=a.useState(""),i=w(),{sales_team:o}=B(h=>h.group);return a.useEffect(()=>{(async()=>{let h=await y.get("/api/method/mbw_dms.api.router.get_sale_person",{params:{team_sale:o,key_search:c}}),{message:S}=h;r(S.map(g=>({value:g.employee_code,label:g.employee_name||g.employee_code})))})()},[c,o]),e.jsxs(_,{className:`min-w-[130px] ${l?"w-full":"w-[20%]"}`,children:[e.jsx("label",{className:"text-xs font-normal leading-[21px] pl-1 ",children:"Nhân viên"}),e.jsx(f,{filterOption:!0,allowClear:!0,showSearch:!0,placeholder:"Tất cả nhân viên",onSearch:h=>{m(h)},options:n,onSelect:h=>{i(v(h)),t(1)},onClear:()=>{i(v(""))}})]})},fs=j().startOf("month"),fe=()=>{const t=w();B(r=>r.date);const l=V(`${K}`),n=r=>{if(r==null)t($(r));else{let c=Date.parse(r.$d)/1e3;t($(c))}};return e.jsxs(_,{className:`min-w-[130px]  ${l?"w-full":" w-[20%]"}`,children:[e.jsx("label",{className:"text-xs font-normal leading-[21px] pl-1 ",children:"Từ ngày"}),e.jsx(q,{format:"DD-MM-YYYY",className:"!bg-[#F4F6F8] w-full rounded-lg h-7",placeholder:"Từ ngày",onChange:n,defaultValue:fs,allowClear:!1})]})},ys=j().endOf("month"),ye=()=>{const t=w(),{startDate:l,endDate:n}=B(o=>o.date),r=o=>{if(l){const h=j.unix(l).month();return o&&o.month()!==h}},c=o=>{if(o==null)t(R(o));else if(l&&o&&o.isBefore(j.unix(l),"day"))Ue.error("Đến ngày phải lớn hơn hoặc bằng Từ ngày");else{let h=Date.parse(o.$d)/1e3;t(R(h))}},m=V(`${K}`),i=j(n*1e3);return e.jsxs(_,{className:`min-w-[130px] ${m?"w-full":" w-[20%]"}`,children:[e.jsx("label",{className:"text-xs font-normal leading-[21px] pl-1 ",children:"Đến ngày"}),e.jsx(q,{format:"DD-MM-YYYY",className:"!bg-[#F4F6F8] w-full rounded-lg h-7",onChange:c,placeholder:"Đến ngày",defaultValue:ys,disabledDate:r,value:i,allowClear:!1})]})},Ss=({setPage:t})=>{const[l,n]=a.useState([]),[r,c]=a.useState(""),m=w();return a.useEffect(()=>{(async()=>{let i=await y.get("/api/method/frappe.desk.search.search_link",{params:{txt:r,doctype:"Supplier",ignore_user_permissions:0,query:""}}),{message:o}=i;n(o.map(h=>({value:h?.value,label:h.description.split(",")[0].trim()})))})()},[r]),e.jsxs(_,{className:"min-w-[130px] w-[20%]",children:[e.jsx("label",{className:"text-xs font-normal leading-[21px] pl-1 ",children:"Nhà Cung cấp"}),e.jsx(f,{filterOption:!1,allowClear:!0,showSearch:!0,placeholder:"Tất cả nhà cung cấp",onSearch:i=>{c&&c(i)},options:l,onSelect:i=>{m(L(i)),t(1)},onClear:()=>{m(L(""))}})]})},gs=({setPage:t,matchMedia:l})=>{const[n,r]=a.useState([]),[c,m]=a.useState(""),i=w();return a.useEffect(()=>{(async()=>{let o=await y.get("/api/method/frappe.desk.search.search_link",{params:{txt:c,doctype:"Brand",ignore_user_permissions:0,query:""}}),{message:h}=o;r(h.map(S=>({value:S?.value,description:S?.description})))})()},[c]),e.jsxs(_,{className:`min-w-[130px] ${l?"w-full":"w-[20%]"}`,children:[e.jsx("label",{className:"text-xs font-normal leading-[21px] pl-1 ",children:"Nhãn hiệu"}),e.jsx(f,{filterOption:!1,allowClear:!0,showSearch:!0,placeholder:"Tất cả nhãn hiệu",onSearch:o=>{m(o)},options:n,onSelect:o=>{i(M(o)),t(1)},onClear:()=>{i(M(""))}})]})},ws=({setPage:t})=>{const[l,n]=a.useState([]),[r,c]=a.useState(""),m=w();return a.useEffect(()=>{(async()=>{let i=await y.get("/api/method/frappe.desk.search.search_link",{params:{txt:r,doctype:"DMS Industry",ignore_user_permissions:0,query:""}}),{message:o}=i;n(o.map(h=>({value:h?.value,description:h?.description})))})()},[r]),e.jsxs(_,{className:"min-w-[130px] w-[20%]",children:[e.jsx("label",{className:"text-xs font-normal leading-[21px] pl-1 ",children:"Ngành hàng"}),e.jsx(f,{filterOption:!1,allowClear:!0,showSearch:!0,placeholder:"Tất cả ngành hàng",onSearch:i=>{c(i)},options:l,onSelect:i=>{m(O(i)),t(1)},onClear:()=>{m(O(""))}})]})},bs=({setPage:t,inputMonth:l,inputYear:n,inputFromDate:r,inputToDate:c,inputSaleGroup:m,inputEmployee:i,inputSupplier:o,inputIndustry:h,inpitBrand:S})=>e.jsxs(e.Fragment,{children:[l&&e.jsx(de,{setPage:t}),n&&e.jsx(xe,{}),r&&e.jsx(fe,{}),c&&e.jsx(ye,{}),m&&e.jsx(ds,{}),i&&e.jsx(xs,{setPage:t}),o&&e.jsx(Ss,{setPage:t}),h&&e.jsx(ws,{setPage:t}),S&&e.jsx(gs,{setPage:t})]}),Ms=bs,js=j().startOf("month"),_s=j().endOf("month");let Fs=Date.parse(js.$d)/1e3,vs=Date.parse(_s.$d)/1e3;const Cs=({setPage:t,matchMedia:l,inputFromDate:n,inputMonth:r,inputToDate:c,inputYear:m,inputSaleGroup:i,inputEmployee:o,inputCompany:h,inputCustomer:S,inputTerritory:g,inputWarehouse:N,inputCustomerType:F,inputCustomerGroup:D,inputOrder:b,inputSupplier:k,inputIndustry:T,inputBrand:E})=>{const[Se,ge]=a.useState([]),[we,be]=a.useState([]),[je,_e]=a.useState([]),[Fe,ve]=a.useState([]),[Ce,Ne]=a.useState([]),[ke,De]=a.useState([]),[Te,Ee]=a.useState([]),[Ie,$e]=a.useState([]),[Re,Le]=a.useState([]),[Me,Oe]=a.useState([]),[W,Be]=a.useState(""),[G,Ke]=a.useState(""),[A,Ve]=a.useState(""),[z,Ye]=a.useState(""),[Q,He]=a.useState(""),[U,qe]=a.useState(""),[Z,We]=a.useState(""),[J,Ge]=a.useState(""),[X,Ae]=a.useState(""),[Y]=Ze(),u=w(),{sales_team:P}=B(s=>s.group);T&&a.useEffect(()=>{(async()=>{let s=await y.get("/api/method/frappe.desk.search.search_link",{params:{txt:J,doctype:"DMS Industry",ignore_user_permissions:0,query:""}}),{message:d}=s;Ee(d.map(p=>({value:p?.value,description:p?.description})))})()},[J]),E&&a.useEffect(()=>{(async()=>{let s=await y.get("/api/method/frappe.desk.search.search_link",{params:{txt:Z,doctype:"Brand",ignore_user_permissions:0,query:""}}),{message:d}=s;De(d.map(p=>({value:p?.value,description:p?.description})))})()},[Z]),S&&a.useEffect(()=>{(async()=>{let s=await y.get("/api/method/frappe.desk.search.search_link",{params:{txt:A,doctype:"Customer",ignore_user_permissions:0,query:""}}),{message:d}=s;ge(d.map(p=>({value:p.value,label:p.value})))})()},[A]),g&&a.useEffect(()=>{(async()=>{let s=await y.get("/api/method/frappe.desk.search.search_link",{params:{txt:z,doctype:"Territory",ignore_user_permissions:0,query:""}}),{message:d}=s;_e(d.map(p=>({value:p.value,label:p.value})))})()},[z]),D&&a.useEffect(()=>{(async()=>{let s=await y.get("/api/method/frappe.desk.search.search_link",{params:{txt:X,doctype:"Customer Group",ignore_user_permissions:0,query:""}}),{message:d}=s;ve(d.map(p=>({value:p.value.trim(),label:p.value.trim()})))})()},[X]),a.useEffect(()=>{(async()=>{let s=await y.get("/api/method/mbw_dms.api.router.get_team_sale");$e(ie({data:s.result.map(d=>({title:d.name,value:d.name,...d})),keyValue:"value",parentField:"parent_sales_person"}))})()},[]),o&&a.useEffect(()=>{(async()=>{let s=await y.get("/api/method/mbw_dms.api.router.get_sale_person",{params:{team_sale:P,key_search:G}}),{message:d}=s;Le(d.map(p=>({value:p.employee_code,label:p.employee_name||p.employee_code})))})()},[P,G]),h&&a.useEffect(()=>{(async()=>{let s=await y.get("/api/method/frappe.desk.search.search_link",{params:{txt:Q,doctype:"Company",ignore_user_permissions:0,query:""}}),{message:d}=s;Ne(d.map(p=>({value:p.value,label:p.value})))})()},[Q]),N&&a.useEffect(()=>{(async()=>{let s=await y.get("/api/method/frappe.desk.search.search_link",{params:{txt:U,doctype:"Warehouse",ignore_user_permissions:0,query:""}}),{message:d}=s;be(d.map(p=>({value:p.value,label:p.value})))})()},[U]),k&&a.useEffect(()=>{(async()=>{let s=await y.get("/api/method/frappe.desk.search.search_link",{params:{txt:W,doctype:"Supplier",ignore_user_permissions:0,query:""}}),{message:d}=s;Oe(d.map(p=>({value:p?.value,label:p.description.split(",")[0].trim()})))})()},[W]);const ze=s=>{s.customergroup?u(se(s.customergroup)):u(se("")),s.customertype?u(te(s.customertype)):u(te("")),s.territory?u(ae(s.territory)):u(ae("")),s.has_sales_order?u(re(s.has_sales_order)):u(re("")),s.filter_month?u($(Date.parse(s.filter_month.$d)/1e3)):u($(Fs)),s.filter_year?u(R(Date.parse(s.filter_year.$d)/1e3)):u(R(vs)),s.company?u(le(s.company)):u(le("")),s.customer?u(ne(s.customer)):u(ne("")),s.warehouse?u(oe(s.warehouse)):u(oe("")),s.filter_group_sales?u(I(s.filter_group_sales)):u(I("")),s.filter_employee?u(v(s.filter_employee)):u(v("")),t&&t(1)};return e.jsx(Je,{className:"!h-8",placement:"bottomRight",trigger:["click"],dropdownRender:()=>e.jsxs(ss,{title:"Bộ lọc",children:[e.jsxs(x,{layout:"vertical",form:Y,onFinish:ze,children:[!l&&e.jsxs(e.Fragment,{children:[n&&e.jsx(x.Item,{className:"w-[468px] border-none",name:"filter_month",children:e.jsx(fe,{})}),r&&e.jsx(x.Item,{className:"w-[468px] border-none",name:"filter_month",children:e.jsx(de,{setPage:t})}),c&&e.jsx(x.Item,{className:"w-[468px] border-none",name:"filter_year",children:e.jsx(ye,{})}),m&&e.jsx(x.Item,{className:"w-[468px] border-none",name:"filter_year",children:e.jsx(xe,{})}),i&&e.jsx(x.Item,{className:"w-[468px] border-none",name:"filter_group_sales",label:"Nhóm bán hàng",children:e.jsx(ue,{placeholder:"Tất cả nhóm bán hàng",allowClear:!0,showSearch:!0,treeData:Ie,dropdownStyle:{maxHeight:400,overflow:"auto",minWidth:350}})}),o&&e.jsx(x.Item,{className:"w-[468px] border-none",label:"Nhân viên",name:"filter_employee",children:e.jsx(f,{filterOption:!0,allowClear:!0,showSearch:!0,placeholder:"Tất cả nhân viên",onSearch:s=>{Ke(s)},options:Re,onClear:()=>{v&&v("")}})})]}),h&&e.jsx(x.Item,{name:"company",label:"Công ty",className:"w-[468px] border-none",children:e.jsx(f,{showSearch:!0,className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:Ce,allowClear:!0,onSearch:s=>{He(s)},placeholder:"Tất cả công ty"})}),S&&e.jsx(x.Item,{name:"customer",label:"Khách hàng",className:"w-[468px] border-none",children:e.jsx(f,{showSearch:!0,className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:Se,filterOption:!1,allowClear:!0,onSearch:s=>{Ve(s)},placeholder:"Tất cả khách hàng"})}),N&&e.jsx(x.Item,{name:"warehouse",label:"Kho",className:"w-[468px] border-none",children:e.jsx(f,{showSearch:!0,className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:we,allowClear:!0,onSearch:s=>{qe(s)},placeholder:"Tất cả kho"})}),F&&e.jsx(x.Item,{name:"customertype",label:"Loại hình khách hàng",className:"w-[468px] border-none",children:e.jsx(f,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:rs,allowClear:!0,showSearch:!0,placeholder:"Tất cả loại hình khách hàng"})}),D&&e.jsx(x.Item,{name:"customergroup",label:"Nhóm khách hàng",className:"w-[468px] border-none",children:e.jsx(f,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:Fe,allowClear:!0,onSearch:s=>{Ae(s)},showSearch:!0,placeholder:"Tất cả nhóm khách hàng"})}),b&&e.jsx(x.Item,{label:"Phát sinh đơn hàng",name:"hasorder",className:"w-[468px] border-none",children:e.jsx(f,{placeholder:"Tất cả",className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:ls,allowClear:!0,showSearch:!0})}),g&&e.jsx(x.Item,{name:"territory",label:"Khu vực",className:"w-[468px] border-none",children:e.jsx(f,{showSearch:!0,className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:je,allowClear:!0,onSearch:s=>{Ye(s)},placeholder:"Tất cả khu vực"})}),E&&e.jsx(x.Item,{name:"territory",label:"Nhãn hiệu",className:"w-[468px] border-none",children:e.jsx(f,{filterOption:!1,allowClear:!0,showSearch:!0,placeholder:"Tất cả nhãn hiệu",onSearch:s=>{We(s)},options:ke,onSelect:s=>{u(M(s)),t&&t(1)},onClear:()=>{u(M(""))}})}),k&&e.jsx(x.Item,{name:"supplier",label:"Nhà cung cấp",className:"w-[468px] border-none",children:e.jsx(f,{filterOption:!1,notFoundContent:null,allowClear:!0,showSearch:!0,placeholder:"Tất cả nhà cung cấp",onSearch:s=>{Be(s)},options:Me,onSelect:s=>{u(L(s)),t&&t(1)},onClear:()=>{u(L(""))}})}),T&&e.jsx(x.Item,{name:"industry",label:"Ngành hàng",className:"w-[468px] border-none",children:e.jsx(f,{filterOption:!1,allowClear:!0,showSearch:!0,placeholder:"Tất cả ngành hàng",onSearch:s=>{Ge(s)},options:Te,onSelect:s=>{u(O(s)),t&&t(1)},onClear:()=>{u(O(""))}})})]}),e.jsx(Xe,{className:"justify-between pt-6 pb-4",children:e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"mr-3",onClick:s=>{s.preventDefault(),u(ce("")),u(he("")),u(I("")),u(v("")),Y.resetFields()},children:"Đặt lại"}),e.jsx(H,{type:"primary",onClick:()=>{Y.submit()},children:"Áp dụng"})]})})]}),children:e.jsx(H,{onClick:s=>s.preventDefault(),className:"flex items-center text-nowrap !text-[13px] !leading-[21px] !font-normal  border-r-[0.1px]  h-8 mt-4",icon:e.jsx(as,{style:{fontSize:"20px"}}),children:"Bộ lọc"})})},Os=Cs,Ns=({setRefresh:t,title:l,params:n,file_name:r})=>{const[c,m]=a.useState(!1);return e.jsx(Pe,{title:l,buttons:[{icon:e.jsx(ts,{className:"text-xl size-4 mb-1 mr-[2px]"}),className:"flex mr-2 h-7 mt-6",action:()=>{t(i=>!i)}},{disabled:c,label:"Xuất dữ liệu",type:"primary",icon:e.jsx(ns,{className:"text-xl"}),size:"18px",className:"flex items-center h-7 mt-6",action:es.bind(null,{url:"/api/method/mbw_dms.api.exports.export_excel.export_excel",params:n,file_name:r},m)}]})},Bs=Ns;export{Os as D,Ms as F,Ls as P,Bs as R,V as a,Rs as b,K as m,B as u};
