import{Y as a,ct as N,cu as Xe,cv as se,V as w,L as e,P as j,a2 as x,cw as $,a1 as y,a6 as de,aa as fe,cx as R,cy as L,cz as C,cA as v,cB as W,aZ as Pe,cC as M,cD as O,cE as B,a_ as et,a9 as tt,N as f,R as st,Q as q,cF as ae,cG as re,cH as ne,cI as le,cJ as oe,cK as ce,cL as ie,a7 as at,bD as rt}from"./index-LeKbS1WZ.js";import{D as nt,S as lt}from"./index-UOd6Tavx.js";import{a as ot}from"./index.esm-fnJp0BJy.js";import{e as ct,f as it}from"./data-u-VkVTNg.js";import{D as G}from"./index-I-f43eY1.js";import{V as ut}from"./VerticalAlignBottomOutlined-f9IY8zcz.js";function xe(){var s=a.useContext(N);return s}function ye(s){s===void 0&&(s=N);var n=s===N?xe:function(){return a.useContext(s)};return function(){var r=n(),i=r.store;return i}}var ht=ye();function pt(s){s===void 0&&(s=N);var n=s===N?ht:ye(s);return function(){var r=n();return r.dispatch}}var b=pt(),mt=function(n,o){return n===o};function dt(s,n,o,r){var i=a.useReducer(function(_){return _+1},0),m=i[1],u=a.useMemo(function(){return Xe(o,r)},[o,r]),c=a.useRef(),h=a.useRef(),S=a.useRef(),g=a.useRef(),k=o.getState(),F;try{if(s!==h.current||k!==S.current||c.current){var T=s(k);g.current===void 0||!n(T,g.current)?F=T:F=g.current}else F=g.current}catch(_){throw c.current&&(_.message+=`
The error may be correlated with this previous error:
`+c.current.stack+`

`),_}return se(function(){h.current=s,S.current=k,g.current=F,c.current=void 0}),se(function(){function _(){try{var D=o.getState();if(D===S.current)return;var E=h.current(D);if(n(E,g.current))return;g.current=E,S.current=D}catch(I){c.current=I}m()}return u.onStateChange=_,u.trySubscribe(),_(),function(){return u.tryUnsubscribe()}},[o,u]),F}function ft(s){s===void 0&&(s=N);var n=s===N?xe:function(){return a.useContext(s)};return function(r,i){i===void 0&&(i=mt);var m=n(),u=m.store,c=m.subscription,h=dt(r,i,u,c);return a.useDebugValue(h),h}}var K=ft();const V="(max-width: 1062px)",Mt="(min-width: 1200px)",xt=[{label:"Tháng 1",value:"1"},{label:"Tháng 2",value:"2"},{label:"Tháng 3",value:"3"},{label:"Tháng 4",value:"4"},{label:"Tháng 5",value:"5"},{label:"Tháng 6",value:"6"},{label:"Tháng 7",value:"7"},{label:"Tháng 8",value:"8"},{label:"Tháng 9",value:"9"},{label:"Tháng 10",value:"10"},{label:"Tháng 11",value:"11"},{label:"Tháng 12",value:"12"}],Ot=20,Y=s=>{const[n,o]=a.useState(!1);return a.useEffect(()=>{const r=window.matchMedia(s);r.matches!==n&&o(r.matches);const i=()=>o(r.matches);return window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)},[n,s]),n},yt=(w().month()+1).toString(),Se=({setPage:s})=>{const n=b(),o=Y(`${V}`);return e.jsxs(j,{className:`min-w-[130px] ${o?"w-full":" w-[20%]"}`,children:[e.jsx("label",{className:"text-xs font-normal leading-[21px] pl-1 ",children:"Tháng"}),e.jsx(x,{className:"!bg-[#F4F6F8] ",defaultValue:yt,options:xt,onChange:r=>{n($(r)),s&&s(1)}})]})},St=()=>{const s=b(),[n,o]=a.useState([]);return a.useEffect(()=>{(async()=>{let r=await y.get("/api/method/mbw_dms.api.router.get_team_sale");o(de({data:r.result.map(i=>({title:i.name,value:i.name,...i})),keyValue:"value",parentField:"parent_sales_person"}))})()},[]),e.jsxs(j,{className:"min-w-[130px]  w-[20%]",children:[e.jsx("label",{className:"text-xs font-normal leading-[21px] pl-1 ",children:"Nhóm bán hàng"}),e.jsx(fe,{placeholder:"Tất cả nhóm bán hàng",allowClear:!0,showSearch:!0,treeData:n,onChange:r=>{s(R(r))},dropdownStyle:{maxHeight:400,overflow:"auto",minWidth:350}})]})},ge=()=>{const s=b(),n=r=>{s(L(r?.$y.toString()))},o=Y(`${V}`);return e.jsxs(j,{className:`min-w-[130px] ${o?"w-full":" w-[20%]"}`,children:[e.jsx("label",{className:"text-xs font-normal leading-[21px] pl-1 ",children:"Năm"}),e.jsx(G,{className:"!bg-[#F4F6F8] w-full rounded-lg h-7",onChange:n,placeholder:"Chọn năm",picker:"year",allowClear:!1,defaultValue:w().startOf("year")})]})},gt=({setPage:s,matchMedia:n})=>{const[o,r]=a.useState([]),[i,m]=a.useState(""),u=b(),{sales_team:c}=K(h=>h.group);return a.useEffect(()=>{(async()=>{let h=await y.get("/api/method/mbw_dms.api.router.get_sale_person",{params:{team_sale:c,key_search:i}}),{message:S}=h;r(S.map(g=>({value:g.employee_code,label:g.employee_name||g.employee_code})))})()},[i,c]),e.jsxs(j,{className:`min-w-[130px] ${n?"w-full":"w-[20%]"}`,children:[e.jsx("label",{className:"text-xs font-normal leading-[21px] pl-1 ",children:"Nhân viên"}),e.jsx(x,{filterOption:!0,allowClear:!0,showSearch:!0,placeholder:"Tất cả nhân viên",onSearch:h=>{m(h)},options:o,onSelect:h=>{u(C(h)),s(1)},onClear:()=>{u(C(""))}})]})},wt=w().startOf("month"),we=()=>{const s=b();K(r=>r.date);const n=Y(`${V}`),o=r=>{if(r==null)s(v(r));else{let i=Date.parse(r.$d)/1e3;s(v(i))}};return e.jsxs(j,{className:`min-w-[130px]  ${n?"w-full":" w-[20%]"}`,children:[e.jsx("label",{className:"text-xs font-normal leading-[21px] pl-1 ",children:"Từ ngày"}),e.jsx(G,{format:"DD-MM-YYYY",className:"!bg-[#F4F6F8] w-full rounded-lg h-7",placeholder:"Từ ngày",onChange:o,defaultValue:wt,allowClear:!1})]})},bt=w().endOf("month"),be=()=>{const s=b(),{startDate:n,endDate:o}=K(c=>c.date),r=c=>{if(n){const h=w.unix(n).month();return c&&c.month()!==h}},i=c=>{if(c==null)s(W(c));else if(n&&c&&c.isBefore(w.unix(n),"day"))Pe.error("Đến ngày phải lớn hơn hoặc bằng Từ ngày");else{let h=Date.parse(c.$d)/1e3;s(W(h))}},m=Y(`${V}`),u=w(o*1e3);return e.jsxs(j,{className:`min-w-[130px] ${m?"w-full":" w-[20%]"}`,children:[e.jsx("label",{className:"text-xs font-normal leading-[21px] pl-1 ",children:"Đến ngày"}),e.jsx(G,{format:"DD-MM-YYYY",className:"!bg-[#F4F6F8] w-full rounded-lg h-7",onChange:i,placeholder:"Đến ngày",defaultValue:bt,disabledDate:r,value:u,allowClear:!1})]})},_t=({setPage:s})=>{const[n,o]=a.useState([]),[r,i]=a.useState(""),m=b();return a.useEffect(()=>{(async()=>{let u=await y.get("/api/method/frappe.desk.search.search_link",{params:{txt:r,doctype:"Supplier",ignore_user_permissions:0,query:""}}),{message:c}=u;o(c.map(h=>({value:h?.value,label:h.description.split(",")[0].trim()})))})()},[r]),e.jsxs(j,{className:"min-w-[130px] w-[20%]",children:[e.jsx("label",{className:"text-xs font-normal leading-[21px] pl-1 ",children:"Nhà Cung cấp"}),e.jsx(x,{filterOption:!1,allowClear:!0,showSearch:!0,placeholder:"Tất cả nhà cung cấp",onSearch:u=>{i&&i(u)},options:n,onSelect:u=>{m(M(u)),s(1)},onClear:()=>{m(M(""))}})]})},jt=({setPage:s,matchMedia:n})=>{const[o,r]=a.useState([]),[i,m]=a.useState(""),u=b();return a.useEffect(()=>{(async()=>{let c=await y.get("/api/method/frappe.desk.search.search_link",{params:{txt:i,doctype:"Brand",ignore_user_permissions:0,query:""}}),{message:h}=c;r(h.map(S=>({value:S?.value,description:S?.description})))})()},[i]),e.jsxs(j,{className:`min-w-[130px] ${n?"w-full":"w-[20%]"}`,children:[e.jsx("label",{className:"text-xs font-normal leading-[21px] pl-1 ",children:"Nhãn hiệu"}),e.jsx(x,{filterOption:!1,allowClear:!0,showSearch:!0,placeholder:"Tất cả nhãn hiệu",onSearch:c=>{m(c)},options:o,onSelect:c=>{u(O(c)),s(1)},onClear:()=>{u(O(""))}})]})},Ft=({setPage:s})=>{const[n,o]=a.useState([]),[r,i]=a.useState(""),m=b();return a.useEffect(()=>{(async()=>{let u=await y.get("/api/method/frappe.desk.search.search_link",{params:{txt:r,doctype:"DMS Industry",ignore_user_permissions:0,query:""}}),{message:c}=u;o(c.map(h=>({value:h?.value,description:h?.description})))})()},[r]),e.jsxs(j,{className:"min-w-[130px] w-[20%]",children:[e.jsx("label",{className:"text-xs font-normal leading-[21px] pl-1 ",children:"Ngành hàng"}),e.jsx(x,{filterOption:!1,allowClear:!0,showSearch:!0,placeholder:"Tất cả ngành hàng",onSearch:u=>{i(u)},options:n,onSelect:u=>{m(B(u)),s(1)},onClear:()=>{m(B(""))}})]})},Ct=({setPage:s,inputMonth:n,inputYear:o,inputFromDate:r,inputToDate:i,inputSaleGroup:m,inputEmployee:u,inputSupplier:c,inputIndustry:h,inpitBrand:S})=>e.jsxs(e.Fragment,{children:[n&&e.jsx(Se,{setPage:s}),o&&e.jsx(ge,{}),r&&e.jsx(we,{}),i&&e.jsx(be,{}),m&&e.jsx(St,{}),u&&e.jsx(gt,{setPage:s}),c&&e.jsx(_t,{setPage:s}),h&&e.jsx(Ft,{setPage:s}),S&&e.jsx(jt,{setPage:s})]}),Bt=Ct,vt=w().startOf("month"),Nt=w().endOf("month");let ue=Date.parse(vt.$d)/1e3,he=Date.parse(Nt.$d)/1e3;const pe=(w().month()+1).toString(),me=w().startOf("year").$y.toString(),kt=({setPage:s,matchMedia:n,inputFromDate:o,inputMonth:r,inputToDate:i,inputYear:m,inputSaleGroup:u,inputEmployee:c,inputCompany:h,inputCustomer:S,inputTerritory:g,inputWarehouse:k,inputCustomerType:F,inputCustomerGroup:T,inputOrder:_,inputSupplier:D,inputIndustry:E,inputBrand:I})=>{const[_e,je]=a.useState([]),[Fe,Ce]=a.useState([]),[ve,Ne]=a.useState([]),[ke,De]=a.useState([]),[Te,Ee]=a.useState([]),[Ie,$e]=a.useState([]),[Re,Le]=a.useState([]),[Me,Oe]=a.useState([]),[Be,Ke]=a.useState([]),[Ve,Ye]=a.useState([]),[A,He]=a.useState(""),[z,qe]=a.useState(""),[Q,We]=a.useState(""),[U,Ge]=a.useState(""),[Z,Ae]=a.useState(""),[J,ze]=a.useState(""),[X,Qe]=a.useState(""),[P,Ue]=a.useState(""),[ee,Ze]=a.useState(""),[H]=et(),l=b(),{sales_team:te}=K(t=>t.group);E&&a.useEffect(()=>{(async()=>{let t=await y.get("/api/method/frappe.desk.search.search_link",{params:{txt:P,doctype:"DMS Industry",ignore_user_permissions:0,query:""}}),{message:d}=t;Le(d.map(p=>({value:p?.value,description:p?.description})))})()},[P]),I&&a.useEffect(()=>{(async()=>{let t=await y.get("/api/method/frappe.desk.search.search_link",{params:{txt:X,doctype:"Brand",ignore_user_permissions:0,query:""}}),{message:d}=t;$e(d.map(p=>({value:p?.value,description:p?.description})))})()},[X]),S&&a.useEffect(()=>{(async()=>{let t=await y.get("/api/method/frappe.desk.search.search_link",{params:{txt:Q,doctype:"Customer",ignore_user_permissions:0,query:""}}),{message:d}=t;je(d.map(p=>({value:p.value,label:p.value})))})()},[Q]),g&&a.useEffect(()=>{(async()=>{let t=await y.get("/api/method/frappe.desk.search.search_link",{params:{txt:U,doctype:"Territory",ignore_user_permissions:0,query:""}}),{message:d}=t;Ne(d.map(p=>({value:p.value,label:p.value})))})()},[U]),T&&a.useEffect(()=>{(async()=>{let t=await y.get("/api/method/frappe.desk.search.search_link",{params:{txt:ee,doctype:"Customer Group",ignore_user_permissions:0,query:""}}),{message:d}=t;De(d.map(p=>({value:p.value.trim(),label:p.value.trim()})))})()},[ee]),a.useEffect(()=>{(async()=>{let t=await y.get("/api/method/mbw_dms.api.router.get_team_sale");Oe(de({data:t.result.map(d=>({title:d.name,value:d.name,...d})),keyValue:"value",parentField:"parent_sales_person"}))})()},[]),c&&a.useEffect(()=>{(async()=>{let t=await y.get("/api/method/mbw_dms.api.router.get_sale_person",{params:{team_sale:te,key_search:z}}),{message:d}=t;Ke(d.map(p=>({value:p.employee_code,label:p.employee_name||p.employee_code})))})()},[te,z]),h&&a.useEffect(()=>{(async()=>{let t=await y.get("/api/method/frappe.desk.search.search_link",{params:{txt:Z,doctype:"Company",ignore_user_permissions:0,query:""}}),{message:d}=t;Ee(d.map(p=>({value:p.value,label:p.value})))})()},[Z]),k&&a.useEffect(()=>{(async()=>{let t=await y.get("/api/method/frappe.desk.search.search_link",{params:{txt:J,doctype:"Warehouse",ignore_user_permissions:0,query:""}}),{message:d}=t;Ce(d.map(p=>({value:p.value,label:p.value})))})()},[J]),D&&a.useEffect(()=>{(async()=>{let t=await y.get("/api/method/frappe.desk.search.search_link",{params:{txt:A,doctype:"Supplier",ignore_user_permissions:0,query:""}}),{message:d}=t;Ye(d.map(p=>({value:p?.value,label:p.description.split(",")[0].trim()})))})()},[A]);const Je=t=>{t.customergroup?l(ae(t.customergroup)):l(ae("")),t.customertype?l(re(t.customertype)):l(re("")),t.territory?l(ne(t.territory)):l(ne("")),t.filter_fromDate?l(v(t.filter_fromDate)):l(v(ue)),t.filter_toDate?l(v(t.filter_toDate)):l(v(he)),t.has_sales_order?l(le(t.has_sales_order)):l(le("")),t.filter_month?l($(Date.parse(t.filter_month.$d)/1e3)):l($(pe)),t.filter_year?l(L(Date.parse(t.filter_year.$d)/1e3)):l(L(me)),t.company?l(oe(t.company)):l(oe("")),t.customer?l(ce(t.customer)):l(ce("")),t.warehouse?l(ie(t.warehouse)):l(ie("")),t.filter_group_sales?l(R(t.filter_group_sales)):l(R("")),t.filter_employee?l(C(t.filter_employee)):l(C("")),s&&s(1)};return e.jsx(tt,{className:"!h-8",placement:"bottomRight",trigger:["click"],dropdownRender:()=>e.jsxs(nt,{title:"Bộ lọc",children:[e.jsxs(f,{layout:"vertical",form:H,onFinish:Je,children:[!n&&e.jsxs(e.Fragment,{children:[o&&e.jsx(f.Item,{className:"w-[468px] border-none",name:"filter_fromDate",children:e.jsx(we,{})}),r&&e.jsx(f.Item,{className:"w-[468px] border-none",name:"filter_month",children:e.jsx(Se,{setPage:s})}),i&&e.jsx(f.Item,{className:"w-[468px] border-none",name:" filter_toDate",children:e.jsx(be,{})}),m&&e.jsx(f.Item,{className:"w-[468px] border-none",name:"filter_year",children:e.jsx(ge,{})}),u&&e.jsx(f.Item,{className:"w-[468px] border-none",name:"filter_group_sales",label:"Nhóm bán hàng",children:e.jsx(fe,{placeholder:"Tất cả nhóm bán hàng",allowClear:!0,showSearch:!0,treeData:Me,dropdownStyle:{maxHeight:400,overflow:"auto",minWidth:350}})}),c&&e.jsx(f.Item,{className:"w-[468px] border-none",label:"Nhân viên",name:"filter_employee",children:e.jsx(x,{filterOption:!0,allowClear:!0,showSearch:!0,placeholder:"Tất cả nhân viên",onSearch:t=>{qe(t)},options:Be,onClear:()=>{C&&C("")}})})]}),h&&e.jsx(f.Item,{name:"company",label:"Công ty",className:"w-[468px] border-none",children:e.jsx(x,{showSearch:!0,className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:Te,allowClear:!0,onSearch:t=>{Ae(t)},placeholder:"Tất cả công ty"})}),S&&e.jsx(f.Item,{name:"customer",label:"Khách hàng",className:"w-[468px] border-none",children:e.jsx(x,{showSearch:!0,className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:_e,filterOption:!1,allowClear:!0,onSearch:t=>{We(t)},placeholder:"Tất cả khách hàng"})}),k&&e.jsx(f.Item,{name:"warehouse",label:"Kho",className:"w-[468px] border-none",children:e.jsx(x,{showSearch:!0,className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:Fe,allowClear:!0,onSearch:t=>{ze(t)},placeholder:"Tất cả kho"})}),F&&e.jsx(f.Item,{name:"customertype",label:"Loại hình khách hàng",className:"w-[468px] border-none",children:e.jsx(x,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:ct,allowClear:!0,showSearch:!0,placeholder:"Tất cả loại hình khách hàng"})}),T&&e.jsx(f.Item,{name:"customergroup",label:"Nhóm khách hàng",className:"w-[468px] border-none",children:e.jsx(x,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:ke,allowClear:!0,onSearch:t=>{Ze(t)},showSearch:!0,placeholder:"Tất cả nhóm khách hàng"})}),_&&e.jsx(f.Item,{label:"Phát sinh đơn hàng",name:"hasorder",className:"w-[468px] border-none",children:e.jsx(x,{placeholder:"Tất cả",className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:it,allowClear:!0,showSearch:!0})}),g&&e.jsx(f.Item,{name:"territory",label:"Khu vực",className:"w-[468px] border-none",children:e.jsx(x,{showSearch:!0,className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:ve,allowClear:!0,onSearch:t=>{Ge(t)},placeholder:"Tất cả khu vực"})}),I&&e.jsx(f.Item,{name:"territory",label:"Nhãn hiệu",className:"w-[468px] border-none",children:e.jsx(x,{filterOption:!1,allowClear:!0,showSearch:!0,placeholder:"Tất cả nhãn hiệu",onSearch:t=>{Qe(t)},options:Ie,onSelect:t=>{l(O(t)),s&&s(1)},onClear:()=>{l(O(""))}})}),D&&e.jsx(f.Item,{name:"supplier",label:"Nhà cung cấp",className:"w-[468px] border-none",children:e.jsx(x,{filterOption:!1,notFoundContent:null,allowClear:!0,showSearch:!0,placeholder:"Tất cả nhà cung cấp",onSearch:t=>{He(t)},options:Ve,onSelect:t=>{l(M(t)),s&&s(1)},onClear:()=>{l(M(""))}})}),E&&e.jsx(f.Item,{name:"industry",label:"Ngành hàng",className:"w-[468px] border-none",children:e.jsx(x,{filterOption:!1,allowClear:!0,showSearch:!0,placeholder:"Tất cả ngành hàng",onSearch:t=>{Ue(t)},options:Re,onSelect:t=>{l(B(t)),s&&s(1)},onClear:()=>{l(B(""))}})})]}),e.jsx(st,{className:"justify-between pt-6 pb-4",children:e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"mr-3",onClick:t=>{t.preventDefault(),l($(pe)),l(L(me)),l(R("")),l(C("")),l(v(ue)),l(W(he)),H.resetFields()},children:"Đặt lại"}),e.jsx(q,{type:"primary",onClick:()=>{H.submit()},children:"Áp dụng"})]})})]}),children:e.jsx(q,{onClick:t=>t.preventDefault(),className:"flex items-center text-nowrap !text-[13px] !leading-[21px] !font-normal  border-r-[0.1px]  h-8 mt-4",icon:e.jsx(ot,{style:{fontSize:"20px"}}),children:"Bộ lọc"})})},Kt=kt,Dt=({setRefresh:s,title:n,params:o,file_name:r})=>{const[i,m]=a.useState(!1);return e.jsx(at,{title:n,buttons:[{icon:e.jsx(lt,{className:"text-xl size-4 mb-1 mr-[2px]"}),className:"flex mr-2 h-7 mt-6",action:()=>{s(u=>!u)}},{disabled:i,label:"Xuất dữ liệu",type:"primary",icon:e.jsx(ut,{className:"text-xl"}),size:"18px",className:"flex items-center h-7 mt-6",action:rt.bind(null,{url:"/api/method/mbw_dms.api.exports.export_excel.export_excel",params:o,file_name:r},m)}]})},Vt=Dt;export{Kt as D,Bt as F,Ot as P,Vt as R,Y as a,Mt as b,V as m,K as u};
