import{Y as s,aX as ye,a1 as i,L as e,a6 as je,R as _,P as c,a8 as ge,a2 as u,a7 as Se,N as h,Q as x,a9 as fe,bz as n,V as m,ab as _e}from"./index-0IXMorD-.js";import{D as ke}from"./index-GGU_kJlv.js";import{u as be,C as Ce}from"./index-5NJOTm04.js";import{e as we,f as Fe}from"./data-u-VkVTNg.js";import{u as p}from"./useDebount-b7K14iVe.js";import{t as Ne,a as ve}from"./index-5JRjFhLb.js";import{a as De,b as Te}from"./index.esm-VKCmA7nu.js";import{D as O}from"./index-dwq1mbqS.js";import{S as Ye}from"./SyncOutlined-_jMRlAUe.js";import{V as Ie}from"./VerticalAlignBottomOutlined-EWPEYFw-.js";const V=m().startOf("month"),G=m().endOf("month");Date.parse(V.$d)/1e3;Date.parse(G.$d)/1e3;const Ee=[{title:"STT",dataIndex:"stt",key:"stt",className:"!text-center",width:60,render:(a,r,d)=>e.jsx("div",{className:"text-center",children:d+1})},{title:"Nhóm bán hàng",dataIndex:"sales_team",key:"sales_team",render:(a,r)=>e.jsx("div",{children:r.sales_team})},{title:"Mã khách hàng",dataIndex:"customer_code",key:"customer_code",render:(a,r)=>e.jsx("div",{children:r.customer_code})},{title:"Tên khách hàng",dataIndex:"customer_name",key:"customer_name",render:(a,r)=>e.jsx("div",{children:r.customer_name})},{title:"Loại khách hàng",dataIndex:"customer_type",key:"customer_type",render:(a,r)=>e.jsx("div",{children:r.customer_type})},{title:"Nhóm khách hàng",dataIndex:"customer_group",key:"customer_group",render:(a,r)=>e.jsx("div",{children:r.customer_group})},{title:"Người liên hệ",dataIndex:"contact",key:"contact",render:(a,r)=>e.jsx("div",{children:r.contact})},{title:"SDT",dataIndex:"phone",key:"phone",render:(a,r)=>e.jsx("div",{children:r.phone})},{title:"Mã số thuế",dataIndex:"tax_id",key:"tax_id",render:(a,r)=>e.jsx("div",{children:r.tax_id})},{title:"Khu vưc",dataIndex:"territory",key:"territory",render:(a,r)=>e.jsx("div",{children:r.territory})},{title:"Địa chỉ",dataIndex:"address",key:"address",render:(a,r)=>e.jsx("div",{children:r.contribution})},{title:"Ngày thu thập",dataIndex:"creation",key:"creation",render:(a,r)=>e.jsx("div",{children:m(r.creation*1e3).format("DD/MM/YYYY")})},{title:"Nguồn",dataIndex:"f1",key:"f1"},{title:e.jsx("div",{className:"!text-right",children:"Số lần VT"}),dataIndex:"totals_checkin",key:"totals_checkin",render:(a,r)=>e.jsx("div",{className:"!text-right",children:r.totals_checkin})},{title:"VT đầu",dataIndex:"first_checkin",key:"first_checkin",render:a=>a?e.jsx("p",{children:m(a*1e3).format("DD/MM/YYYY")}):e.jsx(e.Fragment,{})},{title:"VT cuối",dataIndex:"last_checkin",key:"last_checkin",render:a=>a?e.jsx("p",{children:m(a*1e3).format("DD/MM/YYYY")}):e.jsx(e.Fragment,{})},{title:e.jsx("div",{className:"!text-right",children:"Số đơn hàng"}),dataIndex:"totals_so",key:"totals_so",render:(a,r)=>e.jsx("div",{className:"!text-right",children:r.totals_so})},{title:"Đơn hàng cuối",dataIndex:"last_sale_order",key:"last_sale_order",render:a=>a?e.jsx("p",{children:m(a*1e3).format("DD/MM/YYYY")}):e.jsx(e.Fragment,{})}];function Me(){const[a,r]=s.useState([]),[d,P]=s.useState(0),y=20,[j,H]=s.useState(1),[g]=ye(),[k,b]=s.useState(""),[K,B]=s.useState([]),[Re,A]=s.useState([]),[C,ze]=s.useState(""),[q,Le]=s.useState(""),[w,F]=s.useState("");let N=p(q,500);const[v,D]=s.useState(""),[X,$]=s.useState([]),[Q,U]=s.useState("");let T=p(Q,500);const[Y,I]=s.useState(""),[W,Z]=s.useState([]),[J,ee]=s.useState("");let E=p(J,500);const[M,R]=s.useState(),[te,se]=s.useState([]),[z,re]=s.useState(),[ae,ne]=s.useState("");let L=p(ae);const S=s.useRef(null),f=be(),[le,oe]=s.useState(0),[ie,ce]=s.useState(f?.h*.52),[me,de]=s.useState(!1);s.useEffect(()=>{ce(f.h*.52)},[f]),s.useEffect(()=>{const t=S.current;if(t){const l=new ResizeObserver(o=>{for(let pe of o)oe(pe.contentRect.height)});return l.observe(t),()=>l.disconnect()}},[S]);const ue=t=>{console.log(t)},he=t=>{console.log(t)},xe=t=>{t.customergroup?D(t.customergroup):D(""),t.customertype?F(t.customertype):F(""),t.territory,I(t.territory),t.hasorder?R(t.hasorder):R(void 0)};return s.useEffect(()=>{(async()=>{let t=await i.get("/api/method/mbw_dms.api.router.get_team_sale");se(Ne({data:t.result.map(l=>({title:l.name,value:l.name,...l})),keyValue:"value",parentField:"parent_sales_person"}))})()},[]),s.useEffect(()=>{(async()=>{let t=await i.get("/api/method/mbw_dms.api.router.get_sale_person",{params:{team_sale:z,key_search:L}}),{message:l}=t;B(l.map(o=>({value:o.employee_name,label:o.employee_name||o.employee_code})))})()},[z,L]),s.useEffect(()=>{(async()=>{let t=await i.get("/api/method/frappe.desk.search.search_link",{params:{txt:N,doctype:"Department",ignore_user_permissions:0,query:""}}),{message:l}=t;A(l.map(o=>({value:o.value.trim(),label:o.value.trim()})))})()},[N]),s.useEffect(()=>{(async()=>{let t=await i.get("/api/method/frappe.desk.search.search_link",{params:{txt:T,doctype:"Customer Group",ignore_user_permissions:0,query:""}}),{message:l}=t;$(l.map(o=>({value:o.value.trim(),label:o.value.trim()})))})()},[T]),s.useEffect(()=>{(async()=>{let t=await i.get("/api/method/frappe.desk.search.search_link",{params:{txt:E,doctype:"Territory",ignore_user_permissions:0,query:""}}),{message:l}=t;Z(l.map(o=>({value:o.value,label:o.value})))})()},[E]),s.useEffect(()=>{(async()=>{const t=await i.get("/api/method/mbw_dms.api.report.customer_report.customer_report",{params:{page_size:y,page_number:j,customer_type:w,customer_group:v,territory:Y,employee:k,has_sales_order:M,department:C}});let{result:l}=t;console.log("result",l),r(l),P(l?.totals_cus)})()},[j,w,v,Y,k,M,C,me]),e.jsx(e.Fragment,{children:e.jsx(Ce,{header:e.jsx(je,{title:"Báo cáo khách hàng mới",buttons:[{icon:e.jsx(Ye,{className:"text-xl"}),size:"18px",className:"flex mr-2 ",action:()=>{de(t=>!t)}},{label:"Xuất dữ liệu",type:"primary",icon:e.jsx(Ie,{className:"text-xl"}),size:"18px",className:"flex items-center",action:()=>{ve("/app/data-export/Data%20Export")}}]}),children:e.jsxs("div",{className:"bg-white rounded-2xl pt-4 pb-7 border-[#DFE3E8] border-[0.2px] border-solid",children:[e.jsxs(_,{gutter:[16,16],className:"justify-between items-end w-full",children:[e.jsx(c,{className:"ml-4",children:e.jsxs(_,{gutter:[8,8],children:[e.jsx(c,{span:5,children:e.jsx(O,{format:"DD-MM-YYYY",className:"!bg-[#F4F6F8] w-full rounded-lg h-7",placeholder:"Từ ngày",onChange:ue,defaultValue:V})}),e.jsx(c,{span:5,children:e.jsx(O,{format:"DD-MM-YYYY",className:"!bg-[#F4F6F8] w-full rounded-lg h-7",onChange:he,placeholder:"Đến ngày",defaultValue:G})}),e.jsx(c,{span:7,children:e.jsx(ge,{placeholder:"Tất cả nhóm bán hàng",allowClear:!0,showSearch:!0,treeData:te,onChange:t=>{re(t)},dropdownStyle:{maxHeight:400,overflow:"auto",minWidth:350}})}),e.jsx(c,{span:7,children:e.jsx(u,{filterOption:!1,notFoundContent:null,allowClear:!0,showSearch:!0,placeholder:"Tất cả nhân viên",onSearch:t=>{ne(t)},options:K,onSelect:t=>{b(t)},onClear:()=>{b("")}})})]})}),e.jsx(c,{className:"!ml-4",children:e.jsx("div",{className:"flex flex-wrap items-center",children:e.jsxs("div",{className:"flex justify-center items-center mr-4",children:[e.jsx(Se,{className:"!h-8",placement:"bottomRight",trigger:["click"],dropdownRender:()=>e.jsxs(ke,{title:"Bộ lọc",children:[e.jsx("div",{className:"",children:e.jsxs(h,{layout:"vertical",form:g,onFinish:xe,children:[e.jsx(h.Item,{name:"customertype",label:"Loại khách hàng",className:"w-[468px] border-none",children:e.jsx(u,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:we,allowClear:!0,showSearch:!0,placeholder:"Tất cả loại khách hàng"})}),e.jsx(h.Item,{name:"customergroup",label:"Nhóm khách hàng",className:"w-[468px] border-none",children:e.jsx(u,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:X,allowClear:!0,onSearch:t=>{U(t)},showSearch:!0,placeholder:"Tất cả nhóm khách hàng"})}),e.jsx(h.Item,{label:"Phát sinh đơn hàng",name:"hasorder",className:"w-[468px] border-none",children:e.jsx(u,{placeholder:"Tất cả",className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:Fe,allowClear:!0,showSearch:!0})}),e.jsx(h.Item,{name:"territory",label:"Khu vực",className:"w-[468px] border-none",children:e.jsx(u,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:W,allowClear:!0,onSearch:t=>{ee(t)},showSearch:!0,placeholder:"Tất cẩ khu vực"})})]})}),e.jsxs(_,{className:"justify-between pt-6 pb-4",children:[e.jsx("div",{}),e.jsxs("div",{children:[e.jsx(x,{className:"mr-3",onClick:t=>{t.preventDefault(),g.resetFields()},children:"Đặt lại"}),e.jsx(x,{type:"primary",onClick:()=>{g.submit()},children:"Áp dụng"})]})]})]}),children:e.jsx(x,{onClick:t=>t.preventDefault(),className:"flex items-center text-nowrap !text-[13px] !leading-[21px] !font-normal  border-r-[0.1px] rounded-r-none h-8",icon:e.jsx(De,{style:{fontSize:"20px"}}),children:"Bộ lọc"})}),e.jsx(x,{className:"border-l-[0.1px] rounded-l-none !h-8",children:e.jsx(Te,{style:{fontSize:"20px"}})})]})})})]}),e.jsx("div",{ref:S,className:"pt-5",children:e.jsx(fe,{dataSource:a?.data?.map(t=>({...t,key:t.name})),bordered:!0,columns:Ee,scroll:{x:3e3,y:le<400?void 0:ie},pagination:d&&d>y?{pageSize:y,showSizeChanger:!1,total:d,current:j,onChange(t){H(t)}}:!1,summary:()=>e.jsxs(n.Summary.Row,{children:[e.jsx(n.Summary.Cell,{index:0}),e.jsx(n.Summary.Cell,{index:1,children:"Tổng"}),e.jsx(n.Summary.Cell,{index:2}),e.jsx(n.Summary.Cell,{index:3}),e.jsx(n.Summary.Cell,{index:4}),e.jsx(n.Summary.Cell,{index:5}),e.jsx(n.Summary.Cell,{index:6}),e.jsx(n.Summary.Cell,{index:7}),e.jsx(n.Summary.Cell,{index:8}),e.jsx(n.Summary.Cell,{index:9}),e.jsx(n.Summary.Cell,{index:10}),e.jsx(n.Summary.Cell,{index:11}),e.jsx(n.Summary.Cell,{index:12}),e.jsx(n.Summary.Cell,{index:13}),e.jsx(n.Summary.Cell,{index:14}),e.jsx(n.Summary.Cell,{index:15,children:e.jsx("div",{className:"text-right",children:a?.sum?.sum_checkin})}),e.jsx(n.Summary.Cell,{index:16}),e.jsx(n.Summary.Cell,{index:17}),e.jsx(n.Summary.Cell,{index:18,children:e.jsx("div",{className:"text-right",children:a?.sum?.sum_so})})]})})})]})})})}function $e(){return e.jsxs(e.Fragment,{children:[e.jsx(_e,{children:e.jsx("title",{children:" ReportCustomNew"})}),e.jsx(Me,{})]})}export{$e as default};
