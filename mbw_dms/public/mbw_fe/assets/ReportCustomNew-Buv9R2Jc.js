import{L as r,aS as le,a5 as c,P as e,U as y,V as j,Q as P,R as i,a7 as d,a6 as oe,W as m,a8 as ie,bv as n,Y as h,aa as ce}from"./index-nMpJkfAr.js";import{H as de}from"./header-page-Dvgp7BQs.js";import{D as me}from"./index-7190WY_6.js";import{C as ue}from"./index-QbEi99Nx.js";import{e as he,f as xe}from"./data-u-VkVTNg.js";import{u}from"./useDebount-OHjUyLRa.js";import{t as pe,a as ye}from"./index-zzQQ6mcq.js";import{a as je,b as ge}from"./index.esm-Fajz1EA9.js";import{D as V}from"./index-WRe0omc_.js";import{T as _e}from"./index-VfW5_j-2.js";import{V as Se}from"./VerticalAlignBottomOutlined-rDZ2wdnR.js";const G=h().startOf("month"),R=h().endOf("month");Date.parse(G.$d)/1e3;Date.parse(R.$d)/1e3;const fe=[{title:"STT",dataIndex:"stt",key:"stt",render:(a,s,x)=>e.jsx("div",{className:"text-center",children:x+1})},{title:"Phòng ban",dataIndex:"department",key:"department",render:(a,s)=>e.jsx("div",{children:s.department})},{title:"Mã nhân viên",dataIndex:"employee_id",key:"employee_id",render:(a,s)=>e.jsx("div",{children:s.employee_id})},{title:"Tên nhân viên",dataIndex:"employee_name",key:"employee_name",render:(a,s)=>e.jsx("div",{children:s.employee_name})},{title:"Mã khách hàng",dataIndex:"customer_code",key:"customer_code",render:(a,s)=>e.jsx("div",{children:s.customer_code})},{title:"Tên khách hàng",dataIndex:"customer_name",key:"customer_name",render:(a,s)=>e.jsx("div",{children:s.customer_name})},{title:"Loại khách hàng",dataIndex:"customer_type",key:"customer_type",render:(a,s)=>e.jsx("div",{children:s.customer_type})},{title:"Nhóm khách hàng",dataIndex:"customer_group",key:"customer_group",render:(a,s)=>e.jsx("div",{children:s.customer_group})},{title:"Người liên hệ",dataIndex:"contact",key:"contact",render:(a,s)=>e.jsx("div",{children:s.contact})},{title:"SDT",dataIndex:"phone",key:"phone",render:(a,s)=>e.jsx("div",{children:s.phone})},{title:"Mã số thuế",dataIndex:"tax_id",key:"tax_id",render:(a,s)=>e.jsx("div",{children:s.tax_id})},{title:"Khu vưc",dataIndex:"territory",key:"territory",render:(a,s)=>e.jsx("div",{children:s.territory})},{title:"Địa chỉ",dataIndex:"address",key:"address",render:(a,s)=>e.jsx("div",{children:s.contribution})},{title:"Ngày thu thập",dataIndex:"creation",key:"creation",render:(a,s)=>e.jsx("div",{children:h(s.creation*1e3).format("DD/MM/YYYY")})},{title:"Nguồn",dataIndex:"f1",key:"f1"},{title:e.jsx("div",{className:"!text-right",children:"Số lần VT"}),dataIndex:"totals_checkin",key:"totals_checkin",render:(a,s)=>e.jsx("div",{className:"!text-right",children:s.totals_checkin})},{title:"VT đầu",dataIndex:"first_checkin",key:"first_checkin",render:(a,s)=>e.jsx("div",{children:s.first_checkin})},{title:"VT cuối",dataIndex:"last_checkin",key:"last_checkin",render:(a,s)=>e.jsx("div",{children:s.last_checkin})},{title:e.jsx("div",{className:"!text-right",children:"Số đơn hàng"}),dataIndex:"totals_so",key:"totals_so",render:(a,s)=>e.jsx("div",{className:"!text-right",children:s.totals_so})},{title:"Đơn hàng cuối",dataIndex:"last_sale_order",key:"last_sale_order",render:a=>a?e.jsx("p",{children:h(a*1e3).format("DD/MM/YYYY")}):e.jsx(e.Fragment,{})}];function ke(){const[a,s]=r.useState([]),[x,O]=r.useState(0),g=20,[_,z]=r.useState(1),[p]=le(),[S,f]=r.useState(""),[K,B]=r.useState([]),[be,H]=r.useState([]),[k,Ce]=r.useState(""),[A,Ne]=r.useState(""),[b,C]=r.useState("");let N=u(A,500);const[v,F]=r.useState(""),[q,U]=r.useState([]),[W,ve]=r.useState("");let w=u(W,500);const[D,T]=r.useState(""),[X,$]=r.useState([]),[Q,Fe]=r.useState("");let I=u(Q,500);const[E,Y]=r.useState(),[Z,J]=r.useState([]),[M,ee]=r.useState(),[te,se]=r.useState("");let L=u(te);const re=t=>{console.log(t)},ae=t=>{console.log(t)},ne=t=>{t.customergroup?F(t.customergroup):F(""),t.customertype?C(t.customertype):C(""),t.territory,T(t.territory),t.hasorder?Y(t.hasorder):Y(void 0)};return r.useEffect(()=>{(async()=>{let t=await c.get("/api/method/mbw_dms.api.router.get_team_sale");J(pe({data:t.result.map(l=>({title:l.name,value:l.name,...l})),keyValue:"value",parentField:"parent_sales_person"}))})()},[]),r.useEffect(()=>{(async()=>{let t=await c.get("/api/method/mbw_dms.api.router.get_sale_person",{params:{team_sale:M,key_search:L}}),{message:l}=t;B(l.map(o=>({value:o.employee_name,label:o.employee_name||o.employee_code})))})()},[M,L]),r.useEffect(()=>{(async()=>{let t=await c.get("/api/method/frappe.desk.search.search_link",{params:{txt:N,doctype:"Department",ignore_user_permissions:0,query:""}}),{message:l}=t;H(l.map(o=>({value:o.value.trim(),label:o.value.trim()})))})()},[N]),r.useEffect(()=>{(async()=>{let t=await c.get("/api/method/frappe.desk.search.search_link",{params:{txt:w,doctype:"Customer Group",ignore_user_permissions:0,query:""}}),{message:l}=t;U(l.map(o=>({value:o.value.trim(),label:o.value.trim()})))})()},[w]),r.useEffect(()=>{(async()=>{let t=await c.get("/api/method/frappe.desk.search.search_link",{params:{txt:I,doctype:"Territory",ignore_user_permissions:0,query:""}}),{message:l}=t;$(l.map(o=>({value:o.value,label:o.value})))})()},[I]),r.useEffect(()=>{(async()=>{const t=await c.get("/api/method/mbw_dms.api.report.customer_report.customer_report",{params:{page_size:g,page_number:_,customer_type:b,customer_group:v,territory:D,employee:S,has_sales_order:E,department:k}});let{result:l}=t;console.log("result",l),s(l),O(l?.totals_cus)})()},[_,b,v,D,S,E,k]),e.jsx(e.Fragment,{children:e.jsx(ue,{header:e.jsx(de,{title:"Báo cáo khách hàng mới",buttons:[{label:"Xuất dữ liệu",type:"primary",icon:e.jsx(Se,{className:"text-xl"}),size:"20px",className:"flex items-center",action:()=>{ye("/app/data-export/Data%20Export")}}]}),children:e.jsxs("div",{className:"bg-white rounded-2xl pt-4 pb-7 border-[#DFE3E8] border-[0.2px] border-solid",children:[e.jsxs(y,{gutter:[16,16],className:"justify-between items-end w-full",children:[e.jsx(j,{children:e.jsx(y,{gutter:[8,8],children:e.jsx(j,{className:"mx-4 w-full",span:24,children:e.jsxs(P,{layout:"vertical",className:"flex flex-wrap justify-start items-center ",children:[e.jsx(i,{label:"Từ ngày",className:"w-[175px] border-none mr-2",children:e.jsx(V,{format:"DD-MM-YYYY",className:"!bg-[#F4F6F8] !h-7 rounded-lg mt-[-2px]",placeholder:"Từ ngày",onChange:re,defaultValue:G})}),e.jsx(i,{label:"Đến ngày",className:"w-[175px] border-none mr-2",children:e.jsx(V,{format:"DD-MM-YYYY",className:"!bg-[#F4F6F8] !h-7 rounded-lg mt-[-2px]",onChange:ae,placeholder:"Đến ngày",defaultValue:R})}),e.jsx(i,{label:"Nhóm bán hàng",className:"border-none mr-2 w-[200px]",children:e.jsx(_e,{placeholder:"Tất cả nhóm bán hàng",allowClear:!0,treeData:Z,onChange:t=>{ee(t)},dropdownStyle:{maxHeight:400,overflow:"auto",minWidth:400}})}),e.jsx(i,{label:"Nhân viên",className:"border-none mr-2 w-[200px]",name:"employee",children:e.jsx(d,{filterOption:!1,notFoundContent:null,allowClear:!0,placeholder:"Tất cả nhân viên",onSearch:t=>{se(t)},options:K,onSelect:t=>{f(t)},onClear:()=>{f("")}})})]})})})}),e.jsx(j,{className:"!ml-4",children:e.jsx("div",{className:"flex flex-wrap items-center",children:e.jsxs("div",{className:"flex justify-center items-center mr-4",children:[e.jsx(oe,{className:"!h-9",placement:"bottomRight",trigger:["click"],dropdownRender:()=>e.jsxs(me,{title:"Bộ lọc",children:[e.jsx("div",{className:"",children:e.jsxs(P,{layout:"vertical",form:p,onFinish:ne,children:[e.jsx(i,{name:"customertype",label:"Loại khách hàng",className:"w-[468px] border-none pt-2",children:e.jsx(d,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:he,allowClear:!0,placeholder:"Tất cả loại khách hàng"})}),e.jsx(i,{name:"customergroup",label:"Nhóm khách hàng",className:"w-[468px] border-none pt-2",children:e.jsx(d,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:q,allowClear:!0,placeholder:"Tất cả nhóm khách hàng"})}),e.jsx(i,{label:"Phát sinh đơn hàng",name:"hasorder",className:"w-[468px] border-none pt-2",children:e.jsx(d,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:xe,allowClear:!0,showSearch:!0})}),e.jsx(i,{name:"territory",label:"Khu vực",className:"w-[468px] border-none pt-2",children:e.jsx(d,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:X,allowClear:!0,placeholder:"Tất cẩ khu vực"})})]})}),e.jsxs(y,{className:"justify-between pt-6 pb-4",children:[e.jsx("div",{}),e.jsxs("div",{children:[e.jsx(m,{className:"mr-3",onClick:t=>{t.preventDefault(),p.resetFields()},children:"Đặt lại"}),e.jsx(m,{type:"primary",onClick:()=>{p.submit()},children:"Áp dụng"})]})]})]}),children:e.jsx(m,{onClick:t=>t.preventDefault(),className:"flex items-center text-nowrap !text-[13px] !leading-[21px] !font-normal  border-r-[0.1px] rounded-r-none h-9",icon:e.jsx(je,{style:{fontSize:"20px"}}),children:"Bộ lọc"})}),e.jsx(m,{className:"border-l-[0.1px] rounded-l-none !h-9",children:e.jsx(ge,{style:{fontSize:"20px"}})})]})})})]}),e.jsx("div",{className:"pt-5",children:e.jsx(ie,{dataSource:a?.data?.map(t=>({...t,key:t.name})),bordered:!0,columns:fe,pagination:{defaultPageSize:g,total:x,showSizeChanger:!1,onChange(t){z(t)}},scroll:{x:!0},summary:()=>e.jsxs(n.Summary.Row,{children:[e.jsx(n.Summary.Cell,{index:0}),e.jsx(n.Summary.Cell,{index:1,children:"Tổng"}),e.jsx(n.Summary.Cell,{index:2}),e.jsx(n.Summary.Cell,{index:3}),e.jsx(n.Summary.Cell,{index:4}),e.jsx(n.Summary.Cell,{index:5}),e.jsx(n.Summary.Cell,{index:6}),e.jsx(n.Summary.Cell,{index:7}),e.jsx(n.Summary.Cell,{index:8}),e.jsx(n.Summary.Cell,{index:9}),e.jsx(n.Summary.Cell,{index:10}),e.jsx(n.Summary.Cell,{index:11}),e.jsx(n.Summary.Cell,{index:12}),e.jsx(n.Summary.Cell,{index:13}),e.jsx(n.Summary.Cell,{index:14}),e.jsx(n.Summary.Cell,{index:15,children:e.jsx("div",{className:"text-right",children:a?.sum?.sum_checkin})}),e.jsx(n.Summary.Cell,{index:16}),e.jsx(n.Summary.Cell,{index:17}),e.jsx(n.Summary.Cell,{index:18,children:e.jsx("div",{className:"text-right",children:a?.sum?.sum_so})})]})})})]})})})}function Re(){return e.jsxs(e.Fragment,{children:[e.jsx(ce,{children:e.jsx("title",{children:" ReportCustomNew"})}),e.jsx(ke,{})]})}export{Re as default};
