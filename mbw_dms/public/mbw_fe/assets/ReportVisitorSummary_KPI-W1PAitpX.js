import{Y as s,a1 as M,L as e,ab as T,V as x,R as D,P as V,cq as C,ad as Y}from"./index-CEN6Mloe.js";import{u as z,C as H}from"./index-hFT6F5Gr.js";import{M as F}from"./ModalCheckin-mK7KaPbm.js";import{D as G}from"./Detailmodal-i4pxTk2-.js";import{a as $,u as S,P as b,R as A,F as B,m as Q}from"./ReportHeader-xwMv1xUu.js";import"./index-EDjyQfko.js";import"./VerticalAlignBottomOutlined-s50zueXj.js";function Z({employee:p,timeCheckin:u,checkin_note_id:l,from_date:v,to_date:_,time_slot:j}){const o=[{title:"STT",dataIndex:"stt",key:"stt",width:60,render:(a,i,h)=>h+1},{title:"Mã khách hàng",dataIndex:"kh_ma",key:"kh_ma"},{title:"Khách hàng",dataIndex:"kh_ten",key:"kh_ten"},{title:"Địa chỉ",dataIndex:"kh_diachi",key:"kh_diachi",render:a=>e.jsx("div",{className:"truncate hover:whitespace-normal",children:a})},{title:"Ngày viếng thăm",dataIndex:"checkin_giovao",key:"checkin_giovao",render:a=>e.jsx(e.Fragment,{children:e.jsx("div",{children:x(a).format("DD/MM/YYYY")})})},{title:"Thời gian checkin",dataIndex:"checkin_giovao",key:"checkin_giovao",render:a=>e.jsx(e.Fragment,{children:e.jsx("div",{children:x(a).format("HH:mm")})})},{title:e.jsx("div",{className:"text-center",children:"Ghi chú"}),dataIndex:"",key:"",render:a=>e.jsx("div",{className:"text-blue-600 underline underline-offset-4 text-center",onClick:()=>{f({open:!0,id:l})},children:"Xem chi tiết"})}],[r,w]=s.useState(1),d=20,[c,g]=s.useState(0),[k,y]=s.useState([]),[m,f]=s.useState({open:!1,id:null}),N=()=>{f({open:!1,id:null})};return s.useEffect(()=>{(async()=>{const a=await M.get("/api/method/mbw_dms.api.report.kpi.kpi_visit_detail",{params:{time_checkin:u,employee:p,page_size:d,page_number:r,from_date:v,to_date:_,time_slot:j}});let{result:i}=a;y(i),g(i?.totals)})()},[u,p,r,j]),e.jsxs(e.Fragment,{children:[e.jsx(T,{bordered:!0,$border:!0,dataSource:k?.data?.map(a=>({key:a.name,...a})),pagination:c&&c>d?{pageSize:d,showSizeChanger:!1,total:c,current:r,onChange(a){w(a)}}:!1,scroll:{y:300},columns:o}),e.jsx(F,{title:e.jsx("div",{className:"font-bold text-lg leading-7 text-[#212B36] p-4",children:"Ghi chú"}),open:m.open,onCancel:N,footer:!1,width:800,children:e.jsx(G,{id:m.id})})]})}function q(){const[p,u]=s.useState(!1),[l,v]=s.useState(0),[_,j]=s.useState([]),[o,r]=s.useState(1),w=$(`${Q}`),{startDate:d,endDate:c}=S(t=>t.date),{sales_team:g,employee:k,customer_type:y,customer_group:m,territory:f}=S(t=>t.group),{curentMonth:N,currentYear:a}=S(t=>t.month),[i,h]=s.useState({open:!1,id:null}),R=s.useRef(null),P=z(),E=()=>{h({open:!1,id:null})},K=[{title:e.jsx("div",{className:"",children:"STT"}),dataIndex:"stt",key:"stt",render:(t,n,I)=>I+1},{title:e.jsx("div",{children:"Nhóm bán hàng"}),dataIndex:"nhom_ban_hang",width:100,key:"nhom_ban_hang",render:(t,n,I)=>e.jsx("div",{className:"min-w-[100px]",children:t})},{title:e.jsx("div",{children:"Mã nhân viên"}),dataIndex:"employee_code",key:"employee_code",width:100,render:(t,n,I)=>e.jsx("div",{className:"min-w-[140px]",children:t})},{title:e.jsx("div",{children:"Tên nhân viên"}),dataIndex:"employee_name",width:100,key:"employee_name"},{title:e.jsx("div",{className:"text-center min-w-[80px]",children:"Ngày"}),dataIndex:"create_time",width:100,key:"create_time",render:t=>e.jsx("div",{children:t?x.unix(t).format("DD/MM/YYYY"):e.jsx("div",{className:"min-w-[40px] text-center",children:"-"})})},{title:e.jsx("div",{className:"text-center",children:"Checkin đầu ngày"}),dataIndex:"checkin_daungay",key:"checkin_daungay",width:100,render:t=>e.jsx("div",{className:"min-w-[120px] text-center",children:t?x(t).format("HH:mm"):e.jsx("div",{children:"-"})})},{title:e.jsx("div",{className:"text-center",children:"Checkin cuối ngày"}),dataIndex:"checkin_cuoingay",key:"checkin_cuoingay",width:100,render:t=>e.jsx("div",{className:"min-w-[120px] text-center",children:t?x(t).format("HH:mm"):e.jsx("div",{children:"-"})})},{title:e.jsx("div",{className:"text-center",children:"Khách hàng VT"}),dataIndex:"customers",key:"customers",width:100,render:t=>e.jsx("div",{className:"!text-center min-w-[120px] ",children:t?t.length:0})},{title:e.jsx("div",{className:"text-center",children:"Khách hàng VT sáng"}),dataIndex:"checkin_sang",key:"checkin_sang",width:100,render:(t,n)=>e.jsx("div",{className:"!text-center underline underline-offset-4 text-blue-600 min-w-[130px] ",onClick:()=>{h({open:!0,id:{checkin_note_id:n?.checkin_note_id,time:"sáng",timeCheckin:n?.create_time,employee:n?.employee_code,name_employee:n?.employee_name,...C({timestamp:n.create_time})}})},children:t||e.jsx("div",{className:"min-w-[40px]",children:"0"})})},{title:e.jsx("div",{className:"text-center",children:"Khách hàng VT chiều"}),dataIndex:"checkin_chieu",key:"checkin_chieu",width:100,render:(t,n)=>e.jsx("div",{className:"!text-center underline underline-offset-4 text-blue-600 min-w-[130px]",onClick:()=>{h({open:!0,id:{time:"chiều",checkin_note_id:n?.checkin_note_id,timeCheckin:n?.create_time,employee:n?.employee_code,name_employee:n?.employee_name,...C({timestamp:n.create_time})}})},children:t||e.jsx("div",{className:"min-w-[40px] underline-none ",children:"0"})})},{title:e.jsx("div",{className:"text-center",children:"Số km VT"}),dataIndex:"total_distance",key:"total_distance",width:100,render:t=>e.jsx("div",{className:"!text-center min-w-[100px]",children:t?t.toFixed(2):e.jsx("div",{className:"min-w-[40px]",children:"-"})})},{title:e.jsx("div",{className:"text-center",children:"Số đơn hàng"}),dataIndex:"total_donhang",key:"total_donhang",width:100,render:t=>e.jsx("div",{className:"!text-center min-w-[100px]",children:t||e.jsx("div",{className:"min-w-[40px]",children:"-"})})},{title:e.jsx("div",{className:"text-center",children:"Ảnh chụp"}),dataIndex:"total_anhchup",key:"total_anhchup",width:100,render:(t,n)=>e.jsx("div",{className:"!text-center min-w-[100px]",children:n&&n?.customers?n?.customers[0]?.total_image:e.jsx("div",{className:"min-w-[40px]",children:"-"})})},{title:e.jsx("div",{className:"text-center",children:"Doanh số"}),dataIndex:"total_doanhso",key:"total_doanhso",width:100,render:t=>e.jsx("div",{className:"!text-center min-w-[100px]",children:t?Intl.NumberFormat().format(t):e.jsx("div",{className:"min-w-[40px]",children:"-"})})},{title:e.jsx("div",{className:"text-center",children:"Doanh thu"}),dataIndex:"total_doanhthu",key:"total_doanhthu",width:100,render:t=>e.jsx("div",{className:"!text-center min-w-[100px]",children:t?Intl.NumberFormat().format(t):e.jsx("div",{className:"min-w-[40px]",children:"-"})})}];return s.useEffect(()=>{(async()=>{const t=await M.get("/api/method/mbw_dms.api.report.visitor_kpi.report_visitor_kpi",{params:{page_size:b,page_number:o,from_date:d,to_date:c,employee:k,sales_team:g,territory:f,customer_group:m,customer_type:y}});let{result:n}=t;j(n),v(n?.totals)})()},[o,d,c,p,g,k,m,y]),e.jsx(e.Fragment,{children:e.jsx(H,{header:e.jsx(A,{setRefresh:u,title:"Báo cáo tổng hợp Viếng thăm - KPI",params:{params:{report_type:"Report Visitor_KPI",data_filter:{month:N,year:a}}},file_name:"ReportVisitor_KPI.xlsx"}),children:e.jsxs("div",{className:"bg-white rounded-2xl pt-4 pb-7  border-[#DFE3E8] border-[0.2px] border-solid",children:[e.jsx(D,{gutter:[16,16],className:`flex ${w?"justify-end":"justify-between"} items-center w-full`,children:e.jsx(V,{className:"ml-4 w-[78%]",children:e.jsx(D,{gutter:[8,8],className:"space-x-4",children:e.jsx(B,{setPage:r,inputFromDate:!0,inputToDate:!0,inputSaleGroup:!0,inputEmployee:!0})})})}),e.jsx("div",{ref:R,className:"pt-5",children:e.jsx(T,{bordered:!0,$border:!0,dataSource:_?.data?.map(t=>({key:t.create_time.toString(),...t})),pagination:l&&l>b?{pageSize:b,showSizeChanger:!1,total:l,current:o,onChange(t){r(t)}}:!1,scroll:{x:!0,y:_?.data?.length>0?P?.h*.55:void 0},columns:K})}),e.jsx(F,{title:e.jsxs("div",{className:"font-semibold text-2xl leading-[22px] text-[#222222] px-4 pt-4",children:["Khách hàng viếng thăm ",i.id?.time]}),open:i.open,onCancel:E,footer:!1,width:1120,children:e.jsx(Z,{checkin_note_id:i.id?.checkin_note_id,employee:i.id?.employee,timeCheckin:i.id?.timeCheckin,from_date:i.id?.from_date,to_date:i.id?.to_date,time_slot:i.id?.time})})]})})})}function te(){return e.jsxs(e.Fragment,{children:[e.jsx(Y,{children:e.jsx("title",{children:" ReportVisitorSummary_KPI"})}),e.jsx(q,{})]})}export{te as default};
