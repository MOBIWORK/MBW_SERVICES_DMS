import{Y as a,a3 as i,L as e,O as o,a5 as c,a6 as me,bv as m,V as ie,a8 as ce}from"./index-hb_gRLpY.js";import{H as de}from"./header-page-IQsWRpkl.js";import{u as d}from"./useDebount-KGhcXOCM.js";import{a as ue}from"./index-tGTSx3zL.js";import{D as Y}from"./index-_K4KxRt6.js";import{V as pe}from"./VerticalAlignBottomOutlined-7ONHDdMT.js";const xe=[{title:"STT",dataIndex:"stt",key:"stt",render:(l,s,p)=>p+1},{title:"Đơn đặt",dataIndex:"name",key:"name",render:(l,s)=>e.jsx("div",{className:"!w-[175px]",children:e.jsx("a",{className:"text-[#212B36]",href:`app/sales-invoice/${s.name}`,target:"_blank",children:s.name})})},{title:"Khách hàng",dataIndex:"customer",key:"customer",render:(l,s)=>e.jsx("div",{className:"!w-[175px]",children:s.customer})},{title:"Khu vực",dataIndex:"territory",key:"territory",render:(l,s)=>e.jsx("div",{className:"!w-[175px]",children:s.territory})},{title:"Kho",dataIndex:"set_warehouse",key:"set_warehouse",render:(l,s)=>e.jsx("div",{className:"!w-[175px]",children:s.set_warehouse})},{title:"Ngày tạo",dataIndex:"posting_date",key:"posting_date",render:(l,s)=>e.jsx("div",{className:"!w-[175px]",children:ie(s.posting_date*1e3).format("DD/MM/YYYY")})},{title:"Nhân viên",dataIndex:"employee",key:"employee",render:(l,s)=>e.jsx("div",{className:"!w-[150px]",children:s.employee})},{title:"Thành tiền",dataIndex:"total",key:"total",render:(l,s)=>e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mr-2",children:"VND"}),Intl.NumberFormat().format(s.total)]})},{title:"Tiền VAT",dataIndex:"tax_amount",key:"tax_amount",render:(l,s)=>e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mr-2",children:"VND"}),Intl.NumberFormat().format(s.tax_amount)]})},{title:"Chiết khấu",dataIndex:"discount_amount",key:"discount_amount",render:(l,s)=>e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mr-2",children:"VND"}),Intl.NumberFormat().format(s.discount_amount)]})},{title:"Tổng tiền",dataIndex:"grand_total",key:"grand_total",render:(l,s)=>e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mr-2",children:"VND"}),Intl.NumberFormat().format(s.grand_total)]})}];function he(){const[l,s]=a.useState([]),[p,K]=a.useState(0),h=20,[y,O]=a.useState(1),[q,W]=a.useState([]),[g,j]=a.useState(""),[M,R]=a.useState(""),[_,N]=a.useState(""),[L,P]=a.useState([]),[z,A]=a.useState(""),[f,b]=a.useState(""),[B,H]=a.useState([]),[$,G]=a.useState(""),[S,F]=a.useState(),[k,C]=a.useState(),[w,v]=a.useState(""),[U,X]=a.useState([]),[Z,J]=a.useState(""),[I,T]=a.useState(""),[Q,ee]=a.useState([]),[te,ae]=a.useState("");let D=d(M,500),x=d(z,500),E=d($,500),V=d(Z,500),se=d(te,500);const re=t=>{const n=[{title:"STT",dataIndex:"stt",key:"stt",render:(r,u,oe)=>oe+1},{title:"Mã sản phẩm",dataIndex:"item_code",key:"item_code"},{title:"Tên sản phẩm",dataIndex:"item_name",key:"item_name"},{title:"Nhóm sản phẩm",dataIndex:"item_group",key:"item_group"},{title:"Nhãn hàng",dataIndex:"brand",key:"brand"},{title:"Đơn giá",dataIndex:"rate",key:"rate"},{title:"Số lượng",dataIndex:"qty",key:"qty"},{title:"Chiết khấu (%)",dataIndex:"discount_percentage",key:"discount_percentage"},{title:"Tiền chiết khấu",dataIndex:"discount_amount",key:"discount_amount",render:(r,u)=>e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mr-2",children:"VND"}),Intl.NumberFormat().format(u.discount_amount)]})},{title:"Tổng tiền",dataIndex:"amount",key:"amount",render:(r,u)=>e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mr-2",children:"VND"}),Intl.NumberFormat().format(u.amount)]})}];return e.jsx(m,{columns:n,dataSource:t.items.map(r=>({...r,key:r.item_code})),pagination:!1})};a.useEffect(()=>{(async()=>{let t=await i.get("/api/method/frappe.desk.search.search_link",{params:{txt:D,doctype:"Company",ignore_user_permissions:0,query:""}}),{message:n}=t;W(n.map(r=>({value:r.value,label:r.value})))})()},[D]),a.useEffect(()=>{(async()=>{let t=await i.get("/api/method/frappe.desk.search.search_link",{params:{txt:E,doctype:"Customer",ignore_user_permissions:0,query:""}}),{message:n}=t;H(n.map(r=>({value:r.value,label:r.value})))})()},[E]),a.useEffect(()=>{(async()=>{let t=await i.get("/api/method/frappe.desk.search.search_link",{params:{txt:V,doctype:"Warehouse",ignore_user_permissions:0,query:""}}),{message:n}=t;X(n.map(r=>({value:r.value,label:r.value})))})()},[V]),a.useEffect(()=>{(async()=>{let t=await i.get("/api/method/frappe.desk.search.search_link",{params:{txt:x,doctype:"Territory",ignore_user_permissions:0,query:""}}),{message:n}=t;P(n.map(r=>({value:r.value,label:r.value})))})()},[x]),a.useEffect(()=>{(async()=>{let t=await i.get("/api/method/frappe.desk.search.search_link",{params:{txt:x,doctype:"Employee",ignore_user_permissions:0,query:"mbw_dms.api.report.so_report.employee_query"}}),{message:n}=t;console.log("rsEmployee",n),ee(n.map(r=>({value:r.description.split(",")[1].trim(),label:r.description.split(",")[0].trim()})))})()},[se]),a.useEffect(()=>{(async()=>{const t=await i.get("/api/method/mbw_dms.api.report.so_report.si_report",{params:{page_size:h,page_number:y,company:g,territory:_,customer:f,from_date:S,to_date:k,warehouse:w,employee:I}});let{result:n}=t;s(n),K(n?.totals)})()},[y,g,_,f,S,k,w,I]);const ne=t=>{if(t==null)F("");else{let n=Date.parse(t.$d)/1e3;F(n)}},le=t=>{if(t==null)C("");else{let n=Date.parse(t.$d)/1e3;C(n)}};return e.jsxs(e.Fragment,{children:[e.jsx(de,{title:"Báo cáo tổng hợp đặt hàng",buttons:[{label:"Xuất dữ liệu",type:"primary",icon:e.jsx(pe,{className:"text-xl"}),size:"20px",className:"flex items-center",action:()=>{ue("/app/data-export/Data%20Export")}}]}),e.jsxs("div",{className:"bg-white rounded-md py-7 px-4 border-[#DFE3E8] border-[0.2px] border-solid",children:[e.jsxs("div",{className:"flex justify-start items-center",children:[e.jsx(o,{className:"w-[200px] border-none mr-2",label:"Công ty"}),e.jsx(o,{className:"w-[200px] border-none mr-2",label:"Khách hàng"}),e.jsx(o,{className:"w-[200px] border-none mr-2",label:"Khu vực"}),e.jsx(o,{className:"w-[200px] border-none mr-2",label:"Từ ngày"}),e.jsx(o,{className:"w-[200px] border-none mr-2",label:"Đến ngày"})]}),e.jsxs("div",{className:"flex justify-start items-center",children:[e.jsx(o,{className:"w-[200px] border-none mr-2",children:e.jsx(c,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:q,onSelect:t=>{j(t)},onSearch:t=>{R(t)},onClear:()=>j(""),filterOption:!1,allowClear:!0,placeholder:"Tất cả công ty"})}),e.jsx(o,{className:"w-[200px] border-none mr-2",children:e.jsx(c,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:B,onSelect:t=>{b(t)},onSearch:t=>{G(t)},onClear:()=>b(""),filterOption:!1,allowClear:!0,placeholder:"Tất cả khách hàng"})}),e.jsx(o,{className:"w-[200px] border-none mr-2",children:e.jsx(c,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",defaultValue:"",options:L,onSelect:t=>{N(t)},onSearch:t=>{A(t)},onClear:()=>N(""),filterOption:!1,allowClear:!0,placeholder:"Tất cẩ khu vực"})}),e.jsx(o,{className:"w-[200px] border-none mr-2",children:e.jsx(Y,{format:"DD-MM-YYYY",className:"!bg-[#F4F6F8]",placeholder:"Từ ngày",onChange:ne})}),e.jsx(o,{className:"w-[200px] border-none mr-2",children:e.jsx(Y,{format:"DD-MM-YYYY",className:"!bg-[#F4F6F8]",onChange:le,placeholder:"Đến ngày"})})]}),e.jsxs("div",{className:"flex justify-start items-center pt-2",children:[e.jsx(o,{className:"w-[200px] border-none mr-2",label:"Kho"}),e.jsx(o,{className:"w-[200px] border-none mr-2",label:"Nhân viên"})]}),e.jsxs("div",{className:"flex justify-start items-center h-8 mt-2 pb-5",children:[e.jsx(o,{className:"w-[200px] border-none mr-2",children:e.jsx(c,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:U,onSelect:t=>{v(t)},onSearch:t=>{J(t)},onClear:()=>v(""),filterOption:!1,allowClear:!0,placeholder:"Tất cả kho"})}),e.jsx(o,{className:"w-[200px] border-none mr-2",children:e.jsx(c,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:Q,onSelect:t=>{T(t)},onSearch:t=>{ae(t)},onClear:()=>T(""),filterOption:!1,allowClear:!0,placeholder:"Tất cả nhân viên"})})]}),e.jsx("div",{className:"pt-5",children:e.jsx(me,{dataSource:l?.data?.map(t=>({...t,key:t.name})),expandable:{expandedRowRender:re,defaultExpandedRowKeys:["0"]},bordered:!0,columns:xe,scroll:{x:!0},pagination:{defaultPageSize:h,total:p,showSizeChanger:!1,onChange(t){O(t)}},summary:()=>(console.log("sale",l),e.jsxs(m.Summary.Row,{children:[e.jsx(m.Summary.Cell,{index:0}),e.jsx(m.Summary.Cell,{index:1,children:"Tổng"}),e.jsx(m.Summary.Cell,{index:2}),e.jsx(m.Summary.Cell,{index:3}),e.jsx(m.Summary.Cell,{index:4}),e.jsx(m.Summary.Cell,{index:5}),e.jsx(m.Summary.Cell,{index:6}),e.jsx(m.Summary.Cell,{index:7}),e.jsxs(m.Summary.Cell,{index:8,children:[e.jsx("span",{className:"mr-2",children:"VND"}),Intl.NumberFormat().format(l?.sum?.sum_total)]}),e.jsxs(m.Summary.Cell,{index:9,children:[e.jsx("span",{className:"mr-2",children:"VND"}),Intl.NumberFormat().format(l?.sum?.sum_vat)]}),e.jsxs(m.Summary.Cell,{index:10,children:[e.jsx("span",{className:"mr-2",children:"VND"}),Intl.NumberFormat().format(l?.sum?.sum_discount_amount)]}),e.jsxs(m.Summary.Cell,{index:11,children:[e.jsx("span",{className:"mr-2",children:"VND"}),Intl.NumberFormat().format(l?.sum?.sum_grand_total)]})]}))})})]})]})}function be(){return e.jsxs(e.Fragment,{children:[e.jsx(ce,{children:e.jsx("title",{children:" ReportSales"})}),e.jsx(he,{})]})}export{be as default};
