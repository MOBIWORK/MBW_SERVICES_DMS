import{Y as r,aS as ce,a3 as i,L as e,R as y,P as g,N as P,O as l,a5 as m,a4 as me,Q as d,a6 as de,V as z,aR as K,a8 as pe}from"./index-3DFh7Nef.js";import{H as he}from"./header-page-8MCBYvke.js";import{D as ue}from"./index-HNKpXLK0.js";import{C as xe}from"./index-GcYRjbdc.js";import{u as c}from"./useDebount-CNVqMEwV.js";import{t as ye,a as ge}from"./index-_89DXT5f.js";import{a as fe,b as _e}from"./index.esm-MaP8vEVf.js";import{e as je}from"./data-u-VkVTNg.js";import{D as O}from"./index-WIcwIoO4.js";import{T as ke}from"./index-pwzslDWY.js";import{V as be}from"./VerticalAlignBottomOutlined-Ta1qYFvF.js";const p=z().startOf("month"),h=z().endOf("month");let ve=Date.parse(p.$d)/1e3,Se=Date.parse(h.$d)/1e3;const Fe=[{title:"STT",dataIndex:"stt",key:"stt",render:(n,s,u)=>e.jsx("div",{className:"text-center",children:u+1})},{title:"Phòng/nhóm",dataIndex:"department",key:"department",render:(n,s)=>e.jsx("div",{children:s.department})},{title:"Mã nhân viên",dataIndex:"employee_id",key:"employee_id",render:(n,s)=>e.jsx("div",{children:s.employee_id})},{title:"Tên nhân viên",dataIndex:"employee_name",key:"employee_name",render:(n,s)=>e.jsx("div",{children:s.employee_name})},{title:"Mã khách hàng",dataIndex:"customer_code",key:"customer_code",render:(n,s)=>e.jsx("div",{children:s.customer_code})},{title:"Tên khách hàng",dataIndex:"customer_name",key:"customer_name",render:(n,s)=>e.jsx("div",{children:s.customer_name})},{title:"Loại khách hàng",dataIndex:"customer_type",key:"customer_type",render:(n,s)=>e.jsx("div",{children:s.customer_type})},{title:"Nhóm khách hàng",dataIndex:"customer_group",key:"customer_group",render:(n,s)=>e.jsx("div",{children:s.customer_group})},{title:"Người liên hệ",dataIndex:"contact_person",key:"contact_person",render:(n,s)=>e.jsx("div",{children:s.contact_person})},{title:"SDT",dataIndex:"phone",key:"phone",render:(n,s)=>e.jsx("div",{children:s.phone})},{title:"Mã số thuế",dataIndex:"tax_id",key:"tax_id",render:(n,s)=>e.jsx("div",{children:s.tax_id})},{title:"Khu vực",dataIndex:"territory",key:"territory",render:(n,s)=>e.jsx("div",{children:s.territory})},{title:"Địa chỉ",dataIndex:"address",key:"address",render:(n,s)=>e.jsx("div",{className:"!w-[175px] truncate hover:whitespace-normal",children:s.address})},{title:"Ngày viếng thăm",dataIndex:"date_checkin",key:"date_checkin",render:(n,s)=>e.jsx("div",{children:s.date_checkin?.split("-")?.reverse()?.toString()?.replaceAll(",","-")})}];function we(){const[n,s]=r.useState([]),[u,A]=r.useState(0),f=20,[x]=ce(),[_,B]=r.useState(1),[Ne,V]=r.useState([]),[j,De]=r.useState(""),[H,Ce]=r.useState("");let k=c(H,500);const[b,v]=r.useState(""),[$,q]=r.useState([]),[X,Te]=r.useState("");c(X,500);const[S,F]=r.useState(""),[Q,U]=r.useState([]),[W,Ee]=r.useState("");let w=c(W,500);const[N,D]=r.useState(""),[C,T]=r.useState(""),[Z,J]=r.useState([]),[ee,Ie]=r.useState("");let E=c(ee,500);const[I,L]=r.useState(ve),[R,G]=r.useState(Se),[te,se]=r.useState([]),[M,re]=r.useState(),[ae,ne]=r.useState("");let Y=c(ae);const oe=t=>{if(t==null)L("");else if(h&&t&&t.isAfter(h,"day"))K.error("Từ ngày phải nhỏ hơn hoặc bằng Đến ngày");else{let a=Date.parse(t.$d)/1e3;L(a)}},le=t=>{if(t==null)G("");else if(p&&t&&t.isBefore(p,"day"))K.error("Đến ngày phải lớn hơn hoặc bằng Từ ngày");else{let a=Date.parse(t.$d)/1e3;G(a)}};r.useEffect(()=>{(async()=>{let t=await i.get("/api/method/frappe.desk.search.search_link",{params:{txt:k,doctype:"Department",ignore_user_permissions:0,query:""}}),{message:a}=t;console.log("Customer Group",a),V(a.map(o=>({value:o.value.trim(),label:o.value.trim()})))})()},[k]),r.useEffect(()=>{(async()=>{let t=await i.get("/api/method/mbw_dms.api.router.get_team_sale");se(ye({data:t.result.map(a=>({title:a.name,value:a.name,...a})),keyValue:"value",parentField:"parent_sales_person"}))})()},[]),r.useEffect(()=>{(async()=>{let t=await i.get("/api/method/mbw_dms.api.router.get_sale_person",{params:{team_sale:M,key_search:Y}}),{message:a}=t;q(a.map(o=>({value:o.employee_code,label:o.employee_name||o.employee_code})))})()},[M,Y]),r.useEffect(()=>{(async()=>{let t=await i.get("/api/method/frappe.desk.search.search_link",{params:{txt:w,doctype:"Customer Group",ignore_user_permissions:0,query:""}}),{message:a}=t;U(a.map(o=>({value:o.value.trim(),label:o.value.trim()})))})()},[w]),r.useEffect(()=>{(async()=>{let t=await i.get("/api/method/frappe.desk.search.search_link",{params:{txt:E,doctype:"Territory",ignore_user_permissions:0,query:""}}),{message:a}=t;J(a.map(o=>({value:o.value,label:o.value})))})()},[E]),r.useEffect(()=>{(async()=>{const t=await i.get("/api/method/mbw_dms.api.report.first_checkin_rp.first_checkin_report",{params:{page_size:f,page_number:_,department:j,employee:b,customer_group:S,customer_type:N,territory:C,from_date:I,to_date:R}});let{result:a}=t;console.log("dt",a),s(a),A(a?.totals)})()},[_,j,b,S,N,C,I,R]);const ie=t=>{t.customergroup?F(t.customergroup):F(""),t.customertype?D(t.customertype):D(""),t.territory?T(t.territory):T("")};return e.jsx(e.Fragment,{children:e.jsx(xe,{header:e.jsx(he,{title:"Báo cáo thống kê khách hàng viếng thăm lần đầu",buttons:[{label:"Xuất dữ liệu",type:"primary",icon:e.jsx(be,{className:"text-xl"}),size:"20px",className:"flex items-center",action:()=>{ge("/app/data-export/Data%20Export")}}]}),children:e.jsxs("div",{className:"bg-white rounded-2xl pt-4 pb-7 border-[#DFE3E8] border-[0.2px] border-solid",children:[e.jsxs(y,{gutter:[16,16],className:"justify-between items-end w-full",children:[e.jsx(g,{children:e.jsx(y,{gutter:[8,8],children:e.jsx(g,{className:"mx-4 w-full",span:24,children:e.jsxs(P,{layout:"vertical",className:"flex flex-wrap justify-start items-center ",children:[e.jsx(l,{label:"Từ ngày",className:"w-[175px] border-none mr-2",children:e.jsx(O,{format:"DD-MM-YYYY",className:"!bg-[#F4F6F8] !h-7 rounded-lg mt-[-2px]",placeholder:"Từ ngày",onChange:oe,defaultValue:p})}),e.jsx(l,{label:"Đến ngày",className:"w-[175px] border-none mr-2",children:e.jsx(O,{format:"DD-MM-YYYY",className:"!bg-[#F4F6F8] !h-7 rounded-lg mt-[-2px]",onChange:le,placeholder:"Đến ngày",defaultValue:h})}),e.jsx(l,{label:"Nhóm bán hàng",className:"border-none mr-2 w-[200px]",children:e.jsx(ke,{placeholder:"Tất cả nhóm bán hàng",allowClear:!0,treeData:te,onChange:t=>{re(t)},dropdownStyle:{maxHeight:400,overflow:"auto",minWidth:400}})}),e.jsx(l,{label:"Nhân viên",className:"border-none mr-2 w-[200px]",name:"employee",children:e.jsx(m,{filterOption:!1,notFoundContent:null,allowClear:!0,placeholder:"Tất cả nhân viên",onSearch:t=>{ne(t)},options:$,onSelect:t=>{v(t)},onClear:()=>{v("")}})})]})})})}),e.jsx(g,{className:"!ml-4",children:e.jsx("div",{className:"flex flex-wrap items-center",children:e.jsxs("div",{className:"flex justify-center items-center mr-4",children:[e.jsx(me,{className:"!h-9",placement:"bottomRight",trigger:["click"],dropdownRender:()=>e.jsxs(ue,{title:"Bộ lọc",children:[e.jsx("div",{className:"",children:e.jsxs(P,{layout:"vertical",form:x,onFinish:ie,children:[e.jsx(l,{name:"customertype",label:"Loại khách hàng",className:"w-[468px] border-none pt-2",children:e.jsx(m,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:je,allowClear:!0,placeholder:"Tất cả loại khách hàng"})}),e.jsx(l,{name:"customergroup",label:"Nhóm khách hàng",className:"w-[468px] border-none pt-2",children:e.jsx(m,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:Q,allowClear:!0,placeholder:"Tất cả nhóm khách hàng"})}),e.jsx(l,{name:"territory",label:"Khu vực",className:"w-[468px] border-none pt-2",children:e.jsx(m,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:Z,allowClear:!0,placeholder:"Tất cẩ khu vực"})})]})}),e.jsxs(y,{className:"justify-between pt-6 pb-4",children:[e.jsx("div",{}),e.jsxs("div",{children:[e.jsx(d,{className:"mr-3",onClick:t=>{t.preventDefault(),x.resetFields()},children:"Đặt lại"}),e.jsx(d,{type:"primary",onClick:()=>{x.submit()},children:"Áp dụng"})]})]})]}),children:e.jsx(d,{onClick:t=>t.preventDefault(),className:"flex items-center text-nowrap !text-[13px] !leading-[21px] !font-normal  border-r-[0.1px] rounded-r-none h-9",icon:e.jsx(fe,{style:{fontSize:"20px"}}),children:"Bộ lọc"})}),e.jsx(d,{className:"border-l-[0.1px] rounded-l-none !h-9",children:e.jsx(_e,{style:{fontSize:"20px"}})})]})})})]}),e.jsx("div",{className:"pt-5",children:e.jsx(de,{dataSource:n?.data?.map(t=>({...t,key:t.name})),bordered:!0,pagination:{defaultPageSize:f,total:u,showSizeChanger:!1,onChange(t){B(t)}},columns:Fe,scroll:{x:!0}})})]})})})}function Ve(){return e.jsxs(e.Fragment,{children:[e.jsx(pe,{children:e.jsx("title",{children:" ReportCheckinFirst"})}),e.jsx(we,{})]})}export{Ve as default};
