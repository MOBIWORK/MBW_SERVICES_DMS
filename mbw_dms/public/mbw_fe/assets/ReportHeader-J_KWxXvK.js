import{Y as a,ct as N,cu as cs,cv as oe,V as f,L as s,P as _,a2 as y,cw as B,a1 as g,a6 as Se,aa as be,cx as Y,cy as K,cz as D,cA as j,cB as C,aZ as Z,cC as V,cD as H,cE as q,a_ as is,a9 as us,N as x,R as hs,Q,cF as ce,cG as ie,cH as ue,cI as he,cJ as pe,cK as me,cL as de,a7 as ps,bD as ms}from"./index-vy5BPyrJ.js";import{D as E}from"./index-IVGfch3i.js";import{D as ds,S as fs}from"./index-TJiD9Wrl.js";import{a as xs}from"./index.esm-VAOYD8Cq.js";import{e as ys,f as gs}from"./data-u-VkVTNg.js";import{V as ws}from"./VerticalAlignBottomOutlined-9gnVWgoh.js";function Fe(){var t=a.useContext(N);return t}function _e(t){t===void 0&&(t=N);var r=t===N?Fe:function(){return a.useContext(t)};return function(){var l=r(),u=l.store;return u}}var Ss=_e();function bs(t){t===void 0&&(t=N);var r=t===N?Ss:_e(t);return function(){var l=r();return l.dispatch}}var b=bs(),Fs=function(r,i){return r===i};function _s(t,r,i,l){var u=a.useReducer(function(F){return F+1},0),d=u[1],n=a.useMemo(function(){return cs(i,l)},[i,l]),o=a.useRef(),h=a.useRef(),w=a.useRef(),S=a.useRef(),k=i.getState(),v;try{if(t!==h.current||k!==w.current||o.current){var $=t(k);S.current===void 0||!r($,S.current)?v=$:v=S.current}else v=S.current}catch(F){throw o.current&&(F.message+=`
The error may be correlated with this previous error:
`+o.current.stack+`

`),F}return oe(function(){h.current=t,w.current=k,S.current=v,o.current=void 0}),oe(function(){function F(){try{var T=i.getState();if(T===w.current)return;var I=h.current(T);if(r(I,S.current))return;S.current=I,w.current=T}catch(R){o.current=R}d()}return n.onStateChange=F,n.trySubscribe(),F(),function(){return n.tryUnsubscribe()}},[i,n]),v}function js(t){t===void 0&&(t=N);var r=t===N?Fe:function(){return a.useContext(t)};return function(l,u){u===void 0&&(u=Fs);var d=r(),n=d.store,o=d.subscription,h=_s(l,u,n,o);return a.useDebugValue(h),h}}var O=js();const W="(max-width: 1062px)",Ws="(min-width: 1200px)",je=[{label:"Tháng 1",value:"1"},{label:"Tháng 2",value:"2"},{label:"Tháng 3",value:"3"},{label:"Tháng 4",value:"4"},{label:"Tháng 5",value:"5"},{label:"Tháng 6",value:"6"},{label:"Tháng 7",value:"7"},{label:"Tháng 8",value:"8"},{label:"Tháng 9",value:"9"},{label:"Tháng 10",value:"10"},{label:"Tháng 11",value:"11"},{label:"Tháng 12",value:"12"}],As=20,A=t=>{const[r,i]=a.useState(!1);return a.useEffect(()=>{const l=window.matchMedia(t);l.matches!==r&&i(l.matches);const u=()=>i(l.matches);return window.addEventListener("resize",u),()=>window.removeEventListener("resize",u)},[r,t]),r},Cs=(f().month()+1).toString(),vs=({setPage:t})=>{const r=b(),i=A(`${W}`);return s.jsxs(_,{className:`min-w-[130px] ${i?"w-full":" w-[20%]"}`,children:[s.jsx("label",{className:"text-xs font-normal leading-[21px] pl-1 ",children:"Tháng"}),s.jsx(y,{className:"!bg-[#F4F6F8] ",defaultValue:Cs,options:je,onChange:l=>{r(B(l)),t&&t(1)}})]})},Ds=()=>{const t=b(),[r,i]=a.useState([]);return a.useEffect(()=>{(async()=>{let l=await g.get("/api/method/mbw_dms.api.router.get_team_sale");i(Se({data:l.result.map(u=>({title:u.name,value:u.name,...u})),keyValue:"value",parentField:"parent_sales_person"}))})()},[]),s.jsxs(_,{className:"min-w-[130px]  w-[20%]",children:[s.jsx("label",{className:"text-xs font-normal leading-[21px] pl-1 ",children:"Nhóm bán hàng"}),s.jsx(be,{placeholder:"Tất cả nhóm bán hàng",allowClear:!0,showSearch:!0,treeData:r,onChange:l=>{t(Y(l))},dropdownStyle:{maxHeight:400,overflow:"auto",minWidth:350}})]})},Ns=()=>{const t=b(),r=l=>{t(K(l?.$y.toString()))},i=A(`${W}`);return s.jsxs(_,{className:`min-w-[130px] ${i?"w-full":" w-[20%]"}`,children:[s.jsx("label",{className:"text-xs font-normal leading-[21px] pl-1 ",children:"Năm"}),s.jsx(E,{className:"!bg-[#F4F6F8] w-full rounded-lg h-7",onChange:r,placeholder:"Chọn năm",picker:"year",allowClear:!1,defaultValue:f().startOf("year")})]})},ks=({setPage:t,matchMedia:r})=>{const[i,l]=a.useState([]),[u,d]=a.useState(""),n=b(),{sales_team:o}=O(h=>h.group);return a.useEffect(()=>{(async()=>{let h=await g.get("/api/method/mbw_dms.api.router.get_sale_person",{params:{team_sale:o,key_search:u}}),{message:w}=h;l(w.map(S=>({value:S.employee_code,label:S.employee_name||S.employee_code})))})()},[u,o]),s.jsxs(_,{className:`min-w-[130px] ${r?"w-full":"w-[20%]"}`,children:[s.jsx("label",{className:"text-xs font-normal leading-[21px] pl-1 ",children:"Nhân viên"}),s.jsx(y,{filterOption:!0,allowClear:!0,showSearch:!0,placeholder:"Tất cả nhân viên",onSearch:h=>{d(h)},options:i,onSelect:h=>{n(D(h)),t(1)},onClear:()=>{n(D(""))}})]})},fe=f().startOf("month"),Ts=()=>{const t=b(),{startDate:r,endDate:i}=O(n=>n.date),l=A(`${W}`),u=f(r*1e3);a.useEffect(()=>{t(j(Date.parse(fe.$d)/1e3))},[]);const d=n=>{if(n==null)t(j(n));else{let o=Date.parse(n.$d)/1e3;t(j(o))}};return s.jsxs(_,{className:`min-w-[130px]  ${l?"w-full":" w-[20%]"}`,children:[s.jsx("label",{className:"text-xs font-normal leading-[21px] pl-1 ",children:"Từ ngày"}),s.jsx(E,{format:"DD-MM-YYYY",className:"!bg-[#F4F6F8] w-full rounded-lg h-7",placeholder:"Từ ngày",onChange:d,value:u,defaultValue:fe,allowClear:!1})]})},xe=f().endOf("month"),Es=()=>{const t=b(),{startDate:r,endDate:i}=O(o=>o.date);a.useEffect(()=>{t(C(Date.parse(xe.$d)/1e3))},[]);const l=o=>{if(r){const h=f.unix(r).month();return o&&o.month()!==h}},u=o=>{if(o==null)t(C(o));else if(r&&o&&o.isBefore(f.unix(r),"day"))Z.error("Đến ngày phải lớn hơn hoặc bằng Từ ngày");else{let h=Date.parse(o.$d)/1e3;t(C(h))}},d=A(`${W}`),n=f(i*1e3);return s.jsxs(_,{className:`min-w-[130px] ${d?"w-full":" w-[20%]"}`,children:[s.jsx("label",{className:"text-xs font-normal leading-[21px] pl-1 ",children:"Đến ngày"}),s.jsx(E,{format:"DD-MM-YYYY",className:"!bg-[#F4F6F8] w-full rounded-lg h-7",onChange:u,placeholder:"Đến ngày",defaultValue:xe,disabledDate:l,value:n,allowClear:!1})]})},$s=({setPage:t})=>{const[r,i]=a.useState([]),[l,u]=a.useState(""),d=b();return a.useEffect(()=>{(async()=>{let n=await g.get("/api/method/frappe.desk.search.search_link",{params:{txt:l,doctype:"Supplier",ignore_user_permissions:0,query:""}}),{message:o}=n;i(o.map(h=>({value:h?.value,label:h.description.split(",")[0].trim()})))})()},[l]),s.jsxs(_,{className:"min-w-[130px] w-[20%]",children:[s.jsx("label",{className:"text-xs font-normal leading-[21px] pl-1 ",children:"Nhà Cung cấp"}),s.jsx(y,{filterOption:!1,allowClear:!0,showSearch:!0,placeholder:"Tất cả nhà cung cấp",onSearch:n=>{u&&u(n)},options:r,onSelect:n=>{d(V(n)),t(1)},onClear:()=>{d(V(""))}})]})},Is=({setPage:t,matchMedia:r})=>{const[i,l]=a.useState([]),[u,d]=a.useState(""),n=b();return a.useEffect(()=>{(async()=>{let o=await g.get("/api/method/frappe.desk.search.search_link",{params:{txt:u,doctype:"Brand",ignore_user_permissions:0,query:""}}),{message:h}=o;l(h.map(w=>({value:w?.value,description:w?.description})))})()},[u]),s.jsxs(_,{className:`min-w-[130px] ${r?"w-full":"w-[20%]"}`,children:[s.jsx("label",{className:"text-xs font-normal leading-[21px] pl-1 ",children:"Nhãn hiệu"}),s.jsx(y,{filterOption:!1,allowClear:!0,showSearch:!0,placeholder:"Tất cả nhãn hiệu",onSearch:o=>{d(o)},options:i,onSelect:o=>{n(H(o)),t(1)},onClear:()=>{n(H(""))}})]})},Ms=({setPage:t})=>{const[r,i]=a.useState([]),[l,u]=a.useState(""),d=b();return a.useEffect(()=>{(async()=>{let n=await g.get("/api/method/frappe.desk.search.search_link",{params:{txt:l,doctype:"DMS Industry",ignore_user_permissions:0,query:""}}),{message:o}=n;i(o.map(h=>({value:h?.value,description:h?.description})))})()},[l]),s.jsxs(_,{className:"min-w-[130px] w-[20%]",children:[s.jsx("label",{className:"text-xs font-normal leading-[21px] pl-1 ",children:"Ngành hàng"}),s.jsx(y,{filterOption:!1,allowClear:!0,showSearch:!0,placeholder:"Tất cả ngành hàng",onSearch:n=>{u(n)},options:r,onSelect:n=>{d(q(n)),t(1)},onClear:()=>{d(q(""))}})]})},Os=({setPage:t,inputMonth:r,inputYear:i,inputFromDate:l,inputToDate:u,inputSaleGroup:d,inputEmployee:n,inputSupplier:o,inputIndustry:h,inpitBrand:w})=>s.jsxs(s.Fragment,{children:[r&&s.jsx(vs,{setPage:t}),i&&s.jsx(Ns,{}),l&&s.jsx(Ts,{}),u&&s.jsx(Es,{}),d&&s.jsx(Ds,{}),n&&s.jsx(ks,{setPage:t}),o&&s.jsx($s,{setPage:t}),h&&s.jsx(Ms,{setPage:t}),w&&s.jsx(Is,{setPage:t})]}),Gs=Os,Ce=f().startOf("month"),ve=f().endOf("month");let ye=Date.parse(Ce.$d)/1e3,ge=Date.parse(ve.$d)/1e3;const U=(f().month()+1).toString(),we=f().startOf("year").$y.toString(),Rs=({setPage:t,matchMedia:r,inputFromDate:i,inputMonth:l,inputToDate:u,inputYear:d,inputSaleGroup:n,inputEmployee:o,inputCompany:h,inputCustomer:w,inputTerritory:S,inputWarehouse:k,inputCustomerType:v,inputCustomerGroup:$,inputOrder:F,inputSupplier:T,inputIndustry:I,inputBrand:R})=>{const[De,Ne]=a.useState([]),[ke,Te]=a.useState([]),[Ee,$e]=a.useState([]),[Ie,Me]=a.useState([]),[Oe,Re]=a.useState([]),[Le,Be]=a.useState([]),[Ye,Ke]=a.useState([]),[Ve,He]=a.useState([]),[qe,We]=a.useState([]),[Ae,Ge]=a.useState([]),[J,ze]=a.useState(""),[X,Qe]=a.useState(""),[P,Ue]=a.useState(""),[ee,Ze]=a.useState(""),[se,Je]=a.useState(""),[te,Xe]=a.useState(""),[ae,Pe]=a.useState(""),[re,es]=a.useState(""),[le,ss]=a.useState(""),[G]=is(),c=b(),{sales_team:ne}=O(e=>e.group);I&&a.useEffect(()=>{(async()=>{let e=await g.get("/api/method/frappe.desk.search.search_link",{params:{txt:re,doctype:"DMS Industry",ignore_user_permissions:0,query:""}}),{message:p}=e;Ke(p.map(m=>({value:m?.value,description:m?.description})))})()},[re]),R&&a.useEffect(()=>{(async()=>{let e=await g.get("/api/method/frappe.desk.search.search_link",{params:{txt:ae,doctype:"Brand",ignore_user_permissions:0,query:""}}),{message:p}=e;Be(p.map(m=>({value:m?.value,description:m?.description})))})()},[ae]),w&&a.useEffect(()=>{(async()=>{let e=await g.get("/api/method/frappe.desk.search.search_link",{params:{txt:P,doctype:"Customer",ignore_user_permissions:0,query:""}}),{message:p}=e;Ne(p.map(m=>({value:m.value,label:m.value})))})()},[P]),S&&a.useEffect(()=>{(async()=>{let e=await g.get("/api/method/frappe.desk.search.search_link",{params:{txt:ee,doctype:"Territory",ignore_user_permissions:0,query:""}}),{message:p}=e;$e(p.map(m=>({value:m.value,label:m.value})))})()},[ee]),$&&a.useEffect(()=>{(async()=>{let e=await g.get("/api/method/frappe.desk.search.search_link",{params:{txt:le,doctype:"Customer Group",ignore_user_permissions:0,query:""}}),{message:p}=e;Me(p.map(m=>({value:m.value.trim(),label:m.value.trim()})))})()},[le]),a.useEffect(()=>{(async()=>{let e=await g.get("/api/method/mbw_dms.api.router.get_team_sale");He(Se({data:e.result.map(p=>({title:p.name,value:p.name,...p})),keyValue:"value",parentField:"parent_sales_person"}))})()},[]),o&&a.useEffect(()=>{(async()=>{let e=await g.get("/api/method/mbw_dms.api.router.get_sale_person",{params:{team_sale:ne,key_search:X}}),{message:p}=e;We(p.map(m=>({value:m.employee_code,label:m.employee_name||m.employee_code})))})()},[ne,X]),h&&a.useEffect(()=>{(async()=>{let e=await g.get("/api/method/frappe.desk.search.search_link",{params:{txt:se,doctype:"Company",ignore_user_permissions:0,query:""}}),{message:p}=e;Re(p.map(m=>({value:m.value,label:m.value})))})()},[se]),k&&a.useEffect(()=>{(async()=>{let e=await g.get("/api/method/frappe.desk.search.search_link",{params:{txt:te,doctype:"Warehouse",ignore_user_permissions:0,query:""}}),{message:p}=e;Te(p.map(m=>({value:m.value,label:m.value})))})()},[te]),T&&a.useEffect(()=>{(async()=>{let e=await g.get("/api/method/frappe.desk.search.search_link",{params:{txt:J,doctype:"Supplier",ignore_user_permissions:0,query:""}}),{message:p}=e;Ge(p.map(m=>({value:m?.value,label:m.description.split(",")[0].trim()})))})()},[J]);const L=b(),{startDate:M,endDate:z}=O(e=>e.date),ts=f(M*1e3),as=f(z*1e3),rs=e=>{if(e==null)L(j(e));else if(z&&e&&e.isAfter(f.unix(z),"day"))Z.error("Từ ngày phải nhỏ hơn hoặc bằng Đến ngày");else{let p=Date.parse(e.$d)/1e3;L(j(p))}},ls=e=>{if(e==null)L(C(e));else if(M&&e&&e.isBefore(f.unix(M),"day"))Z.error("Đến ngày phải lớn hơn hoặc bằng Từ ngày");else{let p=Date.parse(e.$d)/1e3;L(C(p))}},ns=e=>{if(M){const p=f.unix(M).month();return e&&e.month()!==p}},os=e=>{e.customergroup?c(ce(e.customergroup)):c(ce("")),e.customertype?c(ie(e.customertype)):c(ie("")),e.territory?c(ue(e.territory)):c(ue("")),e.filter_fromDate?c(j(e.filter_fromDate.$d/1e3)):c(j(ye)),e.filter_toDate?c(C((e.filter_toDate.$d-999)/1e3)):c(C(ge)),e.has_sales_order?c(he(e.has_sales_order)):c(he("")),e.filter_month?c(B(e.filter_month)):c(B(U)),e.filter_year?c(K(Date.parse(e.filter_year.$y).toString())):c(K(we)),e.company?c(pe(e.company)):c(pe("")),e.customer?c(me(e.customer)):c(me("")),e.warehouse?c(de(e.warehouse)):c(de("")),e.filter_group_sales?c(Y(e.filter_group_sales)):c(Y("")),e.filter_employee?c(D(e.filter_employee)):c(D("")),t&&t(1)};return s.jsx(us,{className:"!h-8",placement:"bottomRight",trigger:["click"],dropdownRender:()=>s.jsxs(ds,{title:"Bộ lọc",children:[s.jsxs(x,{layout:"vertical",form:G,onFinish:os,children:[!r&&s.jsxs(s.Fragment,{children:[i&&s.jsx(x.Item,{className:"w-[468px] border-none",name:"filter_fromDate",children:s.jsx(E,{format:"DD-MM-YYYY",className:"!bg-[#F4F6F8] w-full rounded-lg h-7",placeholder:"Từ ngày",onChange:rs,value:ts,defaultValue:Ce,allowClear:!1})}),l&&s.jsx(x.Item,{className:"w-[468px] border-none",name:"filter_month",children:s.jsx(y,{className:"!bg-[#F4F6F8] ",defaultValue:U,options:je})}),u&&s.jsx(x.Item,{className:"w-[468px] border-none",name:"filter_toDate",children:s.jsx(E,{format:"DD-MM-YYYY",className:"!bg-[#F4F6F8] w-full rounded-lg h-7",onChange:ls,placeholder:"Đến ngày",defaultValue:ve,disabledDate:ns,value:as,allowClear:!1})}),d&&s.jsx(x.Item,{className:"w-[468px] border-none",name:"filter_year",children:s.jsx(E,{className:"!bg-[#F4F6F8] w-full rounded-lg h-7",placeholder:"Chọn năm",picker:"year",allowClear:!1,defaultValue:f().startOf("year")})}),n&&s.jsx(x.Item,{className:"w-[468px] border-none",name:"filter_group_sales",label:"Nhóm bán hàng",children:s.jsx(be,{placeholder:"Tất cả nhóm bán hàng",allowClear:!0,showSearch:!0,treeData:Ve,dropdownStyle:{maxHeight:400,overflow:"auto",minWidth:350}})}),o&&s.jsx(x.Item,{className:"w-[468px] border-none",label:"Nhân viên",name:"filter_employee",children:s.jsx(y,{filterOption:!0,allowClear:!0,showSearch:!0,placeholder:"Tất cả nhân viên",onSearch:e=>{Qe(e)},options:qe,onClear:()=>{D&&D("")}})})]}),h&&s.jsx(x.Item,{name:"company",label:"Công ty",className:"w-[468px] border-none",children:s.jsx(y,{showSearch:!0,className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:Oe,allowClear:!0,onSearch:e=>{Je(e)},placeholder:"Tất cả công ty"})}),w&&s.jsx(x.Item,{name:"customer",label:"Khách hàng",className:"w-[468px] border-none",children:s.jsx(y,{showSearch:!0,className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:De,filterOption:!1,allowClear:!0,onSearch:e=>{Ue(e)},placeholder:"Tất cả khách hàng"})}),k&&s.jsx(x.Item,{name:"warehouse",label:"Kho",className:"w-[468px] border-none",children:s.jsx(y,{showSearch:!0,className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:ke,allowClear:!0,onSearch:e=>{Xe(e)},placeholder:"Tất cả kho"})}),v&&s.jsx(x.Item,{name:"customertype",label:"Loại hình khách hàng",className:"w-[468px] border-none",children:s.jsx(y,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:ys,allowClear:!0,showSearch:!0,placeholder:"Tất cả loại hình khách hàng"})}),$&&s.jsx(x.Item,{name:"customergroup",label:"Nhóm khách hàng",className:"w-[468px] border-none",children:s.jsx(y,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:Ie,allowClear:!0,onSearch:e=>{ss(e)},showSearch:!0,placeholder:"Tất cả nhóm khách hàng"})}),F&&s.jsx(x.Item,{label:"Phát sinh đơn hàng",name:"hasorder",className:"w-[468px] border-none",children:s.jsx(y,{placeholder:"Tất cả",className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:gs,allowClear:!0,showSearch:!0})}),S&&s.jsx(x.Item,{name:"territory",label:"Khu vực",className:"w-[468px] border-none",children:s.jsx(y,{showSearch:!0,className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:Ee,allowClear:!0,onSearch:e=>{Ze(e)},placeholder:"Tất cả khu vực"})}),R&&s.jsx(x.Item,{name:"territory",label:"Nhãn hiệu",className:"w-[468px] border-none",children:s.jsx(y,{filterOption:!1,allowClear:!0,showSearch:!0,placeholder:"Tất cả nhãn hiệu",onSearch:e=>{Pe(e)},options:Le,onSelect:e=>{c(H(e)),t&&t(1)},onClear:()=>{c(H(""))}})}),T&&s.jsx(x.Item,{name:"supplier",label:"Nhà cung cấp",className:"w-[468px] border-none",children:s.jsx(y,{filterOption:!1,notFoundContent:null,allowClear:!0,showSearch:!0,placeholder:"Tất cả nhà cung cấp",onSearch:e=>{ze(e)},options:Ae,onSelect:e=>{c(V(e)),t&&t(1)},onClear:()=>{c(V(""))}})}),I&&s.jsx(x.Item,{name:"industry",label:"Ngành hàng",className:"w-[468px] border-none",children:s.jsx(y,{filterOption:!1,allowClear:!0,showSearch:!0,placeholder:"Tất cả ngành hàng",onSearch:e=>{es(e)},options:Ye,onSelect:e=>{c(q(e)),t&&t(1)},onClear:()=>{c(q(""))}})})]}),s.jsx(hs,{className:"justify-between pt-6 pb-4",children:s.jsxs(s.Fragment,{children:[s.jsx(Q,{className:"mr-3",onClick:e=>{e.preventDefault(),c(B(U)),c(K(we)),!r&&c(Y("")),!r&&c(D("")),c(j(ye)),c(C(ge)),G.resetFields()},children:"Đặt lại"}),s.jsx(Q,{type:"primary",onClick:()=>{G.submit()},children:"Áp dụng"})]})})]}),children:s.jsx(Q,{onClick:e=>e.preventDefault(),className:"flex items-center text-nowrap !text-[13px] !leading-[21px] !font-normal  border-r-[0.1px]  h-8 mt-4",icon:s.jsx(xs,{style:{fontSize:"20px"}}),children:"Bộ lọc"})})},zs=Rs,Ls=({setRefresh:t,title:r,params:i,file_name:l})=>{const[u,d]=a.useState(!1);return s.jsx(ps,{title:r,buttons:[{icon:s.jsx(fs,{className:"text-xl size-4 mb-1 mr-[2px]"}),className:"flex mr-2 h-7 mt-6",action:()=>{t(n=>!n)}},{disabled:u,label:"Xuất dữ liệu",type:"primary",icon:s.jsx(ws,{className:"text-xl"}),size:"18px",className:"flex items-center h-7 mt-6",action:ms.bind(null,{url:"/api/method/mbw_dms.api.exports.export_excel.export_excel",params:i,file_name:l},d)}]})},Qs=Ls;export{zs as D,Gs as F,As as P,Qs as R,A as a,Ws as b,W as m,O as u};
