import{X as he,a as as,a8 as Ry,a9 as lo,_ as Fi,aa as jh,ab as ln,N as Ra,ac as w0,ad as Lg,ae as $0,af as Gh,ag as Rg,h as La,K as j0,ah as eu,ai as Og,aj as Oy,ak as Bg,al as By,am as zy,an as vl,ao as b0,ap as Ci,aq as Ny,ar as Uy,w as Hc,as as $a,at as Vy,au as $y,av as ul,aw as jy,ax as Gy,ay as T0,az as Hy,aA as Wy,aB as qy,aC as Zy,aD as Xy,aE as Ky,aF as am,aG as Yy,aH as Jy,aI as Qy,aJ as ev,aK as tv,aL as zg,aM as rv,aN as av,aO as iv,aP as im,aQ as nv,aR as sv,aS as ov,aT as Ng,aU as Ug,aV as Vg,aW as Gi,aX as $g,aY as E0,aZ as lv,a_ as cv,a$ as nm,b0 as jg,b1 as Gg,b2 as sm,b3 as uv,b4 as hv,I as Hg,b5 as fv,b6 as dv,J as pv,b7 as om,b8 as lm,b9 as cm,U as uo,ba as mv,bb as gv,bc as kh,L as Je,R as ho,a1 as on,Q as Si,P as Ni,bd as Ch,a3 as is,a4 as G0,be as xv,bf as _v,bg as yv,O as S0,bh as vv,bi as Wg,bj as wv,bk as bv,bl as Tv,bm as a0,a0 as Ev,bn as Sv,a7 as kv}from"./index-7Ylm8Oqy.js";import{u as Cv}from"./useDebount-I4gjYqMr.js";import{i as Av,M as k0}from"./index-ydzSXXcc.js";import{s as Ah}from"./index-m4e_dIoe.js";import{a as Iv,b as Fv}from"./index.esm-ypJJ1h9B.js";import{H as Pv}from"./header-page-7E4IMHbM.js";import{T as Mv}from"./index-1quCzXel.js";var Dv={percent:0,prefixCls:"rc-progress",strokeColor:"#2db7f5",strokeLinecap:"round",strokeWidth:1,trailColor:"#D9D9D9",trailWidth:1,gapPosition:"bottom"},Lv=function(){var n=he.useRef([]),a=he.useRef(null);return he.useEffect(function(){var c=Date.now(),u=!1;n.current.forEach(function(m){if(m){u=!0;var x=m.style;x.transitionDuration=".3s, .3s, .3s, .06s",a.current&&c-a.current<100&&(x.transitionDuration="0s, 0s")}}),u&&(a.current=Date.now())}),n.current},um=0,Rv=Ry();function Ov(){var e;return Rv?(e=um,um+=1):e="TEST_OR_SSR",e}const Bv=function(e){var n=he.useState(),a=as(n,2),c=a[0],u=a[1];return he.useEffect(function(){u("rc_progress_".concat(Ov()))},[]),e||c};var hm=function(n){var a=n.bg,c=n.children;return he.createElement("div",{style:{width:"100%",height:"100%",background:a}},c)};function fm(e,n){return Object.keys(e).map(function(a){var c=parseFloat(a),u="".concat(Math.floor(c*n),"%");return"".concat(e[a]," ").concat(u)})}var zv=he.forwardRef(function(e,n){var a=e.prefixCls,c=e.color,u=e.gradientId,m=e.radius,x=e.style,o=e.ptg,E=e.strokeLinecap,w=e.strokeWidth,C=e.size,P=e.gapDegree,M=c&&lo(c)==="object",B=M?"#FFF":void 0,U=C/2,N=he.createElement("circle",{className:"".concat(a,"-circle-path"),r:m,cx:U,cy:U,stroke:B,strokeLinecap:E,strokeWidth:w,opacity:o===0?0:1,style:x,ref:n});if(!M)return N;var j="".concat(u,"-conic"),re=P?"".concat(180+P/2,"deg"):"0deg",pe=fm(c,(360-P)/360),X=fm(c,1),le="conic-gradient(from ".concat(re,", ").concat(pe.join(", "),")"),ye="linear-gradient(to ".concat(P?"bottom":"top",", ").concat(X.join(", "),")");return he.createElement(he.Fragment,null,he.createElement("mask",{id:j},N),he.createElement("foreignObject",{x:0,y:0,width:C,height:C,mask:"url(#".concat(j,")")},he.createElement(hm,{bg:ye},he.createElement(hm,{bg:le}))))}),Fc=100,i0=function(n,a,c,u,m,x,o,E,w,C){var P=arguments.length>10&&arguments[10]!==void 0?arguments[10]:0,M=c/100*360*((360-x)/360),B=x===0?0:{bottom:0,top:180,left:90,right:-90}[o],U=(100-u)/100*a;w==="round"&&u!==100&&(U+=C/2,U>=a&&(U=a-.01));var N=Fc/2;return{stroke:typeof E=="string"?E:void 0,strokeDasharray:"".concat(a,"px ").concat(n),strokeDashoffset:U+P,transform:"rotate(".concat(m+M+B,"deg)"),transformOrigin:"".concat(N,"px ").concat(N,"px"),transition:"stroke-dashoffset .3s ease 0s, stroke-dasharray .3s ease 0s, stroke .3s, stroke-width .06s ease .3s, opacity .3s ease 0s",fillOpacity:0}},Nv=["id","prefixCls","steps","strokeWidth","trailWidth","gapDegree","gapPosition","trailColor","strokeLinecap","style","className","strokeColor","percent"];function dm(e){var n=e??[];return Array.isArray(n)?n:[n]}var Uv=function(n){var a=Fi(Fi({},Dv),n),c=a.id,u=a.prefixCls,m=a.steps,x=a.strokeWidth,o=a.trailWidth,E=a.gapDegree,w=E===void 0?0:E,C=a.gapPosition,P=a.trailColor,M=a.strokeLinecap,B=a.style,U=a.className,N=a.strokeColor,j=a.percent,re=jh(a,Nv),pe=Fc/2,X=Bv(c),le="".concat(X,"-gradient"),ye=pe-x/2,we=Math.PI*2*ye,ae=w>0?90+w/2:-90,ze=we*((360-w)/360),Ie=lo(m)==="object"?m:{count:m,space:2},$e=Ie.count,je=Ie.space,Le=dm(j),it=dm(N),ft=it.find(function(Ft){return Ft&&lo(Ft)==="object"}),ct=ft&&lo(ft)==="object",xt=ct?"butt":M,ht=i0(we,ze,0,100,ae,w,C,P,xt,x),Yt=Lv(),He=function(){var ue=0;return Le.map(function(Te,Ee){var Se=it[Ee]||it[it.length-1],Ke=i0(we,ze,ue,Te,ae,w,C,Se,xt,x);return ue+=Te,he.createElement(zv,{key:Ee,color:Se,ptg:Te,radius:ye,prefixCls:u,gradientId:le,style:Ke,strokeLinecap:xt,strokeWidth:x,gapDegree:w,ref:function(_t){Yt[Ee]=_t},size:Fc})}).reverse()},Nt=function(){var ue=Math.round($e*(Le[0]/100)),Te=100/$e,Ee=0;return new Array($e).fill(null).map(function(Se,Ke){var pt=Ke<=ue-1?it[0]:P,_t=pt&&lo(pt)==="object"?"url(#".concat(le,")"):void 0,ut=i0(we,ze,Ee,Te,ae,w,C,pt,"butt",x,je);return Ee+=(ze-ut.strokeDashoffset+je)*100/ze,he.createElement("circle",{key:Ke,className:"".concat(u,"-circle-path"),r:ye,cx:pe,cy:pe,stroke:_t,strokeWidth:x,opacity:1,style:ut,ref:function(Zt){Yt[Ke]=Zt}})})};return he.createElement("svg",ln({className:Ra("".concat(u,"-circle"),U),viewBox:"0 0 ".concat(Fc," ").concat(Fc),style:B,id:c,role:"presentation"},re),!$e&&he.createElement("circle",{className:"".concat(u,"-circle-trail"),r:ye,cx:pe,cy:pe,stroke:P,strokeLinecap:xt,strokeWidth:o||x,style:ht}),$e?Nt():He())};function Ls(e){return!e||e<0?0:e>100?100:e}function Ih(e){let{success:n,successPercent:a}=e,c=a;return n&&"progress"in n&&(c=n.progress),n&&"percent"in n&&(c=n.percent),c}const Vv=e=>{let{percent:n,success:a,successPercent:c}=e;const u=Ls(Ih({success:a,successPercent:c}));return[u,Ls(Ls(n)-u)]},$v=e=>{let{success:n={},strokeColor:a}=e;const{strokeColor:c}=n;return[c||w0.green,a||null]},Hh=(e,n,a)=>{var c,u,m,x;let o=-1,E=-1;if(n==="step"){const w=a.steps,C=a.strokeWidth;typeof e=="string"||typeof e>"u"?(o=e==="small"?2:14,E=C??8):typeof e=="number"?[o,E]=[e,e]:[o=14,E=8]=e,o*=w}else if(n==="line"){const w=a?.strokeWidth;typeof e=="string"||typeof e>"u"?E=w||(e==="small"?6:8):typeof e=="number"?[o,E]=[e,e]:[o=-1,E=8]=e}else(n==="circle"||n==="dashboard")&&(typeof e=="string"||typeof e>"u"?[o,E]=e==="small"?[60,60]:[120,120]:typeof e=="number"?[o,E]=[e,e]:(o=(u=(c=e[0])!==null&&c!==void 0?c:e[1])!==null&&u!==void 0?u:120,E=(x=(m=e[0])!==null&&m!==void 0?m:e[1])!==null&&x!==void 0?x:120));return[o,E]},jv=3,Gv=e=>jv/e*100,Hv=e=>{const{prefixCls:n,trailColor:a=null,strokeLinecap:c="round",gapPosition:u,gapDegree:m,width:x=120,type:o,children:E,success:w,size:C=x}=e,[P,M]=Hh(C,"circle");let{strokeWidth:B}=e;B===void 0&&(B=Math.max(Gv(P),6));const U={width:P,height:M,fontSize:P*.15+6},N=he.useMemo(()=>{if(m||m===0)return m;if(o==="dashboard")return 75},[m,o]),j=u||o==="dashboard"&&"bottom"||void 0,re=Object.prototype.toString.call(e.strokeColor)==="[object Object]",pe=$v({success:w,strokeColor:e.strokeColor}),X=Ra(`${n}-inner`,{[`${n}-circle-gradient`]:re}),le=he.createElement(Uv,{percent:Vv(e),strokeWidth:B,trailWidth:B,strokeColor:pe,strokeLinecap:c,trailColor:a,prefixCls:n,gapDegree:N,gapPosition:j});return he.createElement("div",{className:X,style:U},P<=20?he.createElement(Lg,{title:E},he.createElement("span",null,le)):he.createElement(he.Fragment,null,le,E))},Wv=Hv,Fh="--progress-line-stroke-color",qg="--progress-percent",pm=e=>{const n=e?"100%":"-100%";return new j0(`antProgress${e?"RTL":"LTR"}Active`,{"0%":{transform:`translateX(${n}) scaleX(0)`,opacity:.1},"20%":{transform:`translateX(${n}) scaleX(0)`,opacity:.5},to:{transform:"translateX(0) scaleX(1)",opacity:0}})},qv=e=>{const{componentCls:n,iconCls:a}=e;return{[n]:Object.assign(Object.assign({},Rg(e)),{display:"inline-block","&-rtl":{direction:"rtl"},"&-line":{position:"relative",width:"100%",fontSize:e.fontSize,marginInlineEnd:e.marginXS,marginBottom:e.marginXS},[`${n}-outer`]:{display:"inline-block",width:"100%"},[`&${n}-show-info`]:{[`${n}-outer`]:{marginInlineEnd:`calc(-2em - ${La(e.marginXS)})`,paddingInlineEnd:`calc(2em + ${La(e.paddingXS)})`}},[`${n}-inner`]:{position:"relative",display:"inline-block",width:"100%",overflow:"hidden",verticalAlign:"middle",backgroundColor:e.remainingColor,borderRadius:e.lineBorderRadius},[`${n}-inner:not(${n}-circle-gradient)`]:{[`${n}-circle-path`]:{stroke:e.defaultColor}},[`${n}-success-bg, ${n}-bg`]:{position:"relative",background:e.defaultColor,borderRadius:e.lineBorderRadius,transition:`all ${e.motionDurationSlow} ${e.motionEaseInOutCirc}`},[`${n}-bg`]:{overflow:"hidden","&::after":{content:'""',background:{_multi_value_:!0,value:["inherit",`var(${Fh})`]},height:"100%",width:`calc(1 / var(${qg}) * 100%)`,display:"block"}},[`${n}-success-bg`]:{position:"absolute",insetBlockStart:0,insetInlineStart:0,backgroundColor:e.colorSuccess},[`${n}-text`]:{display:"inline-block",width:"2em",marginInlineStart:e.marginXS,color:e.colorText,lineHeight:1,whiteSpace:"nowrap",textAlign:"start",verticalAlign:"middle",wordBreak:"normal",[a]:{fontSize:e.fontSize}},[`&${n}-status-active`]:{[`${n}-bg::before`]:{position:"absolute",inset:0,backgroundColor:e.colorBgContainer,borderRadius:e.lineBorderRadius,opacity:0,animationName:pm(),animationDuration:e.progressActiveMotionDuration,animationTimingFunction:e.motionEaseOutQuint,animationIterationCount:"infinite",content:'""'}},[`&${n}-rtl${n}-status-active`]:{[`${n}-bg::before`]:{animationName:pm(!0)}},[`&${n}-status-exception`]:{[`${n}-bg`]:{backgroundColor:e.colorError},[`${n}-text`]:{color:e.colorError}},[`&${n}-status-exception ${n}-inner:not(${n}-circle-gradient)`]:{[`${n}-circle-path`]:{stroke:e.colorError}},[`&${n}-status-success`]:{[`${n}-bg`]:{backgroundColor:e.colorSuccess},[`${n}-text`]:{color:e.colorSuccess}},[`&${n}-status-success ${n}-inner:not(${n}-circle-gradient)`]:{[`${n}-circle-path`]:{stroke:e.colorSuccess}}})}},Zv=e=>{const{componentCls:n,iconCls:a}=e;return{[n]:{[`${n}-circle-trail`]:{stroke:e.remainingColor},[`&${n}-circle ${n}-inner`]:{position:"relative",lineHeight:1,backgroundColor:"transparent"},[`&${n}-circle ${n}-text`]:{position:"absolute",insetBlockStart:"50%",insetInlineStart:0,width:"100%",margin:0,padding:0,color:e.circleTextColor,fontSize:e.circleTextFontSize,lineHeight:1,whiteSpace:"normal",textAlign:"center",transform:"translateY(-50%)",[a]:{fontSize:e.circleIconFontSize}},[`${n}-circle&-status-exception`]:{[`${n}-text`]:{color:e.colorError}},[`${n}-circle&-status-success`]:{[`${n}-text`]:{color:e.colorSuccess}}},[`${n}-inline-circle`]:{lineHeight:1,[`${n}-inner`]:{verticalAlign:"bottom"}}}},Xv=e=>{const{componentCls:n}=e;return{[n]:{[`${n}-steps`]:{display:"inline-block","&-outer":{display:"flex",flexDirection:"row",alignItems:"center"},"&-item":{flexShrink:0,minWidth:e.progressStepMinWidth,marginInlineEnd:e.progressStepMarginInlineEnd,backgroundColor:e.remainingColor,transition:`all ${e.motionDurationSlow}`,"&-active":{backgroundColor:e.defaultColor}}}}}},Kv=e=>{const{componentCls:n,iconCls:a}=e;return{[n]:{[`${n}-small&-line, ${n}-small&-line ${n}-text ${a}`]:{fontSize:e.fontSizeSM}}}},Yv=e=>({circleTextColor:e.colorText,defaultColor:e.colorInfo,remainingColor:e.colorFillSecondary,lineBorderRadius:100,circleTextFontSize:"1em",circleIconFontSize:`${e.fontSize/e.fontSizeSM}em`}),Jv=$0("Progress",e=>{const n=e.calc(e.marginXXS).div(2).equal(),a=Gh(e,{progressStepMarginInlineEnd:n,progressStepMinWidth:n,progressActiveMotionDuration:"2.4s"});return[qv(a),Zv(a),Xv(a),Kv(a)]},Yv);var Qv=function(e,n){var a={};for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&n.indexOf(c)<0&&(a[c]=e[c]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var u=0,c=Object.getOwnPropertySymbols(e);u<c.length;u++)n.indexOf(c[u])<0&&Object.prototype.propertyIsEnumerable.call(e,c[u])&&(a[c[u]]=e[c[u]]);return a};const e2=e=>{let n=[];return Object.keys(e).forEach(a=>{const c=parseFloat(a.replace(/%/g,""));isNaN(c)||n.push({key:c,value:e[a]})}),n=n.sort((a,c)=>a.key-c.key),n.map(a=>{let{key:c,value:u}=a;return`${u} ${c}%`}).join(", ")},t2=(e,n)=>{const{from:a=w0.blue,to:c=w0.blue,direction:u=n==="rtl"?"to left":"to right"}=e,m=Qv(e,["from","to","direction"]);if(Object.keys(m).length!==0){const o=e2(m),E=`linear-gradient(${u}, ${o})`;return{background:E,[Fh]:E}}const x=`linear-gradient(${u}, ${a}, ${c})`;return{background:x,[Fh]:x}},r2=e=>{const{prefixCls:n,direction:a,percent:c,size:u,strokeWidth:m,strokeColor:x,strokeLinecap:o="round",children:E,trailColor:w=null,success:C}=e,P=x&&typeof x!="string"?t2(x,a):{[Fh]:x,background:x},M=o==="square"||o==="butt"?0:void 0,B=u??[-1,m||(u==="small"?6:8)],[U,N]=Hh(B,"line",{strokeWidth:m}),j={backgroundColor:w||void 0,borderRadius:M},re=Object.assign(Object.assign({width:`${Ls(c)}%`,height:N,borderRadius:M},P),{[qg]:Ls(c)/100}),pe=Ih(e),X={width:`${Ls(pe)}%`,height:N,borderRadius:M,backgroundColor:C?.strokeColor},le={width:U<0?"100%":U,height:N};return he.createElement(he.Fragment,null,he.createElement("div",{className:`${n}-outer`,style:le},he.createElement("div",{className:`${n}-inner`,style:j},he.createElement("div",{className:`${n}-bg`,style:re}),pe!==void 0?he.createElement("div",{className:`${n}-success-bg`,style:X}):null)),E)},a2=r2,i2=e=>{const{size:n,steps:a,percent:c=0,strokeWidth:u=8,strokeColor:m,trailColor:x=null,prefixCls:o,children:E}=e,w=Math.round(a*(c/100)),P=n??[n==="small"?2:14,u],[M,B]=Hh(P,"step",{steps:a,strokeWidth:u}),U=M/a,N=new Array(a);for(let j=0;j<a;j++){const re=Array.isArray(m)?m[j]:m;N[j]=he.createElement("div",{key:j,className:Ra(`${o}-steps-item`,{[`${o}-steps-item-active`]:j<=w-1}),style:{backgroundColor:j<=w-1?re:x,width:U,height:B}})}return he.createElement("div",{className:`${o}-steps-outer`},N,E)},n2=i2;var s2=function(e,n){var a={};for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&n.indexOf(c)<0&&(a[c]=e[c]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var u=0,c=Object.getOwnPropertySymbols(e);u<c.length;u++)n.indexOf(c[u])<0&&Object.prototype.propertyIsEnumerable.call(e,c[u])&&(a[c[u]]=e[c[u]]);return a};const o2=["normal","exception","active","success"],l2=he.forwardRef((e,n)=>{const{prefixCls:a,className:c,rootClassName:u,steps:m,strokeColor:x,percent:o=0,size:E="default",showInfo:w=!0,type:C="line",status:P,format:M,style:B}=e,U=s2(e,["prefixCls","className","rootClassName","steps","strokeColor","percent","size","showInfo","type","status","format","style"]),N=he.useMemo(()=>{var it,ft;const ct=Ih(e);return parseInt(ct!==void 0?(it=ct??0)===null||it===void 0?void 0:it.toString():(ft=o??0)===null||ft===void 0?void 0:ft.toString(),10)},[o,e.success,e.successPercent]),j=he.useMemo(()=>!o2.includes(P)&&N>=100?"success":P||"normal",[P,N]),{getPrefixCls:re,direction:pe,progress:X}=he.useContext(eu),le=re("progress",a),[ye,we,ae]=Jv(le),ze=he.useMemo(()=>{if(!w)return null;const it=Ih(e);let ft;const ct=M||(ht=>`${ht}%`),xt=C==="line";return M||j!=="exception"&&j!=="success"?ft=ct(Ls(o),Ls(it)):j==="exception"?ft=xt?he.createElement(Oy,null):he.createElement(Bg,null):j==="success"&&(ft=xt?he.createElement(By,null):he.createElement(zy,null)),he.createElement("span",{className:`${le}-text`,title:typeof ft=="string"?ft:void 0},ft)},[w,o,N,j,C,le,M]),Ie=Array.isArray(x)?x[0]:x,$e=typeof x=="string"||Array.isArray(x)?x:void 0;let je;C==="line"?je=m?he.createElement(n2,Object.assign({},e,{strokeColor:$e,prefixCls:le,steps:m}),ze):he.createElement(a2,Object.assign({},e,{strokeColor:Ie,prefixCls:le,direction:pe}),ze):(C==="circle"||C==="dashboard")&&(je=he.createElement(Wv,Object.assign({},e,{strokeColor:Ie,prefixCls:le,progressStatus:j}),ze));const Le=Ra(le,`${le}-status-${j}`,`${le}-${C==="dashboard"&&"circle"||m&&"steps"||C}`,{[`${le}-inline-circle`]:C==="circle"&&Hh(E,"circle")[0]<=20,[`${le}-show-info`]:w,[`${le}-${E}`]:typeof E=="string",[`${le}-rtl`]:pe==="rtl"},X?.className,c,u,we,ae);return ye(he.createElement("div",Object.assign({ref:n,style:Object.assign(Object.assign({},X?.style),B),className:Le,role:"progressbar","aria-valuenow":N},Og(U,["trailColor","strokeWidth","width","gapDegree","gapPosition","strokeLinecap","success","successPercent"])),je))}),c2=l2;var u2={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z"}}]},name:"delete",theme:"outlined"};const h2=u2;var f2=function(n,a){return he.createElement(vl,ln({},n,{ref:a,icon:h2}))};const Zg=he.forwardRef(f2),d2=function(e){var n=he.useRef({valueLabels:new Map});return he.useMemo(function(){var a=n.current.valueLabels,c=new Map,u=e.map(function(m){var x,o=m.value,E=(x=m.label)!==null&&x!==void 0?x:a.get(o);return c.set(o,E),Fi(Fi({},m),{},{label:E})});return n.current.valueLabels=c,[u]},[e])},p2=function(e,n,a,c){return he.useMemo(function(){var u=e.map(function(E){var w=E.value;return w}),m=n.map(function(E){var w=E.value;return w}),x=u.filter(function(E){return!c[E]});if(a){var o=b0(u,!0,c);u=o.checkedKeys,m=o.halfCheckedKeys}return[Array.from(new Set([].concat(Ci(x),Ci(u)))),m]},[e,n,a,c])};function m2(e){return Array.isArray(e)?e:e!==void 0?[e]:[]}function g2(e){var n=e||{},a=n.label,c=n.value,u=n.children,m=c||"value";return{_title:a?[a]:["title","label"],value:m,key:m,children:u||"children"}}function C0(e){return!e||e.disabled||e.disableCheckbox||e.checkable===!1}function x2(e,n){var a=[];function c(u){u.forEach(function(m){var x=m[n.children];x&&(a.push(m[n.value]),c(x))})}return c(e),a}function mm(e){return e==null}const _2=function(e,n){return he.useMemo(function(){var a=Ny(e,{fieldNames:n,initWrapper:function(u){return Fi(Fi({},u),{},{valueEntities:new Map})},processEntity:function(u,m){var x=u.node[n.value];m.valueEntities.set(x,u)}});return a},[e,n])};var H0=function(){return null},y2=["children","value"];function Xg(e){return Uy(e).map(function(n){if(!he.isValidElement(n)||!n.type)return null;var a=n,c=a.key,u=a.props,m=u.children,x=u.value,o=jh(u,y2),E=Fi({key:c,value:x},o),w=Xg(m);return w.length&&(E.children=w),E}).filter(function(n){return n})}function A0(e){if(!e)return e;var n=Fi({},e);return"props"in n||Object.defineProperty(n,"props",{get:function(){return Hc(!1,"New `rc-tree-select` not support return node instance as argument anymore. Please consider to remove `props` access."),n}}),n}function v2(e,n,a,c,u,m){var x=null,o=null;function E(){function w(C){var P=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"0",M=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return C.map(function(B,U){var N="".concat(P,"-").concat(U),j=B[m.value],re=a.includes(j),pe=w(B[m.children]||[],N,re),X=he.createElement(H0,B,pe.map(function(ye){return ye.node}));if(n===j&&(x=X),re){var le={pos:N,node:X,children:pe};return M||o.push(le),le}return null}).filter(function(B){return B})}o||(o=[],w(c),o.sort(function(C,P){var M=C.node.props.value,B=P.node.props.value,U=a.indexOf(M),N=a.indexOf(B);return U-N}))}Object.defineProperty(e,"triggerNode",{get:function(){return Hc(!1,"`triggerNode` is deprecated. Please consider decoupling data with node."),E(),x}}),Object.defineProperty(e,"allCheckedNodes",{get:function(){return Hc(!1,"`allCheckedNodes` is deprecated. Please consider decoupling data with node."),E(),u?o:o.map(function(C){var P=C.node;return P})}})}const w2=function(e,n,a){var c=a.treeNodeFilterProp,u=a.filterTreeNode,m=a.fieldNames,x=m.children;return he.useMemo(function(){if(!n||u===!1)return e;var o;if(typeof u=="function")o=u;else{var E=n.toUpperCase();o=function(P,M){var B=M[c];return String(B).toUpperCase().includes(E)}}function w(C){var P=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return C.reduce(function(M,B){var U=B[x],N=P||o(n,A0(B)),j=w(U||[],N);return(N||j.length)&&M.push(Fi(Fi({},B),{},$a({isLeaf:void 0},x,j))),M},[])}return w(e)},[e,n,x,c,u])};function gm(e){var n=he.useRef();n.current=e;var a=he.useCallback(function(){return n.current.apply(n,arguments)},[]);return a}function b2(e,n){var a=n.id,c=n.pId,u=n.rootPId,m={},x=[],o=e.map(function(E){var w=Fi({},E),C=w[a];return m[C]=w,w.key=w.key||C,w});return o.forEach(function(E){var w=E[c],C=m[w];C&&(C.children=C.children||[],C.children.push(E)),(w===u||!C&&u===null)&&x.push(E)}),x}function T2(e,n,a){return he.useMemo(function(){return e?a?b2(e,Fi({id:"id",pId:"pId",rootPId:null},a!==!0?a:{})):e:Xg(n)},[n,a,e])}var Kg=he.createContext(null),Yg=he.createContext(null),E2={width:0,height:0,display:"flex",overflow:"hidden",opacity:0,border:0,padding:0,margin:0},S2=function(n,a){var c=Vy(),u=c.prefixCls,m=c.multiple,x=c.searchValue,o=c.toggleOpen,E=c.open,w=c.notFoundContent,C=he.useContext(Yg),P=C.virtual,M=C.listHeight,B=C.listItemHeight,U=C.listItemScrollOffset,N=C.treeData,j=C.fieldNames,re=C.onSelect,pe=C.dropdownMatchSelectWidth,X=C.treeExpandAction,le=he.useContext(Kg),ye=le.checkable,we=le.checkedKeys,ae=le.halfCheckedKeys,ze=le.treeExpandedKeys,Ie=le.treeDefaultExpandAll,$e=le.treeDefaultExpandedKeys,je=le.onTreeExpand,Le=le.treeIcon,it=le.showTreeIcon,ft=le.switcherIcon,ct=le.treeLine,xt=le.treeNodeFilterProp,ht=le.loadData,Yt=le.treeLoadedKeys,He=le.treeMotion,Nt=le.onTreeLoad,Ft=le.keyEntities,ue=he.useRef(),Te=$y(function(){return N},[E,N],function(ur,ir){return ir[0]&&ur[1]!==ir[1]}),Ee=he.useState(null),Se=as(Ee,2),Ke=Se[0],pt=Se[1],_t=Ft[Ke],ut=he.useMemo(function(){return ye?{checked:we,halfChecked:ae}:null},[ye,we,ae]);he.useEffect(function(){if(E&&!m&&we.length){var ur;(ur=ue.current)===null||ur===void 0||ur.scrollTo({key:we[0]}),pt(we[0])}},[E]);var tt=String(x).toLowerCase(),Zt=function(ir){return tt?String(ir[xt]).toLowerCase().includes(tt):!1},ge=he.useState($e),Qt=as(ge,2),Xt=Qt[0],or=Qt[1],Jt=he.useState(null),wt=as(Jt,2),cr=wt[0],Pr=wt[1],qe=he.useMemo(function(){return ze?Ci(ze):x?cr:Xt},[Xt,cr,ze,x]);he.useEffect(function(){x&&Pr(x2(N,j))},[x]);var Cr=function(ir){or(ir),Pr(ir),je&&je(ir)},Br=function(ir){ir.preventDefault()},ar=function(ir,Dr){var wr=Dr.node;ye&&C0(wr)||(re(wr.key,{selected:!we.includes(wr.key)}),m||o(!1))};if(he.useImperativeHandle(a,function(){var ur;return{scrollTo:(ur=ue.current)===null||ur===void 0?void 0:ur.scrollTo,onKeyDown:function(Dr){var wr,Nr=Dr.which;switch(Nr){case ul.UP:case ul.DOWN:case ul.LEFT:case ul.RIGHT:(wr=ue.current)===null||wr===void 0||wr.onKeyDown(Dr);break;case ul.ENTER:{if(_t){var Ht=_t?.node||{},br=Ht.selectable,ot=Ht.value;br!==!1&&ar(null,{node:{key:Ke},selected:!we.includes(ot)})}break}case ul.ESC:o(!1)}},onKeyUp:function(){}}}),Te.length===0)return he.createElement("div",{role:"listbox",className:"".concat(u,"-empty"),onMouseDown:Br},w);var Gt={fieldNames:j};return Yt&&(Gt.loadedKeys=Yt),qe&&(Gt.expandedKeys=qe),he.createElement("div",{onMouseDown:Br},_t&&E&&he.createElement("span",{style:E2,"aria-live":"assertive"},_t.node.value),he.createElement(jy,ln({ref:ue,focusable:!1,prefixCls:"".concat(u,"-tree"),treeData:Te,height:M,itemHeight:B,itemScrollOffset:U,virtual:P!==!1&&pe!==!1,multiple:m,icon:Le,showIcon:it,switcherIcon:ft,showLine:ct,loadData:x?null:ht,motion:He,activeKey:Ke,checkable:ye,checkStrictly:!0,checkedKeys:ut,selectedKeys:ye?[]:we,defaultExpandAll:Ie},Gt,{onActiveChange:pt,onSelect:ar,onCheck:ar,onExpand:Cr,onLoad:Nt,filterTreeNode:Zt,expandAction:X})))},Jg=he.forwardRef(S2);Jg.displayName="OptionList";var W0="SHOW_ALL",q0="SHOW_PARENT",Wh="SHOW_CHILD";function xm(e,n,a,c){var u=new Set(e);return n===Wh?e.filter(function(m){var x=a[m];return!(x&&x.children&&x.children.some(function(o){var E=o.node;return u.has(E[c.value])})&&x.children.every(function(o){var E=o.node;return C0(E)||u.has(E[c.value])}))}):n===q0?e.filter(function(m){var x=a[m],o=x?x.parent:null;return!(o&&!C0(o.node)&&u.has(o.key))}):e}var k2=["id","prefixCls","value","defaultValue","onChange","onSelect","onDeselect","searchValue","inputValue","onSearch","autoClearSearchValue","filterTreeNode","treeNodeFilterProp","showCheckedStrategy","treeNodeLabelProp","multiple","treeCheckable","treeCheckStrictly","labelInValue","fieldNames","treeDataSimpleMode","treeData","children","loadData","treeLoadedKeys","onTreeLoad","treeDefaultExpandAll","treeExpandedKeys","treeDefaultExpandedKeys","onTreeExpand","treeExpandAction","virtual","listHeight","listItemHeight","listItemScrollOffset","onDropdownVisibleChange","dropdownMatchSelectWidth","treeLine","treeIcon","showTreeIcon","switcherIcon","treeMotion"];function C2(e){return!e||lo(e)!=="object"}var A2=he.forwardRef(function(e,n){var a=e.id,c=e.prefixCls,u=c===void 0?"rc-tree-select":c,m=e.value,x=e.defaultValue,o=e.onChange,E=e.onSelect,w=e.onDeselect,C=e.searchValue,P=e.inputValue,M=e.onSearch,B=e.autoClearSearchValue,U=B===void 0?!0:B,N=e.filterTreeNode,j=e.treeNodeFilterProp,re=j===void 0?"value":j,pe=e.showCheckedStrategy,X=e.treeNodeLabelProp,le=e.multiple,ye=e.treeCheckable,we=e.treeCheckStrictly,ae=e.labelInValue,ze=e.fieldNames,Ie=e.treeDataSimpleMode,$e=e.treeData,je=e.children,Le=e.loadData,it=e.treeLoadedKeys,ft=e.onTreeLoad,ct=e.treeDefaultExpandAll,xt=e.treeExpandedKeys,ht=e.treeDefaultExpandedKeys,Yt=e.onTreeExpand,He=e.treeExpandAction,Nt=e.virtual,Ft=e.listHeight,ue=Ft===void 0?200:Ft,Te=e.listItemHeight,Ee=Te===void 0?20:Te,Se=e.listItemScrollOffset,Ke=Se===void 0?0:Se,pt=e.onDropdownVisibleChange,_t=e.dropdownMatchSelectWidth,ut=_t===void 0?!0:_t,tt=e.treeLine,Zt=e.treeIcon,ge=e.showTreeIcon,Qt=e.switcherIcon,Xt=e.treeMotion,or=jh(e,k2),Jt=Gy(a),wt=ye&&!we,cr=ye||we,Pr=we||ae,qe=cr||le,Cr=T0(x,{value:m}),Br=as(Cr,2),ar=Br[0],Gt=Br[1],ur=he.useMemo(function(){return ye?pe||Wh:W0},[pe,ye]),ir=he.useMemo(function(){return g2(ze)},[JSON.stringify(ze)]),Dr=T0("",{value:C!==void 0?C:P,postState:function(Ae){return Ae||""}}),wr=as(Dr,2),Nr=wr[0],Ht=wr[1],br=function(Ae){Ht(Ae),M?.(Ae)},ot=T2($e,je,Ie),Pt=_2(ot,ir),Mt=Pt.keyEntities,lr=Pt.valueEntities,tr=he.useCallback(function(J){var Ae=[],Ue=[];return J.forEach(function(Fe){lr.has(Fe)?Ue.push(Fe):Ae.push(Fe)}),{missingRawValues:Ae,existRawValues:Ue}},[lr]),at=w2(ot,Nr,{fieldNames:ir,treeNodeFilterProp:re,filterTreeNode:N}),Rt=he.useCallback(function(J){if(J){if(X)return J[X];for(var Ae=ir._title,Ue=0;Ue<Ae.length;Ue+=1){var Fe=J[Ae[Ue]];if(Fe!==void 0)return Fe}}},[ir,X]),Vt=he.useCallback(function(J){var Ae=m2(J);return Ae.map(function(Ue){return C2(Ue)?{value:Ue}:Ue})},[]),Lr=he.useCallback(function(J){var Ae=Vt(J);return Ae.map(function(Ue){var Fe=Ue.label,De=Ue.value,Ve=Ue.halfChecked,Ye,nt=lr.get(De);if(nt){var yt;Fe=(yt=Fe)!==null&&yt!==void 0?yt:Rt(nt.node),Ye=nt.node.disabled}else if(Fe===void 0){var dt=Vt(ar).find(function(It){return It.value===De});Fe=dt.label}return{label:Fe,value:De,halfChecked:Ve,disabled:Ye}})},[lr,Rt,Vt,ar]),Kr=he.useMemo(function(){return Vt(ar)},[Vt,ar]),rr=he.useMemo(function(){var J=[],Ae=[];return Kr.forEach(function(Ue){Ue.halfChecked?Ae.push(Ue):J.push(Ue)}),[J,Ae]},[Kr]),Aa=as(rr,2),ce=Aa[0],V=Aa[1],H=he.useMemo(function(){return ce.map(function(J){return J.value})},[ce]),te=p2(ce,V,wt,Mt),fe=as(te,2),me=fe[0],Oe=fe[1],Ce=he.useMemo(function(){var J=xm(me,ur,Mt,ir),Ae=J.map(function(Ve){var Ye,nt;return(Ye=(nt=Mt[Ve])===null||nt===void 0||(nt=nt.node)===null||nt===void 0?void 0:nt[ir.value])!==null&&Ye!==void 0?Ye:Ve}),Ue=Ae.map(function(Ve){var Ye=ce.find(function(nt){return nt.value===Ve});return{value:Ve,label:Ye?.label}}),Fe=Lr(Ue),De=Fe[0];return!qe&&De&&mm(De.value)&&mm(De.label)?[]:Fe.map(function(Ve){var Ye;return Fi(Fi({},Ve),{},{label:(Ye=Ve.label)!==null&&Ye!==void 0?Ye:Ve.value})})},[ir,qe,me,ce,Lr,ur,Mt]),ve=d2(Ce),Me=as(ve,1),Qe=Me[0],et=gm(function(J,Ae,Ue){var Fe=Lr(J);if(Gt(Fe),U&&Ht(""),o){var De=J;if(wt){var Ve=xm(J,ur,Mt,ir);De=Ve.map(function(ua){var ma=lr.get(ua);return ma?ma.node[ir.value]:ua})}var Ye=Ae||{triggerValue:void 0,selected:void 0},nt=Ye.triggerValue,yt=Ye.selected,dt=De;if(we){var It=V.filter(function(ua){return!De.includes(ua.value)});dt=[].concat(Ci(dt),Ci(It))}var Kt=Lr(dt),_r={preValue:ce,triggerValue:nt},Ar=!0;(we||Ue==="selection"&&!yt)&&(Ar=!1),v2(_r,nt,J,ot,Ar,ir),cr?_r.checked=yt:_r.selected=yt;var er=Pr?Kt:Kt.map(function(ua){return ua.value});o(qe?er:er[0],Pr?null:Kt.map(function(ua){return ua.label}),_r)}}),z=he.useCallback(function(J,Ae){var Ue,Fe=Ae.selected,De=Ae.source,Ve=Mt[J],Ye=Ve?.node,nt=(Ue=Ye?.[ir.value])!==null&&Ue!==void 0?Ue:J;if(!qe)et([nt],{selected:!0,triggerValue:nt},"option");else{var yt=Fe?[].concat(Ci(H),[nt]):me.filter(function(ma){return ma!==nt});if(wt){var dt=tr(yt),It=dt.missingRawValues,Kt=dt.existRawValues,_r=Kt.map(function(ma){return lr.get(ma).key}),Ar;if(Fe){var er=b0(_r,!0,Mt);Ar=er.checkedKeys}else{var ua=b0(_r,{checked:!1,halfCheckedKeys:Oe},Mt);Ar=ua.checkedKeys}yt=[].concat(Ci(It),Ci(Ar.map(function(ma){return Mt[ma].node[ir.value]})))}et(yt,{selected:Fe,triggerValue:nt},De||"option")}Fe||!qe?E?.(nt,A0(Ye)):w?.(nt,A0(Ye))},[tr,lr,Mt,ir,qe,H,et,wt,E,w,me,Oe]),Q=he.useCallback(function(J){if(pt){var Ae={};Object.defineProperty(Ae,"documentClickClose",{get:function(){return Hc(!1,"Second param of `onDropdownVisibleChange` has been removed."),!1}}),pt(J,Ae)}},[pt]),Y=gm(function(J,Ae){var Ue=J.map(function(Fe){return Fe.value});if(Ae.type==="clear"){et(Ue,{},"selection");return}Ae.values.length&&z(Ae.values[0].value,{selected:!1,source:"selection"})}),K=he.useMemo(function(){return{virtual:Nt,dropdownMatchSelectWidth:ut,listHeight:ue,listItemHeight:Ee,listItemScrollOffset:Ke,treeData:at,fieldNames:ir,onSelect:z,treeExpandAction:He}},[Nt,ut,ue,Ee,Ke,at,ir,z,He]),ee=he.useMemo(function(){return{checkable:cr,loadData:Le,treeLoadedKeys:it,onTreeLoad:ft,checkedKeys:me,halfCheckedKeys:Oe,treeDefaultExpandAll:ct,treeExpandedKeys:xt,treeDefaultExpandedKeys:ht,onTreeExpand:Yt,treeIcon:Zt,treeMotion:Xt,showTreeIcon:ge,switcherIcon:Qt,treeLine:tt,treeNodeFilterProp:re,keyEntities:Mt}},[cr,Le,it,ft,me,Oe,ct,xt,ht,Yt,Zt,Xt,ge,Qt,tt,re,Mt]);return he.createElement(Yg.Provider,{value:K},he.createElement(Kg.Provider,{value:ee},he.createElement(Hy,ln({ref:n},or,{id:Jt,prefixCls:u,mode:qe?"multiple":void 0,displayValues:Qe,onDisplayValuesChange:Y,searchValue:Nr,onSearch:br,OptionList:Jg,emptyOptions:!ot.length,onDropdownVisibleChange:Q,dropdownMatchSelectWidth:ut}))))}),tu=A2;tu.TreeNode=H0;tu.SHOW_ALL=W0;tu.SHOW_PARENT=q0;tu.SHOW_CHILD=Wh;const I2=e=>{const{componentCls:n,treePrefixCls:a,colorBgElevated:c}=e,u=`.${a}`;return[{[`${n}-dropdown`]:[{padding:`${La(e.paddingXS)} ${La(e.calc(e.paddingXS).div(2).equal())}`},Wy(a,Gh(e,{colorBgContainer:c})),{[u]:{borderRadius:0,[`${u}-list-holder-inner`]:{alignItems:"stretch",[`${u}-treenode`]:{[`${u}-node-content-wrapper`]:{flex:"auto"}}}}},qy(`${a}-checkbox`,e),{"&-rtl":{direction:"rtl",[`${u}-switcher${u}-switcher_close`]:{[`${u}-switcher-icon svg`]:{transform:"rotate(90deg)"}}}}]}]};function F2(e,n,a){return $0("TreeSelect",c=>{const u=Gh(c,{treePrefixCls:n});return[I2(u)]},Zy)(e,a)}var P2=function(e,n){var a={};for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&n.indexOf(c)<0&&(a[c]=e[c]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var u=0,c=Object.getOwnPropertySymbols(e);u<c.length;u++)n.indexOf(c[u])<0&&Object.prototype.propertyIsEnumerable.call(e,c[u])&&(a[c[u]]=e[c[u]]);return a};const M2=(e,n)=>{var a,c,{prefixCls:u,size:m,disabled:x,bordered:o=!0,className:E,rootClassName:w,treeCheckable:C,multiple:P,listHeight:M=256,listItemHeight:B=26,placement:U,notFoundContent:N,switcherIcon:j,treeLine:re,getPopupContainer:pe,popupClassName:X,dropdownClassName:le,treeIcon:ye=!1,transitionName:we,choiceTransitionName:ae="",status:ze,treeExpandAction:Ie,builtinPlacements:$e,dropdownMatchSelectWidth:je,popupMatchSelectWidth:Le,allowClear:it}=e,ft=P2(e,["prefixCls","size","disabled","bordered","className","rootClassName","treeCheckable","multiple","listHeight","listItemHeight","placement","notFoundContent","switcherIcon","treeLine","getPopupContainer","popupClassName","dropdownClassName","treeIcon","transitionName","choiceTransitionName","status","treeExpandAction","builtinPlacements","dropdownMatchSelectWidth","popupMatchSelectWidth","allowClear"]);const{getPopupContainer:ct,getPrefixCls:xt,renderEmpty:ht,direction:Yt,virtual:He,popupMatchSelectWidth:Nt,popupOverflow:Ft}=he.useContext(eu),ue=xt(),Te=xt("select",u),Ee=xt("select-tree",u),Se=xt("tree-select",u),{compactSize:Ke,compactItemClassnames:pt}=Ky(Te,Yt),_t=am(Te),ut=am(Se),[tt,Zt,ge]=Yy(Te,_t),[Qt]=F2(Se,Ee,ut),Xt=Ra(X||le,`${Se}-dropdown`,{[`${Se}-dropdown-rtl`]:Yt==="rtl"},w,ge,_t,ut,Zt),or=!!(C||P),Jt=nv(ft.suffixIcon,ft.showArrow),wt=(a=Le??je)!==null&&a!==void 0?a:Nt,{status:cr,hasFeedback:Pr,isFormItemInput:qe,feedbackIcon:Cr}=he.useContext(Jy),Br=sv(cr,ze),{suffixIcon:ar,removeIcon:Gt,clearIcon:ur}=Qy(Object.assign(Object.assign({},ft),{multiple:or,showSuffixIcon:Jt,hasFeedback:Pr,feedbackIcon:Cr,prefixCls:Te,componentName:"TreeSelect"})),ir=it===!0?{clearIcon:ur}:it;let Dr;N!==void 0?Dr=N:Dr=ht?.("Select")||he.createElement(ev,{componentName:"Select"});const wr=Og(ft,["suffixIcon","itemIcon","removeIcon","clearIcon","switcherIcon"]),Nr=he.useMemo(()=>U!==void 0?U:Yt==="rtl"?"bottomRight":"bottomLeft",[U,Yt]),Ht=tv(at=>{var Rt;return(Rt=m??Ke)!==null&&Rt!==void 0?Rt:at}),br=he.useContext(zg),ot=x??br,Pt=Ra(!u&&Se,{[`${Te}-lg`]:Ht==="large",[`${Te}-sm`]:Ht==="small",[`${Te}-rtl`]:Yt==="rtl",[`${Te}-borderless`]:!o,[`${Te}-in-form-item`]:qe},rv(Te,Br,Pr),pt,E,w,ge,_t,ut,Zt),Mt=at=>he.createElement(ov,{prefixCls:Ee,switcherIcon:j,treeNodeProps:at,showLine:re}),[lr]=av("SelectLike",(c=ft.dropdownStyle)===null||c===void 0?void 0:c.zIndex),tr=he.createElement(tu,Object.assign({virtual:He,disabled:ot},wr,{dropdownMatchSelectWidth:wt,builtinPlacements:iv($e,Ft),ref:n,prefixCls:Te,className:Pt,listHeight:M,listItemHeight:B,treeCheckable:C&&he.createElement("span",{className:`${Te}-tree-checkbox-inner`}),treeLine:!!re,suffixIcon:ar,multiple:or,placement:Nr,removeIcon:Gt,allowClear:ir,switcherIcon:Mt,showTreeIcon:ye,notFoundContent:Dr,getPopupContainer:pe||ct,treeMotion:null,dropdownClassName:Xt,dropdownStyle:Object.assign(Object.assign({},ft.dropdownStyle),{zIndex:lr}),choiceTransitionName:im(ue,"",ae),transitionName:im(ue,"slide-up",we),treeExpandAction:Ie}));return tt(Qt(tr))},D2=he.forwardRef(M2),_o=D2,L2=Xy(_o);_o.TreeNode=H0;_o.SHOW_ALL=W0;_o.SHOW_PARENT=q0;_o.SHOW_CHILD=Wh;_o._InternalPanelDoNotUseOrYouWillBeFired=L2;const R2=_o,n0=function(e,n){if(e&&n){var a=Array.isArray(n)?n:n.split(","),c=e.name||"",u=e.type||"",m=u.replace(/\/.*$/,"");return a.some(function(x){var o=x.trim();if(/^\*(\/\*)?$/.test(x))return!0;if(o.charAt(0)==="."){var E=c.toLowerCase(),w=o.toLowerCase(),C=[w];return(w===".jpg"||w===".jpeg")&&(C=[".jpg",".jpeg"]),C.some(function(P){return E.endsWith(P)})}return/\/\*$/.test(o)?m===o.replace(/\/.*$/,""):u===o?!0:/^\w+$/.test(o)?(Hc(!1,"Upload takes an invalidate 'accept' type '".concat(o,"'.Skip for check.")),!0):!1})}return!0};function O2(e,n){var a="cannot ".concat(e.method," ").concat(e.action," ").concat(n.status,"'"),c=new Error(a);return c.status=n.status,c.method=e.method,c.url=e.action,c}function _m(e){var n=e.responseText||e.response;if(!n)return n;try{return JSON.parse(n)}catch{return n}}function B2(e){var n=new XMLHttpRequest;e.onProgress&&n.upload&&(n.upload.onprogress=function(m){m.total>0&&(m.percent=m.loaded/m.total*100),e.onProgress(m)});var a=new FormData;e.data&&Object.keys(e.data).forEach(function(u){var m=e.data[u];if(Array.isArray(m)){m.forEach(function(x){a.append("".concat(u,"[]"),x)});return}a.append(u,m)}),e.file instanceof Blob?a.append(e.filename,e.file,e.file.name):a.append(e.filename,e.file),n.onerror=function(m){e.onError(m)},n.onload=function(){return n.status<200||n.status>=300?e.onError(O2(e,n),_m(n)):e.onSuccess(_m(n),n)},n.open(e.method,e.action,!0),e.withCredentials&&"withCredentials"in n&&(n.withCredentials=!0);var c=e.headers||{};return c["X-Requested-With"]!==null&&n.setRequestHeader("X-Requested-With","XMLHttpRequest"),Object.keys(c).forEach(function(u){c[u]!==null&&n.setRequestHeader(u,c[u])}),n.send(a),{abort:function(){n.abort()}}}function z2(e,n){var a=e.createReader(),c=[];function u(){a.readEntries(function(m){var x=Array.prototype.slice.apply(m);c=c.concat(x);var o=!x.length;o?n(c):u()})}u()}var N2=function(n,a,c){var u=function m(x,o){x&&(x.path=o||"",x.isFile?x.file(function(E){c(E)&&(x.fullPath&&!E.webkitRelativePath&&(Object.defineProperties(E,{webkitRelativePath:{writable:!0}}),E.webkitRelativePath=x.fullPath.replace(/^\//,""),Object.defineProperties(E,{webkitRelativePath:{writable:!1}})),a([E]))}):x.isDirectory&&z2(x,function(E){E.forEach(function(w){m(w,"".concat(o).concat(x.name,"/"))})}))};n.forEach(function(m){u(m.webkitGetAsEntry())})},U2=+new Date,V2=0;function s0(){return"rc-upload-".concat(U2,"-").concat(++V2)}var $2=["component","prefixCls","className","classNames","disabled","id","style","styles","multiple","accept","capture","children","directory","openFileDialogOnClick","onMouseEnter","onMouseLeave","hasControlInside"],j2=function(e){Ng(a,e);var n=Ug(a);function a(){var c;Vg(this,a);for(var u=arguments.length,m=new Array(u),x=0;x<u;x++)m[x]=arguments[x];return c=n.call.apply(n,[this].concat(m)),$a(Gi(c),"state",{uid:s0()}),$a(Gi(c),"reqs",{}),$a(Gi(c),"fileInput",void 0),$a(Gi(c),"_isMounted",void 0),$a(Gi(c),"onChange",function(o){var E=c.props,w=E.accept,C=E.directory,P=o.target.files,M=Ci(P).filter(function(B){return!C||n0(B,w)});c.uploadFiles(M),c.reset()}),$a(Gi(c),"onClick",function(o){var E=c.fileInput;if(E){var w=o.target,C=c.props.onClick;if(w&&w.tagName==="BUTTON"){var P=E.parentNode;P.focus(),w.blur()}E.click(),C&&C(o)}}),$a(Gi(c),"onKeyDown",function(o){o.key==="Enter"&&c.onClick(o)}),$a(Gi(c),"onFileDrop",function(o){var E=c.props.multiple;if(o.preventDefault(),o.type!=="dragover")if(c.props.directory)N2(Array.prototype.slice.call(o.dataTransfer.items),c.uploadFiles,function(C){return n0(C,c.props.accept)});else{var w=Ci(o.dataTransfer.files).filter(function(C){return n0(C,c.props.accept)});E===!1&&(w=w.slice(0,1)),c.uploadFiles(w)}}),$a(Gi(c),"uploadFiles",function(o){var E=Ci(o),w=E.map(function(C){return C.uid=s0(),c.processFile(C,E)});Promise.all(w).then(function(C){var P=c.props.onBatchStart;P?.(C.map(function(M){var B=M.origin,U=M.parsedFile;return{file:B,parsedFile:U}})),C.filter(function(M){return M.parsedFile!==null}).forEach(function(M){c.post(M)})})}),$a(Gi(c),"processFile",function(){var o=cv(nm().mark(function E(w,C){var P,M,B,U,N,j,re,pe,X;return nm().wrap(function(ye){for(;;)switch(ye.prev=ye.next){case 0:if(P=c.props.beforeUpload,M=w,!P){ye.next=14;break}return ye.prev=3,ye.next=6,P(w,C);case 6:M=ye.sent,ye.next=12;break;case 9:ye.prev=9,ye.t0=ye.catch(3),M=!1;case 12:if(M!==!1){ye.next=14;break}return ye.abrupt("return",{origin:w,parsedFile:null,action:null,data:null});case 14:if(B=c.props.action,typeof B!="function"){ye.next=21;break}return ye.next=18,B(w);case 18:U=ye.sent,ye.next=22;break;case 21:U=B;case 22:if(N=c.props.data,typeof N!="function"){ye.next=29;break}return ye.next=26,N(w);case 26:j=ye.sent,ye.next=30;break;case 29:j=N;case 30:return re=(lo(M)==="object"||typeof M=="string")&&M?M:w,re instanceof File?pe=re:pe=new File([re],w.name,{type:w.type}),X=pe,X.uid=w.uid,ye.abrupt("return",{origin:w,data:j,parsedFile:X,action:U});case 35:case"end":return ye.stop()}},E,null,[[3,9]])}));return function(E,w){return o.apply(this,arguments)}}()),$a(Gi(c),"saveFileInput",function(o){c.fileInput=o}),c}return $g(a,[{key:"componentDidMount",value:function(){this._isMounted=!0}},{key:"componentWillUnmount",value:function(){this._isMounted=!1,this.abort()}},{key:"post",value:function(u){var m=this,x=u.data,o=u.origin,E=u.action,w=u.parsedFile;if(this._isMounted){var C=this.props,P=C.onStart,M=C.customRequest,B=C.name,U=C.headers,N=C.withCredentials,j=C.method,re=o.uid,pe=M||B2,X={action:E,filename:B,data:x,file:w,headers:U,withCredentials:N,method:j||"post",onProgress:function(ye){var we=m.props.onProgress;we?.(ye,w)},onSuccess:function(ye,we){var ae=m.props.onSuccess;ae?.(ye,w,we),delete m.reqs[re]},onError:function(ye,we){var ae=m.props.onError;ae?.(ye,we,w),delete m.reqs[re]}};P(o),this.reqs[re]=pe(X)}}},{key:"reset",value:function(){this.setState({uid:s0()})}},{key:"abort",value:function(u){var m=this.reqs;if(u){var x=u.uid?u.uid:u;m[x]&&m[x].abort&&m[x].abort(),delete m[x]}else Object.keys(m).forEach(function(o){m[o]&&m[o].abort&&m[o].abort(),delete m[o]})}},{key:"render",value:function(){var u,m=this.props,x=m.component,o=m.prefixCls,E=m.className,w=m.classNames,C=w===void 0?{}:w,P=m.disabled,M=m.id,B=m.style,U=m.styles,N=U===void 0?{}:U,j=m.multiple,re=m.accept,pe=m.capture,X=m.children,le=m.directory,ye=m.openFileDialogOnClick,we=m.onMouseEnter,ae=m.onMouseLeave,ze=m.hasControlInside,Ie=jh(m,$2),$e=Ra((u={},$a(u,o,!0),$a(u,"".concat(o,"-disabled"),P),$a(u,E,E),u)),je=le?{directory:"directory",webkitdirectory:"webkitdirectory"}:{},Le=P?{}:{onClick:ye?this.onClick:function(){},onKeyDown:ye?this.onKeyDown:function(){},onMouseEnter:we,onMouseLeave:ae,onDrop:this.onFileDrop,onDragOver:this.onFileDrop,tabIndex:ze?void 0:"0"};return E0.createElement(x,ln({},Le,{className:$e,role:ze?void 0:"button",style:B}),E0.createElement("input",ln({},lv(Ie,{aria:!0,data:!0}),{id:M,disabled:P,type:"file",ref:this.saveFileInput,onClick:function(ft){return ft.stopPropagation()},key:this.state.uid,style:Fi({display:"none"},N.input),className:C.input,accept:re},je,{multiple:j,onChange:this.onChange},pe!=null?{capture:pe}:{})),X)}}]),a}(he.Component);function o0(){}var I0=function(e){Ng(a,e);var n=Ug(a);function a(){var c;Vg(this,a);for(var u=arguments.length,m=new Array(u),x=0;x<u;x++)m[x]=arguments[x];return c=n.call.apply(n,[this].concat(m)),$a(Gi(c),"uploader",void 0),$a(Gi(c),"saveUploader",function(o){c.uploader=o}),c}return $g(a,[{key:"abort",value:function(u){this.uploader.abort(u)}},{key:"render",value:function(){return E0.createElement(j2,ln({},this.props,{ref:this.saveUploader}))}}]),a}(he.Component);$a(I0,"defaultProps",{component:"span",prefixCls:"rc-upload",data:{},headers:{},name:"file",multipart:!1,onStart:o0,onError:o0,onSuccess:o0,multiple:!1,beforeUpload:null,customRequest:null,withCredentials:!1,openFileDialogOnClick:!0,hasControlInside:!1});const G2=e=>{const{componentCls:n,iconCls:a}=e;return{[`${n}-wrapper`]:{[`${n}-drag`]:{position:"relative",width:"100%",height:"100%",textAlign:"center",background:e.colorFillAlter,border:`${La(e.lineWidth)} dashed ${e.colorBorder}`,borderRadius:e.borderRadiusLG,cursor:"pointer",transition:`border-color ${e.motionDurationSlow}`,[n]:{padding:e.padding},[`${n}-btn`]:{display:"table",width:"100%",height:"100%",outline:"none",borderRadius:e.borderRadiusLG,"&:focus-visible":{outline:`${La(e.lineWidthFocus)} solid ${e.colorPrimaryBorder}`}},[`${n}-drag-container`]:{display:"table-cell",verticalAlign:"middle"},[`
          &:not(${n}-disabled):hover,
          &-hover:not(${n}-disabled)
        `]:{borderColor:e.colorPrimaryHover},[`p${n}-drag-icon`]:{marginBottom:e.margin,[a]:{color:e.colorPrimary,fontSize:e.uploadThumbnailSize}},[`p${n}-text`]:{margin:`0 0 ${La(e.marginXXS)}`,color:e.colorTextHeading,fontSize:e.fontSizeLG},[`p${n}-hint`]:{color:e.colorTextDescription,fontSize:e.fontSize},[`&${n}-disabled`]:{[`p${n}-drag-icon ${a},
            p${n}-text,
            p${n}-hint
          `]:{color:e.colorTextDisabled}}}}}},H2=e=>{const{componentCls:n,antCls:a,iconCls:c,fontSize:u,lineHeight:m,calc:x}=e,o=`${n}-list-item`,E=`${o}-actions`,w=`${o}-action`,C=e.fontHeightSM;return{[`${n}-wrapper`]:{[`${n}-list`]:Object.assign(Object.assign({},jg()),{lineHeight:e.lineHeight,[o]:{position:"relative",height:x(e.lineHeight).mul(u).equal(),marginTop:e.marginXS,fontSize:u,display:"flex",alignItems:"center",transition:`background-color ${e.motionDurationSlow}`,"&:hover":{backgroundColor:e.controlItemBgHover},[`${o}-name`]:Object.assign(Object.assign({},Gg),{padding:`0 ${La(e.paddingXS)}`,lineHeight:m,flex:"auto",transition:`all ${e.motionDurationSlow}`}),[E]:{[w]:{opacity:0},[c]:{color:e.actionsColor,transition:`all ${e.motionDurationSlow}`},[`
              ${w}:focus-visible,
              &.picture ${w}
            `]:{opacity:1},[`${w}${a}-btn`]:{height:C,border:0,lineHeight:1}},[`${n}-icon ${c}`]:{color:e.colorTextDescription,fontSize:u},[`${o}-progress`]:{position:"absolute",bottom:e.calc(e.uploadProgressOffset).mul(-1).equal(),width:"100%",paddingInlineStart:x(u).add(e.paddingXS).equal(),fontSize:u,lineHeight:0,pointerEvents:"none","> div":{margin:0}}},[`${o}:hover ${w}`]:{opacity:1},[`${o}-error`]:{color:e.colorError,[`${o}-name, ${n}-icon ${c}`]:{color:e.colorError},[E]:{[`${c}, ${c}:hover`]:{color:e.colorError},[w]:{opacity:1}}},[`${n}-list-item-container`]:{transition:`opacity ${e.motionDurationSlow}, height ${e.motionDurationSlow}`,"&::before":{display:"table",width:0,height:0,content:'""'}}})}}},ym=new j0("uploadAnimateInlineIn",{from:{width:0,height:0,margin:0,padding:0,opacity:0}}),vm=new j0("uploadAnimateInlineOut",{to:{width:0,height:0,margin:0,padding:0,opacity:0}}),W2=e=>{const{componentCls:n}=e,a=`${n}-animate-inline`;return[{[`${n}-wrapper`]:{[`${a}-appear, ${a}-enter, ${a}-leave`]:{animationDuration:e.motionDurationSlow,animationTimingFunction:e.motionEaseInOutCirc,animationFillMode:"forwards"},[`${a}-appear, ${a}-enter`]:{animationName:ym},[`${a}-leave`]:{animationName:vm}}},{[`${n}-wrapper`]:Av(e)},ym,vm]},q2=e=>{const{componentCls:n,iconCls:a,uploadThumbnailSize:c,uploadProgressOffset:u,calc:m}=e,x=`${n}-list`,o=`${x}-item`;return{[`${n}-wrapper`]:{[`
        ${x}${x}-picture,
        ${x}${x}-picture-card,
        ${x}${x}-picture-circle
      `]:{[o]:{position:"relative",height:m(c).add(m(e.lineWidth).mul(2)).add(m(e.paddingXS).mul(2)).equal(),padding:e.paddingXS,border:`${La(e.lineWidth)} ${e.lineType} ${e.colorBorder}`,borderRadius:e.borderRadiusLG,"&:hover":{background:"transparent"},[`${o}-thumbnail`]:Object.assign(Object.assign({},Gg),{width:c,height:c,lineHeight:La(m(c).add(e.paddingSM).equal()),textAlign:"center",flex:"none",[a]:{fontSize:e.fontSizeHeading2,color:e.colorPrimary},img:{display:"block",width:"100%",height:"100%",overflow:"hidden"}}),[`${o}-progress`]:{bottom:u,width:`calc(100% - ${La(m(e.paddingSM).mul(2).equal())})`,marginTop:0,paddingInlineStart:m(c).add(e.paddingXS).equal()}},[`${o}-error`]:{borderColor:e.colorError,[`${o}-thumbnail ${a}`]:{[`svg path[fill='${sm[0]}']`]:{fill:e.colorErrorBg},[`svg path[fill='${sm.primary}']`]:{fill:e.colorError}}},[`${o}-uploading`]:{borderStyle:"dashed",[`${o}-name`]:{marginBottom:u}}},[`${x}${x}-picture-circle ${o}`]:{[`&, &::before, ${o}-thumbnail`]:{borderRadius:"50%"}}}}},Z2=e=>{const{componentCls:n,iconCls:a,fontSizeLG:c,colorTextLightSolid:u,calc:m}=e,x=`${n}-list`,o=`${x}-item`,E=e.uploadPicCardSize;return{[`
      ${n}-wrapper${n}-picture-card-wrapper,
      ${n}-wrapper${n}-picture-circle-wrapper
    `]:Object.assign(Object.assign({},jg()),{display:"inline-block",width:"100%",[`${n}${n}-select`]:{width:E,height:E,marginInlineEnd:e.marginXS,marginBottom:e.marginXS,textAlign:"center",verticalAlign:"top",backgroundColor:e.colorFillAlter,border:`${La(e.lineWidth)} dashed ${e.colorBorder}`,borderRadius:e.borderRadiusLG,cursor:"pointer",transition:`border-color ${e.motionDurationSlow}`,[`> ${n}`]:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",textAlign:"center"},[`&:not(${n}-disabled):hover`]:{borderColor:e.colorPrimary}},[`${x}${x}-picture-card, ${x}${x}-picture-circle`]:{[`${x}-item-container`]:{display:"inline-block",width:E,height:E,marginBlock:`0 ${La(e.marginXS)}`,marginInline:`0 ${La(e.marginXS)}`,verticalAlign:"top"},"&::after":{display:"none"},[o]:{height:"100%",margin:0,"&::before":{position:"absolute",zIndex:1,width:`calc(100% - ${La(m(e.paddingXS).mul(2).equal())})`,height:`calc(100% - ${La(m(e.paddingXS).mul(2).equal())})`,backgroundColor:e.colorBgMask,opacity:0,transition:`all ${e.motionDurationSlow}`,content:'" "'}},[`${o}:hover`]:{[`&::before, ${o}-actions`]:{opacity:1}},[`${o}-actions`]:{position:"absolute",insetInlineStart:0,zIndex:10,width:"100%",whiteSpace:"nowrap",textAlign:"center",opacity:0,transition:`all ${e.motionDurationSlow}`,[`
            ${a}-eye,
            ${a}-download,
            ${a}-delete
          `]:{zIndex:10,width:c,margin:`0 ${La(e.marginXXS)}`,fontSize:c,cursor:"pointer",transition:`all ${e.motionDurationSlow}`,color:u,"&:hover":{color:u},svg:{verticalAlign:"baseline"}}},[`${o}-thumbnail, ${o}-thumbnail img`]:{position:"static",display:"block",width:"100%",height:"100%",objectFit:"contain"},[`${o}-name`]:{display:"none",textAlign:"center"},[`${o}-file + ${o}-name`]:{position:"absolute",bottom:e.margin,display:"block",width:`calc(100% - ${La(m(e.paddingXS).mul(2).equal())})`},[`${o}-uploading`]:{[`&${o}`]:{backgroundColor:e.colorFillAlter},[`&::before, ${a}-eye, ${a}-download, ${a}-delete`]:{display:"none"}},[`${o}-progress`]:{bottom:e.marginXL,width:`calc(100% - ${La(m(e.paddingXS).mul(2).equal())})`,paddingInlineStart:0}}}),[`${n}-wrapper${n}-picture-circle-wrapper`]:{[`${n}${n}-select`]:{borderRadius:"50%"}}}},X2=e=>{const{componentCls:n}=e;return{[`${n}-rtl`]:{direction:"rtl"}}},K2=e=>{const{componentCls:n,colorTextDisabled:a}=e;return{[`${n}-wrapper`]:Object.assign(Object.assign({},Rg(e)),{[n]:{outline:0,"input[type='file']":{cursor:"pointer"}},[`${n}-select`]:{display:"inline-block"},[`${n}-disabled`]:{color:a,cursor:"not-allowed"}})}},Y2=e=>({actionsColor:e.colorTextDescription}),J2=$0("Upload",e=>{const{fontSizeHeading3:n,fontHeight:a,lineWidth:c,controlHeightLG:u,calc:m}=e,x=Gh(e,{uploadThumbnailSize:m(n).mul(2).equal(),uploadProgressOffset:m(m(a).div(2)).add(c).equal(),uploadPicCardSize:m(u).mul(2.55).equal()});return[K2(x),G2(x),q2(x),Z2(x),H2(x),W2(x),X2(x),uv(x)]},Y2);var Q2={icon:function(n,a){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M534 352V136H232v752h560V394H576a42 42 0 01-42-42z",fill:a}},{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM602 137.8L790.2 326H602V137.8zM792 888H232V136h302v216a42 42 0 0042 42h216v494z",fill:n}}]}},name:"file",theme:"twotone"};const ew=Q2;var tw=function(n,a){return he.createElement(vl,ln({},n,{ref:a,icon:ew}))};const rw=he.forwardRef(tw);var aw={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M779.3 196.6c-94.2-94.2-247.6-94.2-341.7 0l-261 260.8c-1.7 1.7-2.6 4-2.6 6.4s.9 4.7 2.6 6.4l36.9 36.9a9 9 0 0012.7 0l261-260.8c32.4-32.4 75.5-50.2 121.3-50.2s88.9 17.8 121.2 50.2c32.4 32.4 50.2 75.5 50.2 121.2 0 45.8-17.8 88.8-50.2 121.2l-266 265.9-43.1 43.1c-40.3 40.3-105.8 40.3-146.1 0-19.5-19.5-30.2-45.4-30.2-73s10.7-53.5 30.2-73l263.9-263.8c6.7-6.6 15.5-10.3 24.9-10.3h.1c9.4 0 18.1 3.7 24.7 10.3 6.7 6.7 10.3 15.5 10.3 24.9 0 9.3-3.7 18.1-10.3 24.7L372.4 653c-1.7 1.7-2.6 4-2.6 6.4s.9 4.7 2.6 6.4l36.9 36.9a9 9 0 0012.7 0l215.6-215.6c19.9-19.9 30.8-46.3 30.8-74.4s-11-54.6-30.8-74.4c-41.1-41.1-107.9-41-149 0L463 364 224.8 602.1A172.22 172.22 0 00174 724.8c0 46.3 18.1 89.8 50.8 122.5 33.9 33.8 78.3 50.7 122.7 50.7 44.4 0 88.8-16.9 122.6-50.7l309.2-309C824.8 492.7 850 432 850 367.5c.1-64.6-25.1-125.3-70.7-170.9z"}}]},name:"paper-clip",theme:"outlined"};const iw=aw;var nw=function(n,a){return he.createElement(vl,ln({},n,{ref:a,icon:iw}))};const sw=he.forwardRef(nw);var ow={icon:function(n,a){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 632H136v-39.9l138.5-164.3 150.1 178L658.1 489 888 761.6V792zm0-129.8L664.2 396.8c-3.2-3.8-9-3.8-12.2 0L424.6 666.4l-144-170.7c-3.2-3.8-9-3.8-12.2 0L136 652.7V232h752v430.2z",fill:n}},{tag:"path",attrs:{d:"M424.6 765.8l-150.1-178L136 752.1V792h752v-30.4L658.1 489z",fill:a}},{tag:"path",attrs:{d:"M136 652.7l132.4-157c3.2-3.8 9-3.8 12.2 0l144 170.7L652 396.8c3.2-3.8 9-3.8 12.2 0L888 662.2V232H136v420.7zM304 280a88 88 0 110 176 88 88 0 010-176z",fill:a}},{tag:"path",attrs:{d:"M276 368a28 28 0 1056 0 28 28 0 10-56 0z",fill:a}},{tag:"path",attrs:{d:"M304 456a88 88 0 100-176 88 88 0 000 176zm0-116c15.5 0 28 12.5 28 28s-12.5 28-28 28-28-12.5-28-28 12.5-28 28-28z",fill:n}}]}},name:"picture",theme:"twotone"};const lw=ow;var cw=function(n,a){return he.createElement(vl,ln({},n,{ref:a,icon:lw}))};const uw=he.forwardRef(cw);function mh(e){return Object.assign(Object.assign({},e),{lastModified:e.lastModified,lastModifiedDate:e.lastModifiedDate,name:e.name,size:e.size,type:e.type,uid:e.uid,percent:0,originFileObj:e})}function gh(e,n){const a=Ci(n),c=a.findIndex(u=>{let{uid:m}=u;return m===e.uid});return c===-1?a.push(e):a[c]=e,a}function l0(e,n){const a=e.uid!==void 0?"uid":"name";return n.filter(c=>c[a]===e[a])[0]}function hw(e,n){const a=e.uid!==void 0?"uid":"name",c=n.filter(u=>u[a]!==e[a]);return c.length===n.length?null:c}const fw=function(){const n=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:"").split("/"),c=n[n.length-1].split(/#|\?/)[0];return(/\.[^./\\]*$/.exec(c)||[""])[0]},Qg=e=>e.indexOf("image/")===0,dw=e=>{if(e.type&&!e.thumbUrl)return Qg(e.type);const n=e.thumbUrl||e.url||"",a=fw(n);return/^data:image\//.test(n)||/(webp|svg|png|gif|jpg|jpeg|jfif|bmp|dpg|ico|heic|heif)$/i.test(a)?!0:!(/^data:/.test(n)||a)},As=200;function pw(e){return new Promise(n=>{if(!e.type||!Qg(e.type)){n("");return}const a=document.createElement("canvas");a.width=As,a.height=As,a.style.cssText=`position: fixed; left: 0; top: 0; width: ${As}px; height: ${As}px; z-index: 9999; display: none;`,document.body.appendChild(a);const c=a.getContext("2d"),u=new Image;if(u.onload=()=>{const{width:m,height:x}=u;let o=As,E=As,w=0,C=0;m>x?(E=x*(As/m),C=-(E-o)/2):(o=m*(As/x),w=-(o-E)/2),c.drawImage(u,w,C,o,E);const P=a.toDataURL();document.body.removeChild(a),window.URL.revokeObjectURL(u.src),n(P)},u.crossOrigin="anonymous",e.type.startsWith("image/svg+xml")){const m=new FileReader;m.onload=()=>{m.result&&(u.src=m.result)},m.readAsDataURL(e)}else if(e.type.startsWith("image/gif")){const m=new FileReader;m.onload=()=>{m.result&&n(m.result)},m.readAsDataURL(e)}else u.src=window.URL.createObjectURL(e)})}var mw={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M505.7 661a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9h-74.1V168c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v338.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.8zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"download",theme:"outlined"};const gw=mw;var xw=function(n,a){return he.createElement(vl,ln({},n,{ref:a,icon:gw}))};const e1=he.forwardRef(xw),_w=he.forwardRef((e,n)=>{let{prefixCls:a,className:c,style:u,locale:m,listType:x,file:o,items:E,progress:w,iconRender:C,actionIconRender:P,itemRender:M,isImgUrl:B,showPreviewIcon:U,showRemoveIcon:N,showDownloadIcon:j,previewIcon:re,removeIcon:pe,downloadIcon:X,onPreview:le,onDownload:ye,onClose:we}=e;var ae,ze;const{status:Ie}=o,[$e,je]=he.useState(Ie);he.useEffect(()=>{Ie!=="removed"&&je(Ie)},[Ie]);const[Le,it]=he.useState(!1);he.useEffect(()=>{const tt=setTimeout(()=>{it(!0)},300);return()=>{clearTimeout(tt)}},[]);const ft=C(o);let ct=he.createElement("div",{className:`${a}-icon`},ft);if(x==="picture"||x==="picture-card"||x==="picture-circle")if($e==="uploading"||!o.thumbUrl&&!o.url){const tt=Ra(`${a}-list-item-thumbnail`,{[`${a}-list-item-file`]:$e!=="uploading"});ct=he.createElement("div",{className:tt},ft)}else{const tt=B?.(o)?he.createElement("img",{src:o.thumbUrl||o.url,alt:o.name,className:`${a}-list-item-image`,crossOrigin:o.crossOrigin}):ft,Zt=Ra(`${a}-list-item-thumbnail`,{[`${a}-list-item-file`]:B&&!B(o)});ct=he.createElement("a",{className:Zt,onClick:ge=>le(o,ge),href:o.url||o.thumbUrl,target:"_blank",rel:"noopener noreferrer"},tt)}const xt=Ra(`${a}-list-item`,`${a}-list-item-${$e}`),ht=typeof o.linkProps=="string"?JSON.parse(o.linkProps):o.linkProps,Yt=N?P((typeof pe=="function"?pe(o):pe)||he.createElement(Zg,null),()=>we(o),a,m.removeFile,!0):null,He=j&&$e==="done"?P((typeof X=="function"?X(o):X)||he.createElement(e1,null),()=>ye(o),a,m.downloadFile):null,Nt=x!=="picture-card"&&x!=="picture-circle"&&he.createElement("span",{key:"download-delete",className:Ra(`${a}-list-item-actions`,{picture:x==="picture"})},He,Yt),Ft=Ra(`${a}-list-item-name`),ue=o.url?[he.createElement("a",Object.assign({key:"view",target:"_blank",rel:"noopener noreferrer",className:Ft,title:o.name},ht,{href:o.url,onClick:tt=>le(o,tt)}),o.name),Nt]:[he.createElement("span",{key:"view",className:Ft,onClick:tt=>le(o,tt),title:o.name},o.name),Nt],Te=U&&(o.url||o.thumbUrl)?he.createElement("a",{href:o.url||o.thumbUrl,target:"_blank",rel:"noopener noreferrer",onClick:tt=>le(o,tt),title:m.previewFile},typeof re=="function"?re(o):re||he.createElement(hv,null)):null,Ee=(x==="picture-card"||x==="picture-circle")&&$e!=="uploading"&&he.createElement("span",{className:`${a}-list-item-actions`},Te,$e==="done"&&He,Yt),{getPrefixCls:Se}=he.useContext(eu),Ke=Se(),pt=he.createElement("div",{className:xt},ct,ue,Ee,Le&&he.createElement(Hg,{motionName:`${Ke}-fade`,visible:$e==="uploading",motionDeadline:2e3},tt=>{let{className:Zt}=tt;const ge="percent"in o?he.createElement(c2,Object.assign({},w,{type:"line",percent:o.percent,"aria-label":o["aria-label"],"aria-labelledby":o["aria-labelledby"]})):null;return he.createElement("div",{className:Ra(`${a}-list-item-progress`,Zt)},ge)})),_t=o.response&&typeof o.response=="string"?o.response:((ae=o.error)===null||ae===void 0?void 0:ae.statusText)||((ze=o.error)===null||ze===void 0?void 0:ze.message)||m.uploadError,ut=$e==="error"?he.createElement(Lg,{title:_t,getPopupContainer:tt=>tt.parentNode},pt):pt;return he.createElement("div",{className:Ra(`${a}-list-item-container`,c),style:u,ref:n},M?M(ut,o,E,{download:ye.bind(null,o),preview:le.bind(null,o),remove:we.bind(null,o)}):ut)}),yw=_w,vw=(e,n)=>{const{listType:a="text",previewFile:c=pw,onPreview:u,onDownload:m,onRemove:x,locale:o,iconRender:E,isImageUrl:w=dw,prefixCls:C,items:P=[],showPreviewIcon:M=!0,showRemoveIcon:B=!0,showDownloadIcon:U=!1,removeIcon:N,previewIcon:j,downloadIcon:re,progress:pe={size:[-1,2],showInfo:!1},appendAction:X,appendActionVisible:le=!0,itemRender:ye,disabled:we}=e,ae=fv(),[ze,Ie]=he.useState(!1);he.useEffect(()=>{a!=="picture"&&a!=="picture-card"&&a!=="picture-circle"||(P||[]).forEach(Te=>{typeof document>"u"||typeof window>"u"||!window.FileReader||!window.File||!(Te.originFileObj instanceof File||Te.originFileObj instanceof Blob)||Te.thumbUrl!==void 0||(Te.thumbUrl="",c&&c(Te.originFileObj).then(Ee=>{Te.thumbUrl=Ee||"",ae()}))})},[a,P,c]),he.useEffect(()=>{Ie(!0)},[]);const $e=(Te,Ee)=>{if(u)return Ee?.preventDefault(),u(Te)},je=Te=>{typeof m=="function"?m(Te):Te.url&&window.open(Te.url)},Le=Te=>{x?.(Te)},it=Te=>{if(E)return E(Te,a);const Ee=Te.status==="uploading",Se=w&&w(Te)?he.createElement(uw,null):he.createElement(rw,null);let Ke=Ee?he.createElement(lm,null):he.createElement(sw,null);return a==="picture"?Ke=Ee?he.createElement(lm,null):Se:(a==="picture-card"||a==="picture-circle")&&(Ke=Ee?o.uploading:Se),Ke},ft=(Te,Ee,Se,Ke,pt)=>{const _t={type:"text",size:"small",title:Ke,onClick:ut=>{Ee(),cm(Te)&&Te.props.onClick&&Te.props.onClick(ut)},className:`${Se}-list-item-action`};if(pt&&(_t.disabled=we),cm(Te)){const ut=om(Te,Object.assign(Object.assign({},Te.props),{onClick:()=>{}}));return he.createElement(uo,Object.assign({},_t,{icon:ut}))}return he.createElement(uo,Object.assign({},_t),he.createElement("span",null,Te))};he.useImperativeHandle(n,()=>({handlePreview:$e,handleDownload:je}));const{getPrefixCls:ct}=he.useContext(eu),xt=ct("upload",C),ht=ct(),Yt=Ra(`${xt}-list`,`${xt}-list-${a}`),He=Ci(P.map(Te=>({key:Te.uid,file:Te})));let Ft={motionDeadline:2e3,motionName:`${xt}-${a==="picture-card"||a==="picture-circle"?"animate-inline":"animate"}`,keys:He,motionAppear:ze};const ue=he.useMemo(()=>{const Te=Object.assign({},dv(ht));return delete Te.onAppearEnd,delete Te.onEnterEnd,delete Te.onLeaveEnd,Te},[ht]);return a!=="picture-card"&&a!=="picture-circle"&&(Ft=Object.assign(Object.assign({},ue),Ft)),he.createElement("div",{className:Yt},he.createElement(pv,Object.assign({},Ft,{component:!1}),Te=>{let{key:Ee,file:Se,className:Ke,style:pt}=Te;return he.createElement(yw,{key:Ee,locale:o,prefixCls:xt,className:Ke,style:pt,file:Se,items:P,progress:pe,listType:a,isImgUrl:w,showPreviewIcon:M,showRemoveIcon:B,showDownloadIcon:U,removeIcon:N,previewIcon:j,downloadIcon:re,iconRender:it,actionIconRender:ft,itemRender:ye,onPreview:$e,onDownload:je,onClose:Le})}),X&&he.createElement(Hg,Object.assign({},Ft,{visible:le,forceRender:!0}),Te=>{let{className:Ee,style:Se}=Te;return om(X,Ke=>({className:Ra(Ke.className,Ee),style:Object.assign(Object.assign(Object.assign({},Se),{pointerEvents:Ee?"none":void 0}),Ke.style)}))}))},ww=he.forwardRef(vw),bw=ww;var Tw=function(e,n,a,c){function u(m){return m instanceof a?m:new a(function(x){x(m)})}return new(a||(a=Promise))(function(m,x){function o(C){try{w(c.next(C))}catch(P){x(P)}}function E(C){try{w(c.throw(C))}catch(P){x(P)}}function w(C){C.done?m(C.value):u(C.value).then(o,E)}w((c=c.apply(e,n||[])).next())})};const Pc=`__LIST_IGNORE_${Date.now()}__`,Ew=(e,n)=>{const{fileList:a,defaultFileList:c,onRemove:u,showUploadList:m=!0,listType:x="text",onPreview:o,onDownload:E,onChange:w,onDrop:C,previewFile:P,disabled:M,locale:B,iconRender:U,isImageUrl:N,progress:j,prefixCls:re,className:pe,type:X="select",children:le,style:ye,itemRender:we,maxCount:ae,data:ze={},multiple:Ie=!1,hasControlInside:$e=!0,action:je="",accept:Le="",supportServerRender:it=!0,rootClassName:ft}=e,ct=he.useContext(zg),xt=M??ct,[ht,Yt]=T0(c||[],{value:a,postState:Pt=>Pt??[]}),[He,Nt]=he.useState("drop"),Ft=he.useRef(null);he.useMemo(()=>{const Pt=Date.now();(a||[]).forEach((Mt,lr)=>{!Mt.uid&&!Object.isFrozen(Mt)&&(Mt.uid=`__AUTO__${Pt}_${lr}__`)})},[a]);const ue=(Pt,Mt,lr)=>{let tr=Ci(Mt),at=!1;ae===1?tr=tr.slice(-1):ae&&(at=tr.length>ae,tr=tr.slice(0,ae)),kh.flushSync(()=>{Yt(tr)});const Rt={file:Pt,fileList:tr};lr&&(Rt.event=lr),(!at||tr.some(Vt=>Vt.uid===Pt.uid))&&kh.flushSync(()=>{w?.(Rt)})},Te=(Pt,Mt)=>Tw(void 0,void 0,void 0,function*(){const{beforeUpload:lr,transformFile:tr}=e;let at=Pt;if(lr){const Rt=yield lr(Pt,Mt);if(Rt===!1)return!1;if(delete Pt[Pc],Rt===Pc)return Object.defineProperty(Pt,Pc,{value:!0,configurable:!0}),!1;typeof Rt=="object"&&Rt&&(at=Rt)}return tr&&(at=yield tr(at)),at}),Ee=Pt=>{const Mt=Pt.filter(at=>!at.file[Pc]);if(!Mt.length)return;const lr=Mt.map(at=>mh(at.file));let tr=Ci(ht);lr.forEach(at=>{tr=gh(at,tr)}),lr.forEach((at,Rt)=>{let Vt=at;if(Mt[Rt].parsedFile)at.status="uploading";else{const{originFileObj:Lr}=at;let Kr;try{Kr=new File([Lr],Lr.name,{type:Lr.type})}catch{Kr=new Blob([Lr],{type:Lr.type}),Kr.name=Lr.name,Kr.lastModifiedDate=new Date,Kr.lastModified=new Date().getTime()}Kr.uid=at.uid,Vt=Kr}ue(Vt,tr)})},Se=(Pt,Mt,lr)=>{try{typeof Pt=="string"&&(Pt=JSON.parse(Pt))}catch{}if(!l0(Mt,ht))return;const tr=mh(Mt);tr.status="done",tr.percent=100,tr.response=Pt,tr.xhr=lr;const at=gh(tr,ht);ue(tr,at)},Ke=(Pt,Mt)=>{if(!l0(Mt,ht))return;const lr=mh(Mt);lr.status="uploading",lr.percent=Pt.percent;const tr=gh(lr,ht);ue(lr,tr,Pt)},pt=(Pt,Mt,lr)=>{if(!l0(lr,ht))return;const tr=mh(lr);tr.error=Pt,tr.response=Mt,tr.status="error";const at=gh(tr,ht);ue(tr,at)},_t=Pt=>{let Mt;Promise.resolve(typeof u=="function"?u(Pt):u).then(lr=>{var tr;if(lr===!1)return;const at=hw(Pt,ht);at&&(Mt=Object.assign(Object.assign({},Pt),{status:"removed"}),ht?.forEach(Rt=>{const Vt=Mt.uid!==void 0?"uid":"name";Rt[Vt]===Mt[Vt]&&!Object.isFrozen(Rt)&&(Rt.status="removed")}),(tr=Ft.current)===null||tr===void 0||tr.abort(Mt),ue(Mt,at))})},ut=Pt=>{Nt(Pt.type),Pt.type==="drop"&&C?.(Pt)};he.useImperativeHandle(n,()=>({onBatchStart:Ee,onSuccess:Se,onProgress:Ke,onError:pt,fileList:ht,upload:Ft.current}));const{getPrefixCls:tt,direction:Zt,upload:ge}=he.useContext(eu),Qt=tt("upload",re),Xt=Object.assign(Object.assign({onBatchStart:Ee,onError:pt,onProgress:Ke,onSuccess:Se},e),{data:ze,multiple:Ie,action:je,accept:Le,supportServerRender:it,prefixCls:Qt,disabled:xt,beforeUpload:Te,onChange:void 0,hasControlInside:$e});delete Xt.className,delete Xt.style,(!le||xt)&&delete Xt.id;const or=`${Qt}-wrapper`,[Jt,wt,cr]=J2(Qt,or),[Pr]=mv("Upload",gv.Upload),{showRemoveIcon:qe,showPreviewIcon:Cr,showDownloadIcon:Br,removeIcon:ar,previewIcon:Gt,downloadIcon:ur}=typeof m=="boolean"?{}:m,ir=typeof qe>"u"?!xt:!!qe,Dr=(Pt,Mt)=>m?he.createElement(bw,{prefixCls:Qt,listType:x,items:ht,previewFile:P,onPreview:o,onDownload:E,onRemove:_t,showRemoveIcon:ir,showPreviewIcon:Cr,showDownloadIcon:Br,removeIcon:ar,previewIcon:Gt,downloadIcon:ur,iconRender:U,locale:Object.assign(Object.assign({},Pr),B),isImageUrl:N,progress:j,appendAction:Pt,appendActionVisible:Mt,itemRender:we,disabled:xt}):Pt,wr=Ra(or,pe,ft,wt,cr,ge?.className,{[`${Qt}-rtl`]:Zt==="rtl",[`${Qt}-picture-card-wrapper`]:x==="picture-card",[`${Qt}-picture-circle-wrapper`]:x==="picture-circle"}),Nr=Object.assign(Object.assign({},ge?.style),ye);if(X==="drag"){const Pt=Ra(wt,Qt,`${Qt}-drag`,{[`${Qt}-drag-uploading`]:ht.some(Mt=>Mt.status==="uploading"),[`${Qt}-drag-hover`]:He==="dragover",[`${Qt}-disabled`]:xt,[`${Qt}-rtl`]:Zt==="rtl"});return Jt(he.createElement("span",{className:wr},he.createElement("div",{className:Pt,style:Nr,onDrop:ut,onDragOver:ut,onDragLeave:ut},he.createElement(I0,Object.assign({},Xt,{ref:Ft,className:`${Qt}-btn`}),he.createElement("div",{className:`${Qt}-drag-container`},le))),Dr()))}const Ht=Ra(Qt,`${Qt}-select`,{[`${Qt}-disabled`]:xt}),ot=(Pt=>he.createElement("div",{className:Ht,style:Pt},he.createElement(I0,Object.assign({},Xt,{ref:Ft}))))(le?void 0:{display:"none"});return Jt(x==="picture-card"||x==="picture-circle"?he.createElement("span",{className:wr},Dr(ot,!!le)):he.createElement("span",{className:wr},ot,Dr()))},Sw=he.forwardRef(Ew),t1=Sw;var kw=function(e,n){var a={};for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&n.indexOf(c)<0&&(a[c]=e[c]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var u=0,c=Object.getOwnPropertySymbols(e);u<c.length;u++)n.indexOf(c[u])<0&&Object.prototype.propertyIsEnumerable.call(e,c[u])&&(a[c[u]]=e[c[u]]);return a};const Cw=he.forwardRef((e,n)=>{var{style:a,height:c,hasControlInside:u=!1}=e,m=kw(e,["style","height","hasControlInside"]);return he.createElement(t1,Object.assign({ref:n,hasControlInside:u},m,{type:"drag",style:Object.assign(Object.assign({},a),{height:c})}))}),Aw=Cw,Z0=t1;Z0.Dragger=Aw;Z0.LIST_IGNORE=Pc;const Iw=Z0;var Fw={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M885.2 446.3l-.2-.8-112.2-285.1c-5-16.1-19.9-27.2-36.8-27.2H281.2c-17 0-32.1 11.3-36.9 27.6L139.4 443l-.3.7-.2.8c-1.3 4.9-1.7 9.9-1 14.8-.1 1.6-.2 3.2-.2 4.8V830a60.9 60.9 0 0060.8 60.8h627.2c33.5 0 60.8-27.3 60.9-60.8V464.1c0-1.3 0-2.6-.1-3.7.4-4.9 0-9.6-1.3-14.1zm-295.8-43l-.3 15.7c-.8 44.9-31.8 75.1-77.1 75.1-22.1 0-41.1-7.1-54.8-20.6S436 441.2 435.6 419l-.3-15.7H229.5L309 210h399.2l81.7 193.3H589.4zm-375 76.8h157.3c24.3 57.1 76 90.8 140.4 90.8 33.7 0 65-9.4 90.3-27.2 22.2-15.6 39.5-37.4 50.7-63.6h156.5V814H214.4V480.1z"}}]},name:"inbox",theme:"outlined"};const Pw=Fw;var Mw=function(n,a){return he.createElement(vl,ln({},n,{ref:a,icon:Pw}))};const Dw=he.forwardRef(Mw),Lw=({size:e=20})=>Je.jsx("svg",{width:e,height:e,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:Je.jsx("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M11.0267 1.13334C11.5534 0.501676 12.5792 0.933342 12.4959 1.75168L11.9076 7.50001H16.6667C16.8251 7.50007 16.9801 7.54524 17.1137 7.63024C17.2473 7.71523 17.3539 7.83653 17.4211 7.97993C17.4882 8.12333 17.5132 8.2829 17.4929 8.43994C17.4726 8.59698 17.4081 8.74501 17.3067 8.86668L8.97339 18.8667C8.44672 19.4983 7.42089 19.0667 7.50422 18.2483L8.09255 12.5H3.33339C3.17504 12.4999 3.01999 12.4548 2.88639 12.3698C2.75279 12.2848 2.64617 12.1635 2.57902 12.0201C2.51187 11.8767 2.48696 11.7171 2.50721 11.5601C2.52747 11.403 2.59205 11.255 2.69339 11.1333L11.0267 1.13334Z",fill:"currentColor"})}),Rw=({size:e=20})=>Je.jsxs("svg",{width:e,height:e,viewBox:"0 0 28 28",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[Je.jsx("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M9.83847 8.58794C10.1411 8.46187 10.4827 8.4689 10.7798 8.60732L15.0763 10.6088C15.6604 10.8809 15.9133 11.5749 15.6412 12.159C15.3691 12.7431 14.6751 12.996 14.091 12.7239L11.4888 11.5117L11.653 20.2421L15.7503 22.1045V15.7497C15.7503 15.1053 16.2727 14.583 16.917 14.583C17.5613 14.583 18.0837 15.1053 18.0837 15.7497V22.1663L22.7503 20.2219V13.4163C22.7503 12.772 23.2727 12.2497 23.917 12.2497C24.5613 12.2497 25.0837 12.772 25.0837 13.4163V20.9997C25.0837 21.4707 24.8005 21.8955 24.3657 22.0766L17.3657 24.9933C17.0666 25.1179 16.7292 25.1125 16.4342 24.9784L10.5003 22.2812L4.56643 24.9784C4.20532 25.1426 3.78555 25.112 3.45204 24.8972C3.11854 24.6825 2.91699 24.313 2.91699 23.9163V12.2497C2.91699 11.7787 3.20019 11.3539 3.63494 11.1728L9.83847 8.58794ZM9.31945 20.2549L9.15297 11.4013L5.25033 13.0275V22.1045L9.31945 20.2549Z",fill:"currentColor"}),Je.jsx("path",{d:"M19.8337 8.61425C20.478 8.61425 21.0003 8.09192 21.0003 7.44759C21.0003 6.80326 20.478 6.28092 19.8337 6.28092C19.1893 6.28092 18.667 6.80326 18.667 7.44759C18.667 8.09192 19.1893 8.61425 19.8337 8.61425Z",fill:"currentColor"}),Je.jsx("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M19.8337 2.33301C17.2197 2.33301 15.167 4.52385 15.167 7.1293C15.167 7.85019 15.4274 8.59094 15.7195 9.21916C16.0229 9.8717 16.4198 10.5259 16.8094 11.1056C17.5898 12.2664 18.4067 13.2245 18.579 13.4238L18.5825 13.4278C18.89 13.7803 19.3411 13.9997 19.8337 13.9997C20.3262 13.9997 20.7773 13.7803 21.0848 13.4278L21.0883 13.4238C21.2606 13.2245 22.0776 12.2664 22.8579 11.1056C23.2476 10.5259 23.6444 9.8717 23.9478 9.21916C24.2399 8.59094 24.5003 7.85019 24.5003 7.1293C24.5003 4.52385 22.4476 2.33301 19.8337 2.33301ZM17.5003 7.1293C17.5003 5.7318 18.5876 4.66634 19.8337 4.66634C21.0797 4.66634 22.167 5.7318 22.167 7.1293C22.167 7.33968 22.0764 7.70972 21.832 8.23544C21.5989 8.73683 21.2738 9.2797 20.9214 9.80382C20.5368 10.376 20.1392 10.8972 19.8337 11.2802C19.5281 10.8972 19.1305 10.376 18.7459 9.80382C18.3936 9.2797 18.0684 8.73683 17.8353 8.23544C17.5909 7.70972 17.5003 7.33968 17.5003 7.1293Z",fill:"currentColor"})]}),Ow=({size:e=20,fill:n="#1877F2"})=>Je.jsx("svg",{width:e,height:e,viewBox:"0 0 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:Je.jsx("path",{d:"M23.1875 5.25H10.9375C10.6094 5.25 10.3314 5.36393 10.1035 5.5918C9.87565 5.81966 9.76172 6.09766 9.76172 6.42578C9.76172 6.73568 9.87565 7.00456 10.1035 7.23242C10.3314 7.46029 10.6094 7.57422 10.9375 7.57422H23.1875C23.4974 7.57422 23.7663 7.46029 23.9941 7.23242C24.222 7.00456 24.3359 6.73568 24.3359 6.42578C24.3359 6.09766 24.222 5.81966 23.9941 5.5918C23.7663 5.36393 23.4974 5.25 23.1875 5.25ZM23.1875 12.25H10.9375C10.6094 12.25 10.3314 12.3639 10.1035 12.5918C9.87565 12.8197 9.76172 13.0977 9.76172 13.4258C9.76172 13.7357 9.87565 14.0046 10.1035 14.2324C10.3314 14.4603 10.6094 14.5742 10.9375 14.5742H23.1875C23.4974 14.5742 23.7663 14.4603 23.9941 14.2324C24.222 14.0046 24.3359 13.7357 24.3359 13.4258C24.3359 13.0977 24.222 12.8197 23.9941 12.5918C23.7663 12.3639 23.4974 12.25 23.1875 12.25ZM23.1875 19.25H10.9375C10.6094 19.25 10.3314 19.3639 10.1035 19.5918C9.87565 19.8197 9.76172 20.0977 9.76172 20.4258C9.76172 20.7357 9.87565 21.0046 10.1035 21.2324C10.3314 21.4603 10.6094 21.5742 10.9375 21.5742H23.1875C23.4974 21.5742 23.7663 21.4603 23.9941 21.2324C24.222 21.0046 24.3359 20.7357 24.3359 20.4258C24.3359 20.0977 24.222 19.8197 23.9941 19.5918C23.7663 19.3639 23.4974 19.25 23.1875 19.25ZM5.25 18.6758C5.72396 18.6758 6.13411 18.8444 6.48047 19.1816C6.82682 19.5189 7 19.9336 7 20.4258C7 20.8997 6.82682 21.3099 6.48047 21.6562C6.13411 22.0026 5.72396 22.1758 5.25 22.1758C4.75781 22.1758 4.3431 22.0026 4.00586 21.6562C3.66862 21.3099 3.5 20.8997 3.5 20.4258C3.5 19.9336 3.66862 19.5189 4.00586 19.1816C4.3431 18.8444 4.75781 18.6758 5.25 18.6758ZM5.25 15.1758C4.75781 15.1758 4.3431 15.0026 4.00586 14.6562C3.66862 14.3099 3.5 13.8997 3.5 13.4258C3.5 12.9336 3.66862 12.5189 4.00586 12.1816C4.3431 11.8444 4.75781 11.6758 5.25 11.6758C5.72396 11.6758 6.13411 11.8444 6.48047 12.1816C6.82682 12.5189 7 12.9336 7 13.4258C7 13.8997 6.82682 14.3099 6.48047 14.6562C6.13411 15.0026 5.72396 15.1758 5.25 15.1758ZM5.25 8.17578C4.75781 8.17578 4.3431 8.0026 4.00586 7.65625C3.66862 7.3099 3.5 6.89974 3.5 6.42578C3.5 5.93359 3.66862 5.51888 4.00586 5.18164C4.3431 4.8444 4.75781 4.67578 5.25 4.67578C5.72396 4.67578 6.13411 4.8444 6.48047 5.18164C6.82682 5.51888 7 5.93359 7 6.42578C7 6.89974 6.82682 7.3099 6.48047 7.65625C6.13411 8.0026 5.72396 8.17578 5.25 8.17578Z",fill:"currentColor"})}),Bw=({size:e=32})=>Je.jsxs("svg",{width:e-1,height:e,viewBox:"0 0 31 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[Je.jsx("ellipse",{cx:"15.5002",cy:"14.6668",rx:"5.16667",ry:"5.33333",fill:"white"}),Je.jsx("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M4.77881 13.8369C4.77881 7.71569 9.45773 2.49951 15.5 2.49951C21.5423 2.49951 26.2212 7.71569 26.2212 13.8369C26.2212 15.6318 25.6013 17.3884 24.9844 18.7581C24.3325 20.2055 23.4909 21.6336 22.6828 22.8745C21.0637 25.3608 19.3742 27.4058 19.0124 27.8378L19.0103 27.8403L19.0032 27.8488L19.0013 27.851C18.1452 28.8639 16.8841 29.5005 15.5 29.5005C14.1159 29.5005 12.8548 28.8639 11.9987 27.851L11.9968 27.8487L11.9896 27.8402L11.9876 27.8378C11.6259 27.4058 9.93637 25.3608 8.31723 22.8745C7.50914 21.6336 6.66752 20.2055 6.0156 18.7581C5.39871 17.3884 4.77881 15.6318 4.77881 13.8369ZM15.5 13.4007C14.9114 13.4007 14.4343 13.8933 14.4343 14.5008C14.4343 15.1084 14.9114 15.6009 15.5 15.6009C16.0886 15.6009 16.5657 15.1084 16.5657 14.5008C16.5657 13.8933 16.0886 13.4007 15.5 13.4007ZM11.851 14.5008C11.851 12.4205 13.4847 10.7341 15.5 10.7341C17.5153 10.7341 19.1491 12.4205 19.1491 14.5008C19.1491 16.5811 17.5153 18.2676 15.5 18.2676C13.4847 18.2676 11.851 16.5811 11.851 14.5008Z",fill:"#22C55E"})]});function zw({des:e}){return Je.jsxs("div",{className:"relative",children:[Je.jsx("span",{className:"absolute whitespace-nowrap top-[-50%]",children:e}),Je.jsx(Bw,{})]})}function c0({children:e,className:n}){return Je.jsx(ho,{gutter:38,className:"mt-3 first:mt-0 "+n,children:e})}const Nw=[{label:"Hoạt động",value:"Active"},{label:"Khóa",value:"Lock"}],Uw=[{label:"Thêm khách hàng",value:"add"},{label:"Chọn khách hàng",value:"Choose"},{label:"Import khách hàng",value:"Import"}],X0=[{title:"Mã khách hàng",dataIndex:"customer_code",key:"customercode"},{title:"Tên khách hàng",dataIndex:"customer_name",key:"customername"}],r1=[{title:"Địa chỉ",dataIndex:"display_address",key:"display_address"},{title:"Số điện thoại",dataIndex:"phone_number",key:"phone_number"}],Vw=[{customer_id:"431456",customer_name:"Chu Văn A",display_address:"CT1 Chung cư bộ công an",phone_number:"0123456789",frequency:"1;2;3;4;5"},{customer_id:"4314s56",customer_name:"Chu Văn A",display_address:"CT1 Chung cư bộ công an",phone_number:"0123456789",frequency:""}],$w=[{label:"1",value:"1"},{label:"2",value:"2"},{label:"3",value:"3"},{label:"4",value:"4"}],jw={customer_type:"Loại khách hàng",customer_group:"Nhóm khách hàng",city:"Tỉnh/Thành phố",district:"Quận/huyện",ward:"Phường/xã"},Gw=[{label:"Không giới hạn ",value:null},{label:"Thứ 2",value:"Thứ 2"},{label:"Thứ 3",value:"Thứ 3"},{label:"Thứ 4",value:"Thứ 4"},{label:"Thứ 5",value:"Thứ 5"},{label:"Thứ 6",value:"Thứ 6"},{label:"Thứ 7",value:"Thứ 7"},{label:"Chủ nhật",value:"Chủ nhật"}],a1=(e,n,a={})=>{let c=[];return e.forEach(u=>{let m={};for(let x in u)n.includes(x)&&(m[x]=u[x]);console.log("obj",m),a.isNull?c.push(m):Object.keys(m).find(o=>!m[o])||c.push(m)}),c},F0=({data:e=[],parentField:n="",parentValue:a=null,keyValue:c=""})=>e.length==0?e:e.filter(m=>m[n]==a).map(m=>({...m,children:F0({data:e.filter(x=>x[n]!==a),parentField:n,parentValue:m[c],keyValue:c})}));function Hw({form:e}){console.log(e);const[n,a]=he.useState("");let c=Cv(n);const[u,m]=he.useState([]),[x,o]=he.useState([]),[E,w]=he.useState();return he.useState(),he.useEffect(()=>{(async()=>{let C=await on.get("/api/method/mbw_dms.api.router.get_team_sale");console.log("tree",F0({data:C.result.map(P=>({title:P.name,value:P.name,...P})),keyValue:"value",parentField:"parent_sales_person"})),m(F0({data:C.result.map(P=>({title:P.name,value:P.name,...P})),keyValue:"value",parentField:"parent_sales_person"}))})()},[]),he.useEffect(()=>{(async()=>{let C=await on.get("/api/method/mbw_dms.api.router.get_sale_person",{params:{team_sale:E,key_search:c}}),{message:P}=C;o(P.map(M=>({value:M.employee_code,label:M.employee_name||M.employee_code})))})()},[E,c]),Je.jsxs("div",{className:"p-4 pt-[43px] pb-[58px]",children:[Je.jsxs(c0,{children:[Je.jsx(Si,{span:12,children:Je.jsx(Ni,{label:"Mã tuyến",name:"channel_code",required:!0,children:Je.jsx(Ch,{})})}),Je.jsx(Si,{span:12,children:Je.jsx(Ni,{label:"Tên tuyến",name:"channel_name",required:!0,children:Je.jsx(Ch,{})})})]}),Je.jsxs(c0,{children:[Je.jsx(Si,{span:12,children:Je.jsx(Ni,{label:"Team sale",name:"team_sale",required:!0,children:Je.jsx(R2,{showSearch:!0,treeData:u,onChange:C=>{w(C),e.setFieldsValue({employee:void 0})}})})}),Je.jsx(Si,{span:12,children:Je.jsx(Ni,{label:"Nhân viên",name:"employee",required:!0,children:Je.jsx(is,{showSearch:!0,onSearch:a,options:x,allowClear:!0})})})]}),Je.jsxs(c0,{children:[Je.jsx(Si,{span:12,children:Je.jsx(Ni,{label:"Ngày đi tuyến",name:"travel_date",required:!0,children:Je.jsx(is,{options:Gw})})}),Je.jsx(Si,{span:12,children:Je.jsx(Ni,{label:"Trạng thái",name:"status",children:Je.jsx(is,{options:Nw,defaultValue:"Active"})})})]})]})}function Ww({data:e,handleData:n}){const a=[{title:"Stt",dataIndex:"stt",key:"stt",render:(c,u,m)=>m+1},...X0,...r1,{title:"Tần suất",dataIndex:"frequency",key:"frequency",render:(c,u)=>Je.jsx(is,{mode:"multiple",options:$w,style:{width:"100%"},placeholder:"Chọn tần suất",onChange:m=>{n(x=>x.map(o=>(o.customer_id==u.customer_id&&(o.frequency=m.toString().replaceAll(",",";")),o)))},defaultValue:c?c.split(";"):[]})},{title:"Hành động",dataIndex:"",key:"action",render:(c,u)=>Je.jsx("div",{className:"flex justify-center",onClick:()=>{n(m=>[...m.filter(x=>x.customer_code!=u.customer_code)])},children:Je.jsx(Zg,{})})}];return Je.jsx("div",{className:"p-4",children:Je.jsx(G0,{columns:a,dataSource:e,pagination:!1})})}const qw=he.createContext(null);function Zw(e,n){const a=Array.isArray(e)?e[0]:e?e.x:0,c=Array.isArray(e)?e[1]:e?e.y:0,u=Array.isArray(n)?n[0]:n?n.x:0,m=Array.isArray(n)?n[1]:n?n.y:0;return a===u&&c===m}function Wi(e,n){if(e===n)return!0;if(!e||!n)return!1;if(Array.isArray(e)){if(!Array.isArray(n)||e.length!==n.length)return!1;for(let a=0;a<e.length;a++)if(!Wi(e[a],n[a]))return!1;return!0}else if(Array.isArray(n))return!1;if(typeof e=="object"&&typeof n=="object"){const a=Object.keys(e),c=Object.keys(n);if(a.length!==c.length)return!1;for(const u of a)if(!n.hasOwnProperty(u)||!Wi(e[u],n[u]))return!1;return!0}return!1}function Xw(e){const n=e.clone();return n.pixelsToGLUnits=e.pixelsToGLUnits,n}function wm(e,n){if(!e.getProjection)return;const a=e.getProjection(),c=n.getProjection();Wi(a,c)||n.setProjection(a)}function bm(e){return{longitude:e.center.lng,latitude:e.center.lat,zoom:e.zoom,pitch:e.pitch,bearing:e.bearing,padding:e.padding}}function Tm(e,n){const a=n.viewState||n;let c=!1;if("longitude"in a&&"latitude"in a){const u=e.center;e.center=new u.constructor(a.longitude,a.latitude),c=c||u!==e.center}if("zoom"in a){const u=e.zoom;e.zoom=a.zoom,c=c||u!==e.zoom}if("bearing"in a){const u=e.bearing;e.bearing=a.bearing,c=c||u!==e.bearing}if("pitch"in a){const u=e.pitch;e.pitch=a.pitch,c=c||u!==e.pitch}return a.padding&&!e.isPaddingEqual(a.padding)&&(c=!0,e.padding=a.padding),c}const Kw=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Em(e){if(!e)return null;if(typeof e=="string"||("toJS"in e&&(e=e.toJS()),!e.layers))return e;const n={};for(const c of e.layers)n[c.id]=c;const a=e.layers.map(c=>{let u=null;"interactive"in c&&(u=Object.assign({},c),delete u.interactive);const m=n[c.ref];if(m){u=u||Object.assign({},c),delete u.ref;for(const x of Kw)x in m&&(u[x]=m[x])}return u||c});return{...e,layers:a}}var Sm={};const km={version:8,sources:{},layers:[]},Cm={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},u0={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},Am={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},Yw=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],Jw=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class xl{constructor(n,a,c){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=u=>{const m=this.props[Am[u.type]];m?m(u):u.type==="error"&&console.error(u.error)},this._onPointerEvent=u=>{(u.type==="mousemove"||u.type==="mouseout")&&this._updateHover(u);const m=this.props[Cm[u.type]];m&&(this.props.interactiveLayerIds&&u.type!=="mouseover"&&u.type!=="mouseout"&&(u.features=this._hoveredFeatures||this._queryRenderedFeatures(u.point)),m(u),delete u.features)},this._onCameraEvent=u=>{if(!this._internalUpdate){const m=this.props[u0[u.type]];m&&m(u)}u.type in this._deferredEvents&&(this._deferredEvents[u.type]=!1)},this._MapClass=n,this.props=a,this._initialize(c)}get map(){return this._map}get transform(){return this._renderTransform}setProps(n){const a=this.props;this.props=n;const c=this._updateSettings(n,a);c&&this._createShadowTransform(this._map);const u=this._updateSize(n),m=this._updateViewState(n,!0);this._updateStyle(n,a),this._updateStyleComponents(n,a),this._updateHandlers(n,a),(c||u||m&&!this._map.isMoving())&&this.redraw()}static reuse(n,a){const c=xl.savedMaps.pop();if(!c)return null;const u=c.map,m=u.getContainer();for(a.className=m.className;m.childNodes.length>0;)a.appendChild(m.childNodes[0]);u._container=a;const x=u._resizeObserver;x&&(x.disconnect(),x.observe(a)),c.setProps({...n,styleDiffing:!1}),u.resize();const{initialViewState:o}=n;return o&&(o.bounds?u.fitBounds(o.bounds,{...o.fitBoundsOptions,duration:0}):c._updateViewState(o,!1)),u.isStyleLoaded()?u.fire("load"):u.once("styledata",()=>u.fire("load")),u._update(),c}_initialize(n){const{props:a}=this,{mapStyle:c=km}=a,u={...a,...a.initialViewState,accessToken:a.mapboxAccessToken||Qw()||null,container:n,style:Em(c)},m=u.initialViewState||u.viewState||u;if(Object.assign(u,{center:[m.longitude||0,m.latitude||0],zoom:m.zoom||0,pitch:m.pitch||0,bearing:m.bearing||0}),a.gl){const C=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=C,a.gl)}const x=new this._MapClass(u);m.padding&&x.setPadding(m.padding),a.cursor&&(x.getCanvas().style.cursor=a.cursor),this._createShadowTransform(x);const o=x._render;x._render=C=>{this._inRender=!0,o.call(x,C),this._inRender=!1};const E=x._renderTaskQueue.run;x._renderTaskQueue.run=C=>{E.call(x._renderTaskQueue,C),this._onBeforeRepaint()},x.on("render",()=>this._onAfterRepaint());const w=x.fire;x.fire=this._fireEvent.bind(this,w),x.on("resize",()=>{this._renderTransform.resize(x.transform.width,x.transform.height)}),x.on("styledata",()=>{this._updateStyleComponents(this.props,{}),wm(x.transform,this._renderTransform)}),x.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const C in Cm)x.on(C,this._onPointerEvent);for(const C in u0)x.on(C,this._onCameraEvent);for(const C in Am)x.on(C,this._onEvent);this._map=x}recycle(){const a=this.map.getContainer().querySelector("[mapboxgl-children]");a?.remove(),xl.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const n=this._map;!this._inRender&&n.style&&(n._frame&&(n._frame.cancel(),n._frame=null),n._render())}_createShadowTransform(n){const a=Xw(n.transform);n.painter.transform=a,this._renderTransform=a}_updateSize(n){const{viewState:a}=n;if(a){const c=this._map;if(a.width!==c.transform.width||a.height!==c.transform.height)return c.resize(),!0}return!1}_updateViewState(n,a){if(this._internalUpdate)return!1;const c=this._map,u=this._renderTransform,{zoom:m,pitch:x,bearing:o}=u,E=c.isMoving();E&&(u.cameraElevationReference="sea");const w=Tm(u,{...bm(c.transform),...n});if(E&&(u.cameraElevationReference="ground"),w&&a){const C=this._deferredEvents;C.move=!0,C.zoom||(C.zoom=m!==u.zoom),C.rotate||(C.rotate=o!==u.bearing),C.pitch||(C.pitch=x!==u.pitch)}return E||Tm(c.transform,n),w}_updateSettings(n,a){const c=this._map;let u=!1;for(const m of Yw)if(m in n&&!Wi(n[m],a[m])){u=!0;const x=c[`set${m[0].toUpperCase()}${m.slice(1)}`];x?.call(c,n[m])}return u}_updateStyle(n,a){if(n.cursor!==a.cursor&&(this._map.getCanvas().style.cursor=n.cursor||""),n.mapStyle!==a.mapStyle){const{mapStyle:c=km,styleDiffing:u=!0}=n,m={diff:u};return"localIdeographFontFamily"in n&&(m.localIdeographFontFamily=n.localIdeographFontFamily),this._map.setStyle(Em(c),m),!0}return!1}_updateStyleComponents(n,a){const c=this._map;let u=!1;return c.isStyleLoaded()&&("light"in n&&c.setLight&&!Wi(n.light,a.light)&&(u=!0,c.setLight(n.light)),"fog"in n&&c.setFog&&!Wi(n.fog,a.fog)&&(u=!0,c.setFog(n.fog)),"terrain"in n&&c.setTerrain&&!Wi(n.terrain,a.terrain)&&(!n.terrain||c.getSource(n.terrain.source))&&(u=!0,c.setTerrain(n.terrain))),u}_updateHandlers(n,a){var c,u;const m=this._map;let x=!1;for(const o of Jw){const E=(c=n[o])!==null&&c!==void 0?c:!0,w=(u=a[o])!==null&&u!==void 0?u:!0;Wi(E,w)||(x=!0,E?m[o].enable(E):m[o].disable())}return x}_queryRenderedFeatures(n){const a=this._map,c=a.transform,{interactiveLayerIds:u=[]}=this.props;try{return a.transform=this._renderTransform,a.queryRenderedFeatures(n,{layers:u.filter(a.getLayer.bind(a))})}catch{return[]}finally{a.transform=c}}_updateHover(n){var a;const{props:c}=this;if(c.interactiveLayerIds&&(c.onMouseMove||c.onMouseEnter||c.onMouseLeave)){const m=n.type,x=((a=this._hoveredFeatures)===null||a===void 0?void 0:a.length)>0,o=this._queryRenderedFeatures(n.point),E=o.length>0;!E&&x&&(n.type="mouseleave",this._onPointerEvent(n)),this._hoveredFeatures=o,E&&!x&&(n.type="mouseenter",this._onPointerEvent(n)),n.type=m}else this._hoveredFeatures=null}_fireEvent(n,a,c){const u=this._map,m=u.transform,x=typeof a=="string"?a:a.type;return x==="move"&&this._updateViewState(this.props,!1),x in u0&&(typeof a=="object"&&(a.viewState=bm(m)),this._map.isMoving())?(u.transform=this._renderTransform,n.call(u,a,c),u.transform=m,u):(n.call(u,a,c),u)}_onBeforeRepaint(){const n=this._map;this._internalUpdate=!0;for(const c in this._deferredEvents)this._deferredEvents[c]&&n.fire(c);this._internalUpdate=!1;const a=this._map.transform;n.transform=this._renderTransform,this._onAfterRepaint=()=>{wm(this._renderTransform,a),n.transform=a}}}xl.savedMaps=[];function Qw(){let e=null;if(typeof location<"u"){const n=/access_token=([^&\/]*)/.exec(location.search);e=n&&n[1]}try{e=e||Sm.MapboxAccessToken}catch{}try{e=e||Sm.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return e}const eb=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function tb(e){if(!e)return null;const n=e.map,a={getMap:()=>n,getCenter:()=>e.transform.center,getZoom:()=>e.transform.zoom,getBearing:()=>e.transform.bearing,getPitch:()=>e.transform.pitch,getPadding:()=>e.transform.padding,getBounds:()=>e.transform.getBounds(),project:c=>{const u=n.transform;n.transform=e.transform;const m=n.project(c);return n.transform=u,m},unproject:c=>{const u=n.transform;n.transform=e.transform;const m=n.unproject(c);return n.transform=u,m},queryTerrainElevation:(c,u)=>{const m=n.transform;n.transform=e.transform;const x=n.queryTerrainElevation(c,u);return n.transform=m,x},queryRenderedFeatures:(c,u)=>{const m=n.transform;n.transform=e.transform;const x=n.queryRenderedFeatures(c,u);return n.transform=m,x}};for(const c of rb(n))!(c in a)&&!eb.includes(c)&&(a[c]=n[c].bind(n));return a}function rb(e){const n=new Set;let a=e;for(;a;){for(const c of Object.getOwnPropertyNames(a))c[0]!=="_"&&typeof e[c]=="function"&&c!=="fire"&&c!=="setEventedParent"&&n.add(c);a=Object.getPrototypeOf(a)}return Array.from(n)}const ab=typeof document<"u"?he.useLayoutEffect:he.useEffect,ib=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function nb(e,n){for(const c of ib)c in n&&(e[c]=n[c]);const{RTLTextPlugin:a="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=n;a&&e.getRTLTextPluginStatus&&e.getRTLTextPluginStatus()==="unavailable"&&e.setRTLTextPlugin(a,c=>{c&&console.error(c)},!0)}const wl=he.createContext(null);function sb(e,n,a){const c=he.useContext(qw),[u,m]=he.useState(null),x=he.useRef(),{current:o}=he.useRef({mapLib:null,map:null});he.useEffect(()=>{const C=e.mapLib;let P=!0,M;return Promise.resolve(C||a).then(B=>{if(!P)return;if(!B)throw new Error("Invalid mapLib");const U="Map"in B?B:B.default;if(!U.Map)throw new Error("Invalid mapLib");if(nb(U,e),!U.supported||U.supported(e))e.reuseMaps&&(M=xl.reuse(e,x.current)),M||(M=new xl(U.Map,e,x.current)),o.map=tb(M),o.mapLib=U,m(M),c?.onMapMount(o.map,e.id);else throw new Error("Map is not supported by this browser")}).catch(B=>{const{onError:U}=e;U?U({type:"error",target:null,originalEvent:null,error:B}):console.error(B)}),()=>{P=!1,M&&(c?.onMapUnmount(e.id),e.reuseMaps?M.recycle():M.destroy())}},[]),ab(()=>{u&&u.setProps(e)}),he.useImperativeHandle(n,()=>o.map,[u]);const E=he.useMemo(()=>({position:"relative",width:"100%",height:"100%",...e.style}),[e.style]),w={height:"100%"};return he.createElement("div",{id:e.id,ref:x,style:E},u&&he.createElement(wl.Provider,{value:o},he.createElement("div",{"mapboxgl-children":"",style:w},e.children)))}const ob=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function yo(e,n){if(!e||!n)return;const a=e.style;for(const c in n){const u=n[c];Number.isFinite(u)&&!ob.test(c)?a[c]=`${u}px`:a[c]=u}}function lb(e,n){const{map:a,mapLib:c}=he.useContext(wl),u=he.useRef({props:e});u.current.props=e;const m=he.useMemo(()=>{let N=!1;he.Children.forEach(e.children,pe=>{pe&&(N=!0)});const j={...e,element:N?document.createElement("div"):null},re=new c.Marker(j);return re.setLngLat([e.longitude,e.latitude]),re.getElement().addEventListener("click",pe=>{var X,le;(le=(X=u.current.props).onClick)===null||le===void 0||le.call(X,{type:"click",target:re,originalEvent:pe})}),re.on("dragstart",pe=>{var X,le;const ye=pe;ye.lngLat=m.getLngLat(),(le=(X=u.current.props).onDragStart)===null||le===void 0||le.call(X,ye)}),re.on("drag",pe=>{var X,le;const ye=pe;ye.lngLat=m.getLngLat(),(le=(X=u.current.props).onDrag)===null||le===void 0||le.call(X,ye)}),re.on("dragend",pe=>{var X,le;const ye=pe;ye.lngLat=m.getLngLat(),(le=(X=u.current.props).onDragEnd)===null||le===void 0||le.call(X,ye)}),re},[]);he.useEffect(()=>(m.addTo(a.getMap()),()=>{m.remove()}),[]);const{longitude:x,latitude:o,offset:E,style:w,draggable:C=!1,popup:P=null,rotation:M=0,rotationAlignment:B="auto",pitchAlignment:U="auto"}=e;return he.useEffect(()=>{yo(m.getElement(),w)},[w]),he.useImperativeHandle(n,()=>m,[]),(m.getLngLat().lng!==x||m.getLngLat().lat!==o)&&m.setLngLat([x,o]),E&&!Zw(m.getOffset(),E)&&m.setOffset(E),m.isDraggable()!==C&&m.setDraggable(C),m.getRotation()!==M&&m.setRotation(M),m.getRotationAlignment()!==B&&m.setRotationAlignment(B),m.getPitchAlignment()!==U&&m.setPitchAlignment(U),m.getPopup()!==P&&m.setPopup(P),kh.createPortal(e.children,m.getElement())}const cb=he.memo(he.forwardRef(lb));function Im(e){return new Set(e?e.trim().split(/\s+/):[])}function ub(e,n){const{map:a,mapLib:c}=he.useContext(wl),u=he.useMemo(()=>document.createElement("div"),[]),m=he.useRef({props:e});m.current.props=e;const x=he.useMemo(()=>{const o={...e},E=new c.Popup(o);return E.setLngLat([e.longitude,e.latitude]),E.once("open",w=>{var C,P;(P=(C=m.current.props).onOpen)===null||P===void 0||P.call(C,w)}),E},[]);if(he.useEffect(()=>{const o=E=>{var w,C;(C=(w=m.current.props).onClose)===null||C===void 0||C.call(w,E)};return x.on("close",o),x.setDOMContent(u).addTo(a.getMap()),()=>{x.off("close",o),x.isOpen()&&x.remove()}},[]),he.useEffect(()=>{yo(x.getElement(),e.style)},[e.style]),he.useImperativeHandle(n,()=>x,[]),x.isOpen()&&((x.getLngLat().lng!==e.longitude||x.getLngLat().lat!==e.latitude)&&x.setLngLat([e.longitude,e.latitude]),e.offset&&!Wi(x.options.offset,e.offset)&&x.setOffset(e.offset),(x.options.anchor!==e.anchor||x.options.maxWidth!==e.maxWidth)&&(x.options.anchor=e.anchor,x.setMaxWidth(e.maxWidth)),x.options.className!==e.className)){const o=Im(x.options.className),E=Im(e.className);for(const w of o)E.has(w)||x.removeClassName(w);for(const w of E)o.has(w)||x.addClassName(w);x.options.className=e.className}return kh.createPortal(e.children,u)}he.memo(he.forwardRef(ub));function ru(e,n,a,c){const u=he.useContext(wl),m=he.useMemo(()=>e(u),[]);return he.useEffect(()=>{const x=c||a||n,o=typeof n=="function"&&typeof a=="function"?n:null,E=typeof a=="function"?a:typeof n=="function"?n:null,{map:w}=u;return w.hasControl(m)||(w.addControl(m,x?.position),o&&o(u)),()=>{E&&E(u),w.hasControl(m)&&w.removeControl(m)}},[]),m}function hb(e){const n=ru(({mapLib:a})=>new a.AttributionControl(e),{position:e.position});return he.useEffect(()=>{yo(n._container,e.style)},[e.style]),null}he.memo(hb);function fb(e){const n=ru(({mapLib:a})=>new a.FullscreenControl({container:e.containerId&&document.getElementById(e.containerId)}),{position:e.position});return he.useEffect(()=>{yo(n._controlContainer,e.style)},[e.style]),null}he.memo(fb);function db(e,n){const a=he.useRef({props:e}),c=ru(({mapLib:u})=>{const m=new u.GeolocateControl(e),x=m._setupUI;return m._setupUI=o=>{m._container.hasChildNodes()||x(o)},m.on("geolocate",o=>{var E,w;(w=(E=a.current.props).onGeolocate)===null||w===void 0||w.call(E,o)}),m.on("error",o=>{var E,w;(w=(E=a.current.props).onError)===null||w===void 0||w.call(E,o)}),m.on("outofmaxbounds",o=>{var E,w;(w=(E=a.current.props).onOutOfMaxBounds)===null||w===void 0||w.call(E,o)}),m.on("trackuserlocationstart",o=>{var E,w;(w=(E=a.current.props).onTrackUserLocationStart)===null||w===void 0||w.call(E,o)}),m.on("trackuserlocationend",o=>{var E,w;(w=(E=a.current.props).onTrackUserLocationEnd)===null||w===void 0||w.call(E,o)}),m},{position:e.position});return a.current.props=e,he.useImperativeHandle(n,()=>c,[]),he.useEffect(()=>{yo(c._container,e.style)},[e.style]),null}he.memo(he.forwardRef(db));function pb(e){const n=ru(({mapLib:a})=>new a.NavigationControl(e),{position:e.position});return he.useEffect(()=>{yo(n._container,e.style)},[e.style]),null}he.memo(pb);function mb(e){const n=ru(({mapLib:m})=>new m.ScaleControl(e),{position:e.position}),a=he.useRef(e),c=a.current;a.current=e;const{style:u}=e;return e.maxWidth!==void 0&&e.maxWidth!==c.maxWidth&&(n.options.maxWidth=e.maxWidth),e.unit!==void 0&&e.unit!==c.unit&&n.setUnit(e.unit),he.useEffect(()=>{yo(n._container,u)},[u]),null}he.memo(mb);function Ph(e,n){if(!e)throw new Error(n)}function gb(e,n,a,c){if(Ph(a.id===c.id,"layer id changed"),Ph(a.type===c.type,"layer type changed"),a.type==="custom"||c.type==="custom")return;const{layout:u={},paint:m={},filter:x,minzoom:o,maxzoom:E,beforeId:w}=a;if(w!==c.beforeId&&e.moveLayer(n,w),u!==c.layout){const C=c.layout||{};for(const P in u)Wi(u[P],C[P])||e.setLayoutProperty(n,P,u[P]);for(const P in C)u.hasOwnProperty(P)||e.setLayoutProperty(n,P,void 0)}if(m!==c.paint){const C=c.paint||{};for(const P in m)Wi(m[P],C[P])||e.setPaintProperty(n,P,m[P]);for(const P in C)m.hasOwnProperty(P)||e.setPaintProperty(n,P,void 0)}Wi(x,c.filter)||e.setFilter(n,x),(o!==c.minzoom||E!==c.maxzoom)&&e.setLayerZoomRange(n,o,E)}function xb(e,n,a){if(e.style&&e.style._loaded&&(!("source"in a)||e.getSource(a.source))){const c={...a,id:n};delete c.beforeId,e.addLayer(c,a.beforeId)}}let _b=0;function yb(e){const n=he.useContext(wl).map.getMap(),a=he.useRef(e),[,c]=he.useState(0),u=he.useMemo(()=>e.id||`jsx-layer-${_b++}`,[]);if(he.useEffect(()=>{if(n){const x=()=>c(o=>o+1);return n.on("styledata",x),x(),()=>{n.off("styledata",x),n.style&&n.style._loaded&&n.getLayer(u)&&n.removeLayer(u)}}},[n]),n&&n.style&&n.getLayer(u))try{gb(n,u,e,a.current)}catch(x){console.warn(x)}else xb(n,u,e);return a.current=e,null}let vb=0;function wb(e,n,a){if(e.style&&e.style._loaded){const c={...a};return delete c.id,delete c.children,e.addSource(n,c),e.getSource(n)}return null}function bb(e,n,a){Ph(n.id===a.id,"source id changed"),Ph(n.type===a.type,"source type changed");let c="",u=0;for(const x in n)x!=="children"&&x!=="id"&&!Wi(a[x],n[x])&&(c=x,u++);if(!u)return;const m=n.type;if(m==="geojson")e.setData(n.data);else if(m==="image")e.updateImage({url:n.url,coordinates:n.coordinates});else if("setCoordinates"in e&&u===1&&c==="coordinates")e.setCoordinates(n.coordinates);else if("setUrl"in e)switch(c){case"url":e.setUrl(n.url);break;case"tiles":e.setTiles(n.tiles);break}else console.warn(`Unable to update <Source> prop: ${c}`)}function Tb(e){const n=he.useContext(wl).map.getMap(),a=he.useRef(e),[,c]=he.useState(0),u=he.useMemo(()=>e.id||`jsx-source-${vb++}`,[]);he.useEffect(()=>{if(n){const x=()=>setTimeout(()=>c(o=>o+1),0);return n.on("styledata",x),x(),()=>{var o;if(n.off("styledata",x),n.style&&n.style._loaded&&n.getSource(u)){const E=(o=n.getStyle())===null||o===void 0?void 0:o.layers;if(E)for(const w of E)w.source===u&&n.removeLayer(w.id);n.removeSource(u)}}}},[n]);let m=n&&n.style&&n.getSource(u);return m?bb(m,e,a.current):m=wb(n,u,e),a.current=e,m&&he.Children.map(e.children,x=>x&&he.cloneElement(x,{source:u}))||null}const Eb=xv(()=>import("./mapbox-gl-ECBi2DK5.js").then(e=>e.m),__vite__mapDeps([0,1,2])),Sb=he.forwardRef(function(n,a){return sb(n,a,Eb)}),kb=cb,Cb=yb,Ab=Tb;var i1={exports:{}};(function(e,n){(function(a,c){e.exports=c()})(_v,function(){var a,c,u;function m(o,E){if(!a)a=E;else if(!c)c=E;else{var w="var sharedChunk = {}; ("+a+")(sharedChunk); ("+c+")(sharedChunk);",C={};a(C),u=E(C),typeof window<"u"&&(u.workerUrl=window.URL.createObjectURL(new Blob([w],{type:"text/javascript"})))}}m(["exports"],function(o){function E(i,t,s,h){return new(s||(s=Promise))(function(d,_){function v(I){try{k(h.next(I))}catch(D){_(D)}}function b(I){try{k(h.throw(I))}catch(D){_(D)}}function k(I){var D;I.done?d(I.value):(D=I.value,D instanceof s?D:new s(function(O){O(D)})).then(v,b)}k((h=h.apply(i,t||[])).next())})}function w(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}typeof SuppressedError=="function"&&SuppressedError;var C=P;function P(i,t){this.x=i,this.y=t}P.prototype={clone:function(){return new P(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,t){return this.clone()._rotateAround(i,t)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var t=i.x-this.x,s=i.y-this.y;return t*t+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,t){return Math.atan2(this.x*t-this.y*i,this.x*i+this.y*t)},_matMult:function(i){var t=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=t,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var t=Math.cos(i),s=Math.sin(i),h=s*this.x+t*this.y;return this.x=t*this.x-s*this.y,this.y=h,this},_rotateAround:function(i,t){var s=Math.cos(i),h=Math.sin(i),d=t.y+h*(this.x-t.x)+s*(this.y-t.y);return this.x=t.x+s*(this.x-t.x)-h*(this.y-t.y),this.y=d,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},P.convert=function(i){return i instanceof P?i:Array.isArray(i)?new P(i[0],i[1]):i};var M=w(C),B=U;function U(i,t,s,h){this.cx=3*i,this.bx=3*(s-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(h-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=s,this.p2y=h}U.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var s=i,h=0;h<8;h++){var d=this.sampleCurveX(s)-i;if(Math.abs(d)<t)return s;var _=this.sampleCurveDerivativeX(s);if(Math.abs(_)<1e-6)break;s-=d/_}var v=0,b=1;for(s=i,h=0;h<20&&(d=this.sampleCurveX(s),!(Math.abs(d-i)<t));h++)i>d?v=s:b=s,s=.5*(b-v)+v;return s},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};var N=w(B);let j,re;function pe(){return j==null&&(j=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),j}function X(){if(re==null&&(re=!1,pe())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let h=0;h<5*5;h++){const d=4*h;t.fillStyle=`rgb(${d},${d+1},${d+2})`,t.fillRect(h%5,Math.floor(h/5),1,1)}const s=t.getImageData(0,0,5,5).data;for(let h=0;h<5*5*4;h++)if(h%4!=3&&s[h]!==h){re=!0;break}}}return re||!1}function le(i,t,s,h){const d=new N(i,t,s,h);return function(_){return d.solve(_)}}const ye=le(.25,.1,.25,1);function we(i,t,s){return Math.min(s,Math.max(t,i))}function ae(i,t,s){const h=s-t,d=((i-t)%h+h)%h+t;return d===t?s:d}function ze(i,...t){for(const s of t)for(const h in s)i[h]=s[h];return i}let Ie=1;function $e(i,t,s){const h={};for(const d in i)h[d]=t.call(s||this,i[d],d,i);return h}function je(i,t,s){const h={};for(const d in i)t.call(s||this,i[d],d,i)&&(h[d]=i[d]);return h}function Le(i){return Array.isArray(i)?i.map(Le):typeof i=="object"&&i?$e(i,Le):i}const it={};function ft(i){it[i]||(typeof console<"u"&&console.warn(i),it[i]=!0)}function ct(i,t,s){return(s.y-i.y)*(t.x-i.x)>(t.y-i.y)*(s.x-i.x)}function xt(i){let t=0;for(let s,h,d=0,_=i.length,v=_-1;d<_;v=d++)s=i[d],h=i[v],t+=(h.x-s.x)*(s.y+h.y);return t}function ht(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let Yt=null;function He(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const Nt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Ft(i,t,s,h,d){return E(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const _=new VideoFrame(i,{timestamp:0});try{const v=_?.format;if(!v||!v.startsWith("BGR")&&!v.startsWith("RGB"))throw new Error(`Unrecognized format ${v}`);const b=v.startsWith("BGR"),k=new Uint8ClampedArray(h*d*4);if(yield _.copyTo(k,function(I,D,O,G,q){const Z=4*Math.max(-D,0),ne=(Math.max(0,O)-O)*G*4+Z,xe=4*G,be=Math.max(0,D),Be=Math.max(0,O);return{rect:{x:be,y:Be,width:Math.min(I.width,D+G)-be,height:Math.min(I.height,O+q)-Be},layout:[{offset:ne,stride:xe}]}}(i,t,s,h,d)),b)for(let I=0;I<k.length;I+=4){const D=k[I];k[I]=k[I+2],k[I+2]=D}return k}finally{_.close()}})}let ue,Te,Ee,Se;const Ke={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(i){const t=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(i,t=0){return this.getImageCanvasContext(i).getImageData(-t,-t,i.width+2*t,i.height+2*t)},getImageCanvasContext(i){const t=window.document.createElement("canvas"),s=t.getContext("2d",{willReadFrequently:!0});if(!s)throw new Error("failed to create canvas 2d context");return t.width=i.width,t.height=i.height,s.drawImage(i,0,0,i.width,i.height),s},resolveURL:i=>(Ee||(Ee=document.createElement("a")),Ee.href=i,Ee.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Se==null&&(Se=matchMedia("(prefers-reduced-motion: reduce)")),Se.matches)}},pt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class _t extends Error{constructor(t,s,h,d){super(`AJAXError: ${s} (${t}): ${h}`),this.status=t,this.statusText=s,this.url=h,this.body=d}}const ut=ht()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,tt=i=>pt.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))];function Zt(i,t){const s=new AbortController,h=new Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,cache:i.cache,referrer:ut(),signal:s.signal});let d=!1,_=!1;return i.type==="json"&&h.headers.set("Accept","application/json"),_||fetch(h).then(v=>v.ok?(b=>{(i.type==="arrayBuffer"||i.type==="image"?b.arrayBuffer():i.type==="json"?b.json():b.text()).then(k=>{_||(d=!0,t(null,k,b.headers.get("Cache-Control"),b.headers.get("Expires")))}).catch(k=>{_||t(new Error(k.message))})})(v):v.blob().then(b=>t(new _t(v.status,v.statusText,i.url,b)))).catch(v=>{v.code!==20&&t(new Error(v.message))}),{cancel:()=>{_=!0,d||s.abort()}}}const ge=function(i,t){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){if(ht()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,t);if(!ht())return(tt(i.url)||Zt)(i,t)}if(!(/^file:/.test(s=i.url)||/^file:/.test(ut())&&!/^\w+:/.test(s))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return Zt(i,t);if(ht()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,t,void 0,!0)}var s;return function(h,d){const _=new XMLHttpRequest;_.open(h.method||"GET",h.url,!0),h.type!=="arrayBuffer"&&h.type!=="image"||(_.responseType="arraybuffer");for(const v in h.headers)_.setRequestHeader(v,h.headers[v]);return h.type==="json"&&(_.responseType="text",_.setRequestHeader("Accept","application/json")),_.withCredentials=h.credentials==="include",_.onerror=()=>{d(new Error(_.statusText))},_.onload=()=>{if((_.status>=200&&_.status<300||_.status===0)&&_.response!==null){let v=_.response;if(h.type==="json")try{v=JSON.parse(_.response)}catch(b){return d(b)}d(null,v,_.getResponseHeader("Cache-Control"),_.getResponseHeader("Expires"))}else{const v=new Blob([_.response],{type:_.getResponseHeader("Content-Type")});d(new _t(_.status,_.statusText,h.url,v))}},_.send(h.body),{cancel:()=>_.abort()}}(i,t)},Qt=function(i,t){return ge(ze(i,{type:"arrayBuffer"}),t)};function Xt(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const t=new URL(i),s=window.location;return t.protocol===s.protocol&&t.host===s.host}function or(i,t,s){s[i]&&s[i].indexOf(t)!==-1||(s[i]=s[i]||[],s[i].push(t))}function Jt(i,t,s){if(s&&s[i]){const h=s[i].indexOf(t);h!==-1&&s[i].splice(h,1)}}class wt{constructor(t,s={}){ze(this,s),this.type=t}}class cr extends wt{constructor(t,s={}){super("error",ze({error:t},s))}}class Pr{on(t,s){return this._listeners=this._listeners||{},or(t,s,this._listeners),this}off(t,s){return Jt(t,s,this._listeners),Jt(t,s,this._oneTimeListeners),this}once(t,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},or(t,s,this._oneTimeListeners),this):new Promise(h=>this.once(t,h))}fire(t,s){typeof t=="string"&&(t=new wt(t,s||{}));const h=t.type;if(this.listens(h)){t.target=this;const d=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const b of d)b.call(this,t);const _=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const b of _)Jt(h,b,this._oneTimeListeners),b.call(this,t);const v=this._eventedParent;v&&(ze(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),v.fire(t))}else t instanceof cr&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,s){return this._eventedParent=t,this._eventedParentData=s,this}}var qe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Cr=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Br(i,t){const s={};for(const h in i)h!=="ref"&&(s[h]=i[h]);return Cr.forEach(h=>{h in t&&(s[h]=t[h])}),s}function ar(i,t){if(Array.isArray(i)){if(!Array.isArray(t)||i.length!==t.length)return!1;for(let s=0;s<i.length;s++)if(!ar(i[s],t[s]))return!1;return!0}if(typeof i=="object"&&i!==null&&t!==null){if(typeof t!="object"||Object.keys(i).length!==Object.keys(t).length)return!1;for(const s in i)if(!ar(i[s],t[s]))return!1;return!0}return i===t}const Gt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function ur(i,t,s){s.push({command:Gt.addSource,args:[i,t[i]]})}function ir(i,t,s){t.push({command:Gt.removeSource,args:[i]}),s[i]=!0}function Dr(i,t,s,h){ir(i,s,h),ur(i,t,s)}function wr(i,t,s){let h;for(h in i[s])if(Object.prototype.hasOwnProperty.call(i[s],h)&&h!=="data"&&!ar(i[s][h],t[s][h]))return!1;for(h in t[s])if(Object.prototype.hasOwnProperty.call(t[s],h)&&h!=="data"&&!ar(i[s][h],t[s][h]))return!1;return!0}function Nr(i,t,s,h,d,_){let v;for(v in t=t||{},i=i||{})Object.prototype.hasOwnProperty.call(i,v)&&(ar(i[v],t[v])||s.push({command:_,args:[h,v,t[v],d]}));for(v in t)Object.prototype.hasOwnProperty.call(t,v)&&!Object.prototype.hasOwnProperty.call(i,v)&&(ar(i[v],t[v])||s.push({command:_,args:[h,v,t[v],d]}))}function Ht(i){return i.id}function br(i,t){return i[t.id]=t,i}class ot{constructor(t,s,h,d){this.message=(t?`${t}: `:"")+h,d&&(this.identifier=d),s!=null&&s.__line__&&(this.line=s.__line__)}}function Pt(i,...t){for(const s of t)for(const h in s)i[h]=s[h];return i}class Mt extends Error{constructor(t,s){super(s),this.message=s,this.key=t}}class lr{constructor(t,s=[]){this.parent=t,this.bindings={};for(const[h,d]of s)this.bindings[h]=d}concat(t){return new lr(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const tr={kind:"null"},at={kind:"number"},Rt={kind:"string"},Vt={kind:"boolean"},Lr={kind:"color"},Kr={kind:"object"},rr={kind:"value"},Aa={kind:"collator"},ce={kind:"formatted"},V={kind:"padding"},H={kind:"resolvedImage"},te={kind:"variableAnchorOffsetCollection"};function fe(i,t){return{kind:"array",itemType:i,N:t}}function me(i){if(i.kind==="array"){const t=me(i.itemType);return typeof i.N=="number"?`array<${t}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${t}>`}return i.kind}const Oe=[tr,at,Rt,Vt,Lr,ce,Kr,fe(rr),V,H,te];function Ce(i,t){if(t.kind==="error")return null;if(i.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Ce(i.itemType,t.itemType))&&(typeof i.N!="number"||i.N===t.N))return null}else{if(i.kind===t.kind)return null;if(i.kind==="value"){for(const s of Oe)if(!Ce(s,t))return null}}return`Expected ${me(i)} but found ${me(t)} instead.`}function ve(i,t){return t.some(s=>s.kind===i.kind)}function Me(i,t){return t.some(s=>s==="null"?i===null:s==="array"?Array.isArray(i):s==="object"?i&&!Array.isArray(i)&&typeof i=="object":s===typeof i)}function Qe(i,t){return i.kind==="array"&&t.kind==="array"?i.itemType.kind===t.itemType.kind&&typeof i.N=="number":i.kind===t.kind}const et=.96422,z=.82521,Q=4/29,Y=6/29,K=3*Y*Y,ee=Y*Y*Y,J=Math.PI/180,Ae=180/Math.PI;function Ue(i){return(i%=360)<0&&(i+=360),i}function Fe([i,t,s,h]){let d,_;const v=Ve((.2225045*(i=De(i))+.7168786*(t=De(t))+.0606169*(s=De(s)))/1);i===t&&t===s?d=_=v:(d=Ve((.4360747*i+.3850649*t+.1430804*s)/et),_=Ve((.0139322*i+.0971045*t+.7141733*s)/z));const b=116*v-16;return[b<0?0:b,500*(d-v),200*(v-_),h]}function De(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Ve(i){return i>ee?Math.pow(i,1/3):i/K+Q}function Ye([i,t,s,h]){let d=(i+16)/116,_=isNaN(t)?d:d+t/500,v=isNaN(s)?d:d-s/200;return d=1*yt(d),_=et*yt(_),v=z*yt(v),[nt(3.1338561*_-1.6168667*d-.4906146*v),nt(-.9787684*_+1.9161415*d+.033454*v),nt(.0719453*_-.2289914*d+1.4052427*v),h]}function nt(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function yt(i){return i>Y?i*i*i:K*(i-Q)}function dt(i){return parseInt(i.padEnd(2,i),16)/255}function It(i,t){return Kt(t?i/100:i,0,1)}function Kt(i,t,s){return Math.min(Math.max(t,i),s)}function _r(i){return!i.some(Number.isNaN)}const Ar={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class er{constructor(t,s,h,d=1,_=!0){this.r=t,this.g=s,this.b=h,this.a=d,_||(this.r*=d,this.g*=d,this.b*=d,d||this.overwriteGetter("rgb",[t,s,h,d]))}static parse(t){if(t instanceof er)return t;if(typeof t!="string")return;const s=function(h){if((h=h.toLowerCase().trim())==="transparent")return[0,0,0,0];const d=Ar[h];if(d){const[v,b,k]=d;return[v/255,b/255,k/255,1]}if(h.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(h)){const v=h.length<6?1:2;let b=1;return[dt(h.slice(b,b+=v)),dt(h.slice(b,b+=v)),dt(h.slice(b,b+=v)),dt(h.slice(b,b+v)||"ff")]}if(h.startsWith("rgb")){const v=h.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(v){const[b,k,I,D,O,G,q,Z,ne,xe,be,Be]=v,ke=[D||" ",q||" ",xe].join("");if(ke==="  "||ke==="  /"||ke===",,"||ke===",,,"){const Ne=[I,G,ne].join(""),We=Ne==="%%%"?100:Ne===""?255:0;if(We){const st=[Kt(+k/We,0,1),Kt(+O/We,0,1),Kt(+Z/We,0,1),be?It(+be,Be):1];if(_r(st))return st}}return}}const _=h.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(_){const[v,b,k,I,D,O,G,q,Z]=_,ne=[k||" ",D||" ",G].join("");if(ne==="  "||ne==="  /"||ne===",,"||ne===",,,"){const xe=[+b,Kt(+I,0,100),Kt(+O,0,100),q?It(+q,Z):1];if(_r(xe))return function([be,Be,ke,Ne]){function We(st){const At=(st+be/30)%12,Bt=Be*Math.min(ke,1-ke);return ke-Bt*Math.max(-1,Math.min(At-3,9-At,1))}return be=Ue(be),Be/=100,ke/=100,[We(0),We(8),We(4),Ne]}(xe)}}}(t);return s?new er(...s,!1):void 0}get rgb(){const{r:t,g:s,b:h,a:d}=this,_=d||1/0;return this.overwriteGetter("rgb",[t/_,s/_,h/_,d])}get hcl(){return this.overwriteGetter("hcl",function(t){const[s,h,d,_]=Fe(t),v=Math.sqrt(h*h+d*d);return[Math.round(1e4*v)?Ue(Math.atan2(d,h)*Ae):NaN,v,s,_]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Fe(this.rgb))}overwriteGetter(t,s){return Object.defineProperty(this,t,{value:s}),s}toString(){const[t,s,h,d]=this.rgb;return`rgba(${[t,s,h].map(_=>Math.round(255*_)).join(",")},${d})`}}er.black=new er(0,0,0,1),er.white=new er(1,1,1,1),er.transparent=new er(0,0,0,0),er.red=new er(1,0,0,1);class ua{constructor(t,s,h){this.sensitivity=t?s?"variant":"case":s?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,s){return this.collator.compare(t,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ma{constructor(t,s,h,d,_){this.text=t,this.image=s,this.scale=h,this.fontStack=d,this.textColor=_}}class ea{constructor(t){this.sections=t}static fromString(t){return new ea([new ma(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof ea?t:ea.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class sa{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof sa)return t;if(typeof t=="number")return new sa([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const s of t)if(typeof s!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new sa(t)}}toString(){return JSON.stringify(this.values)}}const Ns=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class ta{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof ta)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let s=0;s<t.length;s+=2){const h=t[s],d=t[s+1];if(typeof h!="string"||!Ns.has(h)||!Array.isArray(d)||d.length!==2||typeof d[0]!="number"||typeof d[1]!="number")return}return new ta(t)}}toString(){return JSON.stringify(this.values)}}class Ia{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Ia({name:t,available:!1}):null}}function ko(i,t,s,h){return typeof i=="number"&&i>=0&&i<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof s=="number"&&s>=0&&s<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:`Invalid rgba value [${[i,t,s,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof h=="number"?[i,t,s,h]:[i,t,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function us(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof er||i instanceof ua||i instanceof ea||i instanceof sa||i instanceof ta||i instanceof Ia)return!0;if(Array.isArray(i)){for(const t of i)if(!us(t))return!1;return!0}if(typeof i=="object"){for(const t in i)if(!us(i[t]))return!1;return!0}return!1}function Hr(i){if(i===null)return tr;if(typeof i=="string")return Rt;if(typeof i=="boolean")return Vt;if(typeof i=="number")return at;if(i instanceof er)return Lr;if(i instanceof ua)return Aa;if(i instanceof ea)return ce;if(i instanceof sa)return V;if(i instanceof ta)return te;if(i instanceof Ia)return H;if(Array.isArray(i)){const t=i.length;let s;for(const h of i){const d=Hr(h);if(s){if(s===d)continue;s=rr;break}s=d}return fe(s||rr,t)}return Kr}function Tr(i){const t=typeof i;return i===null?"":t==="string"||t==="number"||t==="boolean"?String(i):i instanceof er||i instanceof ea||i instanceof sa||i instanceof ta||i instanceof Ia?i.toString():JSON.stringify(i)}class Vn{constructor(t,s){this.type=t,this.value=s}static parse(t,s){if(t.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!us(t[1]))return s.error("invalid value");const h=t[1];let d=Hr(h);const _=s.expectedType;return d.kind!=="array"||d.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(d=_),new Vn(d,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Yr{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const Co={string:Rt,number:at,boolean:Vt,object:Kr};class Mi{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");let h,d=1;const _=t[0];if(_==="array"){let b,k;if(t.length>2){const I=t[1];if(typeof I!="string"||!(I in Co)||I==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);b=Co[I],d++}else b=rr;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return s.error('The length argument to "array" must be a positive integer literal',2);k=t[2],d++}h=fe(b,k)}else{if(!Co[_])throw new Error(`Types doesn't contain name = ${_}`);h=Co[_]}const v=[];for(;d<t.length;d++){const b=s.parse(t[d],d,rr);if(!b)return null;v.push(b)}return new Mi(h,v)}evaluate(t){for(let s=0;s<this.args.length;s++){const h=this.args[s].evaluate(t);if(!Ce(this.type,Hr(h)))return h;if(s===this.args.length-1)throw new Yr(`Expected value to be of type ${me(this.type)}, but found ${me(Hr(h))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Sl={"to-boolean":Vt,"to-color":Lr,"to-number":at,"to-string":Rt};class Cn{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");const h=t[0];if(!Sl[h])throw new Error(`Can't parse ${h} as it is not part of the known types`);if((h==="to-boolean"||h==="to-string")&&t.length!==2)return s.error("Expected one argument.");const d=Sl[h],_=[];for(let v=1;v<t.length;v++){const b=s.parse(t[v],v,rr);if(!b)return null;_.push(b)}return new Cn(d,_)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let s,h;for(const d of this.args){if(s=d.evaluate(t),h=null,s instanceof er)return s;if(typeof s=="string"){const _=t.parseColor(s);if(_)return _}else if(Array.isArray(s)&&(h=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:ko(s[0],s[1],s[2],s[3]),!h))return new er(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new Yr(h||`Could not parse color from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"padding":{let s;for(const h of this.args){s=h.evaluate(t);const d=sa.parse(s);if(d)return d}throw new Yr(`Could not parse padding from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"variableAnchorOffsetCollection":{let s;for(const h of this.args){s=h.evaluate(t);const d=ta.parse(s);if(d)return d}throw new Yr(`Could not parse variableAnchorOffsetCollection from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"number":{let s=null;for(const h of this.args){if(s=h.evaluate(t),s===null)return 0;const d=Number(s);if(!isNaN(d))return d}throw new Yr(`Could not convert ${JSON.stringify(s)} to number.`)}case"formatted":return ea.fromString(Tr(this.args[0].evaluate(t)));case"resolvedImage":return Ia.fromString(Tr(this.args[0].evaluate(t)));default:return Tr(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const cu=["Unknown","Point","LineString","Polygon"];class kl{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?cu[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let s=this._parseColorCache[t];return s||(s=this._parseColorCache[t]=er.parse(t)),s}}class Ao{constructor(t,s,h=[],d,_=new lr,v=[]){this.registry=t,this.path=h,this.key=h.map(b=>`[${b}]`).join(""),this.scope=_,this.errors=v,this.expectedType=d,this._isConstant=s}parse(t,s,h,d,_={}){return s?this.concat(s,h,d)._parse(t,_):this._parse(t,_)}_parse(t,s){function h(d,_,v){return v==="assert"?new Mi(_,[d]):v==="coerce"?new Cn(_,[d]):d}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const d=t[0];if(typeof d!="string")return this.error(`Expression name must be a string, but found ${typeof d} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const _=this.registry[d];if(_){let v=_.parse(t,this);if(!v)return null;if(this.expectedType){const b=this.expectedType,k=v.type;if(b.kind!=="string"&&b.kind!=="number"&&b.kind!=="boolean"&&b.kind!=="object"&&b.kind!=="array"||k.kind!=="value")if(b.kind!=="color"&&b.kind!=="formatted"&&b.kind!=="resolvedImage"||k.kind!=="value"&&k.kind!=="string")if(b.kind!=="padding"||k.kind!=="value"&&k.kind!=="number"&&k.kind!=="array")if(b.kind!=="variableAnchorOffsetCollection"||k.kind!=="value"&&k.kind!=="array"){if(this.checkSubtype(b,k))return null}else v=h(v,b,s.typeAnnotation||"coerce");else v=h(v,b,s.typeAnnotation||"coerce");else v=h(v,b,s.typeAnnotation||"coerce");else v=h(v,b,s.typeAnnotation||"assert")}if(!(v instanceof Vn)&&v.type.kind!=="resolvedImage"&&this._isConstant(v)){const b=new kl;try{v=new Vn(v.type,v.evaluate(b))}catch(k){return this.error(k.message),null}}return v}return this.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,s,h){const d=typeof t=="number"?this.path.concat(t):this.path,_=h?this.scope.concat(h):this.scope;return new Ao(this.registry,this._isConstant,d,s||null,_,this.errors)}error(t,...s){const h=`${this.key}${s.map(d=>`[${d}]`).join("")}`;this.errors.push(new Mt(h,t))}checkSubtype(t,s){const h=Ce(t,s);return h&&this.error(h),h}}class Io{constructor(t,s,h){this.type=Aa,this.locale=h,this.caseSensitive=t,this.diacriticSensitive=s}static parse(t,s){if(t.length!==2)return s.error("Expected one argument.");const h=t[1];if(typeof h!="object"||Array.isArray(h))return s.error("Collator options argument must be an object.");const d=s.parse(h["case-sensitive"]!==void 0&&h["case-sensitive"],1,Vt);if(!d)return null;const _=s.parse(h["diacritic-sensitive"]!==void 0&&h["diacritic-sensitive"],1,Vt);if(!_)return null;let v=null;return h.locale&&(v=s.parse(h.locale,1,Rt),!v)?null:new Io(d,_,v)}evaluate(t){return new ua(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}const An=8192;function Cl(i,t){i[0]=Math.min(i[0],t[0]),i[1]=Math.min(i[1],t[1]),i[2]=Math.max(i[2],t[0]),i[3]=Math.max(i[3],t[1])}function Us(i,t){return!(i[0]<=t[0]||i[2]>=t[2]||i[1]<=t[1]||i[3]>=t[3])}function uu(i,t){const s=(180+i[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,d=Math.pow(2,t.z);return[Math.round(s*d*An),Math.round(h*d*An)]}function Yh(i,t,s){const h=i[0]-t[0],d=i[1]-t[1],_=i[0]-s[0],v=i[1]-s[1];return h*v-_*d==0&&h*_<=0&&d*v<=0}function Al(i,t){let s=!1;for(let v=0,b=t.length;v<b;v++){const k=t[v];for(let I=0,D=k.length;I<D-1;I++){if(Yh(i,k[I],k[I+1]))return!1;(d=k[I])[1]>(h=i)[1]!=(_=k[I+1])[1]>h[1]&&h[0]<(_[0]-d[0])*(h[1]-d[1])/(_[1]-d[1])+d[0]&&(s=!s)}}var h,d,_;return s}function Il(i,t){for(let s=0;s<t.length;s++)if(Al(i,t[s]))return!0;return!1}function hu(i,t,s,h){const d=h[0]-s[0],_=h[1]-s[1],v=(i[0]-s[0])*_-d*(i[1]-s[1]),b=(t[0]-s[0])*_-d*(t[1]-s[1]);return v>0&&b<0||v<0&&b>0}function Jh(i,t,s){for(const I of s)for(let D=0;D<I.length-1;++D)if((b=[(v=I[D+1])[0]-(_=I[D])[0],v[1]-_[1]])[0]*(k=[(d=t)[0]-(h=i)[0],d[1]-h[1]])[1]-b[1]*k[0]!=0&&hu(h,d,_,v)&&hu(_,v,h,d))return!0;var h,d,_,v,b,k;return!1}function fu(i,t){for(let s=0;s<i.length;++s)if(!Al(i[s],t))return!1;for(let s=0;s<i.length-1;++s)if(Jh(i[s],i[s+1],t))return!1;return!0}function du(i,t){for(let s=0;s<t.length;s++)if(fu(i,t[s]))return!0;return!1}function Fo(i,t,s){const h=[];for(let d=0;d<i.length;d++){const _=[];for(let v=0;v<i[d].length;v++){const b=uu(i[d][v],s);Cl(t,b),_.push(b)}h.push(_)}return h}function pu(i,t,s){const h=[];for(let d=0;d<i.length;d++){const _=Fo(i[d],t,s);h.push(_)}return h}function mu(i,t,s,h){if(i[0]<s[0]||i[0]>s[2]){const d=.5*h;let _=i[0]-s[0]>d?-h:s[0]-i[0]>d?h:0;_===0&&(_=i[0]-s[2]>d?-h:s[2]-i[0]>d?h:0),i[0]+=_}Cl(t,i)}function Fl(i,t,s,h){const d=Math.pow(2,h.z)*An,_=[h.x*An,h.y*An],v=[];for(const b of i)for(const k of b){const I=[k.x+_[0],k.y+_[1]];mu(I,t,s,d),v.push(I)}return v}function Pl(i,t,s,h){const d=Math.pow(2,h.z)*An,_=[h.x*An,h.y*An],v=[];for(const k of i){const I=[];for(const D of k){const O=[D.x+_[0],D.y+_[1]];Cl(t,O),I.push(O)}v.push(I)}if(t[2]-t[0]<=d/2){(b=t)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(const k of v)for(const I of k)mu(I,t,s,d)}var b;return v}class $n{constructor(t,s){this.type=Vt,this.geojson=t,this.geometries=s}static parse(t,s){if(t.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(us(t[1])){const h=t[1];if(h.type==="FeatureCollection")for(let d=0;d<h.features.length;++d){const _=h.features[d].geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new $n(h,h.features[d].geometry)}else if(h.type==="Feature"){const d=h.geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new $n(h,h.geometry)}else if(h.type==="Polygon"||h.type==="MultiPolygon")return new $n(h,h)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(s,h){const d=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],v=s.canonicalID();if(h.type==="Polygon"){const b=Fo(h.coordinates,_,v),k=Fl(s.geometry(),d,_,v);if(!Us(d,_))return!1;for(const I of k)if(!Al(I,b))return!1}if(h.type==="MultiPolygon"){const b=pu(h.coordinates,_,v),k=Fl(s.geometry(),d,_,v);if(!Us(d,_))return!1;for(const I of k)if(!Il(I,b))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(s,h){const d=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],v=s.canonicalID();if(h.type==="Polygon"){const b=Fo(h.coordinates,_,v),k=Pl(s.geometry(),d,_,v);if(!Us(d,_))return!1;for(const I of k)if(!fu(I,b))return!1}if(h.type==="MultiPolygon"){const b=pu(h.coordinates,_,v),k=Pl(s.geometry(),d,_,v);if(!Us(d,_))return!1;for(const I of k)if(!du(I,b))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Po{constructor(t,s){this.type=s.type,this.name=t,this.boundExpression=s}static parse(t,s){if(t.length!==2||typeof t[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const h=t[1];return s.scope.has(h)?new Po(h,s.scope.get(h)):s.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Di{constructor(t,s,h,d){this.name=t,this.type=s,this._evaluate=h,this.args=d}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,s){const h=t[0],d=Di.definitions[h];if(!d)return s.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);const _=Array.isArray(d)?d[0]:d.type,v=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,b=v.filter(([I])=>!Array.isArray(I)||I.length===t.length-1);let k=null;for(const[I,D]of b){k=new Ao(s.registry,Mo,s.path,null,s.scope);const O=[];let G=!1;for(let q=1;q<t.length;q++){const Z=t[q],ne=Array.isArray(I)?I[q-1]:I.type,xe=k.parse(Z,1+O.length,ne);if(!xe){G=!0;break}O.push(xe)}if(!G)if(Array.isArray(I)&&I.length!==O.length)k.error(`Expected ${I.length} arguments, but found ${O.length} instead.`);else{for(let q=0;q<O.length;q++){const Z=Array.isArray(I)?I[q]:I.type,ne=O[q];k.concat(q+1).checkSubtype(Z,ne.type)}if(k.errors.length===0)return new Di(h,_,D,O)}}if(b.length===1)s.errors.push(...k.errors);else{const I=(b.length?b:v).map(([O])=>{return G=O,Array.isArray(G)?`(${G.map(me).join(", ")})`:`(${me(G.type)}...)`;var G}).join(" | "),D=[];for(let O=1;O<t.length;O++){const G=s.parse(t[O],1+D.length);if(!G)return null;D.push(me(G.type))}s.error(`Expected arguments of type ${I}, but found (${D.join(", ")}) instead.`)}return null}static register(t,s){Di.definitions=s;for(const h in s)t[h]=Di}}function Mo(i){if(i instanceof Po)return Mo(i.boundExpression);if(i instanceof Di&&i.name==="error"||i instanceof Io||i instanceof $n)return!1;const t=i instanceof Cn||i instanceof Mi;let s=!0;return i.eachChild(h=>{s=t?s&&Mo(h):s&&h instanceof Vn}),!!s&&Do(i)&&Lo(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Do(i){if(i instanceof Di&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof $n)return!1;let t=!0;return i.eachChild(s=>{t&&!Do(s)&&(t=!1)}),t}function Vs(i){if(i instanceof Di&&i.name==="feature-state")return!1;let t=!0;return i.eachChild(s=>{t&&!Vs(s)&&(t=!1)}),t}function Lo(i,t){if(i instanceof Di&&t.indexOf(i.name)>=0)return!1;let s=!0;return i.eachChild(h=>{s&&!Lo(h,t)&&(s=!1)}),s}function hs(i,t){const s=i.length-1;let h,d,_=0,v=s,b=0;for(;_<=v;)if(b=Math.floor((_+v)/2),h=i[b],d=i[b+1],h<=t){if(b===s||t<d)return b;_=b+1}else{if(!(h>t))throw new Yr("Input is not a number.");v=b-1}return 0}class In{constructor(t,s,h){this.type=t,this.input=s,this.labels=[],this.outputs=[];for(const[d,_]of h)this.labels.push(d),this.outputs.push(_)}static parse(t,s){if(t.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return s.error("Expected an even number of arguments.");const h=s.parse(t[1],1,at);if(!h)return null;const d=[];let _=null;s.expectedType&&s.expectedType.kind!=="value"&&(_=s.expectedType);for(let v=1;v<t.length;v+=2){const b=v===1?-1/0:t[v],k=t[v+1],I=v,D=v+1;if(typeof b!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(d.length&&d[d.length-1][0]>=b)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',I);const O=s.parse(k,D,_);if(!O)return null;_=_||O.type,d.push([b,O])}return new In(_,h,d)}evaluate(t){const s=this.labels,h=this.outputs;if(s.length===1)return h[0].evaluate(t);const d=this.input.evaluate(t);if(d<=s[0])return h[0].evaluate(t);const _=s.length;return d>=s[_-1]?h[_-1].evaluate(t):h[hs(s,d)].evaluate(t)}eachChild(t){t(this.input);for(const s of this.outputs)t(s)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function yr(i,t,s){return i+s*(t-i)}function Ro(i,t,s){return i.map((h,d)=>yr(h,t[d],s))}const mi={number:yr,color:function(i,t,s,h="rgb"){switch(h){case"rgb":{const[d,_,v,b]=Ro(i.rgb,t.rgb,s);return new er(d,_,v,b,!1)}case"hcl":{const[d,_,v,b]=i.hcl,[k,I,D,O]=t.hcl;let G,q;if(isNaN(d)||isNaN(k))isNaN(d)?isNaN(k)?G=NaN:(G=k,v!==1&&v!==0||(q=I)):(G=d,D!==1&&D!==0||(q=_));else{let Be=k-d;k>d&&Be>180?Be-=360:k<d&&d-k>180&&(Be+=360),G=d+s*Be}const[Z,ne,xe,be]=function([Be,ke,Ne,We]){return Be=isNaN(Be)?0:Be*J,Ye([Ne,Math.cos(Be)*ke,Math.sin(Be)*ke,We])}([G,q??yr(_,I,s),yr(v,D,s),yr(b,O,s)]);return new er(Z,ne,xe,be,!1)}case"lab":{const[d,_,v,b]=Ye(Ro(i.lab,t.lab,s));return new er(d,_,v,b,!1)}}},array:Ro,padding:function(i,t,s){return new sa(Ro(i.values,t.values,s))},variableAnchorOffsetCollection:function(i,t,s){const h=i.values,d=t.values;if(h.length!==d.length)throw new Yr(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${t.toString()}`);const _=[];for(let v=0;v<h.length;v+=2){if(h[v]!==d[v])throw new Yr(`Cannot interpolate values containing mismatched anchors. from[${v}]: ${h[v]}, to[${v}]: ${d[v]}`);_.push(h[v]);const[b,k]=h[v+1],[I,D]=d[v+1];_.push([yr(b,I,s),yr(k,D,s)])}return new ta(_)}};class gi{constructor(t,s,h,d,_){this.type=t,this.operator=s,this.interpolation=h,this.input=d,this.labels=[],this.outputs=[];for(const[v,b]of _)this.labels.push(v),this.outputs.push(b)}static interpolationFactor(t,s,h,d){let _=0;if(t.name==="exponential")_=Ml(s,t.base,h,d);else if(t.name==="linear")_=Ml(s,1,h,d);else if(t.name==="cubic-bezier"){const v=t.controlPoints;_=new N(v[0],v[1],v[2],v[3]).solve(Ml(s,1,h,d))}return _}static parse(t,s){let[h,d,_,...v]=t;if(!Array.isArray(d)||d.length===0)return s.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){const I=d[1];if(typeof I!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:I}}else{if(d[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(d[0])}`,1,0);{const I=d.slice(1);if(I.length!==4||I.some(D=>typeof D!="number"||D<0||D>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:I}}}if(t.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(_=s.parse(_,2,at),!_)return null;const b=[];let k=null;h==="interpolate-hcl"||h==="interpolate-lab"?k=Lr:s.expectedType&&s.expectedType.kind!=="value"&&(k=s.expectedType);for(let I=0;I<v.length;I+=2){const D=v[I],O=v[I+1],G=I+3,q=I+4;if(typeof D!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',G);if(b.length&&b[b.length-1][0]>=D)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',G);const Z=s.parse(O,q,k);if(!Z)return null;k=k||Z.type,b.push([D,Z])}return Qe(k,at)||Qe(k,Lr)||Qe(k,V)||Qe(k,te)||Qe(k,fe(at))?new gi(k,h,d,_,b):s.error(`Type ${me(k)} is not interpolatable.`)}evaluate(t){const s=this.labels,h=this.outputs;if(s.length===1)return h[0].evaluate(t);const d=this.input.evaluate(t);if(d<=s[0])return h[0].evaluate(t);const _=s.length;if(d>=s[_-1])return h[_-1].evaluate(t);const v=hs(s,d),b=gi.interpolationFactor(this.interpolation,d,s[v],s[v+1]),k=h[v].evaluate(t),I=h[v+1].evaluate(t);switch(this.operator){case"interpolate":return mi[this.type.kind](k,I,b);case"interpolate-hcl":return mi.color(k,I,b,"hcl");case"interpolate-lab":return mi.color(k,I,b,"lab")}}eachChild(t){t(this.input);for(const s of this.outputs)t(s)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Ml(i,t,s,h){const d=h-s,_=i-s;return d===0?0:t===1?_/d:(Math.pow(t,_)-1)/(Math.pow(t,d)-1)}class Oo{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expectected at least one argument.");let h=null;const d=s.expectedType;d&&d.kind!=="value"&&(h=d);const _=[];for(const b of t.slice(1)){const k=s.parse(b,1+_.length,h,void 0,{typeAnnotation:"omit"});if(!k)return null;h=h||k.type,_.push(k)}if(!h)throw new Error("No output type");const v=d&&_.some(b=>Ce(d,b.type));return new Oo(v?rr:h,_)}evaluate(t){let s,h=null,d=0;for(const _ of this.args)if(d++,h=_.evaluate(t),h&&h instanceof Ia&&!h.available&&(s||(s=h.name),h=null,d===this.args.length&&(h=s)),h!==null)break;return h}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}class Bo{constructor(t,s){this.type=s.type,this.bindings=[].concat(t),this.result=s}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const s of this.bindings)t(s[1]);t(this.result)}static parse(t,s){if(t.length<4)return s.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const h=[];for(let _=1;_<t.length-1;_+=2){const v=t[_];if(typeof v!="string")return s.error(`Expected string, but found ${typeof v} instead.`,_);if(/[^a-zA-Z0-9_]/.test(v))return s.error("Variable names must contain only alphanumeric characters or '_'.",_);const b=s.parse(t[_+1],_+1);if(!b)return null;h.push([v,b])}const d=s.parse(t[t.length-1],t.length-1,s.expectedType,h);return d?new Bo(h,d):null}outputDefined(){return this.result.outputDefined()}}class Dl{constructor(t,s,h){this.type=t,this.index=s,this.input=h}static parse(t,s){if(t.length!==3)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const h=s.parse(t[1],1,at),d=s.parse(t[2],2,fe(s.expectedType||rr));return h&&d?new Dl(d.type.itemType,h,d):null}evaluate(t){const s=this.index.evaluate(t),h=this.input.evaluate(t);if(s<0)throw new Yr(`Array index out of bounds: ${s} < 0.`);if(s>=h.length)throw new Yr(`Array index out of bounds: ${s} > ${h.length-1}.`);if(s!==Math.floor(s))throw new Yr(`Array index must be an integer, but found ${s} instead.`);return h[s]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class Ll{constructor(t,s){this.type=Vt,this.needle=t,this.haystack=s}static parse(t,s){if(t.length!==3)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const h=s.parse(t[1],1,rr),d=s.parse(t[2],2,rr);return h&&d?ve(h.type,[Vt,Rt,at,tr,rr])?new Ll(h,d):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${me(h.type)} instead`):null}evaluate(t){const s=this.needle.evaluate(t),h=this.haystack.evaluate(t);if(!h)return!1;if(!Me(s,["boolean","string","number","null"]))throw new Yr(`Expected first argument to be of type boolean, string, number or null, but found ${me(Hr(s))} instead.`);if(!Me(h,["string","array"]))throw new Yr(`Expected second argument to be of type array or string, but found ${me(Hr(h))} instead.`);return h.indexOf(s)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class zo{constructor(t,s,h){this.type=at,this.needle=t,this.haystack=s,this.fromIndex=h}static parse(t,s){if(t.length<=2||t.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const h=s.parse(t[1],1,rr),d=s.parse(t[2],2,rr);if(!h||!d)return null;if(!ve(h.type,[Vt,Rt,at,tr,rr]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${me(h.type)} instead`);if(t.length===4){const _=s.parse(t[3],3,at);return _?new zo(h,d,_):null}return new zo(h,d)}evaluate(t){const s=this.needle.evaluate(t),h=this.haystack.evaluate(t);if(!Me(s,["boolean","string","number","null"]))throw new Yr(`Expected first argument to be of type boolean, string, number or null, but found ${me(Hr(s))} instead.`);if(!Me(h,["string","array"]))throw new Yr(`Expected second argument to be of type array or string, but found ${me(Hr(h))} instead.`);if(this.fromIndex){const d=this.fromIndex.evaluate(t);return h.indexOf(s,d)}return h.indexOf(s)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class Rl{constructor(t,s,h,d,_,v){this.inputType=t,this.type=s,this.input=h,this.cases=d,this.outputs=_,this.otherwise=v}static parse(t,s){if(t.length<5)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return s.error("Expected an even number of arguments.");let h,d;s.expectedType&&s.expectedType.kind!=="value"&&(d=s.expectedType);const _={},v=[];for(let I=2;I<t.length-1;I+=2){let D=t[I];const O=t[I+1];Array.isArray(D)||(D=[D]);const G=s.concat(I);if(D.length===0)return G.error("Expected at least one branch label.");for(const Z of D){if(typeof Z!="number"&&typeof Z!="string")return G.error("Branch labels must be numbers or strings.");if(typeof Z=="number"&&Math.abs(Z)>Number.MAX_SAFE_INTEGER)return G.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Z=="number"&&Math.floor(Z)!==Z)return G.error("Numeric branch labels must be integer values.");if(h){if(G.checkSubtype(h,Hr(Z)))return null}else h=Hr(Z);if(_[String(Z)]!==void 0)return G.error("Branch labels must be unique.");_[String(Z)]=v.length}const q=s.parse(O,I,d);if(!q)return null;d=d||q.type,v.push(q)}const b=s.parse(t[1],1,rr);if(!b)return null;const k=s.parse(t[t.length-1],t.length-1,d);return k?b.type.kind!=="value"&&s.concat(1).checkSubtype(h,b.type)?null:new Rl(h,d,b,_,v,k):null}evaluate(t){const s=this.input.evaluate(t);return(Hr(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class Ol{constructor(t,s,h){this.type=t,this.branches=s,this.otherwise=h}static parse(t,s){if(t.length<4)return s.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return s.error("Expected an odd number of arguments.");let h;s.expectedType&&s.expectedType.kind!=="value"&&(h=s.expectedType);const d=[];for(let v=1;v<t.length-1;v+=2){const b=s.parse(t[v],v,Vt);if(!b)return null;const k=s.parse(t[v+1],v+1,h);if(!k)return null;d.push([b,k]),h=h||k.type}const _=s.parse(t[t.length-1],t.length-1,h);if(!_)return null;if(!h)throw new Error("Can't infer output type");return new Ol(h,d,_)}evaluate(t){for(const[s,h]of this.branches)if(s.evaluate(t))return h.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[s,h]of this.branches)t(s),t(h);t(this.otherwise)}outputDefined(){return this.branches.every(([t,s])=>s.outputDefined())&&this.otherwise.outputDefined()}}class No{constructor(t,s,h,d){this.type=t,this.input=s,this.beginIndex=h,this.endIndex=d}static parse(t,s){if(t.length<=2||t.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const h=s.parse(t[1],1,rr),d=s.parse(t[2],2,at);if(!h||!d)return null;if(!ve(h.type,[fe(rr),Rt,rr]))return s.error(`Expected first argument to be of type array or string, but found ${me(h.type)} instead`);if(t.length===4){const _=s.parse(t[3],3,at);return _?new No(h.type,h,d,_):null}return new No(h.type,h,d)}evaluate(t){const s=this.input.evaluate(t),h=this.beginIndex.evaluate(t);if(!Me(s,["string","array"]))throw new Yr(`Expected first argument to be of type array or string, but found ${me(Hr(s))} instead.`);if(this.endIndex){const d=this.endIndex.evaluate(t);return s.slice(h,d)}return s.slice(h)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function gu(i,t){return i==="=="||i==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function xu(i,t,s,h){return h.compare(t,s)===0}function fs(i,t,s){const h=i!=="=="&&i!=="!=";return class n1{constructor(_,v,b){this.type=Vt,this.lhs=_,this.rhs=v,this.collator=b,this.hasUntypedArgument=_.type.kind==="value"||v.type.kind==="value"}static parse(_,v){if(_.length!==3&&_.length!==4)return v.error("Expected two or three arguments.");const b=_[0];let k=v.parse(_[1],1,rr);if(!k)return null;if(!gu(b,k.type))return v.concat(1).error(`"${b}" comparisons are not supported for type '${me(k.type)}'.`);let I=v.parse(_[2],2,rr);if(!I)return null;if(!gu(b,I.type))return v.concat(2).error(`"${b}" comparisons are not supported for type '${me(I.type)}'.`);if(k.type.kind!==I.type.kind&&k.type.kind!=="value"&&I.type.kind!=="value")return v.error(`Cannot compare types '${me(k.type)}' and '${me(I.type)}'.`);h&&(k.type.kind==="value"&&I.type.kind!=="value"?k=new Mi(I.type,[k]):k.type.kind!=="value"&&I.type.kind==="value"&&(I=new Mi(k.type,[I])));let D=null;if(_.length===4){if(k.type.kind!=="string"&&I.type.kind!=="string"&&k.type.kind!=="value"&&I.type.kind!=="value")return v.error("Cannot use collator to compare non-string types.");if(D=v.parse(_[3],3,Aa),!D)return null}return new n1(k,I,D)}evaluate(_){const v=this.lhs.evaluate(_),b=this.rhs.evaluate(_);if(h&&this.hasUntypedArgument){const k=Hr(v),I=Hr(b);if(k.kind!==I.kind||k.kind!=="string"&&k.kind!=="number")throw new Yr(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${k.kind}, ${I.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){const k=Hr(v),I=Hr(b);if(k.kind!=="string"||I.kind!=="string")return t(_,v,b)}return this.collator?s(_,v,b,this.collator.evaluate(_)):t(_,v,b)}eachChild(_){_(this.lhs),_(this.rhs),this.collator&&_(this.collator)}outputDefined(){return!0}}}const Qh=fs("==",function(i,t,s){return t===s},xu),ef=fs("!=",function(i,t,s){return t!==s},function(i,t,s,h){return!xu(0,t,s,h)}),tf=fs("<",function(i,t,s){return t<s},function(i,t,s,h){return h.compare(t,s)<0}),rf=fs(">",function(i,t,s){return t>s},function(i,t,s,h){return h.compare(t,s)>0}),af=fs("<=",function(i,t,s){return t<=s},function(i,t,s,h){return h.compare(t,s)<=0}),nf=fs(">=",function(i,t,s){return t>=s},function(i,t,s,h){return h.compare(t,s)>=0});class Bl{constructor(t,s,h,d,_){this.type=Rt,this.number=t,this.locale=s,this.currency=h,this.minFractionDigits=d,this.maxFractionDigits=_}static parse(t,s){if(t.length!==3)return s.error("Expected two arguments.");const h=s.parse(t[1],1,at);if(!h)return null;const d=t[2];if(typeof d!="object"||Array.isArray(d))return s.error("NumberFormat options argument must be an object.");let _=null;if(d.locale&&(_=s.parse(d.locale,1,Rt),!_))return null;let v=null;if(d.currency&&(v=s.parse(d.currency,1,Rt),!v))return null;let b=null;if(d["min-fraction-digits"]&&(b=s.parse(d["min-fraction-digits"],1,at),!b))return null;let k=null;return d["max-fraction-digits"]&&(k=s.parse(d["max-fraction-digits"],1,at),!k)?null:new Bl(h,_,v,b,k)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Uo{constructor(t){this.type=ce,this.sections=t}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");const h=t[1];if(!Array.isArray(h)&&typeof h=="object")return s.error("First argument must be an image or text section.");const d=[];let _=!1;for(let v=1;v<=t.length-1;++v){const b=t[v];if(_&&typeof b=="object"&&!Array.isArray(b)){_=!1;let k=null;if(b["font-scale"]&&(k=s.parse(b["font-scale"],1,at),!k))return null;let I=null;if(b["text-font"]&&(I=s.parse(b["text-font"],1,fe(Rt)),!I))return null;let D=null;if(b["text-color"]&&(D=s.parse(b["text-color"],1,Lr),!D))return null;const O=d[d.length-1];O.scale=k,O.font=I,O.textColor=D}else{const k=s.parse(t[v],1,rr);if(!k)return null;const I=k.type.kind;if(I!=="string"&&I!=="value"&&I!=="null"&&I!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,d.push({content:k,scale:null,font:null,textColor:null})}}return new Uo(d)}evaluate(t){return new ea(this.sections.map(s=>{const h=s.content.evaluate(t);return Hr(h)===H?new ma("",h,null,null,null):new ma(Tr(h),null,s.scale?s.scale.evaluate(t):null,s.font?s.font.evaluate(t).join(","):null,s.textColor?s.textColor.evaluate(t):null)}))}eachChild(t){for(const s of this.sections)t(s.content),s.scale&&t(s.scale),s.font&&t(s.font),s.textColor&&t(s.textColor)}outputDefined(){return!1}}class zl{constructor(t){this.type=H,this.input=t}static parse(t,s){if(t.length!==2)return s.error("Expected two arguments.");const h=s.parse(t[1],1,Rt);return h?new zl(h):s.error("No image name provided.")}evaluate(t){const s=this.input.evaluate(t),h=Ia.fromString(s);return h&&t.availableImages&&(h.available=t.availableImages.indexOf(s)>-1),h}eachChild(t){t(this.input)}outputDefined(){return!1}}class Nl{constructor(t){this.type=at,this.input=t}static parse(t,s){if(t.length!==2)return s.error(`Expected 1 argument, but found ${t.length-1} instead.`);const h=s.parse(t[1],1);return h?h.type.kind!=="array"&&h.type.kind!=="string"&&h.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${me(h.type)} instead.`):new Nl(h):null}evaluate(t){const s=this.input.evaluate(t);if(typeof s=="string"||Array.isArray(s))return s.length;throw new Yr(`Expected value to be of type string or array, but found ${me(Hr(s))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const ds={"==":Qh,"!=":ef,">":rf,"<":tf,">=":nf,"<=":af,array:Mi,at:Dl,boolean:Mi,case:Ol,coalesce:Oo,collator:Io,format:Uo,image:zl,in:Ll,"index-of":zo,interpolate:gi,"interpolate-hcl":gi,"interpolate-lab":gi,length:Nl,let:Bo,literal:Vn,match:Rl,number:Mi,"number-format":Bl,object:Mi,slice:No,step:In,string:Mi,"to-boolean":Cn,"to-color":Cn,"to-number":Cn,"to-string":Cn,var:Po,within:$n};function _u(i,[t,s,h,d]){t=t.evaluate(i),s=s.evaluate(i),h=h.evaluate(i);const _=d?d.evaluate(i):1,v=ko(t,s,h,_);if(v)throw new Yr(v);return new er(t/255,s/255,h/255,_,!1)}function yu(i,t){return i in t}function Ul(i,t){const s=t[i];return s===void 0?null:s}function jn(i){return{type:i}}function vu(i){return{result:"success",value:i}}function Fn(i){return{result:"error",value:i}}function ps(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function wu(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function Vl(i){return!!i.expression&&i.expression.interpolated}function Er(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Wr(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function sf(i){return i}function vr(i,t){const s=t.type==="color",h=i.stops&&typeof i.stops[0][0]=="object",d=h||!(h||i.property!==void 0),_=i.type||(Vl(t)?"exponential":"interval");if(s||t.type==="padding"){const D=s?er.parse:sa.parse;(i=Pt({},i)).stops&&(i.stops=i.stops.map(O=>[O[0],D(O[1])])),i.default=D(i.default?i.default:t.default)}if(i.colorSpace&&(v=i.colorSpace)!=="rgb"&&v!=="hcl"&&v!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var v;let b,k,I;if(_==="exponential")b=$s;else if(_==="interval")b=jr;else if(_==="categorical"){b=qr,k=Object.create(null);for(const D of i.stops)k[D[0]]=D[1];I=typeof i.stops[0][0]}else{if(_!=="identity")throw new Error(`Unknown function type "${_}"`);b=bu}if(h){const D={},O=[];for(let Z=0;Z<i.stops.length;Z++){const ne=i.stops[Z],xe=ne[0].zoom;D[xe]===void 0&&(D[xe]={zoom:xe,type:i.type,property:i.property,default:i.default,stops:[]},O.push(xe)),D[xe].stops.push([ne[0].value,ne[1]])}const G=[];for(const Z of O)G.push([D[Z].zoom,vr(D[Z],t)]);const q={name:"linear"};return{kind:"composite",interpolationType:q,interpolationFactor:gi.interpolationFactor.bind(void 0,q),zoomStops:G.map(Z=>Z[0]),evaluate:({zoom:Z},ne)=>$s({stops:G,base:i.base},t,Z).evaluate(Z,ne)}}if(d){const D=_==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:D,interpolationFactor:gi.interpolationFactor.bind(void 0,D),zoomStops:i.stops.map(O=>O[0]),evaluate:({zoom:O})=>b(i,t,O,k,I)}}return{kind:"source",evaluate(D,O){const G=O&&O.properties?O.properties[i.property]:void 0;return G===void 0?Gn(i.default,t.default):b(i,t,G,k,I)}}}function Gn(i,t,s){return i!==void 0?i:t!==void 0?t:s!==void 0?s:void 0}function qr(i,t,s,h,d){return Gn(typeof s===d?h[s]:void 0,i.default,t.default)}function jr(i,t,s){if(Er(s)!=="number")return Gn(i.default,t.default);const h=i.stops.length;if(h===1||s<=i.stops[0][0])return i.stops[0][1];if(s>=i.stops[h-1][0])return i.stops[h-1][1];const d=hs(i.stops.map(_=>_[0]),s);return i.stops[d][1]}function $s(i,t,s){const h=i.base!==void 0?i.base:1;if(Er(s)!=="number")return Gn(i.default,t.default);const d=i.stops.length;if(d===1||s<=i.stops[0][0])return i.stops[0][1];if(s>=i.stops[d-1][0])return i.stops[d-1][1];const _=hs(i.stops.map(D=>D[0]),s),v=function(D,O,G,q){const Z=q-G,ne=D-G;return Z===0?0:O===1?ne/Z:(Math.pow(O,ne)-1)/(Math.pow(O,Z)-1)}(s,h,i.stops[_][0],i.stops[_+1][0]),b=i.stops[_][1],k=i.stops[_+1][1],I=mi[t.type]||sf;return typeof b.evaluate=="function"?{evaluate(...D){const O=b.evaluate.apply(void 0,D),G=k.evaluate.apply(void 0,D);if(O!==void 0&&G!==void 0)return I(O,G,v,i.colorSpace)}}:I(b,k,v,i.colorSpace)}function bu(i,t,s){switch(t.type){case"color":s=er.parse(s);break;case"formatted":s=ea.fromString(s.toString());break;case"resolvedImage":s=Ia.fromString(s.toString());break;case"padding":s=sa.parse(s);break;default:Er(s)===t.type||t.type==="enum"&&t.values[s]||(s=void 0)}return Gn(s,i.default,t.default)}Di.register(ds,{error:[{kind:"error"},[Rt],(i,[t])=>{throw new Yr(t.evaluate(i))}],typeof:[Rt,[rr],(i,[t])=>me(Hr(t.evaluate(i)))],"to-rgba":[fe(at,4),[Lr],(i,[t])=>{const[s,h,d,_]=t.evaluate(i).rgb;return[255*s,255*h,255*d,_]}],rgb:[Lr,[at,at,at],_u],rgba:[Lr,[at,at,at,at],_u],has:{type:Vt,overloads:[[[Rt],(i,[t])=>yu(t.evaluate(i),i.properties())],[[Rt,Kr],(i,[t,s])=>yu(t.evaluate(i),s.evaluate(i))]]},get:{type:rr,overloads:[[[Rt],(i,[t])=>Ul(t.evaluate(i),i.properties())],[[Rt,Kr],(i,[t,s])=>Ul(t.evaluate(i),s.evaluate(i))]]},"feature-state":[rr,[Rt],(i,[t])=>Ul(t.evaluate(i),i.featureState||{})],properties:[Kr,[],i=>i.properties()],"geometry-type":[Rt,[],i=>i.geometryType()],id:[rr,[],i=>i.id()],zoom:[at,[],i=>i.globals.zoom],"heatmap-density":[at,[],i=>i.globals.heatmapDensity||0],"line-progress":[at,[],i=>i.globals.lineProgress||0],accumulated:[rr,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[at,jn(at),(i,t)=>{let s=0;for(const h of t)s+=h.evaluate(i);return s}],"*":[at,jn(at),(i,t)=>{let s=1;for(const h of t)s*=h.evaluate(i);return s}],"-":{type:at,overloads:[[[at,at],(i,[t,s])=>t.evaluate(i)-s.evaluate(i)],[[at],(i,[t])=>-t.evaluate(i)]]},"/":[at,[at,at],(i,[t,s])=>t.evaluate(i)/s.evaluate(i)],"%":[at,[at,at],(i,[t,s])=>t.evaluate(i)%s.evaluate(i)],ln2:[at,[],()=>Math.LN2],pi:[at,[],()=>Math.PI],e:[at,[],()=>Math.E],"^":[at,[at,at],(i,[t,s])=>Math.pow(t.evaluate(i),s.evaluate(i))],sqrt:[at,[at],(i,[t])=>Math.sqrt(t.evaluate(i))],log10:[at,[at],(i,[t])=>Math.log(t.evaluate(i))/Math.LN10],ln:[at,[at],(i,[t])=>Math.log(t.evaluate(i))],log2:[at,[at],(i,[t])=>Math.log(t.evaluate(i))/Math.LN2],sin:[at,[at],(i,[t])=>Math.sin(t.evaluate(i))],cos:[at,[at],(i,[t])=>Math.cos(t.evaluate(i))],tan:[at,[at],(i,[t])=>Math.tan(t.evaluate(i))],asin:[at,[at],(i,[t])=>Math.asin(t.evaluate(i))],acos:[at,[at],(i,[t])=>Math.acos(t.evaluate(i))],atan:[at,[at],(i,[t])=>Math.atan(t.evaluate(i))],min:[at,jn(at),(i,t)=>Math.min(...t.map(s=>s.evaluate(i)))],max:[at,jn(at),(i,t)=>Math.max(...t.map(s=>s.evaluate(i)))],abs:[at,[at],(i,[t])=>Math.abs(t.evaluate(i))],round:[at,[at],(i,[t])=>{const s=t.evaluate(i);return s<0?-Math.round(-s):Math.round(s)}],floor:[at,[at],(i,[t])=>Math.floor(t.evaluate(i))],ceil:[at,[at],(i,[t])=>Math.ceil(t.evaluate(i))],"filter-==":[Vt,[Rt,rr],(i,[t,s])=>i.properties()[t.value]===s.value],"filter-id-==":[Vt,[rr],(i,[t])=>i.id()===t.value],"filter-type-==":[Vt,[Rt],(i,[t])=>i.geometryType()===t.value],"filter-<":[Vt,[Rt,rr],(i,[t,s])=>{const h=i.properties()[t.value],d=s.value;return typeof h==typeof d&&h<d}],"filter-id-<":[Vt,[rr],(i,[t])=>{const s=i.id(),h=t.value;return typeof s==typeof h&&s<h}],"filter->":[Vt,[Rt,rr],(i,[t,s])=>{const h=i.properties()[t.value],d=s.value;return typeof h==typeof d&&h>d}],"filter-id->":[Vt,[rr],(i,[t])=>{const s=i.id(),h=t.value;return typeof s==typeof h&&s>h}],"filter-<=":[Vt,[Rt,rr],(i,[t,s])=>{const h=i.properties()[t.value],d=s.value;return typeof h==typeof d&&h<=d}],"filter-id-<=":[Vt,[rr],(i,[t])=>{const s=i.id(),h=t.value;return typeof s==typeof h&&s<=h}],"filter->=":[Vt,[Rt,rr],(i,[t,s])=>{const h=i.properties()[t.value],d=s.value;return typeof h==typeof d&&h>=d}],"filter-id->=":[Vt,[rr],(i,[t])=>{const s=i.id(),h=t.value;return typeof s==typeof h&&s>=h}],"filter-has":[Vt,[rr],(i,[t])=>t.value in i.properties()],"filter-has-id":[Vt,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Vt,[fe(Rt)],(i,[t])=>t.value.indexOf(i.geometryType())>=0],"filter-id-in":[Vt,[fe(rr)],(i,[t])=>t.value.indexOf(i.id())>=0],"filter-in-small":[Vt,[Rt,fe(rr)],(i,[t,s])=>s.value.indexOf(i.properties()[t.value])>=0],"filter-in-large":[Vt,[Rt,fe(rr)],(i,[t,s])=>function(h,d,_,v){for(;_<=v;){const b=_+v>>1;if(d[b]===h)return!0;d[b]>h?v=b-1:_=b+1}return!1}(i.properties()[t.value],s.value,0,s.value.length-1)],all:{type:Vt,overloads:[[[Vt,Vt],(i,[t,s])=>t.evaluate(i)&&s.evaluate(i)],[jn(Vt),(i,t)=>{for(const s of t)if(!s.evaluate(i))return!1;return!0}]]},any:{type:Vt,overloads:[[[Vt,Vt],(i,[t,s])=>t.evaluate(i)||s.evaluate(i)],[jn(Vt),(i,t)=>{for(const s of t)if(s.evaluate(i))return!0;return!1}]]},"!":[Vt,[Vt],(i,[t])=>!t.evaluate(i)],"is-supported-script":[Vt,[Rt],(i,[t])=>{const s=i.globals&&i.globals.isSupportedScript;return!s||s(t.evaluate(i))}],upcase:[Rt,[Rt],(i,[t])=>t.evaluate(i).toUpperCase()],downcase:[Rt,[Rt],(i,[t])=>t.evaluate(i).toLowerCase()],concat:[Rt,jn(rr),(i,t)=>t.map(s=>Tr(s.evaluate(i))).join("")],"resolved-locale":[Rt,[Aa],(i,[t])=>t.evaluate(i).resolvedLocale()]});class $l{constructor(t,s){var h;this.expression=t,this._warningHistory={},this._evaluator=new kl,this._defaultValue=s?(h=s).type==="color"&&Wr(h.default)?new er(0,0,0,0):h.type==="color"?er.parse(h.default)||null:h.type==="padding"?sa.parse(h.default)||null:h.type==="variableAnchorOffsetCollection"?ta.parse(h.default)||null:h.default===void 0?null:h.default:null,this._enumValues=s&&s.type==="enum"?s.values:null}evaluateWithoutErrorHandling(t,s,h,d,_,v){return this._evaluator.globals=t,this._evaluator.feature=s,this._evaluator.featureState=h,this._evaluator.canonical=d,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=v,this.expression.evaluate(this._evaluator)}evaluate(t,s,h,d,_,v){this._evaluator.globals=t,this._evaluator.feature=s||null,this._evaluator.featureState=h||null,this._evaluator.canonical=d,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=v||null;try{const b=this.expression.evaluate(this._evaluator);if(b==null||typeof b=="number"&&b!=b)return this._defaultValue;if(this._enumValues&&!(b in this._enumValues))throw new Yr(`Expected value to be one of ${Object.keys(this._enumValues).map(k=>JSON.stringify(k)).join(", ")}, but found ${JSON.stringify(b)} instead.`);return b}catch(b){return this._warningHistory[b.message]||(this._warningHistory[b.message]=!0,typeof console<"u"&&console.warn(b.message)),this._defaultValue}}}function Vo(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in ds}function $o(i,t){const s=new Ao(ds,Mo,[],t?function(d){const _={color:Lr,string:Rt,number:at,enum:Rt,boolean:Vt,formatted:ce,padding:V,resolvedImage:H,variableAnchorOffsetCollection:te};return d.type==="array"?fe(_[d.value]||rr,d.length):_[d.type]}(t):void 0),h=s.parse(i,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?vu(new $l(h,t)):Fn(s.errors)}class jl{constructor(t,s){this.kind=t,this._styleExpression=s,this.isStateDependent=t!=="constant"&&!Vs(s.expression)}evaluateWithoutErrorHandling(t,s,h,d,_,v){return this._styleExpression.evaluateWithoutErrorHandling(t,s,h,d,_,v)}evaluate(t,s,h,d,_,v){return this._styleExpression.evaluate(t,s,h,d,_,v)}}class jo{constructor(t,s,h,d){this.kind=t,this.zoomStops=h,this._styleExpression=s,this.isStateDependent=t!=="camera"&&!Vs(s.expression),this.interpolationType=d}evaluateWithoutErrorHandling(t,s,h,d,_,v){return this._styleExpression.evaluateWithoutErrorHandling(t,s,h,d,_,v)}evaluate(t,s,h,d,_,v){return this._styleExpression.evaluate(t,s,h,d,_,v)}interpolationFactor(t,s,h){return this.interpolationType?gi.interpolationFactor(this.interpolationType,t,s,h):0}}function Gl(i,t){const s=$o(i,t);if(s.result==="error")return s;const h=s.value.expression,d=Do(h);if(!d&&!ps(t))return Fn([new Mt("","data expressions not supported")]);const _=Lo(h,["zoom"]);if(!_&&!wu(t))return Fn([new Mt("","zoom expressions not supported")]);const v=Gs(h);return v||_?v instanceof Mt?Fn([v]):v instanceof gi&&!Vl(t)?Fn([new Mt("",'"interpolate" expressions cannot be used with this property')]):vu(v?new jo(d?"camera":"composite",s.value,v.labels,v instanceof gi?v.interpolation:void 0):new jl(d?"constant":"source",s.value)):Fn([new Mt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class js{constructor(t,s){this._parameters=t,this._specification=s,Pt(this,vr(this._parameters,this._specification))}static deserialize(t){return new js(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Gs(i){let t=null;if(i instanceof Bo)t=Gs(i.result);else if(i instanceof Oo){for(const s of i.args)if(t=Gs(s),t)break}else(i instanceof In||i instanceof gi)&&i.input instanceof Di&&i.input.name==="zoom"&&(t=i);return t instanceof Mt||i.eachChild(s=>{const h=Gs(s);h instanceof Mt?t=h:!t&&h?t=new Mt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&h&&t!==h&&(t=new Mt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function Hs(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const t of i.slice(1))if(!Hs(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const of={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Hl(i){if(i==null)return{filter:()=>!0,needGeometry:!1};Hs(i)||(i=Go(i));const t=$o(i,of);if(t.result==="error")throw new Error(t.value.map(s=>`${s.key}: ${s.message}`).join(", "));return{filter:(s,h,d)=>t.value.evaluate(s,h,{},d),needGeometry:Tu(i)}}function lf(i,t){return i<t?-1:i>t?1:0}function Tu(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let t=1;t<i.length;t++)if(Tu(i[t]))return!0;return!1}function Go(i){if(!i)return!0;const t=i[0];return i.length<=1?t!=="any":t==="=="?Wl(i[1],i[2],"=="):t==="!="?Ws(Wl(i[1],i[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Wl(i[1],i[2],t):t==="any"?(s=i.slice(1),["any"].concat(s.map(Go))):t==="all"?["all"].concat(i.slice(1).map(Go)):t==="none"?["all"].concat(i.slice(1).map(Go).map(Ws)):t==="in"?Eu(i[1],i.slice(2)):t==="!in"?Ws(Eu(i[1],i.slice(2))):t==="has"?Su(i[1]):t==="!has"?Ws(Su(i[1])):t!=="within"||i;var s}function Wl(i,t,s){switch(i){case"$type":return[`filter-type-${s}`,t];case"$id":return[`filter-id-${s}`,t];default:return[`filter-${s}`,i,t]}}function Eu(i,t){if(t.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(s=>typeof s!=typeof t[0])?["filter-in-large",i,["literal",t.sort(lf)]]:["filter-in-small",i,["literal",t]]}}function Su(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Ws(i){return["!",i]}function Ho(i){const t=typeof i;if(t==="number"||t==="boolean"||t==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let d="[";for(const _ of i)d+=`${Ho(_)},`;return`${d}]`}const s=Object.keys(i).sort();let h="{";for(let d=0;d<s.length;d++)h+=`${JSON.stringify(s[d])}:${Ho(i[s[d]])},`;return`${h}}`}function Wo(i){let t="";for(const s of Cr)t+=`/${Ho(i[s])}`;return t}function ku(i){const t=i.value;return t?[new ot(i.key,t,"constants have been deprecated as of v8")]:[]}function Jr(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Hn(i){if(Array.isArray(i))return i.map(Hn);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const t={};for(const s in i)t[s]=Hn(i[s]);return t}return Jr(i)}function ei(i){const t=i.key,s=i.value,h=i.valueSpec||{},d=i.objectElementValidators||{},_=i.style,v=i.styleSpec,b=i.validateSpec;let k=[];const I=Er(s);if(I!=="object")return[new ot(t,s,`object expected, ${I} found`)];for(const D in s){const O=D.split(".")[0],G=h[O]||h["*"];let q;if(d[O])q=d[O];else if(h[O])q=b;else if(d["*"])q=d["*"];else{if(!h["*"]){k.push(new ot(t,s[D],`unknown property "${D}"`));continue}q=b}k=k.concat(q({key:(t&&`${t}.`)+D,value:s[D],valueSpec:G,style:_,styleSpec:v,object:s,objectKey:D,validateSpec:b},s))}for(const D in h)d[D]||h[D].required&&h[D].default===void 0&&s[D]===void 0&&k.push(new ot(t,s,`missing required property "${D}"`));return k}function ms(i){const t=i.value,s=i.valueSpec,h=i.style,d=i.styleSpec,_=i.key,v=i.arrayElementValidator||i.validateSpec;if(Er(t)!=="array")return[new ot(_,t,`array expected, ${Er(t)} found`)];if(s.length&&t.length!==s.length)return[new ot(_,t,`array length ${s.length} expected, length ${t.length} found`)];if(s["min-length"]&&t.length<s["min-length"])return[new ot(_,t,`array length at least ${s["min-length"]} expected, length ${t.length} found`)];let b={type:s.value,values:s.values};d.$version<7&&(b.function=s.function),Er(s.value)==="object"&&(b=s.value);let k=[];for(let I=0;I<t.length;I++)k=k.concat(v({array:t,arrayIndex:I,value:t[I],valueSpec:b,validateSpec:i.validateSpec,style:h,styleSpec:d,key:`${_}[${I}]`}));return k}function qs(i){const t=i.key,s=i.value,h=i.valueSpec;let d=Er(s);return d==="number"&&s!=s&&(d="NaN"),d!=="number"?[new ot(t,s,`number expected, ${d} found`)]:"minimum"in h&&s<h.minimum?[new ot(t,s,`${s} is less than the minimum value ${h.minimum}`)]:"maximum"in h&&s>h.maximum?[new ot(t,s,`${s} is greater than the maximum value ${h.maximum}`)]:[]}function qo(i){const t=i.valueSpec,s=Jr(i.value.type);let h,d,_,v={};const b=s!=="categorical"&&i.value.property===void 0,k=!b,I=Er(i.value.stops)==="array"&&Er(i.value.stops[0])==="array"&&Er(i.value.stops[0][0])==="object",D=ei({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(q){if(s==="identity")return[new ot(q.key,q.value,'identity function may not have a "stops" property')];let Z=[];const ne=q.value;return Z=Z.concat(ms({key:q.key,value:ne,valueSpec:q.valueSpec,validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec,arrayElementValidator:O})),Er(ne)==="array"&&ne.length===0&&Z.push(new ot(q.key,ne,"array must have at least one stop")),Z},default:function(q){return q.validateSpec({key:q.key,value:q.value,valueSpec:t,validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec})}}});return s==="identity"&&b&&D.push(new ot(i.key,i.value,'missing required property "property"')),s==="identity"||i.value.stops||D.push(new ot(i.key,i.value,'missing required property "stops"')),s==="exponential"&&i.valueSpec.expression&&!Vl(i.valueSpec)&&D.push(new ot(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(k&&!ps(i.valueSpec)?D.push(new ot(i.key,i.value,"property functions not supported")):b&&!wu(i.valueSpec)&&D.push(new ot(i.key,i.value,"zoom functions not supported"))),s!=="categorical"&&!I||i.value.property!==void 0||D.push(new ot(i.key,i.value,'"property" property is required')),D;function O(q){let Z=[];const ne=q.value,xe=q.key;if(Er(ne)!=="array")return[new ot(xe,ne,`array expected, ${Er(ne)} found`)];if(ne.length!==2)return[new ot(xe,ne,`array length 2 expected, length ${ne.length} found`)];if(I){if(Er(ne[0])!=="object")return[new ot(xe,ne,`object expected, ${Er(ne[0])} found`)];if(ne[0].zoom===void 0)return[new ot(xe,ne,"object stop key must have zoom")];if(ne[0].value===void 0)return[new ot(xe,ne,"object stop key must have value")];if(_&&_>Jr(ne[0].zoom))return[new ot(xe,ne[0].zoom,"stop zoom values must appear in ascending order")];Jr(ne[0].zoom)!==_&&(_=Jr(ne[0].zoom),d=void 0,v={}),Z=Z.concat(ei({key:`${xe}[0]`,value:ne[0],valueSpec:{zoom:{}},validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec,objectElementValidators:{zoom:qs,value:G}}))}else Z=Z.concat(G({key:`${xe}[0]`,value:ne[0],valueSpec:{},validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec},ne));return Vo(Hn(ne[1]))?Z.concat([new ot(`${xe}[1]`,ne[1],"expressions are not allowed in function stops.")]):Z.concat(q.validateSpec({key:`${xe}[1]`,value:ne[1],valueSpec:t,validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec}))}function G(q,Z){const ne=Er(q.value),xe=Jr(q.value),be=q.value!==null?q.value:Z;if(h){if(ne!==h)return[new ot(q.key,be,`${ne} stop domain type must match previous stop domain type ${h}`)]}else h=ne;if(ne!=="number"&&ne!=="string"&&ne!=="boolean")return[new ot(q.key,be,"stop domain value must be a number, string, or boolean")];if(ne!=="number"&&s!=="categorical"){let Be=`number expected, ${ne} found`;return ps(t)&&s===void 0&&(Be+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ot(q.key,be,Be)]}return s!=="categorical"||ne!=="number"||isFinite(xe)&&Math.floor(xe)===xe?s!=="categorical"&&ne==="number"&&d!==void 0&&xe<d?[new ot(q.key,be,"stop domain values must appear in ascending order")]:(d=xe,s==="categorical"&&xe in v?[new ot(q.key,be,"stop domain values must be unique")]:(v[xe]=!0,[])):[new ot(q.key,be,`integer expected, found ${xe}`)]}}function Wn(i){const t=(i.expressionContext==="property"?Gl:$o)(Hn(i.value),i.valueSpec);if(t.result==="error")return t.value.map(h=>new ot(`${i.key}${h.key}`,i.value,h.message));const s=t.value.expression||t.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!s.outputDefined())return[new ot(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!Vs(s))return[new ot(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!Vs(s))return[new ot(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!Lo(s,["zoom","feature-state"]))return[new ot(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Do(s))return[new ot(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Zs(i){const t=i.key,s=i.value,h=i.valueSpec,d=[];return Array.isArray(h.values)?h.values.indexOf(Jr(s))===-1&&d.push(new ot(t,s,`expected one of [${h.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(h.values).indexOf(Jr(s))===-1&&d.push(new ot(t,s,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(s)} found`)),d}function gs(i){return Hs(Hn(i.value))?Wn(Pt({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Cu(i)}function Cu(i){const t=i.value,s=i.key;if(Er(t)!=="array")return[new ot(s,t,`array expected, ${Er(t)} found`)];const h=i.styleSpec;let d,_=[];if(t.length<1)return[new ot(s,t,"filter array must have at least 1 element")];switch(_=_.concat(Zs({key:`${s}[0]`,value:t[0],valueSpec:h.filter_operator,style:i.style,styleSpec:i.styleSpec})),Jr(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Jr(t[1])==="$type"&&_.push(new ot(s,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&_.push(new ot(s,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(d=Er(t[1]),d!=="string"&&_.push(new ot(`${s}[1]`,t[1],`string expected, ${d} found`)));for(let v=2;v<t.length;v++)d=Er(t[v]),Jr(t[1])==="$type"?_=_.concat(Zs({key:`${s}[${v}]`,value:t[v],valueSpec:h.geometry_type,style:i.style,styleSpec:i.styleSpec})):d!=="string"&&d!=="number"&&d!=="boolean"&&_.push(new ot(`${s}[${v}]`,t[v],`string, number, or boolean expected, ${d} found`));break;case"any":case"all":case"none":for(let v=1;v<t.length;v++)_=_.concat(Cu({key:`${s}[${v}]`,value:t[v],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":d=Er(t[1]),t.length!==2?_.push(new ot(s,t,`filter array for "${t[0]}" operator must have 2 elements`)):d!=="string"&&_.push(new ot(`${s}[1]`,t[1],`string expected, ${d} found`));break;case"within":d=Er(t[1]),t.length!==2?_.push(new ot(s,t,`filter array for "${t[0]}" operator must have 2 elements`)):d!=="object"&&_.push(new ot(`${s}[1]`,t[1],`object expected, ${d} found`))}return _}function Au(i,t){const s=i.key,h=i.validateSpec,d=i.style,_=i.styleSpec,v=i.value,b=i.objectKey,k=_[`${t}_${i.layerType}`];if(!k)return[];const I=b.match(/^(.*)-transition$/);if(t==="paint"&&I&&k[I[1]]&&k[I[1]].transition)return h({key:s,value:v,valueSpec:_.transition,style:d,styleSpec:_});const D=i.valueSpec||k[b];if(!D)return[new ot(s,v,`unknown property "${b}"`)];let O;if(Er(v)==="string"&&ps(D)&&!D.tokens&&(O=/^{([^}]+)}$/.exec(v)))return[new ot(s,v,`"${b}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(O[1])} }\`.`)];const G=[];return i.layerType==="symbol"&&(b==="text-field"&&d&&!d.glyphs&&G.push(new ot(s,v,'use of "text-field" requires a style "glyphs" property')),b==="text-font"&&Wr(Hn(v))&&Jr(v.type)==="identity"&&G.push(new ot(s,v,'"text-font" does not support identity functions'))),G.concat(h({key:i.key,value:v,valueSpec:D,style:d,styleSpec:_,expressionContext:"property",propertyType:t,propertyKey:b}))}function Iu(i){return Au(i,"paint")}function Fu(i){return Au(i,"layout")}function Pu(i){let t=[];const s=i.value,h=i.key,d=i.style,_=i.styleSpec;s.type||s.ref||t.push(new ot(h,s,'either "type" or "ref" is required'));let v=Jr(s.type);const b=Jr(s.ref);if(s.id){const k=Jr(s.id);for(let I=0;I<i.arrayIndex;I++){const D=d.layers[I];Jr(D.id)===k&&t.push(new ot(h,s.id,`duplicate layer id "${s.id}", previously used at line ${D.id.__line__}`))}}if("ref"in s){let k;["type","source","source-layer","filter","layout"].forEach(I=>{I in s&&t.push(new ot(h,s[I],`"${I}" is prohibited for ref layers`))}),d.layers.forEach(I=>{Jr(I.id)===b&&(k=I)}),k?k.ref?t.push(new ot(h,s.ref,"ref cannot reference another ref layer")):v=Jr(k.type):t.push(new ot(h,s.ref,`ref layer "${b}" not found`))}else if(v!=="background")if(s.source){const k=d.sources&&d.sources[s.source],I=k&&Jr(k.type);k?I==="vector"&&v==="raster"?t.push(new ot(h,s.source,`layer "${s.id}" requires a raster source`)):I!=="raster-dem"&&v==="hillshade"?t.push(new ot(h,s.source,`layer "${s.id}" requires a raster-dem source`)):I==="raster"&&v!=="raster"?t.push(new ot(h,s.source,`layer "${s.id}" requires a vector source`)):I!=="vector"||s["source-layer"]?I==="raster-dem"&&v!=="hillshade"?t.push(new ot(h,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):v!=="line"||!s.paint||!s.paint["line-gradient"]||I==="geojson"&&k.lineMetrics||t.push(new ot(h,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new ot(h,s,`layer "${s.id}" must specify a "source-layer"`)):t.push(new ot(h,s.source,`source "${s.source}" not found`))}else t.push(new ot(h,s,'missing required property "source"'));return t=t.concat(ei({key:h,value:s,valueSpec:_.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${h}.type`,value:s.type,valueSpec:_.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:s,objectKey:"type"}),filter:gs,layout:k=>ei({layer:s,key:k.key,value:k.value,style:k.style,styleSpec:k.styleSpec,validateSpec:k.validateSpec,objectElementValidators:{"*":I=>Fu(Pt({layerType:v},I))}}),paint:k=>ei({layer:s,key:k.key,value:k.value,style:k.style,styleSpec:k.styleSpec,validateSpec:k.validateSpec,objectElementValidators:{"*":I=>Iu(Pt({layerType:v},I))}})}})),t}function Xi(i){const t=i.value,s=i.key,h=Er(t);return h!=="string"?[new ot(s,t,`string expected, ${h} found`)]:[]}const Xs={promoteId:function({key:i,value:t}){if(Er(t)==="string")return Xi({key:i,value:t});{const s=[];for(const h in t)s.push(...Xi({key:`${i}.${h}`,value:t[h]}));return s}}};function xi(i){const t=i.value,s=i.key,h=i.styleSpec,d=i.style,_=i.validateSpec;if(!t.type)return[new ot(s,t,'"type" is required')];const v=Jr(t.type);let b;switch(v){case"vector":case"raster":return b=ei({key:s,value:t,valueSpec:h[`source_${v.replace("-","_")}`],style:i.style,styleSpec:h,objectElementValidators:Xs,validateSpec:_}),b;case"raster-dem":return b=function(k){var I;const D=(I=k.sourceName)!==null&&I!==void 0?I:"",O=k.value,G=k.styleSpec,q=G.source_raster_dem,Z=k.style;let ne=[];const xe=Er(O);if(O===void 0)return ne;if(xe!=="object")return ne.push(new ot("source_raster_dem",O,`object expected, ${xe} found`)),ne;const be=Jr(O.encoding)==="custom",Be=["redFactor","greenFactor","blueFactor","baseShift"],ke=k.value.encoding?`"${k.value.encoding}"`:"Default";for(const Ne in O)!be&&Be.includes(Ne)?ne.push(new ot(Ne,O[Ne],`In "${D}": "${Ne}" is only valid when "encoding" is set to "custom". ${ke} encoding found`)):q[Ne]?ne=ne.concat(k.validateSpec({key:Ne,value:O[Ne],valueSpec:q[Ne],validateSpec:k.validateSpec,style:Z,styleSpec:G})):ne.push(new ot(Ne,O[Ne],`unknown property "${Ne}"`));return ne}({sourceName:s,value:t,style:i.style,styleSpec:h,validateSpec:_}),b;case"geojson":if(b=ei({key:s,value:t,valueSpec:h.source_geojson,style:d,styleSpec:h,validateSpec:_,objectElementValidators:Xs}),t.cluster)for(const k in t.clusterProperties){const[I,D]=t.clusterProperties[k],O=typeof I=="string"?[I,["accumulated"],["get",k]]:I;b.push(...Wn({key:`${s}.${k}.map`,value:D,validateSpec:_,expressionContext:"cluster-map"})),b.push(...Wn({key:`${s}.${k}.reduce`,value:O,validateSpec:_,expressionContext:"cluster-reduce"}))}return b;case"video":return ei({key:s,value:t,valueSpec:h.source_video,style:d,validateSpec:_,styleSpec:h});case"image":return ei({key:s,value:t,valueSpec:h.source_image,style:d,validateSpec:_,styleSpec:h});case"canvas":return[new ot(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Zs({key:`${s}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:d,validateSpec:_,styleSpec:h})}}function Ks(i){const t=i.value,s=i.styleSpec,h=s.light,d=i.style;let _=[];const v=Er(t);if(t===void 0)return _;if(v!=="object")return _=_.concat([new ot("light",t,`object expected, ${v} found`)]),_;for(const b in t){const k=b.match(/^(.*)-transition$/);_=_.concat(k&&h[k[1]]&&h[k[1]].transition?i.validateSpec({key:b,value:t[b],valueSpec:s.transition,validateSpec:i.validateSpec,style:d,styleSpec:s}):h[b]?i.validateSpec({key:b,value:t[b],valueSpec:h[b],validateSpec:i.validateSpec,style:d,styleSpec:s}):[new ot(b,t[b],`unknown property "${b}"`)])}return _}function Mu(i){const t=i.value,s=i.styleSpec,h=s.terrain,d=i.style;let _=[];const v=Er(t);if(t===void 0)return _;if(v!=="object")return _=_.concat([new ot("terrain",t,`object expected, ${v} found`)]),_;for(const b in t)_=_.concat(h[b]?i.validateSpec({key:b,value:t[b],valueSpec:h[b],validateSpec:i.validateSpec,style:d,styleSpec:s}):[new ot(b,t[b],`unknown property "${b}"`)]);return _}function Du(i){let t=[];const s=i.value,h=i.key;if(Array.isArray(s)){const d=[],_=[];for(const v in s)s[v].id&&d.includes(s[v].id)&&t.push(new ot(h,s,`all the sprites' ids must be unique, but ${s[v].id} is duplicated`)),d.push(s[v].id),s[v].url&&_.includes(s[v].url)&&t.push(new ot(h,s,`all the sprites' URLs must be unique, but ${s[v].url} is duplicated`)),_.push(s[v].url),t=t.concat(ei({key:`${h}[${v}]`,value:s[v],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return t}return Xi({key:h,value:s})}const Lu={"*":()=>[],array:ms,boolean:function(i){const t=i.value,s=i.key,h=Er(t);return h!=="boolean"?[new ot(s,t,`boolean expected, ${h} found`)]:[]},number:qs,color:function(i){const t=i.key,s=i.value,h=Er(s);return h!=="string"?[new ot(t,s,`color expected, ${h} found`)]:er.parse(String(s))?[]:[new ot(t,s,`color expected, "${s}" found`)]},constants:ku,enum:Zs,filter:gs,function:qo,layer:Pu,object:ei,source:xi,light:Ks,terrain:Mu,string:Xi,formatted:function(i){return Xi(i).length===0?[]:Wn(i)},resolvedImage:function(i){return Xi(i).length===0?[]:Wn(i)},padding:function(i){const t=i.key,s=i.value;if(Er(s)==="array"){if(s.length<1||s.length>4)return[new ot(t,s,`padding requires 1 to 4 values; ${s.length} values found`)];const h={type:"number"};let d=[];for(let _=0;_<s.length;_++)d=d.concat(i.validateSpec({key:`${t}[${_}]`,value:s[_],validateSpec:i.validateSpec,valueSpec:h}));return d}return qs({key:t,value:s,valueSpec:{}})},variableAnchorOffsetCollection:function(i){const t=i.key,s=i.value,h=Er(s),d=i.styleSpec;if(h!=="array"||s.length<1||s.length%2!=0)return[new ot(t,s,"variableAnchorOffsetCollection requires a non-empty array of even length")];let _=[];for(let v=0;v<s.length;v+=2)_=_.concat(Zs({key:`${t}[${v}]`,value:s[v],valueSpec:d.layout_symbol["text-anchor"]})),_=_.concat(ms({key:`${t}[${v+1}]`,value:s[v+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:d}));return _},sprite:Du};function hn(i){const t=i.value,s=i.valueSpec,h=i.styleSpec;return i.validateSpec=hn,s.expression&&Wr(Jr(t))?qo(i):s.expression&&Vo(Hn(t))?Wn(i):s.type&&Lu[s.type]?Lu[s.type](i):ei(Pt({},i,{valueSpec:s.type?h[s.type]:s}))}function Ru(i){const t=i.value,s=i.key,h=Xi(i);return h.length||(t.indexOf("{fontstack}")===-1&&h.push(new ot(s,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&h.push(new ot(s,t,'"glyphs" url must include a "{range}" token'))),h}function Li(i,t=qe){let s=[];return s=s.concat(hn({key:"",value:i,valueSpec:t.$root,styleSpec:t,style:i,validateSpec:hn,objectElementValidators:{glyphs:Ru,"*":()=>[]}})),i.constants&&(s=s.concat(ku({key:"constants",value:i.constants,style:i,styleSpec:t,validateSpec:hn}))),Zo(s)}function fn(i){return function(t){return i({...t,validateSpec:hn})}}function Zo(i){return[].concat(i).sort((t,s)=>t.line-s.line)}function dn(i){return function(...t){return Zo(i.apply(this,t))}}Li.source=dn(fn(xi)),Li.sprite=dn(fn(Du)),Li.glyphs=dn(fn(Ru)),Li.light=dn(fn(Ks)),Li.terrain=dn(fn(Mu)),Li.layer=dn(fn(Pu)),Li.filter=dn(fn(gs)),Li.paintProperty=dn(fn(Iu)),Li.layoutProperty=dn(fn(Fu));const pn=Li,cf=pn.light,ql=pn.paintProperty,Ou=pn.layoutProperty;function Xo(i,t){let s=!1;if(t&&t.length)for(const h of t)i.fire(new cr(new Error(h.message))),s=!0;return s}class xs{constructor(t,s,h){const d=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const v=new Int32Array(this.arrayBuffer);t=v[0],this.d=(s=v[1])+2*(h=v[2]);for(let k=0;k<this.d*this.d;k++){const I=v[3+k],D=v[3+k+1];d.push(I===D?null:v.subarray(I,D))}const b=v[3+d.length+1];this.keys=v.subarray(v[3+d.length],b),this.bboxes=v.subarray(b),this.insert=this._insertReadonly}else{this.d=s+2*h;for(let v=0;v<this.d*this.d;v++)d.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=t,this.padding=h,this.scale=s/t,this.uid=0;const _=h/s*t;this.min=-_,this.max=t+_}insert(t,s,h,d,_){this._forEachCell(s,h,d,_,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(s),this.bboxes.push(h),this.bboxes.push(d),this.bboxes.push(_)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,s,h,d,_,v){this.cells[_].push(v)}query(t,s,h,d,_){const v=this.min,b=this.max;if(t<=v&&s<=v&&b<=h&&b<=d&&!_)return Array.prototype.slice.call(this.keys);{const k=[];return this._forEachCell(t,s,h,d,this._queryCell,k,{},_),k}}_queryCell(t,s,h,d,_,v,b,k){const I=this.cells[_];if(I!==null){const D=this.keys,O=this.bboxes;for(let G=0;G<I.length;G++){const q=I[G];if(b[q]===void 0){const Z=4*q;(k?k(O[Z+0],O[Z+1],O[Z+2],O[Z+3]):t<=O[Z+2]&&s<=O[Z+3]&&h>=O[Z+0]&&d>=O[Z+1])?(b[q]=!0,v.push(D[q])):b[q]=!1}}}}_forEachCell(t,s,h,d,_,v,b,k){const I=this._convertToCellCoord(t),D=this._convertToCellCoord(s),O=this._convertToCellCoord(h),G=this._convertToCellCoord(d);for(let q=I;q<=O;q++)for(let Z=D;Z<=G;Z++){const ne=this.d*Z+q;if((!k||k(this._convertFromCellCoord(q),this._convertFromCellCoord(Z),this._convertFromCellCoord(q+1),this._convertFromCellCoord(Z+1)))&&_.call(this,t,s,h,d,ne,v,b,k))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,s=3+this.cells.length+1+1;let h=0;for(let v=0;v<this.cells.length;v++)h+=this.cells[v].length;const d=new Int32Array(s+h+this.keys.length+this.bboxes.length);d[0]=this.extent,d[1]=this.n,d[2]=this.padding;let _=s;for(let v=0;v<t.length;v++){const b=t[v];d[3+v]=_,d.set(b,_),_+=b.length}return d[3+t.length]=_,d.set(this.keys,_),_+=this.keys.length,d[3+t.length+1]=_,d.set(this.bboxes,_),_+=this.bboxes.length,d.buffer}static serialize(t,s){const h=t.toArrayBuffer();return s&&s.push(h),{buffer:h}}static deserialize(t){return new xs(t.buffer)}}const mn={};function Dt(i,t,s={}){if(mn[i])throw new Error(`${i} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:i,writeable:!1}),mn[i]={klass:t,omit:s.omit||[],shallow:s.shallow||[]}}Dt("Object",Object),Dt("TransferableGridIndex",xs),Dt("Color",er),Dt("Error",Error),Dt("AJAXError",_t),Dt("ResolvedImage",Ia),Dt("StylePropertyFunction",js),Dt("StyleExpression",$l,{omit:["_evaluator"]}),Dt("ZoomDependentExpression",jo),Dt("ZoomConstantExpression",jl),Dt("CompoundExpression",Di,{omit:["_evaluate"]});for(const i in ds)ds[i]._classRegistryKey||Dt(`Expression_${i}`,ds[i]);function Ko(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Pn(i,t){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob)return i;if(Ko(i)||He(i))return t&&t.push(i),i;if(ArrayBuffer.isView(i)){const s=i;return t&&t.push(s.buffer),s}if(i instanceof ImageData)return t&&t.push(i.data.buffer),i;if(Array.isArray(i)){const s=[];for(const h of i)s.push(Pn(h,t));return s}if(typeof i=="object"){const s=i.constructor,h=s._classRegistryKey;if(!h)throw new Error("can't serialize object of unregistered class");if(!mn[h])throw new Error(`${h} is not registered.`);const d=s.serialize?s.serialize(i,t):{};if(s.serialize){if(t&&d===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const _ in i){if(!i.hasOwnProperty(_)||mn[h].omit.indexOf(_)>=0)continue;const v=i[_];d[_]=mn[h].shallow.indexOf(_)>=0?v:Pn(v,t)}i instanceof Error&&(d.message=i.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return h!=="Object"&&(d.$name=h),d}throw new Error("can't serialize object of type "+typeof i)}function _s(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||Ko(i)||He(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(_s);if(typeof i=="object"){const t=i.$name||"Object";if(!mn[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:s}=mn[t];if(!s)throw new Error(`can't deserialize unregistered class ${t}`);if(s.deserialize)return s.deserialize(i);const h=Object.create(s.prototype);for(const d of Object.keys(i)){if(d==="$name")continue;const _=i[d];h[d]=mn[t].shallow.indexOf(d)>=0?_:_s(_)}return h}throw new Error("can't deserialize object of type "+typeof i)}class Bu{constructor(){this.first=!0}update(t,s){const h=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=h,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=h,!0):(this.lastFloorZoom>h?(this.lastIntegerZoom=h+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<h&&(this.lastIntegerZoom=h,this.lastIntegerZoomTime=s),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=h,!0))}}const Ct={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function Zl(i){for(const t of i)if(Kl(t.charCodeAt(0)))return!0;return!1}function Xl(i){for(const t of i)if(!uf(t.charCodeAt(0)))return!1;return!0}function uf(i){return!(Ct.Arabic(i)||Ct["Arabic Supplement"](i)||Ct["Arabic Extended-A"](i)||Ct["Arabic Presentation Forms-A"](i)||Ct["Arabic Presentation Forms-B"](i))}function Kl(i){return!(i!==746&&i!==747&&(i<4352||!(Ct["Bopomofo Extended"](i)||Ct.Bopomofo(i)||Ct["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||Ct["CJK Compatibility Ideographs"](i)||Ct["CJK Compatibility"](i)||Ct["CJK Radicals Supplement"](i)||Ct["CJK Strokes"](i)||!(!Ct["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Ct["CJK Unified Ideographs Extension A"](i)||Ct["CJK Unified Ideographs"](i)||Ct["Enclosed CJK Letters and Months"](i)||Ct["Hangul Compatibility Jamo"](i)||Ct["Hangul Jamo Extended-A"](i)||Ct["Hangul Jamo Extended-B"](i)||Ct["Hangul Jamo"](i)||Ct["Hangul Syllables"](i)||Ct.Hiragana(i)||Ct["Ideographic Description Characters"](i)||Ct.Kanbun(i)||Ct["Kangxi Radicals"](i)||Ct["Katakana Phonetic Extensions"](i)||Ct.Katakana(i)&&i!==12540||!(!Ct["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Ct["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||Ct["Unified Canadian Aboriginal Syllabics"](i)||Ct["Unified Canadian Aboriginal Syllabics Extended"](i)||Ct["Vertical Forms"](i)||Ct["Yijing Hexagram Symbols"](i)||Ct["Yi Syllables"](i)||Ct["Yi Radicals"](i))))}function zu(i){return!(Kl(i)||function(t){return!!(Ct["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Ct["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Ct["Letterlike Symbols"](t)||Ct["Number Forms"](t)||Ct["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Ct["Control Pictures"](t)&&t!==9251||Ct["Optical Character Recognition"](t)||Ct["Enclosed Alphanumerics"](t)||Ct["Geometric Shapes"](t)||Ct["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Ct["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Ct["CJK Symbols and Punctuation"](t)||Ct.Katakana(t)||Ct["Private Use Area"](t)||Ct["CJK Compatibility Forms"](t)||Ct["Small Form Variants"](t)||Ct["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(i))}function Nu(i){return i>=1424&&i<=2303||Ct["Arabic Presentation Forms-A"](i)||Ct["Arabic Presentation Forms-B"](i)}function Uu(i,t){return!(!t&&Nu(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||Ct.Khmer(i))}function hf(i){for(const t of i)if(Nu(t.charCodeAt(0)))return!0;return!1}const Yl="deferred",Jl="loading",Ql="loaded";let ec=null,ti="unavailable",Mn=null;const Ys=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(ti="error"),ec&&ec(i)};function tc(){Js.fire(new wt("pluginStateChange",{pluginStatus:ti,pluginURL:Mn}))}const Js=new Pr,rc=function(){return ti},Vu=function(){if(ti!==Yl||!Mn)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ti=Jl,tc(),Mn&&Qt({url:Mn},i=>{i?Ys(i):(ti=Ql,tc())})},_i={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ti===Ql||_i.applyArabicShaping!=null,isLoading:()=>ti===Jl,setState(i){if(!ht())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");ti=i.pluginStatus,Mn=i.pluginURL},isParsed(){if(!ht())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return _i.applyArabicShaping!=null&&_i.processBidirectionalText!=null&&_i.processStyledBidirectionalText!=null},getPluginURL(){if(!ht())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Mn}};class Ur{constructor(t,s){this.zoom=t,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Bu,this.transition={})}isSupportedScript(t){return function(s,h){for(const d of s)if(!Uu(d.charCodeAt(0),h))return!1;return!0}(t,_i.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,s=t-Math.floor(t),h=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*h}:{fromScale:.5,toScale:1,t:1-(1-h)*s}}}class Yo{constructor(t,s){this.property=t,this.value=s,this.expression=function(h,d){if(Wr(h))return new js(h,d);if(Vo(h)){const _=Gl(h,d);if(_.result==="error")throw new Error(_.value.map(v=>`${v.key}: ${v.message}`).join(", "));return _.value}{let _=h;return d.type==="color"&&typeof h=="string"?_=er.parse(h):d.type!=="padding"||typeof h!="number"&&!Array.isArray(h)?d.type==="variableAnchorOffsetCollection"&&Array.isArray(h)&&(_=ta.parse(h)):_=sa.parse(h),{kind:"constant",evaluate:()=>_}}}(s===void 0?t.specification.default:s,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,s,h){return this.property.possiblyEvaluate(this,t,s,h)}}class ac{constructor(t){this.property=t,this.value=new Yo(t,void 0)}transitioned(t,s){return new ju(this.property,this.value,s,ze({},t.transition,this.transition),t.now)}untransitioned(){return new ju(this.property,this.value,null,{},0)}}class $u{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return Le(this._values[t].value.value)}setValue(t,s){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new ac(this._values[t].property)),this._values[t].value=new Yo(this._values[t].property,s===null?void 0:Le(s))}getTransition(t){return Le(this._values[t].transition)}setTransition(t,s){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new ac(this._values[t].property)),this._values[t].transition=Le(s)||void 0}serialize(){const t={};for(const s of Object.keys(this._values)){const h=this.getValue(s);h!==void 0&&(t[s]=h);const d=this.getTransition(s);d!==void 0&&(t[`${s}-transition`]=d)}return t}transitioned(t,s){const h=new Gu(this._properties);for(const d of Object.keys(this._values))h._values[d]=this._values[d].transitioned(t,s._values[d]);return h}untransitioned(){const t=new Gu(this._properties);for(const s of Object.keys(this._values))t._values[s]=this._values[s].untransitioned();return t}}class ju{constructor(t,s,h,d,_){this.property=t,this.value=s,this.begin=_+d.delay||0,this.end=this.begin+d.duration||0,t.specification.transition&&(d.delay||d.duration)&&(this.prior=h)}possiblyEvaluate(t,s,h){const d=t.now||0,_=this.value.possiblyEvaluate(t,s,h),v=this.prior;if(v){if(d>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(d<this.begin)return v.possiblyEvaluate(t,s,h);{const b=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(v.possiblyEvaluate(t,s,h),_,function(k){if(k<=0)return 0;if(k>=1)return 1;const I=k*k,D=I*k;return 4*(k<.5?D:3*(k-I)+D-.75)}(b))}}return _}}class Gu{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,s,h){const d=new Jo(this._properties);for(const _ of Object.keys(this._values))d._values[_]=this._values[_].possiblyEvaluate(t,s,h);return d}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class ff{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return Le(this._values[t].value)}setValue(t,s){this._values[t]=new Yo(this._values[t].property,s===null?void 0:Le(s))}serialize(){const t={};for(const s of Object.keys(this._values)){const h=this.getValue(s);h!==void 0&&(t[s]=h)}return t}possiblyEvaluate(t,s,h){const d=new Jo(this._properties);for(const _ of Object.keys(this._values))d._values[_]=this._values[_].possiblyEvaluate(t,s,h);return d}}class Ha{constructor(t,s,h){this.property=t,this.value=s,this.parameters=h}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,s,h,d){return this.property.evaluate(this.value,this.parameters,t,s,h,d)}}class Jo{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class $t{constructor(t){this.specification=t}possiblyEvaluate(t,s){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(s)}interpolate(t,s,h){const d=mi[this.specification.type];return d?d(t,s,h):t}}class Wt{constructor(t,s){this.specification=t,this.overrides=s}possiblyEvaluate(t,s,h,d){return new Ha(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(s,null,{},h,d)}:t.expression,s)}interpolate(t,s,h){if(t.value.kind!=="constant"||s.value.kind!=="constant")return t;if(t.value.value===void 0||s.value.value===void 0)return new Ha(this,{kind:"constant",value:void 0},t.parameters);const d=mi[this.specification.type];if(d){const _=d(t.value.value,s.value.value,h);return new Ha(this,{kind:"constant",value:_},t.parameters)}return t}evaluate(t,s,h,d,_,v){return t.kind==="constant"?t.value:t.evaluate(s,h,d,_,v)}}class Qs extends Wt{possiblyEvaluate(t,s,h,d){if(t.value===void 0)return new Ha(this,{kind:"constant",value:void 0},s);if(t.expression.kind==="constant"){const _=t.expression.evaluate(s,null,{},h,d),v=t.property.specification.type==="resolvedImage"&&typeof _!="string"?_.name:_,b=this._calculate(v,v,v,s);return new Ha(this,{kind:"constant",value:b},s)}if(t.expression.kind==="camera"){const _=this._calculate(t.expression.evaluate({zoom:s.zoom-1}),t.expression.evaluate({zoom:s.zoom}),t.expression.evaluate({zoom:s.zoom+1}),s);return new Ha(this,{kind:"constant",value:_},s)}return new Ha(this,t.expression,s)}evaluate(t,s,h,d,_,v){if(t.kind==="source"){const b=t.evaluate(s,h,d,_,v);return this._calculate(b,b,b,s)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(s.zoom)-1},h,d),t.evaluate({zoom:Math.floor(s.zoom)},h,d),t.evaluate({zoom:Math.floor(s.zoom)+1},h,d),s):t.value}_calculate(t,s,h,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:t,to:s}:{from:h,to:s}}interpolate(t){return t}}class ic{constructor(t){this.specification=t}possiblyEvaluate(t,s,h,d){if(t.value!==void 0){if(t.expression.kind==="constant"){const _=t.expression.evaluate(s,null,{},h,d);return this._calculate(_,_,_,s)}return this._calculate(t.expression.evaluate(new Ur(Math.floor(s.zoom-1),s)),t.expression.evaluate(new Ur(Math.floor(s.zoom),s)),t.expression.evaluate(new Ur(Math.floor(s.zoom+1),s)),s)}}_calculate(t,s,h,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:t,to:s}:{from:h,to:s}}interpolate(t){return t}}class nc{constructor(t){this.specification=t}possiblyEvaluate(t,s,h,d){return!!t.expression.evaluate(s,null,{},h,d)}interpolate(){return!1}}class oa{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const s in t){const h=t[s];h.specification.overridable&&this.overridableProperties.push(s);const d=this.defaultPropertyValues[s]=new Yo(h,void 0),_=this.defaultTransitionablePropertyValues[s]=new ac(h);this.defaultTransitioningPropertyValues[s]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=d.possiblyEvaluate({})}}}Dt("DataDrivenProperty",Wt),Dt("DataConstantProperty",$t),Dt("CrossFadedDataDrivenProperty",Qs),Dt("CrossFadedProperty",ic),Dt("ColorRampProperty",nc);const sc="-transition";class Ri extends Pr{constructor(t,s){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),s.layout&&(this._unevaluatedLayout=new ff(s.layout)),s.paint)){this._transitionablePaint=new $u(s.paint);for(const h in t.paint)this.setPaintProperty(h,t.paint[h],{validate:!1});for(const h in t.layout)this.setLayoutProperty(h,t.layout[h],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Jo(s.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,s,h={}){s!=null&&this._validate(Ou,`layers.${this.id}.layout.${t}`,t,s,h)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,s):this.visibility=s)}getPaintProperty(t){return t.endsWith(sc)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,s,h={}){if(s!=null&&this._validate(ql,`layers.${this.id}.paint.${t}`,t,s,h))return!1;if(t.endsWith(sc))return this._transitionablePaint.setTransition(t.slice(0,-11),s||void 0),!1;{const d=this._transitionablePaint._values[t],_=d.property.specification["property-type"]==="cross-faded-data-driven",v=d.value.isDataDriven(),b=d.value;this._transitionablePaint.setValue(t,s),this._handleSpecialPaintPropertyUpdate(t);const k=this._transitionablePaint._values[t].value;return k.isDataDriven()||v||_||this._handleOverridablePaintPropertyUpdate(t,b,k)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,s,h){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,s){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,s)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),je(t,(s,h)=>!(s===void 0||h==="layout"&&!Object.keys(s).length||h==="paint"&&!Object.keys(s).length))}_validate(t,s,h,d,_={}){return(!_||_.validate!==!1)&&Xo(this,t.call(pn,{key:s,layerType:this.type,objectKey:h,value:d,styleSpec:qe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const s=this.paint.get(t);if(s instanceof Ha&&ps(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}return!1}}const Hu={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class qn{constructor(t,s){this._structArray=t,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Qr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,s){return t._trim(),s&&(t.isTransferred=!0,s.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const s=Object.create(this.prototype);return s.arrayBuffer=t.arrayBuffer,s.length=t.length,s.capacity=t.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Zr(i,t=1){let s=0,h=0;return{members:i.map(d=>{const _=Hu[d.type].BYTES_PER_ELEMENT,v=s=ys(s,Math.max(t,_)),b=d.components||1;return h=Math.max(h,_),s+=_*b,{name:d.name,type:d.type,components:b,offset:v}}),size:ys(s,Math.max(h,t)),alignment:t}}function ys(i,t){return Math.ceil(i/t)*t}class eo extends Qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s){const h=this.length;return this.resize(h+1),this.emplace(h,t,s)}emplace(t,s,h){const d=2*t;return this.int16[d+0]=s,this.int16[d+1]=h,t}}eo.prototype.bytesPerElement=4,Dt("StructArrayLayout2i4",eo);class to extends Qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,h){const d=this.length;return this.resize(d+1),this.emplace(d,t,s,h)}emplace(t,s,h,d){const _=3*t;return this.int16[_+0]=s,this.int16[_+1]=h,this.int16[_+2]=d,t}}to.prototype.bytesPerElement=6,Dt("StructArrayLayout3i6",to);class Zn extends Qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,h,d){const _=this.length;return this.resize(_+1),this.emplace(_,t,s,h,d)}emplace(t,s,h,d,_){const v=4*t;return this.int16[v+0]=s,this.int16[v+1]=h,this.int16[v+2]=d,this.int16[v+3]=_,t}}Zn.prototype.bytesPerElement=8,Dt("StructArrayLayout4i8",Zn);class oc extends Qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,h,d,_,v){const b=this.length;return this.resize(b+1),this.emplace(b,t,s,h,d,_,v)}emplace(t,s,h,d,_,v,b){const k=6*t;return this.int16[k+0]=s,this.int16[k+1]=h,this.int16[k+2]=d,this.int16[k+3]=_,this.int16[k+4]=v,this.int16[k+5]=b,t}}oc.prototype.bytesPerElement=12,Dt("StructArrayLayout2i4i12",oc);class lc extends Qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,h,d,_,v){const b=this.length;return this.resize(b+1),this.emplace(b,t,s,h,d,_,v)}emplace(t,s,h,d,_,v,b){const k=4*t,I=8*t;return this.int16[k+0]=s,this.int16[k+1]=h,this.uint8[I+4]=d,this.uint8[I+5]=_,this.uint8[I+6]=v,this.uint8[I+7]=b,t}}lc.prototype.bytesPerElement=8,Dt("StructArrayLayout2i4ub8",lc);class vs extends Qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s){const h=this.length;return this.resize(h+1),this.emplace(h,t,s)}emplace(t,s,h){const d=2*t;return this.float32[d+0]=s,this.float32[d+1]=h,t}}vs.prototype.bytesPerElement=8,Dt("StructArrayLayout2f8",vs);class cc extends Qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,h,d,_,v,b,k,I,D){const O=this.length;return this.resize(O+1),this.emplace(O,t,s,h,d,_,v,b,k,I,D)}emplace(t,s,h,d,_,v,b,k,I,D,O){const G=10*t;return this.uint16[G+0]=s,this.uint16[G+1]=h,this.uint16[G+2]=d,this.uint16[G+3]=_,this.uint16[G+4]=v,this.uint16[G+5]=b,this.uint16[G+6]=k,this.uint16[G+7]=I,this.uint16[G+8]=D,this.uint16[G+9]=O,t}}cc.prototype.bytesPerElement=20,Dt("StructArrayLayout10ui20",cc);class uc extends Qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,h,d,_,v,b,k,I,D,O,G){const q=this.length;return this.resize(q+1),this.emplace(q,t,s,h,d,_,v,b,k,I,D,O,G)}emplace(t,s,h,d,_,v,b,k,I,D,O,G,q){const Z=12*t;return this.int16[Z+0]=s,this.int16[Z+1]=h,this.int16[Z+2]=d,this.int16[Z+3]=_,this.uint16[Z+4]=v,this.uint16[Z+5]=b,this.uint16[Z+6]=k,this.uint16[Z+7]=I,this.int16[Z+8]=D,this.int16[Z+9]=O,this.int16[Z+10]=G,this.int16[Z+11]=q,t}}uc.prototype.bytesPerElement=24,Dt("StructArrayLayout4i4ui4i24",uc);class Sr extends Qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,h){const d=this.length;return this.resize(d+1),this.emplace(d,t,s,h)}emplace(t,s,h,d){const _=3*t;return this.float32[_+0]=s,this.float32[_+1]=h,this.float32[_+2]=d,t}}Sr.prototype.bytesPerElement=12,Dt("StructArrayLayout3f12",Sr);class g extends Qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint32[1*t+0]=s,t}}g.prototype.bytesPerElement=4,Dt("StructArrayLayout1ul4",g);class r extends Qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,h,d,_,v,b,k,I){const D=this.length;return this.resize(D+1),this.emplace(D,t,s,h,d,_,v,b,k,I)}emplace(t,s,h,d,_,v,b,k,I,D){const O=10*t,G=5*t;return this.int16[O+0]=s,this.int16[O+1]=h,this.int16[O+2]=d,this.int16[O+3]=_,this.int16[O+4]=v,this.int16[O+5]=b,this.uint32[G+3]=k,this.uint16[O+8]=I,this.uint16[O+9]=D,t}}r.prototype.bytesPerElement=20,Dt("StructArrayLayout6i1ul2ui20",r);class l extends Qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,h,d,_,v){const b=this.length;return this.resize(b+1),this.emplace(b,t,s,h,d,_,v)}emplace(t,s,h,d,_,v,b){const k=6*t;return this.int16[k+0]=s,this.int16[k+1]=h,this.int16[k+2]=d,this.int16[k+3]=_,this.int16[k+4]=v,this.int16[k+5]=b,t}}l.prototype.bytesPerElement=12,Dt("StructArrayLayout2i2i2i12",l);class f extends Qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,h,d,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,s,h,d,_)}emplace(t,s,h,d,_,v){const b=4*t,k=8*t;return this.float32[b+0]=s,this.float32[b+1]=h,this.float32[b+2]=d,this.int16[k+6]=_,this.int16[k+7]=v,t}}f.prototype.bytesPerElement=16,Dt("StructArrayLayout2f1f2i16",f);class p extends Qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,h,d){const _=this.length;return this.resize(_+1),this.emplace(_,t,s,h,d)}emplace(t,s,h,d,_){const v=12*t,b=3*t;return this.uint8[v+0]=s,this.uint8[v+1]=h,this.float32[b+1]=d,this.float32[b+2]=_,t}}p.prototype.bytesPerElement=12,Dt("StructArrayLayout2ub2f12",p);class y extends Qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,h){const d=this.length;return this.resize(d+1),this.emplace(d,t,s,h)}emplace(t,s,h,d){const _=3*t;return this.uint16[_+0]=s,this.uint16[_+1]=h,this.uint16[_+2]=d,t}}y.prototype.bytesPerElement=6,Dt("StructArrayLayout3ui6",y);class T extends Qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,h,d,_,v,b,k,I,D,O,G,q,Z,ne,xe,be){const Be=this.length;return this.resize(Be+1),this.emplace(Be,t,s,h,d,_,v,b,k,I,D,O,G,q,Z,ne,xe,be)}emplace(t,s,h,d,_,v,b,k,I,D,O,G,q,Z,ne,xe,be,Be){const ke=24*t,Ne=12*t,We=48*t;return this.int16[ke+0]=s,this.int16[ke+1]=h,this.uint16[ke+2]=d,this.uint16[ke+3]=_,this.uint32[Ne+2]=v,this.uint32[Ne+3]=b,this.uint32[Ne+4]=k,this.uint16[ke+10]=I,this.uint16[ke+11]=D,this.uint16[ke+12]=O,this.float32[Ne+7]=G,this.float32[Ne+8]=q,this.uint8[We+36]=Z,this.uint8[We+37]=ne,this.uint8[We+38]=xe,this.uint32[Ne+10]=be,this.int16[ke+22]=Be,t}}T.prototype.bytesPerElement=48,Dt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",T);class S extends Qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,h,d,_,v,b,k,I,D,O,G,q,Z,ne,xe,be,Be,ke,Ne,We,st,At,Bt,kt,St,bt,Lt){const Tt=this.length;return this.resize(Tt+1),this.emplace(Tt,t,s,h,d,_,v,b,k,I,D,O,G,q,Z,ne,xe,be,Be,ke,Ne,We,st,At,Bt,kt,St,bt,Lt)}emplace(t,s,h,d,_,v,b,k,I,D,O,G,q,Z,ne,xe,be,Be,ke,Ne,We,st,At,Bt,kt,St,bt,Lt,Tt){const gt=32*t,jt=16*t;return this.int16[gt+0]=s,this.int16[gt+1]=h,this.int16[gt+2]=d,this.int16[gt+3]=_,this.int16[gt+4]=v,this.int16[gt+5]=b,this.int16[gt+6]=k,this.int16[gt+7]=I,this.uint16[gt+8]=D,this.uint16[gt+9]=O,this.uint16[gt+10]=G,this.uint16[gt+11]=q,this.uint16[gt+12]=Z,this.uint16[gt+13]=ne,this.uint16[gt+14]=xe,this.uint16[gt+15]=be,this.uint16[gt+16]=Be,this.uint16[gt+17]=ke,this.uint16[gt+18]=Ne,this.uint16[gt+19]=We,this.uint16[gt+20]=st,this.uint16[gt+21]=At,this.uint16[gt+22]=Bt,this.uint32[jt+12]=kt,this.float32[jt+13]=St,this.float32[jt+14]=bt,this.uint16[gt+30]=Lt,this.uint16[gt+31]=Tt,t}}S.prototype.bytesPerElement=64,Dt("StructArrayLayout8i15ui1ul2f2ui64",S);class A extends Qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.float32[1*t+0]=s,t}}A.prototype.bytesPerElement=4,Dt("StructArrayLayout1f4",A);class F extends Qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,h){const d=this.length;return this.resize(d+1),this.emplace(d,t,s,h)}emplace(t,s,h,d){const _=3*t;return this.uint16[6*t+0]=s,this.float32[_+1]=h,this.float32[_+2]=d,t}}F.prototype.bytesPerElement=12,Dt("StructArrayLayout1ui2f12",F);class L extends Qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,h){const d=this.length;return this.resize(d+1),this.emplace(d,t,s,h)}emplace(t,s,h,d){const _=4*t;return this.uint32[2*t+0]=s,this.uint16[_+2]=h,this.uint16[_+3]=d,t}}L.prototype.bytesPerElement=8,Dt("StructArrayLayout1ul2ui8",L);class R extends Qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s){const h=this.length;return this.resize(h+1),this.emplace(h,t,s)}emplace(t,s,h){const d=2*t;return this.uint16[d+0]=s,this.uint16[d+1]=h,t}}R.prototype.bytesPerElement=4,Dt("StructArrayLayout2ui4",R);class W extends Qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint16[1*t+0]=s,t}}W.prototype.bytesPerElement=2,Dt("StructArrayLayout1ui2",W);class oe extends Qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,h,d){const _=this.length;return this.resize(_+1),this.emplace(_,t,s,h,d)}emplace(t,s,h,d,_){const v=4*t;return this.float32[v+0]=s,this.float32[v+1]=h,this.float32[v+2]=d,this.float32[v+3]=_,t}}oe.prototype.bytesPerElement=16,Dt("StructArrayLayout4f16",oe);class se extends qn{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new M(this.anchorPointX,this.anchorPointY)}}se.prototype.size=20;class de extends r{get(t){return new se(this,t)}}Dt("CollisionBoxArray",de);class ie extends qn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}ie.prototype.size=48;class Pe extends T{get(t){return new ie(this,t)}}Dt("PlacedSymbolArray",Pe);class Ge extends qn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Ge.prototype.size=64;class _e extends S{get(t){return new Ge(this,t)}}Dt("SymbolInstanceArray",_e);class Re extends A{getoffsetX(t){return this.float32[1*t+0]}}Dt("GlyphOffsetArray",Re);class Ze extends to{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Dt("SymbolLineVertexArray",Ze);class Xe extends qn{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Xe.prototype.size=12;class rt extends F{get(t){return new Xe(this,t)}}Dt("TextAnchorOffsetArray",rt);class mt extends qn{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}mt.prototype.size=8;class lt extends L{get(t){return new mt(this,t)}}Dt("FeatureIndexArray",lt);class vt extends eo{}class Ot extends eo{}class pr extends eo{}class Et extends oc{}class qt extends lc{}class zt extends vs{}class Rr extends cc{}class dr extends uc{}class sr extends Sr{}class mr extends g{}class ra extends l{}class zr extends p{}class Fa extends y{}class ga extends R{}const la=Zr([{name:"a_pos",components:2,type:"Int16"}],4),{members:yi}=la;class Vr{constructor(t=[]){this.segments=t}prepareSegment(t,s,h,d){let _=this.segments[this.segments.length-1];return t>Vr.MAX_VERTEX_ARRAY_LENGTH&&ft(`Max vertices per segment is ${Vr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!_||_.vertexLength+t>Vr.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==d)&&(_={vertexOffset:s.length,primitiveOffset:h.length,vertexLength:0,primitiveLength:0},d!==void 0&&(_.sortKey=d),this.segments.push(_)),_}get(){return this.segments}destroy(){for(const t of this.segments)for(const s in t.vaos)t.vaos[s].destroy()}static simpleSegment(t,s,h,d){return new Vr([{vertexOffset:t,primitiveOffset:s,vertexLength:h,primitiveLength:d,vaos:{},sortKey:0}])}}function Ki(i,t){return 256*(i=we(Math.floor(i),0,255))+we(Math.floor(t),0,255)}Vr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Dt("SegmentVector",Vr);const Yi=Zr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Dn={exports:{}},Xn={exports:{}};Xn.exports=function(i,t){var s,h,d,_,v,b,k,I;for(h=i.length-(s=3&i.length),d=t,v=3432918353,b=461845907,I=0;I<h;)k=255&i.charCodeAt(I)|(255&i.charCodeAt(++I))<<8|(255&i.charCodeAt(++I))<<16|(255&i.charCodeAt(++I))<<24,++I,d=27492+(65535&(_=5*(65535&(d=(d^=k=(65535&(k=(k=(65535&k)*v+(((k>>>16)*v&65535)<<16)&4294967295)<<15|k>>>17))*b+(((k>>>16)*b&65535)<<16)&4294967295)<<13|d>>>19))+((5*(d>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(k=0,s){case 3:k^=(255&i.charCodeAt(I+2))<<16;case 2:k^=(255&i.charCodeAt(I+1))<<8;case 1:d^=k=(65535&(k=(k=(65535&(k^=255&i.charCodeAt(I)))*v+(((k>>>16)*v&65535)<<16)&4294967295)<<15|k>>>17))*b+(((k>>>16)*b&65535)<<16)&4294967295}return d^=i.length,d=2246822507*(65535&(d^=d>>>16))+((2246822507*(d>>>16)&65535)<<16)&4294967295,d=3266489909*(65535&(d^=d>>>13))+((3266489909*(d>>>16)&65535)<<16)&4294967295,(d^=d>>>16)>>>0};var ws=Xn.exports,za={exports:{}};za.exports=function(i,t){for(var s,h=i.length,d=t^h,_=0;h>=4;)s=1540483477*(65535&(s=255&i.charCodeAt(_)|(255&i.charCodeAt(++_))<<8|(255&i.charCodeAt(++_))<<16|(255&i.charCodeAt(++_))<<24))+((1540483477*(s>>>16)&65535)<<16),d=1540483477*(65535&d)+((1540483477*(d>>>16)&65535)<<16)^(s=1540483477*(65535&(s^=s>>>24))+((1540483477*(s>>>16)&65535)<<16)),h-=4,++_;switch(h){case 3:d^=(255&i.charCodeAt(_+2))<<16;case 2:d^=(255&i.charCodeAt(_+1))<<8;case 1:d=1540483477*(65535&(d^=255&i.charCodeAt(_)))+((1540483477*(d>>>16)&65535)<<16)}return d=1540483477*(65535&(d^=d>>>13))+((1540483477*(d>>>16)&65535)<<16),(d^=d>>>15)>>>0};var Pa=ws,Wa=za.exports;Dn.exports=Pa,Dn.exports.murmur3=Pa,Dn.exports.murmur2=Wa;var Kn=w(Dn.exports);class aa{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,s,h,d){this.ids.push(xa(t)),this.positions.push(s,h,d)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const s=xa(t);let h=0,d=this.ids.length-1;for(;h<d;){const v=h+d>>1;this.ids[v]>=s?d=v:h=v+1}const _=[];for(;this.ids[h]===s;)_.push({index:this.positions[3*h],start:this.positions[3*h+1],end:this.positions[3*h+2]}),h++;return _}static serialize(t,s){const h=new Float64Array(t.ids),d=new Uint32Array(t.positions);return ri(h,d,0,h.length-1),s&&s.push(h.buffer,d.buffer),{ids:h,positions:d}}static deserialize(t){const s=new aa;return s.ids=t.ids,s.positions=t.positions,s.indexed=!0,s}}function xa(i){const t=+i;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Kn(String(i))}function ri(i,t,s,h){for(;s<h;){const d=i[s+h>>1];let _=s-1,v=h+1;for(;;){do _++;while(i[_]<d);do v--;while(i[v]>d);if(_>=v)break;ia(i,_,v),ia(t,3*_,3*v),ia(t,3*_+1,3*v+1),ia(t,3*_+2,3*v+2)}v-s<h-v?(ri(i,t,s,v),s=v+1):(ri(i,t,v+1,h),h=v)}}function ia(i,t,s){const h=i[t];i[t]=i[s],i[s]=h}Dt("FeaturePositionMap",aa);class Yn{constructor(t,s){this.gl=t.gl,this.location=s}}class Qo extends Yn{constructor(t,s){super(t,s),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Wu extends Yn{constructor(t,s){super(t,s),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class qu extends Yn{constructor(t,s){super(t,s),this.current=er.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const df=new Float32Array(16);function hc(i){return[Ki(255*i.r,255*i.g),Ki(255*i.b,255*i.a)]}class Ji{constructor(t,s,h){this.value=t,this.uniformNames=s.map(d=>`u_${d}`),this.type=h}setUniform(t,s,h){t.set(h.constantOr(this.value))}getBinding(t,s,h){return this.type==="color"?new qu(t,s):new Qo(t,s)}}class Jn{constructor(t,s){this.uniformNames=s.map(h=>`u_${h}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=s.tlbr,this.patternTo=t.tlbr}setUniform(t,s,h,d){const _=d==="u_pattern_to"?this.patternTo:d==="u_pattern_from"?this.patternFrom:d==="u_pixel_ratio_to"?this.pixelRatioTo:d==="u_pixel_ratio_from"?this.pixelRatioFrom:null;_&&t.set(_)}getBinding(t,s,h){return h.substr(0,9)==="u_pattern"?new Wu(t,s):new Qo(t,s)}}class Qi{constructor(t,s,h,d){this.expression=t,this.type=h,this.maxValue=0,this.paintVertexAttributes=s.map(_=>({name:`a_${_}`,type:"Float32",components:h==="color"?2:1,offset:0})),this.paintVertexArray=new d}populatePaintArray(t,s,h,d,_){const v=this.paintVertexArray.length,b=this.expression.evaluate(new Ur(0),s,{},d,[],_);this.paintVertexArray.resize(t),this._setPaintValue(v,t,b)}updatePaintArray(t,s,h,d){const _=this.expression.evaluate({zoom:0},h,d);this._setPaintValue(t,s,_)}_setPaintValue(t,s,h){if(this.type==="color"){const d=hc(h);for(let _=t;_<s;_++)this.paintVertexArray.emplace(_,d[0],d[1])}else{for(let d=t;d<s;d++)this.paintVertexArray.emplace(d,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Oi{constructor(t,s,h,d,_,v){this.expression=t,this.uniformNames=s.map(b=>`u_${b}_t`),this.type=h,this.useIntegerZoom=d,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=s.map(b=>({name:`a_${b}`,type:"Float32",components:h==="color"?4:2,offset:0})),this.paintVertexArray=new v}populatePaintArray(t,s,h,d,_){const v=this.expression.evaluate(new Ur(this.zoom),s,{},d,[],_),b=this.expression.evaluate(new Ur(this.zoom+1),s,{},d,[],_),k=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(k,t,v,b)}updatePaintArray(t,s,h,d){const _=this.expression.evaluate({zoom:this.zoom},h,d),v=this.expression.evaluate({zoom:this.zoom+1},h,d);this._setPaintValue(t,s,_,v)}_setPaintValue(t,s,h,d){if(this.type==="color"){const _=hc(h),v=hc(d);for(let b=t;b<s;b++)this.paintVertexArray.emplace(b,_[0],_[1],v[0],v[1])}else{for(let _=t;_<s;_++)this.paintVertexArray.emplace(_,h,d);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(d))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,s){const h=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,d=we(this.expression.interpolationFactor(h,this.zoom,this.zoom+1),0,1);t.set(d)}getBinding(t,s,h){return new Qo(t,s)}}class en{constructor(t,s,h,d,_,v){this.expression=t,this.type=s,this.useIntegerZoom=h,this.zoom=d,this.layerId=v,this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(t,s,h){const d=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(d,t,s.patterns&&s.patterns[this.layerId],h)}updatePaintArray(t,s,h,d,_){this._setPaintValues(t,s,h.patterns&&h.patterns[this.layerId],_)}_setPaintValues(t,s,h,d){if(!d||!h)return;const{min:_,mid:v,max:b}=h,k=d[_],I=d[v],D=d[b];if(k&&I&&D)for(let O=t;O<s;O++)this.zoomInPaintVertexArray.emplace(O,I.tl[0],I.tl[1],I.br[0],I.br[1],k.tl[0],k.tl[1],k.br[0],k.br[1],I.pixelRatio,k.pixelRatio),this.zoomOutPaintVertexArray.emplace(O,I.tl[0],I.tl[1],I.br[0],I.br[1],D.tl[0],D.tl[1],D.br[0],D.br[1],I.pixelRatio,D.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Yi.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Yi.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class fc{constructor(t,s,h){this.binders={},this._buffers=[];const d=[];for(const _ in t.paint._values){if(!h(_))continue;const v=t.paint.get(_);if(!(v instanceof Ha&&ps(v.property.specification)))continue;const b=Vx(_,t.type),k=v.value,I=v.property.specification.type,D=v.property.useIntegerZoom,O=v.property.specification["property-type"],G=O==="cross-faded"||O==="cross-faded-data-driven";if(k.kind==="constant")this.binders[_]=G?new Jn(k.value,b):new Ji(k.value,b,I),d.push(`/u_${_}`);else if(k.kind==="source"||G){const q=Td(_,I,"source");this.binders[_]=G?new en(k,I,D,s,q,t.id):new Qi(k,b,I,q),d.push(`/a_${_}`)}else{const q=Td(_,I,"composite");this.binders[_]=new Oi(k,b,I,D,s,q),d.push(`/z_${_}`)}}this.cacheKey=d.sort().join("")}getMaxValue(t){const s=this.binders[t];return s instanceof Qi||s instanceof Oi?s.maxValue:0}populatePaintArrays(t,s,h,d,_){for(const v in this.binders){const b=this.binders[v];(b instanceof Qi||b instanceof Oi||b instanceof en)&&b.populatePaintArray(t,s,h,d,_)}}setConstantPatternPositions(t,s){for(const h in this.binders){const d=this.binders[h];d instanceof Jn&&d.setConstantPatternPositions(t,s)}}updatePaintArrays(t,s,h,d,_){let v=!1;for(const b in t){const k=s.getPositions(b);for(const I of k){const D=h.feature(I.index);for(const O in this.binders){const G=this.binders[O];if((G instanceof Qi||G instanceof Oi||G instanceof en)&&G.expression.isStateDependent===!0){const q=d.paint.get(O);G.expression=q.value,G.updatePaintArray(I.start,I.end,D,t[b],_),v=!0}}}}return v}defines(){const t=[];for(const s in this.binders){const h=this.binders[s];(h instanceof Ji||h instanceof Jn)&&t.push(...h.uniformNames.map(d=>`#define HAS_UNIFORM_${d}`))}return t}getBinderAttributes(){const t=[];for(const s in this.binders){const h=this.binders[s];if(h instanceof Qi||h instanceof Oi)for(let d=0;d<h.paintVertexAttributes.length;d++)t.push(h.paintVertexAttributes[d].name);else if(h instanceof en)for(let d=0;d<Yi.members.length;d++)t.push(Yi.members[d].name)}return t}getBinderUniforms(){const t=[];for(const s in this.binders){const h=this.binders[s];if(h instanceof Ji||h instanceof Jn||h instanceof Oi)for(const d of h.uniformNames)t.push(d)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,s){const h=[];for(const d in this.binders){const _=this.binders[d];if(_ instanceof Ji||_ instanceof Jn||_ instanceof Oi){for(const v of _.uniformNames)if(s[v]){const b=_.getBinding(t,s[v],v);h.push({name:v,property:d,binding:b})}}}return h}setUniforms(t,s,h,d){for(const{name:_,property:v,binding:b}of s)this.binders[v].setUniform(b,d,h.get(v),_)}updatePaintBuffers(t){this._buffers=[];for(const s in this.binders){const h=this.binders[s];if(t&&h instanceof en){const d=t.fromScale===2?h.zoomInPaintVertexBuffer:h.zoomOutPaintVertexBuffer;d&&this._buffers.push(d)}else(h instanceof Qi||h instanceof Oi)&&h.paintVertexBuffer&&this._buffers.push(h.paintVertexBuffer)}}upload(t){for(const s in this.binders){const h=this.binders[s];(h instanceof Qi||h instanceof Oi||h instanceof en)&&h.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const s=this.binders[t];(s instanceof Qi||s instanceof Oi||s instanceof en)&&s.destroy()}}}class gn{constructor(t,s,h=()=>!0){this.programConfigurations={};for(const d of t)this.programConfigurations[d.id]=new fc(d,s,h);this.needsUpload=!1,this._featureMap=new aa,this._bufferOffset=0}populatePaintArrays(t,s,h,d,_,v){for(const b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(t,s,d,_,v);s.id!==void 0&&this._featureMap.add(s.id,h,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,s,h,d){for(const _ of h)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(t,this._featureMap,s,_,d)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function Vx(i,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${t}-`,"").replace(/-/g,"_")]}function Td(i,t,s){const h={color:{source:vs,composite:oe},number:{source:A,composite:vs}},d=function(_){return{"line-pattern":{source:Rr,composite:Rr},"fill-pattern":{source:Rr,composite:Rr},"fill-extrusion-pattern":{source:Rr,composite:Rr}}[_]}(i);return d&&d[s]||h[t][s]}Dt("ConstantBinder",Ji),Dt("CrossFadedConstantBinder",Jn),Dt("SourceExpressionBinder",Qi),Dt("CrossFadedCompositeBinder",en),Dt("CompositeExpressionBinder",Oi),Dt("ProgramConfiguration",fc,{omit:["_buffers"]}),Dt("ProgramConfigurationSet",gn);const ha=8192,pf=Math.pow(2,14)-1,Ed=-pf-1;function ro(i){const t=ha/i.extent,s=i.loadGeometry();for(let h=0;h<s.length;h++){const d=s[h];for(let _=0;_<d.length;_++){const v=d[_],b=Math.round(v.x*t),k=Math.round(v.y*t);v.x=we(b,Ed,pf),v.y=we(k,Ed,pf),(b<v.x||b>v.x+1||k<v.y||k>v.y+1)&&ft("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return s}function ao(i,t){return{type:i.type,id:i.id,properties:i.properties,geometry:t?ro(i):[]}}function Zu(i,t,s,h,d){i.emplaceBack(2*t+(h+1)/2,2*s+(d+1)/2)}class mf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Ot,this.indexArray=new Fa,this.segments=new Vr,this.programConfigurations=new gn(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,h){const d=this.layers[0],_=[];let v=null,b=!1;d.type==="circle"&&(v=d.layout.get("circle-sort-key"),b=!v.isConstant());for(const{feature:k,id:I,index:D,sourceLayerIndex:O}of t){const G=this.layers[0]._featureFilter.needGeometry,q=ao(k,G);if(!this.layers[0]._featureFilter.filter(new Ur(this.zoom),q,h))continue;const Z=b?v.evaluate(q,{},h):void 0,ne={id:I,properties:k.properties,type:k.type,sourceLayerIndex:O,index:D,geometry:G?q.geometry:ro(k),patterns:{},sortKey:Z};_.push(ne)}b&&_.sort((k,I)=>k.sortKey-I.sortKey);for(const k of _){const{geometry:I,index:D,sourceLayerIndex:O}=k,G=t[D].feature;this.addFeature(k,I,D,h),s.featureIndex.insert(G,I,D,O,this.index)}}update(t,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,yi),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,s,h,d){for(const _ of s)for(const v of _){const b=v.x,k=v.y;if(b<0||b>=ha||k<0||k>=ha)continue;const I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),D=I.vertexLength;Zu(this.layoutVertexArray,b,k,-1,-1),Zu(this.layoutVertexArray,b,k,1,-1),Zu(this.layoutVertexArray,b,k,1,1),Zu(this.layoutVertexArray,b,k,-1,1),this.indexArray.emplaceBack(D,D+1,D+2),this.indexArray.emplaceBack(D,D+3,D+2),I.vertexLength+=4,I.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,h,{},d)}}function Sd(i,t){for(let s=0;s<i.length;s++)if(el(t,i[s]))return!0;for(let s=0;s<t.length;s++)if(el(i,t[s]))return!0;return!!gf(i,t)}function $x(i,t,s){return!!el(i,t)||!!xf(t,i,s)}function kd(i,t){if(i.length===1)return Ad(t,i[0]);for(let s=0;s<t.length;s++){const h=t[s];for(let d=0;d<h.length;d++)if(el(i,h[d]))return!0}for(let s=0;s<i.length;s++)if(Ad(t,i[s]))return!0;for(let s=0;s<t.length;s++)if(gf(i,t[s]))return!0;return!1}function jx(i,t,s){if(i.length>1){if(gf(i,t))return!0;for(let h=0;h<t.length;h++)if(xf(t[h],i,s))return!0}for(let h=0;h<i.length;h++)if(xf(i[h],t,s))return!0;return!1}function gf(i,t){if(i.length===0||t.length===0)return!1;for(let s=0;s<i.length-1;s++){const h=i[s],d=i[s+1];for(let _=0;_<t.length-1;_++)if(Gx(h,d,t[_],t[_+1]))return!0}return!1}function Gx(i,t,s,h){return ct(i,s,h)!==ct(t,s,h)&&ct(i,t,s)!==ct(i,t,h)}function xf(i,t,s){const h=s*s;if(t.length===1)return i.distSqr(t[0])<h;for(let d=1;d<t.length;d++)if(Cd(i,t[d-1],t[d])<h)return!0;return!1}function Cd(i,t,s){const h=t.distSqr(s);if(h===0)return i.distSqr(t);const d=((i.x-t.x)*(s.x-t.x)+(i.y-t.y)*(s.y-t.y))/h;return i.distSqr(d<0?t:d>1?s:s.sub(t)._mult(d)._add(t))}function Ad(i,t){let s,h,d,_=!1;for(let v=0;v<i.length;v++){s=i[v];for(let b=0,k=s.length-1;b<s.length;k=b++)h=s[b],d=s[k],h.y>t.y!=d.y>t.y&&t.x<(d.x-h.x)*(t.y-h.y)/(d.y-h.y)+h.x&&(_=!_)}return _}function el(i,t){let s=!1;for(let h=0,d=i.length-1;h<i.length;d=h++){const _=i[h],v=i[d];_.y>t.y!=v.y>t.y&&t.x<(v.x-_.x)*(t.y-_.y)/(v.y-_.y)+_.x&&(s=!s)}return s}function Hx(i,t,s){const h=s[0],d=s[2];if(i.x<h.x&&t.x<h.x||i.x>d.x&&t.x>d.x||i.y<h.y&&t.y<h.y||i.y>d.y&&t.y>d.y)return!1;const _=ct(i,t,s[0]);return _!==ct(i,t,s[1])||_!==ct(i,t,s[2])||_!==ct(i,t,s[3])}function dc(i,t,s){const h=t.paint.get(i).value;return h.kind==="constant"?h.value:s.programConfigurations.get(t.id).getMaxValue(i)}function Xu(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Ku(i,t,s,h,d){if(!t[0]&&!t[1])return i;const _=M.convert(t)._mult(d);s==="viewport"&&_._rotate(-h);const v=[];for(let b=0;b<i.length;b++)v.push(i[b].sub(_));return v}let Id,Fd;Dt("CircleBucket",mf,{omit:["layers"]});var Wx={get paint(){return Fd=Fd||new oa({"circle-radius":new Wt(qe.paint_circle["circle-radius"]),"circle-color":new Wt(qe.paint_circle["circle-color"]),"circle-blur":new Wt(qe.paint_circle["circle-blur"]),"circle-opacity":new Wt(qe.paint_circle["circle-opacity"]),"circle-translate":new $t(qe.paint_circle["circle-translate"]),"circle-translate-anchor":new $t(qe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new $t(qe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new $t(qe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Wt(qe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Wt(qe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Wt(qe.paint_circle["circle-stroke-opacity"])})},get layout(){return Id=Id||new oa({"circle-sort-key":new Wt(qe.layout_circle["circle-sort-key"])})}},ai=1e-6,tl=typeof Float32Array<"u"?Float32Array:Array;function _f(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Pd(i,t,s){var h=t[0],d=t[1],_=t[2],v=t[3],b=t[4],k=t[5],I=t[6],D=t[7],O=t[8],G=t[9],q=t[10],Z=t[11],ne=t[12],xe=t[13],be=t[14],Be=t[15],ke=s[0],Ne=s[1],We=s[2],st=s[3];return i[0]=ke*h+Ne*b+We*O+st*ne,i[1]=ke*d+Ne*k+We*G+st*xe,i[2]=ke*_+Ne*I+We*q+st*be,i[3]=ke*v+Ne*D+We*Z+st*Be,i[4]=(ke=s[4])*h+(Ne=s[5])*b+(We=s[6])*O+(st=s[7])*ne,i[5]=ke*d+Ne*k+We*G+st*xe,i[6]=ke*_+Ne*I+We*q+st*be,i[7]=ke*v+Ne*D+We*Z+st*Be,i[8]=(ke=s[8])*h+(Ne=s[9])*b+(We=s[10])*O+(st=s[11])*ne,i[9]=ke*d+Ne*k+We*G+st*xe,i[10]=ke*_+Ne*I+We*q+st*be,i[11]=ke*v+Ne*D+We*Z+st*Be,i[12]=(ke=s[12])*h+(Ne=s[13])*b+(We=s[14])*O+(st=s[15])*ne,i[13]=ke*d+Ne*k+We*G+st*xe,i[14]=ke*_+Ne*I+We*q+st*be,i[15]=ke*v+Ne*D+We*Z+st*Be,i}Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)});var pc,qx=Pd;function Yu(i,t,s){var h=t[0],d=t[1],_=t[2],v=t[3];return i[0]=s[0]*h+s[4]*d+s[8]*_+s[12]*v,i[1]=s[1]*h+s[5]*d+s[9]*_+s[13]*v,i[2]=s[2]*h+s[6]*d+s[10]*_+s[14]*v,i[3]=s[3]*h+s[7]*d+s[11]*_+s[15]*v,i}pc=new tl(4),tl!=Float32Array&&(pc[0]=0,pc[1]=0,pc[2]=0,pc[3]=0);class Zx extends Ri{constructor(t){super(t,Wx)}createBucket(t){return new mf(t)}queryRadius(t){const s=t;return dc("circle-radius",this,s)+dc("circle-stroke-width",this,s)+Xu(this.paint.get("circle-translate"))}queryIntersectsFeature(t,s,h,d,_,v,b,k){const I=Ku(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),v.angle,b),D=this.paint.get("circle-radius").evaluate(s,h)+this.paint.get("circle-stroke-width").evaluate(s,h),O=this.paint.get("circle-pitch-alignment")==="map",G=O?I:function(Z,ne){return Z.map(xe=>Md(xe,ne))}(I,k),q=O?D*b:D;for(const Z of d)for(const ne of Z){const xe=O?ne:Md(ne,k);let be=q;const Be=Yu([],[ne.x,ne.y,0,1],k);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?be*=Be[3]/v.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(be*=v.cameraToCenterDistance/Be[3]),$x(G,xe,be))return!0}return!1}}function Md(i,t){const s=Yu([],[i.x,i.y,0,1],t);return new M(s[0]/s[3],s[1]/s[3])}class Dd extends mf{}let Ld;Dt("HeatmapBucket",Dd,{omit:["layers"]});var Xx={get paint(){return Ld=Ld||new oa({"heatmap-radius":new Wt(qe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Wt(qe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new $t(qe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new nc(qe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new $t(qe.paint_heatmap["heatmap-opacity"])})}};function yf(i,{width:t,height:s},h,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==t*s*h)throw new RangeError(`mismatched image size. expected: ${d.length} but got: ${t*s*h}`)}else d=new Uint8Array(t*s*h);return i.width=t,i.height=s,i.data=d,i}function Rd(i,{width:t,height:s},h){if(t===i.width&&s===i.height)return;const d=yf({},{width:t,height:s},h);vf(i,d,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,t),height:Math.min(i.height,s)},h),i.width=t,i.height=s,i.data=d.data}function vf(i,t,s,h,d,_){if(d.width===0||d.height===0)return t;if(d.width>i.width||d.height>i.height||s.x>i.width-d.width||s.y>i.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>t.width||d.height>t.height||h.x>t.width-d.width||h.y>t.height-d.height)throw new RangeError("out of range destination coordinates for image copy");const v=i.data,b=t.data;if(v===b)throw new Error("srcData equals dstData, so image is already copied");for(let k=0;k<d.height;k++){const I=((s.y+k)*i.width+s.x)*_,D=((h.y+k)*t.width+h.x)*_;for(let O=0;O<d.width*_;O++)b[D+O]=v[I+O]}return t}class mc{constructor(t,s){yf(this,t,1,s)}resize(t){Rd(this,t,1)}clone(){return new mc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,s,h,d,_){vf(t,s,h,d,_,1)}}class Ui{constructor(t,s){yf(this,t,4,s)}resize(t){Rd(this,t,4)}replace(t,s){s?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Ui({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,s,h,d,_){vf(t,s,h,d,_,4)}}function Od(i){const t={},s=i.resolution||256,h=i.clips?i.clips.length:1,d=i.image||new Ui({width:s,height:h});if(Math.log(s)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${s}`);const _=(v,b,k)=>{t[i.evaluationKey]=k;const I=i.expression.evaluate(t);d.data[v+b+0]=Math.floor(255*I.r/I.a),d.data[v+b+1]=Math.floor(255*I.g/I.a),d.data[v+b+2]=Math.floor(255*I.b/I.a),d.data[v+b+3]=Math.floor(255*I.a)};if(i.clips)for(let v=0,b=0;v<h;++v,b+=4*s)for(let k=0,I=0;k<s;k++,I+=4){const D=k/(s-1),{start:O,end:G}=i.clips[v];_(b,I,O*(1-D)+G*D)}else for(let v=0,b=0;v<s;v++,b+=4)_(0,b,v/(s-1));return d}Dt("AlphaImage",mc),Dt("RGBAImage",Ui);class Kx extends Ri{createBucket(t){return new Dd(t)}constructor(t){super(t,Xx),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Od({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Bd;var Yx={get paint(){return Bd=Bd||new oa({"hillshade-illumination-direction":new $t(qe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new $t(qe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new $t(qe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new $t(qe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new $t(qe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new $t(qe.paint_hillshade["hillshade-accent-color"])})}};class Jx extends Ri{constructor(t){super(t,Yx)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Qx=Zr([{name:"a_pos",components:2,type:"Int16"}],4),{members:e_}=Qx;var wf={exports:{}};function Ju(i,t,s){s=s||2;var h,d,_,v,b,k,I,D=t&&t.length,O=D?t[0]*s:i.length,G=zd(i,0,O,s,!0),q=[];if(!G||G.next===G.prev)return q;if(D&&(G=function(ne,xe,be,Be){var ke,Ne,We,st=[];for(ke=0,Ne=xe.length;ke<Ne;ke++)(We=zd(ne,xe[ke]*Be,ke<Ne-1?xe[ke+1]*Be:ne.length,Be,!1))===We.next&&(We.steiner=!0),st.push(l_(We));for(st.sort(n_),ke=0;ke<st.length;ke++)be=s_(st[ke],be);return be}(i,t,G,s)),i.length>80*s){h=_=i[0],d=v=i[1];for(var Z=s;Z<O;Z+=s)(b=i[Z])<h&&(h=b),(k=i[Z+1])<d&&(d=k),b>_&&(_=b),k>v&&(v=k);I=(I=Math.max(_-h,v-d))!==0?32767/I:0}return gc(G,q,s,h,d,I,0),q}function zd(i,t,s,h,d){var _,v;if(d===Ef(i,t,s,h)>0)for(_=t;_<s;_+=h)v=Vd(_,i[_],i[_+1],v);else for(_=s-h;_>=t;_-=h)v=Vd(_,i[_],i[_+1],v);return v&&Qu(v,v.next)&&(_c(v),v=v.next),v}function io(i,t){if(!i)return i;t||(t=i);var s,h=i;do if(s=!1,h.steiner||!Qu(h,h.next)&&ca(h.prev,h,h.next)!==0)h=h.next;else{if(_c(h),(h=t=h.prev)===h.next)break;s=!0}while(s||h!==t);return t}function gc(i,t,s,h,d,_,v){if(i){!v&&_&&function(D,O,G,q){var Z=D;do Z.z===0&&(Z.z=bf(Z.x,Z.y,O,G,q)),Z.prevZ=Z.prev,Z.nextZ=Z.next,Z=Z.next;while(Z!==D);Z.prevZ.nextZ=null,Z.prevZ=null,function(ne){var xe,be,Be,ke,Ne,We,st,At,Bt=1;do{for(be=ne,ne=null,Ne=null,We=0;be;){for(We++,Be=be,st=0,xe=0;xe<Bt&&(st++,Be=Be.nextZ);xe++);for(At=Bt;st>0||At>0&&Be;)st!==0&&(At===0||!Be||be.z<=Be.z)?(ke=be,be=be.nextZ,st--):(ke=Be,Be=Be.nextZ,At--),Ne?Ne.nextZ=ke:ne=ke,ke.prevZ=Ne,Ne=ke;be=Be}Ne.nextZ=null,Bt*=2}while(We>1)}(Z)}(i,h,d,_);for(var b,k,I=i;i.prev!==i.next;)if(b=i.prev,k=i.next,_?r_(i,h,d,_):t_(i))t.push(b.i/s|0),t.push(i.i/s|0),t.push(k.i/s|0),_c(i),i=k.next,I=k.next;else if((i=k)===I){v?v===1?gc(i=a_(io(i),t,s),t,s,h,d,_,2):v===2&&i_(i,t,s,h,d,_):gc(io(i),t,s,h,d,_,1);break}}}function t_(i){var t=i.prev,s=i,h=i.next;if(ca(t,s,h)>=0)return!1;for(var d=t.x,_=s.x,v=h.x,b=t.y,k=s.y,I=h.y,D=d<_?d<v?d:v:_<v?_:v,O=b<k?b<I?b:I:k<I?k:I,G=d>_?d>v?d:v:_>v?_:v,q=b>k?b>I?b:I:k>I?k:I,Z=h.next;Z!==t;){if(Z.x>=D&&Z.x<=G&&Z.y>=O&&Z.y<=q&&rl(d,b,_,k,v,I,Z.x,Z.y)&&ca(Z.prev,Z,Z.next)>=0)return!1;Z=Z.next}return!0}function r_(i,t,s,h){var d=i.prev,_=i,v=i.next;if(ca(d,_,v)>=0)return!1;for(var b=d.x,k=_.x,I=v.x,D=d.y,O=_.y,G=v.y,q=b<k?b<I?b:I:k<I?k:I,Z=D<O?D<G?D:G:O<G?O:G,ne=b>k?b>I?b:I:k>I?k:I,xe=D>O?D>G?D:G:O>G?O:G,be=bf(q,Z,t,s,h),Be=bf(ne,xe,t,s,h),ke=i.prevZ,Ne=i.nextZ;ke&&ke.z>=be&&Ne&&Ne.z<=Be;){if(ke.x>=q&&ke.x<=ne&&ke.y>=Z&&ke.y<=xe&&ke!==d&&ke!==v&&rl(b,D,k,O,I,G,ke.x,ke.y)&&ca(ke.prev,ke,ke.next)>=0||(ke=ke.prevZ,Ne.x>=q&&Ne.x<=ne&&Ne.y>=Z&&Ne.y<=xe&&Ne!==d&&Ne!==v&&rl(b,D,k,O,I,G,Ne.x,Ne.y)&&ca(Ne.prev,Ne,Ne.next)>=0))return!1;Ne=Ne.nextZ}for(;ke&&ke.z>=be;){if(ke.x>=q&&ke.x<=ne&&ke.y>=Z&&ke.y<=xe&&ke!==d&&ke!==v&&rl(b,D,k,O,I,G,ke.x,ke.y)&&ca(ke.prev,ke,ke.next)>=0)return!1;ke=ke.prevZ}for(;Ne&&Ne.z<=Be;){if(Ne.x>=q&&Ne.x<=ne&&Ne.y>=Z&&Ne.y<=xe&&Ne!==d&&Ne!==v&&rl(b,D,k,O,I,G,Ne.x,Ne.y)&&ca(Ne.prev,Ne,Ne.next)>=0)return!1;Ne=Ne.nextZ}return!0}function a_(i,t,s){var h=i;do{var d=h.prev,_=h.next.next;!Qu(d,_)&&Nd(d,h,h.next,_)&&xc(d,_)&&xc(_,d)&&(t.push(d.i/s|0),t.push(h.i/s|0),t.push(_.i/s|0),_c(h),_c(h.next),h=i=_),h=h.next}while(h!==i);return io(h)}function i_(i,t,s,h,d,_){var v=i;do{for(var b=v.next.next;b!==v.prev;){if(v.i!==b.i&&c_(v,b)){var k=Ud(v,b);return v=io(v,v.next),k=io(k,k.next),gc(v,t,s,h,d,_,0),void gc(k,t,s,h,d,_,0)}b=b.next}v=v.next}while(v!==i)}function n_(i,t){return i.x-t.x}function s_(i,t){var s=function(d,_){var v,b=_,k=d.x,I=d.y,D=-1/0;do{if(I<=b.y&&I>=b.next.y&&b.next.y!==b.y){var O=b.x+(I-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(O<=k&&O>D&&(D=O,v=b.x<b.next.x?b:b.next,O===k))return v}b=b.next}while(b!==_);if(!v)return null;var G,q=v,Z=v.x,ne=v.y,xe=1/0;b=v;do k>=b.x&&b.x>=Z&&k!==b.x&&rl(I<ne?k:D,I,Z,ne,I<ne?D:k,I,b.x,b.y)&&(G=Math.abs(I-b.y)/(k-b.x),xc(b,d)&&(G<xe||G===xe&&(b.x>v.x||b.x===v.x&&o_(v,b)))&&(v=b,xe=G)),b=b.next;while(b!==q);return v}(i,t);if(!s)return t;var h=Ud(s,i);return io(h,h.next),io(s,s.next)}function o_(i,t){return ca(i.prev,i,t.prev)<0&&ca(t.next,i,i.next)<0}function bf(i,t,s,h,d){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-s)*d|0)|i<<8))|i<<4))|i<<2))|i<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-h)*d|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function l_(i){var t=i,s=i;do(t.x<s.x||t.x===s.x&&t.y<s.y)&&(s=t),t=t.next;while(t!==i);return s}function rl(i,t,s,h,d,_,v,b){return(d-v)*(t-b)>=(i-v)*(_-b)&&(i-v)*(h-b)>=(s-v)*(t-b)&&(s-v)*(_-b)>=(d-v)*(h-b)}function c_(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!function(s,h){var d=s;do{if(d.i!==s.i&&d.next.i!==s.i&&d.i!==h.i&&d.next.i!==h.i&&Nd(d,d.next,s,h))return!0;d=d.next}while(d!==s);return!1}(i,t)&&(xc(i,t)&&xc(t,i)&&function(s,h){var d=s,_=!1,v=(s.x+h.x)/2,b=(s.y+h.y)/2;do d.y>b!=d.next.y>b&&d.next.y!==d.y&&v<(d.next.x-d.x)*(b-d.y)/(d.next.y-d.y)+d.x&&(_=!_),d=d.next;while(d!==s);return _}(i,t)&&(ca(i.prev,i,t.prev)||ca(i,t.prev,t))||Qu(i,t)&&ca(i.prev,i,i.next)>0&&ca(t.prev,t,t.next)>0)}function ca(i,t,s){return(t.y-i.y)*(s.x-t.x)-(t.x-i.x)*(s.y-t.y)}function Qu(i,t){return i.x===t.x&&i.y===t.y}function Nd(i,t,s,h){var d=th(ca(i,t,s)),_=th(ca(i,t,h)),v=th(ca(s,h,i)),b=th(ca(s,h,t));return d!==_&&v!==b||!(d!==0||!eh(i,s,t))||!(_!==0||!eh(i,h,t))||!(v!==0||!eh(s,i,h))||!(b!==0||!eh(s,t,h))}function eh(i,t,s){return t.x<=Math.max(i.x,s.x)&&t.x>=Math.min(i.x,s.x)&&t.y<=Math.max(i.y,s.y)&&t.y>=Math.min(i.y,s.y)}function th(i){return i>0?1:i<0?-1:0}function xc(i,t){return ca(i.prev,i,i.next)<0?ca(i,t,i.next)>=0&&ca(i,i.prev,t)>=0:ca(i,t,i.prev)<0||ca(i,i.next,t)<0}function Ud(i,t){var s=new Tf(i.i,i.x,i.y),h=new Tf(t.i,t.x,t.y),d=i.next,_=t.prev;return i.next=t,t.prev=i,s.next=d,d.prev=s,h.next=s,s.prev=h,_.next=h,h.prev=_,h}function Vd(i,t,s,h){var d=new Tf(i,t,s);return h?(d.next=h.next,d.prev=h,h.next.prev=d,h.next=d):(d.prev=d,d.next=d),d}function _c(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Tf(i,t,s){this.i=i,this.x=t,this.y=s,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ef(i,t,s,h){for(var d=0,_=t,v=s-h;_<s;_+=h)d+=(i[v]-i[_])*(i[_+1]+i[v+1]),v=_;return d}wf.exports=Ju,wf.exports.default=Ju,Ju.deviation=function(i,t,s,h){var d=t&&t.length,_=Math.abs(Ef(i,0,d?t[0]*s:i.length,s));if(d)for(var v=0,b=t.length;v<b;v++)_-=Math.abs(Ef(i,t[v]*s,v<b-1?t[v+1]*s:i.length,s));var k=0;for(v=0;v<h.length;v+=3){var I=h[v]*s,D=h[v+1]*s,O=h[v+2]*s;k+=Math.abs((i[I]-i[O])*(i[D+1]-i[I+1])-(i[I]-i[D])*(i[O+1]-i[I+1]))}return _===0&&k===0?0:Math.abs((k-_)/_)},Ju.flatten=function(i){for(var t=i[0][0].length,s={vertices:[],holes:[],dimensions:t},h=0,d=0;d<i.length;d++){for(var _=0;_<i[d].length;_++)for(var v=0;v<t;v++)s.vertices.push(i[d][_][v]);d>0&&s.holes.push(h+=i[d-1].length)}return s};var $d=w(wf.exports);function u_(i,t,s,h,d){jd(i,t,s||0,h||i.length-1,d||h_)}function jd(i,t,s,h,d){for(;h>s;){if(h-s>600){var _=h-s+1,v=t-s+1,b=Math.log(_),k=.5*Math.exp(2*b/3),I=.5*Math.sqrt(b*k*(_-k)/_)*(v-_/2<0?-1:1);jd(i,t,Math.max(s,Math.floor(t-v*k/_+I)),Math.min(h,Math.floor(t+(_-v)*k/_+I)),d)}var D=i[t],O=s,G=h;for(yc(i,s,t),d(i[h],D)>0&&yc(i,s,h);O<G;){for(yc(i,O,G),O++,G--;d(i[O],D)<0;)O++;for(;d(i[G],D)>0;)G--}d(i[s],D)===0?yc(i,s,G):yc(i,++G,h),G<=t&&(s=G+1),t<=G&&(h=G-1)}}function yc(i,t,s){var h=i[t];i[t]=i[s],i[s]=h}function h_(i,t){return i<t?-1:i>t?1:0}function Sf(i,t){const s=i.length;if(s<=1)return[i];const h=[];let d,_;for(let v=0;v<s;v++){const b=xt(i[v]);b!==0&&(i[v].area=Math.abs(b),_===void 0&&(_=b<0),_===b<0?(d&&h.push(d),d=[i[v]]):d.push(i[v]))}if(d&&h.push(d),t>1)for(let v=0;v<h.length;v++)h[v].length<=t||(u_(h[v],t,1,h[v].length-1,f_),h[v]=h[v].slice(0,t));return h}function f_(i,t){return t.area-i.area}function kf(i,t,s){const h=s.patternDependencies;let d=!1;for(const _ of t){const v=_.paint.get(`${i}-pattern`);v.isConstant()||(d=!0);const b=v.constantOr(null);b&&(d=!0,h[b.to]=!0,h[b.from]=!0)}return d}function Cf(i,t,s,h,d){const _=d.patternDependencies;for(const v of t){const b=v.paint.get(`${i}-pattern`).value;if(b.kind!=="constant"){let k=b.evaluate({zoom:h-1},s,{},d.availableImages),I=b.evaluate({zoom:h},s,{},d.availableImages),D=b.evaluate({zoom:h+1},s,{},d.availableImages);k=k&&k.name?k.name:k,I=I&&I.name?I.name:I,D=D&&D.name?D.name:D,_[k]=!0,_[I]=!0,_[D]=!0,s.patterns[v.id]={min:k,mid:I,max:D}}}return s}class Af{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new pr,this.indexArray=new Fa,this.indexArray2=new ga,this.programConfigurations=new gn(t.layers,t.zoom),this.segments=new Vr,this.segments2=new Vr,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,h){this.hasPattern=kf("fill",this.layers,s);const d=this.layers[0].layout.get("fill-sort-key"),_=!d.isConstant(),v=[];for(const{feature:b,id:k,index:I,sourceLayerIndex:D}of t){const O=this.layers[0]._featureFilter.needGeometry,G=ao(b,O);if(!this.layers[0]._featureFilter.filter(new Ur(this.zoom),G,h))continue;const q=_?d.evaluate(G,{},h,s.availableImages):void 0,Z={id:k,properties:b.properties,type:b.type,sourceLayerIndex:D,index:I,geometry:O?G.geometry:ro(b),patterns:{},sortKey:q};v.push(Z)}_&&v.sort((b,k)=>b.sortKey-k.sortKey);for(const b of v){const{geometry:k,index:I,sourceLayerIndex:D}=b;if(this.hasPattern){const O=Cf("fill",this.layers,b,this.zoom,s);this.patternFeatures.push(O)}else this.addFeature(b,k,I,h,{});s.featureIndex.insert(t[I].feature,k,I,D,this.index)}}update(t,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,h)}addFeatures(t,s,h){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,s,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,e_),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,s,h,d,_){for(const v of Sf(s,500)){let b=0;for(const q of v)b+=q.length;const k=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray),I=k.vertexLength,D=[],O=[];for(const q of v){if(q.length===0)continue;q!==v[0]&&O.push(D.length/2);const Z=this.segments2.prepareSegment(q.length,this.layoutVertexArray,this.indexArray2),ne=Z.vertexLength;this.layoutVertexArray.emplaceBack(q[0].x,q[0].y),this.indexArray2.emplaceBack(ne+q.length-1,ne),D.push(q[0].x),D.push(q[0].y);for(let xe=1;xe<q.length;xe++)this.layoutVertexArray.emplaceBack(q[xe].x,q[xe].y),this.indexArray2.emplaceBack(ne+xe-1,ne+xe),D.push(q[xe].x),D.push(q[xe].y);Z.vertexLength+=q.length,Z.primitiveLength+=q.length}const G=$d(D,O);for(let q=0;q<G.length;q+=3)this.indexArray.emplaceBack(I+G[q],I+G[q+1],I+G[q+2]);k.vertexLength+=b,k.primitiveLength+=G.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,h,_,d)}}let Gd,Hd;Dt("FillBucket",Af,{omit:["layers","patternFeatures"]});var d_={get paint(){return Hd=Hd||new oa({"fill-antialias":new $t(qe.paint_fill["fill-antialias"]),"fill-opacity":new Wt(qe.paint_fill["fill-opacity"]),"fill-color":new Wt(qe.paint_fill["fill-color"]),"fill-outline-color":new Wt(qe.paint_fill["fill-outline-color"]),"fill-translate":new $t(qe.paint_fill["fill-translate"]),"fill-translate-anchor":new $t(qe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Qs(qe.paint_fill["fill-pattern"])})},get layout(){return Gd=Gd||new oa({"fill-sort-key":new Wt(qe.layout_fill["fill-sort-key"])})}};class p_ extends Ri{constructor(t){super(t,d_)}recalculate(t,s){super.recalculate(t,s);const h=this.paint._values["fill-outline-color"];h.value.kind==="constant"&&h.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Af(t)}queryRadius(){return Xu(this.paint.get("fill-translate"))}queryIntersectsFeature(t,s,h,d,_,v,b){return kd(Ku(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),v.angle,b),d)}isTileClipped(){return!0}}const m_=Zr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),g_=Zr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:x_}=m_;var bs={},__=C,Wd=al;function al(i,t,s,h,d){this.properties={},this.extent=s,this.type=0,this._pbf=i,this._geometry=-1,this._keys=h,this._values=d,i.readFields(y_,this,t)}function y_(i,t,s){i==1?t.id=s.readVarint():i==2?function(h,d){for(var _=h.readVarint()+h.pos;h.pos<_;){var v=d._keys[h.readVarint()],b=d._values[h.readVarint()];d.properties[v]=b}}(s,t):i==3?t.type=s.readVarint():i==4&&(t._geometry=s.pos)}function v_(i){for(var t,s,h=0,d=0,_=i.length,v=_-1;d<_;v=d++)h+=((s=i[v]).x-(t=i[d]).x)*(t.y+s.y);return h}al.types=["Unknown","Point","LineString","Polygon"],al.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var t,s=i.readVarint()+i.pos,h=1,d=0,_=0,v=0,b=[];i.pos<s;){if(d<=0){var k=i.readVarint();h=7&k,d=k>>3}if(d--,h===1||h===2)_+=i.readSVarint(),v+=i.readSVarint(),h===1&&(t&&b.push(t),t=[]),t.push(new __(_,v));else{if(h!==7)throw new Error("unknown command "+h);t&&t.push(t[0].clone())}}return t&&b.push(t),b},al.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var t=i.readVarint()+i.pos,s=1,h=0,d=0,_=0,v=1/0,b=-1/0,k=1/0,I=-1/0;i.pos<t;){if(h<=0){var D=i.readVarint();s=7&D,h=D>>3}if(h--,s===1||s===2)(d+=i.readSVarint())<v&&(v=d),d>b&&(b=d),(_+=i.readSVarint())<k&&(k=_),_>I&&(I=_);else if(s!==7)throw new Error("unknown command "+s)}return[v,k,b,I]},al.prototype.toGeoJSON=function(i,t,s){var h,d,_=this.extent*Math.pow(2,s),v=this.extent*i,b=this.extent*t,k=this.loadGeometry(),I=al.types[this.type];function D(q){for(var Z=0;Z<q.length;Z++){var ne=q[Z];q[Z]=[360*(ne.x+v)/_-180,360/Math.PI*Math.atan(Math.exp((180-360*(ne.y+b)/_)*Math.PI/180))-90]}}switch(this.type){case 1:var O=[];for(h=0;h<k.length;h++)O[h]=k[h][0];D(k=O);break;case 2:for(h=0;h<k.length;h++)D(k[h]);break;case 3:for(k=function(q){var Z=q.length;if(Z<=1)return[q];for(var ne,xe,be=[],Be=0;Be<Z;Be++){var ke=v_(q[Be]);ke!==0&&(xe===void 0&&(xe=ke<0),xe===ke<0?(ne&&be.push(ne),ne=[q[Be]]):ne.push(q[Be]))}return ne&&be.push(ne),be}(k),h=0;h<k.length;h++)for(d=0;d<k[h].length;d++)D(k[h][d])}k.length===1?k=k[0]:I="Multi"+I;var G={type:"Feature",geometry:{type:I,coordinates:k},properties:this.properties};return"id"in this&&(G.id=this.id),G};var w_=Wd,qd=Zd;function Zd(i,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(b_,this,t),this.length=this._features.length}function b_(i,t,s){i===15?t.version=s.readVarint():i===1?t.name=s.readString():i===5?t.extent=s.readVarint():i===2?t._features.push(s.pos):i===3?t._keys.push(s.readString()):i===4&&t._values.push(function(h){for(var d=null,_=h.readVarint()+h.pos;h.pos<_;){var v=h.readVarint()>>3;d=v===1?h.readString():v===2?h.readFloat():v===3?h.readDouble():v===4?h.readVarint64():v===5?h.readVarint():v===6?h.readSVarint():v===7?h.readBoolean():null}return d}(s))}Zd.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var t=this._pbf.readVarint()+this._pbf.pos;return new w_(this._pbf,t,this.extent,this._keys,this._values)};var T_=qd;function E_(i,t,s){if(i===3){var h=new T_(s,s.readVarint()+s.pos);h.length&&(t[h.name]=h)}}bs.VectorTile=function(i,t){this.layers=i.readFields(E_,{},t)},bs.VectorTileFeature=Wd,bs.VectorTileLayer=qd;const S_=bs.VectorTileFeature.types,If=Math.pow(2,13);function vc(i,t,s,h,d,_,v,b){i.emplaceBack(t,s,2*Math.floor(h*If)+v,d*If*2,_*If*2,Math.round(b))}class Ff{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Et,this.centroidVertexArray=new vt,this.indexArray=new Fa,this.programConfigurations=new gn(t.layers,t.zoom),this.segments=new Vr,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,h){this.features=[],this.hasPattern=kf("fill-extrusion",this.layers,s);for(const{feature:d,id:_,index:v,sourceLayerIndex:b}of t){const k=this.layers[0]._featureFilter.needGeometry,I=ao(d,k);if(!this.layers[0]._featureFilter.filter(new Ur(this.zoom),I,h))continue;const D={id:_,sourceLayerIndex:b,index:v,geometry:k?I.geometry:ro(d),properties:d.properties,type:d.type,patterns:{}};this.hasPattern?this.features.push(Cf("fill-extrusion",this.layers,D,this.zoom,s)):this.addFeature(D,D.geometry,v,h,{}),s.featureIndex.insert(d,D.geometry,v,b,this.index,!0)}}addFeatures(t,s,h){for(const d of this.features){const{geometry:_}=d;this.addFeature(d,_,d.index,s,h)}}update(t,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,h)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,x_),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,g_.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,s,h,d,_){const v={x:0,y:0,vertexCount:0};for(const b of Sf(s,500)){let k=0;for(const Z of b)k+=Z.length;let I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const Z of b){if(Z.length===0||C_(Z))continue;let ne=0;for(let xe=0;xe<Z.length;xe++){const be=Z[xe];if(xe>=1){const Be=Z[xe-1];if(!k_(be,Be)){I.vertexLength+4>Vr.MAX_VERTEX_ARRAY_LENGTH&&(I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ke=be.sub(Be)._perp()._unit(),Ne=Be.dist(be);ne+Ne>32768&&(ne=0),vc(this.layoutVertexArray,be.x,be.y,ke.x,ke.y,0,0,ne),vc(this.layoutVertexArray,be.x,be.y,ke.x,ke.y,0,1,ne),v.x+=2*be.x,v.y+=2*be.y,v.vertexCount+=2,ne+=Ne,vc(this.layoutVertexArray,Be.x,Be.y,ke.x,ke.y,0,0,ne),vc(this.layoutVertexArray,Be.x,Be.y,ke.x,ke.y,0,1,ne),v.x+=2*Be.x,v.y+=2*Be.y,v.vertexCount+=2;const We=I.vertexLength;this.indexArray.emplaceBack(We,We+2,We+1),this.indexArray.emplaceBack(We+1,We+2,We+3),I.vertexLength+=4,I.primitiveLength+=2}}}}if(I.vertexLength+k>Vr.MAX_VERTEX_ARRAY_LENGTH&&(I=this.segments.prepareSegment(k,this.layoutVertexArray,this.indexArray)),S_[t.type]!=="Polygon")continue;const D=[],O=[],G=I.vertexLength;for(const Z of b)if(Z.length!==0){Z!==b[0]&&O.push(D.length/2);for(let ne=0;ne<Z.length;ne++){const xe=Z[ne];vc(this.layoutVertexArray,xe.x,xe.y,0,0,1,1,0),v.x+=xe.x,v.y+=xe.y,v.vertexCount+=1,D.push(xe.x),D.push(xe.y)}}const q=$d(D,O);for(let Z=0;Z<q.length;Z+=3)this.indexArray.emplaceBack(G+q[Z],G+q[Z+2],G+q[Z+1]);I.primitiveLength+=q.length/3,I.vertexLength+=k}for(let b=0;b<v.vertexCount;b++)this.centroidVertexArray.emplaceBack(Math.floor(v.x/v.vertexCount),Math.floor(v.y/v.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,h,_,d)}}function k_(i,t){return i.x===t.x&&(i.x<0||i.x>ha)||i.y===t.y&&(i.y<0||i.y>ha)}function C_(i){return i.every(t=>t.x<0)||i.every(t=>t.x>ha)||i.every(t=>t.y<0)||i.every(t=>t.y>ha)}let Xd;Dt("FillExtrusionBucket",Ff,{omit:["layers","features"]});var A_={get paint(){return Xd=Xd||new oa({"fill-extrusion-opacity":new $t(qe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Wt(qe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new $t(qe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new $t(qe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Qs(qe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Wt(qe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Wt(qe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new $t(qe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class I_ extends Ri{constructor(t){super(t,A_)}createBucket(t){return new Ff(t)}queryRadius(){return Xu(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,s,h,d,_,v,b,k){const I=Ku(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),v.angle,b),D=this.paint.get("fill-extrusion-height").evaluate(s,h),O=this.paint.get("fill-extrusion-base").evaluate(s,h),G=function(Z,ne,xe,be){const Be=[];for(const ke of Z){const Ne=[ke.x,ke.y,0,1];Yu(Ne,Ne,ne),Be.push(new M(Ne[0]/Ne[3],Ne[1]/Ne[3]))}return Be}(I,k),q=function(Z,ne,xe,be){const Be=[],ke=[],Ne=be[8]*ne,We=be[9]*ne,st=be[10]*ne,At=be[11]*ne,Bt=be[8]*xe,kt=be[9]*xe,St=be[10]*xe,bt=be[11]*xe;for(const Lt of Z){const Tt=[],gt=[];for(const jt of Lt){const Ut=jt.x,hr=jt.y,$r=be[0]*Ut+be[4]*hr+be[12],Gr=be[1]*Ut+be[5]*hr+be[13],ya=be[2]*Ut+be[6]*hr+be[14],Bi=be[3]*Ut+be[7]*hr+be[15],ii=ya+st,fa=Bi+At,Ma=$r+Bt,Ua=Gr+kt,ni=ya+St,si=Bi+bt,va=new M(($r+Ne)/fa,(Gr+We)/fa);va.z=ii/fa,Tt.push(va);const wa=new M(Ma/si,Ua/si);wa.z=ni/si,gt.push(wa)}Be.push(Tt),ke.push(gt)}return[Be,ke]}(d,O,D,k);return function(Z,ne,xe){let be=1/0;kd(xe,ne)&&(be=Kd(xe,ne[0]));for(let Be=0;Be<ne.length;Be++){const ke=ne[Be],Ne=Z[Be];for(let We=0;We<ke.length-1;We++){const st=ke[We],At=[st,ke[We+1],Ne[We+1],Ne[We],st];Sd(xe,At)&&(be=Math.min(be,Kd(xe,At)))}}return be!==1/0&&be}(q[0],q[1],G)}}function wc(i,t){return i.x*t.x+i.y*t.y}function Kd(i,t){if(i.length===1){let s=0;const h=t[s++];let d;for(;!d||h.equals(d);)if(d=t[s++],!d)return 1/0;for(;s<t.length;s++){const _=t[s],v=i[0],b=d.sub(h),k=_.sub(h),I=v.sub(h),D=wc(b,b),O=wc(b,k),G=wc(k,k),q=wc(I,b),Z=wc(I,k),ne=D*G-O*O,xe=(G*q-O*Z)/ne,be=(D*Z-O*q)/ne,Be=h.z*(1-xe-be)+d.z*xe+_.z*be;if(isFinite(Be))return Be}return 1/0}{let s=1/0;for(const h of t)s=Math.min(s,h.z);return s}}const F_=Zr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:P_}=F_,M_=Zr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:D_}=M_,L_=bs.VectorTileFeature.types,R_=Math.cos(Math.PI/180*37.5),Yd=Math.pow(2,14)/.5;class Pf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new qt,this.layoutVertexArray2=new zt,this.indexArray=new Fa,this.programConfigurations=new gn(t.layers,t.zoom),this.segments=new Vr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,h){this.hasPattern=kf("line",this.layers,s);const d=this.layers[0].layout.get("line-sort-key"),_=!d.isConstant(),v=[];for(const{feature:b,id:k,index:I,sourceLayerIndex:D}of t){const O=this.layers[0]._featureFilter.needGeometry,G=ao(b,O);if(!this.layers[0]._featureFilter.filter(new Ur(this.zoom),G,h))continue;const q=_?d.evaluate(G,{},h):void 0,Z={id:k,properties:b.properties,type:b.type,sourceLayerIndex:D,index:I,geometry:O?G.geometry:ro(b),patterns:{},sortKey:q};v.push(Z)}_&&v.sort((b,k)=>b.sortKey-k.sortKey);for(const b of v){const{geometry:k,index:I,sourceLayerIndex:D}=b;if(this.hasPattern){const O=Cf("line",this.layers,b,this.zoom,s);this.patternFeatures.push(O)}else this.addFeature(b,k,I,h,{});s.featureIndex.insert(t[I].feature,k,I,D,this.index)}}update(t,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,h)}addFeatures(t,s,h){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,s,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,D_)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,P_),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,s,h,d,_){const v=this.layers[0].layout,b=v.get("line-join").evaluate(t,{}),k=v.get("line-cap"),I=v.get("line-miter-limit"),D=v.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const O of s)this.addLine(O,t,b,k,I,D);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,h,_,d)}addLine(t,s,h,d,_,v){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let be=0;be<t.length-1;be++)this.totalDistance+=t[be].dist(t[be+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const b=L_[s.type]==="Polygon";let k=t.length;for(;k>=2&&t[k-1].equals(t[k-2]);)k--;let I=0;for(;I<k-1&&t[I].equals(t[I+1]);)I++;if(k<(b?3:2))return;h==="bevel"&&(_=1.05);const D=this.overscaling<=16?15*ha/(512*this.overscaling):0,O=this.segments.prepareSegment(10*k,this.layoutVertexArray,this.indexArray);let G,q,Z,ne,xe;this.e1=this.e2=-1,b&&(G=t[k-2],xe=t[I].sub(G)._unit()._perp());for(let be=I;be<k;be++){if(Z=be===k-1?b?t[I+1]:void 0:t[be+1],Z&&t[be].equals(Z))continue;xe&&(ne=xe),G&&(q=G),G=t[be],xe=Z?Z.sub(G)._unit()._perp():ne,ne=ne||xe;let Be=ne.add(xe);Be.x===0&&Be.y===0||Be._unit();const ke=ne.x*xe.x+ne.y*xe.y,Ne=Be.x*xe.x+Be.y*xe.y,We=Ne!==0?1/Ne:1/0,st=2*Math.sqrt(2-2*Ne),At=Ne<R_&&q&&Z,Bt=ne.x*xe.y-ne.y*xe.x>0;if(At&&be>I){const bt=G.dist(q);if(bt>2*D){const Lt=G.sub(G.sub(q)._mult(D/bt)._round());this.updateDistance(q,Lt),this.addCurrentVertex(Lt,ne,0,0,O),q=Lt}}const kt=q&&Z;let St=kt?h:b?"butt":d;if(kt&&St==="round"&&(We<v?St="miter":We<=2&&(St="fakeround")),St==="miter"&&We>_&&(St="bevel"),St==="bevel"&&(We>2&&(St="flipbevel"),We<_&&(St="miter")),q&&this.updateDistance(q,G),St==="miter")Be._mult(We),this.addCurrentVertex(G,Be,0,0,O);else if(St==="flipbevel"){if(We>100)Be=xe.mult(-1);else{const bt=We*ne.add(xe).mag()/ne.sub(xe).mag();Be._perp()._mult(bt*(Bt?-1:1))}this.addCurrentVertex(G,Be,0,0,O),this.addCurrentVertex(G,Be.mult(-1),0,0,O)}else if(St==="bevel"||St==="fakeround"){const bt=-Math.sqrt(We*We-1),Lt=Bt?bt:0,Tt=Bt?0:bt;if(q&&this.addCurrentVertex(G,ne,Lt,Tt,O),St==="fakeround"){const gt=Math.round(180*st/Math.PI/20);for(let jt=1;jt<gt;jt++){let Ut=jt/gt;if(Ut!==.5){const $r=Ut-.5;Ut+=Ut*$r*(Ut-1)*((1.0904+ke*(ke*(3.55645-1.43519*ke)-3.2452))*$r*$r+(.848013+ke*(.215638*ke-1.06021)))}const hr=xe.sub(ne)._mult(Ut)._add(ne)._unit()._mult(Bt?-1:1);this.addHalfVertex(G,hr.x,hr.y,!1,Bt,0,O)}}Z&&this.addCurrentVertex(G,xe,-Lt,-Tt,O)}else if(St==="butt")this.addCurrentVertex(G,Be,0,0,O);else if(St==="square"){const bt=q?1:-1;this.addCurrentVertex(G,Be,bt,bt,O)}else St==="round"&&(q&&(this.addCurrentVertex(G,ne,0,0,O),this.addCurrentVertex(G,ne,1,1,O,!0)),Z&&(this.addCurrentVertex(G,xe,-1,-1,O,!0),this.addCurrentVertex(G,xe,0,0,O)));if(At&&be<k-1){const bt=G.dist(Z);if(bt>2*D){const Lt=G.add(Z.sub(G)._mult(D/bt)._round());this.updateDistance(G,Lt),this.addCurrentVertex(Lt,xe,0,0,O),G=Lt}}}}addCurrentVertex(t,s,h,d,_,v=!1){const b=s.y*d-s.x,k=-s.y-s.x*d;this.addHalfVertex(t,s.x+s.y*h,s.y-s.x*h,v,!1,h,_),this.addHalfVertex(t,b,k,v,!0,-d,_),this.distance>Yd/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,s,h,d,_,v))}addHalfVertex({x:t,y:s},h,d,_,v,b,k){const I=.5*(this.lineClips?this.scaledDistance*(Yd-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(_?1:0),(s<<1)+(v?1:0),Math.round(63*h)+128,Math.round(63*d)+128,1+(b===0?0:b<0?-1:1)|(63&I)<<2,I>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const D=k.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),k.primitiveLength++),v?this.e2=D:this.e1=D}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,s){this.distance+=t.dist(s),this.updateScaledDistance()}}let Jd,Qd;Dt("LineBucket",Pf,{omit:["layers","patternFeatures"]});var ep={get paint(){return Qd=Qd||new oa({"line-opacity":new Wt(qe.paint_line["line-opacity"]),"line-color":new Wt(qe.paint_line["line-color"]),"line-translate":new $t(qe.paint_line["line-translate"]),"line-translate-anchor":new $t(qe.paint_line["line-translate-anchor"]),"line-width":new Wt(qe.paint_line["line-width"]),"line-gap-width":new Wt(qe.paint_line["line-gap-width"]),"line-offset":new Wt(qe.paint_line["line-offset"]),"line-blur":new Wt(qe.paint_line["line-blur"]),"line-dasharray":new ic(qe.paint_line["line-dasharray"]),"line-pattern":new Qs(qe.paint_line["line-pattern"]),"line-gradient":new nc(qe.paint_line["line-gradient"])})},get layout(){return Jd=Jd||new oa({"line-cap":new $t(qe.layout_line["line-cap"]),"line-join":new Wt(qe.layout_line["line-join"]),"line-miter-limit":new $t(qe.layout_line["line-miter-limit"]),"line-round-limit":new $t(qe.layout_line["line-round-limit"]),"line-sort-key":new Wt(qe.layout_line["line-sort-key"])})}};class O_ extends Wt{possiblyEvaluate(t,s){return s=new Ur(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,zoomHistory:s.zoomHistory,transition:s.transition}),super.possiblyEvaluate(t,s)}evaluate(t,s,h,d){return s=ze({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(t,s,h,d)}}let rh;class B_ extends Ri{constructor(t){super(t,ep),this.gradientVersion=0,rh||(rh=new O_(ep.paint.properties["line-width"].specification),rh.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const s=this.gradientExpression();this.stepInterpolant=!!function(h){return h._styleExpression!==void 0}(s)&&s._styleExpression.expression instanceof In,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,s){super.recalculate(t,s),this.paint._values["line-floorwidth"]=rh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Pf(t)}queryRadius(t){const s=t,h=tp(dc("line-width",this,s),dc("line-gap-width",this,s)),d=dc("line-offset",this,s);return h/2+Math.abs(d)+Xu(this.paint.get("line-translate"))}queryIntersectsFeature(t,s,h,d,_,v,b){const k=Ku(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),v.angle,b),I=b/2*tp(this.paint.get("line-width").evaluate(s,h),this.paint.get("line-gap-width").evaluate(s,h)),D=this.paint.get("line-offset").evaluate(s,h);return D&&(d=function(O,G){const q=[];for(let Z=0;Z<O.length;Z++){const ne=O[Z],xe=[];for(let be=0;be<ne.length;be++){const Be=ne[be-1],ke=ne[be],Ne=ne[be+1],We=be===0?new M(0,0):ke.sub(Be)._unit()._perp(),st=be===ne.length-1?new M(0,0):Ne.sub(ke)._unit()._perp(),At=We._add(st)._unit(),Bt=At.x*st.x+At.y*st.y;Bt!==0&&At._mult(1/Bt),xe.push(At._mult(G)._add(ke))}q.push(xe)}return q}(d,D*b)),function(O,G,q){for(let Z=0;Z<G.length;Z++){const ne=G[Z];if(O.length>=3){for(let xe=0;xe<ne.length;xe++)if(el(O,ne[xe]))return!0}if(jx(O,ne,q))return!0}return!1}(k,d,I)}isTileClipped(){return!0}}function tp(i,t){return t>0?t+2*i:i}const z_=Zr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),N_=Zr([{name:"a_projected_pos",components:3,type:"Float32"}],4);Zr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const U_=Zr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Zr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const rp=Zr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),V_=Zr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function $_(i,t,s){return i.sections.forEach(h=>{h.text=function(d,_,v){const b=_.layout.get("text-transform").evaluate(v,{});return b==="uppercase"?d=d.toLocaleUpperCase():b==="lowercase"&&(d=d.toLocaleLowerCase()),_i.applyArabicShaping&&(d=_i.applyArabicShaping(d)),d}(h.text,t,s)}),i}Zr([{name:"triangle",components:3,type:"Uint16"}]),Zr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Zr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Zr([{type:"Float32",name:"offsetX"}]),Zr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Zr([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const bc={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var _a=24,ap=Or,ip=function(i,t,s,h,d){var _,v,b=8*d-h-1,k=(1<<b)-1,I=k>>1,D=-7,O=s?d-1:0,G=s?-1:1,q=i[t+O];for(O+=G,_=q&(1<<-D)-1,q>>=-D,D+=b;D>0;_=256*_+i[t+O],O+=G,D-=8);for(v=_&(1<<-D)-1,_>>=-D,D+=h;D>0;v=256*v+i[t+O],O+=G,D-=8);if(_===0)_=1-I;else{if(_===k)return v?NaN:1/0*(q?-1:1);v+=Math.pow(2,h),_-=I}return(q?-1:1)*v*Math.pow(2,_-h)},np=function(i,t,s,h,d,_){var v,b,k,I=8*_-d-1,D=(1<<I)-1,O=D>>1,G=d===23?Math.pow(2,-24)-Math.pow(2,-77):0,q=h?0:_-1,Z=h?1:-1,ne=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(b=isNaN(t)?1:0,v=D):(v=Math.floor(Math.log(t)/Math.LN2),t*(k=Math.pow(2,-v))<1&&(v--,k*=2),(t+=v+O>=1?G/k:G*Math.pow(2,1-O))*k>=2&&(v++,k/=2),v+O>=D?(b=0,v=D):v+O>=1?(b=(t*k-1)*Math.pow(2,d),v+=O):(b=t*Math.pow(2,O-1)*Math.pow(2,d),v=0));d>=8;i[s+q]=255&b,q+=Z,b/=256,d-=8);for(v=v<<d|b,I+=d;I>0;i[s+q]=255&v,q+=Z,v/=256,I-=8);i[s+q-Z]|=128*ne};function Or(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Or.Varint=0,Or.Fixed64=1,Or.Bytes=2,Or.Fixed32=5;var Mf=4294967296,sp=1/Mf,op=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Qn(i){return i.type===Or.Bytes?i.readVarint()+i.pos:i.pos+1}function il(i,t,s){return s?4294967296*t+(i>>>0):4294967296*(t>>>0)+(i>>>0)}function lp(i,t,s){var h=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));s.realloc(h);for(var d=s.pos-1;d>=i;d--)s.buf[d+h]=s.buf[d]}function j_(i,t){for(var s=0;s<i.length;s++)t.writeVarint(i[s])}function G_(i,t){for(var s=0;s<i.length;s++)t.writeSVarint(i[s])}function H_(i,t){for(var s=0;s<i.length;s++)t.writeFloat(i[s])}function W_(i,t){for(var s=0;s<i.length;s++)t.writeDouble(i[s])}function q_(i,t){for(var s=0;s<i.length;s++)t.writeBoolean(i[s])}function Z_(i,t){for(var s=0;s<i.length;s++)t.writeFixed32(i[s])}function X_(i,t){for(var s=0;s<i.length;s++)t.writeSFixed32(i[s])}function K_(i,t){for(var s=0;s<i.length;s++)t.writeFixed64(i[s])}function Y_(i,t){for(var s=0;s<i.length;s++)t.writeSFixed64(i[s])}function ah(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+16777216*i[t+3]}function nl(i,t,s){i[s]=t,i[s+1]=t>>>8,i[s+2]=t>>>16,i[s+3]=t>>>24}function cp(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+(i[t+3]<<24)}Or.prototype={destroy:function(){this.buf=null},readFields:function(i,t,s){for(s=s||this.length;this.pos<s;){var h=this.readVarint(),d=h>>3,_=this.pos;this.type=7&h,i(d,t,this),this.pos===_&&this.skip(h)}return t},readMessage:function(i,t){return this.readFields(i,t,this.readVarint()+this.pos)},readFixed32:function(){var i=ah(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=cp(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=ah(this.buf,this.pos)+ah(this.buf,this.pos+4)*Mf;return this.pos+=8,i},readSFixed64:function(){var i=ah(this.buf,this.pos)+cp(this.buf,this.pos+4)*Mf;return this.pos+=8,i},readFloat:function(){var i=ip(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=ip(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var t,s,h=this.buf;return t=127&(s=h[this.pos++]),s<128?t:(t|=(127&(s=h[this.pos++]))<<7,s<128?t:(t|=(127&(s=h[this.pos++]))<<14,s<128?t:(t|=(127&(s=h[this.pos++]))<<21,s<128?t:function(d,_,v){var b,k,I=v.buf;if(b=(112&(k=I[v.pos++]))>>4,k<128||(b|=(127&(k=I[v.pos++]))<<3,k<128)||(b|=(127&(k=I[v.pos++]))<<10,k<128)||(b|=(127&(k=I[v.pos++]))<<17,k<128)||(b|=(127&(k=I[v.pos++]))<<24,k<128)||(b|=(1&(k=I[v.pos++]))<<31,k<128))return il(d,b,_);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(s=h[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,t=this.pos;return this.pos=i,i-t>=12&&op?function(s,h,d){return op.decode(s.subarray(h,d))}(this.buf,t,i):function(s,h,d){for(var _="",v=h;v<d;){var b,k,I,D=s[v],O=null,G=D>239?4:D>223?3:D>191?2:1;if(v+G>d)break;G===1?D<128&&(O=D):G===2?(192&(b=s[v+1]))==128&&(O=(31&D)<<6|63&b)<=127&&(O=null):G===3?(k=s[v+2],(192&(b=s[v+1]))==128&&(192&k)==128&&((O=(15&D)<<12|(63&b)<<6|63&k)<=2047||O>=55296&&O<=57343)&&(O=null)):G===4&&(k=s[v+2],I=s[v+3],(192&(b=s[v+1]))==128&&(192&k)==128&&(192&I)==128&&((O=(15&D)<<18|(63&b)<<12|(63&k)<<6|63&I)<=65535||O>=1114112)&&(O=null)),O===null?(O=65533,G=1):O>65535&&(O-=65536,_+=String.fromCharCode(O>>>10&1023|55296),O=56320|1023&O),_+=String.fromCharCode(O),v+=G}return _}(this.buf,t,i)},readBytes:function(){var i=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,i);return this.pos=i,t},readPackedVarint:function(i,t){if(this.type!==Or.Bytes)return i.push(this.readVarint(t));var s=Qn(this);for(i=i||[];this.pos<s;)i.push(this.readVarint(t));return i},readPackedSVarint:function(i){if(this.type!==Or.Bytes)return i.push(this.readSVarint());var t=Qn(this);for(i=i||[];this.pos<t;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Or.Bytes)return i.push(this.readBoolean());var t=Qn(this);for(i=i||[];this.pos<t;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Or.Bytes)return i.push(this.readFloat());var t=Qn(this);for(i=i||[];this.pos<t;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Or.Bytes)return i.push(this.readDouble());var t=Qn(this);for(i=i||[];this.pos<t;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Or.Bytes)return i.push(this.readFixed32());var t=Qn(this);for(i=i||[];this.pos<t;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Or.Bytes)return i.push(this.readSFixed32());var t=Qn(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Or.Bytes)return i.push(this.readFixed64());var t=Qn(this);for(i=i||[];this.pos<t;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Or.Bytes)return i.push(this.readSFixed64());var t=Qn(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed64());return i},skip:function(i){var t=7&i;if(t===Or.Varint)for(;this.buf[this.pos++]>127;);else if(t===Or.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Or.Fixed32)this.pos+=4;else{if(t!==Or.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(i,t){this.writeVarint(i<<3|t)},realloc:function(i){for(var t=this.length||16;t<this.pos+i;)t*=2;if(t!==this.length){var s=new Uint8Array(t);s.set(this.buf),this.buf=s,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),nl(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),nl(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),nl(this.buf,-1&i,this.pos),nl(this.buf,Math.floor(i*sp),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),nl(this.buf,-1&i,this.pos),nl(this.buf,Math.floor(i*sp),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(t,s){var h,d;if(t>=0?(h=t%4294967296|0,d=t/4294967296|0):(d=~(-t/4294967296),4294967295^(h=~(-t%4294967296))?h=h+1|0:(h=0,d=d+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),function(_,v,b){b.buf[b.pos++]=127&_|128,_>>>=7,b.buf[b.pos++]=127&_|128,_>>>=7,b.buf[b.pos++]=127&_|128,_>>>=7,b.buf[b.pos++]=127&_|128,b.buf[b.pos]=127&(_>>>=7)}(h,0,s),function(_,v){var b=(7&_)<<4;v.buf[v.pos++]|=b|((_>>>=3)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_)))))}(d,s)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var t=this.pos;this.pos=function(h,d,_){for(var v,b,k=0;k<d.length;k++){if((v=d.charCodeAt(k))>55295&&v<57344){if(!b){v>56319||k+1===d.length?(h[_++]=239,h[_++]=191,h[_++]=189):b=v;continue}if(v<56320){h[_++]=239,h[_++]=191,h[_++]=189,b=v;continue}v=b-55296<<10|v-56320|65536,b=null}else b&&(h[_++]=239,h[_++]=191,h[_++]=189,b=null);v<128?h[_++]=v:(v<2048?h[_++]=v>>6|192:(v<65536?h[_++]=v>>12|224:(h[_++]=v>>18|240,h[_++]=v>>12&63|128),h[_++]=v>>6&63|128),h[_++]=63&v|128)}return _}(this.buf,i,this.pos);var s=this.pos-t;s>=128&&lp(t,s,this),this.pos=t-1,this.writeVarint(s),this.pos+=s},writeFloat:function(i){this.realloc(4),np(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),np(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var t=i.length;this.writeVarint(t),this.realloc(t);for(var s=0;s<t;s++)this.buf[this.pos++]=i[s]},writeRawMessage:function(i,t){this.pos++;var s=this.pos;i(t,this);var h=this.pos-s;h>=128&&lp(s,h,this),this.pos=s-1,this.writeVarint(h),this.pos+=h},writeMessage:function(i,t,s){this.writeTag(i,Or.Bytes),this.writeRawMessage(t,s)},writePackedVarint:function(i,t){t.length&&this.writeMessage(i,j_,t)},writePackedSVarint:function(i,t){t.length&&this.writeMessage(i,G_,t)},writePackedBoolean:function(i,t){t.length&&this.writeMessage(i,q_,t)},writePackedFloat:function(i,t){t.length&&this.writeMessage(i,H_,t)},writePackedDouble:function(i,t){t.length&&this.writeMessage(i,W_,t)},writePackedFixed32:function(i,t){t.length&&this.writeMessage(i,Z_,t)},writePackedSFixed32:function(i,t){t.length&&this.writeMessage(i,X_,t)},writePackedFixed64:function(i,t){t.length&&this.writeMessage(i,K_,t)},writePackedSFixed64:function(i,t){t.length&&this.writeMessage(i,Y_,t)},writeBytesField:function(i,t){this.writeTag(i,Or.Bytes),this.writeBytes(t)},writeFixed32Field:function(i,t){this.writeTag(i,Or.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(i,t){this.writeTag(i,Or.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(i,t){this.writeTag(i,Or.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(i,t){this.writeTag(i,Or.Fixed64),this.writeSFixed64(t)},writeVarintField:function(i,t){this.writeTag(i,Or.Varint),this.writeVarint(t)},writeSVarintField:function(i,t){this.writeTag(i,Or.Varint),this.writeSVarint(t)},writeStringField:function(i,t){this.writeTag(i,Or.Bytes),this.writeString(t)},writeFloatField:function(i,t){this.writeTag(i,Or.Fixed32),this.writeFloat(t)},writeDoubleField:function(i,t){this.writeTag(i,Or.Fixed64),this.writeDouble(t)},writeBooleanField:function(i,t){this.writeVarintField(i,!!t)}};var Df=w(ap);const Lf=3;function J_(i,t,s){i===1&&s.readMessage(Q_,t)}function Q_(i,t,s){if(i===3){const{id:h,bitmap:d,width:_,height:v,left:b,top:k,advance:I}=s.readMessage(ey,{});t.push({id:h,bitmap:new mc({width:_+2*Lf,height:v+2*Lf},d),metrics:{width:_,height:v,left:b,top:k,advance:I}})}}function ey(i,t,s){i===1?t.id=s.readVarint():i===2?t.bitmap=s.readBytes():i===3?t.width=s.readVarint():i===4?t.height=s.readVarint():i===5?t.left=s.readSVarint():i===6?t.top=s.readSVarint():i===7&&(t.advance=s.readVarint())}const up=Lf;function hp(i){let t=0,s=0;for(const v of i)t+=v.w*v.h,s=Math.max(s,v.w);i.sort((v,b)=>b.h-v.h);const h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),s),h:1/0}];let d=0,_=0;for(const v of i)for(let b=h.length-1;b>=0;b--){const k=h[b];if(!(v.w>k.w||v.h>k.h)){if(v.x=k.x,v.y=k.y,_=Math.max(_,v.y+v.h),d=Math.max(d,v.x+v.w),v.w===k.w&&v.h===k.h){const I=h.pop();b<h.length&&(h[b]=I)}else v.h===k.h?(k.x+=v.w,k.w-=v.w):v.w===k.w?(k.y+=v.h,k.h-=v.h):(h.push({x:k.x+v.w,y:k.y,w:k.w-v.w,h:v.h}),k.y+=v.h,k.h-=v.h);break}}return{w:d,h:_,fill:t/(d*_)||0}}const vi=1;class Rf{constructor(t,{pixelRatio:s,version:h,stretchX:d,stretchY:_,content:v}){this.paddedRect=t,this.pixelRatio=s,this.stretchX=d,this.stretchY=_,this.content=v,this.version=h}get tl(){return[this.paddedRect.x+vi,this.paddedRect.y+vi]}get br(){return[this.paddedRect.x+this.paddedRect.w-vi,this.paddedRect.y+this.paddedRect.h-vi]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*vi)/this.pixelRatio,(this.paddedRect.h-2*vi)/this.pixelRatio]}}class fp{constructor(t,s){const h={},d={};this.haveRenderCallbacks=[];const _=[];this.addImages(t,h,_),this.addImages(s,d,_);const{w:v,h:b}=hp(_),k=new Ui({width:v||1,height:b||1});for(const I in t){const D=t[I],O=h[I].paddedRect;Ui.copy(D.data,k,{x:0,y:0},{x:O.x+vi,y:O.y+vi},D.data)}for(const I in s){const D=s[I],O=d[I].paddedRect,G=O.x+vi,q=O.y+vi,Z=D.data.width,ne=D.data.height;Ui.copy(D.data,k,{x:0,y:0},{x:G,y:q},D.data),Ui.copy(D.data,k,{x:0,y:ne-1},{x:G,y:q-1},{width:Z,height:1}),Ui.copy(D.data,k,{x:0,y:0},{x:G,y:q+ne},{width:Z,height:1}),Ui.copy(D.data,k,{x:Z-1,y:0},{x:G-1,y:q},{width:1,height:ne}),Ui.copy(D.data,k,{x:0,y:0},{x:G+Z,y:q},{width:1,height:ne})}this.image=k,this.iconPositions=h,this.patternPositions=d}addImages(t,s,h){for(const d in t){const _=t[d],v={x:0,y:0,w:_.data.width+2*vi,h:_.data.height+2*vi};h.push(v),s[d]=new Rf(v,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(d)}}patchUpdatedImages(t,s){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const h in t.updatedImages)this.patchUpdatedImage(this.iconPositions[h],t.getImage(h),s),this.patchUpdatedImage(this.patternPositions[h],t.getImage(h),s)}patchUpdatedImage(t,s,h){if(!t||!s||t.version===s.version)return;t.version=s.version;const[d,_]=t.tl;h.update(s.data,void 0,{x:d,y:_})}}var Ts;Dt("ImagePosition",Rf),Dt("ImageAtlas",fp),o.ai=void 0,(Ts=o.ai||(o.ai={}))[Ts.none=0]="none",Ts[Ts.horizontal=1]="horizontal",Ts[Ts.vertical=2]="vertical",Ts[Ts.horizontalOnly=3]="horizontalOnly";const Tc=-17;class Ec{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,s){const h=new Ec;return h.scale=t||1,h.fontStack=s,h}static forImage(t){const s=new Ec;return s.imageName=t,s}}class sl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,s){const h=new sl;for(let d=0;d<t.sections.length;d++){const _=t.sections[d];_.image?h.addImageSection(_):h.addTextSection(_,s)}return h}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let s="";for(let h=0;h<t.length;h++){const d=t.charCodeAt(h+1)||null,_=t.charCodeAt(h-1)||null;s+=d&&zu(d)&&!bc[t[h+1]]||_&&zu(_)&&!bc[t[h-1]]||!bc[t[h]]?t[h]:bc[t[h]]}return s}(this.text)}trim(){let t=0;for(let h=0;h<this.text.length&&nh[this.text.charCodeAt(h)];h++)t++;let s=this.text.length;for(let h=this.text.length-1;h>=0&&h>=t&&nh[this.text.charCodeAt(h)];h--)s--;this.text=this.text.substring(t,s),this.sectionIndex=this.sectionIndex.slice(t,s)}substring(t,s){const h=new sl;return h.text=this.text.substring(t,s),h.sectionIndex=this.sectionIndex.slice(t,s),h.sections=this.sections,h}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,s)=>Math.max(t,this.sections[s].scale),0)}addTextSection(t,s){this.text+=t.text,this.sections.push(Ec.forText(t.scale,t.fontStack||s));const h=this.sections.length-1;for(let d=0;d<t.text.length;++d)this.sectionIndex.push(h)}addImageSection(t){const s=t.image?t.image.name:"";if(s.length===0)return void ft("Can't add FormattedSection with an empty image.");const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCharCode(h),this.sections.push(Ec.forImage(s)),this.sectionIndex.push(this.sections.length-1)):ft("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function ih(i,t,s,h,d,_,v,b,k,I,D,O,G,q,Z,ne){const xe=sl.fromFeature(i,d);let be;O===o.ai.vertical&&xe.verticalizePunctuation();const{processBidirectionalText:Be,processStyledBidirectionalText:ke}=_i;if(Be&&xe.sections.length===1){be=[];const st=Be(xe.toString(),Of(xe,I,_,t,h,q,Z));for(const At of st){const Bt=new sl;Bt.text=At,Bt.sections=xe.sections;for(let kt=0;kt<At.length;kt++)Bt.sectionIndex.push(0);be.push(Bt)}}else if(ke){be=[];const st=ke(xe.text,xe.sectionIndex,Of(xe,I,_,t,h,q,Z));for(const At of st){const Bt=new sl;Bt.text=At[0],Bt.sectionIndex=At[1],Bt.sections=xe.sections,be.push(Bt)}}else be=function(st,At){const Bt=[],kt=st.text;let St=0;for(const bt of At)Bt.push(st.substring(St,bt)),St=bt;return St<kt.length&&Bt.push(st.substring(St,kt.length)),Bt}(xe,Of(xe,I,_,t,h,q,Z));const Ne=[],We={positionedLines:Ne,text:xe.toString(),top:D[1],bottom:D[1],left:D[0],right:D[0],writingMode:O,iconsInText:!1,verticalizable:!1};return function(st,At,Bt,kt,St,bt,Lt,Tt,gt,jt,Ut,hr){let $r=0,Gr=Tc,ya=0,Bi=0;const ii=Tt==="right"?1:Tt==="left"?0:.5;let fa=0;for(const va of St){va.trim();const wa=va.getMaxScale(),qa=(wa-1)*_a,oi={positionedGlyphs:[],lineOffset:0};st.positionedLines[fa]=oi;const Za=oi.positionedGlyphs;let wi=0;if(!va.length()){Gr+=bt,++fa;continue}for(let ba=0;ba<va.length();ba++){const xr=va.getSection(ba),Xa=va.getSectionIndex(ba),Va=va.getCharCode(ba);let Ta=0,tn=null,xn=null,_n=null,es=_a;const rn=!(gt===o.ai.horizontal||!Ut&&!Kl(Va)||Ut&&(nh[Va]||(Ma=Va,Ct.Arabic(Ma)||Ct["Arabic Supplement"](Ma)||Ct["Arabic Extended-A"](Ma)||Ct["Arabic Presentation Forms-A"](Ma)||Ct["Arabic Presentation Forms-B"](Ma))));if(xr.imageName){const $i=kt[xr.imageName];if(!$i)continue;_n=xr.imageName,st.iconsInText=st.iconsInText||!0,xn=$i.paddedRect;const Ti=$i.displaySize;xr.scale=xr.scale*_a/hr,tn={width:Ti[0],height:Ti[1],left:vi,top:-up,advance:rn?Ti[1]:Ti[0]},Ta=qa+(_a-Ti[1]*xr.scale),es=tn.advance;const ts=rn?Ti[0]*xr.scale-_a*wa:Ti[1]*xr.scale-_a*wa;ts>0&&ts>wi&&(wi=ts)}else{const $i=Bt[xr.fontStack],Ti=$i&&$i[Va];if(Ti&&Ti.rect)xn=Ti.rect,tn=Ti.metrics;else{const ts=At[xr.fontStack],Ic=ts&&ts[Va];if(!Ic)continue;tn=Ic.metrics}Ta=(wa-xr.scale)*_a}rn?(st.verticalizable=!0,Za.push({glyph:Va,imageName:_n,x:$r,y:Gr+Ta,vertical:rn,scale:xr.scale,fontStack:xr.fontStack,sectionIndex:Xa,metrics:tn,rect:xn}),$r+=es*xr.scale+jt):(Za.push({glyph:Va,imageName:_n,x:$r,y:Gr+Ta,vertical:rn,scale:xr.scale,fontStack:xr.fontStack,sectionIndex:Xa,metrics:tn,rect:xn}),$r+=tn.advance*xr.scale+jt)}Za.length!==0&&(ya=Math.max($r-jt,ya),ay(Za,0,Za.length-1,ii,wi)),$r=0;const bi=bt*wa+wi;oi.lineOffset=Math.max(wi,qa),Gr+=bi,Bi=Math.max(bi,Bi),++fa}var Ma;const Ua=Gr-Tc,{horizontalAlign:ni,verticalAlign:si}=Bf(Lt);(function(va,wa,qa,oi,Za,wi,bi,ba,xr){const Xa=(wa-qa)*Za;let Va=0;Va=wi!==bi?-ba*oi-Tc:(-oi*xr+.5)*bi;for(const Ta of va)for(const tn of Ta.positionedGlyphs)tn.x+=Xa,tn.y+=Va})(st.positionedLines,ii,ni,si,ya,Bi,bt,Ua,St.length),st.top+=-si*Ua,st.bottom=st.top+Ua,st.left+=-ni*ya,st.right=st.left+ya}(We,t,s,h,be,v,b,k,O,I,G,ne),!function(st){for(const At of st)if(At.positionedGlyphs.length!==0)return!1;return!0}(Ne)&&We}const nh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},ty={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function dp(i,t,s,h,d,_){if(t.imageName){const v=h[t.imageName];return v?v.displaySize[0]*t.scale*_a/_+d:0}{const v=s[t.fontStack],b=v&&v[i];return b?b.metrics.advance*t.scale+d:0}}function pp(i,t,s,h){const d=Math.pow(i-t,2);return h?i<t?d/2:2*d:d+Math.abs(s)*s}function ry(i,t,s){let h=0;return i===10&&(h-=1e4),s&&(h+=150),i!==40&&i!==65288||(h+=50),t!==41&&t!==65289||(h+=50),h}function mp(i,t,s,h,d,_){let v=null,b=pp(t,s,d,_);for(const k of h){const I=pp(t-k.x,s,d,_)+k.badness;I<=b&&(v=k,b=I)}return{index:i,x:t,priorBreak:v,badness:b}}function gp(i){return i?gp(i.priorBreak).concat(i.index):[]}function Of(i,t,s,h,d,_,v){if(_!=="point")return[];if(!i)return[];const b=[],k=function(G,q,Z,ne,xe,be){let Be=0;for(let ke=0;ke<G.length();ke++){const Ne=G.getSection(ke);Be+=dp(G.getCharCode(ke),Ne,ne,xe,q,be)}return Be/Math.max(1,Math.ceil(Be/Z))}(i,t,s,h,d,v),I=i.text.indexOf("​")>=0;let D=0;for(let G=0;G<i.length();G++){const q=i.getSection(G),Z=i.getCharCode(G);if(nh[Z]||(D+=dp(Z,q,h,d,t,v)),G<i.length()-1){const ne=!((O=Z)<11904||!(Ct["Bopomofo Extended"](O)||Ct.Bopomofo(O)||Ct["CJK Compatibility Forms"](O)||Ct["CJK Compatibility Ideographs"](O)||Ct["CJK Compatibility"](O)||Ct["CJK Radicals Supplement"](O)||Ct["CJK Strokes"](O)||Ct["CJK Symbols and Punctuation"](O)||Ct["CJK Unified Ideographs Extension A"](O)||Ct["CJK Unified Ideographs"](O)||Ct["Enclosed CJK Letters and Months"](O)||Ct["Halfwidth and Fullwidth Forms"](O)||Ct.Hiragana(O)||Ct["Ideographic Description Characters"](O)||Ct["Kangxi Radicals"](O)||Ct["Katakana Phonetic Extensions"](O)||Ct.Katakana(O)||Ct["Vertical Forms"](O)||Ct["Yi Radicals"](O)||Ct["Yi Syllables"](O)));(ty[Z]||ne||q.imageName)&&b.push(mp(G+1,D,k,b,ry(Z,i.getCharCode(G+1),ne&&I),!1))}}var O;return gp(mp(i.length(),D,k,b,0,!0))}function Bf(i){let t=.5,s=.5;switch(i){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:t,verticalAlign:s}}function ay(i,t,s,h,d){if(!h&&!d)return;const _=i[s],v=(i[s].x+_.metrics.advance*_.scale)*h;for(let b=t;b<=s;b++)i[b].x-=v,i[b].y+=d}function iy(i,t,s){const{horizontalAlign:h,verticalAlign:d}=Bf(s),_=t[0]-i.displaySize[0]*h,v=t[1]-i.displaySize[1]*d;return{image:i,top:v,bottom:v+i.displaySize[1],left:_,right:_+i.displaySize[0]}}function xp(i,t,s,h,d,_){const v=i.image;let b;if(v.content){const xe=v.content,be=v.pixelRatio||1;b=[xe[0]/be,xe[1]/be,v.displaySize[0]-xe[2]/be,v.displaySize[1]-xe[3]/be]}const k=t.left*_,I=t.right*_;let D,O,G,q;s==="width"||s==="both"?(q=d[0]+k-h[3],O=d[0]+I+h[1]):(q=d[0]+(k+I-v.displaySize[0])/2,O=q+v.displaySize[0]);const Z=t.top*_,ne=t.bottom*_;return s==="height"||s==="both"?(D=d[1]+Z-h[0],G=d[1]+ne+h[2]):(D=d[1]+(Z+ne-v.displaySize[1])/2,G=D+v.displaySize[1]),{image:v,top:D,right:O,bottom:G,left:q,collisionPadding:b}}const Sc=255,Ln=128,Es=Sc*Ln;function _p(i,t){const{expression:s}=t;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new Ur(i+1))};if(s.kind==="source")return{kind:"source"};{const{zoomStops:h,interpolationType:d}=s;let _=0;for(;_<h.length&&h[_]<=i;)_++;_=Math.max(0,_-1);let v=_;for(;v<h.length&&h[v]<i+1;)v++;v=Math.min(h.length-1,v);const b=h[_],k=h[v];return s.kind==="composite"?{kind:"composite",minZoom:b,maxZoom:k,interpolationType:d}:{kind:"camera",minZoom:b,maxZoom:k,minSize:s.evaluate(new Ur(b)),maxSize:s.evaluate(new Ur(k)),interpolationType:d}}}function zf(i,t,s){let h="never";const d=i.get(t);return d?h=d:i.get(s)&&(h="always"),h}const ny=bs.VectorTileFeature.types,sy=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function sh(i,t,s,h,d,_,v,b,k,I,D,O,G){const q=b?Math.min(Es,Math.round(b[0])):0,Z=b?Math.min(Es,Math.round(b[1])):0;i.emplaceBack(t,s,Math.round(32*h),Math.round(32*d),_,v,(q<<1)+(k?1:0),Z,16*I,16*D,256*O,256*G)}function Nf(i,t,s){i.emplaceBack(t.x,t.y,s),i.emplaceBack(t.x,t.y,s),i.emplaceBack(t.x,t.y,s),i.emplaceBack(t.x,t.y,s)}function oy(i){for(const t of i.sections)if(hf(t.text))return!0;return!1}class Uf{constructor(t){this.layoutVertexArray=new dr,this.indexArray=new Fa,this.programConfigurations=t,this.segments=new Vr,this.dynamicLayoutVertexArray=new sr,this.opacityVertexArray=new mr,this.hasVisibleVertices=!1,this.placedSymbolArray=new Pe}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,s,h,d){this.isEmpty()||(h&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,z_.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,N_.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,sy,!0),this.opacityVertexBuffer.itemSize=1),(h||d)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Dt("SymbolBuffers",Uf);class Vf{constructor(t,s,h){this.layoutVertexArray=new t,this.layoutAttributes=s,this.indexArray=new h,this.segments=new Vr,this.collisionVertexArray=new zr}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,U_.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Dt("CollisionBuffers",Vf);class ol{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(v=>v.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=_f([]),this.placementViewportMatrix=_f([]);const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=_p(this.zoom,s["text-size"]),this.iconSizeData=_p(this.zoom,s["icon-size"]);const h=this.layers[0].layout,d=h.get("symbol-sort-key"),_=h.get("symbol-z-order");this.canOverlap=zf(h,"text-overlap","text-allow-overlap")!=="never"||zf(h,"icon-overlap","icon-allow-overlap")!=="never"||h.get("text-ignore-placement")||h.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&!d.isConstant(),this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,h.get("symbol-placement")==="point"&&(this.writingModes=h.get("text-writing-mode").map(v=>o.ai[v])),this.stateDependentLayerIds=this.layers.filter(v=>v.isStateDependent()).map(v=>v.id),this.sourceID=t.sourceID}createArrays(){this.text=new Uf(new gn(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new Uf(new gn(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new Re,this.lineVertexArray=new Ze,this.symbolInstances=new _e,this.textAnchorOffsets=new rt}calculateGlyphDependencies(t,s,h,d,_){for(let v=0;v<t.length;v++)if(s[t.charCodeAt(v)]=!0,(h||d)&&_){const b=bc[t.charAt(v)];b&&(s[b.charCodeAt(0)]=!0)}}populate(t,s,h){const d=this.layers[0],_=d.layout,v=_.get("text-font"),b=_.get("text-field"),k=_.get("icon-image"),I=(b.value.kind!=="constant"||b.value.value instanceof ea&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&(v.value.kind!=="constant"||v.value.value.length>0),D=k.value.kind!=="constant"||!!k.value.value||Object.keys(k.parameters).length>0,O=_.get("symbol-sort-key");if(this.features=[],!I&&!D)return;const G=s.iconDependencies,q=s.glyphDependencies,Z=s.availableImages,ne=new Ur(this.zoom);for(const{feature:xe,id:be,index:Be,sourceLayerIndex:ke}of t){const Ne=d._featureFilter.needGeometry,We=ao(xe,Ne);if(!d._featureFilter.filter(ne,We,h))continue;let st,At;if(Ne||(We.geometry=ro(xe)),I){const kt=d.getValueAndResolveTokens("text-field",We,h,Z),St=ea.factory(kt);oy(St)&&(this.hasRTLText=!0),(!this.hasRTLText||rc()==="unavailable"||this.hasRTLText&&_i.isParsed())&&(st=$_(St,d,We))}if(D){const kt=d.getValueAndResolveTokens("icon-image",We,h,Z);At=kt instanceof Ia?kt:Ia.fromString(kt)}if(!st&&!At)continue;const Bt=this.sortFeaturesByKey?O.evaluate(We,{},h):void 0;if(this.features.push({id:be,text:st,icon:At,index:Be,sourceLayerIndex:ke,geometry:We.geometry,properties:xe.properties,type:ny[xe.type],sortKey:Bt}),At&&(G[At.name]=!0),st){const kt=v.evaluate(We,{},h).join(","),St=_.get("text-rotation-alignment")!=="viewport"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(o.ai.vertical)>=0;for(const bt of st.sections)if(bt.image)G[bt.image.name]=!0;else{const Lt=Zl(st.toString()),Tt=bt.fontStack||kt,gt=q[Tt]=q[Tt]||{};this.calculateGlyphDependencies(bt.text,gt,St,this.allowVerticalPlacement,Lt)}}}_.get("symbol-placement")==="line"&&(this.features=function(xe){const be={},Be={},ke=[];let Ne=0;function We(kt){ke.push(xe[kt]),Ne++}function st(kt,St,bt){const Lt=Be[kt];return delete Be[kt],Be[St]=Lt,ke[Lt].geometry[0].pop(),ke[Lt].geometry[0]=ke[Lt].geometry[0].concat(bt[0]),Lt}function At(kt,St,bt){const Lt=be[St];return delete be[St],be[kt]=Lt,ke[Lt].geometry[0].shift(),ke[Lt].geometry[0]=bt[0].concat(ke[Lt].geometry[0]),Lt}function Bt(kt,St,bt){const Lt=bt?St[0][St[0].length-1]:St[0][0];return`${kt}:${Lt.x}:${Lt.y}`}for(let kt=0;kt<xe.length;kt++){const St=xe[kt],bt=St.geometry,Lt=St.text?St.text.toString():null;if(!Lt){We(kt);continue}const Tt=Bt(Lt,bt),gt=Bt(Lt,bt,!0);if(Tt in Be&&gt in be&&Be[Tt]!==be[gt]){const jt=At(Tt,gt,bt),Ut=st(Tt,gt,ke[jt].geometry);delete be[Tt],delete Be[gt],Be[Bt(Lt,ke[Ut].geometry,!0)]=Ut,ke[jt].geometry=null}else Tt in Be?st(Tt,gt,bt):gt in be?At(Tt,gt,bt):(We(kt),be[Tt]=Ne-1,Be[gt]=Ne-1)}return ke.filter(kt=>kt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((xe,be)=>xe.sortKey-be.sortKey)}update(t,s,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,s,this.layers,h),this.icon.programConfigurations.updatePaintArrays(t,s,this.layers,h))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,s){const h=this.lineVertexArray.length;if(t.segment!==void 0){let d=t.dist(s[t.segment+1]),_=t.dist(s[t.segment]);const v={};for(let b=t.segment+1;b<s.length;b++)v[b]={x:s[b].x,y:s[b].y,tileUnitDistanceFromAnchor:d},b<s.length-1&&(d+=s[b+1].dist(s[b]));for(let b=t.segment||0;b>=0;b--)v[b]={x:s[b].x,y:s[b].y,tileUnitDistanceFromAnchor:_},b>0&&(_+=s[b-1].dist(s[b]));for(let b=0;b<s.length;b++){const k=v[b];this.lineVertexArray.emplaceBack(k.x,k.y,k.tileUnitDistanceFromAnchor)}}return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}}addSymbols(t,s,h,d,_,v,b,k,I,D,O,G){const q=t.indexArray,Z=t.layoutVertexArray,ne=t.segments.prepareSegment(4*s.length,Z,q,this.canOverlap?v.sortKey:void 0),xe=this.glyphOffsetArray.length,be=ne.vertexLength,Be=this.allowVerticalPlacement&&b===o.ai.vertical?Math.PI/2:0,ke=v.text&&v.text.sections;for(let Ne=0;Ne<s.length;Ne++){const{tl:We,tr:st,bl:At,br:Bt,tex:kt,pixelOffsetTL:St,pixelOffsetBR:bt,minFontScaleX:Lt,minFontScaleY:Tt,glyphOffset:gt,isSDF:jt,sectionIndex:Ut}=s[Ne],hr=ne.vertexLength,$r=gt[1];sh(Z,k.x,k.y,We.x,$r+We.y,kt.x,kt.y,h,jt,St.x,St.y,Lt,Tt),sh(Z,k.x,k.y,st.x,$r+st.y,kt.x+kt.w,kt.y,h,jt,bt.x,St.y,Lt,Tt),sh(Z,k.x,k.y,At.x,$r+At.y,kt.x,kt.y+kt.h,h,jt,St.x,bt.y,Lt,Tt),sh(Z,k.x,k.y,Bt.x,$r+Bt.y,kt.x+kt.w,kt.y+kt.h,h,jt,bt.x,bt.y,Lt,Tt),Nf(t.dynamicLayoutVertexArray,k,Be),q.emplaceBack(hr,hr+1,hr+2),q.emplaceBack(hr+1,hr+2,hr+3),ne.vertexLength+=4,ne.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(gt[0]),Ne!==s.length-1&&Ut===s[Ne+1].sectionIndex||t.programConfigurations.populatePaintArrays(Z.length,v,v.index,{},G,ke&&ke[Ut])}t.placedSymbolArray.emplaceBack(k.x,k.y,xe,this.glyphOffsetArray.length-xe,be,I,D,k.segment,h?h[0]:0,h?h[1]:0,d[0],d[1],b,0,!1,0,O)}_addCollisionDebugVertex(t,s,h,d,_,v){return s.emplaceBack(0,0),t.emplaceBack(h.x,h.y,d,_,Math.round(v.x),Math.round(v.y))}addCollisionDebugVertices(t,s,h,d,_,v,b){const k=_.segments.prepareSegment(4,_.layoutVertexArray,_.indexArray),I=k.vertexLength,D=_.layoutVertexArray,O=_.collisionVertexArray,G=b.anchorX,q=b.anchorY;this._addCollisionDebugVertex(D,O,v,G,q,new M(t,s)),this._addCollisionDebugVertex(D,O,v,G,q,new M(h,s)),this._addCollisionDebugVertex(D,O,v,G,q,new M(h,d)),this._addCollisionDebugVertex(D,O,v,G,q,new M(t,d)),k.vertexLength+=4;const Z=_.indexArray;Z.emplaceBack(I,I+1),Z.emplaceBack(I+1,I+2),Z.emplaceBack(I+2,I+3),Z.emplaceBack(I+3,I),k.primitiveLength+=4}addDebugCollisionBoxes(t,s,h,d){for(let _=t;_<s;_++){const v=this.collisionBoxArray.get(_);this.addCollisionDebugVertices(v.x1,v.y1,v.x2,v.y2,d?this.textCollisionBox:this.iconCollisionBox,v.anchorPoint,h)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Vf(ra,rp.members,ga),this.iconCollisionBox=new Vf(ra,rp.members,ga);for(let t=0;t<this.symbolInstances.length;t++){const s=this.symbolInstances.get(t);this.addDebugCollisionBoxes(s.textBoxStartIndex,s.textBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.iconBoxStartIndex,s.iconBoxEndIndex,s,!1),this.addDebugCollisionBoxes(s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s,!1)}}_deserializeCollisionBoxesForSymbol(t,s,h,d,_,v,b,k,I){const D={};for(let O=s;O<h;O++){const G=t.get(O);D.textBox={x1:G.x1,y1:G.y1,x2:G.x2,y2:G.y2,anchorPointX:G.anchorPointX,anchorPointY:G.anchorPointY},D.textFeatureIndex=G.featureIndex;break}for(let O=d;O<_;O++){const G=t.get(O);D.verticalTextBox={x1:G.x1,y1:G.y1,x2:G.x2,y2:G.y2,anchorPointX:G.anchorPointX,anchorPointY:G.anchorPointY},D.verticalTextFeatureIndex=G.featureIndex;break}for(let O=v;O<b;O++){const G=t.get(O);D.iconBox={x1:G.x1,y1:G.y1,x2:G.x2,y2:G.y2,anchorPointX:G.anchorPointX,anchorPointY:G.anchorPointY},D.iconFeatureIndex=G.featureIndex;break}for(let O=k;O<I;O++){const G=t.get(O);D.verticalIconBox={x1:G.x1,y1:G.y1,x2:G.x2,y2:G.y2,anchorPointX:G.anchorPointX,anchorPointY:G.anchorPointY},D.verticalIconFeatureIndex=G.featureIndex;break}return D}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const h=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,s){const h=t.placedSymbolArray.get(s),d=h.vertexStartIndex+4*h.numGlyphs;for(let _=h.vertexStartIndex;_<d;_+=4)t.indexArray.emplaceBack(_,_+1,_+2),t.indexArray.emplaceBack(_+1,_+2,_+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const s=Math.sin(t),h=Math.cos(t),d=[],_=[],v=[];for(let b=0;b<this.symbolInstances.length;++b){v.push(b);const k=this.symbolInstances.get(b);d.push(0|Math.round(s*k.anchorX+h*k.anchorY)),_.push(k.featureIndex)}return v.sort((b,k)=>d[b]-d[k]||_[k]-_[b]),v}addToSortKeyRanges(t,s){const h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===s?h.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const h=this.symbolInstances.get(s);this.featureSortOrder.push(h.featureIndex),[h.rightJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.leftJustifiedTextSymbolIndex].forEach((d,_,v)=>{d>=0&&v.indexOf(d)===_&&this.addIndicesForPlacedSymbol(this.text,d)}),h.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,h.verticalPlacedTextSymbolIndex),h.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.placedIconSymbolIndex),h.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let yp,vp;Dt("SymbolBucket",ol,{omit:["layers","collisionBoxArray","features","compareText"]}),ol.MAX_GLYPHS=65535,ol.addDynamicAttributes=Nf;var $f={get paint(){return vp=vp||new oa({"icon-opacity":new Wt(qe.paint_symbol["icon-opacity"]),"icon-color":new Wt(qe.paint_symbol["icon-color"]),"icon-halo-color":new Wt(qe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Wt(qe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Wt(qe.paint_symbol["icon-halo-blur"]),"icon-translate":new $t(qe.paint_symbol["icon-translate"]),"icon-translate-anchor":new $t(qe.paint_symbol["icon-translate-anchor"]),"text-opacity":new Wt(qe.paint_symbol["text-opacity"]),"text-color":new Wt(qe.paint_symbol["text-color"],{runtimeType:Lr,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new Wt(qe.paint_symbol["text-halo-color"]),"text-halo-width":new Wt(qe.paint_symbol["text-halo-width"]),"text-halo-blur":new Wt(qe.paint_symbol["text-halo-blur"]),"text-translate":new $t(qe.paint_symbol["text-translate"]),"text-translate-anchor":new $t(qe.paint_symbol["text-translate-anchor"])})},get layout(){return yp=yp||new oa({"symbol-placement":new $t(qe.layout_symbol["symbol-placement"]),"symbol-spacing":new $t(qe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new $t(qe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Wt(qe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new $t(qe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new $t(qe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new $t(qe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new $t(qe.layout_symbol["icon-ignore-placement"]),"icon-optional":new $t(qe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new $t(qe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Wt(qe.layout_symbol["icon-size"]),"icon-text-fit":new $t(qe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new $t(qe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Wt(qe.layout_symbol["icon-image"]),"icon-rotate":new Wt(qe.layout_symbol["icon-rotate"]),"icon-padding":new Wt(qe.layout_symbol["icon-padding"]),"icon-keep-upright":new $t(qe.layout_symbol["icon-keep-upright"]),"icon-offset":new Wt(qe.layout_symbol["icon-offset"]),"icon-anchor":new Wt(qe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new $t(qe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new $t(qe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new $t(qe.layout_symbol["text-rotation-alignment"]),"text-field":new Wt(qe.layout_symbol["text-field"]),"text-font":new Wt(qe.layout_symbol["text-font"]),"text-size":new Wt(qe.layout_symbol["text-size"]),"text-max-width":new Wt(qe.layout_symbol["text-max-width"]),"text-line-height":new $t(qe.layout_symbol["text-line-height"]),"text-letter-spacing":new Wt(qe.layout_symbol["text-letter-spacing"]),"text-justify":new Wt(qe.layout_symbol["text-justify"]),"text-radial-offset":new Wt(qe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new $t(qe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Wt(qe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Wt(qe.layout_symbol["text-anchor"]),"text-max-angle":new $t(qe.layout_symbol["text-max-angle"]),"text-writing-mode":new $t(qe.layout_symbol["text-writing-mode"]),"text-rotate":new Wt(qe.layout_symbol["text-rotate"]),"text-padding":new $t(qe.layout_symbol["text-padding"]),"text-keep-upright":new $t(qe.layout_symbol["text-keep-upright"]),"text-transform":new Wt(qe.layout_symbol["text-transform"]),"text-offset":new Wt(qe.layout_symbol["text-offset"]),"text-allow-overlap":new $t(qe.layout_symbol["text-allow-overlap"]),"text-overlap":new $t(qe.layout_symbol["text-overlap"]),"text-ignore-placement":new $t(qe.layout_symbol["text-ignore-placement"]),"text-optional":new $t(qe.layout_symbol["text-optional"])})}};class wp{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:tr,this.defaultValue=t}evaluate(t){if(t.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(t.formattedSection))return s.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Dt("FormatSectionOverride",wp,{omit:["defaultValue"]});class oh extends Ri{constructor(t){super(t,$f)}recalculate(t,s){if(super.recalculate(t,s),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const h=this.layout.get("text-writing-mode");if(h){const d=[];for(const _ of h)d.indexOf(_)<0&&d.push(_);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,s,h,d){const _=this.layout.get(t).evaluate(s,{},h,d),v=this._unevaluatedLayout._values[t];return v.isDataDriven()||Vo(v.value)||!_?_:function(b,k){return k.replace(/{([^{}]+)}/g,(I,D)=>b&&D in b?String(b[D]):"")}(s.properties,_)}createBucket(t){return new ol(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of $f.paint.overridableProperties){if(!oh.hasPaintOverride(this.layout,t))continue;const s=this.paint.get(t),h=new wp(s),d=new $l(h,s.property.specification);let _=null;_=s.value.kind==="constant"||s.value.kind==="source"?new jl("source",d):new jo("composite",d,s.value.zoomStops),this.paint._values[t]=new Ha(s.property,_,s.parameters)}}_handleOverridablePaintPropertyUpdate(t,s,h){return!(!this.layout||s.isDataDriven()||h.isDataDriven())&&oh.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,s){const h=t.get("text-field"),d=$f.paint.properties[s];let _=!1;const v=b=>{for(const k of b)if(d.overrides&&d.overrides.hasOverride(k))return void(_=!0)};if(h.value.kind==="constant"&&h.value.value instanceof ea)v(h.value.value.sections);else if(h.value.kind==="source"){const b=I=>{_||(I instanceof Vn&&Hr(I.value)===ce?v(I.value.sections):I instanceof Uo?v(I.sections):I.eachChild(b))},k=h.value;k._styleExpression&&b(k._styleExpression.expression)}return _}}let bp;var ly={get paint(){return bp=bp||new oa({"background-color":new $t(qe.paint_background["background-color"]),"background-pattern":new ic(qe.paint_background["background-pattern"]),"background-opacity":new $t(qe.paint_background["background-opacity"])})}};class cy extends Ri{constructor(t){super(t,ly)}}let Tp;var uy={get paint(){return Tp=Tp||new oa({"raster-opacity":new $t(qe.paint_raster["raster-opacity"]),"raster-hue-rotate":new $t(qe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new $t(qe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new $t(qe.paint_raster["raster-brightness-max"]),"raster-saturation":new $t(qe.paint_raster["raster-saturation"]),"raster-contrast":new $t(qe.paint_raster["raster-contrast"]),"raster-resampling":new $t(qe.paint_raster["raster-resampling"]),"raster-fade-duration":new $t(qe.paint_raster["raster-fade-duration"])})}};class hy extends Ri{constructor(t){super(t,uy)}}class fy extends Ri{constructor(t){super(t,{}),this.onAdd=s=>{this.implementation.onAdd&&this.implementation.onAdd(s,s.painter.context.gl)},this.onRemove=s=>{this.implementation.onRemove&&this.implementation.onRemove(s,s.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class dy{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const jf=63710088e-1;class Ss{constructor(t,s){if(isNaN(t)||isNaN(s))throw new Error(`Invalid LngLat object: (${t}, ${s})`);if(this.lng=+t,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ss(ae(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const s=Math.PI/180,h=this.lat*s,d=t.lat*s,_=Math.sin(h)*Math.sin(d)+Math.cos(h)*Math.cos(d)*Math.cos((t.lng-this.lng)*s);return jf*Math.acos(Math.min(_,1))}static convert(t){if(t instanceof Ss)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Ss(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Ss(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Ep=2*Math.PI*jf;function Sp(i){return Ep*Math.cos(i*Math.PI/180)}function kp(i){return(180+i)/360}function Cp(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Ap(i,t){return i/Sp(t)}function Ip(i){return 360*i-180}function Gf(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class lh{constructor(t,s,h=0){this.x=+t,this.y=+s,this.z=+h}static fromLngLat(t,s=0){const h=Ss.convert(t);return new lh(kp(h.lng),Cp(h.lat),Ap(s,h.lat))}toLngLat(){return new Ss(Ip(this.x),Gf(this.y))}toAltitude(){return this.z*Sp(Gf(this.y))}meterInMercatorCoordinateUnits(){return 1/Ep*(t=Gf(this.y),1/Math.cos(t*Math.PI/180));var t}}function Fp(i,t,s){var h=2*Math.PI*6378137/256/Math.pow(2,s);return[i*h-2*Math.PI*6378137/2,t*h-2*Math.PI*6378137/2]}class Hf{constructor(t,s,h){if(t<0||t>25||h<0||h>=Math.pow(2,t)||s<0||s>=Math.pow(2,t))throw new Error(`x=${s}, y=${h}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=s,this.y=h,this.key=kc(0,t,t,s,h)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,s,h){const d=(v=this.y,b=this.z,k=Fp(256*(_=this.x),256*(v=Math.pow(2,b)-v-1),b),I=Fp(256*(_+1),256*(v+1),b),k[0]+","+k[1]+","+I[0]+","+I[1]);var _,v,b,k,I;const D=function(O,G,q){let Z,ne="";for(let xe=O;xe>0;xe--)Z=1<<xe-1,ne+=(G&Z?1:0)+(q&Z?2:0);return ne}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(h==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,s>1?"@2x":"").replace(/{quadkey}/g,D).replace(/{bbox-epsg-3857}/g,d)}isChildOf(t){const s=this.z-t.z;return s>0&&t.x===this.x>>s&&t.y===this.y>>s}getTilePoint(t){const s=Math.pow(2,this.z);return new M((t.x*s-this.x)*ha,(t.y*s-this.y)*ha)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Pp{constructor(t,s){this.wrap=t,this.canonical=s,this.key=kc(t,s.z,s.z,s.x,s.y)}}class Vi{constructor(t,s,h,d,_){if(t<h)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${h}`);this.overscaledZ=t,this.wrap=s,this.canonical=new Hf(h,+d,+_),this.key=kc(s,t,h,d,_)}clone(){return new Vi(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-t;return t>this.canonical.z?new Vi(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Vi(t,this.wrap,t,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(t,s){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const h=this.canonical.z-t;return t>this.canonical.z?kc(this.wrap*+s,t,this.canonical.z,this.canonical.x,this.canonical.y):kc(this.wrap*+s,t,t,this.canonical.x>>h,this.canonical.y>>h)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const s=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>s&&t.canonical.y===this.canonical.y>>s}children(t){if(this.overscaledZ>=t)return[new Vi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,h=2*this.canonical.x,d=2*this.canonical.y;return[new Vi(s,this.wrap,s,h,d),new Vi(s,this.wrap,s,h+1,d),new Vi(s,this.wrap,s,h,d+1),new Vi(s,this.wrap,s,h+1,d+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Vi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Vi(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Pp(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new lh(t.x-this.wrap,t.y))}}function kc(i,t,s,h,d){(i*=2)<0&&(i=-1*i-1);const _=1<<s;return(_*_*i+_*d+h).toString(36)+s.toString(36)+t.toString(36)}Dt("CanonicalTileID",Hf),Dt("OverscaledTileID",Vi,{omit:["posMatrix"]});class Mp{constructor(t,s,h,d=1,_=1,v=1,b=0){if(this.uid=t,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(h&&!["mapbox","terrarium","custom"].includes(h))return void ft(`"${h}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=s.height;const k=this.dim=s.height-2;switch(this.data=new Uint32Array(s.data.buffer),h){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=d,this.greenFactor=_,this.blueFactor=v,this.baseShift=b;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let I=0;I<k;I++)this.data[this._idx(-1,I)]=this.data[this._idx(0,I)],this.data[this._idx(k,I)]=this.data[this._idx(k-1,I)],this.data[this._idx(I,-1)]=this.data[this._idx(I,0)],this.data[this._idx(I,k)]=this.data[this._idx(I,k-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(k,-1)]=this.data[this._idx(k-1,0)],this.data[this._idx(-1,k)]=this.data[this._idx(0,k-1)],this.data[this._idx(k,k)]=this.data[this._idx(k-1,k-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let I=0;I<k;I++)for(let D=0;D<k;D++){const O=this.get(I,D);O>this.max&&(this.max=O),O<this.min&&(this.min=O)}}get(t,s){const h=new Uint8Array(this.data.buffer),d=4*this._idx(t,s);return this.unpack(h[d],h[d+1],h[d+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,s){if(t<-1||t>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(t+1)}unpack(t,s,h){return t*this.redFactor+s*this.greenFactor+h*this.blueFactor-this.baseShift}getPixels(){return new Ui({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,s,h){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let d=s*this.dim,_=s*this.dim+this.dim,v=h*this.dim,b=h*this.dim+this.dim;switch(s){case-1:d=_-1;break;case 1:_=d+1}switch(h){case-1:v=b-1;break;case 1:b=v+1}const k=-s*this.dim,I=-h*this.dim;for(let D=v;D<b;D++)for(let O=d;O<_;O++)this.data[this._idx(O,D)]=t.data[this._idx(O+k,D+I)]}}Dt("DEMData",Mp);class Dp{constructor(t){this._stringToNumber={},this._numberToString=[];for(let s=0;s<t.length;s++){const h=t[s];this._stringToNumber[h]=s,this._numberToString[s]=h}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class Lp{constructor(t,s,h,d,_){this.type="Feature",this._vectorTileFeature=t,t._z=s,t._x=h,t._y=d,this.properties=t.properties,this.id=_}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const s in this)s!=="_geometry"&&s!=="_vectorTileFeature"&&(t[s]=this[s]);return t}}class Rp{constructor(t,s){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new xs(ha,16,0),this.grid3D=new xs(ha,16,0),this.featureIndexArray=new lt,this.promoteId=s}insert(t,s,h,d,_,v){const b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,d,_);const k=v?this.grid3D:this.grid;for(let I=0;I<s.length;I++){const D=s[I],O=[1/0,1/0,-1/0,-1/0];for(let G=0;G<D.length;G++){const q=D[G];O[0]=Math.min(O[0],q.x),O[1]=Math.min(O[1],q.y),O[2]=Math.max(O[2],q.x),O[3]=Math.max(O[3],q.y)}O[0]<ha&&O[1]<ha&&O[2]>=0&&O[3]>=0&&k.insert(b,O[0],O[1],O[2],O[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new bs.VectorTile(new Df(this.rawTileData)).layers,this.sourceLayerCoder=new Dp(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,s,h,d){this.loadVTLayers();const _=t.params||{},v=ha/t.tileSize/t.scale,b=Hl(_.filter),k=t.queryGeometry,I=t.queryPadding*v,D=Bp(k),O=this.grid.query(D.minX-I,D.minY-I,D.maxX+I,D.maxY+I),G=Bp(t.cameraQueryGeometry),q=this.grid3D.query(G.minX-I,G.minY-I,G.maxX+I,G.maxY+I,(xe,be,Be,ke)=>function(Ne,We,st,At,Bt){for(const St of Ne)if(We<=St.x&&st<=St.y&&At>=St.x&&Bt>=St.y)return!0;const kt=[new M(We,st),new M(We,Bt),new M(At,Bt),new M(At,st)];if(Ne.length>2){for(const St of kt)if(el(Ne,St))return!0}for(let St=0;St<Ne.length-1;St++)if(Hx(Ne[St],Ne[St+1],kt))return!0;return!1}(t.cameraQueryGeometry,xe-I,be-I,Be+I,ke+I));for(const xe of q)O.push(xe);O.sort(py);const Z={};let ne;for(let xe=0;xe<O.length;xe++){const be=O[xe];if(be===ne)continue;ne=be;const Be=this.featureIndexArray.get(be);let ke=null;this.loadMatchingFeature(Z,Be.bucketIndex,Be.sourceLayerIndex,Be.featureIndex,b,_.layers,_.availableImages,s,h,d,(Ne,We,st)=>(ke||(ke=ro(Ne)),We.queryIntersectsFeature(k,Ne,st,ke,this.z,t.transform,v,t.pixelPosMatrix)))}return Z}loadMatchingFeature(t,s,h,d,_,v,b,k,I,D,O){const G=this.bucketLayerIDs[s];if(v&&!function(xe,be){for(let Be=0;Be<xe.length;Be++)if(be.indexOf(xe[Be])>=0)return!0;return!1}(v,G))return;const q=this.sourceLayerCoder.decode(h),Z=this.vtLayers[q].feature(d);if(_.needGeometry){const xe=ao(Z,!0);if(!_.filter(new Ur(this.tileID.overscaledZ),xe,this.tileID.canonical))return}else if(!_.filter(new Ur(this.tileID.overscaledZ),Z))return;const ne=this.getId(Z,q);for(let xe=0;xe<G.length;xe++){const be=G[xe];if(v&&v.indexOf(be)<0)continue;const Be=k[be];if(!Be)continue;let ke={};ne&&D&&(ke=D.getState(Be.sourceLayer||"_geojsonTileLayer",ne));const Ne=ze({},I[be]);Ne.paint=Op(Ne.paint,Be.paint,Z,ke,b),Ne.layout=Op(Ne.layout,Be.layout,Z,ke,b);const We=!O||O(Z,Be,ke);if(!We)continue;const st=new Lp(Z,this.z,this.x,this.y,ne);st.layer=Ne;let At=t[be];At===void 0&&(At=t[be]=[]),At.push({featureIndex:d,feature:st,intersectionZ:We})}}lookupSymbolFeatures(t,s,h,d,_,v,b,k){const I={};this.loadVTLayers();const D=Hl(_);for(const O of t)this.loadMatchingFeature(I,h,d,O,D,v,b,k,s);return I}hasLayer(t){for(const s of this.bucketLayerIDs)for(const h of s)if(t===h)return!0;return!1}getId(t,s){let h=t.id;return this.promoteId&&(h=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[s]],typeof h=="boolean"&&(h=Number(h))),h}}function Op(i,t,s,h,d){return $e(i,(_,v)=>{const b=t instanceof Jo?t.get(v):null;return b&&b.evaluate?b.evaluate(s,h,d):b})}function Bp(i){let t=1/0,s=1/0,h=-1/0,d=-1/0;for(const _ of i)t=Math.min(t,_.x),s=Math.min(s,_.y),h=Math.max(h,_.x),d=Math.max(d,_.y);return{minX:t,minY:s,maxX:h,maxY:d}}function py(i,t){return t-i}function zp(i,t,s,h,d){const _=[];for(let v=0;v<i.length;v++){const b=i[v];let k;for(let I=0;I<b.length-1;I++){let D=b[I],O=b[I+1];D.x<t&&O.x<t||(D.x<t?D=new M(t,D.y+(t-D.x)/(O.x-D.x)*(O.y-D.y))._round():O.x<t&&(O=new M(t,D.y+(t-D.x)/(O.x-D.x)*(O.y-D.y))._round()),D.y<s&&O.y<s||(D.y<s?D=new M(D.x+(s-D.y)/(O.y-D.y)*(O.x-D.x),s)._round():O.y<s&&(O=new M(D.x+(s-D.y)/(O.y-D.y)*(O.x-D.x),s)._round()),D.x>=h&&O.x>=h||(D.x>=h?D=new M(h,D.y+(h-D.x)/(O.x-D.x)*(O.y-D.y))._round():O.x>=h&&(O=new M(h,D.y+(h-D.x)/(O.x-D.x)*(O.y-D.y))._round()),D.y>=d&&O.y>=d||(D.y>=d?D=new M(D.x+(d-D.y)/(O.y-D.y)*(O.x-D.x),d)._round():O.y>=d&&(O=new M(D.x+(d-D.y)/(O.y-D.y)*(O.x-D.x),d)._round()),k&&D.equals(k[k.length-1])||(k=[D],_.push(k)),k.push(O)))))}}return _}Dt("FeatureIndex",Rp,{omit:["rawTileData","sourceLayerCoder"]});class ks extends M{constructor(t,s,h,d){super(t,s),this.angle=h,d!==void 0&&(this.segment=d)}clone(){return new ks(this.x,this.y,this.angle,this.segment)}}function Np(i,t,s,h,d){if(t.segment===void 0||s===0)return!0;let _=t,v=t.segment+1,b=0;for(;b>-s/2;){if(v--,v<0)return!1;b-=i[v].dist(_),_=i[v]}b+=i[v].dist(i[v+1]),v++;const k=[];let I=0;for(;b<s/2;){const D=i[v],O=i[v+1];if(!O)return!1;let G=i[v-1].angleTo(D)-D.angleTo(O);for(G=Math.abs((G+3*Math.PI)%(2*Math.PI)-Math.PI),k.push({distance:b,angleDelta:G}),I+=G;b-k[0].distance>h;)I-=k.shift().angleDelta;if(I>d)return!1;v++,b+=D.dist(O)}return!0}function Up(i){let t=0;for(let s=0;s<i.length-1;s++)t+=i[s].dist(i[s+1]);return t}function Vp(i,t,s){return i?.6*t*s:0}function $p(i,t){return Math.max(i?i.right-i.left:0,t?t.right-t.left:0)}function my(i,t,s,h,d,_){const v=Vp(s,d,_),b=$p(s,h)*_;let k=0;const I=Up(i)/2;for(let D=0;D<i.length-1;D++){const O=i[D],G=i[D+1],q=O.dist(G);if(k+q>I){const Z=(I-k)/q,ne=mi.number(O.x,G.x,Z),xe=mi.number(O.y,G.y,Z),be=new ks(ne,xe,G.angleTo(O),D);return be._round(),!v||Np(i,be,b,v,t)?be:void 0}k+=q}}function gy(i,t,s,h,d,_,v,b,k){const I=Vp(h,_,v),D=$p(h,d),O=D*v,G=i[0].x===0||i[0].x===k||i[0].y===0||i[0].y===k;return t-O<t/4&&(t=O+t/4),jp(i,G?t/2*b%t:(D/2+2*_)*v*b%t,t,I,s,O,G,!1,k)}function jp(i,t,s,h,d,_,v,b,k){const I=_/2,D=Up(i);let O=0,G=t-s,q=[];for(let Z=0;Z<i.length-1;Z++){const ne=i[Z],xe=i[Z+1],be=ne.dist(xe),Be=xe.angleTo(ne);for(;G+s<O+be;){G+=s;const ke=(G-O)/be,Ne=mi.number(ne.x,xe.x,ke),We=mi.number(ne.y,xe.y,ke);if(Ne>=0&&Ne<k&&We>=0&&We<k&&G-I>=0&&G+I<=D){const st=new ks(Ne,We,Be,Z);st._round(),h&&!Np(i,st,_,h,d)||q.push(st)}}O+=be}return b||q.length||v||(q=jp(i,O/2,s,h,d,_,v,!0,k)),q}Dt("Anchor",ks);const ll=vi;function Gp(i,t,s,h){const d=[],_=i.image,v=_.pixelRatio,b=_.paddedRect.w-2*ll,k=_.paddedRect.h-2*ll,I=i.right-i.left,D=i.bottom-i.top,O=_.stretchX||[[0,b]],G=_.stretchY||[[0,k]],q=(bt,Lt)=>bt+Lt[1]-Lt[0],Z=O.reduce(q,0),ne=G.reduce(q,0),xe=b-Z,be=k-ne;let Be=0,ke=Z,Ne=0,We=ne,st=0,At=xe,Bt=0,kt=be;if(_.content&&h){const bt=_.content;Be=ch(O,0,bt[0]),Ne=ch(G,0,bt[1]),ke=ch(O,bt[0],bt[2]),We=ch(G,bt[1],bt[3]),st=bt[0]-Be,Bt=bt[1]-Ne,At=bt[2]-bt[0]-ke,kt=bt[3]-bt[1]-We}const St=(bt,Lt,Tt,gt)=>{const jt=uh(bt.stretch-Be,ke,I,i.left),Ut=hh(bt.fixed-st,At,bt.stretch,Z),hr=uh(Lt.stretch-Ne,We,D,i.top),$r=hh(Lt.fixed-Bt,kt,Lt.stretch,ne),Gr=uh(Tt.stretch-Be,ke,I,i.left),ya=hh(Tt.fixed-st,At,Tt.stretch,Z),Bi=uh(gt.stretch-Ne,We,D,i.top),ii=hh(gt.fixed-Bt,kt,gt.stretch,ne),fa=new M(jt,hr),Ma=new M(Gr,hr),Ua=new M(Gr,Bi),ni=new M(jt,Bi),si=new M(Ut/v,$r/v),va=new M(ya/v,ii/v),wa=t*Math.PI/180;if(wa){const Za=Math.sin(wa),wi=Math.cos(wa),bi=[wi,-Za,Za,wi];fa._matMult(bi),Ma._matMult(bi),ni._matMult(bi),Ua._matMult(bi)}const qa=bt.stretch+bt.fixed,oi=Lt.stretch+Lt.fixed;return{tl:fa,tr:Ma,bl:ni,br:Ua,tex:{x:_.paddedRect.x+ll+qa,y:_.paddedRect.y+ll+oi,w:Tt.stretch+Tt.fixed-qa,h:gt.stretch+gt.fixed-oi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:si,pixelOffsetBR:va,minFontScaleX:At/v/I,minFontScaleY:kt/v/D,isSDF:s}};if(h&&(_.stretchX||_.stretchY)){const bt=Hp(O,xe,Z),Lt=Hp(G,be,ne);for(let Tt=0;Tt<bt.length-1;Tt++){const gt=bt[Tt],jt=bt[Tt+1];for(let Ut=0;Ut<Lt.length-1;Ut++)d.push(St(gt,Lt[Ut],jt,Lt[Ut+1]))}}else d.push(St({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:k+1}));return d}function ch(i,t,s){let h=0;for(const d of i)h+=Math.max(t,Math.min(s,d[1]))-Math.max(t,Math.min(s,d[0]));return h}function Hp(i,t,s){const h=[{fixed:-ll,stretch:0}];for(const[d,_]of i){const v=h[h.length-1];h.push({fixed:d-v.stretch,stretch:v.stretch}),h.push({fixed:d-v.stretch,stretch:v.stretch+(_-d)})}return h.push({fixed:t+ll,stretch:s}),h}function uh(i,t,s,h){return i/t*s+h}function hh(i,t,s,h){return i-t*s/h}class fh{constructor(t,s,h,d,_,v,b,k,I,D){if(this.boxStartIndex=t.length,I){let O=v.top,G=v.bottom;const q=v.collisionPadding;q&&(O-=q[1],G+=q[3]);let Z=G-O;Z>0&&(Z=Math.max(10,Z),this.circleDiameter=Z)}else{let O=v.top*b-k[0],G=v.bottom*b+k[2],q=v.left*b-k[3],Z=v.right*b+k[1];const ne=v.collisionPadding;if(ne&&(q-=ne[0]*b,O-=ne[1]*b,Z+=ne[2]*b,G+=ne[3]*b),D){const xe=new M(q,O),be=new M(Z,O),Be=new M(q,G),ke=new M(Z,G),Ne=D*Math.PI/180;xe._rotate(Ne),be._rotate(Ne),Be._rotate(Ne),ke._rotate(Ne),q=Math.min(xe.x,be.x,Be.x,ke.x),Z=Math.max(xe.x,be.x,Be.x,ke.x),O=Math.min(xe.y,be.y,Be.y,ke.y),G=Math.max(xe.y,be.y,Be.y,ke.y)}t.emplaceBack(s.x,s.y,q,O,Z,G,h,d,_)}this.boxEndIndex=t.length}}class xy{constructor(t=[],s=_y){if(this.data=t,this.length=this.data.length,this.compare=s,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const t=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:s,compare:h}=this,d=s[t];for(;t>0;){const _=t-1>>1,v=s[_];if(h(d,v)>=0)break;s[t]=v,t=_}s[t]=d}_down(t){const{data:s,compare:h}=this,d=this.length>>1,_=s[t];for(;t<d;){let v=1+(t<<1),b=s[v];const k=v+1;if(k<this.length&&h(s[k],b)<0&&(v=k,b=s[k]),h(b,_)>=0)break;s[t]=b,t=v}s[t]=_}}function _y(i,t){return i<t?-1:i>t?1:0}function yy(i,t=1,s=!1){let h=1/0,d=1/0,_=-1/0,v=-1/0;const b=i[0];for(let q=0;q<b.length;q++){const Z=b[q];(!q||Z.x<h)&&(h=Z.x),(!q||Z.y<d)&&(d=Z.y),(!q||Z.x>_)&&(_=Z.x),(!q||Z.y>v)&&(v=Z.y)}const k=Math.min(_-h,v-d);let I=k/2;const D=new xy([],vy);if(k===0)return new M(h,d);for(let q=h;q<_;q+=k)for(let Z=d;Z<v;Z+=k)D.push(new cl(q+I,Z+I,I,i));let O=function(q){let Z=0,ne=0,xe=0;const be=q[0];for(let Be=0,ke=be.length,Ne=ke-1;Be<ke;Ne=Be++){const We=be[Be],st=be[Ne],At=We.x*st.y-st.x*We.y;ne+=(We.x+st.x)*At,xe+=(We.y+st.y)*At,Z+=3*At}return new cl(ne/Z,xe/Z,0,q)}(i),G=D.length;for(;D.length;){const q=D.pop();(q.d>O.d||!O.d)&&(O=q,s&&console.log("found best %d after %d probes",Math.round(1e4*q.d)/1e4,G)),q.max-O.d<=t||(I=q.h/2,D.push(new cl(q.p.x-I,q.p.y-I,I,i)),D.push(new cl(q.p.x+I,q.p.y-I,I,i)),D.push(new cl(q.p.x-I,q.p.y+I,I,i)),D.push(new cl(q.p.x+I,q.p.y+I,I,i)),G+=4)}return s&&(console.log(`num probes: ${G}`),console.log(`best distance: ${O.d}`)),O.p}function vy(i,t){return t.max-i.max}function cl(i,t,s,h){this.p=new M(i,t),this.h=s,this.d=function(d,_){let v=!1,b=1/0;for(let k=0;k<_.length;k++){const I=_[k];for(let D=0,O=I.length,G=O-1;D<O;G=D++){const q=I[D],Z=I[G];q.y>d.y!=Z.y>d.y&&d.x<(Z.x-q.x)*(d.y-q.y)/(Z.y-q.y)+q.x&&(v=!v),b=Math.min(b,Cd(d,q,Z))}}return(v?1:-1)*Math.sqrt(b)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}var Na;o.aq=void 0,(Na=o.aq||(o.aq={}))[Na.center=1]="center",Na[Na.left=2]="left",Na[Na.right=3]="right",Na[Na.top=4]="top",Na[Na.bottom=5]="bottom",Na[Na["top-left"]=6]="top-left",Na[Na["top-right"]=7]="top-right",Na[Na["bottom-left"]=8]="bottom-left",Na[Na["bottom-right"]=9]="bottom-right";const Cs=7,Wf=Number.POSITIVE_INFINITY;function Wp(i,t){return t[1]!==Wf?function(s,h,d){let _=0,v=0;switch(h=Math.abs(h),d=Math.abs(d),s){case"top-right":case"top-left":case"top":v=d-Cs;break;case"bottom-right":case"bottom-left":case"bottom":v=-d+Cs}switch(s){case"top-right":case"bottom-right":case"right":_=-h;break;case"top-left":case"bottom-left":case"left":_=h}return[_,v]}(i,t[0],t[1]):function(s,h){let d=0,_=0;h<0&&(h=0);const v=h/Math.SQRT2;switch(s){case"top-right":case"top-left":_=v-Cs;break;case"bottom-right":case"bottom-left":_=-v+Cs;break;case"bottom":_=-h+Cs;break;case"top":_=h-Cs}switch(s){case"top-right":case"bottom-right":d=-v;break;case"top-left":case"bottom-left":d=v;break;case"left":d=h;break;case"right":d=-h}return[d,_]}(i,t[0])}function qp(i,t,s){var h;const d=i.layout,_=(h=d.get("text-variable-anchor-offset"))===null||h===void 0?void 0:h.evaluate(t,{},s);if(_){const b=_.values,k=[];for(let I=0;I<b.length;I+=2){const D=k[I]=b[I],O=b[I+1].map(G=>G*_a);D.startsWith("top")?O[1]-=Cs:D.startsWith("bottom")&&(O[1]+=Cs),k[I+1]=O}return new ta(k)}const v=d.get("text-variable-anchor");if(v){let b;b=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[d.get("text-radial-offset").evaluate(t,{},s)*_a,Wf]:d.get("text-offset").evaluate(t,{},s).map(I=>I*_a);const k=[];for(const I of v)k.push(I,Wp(I,b));return new ta(k)}return null}function qf(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function wy(i,t,s,h,d,_,v,b,k,I,D){let O=_.textMaxSize.evaluate(t,{});O===void 0&&(O=v);const G=i.layers[0].layout,q=G.get("icon-offset").evaluate(t,{},D),Z=Xp(s.horizontal),ne=v/24,xe=i.tilePixelRatio*ne,be=i.tilePixelRatio*O/24,Be=i.tilePixelRatio*b,ke=i.tilePixelRatio*G.get("symbol-spacing"),Ne=G.get("text-padding")*i.tilePixelRatio,We=function(gt,jt,Ut,hr=1){const $r=gt.get("icon-padding").evaluate(jt,{},Ut),Gr=$r&&$r.values;return[Gr[0]*hr,Gr[1]*hr,Gr[2]*hr,Gr[3]*hr]}(G,t,D,i.tilePixelRatio),st=G.get("text-max-angle")/180*Math.PI,At=G.get("text-rotation-alignment")!=="viewport"&&G.get("symbol-placement")!=="point",Bt=G.get("icon-rotation-alignment")==="map"&&G.get("symbol-placement")!=="point",kt=G.get("symbol-placement"),St=ke/2,bt=G.get("icon-text-fit");let Lt;h&&bt!=="none"&&(i.allowVerticalPlacement&&s.vertical&&(Lt=xp(h,s.vertical,bt,G.get("icon-text-fit-padding"),q,ne)),Z&&(h=xp(h,Z,bt,G.get("icon-text-fit-padding"),q,ne)));const Tt=(gt,jt)=>{jt.x<0||jt.x>=ha||jt.y<0||jt.y>=ha||function(Ut,hr,$r,Gr,ya,Bi,ii,fa,Ma,Ua,ni,si,va,wa,qa,oi,Za,wi,bi,ba,xr,Xa,Va,Ta,tn){const xn=Ut.addToLineVertexArray(hr,$r);let _n,es,rn,$i,Ti=0,ts=0,Ic=0,Qp=0,t0=-1,r0=-1;const rs={};let em=Kn("");if(Ut.allowVerticalPlacement&&Gr.vertical){const Ka=fa.layout.get("text-rotate").evaluate(xr,{},Ta)+90;rn=new fh(Ma,hr,Ua,ni,si,Gr.vertical,va,wa,qa,Ka),ii&&($i=new fh(Ma,hr,Ua,ni,si,ii,Za,wi,qa,Ka))}if(ya){const Ka=fa.layout.get("icon-rotate").evaluate(xr,{}),ji=fa.layout.get("icon-text-fit")!=="none",no=Gp(ya,Ka,Va,ji),vn=ii?Gp(ii,Ka,Va,ji):void 0;es=new fh(Ma,hr,Ua,ni,si,ya,Za,wi,!1,Ka),Ti=4*no.length;const so=Ut.iconSizeData;let Rn=null;so.kind==="source"?(Rn=[Ln*fa.layout.get("icon-size").evaluate(xr,{})],Rn[0]>Es&&ft(`${Ut.layerIds[0]}: Value for "icon-size" is >= ${Sc}. Reduce your "icon-size".`)):so.kind==="composite"&&(Rn=[Ln*Xa.compositeIconSizes[0].evaluate(xr,{},Ta),Ln*Xa.compositeIconSizes[1].evaluate(xr,{},Ta)],(Rn[0]>Es||Rn[1]>Es)&&ft(`${Ut.layerIds[0]}: Value for "icon-size" is >= ${Sc}. Reduce your "icon-size".`)),Ut.addSymbols(Ut.icon,no,Rn,ba,bi,xr,o.ai.none,hr,xn.lineStartIndex,xn.lineLength,-1,Ta),t0=Ut.icon.placedSymbolArray.length-1,vn&&(ts=4*vn.length,Ut.addSymbols(Ut.icon,vn,Rn,ba,bi,xr,o.ai.vertical,hr,xn.lineStartIndex,xn.lineLength,-1,Ta),r0=Ut.icon.placedSymbolArray.length-1)}const tm=Object.keys(Gr.horizontal);for(const Ka of tm){const ji=Gr.horizontal[Ka];if(!_n){em=Kn(ji.text);const vn=fa.layout.get("text-rotate").evaluate(xr,{},Ta);_n=new fh(Ma,hr,Ua,ni,si,ji,va,wa,qa,vn)}const no=ji.positionedLines.length===1;if(Ic+=Zp(Ut,hr,ji,Bi,fa,qa,xr,oi,xn,Gr.vertical?o.ai.horizontal:o.ai.horizontalOnly,no?tm:[Ka],rs,t0,Xa,Ta),no)break}Gr.vertical&&(Qp+=Zp(Ut,hr,Gr.vertical,Bi,fa,qa,xr,oi,xn,o.ai.vertical,["vertical"],rs,r0,Xa,Ta));const Ey=_n?_n.boxStartIndex:Ut.collisionBoxArray.length,Sy=_n?_n.boxEndIndex:Ut.collisionBoxArray.length,ky=rn?rn.boxStartIndex:Ut.collisionBoxArray.length,Cy=rn?rn.boxEndIndex:Ut.collisionBoxArray.length,Ay=es?es.boxStartIndex:Ut.collisionBoxArray.length,Iy=es?es.boxEndIndex:Ut.collisionBoxArray.length,Fy=$i?$i.boxStartIndex:Ut.collisionBoxArray.length,Py=$i?$i.boxEndIndex:Ut.collisionBoxArray.length;let yn=-1;const ph=(Ka,ji)=>Ka&&Ka.circleDiameter?Math.max(Ka.circleDiameter,ji):ji;yn=ph(_n,yn),yn=ph(rn,yn),yn=ph(es,yn),yn=ph($i,yn);const rm=yn>-1?1:0;rm&&(yn*=tn/_a),Ut.glyphOffsetArray.length>=ol.MAX_GLYPHS&&ft("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),xr.sortKey!==void 0&&Ut.addToSortKeyRanges(Ut.symbolInstances.length,xr.sortKey);const My=qp(fa,xr,Ta),[Dy,Ly]=function(Ka,ji){const no=Ka.length,vn=ji?.values;if(vn?.length>0)for(let so=0;so<vn.length;so+=2){const Rn=vn[so+1];Ka.emplaceBack(o.aq[vn[so]],Rn[0],Rn[1])}return[no,Ka.length]}(Ut.textAnchorOffsets,My);Ut.symbolInstances.emplaceBack(hr.x,hr.y,rs.right>=0?rs.right:-1,rs.center>=0?rs.center:-1,rs.left>=0?rs.left:-1,rs.vertical||-1,t0,r0,em,Ey,Sy,ky,Cy,Ay,Iy,Fy,Py,Ua,Ic,Qp,Ti,ts,rm,0,va,yn,Dy,Ly)}(i,jt,gt,s,h,d,Lt,i.layers[0],i.collisionBoxArray,t.index,t.sourceLayerIndex,i.index,xe,[Ne,Ne,Ne,Ne],At,k,Be,We,Bt,q,t,_,I,D,v)};if(kt==="line")for(const gt of zp(t.geometry,0,0,ha,ha)){const jt=gy(gt,ke,st,s.vertical||Z,h,24,be,i.overscaling,ha);for(const Ut of jt)Z&&by(i,Z.text,St,Ut)||Tt(gt,Ut)}else if(kt==="line-center"){for(const gt of t.geometry)if(gt.length>1){const jt=my(gt,st,s.vertical||Z,h,24,be);jt&&Tt(gt,jt)}}else if(t.type==="Polygon")for(const gt of Sf(t.geometry,0)){const jt=yy(gt,16);Tt(gt[0],new ks(jt.x,jt.y,0))}else if(t.type==="LineString")for(const gt of t.geometry)Tt(gt,new ks(gt[0].x,gt[0].y,0));else if(t.type==="Point")for(const gt of t.geometry)for(const jt of gt)Tt([jt],new ks(jt.x,jt.y,0))}function Zp(i,t,s,h,d,_,v,b,k,I,D,O,G,q,Z){const ne=function(Be,ke,Ne,We,st,At,Bt,kt){const St=We.layout.get("text-rotate").evaluate(At,{})*Math.PI/180,bt=[];for(const Lt of ke.positionedLines)for(const Tt of Lt.positionedGlyphs){if(!Tt.rect)continue;const gt=Tt.rect||{};let jt=up+1,Ut=!0,hr=1,$r=0;const Gr=(st||kt)&&Tt.vertical,ya=Tt.metrics.advance*Tt.scale/2;if(kt&&ke.verticalizable&&($r=Lt.lineOffset/2-(Tt.imageName?-(_a-Tt.metrics.width*Tt.scale)/2:(Tt.scale-1)*_a)),Tt.imageName){const ba=Bt[Tt.imageName];Ut=ba.sdf,hr=ba.pixelRatio,jt=vi/hr}const Bi=st?[Tt.x+ya,Tt.y]:[0,0];let ii=st?[0,0]:[Tt.x+ya+Ne[0],Tt.y+Ne[1]-$r],fa=[0,0];Gr&&(fa=ii,ii=[0,0]);const Ma=Tt.metrics.isDoubleResolution?2:1,Ua=(Tt.metrics.left-jt)*Tt.scale-ya+ii[0],ni=(-Tt.metrics.top-jt)*Tt.scale+ii[1],si=Ua+gt.w/Ma*Tt.scale/hr,va=ni+gt.h/Ma*Tt.scale/hr,wa=new M(Ua,ni),qa=new M(si,ni),oi=new M(Ua,va),Za=new M(si,va);if(Gr){const ba=new M(-ya,ya-Tc),xr=-Math.PI/2,Xa=_a/2-ya,Va=new M(5-Tc-Xa,-(Tt.imageName?Xa:0)),Ta=new M(...fa);wa._rotateAround(xr,ba)._add(Va)._add(Ta),qa._rotateAround(xr,ba)._add(Va)._add(Ta),oi._rotateAround(xr,ba)._add(Va)._add(Ta),Za._rotateAround(xr,ba)._add(Va)._add(Ta)}if(St){const ba=Math.sin(St),xr=Math.cos(St),Xa=[xr,-ba,ba,xr];wa._matMult(Xa),qa._matMult(Xa),oi._matMult(Xa),Za._matMult(Xa)}const wi=new M(0,0),bi=new M(0,0);bt.push({tl:wa,tr:qa,bl:oi,br:Za,tex:gt,writingMode:ke.writingMode,glyphOffset:Bi,sectionIndex:Tt.sectionIndex,isSDF:Ut,pixelOffsetTL:wi,pixelOffsetBR:bi,minFontScaleX:0,minFontScaleY:0})}return bt}(0,s,b,d,_,v,h,i.allowVerticalPlacement),xe=i.textSizeData;let be=null;xe.kind==="source"?(be=[Ln*d.layout.get("text-size").evaluate(v,{})],be[0]>Es&&ft(`${i.layerIds[0]}: Value for "text-size" is >= ${Sc}. Reduce your "text-size".`)):xe.kind==="composite"&&(be=[Ln*q.compositeTextSizes[0].evaluate(v,{},Z),Ln*q.compositeTextSizes[1].evaluate(v,{},Z)],(be[0]>Es||be[1]>Es)&&ft(`${i.layerIds[0]}: Value for "text-size" is >= ${Sc}. Reduce your "text-size".`)),i.addSymbols(i.text,ne,be,b,_,v,I,t,k.lineStartIndex,k.lineLength,G,Z);for(const Be of D)O[Be]=i.text.placedSymbolArray.length-1;return 4*ne.length}function Xp(i){for(const t in i)return i[t];return null}function by(i,t,s,h){const d=i.compareText;if(t in d){const _=d[t];for(let v=_.length-1;v>=0;v--)if(h.dist(_[v])<s)return!0}else d[t]=[];return d[t].push(h),!1}const Kp=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Zf{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,h]=new Uint8Array(t,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");const d=h>>4;if(d!==1)throw new Error(`Got v${d} data when expected v1.`);const _=Kp[15&h];if(!_)throw new Error("Unrecognized array type.");const[v]=new Uint16Array(t,2,1),[b]=new Uint32Array(t,4,1);return new Zf(b,v,_,t)}constructor(t,s=64,h=Float64Array,d){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=h,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const _=Kp.indexOf(this.ArrayType),v=2*t*this.ArrayType.BYTES_PER_ELEMENT,b=t*this.IndexArrayType.BYTES_PER_ELEMENT,k=(8-b%8)%8;if(_<0)throw new Error(`Unexpected typed array class: ${h}.`);d&&d instanceof ArrayBuffer?(this.data=d,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+b+k,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+v+b+k),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+b+k,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+_]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=t)}add(t,s){const h=this._pos>>1;return this.ids[h]=h,this.coords[this._pos++]=t,this.coords[this._pos++]=s,h}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Xf(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,s,h,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:v,nodeSize:b}=this,k=[0,_.length-1,0],I=[];for(;k.length;){const D=k.pop()||0,O=k.pop()||0,G=k.pop()||0;if(O-G<=b){for(let xe=G;xe<=O;xe++){const be=v[2*xe],Be=v[2*xe+1];be>=t&&be<=h&&Be>=s&&Be<=d&&I.push(_[xe])}continue}const q=G+O>>1,Z=v[2*q],ne=v[2*q+1];Z>=t&&Z<=h&&ne>=s&&ne<=d&&I.push(_[q]),(D===0?t<=Z:s<=ne)&&(k.push(G),k.push(q-1),k.push(1-D)),(D===0?h>=Z:d>=ne)&&(k.push(q+1),k.push(O),k.push(1-D))}return I}within(t,s,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:_,nodeSize:v}=this,b=[0,d.length-1,0],k=[],I=h*h;for(;b.length;){const D=b.pop()||0,O=b.pop()||0,G=b.pop()||0;if(O-G<=v){for(let xe=G;xe<=O;xe++)Jp(_[2*xe],_[2*xe+1],t,s)<=I&&k.push(d[xe]);continue}const q=G+O>>1,Z=_[2*q],ne=_[2*q+1];Jp(Z,ne,t,s)<=I&&k.push(d[q]),(D===0?t-h<=Z:s-h<=ne)&&(b.push(G),b.push(q-1),b.push(1-D)),(D===0?t+h>=Z:s+h>=ne)&&(b.push(q+1),b.push(O),b.push(1-D))}return k}}function Xf(i,t,s,h,d,_){if(d-h<=s)return;const v=h+d>>1;Yp(i,t,v,h,d,_),Xf(i,t,s,h,v-1,1-_),Xf(i,t,s,v+1,d,1-_)}function Yp(i,t,s,h,d,_){for(;d>h;){if(d-h>600){const I=d-h+1,D=s-h+1,O=Math.log(I),G=.5*Math.exp(2*O/3),q=.5*Math.sqrt(O*G*(I-G)/I)*(D-I/2<0?-1:1);Yp(i,t,s,Math.max(h,Math.floor(s-D*G/I+q)),Math.min(d,Math.floor(s+(I-D)*G/I+q)),_)}const v=t[2*s+_];let b=h,k=d;for(Cc(i,t,h,s),t[2*d+_]>v&&Cc(i,t,h,d);b<k;){for(Cc(i,t,b,k),b++,k--;t[2*b+_]<v;)b++;for(;t[2*k+_]>v;)k--}t[2*h+_]===v?Cc(i,t,h,k):(k++,Cc(i,t,k,d)),k<=s&&(h=k+1),s<=k&&(d=k-1)}}function Cc(i,t,s,h){Kf(i,s,h),Kf(t,2*s,2*h),Kf(t,2*s+1,2*h+1)}function Kf(i,t,s){const h=i[t];i[t]=i[s],i[s]=h}function Jp(i,t,s,h){const d=i-s,_=t-h;return d*d+_*_}var Yf;o.bh=void 0,(Yf=o.bh||(o.bh={})).create="create",Yf.load="load",Yf.fullLoad="fullLoad";let dh=null,Ac=[];const Jf=1e3/60,Qf="loadTime",e0="fullLoadTime",Ty={mark(i){performance.mark(i)},frame(i){const t=i;dh!=null&&Ac.push(t-dh),dh=t},clearMetrics(){dh=null,Ac=[],performance.clearMeasures(Qf),performance.clearMeasures(e0);for(const i in o.bh)performance.clearMarks(o.bh[i])},getPerformanceMetrics(){performance.measure(Qf,o.bh.create,o.bh.load),performance.measure(e0,o.bh.create,o.bh.fullLoad);const i=performance.getEntriesByName(Qf)[0].duration,t=performance.getEntriesByName(e0)[0].duration,s=Ac.length,h=1/(Ac.reduce((_,v)=>_+v,0)/s/1e3),d=Ac.filter(_=>_>Jf).reduce((_,v)=>_+(v-Jf)/Jf,0);return{loadTime:i,fullLoadTime:t,fps:h,percentDroppedFrames:d/(s+d)*100,totalFrames:s}}};o.$=function(i,t,s){var h,d,_,v,b,k,I,D,O,G,q,Z,ne=s[0],xe=s[1],be=s[2];return t===i?(i[12]=t[0]*ne+t[4]*xe+t[8]*be+t[12],i[13]=t[1]*ne+t[5]*xe+t[9]*be+t[13],i[14]=t[2]*ne+t[6]*xe+t[10]*be+t[14],i[15]=t[3]*ne+t[7]*xe+t[11]*be+t[15]):(d=t[1],_=t[2],v=t[3],b=t[4],k=t[5],I=t[6],D=t[7],O=t[8],G=t[9],q=t[10],Z=t[11],i[0]=h=t[0],i[1]=d,i[2]=_,i[3]=v,i[4]=b,i[5]=k,i[6]=I,i[7]=D,i[8]=O,i[9]=G,i[10]=q,i[11]=Z,i[12]=h*ne+b*xe+O*be+t[12],i[13]=d*ne+k*xe+G*be+t[13],i[14]=_*ne+I*xe+q*be+t[14],i[15]=v*ne+D*xe+Z*be+t[15]),i},o.A=tl,o.B=mi,o.C=class{constructor(i,t,s){this.receive=h=>{const d=h.data,_=d.id;if(_&&(!d.targetMapId||this.mapId===d.targetMapId))if(d.type==="<cancel>"){delete this.tasks[_];const v=this.cancelCallbacks[_];delete this.cancelCallbacks[_],v&&v()}else ht()||d.mustQueue?(this.tasks[_]=d,this.taskQueue.push(_),this.invoker.trigger()):this.processTask(_,d)},this.process=()=>{if(!this.taskQueue.length)return;const h=this.taskQueue.shift(),d=this.tasks[h];delete this.tasks[h],this.taskQueue.length&&this.invoker.trigger(),d&&this.processTask(h,d)},this.target=i,this.parent=t,this.mapId=s,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new dy(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=ht()?i:window}send(i,t,s,h,d=!1){const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(this.callbacks[_]=s);const v=[],b={id:_,type:i,hasCallback:!!s,targetMapId:h,mustQueue:d,sourceMapId:this.mapId,data:Pn(t,v)};return this.target.postMessage(b,{transfer:v}),{cancel:()=>{s&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}processTask(i,t){if(t.type==="<response>"){const s=this.callbacks[i];delete this.callbacks[i],s&&(t.error?s(_s(t.error)):s(null,_s(t.data)))}else{let s=!1;const h=[],d=t.hasCallback?(b,k)=>{s=!0,delete this.cancelCallbacks[i];const I={id:i,type:"<response>",sourceMapId:this.mapId,error:b?Pn(b):null,data:Pn(k,h)};this.target.postMessage(I,{transfer:h})}:b=>{s=!0};let _=null;const v=_s(t.data);if(this.parent[t.type])_=this.parent[t.type](t.sourceMapId,v,d);else if("getWorkerSource"in this.parent){const b=t.type.split(".");_=this.parent.getWorkerSource(t.sourceMapId,b[0],v.source)[b[1]](v,d)}else d(new Error(`Could not find function ${t.type}`));!s&&_&&_.cancel&&(this.cancelCallbacks[i]=_.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.D=$t,o.E=Pr,o.F=function(i,t){const s={};for(let h=0;h<t.length;h++){const d=t[h];d in i&&(s[d]=i[d])}return s},o.G=kp,o.H=Cp,o.I=Rf,o.J=pe,o.K=X,o.L=Ss,o.M=Ft,o.N=ha,o.O=Vi,o.P=M,o.Q=Zr,o.R=Ui,o.S=Vr,o.T=$u,o.U=lh,o.V=class extends Zn{},o.W=Hf,o.X=function(i,t){const s=window.document.createElement("video");s.muted=!0,s.onloadstart=function(){t(null,s)};for(let h=0;h<i.length;h++){const d=window.document.createElement("source");Xt(i[h])||(s.crossOrigin="Anonymous"),d.src=i[h],s.appendChild(d)}return{cancel:()=>{}}},o.Y=ot,o.Z=function(){var i=new tl(16);return tl!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},o._=E,o.a=He,o.a$=class extends W{},o.a0=function(i,t,s){var h=s[0],d=s[1],_=s[2];return i[0]=t[0]*h,i[1]=t[1]*h,i[2]=t[2]*h,i[3]=t[3]*h,i[4]=t[4]*d,i[5]=t[5]*d,i[6]=t[6]*d,i[7]=t[7]*d,i[8]=t[8]*_,i[9]=t[9]*_,i[10]=t[10]*_,i[11]=t[11]*_,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},o.a1=Pd,o.a2=function(){return Ie++},o.a3=de,o.a4=ol,o.a5=function(){_i.isLoading()||_i.isLoaded()||rc()!=="deferred"||Vu()},o.a6=Hl,o.a7=ao,o.a8=Ur,o.a9=Lp,o.aA=Ys,o.aB=function(i){i=i.slice();const t=Object.create(null);for(let s=0;s<i.length;s++)t[i[s].id]=i[s];for(let s=0;s<i.length;s++)"ref"in i[s]&&(i[s]=Br(i[s],t[i[s].ref]));return i},o.aC=function(i){if(i.type==="custom")return new fy(i);switch(i.type){case"background":return new cy(i);case"circle":return new Zx(i);case"fill":return new p_(i);case"fill-extrusion":return new I_(i);case"heatmap":return new Kx(i);case"hillshade":return new Jx(i);case"line":return new B_(i);case"raster":return new hy(i);case"symbol":return new oh(i)}},o.aD=Le,o.aE=function(i,t){if(!i)return[{command:Gt.setStyle,args:[t]}];let s=[];try{if(!ar(i.version,t.version))return[{command:Gt.setStyle,args:[t]}];ar(i.center,t.center)||s.push({command:Gt.setCenter,args:[t.center]}),ar(i.zoom,t.zoom)||s.push({command:Gt.setZoom,args:[t.zoom]}),ar(i.bearing,t.bearing)||s.push({command:Gt.setBearing,args:[t.bearing]}),ar(i.pitch,t.pitch)||s.push({command:Gt.setPitch,args:[t.pitch]}),ar(i.sprite,t.sprite)||s.push({command:Gt.setSprite,args:[t.sprite]}),ar(i.glyphs,t.glyphs)||s.push({command:Gt.setGlyphs,args:[t.glyphs]}),ar(i.transition,t.transition)||s.push({command:Gt.setTransition,args:[t.transition]}),ar(i.light,t.light)||s.push({command:Gt.setLight,args:[t.light]});const h={},d=[];(function(v,b,k,I){let D;for(D in b=b||{},v=v||{})Object.prototype.hasOwnProperty.call(v,D)&&(Object.prototype.hasOwnProperty.call(b,D)||ir(D,k,I));for(D in b)Object.prototype.hasOwnProperty.call(b,D)&&(Object.prototype.hasOwnProperty.call(v,D)?ar(v[D],b[D])||(v[D].type==="geojson"&&b[D].type==="geojson"&&wr(v,b,D)?k.push({command:Gt.setGeoJSONSourceData,args:[D,b[D].data]}):Dr(D,b,k,I)):ur(D,b,k))})(i.sources,t.sources,d,h);const _=[];i.layers&&i.layers.forEach(v=>{h[v.source]?s.push({command:Gt.removeLayer,args:[v.id]}):_.push(v)}),s=s.concat(d),function(v,b,k){b=b||[];const I=(v=v||[]).map(Ht),D=b.map(Ht),O=v.reduce(br,{}),G=b.reduce(br,{}),q=I.slice(),Z=Object.create(null);let ne,xe,be,Be,ke,Ne,We;for(ne=0,xe=0;ne<I.length;ne++)be=I[ne],Object.prototype.hasOwnProperty.call(G,be)?xe++:(k.push({command:Gt.removeLayer,args:[be]}),q.splice(q.indexOf(be,xe),1));for(ne=0,xe=0;ne<D.length;ne++)be=D[D.length-1-ne],q[q.length-1-ne]!==be&&(Object.prototype.hasOwnProperty.call(O,be)?(k.push({command:Gt.removeLayer,args:[be]}),q.splice(q.lastIndexOf(be,q.length-xe),1)):xe++,Ne=q[q.length-ne],k.push({command:Gt.addLayer,args:[G[be],Ne]}),q.splice(q.length-ne,0,be),Z[be]=!0);for(ne=0;ne<D.length;ne++)if(be=D[ne],Be=O[be],ke=G[be],!Z[be]&&!ar(Be,ke))if(ar(Be.source,ke.source)&&ar(Be["source-layer"],ke["source-layer"])&&ar(Be.type,ke.type)){for(We in Nr(Be.layout,ke.layout,k,be,null,Gt.setLayoutProperty),Nr(Be.paint,ke.paint,k,be,null,Gt.setPaintProperty),ar(Be.filter,ke.filter)||k.push({command:Gt.setFilter,args:[be,ke.filter]}),ar(Be.minzoom,ke.minzoom)&&ar(Be.maxzoom,ke.maxzoom)||k.push({command:Gt.setLayerZoomRange,args:[be,ke.minzoom,ke.maxzoom]}),Be)Object.prototype.hasOwnProperty.call(Be,We)&&We!=="layout"&&We!=="paint"&&We!=="filter"&&We!=="metadata"&&We!=="minzoom"&&We!=="maxzoom"&&(We.indexOf("paint.")===0?Nr(Be[We],ke[We],k,be,We.slice(6),Gt.setPaintProperty):ar(Be[We],ke[We])||k.push({command:Gt.setLayerProperty,args:[be,We,ke[We]]}));for(We in ke)Object.prototype.hasOwnProperty.call(ke,We)&&!Object.prototype.hasOwnProperty.call(Be,We)&&We!=="layout"&&We!=="paint"&&We!=="filter"&&We!=="metadata"&&We!=="minzoom"&&We!=="maxzoom"&&(We.indexOf("paint.")===0?Nr(Be[We],ke[We],k,be,We.slice(6),Gt.setPaintProperty):ar(Be[We],ke[We])||k.push({command:Gt.setLayerProperty,args:[be,We,ke[We]]}))}else k.push({command:Gt.removeLayer,args:[be]}),Ne=q[q.lastIndexOf(be)+1],k.push({command:Gt.addLayer,args:[ke,Ne]})}(_,t.layers,s)}catch(h){console.warn("Unable to compute style diff:",h),s=[{command:Gt.setStyle,args:[t]}]}return s},o.aF=function(i){const t=[],s=i.id;return s===void 0&&t.push({message:`layers.${s}: missing required property "id"`}),i.render===void 0&&t.push({message:`layers.${s}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&t.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),t},o.aG=function i(t,s){if(Array.isArray(t)){if(!Array.isArray(s)||t.length!==s.length)return!1;for(let h=0;h<t.length;h++)if(!i(t[h],s[h]))return!1;return!0}if(typeof t=="object"&&t!==null&&s!==null){if(typeof s!="object"||Object.keys(t).length!==Object.keys(s).length)return!1;for(const h in t)if(!i(t[h],s[h]))return!1;return!0}return t===s},o.aH=$e,o.aI=je,o.aJ=Js,o.aK=function(i){return i({pluginStatus:ti,pluginURL:Mn}),Js.on("pluginStateChange",i),i},o.aL=class extends Yn{constructor(i,t){super(i,t),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},o.aM=Qo,o.aN=class extends Yn{constructor(i,t){super(i,t),this.current=df}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let t=1;t<16;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},o.aO=Wu,o.aP=class extends Yn{constructor(i,t){super(i,t),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},o.aQ=class extends Yn{constructor(i,t){super(i,t),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},o.aR=qu,o.aS=function(i,t,s,h,d,_,v){var b=1/(t-s),k=1/(h-d),I=1/(_-v);return i[0]=-2*b,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*k,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*I,i[11]=0,i[12]=(t+s)*b,i[13]=(d+h)*k,i[14]=(v+_)*I,i[15]=1,i},o.aT=er,o.aU=qx,o.aV=class extends f{},o.aW=V_,o.aX=class extends y{},o.aY=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},o.aZ=Od,o.a_=vt,o.aa=function(i){const t={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,h,d,_)=>{const v=d||_;return t[h]=!v||v.toLowerCase(),""}),t["max-age"]){const s=parseInt(t["max-age"],10);isNaN(s)?delete t["max-age"]:t["max-age"]=s}return t},o.ab=function(i,t){const s=[];for(const h in i)h in t||s.push(h);return s},o.ac=function(i){if(Yt==null){const t=i.navigator?i.navigator.userAgent:null;Yt=!!i.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Yt},o.ad=we,o.ae=function(i,t,s){var h=Math.sin(s),d=Math.cos(s),_=t[0],v=t[1],b=t[2],k=t[3],I=t[4],D=t[5],O=t[6],G=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=_*d+I*h,i[1]=v*d+D*h,i[2]=b*d+O*h,i[3]=k*d+G*h,i[4]=I*d-_*h,i[5]=D*d-v*h,i[6]=O*d-b*h,i[7]=G*d-k*h,i},o.af=function(i){var t=new tl(16);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],t},o.ag=Yu,o.ah=function(i,t){let s=0,h=0;if(i.kind==="constant")h=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:d,minZoom:_,maxZoom:v}=i,b=d?we(gi.interpolationFactor(d,t,_,v),0,1):0;i.kind==="camera"?h=mi.number(i.minSize,i.maxSize,b):s=b}return{uSizeT:s,uSize:h}},o.aj=function(i,{uSize:t,uSizeT:s},{lowerSize:h,upperSize:d}){return i.kind==="source"?h/Ln:i.kind==="composite"?mi.number(h/Ln,d/Ln,s):t},o.ak=Nf,o.al=function(i,t,s,h){const d=t.y-i.y,_=t.x-i.x,v=h.y-s.y,b=h.x-s.x,k=v*_-b*d;if(k===0)return null;const I=(b*(i.y-s.y)-v*(i.x-s.x))/k;return new M(i.x+I*_,i.y+I*d)},o.am=zp,o.an=Sd,o.ao=_f,o.ap=_a,o.ar=zf,o.as=function(i,t){var s=t[0],h=t[1],d=t[2],_=t[3],v=t[4],b=t[5],k=t[6],I=t[7],D=t[8],O=t[9],G=t[10],q=t[11],Z=t[12],ne=t[13],xe=t[14],be=t[15],Be=s*b-h*v,ke=s*k-d*v,Ne=s*I-_*v,We=h*k-d*b,st=h*I-_*b,At=d*I-_*k,Bt=D*ne-O*Z,kt=D*xe-G*Z,St=D*be-q*Z,bt=O*xe-G*ne,Lt=O*be-q*ne,Tt=G*be-q*xe,gt=Be*Tt-ke*Lt+Ne*bt+We*St-st*kt+At*Bt;return gt?(i[0]=(b*Tt-k*Lt+I*bt)*(gt=1/gt),i[1]=(d*Lt-h*Tt-_*bt)*gt,i[2]=(ne*At-xe*st+be*We)*gt,i[3]=(G*st-O*At-q*We)*gt,i[4]=(k*St-v*Tt-I*kt)*gt,i[5]=(s*Tt-d*St+_*kt)*gt,i[6]=(xe*Ne-Z*At-be*ke)*gt,i[7]=(D*At-G*Ne+q*ke)*gt,i[8]=(v*Lt-b*St+I*Bt)*gt,i[9]=(h*St-s*Lt-_*Bt)*gt,i[10]=(Z*st-ne*Ne+be*Be)*gt,i[11]=(O*Ne-D*st-q*Be)*gt,i[12]=(b*kt-v*bt-k*Bt)*gt,i[13]=(s*bt-h*kt+d*Bt)*gt,i[14]=(ne*ke-Z*We-xe*Be)*gt,i[15]=(D*We-O*ke+G*Be)*gt,i):null},o.at=qf,o.au=Bf,o.av=Zf,o.aw=function(){const i={},t=qe.$version;for(const s in qe.$root){const h=qe.$root[s];if(h.required){let d=null;d=s==="version"?t:h.type==="array"?[]:{},d!=null&&(i[s]=d)}}return i},o.ax=Gt,o.ay=Bu,o.az=ut,o.b=function(i,t){const s=new Blob([new Uint8Array(i)],{type:"image/png"});createImageBitmap(s).then(h=>{t(null,h)}).catch(h=>{t(new Error(`Could not load image because of ${h.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},o.b0=Fa,o.b1=function(i,t){var s=i[0],h=i[1],d=i[2],_=i[3],v=i[4],b=i[5],k=i[6],I=i[7],D=i[8],O=i[9],G=i[10],q=i[11],Z=i[12],ne=i[13],xe=i[14],be=i[15],Be=t[0],ke=t[1],Ne=t[2],We=t[3],st=t[4],At=t[5],Bt=t[6],kt=t[7],St=t[8],bt=t[9],Lt=t[10],Tt=t[11],gt=t[12],jt=t[13],Ut=t[14],hr=t[15];return Math.abs(s-Be)<=ai*Math.max(1,Math.abs(s),Math.abs(Be))&&Math.abs(h-ke)<=ai*Math.max(1,Math.abs(h),Math.abs(ke))&&Math.abs(d-Ne)<=ai*Math.max(1,Math.abs(d),Math.abs(Ne))&&Math.abs(_-We)<=ai*Math.max(1,Math.abs(_),Math.abs(We))&&Math.abs(v-st)<=ai*Math.max(1,Math.abs(v),Math.abs(st))&&Math.abs(b-At)<=ai*Math.max(1,Math.abs(b),Math.abs(At))&&Math.abs(k-Bt)<=ai*Math.max(1,Math.abs(k),Math.abs(Bt))&&Math.abs(I-kt)<=ai*Math.max(1,Math.abs(I),Math.abs(kt))&&Math.abs(D-St)<=ai*Math.max(1,Math.abs(D),Math.abs(St))&&Math.abs(O-bt)<=ai*Math.max(1,Math.abs(O),Math.abs(bt))&&Math.abs(G-Lt)<=ai*Math.max(1,Math.abs(G),Math.abs(Lt))&&Math.abs(q-Tt)<=ai*Math.max(1,Math.abs(q),Math.abs(Tt))&&Math.abs(Z-gt)<=ai*Math.max(1,Math.abs(Z),Math.abs(gt))&&Math.abs(ne-jt)<=ai*Math.max(1,Math.abs(ne),Math.abs(jt))&&Math.abs(xe-Ut)<=ai*Math.max(1,Math.abs(xe),Math.abs(Ut))&&Math.abs(be-hr)<=ai*Math.max(1,Math.abs(be),Math.abs(hr))},o.b2=function(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},o.b3=function(i,t,s){return i[0]=t[0]*s[0],i[1]=t[1]*s[1],i[2]=t[2]*s[2],i[3]=t[3]*s[3],i},o.b4=function(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]*t[3]},o.b5=ae,o.b6=Pp,o.b7=Ap,o.b8=function(i,t,s,h,d){var _,v=1/Math.tan(t/2);return i[0]=v/s,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=v,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,d!=null&&d!==1/0?(i[10]=(d+h)*(_=1/(h-d)),i[14]=2*d*h*_):(i[10]=-1,i[14]=-2*h),i},o.b9=function(i,t,s){var h=Math.sin(s),d=Math.cos(s),_=t[4],v=t[5],b=t[6],k=t[7],I=t[8],D=t[9],O=t[10],G=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=_*d+I*h,i[5]=v*d+D*h,i[6]=b*d+O*h,i[7]=k*d+G*h,i[8]=I*d-_*h,i[9]=D*d-v*h,i[10]=O*d-b*h,i[11]=G*d-k*h,i},o.bA=C,o.bB=ap,o.bC=$o,o.bD=_i,o.ba=le,o.bb=ye,o.bc=function(i,t){return i[0]=t[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=t[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=t[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},o.bd=class extends to{},o.be=jf,o.bf=Ip,o.bg=Ty,o.bi=_t,o.bj=function(i,t,s=!1){if(ti===Yl||ti===Jl||ti===Ql)throw new Error("setRTLTextPlugin cannot be called multiple times.");Mn=Ke.resolveURL(i),ti=Yl,ec=t,tc(),s||Vu()},o.bk=rc,o.bl=function(i,t){const s={};for(let d=0;d<i.length;d++){const _=t&&t[i[d].id]||Wo(i[d]);t&&(t[i[d].id]=_);let v=s[_];v||(v=s[_]=[]),v.push(i[d])}const h=[];for(const d in s)h.push(s[d]);return h},o.bm=Dt,o.bn=Dp,o.bo=Rp,o.bp=fp,o.bq=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=ha/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const t=i.bucket.layers[0],s=t.layout,h=t._unevaluatedLayout._values,d={layoutIconSize:h["icon-size"].possiblyEvaluate(new Ur(i.bucket.zoom+1),i.canonical),layoutTextSize:h["text-size"].possiblyEvaluate(new Ur(i.bucket.zoom+1),i.canonical),textMaxSize:h["text-size"].possiblyEvaluate(new Ur(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:I,maxZoom:D}=i.bucket.textSizeData;d.compositeTextSizes=[h["text-size"].possiblyEvaluate(new Ur(I),i.canonical),h["text-size"].possiblyEvaluate(new Ur(D),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:I,maxZoom:D}=i.bucket.iconSizeData;d.compositeIconSizes=[h["icon-size"].possiblyEvaluate(new Ur(I),i.canonical),h["icon-size"].possiblyEvaluate(new Ur(D),i.canonical)]}const _=s.get("text-line-height")*_a,v=s.get("text-rotation-alignment")!=="viewport"&&s.get("symbol-placement")!=="point",b=s.get("text-keep-upright"),k=s.get("text-size");for(const I of i.bucket.features){const D=s.get("text-font").evaluate(I,{},i.canonical).join(","),O=k.evaluate(I,{},i.canonical),G=d.layoutTextSize.evaluate(I,{},i.canonical),q=d.layoutIconSize.evaluate(I,{},i.canonical),Z={horizontal:{},vertical:void 0},ne=I.text;let xe,be=[0,0];if(ne){const Ne=ne.toString(),We=s.get("text-letter-spacing").evaluate(I,{},i.canonical)*_a,st=Xl(Ne)?We:0,At=s.get("text-anchor").evaluate(I,{},i.canonical),Bt=qp(t,I,i.canonical);if(!Bt){const Tt=s.get("text-radial-offset").evaluate(I,{},i.canonical);be=Tt?Wp(At,[Tt*_a,Wf]):s.get("text-offset").evaluate(I,{},i.canonical).map(gt=>gt*_a)}let kt=v?"center":s.get("text-justify").evaluate(I,{},i.canonical);const St=s.get("symbol-placement"),bt=St==="point"?s.get("text-max-width").evaluate(I,{},i.canonical)*_a:0,Lt=()=>{i.bucket.allowVerticalPlacement&&Zl(Ne)&&(Z.vertical=ih(ne,i.glyphMap,i.glyphPositions,i.imagePositions,D,bt,_,At,"left",st,be,o.ai.vertical,!0,St,G,O))};if(!v&&Bt){const Tt=new Set;if(kt==="auto")for(let jt=0;jt<Bt.values.length;jt+=2)Tt.add(qf(Bt.values[jt]));else Tt.add(kt);let gt=!1;for(const jt of Tt)if(!Z.horizontal[jt])if(gt)Z.horizontal[jt]=Z.horizontal[0];else{const Ut=ih(ne,i.glyphMap,i.glyphPositions,i.imagePositions,D,bt,_,"center",jt,st,be,o.ai.horizontal,!1,St,G,O);Ut&&(Z.horizontal[jt]=Ut,gt=Ut.positionedLines.length===1)}Lt()}else{kt==="auto"&&(kt=qf(At));const Tt=ih(ne,i.glyphMap,i.glyphPositions,i.imagePositions,D,bt,_,At,kt,st,be,o.ai.horizontal,!1,St,G,O);Tt&&(Z.horizontal[kt]=Tt),Lt(),Zl(Ne)&&v&&b&&(Z.vertical=ih(ne,i.glyphMap,i.glyphPositions,i.imagePositions,D,bt,_,At,kt,st,be,o.ai.vertical,!1,St,G,O))}}let Be=!1;if(I.icon&&I.icon.name){const Ne=i.imageMap[I.icon.name];Ne&&(xe=iy(i.imagePositions[I.icon.name],s.get("icon-offset").evaluate(I,{},i.canonical),s.get("icon-anchor").evaluate(I,{},i.canonical)),Be=!!Ne.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=Be:i.bucket.sdfIcons!==Be&&ft("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ne.pixelRatio!==i.bucket.pixelRatio||s.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const ke=Xp(Z.horizontal)||Z.vertical;i.bucket.iconsInText=!!ke&&ke.iconsInText,(ke||xe)&&wy(i.bucket,I,Z,xe,i.imageMap,d,G,q,be,Be,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},o.br=Pf,o.bs=Af,o.bt=Ff,o.bu=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},o.bv=Df,o.bw=bs,o.bx=function(i,t,s,h,d){return E(this,void 0,void 0,function*(){if(X())try{return yield Ft(i,t,s,h,d)}catch{}return function(_,v,b,k,I){const D=_.width,O=_.height;ue&&Te||(ue=new OffscreenCanvas(D,O),Te=ue.getContext("2d",{willReadFrequently:!0})),ue.width=D,ue.height=O,Te.drawImage(_,0,0,D,O);const G=Te.getImageData(v,b,k,I);return Te.clearRect(0,0,D,O),G.data}(i,t,s,h,d)})},o.by=Mp,o.bz=w,o.c=pt,o.d=function(i,t){const s=new Image;s.onload=()=>{t(null,s),URL.revokeObjectURL(s.src),s.onload=null,window.requestAnimationFrame(()=>{s.src=Nt})},s.onerror=()=>t(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const h=new Blob([new Uint8Array(i)],{type:"image/png"});s.src=i.byteLength?URL.createObjectURL(h):Nt},o.e=ze,o.f=function(i,t){return ge(ze(i,{type:"json"}),t)},o.g=tt,o.h=Ke,o.i=ht,o.j=cr,o.k=wt,o.l=Qt,o.m=ge,o.n=function(i){return new Df(i).readFields(J_,[])},o.o=function(i,t,s){if(!i.length)return s(null,[]);let h=i.length;const d=new Array(i.length);let _=null;i.forEach((v,b)=>{t(v,(k,I)=>{k&&(_=k),d[b]=I,--h==0&&s(_,d)})})},o.p=hp,o.q=mc,o.r=oa,o.s=Xt,o.t=cf,o.u=Ct,o.v=qe,o.w=ft,o.x=Xo,o.y=pn,o.z=function([i,t,s]){return t+=90,t*=Math.PI/180,s*=Math.PI/180,{x:i*Math.cos(t)*Math.sin(s),y:i*Math.sin(t)*Math.sin(s),z:i*Math.cos(s)}}}),m(["./shared"],function(o){class E{constructor(V){this.keyCache={},V&&this.replace(V)}replace(V){this._layerConfigs={},this._layers={},this.update(V,[])}update(V,H){for(const fe of V){this._layerConfigs[fe.id]=fe;const me=this._layers[fe.id]=o.aC(fe);me._featureFilter=o.a6(me.filter),this.keyCache[fe.id]&&delete this.keyCache[fe.id]}for(const fe of H)delete this.keyCache[fe],delete this._layerConfigs[fe],delete this._layers[fe];this.familiesBySource={};const te=o.bl(Object.values(this._layerConfigs),this.keyCache);for(const fe of te){const me=fe.map(et=>this._layers[et.id]),Oe=me[0];if(Oe.visibility==="none")continue;const Ce=Oe.source||"";let ve=this.familiesBySource[Ce];ve||(ve=this.familiesBySource[Ce]={});const Me=Oe.sourceLayer||"_geojsonTileLayer";let Qe=ve[Me];Qe||(Qe=ve[Me]=[]),Qe.push(me)}}}class w{constructor(V){const H={},te=[];for(const Ce in V){const ve=V[Ce],Me=H[Ce]={};for(const Qe in ve){const et=ve[+Qe];if(!et||et.bitmap.width===0||et.bitmap.height===0)continue;const z={x:0,y:0,w:et.bitmap.width+2,h:et.bitmap.height+2};te.push(z),Me[Qe]={rect:z,metrics:et.metrics}}}const{w:fe,h:me}=o.p(te),Oe=new o.q({width:fe||1,height:me||1});for(const Ce in V){const ve=V[Ce];for(const Me in ve){const Qe=ve[+Me];if(!Qe||Qe.bitmap.width===0||Qe.bitmap.height===0)continue;const et=H[Ce][Me].rect;o.q.copy(Qe.bitmap,Oe,{x:0,y:0},{x:et.x+1,y:et.y+1},Qe.bitmap)}}this.image=Oe,this.positions=H}}o.bm("GlyphAtlas",w);class C{constructor(V){this.tileID=new o.O(V.tileID.overscaledZ,V.tileID.wrap,V.tileID.canonical.z,V.tileID.canonical.x,V.tileID.canonical.y),this.uid=V.uid,this.zoom=V.zoom,this.pixelRatio=V.pixelRatio,this.tileSize=V.tileSize,this.source=V.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=V.showCollisionBoxes,this.collectResourceTiming=!!V.collectResourceTiming,this.returnDependencies=!!V.returnDependencies,this.promoteId=V.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(V,H,te,fe,me){this.status="parsing",this.data=V,this.collisionBoxArray=new o.a3;const Oe=new o.bn(Object.keys(V.layers).sort()),Ce=new o.bo(this.tileID,this.promoteId);Ce.bucketLayerIDs=[];const ve={},Me={featureIndex:Ce,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:te},Qe=H.familiesBySource[this.source];for(const Fe in Qe){const De=V.layers[Fe];if(!De)continue;De.version===1&&o.w(`Vector tile source "${this.source}" layer "${Fe}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ve=Oe.encode(Fe),Ye=[];for(let nt=0;nt<De.length;nt++){const yt=De.feature(nt),dt=Ce.getId(yt,Fe);Ye.push({feature:yt,id:dt,index:nt,sourceLayerIndex:Ve})}for(const nt of Qe[Fe]){const yt=nt[0];yt.source!==this.source&&o.w(`layer.source = ${yt.source} does not equal this.source = ${this.source}`),yt.minzoom&&this.zoom<Math.floor(yt.minzoom)||yt.maxzoom&&this.zoom>=yt.maxzoom||yt.visibility!=="none"&&(P(nt,this.zoom,te),(ve[yt.id]=yt.createBucket({index:Ce.bucketLayerIDs.length,layers:nt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ve,sourceID:this.source})).populate(Ye,Me,this.tileID.canonical),Ce.bucketLayerIDs.push(nt.map(dt=>dt.id)))}}let et,z,Q,Y;const K=o.aH(Me.glyphDependencies,Fe=>Object.keys(Fe).map(Number));this.inFlightDependencies.forEach(Fe=>Fe?.cancel()),this.inFlightDependencies=[];const ee=++this.dependencySentinel;Object.keys(K).length?this.inFlightDependencies.push(fe.send("getGlyphs",{uid:this.uid,stacks:K,source:this.source,tileID:this.tileID,type:"glyphs"},(Fe,De)=>{ee===this.dependencySentinel&&(et||(et=Fe,z=De,Ue.call(this)))})):z={};const J=Object.keys(Me.iconDependencies);J.length?this.inFlightDependencies.push(fe.send("getImages",{icons:J,source:this.source,tileID:this.tileID,type:"icons"},(Fe,De)=>{ee===this.dependencySentinel&&(et||(et=Fe,Q=De,Ue.call(this)))})):Q={};const Ae=Object.keys(Me.patternDependencies);function Ue(){if(et)return me(et);if(z&&Q&&Y){const Fe=new w(z),De=new o.bp(Q,Y);for(const Ve in ve){const Ye=ve[Ve];Ye instanceof o.a4?(P(Ye.layers,this.zoom,te),o.bq({bucket:Ye,glyphMap:z,glyphPositions:Fe.positions,imageMap:Q,imagePositions:De.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Ye.hasPattern&&(Ye instanceof o.br||Ye instanceof o.bs||Ye instanceof o.bt)&&(P(Ye.layers,this.zoom,te),Ye.addFeatures(Me,this.tileID.canonical,De.patternPositions))}this.status="done",me(null,{buckets:Object.values(ve).filter(Ve=>!Ve.isEmpty()),featureIndex:Ce,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Fe.image,imageAtlas:De,glyphMap:this.returnDependencies?z:null,iconMap:this.returnDependencies?Q:null,glyphPositions:this.returnDependencies?Fe.positions:null})}}Ae.length?this.inFlightDependencies.push(fe.send("getImages",{icons:Ae,source:this.source,tileID:this.tileID,type:"patterns"},(Fe,De)=>{ee===this.dependencySentinel&&(et||(et=Fe,Y=De,Ue.call(this)))})):Y={},Ue.call(this)}}function P(ce,V,H){const te=new o.a8(V);for(const fe of ce)fe.recalculate(te,H)}function M(ce,V){const H=o.l(ce.request,(te,fe,me,Oe)=>{if(te)V(te);else if(fe)try{const Ce=new o.bw.VectorTile(new o.bv(fe));V(null,{vectorTile:Ce,rawData:fe,cacheControl:me,expires:Oe})}catch(Ce){const ve=new Uint8Array(fe);let Me=`Unable to parse the tile at ${ce.request.url}, `;Me+=ve[0]===31&&ve[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Ce.messge}`,V(new Error(Me))}});return()=>{H.cancel(),V()}}class B{constructor(V,H,te,fe){this.actor=V,this.layerIndex=H,this.availableImages=te,this.loadVectorData=fe||M,this.fetching={},this.loading={},this.loaded={}}loadTile(V,H){const te=V.uid;this.loading||(this.loading={});const fe=!!(V&&V.request&&V.request.collectResourceTiming)&&new o.bu(V.request),me=this.loading[te]=new C(V);me.abort=this.loadVectorData(V,(Oe,Ce)=>{if(delete this.loading[te],Oe||!Ce)return me.status="done",this.loaded[te]=me,H(Oe);const ve=Ce.rawData,Me={};Ce.expires&&(Me.expires=Ce.expires),Ce.cacheControl&&(Me.cacheControl=Ce.cacheControl);const Qe={};if(fe){const et=fe.finish();et&&(Qe.resourceTiming=JSON.parse(JSON.stringify(et)))}me.vectorTile=Ce.vectorTile,me.parse(Ce.vectorTile,this.layerIndex,this.availableImages,this.actor,(et,z)=>{if(delete this.fetching[te],et||!z)return H(et);H(null,o.e({rawTileData:ve.slice(0)},z,Me,Qe))}),this.loaded=this.loaded||{},this.loaded[te]=me,this.fetching[te]={rawTileData:ve,cacheControl:Me,resourceTiming:Qe}})}reloadTile(V,H){const te=this.loaded,fe=V.uid;if(te&&te[fe]){const me=te[fe];me.showCollisionBoxes=V.showCollisionBoxes,me.status==="parsing"?me.parse(me.vectorTile,this.layerIndex,this.availableImages,this.actor,(Oe,Ce)=>{if(Oe||!Ce)return H(Oe,Ce);let ve;if(this.fetching[fe]){const{rawTileData:Me,cacheControl:Qe,resourceTiming:et}=this.fetching[fe];delete this.fetching[fe],ve=o.e({rawTileData:Me.slice(0)},Ce,Qe,et)}else ve=Ce;H(null,ve)}):me.status==="done"&&(me.vectorTile?me.parse(me.vectorTile,this.layerIndex,this.availableImages,this.actor,H):H())}}abortTile(V,H){const te=this.loading,fe=V.uid;te&&te[fe]&&te[fe].abort&&(te[fe].abort(),delete te[fe]),H()}removeTile(V,H){const te=this.loaded,fe=V.uid;te&&te[fe]&&delete te[fe],H()}}class U{constructor(){this.loaded={}}loadTile(V,H){return o._(this,void 0,void 0,function*(){const{uid:te,encoding:fe,rawImageData:me,redFactor:Oe,greenFactor:Ce,blueFactor:ve,baseShift:Me}=V,Qe=me.width+2,et=me.height+2,z=o.a(me)?new o.R({width:Qe,height:et},yield o.bx(me,-1,-1,Qe,et)):me,Q=new o.by(te,z,fe,Oe,Ce,ve,Me);this.loaded=this.loaded||{},this.loaded[te]=Q,H(null,Q)})}removeTile(V){const H=this.loaded,te=V.uid;H&&H[te]&&delete H[te]}}function N(ce,V){if(ce.length!==0){j(ce[0],V);for(var H=1;H<ce.length;H++)j(ce[H],!V)}}function j(ce,V){for(var H=0,te=0,fe=0,me=ce.length,Oe=me-1;fe<me;Oe=fe++){var Ce=(ce[fe][0]-ce[Oe][0])*(ce[Oe][1]+ce[fe][1]),ve=H+Ce;te+=Math.abs(H)>=Math.abs(Ce)?H-ve+Ce:Ce-ve+H,H=ve}H+te>=0!=!!V&&ce.reverse()}var re=o.bz(function ce(V,H){var te,fe=V&&V.type;if(fe==="FeatureCollection")for(te=0;te<V.features.length;te++)ce(V.features[te],H);else if(fe==="GeometryCollection")for(te=0;te<V.geometries.length;te++)ce(V.geometries[te],H);else if(fe==="Feature")ce(V.geometry,H);else if(fe==="Polygon")N(V.coordinates,H);else if(fe==="MultiPolygon")for(te=0;te<V.coordinates.length;te++)N(V.coordinates[te],H);return V});const pe=o.bw.VectorTileFeature.prototype.toGeoJSON;var X={exports:{}},le=o.bA,ye=o.bw.VectorTileFeature,we=ae;function ae(ce,V){this.options=V||{},this.features=ce,this.length=ce.length}function ze(ce,V){this.id=typeof ce.id=="number"?ce.id:void 0,this.type=ce.type,this.rawGeometry=ce.type===1?[ce.geometry]:ce.geometry,this.properties=ce.tags,this.extent=V||4096}ae.prototype.feature=function(ce){return new ze(this.features[ce],this.options.extent)},ze.prototype.loadGeometry=function(){var ce=this.rawGeometry;this.geometry=[];for(var V=0;V<ce.length;V++){for(var H=ce[V],te=[],fe=0;fe<H.length;fe++)te.push(new le(H[fe][0],H[fe][1]));this.geometry.push(te)}return this.geometry},ze.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ce=this.geometry,V=1/0,H=-1/0,te=1/0,fe=-1/0,me=0;me<ce.length;me++)for(var Oe=ce[me],Ce=0;Ce<Oe.length;Ce++){var ve=Oe[Ce];V=Math.min(V,ve.x),H=Math.max(H,ve.x),te=Math.min(te,ve.y),fe=Math.max(fe,ve.y)}return[V,te,H,fe]},ze.prototype.toGeoJSON=ye.prototype.toGeoJSON;var Ie=o.bB,$e=we;function je(ce){var V=new Ie;return function(H,te){for(var fe in H.layers)te.writeMessage(3,Le,H.layers[fe])}(ce,V),V.finish()}function Le(ce,V){var H;V.writeVarintField(15,ce.version||1),V.writeStringField(1,ce.name||""),V.writeVarintField(5,ce.extent||4096);var te={keys:[],values:[],keycache:{},valuecache:{}};for(H=0;H<ce.length;H++)te.feature=ce.feature(H),V.writeMessage(2,it,te);var fe=te.keys;for(H=0;H<fe.length;H++)V.writeStringField(3,fe[H]);var me=te.values;for(H=0;H<me.length;H++)V.writeMessage(4,Yt,me[H])}function it(ce,V){var H=ce.feature;H.id!==void 0&&V.writeVarintField(1,H.id),V.writeMessage(2,ft,ce),V.writeVarintField(3,H.type),V.writeMessage(4,ht,H)}function ft(ce,V){var H=ce.feature,te=ce.keys,fe=ce.values,me=ce.keycache,Oe=ce.valuecache;for(var Ce in H.properties){var ve=H.properties[Ce],Me=me[Ce];if(ve!==null){Me===void 0&&(te.push(Ce),me[Ce]=Me=te.length-1),V.writeVarint(Me);var Qe=typeof ve;Qe!=="string"&&Qe!=="boolean"&&Qe!=="number"&&(ve=JSON.stringify(ve));var et=Qe+":"+ve,z=Oe[et];z===void 0&&(fe.push(ve),Oe[et]=z=fe.length-1),V.writeVarint(z)}}}function ct(ce,V){return(V<<3)+(7&ce)}function xt(ce){return ce<<1^ce>>31}function ht(ce,V){for(var H=ce.loadGeometry(),te=ce.type,fe=0,me=0,Oe=H.length,Ce=0;Ce<Oe;Ce++){var ve=H[Ce],Me=1;te===1&&(Me=ve.length),V.writeVarint(ct(1,Me));for(var Qe=te===3?ve.length-1:ve.length,et=0;et<Qe;et++){et===1&&te!==1&&V.writeVarint(ct(2,Qe-1));var z=ve[et].x-fe,Q=ve[et].y-me;V.writeVarint(xt(z)),V.writeVarint(xt(Q)),fe+=z,me+=Q}te===3&&V.writeVarint(ct(7,1))}}function Yt(ce,V){var H=typeof ce;H==="string"?V.writeStringField(1,ce):H==="boolean"?V.writeBooleanField(7,ce):H==="number"&&(ce%1!=0?V.writeDoubleField(3,ce):ce<0?V.writeSVarintField(6,ce):V.writeVarintField(5,ce))}X.exports=je,X.exports.fromVectorTileJs=je,X.exports.fromGeojsonVt=function(ce,V){V=V||{};var H={};for(var te in ce)H[te]=new $e(ce[te].features,V),H[te].name=te,H[te].version=V.version,H[te].extent=V.extent;return je({layers:H})},X.exports.GeoJSONWrapper=$e;var He=o.bz(X.exports);const Nt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ce=>ce},Ft=Math.fround||(ue=new Float32Array(1),ce=>(ue[0]=+ce,ue[0]));var ue;const Te=3,Ee=5,Se=6;class Ke{constructor(V){this.options=Object.assign(Object.create(Nt),V),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(V){const{log:H,minZoom:te,maxZoom:fe}=this.options;H&&console.time("total time");const me=`prepare ${V.length} points`;H&&console.time(me),this.points=V;const Oe=[];for(let ve=0;ve<V.length;ve++){const Me=V[ve];if(!Me.geometry)continue;const[Qe,et]=Me.geometry.coordinates,z=Ft(ut(Qe)),Q=Ft(tt(et));Oe.push(z,Q,1/0,ve,-1,1),this.options.reduce&&Oe.push(0)}let Ce=this.trees[fe+1]=this._createTree(Oe);H&&console.timeEnd(me);for(let ve=fe;ve>=te;ve--){const Me=+Date.now();Ce=this.trees[ve]=this._createTree(this._cluster(Ce,ve)),H&&console.log("z%d: %d clusters in %dms",ve,Ce.numItems,+Date.now()-Me)}return H&&console.timeEnd("total time"),this}getClusters(V,H){let te=((V[0]+180)%360+360)%360-180;const fe=Math.max(-90,Math.min(90,V[1]));let me=V[2]===180?180:((V[2]+180)%360+360)%360-180;const Oe=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)te=-180,me=180;else if(te>me){const et=this.getClusters([te,fe,180,Oe],H),z=this.getClusters([-180,fe,me,Oe],H);return et.concat(z)}const Ce=this.trees[this._limitZoom(H)],ve=Ce.range(ut(te),tt(Oe),ut(me),tt(fe)),Me=Ce.data,Qe=[];for(const et of ve){const z=this.stride*et;Qe.push(Me[z+Ee]>1?pt(Me,z,this.clusterProps):this.points[Me[z+Te]])}return Qe}getChildren(V){const H=this._getOriginId(V),te=this._getOriginZoom(V),fe="No cluster with the specified id.",me=this.trees[te];if(!me)throw new Error(fe);const Oe=me.data;if(H*this.stride>=Oe.length)throw new Error(fe);const Ce=this.options.radius/(this.options.extent*Math.pow(2,te-1)),ve=me.within(Oe[H*this.stride],Oe[H*this.stride+1],Ce),Me=[];for(const Qe of ve){const et=Qe*this.stride;Oe[et+4]===V&&Me.push(Oe[et+Ee]>1?pt(Oe,et,this.clusterProps):this.points[Oe[et+Te]])}if(Me.length===0)throw new Error(fe);return Me}getLeaves(V,H,te){const fe=[];return this._appendLeaves(fe,V,H=H||10,te=te||0,0),fe}getTile(V,H,te){const fe=this.trees[this._limitZoom(V)],me=Math.pow(2,V),{extent:Oe,radius:Ce}=this.options,ve=Ce/Oe,Me=(te-ve)/me,Qe=(te+1+ve)/me,et={features:[]};return this._addTileFeatures(fe.range((H-ve)/me,Me,(H+1+ve)/me,Qe),fe.data,H,te,me,et),H===0&&this._addTileFeatures(fe.range(1-ve/me,Me,1,Qe),fe.data,me,te,me,et),H===me-1&&this._addTileFeatures(fe.range(0,Me,ve/me,Qe),fe.data,-1,te,me,et),et.features.length?et:null}getClusterExpansionZoom(V){let H=this._getOriginZoom(V)-1;for(;H<=this.options.maxZoom;){const te=this.getChildren(V);if(H++,te.length!==1)break;V=te[0].properties.cluster_id}return H}_appendLeaves(V,H,te,fe,me){const Oe=this.getChildren(H);for(const Ce of Oe){const ve=Ce.properties;if(ve&&ve.cluster?me+ve.point_count<=fe?me+=ve.point_count:me=this._appendLeaves(V,ve.cluster_id,te,fe,me):me<fe?me++:V.push(Ce),V.length===te)break}return me}_createTree(V){const H=new o.av(V.length/this.stride|0,this.options.nodeSize,Float32Array);for(let te=0;te<V.length;te+=this.stride)H.add(V[te],V[te+1]);return H.finish(),H.data=V,H}_addTileFeatures(V,H,te,fe,me,Oe){for(const Ce of V){const ve=Ce*this.stride,Me=H[ve+Ee]>1;let Qe,et,z;if(Me)Qe=_t(H,ve,this.clusterProps),et=H[ve],z=H[ve+1];else{const K=this.points[H[ve+Te]];Qe=K.properties;const[ee,J]=K.geometry.coordinates;et=ut(ee),z=tt(J)}const Q={type:1,geometry:[[Math.round(this.options.extent*(et*me-te)),Math.round(this.options.extent*(z*me-fe))]],tags:Qe};let Y;Y=Me||this.options.generateId?H[ve+Te]:this.points[H[ve+Te]].id,Y!==void 0&&(Q.id=Y),Oe.features.push(Q)}}_limitZoom(V){return Math.max(this.options.minZoom,Math.min(Math.floor(+V),this.options.maxZoom+1))}_cluster(V,H){const{radius:te,extent:fe,reduce:me,minPoints:Oe}=this.options,Ce=te/(fe*Math.pow(2,H)),ve=V.data,Me=[],Qe=this.stride;for(let et=0;et<ve.length;et+=Qe){if(ve[et+2]<=H)continue;ve[et+2]=H;const z=ve[et],Q=ve[et+1],Y=V.within(ve[et],ve[et+1],Ce),K=ve[et+Ee];let ee=K;for(const J of Y){const Ae=J*Qe;ve[Ae+2]>H&&(ee+=ve[Ae+Ee])}if(ee>K&&ee>=Oe){let J,Ae=z*K,Ue=Q*K,Fe=-1;const De=((et/Qe|0)<<5)+(H+1)+this.points.length;for(const Ve of Y){const Ye=Ve*Qe;if(ve[Ye+2]<=H)continue;ve[Ye+2]=H;const nt=ve[Ye+Ee];Ae+=ve[Ye]*nt,Ue+=ve[Ye+1]*nt,ve[Ye+4]=De,me&&(J||(J=this._map(ve,et,!0),Fe=this.clusterProps.length,this.clusterProps.push(J)),me(J,this._map(ve,Ye)))}ve[et+4]=De,Me.push(Ae/ee,Ue/ee,1/0,De,-1,ee),me&&Me.push(Fe)}else{for(let J=0;J<Qe;J++)Me.push(ve[et+J]);if(ee>1)for(const J of Y){const Ae=J*Qe;if(!(ve[Ae+2]<=H)){ve[Ae+2]=H;for(let Ue=0;Ue<Qe;Ue++)Me.push(ve[Ae+Ue])}}}}return Me}_getOriginId(V){return V-this.points.length>>5}_getOriginZoom(V){return(V-this.points.length)%32}_map(V,H,te){if(V[H+Ee]>1){const Oe=this.clusterProps[V[H+Se]];return te?Object.assign({},Oe):Oe}const fe=this.points[V[H+Te]].properties,me=this.options.map(fe);return te&&me===fe?Object.assign({},me):me}}function pt(ce,V,H){return{type:"Feature",id:ce[V+Te],properties:_t(ce,V,H),geometry:{type:"Point",coordinates:[(te=ce[V],360*(te-.5)),Zt(ce[V+1])]}};var te}function _t(ce,V,H){const te=ce[V+Ee],fe=te>=1e4?`${Math.round(te/1e3)}k`:te>=1e3?Math.round(te/100)/10+"k":te,me=ce[V+Se],Oe=me===-1?{}:Object.assign({},H[me]);return Object.assign(Oe,{cluster:!0,cluster_id:ce[V+Te],point_count:te,point_count_abbreviated:fe})}function ut(ce){return ce/360+.5}function tt(ce){const V=Math.sin(ce*Math.PI/180),H=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return H<0?0:H>1?1:H}function Zt(ce){const V=(180-360*ce)*Math.PI/180;return 360*Math.atan(Math.exp(V))/Math.PI-90}function ge(ce,V,H,te){for(var fe,me=te,Oe=H-V>>1,Ce=H-V,ve=ce[V],Me=ce[V+1],Qe=ce[H],et=ce[H+1],z=V+3;z<H;z+=3){var Q=Qt(ce[z],ce[z+1],ve,Me,Qe,et);if(Q>me)fe=z,me=Q;else if(Q===me){var Y=Math.abs(z-Oe);Y<Ce&&(fe=z,Ce=Y)}}me>te&&(fe-V>3&&ge(ce,V,fe,te),ce[fe+2]=me,H-fe>3&&ge(ce,fe,H,te))}function Qt(ce,V,H,te,fe,me){var Oe=fe-H,Ce=me-te;if(Oe!==0||Ce!==0){var ve=((ce-H)*Oe+(V-te)*Ce)/(Oe*Oe+Ce*Ce);ve>1?(H=fe,te=me):ve>0&&(H+=Oe*ve,te+=Ce*ve)}return(Oe=ce-H)*Oe+(Ce=V-te)*Ce}function Xt(ce,V,H,te){var fe={id:ce===void 0?null:ce,type:V,geometry:H,tags:te,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(me){var Oe=me.geometry,Ce=me.type;if(Ce==="Point"||Ce==="MultiPoint"||Ce==="LineString")or(me,Oe);else if(Ce==="Polygon"||Ce==="MultiLineString")for(var ve=0;ve<Oe.length;ve++)or(me,Oe[ve]);else if(Ce==="MultiPolygon")for(ve=0;ve<Oe.length;ve++)for(var Me=0;Me<Oe[ve].length;Me++)or(me,Oe[ve][Me])}(fe),fe}function or(ce,V){for(var H=0;H<V.length;H+=3)ce.minX=Math.min(ce.minX,V[H]),ce.minY=Math.min(ce.minY,V[H+1]),ce.maxX=Math.max(ce.maxX,V[H]),ce.maxY=Math.max(ce.maxY,V[H+1])}function Jt(ce,V,H,te){if(V.geometry){var fe=V.geometry.coordinates,me=V.geometry.type,Oe=Math.pow(H.tolerance/((1<<H.maxZoom)*H.extent),2),Ce=[],ve=V.id;if(H.promoteId?ve=V.properties[H.promoteId]:H.generateId&&(ve=te||0),me==="Point")wt(fe,Ce);else if(me==="MultiPoint")for(var Me=0;Me<fe.length;Me++)wt(fe[Me],Ce);else if(me==="LineString")cr(fe,Ce,Oe,!1);else if(me==="MultiLineString"){if(H.lineMetrics){for(Me=0;Me<fe.length;Me++)cr(fe[Me],Ce=[],Oe,!1),ce.push(Xt(ve,"LineString",Ce,V.properties));return}Pr(fe,Ce,Oe,!1)}else if(me==="Polygon")Pr(fe,Ce,Oe,!0);else{if(me!=="MultiPolygon"){if(me==="GeometryCollection"){for(Me=0;Me<V.geometry.geometries.length;Me++)Jt(ce,{id:ve,geometry:V.geometry.geometries[Me],properties:V.properties},H,te);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Me=0;Me<fe.length;Me++){var Qe=[];Pr(fe[Me],Qe,Oe,!0),Ce.push(Qe)}}ce.push(Xt(ve,me,Ce,V.properties))}}function wt(ce,V){V.push(qe(ce[0])),V.push(Cr(ce[1])),V.push(0)}function cr(ce,V,H,te){for(var fe,me,Oe=0,Ce=0;Ce<ce.length;Ce++){var ve=qe(ce[Ce][0]),Me=Cr(ce[Ce][1]);V.push(ve),V.push(Me),V.push(0),Ce>0&&(Oe+=te?(fe*Me-ve*me)/2:Math.sqrt(Math.pow(ve-fe,2)+Math.pow(Me-me,2))),fe=ve,me=Me}var Qe=V.length-3;V[2]=1,ge(V,0,Qe,H),V[Qe+2]=1,V.size=Math.abs(Oe),V.start=0,V.end=V.size}function Pr(ce,V,H,te){for(var fe=0;fe<ce.length;fe++){var me=[];cr(ce[fe],me,H,te),V.push(me)}}function qe(ce){return ce/360+.5}function Cr(ce){var V=Math.sin(ce*Math.PI/180),H=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return H<0?0:H>1?1:H}function Br(ce,V,H,te,fe,me,Oe,Ce){if(te/=V,me>=(H/=V)&&Oe<te)return ce;if(Oe<H||me>=te)return null;for(var ve=[],Me=0;Me<ce.length;Me++){var Qe=ce[Me],et=Qe.geometry,z=Qe.type,Q=fe===0?Qe.minX:Qe.minY,Y=fe===0?Qe.maxX:Qe.maxY;if(Q>=H&&Y<te)ve.push(Qe);else if(!(Y<H||Q>=te)){var K=[];if(z==="Point"||z==="MultiPoint")ar(et,K,H,te,fe);else if(z==="LineString")Gt(et,K,H,te,fe,!1,Ce.lineMetrics);else if(z==="MultiLineString")ir(et,K,H,te,fe,!1);else if(z==="Polygon")ir(et,K,H,te,fe,!0);else if(z==="MultiPolygon")for(var ee=0;ee<et.length;ee++){var J=[];ir(et[ee],J,H,te,fe,!0),J.length&&K.push(J)}if(K.length){if(Ce.lineMetrics&&z==="LineString"){for(ee=0;ee<K.length;ee++)ve.push(Xt(Qe.id,z,K[ee],Qe.tags));continue}z!=="LineString"&&z!=="MultiLineString"||(K.length===1?(z="LineString",K=K[0]):z="MultiLineString"),z!=="Point"&&z!=="MultiPoint"||(z=K.length===3?"Point":"MultiPoint"),ve.push(Xt(Qe.id,z,K,Qe.tags))}}}return ve.length?ve:null}function ar(ce,V,H,te,fe){for(var me=0;me<ce.length;me+=3){var Oe=ce[me+fe];Oe>=H&&Oe<=te&&(V.push(ce[me]),V.push(ce[me+1]),V.push(ce[me+2]))}}function Gt(ce,V,H,te,fe,me,Oe){for(var Ce,ve,Me=ur(ce),Qe=fe===0?wr:Nr,et=ce.start,z=0;z<ce.length-3;z+=3){var Q=ce[z],Y=ce[z+1],K=ce[z+2],ee=ce[z+3],J=ce[z+4],Ae=fe===0?Q:Y,Ue=fe===0?ee:J,Fe=!1;Oe&&(Ce=Math.sqrt(Math.pow(Q-ee,2)+Math.pow(Y-J,2))),Ae<H?Ue>H&&(ve=Qe(Me,Q,Y,ee,J,H),Oe&&(Me.start=et+Ce*ve)):Ae>te?Ue<te&&(ve=Qe(Me,Q,Y,ee,J,te),Oe&&(Me.start=et+Ce*ve)):Dr(Me,Q,Y,K),Ue<H&&Ae>=H&&(ve=Qe(Me,Q,Y,ee,J,H),Fe=!0),Ue>te&&Ae<=te&&(ve=Qe(Me,Q,Y,ee,J,te),Fe=!0),!me&&Fe&&(Oe&&(Me.end=et+Ce*ve),V.push(Me),Me=ur(ce)),Oe&&(et+=Ce)}var De=ce.length-3;Q=ce[De],Y=ce[De+1],K=ce[De+2],(Ae=fe===0?Q:Y)>=H&&Ae<=te&&Dr(Me,Q,Y,K),De=Me.length-3,me&&De>=3&&(Me[De]!==Me[0]||Me[De+1]!==Me[1])&&Dr(Me,Me[0],Me[1],Me[2]),Me.length&&V.push(Me)}function ur(ce){var V=[];return V.size=ce.size,V.start=ce.start,V.end=ce.end,V}function ir(ce,V,H,te,fe,me){for(var Oe=0;Oe<ce.length;Oe++)Gt(ce[Oe],V,H,te,fe,me,!1)}function Dr(ce,V,H,te){ce.push(V),ce.push(H),ce.push(te)}function wr(ce,V,H,te,fe,me){var Oe=(me-V)/(te-V);return ce.push(me),ce.push(H+(fe-H)*Oe),ce.push(1),Oe}function Nr(ce,V,H,te,fe,me){var Oe=(me-H)/(fe-H);return ce.push(V+(te-V)*Oe),ce.push(me),ce.push(1),Oe}function Ht(ce,V){for(var H=[],te=0;te<ce.length;te++){var fe,me=ce[te],Oe=me.type;if(Oe==="Point"||Oe==="MultiPoint"||Oe==="LineString")fe=br(me.geometry,V);else if(Oe==="MultiLineString"||Oe==="Polygon"){fe=[];for(var Ce=0;Ce<me.geometry.length;Ce++)fe.push(br(me.geometry[Ce],V))}else if(Oe==="MultiPolygon")for(fe=[],Ce=0;Ce<me.geometry.length;Ce++){for(var ve=[],Me=0;Me<me.geometry[Ce].length;Me++)ve.push(br(me.geometry[Ce][Me],V));fe.push(ve)}H.push(Xt(me.id,Oe,fe,me.tags))}return H}function br(ce,V){var H=[];H.size=ce.size,ce.start!==void 0&&(H.start=ce.start,H.end=ce.end);for(var te=0;te<ce.length;te+=3)H.push(ce[te]+V,ce[te+1],ce[te+2]);return H}function ot(ce,V){if(ce.transformed)return ce;var H,te,fe,me=1<<ce.z,Oe=ce.x,Ce=ce.y;for(H=0;H<ce.features.length;H++){var ve=ce.features[H],Me=ve.geometry,Qe=ve.type;if(ve.geometry=[],Qe===1)for(te=0;te<Me.length;te+=2)ve.geometry.push(Pt(Me[te],Me[te+1],V,me,Oe,Ce));else for(te=0;te<Me.length;te++){var et=[];for(fe=0;fe<Me[te].length;fe+=2)et.push(Pt(Me[te][fe],Me[te][fe+1],V,me,Oe,Ce));ve.geometry.push(et)}}return ce.transformed=!0,ce}function Pt(ce,V,H,te,fe,me){return[Math.round(H*(ce*te-fe)),Math.round(H*(V*te-me))]}function Mt(ce,V,H,te,fe){for(var me=V===fe.maxZoom?0:fe.tolerance/((1<<V)*fe.extent),Oe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:H,y:te,z:V,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ce=0;Ce<ce.length;Ce++){Oe.numFeatures++,lr(Oe,ce[Ce],me,fe);var ve=ce[Ce].minX,Me=ce[Ce].minY,Qe=ce[Ce].maxX,et=ce[Ce].maxY;ve<Oe.minX&&(Oe.minX=ve),Me<Oe.minY&&(Oe.minY=Me),Qe>Oe.maxX&&(Oe.maxX=Qe),et>Oe.maxY&&(Oe.maxY=et)}return Oe}function lr(ce,V,H,te){var fe=V.geometry,me=V.type,Oe=[];if(me==="Point"||me==="MultiPoint")for(var Ce=0;Ce<fe.length;Ce+=3)Oe.push(fe[Ce]),Oe.push(fe[Ce+1]),ce.numPoints++,ce.numSimplified++;else if(me==="LineString")tr(Oe,fe,ce,H,!1,!1);else if(me==="MultiLineString"||me==="Polygon")for(Ce=0;Ce<fe.length;Ce++)tr(Oe,fe[Ce],ce,H,me==="Polygon",Ce===0);else if(me==="MultiPolygon")for(var ve=0;ve<fe.length;ve++){var Me=fe[ve];for(Ce=0;Ce<Me.length;Ce++)tr(Oe,Me[Ce],ce,H,!0,Ce===0)}if(Oe.length){var Qe=V.tags||null;if(me==="LineString"&&te.lineMetrics){for(var et in Qe={},V.tags)Qe[et]=V.tags[et];Qe.mapbox_clip_start=fe.start/fe.size,Qe.mapbox_clip_end=fe.end/fe.size}var z={geometry:Oe,type:me==="Polygon"||me==="MultiPolygon"?3:me==="LineString"||me==="MultiLineString"?2:1,tags:Qe};V.id!==null&&(z.id=V.id),ce.features.push(z)}}function tr(ce,V,H,te,fe,me){var Oe=te*te;if(te>0&&V.size<(fe?Oe:te))H.numPoints+=V.length/3;else{for(var Ce=[],ve=0;ve<V.length;ve+=3)(te===0||V[ve+2]>Oe)&&(H.numSimplified++,Ce.push(V[ve]),Ce.push(V[ve+1])),H.numPoints++;fe&&function(Me,Qe){for(var et=0,z=0,Q=Me.length,Y=Q-2;z<Q;Y=z,z+=2)et+=(Me[z]-Me[Y])*(Me[z+1]+Me[Y+1]);if(et>0===Qe)for(z=0,Q=Me.length;z<Q/2;z+=2){var K=Me[z],ee=Me[z+1];Me[z]=Me[Q-2-z],Me[z+1]=Me[Q-1-z],Me[Q-2-z]=K,Me[Q-1-z]=ee}}(Ce,me),ce.push(Ce)}}function at(ce,V){var H=(V=this.options=function(fe,me){for(var Oe in me)fe[Oe]=me[Oe];return fe}(Object.create(this.options),V)).debug;if(H&&console.time("preprocess data"),V.maxZoom<0||V.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(V.promoteId&&V.generateId)throw new Error("promoteId and generateId cannot be used together.");var te=function(fe,me){var Oe=[];if(fe.type==="FeatureCollection")for(var Ce=0;Ce<fe.features.length;Ce++)Jt(Oe,fe.features[Ce],me,Ce);else Jt(Oe,fe.type==="Feature"?fe:{geometry:fe},me);return Oe}(ce,V);this.tiles={},this.tileCoords=[],H&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",V.indexMaxZoom,V.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),te=function(fe,me){var Oe=me.buffer/me.extent,Ce=fe,ve=Br(fe,1,-1-Oe,Oe,0,-1,2,me),Me=Br(fe,1,1-Oe,2+Oe,0,-1,2,me);return(ve||Me)&&(Ce=Br(fe,1,-Oe,1+Oe,0,-1,2,me)||[],ve&&(Ce=Ht(ve,1).concat(Ce)),Me&&(Ce=Ce.concat(Ht(Me,-1)))),Ce}(te,V),te.length&&this.splitTile(te,0,0,0),H&&(te.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Rt(ce,V,H){return 32*((1<<ce)*H+V)+ce}function Vt(ce,V){return V?ce.properties[V]:ce.id}function Lr(ce,V){if(ce==null)return!0;if(ce.type==="Feature")return Vt(ce,V)!=null;if(ce.type==="FeatureCollection"){const H=new Set;for(const te of ce.features){const fe=Vt(te,V);if(fe==null||H.has(fe))return!1;H.add(fe)}return!0}return!1}function Kr(ce,V){const H=new Map;if(ce!=null)if(ce.type==="Feature")H.set(Vt(ce,V),ce);else for(const te of ce.features)H.set(Vt(te,V),te);return H}at.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},at.prototype.splitTile=function(ce,V,H,te,fe,me,Oe){for(var Ce=[ce,V,H,te],ve=this.options,Me=ve.debug;Ce.length;){te=Ce.pop(),H=Ce.pop(),V=Ce.pop(),ce=Ce.pop();var Qe=1<<V,et=Rt(V,H,te),z=this.tiles[et];if(!z&&(Me>1&&console.time("creation"),z=this.tiles[et]=Mt(ce,V,H,te,ve),this.tileCoords.push({z:V,x:H,y:te}),Me)){Me>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",V,H,te,z.numFeatures,z.numPoints,z.numSimplified),console.timeEnd("creation"));var Q="z"+V;this.stats[Q]=(this.stats[Q]||0)+1,this.total++}if(z.source=ce,fe){if(V===ve.maxZoom||V===fe)continue;var Y=1<<fe-V;if(H!==Math.floor(me/Y)||te!==Math.floor(Oe/Y))continue}else if(V===ve.indexMaxZoom||z.numPoints<=ve.indexMaxPoints)continue;if(z.source=null,ce.length!==0){Me>1&&console.time("clipping");var K,ee,J,Ae,Ue,Fe,De=.5*ve.buffer/ve.extent,Ve=.5-De,Ye=.5+De,nt=1+De;K=ee=J=Ae=null,Ue=Br(ce,Qe,H-De,H+Ye,0,z.minX,z.maxX,ve),Fe=Br(ce,Qe,H+Ve,H+nt,0,z.minX,z.maxX,ve),ce=null,Ue&&(K=Br(Ue,Qe,te-De,te+Ye,1,z.minY,z.maxY,ve),ee=Br(Ue,Qe,te+Ve,te+nt,1,z.minY,z.maxY,ve),Ue=null),Fe&&(J=Br(Fe,Qe,te-De,te+Ye,1,z.minY,z.maxY,ve),Ae=Br(Fe,Qe,te+Ve,te+nt,1,z.minY,z.maxY,ve),Fe=null),Me>1&&console.timeEnd("clipping"),Ce.push(K||[],V+1,2*H,2*te),Ce.push(ee||[],V+1,2*H,2*te+1),Ce.push(J||[],V+1,2*H+1,2*te),Ce.push(Ae||[],V+1,2*H+1,2*te+1)}}},at.prototype.getTile=function(ce,V,H){var te=this.options,fe=te.extent,me=te.debug;if(ce<0||ce>24)return null;var Oe=1<<ce,Ce=Rt(ce,V=(V%Oe+Oe)%Oe,H);if(this.tiles[Ce])return ot(this.tiles[Ce],fe);me>1&&console.log("drilling down to z%d-%d-%d",ce,V,H);for(var ve,Me=ce,Qe=V,et=H;!ve&&Me>0;)Me--,Qe=Math.floor(Qe/2),et=Math.floor(et/2),ve=this.tiles[Rt(Me,Qe,et)];return ve&&ve.source?(me>1&&console.log("found parent tile z%d-%d-%d",Me,Qe,et),me>1&&console.time("drilling down"),this.splitTile(ve.source,Me,Qe,et,ce,V,H),me>1&&console.timeEnd("drilling down"),this.tiles[Ce]?ot(this.tiles[Ce],fe):null):null};class rr extends B{constructor(V,H,te,fe){super(V,H,te),this._dataUpdateable=new Map,this.loadGeoJSON=(me,Oe)=>{const{promoteId:Ce}=me;if(me.request)return o.f(me.request,(ve,Me,Qe,et)=>{this._dataUpdateable=Lr(Me,Ce)?Kr(Me,Ce):void 0,Oe(ve,Me,Qe,et)});if(typeof me.data=="string")try{const ve=JSON.parse(me.data);this._dataUpdateable=Lr(ve,Ce)?Kr(ve,Ce):void 0,Oe(null,ve)}catch{Oe(new Error(`Input data given to '${me.source}' is not a valid GeoJSON object.`))}else me.dataDiff?this._dataUpdateable?(function(ve,Me,Qe){var et,z,Q,Y;if(Me.removeAll&&ve.clear(),Me.remove)for(const K of Me.remove)ve.delete(K);if(Me.add)for(const K of Me.add){const ee=Vt(K,Qe);ee!=null&&ve.set(ee,K)}if(Me.update)for(const K of Me.update){let ee=ve.get(K.id);if(ee==null)continue;const J=!K.removeAllProperties&&(((et=K.removeProperties)===null||et===void 0?void 0:et.length)>0||((z=K.addOrUpdateProperties)===null||z===void 0?void 0:z.length)>0);if((K.newGeometry||K.removeAllProperties||J)&&(ee=Object.assign({},ee),ve.set(K.id,ee),J&&(ee.properties=Object.assign({},ee.properties))),K.newGeometry&&(ee.geometry=K.newGeometry),K.removeAllProperties)ee.properties={};else if(((Q=K.removeProperties)===null||Q===void 0?void 0:Q.length)>0)for(const Ae of K.removeProperties)Object.prototype.hasOwnProperty.call(ee.properties,Ae)&&delete ee.properties[Ae];if(((Y=K.addOrUpdateProperties)===null||Y===void 0?void 0:Y.length)>0)for(const{key:Ae,value:Ue}of K.addOrUpdateProperties)ee.properties[Ae]=Ue}}(this._dataUpdateable,me.dataDiff,Ce),Oe(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):Oe(new Error(`Cannot update existing geojson data in ${me.source}`)):Oe(new Error(`Input data given to '${me.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},this.loadVectorData=this.loadGeoJSONTile,fe&&(this.loadGeoJSON=fe)}loadGeoJSONTile(V,H){const te=V.tileID.canonical;if(!this._geoJSONIndex)return H(null,null);const fe=this._geoJSONIndex.getTile(te.z,te.x,te.y);if(!fe)return H(null,null);const me=new class{constructor(Ce){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.N,this.length=Ce.length,this._features=Ce}feature(Ce){return new class{constructor(ve){this._feature=ve,this.extent=o.N,this.type=ve.type,this.properties=ve.tags,"id"in ve&&!isNaN(ve.id)&&(this.id=parseInt(ve.id,10))}loadGeometry(){if(this._feature.type===1){const ve=[];for(const Me of this._feature.geometry)ve.push([new o.P(Me[0],Me[1])]);return ve}{const ve=[];for(const Me of this._feature.geometry){const Qe=[];for(const et of Me)Qe.push(new o.P(et[0],et[1]));ve.push(Qe)}return ve}}toGeoJSON(ve,Me,Qe){return pe.call(this,ve,Me,Qe)}}(this._features[Ce])}}(fe.features);let Oe=He(me);Oe.byteOffset===0&&Oe.byteLength===Oe.buffer.byteLength||(Oe=new Uint8Array(Oe)),H(null,{vectorTile:me,rawData:Oe.buffer})}loadData(V,H){var te;(te=this._pendingRequest)===null||te===void 0||te.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const fe=!!(V&&V.request&&V.request.collectResourceTiming)&&new o.bu(V.request);this._pendingCallback=H,this._pendingRequest=this.loadGeoJSON(V,(me,Oe)=>{if(delete this._pendingCallback,delete this._pendingRequest,me||!Oe)return H(me);if(typeof Oe!="object")return H(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`));{re(Oe,!0);try{if(V.filter){const ve=o.bC(V.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ve.result==="error")throw new Error(ve.value.map(Qe=>`${Qe.key}: ${Qe.message}`).join(", "));Oe={type:"FeatureCollection",features:Oe.features.filter(Qe=>ve.value.evaluate({zoom:0},Qe))}}this._geoJSONIndex=V.cluster?new Ke(function({superclusterOptions:ve,clusterProperties:Me}){if(!Me||!ve)return ve;const Qe={},et={},z={accumulated:null,zoom:0},Q={properties:null},Y=Object.keys(Me);for(const K of Y){const[ee,J]=Me[K],Ae=o.bC(J),Ue=o.bC(typeof ee=="string"?[ee,["accumulated"],["get",K]]:ee);Qe[K]=Ae.value,et[K]=Ue.value}return ve.map=K=>{Q.properties=K;const ee={};for(const J of Y)ee[J]=Qe[J].evaluate(z,Q);return ee},ve.reduce=(K,ee)=>{Q.properties=ee;for(const J of Y)z.accumulated=K[J],K[J]=et[J].evaluate(z,Q)},ve}(V)).load(Oe.features):function(ve,Me){return new at(ve,Me)}(Oe,V.geojsonVtOptions)}catch(ve){return H(ve)}this.loaded={};const Ce={};if(fe){const ve=fe.finish();ve&&(Ce.resourceTiming={},Ce.resourceTiming[V.source]=JSON.parse(JSON.stringify(ve)))}H(null,Ce)}})}reloadTile(V,H){const te=this.loaded;return te&&te[V.uid]?super.reloadTile(V,H):this.loadTile(V,H)}removeSource(V,H){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),H()}getClusterExpansionZoom(V,H){try{H(null,this._geoJSONIndex.getClusterExpansionZoom(V.clusterId))}catch(te){H(te)}}getClusterChildren(V,H){try{H(null,this._geoJSONIndex.getChildren(V.clusterId))}catch(te){H(te)}}getClusterLeaves(V,H){try{H(null,this._geoJSONIndex.getLeaves(V.clusterId,V.limit,V.offset))}catch(te){H(te)}}}class Aa{constructor(V){this.self=V,this.actor=new o.C(V,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:B,geojson:rr},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(H,te)=>{if(this.workerSourceTypes[H])throw new Error(`Worker source with name "${H}" already registered.`);this.workerSourceTypes[H]=te},this.self.registerRTLTextPlugin=H=>{if(o.bD.isParsed())throw new Error("RTL text plugin already registered.");o.bD.applyArabicShaping=H.applyArabicShaping,o.bD.processBidirectionalText=H.processBidirectionalText,o.bD.processStyledBidirectionalText=H.processStyledBidirectionalText}}setReferrer(V,H){this.referrer=H}setImages(V,H,te){this.availableImages[V]=H;for(const fe in this.workerSources[V]){const me=this.workerSources[V][fe];for(const Oe in me)me[Oe].availableImages=H}te()}setLayers(V,H,te){this.getLayerIndex(V).replace(H),te()}updateLayers(V,H,te){this.getLayerIndex(V).update(H.layers,H.removedIds),te()}loadTile(V,H,te){this.getWorkerSource(V,H.type,H.source).loadTile(H,te)}loadDEMTile(V,H,te){this.getDEMWorkerSource(V,H.source).loadTile(H,te)}reloadTile(V,H,te){this.getWorkerSource(V,H.type,H.source).reloadTile(H,te)}abortTile(V,H,te){this.getWorkerSource(V,H.type,H.source).abortTile(H,te)}removeTile(V,H,te){this.getWorkerSource(V,H.type,H.source).removeTile(H,te)}removeDEMTile(V,H){this.getDEMWorkerSource(V,H.source).removeTile(H)}removeSource(V,H,te){if(!this.workerSources[V]||!this.workerSources[V][H.type]||!this.workerSources[V][H.type][H.source])return;const fe=this.workerSources[V][H.type][H.source];delete this.workerSources[V][H.type][H.source],fe.removeSource!==void 0?fe.removeSource(H,te):te()}loadWorkerSource(V,H,te){try{this.self.importScripts(H.url),te()}catch(fe){te(fe.toString())}}syncRTLPluginState(V,H,te){try{o.bD.setState(H);const fe=o.bD.getPluginURL();if(o.bD.isLoaded()&&!o.bD.isParsed()&&fe!=null){this.self.importScripts(fe);const me=o.bD.isParsed();te(me?void 0:new Error(`RTL Text Plugin failed to import scripts from ${fe}`),me)}}catch(fe){te(fe.toString())}}getAvailableImages(V){let H=this.availableImages[V];return H||(H=[]),H}getLayerIndex(V){let H=this.layerIndexes[V];return H||(H=this.layerIndexes[V]=new E),H}getWorkerSource(V,H,te){return this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][H]||(this.workerSources[V][H]={}),this.workerSources[V][H][te]||(this.workerSources[V][H][te]=new this.workerSourceTypes[H]({send:(fe,me,Oe)=>{this.actor.send(fe,me,Oe,V)}},this.getLayerIndex(V),this.getAvailableImages(V))),this.workerSources[V][H][te]}getDEMWorkerSource(V,H){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][H]||(this.demWorkerSources[V][H]=new U),this.demWorkerSources[V][H]}}return o.i()&&(self.worker=new Aa(self)),Aa}),m(["./shared"],function(o){var E="3.6.2";class w{static testProp(r){if(!w.docStyle)return r[0];for(let l=0;l<r.length;l++)if(r[l]in w.docStyle)return r[l];return r[0]}static create(r,l,f){const p=window.document.createElement(r);return l!==void 0&&(p.className=l),f&&f.appendChild(p),p}static createNS(r,l){return window.document.createElementNS(r,l)}static disableDrag(){w.docStyle&&w.selectProp&&(w.userSelect=w.docStyle[w.selectProp],w.docStyle[w.selectProp]="none")}static enableDrag(){w.docStyle&&w.selectProp&&(w.docStyle[w.selectProp]=w.userSelect)}static setTransform(r,l){r.style[w.transformProp]=l}static addEventListener(r,l,f,p={}){r.addEventListener(l,f,"passive"in p?p:p.capture)}static removeEventListener(r,l,f,p={}){r.removeEventListener(l,f,"passive"in p?p:p.capture)}static suppressClickInternal(r){r.preventDefault(),r.stopPropagation(),window.removeEventListener("click",w.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",w.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",w.suppressClickInternal,!0)},0)}static mousePos(r,l){const f=r.getBoundingClientRect();return new o.P(l.clientX-f.left-r.clientLeft,l.clientY-f.top-r.clientTop)}static touchPos(r,l){const f=r.getBoundingClientRect(),p=[];for(let y=0;y<l.length;y++)p.push(new o.P(l[y].clientX-f.left-r.clientLeft,l[y].clientY-f.top-r.clientTop));return p}static mouseButton(r){return r.button}static remove(r){r.parentNode&&r.parentNode.removeChild(r)}}w.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,w.selectProp=w.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),w.transformProp=w.testProp(["transform","WebkitTransform"]);const C={supported:!1,testSupport:function(g){!B&&M&&(U?N(g):P=g)}};let P,M,B=!1,U=!1;function N(g){const r=g.createTexture();g.bindTexture(g.TEXTURE_2D,r);try{if(g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,M),g.isContextLost())return;C.supported=!0}catch{}g.deleteTexture(r),B=!0}var j,re;typeof document<"u"&&(M=document.createElement("img"),M.onload=function(){P&&N(P),P=null,U=!0},M.onerror=function(){B=!0,P=null},M.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(g){let r,l,f,p;g.resetRequestQueue=()=>{r=[],l=0,f=0,p={}},g.addThrottleControl=F=>{const L=f++;return p[L]=F,L},g.removeThrottleControl=F=>{delete p[F],S()},g.getImage=(F,L,R=!0)=>{C.supported&&(F.headers||(F.headers={}),F.headers.accept="image/webp,*/*");const W={requestParameters:F,supportImageRefresh:R,callback:L,cancelled:!1,completed:!1,cancel:()=>{W.completed||W.cancelled||(W.cancelled=!0,W.innerRequest&&(W.innerRequest.cancel(),l--),S())}};return r.push(W),S(),W};const y=F=>{const{requestParameters:L,supportImageRefresh:R,callback:W}=F;return o.e(L,{type:"image"}),(R!==!1||o.i()||o.g(L.url)||L.headers&&!Object.keys(L.headers).reduce((oe,se)=>oe&&se==="accept",!0)?o.m:A)(L,(oe,se,de,ie)=>{T(F,W,oe,se,de,ie)})},T=(F,L,R,W,oe,se)=>{R?L(R):W instanceof HTMLImageElement||o.a(W)?L(null,W):W&&((de,ie)=>{typeof createImageBitmap=="function"?o.b(de,ie):o.d(de,ie)})(W,(de,ie)=>{de!=null?L(de):ie!=null&&L(null,ie,{cacheControl:oe,expires:se})}),F.cancelled||(F.completed=!0,l--,S())},S=()=>{const F=(()=>{const L=Object.keys(p);let R=!1;if(L.length>0){for(const W of L)if(R=p[W](),R)break}return R})()?o.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:o.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let L=l;L<F&&r.length>0;L++){const R=r.shift();if(R.cancelled){L--;continue}const W=y(R);l++,R.innerRequest=W}},A=(F,L)=>{const R=new Image,W=F.url;let oe=!1;const se=F.credentials;return se&&se==="include"?R.crossOrigin="use-credentials":(se&&se==="same-origin"||!o.s(W))&&(R.crossOrigin="anonymous"),R.fetchPriority="high",R.onload=()=>{L(null,R),R.onerror=R.onload=null},R.onerror=()=>{oe||L(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),R.onerror=R.onload=null},R.src=W,{cancel:()=>{oe=!0,R.src=""}}}}(j||(j={})),j.resetRequestQueue(),function(g){g.Glyphs="Glyphs",g.Image="Image",g.Source="Source",g.SpriteImage="SpriteImage",g.SpriteJSON="SpriteJSON",g.Style="Style",g.Tile="Tile",g.Unknown="Unknown"}(re||(re={}));class pe{constructor(r){this._transformRequestFn=r}transformRequest(r,l){return this._transformRequestFn&&this._transformRequestFn(r,l)||{url:r}}normalizeSpriteURL(r,l,f){const p=function(y){const T=y.match(X);if(!T)throw new Error(`Unable to parse URL "${y}"`);return{protocol:T[1],authority:T[2],path:T[3]||"/",params:T[4]?T[4].split("&"):[]}}(r);return p.path+=`${l}${f}`,function(y){const T=y.params.length?`?${y.params.join("&")}`:"";return`${y.protocol}://${y.authority}${y.path}${T}`}(p)}setTransformRequest(r){this._transformRequestFn=r}}const X=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function le(g){var r=new o.A(3);return r[0]=g[0],r[1]=g[1],r[2]=g[2],r}var ye,we=function(g,r,l){return g[0]=r[0]-l[0],g[1]=r[1]-l[1],g[2]=r[2]-l[2],g};ye=new o.A(3),o.A!=Float32Array&&(ye[0]=0,ye[1]=0,ye[2]=0);var ae=function(g){var r=g[0],l=g[1];return r*r+l*l};function ze(g){const r=[];if(typeof g=="string")r.push({id:"default",url:g});else if(g&&g.length>0){const l=[];for(const{id:f,url:p}of g){const y=`${f}${p}`;l.indexOf(y)===-1&&(l.push(y),r.push({id:f,url:p}))}}return r}function Ie(g,r,l,f,p){if(f)return void g(f);if(p!==Object.values(r).length||p!==Object.values(l).length)return;const y={};for(const T in r){y[T]={};const S=o.h.getImageCanvasContext(l[T]),A=r[T];for(const F in A){const{width:L,height:R,x:W,y:oe,sdf:se,pixelRatio:de,stretchX:ie,stretchY:Pe,content:Ge}=A[F];y[T][F]={data:null,pixelRatio:de,sdf:se,stretchX:ie,stretchY:Pe,content:Ge,spriteData:{width:L,height:R,x:W,y:oe,context:S}}}}g(null,y)}(function(){var g=new o.A(2);o.A!=Float32Array&&(g[0]=0,g[1]=0)})();class $e{constructor(r,l,f,p){this.context=r,this.format=f,this.texture=r.gl.createTexture(),this.update(l,p)}update(r,l,f){const{width:p,height:y}=r,T=!(this.size&&this.size[0]===p&&this.size[1]===y||f),{context:S}=this,{gl:A}=S;if(this.useMipmap=!!(l&&l.useMipmap),A.bindTexture(A.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===A.RGBA&&(!l||l.premultiply!==!1)),T)this.size=[p,y],r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||o.a(r)?A.texImage2D(A.TEXTURE_2D,0,this.format,this.format,A.UNSIGNED_BYTE,r):A.texImage2D(A.TEXTURE_2D,0,this.format,p,y,0,this.format,A.UNSIGNED_BYTE,r.data);else{const{x:F,y:L}=f||{x:0,y:0};r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||o.a(r)?A.texSubImage2D(A.TEXTURE_2D,0,F,L,A.RGBA,A.UNSIGNED_BYTE,r):A.texSubImage2D(A.TEXTURE_2D,0,F,L,p,y,A.RGBA,A.UNSIGNED_BYTE,r.data)}this.useMipmap&&this.isSizePowerOfTwo()&&A.generateMipmap(A.TEXTURE_2D)}bind(r,l,f){const{context:p}=this,{gl:y}=p;y.bindTexture(y.TEXTURE_2D,this.texture),f!==y.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(f=y.LINEAR),r!==this.filter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,r),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,f||r),this.filter=r),l!==this.wrap&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,l),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,l),this.wrap=l)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}function je(g){const{userImage:r}=g;return!!(r&&r.render&&r.render())&&(g.data.replace(new Uint8Array(r.data.buffer)),!0)}class Le extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(r){if(this.loaded!==r&&(this.loaded=r,r)){for(const{ids:l,callback:f}of this.requestors)this._notify(l,f);this.requestors=[]}}getImage(r){const l=this.images[r];if(l&&!l.data&&l.spriteData){const f=l.spriteData;l.data=new o.R({width:f.width,height:f.height},f.context.getImageData(f.x,f.y,f.width,f.height).data),l.spriteData=null}return l}addImage(r,l){if(this.images[r])throw new Error(`Image id ${r} already exist, use updateImage instead`);this._validate(r,l)&&(this.images[r]=l)}_validate(r,l){let f=!0;const p=l.data||l.spriteData;return this._validateStretch(l.stretchX,p&&p.width)||(this.fire(new o.j(new Error(`Image "${r}" has invalid "stretchX" value`))),f=!1),this._validateStretch(l.stretchY,p&&p.height)||(this.fire(new o.j(new Error(`Image "${r}" has invalid "stretchY" value`))),f=!1),this._validateContent(l.content,l)||(this.fire(new o.j(new Error(`Image "${r}" has invalid "content" value`))),f=!1),f}_validateStretch(r,l){if(!r)return!0;let f=0;for(const p of r){if(p[0]<f||p[1]<p[0]||l<p[1])return!1;f=p[1]}return!0}_validateContent(r,l){if(!r)return!0;if(r.length!==4)return!1;const f=l.spriteData,p=f&&f.width||l.data.width,y=f&&f.height||l.data.height;return!(r[0]<0||p<r[0]||r[1]<0||y<r[1]||r[2]<0||p<r[2]||r[3]<0||y<r[3]||r[2]<r[0]||r[3]<r[1])}updateImage(r,l,f=!0){const p=this.getImage(r);if(f&&(p.data.width!==l.data.width||p.data.height!==l.data.height))throw new Error(`size mismatch between old image (${p.data.width}x${p.data.height}) and new image (${l.data.width}x${l.data.height}).`);l.version=p.version+1,this.images[r]=l,this.updatedImages[r]=!0}removeImage(r){const l=this.images[r];delete this.images[r],delete this.patterns[r],l.userImage&&l.userImage.onRemove&&l.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(r,l){let f=!0;if(!this.isLoaded())for(const p of r)this.images[p]||(f=!1);this.isLoaded()||f?this._notify(r,l):this.requestors.push({ids:r,callback:l})}_notify(r,l){const f={};for(const p of r){let y=this.getImage(p);y||(this.fire(new o.k("styleimagemissing",{id:p})),y=this.getImage(p)),y?f[p]={data:y.data.clone(),pixelRatio:y.pixelRatio,sdf:y.sdf,version:y.version,stretchX:y.stretchX,stretchY:y.stretchY,content:y.content,hasRenderCallback:!!(y.userImage&&y.userImage.render)}:o.w(`Image "${p}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}l(null,f)}getPixelSize(){const{width:r,height:l}=this.atlasImage;return{width:r,height:l}}getPattern(r){const l=this.patterns[r],f=this.getImage(r);if(!f)return null;if(l&&l.position.version===f.version)return l.position;if(l)l.position.version=f.version;else{const p={w:f.data.width+2,h:f.data.height+2,x:0,y:0},y=new o.I(p,f);this.patterns[r]={bin:p,position:y}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){const l=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new $e(r,this.atlasImage,l.RGBA),this.atlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE)}_updatePatternAtlas(){const r=[];for(const y in this.patterns)r.push(this.patterns[y].bin);const{w:l,h:f}=o.p(r),p=this.atlasImage;p.resize({width:l||1,height:f||1});for(const y in this.patterns){const{bin:T}=this.patterns[y],S=T.x+1,A=T.y+1,F=this.getImage(y).data,L=F.width,R=F.height;o.R.copy(F,p,{x:0,y:0},{x:S,y:A},{width:L,height:R}),o.R.copy(F,p,{x:0,y:R-1},{x:S,y:A-1},{width:L,height:1}),o.R.copy(F,p,{x:0,y:0},{x:S,y:A+R},{width:L,height:1}),o.R.copy(F,p,{x:L-1,y:0},{x:S-1,y:A},{width:1,height:R}),o.R.copy(F,p,{x:0,y:0},{x:S+L,y:A},{width:1,height:R})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(r){for(const l of r){if(this.callbackDispatchedThisFrame[l])continue;this.callbackDispatchedThisFrame[l]=!0;const f=this.getImage(l);f||o.w(`Image with ID: "${l}" was not found`),je(f)&&this.updateImage(l,f)}}}const it=1e20;function ft(g,r,l,f,p,y,T,S,A){for(let F=r;F<r+f;F++)ct(g,l*y+F,y,p,T,S,A);for(let F=l;F<l+p;F++)ct(g,F*y+r,1,f,T,S,A)}function ct(g,r,l,f,p,y,T){y[0]=0,T[0]=-it,T[1]=it,p[0]=g[r];for(let S=1,A=0,F=0;S<f;S++){p[S]=g[r+S*l];const L=S*S;do{const R=y[A];F=(p[S]-p[R]+L-R*R)/(S-R)/2}while(F<=T[A]&&--A>-1);A++,y[A]=S,T[A]=F,T[A+1]=it}for(let S=0,A=0;S<f;S++){for(;T[A+1]<S;)A++;const F=y[A],L=S-F;g[r+S*l]=p[F]+L*L}}class xt{constructor(r,l){this.requestManager=r,this.localIdeographFontFamily=l,this.entries={}}setURL(r){this.url=r}getGlyphs(r,l){const f=[];for(const p in r)for(const y of r[p])f.push({stack:p,id:y});o.o(f,({stack:p,id:y},T)=>{let S=this.entries[p];S||(S=this.entries[p]={glyphs:{},requests:{},ranges:{}});let A=S.glyphs[y];if(A!==void 0)return void T(null,{stack:p,id:y,glyph:A});if(A=this._tinySDF(S,p,y),A)return S.glyphs[y]=A,void T(null,{stack:p,id:y,glyph:A});const F=Math.floor(y/256);if(256*F>65535)return void T(new Error("glyphs > 65535 not supported"));if(S.ranges[F])return void T(null,{stack:p,id:y,glyph:A});if(!this.url)return void T(new Error("glyphsUrl is not set"));let L=S.requests[F];L||(L=S.requests[F]=[],xt.loadGlyphRange(p,F,this.url,this.requestManager,(R,W)=>{if(W){for(const oe in W)this._doesCharSupportLocalGlyph(+oe)||(S.glyphs[+oe]=W[+oe]);S.ranges[F]=!0}for(const oe of L)oe(R,W);delete S.requests[F]})),L.push((R,W)=>{R?T(R):W&&T(null,{stack:p,id:y,glyph:W[y]||null})})},(p,y)=>{if(p)l(p);else if(y){const T={};for(const{stack:S,id:A,glyph:F}of y)(T[S]||(T[S]={}))[A]=F&&{id:F.id,bitmap:F.bitmap.clone(),metrics:F.metrics};l(null,T)}})}_doesCharSupportLocalGlyph(r){return!!this.localIdeographFontFamily&&(o.u["CJK Unified Ideographs"](r)||o.u["Hangul Syllables"](r)||o.u.Hiragana(r)||o.u.Katakana(r))}_tinySDF(r,l,f){const p=this.localIdeographFontFamily;if(!p||!this._doesCharSupportLocalGlyph(f))return;let y=r.tinySDF;if(!y){let S="400";/bold/i.test(l)?S="900":/medium/i.test(l)?S="500":/light/i.test(l)&&(S="200"),y=r.tinySDF=new xt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:p,fontWeight:S})}const T=y.draw(String.fromCharCode(f));return{id:f,bitmap:new o.q({width:T.width||60,height:T.height||60},T.data),metrics:{width:T.glyphWidth/2||24,height:T.glyphHeight/2||24,left:T.glyphLeft/2+.5||0,top:T.glyphTop/2-27.5||-8,advance:T.glyphAdvance/2||24,isDoubleResolution:!0}}}}xt.loadGlyphRange=function(g,r,l,f,p){const y=256*r,T=y+255,S=f.transformRequest(l.replace("{fontstack}",g).replace("{range}",`${y}-${T}`),re.Glyphs);o.l(S,(A,F)=>{if(A)p(A);else if(F){const L={};for(const R of o.n(F))L[R.id]=R;p(null,L)}})},xt.TinySDF=class{constructor({fontSize:g=24,buffer:r=3,radius:l=8,cutoff:f=.25,fontFamily:p="sans-serif",fontWeight:y="normal",fontStyle:T="normal"}={}){this.buffer=r,this.cutoff=f,this.radius=l;const S=this.size=g+4*r,A=this._createCanvas(S),F=this.ctx=A.getContext("2d",{willReadFrequently:!0});F.font=`${T} ${y} ${g}px ${p}`,F.textBaseline="alphabetic",F.textAlign="left",F.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(g){const r=document.createElement("canvas");return r.width=r.height=g,r}draw(g){const{width:r,actualBoundingBoxAscent:l,actualBoundingBoxDescent:f,actualBoundingBoxLeft:p,actualBoundingBoxRight:y}=this.ctx.measureText(g),T=Math.ceil(l),S=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(y-p))),A=Math.min(this.size-this.buffer,T+Math.ceil(f)),F=S+2*this.buffer,L=A+2*this.buffer,R=Math.max(F*L,0),W=new Uint8ClampedArray(R),oe={data:W,width:F,height:L,glyphWidth:S,glyphHeight:A,glyphTop:T,glyphLeft:0,glyphAdvance:r};if(S===0||A===0)return oe;const{ctx:se,buffer:de,gridInner:ie,gridOuter:Pe}=this;se.clearRect(de,de,S,A),se.fillText(g,de,de+T);const Ge=se.getImageData(de,de,S,A);Pe.fill(it,0,R),ie.fill(0,0,R);for(let _e=0;_e<A;_e++)for(let Re=0;Re<S;Re++){const Ze=Ge.data[4*(_e*S+Re)+3]/255;if(Ze===0)continue;const Xe=(_e+de)*F+Re+de;if(Ze===1)Pe[Xe]=0,ie[Xe]=it;else{const rt=.5-Ze;Pe[Xe]=rt>0?rt*rt:0,ie[Xe]=rt<0?rt*rt:0}}ft(Pe,0,0,F,L,F,this.f,this.v,this.z),ft(ie,de,de,S,A,F,this.f,this.v,this.z);for(let _e=0;_e<R;_e++){const Re=Math.sqrt(Pe[_e])-Math.sqrt(ie[_e]);W[_e]=Math.round(255-255*(Re/this.radius+this.cutoff))}return oe}};class ht{constructor(){this.specification=o.v.light.position}possiblyEvaluate(r,l){return o.z(r.expression.evaluate(l))}interpolate(r,l,f){return{x:o.B.number(r.x,l.x,f),y:o.B.number(r.y,l.y,f),z:o.B.number(r.z,l.z,f)}}}let Yt;class He extends o.E{constructor(r){super(),Yt=Yt||new o.r({anchor:new o.D(o.v.light.anchor),position:new ht,color:new o.D(o.v.light.color),intensity:new o.D(o.v.light.intensity)}),this._transitionable=new o.T(Yt),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,l={}){if(!this._validate(o.t,r,l))for(const f in r){const p=r[f];f.endsWith("-transition")?this._transitionable.setTransition(f.slice(0,-11),p):this._transitionable.setValue(f,p)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,l,f){return(!f||f.validate!==!1)&&o.x(this,r.call(o.y,o.e({value:l,style:{glyphs:!0,sprite:!0},styleSpec:o.v})))}}class Nt{constructor(r,l){this.width=r,this.height=l,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(r,l){const f=r.join(",")+String(l);return this.dashEntry[f]||(this.dashEntry[f]=this.addDash(r,l)),this.dashEntry[f]}getDashRanges(r,l,f){const p=[];let y=r.length%2==1?-r[r.length-1]*f:0,T=r[0]*f,S=!0;p.push({left:y,right:T,isDash:S,zeroLength:r[0]===0});let A=r[0];for(let F=1;F<r.length;F++){S=!S;const L=r[F];y=A*f,A+=L,T=A*f,p.push({left:y,right:T,isDash:S,zeroLength:L===0})}return p}addRoundDash(r,l,f){const p=l/2;for(let y=-f;y<=f;y++){const T=this.width*(this.nextRow+f+y);let S=0,A=r[S];for(let F=0;F<this.width;F++){F/A.right>1&&(A=r[++S]);const L=Math.abs(F-A.left),R=Math.abs(F-A.right),W=Math.min(L,R);let oe;const se=y/f*(p+1);if(A.isDash){const de=p-Math.abs(se);oe=Math.sqrt(W*W+de*de)}else oe=p-Math.sqrt(W*W+se*se);this.data[T+F]=Math.max(0,Math.min(255,oe+128))}}}addRegularDash(r){for(let S=r.length-1;S>=0;--S){const A=r[S],F=r[S+1];A.zeroLength?r.splice(S,1):F&&F.isDash===A.isDash&&(F.left=A.left,r.splice(S,1))}const l=r[0],f=r[r.length-1];l.isDash===f.isDash&&(l.left=f.left-this.width,f.right=l.right+this.width);const p=this.width*this.nextRow;let y=0,T=r[y];for(let S=0;S<this.width;S++){S/T.right>1&&(T=r[++y]);const A=Math.abs(S-T.left),F=Math.abs(S-T.right),L=Math.min(A,F);this.data[p+S]=Math.max(0,Math.min(255,(T.isDash?L:-L)+128))}}addDash(r,l){const f=l?7:0,p=2*f+1;if(this.nextRow+p>this.height)return o.w("LineAtlas out of space"),null;let y=0;for(let S=0;S<r.length;S++)y+=r[S];if(y!==0){const S=this.width/y,A=this.getDashRanges(r,this.width,S);l?this.addRoundDash(A,S,f):this.addRegularDash(A)}const T={y:(this.nextRow+f+.5)/this.height,height:2*f/this.height,width:y};return this.nextRow+=p,this.dirty=!0,T}bind(r){const l=r.gl;this.texture?(l.bindTexture(l.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,l.texSubImage2D(l.TEXTURE_2D,0,0,0,this.width,this.height,l.ALPHA,l.UNSIGNED_BYTE,this.data))):(this.texture=l.createTexture(),l.bindTexture(l.TEXTURE_2D,this.texture),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.REPEAT),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.REPEAT),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.LINEAR),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.LINEAR),l.texImage2D(l.TEXTURE_2D,0,l.ALPHA,this.width,this.height,0,l.ALPHA,l.UNSIGNED_BYTE,this.data))}}class Ft{constructor(r,l,f){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=f;const p=this.workerPool.acquire(f);for(let y=0;y<p.length;y++){const T=new o.C(p[y],l,f);T.name=`Worker ${y}`,this.actors.push(T)}if(!this.actors.length)throw new Error("No actors found")}broadcast(r,l,f){o.o(this.actors,(p,y)=>{p.send(r,l,y)},f=f||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(r=!0){this.actors.forEach(l=>{l.remove()}),this.actors=[],r&&this.workerPool.release(this.id)}}function ue(g,r,l){const f=function(p,y){if(p)return l(p);if(y){const T=o.F(o.e(y,g),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);y.vector_layers&&(T.vectorLayers=y.vector_layers,T.vectorLayerIds=T.vectorLayers.map(S=>S.id)),l(null,T)}};return g.url?o.f(r.transformRequest(g.url,re.Source),f):o.h.frame(()=>f(null,g))}class Te{constructor(r,l){r&&(l?this.setSouthWest(r).setNorthEast(l):Array.isArray(r)&&(r.length===4?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1])))}setNorthEast(r){return this._ne=r instanceof o.L?new o.L(r.lng,r.lat):o.L.convert(r),this}setSouthWest(r){return this._sw=r instanceof o.L?new o.L(r.lng,r.lat):o.L.convert(r),this}extend(r){const l=this._sw,f=this._ne;let p,y;if(r instanceof o.L)p=r,y=r;else{if(!(r instanceof Te))return Array.isArray(r)?r.length===4||r.every(Array.isArray)?this.extend(Te.convert(r)):this.extend(o.L.convert(r)):r&&("lng"in r||"lon"in r)&&"lat"in r?this.extend(o.L.convert(r)):this;if(p=r._sw,y=r._ne,!p||!y)return this}return l||f?(l.lng=Math.min(p.lng,l.lng),l.lat=Math.min(p.lat,l.lat),f.lng=Math.max(y.lng,f.lng),f.lat=Math.max(y.lat,f.lat)):(this._sw=new o.L(p.lng,p.lat),this._ne=new o.L(y.lng,y.lat)),this}getCenter(){return new o.L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new o.L(this.getWest(),this.getNorth())}getSouthEast(){return new o.L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:l,lat:f}=o.L.convert(r);let p=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&p}static convert(r){return r instanceof Te?r:r&&new Te(r)}static fromLngLat(r,l=0){const f=360*l/40075017,p=f/Math.cos(Math.PI/180*r.lat);return new Te(new o.L(r.lng-p,r.lat-f),new o.L(r.lng+p,r.lat+f))}}class Ee{constructor(r,l,f){this.bounds=Te.convert(this.validateBounds(r)),this.minzoom=l||0,this.maxzoom=f||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const l=Math.pow(2,r.z),f=Math.floor(o.G(this.bounds.getWest())*l),p=Math.floor(o.H(this.bounds.getNorth())*l),y=Math.ceil(o.G(this.bounds.getEast())*l),T=Math.ceil(o.H(this.bounds.getSouth())*l);return r.x>=f&&r.x<y&&r.y>=p&&r.y<T}}class Se extends o.E{constructor(r,l,f,p){if(super(),this.load=()=>{this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this._tileJSONRequest=ue(this._options,this.map._requestManager,(y,T)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),y?this.fire(new o.j(y)):T&&(o.e(this,T),T.bounds&&(this.tileBounds=new Ee(T.bounds,this.minzoom,this.maxzoom)),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>o.e({},this._options),this.id=r,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.e(this,o.F(l,["url","scheme","tileSize","promoteId"])),this._options=o.e({type:"vector"},l),this._collectResourceTiming=l.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p)}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}setSourceProperty(r){this._tileJSONRequest&&this._tileJSONRequest.cancel(),r(),this.load()}setTiles(r){return this.setSourceProperty(()=>{this._options.tiles=r}),this}setUrl(r){return this.setSourceProperty(()=>{this.url=r,this._options.url=r}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(r,l){const f=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p={request:this.map._requestManager.transformRequest(f,re.Tile),uid:r.uid,tileID:r.tileID,zoom:r.tileID.overscaledZ,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function y(T,S){return delete r.request,r.aborted?l(null):T&&T.status!==404?l(T):(S&&S.resourceTiming&&(r.resourceTiming=S.resourceTiming),this.map._refreshExpiredTiles&&S&&r.setExpiryData(S),r.loadVectorData(S,this.map.painter),l(null),void(r.reloadCallback&&(this.loadTile(r,r.reloadCallback),r.reloadCallback=null)))}p.request.collectResourceTiming=this._collectResourceTiming,r.actor&&r.state!=="expired"?r.state==="loading"?r.reloadCallback=l:r.request=r.actor.send("reloadTile",p,y.bind(this)):(r.actor=this.dispatcher.getActor(),r.request=r.actor.send("loadTile",p,y.bind(this)))}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id},void 0)}unloadTile(r){r.unloadVectorData(),r.actor&&r.actor.send("removeTile",{uid:r.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Ke extends o.E{constructor(r,l,f,p){super(),this.id=r,this.dispatcher=f,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.e({type:"raster"},l),o.e(this,o.F(l,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this._tileJSONRequest=ue(this._options,this.map._requestManager,(r,l)=>{this._tileJSONRequest=null,this._loaded=!0,r?this.fire(new o.j(r)):l&&(o.e(this,l),l.bounds&&(this.tileBounds=new Ee(l.bounds,this.minzoom,this.maxzoom)),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}setSourceProperty(r){this._tileJSONRequest&&this._tileJSONRequest.cancel(),r(),this.load()}setTiles(r){return this.setSourceProperty(()=>{this._options.tiles=r}),this}serialize(){return o.e({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,l){const f=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);r.request=j.getImage(this.map._requestManager.transformRequest(f,re.Tile),(p,y,T)=>{if(delete r.request,r.aborted)r.state="unloaded",l(null);else if(p)r.state="errored",l(p);else if(y){this.map._refreshExpiredTiles&&T&&r.setExpiryData(T);const S=this.map.painter.context,A=S.gl;r.texture=this.map.painter.getTileTexture(y.width),r.texture?r.texture.update(y,{useMipmap:!0}):(r.texture=new $e(S,y,A.RGBA,{useMipmap:!0}),r.texture.bind(A.LINEAR,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),S.extTextureFilterAnisotropic&&A.texParameterf(A.TEXTURE_2D,S.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,S.extTextureFilterAnisotropicMax)),r.state="loaded",l(null)}},this.map._refreshExpiredTiles)}abortTile(r,l){r.request&&(r.request.cancel(),delete r.request),l()}unloadTile(r,l){r.texture&&this.map.painter.saveTileTexture(r.texture),l()}hasTransition(){return!1}}class pt extends Ke{constructor(r,l,f,p){super(r,l,f,p),this.type="raster-dem",this.maxzoom=22,this._options=o.e({type:"raster-dem"},l),this.encoding=l.encoding||"mapbox",this.redFactor=l.redFactor,this.greenFactor=l.greenFactor,this.blueFactor=l.blueFactor,this.baseShift=l.baseShift}loadTile(r,l){const f=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p=this.map._requestManager.transformRequest(f,re.Tile);function y(T,S){T&&(r.state="errored",l(T)),S&&(r.dem=S,r.needsHillshadePrepare=!0,r.needsTerrainPrepare=!0,r.state="loaded",l(null))}r.neighboringTiles=this._getNeighboringTiles(r.tileID),r.request=j.getImage(p,(T,S,A)=>o._(this,void 0,void 0,function*(){if(delete r.request,r.aborted)r.state="unloaded",l(null);else if(T)r.state="errored",l(T);else if(S){this.map._refreshExpiredTiles&&r.setExpiryData(A);const F=o.a(S)&&o.J()?S:yield function(R){return o._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&o.K()){const W=R.width+2,oe=R.height+2;try{return new o.R({width:W,height:oe},yield o.M(R,-1,-1,W,oe))}catch{}}return o.h.getImageData(R,1)})}(S),L={uid:r.uid,coord:r.tileID,source:this.id,rawImageData:F,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};r.actor&&r.state!=="expired"||(r.actor=this.dispatcher.getActor(),r.actor.send("loadDEMTile",L,y))}}),this.map._refreshExpiredTiles)}_getNeighboringTiles(r){const l=r.canonical,f=Math.pow(2,l.z),p=(l.x-1+f)%f,y=l.x===0?r.wrap-1:r.wrap,T=(l.x+1+f)%f,S=l.x+1===f?r.wrap+1:r.wrap,A={};return A[new o.O(r.overscaledZ,y,l.z,p,l.y).key]={backfilled:!1},A[new o.O(r.overscaledZ,S,l.z,T,l.y).key]={backfilled:!1},l.y>0&&(A[new o.O(r.overscaledZ,y,l.z,p,l.y-1).key]={backfilled:!1},A[new o.O(r.overscaledZ,r.wrap,l.z,l.x,l.y-1).key]={backfilled:!1},A[new o.O(r.overscaledZ,S,l.z,T,l.y-1).key]={backfilled:!1}),l.y+1<f&&(A[new o.O(r.overscaledZ,y,l.z,p,l.y+1).key]={backfilled:!1},A[new o.O(r.overscaledZ,r.wrap,l.z,l.x,l.y+1).key]={backfilled:!1},A[new o.O(r.overscaledZ,S,l.z,T,l.y+1).key]={backfilled:!1}),A}unloadTile(r){r.demTexture&&this.map.painter.saveTileTexture(r.demTexture),r.fbo&&(r.fbo.destroy(),delete r.fbo),r.dem&&delete r.dem,delete r.neighboringTiles,r.state="unloaded",r.actor&&r.actor.send("removeDEMTile",{uid:r.uid,source:this.id})}}class _t extends o.E{constructor(r,l,f,p){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>o.e({},this._options,{type:this.type,data:this._data}),this.id=r,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=f.getActor(),this.setEventedParent(p),this._data=l.data,this._options=o.e({},l),this._collectResourceTiming=l.collectResourceTiming,l.maxzoom!==void 0&&(this.maxzoom=l.maxzoom),l.type&&(this.type=l.type),l.attribution&&(this.attribution=l.attribution),this.promoteId=l.promoteId;const y=o.N/this.tileSize;this.workerOptions=o.e({source:this.id,cluster:l.cluster||!1,geojsonVtOptions:{buffer:(l.buffer!==void 0?l.buffer:128)*y,tolerance:(l.tolerance!==void 0?l.tolerance:.375)*y,extent:o.N,maxZoom:this.maxzoom,lineMetrics:l.lineMetrics||!1,generateId:l.generateId||!1},superclusterOptions:{maxZoom:l.clusterMaxZoom!==void 0?l.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,l.clusterMinPoints||2),extent:o.N,radius:(l.clusterRadius||50)*y,log:!1,generateId:l.generateId||!1},clusterProperties:l.clusterProperties,filter:l.filter},l.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(r){this.map=r,this.load()}setData(r){return this._data=r,this._updateWorkerData(),this}updateData(r){return this._updateWorkerData(r),this}setClusterOptions(r){return this.workerOptions.cluster=r.cluster,r&&(r.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=r.clusterRadius),r.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=r.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(r,l){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:r,source:this.id},l),this}getClusterChildren(r,l){return this.actor.send("geojson.getClusterChildren",{clusterId:r,source:this.id},l),this}getClusterLeaves(r,l,f,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:r,limit:l,offset:f},p),this}_updateWorkerData(r){const l=o.e({},this.workerOptions);r?l.dataDiff=r:typeof this._data=="string"?(l.request=this.map._requestManager.transformRequest(o.h.resolveURL(this._data),re.Source),l.request.collectResourceTiming=this._collectResourceTiming):l.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new o.k("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,l,(f,p)=>{if(this._pendingLoads--,this._removed||p&&p.abandoned)return void this.fire(new o.k("dataabort",{dataType:"source"}));let y=null;if(p&&p.resourceTiming&&p.resourceTiming[this.id]&&(y=p.resourceTiming[this.id].slice(0)),f)return void this.fire(new o.j(f));const T={dataType:"source"};this._collectResourceTiming&&y&&y.length>0&&o.e(T,{resourceTiming:y}),this.fire(new o.k("data",Object.assign(Object.assign({},T),{sourceDataType:"metadata"}))),this.fire(new o.k("data",Object.assign(Object.assign({},T),{sourceDataType:"content"})))})}loaded(){return this._pendingLoads===0}loadTile(r,l){const f=r.actor?"reloadTile":"loadTile";r.actor=this.actor;const p={type:this.type,uid:r.uid,tileID:r.tileID,zoom:r.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};r.request=this.actor.send(f,p,(y,T)=>(delete r.request,r.unloadVectorData(),r.aborted?l(null):y?l(y):(r.loadVectorData(T,this.map.painter,f==="reloadTile"),l(null))))}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.aborted=!0}unloadTile(r){r.unloadVectorData(),this.actor.send("removeTile",{uid:r.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var ut=o.Q([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class tt extends o.E{constructor(r,l,f,p){super(),this.load=(y,T)=>{this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=j.getImage(this.map._requestManager.transformRequest(this.url,re.Image),(S,A)=>{this._request=null,this._loaded=!0,S?this.fire(new o.j(S)):A&&(this.image=A,y&&(this.coordinates=y),T&&T(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;const y=this.map.painter.context,T=y.gl;this.boundsBuffer||(this.boundsBuffer=y.createVertexBuffer(this._boundsArray,ut.members)),this.boundsSegments||(this.boundsSegments=o.S.simpleSegment(0,0,4,2)),this.texture||(this.texture=new $e(y,this.image,T.RGBA),this.texture.bind(T.LINEAR,T.CLAMP_TO_EDGE));let S=!1;for(const A in this.tiles){const F=this.tiles[A];F.state!=="loaded"&&(F.state="loaded",F.texture=this.texture,S=!0)}S&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=r,this.dispatcher=f,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(p),this.options=l}loaded(){return this._loaded}updateImage(r){return r.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=r.url,this.load(r.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(r){this.coordinates=r;const l=r.map(o.U.fromLngLat);this.tileID=function(p){let y=1/0,T=1/0,S=-1/0,A=-1/0;for(const W of p)y=Math.min(y,W.x),T=Math.min(T,W.y),S=Math.max(S,W.x),A=Math.max(A,W.y);const F=Math.max(S-y,A-T),L=Math.max(0,Math.floor(-Math.log(F)/Math.LN2)),R=Math.pow(2,L);return new o.W(L,Math.floor((y+S)/2*R),Math.floor((T+A)/2*R))}(l),this.minzoom=this.maxzoom=this.tileID.z;const f=l.map(p=>this.tileID.getTilePoint(p)._round());return this._boundsArray=new o.V,this._boundsArray.emplaceBack(f[0].x,f[0].y,0,0),this._boundsArray.emplaceBack(f[1].x,f[1].y,o.N,0),this._boundsArray.emplaceBack(f[3].x,f[3].y,0,o.N),this._boundsArray.emplaceBack(f[2].x,f[2].y,o.N,o.N),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(r,l){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},l(null)):(r.state="errored",l(null))}hasTransition(){return!1}}class Zt extends tt{constructor(r,l,f,p){super(r,l,f,p),this.load=()=>{this._loaded=!1;const y=this.options;this.urls=[];for(const T of y.urls)this.urls.push(this.map._requestManager.transformRequest(T,re.Source).url);o.X(this.urls,(T,S)=>{this._loaded=!0,T?this.fire(new o.j(T)):S&&(this.video=S,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const y=this.map.painter.context,T=y.gl;this.boundsBuffer||(this.boundsBuffer=y.createVertexBuffer(this._boundsArray,ut.members)),this.boundsSegments||(this.boundsSegments=o.S.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(T.LINEAR,T.CLAMP_TO_EDGE),T.texSubImage2D(T.TEXTURE_2D,0,0,0,T.RGBA,T.UNSIGNED_BYTE,this.video)):(this.texture=new $e(y,this.video,T.RGBA),this.texture.bind(T.LINEAR,T.CLAMP_TO_EDGE));let S=!1;for(const A in this.tiles){const F=this.tiles[A];F.state!=="loaded"&&(F.state="loaded",F.texture=this.texture,S=!0)}S&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=l}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(r){if(this.video){const l=this.video.seekable;r<l.start(0)||r>l.end(0)?this.fire(new o.j(new o.Y(`sources.${this.id}`,null,`Playback for this video can be set only between the ${l.start(0)} and ${l.end(0)}-second mark.`))):this.video.currentTime=r}}getVideo(){return this.video}onAdd(r){this.map||(this.map=r,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class ge extends tt{constructor(r,l,f,p){super(r,l,f,p),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let y=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,y=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,y=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const T=this.map.painter.context,S=T.gl;this.boundsBuffer||(this.boundsBuffer=T.createVertexBuffer(this._boundsArray,ut.members)),this.boundsSegments||(this.boundsSegments=o.S.simpleSegment(0,0,4,2)),this.texture?(y||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new $e(T,this.canvas,S.RGBA,{premultiply:!0});let A=!1;for(const F in this.tiles){const L=this.tiles[F];L.state!=="loaded"&&(L.state="loaded",L.texture=this.texture,A=!0)}A&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),l.coordinates?Array.isArray(l.coordinates)&&l.coordinates.length===4&&!l.coordinates.some(y=>!Array.isArray(y)||y.length!==2||y.some(T=>typeof T!="number"))||this.fire(new o.j(new o.Y(`sources.${r}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.j(new o.Y(`sources.${r}`,null,'missing required property "coordinates"'))),l.animate&&typeof l.animate!="boolean"&&this.fire(new o.j(new o.Y(`sources.${r}`,null,'optional "animate" property must be a boolean value'))),l.canvas?typeof l.canvas=="string"||l.canvas instanceof HTMLCanvasElement||this.fire(new o.j(new o.Y(`sources.${r}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.j(new o.Y(`sources.${r}`,null,'missing required property "canvas"'))),this.options=l,this.animate=l.animate===void 0||l.animate}getCanvas(){return this.canvas}onAdd(r){this.map=r,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const r of[this.canvas.width,this.canvas.height])if(isNaN(r)||r<=0)return!0;return!1}}const Qt={},Xt=g=>{switch(g){case"geojson":return _t;case"image":return tt;case"raster":return Ke;case"raster-dem":return pt;case"vector":return Se;case"video":return Zt;case"canvas":return ge}return Qt[g]};function or(g,r){const l=o.Z();return o.$(l,l,[1,1,0]),o.a0(l,l,[.5*g.width,.5*g.height,1]),o.a1(l,l,g.calculatePosMatrix(r.toUnwrapped()))}function Jt(g,r,l,f,p,y){const T=function(R,W,oe){if(R)for(const se of R){const de=W[se];if(de&&de.source===oe&&de.type==="fill-extrusion")return!0}else for(const se in W){const de=W[se];if(de.source===oe&&de.type==="fill-extrusion")return!0}return!1}(p&&p.layers,r,g.id),S=y.maxPitchScaleFactor(),A=g.tilesIn(f,S,T);A.sort(wt);const F=[];for(const R of A)F.push({wrappedTileID:R.tileID.wrapped().key,queryResults:R.tile.queryRenderedFeatures(r,l,g._state,R.queryGeometry,R.cameraQueryGeometry,R.scale,p,y,S,or(g.transform,R.tileID))});const L=function(R){const W={},oe={};for(const se of R){const de=se.queryResults,ie=se.wrappedTileID,Pe=oe[ie]=oe[ie]||{};for(const Ge in de){const _e=de[Ge],Re=Pe[Ge]=Pe[Ge]||{},Ze=W[Ge]=W[Ge]||[];for(const Xe of _e)Re[Xe.featureIndex]||(Re[Xe.featureIndex]=!0,Ze.push(Xe))}}return W}(F);for(const R in L)L[R].forEach(W=>{const oe=W.feature,se=g.getFeatureState(oe.layer["source-layer"],oe.id);oe.source=oe.layer.source,oe.layer["source-layer"]&&(oe.sourceLayer=oe.layer["source-layer"]),oe.state=se});return L}function wt(g,r){const l=g.tileID,f=r.tileID;return l.overscaledZ-f.overscaledZ||l.canonical.y-f.canonical.y||l.wrap-f.wrap||l.canonical.x-f.canonical.x}class cr{constructor(r,l){this.timeAdded=0,this.fadeEndTime=0,this.tileID=r,this.uid=o.a2(),this.uses=0,this.tileSize=l,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(r){const l=r+this.timeAdded;l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(r){this.demTexture&&r.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(r,l,f){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=function(p,y){const T={};if(!y)return T;for(const S of p){const A=S.layerIds.map(F=>y.getLayer(F)).filter(Boolean);if(A.length!==0){S.layers=A,S.stateDependentLayerIds&&(S.stateDependentLayers=S.stateDependentLayerIds.map(F=>A.filter(L=>L.id===F)[0]));for(const F of A)T[F.id]=S}}return T}(r.buckets,l.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const y=this.buckets[p];if(y instanceof o.a4){if(this.hasSymbolBuckets=!0,!f)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const y=this.buckets[p];if(y instanceof o.a4&&y.hasRTLText){this.hasRTLText=!0,o.a5();break}}this.queryPadding=0;for(const p in this.buckets){const y=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,l.style.getLayer(p).queryRadius(y))}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage)}else this.collisionBoxArray=new o.a3}unloadVectorData(){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(r){return this.buckets[r.id]}upload(r){for(const f in this.buckets){const p=this.buckets[f];p.uploadPending()&&p.upload(r)}const l=r.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new $e(r,this.imageAtlas.image,l.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new $e(r,this.glyphAtlasImage,l.ALPHA),this.glyphAtlasImage=null)}prepare(r){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture)}queryRenderedFeatures(r,l,f,p,y,T,S,A,F,L){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:p,cameraQueryGeometry:y,scale:T,tileSize:this.tileSize,pixelPosMatrix:L,transform:A,params:S,queryPadding:this.queryPadding*F},r,l,f):{}}querySourceFeatures(r,l){const f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;const p=f.loadVTLayers(),y=l&&l.sourceLayer?l.sourceLayer:"",T=p._geojsonTileLayer||p[y];if(!T)return;const S=o.a6(l&&l.filter),{z:A,x:F,y:L}=this.tileID.canonical,R={z:A,x:F,y:L};for(let W=0;W<T.length;W++){const oe=T.feature(W);if(S.needGeometry){const ie=o.a7(oe,!0);if(!S.filter(new o.a8(this.tileID.overscaledZ),ie,this.tileID.canonical))continue}else if(!S.filter(new o.a8(this.tileID.overscaledZ),oe))continue;const se=f.getId(oe,y),de=new o.a9(oe,A,F,L,se);de.tile=R,r.push(de)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){const l=this.expirationTime;if(r.cacheControl){const f=o.aa(r.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const f=Date.now();let p=!1;if(this.expirationTime>f)p=!1;else if(l)if(this.expirationTime<l)p=!0;else{const y=this.expirationTime-l;y?this.expirationTime=f+Math.max(y,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(r,l){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(r).length===0)return;const f=this.latestFeatureIndex.loadVTLayers();for(const p in this.buckets){if(!l.style.hasLayer(p))continue;const y=this.buckets[p],T=y.layers[0].sourceLayer||"_geojsonTileLayer",S=f[T],A=r[T];if(!S||!A||Object.keys(A).length===0)continue;y.update(A,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});const F=l&&l.style&&l.style.getLayer(p);F&&(this.queryPadding=Math.max(this.queryPadding,F.queryRadius(y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.h.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=o.h.now()+r}setDependencies(r,l){const f={};for(const p of l)f[p]=!0;this.dependencies[r]=f}hasDependency(r,l){for(const f of r){const p=this.dependencies[f];if(p){for(const y of l)if(p[y])return!0}}return!1}}class Pr{constructor(r,l){this.max=r,this.onRemove=l,this.reset()}reset(){for(const r in this.data)for(const l of this.data[r])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(r,l,f){const p=r.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);const y={value:l,timeout:void 0};if(f!==void 0&&(y.timeout=setTimeout(()=>{this.remove(r,y)},f)),this.data[p].push(y),this.order.push(p),this.order.length>this.max){const T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const l=this.data[r].shift();return l.timeout&&clearTimeout(l.timeout),this.data[r].length===0&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),l.value}getByKey(r){const l=this.data[r];return l?l[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,l){if(!this.has(r))return this;const f=r.wrapped().key,p=l===void 0?0:this.data[f].indexOf(l),y=this.data[f][p];return this.data[f].splice(p,1),y.timeout&&clearTimeout(y.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(y.value),this.order.splice(this.order.indexOf(f),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(r){const l=[];for(const f in this.data)for(const p of this.data[f])r(p.value)||l.push(p);for(const f of l)this.remove(f.value.tileID,f)}}class qe{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,l,f){const p=String(l);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][p]=this.stateChanges[r][p]||{},o.e(this.stateChanges[r][p],f),this.deletedStates[r]===null){this.deletedStates[r]={};for(const y in this.state[r])y!==p&&(this.deletedStates[r][y]=null)}else if(this.deletedStates[r]&&this.deletedStates[r][p]===null){this.deletedStates[r][p]={};for(const y in this.state[r][p])f[y]||(this.deletedStates[r][p][y]=null)}else for(const y in f)this.deletedStates[r]&&this.deletedStates[r][p]&&this.deletedStates[r][p][y]===null&&delete this.deletedStates[r][p][y]}removeFeatureState(r,l,f){if(this.deletedStates[r]===null)return;const p=String(l);if(this.deletedStates[r]=this.deletedStates[r]||{},f&&l!==void 0)this.deletedStates[r][p]!==null&&(this.deletedStates[r][p]=this.deletedStates[r][p]||{},this.deletedStates[r][p][f]=null);else if(l!==void 0)if(this.stateChanges[r]&&this.stateChanges[r][p])for(f in this.deletedStates[r][p]={},this.stateChanges[r][p])this.deletedStates[r][p][f]=null;else this.deletedStates[r][p]=null;else this.deletedStates[r]=null}getState(r,l){const f=String(l),p=o.e({},(this.state[r]||{})[f],(this.stateChanges[r]||{})[f]);if(this.deletedStates[r]===null)return{};if(this.deletedStates[r]){const y=this.deletedStates[r][l];if(y===null)return{};for(const T in y)delete p[T]}return p}initializeTileState(r,l){r.setFeatureState(this.state,l)}coalesceChanges(r,l){const f={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const y={};for(const T in this.stateChanges[p])this.state[p][T]||(this.state[p][T]={}),o.e(this.state[p][T],this.stateChanges[p][T]),y[T]=this.state[p][T];f[p]=y}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const y={};if(this.deletedStates[p]===null)for(const T in this.state[p])y[T]={},this.state[p][T]={};else for(const T in this.deletedStates[p]){if(this.deletedStates[p][T]===null)this.state[p][T]={};else for(const S of Object.keys(this.deletedStates[p][T]))delete this.state[p][T][S];y[T]=this.state[p][T]}f[p]=f[p]||{},o.e(f[p],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0)for(const p in r)r[p].setFeatureState(f,l)}}class Cr extends o.E{constructor(r,l,f){super(),this.id=r,this.dispatcher=f,this.on("data",p=>{p.dataType==="source"&&p.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&p.dataType==="source"&&p.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((p,y,T,S)=>{const A=new(Xt(y.type))(p,y,T,S);if(A.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${A.id}`);return A})(r,l,f,this),this._tiles={},this._cache=new Pr(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new qe,this._didEmitContent=!1,this._updated=!1}onAdd(r){this.map=r,this._maxTileCacheSize=r?r._maxTileCacheSize:null,this._maxTileCacheZoomLevels=r?r._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(r)}onRemove(r){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(r)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const r in this._tiles){const l=this._tiles[r];if(l.state!=="loaded"&&l.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(r,l){return this._source.loadTile(r,l)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r,()=>{})}_abortTile(r){this._source.abortTile&&this._source.abortTile(r,()=>{}),this._source.fire(new o.k("dataabort",{tile:r,coord:r.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const l in this._tiles){const f=this._tiles[l];f.upload(r),f.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(r=>r.tileID).sort(Br).map(r=>r.key)}getRenderableIds(r){const l=[];for(const f in this._tiles)this._isIdRenderable(f,r)&&l.push(this._tiles[f]);return r?l.sort((f,p)=>{const y=f.tileID,T=p.tileID,S=new o.P(y.canonical.x,y.canonical.y)._rotate(this.transform.angle),A=new o.P(T.canonical.x,T.canonical.y)._rotate(this.transform.angle);return y.overscaledZ-T.overscaledZ||A.y-S.y||A.x-S.x}).map(f=>f.tileID.key):l.map(f=>f.tileID).sort(Br).map(f=>f.key)}hasRenderableParent(r){const l=this.findLoadedParent(r,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(r,l){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(l||!this._tiles[r].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)this._tiles[r].state!=="errored"&&this._reloadTile(r,"reloading")}}_reloadTile(r,l){const f=this._tiles[r];f&&(f.state!=="loading"&&(f.state=l),this._loadTile(f,this._tileLoaded.bind(this,f,r,l)))}_tileLoaded(r,l,f,p){if(p)return r.state="errored",void(p.status!==404?this._source.fire(new o.j(p,{tile:r})):this.update(this.transform,this.terrain));r.timeAdded=o.h.now(),f==="expired"&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(l,r),this.getSource().type==="raster-dem"&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),r.aborted||this._source.fire(new o.k("data",{dataType:"source",tile:r,coord:r.tileID}))}_backfillDEM(r){const l=this.getRenderableIds();for(let p=0;p<l.length;p++){const y=l[p];if(r.neighboringTiles&&r.neighboringTiles[y]){const T=this.getTileByID(y);f(r,T),f(T,r)}}function f(p,y){p.needsHillshadePrepare=!0,p.needsTerrainPrepare=!0;let T=y.tileID.canonical.x-p.tileID.canonical.x;const S=y.tileID.canonical.y-p.tileID.canonical.y,A=Math.pow(2,p.tileID.canonical.z),F=y.tileID.key;T===0&&S===0||Math.abs(S)>1||(Math.abs(T)>1&&(Math.abs(T+A)===1?T+=A:Math.abs(T-A)===1&&(T-=A)),y.dem&&p.dem&&(p.dem.backfillBorder(y.dem,T,S),p.neighboringTiles&&p.neighboringTiles[F]&&(p.neighboringTiles[F].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,l,f,p){for(const y in this._tiles){let T=this._tiles[y];if(p[y]||!T.hasData()||T.tileID.overscaledZ<=l||T.tileID.overscaledZ>f)continue;let S=T.tileID;for(;T&&T.tileID.overscaledZ>l+1;){const F=T.tileID.scaledTo(T.tileID.overscaledZ-1);T=this._tiles[F.key],T&&T.hasData()&&(S=F)}let A=S;for(;A.overscaledZ>l;)if(A=A.scaledTo(A.overscaledZ-1),r[A.key]){p[S.key]=S;break}}}findLoadedParent(r,l){if(r.key in this._loadedParentTiles){const f=this._loadedParentTiles[r.key];return f&&f.tileID.overscaledZ>=l?f:null}for(let f=r.overscaledZ-1;f>=l;f--){const p=r.scaledTo(f),y=this._getLoadedTile(p);if(y)return y}}_getLoadedTile(r){const l=this._tiles[r.key];return l&&l.hasData()?l:this._cache.getByKey(r.wrapped().key)}updateCacheSize(r){const l=Math.ceil(r.width/this._source.tileSize)+1,f=Math.ceil(r.height/this._source.tileSize)+1,p=Math.floor(l*f*(this._maxTileCacheZoomLevels===null?o.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._cache.setMaxSize(y)}handleWrapJump(r){const l=Math.round((r-(this._prevLng===void 0?r:this._prevLng))/360);if(this._prevLng=r,l){const f={};for(const p in this._tiles){const y=this._tiles[p];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+l),f[y.tileID.key]=y}this._tiles=f;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(p,this._tiles[p])}}update(r,l){if(this.transform=r,this.terrain=l,!this._sourceLoaded||this._paused)return;let f;this.updateCacheSize(r),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?f=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(L=>new o.O(L.canonical.z,L.wrap,L.canonical.z,L.canonical.x,L.canonical.y)):(f=r.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:l}),this._source.hasTile&&(f=f.filter(L=>this._source.hasTile(L)))):f=[];const p=r.coveringZoomLevel(this._source),y=Math.max(p-Cr.maxOverzooming,this._source.minzoom),T=Math.max(p+Cr.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const L={};for(const R of f)if(R.canonical.z>this._source.minzoom){const W=R.scaledTo(R.canonical.z-1);L[W.key]=W;const oe=R.scaledTo(Math.max(this._source.minzoom,Math.min(R.canonical.z,5)));L[oe.key]=oe}f=f.concat(Object.values(L))}const S=f.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,S&&this.fire(new o.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const A=this._updateRetainedTiles(f,p);if(ar(this._source.type)){const L={},R={},W=Object.keys(A),oe=o.h.now();for(const se of W){const de=A[se],ie=this._tiles[se];if(!ie||ie.fadeEndTime!==0&&ie.fadeEndTime<=oe)continue;const Pe=this.findLoadedParent(de,y);Pe&&(this._addTile(Pe.tileID),L[Pe.tileID.key]=Pe.tileID),R[se]=de}this._retainLoadedChildren(R,p,T,A);for(const se in L)A[se]||(this._coveredTiles[se]=!0,A[se]=L[se]);if(l){const se={},de={};for(const ie of f)this._tiles[ie.key].hasData()?se[ie.key]=ie:de[ie.key]=ie;for(const ie in de){const Pe=de[ie].children(this._source.maxzoom);this._tiles[Pe[0].key]&&this._tiles[Pe[1].key]&&this._tiles[Pe[2].key]&&this._tiles[Pe[3].key]&&(se[Pe[0].key]=A[Pe[0].key]=Pe[0],se[Pe[1].key]=A[Pe[1].key]=Pe[1],se[Pe[2].key]=A[Pe[2].key]=Pe[2],se[Pe[3].key]=A[Pe[3].key]=Pe[3],delete de[ie])}for(const ie in de){const Pe=this.findLoadedParent(de[ie],this._source.minzoom);if(Pe){se[Pe.tileID.key]=A[Pe.tileID.key]=Pe.tileID;for(const Ge in se)se[Ge].isChildOf(Pe.tileID)&&delete se[Ge]}}for(const ie in this._tiles)se[ie]||(this._coveredTiles[ie]=!0)}}for(const L in A)this._tiles[L].clearFadeHold();const F=o.ab(this._tiles,A);for(const L of F){const R=this._tiles[L];R.hasSymbolBuckets&&!R.holdingForFade()?R.setHoldDuration(this.map._fadeDuration):R.hasSymbolBuckets&&!R.symbolFadeFinished()||this._removeTile(L)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(r)}_updateRetainedTiles(r,l){const f={},p={},y=Math.max(l-Cr.maxOverzooming,this._source.minzoom),T=Math.max(l+Cr.maxUnderzooming,this._source.minzoom),S={};for(const A of r){const F=this._addTile(A);f[A.key]=A,F.hasData()||l<this._source.maxzoom&&(S[A.key]=A)}this._retainLoadedChildren(S,l,T,f);for(const A of r){let F=this._tiles[A.key];if(F.hasData())continue;if(l+1>this._source.maxzoom){const R=A.children(this._source.maxzoom)[0],W=this.getTile(R);if(W&&W.hasData()){f[R.key]=R;continue}}else{const R=A.children(this._source.maxzoom);if(f[R[0].key]&&f[R[1].key]&&f[R[2].key]&&f[R[3].key])continue}let L=F.wasRequested();for(let R=A.overscaledZ-1;R>=y;--R){const W=A.scaledTo(R);if(p[W.key])break;if(p[W.key]=!0,F=this.getTile(W),!F&&L&&(F=this._addTile(W)),F){const oe=F.hasData();if((L||oe)&&(f[W.key]=W),L=F.wasRequested(),oe)break}}}return f}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const l=[];let f,p=this._tiles[r].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){f=this._loadedParentTiles[p.key];break}l.push(p.key);const y=p.scaledTo(p.overscaledZ-1);if(f=this._getLoadedTile(y),f)break;p=y}for(const y of l)this._loadedParentTiles[y]=f}}_addTile(r){let l=this._tiles[r.key];if(l)return l;l=this._cache.getAndRemove(r),l&&(this._setTileReloadTimer(r.key,l),l.tileID=r,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,l)));const f=l;return l||(l=new cr(r,this._source.tileSize*r.overscaleFactor()),this._loadTile(l,this._tileLoaded.bind(this,l,r.key,l.state))),l.uses++,this._tiles[r.key]=l,f||this._source.fire(new o.k("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l}_setTileReloadTimer(r,l){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const f=l.getExpiryTimeout();f&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},f))}_removeTile(r){const l=this._tiles[r];l&&(l.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),l.uses>0||(l.hasData()&&l.state!=="reloading"?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(r);this._cache.reset()}tilesIn(r,l,f){const p=[],y=this.transform;if(!y)return p;const T=f?y.getCameraQueryGeometry(r):r,S=r.map(se=>y.pointCoordinate(se,this.terrain)),A=T.map(se=>y.pointCoordinate(se,this.terrain)),F=this.getIds();let L=1/0,R=1/0,W=-1/0,oe=-1/0;for(const se of A)L=Math.min(L,se.x),R=Math.min(R,se.y),W=Math.max(W,se.x),oe=Math.max(oe,se.y);for(let se=0;se<F.length;se++){const de=this._tiles[F[se]];if(de.holdingForFade())continue;const ie=de.tileID,Pe=Math.pow(2,y.zoom-de.tileID.overscaledZ),Ge=l*de.queryPadding*o.N/de.tileSize/Pe,_e=[ie.getTilePoint(new o.U(L,R)),ie.getTilePoint(new o.U(W,oe))];if(_e[0].x-Ge<o.N&&_e[0].y-Ge<o.N&&_e[1].x+Ge>=0&&_e[1].y+Ge>=0){const Re=S.map(Xe=>ie.getTilePoint(Xe)),Ze=A.map(Xe=>ie.getTilePoint(Xe));p.push({tile:de,tileID:ie,queryGeometry:Re,cameraQueryGeometry:Ze,scale:Pe})}}return p}getVisibleCoordinates(r){const l=this.getRenderableIds(r).map(f=>this._tiles[f].tileID);for(const f of l)f.posMatrix=this.transform.calculatePosMatrix(f.toUnwrapped());return l}hasTransition(){if(this._source.hasTransition())return!0;if(ar(this._source.type)){const r=o.h.now();for(const l in this._tiles)if(this._tiles[l].fadeEndTime>=r)return!0}return!1}setFeatureState(r,l,f){this._state.updateState(r=r||"_geojsonTileLayer",l,f)}removeFeatureState(r,l,f){this._state.removeFeatureState(r=r||"_geojsonTileLayer",l,f)}getFeatureState(r,l){return this._state.getState(r=r||"_geojsonTileLayer",l)}setDependencies(r,l,f){const p=this._tiles[r];p&&p.setDependencies(l,f)}reloadTilesForDependencies(r,l){for(const f in this._tiles)this._tiles[f].hasDependency(r,l)&&this._reloadTile(f,"reloading");this._cache.filter(f=>!f.hasDependency(r,l))}}function Br(g,r){const l=Math.abs(2*g.wrap)-+(g.wrap<0),f=Math.abs(2*r.wrap)-+(r.wrap<0);return g.overscaledZ-r.overscaledZ||f-l||r.canonical.y-g.canonical.y||r.canonical.x-g.canonical.x}function ar(g){return g==="raster"||g==="image"||g==="video"}Cr.maxOverzooming=10,Cr.maxUnderzooming=3;const Gt="mapboxgl_preloaded_worker_pool";class ur{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<ur.workerCount;)this.workers.push(new Worker(o.c.WORKER_URL));return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],this.numActive()===0&&(this.workers.forEach(l=>{l.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Gt]}numActive(){return Object.keys(this.active).length}}const ir=Math.floor(o.h.hardwareConcurrency/2);let Dr;function wr(){return Dr||(Dr=new ur),Dr}ur.workerCount=o.ac(globalThis)?Math.max(Math.min(ir,3),1):1;class Nr{constructor(r,l){this.reset(r,l)}reset(r,l){this.points=r||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=o.ad(r,0,1);let l=1,f=this._distances[l];const p=r*this.paddedLength+this.padding;for(;f<p&&l<this._distances.length;)f=this._distances[++l];const y=l-1,T=this._distances[y],S=f-T,A=S>0?(p-T)/S:0;return this.points[y].mult(1-A).add(this.points[l].mult(A))}}function Ht(g,r){let l=!0;return g==="always"||g!=="never"&&r!=="never"||(l=!1),l}class br{constructor(r,l,f){const p=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(r/f),this.yCellCount=Math.ceil(l/f);for(let T=0;T<this.xCellCount*this.yCellCount;T++)p.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=l,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,l,f,p,y){this._forEachCell(l,f,p,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(l),this.bboxes.push(f),this.bboxes.push(p),this.bboxes.push(y)}insertCircle(r,l,f,p){this._forEachCell(l-p,f-p,l+p,f+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(l),this.circles.push(f),this.circles.push(p)}_insertBoxCell(r,l,f,p,y,T){this.boxCells[y].push(T)}_insertCircleCell(r,l,f,p,y,T){this.circleCells[y].push(T)}_query(r,l,f,p,y,T,S){if(f<0||r>this.width||p<0||l>this.height)return[];const A=[];if(r<=0&&l<=0&&this.width<=f&&this.height<=p){if(y)return[{key:null,x1:r,y1:l,x2:f,y2:p}];for(let F=0;F<this.boxKeys.length;F++)A.push({key:this.boxKeys[F],x1:this.bboxes[4*F],y1:this.bboxes[4*F+1],x2:this.bboxes[4*F+2],y2:this.bboxes[4*F+3]});for(let F=0;F<this.circleKeys.length;F++){const L=this.circles[3*F],R=this.circles[3*F+1],W=this.circles[3*F+2];A.push({key:this.circleKeys[F],x1:L-W,y1:R-W,x2:L+W,y2:R+W})}}else this._forEachCell(r,l,f,p,this._queryCell,A,{hitTest:y,overlapMode:T,seenUids:{box:{},circle:{}}},S);return A}query(r,l,f,p){return this._query(r,l,f,p,!1,null)}hitTest(r,l,f,p,y,T){return this._query(r,l,f,p,!0,y,T).length>0}hitTestCircle(r,l,f,p,y){const T=r-f,S=r+f,A=l-f,F=l+f;if(S<0||T>this.width||F<0||A>this.height)return!1;const L=[];return this._forEachCell(T,A,S,F,this._queryCellCircle,L,{hitTest:!0,overlapMode:p,circle:{x:r,y:l,radius:f},seenUids:{box:{},circle:{}}},y),L.length>0}_queryCell(r,l,f,p,y,T,S,A){const{seenUids:F,hitTest:L,overlapMode:R}=S,W=this.boxCells[y];if(W!==null){const se=this.bboxes;for(const de of W)if(!F.box[de]){F.box[de]=!0;const ie=4*de,Pe=this.boxKeys[de];if(r<=se[ie+2]&&l<=se[ie+3]&&f>=se[ie+0]&&p>=se[ie+1]&&(!A||A(Pe))&&(!L||!Ht(R,Pe.overlapMode))&&(T.push({key:Pe,x1:se[ie],y1:se[ie+1],x2:se[ie+2],y2:se[ie+3]}),L))return!0}}const oe=this.circleCells[y];if(oe!==null){const se=this.circles;for(const de of oe)if(!F.circle[de]){F.circle[de]=!0;const ie=3*de,Pe=this.circleKeys[de];if(this._circleAndRectCollide(se[ie],se[ie+1],se[ie+2],r,l,f,p)&&(!A||A(Pe))&&(!L||!Ht(R,Pe.overlapMode))){const Ge=se[ie],_e=se[ie+1],Re=se[ie+2];if(T.push({key:Pe,x1:Ge-Re,y1:_e-Re,x2:Ge+Re,y2:_e+Re}),L)return!0}}}return!1}_queryCellCircle(r,l,f,p,y,T,S,A){const{circle:F,seenUids:L,overlapMode:R}=S,W=this.boxCells[y];if(W!==null){const se=this.bboxes;for(const de of W)if(!L.box[de]){L.box[de]=!0;const ie=4*de,Pe=this.boxKeys[de];if(this._circleAndRectCollide(F.x,F.y,F.radius,se[ie+0],se[ie+1],se[ie+2],se[ie+3])&&(!A||A(Pe))&&!Ht(R,Pe.overlapMode))return T.push(!0),!0}}const oe=this.circleCells[y];if(oe!==null){const se=this.circles;for(const de of oe)if(!L.circle[de]){L.circle[de]=!0;const ie=3*de,Pe=this.circleKeys[de];if(this._circlesCollide(se[ie],se[ie+1],se[ie+2],F.x,F.y,F.radius)&&(!A||A(Pe))&&!Ht(R,Pe.overlapMode))return T.push(!0),!0}}}_forEachCell(r,l,f,p,y,T,S,A){const F=this._convertToXCellCoord(r),L=this._convertToYCellCoord(l),R=this._convertToXCellCoord(f),W=this._convertToYCellCoord(p);for(let oe=F;oe<=R;oe++)for(let se=L;se<=W;se++)if(y.call(this,r,l,f,p,this.xCellCount*se+oe,T,S,A))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,l,f,p,y,T){const S=p-r,A=y-l,F=f+T;return F*F>S*S+A*A}_circleAndRectCollide(r,l,f,p,y,T,S){const A=(T-p)/2,F=Math.abs(r-(p+A));if(F>A+f)return!1;const L=(S-y)/2,R=Math.abs(l-(y+L));if(R>L+f)return!1;if(F<=A||R<=L)return!0;const W=F-A,oe=R-L;return W*W+oe*oe<=f*f}}function ot(g,r,l,f,p){const y=o.Z();return r?(o.a0(y,y,[1/p,1/p,1]),l||o.ae(y,y,f.angle)):o.a1(y,f.labelPlaneMatrix,g),y}function Pt(g,r,l,f,p){if(r){const y=o.af(g);return o.a0(y,y,[p,p,1]),l||o.ae(y,y,-f.angle),y}return f.glCoordMatrix}function Mt(g,r,l){let f;l?(f=[g.x,g.y,l(g.x,g.y),1],o.ag(f,f,r)):(f=[g.x,g.y,0,1],fe(f,f,r));const p=f[3];return{point:new o.P(f[0]/p,f[1]/p),signedDistanceFromCamera:p}}function lr(g,r){return .5+g/r*.5}function tr(g,r){const l=g[0]/g[3],f=g[1]/g[3];return l>=-r[0]&&l<=r[0]&&f>=-r[1]&&f<=r[1]}function at(g,r,l,f,p,y,T,S,A,F){const L=f?g.textSizeData:g.iconSizeData,R=o.ah(L,l.transform.zoom),W=[256/l.width*2+1,256/l.height*2+1],oe=f?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;oe.clear();const se=g.lineVertexArray,de=f?g.text.placedSymbolArray:g.icon.placedSymbolArray,ie=l.transform.width/l.transform.height;let Pe=!1;for(let Ge=0;Ge<de.length;Ge++){const _e=de.get(Ge);if(_e.hidden||_e.writingMode===o.ai.vertical&&!Pe){te(_e.numGlyphs,oe);continue}let Re;if(Pe=!1,F?(Re=[_e.anchorX,_e.anchorY,F(_e.anchorX,_e.anchorY),1],o.ag(Re,Re,r)):(Re=[_e.anchorX,_e.anchorY,0,1],fe(Re,Re,r)),!tr(Re,W)){te(_e.numGlyphs,oe);continue}const Ze=lr(l.transform.cameraToCenterDistance,Re[3]),Xe=o.aj(L,R,_e),rt=T?Xe/Ze:Xe*Ze,mt=new o.P(_e.anchorX,_e.anchorY),lt=Mt(mt,p,F).point,vt={projections:{},offsets:{}},Ot=Lr(_e,rt,!1,S,r,p,y,g.glyphOffsetArray,se,oe,lt,mt,vt,ie,A,F);Pe=Ot.useVertical,(Ot.notEnoughRoom||Pe||Ot.needsFlipping&&Lr(_e,rt,!0,S,r,p,y,g.glyphOffsetArray,se,oe,lt,mt,vt,ie,A,F).notEnoughRoom)&&te(_e.numGlyphs,oe)}f?g.text.dynamicLayoutVertexBuffer.updateData(oe):g.icon.dynamicLayoutVertexBuffer.updateData(oe)}function Rt(g,r,l,f,p,y,T,S,A,F,L,R,W){const oe=S.glyphStartIndex+S.numGlyphs,se=S.lineStartIndex,de=S.lineStartIndex+S.lineLength,ie=r.getoffsetX(S.glyphStartIndex),Pe=r.getoffsetX(oe-1),Ge=V(g*ie,l,f,p,y,T,S.segment,se,de,A,F,L,R,W);if(!Ge)return null;const _e=V(g*Pe,l,f,p,y,T,S.segment,se,de,A,F,L,R,W);return _e?{first:Ge,last:_e}:null}function Vt(g,r,l,f){return g===o.ai.horizontal&&Math.abs(l.y-r.y)>Math.abs(l.x-r.x)*f?{useVertical:!0}:(g===o.ai.vertical?r.y<l.y:r.x>l.x)?{needsFlipping:!0}:null}function Lr(g,r,l,f,p,y,T,S,A,F,L,R,W,oe,se,de){const ie=r/24,Pe=g.lineOffsetX*ie,Ge=g.lineOffsetY*ie;let _e;if(g.numGlyphs>1){const Re=g.glyphStartIndex+g.numGlyphs,Ze=g.lineStartIndex,Xe=g.lineStartIndex+g.lineLength,rt=Rt(ie,S,Pe,Ge,l,L,R,g,A,y,W,se,de);if(!rt)return{notEnoughRoom:!0};const mt=Mt(rt.first.point,T,de).point,lt=Mt(rt.last.point,T,de).point;if(f&&!l){const vt=Vt(g.writingMode,mt,lt,oe);if(vt)return vt}_e=[rt.first];for(let vt=g.glyphStartIndex+1;vt<Re-1;vt++)_e.push(V(ie*S.getoffsetX(vt),Pe,Ge,l,L,R,g.segment,Ze,Xe,A,y,W,se,de));_e.push(rt.last)}else{if(f&&!l){const Ze=Mt(R,p,de).point,Xe=g.lineStartIndex+g.segment+1,rt=new o.P(A.getx(Xe),A.gety(Xe)),mt=Mt(rt,p,de),lt=mt.signedDistanceFromCamera>0?mt.point:Kr(R,rt,Ze,1,p,de),vt=Vt(g.writingMode,Ze,lt,oe);if(vt)return vt}const Re=V(ie*S.getoffsetX(g.glyphStartIndex),Pe,Ge,l,L,R,g.segment,g.lineStartIndex,g.lineStartIndex+g.lineLength,A,y,W,se,de);if(!Re)return{notEnoughRoom:!0};_e=[Re]}for(const Re of _e)o.ak(F,Re.point,Re.angle);return{}}function Kr(g,r,l,f,p,y){const T=Mt(g.add(g.sub(r)._unit()),p,y).point,S=l.sub(T);return l.add(S._mult(f/S.mag()))}function rr(g,r){const{projectionCache:l,lineVertexArray:f,labelPlaneMatrix:p,tileAnchorPoint:y,distanceFromAnchor:T,getElevation:S,previousVertex:A,direction:F,absOffsetX:L}=r;if(l.projections[g])return l.projections[g];const R=new o.P(f.getx(g),f.gety(g)),W=Mt(R,p,S);if(W.signedDistanceFromCamera>0)return l.projections[g]=W.point,W.point;const oe=g-F;return Kr(T===0?y:new o.P(f.getx(oe),f.gety(oe)),R,A,L-T+1,p,S)}function Aa(g,r,l){return g._unit()._perp()._mult(r*l)}function ce(g,r,l,f,p,y,T,S){const{projectionCache:A,direction:F}=S;if(A.offsets[g])return A.offsets[g];const L=l.add(r);if(g+F<f||g+F>=p)return A.offsets[g]=L,L;const R=rr(g+F,S),W=Aa(R.sub(l),T,F),oe=l.add(W),se=R.add(W);return A.offsets[g]=o.al(y,L,oe,se)||L,A.offsets[g]}function V(g,r,l,f,p,y,T,S,A,F,L,R,W,oe){const se=f?g-r:g+r;let de=se>0?1:-1,ie=0;f&&(de*=-1,ie=Math.PI),de<0&&(ie+=Math.PI);let Pe,Ge,_e=de>0?S+T:S+T+1,Re=p,Ze=p,Xe=0,rt=0;const mt=Math.abs(se),lt=[];let vt;for(;Xe+rt<=mt;){if(_e+=de,_e<S||_e>=A)return null;Xe+=rt,Ze=Re,Ge=Pe;const Et={projectionCache:R,lineVertexArray:F,labelPlaneMatrix:L,tileAnchorPoint:y,distanceFromAnchor:Xe,getElevation:oe,previousVertex:Ze,direction:de,absOffsetX:mt};if(Re=rr(_e,Et),l===0)lt.push(Ze),vt=Re.sub(Ze);else{let qt;const zt=Re.sub(Ze);qt=zt.mag()===0?Aa(rr(_e+de,Et).sub(Re),l,de):Aa(zt,l,de),Ge||(Ge=Ze.add(qt)),Pe=ce(_e,qt,Re,S,A,Ge,l,Et),lt.push(Ge),vt=Pe.sub(Ge)}rt=vt.mag()}const Ot=vt._mult((mt-Xe)/rt)._add(Ge||Ze),pr=ie+Math.atan2(Re.y-Ze.y,Re.x-Ze.x);return lt.push(Ot),{point:Ot,angle:W?pr:0,path:lt}}const H=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function te(g,r){for(let l=0;l<g;l++){const f=r.length;r.resize(f+4),r.float32.set(H,3*f)}}function fe(g,r,l){const f=r[0],p=r[1];return g[0]=l[0]*f+l[4]*p+l[12],g[1]=l[1]*f+l[5]*p+l[13],g[3]=l[3]*f+l[7]*p+l[15],g}const me=100;class Oe{constructor(r,l=new br(r.width+200,r.height+200,25),f=new br(r.width+200,r.height+200,25)){this.transform=r,this.grid=l,this.ignoredGrid=f,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+me,this.screenBottomBoundary=r.height+me,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(r,l,f,p,y,T){const S=this.projectAndGetPerspectiveRatio(p,r.anchorPointX,r.anchorPointY,T),A=f*S.perspectiveRatio,F=r.x1*A+S.point.x,L=r.y1*A+S.point.y,R=r.x2*A+S.point.x,W=r.y2*A+S.point.y;return!this.isInsideGrid(F,L,R,W)||l!=="always"&&this.grid.hitTest(F,L,R,W,l,y)||S.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[F,L,R,W],offscreen:this.isOffscreen(F,L,R,W)}}placeCollisionCircles(r,l,f,p,y,T,S,A,F,L,R,W,oe,se){const de=[],ie=new o.P(l.anchorX,l.anchorY),Pe=Mt(ie,T,se),Ge=lr(this.transform.cameraToCenterDistance,Pe.signedDistanceFromCamera),_e=(L?y/Ge:y*Ge)/o.ap,Re=Mt(ie,S,se).point,Ze=Rt(_e,p,l.lineOffsetX*_e,l.lineOffsetY*_e,!1,Re,ie,l,f,S,{projections:{},offsets:{}},!1,se);let Xe=!1,rt=!1,mt=!0;if(Ze){const lt=.5*W*Ge+oe,vt=new o.P(-100,-100),Ot=new o.P(this.screenRightBoundary,this.screenBottomBoundary),pr=new Nr,Et=Ze.first,qt=Ze.last;let zt=[];for(let sr=Et.path.length-1;sr>=1;sr--)zt.push(Et.path[sr]);for(let sr=1;sr<qt.path.length;sr++)zt.push(qt.path[sr]);const Rr=2.5*lt;if(A){const sr=zt.map(mr=>Mt(mr,A,se));zt=sr.some(mr=>mr.signedDistanceFromCamera<=0)?[]:sr.map(mr=>mr.point)}let dr=[];if(zt.length>0){const sr=zt[0].clone(),mr=zt[0].clone();for(let ra=1;ra<zt.length;ra++)sr.x=Math.min(sr.x,zt[ra].x),sr.y=Math.min(sr.y,zt[ra].y),mr.x=Math.max(mr.x,zt[ra].x),mr.y=Math.max(mr.y,zt[ra].y);dr=sr.x>=vt.x&&mr.x<=Ot.x&&sr.y>=vt.y&&mr.y<=Ot.y?[zt]:mr.x<vt.x||sr.x>Ot.x||mr.y<vt.y||sr.y>Ot.y?[]:o.am([zt],vt.x,vt.y,Ot.x,Ot.y)}for(const sr of dr){pr.reset(sr,.25*lt);let mr=0;mr=pr.length<=.5*lt?1:Math.ceil(pr.paddedLength/Rr)+1;for(let ra=0;ra<mr;ra++){const zr=ra/Math.max(mr-1,1),Fa=pr.lerp(zr),ga=Fa.x+me,la=Fa.y+me;de.push(ga,la,lt,0);const yi=ga-lt,Vr=la-lt,Ki=ga+lt,Yi=la+lt;if(mt=mt&&this.isOffscreen(yi,Vr,Ki,Yi),rt=rt||this.isInsideGrid(yi,Vr,Ki,Yi),r!=="always"&&this.grid.hitTestCircle(ga,la,lt,r,R)&&(Xe=!0,!F))return{circles:[],offscreen:!1,collisionDetected:Xe}}}}return{circles:!F&&Xe||!rt||Ge<this.perspectiveRatioCutoff?[]:de,offscreen:mt,collisionDetected:Xe}}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const l=[];let f=1/0,p=1/0,y=-1/0,T=-1/0;for(const L of r){const R=new o.P(L.x+me,L.y+me);f=Math.min(f,R.x),p=Math.min(p,R.y),y=Math.max(y,R.x),T=Math.max(T,R.y),l.push(R)}const S=this.grid.query(f,p,y,T).concat(this.ignoredGrid.query(f,p,y,T)),A={},F={};for(const L of S){const R=L.key;if(A[R.bucketInstanceId]===void 0&&(A[R.bucketInstanceId]={}),A[R.bucketInstanceId][R.featureIndex])continue;const W=[new o.P(L.x1,L.y1),new o.P(L.x2,L.y1),new o.P(L.x2,L.y2),new o.P(L.x1,L.y2)];o.an(l,W)&&(A[R.bucketInstanceId][R.featureIndex]=!0,F[R.bucketInstanceId]===void 0&&(F[R.bucketInstanceId]=[]),F[R.bucketInstanceId].push(R.featureIndex))}return F}insertCollisionBox(r,l,f,p,y,T){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:y,collisionGroupID:T,overlapMode:l},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,l,f,p,y,T){const S=f?this.ignoredGrid:this.grid,A={bucketInstanceId:p,featureIndex:y,collisionGroupID:T,overlapMode:l};for(let F=0;F<r.length;F+=4)S.insertCircle(A,r[F],r[F+1],r[F+2])}projectAndGetPerspectiveRatio(r,l,f,p){let y;return p?(y=[l,f,p(l,f),1],o.ag(y,y,r)):(y=[l,f,0,1],fe(y,y,r)),{point:new o.P((y[0]/y[3]+1)/2*this.transform.width+me,(-y[1]/y[3]+1)/2*this.transform.height+me),perspectiveRatio:.5+this.transform.cameraToCenterDistance/y[3]*.5}}isOffscreen(r,l,f,p){return f<me||r>=this.screenRightBoundary||p<me||l>this.screenBottomBoundary}isInsideGrid(r,l,f,p){return f>=0&&r<this.gridRightBoundary&&p>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const r=o.ao([]);return o.$(r,r,[-100,-100,0]),r}}function Ce(g,r,l){return r*(o.N/(g.tileSize*Math.pow(2,l-g.tileID.overscaledZ)))}class ve{constructor(r,l,f,p){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?l:-l))):p&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class Me{constructor(r,l,f,p,y){this.text=new ve(r?r.text:null,l,f,y),this.icon=new ve(r?r.icon:null,l,p,y)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Qe{constructor(r,l,f){this.text=r,this.icon=l,this.skipFade=f}}class et{constructor(){this.invProjMatrix=o.Z(),this.viewportMatrix=o.Z(),this.circles=[]}}class z{constructor(r,l,f,p,y){this.bucketInstanceId=r,this.featureIndex=l,this.sourceLayerIndex=f,this.bucketIndex=p,this.tileID=y}}class Q{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const l=++this.maxGroupID;this.collisionGroups[r]={ID:l,predicate:f=>f.collisionGroupID===l}}return this.collisionGroups[r]}}function Y(g,r,l,f,p){const{horizontalAlign:y,verticalAlign:T}=o.au(g);return new o.P(-(y-.5)*r+f[0]*p,-(T-.5)*l+f[1]*p)}function K(g,r,l,f,p,y){const{x1:T,x2:S,y1:A,y2:F,anchorPointX:L,anchorPointY:R}=g,W=new o.P(r,l);return f&&W._rotate(p?y:-y),{x1:T+W.x,y1:A+W.y,x2:S+W.x,y2:F+W.y,anchorPointX:L,anchorPointY:R}}class ee{constructor(r,l,f,p,y){this.transform=r.clone(),this.terrain=l,this.collisionIndex=new Oe(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new Q(p),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,l,f,p){const y=f.getBucket(l),T=f.latestFeatureIndex;if(!y||!T||l.id!==y.layerIds[0])return;const S=f.collisionBoxArray,A=y.layers[0].layout,F=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),L=f.tileSize/o.N,R=this.transform.calculatePosMatrix(f.tileID.toUnwrapped()),W=A.get("text-pitch-alignment")==="map",oe=A.get("text-rotation-alignment")==="map",se=Ce(f,1,this.transform.zoom),de=ot(R,W,oe,this.transform,se);let ie=null;if(W){const Ge=Pt(R,W,oe,this.transform,se);ie=o.a1([],this.transform.labelPlaneMatrix,Ge)}this.retainedQueryData[y.bucketInstanceId]=new z(y.bucketInstanceId,T,y.sourceLayerIndex,y.index,f.tileID);const Pe={bucket:y,layout:A,posMatrix:R,textLabelPlaneMatrix:de,labelToScreenMatrix:ie,scale:F,textPixelRatio:L,holdingForFade:f.holdingForFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:o.ah(y.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(p)for(const Ge of y.sortKeyRanges){const{sortKey:_e,symbolInstanceStart:Re,symbolInstanceEnd:Ze}=Ge;r.push({sortKey:_e,symbolInstanceStart:Re,symbolInstanceEnd:Ze,parameters:Pe})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:Pe})}attemptAnchorPlacement(r,l,f,p,y,T,S,A,F,L,R,W,oe,se,de,ie){const Pe=o.aq[r.textAnchor],Ge=[r.textOffset0,r.textOffset1],_e=Y(Pe,f,p,Ge,y),Re=this.collisionIndex.placeCollisionBox(K(l,_e.x,_e.y,T,S,this.transform.angle),R,A,F,L.predicate,ie);if((!de||this.collisionIndex.placeCollisionBox(K(de,_e.x,_e.y,T,S,this.transform.angle),R,A,F,L.predicate,ie).box.length!==0)&&Re.box.length>0){let Ze;if(this.prevPlacement&&this.prevPlacement.variableOffsets[W.crossTileID]&&this.prevPlacement.placements[W.crossTileID]&&this.prevPlacement.placements[W.crossTileID].text&&(Ze=this.prevPlacement.variableOffsets[W.crossTileID].anchor),W.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[W.crossTileID]={textOffset:Ge,width:f,height:p,anchor:Pe,textBoxScale:y,prevAnchor:Ze},this.markUsedJustification(oe,Pe,W,se),oe.allowVerticalPlacement&&(this.markUsedOrientation(oe,se,W),this.placedOrientations[W.crossTileID]=se),{shift:_e,placedGlyphBoxes:Re}}}placeLayerBucketPart(r,l,f){const{bucket:p,layout:y,posMatrix:T,textLabelPlaneMatrix:S,labelToScreenMatrix:A,textPixelRatio:F,holdingForFade:L,collisionBoxArray:R,partiallyEvaluatedTextSize:W,collisionGroup:oe}=r.parameters,se=y.get("text-optional"),de=y.get("icon-optional"),ie=o.ar(y,"text-overlap","text-allow-overlap"),Pe=ie==="always",Ge=o.ar(y,"icon-overlap","icon-allow-overlap"),_e=Ge==="always",Re=y.get("text-rotation-alignment")==="map",Ze=y.get("text-pitch-alignment")==="map",Xe=y.get("icon-text-fit")!=="none",rt=y.get("symbol-z-order")==="viewport-y",mt=Pe&&(_e||!p.hasIconData()||de),lt=_e&&(Pe||!p.hasTextData()||se);!p.collisionArrays&&R&&p.deserializeCollisionBoxes(R);const vt=this.retainedQueryData[p.bucketInstanceId].tileID,Ot=this.terrain?(Et,qt)=>this.terrain.getElevation(vt,Et,qt):null,pr=(Et,qt)=>{var zt,Rr;if(l[Et.crossTileID])return;if(L)return void(this.placements[Et.crossTileID]=new Qe(!1,!1,!1));let dr=!1,sr=!1,mr=!0,ra=null,zr={box:null,offscreen:null},Fa={box:null,offscreen:null},ga=null,la=null,yi=null,Vr=0,Ki=0,Yi=0;qt.textFeatureIndex?Vr=qt.textFeatureIndex:Et.useRuntimeCollisionCircles&&(Vr=Et.featureIndex),qt.verticalTextFeatureIndex&&(Ki=qt.verticalTextFeatureIndex);const Dn=qt.textBox;if(Dn){const za=aa=>{let xa=o.ai.horizontal;if(p.allowVerticalPlacement&&!aa&&this.prevPlacement){const ri=this.prevPlacement.placedOrientations[Et.crossTileID];ri&&(this.placedOrientations[Et.crossTileID]=ri,xa=ri,this.markUsedOrientation(p,xa,Et))}return xa},Pa=(aa,xa)=>{if(p.allowVerticalPlacement&&Et.numVerticalGlyphVertices>0&&qt.verticalTextBox){for(const ri of p.writingModes)if(ri===o.ai.vertical?(zr=xa(),Fa=zr):zr=aa(),zr&&zr.box&&zr.box.length)break}else zr=aa()},Wa=Et.textAnchorOffsetStartIndex,Kn=Et.textAnchorOffsetEndIndex;if(Kn===Wa){const aa=(xa,ri)=>{const ia=this.collisionIndex.placeCollisionBox(xa,ie,F,T,oe.predicate,Ot);return ia&&ia.box&&ia.box.length&&(this.markUsedOrientation(p,ri,Et),this.placedOrientations[Et.crossTileID]=ri),ia};Pa(()=>aa(Dn,o.ai.horizontal),()=>{const xa=qt.verticalTextBox;return p.allowVerticalPlacement&&Et.numVerticalGlyphVertices>0&&xa?aa(xa,o.ai.vertical):{box:null,offscreen:null}}),za(zr&&zr.box&&zr.box.length)}else{let aa=o.aq[(Rr=(zt=this.prevPlacement)===null||zt===void 0?void 0:zt.variableOffsets[Et.crossTileID])===null||Rr===void 0?void 0:Rr.anchor];const xa=(ia,Yn,Qo)=>{const Wu=ia.x2-ia.x1,qu=ia.y2-ia.y1,df=Et.textBoxScale,hc=Xe&&Ge==="never"?Yn:null;let Ji={box:[],offscreen:!1},Jn=ie==="never"?1:2,Qi="never";aa&&Jn++;for(let Oi=0;Oi<Jn;Oi++){for(let en=Wa;en<Kn;en++){const fc=p.textAnchorOffsets.get(en);if(aa&&fc.textAnchor!==aa)continue;const gn=this.attemptAnchorPlacement(fc,ia,Wu,qu,df,Re,Ze,F,T,oe,Qi,Et,p,Qo,hc,Ot);if(gn&&(Ji=gn.placedGlyphBoxes,Ji&&Ji.box&&Ji.box.length))return dr=!0,ra=gn.shift,Ji}aa?aa=null:Qi=ie}return Ji};Pa(()=>xa(Dn,qt.iconBox,o.ai.horizontal),()=>{const ia=qt.verticalTextBox;return p.allowVerticalPlacement&&!(zr&&zr.box&&zr.box.length)&&Et.numVerticalGlyphVertices>0&&ia?xa(ia,qt.verticalIconBox,o.ai.vertical):{box:null,offscreen:null}}),zr&&(dr=zr.box,mr=zr.offscreen);const ri=za(zr&&zr.box);if(!dr&&this.prevPlacement){const ia=this.prevPlacement.variableOffsets[Et.crossTileID];ia&&(this.variableOffsets[Et.crossTileID]=ia,this.markUsedJustification(p,ia.anchor,Et,ri))}}}if(ga=zr,dr=ga&&ga.box&&ga.box.length>0,mr=ga&&ga.offscreen,Et.useRuntimeCollisionCircles){const za=p.text.placedSymbolArray.get(Et.centerJustifiedTextSymbolIndex),Pa=o.aj(p.textSizeData,W,za),Wa=y.get("text-padding");la=this.collisionIndex.placeCollisionCircles(ie,za,p.lineVertexArray,p.glyphOffsetArray,Pa,T,S,A,f,Ze,oe.predicate,Et.collisionCircleDiameter,Wa,Ot),la.circles.length&&la.collisionDetected&&!f&&o.w("Collisions detected, but collision boxes are not shown"),dr=Pe||la.circles.length>0&&!la.collisionDetected,mr=mr&&la.offscreen}if(qt.iconFeatureIndex&&(Yi=qt.iconFeatureIndex),qt.iconBox){const za=Pa=>{const Wa=Xe&&ra?K(Pa,ra.x,ra.y,Re,Ze,this.transform.angle):Pa;return this.collisionIndex.placeCollisionBox(Wa,Ge,F,T,oe.predicate,Ot)};Fa&&Fa.box&&Fa.box.length&&qt.verticalIconBox?(yi=za(qt.verticalIconBox),sr=yi.box.length>0):(yi=za(qt.iconBox),sr=yi.box.length>0),mr=mr&&yi.offscreen}const Xn=se||Et.numHorizontalGlyphVertices===0&&Et.numVerticalGlyphVertices===0,ws=de||Et.numIconVertices===0;if(Xn||ws?ws?Xn||(sr=sr&&dr):dr=sr&&dr:sr=dr=sr&&dr,dr&&ga&&ga.box&&this.collisionIndex.insertCollisionBox(ga.box,ie,y.get("text-ignore-placement"),p.bucketInstanceId,Fa&&Fa.box&&Ki?Ki:Vr,oe.ID),sr&&yi&&this.collisionIndex.insertCollisionBox(yi.box,Ge,y.get("icon-ignore-placement"),p.bucketInstanceId,Yi,oe.ID),la&&(dr&&this.collisionIndex.insertCollisionCircles(la.circles,ie,y.get("text-ignore-placement"),p.bucketInstanceId,Vr,oe.ID),f)){const za=p.bucketInstanceId;let Pa=this.collisionCircleArrays[za];Pa===void 0&&(Pa=this.collisionCircleArrays[za]=new et);for(let Wa=0;Wa<la.circles.length;Wa+=4)Pa.circles.push(la.circles[Wa+0]),Pa.circles.push(la.circles[Wa+1]),Pa.circles.push(la.circles[Wa+2]),Pa.circles.push(la.collisionDetected?1:0)}if(Et.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(p.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Et.crossTileID]=new Qe(dr||mt,sr||lt,mr||p.justReloaded),l[Et.crossTileID]=!0};if(rt){if(r.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Et=p.getSortedSymbolIndexes(this.transform.angle);for(let qt=Et.length-1;qt>=0;--qt){const zt=Et[qt];pr(p.symbolInstances.get(zt),p.collisionArrays[zt])}}else for(let Et=r.symbolInstanceStart;Et<r.symbolInstanceEnd;Et++)pr(p.symbolInstances.get(Et),p.collisionArrays[Et]);if(f&&p.bucketInstanceId in this.collisionCircleArrays){const Et=this.collisionCircleArrays[p.bucketInstanceId];o.as(Et.invProjMatrix,T),Et.viewportMatrix=this.collisionIndex.getViewportMatrix()}p.justReloaded=!1}markUsedJustification(r,l,f,p){let y;y=p===o.ai.vertical?f.verticalPlacedTextSymbolIndex:{left:f.leftJustifiedTextSymbolIndex,center:f.centerJustifiedTextSymbolIndex,right:f.rightJustifiedTextSymbolIndex}[o.at(l)];const T=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex,f.verticalPlacedTextSymbolIndex];for(const S of T)S>=0&&(r.text.placedSymbolArray.get(S).crossTileID=y>=0&&S!==y?0:f.crossTileID)}markUsedOrientation(r,l,f){const p=l===o.ai.horizontal||l===o.ai.horizontalOnly?l:0,y=l===o.ai.vertical?l:0,T=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex];for(const S of T)r.text.placedSymbolArray.get(S).placedOrientation=p;f.verticalPlacedTextSymbolIndex&&(r.text.placedSymbolArray.get(f.verticalPlacedTextSymbolIndex).placedOrientation=y)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let f=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const p=l?l.symbolFadeChange(r):1,y=l?l.opacities:{},T=l?l.variableOffsets:{},S=l?l.placedOrientations:{};for(const A in this.placements){const F=this.placements[A],L=y[A];L?(this.opacities[A]=new Me(L,p,F.text,F.icon),f=f||F.text!==L.text.placed||F.icon!==L.icon.placed):(this.opacities[A]=new Me(null,p,F.text,F.icon,F.skipFade),f=f||F.text||F.icon)}for(const A in y){const F=y[A];if(!this.opacities[A]){const L=new Me(F,p,!1,!1);L.isHidden()||(this.opacities[A]=L,f=f||F.text.placed||F.icon.placed)}}for(const A in T)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=T[A]);for(const A in S)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=S[A]);if(l&&l.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");f?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:r)}updateLayerOpacities(r,l){const f={};for(const p of l){const y=p.getBucket(r);y&&p.latestFeatureIndex&&r.id===y.layerIds[0]&&this.updateBucketOpacities(y,f,p.collisionBoxArray)}}updateBucketOpacities(r,l,f){r.hasTextData()&&(r.text.opacityVertexArray.clear(),r.text.hasVisibleVertices=!1),r.hasIconData()&&(r.icon.opacityVertexArray.clear(),r.icon.hasVisibleVertices=!1),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const p=r.layers[0],y=p.layout,T=new Me(null,0,!1,!1,!0),S=y.get("text-allow-overlap"),A=y.get("icon-allow-overlap"),F=p._unevaluatedLayout.hasValue("text-variable-anchor")||p._unevaluatedLayout.hasValue("text-variable-anchor-offset"),L=y.get("text-rotation-alignment")==="map",R=y.get("text-pitch-alignment")==="map",W=y.get("icon-text-fit")!=="none",oe=new Me(null,0,S&&(A||!r.hasIconData()||y.get("icon-optional")),A&&(S||!r.hasTextData()||y.get("text-optional")),!0);!r.collisionArrays&&f&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(f);const se=(de,ie,Pe)=>{for(let Ge=0;Ge<ie/4;Ge++)de.opacityVertexArray.emplaceBack(Pe);de.hasVisibleVertices=de.hasVisibleVertices||Pe!==dt};for(let de=0;de<r.symbolInstances.length;de++){const ie=r.symbolInstances.get(de),{numHorizontalGlyphVertices:Pe,numVerticalGlyphVertices:Ge,crossTileID:_e}=ie;let Re=this.opacities[_e];l[_e]?Re=T:Re||(Re=oe,this.opacities[_e]=Re),l[_e]=!0;const Ze=ie.numIconVertices>0,Xe=this.placedOrientations[ie.crossTileID],rt=Xe===o.ai.vertical,mt=Xe===o.ai.horizontal||Xe===o.ai.horizontalOnly;if(Pe>0||Ge>0){const lt=yt(Re.text);se(r.text,Pe,rt?dt:lt),se(r.text,Ge,mt?dt:lt);const vt=Re.text.isHidden();[ie.rightJustifiedTextSymbolIndex,ie.centerJustifiedTextSymbolIndex,ie.leftJustifiedTextSymbolIndex].forEach(Et=>{Et>=0&&(r.text.placedSymbolArray.get(Et).hidden=vt||rt?1:0)}),ie.verticalPlacedTextSymbolIndex>=0&&(r.text.placedSymbolArray.get(ie.verticalPlacedTextSymbolIndex).hidden=vt||mt?1:0);const Ot=this.variableOffsets[ie.crossTileID];Ot&&this.markUsedJustification(r,Ot.anchor,ie,Xe);const pr=this.placedOrientations[ie.crossTileID];pr&&(this.markUsedJustification(r,"left",ie,pr),this.markUsedOrientation(r,pr,ie))}if(Ze){const lt=yt(Re.icon),vt=!(W&&ie.verticalPlacedIconSymbolIndex&&rt);ie.placedIconSymbolIndex>=0&&(se(r.icon,ie.numIconVertices,vt?lt:dt),r.icon.placedSymbolArray.get(ie.placedIconSymbolIndex).hidden=Re.icon.isHidden()),ie.verticalPlacedIconSymbolIndex>=0&&(se(r.icon,ie.numVerticalIconVertices,vt?dt:lt),r.icon.placedSymbolArray.get(ie.verticalPlacedIconSymbolIndex).hidden=Re.icon.isHidden())}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const lt=r.collisionArrays[de];if(lt){let vt=new o.P(0,0);if(lt.textBox||lt.verticalTextBox){let pr=!0;if(F){const Et=this.variableOffsets[_e];Et?(vt=Y(Et.anchor,Et.width,Et.height,Et.textOffset,Et.textBoxScale),L&&vt._rotate(R?this.transform.angle:-this.transform.angle)):pr=!1}lt.textBox&&J(r.textCollisionBox.collisionVertexArray,Re.text.placed,!pr||rt,vt.x,vt.y),lt.verticalTextBox&&J(r.textCollisionBox.collisionVertexArray,Re.text.placed,!pr||mt,vt.x,vt.y)}const Ot=!!(!mt&&lt.verticalIconBox);lt.iconBox&&J(r.iconCollisionBox.collisionVertexArray,Re.icon.placed,Ot,W?vt.x:0,W?vt.y:0),lt.verticalIconBox&&J(r.iconCollisionBox.collisionVertexArray,Re.icon.placed,!Ot,W?vt.x:0,W?vt.y:0)}}}if(r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.text.opacityVertexArray.length!==r.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${r.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${r.text.layoutVertexArray.length}) / 4`);if(r.icon.opacityVertexArray.length!==r.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${r.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${r.icon.layoutVertexArray.length}) / 4`);if(r.bucketInstanceId in this.collisionCircleArrays){const de=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=de.invProjMatrix,r.placementViewportMatrix=de.viewportMatrix,r.collisionCircleArray=de.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,l){const f=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*f>r}setStale(){this.stale=!0}}function J(g,r,l,f,p){g.emplaceBack(r?1:0,l?1:0,f||0,p||0),g.emplaceBack(r?1:0,l?1:0,f||0,p||0),g.emplaceBack(r?1:0,l?1:0,f||0,p||0),g.emplaceBack(r?1:0,l?1:0,f||0,p||0)}const Ae=Math.pow(2,25),Ue=Math.pow(2,24),Fe=Math.pow(2,17),De=Math.pow(2,16),Ve=Math.pow(2,9),Ye=Math.pow(2,8),nt=Math.pow(2,1);function yt(g){if(g.opacity===0&&!g.placed)return 0;if(g.opacity===1&&g.placed)return 4294967295;const r=g.placed?1:0,l=Math.floor(127*g.opacity);return l*Ae+r*Ue+l*Fe+r*De+l*Ve+r*Ye+l*nt+r}const dt=0;class It{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&!r.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(r,l,f,p,y){const T=this._bucketParts;for(;this._currentTileIndex<r.length;)if(l.getBucketParts(T,p,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort((S,A)=>S.sortKey-A.sortKey));this._currentPartIndex<T.length;)if(l.placeLayerBucketPart(T[this._currentPartIndex],this._seenCrossTileIDs,f),this._currentPartIndex++,y())return!0;return!1}}class Kt{constructor(r,l,f,p,y,T,S,A){this.placement=new ee(r,l,T,S,A),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(r,l,f){const p=o.h.now(),y=()=>!this._forceFullPlacement&&o.h.now()-p>2;for(;this._currentPlacementIndex>=0;){const T=l[r[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=S)&&(!T.maxzoom||T.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new It(T)),this._inProgressLayer.continuePlacement(f[T.source],this.placement,this._showCollisionBoxes,T,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const _r=512/o.N/2;class Ar{constructor(r,l,f){this.tileID=r,this.bucketInstanceId=f,this._symbolsByKey={};const p=new Map;for(let y=0;y<l.length;y++){const T=l.get(y),S=T.key,A=p.get(S);A?A.push(T):p.set(S,[T])}for(const[y,T]of p){const S={positions:T.map(A=>({x:Math.floor(A.anchorX*_r),y:Math.floor(A.anchorY*_r)})),crossTileIDs:T.map(A=>A.crossTileID)};if(S.positions.length>128){const A=new o.av(S.positions.length,16,Uint16Array);for(const{x:F,y:L}of S.positions)A.add(F,L);A.finish(),delete S.positions,S.index=A}this._symbolsByKey[y]=S}}getScaledCoordinates(r,l){const{x:f,y:p,z:y}=this.tileID.canonical,{x:T,y:S,z:A}=l.canonical,F=_r/Math.pow(2,A-y),L=(S*o.N+r.anchorY)*F,R=p*o.N*_r;return{x:Math.floor((T*o.N+r.anchorX)*F-f*o.N*_r),y:Math.floor(L-R)}}findMatches(r,l,f){const p=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z);for(let y=0;y<r.length;y++){const T=r.get(y);if(T.crossTileID)continue;const S=this._symbolsByKey[T.key];if(!S)continue;const A=this.getScaledCoordinates(T,l);if(S.index){const F=S.index.range(A.x-p,A.y-p,A.x+p,A.y+p).sort();for(const L of F){const R=S.crossTileIDs[L];if(!f[R]){f[R]=!0,T.crossTileID=R;break}}}else if(S.positions)for(let F=0;F<S.positions.length;F++){const L=S.positions[F],R=S.crossTileIDs[F];if(Math.abs(L.x-A.x)<=p&&Math.abs(L.y-A.y)<=p&&!f[R]){f[R]=!0,T.crossTileID=R;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:r})=>r)}}class er{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ua{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const l=Math.round((r-this.lng)/360);if(l!==0)for(const f in this.indexes){const p=this.indexes[f],y={};for(const T in p){const S=p[T];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+l),y[S.tileID.key]=S}this.indexes[f]=y}this.lng=r}addBucket(r,l,f){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let y=0;y<l.symbolInstances.length;y++)l.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]={});const p=this.usedCrossTileIDs[r.overscaledZ];for(const y in this.indexes){const T=this.indexes[y];if(Number(y)>r.overscaledZ)for(const S in T){const A=T[S];A.tileID.isChildOf(r)&&A.findMatches(l.symbolInstances,r,p)}else{const S=T[r.scaledTo(Number(y)).key];S&&S.findMatches(l.symbolInstances,r,p)}}for(let y=0;y<l.symbolInstances.length;y++){const T=l.symbolInstances.get(y);T.crossTileID||(T.crossTileID=f.generate(),p[T.crossTileID]=!0)}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new Ar(r,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(r,l){for(const f of l.getCrossTileIDsLists())for(const p of f)delete this.usedCrossTileIDs[r][p]}removeStaleBuckets(r){let l=!1;for(const f in this.indexes){const p=this.indexes[f];for(const y in p)r[p[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,p[y]),delete p[y],l=!0)}return l}}class ma{constructor(){this.layerIndexes={},this.crossTileIDs=new er,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,l,f){let p=this.layerIndexes[r.id];p===void 0&&(p=this.layerIndexes[r.id]=new ua);let y=!1;const T={};p.handleWrapJump(f);for(const S of l){const A=S.getBucket(r);A&&r.id===A.layerIds[0]&&(A.bucketInstanceId||(A.bucketInstanceId=++this.maxBucketInstanceId),p.addBucket(S.tileID,A,this.crossTileIDs)&&(y=!0),T[A.bucketInstanceId]=!0)}return p.removeStaleBuckets(T)&&(y=!0),y}pruneUnusedLayers(r){const l={};r.forEach(f=>{l[f]=!0});for(const f in this.layerIndexes)l[f]||delete this.layerIndexes[f]}}const ea=(g,r)=>o.x(g,r&&r.filter(l=>l.identifier!=="source.canvas")),sa=o.F(o.ax,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),Ns=o.F(o.ax,["setCenter","setZoom","setBearing","setPitch"]),ta=o.aw();class Ia extends o.E{constructor(r,l={}){super(),this.map=r,this.dispatcher=new Ft(wr(),this,r._getMapId()),this.imageManager=new Le,this.imageManager.setEventedParent(this),this.glyphManager=new xt(r._requestManager,l.localIdeographFontFamily),this.lineAtlas=new Nt(256,512),this.crossTileSymbolIndex=new ma,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.az());const f=this;this._rtlTextPluginCallback=Ia.registerForPluginStateChange(p=>{f.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:p.pluginStatus,pluginURL:p.pluginURL},(y,T)=>{if(o.aA(y),T&&T.every(S=>S))for(const S in f.sourceCaches){const A=f.sourceCaches[S].getSource().type;A!=="vector"&&A!=="geojson"||f.sourceCaches[S].reload()}})}),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const y=this.sourceCaches[p.sourceId];if(!y)return;const T=y.getSource();if(T&&T.vectorLayerIds)for(const S in this._layers){const A=this._layers[S];A.source===T.id&&this._validateLayer(A)}})}loadURL(r,l={},f){this.fire(new o.k("dataloading",{dataType:"style"})),l.validate=typeof l.validate!="boolean"||l.validate;const p=this.map._requestManager.transformRequest(r,re.Style);this._request=o.f(p,(y,T)=>{this._request=null,y?this.fire(new o.j(y)):T&&this._load(T,l,f)})}loadJSON(r,l={},f){this.fire(new o.k("dataloading",{dataType:"style"})),this._request=o.h.frame(()=>{this._request=null,l.validate=l.validate!==!1,this._load(r,l,f)})}loadEmpty(){this.fire(new o.k("dataloading",{dataType:"style"})),this._load(ta,{validate:!1})}_load(r,l,f){var p;const y=l.transformStyle?l.transformStyle(f,r):r;if(!l.validate||!ea(this,o.y(y))){this._loaded=!0,this.stylesheet=y;for(const T in y.sources)this.addSource(T,y.sources[T],{validate:!1});y.sprite?this._loadSprite(y.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(y.glyphs),this._createLayers(),this.light=new He(this.stylesheet.light),this.map.setTerrain((p=this.stylesheet.terrain)!==null&&p!==void 0?p:null),this.fire(new o.k("data",{dataType:"style"})),this.fire(new o.k("style.load"))}}_createLayers(){const r=o.aB(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",r),this._order=r.map(l=>l.id),this._layers={},this._serializedLayers=null;for(const l of r){const f=o.aC(l);f.setEventedParent(this,{layer:{id:l.id}}),this._layers[l.id]=f}}_loadSprite(r,l=!1,f=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(p,y,T,S){const A=ze(p),F=A.length,L=T>1?"@2x":"",R={},W={},oe={};for(const{id:se,url:de}of A){const ie=y.transformRequest(y.normalizeSpriteURL(de,L,".json"),re.SpriteJSON),Pe=`${se}_${ie.url}`;R[Pe]=o.f(ie,(Re,Ze)=>{delete R[Pe],W[se]=Ze,Ie(S,W,oe,Re,F)});const Ge=y.transformRequest(y.normalizeSpriteURL(de,L,".png"),re.SpriteImage),_e=`${se}_${Ge.url}`;R[_e]=j.getImage(Ge,(Re,Ze)=>{delete R[_e],oe[se]=Ze,Ie(S,W,oe,Re,F)})}return{cancel(){for(const se of Object.values(R))se.cancel()}}}(r,this.map._requestManager,this.map.getPixelRatio(),(p,y)=>{if(this._spriteRequest=null,p)this.fire(new o.j(p));else if(y)for(const T in y){this._spritesImagesIds[T]=[];const S=this._spritesImagesIds[T]?this._spritesImagesIds[T].filter(A=>!(A in y)):[];for(const A of S)this.imageManager.removeImage(A),this._changedImages[A]=!0;for(const A in y[T]){const F=T==="default"?A:`${T}:${A}`;this._spritesImagesIds[T].push(F),F in this.imageManager.images?this.imageManager.updateImage(F,y[T][A],!1):this.imageManager.addImage(F,y[T][A]),l&&(this._changedImages[F]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),l&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.k("data",{dataType:"style"})),f&&f(p)})}_unloadSprite(){for(const r of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(r),this._changedImages[r]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}_validateLayer(r){const l=this.sourceCaches[r.source];if(!l)return;const f=r.sourceLayer;if(!f)return;const p=l.getSource();(p.type==="geojson"||p.vectorLayerIds&&p.vectorLayerIds.indexOf(f)===-1)&&this.fire(new o.j(new Error(`Source layer "${f}" does not exist on source "${p.id}" as specified by style layer "${r.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const r in this.sourceCaches)if(!this.sourceCaches[r].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(r){const l=this._serializedAllLayers();if(!r||r.length===0)return Object.values(l);const f=[];for(const p of r)l[p]&&f.push(l[p]);return f}_serializedAllLayers(){let r=this._serializedLayers;if(r)return r;r=this._serializedLayers={};const l=Object.keys(this._layers);for(const f of l){const p=this._layers[f];p.type!=="custom"&&(r[f]=p.serialize())}return r}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const r in this.sourceCaches)if(this.sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(r){if(!this._loaded)return;const l=this._changed;if(this._changed){const p=Object.keys(this._updatedLayers),y=Object.keys(this._removedLayers);(p.length||y.length)&&this._updateWorkerLayers(p,y);for(const T in this._updatedSources){const S=this._updatedSources[T];if(S==="reload")this._reloadSource(T);else{if(S!=="clear")throw new Error(`Invalid action ${S}`);this._clearSource(T)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const T in this._updatedPaintProps)this._layers[T].updateTransitions(r);this.light.updateTransitions(r),this._resetUpdates()}const f={};for(const p in this.sourceCaches){const y=this.sourceCaches[p];f[p]=y.used,y.used=!1}for(const p of this._order){const y=this._layers[p];y.recalculate(r,this._availableImages),!y.isHidden(r.zoom)&&y.source&&(this.sourceCaches[y.source].used=!0)}for(const p in f){const y=this.sourceCaches[p];f[p]!==y.used&&y.fire(new o.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:p}))}this.light.recalculate(r),this.z=r.zoom,l&&this.fire(new o.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=Object.keys(this._changedImages);if(r.length){for(const l in this.sourceCaches)this.sourceCaches[l].reloadTilesForDependencies(["icons","patterns"],r);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const r in this.sourceCaches)this.sourceCaches[r].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(r,l){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(r),removedIds:l})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(r,l={}){this._checkLoaded();const f=this.serialize();if(r=l.transformStyle?l.transformStyle(f,r):r,ea(this,o.y(r)))return!1;(r=o.aD(r)).layers=o.aB(r.layers);const p=o.aE(f,r).filter(T=>!(T.command in Ns));if(p.length===0)return!1;const y=p.filter(T=>!(T.command in sa));if(y.length>0)throw new Error(`Unimplemented: ${y.map(T=>T.command).join(", ")}.`);for(const T of p)T.command!=="setTransition"&&this[T.command].apply(this,T.args);return this.stylesheet=r,this._serializedLayers=null,!0}addImage(r,l){if(this.getImage(r))return this.fire(new o.j(new Error(`An image named "${r}" already exists.`)));this.imageManager.addImage(r,l),this._afterImageUpdated(r)}updateImage(r,l){this.imageManager.updateImage(r,l)}getImage(r){return this.imageManager.getImage(r)}removeImage(r){if(!this.getImage(r))return this.fire(new o.j(new Error(`An image named "${r}" does not exist.`)));this.imageManager.removeImage(r),this._afterImageUpdated(r)}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(r,l,f={}){if(this._checkLoaded(),this.sourceCaches[r]!==void 0)throw new Error(`Source "${r}" already exists.`);if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(o.y.source,`sources.${r}`,l,null,f))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const p=this.sourceCaches[r]=new Cr(r,l,this.dispatcher);p.style=this,p.setEventedParent(this,()=>({isSourceLoaded:p.loaded(),source:p.serialize(),sourceId:r})),p.onAdd(this.map),this._changed=!0}removeSource(r){if(this._checkLoaded(),this.sourceCaches[r]===void 0)throw new Error("There is no source with this ID");for(const f in this._layers)if(this._layers[f].source===r)return this.fire(new o.j(new Error(`Source "${r}" cannot be removed while layer "${f}" is using it.`)));const l=this.sourceCaches[r];delete this.sourceCaches[r],delete this._updatedSources[r],l.fire(new o.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:r})),l.setEventedParent(null),l.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(r,l){if(this._checkLoaded(),this.sourceCaches[r]===void 0)throw new Error(`There is no source with this ID=${r}`);const f=this.sourceCaches[r].getSource();if(f.type!=="geojson")throw new Error(`geojsonSource.type is ${f.type}, which is !== 'geojson`);f.setData(l),this._changed=!0}getSource(r){return this.sourceCaches[r]&&this.sourceCaches[r].getSource()}addLayer(r,l,f={}){this._checkLoaded();const p=r.id;if(this.getLayer(p))return void this.fire(new o.j(new Error(`Layer "${p}" already exists on this map.`)));let y;if(r.type==="custom"){if(ea(this,o.aF(r)))return;y=o.aC(r)}else{if("source"in r&&typeof r.source=="object"&&(this.addSource(p,r.source),r=o.aD(r),r=o.e(r,{source:p})),this._validate(o.y.layer,`layers.${p}`,r,{arrayIndex:-1},f))return;y=o.aC(r),this._validateLayer(y),y.setEventedParent(this,{layer:{id:p}})}const T=l?this._order.indexOf(l):this._order.length;if(l&&T===-1)this.fire(new o.j(new Error(`Cannot add layer "${p}" before non-existing layer "${l}".`)));else{if(this._order.splice(T,0,p),this._layerOrderChanged=!0,this._layers[p]=y,this._removedLayers[p]&&y.source&&y.type!=="custom"){const S=this._removedLayers[p];delete this._removedLayers[p],S.type!==y.type?this._updatedSources[y.source]="clear":(this._updatedSources[y.source]="reload",this.sourceCaches[y.source].pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map)}}moveLayer(r,l){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new o.j(new Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===l)return;const f=this._order.indexOf(r);this._order.splice(f,1);const p=l?this._order.indexOf(l):this._order.length;l&&p===-1?this.fire(new o.j(new Error(`Cannot move layer "${r}" before non-existing layer "${l}".`))):(this._order.splice(p,0,r),this._layerOrderChanged=!0)}removeLayer(r){this._checkLoaded();const l=this._layers[r];if(!l)return void this.fire(new o.j(new Error(`Cannot remove non-existing layer "${r}".`)));l.setEventedParent(null);const f=this._order.indexOf(r);this._order.splice(f,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=l,delete this._layers[r],this._serializedLayers&&delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],l.onRemove&&l.onRemove(this.map)}getLayer(r){return this._layers[r]}getLayersOrder(){return[...this._order]}hasLayer(r){return r in this._layers}setLayerZoomRange(r,l,f){this._checkLoaded();const p=this.getLayer(r);p?p.minzoom===l&&p.maxzoom===f||(l!=null&&(p.minzoom=l),f!=null&&(p.maxzoom=f),this._updateLayer(p)):this.fire(new o.j(new Error(`Cannot set the zoom range of non-existing layer "${r}".`)))}setFilter(r,l,f={}){this._checkLoaded();const p=this.getLayer(r);if(p){if(!o.aG(p.filter,l))return l==null?(p.filter=void 0,void this._updateLayer(p)):void(this._validate(o.y.filter,`layers.${p.id}.filter`,l,null,f)||(p.filter=o.aD(l),this._updateLayer(p)))}else this.fire(new o.j(new Error(`Cannot filter non-existing layer "${r}".`)))}getFilter(r){return o.aD(this.getLayer(r).filter)}setLayoutProperty(r,l,f,p={}){this._checkLoaded();const y=this.getLayer(r);y?o.aG(y.getLayoutProperty(l),f)||(y.setLayoutProperty(l,f,p),this._updateLayer(y)):this.fire(new o.j(new Error(`Cannot style non-existing layer "${r}".`)))}getLayoutProperty(r,l){const f=this.getLayer(r);if(f)return f.getLayoutProperty(l);this.fire(new o.j(new Error(`Cannot get style of non-existing layer "${r}".`)))}setPaintProperty(r,l,f,p={}){this._checkLoaded();const y=this.getLayer(r);y?o.aG(y.getPaintProperty(l),f)||(y.setPaintProperty(l,f,p)&&this._updateLayer(y),this._changed=!0,this._updatedPaintProps[r]=!0):this.fire(new o.j(new Error(`Cannot style non-existing layer "${r}".`)))}getPaintProperty(r,l){return this.getLayer(r).getPaintProperty(l)}setFeatureState(r,l){this._checkLoaded();const f=r.source,p=r.sourceLayer,y=this.sourceCaches[f];if(y===void 0)return void this.fire(new o.j(new Error(`The source '${f}' does not exist in the map's style.`)));const T=y.getSource().type;T==="geojson"&&p?this.fire(new o.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):T!=="vector"||p?(r.id===void 0&&this.fire(new o.j(new Error("The feature id parameter must be provided."))),y.setFeatureState(p,r.id,l)):this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(r,l){this._checkLoaded();const f=r.source,p=this.sourceCaches[f];if(p===void 0)return void this.fire(new o.j(new Error(`The source '${f}' does not exist in the map's style.`)));const y=p.getSource().type,T=y==="vector"?r.sourceLayer:void 0;y!=="vector"||T?l&&typeof r.id!="string"&&typeof r.id!="number"?this.fire(new o.j(new Error("A feature id is required to remove its specific state property."))):p.removeFeatureState(T,r.id,l):this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(r){this._checkLoaded();const l=r.source,f=r.sourceLayer,p=this.sourceCaches[l];if(p!==void 0)return p.getSource().type!=="vector"||f?(r.id===void 0&&this.fire(new o.j(new Error("The feature id parameter must be provided."))),p.getFeatureState(f,r.id)):void this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.j(new Error(`The source '${l}' does not exist in the map's style.`)))}getTransition(){return o.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const r=o.aH(this.sourceCaches,y=>y.serialize()),l=this._serializeByIds(this._order),f=this.map.getTerrain()||void 0,p=this.stylesheet;return o.aI({version:p.version,name:p.name,metadata:p.metadata,light:p.light,center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch,sprite:p.sprite,glyphs:p.glyphs,transition:p.transition,sources:r,layers:l,terrain:f},y=>y!==void 0)}_updateLayer(r){this._updatedLayers[r.id]=!0,r.source&&!this._updatedSources[r.source]&&this.sourceCaches[r.source].getSource().type!=="raster"&&(this._updatedSources[r.source]="reload",this.sourceCaches[r.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(r){const l=T=>this._layers[T].type==="fill-extrusion",f={},p=[];for(let T=this._order.length-1;T>=0;T--){const S=this._order[T];if(l(S)){f[S]=T;for(const A of r){const F=A[S];if(F)for(const L of F)p.push(L)}}}p.sort((T,S)=>S.intersectionZ-T.intersectionZ);const y=[];for(let T=this._order.length-1;T>=0;T--){const S=this._order[T];if(l(S))for(let A=p.length-1;A>=0;A--){const F=p[A].feature;if(f[F.layer.id]<T)break;y.push(F),p.pop()}else for(const A of r){const F=A[S];if(F)for(const L of F)y.push(L.feature)}}return y}queryRenderedFeatures(r,l,f){l&&l.filter&&this._validate(o.y.filter,"queryRenderedFeatures.filter",l.filter,null,l);const p={};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new o.j(new Error("parameters.layers must be an Array."))),[];for(const S of l.layers){const A=this._layers[S];if(!A)return this.fire(new o.j(new Error(`The layer '${S}' does not exist in the map's style and cannot be queried for features.`))),[];p[A.source]=!0}}const y=[];l.availableImages=this._availableImages;const T=this._serializedAllLayers();for(const S in this.sourceCaches)l.layers&&!p[S]||y.push(Jt(this.sourceCaches[S],this._layers,T,r,l,f));return this.placement&&y.push(function(S,A,F,L,R,W,oe){const se={},de=W.queryRenderedSymbols(L),ie=[];for(const Pe of Object.keys(de).map(Number))ie.push(oe[Pe]);ie.sort(wt);for(const Pe of ie){const Ge=Pe.featureIndex.lookupSymbolFeatures(de[Pe.bucketInstanceId],A,Pe.bucketIndex,Pe.sourceLayerIndex,R.filter,R.layers,R.availableImages,S);for(const _e in Ge){const Re=se[_e]=se[_e]||[],Ze=Ge[_e];Ze.sort((Xe,rt)=>{const mt=Pe.featureSortOrder;if(mt){const lt=mt.indexOf(Xe.featureIndex);return mt.indexOf(rt.featureIndex)-lt}return rt.featureIndex-Xe.featureIndex});for(const Xe of Ze)Re.push(Xe)}}for(const Pe in se)se[Pe].forEach(Ge=>{const _e=Ge.feature,Re=F[S[Pe].source].getFeatureState(_e.layer["source-layer"],_e.id);_e.source=_e.layer.source,_e.layer["source-layer"]&&(_e.sourceLayer=_e.layer["source-layer"]),_e.state=Re});return se}(this._layers,T,this.sourceCaches,r,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(y)}querySourceFeatures(r,l){l&&l.filter&&this._validate(o.y.filter,"querySourceFeatures.filter",l.filter,null,l);const f=this.sourceCaches[r];return f?function(p,y){const T=p.getRenderableIds().map(F=>p.getTileByID(F)),S=[],A={};for(let F=0;F<T.length;F++){const L=T[F],R=L.tileID.canonical.key;A[R]||(A[R]=!0,L.querySourceFeatures(S,y))}return S}(f,l):[]}addSourceType(r,l,f){return Xt(r)?f(new Error(`A source type called "${r}" already exists.`)):(((p,y)=>{Qt[p]=y})(r,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:l.workerSourceURL},f):f(null,null))}getLight(){return this.light.getLight()}setLight(r,l={}){this._checkLoaded();const f=this.light.getLight();let p=!1;for(const T in r)if(!o.aG(r[T],f[T])){p=!0;break}if(!p)return;const y={now:o.h.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(r,l),this.light.updateTransitions(y)}_validate(r,l,f,p,y={}){return(!y||y.validate!==!1)&&ea(this,r.call(o.y,o.e({key:l,style:this.serialize(),value:f,styleSpec:o.v},p)))}_remove(r=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.aJ.off("pluginStateChange",this._rtlTextPluginCallback);for(const l in this._layers)this._layers[l].setEventedParent(null);for(const l in this.sourceCaches){const f=this.sourceCaches[l];f.setEventedParent(null),f.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(r)}_clearSource(r){this.sourceCaches[r].clearTiles()}_reloadSource(r){this.sourceCaches[r].resume(),this.sourceCaches[r].reload()}_updateSources(r){for(const l in this.sourceCaches)this.sourceCaches[l].update(r,this.map.terrain)}_generateCollisionBoxes(){for(const r in this.sourceCaches)this._reloadSource(r)}_updatePlacement(r,l,f,p,y=!1){let T=!1,S=!1;const A={};for(const F of this._order){const L=this._layers[F];if(L.type!=="symbol")continue;if(!A[L.source]){const W=this.sourceCaches[L.source];A[L.source]=W.getRenderableIds(!0).map(oe=>W.getTileByID(oe)).sort((oe,se)=>se.tileID.overscaledZ-oe.tileID.overscaledZ||(oe.tileID.isLessThan(se.tileID)?-1:1))}const R=this.crossTileSymbolIndex.addLayer(L,A[L.source],r.center.lng);T=T||R}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((y=y||this._layerOrderChanged||f===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.h.now(),r.zoom))&&(this.pauseablePlacement=new Kt(r,this.map.terrain,this._order,y,l,f,p,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,A),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.h.now()),S=!0),T&&this.pauseablePlacement.placement.setStale()),S||T)for(const F of this._order){const L=this._layers[F];L.type==="symbol"&&this.placement.updateLayerOpacities(L,A[L.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.h.now())}_releaseSymbolFadeTiles(){for(const r in this.sourceCaches)this.sourceCaches[r].releaseSymbolFadeTiles()}getImages(r,l,f){this.imageManager.getImages(l.icons,f),this._updateTilesForChangedImages();const p=this.sourceCaches[l.source];p&&p.setDependencies(l.tileID.key,l.type,l.icons)}getGlyphs(r,l,f){this.glyphManager.getGlyphs(l.stacks,f);const p=this.sourceCaches[l.source];p&&p.setDependencies(l.tileID.key,l.type,[""])}getResource(r,l,f){return o.m(l,f)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(r,l={}){this._checkLoaded(),r&&this._validate(o.y.glyphs,"glyphs",r,null,l)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=r,this.glyphManager.entries={},this.glyphManager.setURL(r))}addSprite(r,l,f={},p){this._checkLoaded();const y=[{id:r,url:l}],T=[...ze(this.stylesheet.sprite),...y];this._validate(o.y.sprite,"sprite",T,null,f)||(this.stylesheet.sprite=T,this._loadSprite(y,!0,p))}removeSprite(r){this._checkLoaded();const l=ze(this.stylesheet.sprite);if(l.find(f=>f.id===r)){if(this._spritesImagesIds[r])for(const f of this._spritesImagesIds[r])this.imageManager.removeImage(f),this._changedImages[f]=!0;l.splice(l.findIndex(f=>f.id===r),1),this.stylesheet.sprite=l.length>0?l:void 0,delete this._spritesImagesIds[r],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}else this.fire(new o.j(new Error(`Sprite "${r}" doesn't exists on this map.`)))}getSprite(){return ze(this.stylesheet.sprite)}setSprite(r,l={},f){this._checkLoaded(),r&&this._validate(o.y.sprite,"sprite",r,null,l)||(this.stylesheet.sprite=r,r?this._loadSprite(r,!0,f):(this._unloadSprite(),f&&f(null)))}}Ia.registerForPluginStateChange=o.aK;var ko=o.Q([{name:"a_pos",type:"Int16",components:2}]),us="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const Hr={prelude:Tr(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Tr(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Tr(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Tr(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Tr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Tr(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Tr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Tr("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Tr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Tr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Tr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Tr(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Tr(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Tr(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Tr(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Tr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Tr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Tr(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Tr(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Tr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Tr(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Tr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Tr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Tr(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Tr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Tr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Tr("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",us),terrainDepth:Tr("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",us),terrainCoords:Tr("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",us)};function Tr(g,r){const l=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,f=r.match(/attribute ([\w]+) ([\w]+)/g),p=g.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=r.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=y?y.concat(p):p,S={};return{fragmentSource:g=g.replace(l,(A,F,L,R,W)=>(S[W]=!0,F==="define"?`
#ifndef HAS_UNIFORM_u_${W}
varying ${L} ${R} ${W};
#else
uniform ${L} ${R} u_${W};
#endif
`:`
#ifdef HAS_UNIFORM_u_${W}
    ${L} ${R} ${W} = u_${W};
#endif
`)),vertexSource:r=r.replace(l,(A,F,L,R,W)=>{const oe=R==="float"?"vec2":"vec4",se=W.match(/color/)?"color":oe;return S[W]?F==="define"?`
#ifndef HAS_UNIFORM_u_${W}
uniform lowp float u_${W}_t;
attribute ${L} ${oe} a_${W};
varying ${L} ${R} ${W};
#else
uniform ${L} ${R} u_${W};
#endif
`:se==="vec4"?`
#ifndef HAS_UNIFORM_u_${W}
    ${W} = a_${W};
#else
    ${L} ${R} ${W} = u_${W};
#endif
`:`
#ifndef HAS_UNIFORM_u_${W}
    ${W} = unpack_mix_${se}(a_${W}, u_${W}_t);
#else
    ${L} ${R} ${W} = u_${W};
#endif
`:F==="define"?`
#ifndef HAS_UNIFORM_u_${W}
uniform lowp float u_${W}_t;
attribute ${L} ${oe} a_${W};
#else
uniform ${L} ${R} u_${W};
#endif
`:se==="vec4"?`
#ifndef HAS_UNIFORM_u_${W}
    ${L} ${R} ${W} = a_${W};
#else
    ${L} ${R} ${W} = u_${W};
#endif
`:`
#ifndef HAS_UNIFORM_u_${W}
    ${L} ${R} ${W} = unpack_mix_${se}(a_${W}, u_${W}_t);
#else
    ${L} ${R} ${W} = u_${W};
#endif
`}),staticAttributes:f,staticUniforms:T}}class Vn{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(r,l,f,p,y,T,S,A,F){this.context=r;let L=this.boundPaintVertexBuffers.length!==p.length;for(let R=0;!L&&R<p.length;R++)this.boundPaintVertexBuffers[R]!==p[R]&&(L=!0);!this.vao||this.boundProgram!==l||this.boundLayoutVertexBuffer!==f||L||this.boundIndexBuffer!==y||this.boundVertexOffset!==T||this.boundDynamicVertexBuffer!==S||this.boundDynamicVertexBuffer2!==A||this.boundDynamicVertexBuffer3!==F?this.freshBind(l,f,p,y,T,S,A,F):(r.bindVertexArray.set(this.vao),S&&S.bind(),y&&y.dynamicDraw&&y.bind(),A&&A.bind(),F&&F.bind())}freshBind(r,l,f,p,y,T,S,A){const F=r.numAttributes,L=this.context,R=L.gl;this.vao&&this.destroy(),this.vao=L.createVertexArray(),L.bindVertexArray.set(this.vao),this.boundProgram=r,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=p,this.boundVertexOffset=y,this.boundDynamicVertexBuffer=T,this.boundDynamicVertexBuffer2=S,this.boundDynamicVertexBuffer3=A,l.enableAttributes(R,r);for(const W of f)W.enableAttributes(R,r);T&&T.enableAttributes(R,r),S&&S.enableAttributes(R,r),A&&A.enableAttributes(R,r),l.bind(),l.setVertexAttribPointers(R,r,y);for(const W of f)W.bind(),W.setVertexAttribPointers(R,r,y);T&&(T.bind(),T.setVertexAttribPointers(R,r,y)),p&&p.bind(),S&&(S.bind(),S.setVertexAttribPointers(R,r,y)),A&&(A.bind(),A.setVertexAttribPointers(R,r,y)),L.currentNumAttributes=F}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Yr(g){const r=[];for(let l=0;l<g.length;l++){if(g[l]===null)continue;const f=g[l].split(" ");r.push(f.pop())}return r}class Co{constructor(r,l,f,p,y,T){const S=r.gl;this.program=S.createProgram();const A=Yr(l.staticAttributes),F=f?f.getBinderAttributes():[],L=A.concat(F),R=Hr.prelude.staticUniforms?Yr(Hr.prelude.staticUniforms):[],W=l.staticUniforms?Yr(l.staticUniforms):[],oe=f?f.getBinderUniforms():[],se=R.concat(W).concat(oe),de=[];for(const Xe of se)de.indexOf(Xe)<0&&de.push(Xe);const ie=f?f.defines():[];y&&ie.push("#define OVERDRAW_INSPECTOR;"),T&&ie.push("#define TERRAIN3D;");const Pe=ie.concat(Hr.prelude.fragmentSource,l.fragmentSource).join(`
`),Ge=ie.concat(Hr.prelude.vertexSource,l.vertexSource).join(`
`),_e=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);if(S.shaderSource(_e,Pe),S.compileShader(_e),!S.getShaderParameter(_e,S.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${S.getShaderInfoLog(_e)}`);S.attachShader(this.program,_e);const Re=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);if(S.shaderSource(Re,Ge),S.compileShader(Re),!S.getShaderParameter(Re,S.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${S.getShaderInfoLog(Re)}`);S.attachShader(this.program,Re),this.attributes={};const Ze={};this.numAttributes=L.length;for(let Xe=0;Xe<this.numAttributes;Xe++)L[Xe]&&(S.bindAttribLocation(this.program,Xe,L[Xe]),this.attributes[L[Xe]]=Xe);if(S.linkProgram(this.program),!S.getProgramParameter(this.program,S.LINK_STATUS))throw new Error(`Program failed to link: ${S.getProgramInfoLog(this.program)}`);S.deleteShader(Re),S.deleteShader(_e);for(let Xe=0;Xe<de.length;Xe++){const rt=de[Xe];if(rt&&!Ze[rt]){const mt=S.getUniformLocation(this.program,rt);mt&&(Ze[rt]=mt)}}this.fixedUniforms=p(r,Ze),this.terrainUniforms=((Xe,rt)=>({u_depth:new o.aL(Xe,rt.u_depth),u_terrain:new o.aL(Xe,rt.u_terrain),u_terrain_dim:new o.aM(Xe,rt.u_terrain_dim),u_terrain_matrix:new o.aN(Xe,rt.u_terrain_matrix),u_terrain_unpack:new o.aO(Xe,rt.u_terrain_unpack),u_terrain_exaggeration:new o.aM(Xe,rt.u_terrain_exaggeration)}))(r,Ze),this.binderUniforms=f?f.getUniforms(r,Ze):[]}draw(r,l,f,p,y,T,S,A,F,L,R,W,oe,se,de,ie,Pe,Ge){const _e=r.gl;if(this.failedToCreate)return;if(r.program.set(this.program),r.setDepthMode(f),r.setStencilMode(p),r.setColorMode(y),r.setCullFace(T),A){r.activeTexture.set(_e.TEXTURE2),_e.bindTexture(_e.TEXTURE_2D,A.depthTexture),r.activeTexture.set(_e.TEXTURE3),_e.bindTexture(_e.TEXTURE_2D,A.texture);for(const Ze in this.terrainUniforms)this.terrainUniforms[Ze].set(A[Ze])}for(const Ze in this.fixedUniforms)this.fixedUniforms[Ze].set(S[Ze]);de&&de.setUniforms(r,this.binderUniforms,oe,{zoom:se});let Re=0;switch(l){case _e.LINES:Re=2;break;case _e.TRIANGLES:Re=3;break;case _e.LINE_STRIP:Re=1}for(const Ze of W.get()){const Xe=Ze.vaos||(Ze.vaos={});(Xe[F]||(Xe[F]=new Vn)).bind(r,this,L,de?de.getPaintVertexBuffers():[],R,Ze.vertexOffset,ie,Pe,Ge),_e.drawElements(l,Ze.primitiveLength*Re,_e.UNSIGNED_SHORT,Ze.primitiveOffset*Re*2)}}}function Mi(g,r,l){const f=1/Ce(l,1,r.transform.tileZoom),p=Math.pow(2,l.tileID.overscaledZ),y=l.tileSize*Math.pow(2,r.transform.tileZoom)/p,T=y*(l.tileID.canonical.x+l.tileID.wrap*p),S=y*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture.size,u_scale:[f,g.fromScale,g.toScale],u_fade:g.t,u_pixel_coord_upper:[T>>16,S>>16],u_pixel_coord_lower:[65535&T,65535&S]}}const Sl=(g,r,l,f)=>{const p=r.style.light,y=p.properties.get("position"),T=[y.x,y.y,y.z],S=function(){var F=new o.A(9);return o.A!=Float32Array&&(F[1]=0,F[2]=0,F[3]=0,F[5]=0,F[6]=0,F[7]=0),F[0]=1,F[4]=1,F[8]=1,F}();p.properties.get("anchor")==="viewport"&&function(F,L){var R=Math.sin(L),W=Math.cos(L);F[0]=W,F[1]=R,F[2]=0,F[3]=-R,F[4]=W,F[5]=0,F[6]=0,F[7]=0,F[8]=1}(S,-r.transform.angle),function(F,L,R){var W=L[0],oe=L[1],se=L[2];F[0]=W*R[0]+oe*R[3]+se*R[6],F[1]=W*R[1]+oe*R[4]+se*R[7],F[2]=W*R[2]+oe*R[5]+se*R[8]}(T,T,S);const A=p.properties.get("color");return{u_matrix:g,u_lightpos:T,u_lightintensity:p.properties.get("intensity"),u_lightcolor:[A.r,A.g,A.b],u_vertical_gradient:+l,u_opacity:f}},Cn=(g,r,l,f,p,y,T)=>o.e(Sl(g,r,l,f),Mi(y,r,T),{u_height_factor:-Math.pow(2,p.overscaledZ)/T.tileSize/8}),cu=g=>({u_matrix:g}),kl=(g,r,l,f)=>o.e(cu(g),Mi(l,r,f)),Ao=(g,r)=>({u_matrix:g,u_world:r}),Io=(g,r,l,f,p)=>o.e(kl(g,r,l,f),{u_world:p}),An=(g,r,l,f)=>{const p=g.transform;let y,T;if(f.paint.get("circle-pitch-alignment")==="map"){const S=Ce(l,1,p.zoom);y=!0,T=[S,S]}else y=!1,T=p.pixelsToGLUnits;return{u_camera_to_center_distance:p.cameraToCenterDistance,u_scale_with_map:+(f.paint.get("circle-pitch-scale")==="map"),u_matrix:g.translatePosMatrix(r.posMatrix,l,f.paint.get("circle-translate"),f.paint.get("circle-translate-anchor")),u_pitch_with_map:+y,u_device_pixel_ratio:g.pixelRatio,u_extrude_scale:T}},Cl=(g,r,l)=>{const f=Ce(l,1,r.zoom),p=Math.pow(2,r.zoom-l.tileID.overscaledZ),y=l.tileID.overscaleFactor();return{u_matrix:g,u_camera_to_center_distance:r.cameraToCenterDistance,u_pixels_to_tile_units:f,u_extrude_scale:[r.pixelsToGLUnits[0]/(f*p),r.pixelsToGLUnits[1]/(f*p)],u_overscale_factor:y}},Us=(g,r,l=1)=>({u_matrix:g,u_color:r,u_overlay:0,u_overlay_scale:l}),uu=g=>({u_matrix:g}),Yh=(g,r,l,f)=>({u_matrix:g,u_extrude_scale:Ce(r,1,l),u_intensity:f});function Al(g,r){const l=Math.pow(2,r.canonical.z),f=r.canonical.y;return[new o.U(0,f/l).toLngLat().lat,new o.U(0,(f+1)/l).toLngLat().lat]}const Il=(g,r,l,f)=>{const p=g.transform;return{u_matrix:Fo(g,r,l,f),u_ratio:1/Ce(r,1,p.zoom),u_device_pixel_ratio:g.pixelRatio,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},hu=(g,r,l,f,p)=>o.e(Il(g,r,l,p),{u_image:0,u_image_height:f}),Jh=(g,r,l,f,p)=>{const y=g.transform,T=du(r,y);return{u_matrix:Fo(g,r,l,p),u_texsize:r.imageAtlasTexture.size,u_ratio:1/Ce(r,1,y.zoom),u_device_pixel_ratio:g.pixelRatio,u_image:0,u_scale:[T,f.fromScale,f.toScale],u_fade:f.t,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},fu=(g,r,l,f,p,y)=>{const T=g.lineAtlas,S=du(r,g.transform),A=l.layout.get("line-cap")==="round",F=T.getDash(f.from,A),L=T.getDash(f.to,A),R=F.width*p.fromScale,W=L.width*p.toScale;return o.e(Il(g,r,l,y),{u_patternscale_a:[S/R,-F.height/2],u_patternscale_b:[S/W,-L.height/2],u_sdfgamma:T.width/(256*Math.min(R,W)*g.pixelRatio)/2,u_image:0,u_tex_y_a:F.y,u_tex_y_b:L.y,u_mix:p.t})};function du(g,r){return 1/Ce(g,1,r.tileZoom)}function Fo(g,r,l,f){return g.translatePosMatrix(f?f.posMatrix:r.tileID.posMatrix,r,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}const pu=(g,r,l,f,p)=>{return{u_matrix:g,u_tl_parent:r,u_scale_parent:l,u_buffer_scale:1,u_fade_t:f.mix,u_opacity:f.opacity*p.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:p.paint.get("raster-brightness-min"),u_brightness_high:p.paint.get("raster-brightness-max"),u_saturation_factor:(T=p.paint.get("raster-saturation"),T>0?1-1/(1.001-T):-T),u_contrast_factor:(y=p.paint.get("raster-contrast"),y>0?1/(1-y):1+y),u_spin_weights:mu(p.paint.get("raster-hue-rotate"))};var y,T};function mu(g){g*=Math.PI/180;const r=Math.sin(g),l=Math.cos(g);return[(2*l+1)/3,(-Math.sqrt(3)*r-l+1)/3,(Math.sqrt(3)*r-l+1)/3]}const Fl=(g,r,l,f,p,y,T,S,A,F)=>{const L=p.transform;return{u_is_size_zoom_constant:+(g==="constant"||g==="source"),u_is_size_feature_constant:+(g==="constant"||g==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:L.cameraToCenterDistance,u_pitch:L.pitch/360*2*Math.PI,u_rotate_symbol:+l,u_aspect_ratio:L.width/L.height,u_fade_change:p.options.fadeDuration?p.symbolFadeChange:1,u_matrix:y,u_label_plane_matrix:T,u_coord_matrix:S,u_is_text:+A,u_pitch_with_map:+f,u_texsize:F,u_texture:0}},Pl=(g,r,l,f,p,y,T,S,A,F,L)=>{const R=p.transform;return o.e(Fl(g,r,l,f,p,y,T,S,A,F),{u_gamma_scale:f?Math.cos(R._pitch)*R.cameraToCenterDistance:1,u_device_pixel_ratio:p.pixelRatio,u_is_halo:+L})},$n=(g,r,l,f,p,y,T,S,A,F)=>o.e(Pl(g,r,l,f,p,y,T,S,!0,A,!0),{u_texsize_icon:F,u_texture_icon:1}),Po=(g,r,l)=>({u_matrix:g,u_opacity:r,u_color:l}),Di=(g,r,l,f,p,y)=>o.e(function(T,S,A,F){const L=A.imageManager.getPattern(T.from.toString()),R=A.imageManager.getPattern(T.to.toString()),{width:W,height:oe}=A.imageManager.getPixelSize(),se=Math.pow(2,F.tileID.overscaledZ),de=F.tileSize*Math.pow(2,A.transform.tileZoom)/se,ie=de*(F.tileID.canonical.x+F.tileID.wrap*se),Pe=de*F.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:L.tl,u_pattern_br_a:L.br,u_pattern_tl_b:R.tl,u_pattern_br_b:R.br,u_texsize:[W,oe],u_mix:S.t,u_pattern_size_a:L.displaySize,u_pattern_size_b:R.displaySize,u_scale_a:S.fromScale,u_scale_b:S.toScale,u_tile_units_to_pixels:1/Ce(F,1,A.transform.tileZoom),u_pixel_coord_upper:[ie>>16,Pe>>16],u_pixel_coord_lower:[65535&ie,65535&Pe]}}(f,y,l,p),{u_matrix:g,u_opacity:r}),Mo={fillExtrusion:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_lightpos:new o.aP(g,r.u_lightpos),u_lightintensity:new o.aM(g,r.u_lightintensity),u_lightcolor:new o.aP(g,r.u_lightcolor),u_vertical_gradient:new o.aM(g,r.u_vertical_gradient),u_opacity:new o.aM(g,r.u_opacity)}),fillExtrusionPattern:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_lightpos:new o.aP(g,r.u_lightpos),u_lightintensity:new o.aM(g,r.u_lightintensity),u_lightcolor:new o.aP(g,r.u_lightcolor),u_vertical_gradient:new o.aM(g,r.u_vertical_gradient),u_height_factor:new o.aM(g,r.u_height_factor),u_image:new o.aL(g,r.u_image),u_texsize:new o.aQ(g,r.u_texsize),u_pixel_coord_upper:new o.aQ(g,r.u_pixel_coord_upper),u_pixel_coord_lower:new o.aQ(g,r.u_pixel_coord_lower),u_scale:new o.aP(g,r.u_scale),u_fade:new o.aM(g,r.u_fade),u_opacity:new o.aM(g,r.u_opacity)}),fill:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix)}),fillPattern:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_image:new o.aL(g,r.u_image),u_texsize:new o.aQ(g,r.u_texsize),u_pixel_coord_upper:new o.aQ(g,r.u_pixel_coord_upper),u_pixel_coord_lower:new o.aQ(g,r.u_pixel_coord_lower),u_scale:new o.aP(g,r.u_scale),u_fade:new o.aM(g,r.u_fade)}),fillOutline:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_world:new o.aQ(g,r.u_world)}),fillOutlinePattern:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_world:new o.aQ(g,r.u_world),u_image:new o.aL(g,r.u_image),u_texsize:new o.aQ(g,r.u_texsize),u_pixel_coord_upper:new o.aQ(g,r.u_pixel_coord_upper),u_pixel_coord_lower:new o.aQ(g,r.u_pixel_coord_lower),u_scale:new o.aP(g,r.u_scale),u_fade:new o.aM(g,r.u_fade)}),circle:(g,r)=>({u_camera_to_center_distance:new o.aM(g,r.u_camera_to_center_distance),u_scale_with_map:new o.aL(g,r.u_scale_with_map),u_pitch_with_map:new o.aL(g,r.u_pitch_with_map),u_extrude_scale:new o.aQ(g,r.u_extrude_scale),u_device_pixel_ratio:new o.aM(g,r.u_device_pixel_ratio),u_matrix:new o.aN(g,r.u_matrix)}),collisionBox:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_camera_to_center_distance:new o.aM(g,r.u_camera_to_center_distance),u_pixels_to_tile_units:new o.aM(g,r.u_pixels_to_tile_units),u_extrude_scale:new o.aQ(g,r.u_extrude_scale),u_overscale_factor:new o.aM(g,r.u_overscale_factor)}),collisionCircle:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_inv_matrix:new o.aN(g,r.u_inv_matrix),u_camera_to_center_distance:new o.aM(g,r.u_camera_to_center_distance),u_viewport_size:new o.aQ(g,r.u_viewport_size)}),debug:(g,r)=>({u_color:new o.aR(g,r.u_color),u_matrix:new o.aN(g,r.u_matrix),u_overlay:new o.aL(g,r.u_overlay),u_overlay_scale:new o.aM(g,r.u_overlay_scale)}),clippingMask:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix)}),heatmap:(g,r)=>({u_extrude_scale:new o.aM(g,r.u_extrude_scale),u_intensity:new o.aM(g,r.u_intensity),u_matrix:new o.aN(g,r.u_matrix)}),heatmapTexture:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_world:new o.aQ(g,r.u_world),u_image:new o.aL(g,r.u_image),u_color_ramp:new o.aL(g,r.u_color_ramp),u_opacity:new o.aM(g,r.u_opacity)}),hillshade:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_image:new o.aL(g,r.u_image),u_latrange:new o.aQ(g,r.u_latrange),u_light:new o.aQ(g,r.u_light),u_shadow:new o.aR(g,r.u_shadow),u_highlight:new o.aR(g,r.u_highlight),u_accent:new o.aR(g,r.u_accent)}),hillshadePrepare:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_image:new o.aL(g,r.u_image),u_dimension:new o.aQ(g,r.u_dimension),u_zoom:new o.aM(g,r.u_zoom),u_unpack:new o.aO(g,r.u_unpack)}),line:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_ratio:new o.aM(g,r.u_ratio),u_device_pixel_ratio:new o.aM(g,r.u_device_pixel_ratio),u_units_to_pixels:new o.aQ(g,r.u_units_to_pixels)}),lineGradient:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_ratio:new o.aM(g,r.u_ratio),u_device_pixel_ratio:new o.aM(g,r.u_device_pixel_ratio),u_units_to_pixels:new o.aQ(g,r.u_units_to_pixels),u_image:new o.aL(g,r.u_image),u_image_height:new o.aM(g,r.u_image_height)}),linePattern:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_texsize:new o.aQ(g,r.u_texsize),u_ratio:new o.aM(g,r.u_ratio),u_device_pixel_ratio:new o.aM(g,r.u_device_pixel_ratio),u_image:new o.aL(g,r.u_image),u_units_to_pixels:new o.aQ(g,r.u_units_to_pixels),u_scale:new o.aP(g,r.u_scale),u_fade:new o.aM(g,r.u_fade)}),lineSDF:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_ratio:new o.aM(g,r.u_ratio),u_device_pixel_ratio:new o.aM(g,r.u_device_pixel_ratio),u_units_to_pixels:new o.aQ(g,r.u_units_to_pixels),u_patternscale_a:new o.aQ(g,r.u_patternscale_a),u_patternscale_b:new o.aQ(g,r.u_patternscale_b),u_sdfgamma:new o.aM(g,r.u_sdfgamma),u_image:new o.aL(g,r.u_image),u_tex_y_a:new o.aM(g,r.u_tex_y_a),u_tex_y_b:new o.aM(g,r.u_tex_y_b),u_mix:new o.aM(g,r.u_mix)}),raster:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_tl_parent:new o.aQ(g,r.u_tl_parent),u_scale_parent:new o.aM(g,r.u_scale_parent),u_buffer_scale:new o.aM(g,r.u_buffer_scale),u_fade_t:new o.aM(g,r.u_fade_t),u_opacity:new o.aM(g,r.u_opacity),u_image0:new o.aL(g,r.u_image0),u_image1:new o.aL(g,r.u_image1),u_brightness_low:new o.aM(g,r.u_brightness_low),u_brightness_high:new o.aM(g,r.u_brightness_high),u_saturation_factor:new o.aM(g,r.u_saturation_factor),u_contrast_factor:new o.aM(g,r.u_contrast_factor),u_spin_weights:new o.aP(g,r.u_spin_weights)}),symbolIcon:(g,r)=>({u_is_size_zoom_constant:new o.aL(g,r.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aL(g,r.u_is_size_feature_constant),u_size_t:new o.aM(g,r.u_size_t),u_size:new o.aM(g,r.u_size),u_camera_to_center_distance:new o.aM(g,r.u_camera_to_center_distance),u_pitch:new o.aM(g,r.u_pitch),u_rotate_symbol:new o.aL(g,r.u_rotate_symbol),u_aspect_ratio:new o.aM(g,r.u_aspect_ratio),u_fade_change:new o.aM(g,r.u_fade_change),u_matrix:new o.aN(g,r.u_matrix),u_label_plane_matrix:new o.aN(g,r.u_label_plane_matrix),u_coord_matrix:new o.aN(g,r.u_coord_matrix),u_is_text:new o.aL(g,r.u_is_text),u_pitch_with_map:new o.aL(g,r.u_pitch_with_map),u_texsize:new o.aQ(g,r.u_texsize),u_texture:new o.aL(g,r.u_texture)}),symbolSDF:(g,r)=>({u_is_size_zoom_constant:new o.aL(g,r.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aL(g,r.u_is_size_feature_constant),u_size_t:new o.aM(g,r.u_size_t),u_size:new o.aM(g,r.u_size),u_camera_to_center_distance:new o.aM(g,r.u_camera_to_center_distance),u_pitch:new o.aM(g,r.u_pitch),u_rotate_symbol:new o.aL(g,r.u_rotate_symbol),u_aspect_ratio:new o.aM(g,r.u_aspect_ratio),u_fade_change:new o.aM(g,r.u_fade_change),u_matrix:new o.aN(g,r.u_matrix),u_label_plane_matrix:new o.aN(g,r.u_label_plane_matrix),u_coord_matrix:new o.aN(g,r.u_coord_matrix),u_is_text:new o.aL(g,r.u_is_text),u_pitch_with_map:new o.aL(g,r.u_pitch_with_map),u_texsize:new o.aQ(g,r.u_texsize),u_texture:new o.aL(g,r.u_texture),u_gamma_scale:new o.aM(g,r.u_gamma_scale),u_device_pixel_ratio:new o.aM(g,r.u_device_pixel_ratio),u_is_halo:new o.aL(g,r.u_is_halo)}),symbolTextAndIcon:(g,r)=>({u_is_size_zoom_constant:new o.aL(g,r.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aL(g,r.u_is_size_feature_constant),u_size_t:new o.aM(g,r.u_size_t),u_size:new o.aM(g,r.u_size),u_camera_to_center_distance:new o.aM(g,r.u_camera_to_center_distance),u_pitch:new o.aM(g,r.u_pitch),u_rotate_symbol:new o.aL(g,r.u_rotate_symbol),u_aspect_ratio:new o.aM(g,r.u_aspect_ratio),u_fade_change:new o.aM(g,r.u_fade_change),u_matrix:new o.aN(g,r.u_matrix),u_label_plane_matrix:new o.aN(g,r.u_label_plane_matrix),u_coord_matrix:new o.aN(g,r.u_coord_matrix),u_is_text:new o.aL(g,r.u_is_text),u_pitch_with_map:new o.aL(g,r.u_pitch_with_map),u_texsize:new o.aQ(g,r.u_texsize),u_texsize_icon:new o.aQ(g,r.u_texsize_icon),u_texture:new o.aL(g,r.u_texture),u_texture_icon:new o.aL(g,r.u_texture_icon),u_gamma_scale:new o.aM(g,r.u_gamma_scale),u_device_pixel_ratio:new o.aM(g,r.u_device_pixel_ratio),u_is_halo:new o.aL(g,r.u_is_halo)}),background:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_opacity:new o.aM(g,r.u_opacity),u_color:new o.aR(g,r.u_color)}),backgroundPattern:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_opacity:new o.aM(g,r.u_opacity),u_image:new o.aL(g,r.u_image),u_pattern_tl_a:new o.aQ(g,r.u_pattern_tl_a),u_pattern_br_a:new o.aQ(g,r.u_pattern_br_a),u_pattern_tl_b:new o.aQ(g,r.u_pattern_tl_b),u_pattern_br_b:new o.aQ(g,r.u_pattern_br_b),u_texsize:new o.aQ(g,r.u_texsize),u_mix:new o.aM(g,r.u_mix),u_pattern_size_a:new o.aQ(g,r.u_pattern_size_a),u_pattern_size_b:new o.aQ(g,r.u_pattern_size_b),u_scale_a:new o.aM(g,r.u_scale_a),u_scale_b:new o.aM(g,r.u_scale_b),u_pixel_coord_upper:new o.aQ(g,r.u_pixel_coord_upper),u_pixel_coord_lower:new o.aQ(g,r.u_pixel_coord_lower),u_tile_units_to_pixels:new o.aM(g,r.u_tile_units_to_pixels)}),terrain:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_texture:new o.aL(g,r.u_texture),u_ele_delta:new o.aM(g,r.u_ele_delta)}),terrainDepth:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_ele_delta:new o.aM(g,r.u_ele_delta)}),terrainCoords:(g,r)=>({u_matrix:new o.aN(g,r.u_matrix),u_texture:new o.aL(g,r.u_texture),u_terrain_coords_id:new o.aM(g,r.u_terrain_coords_id),u_ele_delta:new o.aM(g,r.u_ele_delta)})};class Do{constructor(r,l,f){this.context=r;const p=r.gl;this.buffer=p.createBuffer(),this.dynamicDraw=!!f,this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete l.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){const l=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Vs={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Lo{constructor(r,l,f,p){this.length=l.length,this.attributes=f,this.itemSize=l.bytesPerElement,this.dynamicDraw=p,this.context=r;const y=r.gl;this.buffer=y.createBuffer(),r.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete l.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){if(r.length!==this.length)throw new Error(`Length of new data is ${r.length}, which doesn't match current length of ${this.length}`);const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,l){for(let f=0;f<this.attributes.length;f++){const p=l.attributes[this.attributes[f].name];p!==void 0&&r.enableVertexAttribArray(p)}}setVertexAttribPointers(r,l,f){for(let p=0;p<this.attributes.length;p++){const y=this.attributes[p],T=l.attributes[y.name];T!==void 0&&r.vertexAttribPointer(T,y.components,r[Vs[y.type]],!1,this.itemSize,y.offset+this.itemSize*(f||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const hs=new WeakMap;function In(g){var r;if(hs.has(g))return hs.get(g);{const l=(r=g.getParameter(g.VERSION))===null||r===void 0?void 0:r.startsWith("WebGL 2.0");return hs.set(g,l),l}}class yr{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ro extends yr{getDefault(){return o.aT.transparent}set(r){const l=this.current;(r.r!==l.r||r.g!==l.g||r.b!==l.b||r.a!==l.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class mi extends yr{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class gi extends yr{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class Ml extends yr{getDefault(){return[!0,!0,!0,!0]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||r[3]!==l[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Oo extends yr{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class Bo extends yr{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class Dl extends yr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const l=this.current;(r.func!==l.func||r.ref!==l.ref||r.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class Ll extends yr{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class zo extends yr{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=r,this.dirty=!1}}class Rl extends yr{getDefault(){return[0,1]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class Ol extends yr{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=r,this.dirty=!1}}class No extends yr{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class gu extends yr{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.BLEND):l.disable(l.BLEND),this.current=r,this.dirty=!1}}class xu extends yr{getDefault(){const r=this.gl;return[r.ONE,r.ZERO]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||this.dirty)&&(this.gl.blendFunc(r[0],r[1]),this.current=r,this.dirty=!1)}}class fs extends yr{getDefault(){return o.aT.transparent}set(r){const l=this.current;(r.r!==l.r||r.g!==l.g||r.b!==l.b||r.a!==l.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Qh extends yr{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquation(r),this.current=r,this.dirty=!1)}}class ef extends yr{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=r,this.dirty=!1}}class tf extends yr{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class rf extends yr{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}class af extends yr{getDefault(){return null}set(r){(r!==this.current||this.dirty)&&(this.gl.useProgram(r),this.current=r,this.dirty=!1)}}class nf extends yr{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class Bl extends yr{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||r[3]!==l[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Uo extends yr{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class zl extends yr{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Nl extends yr{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class ds extends yr{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class _u extends yr{getDefault(){return null}set(r){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class yu extends yr{getDefault(){return null}set(r){var l;if(r===this.current&&!this.dirty)return;const f=this.gl;In(f)?f.bindVertexArray(r):(l=f.getExtension("OES_vertex_array_object"))===null||l===void 0||l.bindVertexArrayOES(r),this.current=r,this.dirty=!1}}class Ul extends yr{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class jn extends yr{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class vu extends yr{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class Fn extends yr{constructor(r,l){super(r),this.context=r,this.parent=l}getDefault(){return null}}class ps extends Fn{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class wu extends Fn{set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,l.DEPTH_ATTACHMENT,l.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Vl extends Fn{set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,l.DEPTH_STENCIL_ATTACHMENT,l.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Er{constructor(r,l,f,p,y){this.context=r,this.width=l,this.height=f;const T=r.gl,S=this.framebuffer=T.createFramebuffer();if(this.colorAttachment=new ps(r,S),p)this.depthAttachment=y?new Vl(r,S):new wu(r,S);else if(y)throw new Error("Stencil cannot be setted without depth");if(T.checkFramebufferStatus(T.FRAMEBUFFER)!==T.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const r=this.context.gl,l=this.colorAttachment.get();if(l&&r.deleteTexture(l),this.depthAttachment){const f=this.depthAttachment.get();f&&r.deleteRenderbuffer(f)}r.deleteFramebuffer(this.framebuffer)}}class Wr{constructor(r,l,f){this.blendFunction=r,this.blendColor=l,this.mask=f}}Wr.Replace=[1,0],Wr.disabled=new Wr(Wr.Replace,o.aT.transparent,[!1,!1,!1,!1]),Wr.unblended=new Wr(Wr.Replace,o.aT.transparent,[!0,!0,!0,!0]),Wr.alphaBlended=new Wr([1,771],o.aT.transparent,[!0,!0,!0,!0]);class sf{constructor(r){var l,f;if(this.gl=r,this.clearColor=new Ro(this),this.clearDepth=new mi(this),this.clearStencil=new gi(this),this.colorMask=new Ml(this),this.depthMask=new Oo(this),this.stencilMask=new Bo(this),this.stencilFunc=new Dl(this),this.stencilOp=new Ll(this),this.stencilTest=new zo(this),this.depthRange=new Rl(this),this.depthTest=new Ol(this),this.depthFunc=new No(this),this.blend=new gu(this),this.blendFunc=new xu(this),this.blendColor=new fs(this),this.blendEquation=new Qh(this),this.cullFace=new ef(this),this.cullFaceSide=new tf(this),this.frontFace=new rf(this),this.program=new af(this),this.activeTexture=new nf(this),this.viewport=new Bl(this),this.bindFramebuffer=new Uo(this),this.bindRenderbuffer=new zl(this),this.bindTexture=new Nl(this),this.bindVertexBuffer=new ds(this),this.bindElementBuffer=new _u(this),this.bindVertexArray=new yu(this),this.pixelStoreUnpack=new Ul(this),this.pixelStoreUnpackPremultiplyAlpha=new jn(this),this.pixelStoreUnpackFlipY=new vu(this),this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),In(r)){this.HALF_FLOAT=r.HALF_FLOAT;const p=r.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(l=r.RGBA16F)!==null&&l!==void 0?l:p?.RGBA16F_EXT,this.RGB16F=(f=r.RGB16F)!==null&&f!==void 0?f:p?.RGB16F_EXT,r.getExtension("EXT_color_buffer_float")}else{r.getExtension("EXT_color_buffer_half_float"),r.getExtension("OES_texture_half_float_linear");const p=r.getExtension("OES_texture_half_float");this.HALF_FLOAT=p?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,l){return new Do(this,r,l)}createVertexBuffer(r,l,f){return new Lo(this,r,l,f)}createRenderbuffer(r,l,f){const p=this.gl,y=p.createRenderbuffer();return this.bindRenderbuffer.set(y),p.renderbufferStorage(p.RENDERBUFFER,r,l,f),this.bindRenderbuffer.set(null),y}createFramebuffer(r,l,f,p){return new Er(this,r,l,f,p)}clear({color:r,depth:l,stencil:f}){const p=this.gl;let y=0;r&&(y|=p.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set([!0,!0,!0,!0])),l!==void 0&&(y|=p.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),f!==void 0&&(y|=p.STENCIL_BUFFER_BIT,this.clearStencil.set(f),this.stencilMask.set(255)),p.clear(y)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){o.aG(r.blendFunction,Wr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}createVertexArray(){var r;return In(this.gl)?this.gl.createVertexArray():(r=this.gl.getExtension("OES_vertex_array_object"))===null||r===void 0?void 0:r.createVertexArrayOES()}deleteVertexArray(r){var l;return In(this.gl)?this.gl.deleteVertexArray(r):(l=this.gl.getExtension("OES_vertex_array_object"))===null||l===void 0?void 0:l.deleteVertexArrayOES(r)}unbindVAO(){this.bindVertexArray.set(null)}}class vr{constructor(r,l,f){this.func=r,this.mask=l,this.range=f}}vr.ReadOnly=!1,vr.ReadWrite=!0,vr.disabled=new vr(519,vr.ReadOnly,[0,1]);const Gn=7680;class qr{constructor(r,l,f,p,y,T){this.test=r,this.ref=l,this.mask=f,this.fail=p,this.depthFail=y,this.pass=T}}qr.disabled=new qr({func:519,mask:0},0,0,Gn,Gn,Gn);class jr{constructor(r,l,f){this.enable=r,this.mode=l,this.frontFace=f}}let $s;function bu(g,r,l,f,p,y,T){const S=g.context,A=S.gl,F=g.useProgram("collisionBox"),L=[];let R=0,W=0;for(let _e=0;_e<f.length;_e++){const Re=f[_e],Ze=r.getTile(Re),Xe=Ze.getBucket(l);if(!Xe)continue;let rt=Re.posMatrix;p[0]===0&&p[1]===0||(rt=g.translatePosMatrix(Re.posMatrix,Ze,p,y));const mt=T?Xe.textCollisionBox:Xe.iconCollisionBox,lt=Xe.collisionCircleArray;if(lt.length>0){const vt=o.Z(),Ot=rt;o.aU(vt,Xe.placementInvProjMatrix,g.transform.glCoordMatrix),o.aU(vt,vt,Xe.placementViewportMatrix),L.push({circleArray:lt,circleOffset:W,transform:Ot,invTransform:vt,coord:Re}),R+=lt.length/4,W=R}mt&&F.draw(S,A.LINES,vr.disabled,qr.disabled,g.colorModeForRenderPass(),jr.disabled,Cl(rt,g.transform,Ze),g.style.map.terrain&&g.style.map.terrain.getTerrainData(Re),l.id,mt.layoutVertexBuffer,mt.indexBuffer,mt.segments,null,g.transform.zoom,null,null,mt.collisionVertexBuffer)}if(!T||!L.length)return;const oe=g.useProgram("collisionCircle"),se=new o.aV;se.resize(4*R),se._trim();let de=0;for(const _e of L)for(let Re=0;Re<_e.circleArray.length/4;Re++){const Ze=4*Re,Xe=_e.circleArray[Ze+0],rt=_e.circleArray[Ze+1],mt=_e.circleArray[Ze+2],lt=_e.circleArray[Ze+3];se.emplace(de++,Xe,rt,mt,lt,0),se.emplace(de++,Xe,rt,mt,lt,1),se.emplace(de++,Xe,rt,mt,lt,2),se.emplace(de++,Xe,rt,mt,lt,3)}(!$s||$s.length<2*R)&&($s=function(_e){const Re=2*_e,Ze=new o.aX;Ze.resize(Re),Ze._trim();for(let Xe=0;Xe<Re;Xe++){const rt=6*Xe;Ze.uint16[rt+0]=4*Xe+0,Ze.uint16[rt+1]=4*Xe+1,Ze.uint16[rt+2]=4*Xe+2,Ze.uint16[rt+3]=4*Xe+2,Ze.uint16[rt+4]=4*Xe+3,Ze.uint16[rt+5]=4*Xe+0}return Ze}(R));const ie=S.createIndexBuffer($s,!0),Pe=S.createVertexBuffer(se,o.aW.members,!0);for(const _e of L){const Re={u_matrix:_e.transform,u_inv_matrix:_e.invTransform,u_camera_to_center_distance:(Ge=g.transform).cameraToCenterDistance,u_viewport_size:[Ge.width,Ge.height]};oe.draw(S,A.TRIANGLES,vr.disabled,qr.disabled,g.colorModeForRenderPass(),jr.disabled,Re,g.style.map.terrain&&g.style.map.terrain.getTerrainData(_e.coord),l.id,Pe,ie,o.S.simpleSegment(0,2*_e.circleOffset,_e.circleArray.length,_e.circleArray.length/2),null,g.transform.zoom,null,null,null)}var Ge;Pe.destroy(),ie.destroy()}jr.disabled=new jr(!1,1029,2305),jr.backCCW=new jr(!0,1029,2305);const $l=o.ao(new Float32Array(16));function Vo(g,r,l,f,p,y){const{horizontalAlign:T,verticalAlign:S}=o.au(g);return new o.P((-(T-.5)*r/p+f[0])*y,(-(S-.5)*l/p+f[1])*y)}function $o(g,r,l,f,p,y,T,S,A,F,L){const R=g.text.placedSymbolArray,W=g.text.dynamicLayoutVertexArray,oe=g.icon.dynamicLayoutVertexArray,se={};W.clear();for(let de=0;de<R.length;de++){const ie=R.get(de),Pe=ie.hidden||!ie.crossTileID||g.allowVerticalPlacement&&!ie.placedOrientation?null:f[ie.crossTileID];if(Pe){const Ge=new o.P(ie.anchorX,ie.anchorY),_e=Mt(Ge,l?T:y,L),Re=lr(p.cameraToCenterDistance,_e.signedDistanceFromCamera);let Ze=o.aj(g.textSizeData,A,ie)*Re/o.ap;l&&(Ze*=g.tilePixelRatio/S);const{width:Xe,height:rt,anchor:mt,textOffset:lt,textBoxScale:vt}=Pe,Ot=Vo(mt,Xe,rt,lt,vt,Ze),pr=l?Mt(Ge.add(Ot),y,L).point:_e.point.add(r?Ot.rotate(-p.angle):Ot),Et=g.allowVerticalPlacement&&ie.placedOrientation===o.ai.vertical?Math.PI/2:0;for(let qt=0;qt<ie.numGlyphs;qt++)o.ak(W,pr,Et);F&&ie.associatedIconIndex>=0&&(se[ie.associatedIconIndex]={shiftedAnchor:pr,angle:Et})}else te(ie.numGlyphs,W)}if(F){oe.clear();const de=g.icon.placedSymbolArray;for(let ie=0;ie<de.length;ie++){const Pe=de.get(ie);if(Pe.hidden)te(Pe.numGlyphs,oe);else{const Ge=se[ie];if(Ge)for(let _e=0;_e<Pe.numGlyphs;_e++)o.ak(oe,Ge.shiftedAnchor,Ge.angle);else te(Pe.numGlyphs,oe)}}g.icon.dynamicLayoutVertexBuffer.updateData(oe)}g.text.dynamicLayoutVertexBuffer.updateData(W)}function jl(g,r,l){return l.iconsInText&&r?"symbolTextAndIcon":g?"symbolSDF":"symbolIcon"}function jo(g,r,l,f,p,y,T,S,A,F,L,R){const W=g.context,oe=W.gl,se=g.transform,de=S==="map",ie=A==="map",Pe=S!=="viewport"&&l.layout.get("symbol-placement")!=="point",Ge=de&&!ie&&!Pe,_e=!l.layout.get("symbol-sort-key").isConstant();let Re=!1;const Ze=g.depthModeForSublayer(0,vr.ReadOnly),Xe=l._unevaluatedLayout.hasValue("text-variable-anchor")||l._unevaluatedLayout.hasValue("text-variable-anchor-offset"),rt=[];for(const mt of f){const lt=r.getTile(mt),vt=lt.getBucket(l);if(!vt)continue;const Ot=p?vt.text:vt.icon;if(!Ot||!Ot.segments.get().length||!Ot.hasVisibleVertices)continue;const pr=Ot.programConfigurations.get(l.id),Et=p||vt.sdfIcons,qt=p?vt.textSizeData:vt.iconSizeData,zt=ie||se.pitch!==0,Rr=g.useProgram(jl(Et,p,vt),pr),dr=o.ah(qt,se.zoom),sr=g.style.map.terrain&&g.style.map.terrain.getTerrainData(mt);let mr,ra,zr,Fa,ga=[0,0],la=null;if(p)ra=lt.glyphAtlasTexture,zr=oe.LINEAR,mr=lt.glyphAtlasTexture.size,vt.iconsInText&&(ga=lt.imageAtlasTexture.size,la=lt.imageAtlasTexture,Fa=zt||g.options.rotating||g.options.zooming||qt.kind==="composite"||qt.kind==="camera"?oe.LINEAR:oe.NEAREST);else{const aa=l.layout.get("icon-size").constantOr(0)!==1||vt.iconsNeedLinear;ra=lt.imageAtlasTexture,zr=Et||g.options.rotating||g.options.zooming||aa||zt?oe.LINEAR:oe.NEAREST,mr=lt.imageAtlasTexture.size}const yi=Ce(lt,1,g.transform.zoom),Vr=ot(mt.posMatrix,ie,de,g.transform,yi),Ki=Pt(mt.posMatrix,ie,de,g.transform,yi),Yi=Xe&&vt.hasTextData(),Dn=l.layout.get("icon-text-fit")!=="none"&&Yi&&vt.hasIconData();if(Pe){const aa=g.style.map.terrain?(ri,ia)=>g.style.map.terrain.getElevation(mt,ri,ia):null,xa=l.layout.get("text-rotation-alignment")==="map";at(vt,mt.posMatrix,g,p,Vr,Ki,ie,F,xa,aa)}const Xn=g.translatePosMatrix(mt.posMatrix,lt,y,T),ws=Pe||p&&Xe||Dn?$l:Vr,za=g.translatePosMatrix(Ki,lt,y,T,!0),Pa=Et&&l.paint.get(p?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Wa;Wa=Et?vt.iconsInText?$n(qt.kind,dr,Ge,ie,g,Xn,ws,za,mr,ga):Pl(qt.kind,dr,Ge,ie,g,Xn,ws,za,p,mr,!0):Fl(qt.kind,dr,Ge,ie,g,Xn,ws,za,p,mr);const Kn={program:Rr,buffers:Ot,uniformValues:Wa,atlasTexture:ra,atlasTextureIcon:la,atlasInterpolation:zr,atlasInterpolationIcon:Fa,isSDF:Et,hasHalo:Pa};if(_e&&vt.canOverlap){Re=!0;const aa=Ot.segments.get();for(const xa of aa)rt.push({segments:new o.S([xa]),sortKey:xa.sortKey,state:Kn,terrainData:sr})}else rt.push({segments:Ot.segments,sortKey:0,state:Kn,terrainData:sr})}Re&&rt.sort((mt,lt)=>mt.sortKey-lt.sortKey);for(const mt of rt){const lt=mt.state;if(W.activeTexture.set(oe.TEXTURE0),lt.atlasTexture.bind(lt.atlasInterpolation,oe.CLAMP_TO_EDGE),lt.atlasTextureIcon&&(W.activeTexture.set(oe.TEXTURE1),lt.atlasTextureIcon&&lt.atlasTextureIcon.bind(lt.atlasInterpolationIcon,oe.CLAMP_TO_EDGE)),lt.isSDF){const vt=lt.uniformValues;lt.hasHalo&&(vt.u_is_halo=1,Gl(lt.buffers,mt.segments,l,g,lt.program,Ze,L,R,vt,mt.terrainData)),vt.u_is_halo=0}Gl(lt.buffers,mt.segments,l,g,lt.program,Ze,L,R,lt.uniformValues,mt.terrainData)}}function Gl(g,r,l,f,p,y,T,S,A,F){const L=f.context;p.draw(L,L.gl.TRIANGLES,y,T,S,jr.disabled,A,F,l.id,g.layoutVertexBuffer,g.indexBuffer,r,l.paint,f.transform.zoom,g.programConfigurations.get(l.id),g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer)}function js(g,r,l,f,p){if(!l||!f||!f.imageAtlas)return;const y=f.imageAtlas.patternPositions;let T=y[l.to.toString()],S=y[l.from.toString()];if(!T&&S&&(T=S),!S&&T&&(S=T),!T||!S){const A=p.getPaintProperty(r);T=y[A],S=y[A]}T&&S&&g.setConstantPatternPositions(T,S)}function Gs(g,r,l,f,p,y,T){const S=g.context.gl,A="fill-pattern",F=l.paint.get(A),L=F&&F.constantOr(1),R=l.getCrossfadeParameters();let W,oe,se,de,ie;T?(oe=L&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",W=S.LINES):(oe=L?"fillPattern":"fill",W=S.TRIANGLES);const Pe=F.constantOr(null);for(const Ge of f){const _e=r.getTile(Ge);if(L&&!_e.patternsLoaded())continue;const Re=_e.getBucket(l);if(!Re)continue;const Ze=Re.programConfigurations.get(l.id),Xe=g.useProgram(oe,Ze),rt=g.style.map.terrain&&g.style.map.terrain.getTerrainData(Ge);L&&(g.context.activeTexture.set(S.TEXTURE0),_e.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),Ze.updatePaintBuffers(R)),js(Ze,A,Pe,_e,l);const mt=rt?Ge:null,lt=g.translatePosMatrix(mt?mt.posMatrix:Ge.posMatrix,_e,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor"));if(T){de=Re.indexBuffer2,ie=Re.segments2;const vt=[S.drawingBufferWidth,S.drawingBufferHeight];se=oe==="fillOutlinePattern"&&L?Io(lt,g,R,_e,vt):Ao(lt,vt)}else de=Re.indexBuffer,ie=Re.segments,se=L?kl(lt,g,R,_e):cu(lt);Xe.draw(g.context,W,p,g.stencilModeForClipping(Ge),y,jr.disabled,se,rt,l.id,Re.layoutVertexBuffer,de,ie,l.paint,g.transform.zoom,Ze)}}function Hs(g,r,l,f,p,y,T){const S=g.context,A=S.gl,F="fill-extrusion-pattern",L=l.paint.get(F),R=L.constantOr(1),W=l.getCrossfadeParameters(),oe=l.paint.get("fill-extrusion-opacity"),se=L.constantOr(null);for(const de of f){const ie=r.getTile(de),Pe=ie.getBucket(l);if(!Pe)continue;const Ge=g.style.map.terrain&&g.style.map.terrain.getTerrainData(de),_e=Pe.programConfigurations.get(l.id),Re=g.useProgram(R?"fillExtrusionPattern":"fillExtrusion",_e);R&&(g.context.activeTexture.set(A.TEXTURE0),ie.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),_e.updatePaintBuffers(W)),js(_e,F,se,ie,l);const Ze=g.translatePosMatrix(de.posMatrix,ie,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),Xe=l.paint.get("fill-extrusion-vertical-gradient"),rt=R?Cn(Ze,g,Xe,oe,de,W,ie):Sl(Ze,g,Xe,oe);Re.draw(S,S.gl.TRIANGLES,p,y,T,jr.backCCW,rt,Ge,l.id,Pe.layoutVertexBuffer,Pe.indexBuffer,Pe.segments,l.paint,g.transform.zoom,_e,g.style.map.terrain&&Pe.centroidVertexBuffer)}}function of(g,r,l,f,p,y,T){const S=g.context,A=S.gl,F=l.fbo;if(!F)return;const L=g.useProgram("hillshade"),R=g.style.map.terrain&&g.style.map.terrain.getTerrainData(r);S.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,F.colorAttachment.get()),L.draw(S,A.TRIANGLES,p,y,T,jr.disabled,((W,oe,se,de)=>{const ie=se.paint.get("hillshade-shadow-color"),Pe=se.paint.get("hillshade-highlight-color"),Ge=se.paint.get("hillshade-accent-color");let _e=se.paint.get("hillshade-illumination-direction")*(Math.PI/180);se.paint.get("hillshade-illumination-anchor")==="viewport"&&(_e-=W.transform.angle);const Re=!W.options.moving;return{u_matrix:de?de.posMatrix:W.transform.calculatePosMatrix(oe.tileID.toUnwrapped(),Re),u_image:0,u_latrange:Al(0,oe.tileID),u_light:[se.paint.get("hillshade-exaggeration"),_e],u_shadow:ie,u_highlight:Pe,u_accent:Ge}})(g,l,f,R?r:null),R,f.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments)}function Hl(g,r,l,f,p,y){const T=g.context,S=T.gl,A=r.dem;if(A&&A.data){const F=A.dim,L=A.stride,R=A.getPixels();if(T.activeTexture.set(S.TEXTURE1),T.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||g.getTileTexture(L),r.demTexture){const oe=r.demTexture;oe.update(R,{premultiply:!1}),oe.bind(S.NEAREST,S.CLAMP_TO_EDGE)}else r.demTexture=new $e(T,R,S.RGBA,{premultiply:!1}),r.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);T.activeTexture.set(S.TEXTURE0);let W=r.fbo;if(!W){const oe=new $e(T,{width:F,height:F,data:null},S.RGBA);oe.bind(S.LINEAR,S.CLAMP_TO_EDGE),W=r.fbo=T.createFramebuffer(F,F,!0,!1),W.colorAttachment.set(oe.texture)}T.bindFramebuffer.set(W.framebuffer),T.viewport.set([0,0,F,F]),g.useProgram("hillshadePrepare").draw(T,S.TRIANGLES,f,p,y,jr.disabled,((oe,se)=>{const de=se.stride,ie=o.Z();return o.aS(ie,0,o.N,-o.N,0,0,1),o.$(ie,ie,[0,-o.N,0]),{u_matrix:ie,u_image:1,u_dimension:[de,de],u_zoom:oe.overscaledZ,u_unpack:se.getUnpackVector()}})(r.tileID,A),null,l.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments),r.needsHillshadePrepare=!1}}function lf(g,r,l,f,p,y){const T=f.paint.get("raster-fade-duration");if(!y&&T>0){const S=o.h.now(),A=(S-g.timeAdded)/T,F=r?(S-r.timeAdded)/T:-1,L=l.getSource(),R=p.coveringZoomLevel({tileSize:L.tileSize,roundZoom:L.roundZoom}),W=!r||Math.abs(r.tileID.overscaledZ-R)>Math.abs(g.tileID.overscaledZ-R),oe=W&&g.refreshedUponExpiration?1:o.ad(W?A:1-F,0,1);return g.refreshedUponExpiration&&A>=1&&(g.refreshedUponExpiration=!1),r?{opacity:1,mix:1-oe}:{opacity:oe,mix:0}}return{opacity:1,mix:0}}const Tu=new o.aT(1,0,0,1),Go=new o.aT(0,1,0,1),Wl=new o.aT(0,0,1,1),Eu=new o.aT(1,0,1,1),Su=new o.aT(0,1,1,1);function Ws(g,r,l,f){Wo(g,0,r+l/2,g.transform.width,l,f)}function Ho(g,r,l,f){Wo(g,r-l/2,0,l,g.transform.height,f)}function Wo(g,r,l,f,p,y){const T=g.context,S=T.gl;S.enable(S.SCISSOR_TEST),S.scissor(r*g.pixelRatio,l*g.pixelRatio,f*g.pixelRatio,p*g.pixelRatio),T.clear({color:y}),S.disable(S.SCISSOR_TEST)}function ku(g,r,l){const f=g.context,p=f.gl,y=l.posMatrix,T=g.useProgram("debug"),S=vr.disabled,A=qr.disabled,F=g.colorModeForRenderPass(),L="$debug",R=g.style.map.terrain&&g.style.map.terrain.getTerrainData(l);f.activeTexture.set(p.TEXTURE0);const W=r.getTileByID(l.key).latestRawTileData,oe=Math.floor((W&&W.byteLength||0)/1024),se=r.getTile(l).tileSize,de=512/Math.min(se,512)*(l.overscaledZ/g.transform.zoom)*.5;let ie=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(ie+=` => ${l.overscaledZ}`),function(Pe,Ge){Pe.initDebugOverlayCanvas();const _e=Pe.debugOverlayCanvas,Re=Pe.context.gl,Ze=Pe.debugOverlayCanvas.getContext("2d");Ze.clearRect(0,0,_e.width,_e.height),Ze.shadowColor="white",Ze.shadowBlur=2,Ze.lineWidth=1.5,Ze.strokeStyle="white",Ze.textBaseline="top",Ze.font="bold 36px Open Sans, sans-serif",Ze.fillText(Ge,5,5),Ze.strokeText(Ge,5,5),Pe.debugOverlayTexture.update(_e),Pe.debugOverlayTexture.bind(Re.LINEAR,Re.CLAMP_TO_EDGE)}(g,`${ie} ${oe}kB`),T.draw(f,p.TRIANGLES,S,A,Wr.alphaBlended,jr.disabled,Us(y,o.aT.transparent,de),null,L,g.debugBuffer,g.quadTriangleIndexBuffer,g.debugSegments),T.draw(f,p.LINE_STRIP,S,A,F,jr.disabled,Us(y,o.aT.red),R,L,g.debugBuffer,g.tileBorderIndexBuffer,g.debugSegments)}function Jr(g,r,l){const f=g.context,p=f.gl,y=g.colorModeForRenderPass(),T=new vr(p.LEQUAL,vr.ReadWrite,g.depthRangeFor3D),S=g.useProgram("terrain"),A=r.getTerrainMesh();f.bindFramebuffer.set(null),f.viewport.set([0,0,g.width,g.height]);for(const F of l){const L=g.renderToTexture.getTexture(F),R=r.getTerrainData(F.tileID);f.activeTexture.set(p.TEXTURE0),p.bindTexture(p.TEXTURE_2D,L.texture);const W={u_matrix:g.transform.calculatePosMatrix(F.tileID.toUnwrapped()),u_texture:0,u_ele_delta:r.getMeshFrameDelta(g.transform.zoom)};S.draw(f,p.TRIANGLES,T,qr.disabled,y,jr.backCCW,W,R,"terrain",A.vertexBuffer,A.indexBuffer,A.segments)}}class Hn{constructor(r,l){this.context=new sf(r),this.transform=l,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.Z(),renderTime:0},this.setup(),this.numSublayers=Cr.maxUnderzooming+Cr.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ma}resize(r,l,f){if(this.width=Math.floor(r*f),this.height=Math.floor(l*f),this.pixelRatio=f,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style._order)this.style._layers[p].resize()}setup(){const r=this.context,l=new o.a_;l.emplaceBack(0,0),l.emplaceBack(o.N,0),l.emplaceBack(0,o.N),l.emplaceBack(o.N,o.N),this.tileExtentBuffer=r.createVertexBuffer(l,ko.members),this.tileExtentSegments=o.S.simpleSegment(0,0,4,2);const f=new o.a_;f.emplaceBack(0,0),f.emplaceBack(o.N,0),f.emplaceBack(0,o.N),f.emplaceBack(o.N,o.N),this.debugBuffer=r.createVertexBuffer(f,ko.members),this.debugSegments=o.S.simpleSegment(0,0,4,5);const p=new o.V;p.emplaceBack(0,0,0,0),p.emplaceBack(o.N,0,o.N,0),p.emplaceBack(0,o.N,0,o.N),p.emplaceBack(o.N,o.N,o.N,o.N),this.rasterBoundsBuffer=r.createVertexBuffer(p,ut.members),this.rasterBoundsSegments=o.S.simpleSegment(0,0,4,2);const y=new o.a_;y.emplaceBack(0,0),y.emplaceBack(1,0),y.emplaceBack(0,1),y.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(y,ko.members),this.viewportSegments=o.S.simpleSegment(0,0,4,2);const T=new o.a$;T.emplaceBack(0),T.emplaceBack(1),T.emplaceBack(3),T.emplaceBack(2),T.emplaceBack(0),this.tileBorderIndexBuffer=r.createIndexBuffer(T);const S=new o.b0;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(S);const A=this.context.gl;this.stencilClearMode=new qr({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO)}clearStencil(){const r=this.context,l=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const f=o.Z();o.aS(f,0,this.width,this.height,0,0,1),o.a0(f,f,[l.drawingBufferWidth,l.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(r,l.TRIANGLES,vr.disabled,this.stencilClearMode,Wr.disabled,jr.disabled,uu(f),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(r,l){if(this.currentStencilSource===r.source||!r.isTileClipped()||!l||!l.length)return;this.currentStencilSource=r.source;const f=this.context,p=f.gl;this.nextStencilID+l.length>256&&this.clearStencil(),f.setColorMode(Wr.disabled),f.setDepthMode(vr.disabled);const y=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const T of l){const S=this._tileClippingMaskIDs[T.key]=this.nextStencilID++,A=this.style.map.terrain&&this.style.map.terrain.getTerrainData(T);y.draw(f,p.TRIANGLES,vr.disabled,new qr({func:p.ALWAYS,mask:0},S,255,p.KEEP,p.KEEP,p.REPLACE),Wr.disabled,jr.disabled,uu(T.posMatrix),A,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,l=this.context.gl;return new qr({func:l.NOTEQUAL,mask:255},r,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(r){const l=this.context.gl;return new qr({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(r){const l=this.context.gl,f=r.sort((T,S)=>S.overscaledZ-T.overscaledZ),p=f[f.length-1].overscaledZ,y=f[0].overscaledZ-p+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const T={};for(let S=0;S<y;S++)T[S+p]=new qr({func:l.GEQUAL,mask:255},S+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=y,[T,f]}return[{[p]:qr.disabled},f]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new Wr([r.CONSTANT_COLOR,r.ONE],new o.aT(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Wr.unblended:Wr.alphaBlended}depthModeForSublayer(r,l,f){if(!this.opaquePassEnabledForLayer())return vr.disabled;const p=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new vr(f||this.context.gl.LEQUAL,l,[p,p])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,l){this.style=r,this.options=l,this.lineAtlas=r.lineAtlas,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(o.h.now()),this.imageManager.beginFrame();const f=this.style._order,p=this.style.sourceCaches,y={},T={},S={};for(const A in p){const F=p[A];F.used&&F.prepare(this.context),y[A]=F.getVisibleCoordinates(),T[A]=y[A].slice().reverse(),S[A]=F.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let A=0;A<f.length;A++)if(this.style._layers[f[A]].is3D()){this.opaquePassCutoff=A;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const A=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!o.b1(this.terrainFacilitator.matrix,this.transform.projMatrix)||A.length)&&(o.b2(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(F,L){const R=F.context,W=R.gl,oe=Wr.unblended,se=new vr(W.LEQUAL,vr.ReadWrite,[0,1]),de=L.getTerrainMesh(),ie=L.sourceCache.getRenderableTiles(),Pe=F.useProgram("terrainDepth");R.bindFramebuffer.set(L.getFramebuffer("depth").framebuffer),R.viewport.set([0,0,F.width/devicePixelRatio,F.height/devicePixelRatio]),R.clear({color:o.aT.transparent,depth:1});for(const Ge of ie){const _e=L.getTerrainData(Ge.tileID),Re={u_matrix:F.transform.calculatePosMatrix(Ge.tileID.toUnwrapped()),u_ele_delta:L.getMeshFrameDelta(F.transform.zoom)};Pe.draw(R,W.TRIANGLES,se,qr.disabled,oe,jr.backCCW,Re,_e,"terrain",de.vertexBuffer,de.indexBuffer,de.segments)}R.bindFramebuffer.set(null),R.viewport.set([0,0,F.width,F.height])}(this,this.style.map.terrain),function(F,L){const R=F.context,W=R.gl,oe=Wr.unblended,se=new vr(W.LEQUAL,vr.ReadWrite,[0,1]),de=L.getTerrainMesh(),ie=L.getCoordsTexture(),Pe=L.sourceCache.getRenderableTiles(),Ge=F.useProgram("terrainCoords");R.bindFramebuffer.set(L.getFramebuffer("coords").framebuffer),R.viewport.set([0,0,F.width/devicePixelRatio,F.height/devicePixelRatio]),R.clear({color:o.aT.transparent,depth:1}),L.coordsIndex=[];for(const _e of Pe){const Re=L.getTerrainData(_e.tileID);R.activeTexture.set(W.TEXTURE0),W.bindTexture(W.TEXTURE_2D,ie.texture);const Ze={u_matrix:F.transform.calculatePosMatrix(_e.tileID.toUnwrapped()),u_terrain_coords_id:(255-L.coordsIndex.length)/255,u_texture:0,u_ele_delta:L.getMeshFrameDelta(F.transform.zoom)};Ge.draw(R,W.TRIANGLES,se,qr.disabled,oe,jr.backCCW,Ze,Re,"terrain",de.vertexBuffer,de.indexBuffer,de.segments),L.coordsIndex.push(_e.tileID.key)}R.bindFramebuffer.set(null),R.viewport.set([0,0,F.width,F.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const A of f){const F=this.style._layers[A];if(!F.hasOffscreenPass()||F.isHidden(this.transform.zoom))continue;const L=T[F.source];(F.type==="custom"||L.length)&&this.renderLayer(this,p[F.source],F,L)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:l.showOverdrawInspector?o.aT.black:o.aT.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.depthRangeFor3D=[0,1-(r._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=f.length-1;this.currentLayer>=0;this.currentLayer--){const A=this.style._layers[f[this.currentLayer]],F=p[A.source],L=y[A.source];this._renderTileClippingMasks(A,L),this.renderLayer(this,F,A,L)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<f.length;this.currentLayer++){const A=this.style._layers[f[this.currentLayer]],F=p[A.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(A))continue;const L=(A.type==="symbol"?S:T)[A.source];this._renderTileClippingMasks(A,y[A.source]),this.renderLayer(this,F,A,L)}if(this.options.showTileBoundaries){const A=function(F,L){let R=null;const W=Object.values(F._layers).flatMap(ie=>ie.source&&!ie.isHidden(L)?[F.sourceCaches[ie.source]]:[]),oe=W.filter(ie=>ie.getSource().type==="vector"),se=W.filter(ie=>ie.getSource().type!=="vector"),de=ie=>{(!R||R.getSource().maxzoom<ie.getSource().maxzoom)&&(R=ie)};return oe.forEach(ie=>de(ie)),R||se.forEach(ie=>de(ie)),R}(this.style,this.transform.zoom);A&&function(F,L,R){for(let W=0;W<R.length;W++)ku(F,L,R[W])}(this,A,A.getVisibleCoordinates())}this.options.showPadding&&function(A){const F=A.transform.padding;Ws(A,A.transform.height-(F.top||0),3,Tu),Ws(A,F.bottom||0,3,Go),Ho(A,F.left||0,3,Wl),Ho(A,A.transform.width-(F.right||0),3,Eu);const L=A.transform.centerPoint;(function(R,W,oe,se){Wo(R,W-1,oe-10,2,20,se),Wo(R,W-10,oe-1,20,2,se)})(A,L.x,A.transform.height-L.y,Su)}(this),this.context.setDefault()}renderLayer(r,l,f,p){if(!f.isHidden(this.transform.zoom)&&(f.type==="background"||f.type==="custom"||(p||[]).length))switch(this.id=f.id,f.type){case"symbol":(function(y,T,S,A,F){if(y.renderPass!=="translucent")return;const L=qr.disabled,R=y.colorModeForRenderPass();(S._unevaluatedLayout.hasValue("text-variable-anchor")||S._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(W,oe,se,de,ie,Pe,Ge){const _e=oe.transform,Re=ie==="map",Ze=Pe==="map";for(const Xe of W){const rt=de.getTile(Xe),mt=rt.getBucket(se);if(!mt||!mt.text||!mt.text.segments.get().length)continue;const lt=o.ah(mt.textSizeData,_e.zoom),vt=Ce(rt,1,oe.transform.zoom),Ot=ot(Xe.posMatrix,Ze,Re,oe.transform,vt),pr=se.layout.get("icon-text-fit")!=="none"&&mt.hasIconData();if(lt){const Et=Math.pow(2,_e.zoom-rt.tileID.overscaledZ);$o(mt,Re,Ze,Ge,_e,Ot,Xe.posMatrix,Et,lt,pr,oe.style.map.terrain?(qt,zt)=>oe.style.map.terrain.getElevation(Xe,qt,zt):null)}}}(A,y,S,T,S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),F),S.paint.get("icon-opacity").constantOr(1)!==0&&jo(y,T,S,A,!1,S.paint.get("icon-translate"),S.paint.get("icon-translate-anchor"),S.layout.get("icon-rotation-alignment"),S.layout.get("icon-pitch-alignment"),S.layout.get("icon-keep-upright"),L,R),S.paint.get("text-opacity").constantOr(1)!==0&&jo(y,T,S,A,!0,S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),S.layout.get("text-keep-upright"),L,R),T.map.showCollisionBoxes&&(bu(y,T,S,A,S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),!0),bu(y,T,S,A,S.paint.get("icon-translate"),S.paint.get("icon-translate-anchor"),!1))})(r,l,f,p,this.style.placement.variableOffsets);break;case"circle":(function(y,T,S,A){if(y.renderPass!=="translucent")return;const F=S.paint.get("circle-opacity"),L=S.paint.get("circle-stroke-width"),R=S.paint.get("circle-stroke-opacity"),W=!S.layout.get("circle-sort-key").isConstant();if(F.constantOr(1)===0&&(L.constantOr(1)===0||R.constantOr(1)===0))return;const oe=y.context,se=oe.gl,de=y.depthModeForSublayer(0,vr.ReadOnly),ie=qr.disabled,Pe=y.colorModeForRenderPass(),Ge=[];for(let _e=0;_e<A.length;_e++){const Re=A[_e],Ze=T.getTile(Re),Xe=Ze.getBucket(S);if(!Xe)continue;const rt=Xe.programConfigurations.get(S.id),mt=y.useProgram("circle",rt),lt=Xe.layoutVertexBuffer,vt=Xe.indexBuffer,Ot=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Re),pr={programConfiguration:rt,program:mt,layoutVertexBuffer:lt,indexBuffer:vt,uniformValues:An(y,Re,Ze,S),terrainData:Ot};if(W){const Et=Xe.segments.get();for(const qt of Et)Ge.push({segments:new o.S([qt]),sortKey:qt.sortKey,state:pr})}else Ge.push({segments:Xe.segments,sortKey:0,state:pr})}W&&Ge.sort((_e,Re)=>_e.sortKey-Re.sortKey);for(const _e of Ge){const{programConfiguration:Re,program:Ze,layoutVertexBuffer:Xe,indexBuffer:rt,uniformValues:mt,terrainData:lt}=_e.state;Ze.draw(oe,se.TRIANGLES,de,ie,Pe,jr.disabled,mt,lt,S.id,Xe,rt,_e.segments,S.paint,y.transform.zoom,Re)}})(r,l,f,p);break;case"heatmap":(function(y,T,S,A){if(S.paint.get("heatmap-opacity")!==0)if(y.renderPass==="offscreen"){const F=y.context,L=F.gl,R=qr.disabled,W=new Wr([L.ONE,L.ONE],o.aT.transparent,[!0,!0,!0,!0]);(function(oe,se,de){const ie=oe.gl;oe.activeTexture.set(ie.TEXTURE1),oe.viewport.set([0,0,se.width/4,se.height/4]);let Pe=de.heatmapFbo;if(Pe)ie.bindTexture(ie.TEXTURE_2D,Pe.colorAttachment.get()),oe.bindFramebuffer.set(Pe.framebuffer);else{const Ge=ie.createTexture();ie.bindTexture(ie.TEXTURE_2D,Ge),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_WRAP_S,ie.CLAMP_TO_EDGE),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_WRAP_T,ie.CLAMP_TO_EDGE),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_MIN_FILTER,ie.LINEAR),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_MAG_FILTER,ie.LINEAR),Pe=de.heatmapFbo=oe.createFramebuffer(se.width/4,se.height/4,!1,!1),function(_e,Re,Ze,Xe){var rt,mt;const lt=_e.gl,vt=(rt=_e.HALF_FLOAT)!==null&&rt!==void 0?rt:lt.UNSIGNED_BYTE,Ot=(mt=_e.RGBA16F)!==null&&mt!==void 0?mt:lt.RGBA;lt.texImage2D(lt.TEXTURE_2D,0,Ot,Re.width/4,Re.height/4,0,lt.RGBA,vt,null),Xe.colorAttachment.set(Ze)}(oe,se,Ge,Pe)}})(F,y,S),F.clear({color:o.aT.transparent});for(let oe=0;oe<A.length;oe++){const se=A[oe];if(T.hasRenderableParent(se))continue;const de=T.getTile(se),ie=de.getBucket(S);if(!ie)continue;const Pe=ie.programConfigurations.get(S.id),Ge=y.useProgram("heatmap",Pe),{zoom:_e}=y.transform;Ge.draw(F,L.TRIANGLES,vr.disabled,R,W,jr.disabled,Yh(se.posMatrix,de,_e,S.paint.get("heatmap-intensity")),null,S.id,ie.layoutVertexBuffer,ie.indexBuffer,ie.segments,S.paint,y.transform.zoom,Pe)}F.viewport.set([0,0,y.width,y.height])}else y.renderPass==="translucent"&&(y.context.setColorMode(y.colorModeForRenderPass()),function(F,L){const R=F.context,W=R.gl,oe=L.heatmapFbo;if(!oe)return;R.activeTexture.set(W.TEXTURE0),W.bindTexture(W.TEXTURE_2D,oe.colorAttachment.get()),R.activeTexture.set(W.TEXTURE1);let se=L.colorRampTexture;se||(se=L.colorRampTexture=new $e(R,L.colorRamp,W.RGBA)),se.bind(W.LINEAR,W.CLAMP_TO_EDGE),F.useProgram("heatmapTexture").draw(R,W.TRIANGLES,vr.disabled,qr.disabled,F.colorModeForRenderPass(),jr.disabled,((de,ie,Pe,Ge)=>{const _e=o.Z();o.aS(_e,0,de.width,de.height,0,0,1);const Re=de.context.gl;return{u_matrix:_e,u_world:[Re.drawingBufferWidth,Re.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:ie.paint.get("heatmap-opacity")}})(F,L),null,L.id,F.viewportBuffer,F.quadTriangleIndexBuffer,F.viewportSegments,L.paint,F.transform.zoom)}(y,S))})(r,l,f,p);break;case"line":(function(y,T,S,A){if(y.renderPass!=="translucent")return;const F=S.paint.get("line-opacity"),L=S.paint.get("line-width");if(F.constantOr(1)===0||L.constantOr(1)===0)return;const R=y.depthModeForSublayer(0,vr.ReadOnly),W=y.colorModeForRenderPass(),oe=S.paint.get("line-dasharray"),se=S.paint.get("line-pattern"),de=se.constantOr(1),ie=S.paint.get("line-gradient"),Pe=S.getCrossfadeParameters(),Ge=de?"linePattern":oe?"lineSDF":ie?"lineGradient":"line",_e=y.context,Re=_e.gl;let Ze=!0;for(const Xe of A){const rt=T.getTile(Xe);if(de&&!rt.patternsLoaded())continue;const mt=rt.getBucket(S);if(!mt)continue;const lt=mt.programConfigurations.get(S.id),vt=y.context.program.get(),Ot=y.useProgram(Ge,lt),pr=Ze||Ot.program!==vt,Et=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Xe),qt=se.constantOr(null);if(qt&&rt.imageAtlas){const dr=rt.imageAtlas,sr=dr.patternPositions[qt.to.toString()],mr=dr.patternPositions[qt.from.toString()];sr&&mr&&lt.setConstantPatternPositions(sr,mr)}const zt=Et?Xe:null,Rr=de?Jh(y,rt,S,Pe,zt):oe?fu(y,rt,S,oe,Pe,zt):ie?hu(y,rt,S,mt.lineClipsArray.length,zt):Il(y,rt,S,zt);if(de)_e.activeTexture.set(Re.TEXTURE0),rt.imageAtlasTexture.bind(Re.LINEAR,Re.CLAMP_TO_EDGE),lt.updatePaintBuffers(Pe);else if(oe&&(pr||y.lineAtlas.dirty))_e.activeTexture.set(Re.TEXTURE0),y.lineAtlas.bind(_e);else if(ie){const dr=mt.gradients[S.id];let sr=dr.texture;if(S.gradientVersion!==dr.version){let mr=256;if(S.stepInterpolant){const ra=T.getSource().maxzoom,zr=Xe.canonical.z===ra?Math.ceil(1<<y.transform.maxZoom-Xe.canonical.z):1;mr=o.ad(o.aY(mt.maxLineLength/o.N*1024*zr),256,_e.maxTextureSize)}dr.gradient=o.aZ({expression:S.gradientExpression(),evaluationKey:"lineProgress",resolution:mr,image:dr.gradient||void 0,clips:mt.lineClipsArray}),dr.texture?dr.texture.update(dr.gradient):dr.texture=new $e(_e,dr.gradient,Re.RGBA),dr.version=S.gradientVersion,sr=dr.texture}_e.activeTexture.set(Re.TEXTURE0),sr.bind(S.stepInterpolant?Re.NEAREST:Re.LINEAR,Re.CLAMP_TO_EDGE)}Ot.draw(_e,Re.TRIANGLES,R,y.stencilModeForClipping(Xe),W,jr.disabled,Rr,Et,S.id,mt.layoutVertexBuffer,mt.indexBuffer,mt.segments,S.paint,y.transform.zoom,lt,mt.layoutVertexBuffer2),Ze=!1}})(r,l,f,p);break;case"fill":(function(y,T,S,A){const F=S.paint.get("fill-color"),L=S.paint.get("fill-opacity");if(L.constantOr(1)===0)return;const R=y.colorModeForRenderPass(),W=S.paint.get("fill-pattern"),oe=y.opaquePassEnabledForLayer()&&!W.constantOr(1)&&F.constantOr(o.aT.transparent).a===1&&L.constantOr(0)===1?"opaque":"translucent";if(y.renderPass===oe){const se=y.depthModeForSublayer(1,y.renderPass==="opaque"?vr.ReadWrite:vr.ReadOnly);Gs(y,T,S,A,se,R,!1)}if(y.renderPass==="translucent"&&S.paint.get("fill-antialias")){const se=y.depthModeForSublayer(S.getPaintProperty("fill-outline-color")?2:0,vr.ReadOnly);Gs(y,T,S,A,se,R,!0)}})(r,l,f,p);break;case"fill-extrusion":(function(y,T,S,A){const F=S.paint.get("fill-extrusion-opacity");if(F!==0&&y.renderPass==="translucent"){const L=new vr(y.context.gl.LEQUAL,vr.ReadWrite,y.depthRangeFor3D);if(F!==1||S.paint.get("fill-extrusion-pattern").constantOr(1))Hs(y,T,S,A,L,qr.disabled,Wr.disabled),Hs(y,T,S,A,L,y.stencilModeFor3D(),y.colorModeForRenderPass());else{const R=y.colorModeForRenderPass();Hs(y,T,S,A,L,qr.disabled,R)}}})(r,l,f,p);break;case"hillshade":(function(y,T,S,A){if(y.renderPass!=="offscreen"&&y.renderPass!=="translucent")return;const F=y.context,L=y.depthModeForSublayer(0,vr.ReadOnly),R=y.colorModeForRenderPass(),[W,oe]=y.renderPass==="translucent"?y.stencilConfigForOverlap(A):[{},A];for(const se of oe){const de=T.getTile(se);de.needsHillshadePrepare!==void 0&&de.needsHillshadePrepare&&y.renderPass==="offscreen"?Hl(y,de,S,L,qr.disabled,R):y.renderPass==="translucent"&&of(y,se,de,S,L,W[se.overscaledZ],R)}F.viewport.set([0,0,y.width,y.height])})(r,l,f,p);break;case"raster":(function(y,T,S,A){if(y.renderPass!=="translucent"||S.paint.get("raster-opacity")===0||!A.length)return;const F=y.context,L=F.gl,R=T.getSource(),W=y.useProgram("raster"),oe=y.colorModeForRenderPass(),[se,de]=R instanceof tt?[{},A]:y.stencilConfigForOverlap(A),ie=de[de.length-1].overscaledZ,Pe=!y.options.moving;for(const Ge of de){const _e=y.depthModeForSublayer(Ge.overscaledZ-ie,S.paint.get("raster-opacity")===1?vr.ReadWrite:vr.ReadOnly,L.LESS),Re=T.getTile(Ge);Re.registerFadeDuration(S.paint.get("raster-fade-duration"));const Ze=T.findLoadedParent(Ge,0),Xe=lf(Re,Ze,T,S,y.transform,y.style.map.terrain);let rt,mt;const lt=S.paint.get("raster-resampling")==="nearest"?L.NEAREST:L.LINEAR;F.activeTexture.set(L.TEXTURE0),Re.texture.bind(lt,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),F.activeTexture.set(L.TEXTURE1),Ze?(Ze.texture.bind(lt,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),rt=Math.pow(2,Ze.tileID.overscaledZ-Re.tileID.overscaledZ),mt=[Re.tileID.canonical.x*rt%1,Re.tileID.canonical.y*rt%1]):Re.texture.bind(lt,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST);const vt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Ge),Ot=vt?Ge:null,pr=Ot?Ot.posMatrix:y.transform.calculatePosMatrix(Ge.toUnwrapped(),Pe),Et=pu(pr,mt||[0,0],rt||1,Xe,S);R instanceof tt?W.draw(F,L.TRIANGLES,_e,qr.disabled,oe,jr.disabled,Et,vt,S.id,R.boundsBuffer,y.quadTriangleIndexBuffer,R.boundsSegments):W.draw(F,L.TRIANGLES,_e,se[Ge.overscaledZ],oe,jr.disabled,Et,vt,S.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments)}})(r,l,f,p);break;case"background":(function(y,T,S,A){const F=S.paint.get("background-color"),L=S.paint.get("background-opacity");if(L===0)return;const R=y.context,W=R.gl,oe=y.transform,se=oe.tileSize,de=S.paint.get("background-pattern");if(y.isPatternMissing(de))return;const ie=!de&&F.a===1&&L===1&&y.opaquePassEnabledForLayer()?"opaque":"translucent";if(y.renderPass!==ie)return;const Pe=qr.disabled,Ge=y.depthModeForSublayer(0,ie==="opaque"?vr.ReadWrite:vr.ReadOnly),_e=y.colorModeForRenderPass(),Re=y.useProgram(de?"backgroundPattern":"background"),Ze=A||oe.coveringTiles({tileSize:se,terrain:y.style.map.terrain});de&&(R.activeTexture.set(W.TEXTURE0),y.imageManager.bind(y.context));const Xe=S.getCrossfadeParameters();for(const rt of Ze){const mt=A?rt.posMatrix:y.transform.calculatePosMatrix(rt.toUnwrapped()),lt=de?Di(mt,L,y,de,{tileID:rt,tileSize:se},Xe):Po(mt,L,F),vt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(rt);Re.draw(R,W.TRIANGLES,Ge,Pe,_e,jr.disabled,lt,vt,S.id,y.tileExtentBuffer,y.quadTriangleIndexBuffer,y.tileExtentSegments)}})(r,0,f,p);break;case"custom":(function(y,T,S){const A=y.context,F=S.implementation;if(y.renderPass==="offscreen"){const L=F.prerender;L&&(y.setCustomLayerDefaults(),A.setColorMode(y.colorModeForRenderPass()),L.call(F,A.gl,y.transform.customLayerMatrix()),A.setDirty(),y.setBaseState())}else if(y.renderPass==="translucent"){y.setCustomLayerDefaults(),A.setColorMode(y.colorModeForRenderPass()),A.setStencilMode(qr.disabled);const L=F.renderingMode==="3d"?new vr(y.context.gl.LEQUAL,vr.ReadWrite,y.depthRangeFor3D):y.depthModeForSublayer(0,vr.ReadOnly);A.setDepthMode(L),F.render(A.gl,y.transform.customLayerMatrix()),A.setDirty(),y.setBaseState(),A.bindFramebuffer.set(null)}})(r,0,f)}}translatePosMatrix(r,l,f,p,y){if(!f[0]&&!f[1])return r;const T=y?p==="map"?this.transform.angle:0:p==="viewport"?-this.transform.angle:0;if(T){const F=Math.sin(T),L=Math.cos(T);f=[f[0]*L-f[1]*F,f[0]*F+f[1]*L]}const S=[y?f[0]:Ce(l,f[0],this.transform.zoom),y?f[1]:Ce(l,f[1],this.transform.zoom),0],A=new Float32Array(16);return o.$(A,r,S),A}saveTileTexture(r){const l=this._tileTextures[r.size[0]];l?l.push(r):this._tileTextures[r.size[0]]=[r]}getTileTexture(r){const l=this._tileTextures[r];return l&&l.length>0?l.pop():null}isPatternMissing(r){if(!r)return!1;if(!r.from||!r.to)return!0;const l=this.imageManager.getPattern(r.from.toString()),f=this.imageManager.getPattern(r.to.toString());return!l||!f}useProgram(r,l){this.cache=this.cache||{};const f=r+(l?l.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[f]||(this.cache[f]=new Co(this.context,Hr[r],l,Mo[r],this._showOverdrawInspector,this.style.map.terrain)),this.cache[f]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new $e(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:r,drawingBufferHeight:l}=this.context.gl;return this.width!==r||this.height!==l}}class ei{constructor(r,l){this.points=r,this.planes=l}static fromInvProjectionMatrix(r,l,f){const p=Math.pow(2,f),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(S=>{const A=1/(S=o.ag([],S,r))[3]/l*p;return o.b3(S,S,[A,A,1/S[3],A])}),T=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(S=>{const A=function(W,oe){var se=oe[0],de=oe[1],ie=oe[2],Pe=se*se+de*de+ie*ie;return Pe>0&&(Pe=1/Math.sqrt(Pe)),W[0]=oe[0]*Pe,W[1]=oe[1]*Pe,W[2]=oe[2]*Pe,W}([],function(W,oe,se){var de=oe[0],ie=oe[1],Pe=oe[2],Ge=se[0],_e=se[1],Re=se[2];return W[0]=ie*Re-Pe*_e,W[1]=Pe*Ge-de*Re,W[2]=de*_e-ie*Ge,W}([],we([],y[S[0]],y[S[1]]),we([],y[S[2]],y[S[1]]))),F=-((L=A)[0]*(R=y[S[1]])[0]+L[1]*R[1]+L[2]*R[2]);var L,R;return A.concat(F)});return new ei(y,T)}}class ms{constructor(r,l){this.min=r,this.max=l,this.center=function(f,p,y){return f[0]=.5*p[0],f[1]=.5*p[1],f[2]=.5*p[2],f}([],function(f,p,y){return f[0]=p[0]+y[0],f[1]=p[1]+y[1],f[2]=p[2]+y[2],f}([],this.min,this.max))}quadrant(r){const l=[r%2==0,r<2],f=le(this.min),p=le(this.max);for(let y=0;y<l.length;y++)f[y]=l[y]?this.min[y]:this.center[y],p[y]=l[y]?this.center[y]:this.max[y];return p[2]=this.max[2],new ms(f,p)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}intersects(r){const l=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let f=!0;for(let p=0;p<r.planes.length;p++){const y=r.planes[p];let T=0;for(let S=0;S<l.length;S++)o.b4(y,l[S])>=0&&T++;if(T===0)return 0;T!==l.length&&(f=!1)}if(f)return 2;for(let p=0;p<3;p++){let y=Number.MAX_VALUE,T=-Number.MAX_VALUE;for(let S=0;S<r.points.length;S++){const A=r.points[S][p]-this.min[p];y=Math.min(y,A),T=Math.max(T,A)}if(T<0||y>this.max[p]-this.min[p])return 0}return 1}}class qs{constructor(r=0,l=0,f=0,p=0){if(isNaN(r)||r<0||isNaN(l)||l<0||isNaN(f)||f<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=l,this.left=f,this.right=p}interpolate(r,l,f){return l.top!=null&&r.top!=null&&(this.top=o.B.number(r.top,l.top,f)),l.bottom!=null&&r.bottom!=null&&(this.bottom=o.B.number(r.bottom,l.bottom,f)),l.left!=null&&r.left!=null&&(this.left=o.B.number(r.left,l.left,f)),l.right!=null&&r.right!=null&&(this.right=o.B.number(r.right,l.right,f)),this}getCenter(r,l){const f=o.ad((this.left+r-this.right)/2,0,r),p=o.ad((this.top+l-this.bottom)/2,0,l);return new o.P(f,p)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new qs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class qo{constructor(r,l,f,p,y){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=y===void 0||!!y,this._minZoom=r||0,this._maxZoom=l||22,this._minPitch=f??0,this._maxPitch=p??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new o.L(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new qs,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const r=new qo(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return r.apply(this),r}apply(r){this.tileSize=r.tileSize,this.latRange=r.latRange,this.width=r.width,this.height=r.height,this._center=r._center,this._elevation=r._elevation,this._minEleveationForCurrentTile=r._minEleveationForCurrentTile,this.zoom=r.zoom,this.angle=r.angle,this._fov=r._fov,this._pitch=r._pitch,this._unmodified=r._unmodified,this._edgeInsets=r._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(r){const l=-o.b5(r,-180,180)*Math.PI/180;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=function(){var f=new o.A(4);return o.A!=Float32Array&&(f[1]=0,f[2]=0),f[0]=1,f[3]=1,f}(),function(f,p,y){var T=p[0],S=p[1],A=p[2],F=p[3],L=Math.sin(y),R=Math.cos(y);f[0]=T*R+A*L,f[1]=S*R+F*L,f[2]=T*-L+A*R,f[3]=S*-L+F*R}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const l=o.ad(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=r/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(r){const l=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._zoom=l,this.tileZoom=Math.max(0,Math.floor(l)),this.scale=this.zoomScale(l),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(r){r!==this._elevation&&(this._elevation=r,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,l,f){this._unmodified=!1,this._edgeInsets.interpolate(r,l,f),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const l=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(r){const l=[new o.b6(0,r)];if(this._renderWorldCopies){const f=this.pointCoordinate(new o.P(0,0)),p=this.pointCoordinate(new o.P(this.width,0)),y=this.pointCoordinate(new o.P(this.width,this.height)),T=this.pointCoordinate(new o.P(0,this.height)),S=Math.floor(Math.min(f.x,p.x,y.x,T.x)),A=Math.floor(Math.max(f.x,p.x,y.x,T.x)),F=1;for(let L=S-F;L<=A+F;L++)L!==0&&l.push(new o.b6(L,r))}return l}coveringTiles(r){var l,f;let p=this.coveringZoomLevel(r);const y=p;if(r.minzoom!==void 0&&p<r.minzoom)return[];r.maxzoom!==void 0&&p>r.maxzoom&&(p=r.maxzoom);const T=this.pointCoordinate(this.getCameraPoint()),S=o.U.fromLngLat(this.center),A=Math.pow(2,p),F=[A*T.x,A*T.y,0],L=[A*S.x,A*S.y,0],R=ei.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,p);let W=r.minzoom||0;!r.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(W=p);const oe=r.terrain?2/Math.min(this.tileSize,r.tileSize)*this.tileSize:3,se=_e=>({aabb:new ms([_e*A,0,0],[(_e+1)*A,A,0]),zoom:0,x:0,y:0,wrap:_e,fullyVisible:!1}),de=[],ie=[],Pe=p,Ge=r.reparseOverscaled?y:p;if(this._renderWorldCopies)for(let _e=1;_e<=3;_e++)de.push(se(-_e)),de.push(se(_e));for(de.push(se(0));de.length>0;){const _e=de.pop(),Re=_e.x,Ze=_e.y;let Xe=_e.fullyVisible;if(!Xe){const Ot=_e.aabb.intersects(R);if(Ot===0)continue;Xe=Ot===2}const rt=r.terrain?F:L,mt=_e.aabb.distanceX(rt),lt=_e.aabb.distanceY(rt),vt=Math.max(Math.abs(mt),Math.abs(lt));if(_e.zoom===Pe||vt>oe+(1<<Pe-_e.zoom)-2&&_e.zoom>=W){const Ot=Pe-_e.zoom,pr=F[0]-.5-(Re<<Ot),Et=F[1]-.5-(Ze<<Ot);ie.push({tileID:new o.O(_e.zoom===Pe?Ge:_e.zoom,_e.wrap,_e.zoom,Re,Ze),distanceSq:ae([L[0]-.5-Re,L[1]-.5-Ze]),tileDistanceToCamera:Math.sqrt(pr*pr+Et*Et)})}else for(let Ot=0;Ot<4;Ot++){const pr=(Re<<1)+Ot%2,Et=(Ze<<1)+(Ot>>1),qt=_e.zoom+1;let zt=_e.aabb.quadrant(Ot);if(r.terrain){const Rr=new o.O(qt,_e.wrap,qt,pr,Et),dr=r.terrain.getMinMaxElevation(Rr),sr=(l=dr.minElevation)!==null&&l!==void 0?l:this.elevation,mr=(f=dr.maxElevation)!==null&&f!==void 0?f:this.elevation;zt=new ms([zt.min[0],zt.min[1],sr],[zt.max[0],zt.max[1],mr])}de.push({aabb:zt,zoom:qt,x:pr,y:Et,wrap:_e.wrap,fullyVisible:Xe})}}return ie.sort((_e,Re)=>_e.distanceSq-Re.distanceSq).map(_e=>_e.tileID)}resize(r,l){this.width=r,this.height=l,this.pixelsToGLUnits=[2/r,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const l=o.ad(r.lat,-this.maxValidLatitude,this.maxValidLatitude);return new o.P(o.G(r.lng)*this.worldSize,o.H(l)*this.worldSize)}unproject(r){return new o.U(r.x/this.worldSize,r.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(r){const l=this.pointLocation(this.centerPoint,r),f=r.getElevationForLngLatZoom(l,this.tileZoom);if(!(this.elevation-f))return;const p=this.getCameraPosition(),y=o.U.fromLngLat(p.lngLat,p.altitude),T=o.U.fromLngLat(l,f),S=y.x-T.x,A=y.y-T.y,F=y.z-T.z,L=Math.sqrt(S*S+A*A+F*F),R=this.scaleZoom(this.cameraToCenterDistance/L/this.tileSize);this._elevation=f,this._center=l,this.zoom=R}setLocationAtPoint(r,l){const f=this.pointCoordinate(l),p=this.pointCoordinate(this.centerPoint),y=this.locationCoordinate(r),T=new o.U(y.x-(f.x-p.x),y.y-(f.y-p.y));this.center=this.coordinateLocation(T),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(r,l){return l?this.coordinatePoint(this.locationCoordinate(r),l.getElevationForLngLatZoom(r,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(r))}pointLocation(r,l){return this.coordinateLocation(this.pointCoordinate(r,l))}locationCoordinate(r){return o.U.fromLngLat(r)}coordinateLocation(r){return r&&r.toLngLat()}pointCoordinate(r,l){if(l){const W=l.pointCoordinate(r);if(W!=null)return W}const f=[r.x,r.y,0,1],p=[r.x,r.y,1,1];o.ag(f,f,this.pixelMatrixInverse),o.ag(p,p,this.pixelMatrixInverse);const y=f[3],T=p[3],S=f[1]/y,A=p[1]/T,F=f[2]/y,L=p[2]/T,R=F===L?0:(0-F)/(L-F);return new o.U(o.B.number(f[0]/y,p[0]/T,R)/this.worldSize,o.B.number(S,A,R)/this.worldSize)}coordinatePoint(r,l=0,f=this.pixelMatrix){const p=[r.x*this.worldSize,r.y*this.worldSize,l,1];return o.ag(p,p,f),new o.P(p[0]/p[3],p[1]/p[3])}getBounds(){const r=Math.max(0,this.height/2-this.getHorizon());return new Te().extend(this.pointLocation(new o.P(0,r))).extend(this.pointLocation(new o.P(this.width,r))).extend(this.pointLocation(new o.P(this.width,this.height))).extend(this.pointLocation(new o.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Te([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(r){r?(this.lngRange=[r.getWest(),r.getEast()],this.latRange=[r.getSouth(),r.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(r,l=!1){const f=r.key,p=l?this._alignedPosMatrixCache:this._posMatrixCache;if(p[f])return p[f];const y=r.canonical,T=this.worldSize/this.zoomScale(y.z),S=y.x+Math.pow(2,y.z)*r.wrap,A=o.ao(new Float64Array(16));return o.$(A,A,[S*T,y.y*T,0]),o.a0(A,A,[T/o.N,T/o.N,1]),o.a1(A,l?this.alignedProjMatrix:this.projMatrix,A),p[f]=new Float32Array(A),p[f]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let r,l,f,p,y=-90,T=90,S=-180,A=180;const F=this.size,L=this._unmodified;if(this.latRange){const oe=this.latRange;y=o.H(oe[1])*this.worldSize,T=o.H(oe[0])*this.worldSize,r=T-y<F.y?F.y/(T-y):0}if(this.lngRange){const oe=this.lngRange;S=o.b5(o.G(oe[0])*this.worldSize,0,this.worldSize),A=o.b5(o.G(oe[1])*this.worldSize,0,this.worldSize),A<S&&(A+=this.worldSize),l=A-S<F.x?F.x/(A-S):0}const R=this.point,W=Math.max(l||0,r||0);if(W)return this.center=this.unproject(new o.P(l?(A+S)/2:R.x,r?(T+y)/2:R.y)),this.zoom+=this.scaleZoom(W),this._unmodified=L,void(this._constraining=!1);if(this.latRange){const oe=R.y,se=F.y/2;oe-se<y&&(p=y+se),oe+se>T&&(p=T-se)}if(this.lngRange){const oe=(S+A)/2,se=o.b5(R.x,oe-this.worldSize/2,oe+this.worldSize/2),de=F.x/2;se-de<S&&(f=S+de),se+de>A&&(f=A-de)}f===void 0&&p===void 0||(this.center=this.unproject(new o.P(f!==void 0?f:R.x,p!==void 0?p:R.y)).wrap()),this._unmodified=L,this._constraining=!1}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,l=this.point.x,f=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=o.b7(1,this.center.lat)*this.worldSize;let p=o.ao(new Float64Array(16));o.a0(p,p,[this.width/2,-this.height/2,1]),o.$(p,p,[1,-1,0]),this.labelPlaneMatrix=p,p=o.ao(new Float64Array(16)),o.a0(p,p,[1,-1,1]),o.$(p,p,[-1,-1,0]),o.a0(p,p,[2/this.width,2/this.height,1]),this.glCoordMatrix=p;const y=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),T=Math.min(this.elevation,this._minEleveationForCurrentTile),S=y-T*this._pixelPerMeter/Math.cos(this._pitch),A=T<0?S:y,F=Math.PI/2+this._pitch,L=this._fov*(.5+r.y/this.height),R=Math.sin(L)*A/Math.sin(o.ad(Math.PI-F-L,.01,Math.PI-.01)),W=this.getHorizon(),oe=2*Math.atan(W/this.cameraToCenterDistance)*(.5+r.y/(2*W)),se=Math.sin(oe)*A/Math.sin(o.ad(Math.PI-F-oe,.01,Math.PI-.01)),de=Math.min(R,se),ie=1.01*(Math.cos(Math.PI/2-this._pitch)*de+A),Pe=this.height/50;p=new Float64Array(16),o.b8(p,this._fov,this.width/this.height,Pe,ie),p[8]=2*-r.x/this.width,p[9]=2*r.y/this.height,o.a0(p,p,[1,-1,1]),o.$(p,p,[0,0,-this.cameraToCenterDistance]),o.b9(p,p,this._pitch),o.ae(p,p,this.angle),o.$(p,p,[-l,-f,0]),this.mercatorMatrix=o.a0([],p,[this.worldSize,this.worldSize,this.worldSize]),o.a0(p,p,[1,1,this._pixelPerMeter]),this.pixelMatrix=o.a1(new Float64Array(16),this.labelPlaneMatrix,p),o.$(p,p,[0,0,-this.elevation]),this.projMatrix=p,this.invProjMatrix=o.as([],p),this.pixelMatrix3D=o.a1(new Float64Array(16),this.labelPlaneMatrix,p);const Ge=this.width%2/2,_e=this.height%2/2,Re=Math.cos(this.angle),Ze=Math.sin(this.angle),Xe=l-Math.round(l)+Re*Ge+Ze*_e,rt=f-Math.round(f)+Re*_e+Ze*Ge,mt=new Float64Array(p);if(o.$(mt,mt,[Xe>.5?Xe-1:Xe,rt>.5?rt-1:rt,0]),this.alignedProjMatrix=mt,p=o.as(new Float64Array(16),this.pixelMatrix),!p)throw new Error("failed to invert matrix");this.pixelMatrixInverse=p,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const r=this.pointCoordinate(new o.P(0,0)),l=[r.x*this.worldSize,r.y*this.worldSize,0,1];return o.ag(l,l,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,r))}getCameraQueryGeometry(r){const l=this.getCameraPoint();if(r.length===1)return[r[0],l];{let f=l.x,p=l.y,y=l.x,T=l.y;for(const S of r)f=Math.min(f,S.x),p=Math.min(p,S.y),y=Math.max(y,S.x),T=Math.max(T,S.y);return[new o.P(f,p),new o.P(y,p),new o.P(y,T),new o.P(f,T),new o.P(f,p)]}}}function Wn(g,r){let l,f=!1,p=null,y=null;const T=()=>{p=null,f&&(g.apply(y,l),p=setTimeout(T,r),f=!1)};return(...S)=>(f=!0,y=this,l=S,p||T(),p)}class Zs{constructor(r){this._getCurrentHash=()=>{const l=window.location.hash.replace("#","");if(this._hashName){let f;return l.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(f=p)}),(f&&f[1]||"").split("/")}return l.split("/")},this._onHashChange=()=>{const l=this._getCurrentHash();if(l.length>=3&&!l.some(f=>isNaN(f))){const f=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(l[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:f,pitch:+(l[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const l=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,l)}catch{}},this._updateHash=Wn(this._updateHashUnthrottled,300),this._hashName=r&&encodeURIComponent(r)}addTo(r){return this._map=r,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(r){const l=this._map.getCenter(),f=Math.round(100*this._map.getZoom())/100,p=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,p),T=Math.round(l.lng*y)/y,S=Math.round(l.lat*y)/y,A=this._map.getBearing(),F=this._map.getPitch();let L="";if(L+=r?`/${T}/${S}/${f}`:`${f}/${S}/${T}`,(A||F)&&(L+="/"+Math.round(10*A)/10),F&&(L+=`/${Math.round(F)}`),this._hashName){const R=this._hashName;let W=!1;const oe=window.location.hash.slice(1).split("&").map(se=>{const de=se.split("=")[0];return de===R?(W=!0,`${de}=${L}`):se}).filter(se=>se);return W||oe.push(`${R}=${L}`),`#${oe.join("&")}`}return`#${L}`}}const gs={linearity:.3,easing:o.ba(0,0,.3,1)},Cu=o.e({deceleration:2500,maxSpeed:1400},gs),Au=o.e({deceleration:20,maxSpeed:1400},gs),Iu=o.e({deceleration:1e3,maxSpeed:360},gs),Fu=o.e({deceleration:1e3,maxSpeed:90},gs);class Pu{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.h.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,l=o.h.now();for(;r.length>0&&l-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const l={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)l.zoom+=y.zoomDelta||0,l.bearing+=y.bearingDelta||0,l.pitch+=y.pitchDelta||0,y.panDelta&&l.pan._add(y.panDelta),y.around&&(l.around=y.around),y.pinchAround&&(l.pinchAround=y.pinchAround);const f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(l.pan.mag()){const y=Xs(l.pan.mag(),f,o.e({},Cu,r||{}));p.offset=l.pan.mult(y.amount/l.pan.mag()),p.center=this._map.transform.center,Xi(p,y)}if(l.zoom){const y=Xs(l.zoom,f,Au);p.zoom=this._map.transform.zoom+y.amount,Xi(p,y)}if(l.bearing){const y=Xs(l.bearing,f,Iu);p.bearing=this._map.transform.bearing+o.ad(y.amount,-179,179),Xi(p,y)}if(l.pitch){const y=Xs(l.pitch,f,Fu);p.pitch=this._map.transform.pitch+y.amount,Xi(p,y)}if(p.zoom||p.bearing){const y=l.pinchAround===void 0?l.around:l.pinchAround;p.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),o.e(p,{noMoveStart:!0})}}function Xi(g,r){(!g.duration||g.duration<r.duration)&&(g.duration=r.duration,g.easing=r.easing)}function Xs(g,r,l){const{maxSpeed:f,linearity:p,deceleration:y}=l,T=o.ad(g*p/(r/1e3),-f,f),S=Math.abs(T)/(y*p);return{easing:l.easing,duration:1e3*S,amount:T*(S/2)}}class xi extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,f,p={}){const y=w.mousePos(l.getCanvasContainer(),f),T=l.unproject(y);super(r,o.e({point:y,lngLat:T,originalEvent:f},p)),this._defaultPrevented=!1,this.target=l}}class Ks extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,f){const p=r==="touchend"?f.changedTouches:f.touches,y=w.touchPos(l.getCanvasContainer(),p),T=y.map(A=>l.unproject(A)),S=y.reduce((A,F,L,R)=>A.add(F.div(R.length)),new o.P(0,0));super(r,{points:y,point:S,lngLats:T,lngLat:l.unproject(S),originalEvent:f}),this._defaultPrevented=!1}}class Mu extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,f){super(r,{originalEvent:f}),this._defaultPrevented=!1}}class Du{constructor(r,l){this._map=r,this._clickTolerance=l.clickTolerance}reset(){delete this._mousedownPos}wheel(r){return this._firePreventable(new Mu(r.type,this._map,r))}mousedown(r,l){return this._mousedownPos=l,this._firePreventable(new xi(r.type,this._map,r))}mouseup(r){this._map.fire(new xi(r.type,this._map,r))}click(r,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||this._map.fire(new xi(r.type,this._map,r))}dblclick(r){return this._firePreventable(new xi(r.type,this._map,r))}mouseover(r){this._map.fire(new xi(r.type,this._map,r))}mouseout(r){this._map.fire(new xi(r.type,this._map,r))}touchstart(r){return this._firePreventable(new Ks(r.type,this._map,r))}touchmove(r){this._map.fire(new Ks(r.type,this._map,r))}touchend(r){this._map.fire(new Ks(r.type,this._map,r))}touchcancel(r){this._map.fire(new Ks(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Lu{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(r){this._map.fire(new xi(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new xi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._ignoreContextMenu||this._map.fire(new xi(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class hn{constructor(r){this._map=r}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(r){return this.transform.pointLocation(o.P.convert(r),this._map.terrain)}}class Ru{constructor(r,l){this._map=r,this._tr=new hn(r),this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,l){this.isEnabled()&&r.shiftKey&&r.button===0&&(w.disableDrag(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(r,l){if(!this._active)return;const f=l;if(this._lastPos.equals(f)||!this._box&&f.dist(this._startPos)<this._clickTolerance)return;const p=this._startPos;this._lastPos=f,this._box||(this._box=w.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",r));const y=Math.min(p.x,f.x),T=Math.max(p.x,f.x),S=Math.min(p.y,f.y),A=Math.max(p.y,f.y);w.setTransform(this._box,`translate(${y}px,${S}px)`),this._box.style.width=T-y+"px",this._box.style.height=A-S+"px"}mouseupWindow(r,l){if(!this._active||r.button!==0)return;const f=this._startPos,p=l;if(this.reset(),w.suppressClick(),f.x!==p.x||f.y!==p.y)return this._map.fire(new o.k("boxzoomend",{originalEvent:r})),{cameraAnimation:y=>y.fitScreenCoordinates(f,p,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",r)}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(w.remove(this._box),this._box=null),w.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(r,l){return this._map.fire(new o.k(r,{originalEvent:l}))}}function Li(g,r){if(g.length!==r.length)throw new Error(`The number of touches and points are not equal - touches ${g.length}, points ${r.length}`);const l={};for(let f=0;f<g.length;f++)l[g[f].identifier]=r[f];return l}class fn{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(r,l,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=r.timeStamp),f.length===this.numTouches&&(this.centroid=function(p){const y=new o.P(0,0);for(const T of p)y._add(T);return y.div(p.length)}(l),this.touches=Li(f,l)))}touchmove(r,l,f){if(this.aborted||!this.centroid)return;const p=Li(f,l);for(const y in this.touches){const T=p[y];(!T||T.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(r,l,f){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){const p=!this.aborted&&this.centroid;if(this.reset(),p)return p}}}class Zo{constructor(r){this.singleTap=new fn(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(r,l,f){this.singleTap.touchstart(r,l,f)}touchmove(r,l,f){this.singleTap.touchmove(r,l,f)}touchend(r,l,f){const p=this.singleTap.touchend(r,l,f);if(p){const y=r.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(p)<30;if(y&&T||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}}}class dn{constructor(r){this._tr=new hn(r),this._zoomIn=new Zo({numTouches:1,numTaps:2}),this._zoomOut=new Zo({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,l,f){this._zoomIn.touchstart(r,l,f),this._zoomOut.touchstart(r,l,f)}touchmove(r,l,f){this._zoomIn.touchmove(r,l,f),this._zoomOut.touchmove(r,l,f)}touchend(r,l,f){const p=this._zoomIn.touchend(r,l,f),y=this._zoomOut.touchend(r,l,f),T=this._tr;return p?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:T.zoom+1,around:T.unproject(p)},{originalEvent:r})}):y?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:T.zoom-1,around:T.unproject(y)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class pn{constructor(r){this._enabled=!!r.enable,this._moveStateManager=r.moveStateManager,this._clickTolerance=r.clickTolerance||1,this._moveFunction=r.move,this._activateOnStart=!!r.activateOnStart,r.assignEvents(this),this.reset()}reset(r){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(r)}_move(...r){const l=this._moveFunction(...r);if(l.bearingDelta||l.pitchDelta||l.around||l.panDelta)return this._active=!0,l}dragStart(r,l){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(r)&&(this._moveStateManager.startMove(r),this._lastPoint=l.length?l[0]:l,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(r,l){if(!this.isEnabled())return;const f=this._lastPoint;if(!f)return;if(r.preventDefault(),!this._moveStateManager.isValidMoveEvent(r))return void this.reset(r);const p=l.length?l[0]:l;return!this._moved&&p.dist(f)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=p,this._move(f,p))}dragEnd(r){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(r)&&(this._moved&&w.suppressClick(),this.reset(r))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const cf={0:1,2:2};class ql{constructor(r){this._correctEvent=r.checkCorrectEvent}startMove(r){const l=w.mouseButton(r);this._eventButton=l}endMove(r){delete this._eventButton}isValidStartEvent(r){return this._correctEvent(r)}isValidMoveEvent(r){return!function(l,f){const p=cf[f];return l.buttons===void 0||(l.buttons&p)!==p}(r,this._eventButton)}isValidEndEvent(r){return w.mouseButton(r)===this._eventButton}}class Ou{constructor(){this._firstTouch=void 0}_isOneFingerTouch(r){return r.targetTouches.length===1}_isSameTouchEvent(r){return r.targetTouches[0].identifier===this._firstTouch}startMove(r){this._firstTouch=r.targetTouches[0].identifier}endMove(r){delete this._firstTouch}isValidStartEvent(r){return this._isOneFingerTouch(r)}isValidMoveEvent(r){return this._isOneFingerTouch(r)&&this._isSameTouchEvent(r)}isValidEndEvent(r){return this._isOneFingerTouch(r)&&this._isSameTouchEvent(r)}}const Xo=g=>{g.mousedown=g.dragStart,g.mousemoveWindow=g.dragMove,g.mouseup=g.dragEnd,g.contextmenu=function(r){r.preventDefault()}},xs=({enable:g,clickTolerance:r,bearingDegreesPerPixelMoved:l=.8})=>{const f=new ql({checkCorrectEvent:p=>w.mouseButton(p)===0&&p.ctrlKey||w.mouseButton(p)===2});return new pn({clickTolerance:r,move:(p,y)=>({bearingDelta:(y.x-p.x)*l}),moveStateManager:f,enable:g,assignEvents:Xo})},mn=({enable:g,clickTolerance:r,pitchDegreesPerPixelMoved:l=-.5})=>{const f=new ql({checkCorrectEvent:p=>w.mouseButton(p)===0&&p.ctrlKey||w.mouseButton(p)===2});return new pn({clickTolerance:r,move:(p,y)=>({pitchDelta:(y.y-p.y)*l}),moveStateManager:f,enable:g,assignEvents:Xo})};class Dt{constructor(r,l){this._minTouches=r.cooperativeGestures?2:1,this._clickTolerance=r.clickTolerance||1,this._map=l,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(r,l,f){return this._calculateTransform(r,l,f)}touchmove(r,l,f){if(this._map._cooperativeGestures&&(this._minTouches===2&&f.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(r,!1,f.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(f.length<this._minTouches))return r.preventDefault(),this._calculateTransform(r,l,f)}touchend(r,l,f){this._calculateTransform(r,l,f),this._active&&f.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,l,f){f.length>0&&(this._active=!0);const p=Li(f,l),y=new o.P(0,0),T=new o.P(0,0);let S=0;for(const F in p){const L=p[F],R=this._touches[F];R&&(y._add(L),T._add(L.sub(R)),S++,p[F]=L)}if(this._touches=p,S<this._minTouches||!T.mag())return;const A=T.div(S);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(S),panDelta:A}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ko{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(r,l,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([l[0],l[1]]))}touchmove(r,l,f){if(!this._firstTwoTouches)return;r.preventDefault();const[p,y]=this._firstTwoTouches,T=Pn(f,l,p),S=Pn(f,l,y);if(!T||!S)return;const A=this._aroundCenter?null:T.add(S).div(2);return this._move([T,S],A,r)}touchend(r,l,f){if(!this._firstTwoTouches)return;const[p,y]=this._firstTwoTouches,T=Pn(f,l,p),S=Pn(f,l,y);T&&S||(this._active&&w.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Pn(g,r,l){for(let f=0;f<g.length;f++)if(g[f].identifier===l)return r[f]}function _s(g,r){return Math.log(g/r)/Math.LN2}class Bu extends Ko{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,l){const f=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(_s(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:_s(this._distance,f),pinchAround:l}}}function Ct(g,r){return 180*g.angleWith(r)/Math.PI}class Zl extends Ko{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,l){const f=this._vector;if(this._vector=r[0].sub(r[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Ct(this._vector,f),pinchAround:l}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const l=25/(Math.PI*this._minDiameter)*360,f=Ct(r,this._startVector);return Math.abs(f)<l}}function Xl(g){return Math.abs(g.y)>Math.abs(g.x)}class uf extends Ko{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(r,l,f){super.touchstart(r,l,f),this._currentTouchCount=f.length}_start(r){this._lastPoints=r,Xl(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,l,f){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const p=r[0].sub(this._lastPoints[0]),y=r[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(p,y,f.timeStamp),this._valid?(this._lastPoints=r,this._active=!0,{pitchDelta:(p.y+y.y)/2*-.5}):void 0}gestureBeginsVertically(r,l,f){if(this._valid!==void 0)return this._valid;const p=r.mag()>=2,y=l.mag()>=2;if(!p&&!y)return;if(!p||!y)return this._firstMove===void 0&&(this._firstMove=f),f-this._firstMove<100&&void 0;const T=r.y>0==l.y>0;return Xl(r)&&Xl(l)&&T}}const Kl={panStep:100,bearingStep:15,pitchStep:10};class zu{constructor(r){this._tr=new hn(r);const l=Kl;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let l=0,f=0,p=0,y=0,T=0;switch(r.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:r.shiftKey?f=-1:(r.preventDefault(),y=-1);break;case 39:r.shiftKey?f=1:(r.preventDefault(),y=1);break;case 38:r.shiftKey?p=1:(r.preventDefault(),T=-1);break;case 40:r.shiftKey?p=-1:(r.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(f=0,p=0),{cameraAnimation:S=>{const A=this._tr;S.easeTo({duration:300,easeId:"keyboardHandler",easing:Nu,zoom:l?Math.round(A.zoom)+l*(r.shiftKey?2:1):A.zoom,bearing:A.bearing+f*this._bearingStep,pitch:A.pitch+p*this._pitchStep,offset:[-y*this._panStep,-T*this._panStep],center:A.center},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Nu(g){return g*(2-g)}const Uu=4.000244140625;class hf{constructor(r,l){this._onTimeout=f=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(f)},this._map=r,this._tr=new hn(r),this._el=r.getCanvasContainer(),this._triggerRenderFrame=l,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&r.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!r[this._map._metaKey])return;r.preventDefault()}let l=r.deltaMode===WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const f=o.h.now(),p=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,l!==0&&l%Uu==0?this._type="wheel":l!==0&&Math.abs(l)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=l,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(p*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),r.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=r,this._delta-=l,this._active||this._start(r)),r.preventDefault()}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=w.mousePos(this._el,r),f=this._tr;this._around=o.L.convert(this._aroundCenter?f.center:f.unproject(l)),this._aroundPoint=f.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._tr.transform;if(this._delta!==0){const S=this._type==="wheel"&&Math.abs(this._delta)>Uu?this._wheelZoomRate:this._defaultZoomRate;let A=2/(1+Math.exp(-Math.abs(this._delta*S)));this._delta<0&&A!==0&&(A=1/A);const F=typeof this._targetZoom=="number"?r.zoomScale(this._targetZoom):r.scale;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(F*A))),this._type==="wheel"&&(this._startZoom=r.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const l=typeof this._targetZoom=="number"?this._targetZoom:r.zoom,f=this._startZoom,p=this._easing;let y,T=!1;if(this._type==="wheel"&&f&&p){const S=Math.min((o.h.now()-this._lastWheelEventTime)/200,1),A=p(S);y=o.B.number(f,l,A),S<1?this._frameId||(this._frameId=!0):T=!0}else y=l,T=!0;return this._active=!0,T&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!T,zoomDelta:y-r.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let l=o.bb;if(this._prevEase){const f=this._prevEase,p=(o.h.now()-f.start)/f.duration,y=f.easing(p+.01)-f.easing(p),T=.27/Math.sqrt(y*y+1e-4)*.01,S=Math.sqrt(.0729-T*T);l=o.ba(T,S,.25,1)}return this._prevEase={start:o.h.now(),duration:r,easing:l},l}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Yl{constructor(r,l){this._clickZoom=r,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Jl{constructor(r){this._tr=new hn(r),this.reset()}reset(){this._active=!1}dblclick(r,l){return r.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:this._tr.zoom+(r.shiftKey?-1:1),around:this._tr.unproject(l)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ql{constructor(){this._tap=new Zo({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(r,l,f){if(!this._swipePoint)if(this._tapTime){const p=l[0],y=r.timeStamp-this._tapTime<500,T=this._tapPoint.dist(p)<30;y&&T?f.length>0&&(this._swipePoint=p,this._swipeTouch=f[0].identifier):this.reset()}else this._tap.touchstart(r,l,f)}touchmove(r,l,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;const p=l[0],y=p.y-this._swipePoint.y;return this._swipePoint=p,r.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(r,l,f)}touchend(r,l,f){if(this._tapTime)this._swipePoint&&f.length===0&&this.reset();else{const p=this._tap.touchend(r,l,f);p&&(this._tapTime=r.timeStamp,this._tapPoint=p)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ec{constructor(r,l,f){this._el=r,this._mousePan=l,this._touchPan=f}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ti{constructor(r,l,f){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=l,this._mousePitch=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Mn{constructor(r,l,f,p){this._el=r,this._touchZoom=l,this._touchRotate=f,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ys=g=>g.zoom||g.drag||g.pitch||g.rotate;class tc extends o.k{}function Js(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta}class rc{constructor(r,l){this.handleWindowEvent=p=>{this.handleEvent(p,`${p.type}Window`)},this.handleEvent=(p,y)=>{if(p.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const T=p.type==="renderFrame"?void 0:p,S={needsRenderFrame:!1},A={},F={},L=p.touches,R=L?this._getMapTouches(L):void 0,W=R?w.touchPos(this._el,R):w.mousePos(this._el,p);for(const{handlerName:de,handler:ie,allowed:Pe}of this._handlers){if(!ie.isEnabled())continue;let Ge;this._blockedByActive(F,Pe,de)?ie.reset():ie[y||p.type]&&(Ge=ie[y||p.type](p,W,R),this.mergeHandlerResult(S,A,Ge,de,T),Ge&&Ge.needsRenderFrame&&this._triggerRenderFrame()),(Ge||ie.isActive())&&(F[de]=ie)}const oe={};for(const de in this._previousActiveHandlers)F[de]||(oe[de]=T);this._previousActiveHandlers=F,(Object.keys(oe).length||Js(S))&&(this._changes.push([S,A,oe]),this._triggerRenderFrame()),(Object.keys(F).length||Js(S))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:se}=S;se&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],se(this._map))},this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Pu(r),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(l);const f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[window,"blur",void 0]];for(const[p,y,T]of this._listeners)w.addEventListener(p,y,p===document?this.handleWindowEvent:this.handleEvent,T)}destroy(){for(const[r,l,f]of this._listeners)w.removeEventListener(r,l,r===document?this.handleWindowEvent:this.handleEvent,f)}_addDefaultHandlers(r){const l=this._map,f=l.getCanvasContainer();this._add("mapEvent",new Du(l,r));const p=l.boxZoom=new Ru(l,r);this._add("boxZoom",p),r.interactive&&r.boxZoom&&p.enable();const y=new dn(l),T=new Jl(l);l.doubleClickZoom=new Yl(T,y),this._add("tapZoom",y),this._add("clickZoom",T),r.interactive&&r.doubleClickZoom&&l.doubleClickZoom.enable();const S=new Ql;this._add("tapDragZoom",S);const A=l.touchPitch=new uf(l);this._add("touchPitch",A),r.interactive&&r.touchPitch&&l.touchPitch.enable(r.touchPitch);const F=xs(r),L=mn(r);l.dragRotate=new ti(r,F,L),this._add("mouseRotate",F,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]),r.interactive&&r.dragRotate&&l.dragRotate.enable();const R=(({enable:Pe,clickTolerance:Ge})=>{const _e=new ql({checkCorrectEvent:Re=>w.mouseButton(Re)===0&&!Re.ctrlKey});return new pn({clickTolerance:Ge,move:(Re,Ze)=>({around:Ze,panDelta:Ze.sub(Re)}),activateOnStart:!0,moveStateManager:_e,enable:Pe,assignEvents:Xo})})(r),W=new Dt(r,l);l.dragPan=new ec(f,R,W),this._add("mousePan",R),this._add("touchPan",W,["touchZoom","touchRotate"]),r.interactive&&r.dragPan&&l.dragPan.enable(r.dragPan);const oe=new Zl,se=new Bu;l.touchZoomRotate=new Mn(f,se,oe,S),this._add("touchRotate",oe,["touchPan","touchZoom"]),this._add("touchZoom",se,["touchPan","touchRotate"]),r.interactive&&r.touchZoomRotate&&l.touchZoomRotate.enable(r.touchZoomRotate);const de=l.scrollZoom=new hf(l,()=>this._triggerRenderFrame());this._add("scrollZoom",de,["mousePan"]),r.interactive&&r.scrollZoom&&l.scrollZoom.enable(r.scrollZoom);const ie=l.keyboard=new zu(l);this._add("keyboard",ie),r.interactive&&r.keyboard&&l.keyboard.enable(),this._add("blockableMapEvent",new Lu(l))}_add(r,l,f){this._handlers.push({handlerName:r,handler:l,allowed:f}),this._handlersById[r]=l}stop(r){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[]}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ys(this._eventsInProgress)||this.isZooming()}_blockedByActive(r,l,f){for(const p in r)if(p!==f&&(!l||l.indexOf(p)<0))return!0;return!1}_getMapTouches(r){const l=[];for(const f of r)this._el.contains(f.target)&&l.push(f);return l}mergeHandlerResult(r,l,f,p,y){if(!f)return;o.e(r,f);const T={handlerName:p,originalEvent:f.originalEvent||y};f.zoomDelta!==void 0&&(l.zoom=T),f.panDelta!==void 0&&(l.drag=T),f.pitchDelta!==void 0&&(l.pitch=T),f.bearingDelta!==void 0&&(l.rotate=T)}_applyChanges(){const r={},l={},f={};for(const[p,y,T]of this._changes)p.panDelta&&(r.panDelta=(r.panDelta||new o.P(0,0))._add(p.panDelta)),p.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+p.pitchDelta),p.around!==void 0&&(r.around=p.around),p.pinchAround!==void 0&&(r.pinchAround=p.pinchAround),p.noInertia&&(r.noInertia=p.noInertia),o.e(l,y),o.e(f,T);this._updateMapTransform(r,l,f),this._changes=[]}_updateMapTransform(r,l,f){const p=this._map,y=p._getTransformForUpdate(),T=p.terrain;if(!(Js(r)||T&&this._terrainMovement))return this._fireEvents(l,f,!0);let{panDelta:S,zoomDelta:A,bearingDelta:F,pitchDelta:L,around:R,pinchAround:W}=r;W!==void 0&&(R=W),p._stop(!0),R=R||p.transform.centerPoint;const oe=y.pointLocation(S?R.sub(S):R);F&&(y.bearing+=F),L&&(y.pitch+=L),A&&(y.zoom+=A),T?this._terrainMovement||!l.drag&&!l.zoom?l.drag&&this._terrainMovement?y.center=y.pointLocation(y.centerPoint.sub(S)):y.setLocationAtPoint(oe,R):(this._terrainMovement=!0,this._map._elevationFreeze=!0,y.setLocationAtPoint(oe,R),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,y.recalculateZoom(p.terrain)})):y.setLocationAtPoint(oe,R),p._applyUpdatedTransform(y),this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(l,f,!0)}_fireEvents(r,l,f){const p=Ys(this._eventsInProgress),y=Ys(r),T={};for(const L in r){const{originalEvent:R}=r[L];this._eventsInProgress[L]||(T[`${L}start`]=R),this._eventsInProgress[L]=r[L]}!p&&y&&this._fireEvent("movestart",y.originalEvent);for(const L in T)this._fireEvent(L,T[L]);y&&this._fireEvent("move",y.originalEvent);for(const L in r){const{originalEvent:R}=r[L];this._fireEvent(L,R)}const S={};let A;for(const L in this._eventsInProgress){const{handlerName:R,originalEvent:W}=this._eventsInProgress[L];this._handlersById[R].isActive()||(delete this._eventsInProgress[L],A=l[R]||W,S[`${L}end`]=A)}for(const L in S)this._fireEvent(L,S[L]);const F=Ys(this._eventsInProgress);if(f&&(p||y)&&!F){this._updatingCamera=!0;const L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),R=W=>W!==0&&-this._bearingSnap<W&&W<this._bearingSnap;!L||!L.essential&&o.h.prefersReducedMotion?(this._map.fire(new o.k("moveend",{originalEvent:A})),R(this._map.getBearing())&&this._map.resetNorth()):(R(L.bearing||this._map.getBearing())&&(L.bearing=0),L.freezeElevation=!0,this._map.easeTo(L,{originalEvent:A})),this._updatingCamera=!1}}_fireEvent(r,l){this._map.fire(new o.k(r,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{delete this._frameId,this.handleEvent(new tc("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Vu extends o.E{constructor(r,l){super(),this._renderFrameCallback=()=>{const f=Math.min((o.h.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(f)),f<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=l.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new o.L(this.transform.center.lng,this.transform.center.lat)}setCenter(r,l){return this.jumpTo({center:r},l)}panBy(r,l,f){return r=o.P.convert(r).mult(-1),this.panTo(this.transform.center,o.e({offset:r},l),f)}panTo(r,l,f){return this.easeTo(o.e({center:r},l),f)}getZoom(){return this.transform.zoom}setZoom(r,l){return this.jumpTo({zoom:r},l),this}zoomTo(r,l,f){return this.easeTo(o.e({zoom:r},l),f)}zoomIn(r,l){return this.zoomTo(this.getZoom()+1,r,l),this}zoomOut(r,l){return this.zoomTo(this.getZoom()-1,r,l),this}getBearing(){return this.transform.bearing}setBearing(r,l){return this.jumpTo({bearing:r},l),this}getPadding(){return this.transform.padding}setPadding(r,l){return this.jumpTo({padding:r},l),this}rotateTo(r,l,f){return this.easeTo(o.e({bearing:r},l),f)}resetNorth(r,l){return this.rotateTo(0,o.e({duration:1e3},r),l),this}resetNorthPitch(r,l){return this.easeTo(o.e({bearing:0,pitch:0,duration:1e3},r),l),this}snapToNorth(r,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,l):this}getPitch(){return this.transform.pitch}setPitch(r,l){return this.jumpTo({pitch:r},l),this}cameraForBounds(r,l){r=Te.convert(r);const f=l&&l.bearing||0;return this._cameraForBoxAndBearing(r.getNorthWest(),r.getSouthEast(),f,l)}_cameraForBoxAndBearing(r,l,f,p){const y={top:0,bottom:0,right:0,left:0};if(typeof(p=o.e({padding:y,offset:[0,0],maxZoom:this.transform.maxZoom},p)).padding=="number"){const Ze=p.padding;p.padding={top:Ze,bottom:Ze,right:Ze,left:Ze}}p.padding=o.e(y,p.padding);const T=this.transform,S=T.padding,A=T.project(o.L.convert(r)),F=T.project(o.L.convert(l)),L=A.rotate(-f*Math.PI/180),R=F.rotate(-f*Math.PI/180),W=new o.P(Math.max(L.x,R.x),Math.max(L.y,R.y)),oe=new o.P(Math.min(L.x,R.x),Math.min(L.y,R.y)),se=W.sub(oe),de=(T.width-(S.left+S.right+p.padding.left+p.padding.right))/se.x,ie=(T.height-(S.top+S.bottom+p.padding.top+p.padding.bottom))/se.y;if(ie<0||de<0)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Pe=Math.min(T.scaleZoom(T.scale*Math.min(de,ie)),p.maxZoom),Ge=o.P.convert(p.offset),_e=new o.P((p.padding.left-p.padding.right)/2,(p.padding.top-p.padding.bottom)/2).rotate(f*Math.PI/180),Re=Ge.add(_e).mult(T.scale/T.zoomScale(Pe));return{center:T.unproject(A.add(F).div(2).sub(Re)),zoom:Pe,bearing:f}}fitBounds(r,l,f){return this._fitInternal(this.cameraForBounds(r,l),l,f)}fitScreenCoordinates(r,l,f,p,y){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(o.P.convert(r)),this.transform.pointLocation(o.P.convert(l)),f,p),p,y)}_fitInternal(r,l,f){return r?(delete(l=o.e(r,l)).padding,l.linear?this.easeTo(l,f):this.flyTo(l,f)):this}jumpTo(r,l){this.stop();const f=this._getTransformForUpdate();let p=!1,y=!1,T=!1;return"zoom"in r&&f.zoom!==+r.zoom&&(p=!0,f.zoom=+r.zoom),r.center!==void 0&&(f.center=o.L.convert(r.center)),"bearing"in r&&f.bearing!==+r.bearing&&(y=!0,f.bearing=+r.bearing),"pitch"in r&&f.pitch!==+r.pitch&&(T=!0,f.pitch=+r.pitch),r.padding==null||f.isPaddingEqual(r.padding)||(f.padding=r.padding),this._applyUpdatedTransform(f),this.fire(new o.k("movestart",l)).fire(new o.k("move",l)),p&&this.fire(new o.k("zoomstart",l)).fire(new o.k("zoom",l)).fire(new o.k("zoomend",l)),y&&this.fire(new o.k("rotatestart",l)).fire(new o.k("rotate",l)).fire(new o.k("rotateend",l)),T&&this.fire(new o.k("pitchstart",l)).fire(new o.k("pitch",l)).fire(new o.k("pitchend",l)),this.fire(new o.k("moveend",l))}calculateCameraOptionsFromTo(r,l,f,p=0){const y=o.U.fromLngLat(r,l),T=o.U.fromLngLat(f,p),S=T.x-y.x,A=T.y-y.y,F=T.z-y.z,L=Math.hypot(S,A,F);if(L===0)throw new Error("Can't calculate camera options with same From and To");const R=Math.hypot(S,A),W=this.transform.scaleZoom(this.transform.cameraToCenterDistance/L/this.transform.tileSize),oe=180*Math.atan2(S,-A)/Math.PI;let se=180*Math.acos(R/L)/Math.PI;return se=F<0?90-se:90+se,{center:T.toLngLat(),zoom:W,pitch:se,bearing:oe}}easeTo(r,l){this._stop(!1,r.easeId),((r=o.e({offset:[0,0],duration:500,easing:o.bb},r)).animate===!1||!r.essential&&o.h.prefersReducedMotion)&&(r.duration=0);const f=this._getTransformForUpdate(),p=this.getZoom(),y=this.getBearing(),T=this.getPitch(),S=this.getPadding(),A="zoom"in r?+r.zoom:p,F="bearing"in r?this._normalizeBearing(r.bearing,y):y,L="pitch"in r?+r.pitch:T,R="padding"in r?r.padding:f.padding,W=o.P.convert(r.offset);let oe=f.centerPoint.add(W);const se=f.pointLocation(oe),de=o.L.convert(r.center||se);this._normalizeCenter(de);const ie=f.project(se),Pe=f.project(de).sub(ie),Ge=f.zoomScale(A-p);let _e,Re;r.around&&(_e=o.L.convert(r.around),Re=f.locationPoint(_e));const Ze={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||A!==p,this._rotating=this._rotating||y!==F,this._pitching=this._pitching||L!==T,this._padding=!f.isPaddingEqual(R),this._easeId=r.easeId,this._prepareEase(l,r.noMoveStart,Ze),this.terrain&&this._prepareElevation(de),this._ease(Xe=>{if(this._zooming&&(f.zoom=o.B.number(p,A,Xe)),this._rotating&&(f.bearing=o.B.number(y,F,Xe)),this._pitching&&(f.pitch=o.B.number(T,L,Xe)),this._padding&&(f.interpolatePadding(S,R,Xe),oe=f.centerPoint.add(W)),this.terrain&&!r.freezeElevation&&this._updateElevation(Xe),_e)f.setLocationAtPoint(_e,Re);else{const rt=f.zoomScale(f.zoom-p),mt=A>p?Math.min(2,Ge):Math.max(.5,Ge),lt=Math.pow(mt,1-Xe),vt=f.unproject(ie.add(Pe.mult(Xe*lt)).mult(rt));f.setLocationAtPoint(f.renderWorldCopies?vt.wrap():vt,oe)}this._applyUpdatedTransform(f),this._fireMoveEvents(l)},Xe=>{this.terrain&&this._finalizeElevation(),this._afterEase(l,Xe)},r),this}_prepareEase(r,l,f={}){this._moving=!0,l||f.moving||this.fire(new o.k("movestart",r)),this._zooming&&!f.zooming&&this.fire(new o.k("zoomstart",r)),this._rotating&&!f.rotating&&this.fire(new o.k("rotatestart",r)),this._pitching&&!f.pitching&&this.fire(new o.k("pitchstart",r))}_prepareElevation(r){this._elevationCenter=r,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(r,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(r){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const l=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(r<1&&l!==this._elevationTarget){const f=this._elevationTarget-this._elevationStart;this._elevationStart+=r*(f-(l-(f*r+this._elevationStart))/(1-r)),this._elevationTarget=l}this.transform.elevation=o.B.number(this._elevationStart,this._elevationTarget,r)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(r){if(!this.transformCameraUpdate)return;const l=r.clone(),{center:f,zoom:p,pitch:y,bearing:T,elevation:S}=this.transformCameraUpdate(l);f&&(l.center=f),p!==void 0&&(l.zoom=p),y!==void 0&&(l.pitch=y),T!==void 0&&(l.bearing=T),S!==void 0&&(l.elevation=S),this.transform.apply(l)}_fireMoveEvents(r){this.fire(new o.k("move",r)),this._zooming&&this.fire(new o.k("zoom",r)),this._rotating&&this.fire(new o.k("rotate",r)),this._pitching&&this.fire(new o.k("pitch",r))}_afterEase(r,l){if(this._easeId&&l&&this._easeId===l)return;delete this._easeId;const f=this._zooming,p=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,f&&this.fire(new o.k("zoomend",r)),p&&this.fire(new o.k("rotateend",r)),y&&this.fire(new o.k("pitchend",r)),this.fire(new o.k("moveend",r))}flyTo(r,l){if(!r.essential&&o.h.prefersReducedMotion){const zt=o.F(r,["center","zoom","bearing","pitch","around"]);return this.jumpTo(zt,l)}this.stop(),r=o.e({offset:[0,0],speed:1.2,curve:1.42,easing:o.bb},r);const f=this._getTransformForUpdate(),p=this.getZoom(),y=this.getBearing(),T=this.getPitch(),S=this.getPadding(),A="zoom"in r?o.ad(+r.zoom,f.minZoom,f.maxZoom):p,F="bearing"in r?this._normalizeBearing(r.bearing,y):y,L="pitch"in r?+r.pitch:T,R="padding"in r?r.padding:f.padding,W=f.zoomScale(A-p),oe=o.P.convert(r.offset);let se=f.centerPoint.add(oe);const de=f.pointLocation(se),ie=o.L.convert(r.center||de);this._normalizeCenter(ie);const Pe=f.project(de),Ge=f.project(ie).sub(Pe);let _e=r.curve;const Re=Math.max(f.width,f.height),Ze=Re/W,Xe=Ge.mag();if("minZoom"in r){const zt=o.ad(Math.min(r.minZoom,p,A),f.minZoom,f.maxZoom),Rr=Re/f.zoomScale(zt-p);_e=Math.sqrt(Rr/Xe*2)}const rt=_e*_e;function mt(zt){const Rr=(Ze*Ze-Re*Re+(zt?-1:1)*rt*rt*Xe*Xe)/(2*(zt?Ze:Re)*rt*Xe);return Math.log(Math.sqrt(Rr*Rr+1)-Rr)}function lt(zt){return(Math.exp(zt)-Math.exp(-zt))/2}function vt(zt){return(Math.exp(zt)+Math.exp(-zt))/2}const Ot=mt(!1);let pr=function(zt){return vt(Ot)/vt(Ot+_e*zt)},Et=function(zt){return Re*((vt(Ot)*(lt(Rr=Ot+_e*zt)/vt(Rr))-lt(Ot))/rt)/Xe;var Rr},qt=(mt(!0)-Ot)/_e;if(Math.abs(Xe)<1e-6||!isFinite(qt)){if(Math.abs(Re-Ze)<1e-6)return this.easeTo(r,l);const zt=Ze<Re?-1:1;qt=Math.abs(Math.log(Ze/Re))/_e,Et=function(){return 0},pr=function(Rr){return Math.exp(zt*_e*Rr)}}return r.duration="duration"in r?+r.duration:1e3*qt/("screenSpeed"in r?+r.screenSpeed/_e:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0),this._zooming=!0,this._rotating=y!==F,this._pitching=L!==T,this._padding=!f.isPaddingEqual(R),this._prepareEase(l,!1),this.terrain&&this._prepareElevation(ie),this._ease(zt=>{const Rr=zt*qt,dr=1/pr(Rr);f.zoom=zt===1?A:p+f.scaleZoom(dr),this._rotating&&(f.bearing=o.B.number(y,F,zt)),this._pitching&&(f.pitch=o.B.number(T,L,zt)),this._padding&&(f.interpolatePadding(S,R,zt),se=f.centerPoint.add(oe)),this.terrain&&!r.freezeElevation&&this._updateElevation(zt);const sr=zt===1?ie:f.unproject(Pe.add(Ge.mult(Et(Rr))).mult(dr));f.setLocationAtPoint(f.renderWorldCopies?sr.wrap():sr,se),this._applyUpdatedTransform(f),this._fireMoveEvents(l)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(l)},r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const f=this._onEaseEnd;delete this._onEaseEnd,f.call(this,l)}if(!r){const f=this.handlers;f&&f.stop(!1)}return this}_ease(r,l,f){f.animate===!1||f.duration===0?(r(1),l()):(this._easeStart=o.h.now(),this._easeOptions=f,this._onEaseFrame=r,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(r,l){r=o.b5(r,-180,180);const f=Math.abs(r-l);return Math.abs(r-360-l)<f&&(r-=360),Math.abs(r+360-l)<f&&(r+=360),r}_normalizeCenter(r){const l=this.transform;if(!l.renderWorldCopies||l.lngRange)return;const f=r.lng-l.center.lng;r.lng+=f>180?-360:f<-180?360:0}queryTerrainElevation(r){return this.terrain?this.terrain.getElevationForLngLatZoom(o.L.convert(r),this.transform.tileZoom)-this.transform.elevation:null}}class _i{constructor(r={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=l=>{!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"&&l.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=r}getDefaultPosition(){return"bottom-right"}onAdd(r){return this._map=r,this._compact=this.options&&this.options.compact,this._container=w.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=w.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=w.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){w.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(r,l){const f=this._map._getUIString(`AttributionControl.${l}`);r.title=f,r.setAttribute("aria-label",f)}_updateAttributions(){if(!this._map.style)return;let r=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=r.concat(this.options.customAttribution.map(p=>typeof p!="string"?"":p)):typeof this.options.customAttribution=="string"&&r.push(this.options.customAttribution)),this._map.style.stylesheet){const p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}const l=this._map.style.sourceCaches;for(const p in l){const y=l[p];if(y.used||y.usedForTerrain){const T=y.getSource();T.attribution&&r.indexOf(T.attribution)<0&&r.push(T.attribution)}}r=r.filter(p=>String(p).trim()),r.sort((p,y)=>p.length-y.length),r=r.filter((p,y)=>{for(let T=y+1;T<r.length;T++)if(r[T].indexOf(p)>=0)return!1;return!0});const f=r.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,r.length?(this._innerContainer.innerHTML=f,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Ur{constructor(r={}){this._updateCompact=()=>{const l=this._container.children;if(l.length){const f=l[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&f.classList.add("maplibregl-compact"):f.classList.remove("maplibregl-compact")}},this.options=r}getDefaultPosition(){return"bottom-left"}onAdd(r){this._map=r,this._compact=this.options&&this.options.compact,this._container=w.create("div","maplibregl-ctrl");const l=w.create("a","maplibregl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://maplibre.org/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){w.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Yo{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const l=++this._id;return this._queue.push({callback:r,id:l,cancelled:!1}),l}remove(r){const l=this._currentlyRunning,f=l?this._queue.concat(l):this._queue;for(const p of f)if(p.id===r)return void(p.cancelled=!0)}run(r=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const l=this._currentlyRunning=this._queue;this._queue=[];for(const f of l)if(!f.cancelled&&(f.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const ac={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var $u=o.Q([{name:"a_pos3d",type:"Int16",components:3}]);class ju extends o.E{constructor(r){super(),this.sourceCache=r,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,r.usedForTerrain=!0,r.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(r,l){this.sourceCache.update(r,l),this._renderableTilesKeys=[];const f={};for(const p of r.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:l}))f[p.key]=!0,this._renderableTilesKeys.push(p.key),this._tiles[p.key]||(p.posMatrix=new Float64Array(16),o.aS(p.posMatrix,0,o.N,0,o.N,0,1),this._tiles[p.key]=new cr(p,this.tileSize));for(const p in this._tiles)f[p]||delete this._tiles[p]}freeRtt(r){for(const l in this._tiles){const f=this._tiles[l];(!r||f.tileID.equals(r)||f.tileID.isChildOf(r)||r.isChildOf(f.tileID))&&(f.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(r=>this.getTileByID(r))}getTileByID(r){return this._tiles[r]}getTerrainCoords(r){const l={};for(const f of this._renderableTilesKeys){const p=this._tiles[f].tileID;if(p.canonical.equals(r.canonical)){const y=r.clone();y.posMatrix=new Float64Array(16),o.aS(y.posMatrix,0,o.N,0,o.N,0,1),l[f]=y}else if(p.canonical.isChildOf(r.canonical)){const y=r.clone();y.posMatrix=new Float64Array(16);const T=p.canonical.z-r.canonical.z,S=p.canonical.x-(p.canonical.x>>T<<T),A=p.canonical.y-(p.canonical.y>>T<<T),F=o.N>>T;o.aS(y.posMatrix,0,F,0,F,0,1),o.$(y.posMatrix,y.posMatrix,[-S*F,-A*F,0]),l[f]=y}else if(r.canonical.isChildOf(p.canonical)){const y=r.clone();y.posMatrix=new Float64Array(16);const T=r.canonical.z-p.canonical.z,S=r.canonical.x-(r.canonical.x>>T<<T),A=r.canonical.y-(r.canonical.y>>T<<T),F=o.N>>T;o.aS(y.posMatrix,0,o.N,0,o.N,0,1),o.$(y.posMatrix,y.posMatrix,[S*F,A*F,0]),o.a0(y.posMatrix,y.posMatrix,[1/2**T,1/2**T,0]),l[f]=y}}return l}getSourceTile(r,l){const f=this.sourceCache._source;let p=r.overscaledZ-this.deltaZoom;if(p>f.maxzoom&&(p=f.maxzoom),p<f.minzoom)return null;this._sourceTileCache[r.key]||(this._sourceTileCache[r.key]=r.scaledTo(p).key);let y=this.sourceCache.getTileByID(this._sourceTileCache[r.key]);if((!y||!y.dem)&&l)for(;p>=f.minzoom&&(!y||!y.dem);)y=this.sourceCache.getTileByID(r.scaledTo(p--).key);return y}tilesAfterTime(r=Date.now()){return Object.values(this._tiles).filter(l=>l.timeAdded>=r)}}class Gu{constructor(r,l,f){this.painter=r,this.sourceCache=new ju(l),this.options=f,this.exaggeration=typeof f.exaggeration=="number"?f.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(r,l,f,p=o.N){var y;if(!(l>=0&&l<p&&f>=0&&f<p))return 0;const T=this.getTerrainData(r),S=(y=T.tile)===null||y===void 0?void 0:y.dem;if(!S)return 0;const A=function(se,de,ie){var Pe=de[0],Ge=de[1];return se[0]=ie[0]*Pe+ie[4]*Ge+ie[12],se[1]=ie[1]*Pe+ie[5]*Ge+ie[13],se}([],[l/p*o.N,f/p*o.N],T.u_terrain_matrix),F=[A[0]*S.dim,A[1]*S.dim],L=Math.floor(F[0]),R=Math.floor(F[1]),W=F[0]-L,oe=F[1]-R;return S.get(L,R)*(1-W)*(1-oe)+S.get(L+1,R)*W*(1-oe)+S.get(L,R+1)*(1-W)*oe+S.get(L+1,R+1)*W*oe}getElevationForLngLatZoom(r,l){const{tileID:f,mercatorX:p,mercatorY:y}=this._getOverscaledTileIDFromLngLatZoom(r,l);return this.getElevation(f,p%o.N,y%o.N,o.N)}getElevation(r,l,f,p=o.N){return this.getDEMElevation(r,l,f,p)*this.exaggeration}getTerrainData(r){if(!this._emptyDemTexture){const p=this.painter.context,y=new o.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new $e(p,y,p.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new $e(p,new o.R({width:1,height:1}),p.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.ao([])}const l=this.sourceCache.getSourceTile(r,!0);if(l&&l.dem&&(!l.demTexture||l.needsTerrainPrepare)){const p=this.painter.context;l.demTexture=this.painter.getTileTexture(l.dem.stride),l.demTexture?l.demTexture.update(l.dem.getPixels(),{premultiply:!1}):l.demTexture=new $e(p,l.dem.getPixels(),p.gl.RGBA,{premultiply:!1}),l.demTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),l.needsTerrainPrepare=!1}const f=l&&l+l.tileID.key+r.key;if(f&&!this._demMatrixCache[f]){const p=this.sourceCache.sourceCache._source.maxzoom;let y=r.canonical.z-l.tileID.canonical.z;r.overscaledZ>r.canonical.z&&(r.canonical.z>=p?y=r.canonical.z-p:o.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const T=r.canonical.x-(r.canonical.x>>y<<y),S=r.canonical.y-(r.canonical.y>>y<<y),A=o.bc(new Float64Array(16),[1/(o.N<<y),1/(o.N<<y),0]);o.$(A,A,[T*o.N,S*o.N,0]),this._demMatrixCache[r.key]={matrix:A,coord:r}}return{u_depth:2,u_terrain:3,u_terrain_dim:l&&l.dem&&l.dem.dim||1,u_terrain_matrix:f?this._demMatrixCache[r.key].matrix:this._emptyDemMatrix,u_terrain_unpack:l&&l.dem&&l.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(l&&l.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:l}}getFramebuffer(r){const l=this.painter,f=l.width/devicePixelRatio,p=l.height/devicePixelRatio;return!this._fbo||this._fbo.width===f&&this._fbo.height===p||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new $e(l.context,{width:f,height:p,data:null},l.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(l.context.gl.NEAREST,l.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new $e(l.context,{width:f,height:p,data:null},l.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(l.context.gl.NEAREST,l.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=l.context.createFramebuffer(f,p,!0,!1),this._fbo.depthAttachment.set(l.context.createRenderbuffer(l.context.gl.DEPTH_COMPONENT16,f,p))),this._fbo.colorAttachment.set(r==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const r=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const l=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let y=0,T=0;y<this._coordsTextureSize;y++)for(let S=0;S<this._coordsTextureSize;S++,T+=4)l[T+0]=255&S,l[T+1]=255&y,l[T+2]=S>>8<<4|y>>8,l[T+3]=0;const f=new o.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(l.buffer)),p=new $e(r,f,r.gl.RGBA,{premultiply:!1});return p.bind(r.gl.NEAREST,r.gl.CLAMP_TO_EDGE),this._coordsTexture=p,p}pointCoordinate(r){const l=new Uint8Array(4),f=this.painter.context,p=f.gl;f.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),p.readPixels(r.x,this.painter.height/devicePixelRatio-r.y-1,1,1,p.RGBA,p.UNSIGNED_BYTE,l),f.bindFramebuffer.set(null);const y=l[0]+(l[2]>>4<<8),T=l[1]+((15&l[2])<<8),S=this.coordsIndex[255-l[3]],A=S&&this.sourceCache.getTileByID(S);if(!A)return null;const F=this._coordsTextureSize,L=(1<<A.tileID.canonical.z)*F;return new o.U(this._allowMercatorOverflow(r,(A.tileID.canonical.x*F+y)/L),(A.tileID.canonical.y*F+T)/L,this.getElevation(A.tileID,y,T,F))}getTerrainMesh(){if(this._mesh)return this._mesh;const r=this.painter.context,l=new o.bd,f=new o.b0,p=this.meshSize,y=o.N/p,T=p*p;for(let R=0;R<=p;R++)for(let W=0;W<=p;W++)l.emplaceBack(W*y,R*y,0);for(let R=0;R<T;R+=p+1)for(let W=0;W<p;W++)f.emplaceBack(W+R,p+W+R+1,p+W+R+2),f.emplaceBack(W+R,p+W+R+2,W+R+1);const S=l.length,A=S+2*(p+1);for(const R of[0,1])for(let W=0;W<=p;W++)for(const oe of[0,1])l.emplaceBack(W*y,R*o.N,oe);for(let R=0;R<2*p;R+=2)f.emplaceBack(A+R,A+R+1,A+R+3),f.emplaceBack(A+R,A+R+3,A+R+2),f.emplaceBack(S+R,S+R+3,S+R+1),f.emplaceBack(S+R,S+R+2,S+R+3);const F=l.length,L=F+2*(p+1);for(const R of[0,1])for(let W=0;W<=p;W++)for(const oe of[0,1])l.emplaceBack(R*o.N,W*y,oe);for(let R=0;R<2*p;R+=2)f.emplaceBack(F+R,F+R+1,F+R+3),f.emplaceBack(F+R,F+R+3,F+R+2),f.emplaceBack(L+R,L+R+3,L+R+1),f.emplaceBack(L+R,L+R+2,L+R+3);return this._mesh={indexBuffer:r.createIndexBuffer(f),vertexBuffer:r.createVertexBuffer(l,$u.members),segments:o.S.simpleSegment(0,0,l.length,f.length)},this._mesh}getMeshFrameDelta(r){return 2*Math.PI*o.be/Math.pow(2,r)/5}getMinTileElevationForLngLatZoom(r,l){var f;const{tileID:p}=this._getOverscaledTileIDFromLngLatZoom(r,l);return(f=this.getMinMaxElevation(p).minElevation)!==null&&f!==void 0?f:0}getMinMaxElevation(r){const l=this.getTerrainData(r).tile,f={minElevation:null,maxElevation:null};return l&&l.dem&&(f.minElevation=l.dem.min*this.exaggeration,f.maxElevation=l.dem.max*this.exaggeration),f}_getOverscaledTileIDFromLngLatZoom(r,l){const f=o.U.fromLngLat(r.wrap()),p=(1<<l)*o.N,y=f.x*p,T=f.y*p,S=Math.floor(y/o.N),A=Math.floor(T/o.N);return{tileID:new o.O(l,0,l,S,A),mercatorX:y,mercatorY:T}}_allowMercatorOverflow(r,l){const f=r.x<this.painter.width/2;let p=o.bf(l);const y=this.painter.transform.center.lng;return f&&Math.sign(p)>0&&Math.sign(y)<0||!f&&Math.sign(p)<0&&Math.sign(y)>0?(p=360*Math.sign(y)+p,o.G(p)):l}}class ff{constructor(r,l,f){this._context=r,this._size=l,this._tileSize=f,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const r of this._objects)r.texture.destroy(),r.fbo.destroy()}_createObject(r){const l=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),f=new $e(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return f.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),l.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),l.colorAttachment.set(f.texture),{id:r,fbo:l,texture:f,stamp:-1,inUse:!1}}getObjectForId(r){return this._objects[r]}useObject(r){r.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(l=>r.id!==l),this._recentlyUsed.push(r.id)}stampObject(r){r.stamp=++this._stamp}getOrCreateFreeObject(){for(const l of this._recentlyUsed)if(!this._objects[l].inUse)return this._objects[l];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const r=this._createObject(this._objects.length);return this._objects.push(r),r}freeObject(r){r.inUse=!1}freeAllObjects(){for(const r of this._objects)this.freeObject(r)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(r=>!r.inUse)===!1}}const Ha={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Jo{constructor(r,l){this.painter=r,this.terrain=l,this.pool=new ff(r.context,30,l.sourceCache.tileSize*l.qualityFactor)}destruct(){this.pool.destruct()}getTexture(r){return this.pool.getObjectForId(r.rtt[this._stacks.length-1].id).texture}prepareForRender(r,l){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=r._order.filter(f=>!r._layers[f].isHidden(l)),this._coordsDescendingInv={};for(const f in r.sourceCaches){this._coordsDescendingInv[f]={};const p=r.sourceCaches[f].getVisibleCoordinates();for(const y of p){const T=this.terrain.sourceCache.getTerrainCoords(y);for(const S in T)this._coordsDescendingInv[f][S]||(this._coordsDescendingInv[f][S]=[]),this._coordsDescendingInv[f][S].push(T[S])}}this._coordsDescendingInvStr={};for(const f of r._order){const p=r._layers[f],y=p.source;if(Ha[p.type]&&!this._coordsDescendingInvStr[y]){this._coordsDescendingInvStr[y]={};for(const T in this._coordsDescendingInv[y])this._coordsDescendingInvStr[y][T]=this._coordsDescendingInv[y][T].map(S=>S.key).sort().join()}}for(const f of this._renderableTiles)for(const p in this._coordsDescendingInvStr){const y=this._coordsDescendingInvStr[p][f.tileID.key];y&&y!==f.rttCoords[p]&&(f.rtt=[])}}renderLayer(r){if(r.isHidden(this.painter.transform.zoom))return!1;const l=r.type,f=this.painter,p=this._renderableLayerIds[this._renderableLayerIds.length-1]===r.id;if(Ha[l]&&(this._prevType&&Ha[this._prevType]||this._stacks.push([]),this._prevType=l,this._stacks[this._stacks.length-1].push(r.id),!p))return!0;if(Ha[this._prevType]||Ha[l]&&p){this._prevType=l;const y=this._stacks.length-1,T=this._stacks[y]||[];for(const S of this._renderableTiles){if(this.pool.isFull()&&(Jr(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(S),S.rtt[y]){const F=this.pool.getObjectForId(S.rtt[y].id);if(F.stamp===S.rtt[y].stamp){this.pool.useObject(F);continue}}const A=this.pool.getOrCreateFreeObject();this.pool.useObject(A),this.pool.stampObject(A),S.rtt[y]={id:A.id,stamp:A.stamp},f.context.bindFramebuffer.set(A.fbo.framebuffer),f.context.clear({color:o.aT.transparent,stencil:0}),f.currentStencilSource=void 0;for(let F=0;F<T.length;F++){const L=f.style._layers[T[F]],R=L.source?this._coordsDescendingInv[L.source][S.tileID.key]:[S.tileID];f.context.viewport.set([0,0,A.fbo.width,A.fbo.height]),f._renderTileClippingMasks(L,R),f.renderLayer(f,f.style.sourceCaches[L.source],L,R),L.source&&(S.rttCoords[L.source]=this._coordsDescendingInvStr[L.source][S.tileID.key])}}return Jr(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Ha[l]}return!1}}const $t=E,Wt={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:o.c.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},Qs=g=>{g.touchstart=g.dragStart,g.touchmoveWindow=g.dragMove,g.touchend=g.dragEnd},ic={showCompass:!0,showZoom:!0,visualizePitch:!1};class nc{constructor(r,l,f=!1){this.mousedown=T=>{this.startMouse(o.e({},T,{ctrlKey:!0,preventDefault:()=>T.preventDefault()}),w.mousePos(this.element,T)),w.addEventListener(window,"mousemove",this.mousemove),w.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=T=>{this.moveMouse(T,w.mousePos(this.element,T))},this.mouseup=T=>{this.mouseRotate.dragEnd(T),this.mousePitch&&this.mousePitch.dragEnd(T),this.offTemp()},this.touchstart=T=>{T.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=w.touchPos(this.element,T.targetTouches)[0],this.startTouch(T,this._startPos),w.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),w.addEventListener(window,"touchend",this.touchend))},this.touchmove=T=>{T.targetTouches.length!==1?this.reset():(this._lastPos=w.touchPos(this.element,T.targetTouches)[0],this.moveTouch(T,this._lastPos))},this.touchend=T=>{T.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const p=r.dragRotate._mouseRotate.getClickTolerance(),y=r.dragRotate._mousePitch.getClickTolerance();this.element=l,this.mouseRotate=xs({clickTolerance:p,enable:!0}),this.touchRotate=(({enable:T,clickTolerance:S,bearingDegreesPerPixelMoved:A=.8})=>{const F=new Ou;return new pn({clickTolerance:S,move:(L,R)=>({bearingDelta:(R.x-L.x)*A}),moveStateManager:F,enable:T,assignEvents:Qs})})({clickTolerance:p,enable:!0}),this.map=r,f&&(this.mousePitch=mn({clickTolerance:y,enable:!0}),this.touchPitch=(({enable:T,clickTolerance:S,pitchDegreesPerPixelMoved:A=-.5})=>{const F=new Ou;return new pn({clickTolerance:S,move:(L,R)=>({pitchDelta:(R.y-L.y)*A}),moveStateManager:F,enable:T,assignEvents:Qs})})({clickTolerance:y,enable:!0})),w.addEventListener(l,"mousedown",this.mousedown),w.addEventListener(l,"touchstart",this.touchstart,{passive:!1}),w.addEventListener(l,"touchcancel",this.reset)}startMouse(r,l){this.mouseRotate.dragStart(r,l),this.mousePitch&&this.mousePitch.dragStart(r,l),w.disableDrag()}startTouch(r,l){this.touchRotate.dragStart(r,l),this.touchPitch&&this.touchPitch.dragStart(r,l),w.disableDrag()}moveMouse(r,l){const f=this.map,{bearingDelta:p}=this.mouseRotate.dragMove(r,l)||{};if(p&&f.setBearing(f.getBearing()+p),this.mousePitch){const{pitchDelta:y}=this.mousePitch.dragMove(r,l)||{};y&&f.setPitch(f.getPitch()+y)}}moveTouch(r,l){const f=this.map,{bearingDelta:p}=this.touchRotate.dragMove(r,l)||{};if(p&&f.setBearing(f.getBearing()+p),this.touchPitch){const{pitchDelta:y}=this.touchPitch.dragMove(r,l)||{};y&&f.setPitch(f.getPitch()+y)}}off(){const r=this.element;w.removeEventListener(r,"mousedown",this.mousedown),w.removeEventListener(r,"touchstart",this.touchstart,{passive:!1}),w.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),w.removeEventListener(window,"touchend",this.touchend),w.removeEventListener(r,"touchcancel",this.reset),this.offTemp()}offTemp(){w.enableDrag(),w.removeEventListener(window,"mousemove",this.mousemove),w.removeEventListener(window,"mouseup",this.mouseup),w.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),w.removeEventListener(window,"touchend",this.touchend)}}let oa;function sc(g,r,l){if(g=new o.L(g.lng,g.lat),r){const f=new o.L(g.lng-360,g.lat),p=new o.L(g.lng+360,g.lat),y=l.locationPoint(g).distSqr(r);l.locationPoint(f).distSqr(r)<y?g=f:l.locationPoint(p).distSqr(r)<y&&(g=p)}for(;Math.abs(g.lng-l.center.lng)>180;){const f=l.locationPoint(g);if(f.x>=0&&f.y>=0&&f.x<=l.width&&f.y<=l.height)break;g.lng>l.center.lng?g.lng-=360:g.lng+=360}return g}const Ri={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Hu(g,r,l){const f=g.classList;for(const p in Ri)f.remove(`maplibregl-${l}-anchor-${p}`);f.add(`maplibregl-${l}-anchor-${r}`)}class qn extends o.E{constructor(r){if(super(),this._onKeyPress=l=>{const f=l.code,p=l.charCode||l.keyCode;f!=="Space"&&f!=="Enter"&&p!==32&&p!==13||this.togglePopup()},this._onMapClick=l=>{const f=l.originalEvent.target,p=this._element;this._popup&&(f===p||p.contains(f))&&this.togglePopup()},this._update=l=>{if(!this._map)return;const f=this._map.loaded()&&!this._map.isMoving();(l?.type==="terrain"||l?.type==="render"&&!f)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=sc(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let p="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?p=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(p=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let y="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?y="rotateX(0deg)":this._pitchAlignment==="map"&&(y=`rotateX(${this._map.getPitch()}deg)`),l&&l.type!=="moveend"||(this._pos=this._pos.round()),w.setTransform(this._element,`${Ri[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${y} ${p}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const T=this._map.unproject(this._pos),S=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=T.distanceTo(this._lngLat)>20*S?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=l=>{if(!this._isDragging){const f=this._clickTolerance||this._map._clickTolerance;this._isDragging=l.point.dist(this._pointerdownPos)>=f}this._isDragging&&(this._pos=l.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.k("dragstart"))),this.fire(new o.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.k("dragend")),this._state="inactive"},this._addDragHandler=l=>{this._element.contains(l.originalEvent.target)&&(l.preventDefault(),this._positionDelta=l.point.sub(this._pos).add(this._offset),this._pointerdownPos=l.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment!=="auto"?r.pitchAlignment:this._rotationAlignment,r&&r.element)this._element=r.element,this._offset=o.P.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=w.create("div"),this._element.setAttribute("aria-label","Map marker");const l=w.createNS("http://www.w3.org/2000/svg","svg"),f=41,p=27;l.setAttributeNS(null,"display","block"),l.setAttributeNS(null,"height",`${f}px`),l.setAttributeNS(null,"width",`${p}px`),l.setAttributeNS(null,"viewBox",`0 0 ${p} ${f}`);const y=w.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"stroke","none"),y.setAttributeNS(null,"stroke-width","1"),y.setAttributeNS(null,"fill","none"),y.setAttributeNS(null,"fill-rule","evenodd");const T=w.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"fill-rule","nonzero");const S=w.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"transform","translate(3.0, 29.0)"),S.setAttributeNS(null,"fill","#000000");const A=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Pe of A){const Ge=w.createNS("http://www.w3.org/2000/svg","ellipse");Ge.setAttributeNS(null,"opacity","0.04"),Ge.setAttributeNS(null,"cx","10.5"),Ge.setAttributeNS(null,"cy","5.80029008"),Ge.setAttributeNS(null,"rx",Pe.rx),Ge.setAttributeNS(null,"ry",Pe.ry),S.appendChild(Ge)}const F=w.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"fill",this._color);const L=w.createNS("http://www.w3.org/2000/svg","path");L.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),F.appendChild(L);const R=w.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"opacity","0.25"),R.setAttributeNS(null,"fill","#000000");const W=w.createNS("http://www.w3.org/2000/svg","path");W.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),R.appendChild(W);const oe=w.createNS("http://www.w3.org/2000/svg","g");oe.setAttributeNS(null,"transform","translate(6.0, 7.0)"),oe.setAttributeNS(null,"fill","#FFFFFF");const se=w.createNS("http://www.w3.org/2000/svg","g");se.setAttributeNS(null,"transform","translate(8.0, 8.0)");const de=w.createNS("http://www.w3.org/2000/svg","circle");de.setAttributeNS(null,"fill","#000000"),de.setAttributeNS(null,"opacity","0.25"),de.setAttributeNS(null,"cx","5.5"),de.setAttributeNS(null,"cy","5.5"),de.setAttributeNS(null,"r","5.4999962");const ie=w.createNS("http://www.w3.org/2000/svg","circle");ie.setAttributeNS(null,"fill","#FFFFFF"),ie.setAttributeNS(null,"cx","5.5"),ie.setAttributeNS(null,"cy","5.5"),ie.setAttributeNS(null,"r","5.4999962"),se.appendChild(de),se.appendChild(ie),T.appendChild(S),T.appendChild(F),T.appendChild(R),T.appendChild(oe),T.appendChild(se),l.appendChild(T),l.setAttributeNS(null,"height",f*this._scale+"px"),l.setAttributeNS(null,"width",p*this._scale+"px"),this._element.appendChild(l),this._offset=o.P.convert(r&&r.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",l=>{l.preventDefault()}),this._element.addEventListener("mousedown",l=>{l.preventDefault()}),Hu(this._element,this._anchor,"marker"),r&&r.className)for(const l of r.className.split(" "))this._element.classList.add(l);this._popup=null}addTo(r){return this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._update),r.on("moveend",this._update),r.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),w.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=o.L.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const p=Math.abs(13.5)/Math.SQRT2;r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(38.1-13.5+p)],"bottom-right":[-p,-1*(38.1-13.5+p)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?r.remove():r.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(r){return this._offset=o.P.convert(r),this._update(),this}addClassName(r){this._element.classList.add(r)}removeClassName(r){this._element.classList.remove(r)}toggleClassName(r){return this._element.classList.toggle(r)}setDraggable(r){return this._draggable=!!r,this._map&&(r?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r&&r!=="auto"?r:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const Qr={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Zr=0,ys=!1;const eo={maxWidth:100,unit:"metric"};function to(g,r,l){const f=l&&l.maxWidth||100,p=g._container.clientHeight/2,y=g.unproject([0,p]),T=g.unproject([f,p]),S=y.distanceTo(T);if(l&&l.unit==="imperial"){const A=3.2808*S;A>5280?Zn(r,f,A/5280,g._getUIString("ScaleControl.Miles")):Zn(r,f,A,g._getUIString("ScaleControl.Feet"))}else l&&l.unit==="nautical"?Zn(r,f,S/1852,g._getUIString("ScaleControl.NauticalMiles")):S>=1e3?Zn(r,f,S/1e3,g._getUIString("ScaleControl.Kilometers")):Zn(r,f,S,g._getUIString("ScaleControl.Meters"))}function Zn(g,r,l,f){const p=function(y){const T=Math.pow(10,`${Math.floor(y)}`.length-1);let S=y/T;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(A){const F=Math.pow(10,Math.ceil(-Math.log(A)/Math.LN10));return Math.round(A*F)/F}(S),T*S}(l);g.style.width=r*(p/l)+"px",g.innerHTML=`${p}&nbsp;${f}`}const oc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},lc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function vs(g){if(g){if(typeof g=="number"){const r=Math.round(Math.abs(g)/Math.SQRT2);return{center:new o.P(0,0),top:new o.P(0,g),"top-left":new o.P(r,r),"top-right":new o.P(-r,r),bottom:new o.P(0,-g),"bottom-left":new o.P(r,-r),"bottom-right":new o.P(-r,-r),left:new o.P(g,0),right:new o.P(-g,0)}}if(g instanceof o.P||Array.isArray(g)){const r=o.P.convert(g);return{center:r,top:r,"top-left":r,"top-right":r,bottom:r,"bottom-left":r,"bottom-right":r,left:r,right:r}}return{center:o.P.convert(g.center||[0,0]),top:o.P.convert(g.top||[0,0]),"top-left":o.P.convert(g["top-left"]||[0,0]),"top-right":o.P.convert(g["top-right"]||[0,0]),bottom:o.P.convert(g.bottom||[0,0]),"bottom-left":o.P.convert(g["bottom-left"]||[0,0]),"bottom-right":o.P.convert(g["bottom-right"]||[0,0]),left:o.P.convert(g.left||[0,0]),right:o.P.convert(g.right||[0,0])}}return vs(new o.P(0,0))}const cc={extend:(g,...r)=>o.e(g,...r),run(g){g()},logToElement(g,r=!1,l="log"){const f=window.document.getElementById(l);f&&(r&&(f.innerHTML=""),f.innerHTML+=`<br>${g}`)}},uc=E;class Sr{static get version(){return uc}static get workerCount(){return ur.workerCount}static set workerCount(r){ur.workerCount=r}static get maxParallelImageRequests(){return o.c.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(r){o.c.MAX_PARALLEL_IMAGE_REQUESTS=r}static get workerUrl(){return o.c.WORKER_URL}static set workerUrl(r){o.c.WORKER_URL=r}static addProtocol(r,l){o.c.REGISTERED_PROTOCOLS[r]=l}static removeProtocol(r){delete o.c.REGISTERED_PROTOCOLS[r]}}return Sr.Map=class extends Vu{constructor(g){if(o.bg.mark(o.bh.create),(g=o.e({},Wt,g)).minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new qo(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies),{bearingSnap:g.bearingSnap}),this._cooperativeGesturesOnWheel=r=>{this._onCooperativeGesture(r,r[this._metaKey],1)},this._contextLost=r=>{r.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.k("webglcontextlost",{originalEvent:r}))},this._contextRestored=r=>{this._setupPainter(),this.resize(),this._update(),this.fire(new o.k("webglcontextrestored",{originalEvent:r}))},this._onMapScroll=r=>{if(r.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=g.interactive,this._cooperativeGestures=g.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=g.maxTileCacheSize,this._maxTileCacheZoomLevels=g.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._crossSourceCollisions=g.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=g.collectResourceTiming,this._renderTaskQueue=new Yo,this._controls=[],this._mapId=o.a2(),this._locale=o.e({},ac,g.locale),this._clickTolerance=g.clickTolerance,this._overridePixelRatio=g.pixelRatio,this._maxCanvasSize=g.maxCanvasSize,this.transformCameraUpdate=g.transformCameraUpdate,this._imageQueueHandle=j.addThrottleControl(()=>this.isMoving()),this._requestManager=new pe(g.transformRequest),typeof g.container=="string"){if(this._container=document.getElementById(g.container),!this._container)throw new Error(`Container '${g.container}' not found.`)}else{if(!(g.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(g.maxBounds&&this.setMaxBounds(g.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let r=!1;const l=Wn(f=>{this._trackResize&&!this._removed&&this.resize(f)._update()},50);this._resizeObserver=new ResizeObserver(f=>{r?l(f):r=!0}),this._resizeObserver.observe(this._container)}this.handlers=new rc(this,g),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=g.hash&&new Zs(typeof g.hash=="string"&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,o.e({},g.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=g.localIdeographFontFamily,this._validateStyle=g.validateStyle,g.style&&this.setStyle(g.style,{localIdeographFontFamily:g.localIdeographFontFamily}),g.attributionControl&&this.addControl(new _i({customAttribution:g.customAttribution})),g.maplibreLogo&&this.addControl(new Ur,g.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",r=>{this._update(r.dataType==="style"),this.fire(new o.k(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new o.k(`${r.dataType}dataloading`,r))}),this.on("dataabort",r=>{this.fire(new o.k("sourcedataabort",r))})}_getMapId(){return this._mapId}addControl(g,r){if(r===void 0&&(r=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new o.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=g.onAdd(this);this._controls.push(g);const f=this._controlPositions[r];return r.indexOf("bottom")!==-1?f.insertBefore(l,f.firstChild):f.appendChild(l),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new o.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(g);return r>-1&&this._controls.splice(r,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}calculateCameraOptionsFromTo(g,r,l,f){return f==null&&this.terrain&&(f=this.terrain.getElevationForLngLatZoom(l,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(g,r,l,f)}resize(g){var r;const l=this._containerDimensions(),f=l[0],p=l[1],y=this._getClampedPixelRatio(f,p);if(this._resizeCanvas(f,p,y),this.painter.resize(f,p,y),this.painter.overLimit()){const S=this.painter.context.gl;this._maxCanvasSize=[S.drawingBufferWidth,S.drawingBufferHeight];const A=this._getClampedPixelRatio(f,p);this._resizeCanvas(f,p,A),this.painter.resize(f,p,A)}this.transform.resize(f,p),(r=this._requestedCameraState)===null||r===void 0||r.resize(f,p);const T=!this._moving;return T&&(this.stop(),this.fire(new o.k("movestart",g)).fire(new o.k("move",g))),this.fire(new o.k("resize",g)),T&&this.fire(new o.k("moveend",g)),this}_getClampedPixelRatio(g,r){const{0:l,1:f}=this._maxCanvasSize,p=this.getPixelRatio(),y=g*p,T=r*p;return Math.min(y>l?l/y:1,T>f?f/T:1)*p}getPixelRatio(){var g;return(g=this._overridePixelRatio)!==null&&g!==void 0?g:devicePixelRatio}setPixelRatio(g){this._overridePixelRatio=g,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(g){return this.transform.setMaxBounds(Te.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g&&this.setZoom(g),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g&&this.setZoom(g),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g&&this.setPitch(g),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g&&this.setPitch(g),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.renderWorldCopies=g,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(g){return this._cooperativeGestures=g,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(g){return this.transform.locationPoint(o.L.convert(g),this.style&&this.terrain)}unproject(g){return this.transform.pointLocation(o.P.convert(g),this.terrain)}isMoving(){var g;return this._moving||((g=this.handlers)===null||g===void 0?void 0:g.isMoving())}isZooming(){var g;return this._zooming||((g=this.handlers)===null||g===void 0?void 0:g.isZooming())}isRotating(){var g;return this._rotating||((g=this.handlers)===null||g===void 0?void 0:g.isRotating())}_createDelegatedListener(g,r,l){if(g==="mouseenter"||g==="mouseover"){let f=!1;return{layer:r,listener:l,delegates:{mousemove:y=>{const T=this.getLayer(r)?this.queryRenderedFeatures(y.point,{layers:[r]}):[];T.length?f||(f=!0,l.call(this,new xi(g,this,y.originalEvent,{features:T}))):f=!1},mouseout:()=>{f=!1}}}}if(g==="mouseleave"||g==="mouseout"){let f=!1;return{layer:r,listener:l,delegates:{mousemove:T=>{(this.getLayer(r)?this.queryRenderedFeatures(T.point,{layers:[r]}):[]).length?f=!0:f&&(f=!1,l.call(this,new xi(g,this,T.originalEvent)))},mouseout:T=>{f&&(f=!1,l.call(this,new xi(g,this,T.originalEvent)))}}}}{const f=p=>{const y=this.getLayer(r)?this.queryRenderedFeatures(p.point,{layers:[r]}):[];y.length&&(p.features=y,l.call(this,p),delete p.features)};return{layer:r,listener:l,delegates:{[g]:f}}}}on(g,r,l){if(l===void 0)return super.on(g,r);const f=this._createDelegatedListener(g,r,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(f);for(const p in f.delegates)this.on(p,f.delegates[p]);return this}once(g,r,l){if(l===void 0)return super.once(g,r);const f=this._createDelegatedListener(g,r,l);for(const p in f.delegates)this.once(p,f.delegates[p]);return this}off(g,r,l){return l===void 0?super.off(g,r):(this._delegatedListeners&&this._delegatedListeners[g]&&(f=>{const p=this._delegatedListeners[g];for(let y=0;y<p.length;y++){const T=p[y];if(T.layer===r&&T.listener===l){for(const S in T.delegates)this.off(S,T.delegates[S]);return p.splice(y,1),this}}})(),this)}queryRenderedFeatures(g,r){if(!this.style)return[];let l;const f=g instanceof o.P||Array.isArray(g),p=f?g:[[0,0],[this.transform.width,this.transform.height]];if(r=r||(f?{}:g)||{},p instanceof o.P||typeof p[0]=="number")l=[o.P.convert(p)];else{const y=o.P.convert(p[0]),T=o.P.convert(p[1]);l=[y,new o.P(T.x,y.y),T,new o.P(y.x,T.y),y]}return this.style.queryRenderedFeatures(l,r,this.transform)}querySourceFeatures(g,r){return this.style.querySourceFeatures(g,r)}setStyle(g,r){return(r=o.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},r)).diff!==!1&&r.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&g?(this._diffStyle(g,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._updateStyle(g,r))}setTransformRequest(g){return this._requestManager.setTransformRequest(g),this}_getUIString(g){const r=this._locale[g];if(r==null)throw new Error(`Missing UI string '${g}'`);return r}_updateStyle(g,r){if(r.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(g,r));const l=this.style&&r.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!g)),g?(this.style=new Ia(this,r||{}),this.style.setEventedParent(this,{style:this.style}),typeof g=="string"?this.style.loadURL(g,r,l):this.style.loadJSON(g,r,l),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Ia(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(g,r){if(typeof g=="string"){const l=this._requestManager.transformRequest(g,re.Style);o.f(l,(f,p)=>{f?this.fire(new o.j(f)):p&&this._updateDiff(p,r)})}else typeof g=="object"&&this._updateDiff(g,r)}_updateDiff(g,r){try{this.style.setState(g,r)&&this._update(!0)}catch(l){o.w(`Unable to perform style diff: ${l.message||l.error||l}.  Rebuilding the style from scratch.`),this._updateStyle(g,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.w("There is no style added to the map.")}addSource(g,r){return this._lazyInitEmptyStyle(),this.style.addSource(g,r),this._update(!0)}isSourceLoaded(g){const r=this.style&&this.style.sourceCaches[g];if(r!==void 0)return r.loaded();this.fire(new o.j(new Error(`There is no source with ID '${g}'`)))}setTerrain(g){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),g){const r=this.style.sourceCaches[g.source];if(!r)throw new Error(`cannot load terrain, because there exists no source with ID: ${g.source}`);for(const l in this.style._layers){const f=this.style._layers[l];f.type==="hillshade"&&f.source===g.source&&o.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Gu(this.painter,r,g),this.painter.renderToTexture=new Jo(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=l=>{l.dataType==="style"?this.terrain.sourceCache.freeRtt():l.dataType==="source"&&l.tile&&(l.sourceId!==g.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(l.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new o.k("terrain",{terrain:g})),this}getTerrain(){var g,r;return(r=(g=this.terrain)===null||g===void 0?void 0:g.options)!==null&&r!==void 0?r:null}areTilesLoaded(){const g=this.style&&this.style.sourceCaches;for(const r in g){const l=g[r]._tiles;for(const f in l){const p=l[f];if(p.state!=="loaded"&&p.state!=="errored")return!1}}return!0}addSourceType(g,r,l){return this._lazyInitEmptyStyle(),this.style.addSourceType(g,r,l)}removeSource(g){return this.style.removeSource(g),this._update(!0)}getSource(g){return this.style.getSource(g)}addImage(g,r,l={}){const{pixelRatio:f=1,sdf:p=!1,stretchX:y,stretchY:T,content:S}=l;if(this._lazyInitEmptyStyle(),!(r instanceof HTMLImageElement||o.a(r))){if(r.width===void 0||r.height===void 0)return this.fire(new o.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:A,height:F,data:L}=r,R=r;return this.style.addImage(g,{data:new o.R({width:A,height:F},new Uint8Array(L)),pixelRatio:f,stretchX:y,stretchY:T,content:S,sdf:p,version:0,userImage:R}),R.onAdd&&R.onAdd(this,g),this}}{const{width:A,height:F,data:L}=o.h.getImageData(r);this.style.addImage(g,{data:new o.R({width:A,height:F},L),pixelRatio:f,stretchX:y,stretchY:T,content:S,sdf:p,version:0})}}updateImage(g,r){const l=this.style.getImage(g);if(!l)return this.fire(new o.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const f=r instanceof HTMLImageElement||o.a(r)?o.h.getImageData(r):r,{width:p,height:y,data:T}=f;if(p===void 0||y===void 0)return this.fire(new o.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(p!==l.data.width||y!==l.data.height)return this.fire(new o.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const S=!(r instanceof HTMLImageElement||o.a(r));return l.data.replace(T,S),this.style.updateImage(g,l),this}getImage(g){return this.style.getImage(g)}hasImage(g){return g?!!this.style.getImage(g):(this.fire(new o.j(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g,r){j.getImage(this._requestManager.transformRequest(g,re.Image),r)}listImages(){return this.style.listImages()}addLayer(g,r){return this._lazyInitEmptyStyle(),this.style.addLayer(g,r),this._update(!0)}moveLayer(g,r){return this.style.moveLayer(g,r),this._update(!0)}removeLayer(g){return this.style.removeLayer(g),this._update(!0)}getLayer(g){return this.style.getLayer(g)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(g,r,l){return this.style.setLayerZoomRange(g,r,l),this._update(!0)}setFilter(g,r,l={}){return this.style.setFilter(g,r,l),this._update(!0)}getFilter(g){return this.style.getFilter(g)}setPaintProperty(g,r,l,f={}){return this.style.setPaintProperty(g,r,l,f),this._update(!0)}getPaintProperty(g,r){return this.style.getPaintProperty(g,r)}setLayoutProperty(g,r,l,f={}){return this.style.setLayoutProperty(g,r,l,f),this._update(!0)}getLayoutProperty(g,r){return this.style.getLayoutProperty(g,r)}setGlyphs(g,r={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(g,r),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(g,r,l={}){return this._lazyInitEmptyStyle(),this.style.addSprite(g,r,l,f=>{f||this._update(!0)}),this}removeSprite(g){return this._lazyInitEmptyStyle(),this.style.removeSprite(g),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(g,r={}){return this._lazyInitEmptyStyle(),this.style.setSprite(g,r,l=>{l||this._update(!0)}),this}setLight(g,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(g,r),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(g,r){return this.style.setFeatureState(g,r),this._update()}removeFeatureState(g,r){return this.style.removeFeatureState(g,r),this._update()}getFeatureState(g){return this.style.getFeatureState(g)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let g=0,r=0;return this._container&&(g=this._container.clientWidth||400,r=this._container.clientHeight||300),[g,r]}_setupContainer(){const g=this._container;g.classList.add("maplibregl-map");const r=this._canvasContainer=w.create("div","maplibregl-canvas-container",g);this._interactive&&r.classList.add("maplibregl-interactive"),this._canvas=w.create("canvas","maplibregl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const l=this._containerDimensions(),f=this._getClampedPixelRatio(l[0],l[1]);this._resizeCanvas(l[0],l[1],f);const p=this._controlContainer=w.create("div","maplibregl-control-container",g),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(T=>{y[T]=w.create("div",`maplibregl-ctrl-${T} `,p)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=w.create("div","maplibregl-cooperative-gesture-screen",this._container);let g=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(g=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use ⌘ + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${g}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){w.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(g,r,l){this._canvas.width=Math.floor(l*g),this._canvas.height=Math.floor(l*r),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${r}px`}_setupPainter(){const g={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let r=null;this._canvas.addEventListener("webglcontextcreationerror",f=>{r={requestedAttributes:g},f&&(r.statusMessage=f.statusMessage,r.type=f.type)},{once:!0});const l=this._canvas.getContext("webgl2",g)||this._canvas.getContext("webgl",g);if(!l){const f="Failed to initialize WebGL";throw r?(r.message=f,new Error(JSON.stringify(r))):new Error(f)}this.painter=new Hn(l,this.transform),C.testSupport(l)}_onCooperativeGesture(g,r,l){return!r&&l<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(g){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_render(g){const r=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(g),this._removed)return;let l=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const p=this.transform.zoom,y=o.h.now();this.style.zoomHistory.update(p,y);const T=new o.a8(p,{now:y,fadeDuration:r,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),S=T.crossFadingFactor();S===1&&S===this._crossFadingFactor||(l=!0,this._crossFadingFactor=S),this.style.update(T)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,r,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:r,showPadding:this.showPadding}),this.fire(new o.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.bg.mark(o.bh.load),this.fire(new o.k("load"))),this.style&&(this.style.hasTransitions()||l)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const f=this._sourcesDirty||this._styleDirty||this._placementDirty;return f||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.k("idle")),!this._loaded||this._fullyLoaded||f||(this._fullyLoaded=!0,o.bg.mark(o.bh.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var g;this._hash&&this._hash.remove();for(const l of this._controls)l.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),j.removeThrottleControl(this._imageQueueHandle),(g=this._resizeObserver)===null||g===void 0||g.disconnect();const r=this.painter.context.gl.getExtension("WEBGL_lose_context");r&&r.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),w.remove(this._canvasContainer),w.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),o.bg.clearMetrics(),this._removed=!0,this.fire(new o.k("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=o.h.frame(g=>{o.bg.frame(g),this._frame=null,this._render(g)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get version(){return $t}getCameraTargetElevation(){return this.transform.elevation}},Sr.NavigationControl=class{constructor(g){this._updateZoomButtons=()=>{const r=this._map.getZoom(),l=r===this._map.getMaxZoom(),f=r===this._map.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())},this._rotateCompassArrow=()=>{const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=r},this._setButtonTitle=(r,l)=>{const f=this._map._getUIString(`NavigationControl.${l}`);r.title=f,r.setAttribute("aria-label",f)},this.options=o.e({},ic,g),this._container=w.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",r=>this._map.zoomIn({},{originalEvent:r})),w.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",r=>this._map.zoomOut({},{originalEvent:r})),w.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",r=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:r}):this._map.resetNorth({},{originalEvent:r})}),this._compassIcon=w.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new nc(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){w.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(g,r){const l=w.create("button",g,this._container);return l.type="button",l.addEventListener("click",r),l}},Sr.GeolocateControl=class extends o.E{constructor(g){super(),this._onSuccess=r=>{if(this._map){if(this._isOutOfMapMaxBounds(r))return this._setErrorState(),this.fire(new o.k("outofmaxbounds",r)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=r,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(r),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(r),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new o.k("geolocate",r)),this._finish()}},this._updateCamera=r=>{const l=new o.L(r.coords.longitude,r.coords.latitude),f=r.coords.accuracy,p=this._map.getBearing(),y=o.e({bearing:p},this.options.fitBoundsOptions),T=Te.fromLngLat(l,f);this._map.fitBounds(T,y,{geolocateSource:!0})},this._updateMarker=r=>{if(r){const l=new o.L(r.coords.longitude,r.coords.latitude);this._accuracyCircleMarker.setLngLat(l).addTo(this._map),this._userLocationDotMarker.setLngLat(l).addTo(this._map),this._accuracy=r.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=r=>{if(this._map){if(this.options.trackUserLocation)if(r.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=l,this._geolocateButton.setAttribute("aria-label",l),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(r.code===3&&ys)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new o.k("error",r)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=r=>{if(this._map){if(this._container.addEventListener("contextmenu",l=>l.preventDefault()),this._geolocateButton=w.create("button","maplibregl-ctrl-geolocate",this._container),w.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",r===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=l,this._geolocateButton.setAttribute("aria-label",l)}else{const l=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=l,this._geolocateButton.setAttribute("aria-label",l)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=w.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new qn({element:this._dotElement}),this._circleElement=w.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new qn({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",l=>{l.geolocateSource||this._watchState!=="ACTIVE_LOCK"||l.originalEvent&&l.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new o.k("trackuserlocationend")))})}},this.options=o.e({},Qr,g)}onAdd(g){return this._map=g,this._container=w.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(r,l=!1){oa===void 0||l?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(f=>{oa=f.state!=="denied",r(oa)}).catch(()=>{oa=!!window.navigator.geolocation,r(oa)}):(oa=!!window.navigator.geolocation,r(oa)):r(oa)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),w.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Zr=0,ys=!1}_isOutOfMapMaxBounds(g){const r=this._map.getMaxBounds(),l=g.coords;return r&&(l.longitude<r.getWest()||l.longitude>r.getEast()||l.latitude<r.getSouth()||l.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const g=this._map.getBounds(),r=g.getSouthEast(),l=g.getNorthEast(),f=r.distanceTo(l),p=Math.ceil(this._accuracy/(f/this._map._container.clientHeight)*2);this._circleElement.style.width=`${p}px`,this._circleElement.style.height=`${p}px`}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Zr--,ys=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new o.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let g;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Zr++,Zr>1?(g={maximumAge:6e5,timeout:0},ys=!0):(g=this.options.positionOptions,ys=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,g)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},Sr.AttributionControl=_i,Sr.LogoControl=Ur,Sr.ScaleControl=class{constructor(g){this._onMove=()=>{to(this._map,this._container,this.options)},this.setUnit=r=>{this.options.unit=r,to(this._map,this._container,this.options)},this.options=o.e({},eo,g)}getDefaultPosition(){return"bottom-left"}onAdd(g){return this._map=g,this._container=w.create("div","maplibregl-ctrl maplibregl-ctrl-scale",g.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){w.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},Sr.FullscreenControl=class extends o.E{constructor(g={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,g&&g.container&&(g.container instanceof HTMLElement?this._container=g.container:o.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=w.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){w.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const g=this._fullscreenButton=w.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);w.create("span","maplibregl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.title=g}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new o.k("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new o.k("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},Sr.TerrainControl=class{constructor(g){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=g}onAdd(g){return this._map=g,this._container=w.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=w.create("button","maplibregl-ctrl-terrain",this._container),w.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){w.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},Sr.Popup=class extends o.E{constructor(g){super(),this.remove=()=>(this._content&&w.remove(this._content),this._container&&(w.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new o.k("close")),this),this._onMouseUp=r=>{this._update(r.point)},this._onMouseMove=r=>{this._update(r.point)},this._onDrag=r=>{this._update(r.point)},this._update=r=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=w.create("div","maplibregl-popup",this._map.getContainer()),this._tip=w.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const T of this.options.className.split(" "))this._container.classList.add(T);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=sc(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!r)return;const l=this._pos=this._trackPointer&&r?r:this._map.project(this._lngLat);let f=this.options.anchor;const p=vs(this.options.offset);if(!f){const T=this._container.offsetWidth,S=this._container.offsetHeight;let A;A=l.y+p.bottom.y<S?["top"]:l.y>this._map.transform.height-S?["bottom"]:[],l.x<T/2?A.push("left"):l.x>this._map.transform.width-T/2&&A.push("right"),f=A.length===0?"bottom":A.join("-")}const y=l.add(p[f]).round();w.setTransform(this._container,`${Ri[f]} translate(${y.x}px,${y.y}px)`),Hu(this._container,f,"popup")},this._onClose=()=>{this.remove()},this.options=o.e(Object.create(oc),g)}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new o.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(g){return this._lngLat=o.L.convert(g),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(document.createTextNode(g))}setHTML(g){const r=document.createDocumentFragment(),l=document.createElement("body");let f;for(l.innerHTML=g;f=l.firstChild,f;)r.appendChild(f);return this.setDOMContent(r)}getMaxWidth(){var g;return(g=this._container)===null||g===void 0?void 0:g.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=w.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(g),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(g){this._container&&this._container.classList.add(g)}removeClassName(g){this._container&&this._container.classList.remove(g)}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){if(this._container)return this._container.classList.toggle(g)}_createCloseButton(){this.options.closeButton&&(this._closeButton=w.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(lc);g&&g.focus()}},Sr.Marker=qn,Sr.Style=Ia,Sr.LngLat=o.L,Sr.LngLatBounds=Te,Sr.Point=o.P,Sr.MercatorCoordinate=o.U,Sr.Evented=o.E,Sr.AJAXError=o.bi,Sr.config=o.c,Sr.CanvasSource=ge,Sr.GeoJSONSource=_t,Sr.ImageSource=tt,Sr.RasterDEMTileSource=pt,Sr.RasterTileSource=Ke,Sr.VectorTileSource=Se,Sr.VideoSource=Zt,Sr.setRTLTextPlugin=o.bj,Sr.getRTLTextPluginStatus=o.bk,Sr.prewarm=function(){wr().acquire(Gt)},Sr.clearPrewarmedResources=function(){const g=Dr;g&&(g.isPreloaded()&&g.numActive()===1?(g.release(Gt),Dr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},cc.extend(Sr,{isSafari:o.ac,getPerformanceMetrics:o.bg.getPerformanceMetrics}),Sr});var x=u;return x})})(i1);var Ib=i1.exports;const Fb=yv(Ib);function Pb({locations:e}){const[n,a]=he.useState(!1);return Je.jsx("div",{className:n?"fixed top-0 right-0 bottom-0 left-0 z-[9999]":"w-full h-full relative",children:Je.jsxs(Sb,{mapLib:Fb,style:{width:"100%",height:" 100%",position:"relative"},mapStyle:"https://api.ekgis.vn/v2/mapstyles/style/osmplus/standard/style.json?api_key=wtpM0U1ZmE2s87LEZNSHf63Osc1a2sboaozCQNsy",children:[e.map(c=>Je.jsx(kb,{latitude:c.lat,longitude:c.long,offsetLeft:-20,offsetTop:-10,children:Je.jsx(zw,{des:c?.customer_name})},c.customer_name)),Je.jsx(Ab,{id:"lines",type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",properties:{color:"#F7455D"},geometry:{type:"LineString",coordinates:e.map(c=>[c.long,c.lat])}}]},children:Je.jsx(Cb,{id:"lines",type:"line",paint:{"line-color":["get","color"],"line-width":3}})})]})})}function Mb({data:e}){const[n,a]=he.useState([]);return he.useEffect(()=>{console.log("data in map",e),a(a1(e,["customer_name","long","lat"],{isNull:!1}))},[e]),Je.jsx(Je.Fragment,{children:Je.jsxs(ho,{className:"h-[500px]",children:[Je.jsx(Si,{span:8,children:Je.jsx(G0,{columns:[{title:"Stt",dataIndex:"stt",key:"stt",render:(c,u,m)=>m+1},...X0],dataSource:e,pagination:!1})}),Je.jsx(Si,{span:16,className:"overflow-hidden",children:Je.jsx(Pb,{locations:n})})]})})}const{Dragger:Db}=Iw;function Lb({handleFile:e}){const n={name:"file",accept:".xls,.xlsx",action:"https://run.mocky.io/v3/435e224c-44fb-4773-9faf-380c5e6a2188",onChange(a){const{status:c}=a.file;c!=="uploading"&&console.log(a.file,a.fileList),c==="done"?Ah.success(`${a.file.name} file uploaded successfully.`):c==="error"&&Ah.error(`${a.file.name} file upload failed.`);let u=a.file.originFileObj;e(u)},onDrop(a){}};return Je.jsxs(Db,{...n,children:[Je.jsx("p",{className:"ant-upload-drag-icon",children:Je.jsx(Dw,{})}),Je.jsx("p",{className:"ant-upload-text",children:"Kéo, thả hoặc chọn tệp để tải lên"}),Je.jsx("p",{className:"ant-upload-hint",children:"Hỗ trợ tệp .xls, .xlsx"})]})}function Rb({form:e,filter:n,setFilter:a}){const[c,u]=he.useState([]),[m,x]=he.useState([]),[o,E]=he.useState([]),[w,C]=he.useState([]);he.useState(""),he.useState(""),he.useEffect(()=>{e.setFieldsValue(n)},[n]),he.useEffect(()=>{(async()=>{let B=await on.get("/api/method/frappe.desk.search.search_link",{params:{txt:"",doctype:"Customer Group",ignore_user_permissions:0,reference_doctype:"Customer"}}),U=await on.get("/api/method/mbw_dms.api.location.list_province");x(U.result);let{results:N}=B;u(N.map(j=>({label:j.value,value:j.value})))})()},[]);const P=async B=>{let U=m.find(N=>N.ten_tinh==B)?.ma_tinh;if(U){let N=await on.get("/api/method/mbw_dms.api.location.list_district",{params:{ma_tinh:U}});E(N.result)}},M=async B=>{let U=o.find(N=>N.ten_huyen==B)?.ma_huyen;if(U){let N=await on.get("/api/method/mbw_dms.api.location.list_ward",{params:{ma_quan_huyen:U}});C(N.result)}};return Je.jsxs(S0,{form:e,layout:"vertical",onFinish:a,children:[Je.jsx(Ni,{label:"Loại khách hàng",name:"customer_type",children:Je.jsx(is,{options:[{label:"Tất cả",value:!1},{label:"Company",value:"Company"},{label:"Individual",value:"Individual"}]})}),Je.jsx(Ni,{label:"Nhóm khách hàng",name:"customer_group",children:Je.jsx(is,{options:c})}),Je.jsx("p",{className:"font-medium text-sm",children:"Địa chỉ"}),Je.jsx(Ni,{label:"Tỉnh/Thành phố",name:"city",children:Je.jsx(is,{options:m.map(B=>({label:B.ten_tinh,value:B.ten_tinh})),onChange:P})}),Je.jsx(Ni,{label:"Quận/huyện",name:"district",children:Je.jsx(is,{options:o.map(B=>({label:B.ten_huyen,value:B.ten_huyen})),disabled:o.length==0,onChange:M})}),Je.jsx(Ni,{label:"Phường/xã",name:"ward",children:Je.jsx(is,{options:w.map(B=>({label:B.ten_xa,value:B.ten_xa})),disabled:w.length==0})})]})}const Ob=[...X0,{title:"Loại khách hàng",dataIndex:"customer_id",key:"customer_type"},{title:"Nhóm khách hàng",dataIndex:"customer_name",key:"customer_group"},...r1],Fm=e=>{let n=[];for(let a in e)e[a]&&(n=[...n,{key:[jw[a]],value:e[a],key2:a}]);return n};function Bb({selected:e,handleAdd:n,closeModal:a}){const[c]=vv(),[u,m]=he.useState([]),[x,o]=he.useState(Vw),[E,w]=he.useState({}),[C,P]=he.useState(!1),M=20,[B,U]=he.useState(1),[N,j]=he.useState(40),re={selectedRowKeys:u&&u.map(ye=>ye.customer_code),onChange:(ye,we)=>{m(we)}},pe=()=>{c.submit(),P(!1)},X=ye=>{if(ye){let we={...E};delete we[ye.key2],c.setFieldsValue(we),w(ae=>(delete ae[ye.key2],{...ae}))}else c.resetFields(),w({})};he.useEffect(()=>{(async()=>{const ye=await on.get("/api/method/mbw_dms.api.router.get_customer",{params:{...E,page_size:M,page_number:B}});o(ye?.result?.data),j(ye.result?.total)})()},[E,B]);const le=()=>{u.length>0&&n(ye=>{let we=e.map(ae=>ae.customer_code);return u.forEach(ae=>{we.includes(ae.customer_code)||(ye=[ae,...ye])}),[...ye]}),a()};return he.useEffect(()=>{m(e)},[e]),Je.jsxs(Je.Fragment,{children:[Je.jsxs(ho,{className:"justify-between",children:[Je.jsxs(Si,{className:"inline-flex ",children:[Je.jsx(Ni,{children:Je.jsx(Ch,{placeholder:"Tìm kiếm khách hàng",prefix:Je.jsx(Wg,{})})}),Je.jsxs("div",{className:"flex justify-center items-center ml-4",children:[Je.jsx(uo,{className:"flex items-center text-nowrap !text-[13px] !leading-[21px] !font-normal  border-r-[0.1px] rounded-r-none h-[36px]",icon:Je.jsx(Iv,{style:{fontSize:"20px"}}),onClick:P.bind(null,!0),children:"Bộ lọc"}),Je.jsx(uo,{className:"border-l-[0.1px] rounded-l-none h-[36px]",onClick:()=>X(),children:Je.jsx(Fv,{style:{fontSize:"20px"}})})]})]}),Je.jsxs(Si,{className:"inline-flex items-center",children:[Je.jsxs("span",{className:"mr-4",children:["Đã chọn ",u.length||0," khách hàng"]}),Je.jsx(uo,{type:"primary",onClick:le,children:"Thêm"})]})]}),Je.jsxs("div",{className:"py-5 px-4",children:[Je.jsxs("span",{children:[x.length," kết quả hiển thị"]}),Fm(E).length>0&&Je.jsx(ho,{className:"items-center",children:Fm(E).map(ye=>Je.jsxs(wv,{closeIcon:Je.jsx(Bg,{}),onClose:()=>{X(ye)},children:[ye.key,": ",ye.value]}))})]}),Je.jsx(G0,{scroll:{y:500},rowSelection:{type:"checkbox",...re},columns:Ob,dataSource:x.map(ye=>({key:ye.customer_code,...ye})),pagination:!1}),Je.jsx(ho,{className:"justify-end mt-2",children:Je.jsx(bv,{showSizeChanger:!1,defaultCurrent:B,pageSize:M,total:N,onChange:(ye,we)=>{U(ye)}})}),Je.jsx(k0,{width:451,title:"Bộ lọc",open:C,okText:"Áp dụng",cancelText:"Đặt lại",onCancel:P.bind(null,!1),onOk:pe,children:Je.jsx(Rb,{filter:E,setFilter:w,form:c})})]})}/*! xlsx.js (C) 2013-present SheetJS -- http://sheetjs.com */var s1=1252,zb=[874,932,936,949,950,1250,1251,1252,1253,1254,1255,1256,1257,1258,1e4],K0={0:1252,1:65001,2:65001,77:1e4,128:932,129:949,130:1361,134:936,136:950,161:1253,162:1254,163:1258,177:1255,178:1256,186:1257,204:1251,222:874,238:1250,255:1252,69:6969},Y0=function(e){zb.indexOf(e)!=-1&&(s1=K0[0]=e)};function Nb(){Y0(1252)}var En=function(e){Y0(e)};function o1(){En(1200),Nb()}function Pm(e){for(var n=[],a=0,c=e.length;a<c;++a)n[a]=e.charCodeAt(a);return n}function Ub(e){for(var n=[],a=0;a<e.length>>1;++a)n[a]=String.fromCharCode(e.charCodeAt(2*a)+(e.charCodeAt(2*a+1)<<8));return n.join("")}function l1(e){for(var n=[],a=0;a<e.length>>1;++a)n[a]=String.fromCharCode(e.charCodeAt(2*a+1)+(e.charCodeAt(2*a)<<8));return n.join("")}var Mc=function(e){var n=e.charCodeAt(0),a=e.charCodeAt(1);return n==255&&a==254?Ub(e.slice(2)):n==254&&a==255?l1(e.slice(2)):n==65279?e.slice(1):e},xh=function(n){return String.fromCharCode(n)},Mm=function(n){return String.fromCharCode(n)},Fs,Ms="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function Dm(e){for(var n="",a=0,c=0,u=0,m=0,x=0,o=0,E=0,w=0;w<e.length;)a=e.charCodeAt(w++),m=a>>2,c=e.charCodeAt(w++),x=(a&3)<<4|c>>4,u=e.charCodeAt(w++),o=(c&15)<<2|u>>6,E=u&63,isNaN(c)?o=E=64:isNaN(u)&&(E=64),n+=Ms.charAt(m)+Ms.charAt(x)+Ms.charAt(o)+Ms.charAt(E);return n}function Zi(e){var n="",a=0,c=0,u=0,m=0,x=0,o=0,E=0;e=e.replace(/[^\w\+\/\=]/g,"");for(var w=0;w<e.length;)m=Ms.indexOf(e.charAt(w++)),x=Ms.indexOf(e.charAt(w++)),a=m<<2|x>>4,n+=String.fromCharCode(a),o=Ms.indexOf(e.charAt(w++)),c=(x&15)<<4|o>>2,o!==64&&(n+=String.fromCharCode(c)),E=Ms.indexOf(e.charAt(w++)),u=(o&3)<<6|E,E!==64&&(n+=String.fromCharCode(u));return n}var kr=function(){return typeof Buffer<"u"&&typeof process<"u"&&typeof process.versions<"u"&&!!process.versions.node}(),vo=function(){if(typeof Buffer<"u"){var e=!Buffer.from;if(!e)try{Buffer.from("foo","utf8")}catch{e=!0}return e?function(n,a){return a?new Buffer(n,a):new Buffer(n)}:Buffer.from.bind(Buffer)}return function(){}}();function Os(e){return kr?Buffer.alloc?Buffer.alloc(e):new Buffer(e):typeof Uint8Array<"u"?new Uint8Array(e):new Array(e)}function Lm(e){return kr?Buffer.allocUnsafe?Buffer.allocUnsafe(e):new Buffer(e):typeof Uint8Array<"u"?new Uint8Array(e):new Array(e)}var Tn=function(n){return kr?vo(n,"binary"):n.split("").map(function(a){return a.charCodeAt(0)&255})};function wo(e){if(Array.isArray(e))return e.map(function(c){return String.fromCharCode(c)}).join("");for(var n=[],a=0;a<e.length;++a)n[a]=String.fromCharCode(e[a]);return n.join("")}function J0(e){if(typeof ArrayBuffer>"u")throw new Error("Unsupported");if(e instanceof ArrayBuffer)return J0(new Uint8Array(e));for(var n=new Array(e.length),a=0;a<e.length;++a)n[a]=e[a];return n}var Ps=kr?function(e){return Buffer.concat(e.map(function(n){return Buffer.isBuffer(n)?n:vo(n)}))}:function(e){if(typeof Uint8Array<"u"){var n=0,a=0;for(n=0;n<e.length;++n)a+=e[n].length;var c=new Uint8Array(a),u=0;for(n=0,a=0;n<e.length;a+=u,++n)if(u=e[n].length,e[n]instanceof Uint8Array)c.set(e[n],a);else{if(typeof e[n]=="string")throw"wtf";c.set(new Uint8Array(e[n]),a)}return c}return[].concat.apply([],e.map(function(m){return Array.isArray(m)?m:[].slice.call(m)}))};function Vb(e){for(var n=[],a=0,c=e.length+250,u=Os(e.length+255),m=0;m<e.length;++m){var x=e.charCodeAt(m);if(x<128)u[a++]=x;else if(x<2048)u[a++]=192|x>>6&31,u[a++]=128|x&63;else if(x>=55296&&x<57344){x=(x&1023)+64;var o=e.charCodeAt(++m)&1023;u[a++]=240|x>>8&7,u[a++]=128|x>>2&63,u[a++]=128|o>>6&15|(x&3)<<4,u[a++]=128|o&63}else u[a++]=224|x>>12&15,u[a++]=128|x>>6&63,u[a++]=128|x&63;a>c&&(n.push(u.slice(0,a)),a=0,u=Os(65535),c=65530)}return n.push(u.slice(0,a)),Ps(n)}var Ii=/\u0000/g,Dc=/[\u0001-\u0006]/g;function pl(e){for(var n="",a=e.length-1;a>=0;)n+=e.charAt(a--);return n}function Sn(e,n){var a=""+e;return a.length>=n?a:da("0",n-a.length)+a}function Q0(e,n){var a=""+e;return a.length>=n?a:da(" ",n-a.length)+a}function Mh(e,n){var a=""+e;return a.length>=n?a:a+da(" ",n-a.length)}function $b(e,n){var a=""+Math.round(e);return a.length>=n?a:da("0",n-a.length)+a}function jb(e,n){var a=""+e;return a.length>=n?a:da("0",n-a.length)+a}var Rm=Math.pow(2,32);function hl(e,n){if(e>Rm||e<-Rm)return $b(e,n);var a=Math.round(e);return jb(a,n)}function Dh(e,n){return n=n||0,e.length>=7+n&&(e.charCodeAt(n)|32)===103&&(e.charCodeAt(n+1)|32)===101&&(e.charCodeAt(n+2)|32)===110&&(e.charCodeAt(n+3)|32)===101&&(e.charCodeAt(n+4)|32)===114&&(e.charCodeAt(n+5)|32)===97&&(e.charCodeAt(n+6)|32)===108}var Om=[["Sun","Sunday"],["Mon","Monday"],["Tue","Tuesday"],["Wed","Wednesday"],["Thu","Thursday"],["Fri","Friday"],["Sat","Saturday"]],h0=[["J","Jan","January"],["F","Feb","February"],["M","Mar","March"],["A","Apr","April"],["M","May","May"],["J","Jun","June"],["J","Jul","July"],["A","Aug","August"],["S","Sep","September"],["O","Oct","October"],["N","Nov","November"],["D","Dec","December"]];function Gb(e){return e||(e={}),e[0]="General",e[1]="0",e[2]="0.00",e[3]="#,##0",e[4]="#,##0.00",e[9]="0%",e[10]="0.00%",e[11]="0.00E+00",e[12]="# ?/?",e[13]="# ??/??",e[14]="m/d/yy",e[15]="d-mmm-yy",e[16]="d-mmm",e[17]="mmm-yy",e[18]="h:mm AM/PM",e[19]="h:mm:ss AM/PM",e[20]="h:mm",e[21]="h:mm:ss",e[22]="m/d/yy h:mm",e[37]="#,##0 ;(#,##0)",e[38]="#,##0 ;[Red](#,##0)",e[39]="#,##0.00;(#,##0.00)",e[40]="#,##0.00;[Red](#,##0.00)",e[45]="mm:ss",e[46]="[h]:mm:ss",e[47]="mmss.0",e[48]="##0.0E+0",e[49]="@",e[56]='"上午/下午 "hh"時"mm"分"ss"秒 "',e}var gr={0:"General",1:"0",2:"0.00",3:"#,##0",4:"#,##0.00",9:"0%",10:"0.00%",11:"0.00E+00",12:"# ?/?",13:"# ??/??",14:"m/d/yy",15:"d-mmm-yy",16:"d-mmm",17:"mmm-yy",18:"h:mm AM/PM",19:"h:mm:ss AM/PM",20:"h:mm",21:"h:mm:ss",22:"m/d/yy h:mm",37:"#,##0 ;(#,##0)",38:"#,##0 ;[Red](#,##0)",39:"#,##0.00;(#,##0.00)",40:"#,##0.00;[Red](#,##0.00)",45:"mm:ss",46:"[h]:mm:ss",47:"mmss.0",48:"##0.0E+0",49:"@",56:'"上午/下午 "hh"時"mm"分"ss"秒 "'},Bm={5:37,6:38,7:39,8:40,23:0,24:0,25:0,26:0,27:14,28:14,29:14,30:14,31:14,50:14,51:14,52:14,53:14,54:14,55:14,56:14,57:14,58:14,59:1,60:2,61:3,62:4,67:9,68:10,69:12,70:13,71:14,72:14,73:15,74:16,75:17,76:20,77:21,78:22,79:45,80:46,81:47,82:0},Hb={5:'"$"#,##0_);\\("$"#,##0\\)',63:'"$"#,##0_);\\("$"#,##0\\)',6:'"$"#,##0_);[Red]\\("$"#,##0\\)',64:'"$"#,##0_);[Red]\\("$"#,##0\\)',7:'"$"#,##0.00_);\\("$"#,##0.00\\)',65:'"$"#,##0.00_);\\("$"#,##0.00\\)',8:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',66:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',41:'_(* #,##0_);_(* \\(#,##0\\);_(* "-"_);_(@_)',42:'_("$"* #,##0_);_("$"* \\(#,##0\\);_("$"* "-"_);_(@_)',43:'_(* #,##0.00_);_(* \\(#,##0.00\\);_(* "-"??_);_(@_)',44:'_("$"* #,##0.00_);_("$"* \\(#,##0.00\\);_("$"* "-"??_);_(@_)'};function Lh(e,n,a){for(var c=e<0?-1:1,u=e*c,m=0,x=1,o=0,E=1,w=0,C=0,P=Math.floor(u);w<n&&(P=Math.floor(u),o=P*x+m,C=P*w+E,!(u-P<5e-8));)u=1/(u-P),m=x,x=o,E=w,w=C;if(C>n&&(w>n?(C=E,o=m):(C=w,o=x)),!a)return[0,c*o,C];var M=Math.floor(c*o/C);return[M,c*o-M*C,C]}function co(e,n,a){if(e>2958465||e<0)return null;var c=e|0,u=Math.floor(86400*(e-c)),m=0,x=[],o={D:c,T:u,u:86400*(e-c)-u,y:0,m:0,d:0,H:0,M:0,S:0,q:0};if(Math.abs(o.u)<1e-6&&(o.u=0),n&&n.date1904&&(c+=1462),o.u>.9999&&(o.u=0,++u==86400&&(o.T=u=0,++c,++o.D)),c===60)x=a?[1317,10,29]:[1900,2,29],m=3;else if(c===0)x=a?[1317,8,29]:[1900,1,0],m=6;else{c>60&&--c;var E=new Date(1900,0,1);E.setDate(E.getDate()+c-1),x=[E.getFullYear(),E.getMonth()+1,E.getDate()],m=E.getDay(),c<60&&(m=(m+6)%7),a&&(m=Yb(E,x))}return o.y=x[0],o.m=x[1],o.d=x[2],o.S=u%60,u=Math.floor(u/60),o.M=u%60,u=Math.floor(u/60),o.H=u,o.q=m,o}var c1=new Date(1899,11,31,0,0,0),Wb=c1.getTime(),qb=new Date(1900,2,1,0,0,0);function u1(e,n){var a=e.getTime();return n?a-=1461*24*60*60*1e3:e>=qb&&(a+=24*60*60*1e3),(a-(Wb+(e.getTimezoneOffset()-c1.getTimezoneOffset())*6e4))/(24*60*60*1e3)}function ed(e){return e.indexOf(".")==-1?e:e.replace(/(?:\.0*|(\.\d*[1-9])0+)$/,"$1")}function Zb(e){return e.indexOf("E")==-1?e:e.replace(/(?:\.0*|(\.\d*[1-9])0+)[Ee]/,"$1E").replace(/(E[+-])(\d)$/,"$10$2")}function Xb(e){var n=e<0?12:11,a=ed(e.toFixed(12));return a.length<=n||(a=e.toPrecision(10),a.length<=n)?a:e.toExponential(5)}function Kb(e){var n=ed(e.toFixed(11));return n.length>(e<0?12:11)||n==="0"||n==="-0"?e.toPrecision(6):n}function Wc(e){var n=Math.floor(Math.log(Math.abs(e))*Math.LOG10E),a;return n>=-4&&n<=-1?a=e.toPrecision(10+n):Math.abs(n)<=9?a=Xb(e):n===10?a=e.toFixed(10).substr(0,12):a=Kb(e),ed(Zb(a.toUpperCase()))}function mo(e,n){switch(typeof e){case"string":return e;case"boolean":return e?"TRUE":"FALSE";case"number":return(e|0)===e?e.toString(10):Wc(e);case"undefined":return"";case"object":if(e==null)return"";if(e instanceof Date)return cn(14,u1(e,n&&n.date1904),n)}throw new Error("unsupported value in General format: "+e)}function Yb(e,n){n[0]-=581;var a=e.getDay();return e<60&&(a=(a+6)%7),a}function Jb(e,n,a,c){var u="",m=0,x=0,o=a.y,E,w=0;switch(e){case 98:o=a.y+543;case 121:switch(n.length){case 1:case 2:E=o%100,w=2;break;default:E=o%1e4,w=4;break}break;case 109:switch(n.length){case 1:case 2:E=a.m,w=n.length;break;case 3:return h0[a.m-1][1];case 5:return h0[a.m-1][0];default:return h0[a.m-1][2]}break;case 100:switch(n.length){case 1:case 2:E=a.d,w=n.length;break;case 3:return Om[a.q][0];default:return Om[a.q][1]}break;case 104:switch(n.length){case 1:case 2:E=1+(a.H+11)%12,w=n.length;break;default:throw"bad hour format: "+n}break;case 72:switch(n.length){case 1:case 2:E=a.H,w=n.length;break;default:throw"bad hour format: "+n}break;case 77:switch(n.length){case 1:case 2:E=a.M,w=n.length;break;default:throw"bad minute format: "+n}break;case 115:if(n!="s"&&n!="ss"&&n!=".0"&&n!=".00"&&n!=".000")throw"bad second format: "+n;return a.u===0&&(n=="s"||n=="ss")?Sn(a.S,n.length):(c>=2?x=c===3?1e3:100:x=c===1?10:1,m=Math.round(x*(a.S+a.u)),m>=60*x&&(m=0),n==="s"?m===0?"0":""+m/x:(u=Sn(m,2+c),n==="ss"?u.substr(0,2):"."+u.substr(2,n.length-1)));case 90:switch(n){case"[h]":case"[hh]":E=a.D*24+a.H;break;case"[m]":case"[mm]":E=(a.D*24+a.H)*60+a.M;break;case"[s]":case"[ss]":E=((a.D*24+a.H)*60+a.M)*60+Math.round(a.S+a.u);break;default:throw"bad abstime format: "+n}w=n.length===3?1:2;break;case 101:E=o,w=1;break}var C=w>0?Sn(E,w):"";return C}function Ds(e){var n=3;if(e.length<=n)return e;for(var a=e.length%n,c=e.substr(0,a);a!=e.length;a+=n)c+=(c.length>0?",":"")+e.substr(a,n);return c}var h1=/%/g;function Qb(e,n,a){var c=n.replace(h1,""),u=n.length-c.length;return ss(e,c,a*Math.pow(10,2*u))+da("%",u)}function eT(e,n,a){for(var c=n.length-1;n.charCodeAt(c-1)===44;)--c;return ss(e,n.substr(0,c),a/Math.pow(10,3*(n.length-c)))}function f1(e,n){var a,c=e.indexOf("E")-e.indexOf(".")-1;if(e.match(/^#+0.0E\+0$/)){if(n==0)return"0.0E+0";if(n<0)return"-"+f1(e,-n);var u=e.indexOf(".");u===-1&&(u=e.indexOf("E"));var m=Math.floor(Math.log(n)*Math.LOG10E)%u;if(m<0&&(m+=u),a=(n/Math.pow(10,m)).toPrecision(c+1+(u+m)%u),a.indexOf("e")===-1){var x=Math.floor(Math.log(n)*Math.LOG10E);for(a.indexOf(".")===-1?a=a.charAt(0)+"."+a.substr(1)+"E+"+(x-a.length+m):a+="E+"+(x-m);a.substr(0,2)==="0.";)a=a.charAt(0)+a.substr(2,u)+"."+a.substr(2+u),a=a.replace(/^0+([1-9])/,"$1").replace(/^0+\./,"0.");a=a.replace(/\+-/,"-")}a=a.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(o,E,w,C){return E+w+C.substr(0,(u+m)%u)+"."+C.substr(m)+"E"})}else a=n.toExponential(c);return e.match(/E\+00$/)&&a.match(/e[+-]\d$/)&&(a=a.substr(0,a.length-1)+"0"+a.charAt(a.length-1)),e.match(/E\-/)&&a.match(/e\+/)&&(a=a.replace(/e\+/,"e")),a.replace("e","E")}var d1=/# (\?+)( ?)\/( ?)(\d+)/;function tT(e,n,a){var c=parseInt(e[4],10),u=Math.round(n*c),m=Math.floor(u/c),x=u-m*c,o=c;return a+(m===0?"":""+m)+" "+(x===0?da(" ",e[1].length+1+e[4].length):Q0(x,e[1].length)+e[2]+"/"+e[3]+Sn(o,e[4].length))}function rT(e,n,a){return a+(n===0?"":""+n)+da(" ",e[1].length+2+e[4].length)}var p1=/^#*0*\.([0#]+)/,m1=/\).*[0#]/,g1=/\(###\) ###\\?-####/;function Ei(e){for(var n="",a,c=0;c!=e.length;++c)switch(a=e.charCodeAt(c)){case 35:break;case 63:n+=" ";break;case 48:n+="0";break;default:n+=String.fromCharCode(a)}return n}function zm(e,n){var a=Math.pow(10,n);return""+Math.round(e*a)/a}function Nm(e,n){var a=e-Math.floor(e),c=Math.pow(10,n);return n<(""+Math.round(a*c)).length?0:Math.round(a*c)}function aT(e,n){return n<(""+Math.round((e-Math.floor(e))*Math.pow(10,n))).length?1:0}function iT(e){return e<2147483647&&e>-2147483648?""+(e>=0?e|0:e-1|0):""+Math.floor(e)}function nn(e,n,a){if(e.charCodeAt(0)===40&&!n.match(m1)){var c=n.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return a>=0?nn("n",c,a):"("+nn("n",c,-a)+")"}if(n.charCodeAt(n.length-1)===44)return eT(e,n,a);if(n.indexOf("%")!==-1)return Qb(e,n,a);if(n.indexOf("E")!==-1)return f1(n,a);if(n.charCodeAt(0)===36)return"$"+nn(e,n.substr(n.charAt(1)==" "?2:1),a);var u,m,x,o,E=Math.abs(a),w=a<0?"-":"";if(n.match(/^00+$/))return w+hl(E,n.length);if(n.match(/^[#?]+$/))return u=hl(a,0),u==="0"&&(u=""),u.length>n.length?u:Ei(n.substr(0,n.length-u.length))+u;if(m=n.match(d1))return tT(m,E,w);if(n.match(/^#+0+$/))return w+hl(E,n.length-n.indexOf("0"));if(m=n.match(p1))return u=zm(a,m[1].length).replace(/^([^\.]+)$/,"$1."+Ei(m[1])).replace(/\.$/,"."+Ei(m[1])).replace(/\.(\d*)$/,function(U,N){return"."+N+da("0",Ei(m[1]).length-N.length)}),n.indexOf("0.")!==-1?u:u.replace(/^0\./,".");if(n=n.replace(/^#+([0.])/,"$1"),m=n.match(/^(0*)\.(#*)$/))return w+zm(E,m[2].length).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,m[1].length?"0.":".");if(m=n.match(/^#{1,3},##0(\.?)$/))return w+Ds(hl(E,0));if(m=n.match(/^#,##0\.([#0]*0)$/))return a<0?"-"+nn(e,n,-a):Ds(""+(Math.floor(a)+aT(a,m[1].length)))+"."+Sn(Nm(a,m[1].length),m[1].length);if(m=n.match(/^#,#*,#0/))return nn(e,n.replace(/^#,#*,/,""),a);if(m=n.match(/^([0#]+)(\\?-([0#]+))+$/))return u=pl(nn(e,n.replace(/[\\-]/g,""),a)),x=0,pl(pl(n.replace(/\\/g,"")).replace(/[0#]/g,function(U){return x<u.length?u.charAt(x++):U==="0"?"0":""}));if(n.match(g1))return u=nn(e,"##########",a),"("+u.substr(0,3)+") "+u.substr(3,3)+"-"+u.substr(6);var C="";if(m=n.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return x=Math.min(m[4].length,7),o=Lh(E,Math.pow(10,x)-1,!1),u=""+w,C=ss("n",m[1],o[1]),C.charAt(C.length-1)==" "&&(C=C.substr(0,C.length-1)+"0"),u+=C+m[2]+"/"+m[3],C=Mh(o[2],x),C.length<m[4].length&&(C=Ei(m[4].substr(m[4].length-C.length))+C),u+=C,u;if(m=n.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return x=Math.min(Math.max(m[1].length,m[4].length),7),o=Lh(E,Math.pow(10,x)-1,!0),w+(o[0]||(o[1]?"":"0"))+" "+(o[1]?Q0(o[1],x)+m[2]+"/"+m[3]+Mh(o[2],x):da(" ",2*x+1+m[2].length+m[3].length));if(m=n.match(/^[#0?]+$/))return u=hl(a,0),n.length<=u.length?u:Ei(n.substr(0,n.length-u.length))+u;if(m=n.match(/^([#0?]+)\.([#0]+)$/)){u=""+a.toFixed(Math.min(m[2].length,10)).replace(/([^0])0+$/,"$1"),x=u.indexOf(".");var P=n.indexOf(".")-x,M=n.length-u.length-P;return Ei(n.substr(0,P)+u+n.substr(n.length-M))}if(m=n.match(/^00,000\.([#0]*0)$/))return x=Nm(a,m[1].length),a<0?"-"+nn(e,n,-a):Ds(iT(a)).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(U){return"00,"+(U.length<3?Sn(0,3-U.length):"")+U})+"."+Sn(x,m[1].length);switch(n){case"###,##0.00":return nn(e,"#,##0.00",a);case"###,###":case"##,###":case"#,###":var B=Ds(hl(E,0));return B!=="0"?w+B:"";case"###,###.00":return nn(e,"###,##0.00",a).replace(/^0\./,".");case"#,###.00":return nn(e,"#,##0.00",a).replace(/^0\./,".")}throw new Error("unsupported format |"+n+"|")}function nT(e,n,a){for(var c=n.length-1;n.charCodeAt(c-1)===44;)--c;return ss(e,n.substr(0,c),a/Math.pow(10,3*(n.length-c)))}function sT(e,n,a){var c=n.replace(h1,""),u=n.length-c.length;return ss(e,c,a*Math.pow(10,2*u))+da("%",u)}function x1(e,n){var a,c=e.indexOf("E")-e.indexOf(".")-1;if(e.match(/^#+0.0E\+0$/)){if(n==0)return"0.0E+0";if(n<0)return"-"+x1(e,-n);var u=e.indexOf(".");u===-1&&(u=e.indexOf("E"));var m=Math.floor(Math.log(n)*Math.LOG10E)%u;if(m<0&&(m+=u),a=(n/Math.pow(10,m)).toPrecision(c+1+(u+m)%u),!a.match(/[Ee]/)){var x=Math.floor(Math.log(n)*Math.LOG10E);a.indexOf(".")===-1?a=a.charAt(0)+"."+a.substr(1)+"E+"+(x-a.length+m):a+="E+"+(x-m),a=a.replace(/\+-/,"-")}a=a.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(o,E,w,C){return E+w+C.substr(0,(u+m)%u)+"."+C.substr(m)+"E"})}else a=n.toExponential(c);return e.match(/E\+00$/)&&a.match(/e[+-]\d$/)&&(a=a.substr(0,a.length-1)+"0"+a.charAt(a.length-1)),e.match(/E\-/)&&a.match(/e\+/)&&(a=a.replace(/e\+/,"e")),a.replace("e","E")}function Bn(e,n,a){if(e.charCodeAt(0)===40&&!n.match(m1)){var c=n.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return a>=0?Bn("n",c,a):"("+Bn("n",c,-a)+")"}if(n.charCodeAt(n.length-1)===44)return nT(e,n,a);if(n.indexOf("%")!==-1)return sT(e,n,a);if(n.indexOf("E")!==-1)return x1(n,a);if(n.charCodeAt(0)===36)return"$"+Bn(e,n.substr(n.charAt(1)==" "?2:1),a);var u,m,x,o,E=Math.abs(a),w=a<0?"-":"";if(n.match(/^00+$/))return w+Sn(E,n.length);if(n.match(/^[#?]+$/))return u=""+a,a===0&&(u=""),u.length>n.length?u:Ei(n.substr(0,n.length-u.length))+u;if(m=n.match(d1))return rT(m,E,w);if(n.match(/^#+0+$/))return w+Sn(E,n.length-n.indexOf("0"));if(m=n.match(p1))return u=(""+a).replace(/^([^\.]+)$/,"$1."+Ei(m[1])).replace(/\.$/,"."+Ei(m[1])),u=u.replace(/\.(\d*)$/,function(U,N){return"."+N+da("0",Ei(m[1]).length-N.length)}),n.indexOf("0.")!==-1?u:u.replace(/^0\./,".");if(n=n.replace(/^#+([0.])/,"$1"),m=n.match(/^(0*)\.(#*)$/))return w+(""+E).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,m[1].length?"0.":".");if(m=n.match(/^#{1,3},##0(\.?)$/))return w+Ds(""+E);if(m=n.match(/^#,##0\.([#0]*0)$/))return a<0?"-"+Bn(e,n,-a):Ds(""+a)+"."+da("0",m[1].length);if(m=n.match(/^#,#*,#0/))return Bn(e,n.replace(/^#,#*,/,""),a);if(m=n.match(/^([0#]+)(\\?-([0#]+))+$/))return u=pl(Bn(e,n.replace(/[\\-]/g,""),a)),x=0,pl(pl(n.replace(/\\/g,"")).replace(/[0#]/g,function(U){return x<u.length?u.charAt(x++):U==="0"?"0":""}));if(n.match(g1))return u=Bn(e,"##########",a),"("+u.substr(0,3)+") "+u.substr(3,3)+"-"+u.substr(6);var C="";if(m=n.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return x=Math.min(m[4].length,7),o=Lh(E,Math.pow(10,x)-1,!1),u=""+w,C=ss("n",m[1],o[1]),C.charAt(C.length-1)==" "&&(C=C.substr(0,C.length-1)+"0"),u+=C+m[2]+"/"+m[3],C=Mh(o[2],x),C.length<m[4].length&&(C=Ei(m[4].substr(m[4].length-C.length))+C),u+=C,u;if(m=n.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return x=Math.min(Math.max(m[1].length,m[4].length),7),o=Lh(E,Math.pow(10,x)-1,!0),w+(o[0]||(o[1]?"":"0"))+" "+(o[1]?Q0(o[1],x)+m[2]+"/"+m[3]+Mh(o[2],x):da(" ",2*x+1+m[2].length+m[3].length));if(m=n.match(/^[#0?]+$/))return u=""+a,n.length<=u.length?u:Ei(n.substr(0,n.length-u.length))+u;if(m=n.match(/^([#0]+)\.([#0]+)$/)){u=""+a.toFixed(Math.min(m[2].length,10)).replace(/([^0])0+$/,"$1"),x=u.indexOf(".");var P=n.indexOf(".")-x,M=n.length-u.length-P;return Ei(n.substr(0,P)+u+n.substr(n.length-M))}if(m=n.match(/^00,000\.([#0]*0)$/))return a<0?"-"+Bn(e,n,-a):Ds(""+a).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(U){return"00,"+(U.length<3?Sn(0,3-U.length):"")+U})+"."+Sn(0,m[1].length);switch(n){case"###,###":case"##,###":case"#,###":var B=Ds(""+E);return B!=="0"?w+B:"";default:if(n.match(/\.[0#?]*$/))return Bn(e,n.slice(0,n.lastIndexOf(".")),a)+Ei(n.slice(n.lastIndexOf(".")))}throw new Error("unsupported format |"+n+"|")}function ss(e,n,a){return(a|0)===a?Bn(e,n,a):nn(e,n,a)}function oT(e){for(var n=[],a=!1,c=0,u=0;c<e.length;++c)switch(e.charCodeAt(c)){case 34:a=!a;break;case 95:case 42:case 92:++c;break;case 59:n[n.length]=e.substr(u,c-u),u=c+1}if(n[n.length]=e.substr(u),a===!0)throw new Error("Format |"+e+"| unterminated string ");return n}var _1=/\[[HhMmSs\u0E0A\u0E19\u0E17]*\]/;function bl(e){for(var n=0,a="",c="";n<e.length;)switch(a=e.charAt(n)){case"G":Dh(e,n)&&(n+=6),n++;break;case'"':for(;e.charCodeAt(++n)!==34&&n<e.length;);++n;break;case"\\":n+=2;break;case"_":n+=2;break;case"@":++n;break;case"B":case"b":if(e.charAt(n+1)==="1"||e.charAt(n+1)==="2")return!0;case"M":case"D":case"Y":case"H":case"S":case"E":case"m":case"d":case"y":case"h":case"s":case"e":case"g":return!0;case"A":case"a":case"上":if(e.substr(n,3).toUpperCase()==="A/P"||e.substr(n,5).toUpperCase()==="AM/PM"||e.substr(n,5).toUpperCase()==="上午/下午")return!0;++n;break;case"[":for(c=a;e.charAt(n++)!=="]"&&n<e.length;)c+=e.charAt(n);if(c.match(_1))return!0;break;case".":case"0":case"#":for(;n<e.length&&("0#?.,E+-%".indexOf(a=e.charAt(++n))>-1||a=="\\"&&e.charAt(n+1)=="-"&&"0#".indexOf(e.charAt(n+2))>-1););break;case"?":for(;e.charAt(++n)===a;);break;case"*":++n,(e.charAt(n)==" "||e.charAt(n)=="*")&&++n;break;case"(":case")":++n;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(;n<e.length&&"0123456789".indexOf(e.charAt(++n))>-1;);break;case" ":++n;break;default:++n;break}return!1}function lT(e,n,a,c){for(var u=[],m="",x=0,o="",E="t",w,C,P,M="H";x<e.length;)switch(o=e.charAt(x)){case"G":if(!Dh(e,x))throw new Error("unrecognized character "+o+" in "+e);u[u.length]={t:"G",v:"General"},x+=7;break;case'"':for(m="";(P=e.charCodeAt(++x))!==34&&x<e.length;)m+=String.fromCharCode(P);u[u.length]={t:"t",v:m},++x;break;case"\\":var B=e.charAt(++x),U=B==="("||B===")"?B:"t";u[u.length]={t:U,v:B},++x;break;case"_":u[u.length]={t:"t",v:" "},x+=2;break;case"@":u[u.length]={t:"T",v:n},++x;break;case"B":case"b":if(e.charAt(x+1)==="1"||e.charAt(x+1)==="2"){if(w==null&&(w=co(n,a,e.charAt(x+1)==="2"),w==null))return"";u[u.length]={t:"X",v:e.substr(x,2)},E=o,x+=2;break}case"M":case"D":case"Y":case"H":case"S":case"E":o=o.toLowerCase();case"m":case"d":case"y":case"h":case"s":case"e":case"g":if(n<0||w==null&&(w=co(n,a),w==null))return"";for(m=o;++x<e.length&&e.charAt(x).toLowerCase()===o;)m+=o;o==="m"&&E.toLowerCase()==="h"&&(o="M"),o==="h"&&(o=M),u[u.length]={t:o,v:m},E=o;break;case"A":case"a":case"上":var N={t:o,v:o};if(w==null&&(w=co(n,a)),e.substr(x,3).toUpperCase()==="A/P"?(w!=null&&(N.v=w.H>=12?"P":"A"),N.t="T",M="h",x+=3):e.substr(x,5).toUpperCase()==="AM/PM"?(w!=null&&(N.v=w.H>=12?"PM":"AM"),N.t="T",x+=5,M="h"):e.substr(x,5).toUpperCase()==="上午/下午"?(w!=null&&(N.v=w.H>=12?"下午":"上午"),N.t="T",x+=5,M="h"):(N.t="t",++x),w==null&&N.t==="T")return"";u[u.length]=N,E=o;break;case"[":for(m=o;e.charAt(x++)!=="]"&&x<e.length;)m+=e.charAt(x);if(m.slice(-1)!=="]")throw'unterminated "[" block: |'+m+"|";if(m.match(_1)){if(w==null&&(w=co(n,a),w==null))return"";u[u.length]={t:"Z",v:m.toLowerCase()},E=m.charAt(1)}else m.indexOf("$")>-1&&(m=(m.match(/\$([^-\[\]]*)/)||[])[1]||"$",bl(e)||(u[u.length]={t:"t",v:m}));break;case".":if(w!=null){for(m=o;++x<e.length&&(o=e.charAt(x))==="0";)m+=o;u[u.length]={t:"s",v:m};break}case"0":case"#":for(m=o;++x<e.length&&"0#?.,E+-%".indexOf(o=e.charAt(x))>-1;)m+=o;u[u.length]={t:"n",v:m};break;case"?":for(m=o;e.charAt(++x)===o;)m+=o;u[u.length]={t:o,v:m},E=o;break;case"*":++x,(e.charAt(x)==" "||e.charAt(x)=="*")&&++x;break;case"(":case")":u[u.length]={t:c===1?"t":o,v:o},++x;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(m=o;x<e.length&&"0123456789".indexOf(e.charAt(++x))>-1;)m+=e.charAt(x);u[u.length]={t:"D",v:m};break;case" ":u[u.length]={t:o,v:o},++x;break;case"$":u[u.length]={t:"t",v:"$"},++x;break;default:if(",$-+/():!^&'~{}<>=€acfijklopqrtuvwxzP".indexOf(o)===-1)throw new Error("unrecognized character "+o+" in "+e);u[u.length]={t:"t",v:o},++x;break}var j=0,re=0,pe;for(x=u.length-1,E="t";x>=0;--x)switch(u[x].t){case"h":case"H":u[x].t=M,E="h",j<1&&(j=1);break;case"s":(pe=u[x].v.match(/\.0+$/))&&(re=Math.max(re,pe[0].length-1)),j<3&&(j=3);case"d":case"y":case"M":case"e":E=u[x].t;break;case"m":E==="s"&&(u[x].t="M",j<2&&(j=2));break;case"X":break;case"Z":j<1&&u[x].v.match(/[Hh]/)&&(j=1),j<2&&u[x].v.match(/[Mm]/)&&(j=2),j<3&&u[x].v.match(/[Ss]/)&&(j=3)}switch(j){case 0:break;case 1:w.u>=.5&&(w.u=0,++w.S),w.S>=60&&(w.S=0,++w.M),w.M>=60&&(w.M=0,++w.H);break;case 2:w.u>=.5&&(w.u=0,++w.S),w.S>=60&&(w.S=0,++w.M);break}var X="",le;for(x=0;x<u.length;++x)switch(u[x].t){case"t":case"T":case" ":case"D":break;case"X":u[x].v="",u[x].t=";";break;case"d":case"m":case"y":case"h":case"H":case"M":case"s":case"e":case"b":case"Z":u[x].v=Jb(u[x].t.charCodeAt(0),u[x].v,w,re),u[x].t="t";break;case"n":case"?":for(le=x+1;u[le]!=null&&((o=u[le].t)==="?"||o==="D"||(o===" "||o==="t")&&u[le+1]!=null&&(u[le+1].t==="?"||u[le+1].t==="t"&&u[le+1].v==="/")||u[x].t==="("&&(o===" "||o==="n"||o===")")||o==="t"&&(u[le].v==="/"||u[le].v===" "&&u[le+1]!=null&&u[le+1].t=="?"));)u[x].v+=u[le].v,u[le]={v:"",t:";"},++le;X+=u[x].v,x=le-1;break;case"G":u[x].t="t",u[x].v=mo(n,a);break}var ye="",we,ae;if(X.length>0){X.charCodeAt(0)==40?(we=n<0&&X.charCodeAt(0)===45?-n:n,ae=ss("n",X,we)):(we=n<0&&c>1?-n:n,ae=ss("n",X,we),we<0&&u[0]&&u[0].t=="t"&&(ae=ae.substr(1),u[0].v="-"+u[0].v)),le=ae.length-1;var ze=u.length;for(x=0;x<u.length;++x)if(u[x]!=null&&u[x].t!="t"&&u[x].v.indexOf(".")>-1){ze=x;break}var Ie=u.length;if(ze===u.length&&ae.indexOf("E")===-1){for(x=u.length-1;x>=0;--x)u[x]==null||"n?".indexOf(u[x].t)===-1||(le>=u[x].v.length-1?(le-=u[x].v.length,u[x].v=ae.substr(le+1,u[x].v.length)):le<0?u[x].v="":(u[x].v=ae.substr(0,le+1),le=-1),u[x].t="t",Ie=x);le>=0&&Ie<u.length&&(u[Ie].v=ae.substr(0,le+1)+u[Ie].v)}else if(ze!==u.length&&ae.indexOf("E")===-1){for(le=ae.indexOf(".")-1,x=ze;x>=0;--x)if(!(u[x]==null||"n?".indexOf(u[x].t)===-1)){for(C=u[x].v.indexOf(".")>-1&&x===ze?u[x].v.indexOf(".")-1:u[x].v.length-1,ye=u[x].v.substr(C+1);C>=0;--C)le>=0&&(u[x].v.charAt(C)==="0"||u[x].v.charAt(C)==="#")&&(ye=ae.charAt(le--)+ye);u[x].v=ye,u[x].t="t",Ie=x}for(le>=0&&Ie<u.length&&(u[Ie].v=ae.substr(0,le+1)+u[Ie].v),le=ae.indexOf(".")+1,x=ze;x<u.length;++x)if(!(u[x]==null||"n?(".indexOf(u[x].t)===-1&&x!==ze)){for(C=u[x].v.indexOf(".")>-1&&x===ze?u[x].v.indexOf(".")+1:0,ye=u[x].v.substr(0,C);C<u[x].v.length;++C)le<ae.length&&(ye+=ae.charAt(le++));u[x].v=ye,u[x].t="t",Ie=x}}}for(x=0;x<u.length;++x)u[x]!=null&&"n?".indexOf(u[x].t)>-1&&(we=c>1&&n<0&&x>0&&u[x-1].v==="-"?-n:n,u[x].v=ss(u[x].t,u[x].v,we),u[x].t="t");var $e="";for(x=0;x!==u.length;++x)u[x]!=null&&($e+=u[x].v);return $e}var Um=/\[(=|>[=]?|<[>=]?)(-?\d+(?:\.\d*)?)\]/;function Vm(e,n){if(n==null)return!1;var a=parseFloat(n[2]);switch(n[1]){case"=":if(e==a)return!0;break;case">":if(e>a)return!0;break;case"<":if(e<a)return!0;break;case"<>":if(e!=a)return!0;break;case">=":if(e>=a)return!0;break;case"<=":if(e<=a)return!0;break}return!1}function cT(e,n){var a=oT(e),c=a.length,u=a[c-1].indexOf("@");if(c<4&&u>-1&&--c,a.length>4)throw new Error("cannot find right format for |"+a.join("|")+"|");if(typeof n!="number")return[4,a.length===4||u>-1?a[a.length-1]:"@"];switch(a.length){case 1:a=u>-1?["General","General","General",a[0]]:[a[0],a[0],a[0],"@"];break;case 2:a=u>-1?[a[0],a[0],a[0],a[1]]:[a[0],a[1],a[0],"@"];break;case 3:a=u>-1?[a[0],a[1],a[0],a[2]]:[a[0],a[1],a[2],"@"];break}var m=n>0?a[0]:n<0?a[1]:a[2];if(a[0].indexOf("[")===-1&&a[1].indexOf("[")===-1)return[c,m];if(a[0].match(/\[[=<>]/)!=null||a[1].match(/\[[=<>]/)!=null){var x=a[0].match(Um),o=a[1].match(Um);return Vm(n,x)?[c,a[0]]:Vm(n,o)?[c,a[1]]:[c,a[x!=null&&o!=null?2:1]]}return[c,m]}function cn(e,n,a){a==null&&(a={});var c="";switch(typeof e){case"string":e=="m/d/yy"&&a.dateNF?c=a.dateNF:c=e;break;case"number":e==14&&a.dateNF?c=a.dateNF:c=(a.table!=null?a.table:gr)[e],c==null&&(c=a.table&&a.table[Bm[e]]||gr[Bm[e]]),c==null&&(c=Hb[e]||"General");break}if(Dh(c,0))return mo(n,a);n instanceof Date&&(n=u1(n,a.date1904));var u=cT(c,n);if(Dh(u[1]))return mo(n,a);if(n===!0)n="TRUE";else if(n===!1)n="FALSE";else if(n===""||n==null)return"";return lT(u[1],n,a,u[0])}function fo(e,n){if(typeof n!="number"){n=+n||-1;for(var a=0;a<392;++a){if(gr[a]==null){n<0&&(n=a);continue}if(gr[a]==e){n=a;break}}n<0&&(n=391)}return gr[n]=e,n}function y1(){gr=Gb()}var uT={5:'"$"#,##0_);\\("$"#,##0\\)',6:'"$"#,##0_);[Red]\\("$"#,##0\\)',7:'"$"#,##0.00_);\\("$"#,##0.00\\)',8:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',23:"General",24:"General",25:"General",26:"General",27:"m/d/yy",28:"m/d/yy",29:"m/d/yy",30:"m/d/yy",31:"m/d/yy",32:"h:mm:ss",33:"h:mm:ss",34:"h:mm:ss",35:"h:mm:ss",36:"m/d/yy",41:'_(* #,##0_);_(* (#,##0);_(* "-"_);_(@_)',42:'_("$"* #,##0_);_("$"* (#,##0);_("$"* "-"_);_(@_)',43:'_(* #,##0.00_);_(* (#,##0.00);_(* "-"??_);_(@_)',44:'_("$"* #,##0.00_);_("$"* (#,##0.00);_("$"* "-"??_);_(@_)',50:"m/d/yy",51:"m/d/yy",52:"m/d/yy",53:"m/d/yy",54:"m/d/yy",55:"m/d/yy",56:"m/d/yy",57:"m/d/yy",58:"m/d/yy",59:"0",60:"0.00",61:"#,##0",62:"#,##0.00",63:'"$"#,##0_);\\("$"#,##0\\)',64:'"$"#,##0_);[Red]\\("$"#,##0\\)',65:'"$"#,##0.00_);\\("$"#,##0.00\\)',66:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',67:"0%",68:"0.00%",69:"# ?/?",70:"# ??/??",71:"m/d/yy",72:"m/d/yy",73:"d-mmm-yy",74:"d-mmm",75:"mmm-yy",76:"h:mm",77:"h:mm:ss",78:"m/d/yy h:mm",79:"mm:ss",80:"[h]:mm:ss",81:"mmss.0"},v1=/[dD]+|[mM]+|[yYeE]+|[Hh]+|[Ss]+/g;function hT(e){var n=typeof e=="number"?gr[e]:e;return n=n.replace(v1,"(\\d+)"),new RegExp("^"+n+"$")}function fT(e,n,a){var c=-1,u=-1,m=-1,x=-1,o=-1,E=-1;(n.match(v1)||[]).forEach(function(P,M){var B=parseInt(a[M+1],10);switch(P.toLowerCase().charAt(0)){case"y":c=B;break;case"d":m=B;break;case"h":x=B;break;case"s":E=B;break;case"m":x>=0?o=B:u=B;break}}),E>=0&&o==-1&&u>=0&&(o=u,u=-1);var w=(""+(c>=0?c:new Date().getFullYear())).slice(-4)+"-"+("00"+(u>=1?u:1)).slice(-2)+"-"+("00"+(m>=1?m:1)).slice(-2);w.length==7&&(w="0"+w),w.length==8&&(w="20"+w);var C=("00"+(x>=0?x:0)).slice(-2)+":"+("00"+(o>=0?o:0)).slice(-2)+":"+("00"+(E>=0?E:0)).slice(-2);return x==-1&&o==-1&&E==-1?w:c==-1&&u==-1&&m==-1?C:w+"T"+C}var dT=function(){var e={};e.version="1.2.0";function n(){for(var ae=0,ze=new Array(256),Ie=0;Ie!=256;++Ie)ae=Ie,ae=ae&1?-306674912^ae>>>1:ae>>>1,ae=ae&1?-306674912^ae>>>1:ae>>>1,ae=ae&1?-306674912^ae>>>1:ae>>>1,ae=ae&1?-306674912^ae>>>1:ae>>>1,ae=ae&1?-306674912^ae>>>1:ae>>>1,ae=ae&1?-306674912^ae>>>1:ae>>>1,ae=ae&1?-306674912^ae>>>1:ae>>>1,ae=ae&1?-306674912^ae>>>1:ae>>>1,ze[Ie]=ae;return typeof Int32Array<"u"?new Int32Array(ze):ze}var a=n();function c(ae){var ze=0,Ie=0,$e=0,je=typeof Int32Array<"u"?new Int32Array(4096):new Array(4096);for($e=0;$e!=256;++$e)je[$e]=ae[$e];for($e=0;$e!=256;++$e)for(Ie=ae[$e],ze=256+$e;ze<4096;ze+=256)Ie=je[ze]=Ie>>>8^ae[Ie&255];var Le=[];for($e=1;$e!=16;++$e)Le[$e-1]=typeof Int32Array<"u"?je.subarray($e*256,$e*256+256):je.slice($e*256,$e*256+256);return Le}var u=c(a),m=u[0],x=u[1],o=u[2],E=u[3],w=u[4],C=u[5],P=u[6],M=u[7],B=u[8],U=u[9],N=u[10],j=u[11],re=u[12],pe=u[13],X=u[14];function le(ae,ze){for(var Ie=ze^-1,$e=0,je=ae.length;$e<je;)Ie=Ie>>>8^a[(Ie^ae.charCodeAt($e++))&255];return~Ie}function ye(ae,ze){for(var Ie=ze^-1,$e=ae.length-15,je=0;je<$e;)Ie=X[ae[je++]^Ie&255]^pe[ae[je++]^Ie>>8&255]^re[ae[je++]^Ie>>16&255]^j[ae[je++]^Ie>>>24]^N[ae[je++]]^U[ae[je++]]^B[ae[je++]]^M[ae[je++]]^P[ae[je++]]^C[ae[je++]]^w[ae[je++]]^E[ae[je++]]^o[ae[je++]]^x[ae[je++]]^m[ae[je++]]^a[ae[je++]];for($e+=15;je<$e;)Ie=Ie>>>8^a[(Ie^ae[je++])&255];return~Ie}function we(ae,ze){for(var Ie=ze^-1,$e=0,je=ae.length,Le=0,it=0;$e<je;)Le=ae.charCodeAt($e++),Le<128?Ie=Ie>>>8^a[(Ie^Le)&255]:Le<2048?(Ie=Ie>>>8^a[(Ie^(192|Le>>6&31))&255],Ie=Ie>>>8^a[(Ie^(128|Le&63))&255]):Le>=55296&&Le<57344?(Le=(Le&1023)+64,it=ae.charCodeAt($e++)&1023,Ie=Ie>>>8^a[(Ie^(240|Le>>8&7))&255],Ie=Ie>>>8^a[(Ie^(128|Le>>2&63))&255],Ie=Ie>>>8^a[(Ie^(128|it>>6&15|(Le&3)<<4))&255],Ie=Ie>>>8^a[(Ie^(128|it&63))&255]):(Ie=Ie>>>8^a[(Ie^(224|Le>>12&15))&255],Ie=Ie>>>8^a[(Ie^(128|Le>>6&63))&255],Ie=Ie>>>8^a[(Ie^(128|Le&63))&255]);return~Ie}return e.table=a,e.bstr=le,e.buf=ye,e.str=we,e}(),Ir=function(){var n={};n.version="1.2.1";function a(z,Q){for(var Y=z.split("/"),K=Q.split("/"),ee=0,J=0,Ae=Math.min(Y.length,K.length);ee<Ae;++ee){if(J=Y[ee].length-K[ee].length)return J;if(Y[ee]!=K[ee])return Y[ee]<K[ee]?-1:1}return Y.length-K.length}function c(z){if(z.charAt(z.length-1)=="/")return z.slice(0,-1).indexOf("/")===-1?z:c(z.slice(0,-1));var Q=z.lastIndexOf("/");return Q===-1?z:z.slice(0,Q+1)}function u(z){if(z.charAt(z.length-1)=="/")return u(z.slice(0,-1));var Q=z.lastIndexOf("/");return Q===-1?z:z.slice(Q+1)}function m(z,Q){typeof Q=="string"&&(Q=new Date(Q));var Y=Q.getHours();Y=Y<<6|Q.getMinutes(),Y=Y<<5|Q.getSeconds()>>>1,z.write_shift(2,Y);var K=Q.getFullYear()-1980;K=K<<4|Q.getMonth()+1,K=K<<5|Q.getDate(),z.write_shift(2,K)}function x(z){var Q=z.read_shift(2)&65535,Y=z.read_shift(2)&65535,K=new Date,ee=Y&31;Y>>>=5;var J=Y&15;Y>>>=4,K.setMilliseconds(0),K.setFullYear(Y+1980),K.setMonth(J-1),K.setDate(ee);var Ae=Q&31;Q>>>=5;var Ue=Q&63;return Q>>>=6,K.setHours(Q),K.setMinutes(Ue),K.setSeconds(Ae<<1),K}function o(z){Ya(z,0);for(var Q={},Y=0;z.l<=z.length-4;){var K=z.read_shift(2),ee=z.read_shift(2),J=z.l+ee,Ae={};switch(K){case 21589:Y=z.read_shift(1),Y&1&&(Ae.mtime=z.read_shift(4)),ee>5&&(Y&2&&(Ae.atime=z.read_shift(4)),Y&4&&(Ae.ctime=z.read_shift(4))),Ae.mtime&&(Ae.mt=new Date(Ae.mtime*1e3));break}z.l=J,Q[K]=Ae}return Q}var E;function w(){return E||(E={})}function C(z,Q){if(z[0]==80&&z[1]==75)return Lr(z,Q);if((z[0]|32)==109&&(z[1]|32)==105)return me(z,Q);if(z.length<512)throw new Error("CFB file size "+z.length+" < 512");var Y=3,K=512,ee=0,J=0,Ae=0,Ue=0,Fe=0,De=[],Ve=z.slice(0,512);Ya(Ve,0);var Ye=P(Ve);switch(Y=Ye[0],Y){case 3:K=512;break;case 4:K=4096;break;case 0:if(Ye[1]==0)return Lr(z,Q);default:throw new Error("Major Version: Expected 3 or 4 saw "+Y)}K!==512&&(Ve=z.slice(0,K),Ya(Ve,28));var nt=z.slice(0,K);M(Ve,Y);var yt=Ve.read_shift(4,"i");if(Y===3&&yt!==0)throw new Error("# Directory Sectors: Expected 0 saw "+yt);Ve.l+=4,Ae=Ve.read_shift(4,"i"),Ve.l+=4,Ve.chk("00100000","Mini Stream Cutoff Size: "),Ue=Ve.read_shift(4,"i"),ee=Ve.read_shift(4,"i"),Fe=Ve.read_shift(4,"i"),J=Ve.read_shift(4,"i");for(var dt=-1,It=0;It<109&&(dt=Ve.read_shift(4,"i"),!(dt<0));++It)De[It]=dt;var Kt=B(z,K);j(Fe,J,Kt,K,De);var _r=pe(Kt,Ae,De,K);_r[Ae].name="!Directory",ee>0&&Ue!==it&&(_r[Ue].name="!MiniFAT"),_r[De[0]].name="!FAT",_r.fat_addrs=De,_r.ssz=K;var Ar={},er=[],ua=[],ma=[];X(Ae,_r,Kt,er,ee,Ar,ua,Ue),U(ua,ma,er),er.shift();var ea={FileIndex:ua,FullPaths:ma};return Q&&Q.raw&&(ea.raw={header:nt,sectors:Kt}),ea}function P(z){if(z[z.l]==80&&z[z.l+1]==75)return[0,0];z.chk(ft,"Header Signature: "),z.l+=16;var Q=z.read_shift(2,"u");return[z.read_shift(2,"u"),Q]}function M(z,Q){var Y=9;switch(z.l+=2,Y=z.read_shift(2)){case 9:if(Q!=3)throw new Error("Sector Shift: Expected 9 saw "+Y);break;case 12:if(Q!=4)throw new Error("Sector Shift: Expected 12 saw "+Y);break;default:throw new Error("Sector Shift: Expected 9 or 12 saw "+Y)}z.chk("0600","Mini Sector Shift: "),z.chk("000000000000","Reserved: ")}function B(z,Q){for(var Y=Math.ceil(z.length/Q)-1,K=[],ee=1;ee<Y;++ee)K[ee-1]=z.slice(ee*Q,(ee+1)*Q);return K[Y-1]=z.slice(Y*Q),K}function U(z,Q,Y){for(var K=0,ee=0,J=0,Ae=0,Ue=0,Fe=Y.length,De=[],Ve=[];K<Fe;++K)De[K]=Ve[K]=K,Q[K]=Y[K];for(;Ue<Ve.length;++Ue)K=Ve[Ue],ee=z[K].L,J=z[K].R,Ae=z[K].C,De[K]===K&&(ee!==-1&&De[ee]!==ee&&(De[K]=De[ee]),J!==-1&&De[J]!==J&&(De[K]=De[J])),Ae!==-1&&(De[Ae]=K),ee!==-1&&K!=De[K]&&(De[ee]=De[K],Ve.lastIndexOf(ee)<Ue&&Ve.push(ee)),J!==-1&&K!=De[K]&&(De[J]=De[K],Ve.lastIndexOf(J)<Ue&&Ve.push(J));for(K=1;K<Fe;++K)De[K]===K&&(J!==-1&&De[J]!==J?De[K]=De[J]:ee!==-1&&De[ee]!==ee&&(De[K]=De[ee]));for(K=1;K<Fe;++K)if(z[K].type!==0){if(Ue=K,Ue!=De[Ue])do Ue=De[Ue],Q[K]=Q[Ue]+"/"+Q[K];while(Ue!==0&&De[Ue]!==-1&&Ue!=De[Ue]);De[K]=-1}for(Q[0]+="/",K=1;K<Fe;++K)z[K].type!==2&&(Q[K]+="/")}function N(z,Q,Y){for(var K=z.start,ee=z.size,J=[],Ae=K;Y&&ee>0&&Ae>=0;)J.push(Q.slice(Ae*Le,Ae*Le+Le)),ee-=Le,Ae=oo(Y,Ae*4);return J.length===0?Da(0):Ps(J).slice(0,z.size)}function j(z,Q,Y,K,ee){var J=it;if(z===it){if(Q!==0)throw new Error("DIFAT chain shorter than expected")}else if(z!==-1){var Ae=Y[z],Ue=(K>>>2)-1;if(!Ae)return;for(var Fe=0;Fe<Ue&&(J=oo(Ae,Fe*4))!==it;++Fe)ee.push(J);j(oo(Ae,K-4),Q-1,Y,K,ee)}}function re(z,Q,Y,K,ee){var J=[],Ae=[];ee||(ee=[]);var Ue=K-1,Fe=0,De=0;for(Fe=Q;Fe>=0;){ee[Fe]=!0,J[J.length]=Fe,Ae.push(z[Fe]);var Ve=Y[Math.floor(Fe*4/K)];if(De=Fe*4&Ue,K<4+De)throw new Error("FAT boundary crossed: "+Fe+" 4 "+K);if(!z[Ve])break;Fe=oo(z[Ve],De)}return{nodes:J,data:Ym([Ae])}}function pe(z,Q,Y,K){var ee=z.length,J=[],Ae=[],Ue=[],Fe=[],De=K-1,Ve=0,Ye=0,nt=0,yt=0;for(Ve=0;Ve<ee;++Ve)if(Ue=[],nt=Ve+Q,nt>=ee&&(nt-=ee),!Ae[nt]){Fe=[];var dt=[];for(Ye=nt;Ye>=0;){dt[Ye]=!0,Ae[Ye]=!0,Ue[Ue.length]=Ye,Fe.push(z[Ye]);var It=Y[Math.floor(Ye*4/K)];if(yt=Ye*4&De,K<4+yt)throw new Error("FAT boundary crossed: "+Ye+" 4 "+K);if(!z[It]||(Ye=oo(z[It],yt),dt[Ye]))break}J[nt]={nodes:Ue,data:Ym([Fe])}}return J}function X(z,Q,Y,K,ee,J,Ae,Ue){for(var Fe=0,De=K.length?2:0,Ve=Q[z].data,Ye=0,nt=0,yt;Ye<Ve.length;Ye+=128){var dt=Ve.slice(Ye,Ye+128);Ya(dt,64),nt=dt.read_shift(2),yt=nd(dt,0,nt-De),K.push(yt);var It={name:yt,type:dt.read_shift(1),color:dt.read_shift(1),L:dt.read_shift(4,"i"),R:dt.read_shift(4,"i"),C:dt.read_shift(4,"i"),clsid:dt.read_shift(16),state:dt.read_shift(4,"i"),start:0,size:0},Kt=dt.read_shift(2)+dt.read_shift(2)+dt.read_shift(2)+dt.read_shift(2);Kt!==0&&(It.ct=le(dt,dt.l-8));var _r=dt.read_shift(2)+dt.read_shift(2)+dt.read_shift(2)+dt.read_shift(2);_r!==0&&(It.mt=le(dt,dt.l-8)),It.start=dt.read_shift(4,"i"),It.size=dt.read_shift(4,"i"),It.size<0&&It.start<0&&(It.size=It.type=0,It.start=it,It.name=""),It.type===5?(Fe=It.start,ee>0&&Fe!==it&&(Q[Fe].name="!StreamData")):It.size>=4096?(It.storage="fat",Q[It.start]===void 0&&(Q[It.start]=re(Y,It.start,Q.fat_addrs,Q.ssz)),Q[It.start].name=It.name,It.content=Q[It.start].data.slice(0,It.size)):(It.storage="minifat",It.size<0?It.size=0:Fe!==it&&It.start!==it&&Q[Fe]&&(It.content=N(It,Q[Fe].data,(Q[Ue]||{}).data))),It.content&&Ya(It.content,0),J[yt]=It,Ae.push(It)}}function le(z,Q){return new Date((Hi(z,Q+4)/1e7*Math.pow(2,32)+Hi(z,Q)/1e7-11644473600)*1e3)}function ye(z,Q){return w(),C(E.readFileSync(z),Q)}function we(z,Q){var Y=Q&&Q.type;switch(Y||kr&&Buffer.isBuffer(z)&&(Y="buffer"),Y||"base64"){case"file":return ye(z,Q);case"base64":return C(Tn(Zi(z)),Q);case"binary":return C(Tn(z),Q)}return C(z,Q)}function ae(z,Q){var Y=Q||{},K=Y.root||"Root Entry";if(z.FullPaths||(z.FullPaths=[]),z.FileIndex||(z.FileIndex=[]),z.FullPaths.length!==z.FileIndex.length)throw new Error("inconsistent CFB structure");z.FullPaths.length===0&&(z.FullPaths[0]=K+"/",z.FileIndex[0]={name:K,type:5}),Y.CLSID&&(z.FileIndex[0].clsid=Y.CLSID),ze(z)}function ze(z){var Q="Sh33tJ5";if(!Ir.find(z,"/"+Q)){var Y=Da(4);Y[0]=55,Y[1]=Y[3]=50,Y[2]=54,z.FileIndex.push({name:Q,type:2,content:Y,size:4,L:69,R:69,C:69}),z.FullPaths.push(z.FullPaths[0]+Q),Ie(z)}}function Ie(z,Q){ae(z);for(var Y=!1,K=!1,ee=z.FullPaths.length-1;ee>=0;--ee){var J=z.FileIndex[ee];switch(J.type){case 0:K?Y=!0:(z.FileIndex.pop(),z.FullPaths.pop());break;case 1:case 2:case 5:K=!0,isNaN(J.R*J.L*J.C)&&(Y=!0),J.R>-1&&J.L>-1&&J.R==J.L&&(Y=!0);break;default:Y=!0;break}}if(!(!Y&&!Q)){var Ae=new Date(1987,1,19),Ue=0,Fe=Object.create?Object.create(null):{},De=[];for(ee=0;ee<z.FullPaths.length;++ee)Fe[z.FullPaths[ee]]=!0,z.FileIndex[ee].type!==0&&De.push([z.FullPaths[ee],z.FileIndex[ee]]);for(ee=0;ee<De.length;++ee){var Ve=c(De[ee][0]);K=Fe[Ve],K||(De.push([Ve,{name:u(Ve).replace("/",""),type:1,clsid:xt,ct:Ae,mt:Ae,content:null}]),Fe[Ve]=!0)}for(De.sort(function(yt,dt){return a(yt[0],dt[0])}),z.FullPaths=[],z.FileIndex=[],ee=0;ee<De.length;++ee)z.FullPaths[ee]=De[ee][0],z.FileIndex[ee]=De[ee][1];for(ee=0;ee<De.length;++ee){var Ye=z.FileIndex[ee],nt=z.FullPaths[ee];if(Ye.name=u(nt).replace("/",""),Ye.L=Ye.R=Ye.C=-(Ye.color=1),Ye.size=Ye.content?Ye.content.length:0,Ye.start=0,Ye.clsid=Ye.clsid||xt,ee===0)Ye.C=De.length>1?1:-1,Ye.size=0,Ye.type=5;else if(nt.slice(-1)=="/"){for(Ue=ee+1;Ue<De.length&&c(z.FullPaths[Ue])!=nt;++Ue);for(Ye.C=Ue>=De.length?-1:Ue,Ue=ee+1;Ue<De.length&&c(z.FullPaths[Ue])!=c(nt);++Ue);Ye.R=Ue>=De.length?-1:Ue,Ye.type=1}else c(z.FullPaths[ee+1]||"")==c(nt)&&(Ye.R=ee+1),Ye.type=2}}}function $e(z,Q){var Y=Q||{};if(Y.fileType=="mad")return Oe(z,Y);switch(Ie(z),Y.fileType){case"zip":return rr(z,Y)}var K=function(yt){for(var dt=0,It=0,Kt=0;Kt<yt.FileIndex.length;++Kt){var _r=yt.FileIndex[Kt];if(_r.content){var Ar=_r.content.length;Ar>0&&(Ar<4096?dt+=Ar+63>>6:It+=Ar+511>>9)}}for(var er=yt.FullPaths.length+3>>2,ua=dt+7>>3,ma=dt+127>>7,ea=ua+It+er+ma,sa=ea+127>>7,Ns=sa<=109?0:Math.ceil((sa-109)/127);ea+sa+Ns+127>>7>sa;)Ns=++sa<=109?0:Math.ceil((sa-109)/127);var ta=[1,Ns,sa,ma,er,It,dt,0];return yt.FileIndex[0].size=dt<<6,ta[7]=(yt.FileIndex[0].start=ta[0]+ta[1]+ta[2]+ta[3]+ta[4]+ta[5])+(ta[6]+7>>3),ta}(z),ee=Da(K[7]<<9),J=0,Ae=0;{for(J=0;J<8;++J)ee.write_shift(1,ct[J]);for(J=0;J<8;++J)ee.write_shift(2,0);for(ee.write_shift(2,62),ee.write_shift(2,3),ee.write_shift(2,65534),ee.write_shift(2,9),ee.write_shift(2,6),J=0;J<3;++J)ee.write_shift(2,0);for(ee.write_shift(4,0),ee.write_shift(4,K[2]),ee.write_shift(4,K[0]+K[1]+K[2]+K[3]-1),ee.write_shift(4,0),ee.write_shift(4,4096),ee.write_shift(4,K[3]?K[0]+K[1]+K[2]-1:it),ee.write_shift(4,K[3]),ee.write_shift(-4,K[1]?K[0]-1:it),ee.write_shift(4,K[1]),J=0;J<109;++J)ee.write_shift(-4,J<K[2]?K[1]+J:-1)}if(K[1])for(Ae=0;Ae<K[1];++Ae){for(;J<236+Ae*127;++J)ee.write_shift(-4,J<K[2]?K[1]+J:-1);ee.write_shift(-4,Ae===K[1]-1?it:Ae+1)}var Ue=function(yt){for(Ae+=yt;J<Ae-1;++J)ee.write_shift(-4,J+1);yt&&(++J,ee.write_shift(-4,it))};for(Ae=J=0,Ae+=K[1];J<Ae;++J)ee.write_shift(-4,ht.DIFSECT);for(Ae+=K[2];J<Ae;++J)ee.write_shift(-4,ht.FATSECT);Ue(K[3]),Ue(K[4]);for(var Fe=0,De=0,Ve=z.FileIndex[0];Fe<z.FileIndex.length;++Fe)Ve=z.FileIndex[Fe],Ve.content&&(De=Ve.content.length,!(De<4096)&&(Ve.start=Ae,Ue(De+511>>9)));for(Ue(K[6]+7>>3);ee.l&511;)ee.write_shift(-4,ht.ENDOFCHAIN);for(Ae=J=0,Fe=0;Fe<z.FileIndex.length;++Fe)Ve=z.FileIndex[Fe],Ve.content&&(De=Ve.content.length,!(!De||De>=4096)&&(Ve.start=Ae,Ue(De+63>>6)));for(;ee.l&511;)ee.write_shift(-4,ht.ENDOFCHAIN);for(J=0;J<K[4]<<2;++J){var Ye=z.FullPaths[J];if(!Ye||Ye.length===0){for(Fe=0;Fe<17;++Fe)ee.write_shift(4,0);for(Fe=0;Fe<3;++Fe)ee.write_shift(4,-1);for(Fe=0;Fe<12;++Fe)ee.write_shift(4,0);continue}Ve=z.FileIndex[J],J===0&&(Ve.start=Ve.size?Ve.start-1:it);var nt=J===0&&Y.root||Ve.name;if(De=2*(nt.length+1),ee.write_shift(64,nt,"utf16le"),ee.write_shift(2,De),ee.write_shift(1,Ve.type),ee.write_shift(1,Ve.color),ee.write_shift(-4,Ve.L),ee.write_shift(-4,Ve.R),ee.write_shift(-4,Ve.C),Ve.clsid)ee.write_shift(16,Ve.clsid,"hex");else for(Fe=0;Fe<4;++Fe)ee.write_shift(4,0);ee.write_shift(4,Ve.state||0),ee.write_shift(4,0),ee.write_shift(4,0),ee.write_shift(4,0),ee.write_shift(4,0),ee.write_shift(4,Ve.start),ee.write_shift(4,Ve.size),ee.write_shift(4,0)}for(J=1;J<z.FileIndex.length;++J)if(Ve=z.FileIndex[J],Ve.size>=4096)if(ee.l=Ve.start+1<<9,kr&&Buffer.isBuffer(Ve.content))Ve.content.copy(ee,ee.l,0,Ve.size),ee.l+=Ve.size+511&-512;else{for(Fe=0;Fe<Ve.size;++Fe)ee.write_shift(1,Ve.content[Fe]);for(;Fe&511;++Fe)ee.write_shift(1,0)}for(J=1;J<z.FileIndex.length;++J)if(Ve=z.FileIndex[J],Ve.size>0&&Ve.size<4096)if(kr&&Buffer.isBuffer(Ve.content))Ve.content.copy(ee,ee.l,0,Ve.size),ee.l+=Ve.size+63&-64;else{for(Fe=0;Fe<Ve.size;++Fe)ee.write_shift(1,Ve.content[Fe]);for(;Fe&63;++Fe)ee.write_shift(1,0)}if(kr)ee.l=ee.length;else for(;ee.l<ee.length;)ee.write_shift(1,0);return ee}function je(z,Q){var Y=z.FullPaths.map(function(Fe){return Fe.toUpperCase()}),K=Y.map(function(Fe){var De=Fe.split("/");return De[De.length-(Fe.slice(-1)=="/"?2:1)]}),ee=!1;Q.charCodeAt(0)===47?(ee=!0,Q=Y[0].slice(0,-1)+Q):ee=Q.indexOf("/")!==-1;var J=Q.toUpperCase(),Ae=ee===!0?Y.indexOf(J):K.indexOf(J);if(Ae!==-1)return z.FileIndex[Ae];var Ue=!J.match(Dc);for(J=J.replace(Ii,""),Ue&&(J=J.replace(Dc,"!")),Ae=0;Ae<Y.length;++Ae)if((Ue?Y[Ae].replace(Dc,"!"):Y[Ae]).replace(Ii,"")==J||(Ue?K[Ae].replace(Dc,"!"):K[Ae]).replace(Ii,"")==J)return z.FileIndex[Ae];return null}var Le=64,it=-2,ft="d0cf11e0a1b11ae1",ct=[208,207,17,224,161,177,26,225],xt="00000000000000000000000000000000",ht={MAXREGSECT:-6,DIFSECT:-4,FATSECT:-3,ENDOFCHAIN:it,FREESECT:-1,HEADER_SIGNATURE:ft,HEADER_MINOR_VERSION:"3e00",MAXREGSID:-6,NOSTREAM:-1,HEADER_CLSID:xt,EntryTypes:["unknown","storage","stream","lockbytes","property","root"]};function Yt(z,Q,Y){w();var K=$e(z,Y);E.writeFileSync(Q,K)}function He(z){for(var Q=new Array(z.length),Y=0;Y<z.length;++Y)Q[Y]=String.fromCharCode(z[Y]);return Q.join("")}function Nt(z,Q){var Y=$e(z,Q);switch(Q&&Q.type||"buffer"){case"file":return w(),E.writeFileSync(Q.filename,Y),Y;case"binary":return typeof Y=="string"?Y:He(Y);case"base64":return Dm(typeof Y=="string"?Y:He(Y));case"buffer":if(kr)return Buffer.isBuffer(Y)?Y:vo(Y);case"array":return typeof Y=="string"?Tn(Y):Y}return Y}var Ft;function ue(z){try{var Q=z.InflateRaw,Y=new Q;if(Y._processChunk(new Uint8Array([3,0]),Y._finishFlushFlag),Y.bytesRead)Ft=z;else throw new Error("zlib does not expose bytesRead")}catch(K){console.error("cannot use native zlib: "+(K.message||K))}}function Te(z,Q){if(!Ft)return Rt(z,Q);var Y=Ft.InflateRaw,K=new Y,ee=K._processChunk(z.slice(z.l),K._finishFlushFlag);return z.l+=K.bytesRead,ee}function Ee(z){return Ft?Ft.deflateRawSync(z):Ht(z)}var Se=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Ke=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258],pt=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];function _t(z){var Q=(z<<1|z<<11)&139536|(z<<5|z<<15)&558144;return(Q>>16|Q>>8|Q)&255}for(var ut=typeof Uint8Array<"u",tt=ut?new Uint8Array(256):[],Zt=0;Zt<256;++Zt)tt[Zt]=_t(Zt);function ge(z,Q){var Y=tt[z&255];return Q<=8?Y>>>8-Q:(Y=Y<<8|tt[z>>8&255],Q<=16?Y>>>16-Q:(Y=Y<<8|tt[z>>16&255],Y>>>24-Q))}function Qt(z,Q){var Y=Q&7,K=Q>>>3;return(z[K]|(Y<=6?0:z[K+1]<<8))>>>Y&3}function Xt(z,Q){var Y=Q&7,K=Q>>>3;return(z[K]|(Y<=5?0:z[K+1]<<8))>>>Y&7}function or(z,Q){var Y=Q&7,K=Q>>>3;return(z[K]|(Y<=4?0:z[K+1]<<8))>>>Y&15}function Jt(z,Q){var Y=Q&7,K=Q>>>3;return(z[K]|(Y<=3?0:z[K+1]<<8))>>>Y&31}function wt(z,Q){var Y=Q&7,K=Q>>>3;return(z[K]|(Y<=1?0:z[K+1]<<8))>>>Y&127}function cr(z,Q,Y){var K=Q&7,ee=Q>>>3,J=(1<<Y)-1,Ae=z[ee]>>>K;return Y<8-K||(Ae|=z[ee+1]<<8-K,Y<16-K)||(Ae|=z[ee+2]<<16-K,Y<24-K)||(Ae|=z[ee+3]<<24-K),Ae&J}function Pr(z,Q,Y){var K=Q&7,ee=Q>>>3;return K<=5?z[ee]|=(Y&7)<<K:(z[ee]|=Y<<K&255,z[ee+1]=(Y&7)>>8-K),Q+3}function qe(z,Q,Y){var K=Q&7,ee=Q>>>3;return Y=(Y&1)<<K,z[ee]|=Y,Q+1}function Cr(z,Q,Y){var K=Q&7,ee=Q>>>3;return Y<<=K,z[ee]|=Y&255,Y>>>=8,z[ee+1]=Y,Q+8}function Br(z,Q,Y){var K=Q&7,ee=Q>>>3;return Y<<=K,z[ee]|=Y&255,Y>>>=8,z[ee+1]=Y&255,z[ee+2]=Y>>>8,Q+16}function ar(z,Q){var Y=z.length,K=2*Y>Q?2*Y:Q+5,ee=0;if(Y>=Q)return z;if(kr){var J=Lm(K);if(z.copy)z.copy(J);else for(;ee<z.length;++ee)J[ee]=z[ee];return J}else if(ut){var Ae=new Uint8Array(K);if(Ae.set)Ae.set(z);else for(;ee<Y;++ee)Ae[ee]=z[ee];return Ae}return z.length=K,z}function Gt(z){for(var Q=new Array(z),Y=0;Y<z;++Y)Q[Y]=0;return Q}function ur(z,Q,Y){var K=1,ee=0,J=0,Ae=0,Ue=0,Fe=z.length,De=ut?new Uint16Array(32):Gt(32);for(J=0;J<32;++J)De[J]=0;for(J=Fe;J<Y;++J)z[J]=0;Fe=z.length;var Ve=ut?new Uint16Array(Fe):Gt(Fe);for(J=0;J<Fe;++J)De[ee=z[J]]++,K<ee&&(K=ee),Ve[J]=0;for(De[0]=0,J=1;J<=K;++J)De[J+16]=Ue=Ue+De[J-1]<<1;for(J=0;J<Fe;++J)Ue=z[J],Ue!=0&&(Ve[J]=De[Ue+16]++);var Ye=0;for(J=0;J<Fe;++J)if(Ye=z[J],Ye!=0)for(Ue=ge(Ve[J],K)>>K-Ye,Ae=(1<<K+4-Ye)-1;Ae>=0;--Ae)Q[Ue|Ae<<Ye]=Ye&15|J<<4;return K}var ir=ut?new Uint16Array(512):Gt(512),Dr=ut?new Uint16Array(32):Gt(32);if(!ut){for(var wr=0;wr<512;++wr)ir[wr]=0;for(wr=0;wr<32;++wr)Dr[wr]=0}(function(){for(var z=[],Q=0;Q<32;Q++)z.push(5);ur(z,Dr,32);var Y=[];for(Q=0;Q<=143;Q++)Y.push(8);for(;Q<=255;Q++)Y.push(9);for(;Q<=279;Q++)Y.push(7);for(;Q<=287;Q++)Y.push(8);ur(Y,ir,288)})();var Nr=function(){for(var Q=ut?new Uint8Array(32768):[],Y=0,K=0;Y<pt.length-1;++Y)for(;K<pt[Y+1];++K)Q[K]=Y;for(;K<32768;++K)Q[K]=29;var ee=ut?new Uint8Array(259):[];for(Y=0,K=0;Y<Ke.length-1;++Y)for(;K<Ke[Y+1];++K)ee[K]=Y;function J(Ue,Fe){for(var De=0;De<Ue.length;){var Ve=Math.min(65535,Ue.length-De),Ye=De+Ve==Ue.length;for(Fe.write_shift(1,+Ye),Fe.write_shift(2,Ve),Fe.write_shift(2,~Ve&65535);Ve-- >0;)Fe[Fe.l++]=Ue[De++]}return Fe.l}function Ae(Ue,Fe){for(var De=0,Ve=0,Ye=ut?new Uint16Array(32768):[];Ve<Ue.length;){var nt=Math.min(65535,Ue.length-Ve);if(nt<10){for(De=Pr(Fe,De,+(Ve+nt==Ue.length)),De&7&&(De+=8-(De&7)),Fe.l=De/8|0,Fe.write_shift(2,nt),Fe.write_shift(2,~nt&65535);nt-- >0;)Fe[Fe.l++]=Ue[Ve++];De=Fe.l*8;continue}De=Pr(Fe,De,+(Ve+nt==Ue.length)+2);for(var yt=0;nt-- >0;){var dt=Ue[Ve];yt=(yt<<5^dt)&32767;var It=-1,Kt=0;if((It=Ye[yt])&&(It|=Ve&-32768,It>Ve&&(It-=32768),It<Ve))for(;Ue[It+Kt]==Ue[Ve+Kt]&&Kt<250;)++Kt;if(Kt>2){dt=ee[Kt],dt<=22?De=Cr(Fe,De,tt[dt+1]>>1)-1:(Cr(Fe,De,3),De+=5,Cr(Fe,De,tt[dt-23]>>5),De+=3);var _r=dt<8?0:dt-4>>2;_r>0&&(Br(Fe,De,Kt-Ke[dt]),De+=_r),dt=Q[Ve-It],De=Cr(Fe,De,tt[dt]>>3),De-=3;var Ar=dt<4?0:dt-2>>1;Ar>0&&(Br(Fe,De,Ve-It-pt[dt]),De+=Ar);for(var er=0;er<Kt;++er)Ye[yt]=Ve&32767,yt=(yt<<5^Ue[Ve])&32767,++Ve;nt-=Kt-1}else dt<=143?dt=dt+48:De=qe(Fe,De,1),De=Cr(Fe,De,tt[dt]),Ye[yt]=Ve&32767,++Ve}De=Cr(Fe,De,0)-1}return Fe.l=(De+7)/8|0,Fe.l}return function(Fe,De){return Fe.length<8?J(Fe,De):Ae(Fe,De)}}();function Ht(z){var Q=Da(50+Math.floor(z.length*1.1)),Y=Nr(z,Q);return Q.slice(0,Y)}var br=ut?new Uint16Array(32768):Gt(32768),ot=ut?new Uint16Array(32768):Gt(32768),Pt=ut?new Uint16Array(128):Gt(128),Mt=1,lr=1;function tr(z,Q){var Y=Jt(z,Q)+257;Q+=5;var K=Jt(z,Q)+1;Q+=5;var ee=or(z,Q)+4;Q+=4;for(var J=0,Ae=ut?new Uint8Array(19):Gt(19),Ue=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Fe=1,De=ut?new Uint8Array(8):Gt(8),Ve=ut?new Uint8Array(8):Gt(8),Ye=Ae.length,nt=0;nt<ee;++nt)Ae[Se[nt]]=J=Xt(z,Q),Fe<J&&(Fe=J),De[J]++,Q+=3;var yt=0;for(De[0]=0,nt=1;nt<=Fe;++nt)Ve[nt]=yt=yt+De[nt-1]<<1;for(nt=0;nt<Ye;++nt)(yt=Ae[nt])!=0&&(Ue[nt]=Ve[yt]++);var dt=0;for(nt=0;nt<Ye;++nt)if(dt=Ae[nt],dt!=0){yt=tt[Ue[nt]]>>8-dt;for(var It=(1<<7-dt)-1;It>=0;--It)Pt[yt|It<<dt]=dt&7|nt<<3}var Kt=[];for(Fe=1;Kt.length<Y+K;)switch(yt=Pt[wt(z,Q)],Q+=yt&7,yt>>>=3){case 16:for(J=3+Qt(z,Q),Q+=2,yt=Kt[Kt.length-1];J-- >0;)Kt.push(yt);break;case 17:for(J=3+Xt(z,Q),Q+=3;J-- >0;)Kt.push(0);break;case 18:for(J=11+wt(z,Q),Q+=7;J-- >0;)Kt.push(0);break;default:Kt.push(yt),Fe<yt&&(Fe=yt);break}var _r=Kt.slice(0,Y),Ar=Kt.slice(Y);for(nt=Y;nt<286;++nt)_r[nt]=0;for(nt=K;nt<30;++nt)Ar[nt]=0;return Mt=ur(_r,br,286),lr=ur(Ar,ot,30),Q}function at(z,Q){if(z[0]==3&&!(z[1]&3))return[Os(Q),2];for(var Y=0,K=0,ee=Lm(Q||1<<18),J=0,Ae=ee.length>>>0,Ue=0,Fe=0;!(K&1);){if(K=Xt(z,Y),Y+=3,K>>>1)K>>1==1?(Ue=9,Fe=5):(Y=tr(z,Y),Ue=Mt,Fe=lr);else{Y&7&&(Y+=8-(Y&7));var De=z[Y>>>3]|z[(Y>>>3)+1]<<8;if(Y+=32,De>0)for(!Q&&Ae<J+De&&(ee=ar(ee,J+De),Ae=ee.length);De-- >0;)ee[J++]=z[Y>>>3],Y+=8;continue}for(;;){!Q&&Ae<J+32767&&(ee=ar(ee,J+32767),Ae=ee.length);var Ve=cr(z,Y,Ue),Ye=K>>>1==1?ir[Ve]:br[Ve];if(Y+=Ye&15,Ye>>>=4,!(Ye>>>8&255))ee[J++]=Ye;else{if(Ye==256)break;Ye-=257;var nt=Ye<8?0:Ye-4>>2;nt>5&&(nt=0);var yt=J+Ke[Ye];nt>0&&(yt+=cr(z,Y,nt),Y+=nt),Ve=cr(z,Y,Fe),Ye=K>>>1==1?Dr[Ve]:ot[Ve],Y+=Ye&15,Ye>>>=4;var dt=Ye<4?0:Ye-2>>1,It=pt[Ye];for(dt>0&&(It+=cr(z,Y,dt),Y+=dt),!Q&&Ae<yt&&(ee=ar(ee,yt+100),Ae=ee.length);J<yt;)ee[J]=ee[J-It],++J}}}return Q?[ee,Y+7>>>3]:[ee.slice(0,J),Y+7>>>3]}function Rt(z,Q){var Y=z.slice(z.l||0),K=at(Y,Q);return z.l+=K[1],K[0]}function Vt(z,Q){if(z)typeof console<"u"&&console.error(Q);else throw new Error(Q)}function Lr(z,Q){var Y=z;Ya(Y,0);var K=[],ee=[],J={FileIndex:K,FullPaths:ee};ae(J,{root:Q.root});for(var Ae=Y.length-4;(Y[Ae]!=80||Y[Ae+1]!=75||Y[Ae+2]!=5||Y[Ae+3]!=6)&&Ae>=0;)--Ae;Y.l=Ae+4,Y.l+=4;var Ue=Y.read_shift(2);Y.l+=6;var Fe=Y.read_shift(4);for(Y.l=Fe,Ae=0;Ae<Ue;++Ae){Y.l+=20;var De=Y.read_shift(4),Ve=Y.read_shift(4),Ye=Y.read_shift(2),nt=Y.read_shift(2),yt=Y.read_shift(2);Y.l+=8;var dt=Y.read_shift(4),It=o(Y.slice(Y.l+Ye,Y.l+Ye+nt));Y.l+=Ye+nt+yt;var Kt=Y.l;Y.l=dt+4,Kr(Y,De,Ve,J,It),Y.l=Kt}return J}function Kr(z,Q,Y,K,ee){z.l+=2;var J=z.read_shift(2),Ae=z.read_shift(2),Ue=x(z);if(J&8257)throw new Error("Unsupported ZIP encryption");for(var Fe=z.read_shift(4),De=z.read_shift(4),Ve=z.read_shift(4),Ye=z.read_shift(2),nt=z.read_shift(2),yt="",dt=0;dt<Ye;++dt)yt+=String.fromCharCode(z[z.l++]);if(nt){var It=o(z.slice(z.l,z.l+nt));(It[21589]||{}).mt&&(Ue=It[21589].mt),((ee||{})[21589]||{}).mt&&(Ue=ee[21589].mt)}z.l+=nt;var Kt=z.slice(z.l,z.l+De);switch(Ae){case 8:Kt=Te(z,Ve);break;case 0:break;default:throw new Error("Unsupported ZIP Compression method "+Ae)}var _r=!1;J&8&&(Fe=z.read_shift(4),Fe==134695760&&(Fe=z.read_shift(4),_r=!0),De=z.read_shift(4),Ve=z.read_shift(4)),De!=Q&&Vt(_r,"Bad compressed size: "+Q+" != "+De),Ve!=Y&&Vt(_r,"Bad uncompressed size: "+Y+" != "+Ve),ve(K,yt,Kt,{unsafe:!0,mt:Ue})}function rr(z,Q){var Y=Q||{},K=[],ee=[],J=Da(1),Ae=Y.compression?8:0,Ue=0,Fe=0,De=0,Ve=0,Ye=0,nt=z.FullPaths[0],yt=nt,dt=z.FileIndex[0],It=[],Kt=0;for(Fe=1;Fe<z.FullPaths.length;++Fe)if(yt=z.FullPaths[Fe].slice(nt.length),dt=z.FileIndex[Fe],!(!dt.size||!dt.content||yt=="Sh33tJ5")){var _r=Ve,Ar=Da(yt.length);for(De=0;De<yt.length;++De)Ar.write_shift(1,yt.charCodeAt(De)&127);Ar=Ar.slice(0,Ar.l),It[Ye]=dT.buf(dt.content,0);var er=dt.content;Ae==8&&(er=Ee(er)),J=Da(30),J.write_shift(4,67324752),J.write_shift(2,20),J.write_shift(2,Ue),J.write_shift(2,Ae),dt.mt?m(J,dt.mt):J.write_shift(4,0),J.write_shift(-4,It[Ye]),J.write_shift(4,er.length),J.write_shift(4,dt.content.length),J.write_shift(2,Ar.length),J.write_shift(2,0),Ve+=J.length,K.push(J),Ve+=Ar.length,K.push(Ar),Ve+=er.length,K.push(er),J=Da(46),J.write_shift(4,33639248),J.write_shift(2,0),J.write_shift(2,20),J.write_shift(2,Ue),J.write_shift(2,Ae),J.write_shift(4,0),J.write_shift(-4,It[Ye]),J.write_shift(4,er.length),J.write_shift(4,dt.content.length),J.write_shift(2,Ar.length),J.write_shift(2,0),J.write_shift(2,0),J.write_shift(2,0),J.write_shift(2,0),J.write_shift(4,0),J.write_shift(4,_r),Kt+=J.l,ee.push(J),Kt+=Ar.length,ee.push(Ar),++Ye}return J=Da(22),J.write_shift(4,101010256),J.write_shift(2,0),J.write_shift(2,0),J.write_shift(2,Ye),J.write_shift(2,Ye),J.write_shift(4,Kt),J.write_shift(4,Ve),J.write_shift(2,0),Ps([Ps(K),Ps(ee),J])}var Aa={htm:"text/html",xml:"text/xml",gif:"image/gif",jpg:"image/jpeg",png:"image/png",mso:"application/x-mso",thmx:"application/vnd.ms-officetheme",sh33tj5:"application/octet-stream"};function ce(z,Q){if(z.ctype)return z.ctype;var Y=z.name||"",K=Y.match(/\.([^\.]+)$/);return K&&Aa[K[1]]||Q&&(K=(Y=Q).match(/[\.\\]([^\.\\])+$/),K&&Aa[K[1]])?Aa[K[1]]:"application/octet-stream"}function V(z){for(var Q=Dm(z),Y=[],K=0;K<Q.length;K+=76)Y.push(Q.slice(K,K+76));return Y.join(`\r
`)+`\r
`}function H(z){var Q=z.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF=]/g,function(De){var Ve=De.charCodeAt(0).toString(16).toUpperCase();return"="+(Ve.length==1?"0"+Ve:Ve)});Q=Q.replace(/ $/mg,"=20").replace(/\t$/mg,"=09"),Q.charAt(0)==`
`&&(Q="=0D"+Q.slice(1)),Q=Q.replace(/\r(?!\n)/mg,"=0D").replace(/\n\n/mg,`
=0A`).replace(/([^\r\n])\n/mg,"$1=0A");for(var Y=[],K=Q.split(`\r
`),ee=0;ee<K.length;++ee){var J=K[ee];if(J.length==0){Y.push("");continue}for(var Ae=0;Ae<J.length;){var Ue=76,Fe=J.slice(Ae,Ae+Ue);Fe.charAt(Ue-1)=="="?Ue--:Fe.charAt(Ue-2)=="="?Ue-=2:Fe.charAt(Ue-3)=="="&&(Ue-=3),Fe=J.slice(Ae,Ae+Ue),Ae+=Ue,Ae<J.length&&(Fe+="="),Y.push(Fe)}}return Y.join(`\r
`)}function te(z){for(var Q=[],Y=0;Y<z.length;++Y){for(var K=z[Y];Y<=z.length&&K.charAt(K.length-1)=="=";)K=K.slice(0,K.length-1)+z[++Y];Q.push(K)}for(var ee=0;ee<Q.length;++ee)Q[ee]=Q[ee].replace(/[=][0-9A-Fa-f]{2}/g,function(J){return String.fromCharCode(parseInt(J.slice(1),16))});return Tn(Q.join(`\r
`))}function fe(z,Q,Y){for(var K="",ee="",J="",Ae,Ue=0;Ue<10;++Ue){var Fe=Q[Ue];if(!Fe||Fe.match(/^\s*$/))break;var De=Fe.match(/^(.*?):\s*([^\s].*)$/);if(De)switch(De[1].toLowerCase()){case"content-location":K=De[2].trim();break;case"content-type":J=De[2].trim();break;case"content-transfer-encoding":ee=De[2].trim();break}}switch(++Ue,ee.toLowerCase()){case"base64":Ae=Tn(Zi(Q.slice(Ue).join("")));break;case"quoted-printable":Ae=te(Q.slice(Ue));break;default:throw new Error("Unsupported Content-Transfer-Encoding "+ee)}var Ve=ve(z,K.slice(Y.length),Ae,{unsafe:!0});J&&(Ve.ctype=J)}function me(z,Q){if(He(z.slice(0,13)).toLowerCase()!="mime-version:")throw new Error("Unsupported MAD header");var Y=Q&&Q.root||"",K=(kr&&Buffer.isBuffer(z)?z.toString("binary"):He(z)).split(`\r
`),ee=0,J="";for(ee=0;ee<K.length;++ee)if(J=K[ee],!!/^Content-Location:/i.test(J)&&(J=J.slice(J.indexOf("file")),Y||(Y=J.slice(0,J.lastIndexOf("/")+1)),J.slice(0,Y.length)!=Y))for(;Y.length>0&&(Y=Y.slice(0,Y.length-1),Y=Y.slice(0,Y.lastIndexOf("/")+1),J.slice(0,Y.length)!=Y););var Ae=(K[1]||"").match(/boundary="(.*?)"/);if(!Ae)throw new Error("MAD cannot find boundary");var Ue="--"+(Ae[1]||""),Fe=[],De=[],Ve={FileIndex:Fe,FullPaths:De};ae(Ve);var Ye,nt=0;for(ee=0;ee<K.length;++ee){var yt=K[ee];yt!==Ue&&yt!==Ue+"--"||(nt++&&fe(Ve,K.slice(Ye,ee),Y),Ye=ee)}return Ve}function Oe(z,Q){var Y=Q||{},K=Y.boundary||"SheetJS";K="------="+K;for(var ee=["MIME-Version: 1.0",'Content-Type: multipart/related; boundary="'+K.slice(2)+'"',"","",""],J=z.FullPaths[0],Ae=J,Ue=z.FileIndex[0],Fe=1;Fe<z.FullPaths.length;++Fe)if(Ae=z.FullPaths[Fe].slice(J.length),Ue=z.FileIndex[Fe],!(!Ue.size||!Ue.content||Ae=="Sh33tJ5")){Ae=Ae.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF]/g,function(Kt){return"_x"+Kt.charCodeAt(0).toString(16)+"_"}).replace(/[\u0080-\uFFFF]/g,function(Kt){return"_u"+Kt.charCodeAt(0).toString(16)+"_"});for(var De=Ue.content,Ve=kr&&Buffer.isBuffer(De)?De.toString("binary"):He(De),Ye=0,nt=Math.min(1024,Ve.length),yt=0,dt=0;dt<=nt;++dt)(yt=Ve.charCodeAt(dt))>=32&&yt<128&&++Ye;var It=Ye>=nt*4/5;ee.push(K),ee.push("Content-Location: "+(Y.root||"file:///C:/SheetJS/")+Ae),ee.push("Content-Transfer-Encoding: "+(It?"quoted-printable":"base64")),ee.push("Content-Type: "+ce(Ue,Ae)),ee.push(""),ee.push(It?H(Ve):V(Ve))}return ee.push(K+`--\r
`),ee.join(`\r
`)}function Ce(z){var Q={};return ae(Q,z),Q}function ve(z,Q,Y,K){var ee=K&&K.unsafe;ee||ae(z);var J=!ee&&Ir.find(z,Q);if(!J){var Ae=z.FullPaths[0];Q.slice(0,Ae.length)==Ae?Ae=Q:(Ae.slice(-1)!="/"&&(Ae+="/"),Ae=(Ae+Q).replace("//","/")),J={name:u(Q),type:2},z.FileIndex.push(J),z.FullPaths.push(Ae),ee||Ir.utils.cfb_gc(z)}return J.content=Y,J.size=Y?Y.length:0,K&&(K.CLSID&&(J.clsid=K.CLSID),K.mt&&(J.mt=K.mt),K.ct&&(J.ct=K.ct)),J}function Me(z,Q){ae(z);var Y=Ir.find(z,Q);if(Y){for(var K=0;K<z.FileIndex.length;++K)if(z.FileIndex[K]==Y)return z.FileIndex.splice(K,1),z.FullPaths.splice(K,1),!0}return!1}function Qe(z,Q,Y){ae(z);var K=Ir.find(z,Q);if(K){for(var ee=0;ee<z.FileIndex.length;++ee)if(z.FileIndex[ee]==K)return z.FileIndex[ee].name=u(Y),z.FullPaths[ee]=Y,!0}return!1}function et(z){Ie(z,!0)}return n.find=je,n.read=we,n.parse=C,n.write=Nt,n.writeFile=Yt,n.utils={cfb_new:Ce,cfb_add:ve,cfb_del:Me,cfb_mov:Qe,cfb_gc:et,ReadShift:Oc,CheckField:j1,prep_blob:Ya,bconcat:Ps,use_zlib:ue,_deflateRaw:Ht,_inflateRaw:Rt,consts:ht},n}();function pT(e){if(typeof Deno<"u")return Deno.readFileSync(e);if(typeof $<"u"&&typeof File<"u"&&typeof Folder<"u")try{var n=File(e);n.open("r"),n.encoding="binary";var a=n.read();return n.close(),a}catch(c){if(!c.message||!c.message.match(/onstruct/))throw c}throw new Error("Cannot access file "+e)}function zn(e){for(var n=Object.keys(e),a=[],c=0;c<n.length;++c)Object.prototype.hasOwnProperty.call(e,n[c])&&a.push(n[c]);return a}function td(e){for(var n=[],a=zn(e),c=0;c!==a.length;++c)n[e[a[c]]]=a[c];return n}var Rh=new Date(1899,11,30,0,0,0);function Pi(e,n){var a=e.getTime();n&&(a-=1462*24*60*60*1e3);var c=Rh.getTime()+(e.getTimezoneOffset()-Rh.getTimezoneOffset())*6e4;return(a-c)/(24*60*60*1e3)}var w1=new Date,mT=Rh.getTime()+(w1.getTimezoneOffset()-Rh.getTimezoneOffset())*6e4,$m=w1.getTimezoneOffset();function qh(e){var n=new Date;return n.setTime(e*24*60*60*1e3+mT),n.getTimezoneOffset()!==$m&&n.setTime(n.getTime()+(n.getTimezoneOffset()-$m)*6e4),n}function gT(e){var n=0,a=0,c=!1,u=e.match(/P([0-9\.]+Y)?([0-9\.]+M)?([0-9\.]+D)?T([0-9\.]+H)?([0-9\.]+M)?([0-9\.]+S)?/);if(!u)throw new Error("|"+e+"| is not an ISO8601 Duration");for(var m=1;m!=u.length;++m)if(u[m]){switch(a=1,m>3&&(c=!0),u[m].slice(u[m].length-1)){case"Y":throw new Error("Unsupported ISO Duration Field: "+u[m].slice(u[m].length-1));case"D":a*=24;case"H":a*=60;case"M":if(c)a*=60;else throw new Error("Unsupported ISO Duration Field: M")}n+=a*parseInt(u[m],10)}return n}var jm=new Date("2017-02-19T19:06:09.000Z"),b1=isNaN(jm.getFullYear())?new Date("2/19/17"):jm,xT=b1.getFullYear()==2017;function Ga(e,n){var a=new Date(e);if(xT)return n>0?a.setTime(a.getTime()+a.getTimezoneOffset()*60*1e3):n<0&&a.setTime(a.getTime()-a.getTimezoneOffset()*60*1e3),a;if(e instanceof Date)return e;if(b1.getFullYear()==1917&&!isNaN(a.getFullYear())){var c=a.getFullYear();return e.indexOf(""+c)>-1||a.setFullYear(a.getFullYear()+100),a}var u=e.match(/\d+/g)||["2017","2","19","0","0","0"],m=new Date(+u[0],+u[1]-1,+u[2],+u[3]||0,+u[4]||0,+u[5]||0);return e.indexOf("Z")>-1&&(m=new Date(m.getTime()-m.getTimezoneOffset()*60*1e3)),m}function go(e,n){if(kr&&Buffer.isBuffer(e)){if(n){if(e[0]==255&&e[1]==254)return Rc(e.slice(2).toString("utf16le"));if(e[1]==254&&e[2]==255)return Rc(l1(e.slice(2).toString("binary")))}return e.toString("binary")}if(typeof TextDecoder<"u")try{if(n){if(e[0]==255&&e[1]==254)return Rc(new TextDecoder("utf-16le").decode(e.slice(2)));if(e[0]==254&&e[1]==255)return Rc(new TextDecoder("utf-16be").decode(e.slice(2)))}var a={"€":"","‚":"",ƒ:"","„":"","…":"","†":"","‡":"","ˆ":"","‰":"",Š:"","‹":"",Œ:"",Ž:"","‘":"","’":"","“":"","”":"","•":"","–":"","—":"","˜":"","™":"",š:"","›":"",œ:"",ž:"",Ÿ:""};return Array.isArray(e)&&(e=new Uint8Array(e)),new TextDecoder("latin1").decode(e).replace(/[€‚ƒ„…†‡ˆ‰Š‹ŒŽ‘’“”•–—˜™š›œžŸ]/g,function(m){return a[m]||m})}catch{}for(var c=[],u=0;u!=e.length;++u)c.push(String.fromCharCode(e[u]));return c.join("")}function Ja(e){if(typeof JSON<"u"&&!Array.isArray(e))return JSON.parse(JSON.stringify(e));if(typeof e!="object"||e==null)return e;if(e instanceof Date)return new Date(e.getTime());var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(n[a]=Ja(e[a]));return n}function da(e,n){for(var a="";a.length<n;)a+=e;return a}function kn(e){var n=Number(e);if(!isNaN(n))return isFinite(n)?n:NaN;if(!/\d/.test(e))return n;var a=1,c=e.replace(/([\d]),([\d])/g,"$1$2").replace(/[$]/g,"").replace(/[%]/g,function(){return a*=100,""});return!isNaN(n=Number(c))||(c=c.replace(/[(](.*)[)]/,function(u,m){return a=-a,m}),!isNaN(n=Number(c)))?n/a:n}var _T=["january","february","march","april","may","june","july","august","september","october","november","december"];function _l(e){var n=new Date(e),a=new Date(NaN),c=n.getYear(),u=n.getMonth(),m=n.getDate();if(isNaN(m))return a;var x=e.toLowerCase();if(x.match(/jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec/)){if(x=x.replace(/[^a-z]/g,"").replace(/([^a-z]|^)[ap]m?([^a-z]|$)/,""),x.length>3&&_T.indexOf(x)==-1)return a}else if(x.match(/[a-z]/))return a;return c<0||c>8099?a:(u>0||m>1)&&c!=101?n:e.match(/[^-0-9:,\/\\]/)?a:n}var yT=function(){var e="abacaba".split(/(:?b)/i).length==5;return function(a,c,u){if(e||typeof c=="string")return a.split(c);for(var m=a.split(c),x=[m[0]],o=1;o<m.length;++o)x.push(u),x.push(m[o]);return x}}();function T1(e){return e?e.content&&e.type?go(e.content,!0):e.data?Mc(e.data):e.asNodeBuffer&&kr?Mc(e.asNodeBuffer().toString("binary")):e.asBinary?Mc(e.asBinary()):e._data&&e._data.getContent?Mc(go(Array.prototype.slice.call(e._data.getContent(),0))):null:null}function E1(e){if(!e)return null;if(e.data)return Pm(e.data);if(e.asNodeBuffer&&kr)return e.asNodeBuffer();if(e._data&&e._data.getContent){var n=e._data.getContent();return typeof n=="string"?Pm(n):Array.prototype.slice.call(n)}return e.content&&e.type?e.content:null}function vT(e){return e&&e.name.slice(-4)===".bin"?E1(e):T1(e)}function sn(e,n){for(var a=e.FullPaths||zn(e.files),c=n.toLowerCase().replace(/[\/]/g,"\\"),u=c.replace(/\\/g,"/"),m=0;m<a.length;++m){var x=a[m].replace(/^Root Entry[\/]/,"").toLowerCase();if(c==x||u==x)return e.files?e.files[a[m]]:e.FileIndex[m]}return null}function rd(e,n){var a=sn(e,n);if(a==null)throw new Error("Cannot find file "+n+" in zip");return a}function ka(e,n,a){if(!a)return vT(rd(e,n));if(!n)return null;try{return ka(e,n)}catch{return null}}function qi(e,n,a){if(!a)return T1(rd(e,n));if(!n)return null;try{return qi(e,n)}catch{return null}}function S1(e,n,a){if(!a)return E1(rd(e,n));if(!n)return null;try{return S1(e,n)}catch{return null}}function Gm(e){for(var n=e.FullPaths||zn(e.files),a=[],c=0;c<n.length;++c)n[c].slice(-1)!="/"&&a.push(n[c].replace(/^Root Entry[\/]/,""));return a.sort()}function wT(e,n,a){if(e.FullPaths){if(typeof a=="string"){var c;return kr?c=vo(a):c=Vb(a),Ir.utils.cfb_add(e,n,c)}Ir.utils.cfb_add(e,n,a)}else e.file(n,a)}function k1(e,n){switch(n.type){case"base64":return Ir.read(e,{type:"base64"});case"binary":return Ir.read(e,{type:"binary"});case"buffer":case"array":return Ir.read(e,{type:"buffer"})}throw new Error("Unrecognized type "+n.type)}function Lc(e,n){if(e.charAt(0)=="/")return e.slice(1);var a=n.split("/");n.slice(-1)!="/"&&a.pop();for(var c=e.split("/");c.length!==0;){var u=c.shift();u===".."?a.pop():u!=="."&&a.push(u)}return a.join("/")}var C1=`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\r
`,bT=/([^"\s?>\/]+)\s*=\s*((?:")([^"]*)(?:")|(?:')([^']*)(?:')|([^'">\s]+))/g,Hm=/<[\/\?]?[a-zA-Z0-9:_-]+(?:\s+[^"\s?>\/]+\s*=\s*(?:"[^"]*"|'[^']*'|[^'">\s=]+))*\s*[\/\?]?>/mg,TT=/<[^>]*>/g,pi=C1.match(Hm)?Hm:TT,ET=/<\w*:/,ST=/<(\/?)\w+:/;function nr(e,n,a){for(var c={},u=0,m=0;u!==e.length&&!((m=e.charCodeAt(u))===32||m===10||m===13);++u);if(n||(c[0]=e.slice(0,u)),u===e.length)return c;var x=e.match(bT),o=0,E="",w=0,C="",P="",M=1;if(x)for(w=0;w!=x.length;++w){for(P=x[w],m=0;m!=P.length&&P.charCodeAt(m)!==61;++m);for(C=P.slice(0,m).trim();P.charCodeAt(m+1)==32;)++m;for(M=(u=P.charCodeAt(m+1))==34||u==39?1:0,E=P.slice(m+1+M,P.length-M),o=0;o!=C.length&&C.charCodeAt(o)!==58;++o);if(o===C.length)C.indexOf("_")>0&&(C=C.slice(0,C.indexOf("_"))),c[C]=E,a||(c[C.toLowerCase()]=E);else{var B=(o===5&&C.slice(0,5)==="xmlns"?"xmlns":"")+C.slice(o+1);if(c[B]&&C.slice(o-3,o)=="ext")continue;c[B]=E,a||(c[B.toLowerCase()]=E)}}return c}function Nn(e){return e.replace(ST,"<$1")}var A1={"&quot;":'"',"&apos;":"'","&gt;":">","&lt;":"<","&amp;":"&"},kT=td(A1),Mr=function(){var e=/&(?:quot|apos|gt|lt|amp|#x?([\da-fA-F]+));/ig,n=/_x([\da-fA-F]{4})_/ig;return function a(c){var u=c+"",m=u.indexOf("<![CDATA[");if(m==-1)return u.replace(e,function(o,E){return A1[o]||String.fromCharCode(parseInt(E,o.indexOf("x")>-1?16:10))||o}).replace(n,function(o,E){return String.fromCharCode(parseInt(E,16))});var x=u.indexOf("]]>");return a(u.slice(0,m))+u.slice(m+9,x)+a(u.slice(x+3))}}(),CT=/[&<>'"]/g,AT=/[\u0000-\u001f]/g;function ad(e){var n=e+"";return n.replace(CT,function(a){return kT[a]}).replace(/\n/g,"<br/>").replace(AT,function(a){return"&#x"+("000"+a.charCodeAt(0).toString(16)).slice(-4)+";"})}var Wm=function(){var e=/&#(\d+);/g;function n(a,c){return String.fromCharCode(parseInt(c,10))}return function(c){return c.replace(e,n)}}();function na(e){switch(e){case 1:case!0:case"1":case"true":case"TRUE":return!0;default:return!1}}function f0(e){for(var n="",a=0,c=0,u=0,m=0,x=0,o=0;a<e.length;){if(c=e.charCodeAt(a++),c<128){n+=String.fromCharCode(c);continue}if(u=e.charCodeAt(a++),c>191&&c<224){x=(c&31)<<6,x|=u&63,n+=String.fromCharCode(x);continue}if(m=e.charCodeAt(a++),c<240){n+=String.fromCharCode((c&15)<<12|(u&63)<<6|m&63);continue}x=e.charCodeAt(a++),o=((c&7)<<18|(u&63)<<12|(m&63)<<6|x&63)-65536,n+=String.fromCharCode(55296+(o>>>10&1023)),n+=String.fromCharCode(56320+(o&1023))}return n}function qm(e){var n=Os(2*e.length),a,c,u=1,m=0,x=0,o;for(c=0;c<e.length;c+=u)u=1,(o=e.charCodeAt(c))<128?a=o:o<224?(a=(o&31)*64+(e.charCodeAt(c+1)&63),u=2):o<240?(a=(o&15)*4096+(e.charCodeAt(c+1)&63)*64+(e.charCodeAt(c+2)&63),u=3):(u=4,a=(o&7)*262144+(e.charCodeAt(c+1)&63)*4096+(e.charCodeAt(c+2)&63)*64+(e.charCodeAt(c+3)&63),a-=65536,x=55296+(a>>>10&1023),a=56320+(a&1023)),x!==0&&(n[m++]=x&255,n[m++]=x>>>8,x=0),n[m++]=a%256,n[m++]=a>>>8;return n.slice(0,m).toString("ucs2")}function Zm(e){return vo(e,"binary").toString("utf8")}var _h="foo bar bazâð£",Xr=kr&&(Zm(_h)==f0(_h)&&Zm||qm(_h)==f0(_h)&&qm)||f0,Rc=kr?function(e){return vo(e,"utf8").toString("binary")}:function(e){for(var n=[],a=0,c=0,u=0;a<e.length;)switch(c=e.charCodeAt(a++),!0){case c<128:n.push(String.fromCharCode(c));break;case c<2048:n.push(String.fromCharCode(192+(c>>6))),n.push(String.fromCharCode(128+(c&63)));break;case(c>=55296&&c<57344):c-=55296,u=e.charCodeAt(a++)-56320+(c<<10),n.push(String.fromCharCode(240+(u>>18&7))),n.push(String.fromCharCode(144+(u>>12&63))),n.push(String.fromCharCode(128+(u>>6&63))),n.push(String.fromCharCode(128+(u&63)));break;default:n.push(String.fromCharCode(224+(c>>12))),n.push(String.fromCharCode(128+(c>>6&63))),n.push(String.fromCharCode(128+(c&63)))}return n.join("")},qc=function(){var e={};return function(a,c){var u=a+"|"+(c||"");return e[u]?e[u]:e[u]=new RegExp("<(?:\\w+:)?"+a+'(?: xml:space="preserve")?(?:[^>]*)>([\\s\\S]*?)</(?:\\w+:)?'+a+">",c||"")}}(),I1=function(){var e=[["nbsp"," "],["middot","·"],["quot",'"'],["apos","'"],["gt",">"],["lt","<"],["amp","&"]].map(function(n){return[new RegExp("&"+n[0]+";","ig"),n[1]]});return function(a){for(var c=a.replace(/^[\t\n\r ]+/,"").replace(/[\t\n\r ]+$/,"").replace(/>\s+/g,">").replace(/\s+</g,"<").replace(/[\t\n\r ]+/g," ").replace(/<\s*[bB][rR]\s*\/?>/g,`
`).replace(/<[^>]*>/g,""),u=0;u<e.length;++u)c=c.replace(e[u][0],e[u][1]);return c}}(),IT=function(){var e={};return function(a){return e[a]!==void 0?e[a]:e[a]=new RegExp("<(?:vt:)?"+a+">([\\s\\S]*?)</(?:vt:)?"+a+">","g")}}(),FT=/<\/?(?:vt:)?variant>/g,PT=/<(?:vt:)([^>]*)>([\s\S]*)</;function Xm(e,n){var a=nr(e),c=e.match(IT(a.baseType))||[],u=[];if(c.length!=a.size){if(n.WTF)throw new Error("unexpected vector length "+c.length+" != "+a.size);return u}return c.forEach(function(m){var x=m.replace(FT,"").match(PT);x&&u.push({v:Xr(x[2]),t:x[1]})}),u}var MT=/(^\s|\s$|\n)/;function DT(e){return zn(e).map(function(n){return" "+n+'="'+e[n]+'"'}).join("")}function LT(e,n,a){return"<"+e+(a!=null?DT(a):"")+(n!=null?(n.match(MT)?' xml:space="preserve"':"")+">"+n+"</"+e:"/")+">"}function id(e){if(kr&&Buffer.isBuffer(e))return e.toString("utf8");if(typeof e=="string")return e;if(typeof Uint8Array<"u"&&e instanceof Uint8Array)return Xr(wo(J0(e)));throw new Error("Bad input format: expected Buffer or string")}var Zc=/<(\/?)([^\s?><!\/:]*:|)([^\s?<>:\/]+)(?:[\s?:\/][^>]*)?>/mg,RT={CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/metadata/core-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/custom-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/extended-properties",CT:"http://schemas.openxmlformats.org/package/2006/content-types",RELS:"http://schemas.openxmlformats.org/package/2006/relationships",TCMNT:"http://schemas.microsoft.com/office/spreadsheetml/2018/threadedcomments",dc:"http://purl.org/dc/elements/1.1/",dcterms:"http://purl.org/dc/terms/",dcmitype:"http://purl.org/dc/dcmitype/",mx:"http://schemas.microsoft.com/office/mac/excel/2008/main",r:"http://schemas.openxmlformats.org/officeDocument/2006/relationships",sjs:"http://schemas.openxmlformats.org/package/2006/sheetjs/core-properties",vt:"http://schemas.openxmlformats.org/officeDocument/2006/docPropsVTypes",xsi:"http://www.w3.org/2001/XMLSchema-instance",xsd:"http://www.w3.org/2001/XMLSchema"},OT=["http://schemas.openxmlformats.org/spreadsheetml/2006/main","http://purl.oclc.org/ooxml/spreadsheetml/main","http://schemas.microsoft.com/office/excel/2006/main","http://schemas.microsoft.com/office/excel/2006/2"];function BT(e,n){for(var a=1-2*(e[n+7]>>>7),c=((e[n+7]&127)<<4)+(e[n+6]>>>4&15),u=e[n+6]&15,m=5;m>=0;--m)u=u*256+e[n+m];return c==2047?u==0?a*(1/0):NaN:(c==0?c=-1022:(c-=1023,u+=Math.pow(2,52)),a*Math.pow(2,c-52)*u)}function zT(e,n,a){var c=(n<0||1/n==-1/0?1:0)<<7,u=0,m=0,x=c?-n:n;isFinite(x)?x==0?u=m=0:(u=Math.floor(Math.log(x)/Math.LN2),m=x*Math.pow(2,52-u),u<=-1023&&(!isFinite(m)||m<Math.pow(2,52))?u=-1022:(m-=Math.pow(2,52),u+=1023)):(u=2047,m=isNaN(n)?26985:0);for(var o=0;o<=5;++o,m/=256)e[a+o]=m&255;e[a+6]=(u&15)<<4|m&15,e[a+7]=u>>4|c}var Km=function(e){for(var n=[],a=10240,c=0;c<e[0].length;++c)if(e[0][c])for(var u=0,m=e[0][c].length;u<m;u+=a)n.push.apply(n,e[0][c].slice(u,u+a));return n},Ym=kr?function(e){return e[0].length>0&&Buffer.isBuffer(e[0][0])?Buffer.concat(e[0].map(function(n){return Buffer.isBuffer(n)?n:vo(n)})):Km(e)}:Km,Jm=function(e,n,a){for(var c=[],u=n;u<a;u+=2)c.push(String.fromCharCode(ns(e,u)));return c.join("").replace(Ii,"")},nd=kr?function(e,n,a){return Buffer.isBuffer(e)?e.toString("utf16le",n,a).replace(Ii,""):Jm(e,n,a)}:Jm,Qm=function(e,n,a){for(var c=[],u=n;u<n+a;++u)c.push(("0"+e[u].toString(16)).slice(-2));return c.join("")},F1=kr?function(e,n,a){return Buffer.isBuffer(e)?e.toString("hex",n,n+a):Qm(e,n,a)}:Qm,eg=function(e,n,a){for(var c=[],u=n;u<a;u++)c.push(String.fromCharCode(fl(e,u)));return c.join("")},au=kr?function(n,a,c){return Buffer.isBuffer(n)?n.toString("utf8",a,c):eg(n,a,c)}:eg,P1=function(e,n){var a=Hi(e,n);return a>0?au(e,n+4,n+4+a-1):""},M1=P1,D1=function(e,n){var a=Hi(e,n);return a>0?au(e,n+4,n+4+a-1):""},L1=D1,R1=function(e,n){var a=2*Hi(e,n);return a>0?au(e,n+4,n+4+a-1):""},O1=R1,B1=function(n,a){var c=Hi(n,a);return c>0?nd(n,a+4,a+4+c):""},z1=B1,N1=function(e,n){var a=Hi(e,n);return a>0?au(e,n+4,n+4+a):""},U1=N1,V1=function(e,n){return BT(e,n)},Oh=V1,$1=function(n){return Array.isArray(n)||typeof Uint8Array<"u"&&n instanceof Uint8Array};kr&&(M1=function(n,a){if(!Buffer.isBuffer(n))return P1(n,a);var c=n.readUInt32LE(a);return c>0?n.toString("utf8",a+4,a+4+c-1):""},L1=function(n,a){if(!Buffer.isBuffer(n))return D1(n,a);var c=n.readUInt32LE(a);return c>0?n.toString("utf8",a+4,a+4+c-1):""},O1=function(n,a){if(!Buffer.isBuffer(n))return R1(n,a);var c=2*n.readUInt32LE(a);return n.toString("utf16le",a+4,a+4+c-1)},z1=function(n,a){if(!Buffer.isBuffer(n))return B1(n,a);var c=n.readUInt32LE(a);return n.toString("utf16le",a+4,a+4+c)},U1=function(n,a){if(!Buffer.isBuffer(n))return N1(n,a);var c=n.readUInt32LE(a);return n.toString("utf8",a+4,a+4+c)},Oh=function(n,a){return Buffer.isBuffer(n)?n.readDoubleLE(a):V1(n,a)},$1=function(n){return Buffer.isBuffer(n)||Array.isArray(n)||typeof Uint8Array<"u"&&n instanceof Uint8Array});var fl=function(e,n){return e[n]},ns=function(e,n){return e[n+1]*256+e[n]},NT=function(e,n){var a=e[n+1]*256+e[n];return a<32768?a:(65535-a+1)*-1},Hi=function(e,n){return e[n+3]*(1<<24)+(e[n+2]<<16)+(e[n+1]<<8)+e[n]},oo=function(e,n){return e[n+3]<<24|e[n+2]<<16|e[n+1]<<8|e[n]},UT=function(e,n){return e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3]};function Oc(e,n){var a="",c,u,m=[],x,o,E,w;switch(n){case"dbcs":if(w=this.l,kr&&Buffer.isBuffer(this))a=this.slice(this.l,this.l+2*e).toString("utf16le");else for(E=0;E<e;++E)a+=String.fromCharCode(ns(this,w)),w+=2;e*=2;break;case"utf8":a=au(this,this.l,this.l+e);break;case"utf16le":e*=2,a=nd(this,this.l,this.l+e);break;case"wstr":return Oc.call(this,e,"dbcs");case"lpstr-ansi":a=M1(this,this.l),e=4+Hi(this,this.l);break;case"lpstr-cp":a=L1(this,this.l),e=4+Hi(this,this.l);break;case"lpwstr":a=O1(this,this.l),e=4+2*Hi(this,this.l);break;case"lpp4":e=4+Hi(this,this.l),a=z1(this,this.l),e&2&&(e+=2);break;case"8lpp4":e=4+Hi(this,this.l),a=U1(this,this.l),e&3&&(e+=4-(e&3));break;case"cstr":for(e=0,a="";(x=fl(this,this.l+e++))!==0;)m.push(xh(x));a=m.join("");break;case"_wstr":for(e=0,a="";(x=ns(this,this.l+e))!==0;)m.push(xh(x)),e+=2;e+=2,a=m.join("");break;case"dbcs-cont":for(a="",w=this.l,E=0;E<e;++E){if(this.lens&&this.lens.indexOf(w)!==-1)return x=fl(this,w),this.l=w+1,o=Oc.call(this,e-E,x?"dbcs-cont":"sbcs-cont"),m.join("")+o;m.push(xh(ns(this,w))),w+=2}a=m.join(""),e*=2;break;case"cpstr":case"sbcs-cont":for(a="",w=this.l,E=0;E!=e;++E){if(this.lens&&this.lens.indexOf(w)!==-1)return x=fl(this,w),this.l=w+1,o=Oc.call(this,e-E,x?"dbcs-cont":"sbcs-cont"),m.join("")+o;m.push(xh(fl(this,w))),w+=1}a=m.join("");break;default:switch(e){case 1:return c=fl(this,this.l),this.l++,c;case 2:return c=(n==="i"?NT:ns)(this,this.l),this.l+=2,c;case 4:case-4:return n==="i"||!(this[this.l+3]&128)?(c=(e>0?oo:UT)(this,this.l),this.l+=4,c):(u=Hi(this,this.l),this.l+=4,u);case 8:case-8:if(n==="f")return e==8?u=Oh(this,this.l):u=Oh([this[this.l+7],this[this.l+6],this[this.l+5],this[this.l+4],this[this.l+3],this[this.l+2],this[this.l+1],this[this.l+0]],0),this.l+=8,u;e=8;case 16:a=F1(this,this.l,e);break}}return this.l+=e,a}var VT=function(e,n,a){e[a]=n&255,e[a+1]=n>>>8&255,e[a+2]=n>>>16&255,e[a+3]=n>>>24&255},$T=function(e,n,a){e[a]=n&255,e[a+1]=n>>8&255,e[a+2]=n>>16&255,e[a+3]=n>>24&255},jT=function(e,n,a){e[a]=n&255,e[a+1]=n>>>8&255};function GT(e,n,a){var c=0,u=0;if(a==="dbcs"){for(u=0;u!=n.length;++u)jT(this,n.charCodeAt(u),this.l+2*u);c=2*n.length}else if(a==="sbcs"){for(n=n.replace(/[^\x00-\x7F]/g,"_"),u=0;u!=n.length;++u)this[this.l+u]=n.charCodeAt(u)&255;c=n.length}else if(a==="hex"){for(;u<e;++u)this[this.l++]=parseInt(n.slice(2*u,2*u+2),16)||0;return this}else if(a==="utf16le"){var m=Math.min(this.l+e,this.length);for(u=0;u<Math.min(n.length,e);++u){var x=n.charCodeAt(u);this[this.l++]=x&255,this[this.l++]=x>>8}for(;this.l<m;)this[this.l++]=0;return this}else switch(e){case 1:c=1,this[this.l]=n&255;break;case 2:c=2,this[this.l]=n&255,n>>>=8,this[this.l+1]=n&255;break;case 3:c=3,this[this.l]=n&255,n>>>=8,this[this.l+1]=n&255,n>>>=8,this[this.l+2]=n&255;break;case 4:c=4,VT(this,n,this.l);break;case 8:if(c=8,a==="f"){zT(this,n,this.l);break}case 16:break;case-4:c=4,$T(this,n,this.l);break}return this.l+=c,this}function j1(e,n){var a=F1(this,this.l,e.length>>1);if(a!==e)throw new Error(n+"Expected "+e+" saw "+a);this.l+=e.length>>1}function Ya(e,n){e.l=n,e.read_shift=Oc,e.chk=j1,e.write_shift=GT}function di(e,n){e.l+=n}function Da(e){var n=Os(e);return Ya(n,0),n}function cs(e,n,a){if(e){var c,u,m;Ya(e,e.l||0);for(var x=e.length,o=0,E=0;e.l<x;){o=e.read_shift(1),o&128&&(o=(o&127)+((e.read_shift(1)&127)<<7));var w=$h[o]||$h[65535];for(c=e.read_shift(1),m=c&127,u=1;u<4&&c&128;++u)m+=((c=e.read_shift(1))&127)<<7*u;E=e.l+m;var C=w.f&&w.f(e,m,a);if(e.l=E,n(C,w,o))return}}}function P0(){var e=[],n=kr?256:2048,a=function(w){var C=Da(w);return Ya(C,0),C},c=a(n),u=function(){c&&(c.length>c.l&&(c=c.slice(0,c.l),c.l=c.length),c.length>0&&e.push(c),c=null)},m=function(w){return c&&w<c.length-c.l?c:(u(),c=a(Math.max(w+1,n)))},x=function(){return u(),Ps(e)},o=function(w){u(),c=w,c.l==null&&(c.l=c.length),m(n)};return{next:m,push:o,end:x,_bufs:e}}function Bc(e,n,a){var c=Ja(e);if(n.s?(c.cRel&&(c.c+=n.s.c),c.rRel&&(c.r+=n.s.r)):(c.cRel&&(c.c+=n.c),c.rRel&&(c.r+=n.r)),!a||a.biff<12){for(;c.c>=256;)c.c-=256;for(;c.r>=65536;)c.r-=65536}return c}function tg(e,n,a){var c=Ja(e);return c.s=Bc(c.s,n.s,a),c.e=Bc(c.e,n.s,a),c}function zc(e,n){if(e.cRel&&e.c<0)for(e=Ja(e);e.c<0;)e.c+=n>8?16384:256;if(e.rRel&&e.r<0)for(e=Ja(e);e.r<0;)e.r+=n>8?1048576:n>5?65536:16384;var a=fr(e);return!e.cRel&&e.cRel!=null&&(a=qT(a)),!e.rRel&&e.rRel!=null&&(a=HT(a)),a}function d0(e,n){return e.s.r==0&&!e.s.rRel&&e.e.r==(n.biff>=12?1048575:n.biff>=8?65536:16384)&&!e.e.rRel?(e.s.cRel?"":"$")+Oa(e.s.c)+":"+(e.e.cRel?"":"$")+Oa(e.e.c):e.s.c==0&&!e.s.cRel&&e.e.c==(n.biff>=12?16383:255)&&!e.e.cRel?(e.s.rRel?"":"$")+Qa(e.s.r)+":"+(e.e.rRel?"":"$")+Qa(e.e.r):zc(e.s,n.biff)+":"+zc(e.e,n.biff)}function sd(e){return parseInt(WT(e),10)-1}function Qa(e){return""+(e+1)}function HT(e){return e.replace(/([A-Z]|^)(\d+)$/,"$1$$$2")}function WT(e){return e.replace(/\$(\d+)$/,"$1")}function od(e){for(var n=ZT(e),a=0,c=0;c!==n.length;++c)a=26*a+n.charCodeAt(c)-64;return a-1}function Oa(e){if(e<0)throw new Error("invalid column "+e);var n="";for(++e;e;e=Math.floor((e-1)/26))n=String.fromCharCode((e-1)%26+65)+n;return n}function qT(e){return e.replace(/^([A-Z])/,"$$$1")}function ZT(e){return e.replace(/^\$([A-Z])/,"$1")}function XT(e){return e.replace(/(\$?[A-Z]*)(\$?\d*)/,"$1,$2").split(",")}function Ai(e){for(var n=0,a=0,c=0;c<e.length;++c){var u=e.charCodeAt(c);u>=48&&u<=57?n=10*n+(u-48):u>=65&&u<=90&&(a=26*a+(u-64))}return{c:a-1,r:n-1}}function fr(e){for(var n=e.c+1,a="";n;n=(n-1)/26|0)a=String.fromCharCode((n-1)%26+65)+a;return a+(e.r+1)}function Tl(e){var n=e.indexOf(":");return n==-1?{s:Ai(e),e:Ai(e)}:{s:Ai(e.slice(0,n)),e:Ai(e.slice(n+1))}}function Fr(e,n){return typeof n>"u"||typeof n=="number"?Fr(e.s,e.e):(typeof e!="string"&&(e=fr(e)),typeof n!="string"&&(n=fr(n)),e==n?e:e+":"+n)}function pa(e){var n={s:{c:0,r:0},e:{c:0,r:0}},a=0,c=0,u=0,m=e.length;for(a=0;c<m&&!((u=e.charCodeAt(c)-64)<1||u>26);++c)a=26*a+u;for(n.s.c=--a,a=0;c<m&&!((u=e.charCodeAt(c)-48)<0||u>9);++c)a=10*a+u;if(n.s.r=--a,c===m||u!=10)return n.e.c=n.s.c,n.e.r=n.s.r,n;for(++c,a=0;c!=m&&!((u=e.charCodeAt(c)-64)<1||u>26);++c)a=26*a+u;for(n.e.c=--a,a=0;c!=m&&!((u=e.charCodeAt(c)-48)<0||u>9);++c)a=10*a+u;return n.e.r=--a,n}function rg(e,n){var a=e.t=="d"&&n instanceof Date;if(e.z!=null)try{return e.w=cn(e.z,a?Pi(n):n)}catch{}try{return e.w=cn((e.XF||{}).numFmtId||(a?14:0),a?Pi(n):n)}catch{return""+n}}function ls(e,n,a){return e==null||e.t==null||e.t=="z"?"":e.w!==void 0?e.w:(e.t=="d"&&!e.z&&a&&a.dateNF&&(e.z=a.dateNF),e.t=="e"?Eo[e.v]||e.v:n==null?rg(e,e.v):rg(e,n))}function zs(e,n){var a=n&&n.sheet?n.sheet:"Sheet1",c={};return c[a]=e,{SheetNames:[a],Sheets:c}}function G1(e,n,a){var c=a||{},u=e?Array.isArray(e):c.dense,m=e||(u?[]:{}),x=0,o=0;if(m&&c.origin!=null){if(typeof c.origin=="number")x=c.origin;else{var E=typeof c.origin=="string"?Ai(c.origin):c.origin;x=E.r,o=E.c}m["!ref"]||(m["!ref"]="A1:A1")}var w={s:{c:1e7,r:1e7},e:{c:0,r:0}};if(m["!ref"]){var C=pa(m["!ref"]);w.s.c=C.s.c,w.s.r=C.s.r,w.e.c=Math.max(w.e.c,C.e.c),w.e.r=Math.max(w.e.r,C.e.r),x==-1&&(w.e.r=x=C.e.r+1)}for(var P=0;P!=n.length;++P)if(n[P]){if(!Array.isArray(n[P]))throw new Error("aoa_to_sheet expects an array of arrays");for(var M=0;M!=n[P].length;++M)if(!(typeof n[P][M]>"u")){var B={v:n[P][M]},U=x+P,N=o+M;if(w.s.r>U&&(w.s.r=U),w.s.c>N&&(w.s.c=N),w.e.r<U&&(w.e.r=U),w.e.c<N&&(w.e.c=N),n[P][M]&&typeof n[P][M]=="object"&&!Array.isArray(n[P][M])&&!(n[P][M]instanceof Date))B=n[P][M];else if(Array.isArray(B.v)&&(B.f=n[P][M][1],B.v=B.v[0]),B.v===null)if(B.f)B.t="n";else if(c.nullError)B.t="e",B.v=0;else if(c.sheetStubs)B.t="z";else continue;else typeof B.v=="number"?B.t="n":typeof B.v=="boolean"?B.t="b":B.v instanceof Date?(B.z=c.dateNF||gr[14],c.cellDates?(B.t="d",B.w=cn(B.z,Pi(B.v))):(B.t="n",B.v=Pi(B.v),B.w=cn(B.z,B.v))):B.t="s";if(u)m[U]||(m[U]=[]),m[U][N]&&m[U][N].z&&(B.z=m[U][N].z),m[U][N]=B;else{var j=fr({c:N,r:U});m[j]&&m[j].z&&(B.z=m[j].z),m[j]=B}}}return w.s.c<1e7&&(m["!ref"]=Fr(w)),m}function El(e,n){return G1(null,e,n)}function KT(e){return e.read_shift(4,"i")}function fi(e){var n=e.read_shift(4);return n===0?"":e.read_shift(n,"dbcs")}function YT(e){return{ich:e.read_shift(2),ifnt:e.read_shift(2)}}function ld(e,n){var a=e.l,c=e.read_shift(1),u=fi(e),m=[],x={t:u,h:u};if(c&1){for(var o=e.read_shift(4),E=0;E!=o;++E)m.push(YT(e));x.r=m}else x.r=[{ich:0,ifnt:0}];return e.l=a+n,x}var JT=ld;function un(e){var n=e.read_shift(4),a=e.read_shift(2);return a+=e.read_shift(1)<<16,e.l++,{c:n,iStyleRef:a}}function bo(e){var n=e.read_shift(2);return n+=e.read_shift(1)<<16,e.l++,{c:-1,iStyleRef:n}}var QT=fi;function cd(e){var n=e.read_shift(4);return n===0||n===4294967295?"":e.read_shift(n,"dbcs")}var eE=fi,M0=cd;function ud(e){var n=e.slice(e.l,e.l+4),a=n[0]&1,c=n[0]&2;e.l+=4;var u=c===0?Oh([0,0,0,0,n[0]&252,n[1],n[2],n[3]],0):oo(n,0)>>2;return a?u/100:u}function H1(e){var n={s:{},e:{}};return n.s.r=e.read_shift(4),n.e.r=e.read_shift(4),n.s.c=e.read_shift(4),n.e.c=e.read_shift(4),n}var To=H1;function ui(e){if(e.length-e.l<8)throw"XLS Xnum Buffer underflow";return e.read_shift(8,"f")}function tE(e){var n={},a=e.read_shift(1),c=a>>>1,u=e.read_shift(1),m=e.read_shift(2,"i"),x=e.read_shift(1),o=e.read_shift(1),E=e.read_shift(1);switch(e.l++,c){case 0:n.auto=1;break;case 1:n.index=u;var w=po[u];w&&(n.rgb=Kc(w));break;case 2:n.rgb=Kc([x,o,E]);break;case 3:n.theme=u;break}return m!=0&&(n.tint=m>0?m/32767:m/32768),n}function rE(e){var n=e.read_shift(1);e.l++;var a={fBold:n&1,fItalic:n&2,fUnderline:n&4,fStrikeout:n&8,fOutline:n&16,fShadow:n&32,fCondense:n&64,fExtend:n&128};return a}function W1(e,n){var a={2:"BITMAP",3:"METAFILEPICT",8:"DIB",14:"ENHMETAFILE"},c=e.read_shift(4);switch(c){case 0:return"";case 4294967295:case 4294967294:return a[e.read_shift(4)]||""}if(c>400)throw new Error("Unsupported Clipboard: "+c.toString(16));return e.l-=4,e.read_shift(0,n==1?"lpstr":"lpwstr")}function aE(e){return W1(e,1)}function iE(e){return W1(e,2)}var hd=2,zi=3,yh=11,ag=12,Bh=19,vh=64,nE=65,sE=71,oE=4108,lE=4126,ja=80,q1=81,cE=[ja,q1],uE={1:{n:"CodePage",t:hd},2:{n:"Category",t:ja},3:{n:"PresentationFormat",t:ja},4:{n:"ByteCount",t:zi},5:{n:"LineCount",t:zi},6:{n:"ParagraphCount",t:zi},7:{n:"SlideCount",t:zi},8:{n:"NoteCount",t:zi},9:{n:"HiddenCount",t:zi},10:{n:"MultimediaClipCount",t:zi},11:{n:"ScaleCrop",t:yh},12:{n:"HeadingPairs",t:oE},13:{n:"TitlesOfParts",t:lE},14:{n:"Manager",t:ja},15:{n:"Company",t:ja},16:{n:"LinksUpToDate",t:yh},17:{n:"CharacterCount",t:zi},19:{n:"SharedDoc",t:yh},22:{n:"HyperlinksChanged",t:yh},23:{n:"AppVersion",t:zi,p:"version"},24:{n:"DigSig",t:nE},26:{n:"ContentType",t:ja},27:{n:"ContentStatus",t:ja},28:{n:"Language",t:ja},29:{n:"Version",t:ja},255:{},2147483648:{n:"Locale",t:Bh},2147483651:{n:"Behavior",t:Bh},1919054434:{}},hE={1:{n:"CodePage",t:hd},2:{n:"Title",t:ja},3:{n:"Subject",t:ja},4:{n:"Author",t:ja},5:{n:"Keywords",t:ja},6:{n:"Comments",t:ja},7:{n:"Template",t:ja},8:{n:"LastAuthor",t:ja},9:{n:"RevNumber",t:ja},10:{n:"EditTime",t:vh},11:{n:"LastPrinted",t:vh},12:{n:"CreatedDate",t:vh},13:{n:"ModifiedDate",t:vh},14:{n:"PageCount",t:zi},15:{n:"WordCount",t:zi},16:{n:"CharCount",t:zi},17:{n:"Thumbnail",t:sE},18:{n:"Application",t:ja},19:{n:"DocSecurity",t:zi},255:{},2147483648:{n:"Locale",t:Bh},2147483651:{n:"Behavior",t:Bh},1919054434:{}},ig={1:"US",2:"CA",3:"",7:"RU",20:"EG",30:"GR",31:"NL",32:"BE",33:"FR",34:"ES",36:"HU",39:"IT",41:"CH",43:"AT",44:"GB",45:"DK",46:"SE",47:"NO",48:"PL",49:"DE",52:"MX",55:"BR",61:"AU",64:"NZ",66:"TH",81:"JP",82:"KR",84:"VN",86:"CN",90:"TR",105:"JS",213:"DZ",216:"MA",218:"LY",351:"PT",354:"IS",358:"FI",420:"CZ",886:"TW",961:"LB",962:"JO",963:"SY",964:"IQ",965:"KW",966:"SA",971:"AE",972:"IL",974:"QA",981:"IR",65535:"US"},fE=[null,"solid","mediumGray","darkGray","lightGray","darkHorizontal","darkVertical","darkDown","darkUp","darkGrid","darkTrellis","lightHorizontal","lightVertical","lightDown","lightUp","lightGrid","lightTrellis","gray125","gray0625"];function dE(e){return e.map(function(n){return[n>>16&255,n>>8&255,n&255]})}var pE=dE([0,16777215,16711680,65280,255,16776960,16711935,65535,0,16777215,16711680,65280,255,16776960,16711935,65535,8388608,32768,128,8421376,8388736,32896,12632256,8421504,10066431,10040166,16777164,13434879,6684774,16744576,26316,13421823,128,16711935,16776960,65535,8388736,8388608,32896,255,52479,13434879,13434828,16777113,10079487,16751052,13408767,16764057,3368703,3394764,10079232,16763904,16750848,16737792,6710937,9868950,13158,3381606,13056,3355392,10040064,10040166,3355545,3355443,16777215,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),po=Ja(pE),Eo={0:"#NULL!",7:"#DIV/0!",15:"#VALUE!",23:"#REF!",29:"#NAME?",36:"#NUM!",42:"#N/A",43:"#GETTING_DATA",255:"#WTF?"},Z1={"#NULL!":0,"#DIV/0!":7,"#VALUE!":15,"#REF!":23,"#NAME?":29,"#NUM!":36,"#N/A":42,"#GETTING_DATA":43,"#WTF?":255},ng={"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml":"workbooks","application/vnd.ms-excel.sheet.macroEnabled.main+xml":"workbooks","application/vnd.ms-excel.sheet.binary.macroEnabled.main":"workbooks","application/vnd.ms-excel.addin.macroEnabled.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml":"sheets","application/vnd.ms-excel.worksheet":"sheets","application/vnd.ms-excel.binIndexWs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml":"charts","application/vnd.ms-excel.chartsheet":"charts","application/vnd.ms-excel.macrosheet+xml":"macros","application/vnd.ms-excel.macrosheet":"macros","application/vnd.ms-excel.intlmacrosheet":"TODO","application/vnd.ms-excel.binIndexMs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml":"dialogs","application/vnd.ms-excel.dialogsheet":"dialogs","application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml":"strs","application/vnd.ms-excel.sharedStrings":"strs","application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml":"styles","application/vnd.ms-excel.styles":"styles","application/vnd.openxmlformats-package.core-properties+xml":"coreprops","application/vnd.openxmlformats-officedocument.custom-properties+xml":"custprops","application/vnd.openxmlformats-officedocument.extended-properties+xml":"extprops","application/vnd.openxmlformats-officedocument.customXmlProperties+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.customProperty":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml":"comments","application/vnd.ms-excel.comments":"comments","application/vnd.ms-excel.threadedcomments+xml":"threadedcomments","application/vnd.ms-excel.person+xml":"people","application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml":"metadata","application/vnd.ms-excel.sheetMetadata":"metadata","application/vnd.ms-excel.pivotTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotTable+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.chart+xml":"TODO","application/vnd.ms-office.chartcolorstyle+xml":"TODO","application/vnd.ms-office.chartstyle+xml":"TODO","application/vnd.ms-office.chartex+xml":"TODO","application/vnd.ms-excel.calcChain":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.calcChain+xml":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.printerSettings":"TODO","application/vnd.ms-office.activeX":"TODO","application/vnd.ms-office.activeX+xml":"TODO","application/vnd.ms-excel.attachedToolbars":"TODO","application/vnd.ms-excel.connections":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.connections+xml":"TODO","application/vnd.ms-excel.externalLink":"links","application/vnd.openxmlformats-officedocument.spreadsheetml.externalLink+xml":"links","application/vnd.ms-excel.pivotCacheDefinition":"TODO","application/vnd.ms-excel.pivotCacheRecords":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheDefinition+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheRecords+xml":"TODO","application/vnd.ms-excel.queryTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.queryTable+xml":"TODO","application/vnd.ms-excel.userNames":"TODO","application/vnd.ms-excel.revisionHeaders":"TODO","application/vnd.ms-excel.revisionLog":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionHeaders+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionLog+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.userNames+xml":"TODO","application/vnd.ms-excel.tableSingleCells":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.tableSingleCells+xml":"TODO","application/vnd.ms-excel.slicer":"TODO","application/vnd.ms-excel.slicerCache":"TODO","application/vnd.ms-excel.slicer+xml":"TODO","application/vnd.ms-excel.slicerCache+xml":"TODO","application/vnd.ms-excel.wsSortMap":"TODO","application/vnd.ms-excel.table":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml":"TODO","application/vnd.openxmlformats-officedocument.theme+xml":"themes","application/vnd.openxmlformats-officedocument.themeOverride+xml":"TODO","application/vnd.ms-excel.Timeline+xml":"TODO","application/vnd.ms-excel.TimelineCache+xml":"TODO","application/vnd.ms-office.vbaProject":"vba","application/vnd.ms-office.vbaProjectSignature":"TODO","application/vnd.ms-office.volatileDependencies":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.volatileDependencies+xml":"TODO","application/vnd.ms-excel.controlproperties+xml":"TODO","application/vnd.openxmlformats-officedocument.model+data":"TODO","application/vnd.ms-excel.Survey+xml":"TODO","application/vnd.openxmlformats-officedocument.drawing+xml":"drawings","application/vnd.openxmlformats-officedocument.drawingml.chartshapes+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramColors+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramData+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramLayout+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramStyle+xml":"TODO","application/vnd.openxmlformats-officedocument.vmlDrawing":"TODO","application/vnd.openxmlformats-package.relationships+xml":"rels","application/vnd.openxmlformats-officedocument.oleObject":"TODO","image/png":"TODO",sheet:"js"};function mE(){return{workbooks:[],sheets:[],charts:[],dialogs:[],macros:[],rels:[],strs:[],comments:[],threadedcomments:[],links:[],coreprops:[],extprops:[],custprops:[],themes:[],styles:[],calcchains:[],vba:[],drawings:[],metadata:[],people:[],TODO:[],xmlns:""}}function gE(e){var n=mE();if(!e||!e.match)return n;var a={};if((e.match(pi)||[]).forEach(function(c){var u=nr(c);switch(u[0].replace(ET,"<")){case"<?xml":break;case"<Types":n.xmlns=u["xmlns"+(u[0].match(/<(\w+):/)||["",""])[1]];break;case"<Default":a[u.Extension]=u.ContentType;break;case"<Override":n[ng[u.ContentType]]!==void 0&&n[ng[u.ContentType]].push(u.PartName);break}}),n.xmlns!==RT.CT)throw new Error("Unknown Namespace: "+n.xmlns);return n.calcchain=n.calcchains.length>0?n.calcchains[0]:"",n.sst=n.strs.length>0?n.strs[0]:"",n.style=n.styles.length>0?n.styles[0]:"",n.defaults=a,delete n.calcchains,n}var dl={WB:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument",SHEET:"http://sheetjs.openxmlformats.org/officeDocument/2006/relationships/officeDocument",HLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink",VML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/vmlDrawing",XPATH:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLinkPath",XMISS:"http://schemas.microsoft.com/office/2006/relationships/xlExternalLinkPath/xlPathMissing",XLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLink",CXML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXml",CXMLP:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXmlProps",CMNT:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/comments",CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/custom-properties",SST:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings",STY:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles",THEME:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/theme",CHART:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chart",CHARTEX:"http://schemas.microsoft.com/office/2014/relationships/chartEx",CS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chartsheet",WS:["http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet","http://purl.oclc.org/ooxml/officeDocument/relationships/worksheet"],DS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/dialogsheet",MS:"http://schemas.microsoft.com/office/2006/relationships/xlMacrosheet",IMG:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/image",DRAW:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing",XLMETA:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sheetMetadata",TCMNT:"http://schemas.microsoft.com/office/2017/10/relationships/threadedComment",PEOPLE:"http://schemas.microsoft.com/office/2017/10/relationships/person",VBA:"http://schemas.microsoft.com/office/2006/relationships/vbaProject"};function D0(e){var n=e.lastIndexOf("/");return e.slice(0,n+1)+"_rels/"+e.slice(n+1)+".rels"}function Nc(e,n){var a={"!id":{}};if(!e)return a;n.charAt(0)!=="/"&&(n="/"+n);var c={};return(e.match(pi)||[]).forEach(function(u){var m=nr(u);if(m[0]==="<Relationship"){var x={};x.Type=m.Type,x.Target=m.Target,x.Id=m.Id,m.TargetMode&&(x.TargetMode=m.TargetMode);var o=m.TargetMode==="External"?m.Target:Lc(m.Target,n);a[o]=x,c[m.Id]=x}}),a["!id"]=c,a}var xE="application/vnd.oasis.opendocument.spreadsheet";function _E(e,n){for(var a=id(e),c,u;c=Zc.exec(a);)switch(c[3]){case"manifest":break;case"file-entry":if(u=nr(c[0],!1),u.path=="/"&&u.type!==xE)throw new Error("This OpenDocument is not a spreadsheet");break;case"encryption-data":case"algorithm":case"start-key-generation":case"key-derivation":throw new Error("Unsupported ODS Encryption");default:if(n&&n.WTF)throw c}}var Uc=[["cp:category","Category"],["cp:contentStatus","ContentStatus"],["cp:keywords","Keywords"],["cp:lastModifiedBy","LastAuthor"],["cp:lastPrinted","LastPrinted"],["cp:revision","RevNumber"],["cp:version","Version"],["dc:creator","Author"],["dc:description","Comments"],["dc:identifier","Identifier"],["dc:language","Language"],["dc:subject","Subject"],["dc:title","Title"],["dcterms:created","CreatedDate","date"],["dcterms:modified","ModifiedDate","date"]],yE=function(){for(var e=new Array(Uc.length),n=0;n<Uc.length;++n){var a=Uc[n],c="(?:"+a[0].slice(0,a[0].indexOf(":"))+":)"+a[0].slice(a[0].indexOf(":")+1);e[n]=new RegExp("<"+c+"[^>]*>([\\s\\S]*?)</"+c+">")}return e}();function X1(e){var n={};e=Xr(e);for(var a=0;a<Uc.length;++a){var c=Uc[a],u=e.match(yE[a]);u!=null&&u.length>0&&(n[c[1]]=Mr(u[1])),c[2]==="date"&&n[c[1]]&&(n[c[1]]=Ga(n[c[1]]))}return n}var vE=[["Application","Application","string"],["AppVersion","AppVersion","string"],["Company","Company","string"],["DocSecurity","DocSecurity","string"],["Manager","Manager","string"],["HyperlinksChanged","HyperlinksChanged","bool"],["SharedDoc","SharedDoc","bool"],["LinksUpToDate","LinksUpToDate","bool"],["ScaleCrop","ScaleCrop","bool"],["HeadingPairs","HeadingPairs","raw"],["TitlesOfParts","TitlesOfParts","raw"]];function K1(e,n,a,c){var u=[];if(typeof e=="string")u=Xm(e,c);else for(var m=0;m<e.length;++m)u=u.concat(e[m].map(function(C){return{v:C}}));var x=typeof n=="string"?Xm(n,c).map(function(C){return C.v}):n,o=0,E=0;if(x.length>0)for(var w=0;w!==u.length;w+=2){switch(E=+u[w+1].v,u[w].v){case"Worksheets":case"工作表":case"Листы":case"أوراق العمل":case"ワークシート":case"גליונות עבודה":case"Arbeitsblätter":case"Çalışma Sayfaları":case"Feuilles de calcul":case"Fogli di lavoro":case"Folhas de cálculo":case"Planilhas":case"Regneark":case"Hojas de cálculo":case"Werkbladen":a.Worksheets=E,a.SheetNames=x.slice(o,o+E);break;case"Named Ranges":case"Rangos con nombre":case"名前付き一覧":case"Benannte Bereiche":case"Navngivne områder":a.NamedRanges=E,a.DefinedNames=x.slice(o,o+E);break;case"Charts":case"Diagramme":a.Chartsheets=E,a.ChartNames=x.slice(o,o+E);break}o+=E}}function wE(e,n,a){var c={};return n||(n={}),e=Xr(e),vE.forEach(function(u){var m=(e.match(qc(u[0]))||[])[1];switch(u[2]){case"string":m&&(n[u[1]]=Mr(m));break;case"bool":n[u[1]]=m==="true";break;case"raw":var x=e.match(new RegExp("<"+u[0]+"[^>]*>([\\s\\S]*?)</"+u[0]+">"));x&&x.length>0&&(c[u[1]]=x[1]);break}}),c.HeadingPairs&&c.TitlesOfParts&&K1(c.HeadingPairs,c.TitlesOfParts,n,a),n}var bE=/<[^>]+>[^<]*/g;function TE(e,n){var a={},c="",u=e.match(bE);if(u)for(var m=0;m!=u.length;++m){var x=u[m],o=nr(x);switch(o[0]){case"<?xml":break;case"<Properties":break;case"<property":c=Mr(o.name);break;case"</property>":c=null;break;default:if(x.indexOf("<vt:")===0){var E=x.split(">"),w=E[0].slice(4),C=E[1];switch(w){case"lpstr":case"bstr":case"lpwstr":a[c]=Mr(C);break;case"bool":a[c]=na(C);break;case"i1":case"i2":case"i4":case"i8":case"int":case"uint":a[c]=parseInt(C,10);break;case"r4":case"r8":case"decimal":a[c]=parseFloat(C);break;case"filetime":case"date":a[c]=Ga(C);break;case"cy":case"error":a[c]=Mr(C);break;default:if(w.slice(-1)=="/")break;n.WTF&&typeof console<"u"&&console.warn("Unexpected",x,w,E)}}else if(x.slice(0,2)!=="</"){if(n.WTF)throw new Error(x)}}}return a}var EE={Title:"Title",Subject:"Subject",Author:"Author",Keywords:"Keywords",Comments:"Description",LastAuthor:"LastAuthor",RevNumber:"Revision",Application:"AppName",LastPrinted:"LastPrinted",CreatedDate:"Created",ModifiedDate:"LastSaved",Category:"Category",Manager:"Manager",Company:"Company",AppVersion:"Version",ContentStatus:"ContentStatus",Identifier:"Identifier",Language:"Language"},p0;function SE(e,n,a){p0||(p0=td(EE)),n=p0[n]||n,e[n]=a}function fd(e){var n=e.read_shift(4),a=e.read_shift(4);return new Date((a/1e7*Math.pow(2,32)+n/1e7-11644473600)*1e3).toISOString().replace(/\.000/,"")}function Y1(e,n,a){var c=e.l,u=e.read_shift(0,"lpstr-cp");if(a)for(;e.l-c&3;)++e.l;return u}function J1(e,n,a){var c=e.read_shift(0,"lpwstr");return a&&(e.l+=4-(c.length+1&3)&3),c}function Q1(e,n,a){return n===31?J1(e):Y1(e,n,a)}function L0(e,n,a){return Q1(e,n,a===!1?0:4)}function kE(e,n){if(!n)throw new Error("VtUnalignedString must have positive length");return Q1(e,n,0)}function CE(e){for(var n=e.read_shift(4),a=[],c=0;c!=n;++c){var u=e.l;a[c]=e.read_shift(0,"lpwstr").replace(Ii,""),e.l-u&2&&(e.l+=2)}return a}function AE(e){for(var n=e.read_shift(4),a=[],c=0;c!=n;++c)a[c]=e.read_shift(0,"lpstr-cp").replace(Ii,"");return a}function IE(e){var n=e.l,a=zh(e,q1);e[e.l]==0&&e[e.l+1]==0&&e.l-n&2&&(e.l+=2);var c=zh(e,zi);return[a,c]}function FE(e){for(var n=e.read_shift(4),a=[],c=0;c<n/2;++c)a.push(IE(e));return a}function sg(e,n){for(var a=e.read_shift(4),c={},u=0;u!=a;++u){var m=e.read_shift(4),x=e.read_shift(4);c[m]=e.read_shift(x,n===1200?"utf16le":"utf8").replace(Ii,"").replace(Dc,"!"),n===1200&&x%2&&(e.l+=2)}return e.l&3&&(e.l=e.l>>3<<2),c}function ex(e){var n=e.read_shift(4),a=e.slice(e.l,e.l+n);return e.l+=n,(n&3)>0&&(e.l+=4-(n&3)&3),a}function PE(e){var n={};return n.Size=e.read_shift(4),e.l+=n.Size+3-(n.Size-1)%4,n}function zh(e,n,a){var c=e.read_shift(2),u,m=a||{};if(e.l+=2,n!==ag&&c!==n&&cE.indexOf(n)===-1&&!((n&65534)==4126&&(c&65534)==4126))throw new Error("Expected type "+n+" saw "+c);switch(n===ag?c:n){case 2:return u=e.read_shift(2,"i"),m.raw||(e.l+=2),u;case 3:return u=e.read_shift(4,"i"),u;case 11:return e.read_shift(4)!==0;case 19:return u=e.read_shift(4),u;case 30:return Y1(e,c,4).replace(Ii,"");case 31:return J1(e);case 64:return fd(e);case 65:return ex(e);case 71:return PE(e);case 80:return L0(e,c,!m.raw).replace(Ii,"");case 81:return kE(e,c).replace(Ii,"");case 4108:return FE(e);case 4126:case 4127:return c==4127?CE(e):AE(e);default:throw new Error("TypedPropertyValue unrecognized type "+n+" "+c)}}function og(e,n){var a=e.l,c=e.read_shift(4),u=e.read_shift(4),m=[],x=0,o=0,E=-1,w={};for(x=0;x!=u;++x){var C=e.read_shift(4),P=e.read_shift(4);m[x]=[C,P+a]}m.sort(function(pe,X){return pe[1]-X[1]});var M={};for(x=0;x!=u;++x){if(e.l!==m[x][1]){var B=!0;if(x>0&&n)switch(n[m[x-1][0]].t){case 2:e.l+2===m[x][1]&&(e.l+=2,B=!1);break;case 80:e.l<=m[x][1]&&(e.l=m[x][1],B=!1);break;case 4108:e.l<=m[x][1]&&(e.l=m[x][1],B=!1);break}if((!n||x==0)&&e.l<=m[x][1]&&(B=!1,e.l=m[x][1]),B)throw new Error("Read Error: Expected address "+m[x][1]+" at "+e.l+" :"+x)}if(n){var U=n[m[x][0]];if(M[U.n]=zh(e,U.t,{raw:!0}),U.p==="version"&&(M[U.n]=String(M[U.n]>>16)+"."+("0000"+String(M[U.n]&65535)).slice(-4)),U.n=="CodePage")switch(M[U.n]){case 0:M[U.n]=1252;case 874:case 932:case 936:case 949:case 950:case 1250:case 1251:case 1253:case 1254:case 1255:case 1256:case 1257:case 1258:case 1e4:case 1200:case 1201:case 1252:case 65e3:case-536:case 65001:case-535:En(o=M[U.n]>>>0&65535);break;default:throw new Error("Unsupported CodePage: "+M[U.n])}}else if(m[x][0]===1){if(o=M.CodePage=zh(e,hd),En(o),E!==-1){var N=e.l;e.l=m[E][1],w=sg(e,o),e.l=N}}else if(m[x][0]===0){if(o===0){E=x,e.l=m[x+1][1];continue}w=sg(e,o)}else{var j=w[m[x][0]],re;switch(e[e.l]){case 65:e.l+=4,re=ex(e);break;case 30:e.l+=4,re=L0(e,e[e.l-4]).replace(/\u0000+$/,"");break;case 31:e.l+=4,re=L0(e,e[e.l-4]).replace(/\u0000+$/,"");break;case 3:e.l+=4,re=e.read_shift(4,"i");break;case 19:e.l+=4,re=e.read_shift(4);break;case 5:e.l+=4,re=e.read_shift(8,"f");break;case 11:e.l+=4,re=Ea(e,4);break;case 64:e.l+=4,re=Ga(fd(e));break;default:throw new Error("unparsed value: "+e[e.l])}M[j]=re}}return e.l=a+c,M}function lg(e,n,a){var c=e.content;if(!c)return{};Ya(c,0);var u,m,x,o,E=0;c.chk("feff","Byte Order: "),c.read_shift(2);var w=c.read_shift(4),C=c.read_shift(16);if(C!==Ir.utils.consts.HEADER_CLSID&&C!==a)throw new Error("Bad PropertySet CLSID "+C);if(u=c.read_shift(4),u!==1&&u!==2)throw new Error("Unrecognized #Sets: "+u);if(m=c.read_shift(16),o=c.read_shift(4),u===1&&o!==c.l)throw new Error("Length mismatch: "+o+" !== "+c.l);u===2&&(x=c.read_shift(16),E=c.read_shift(4));var P=og(c,n),M={SystemIdentifier:w};for(var B in P)M[B]=P[B];if(M.FMTID=m,u===1)return M;if(E-c.l==2&&(c.l+=2),c.l!==E)throw new Error("Length mismatch 2: "+c.l+" !== "+E);var U;try{U=og(c,null)}catch{}for(B in U)M[B]=U[B];return M.FMTID=[m,x],M}function Is(e,n){return e.read_shift(n),null}function ME(e,n,a){for(var c=[],u=e.l+n;e.l<u;)c.push(a(e,u-e.l));if(u!==e.l)throw new Error("Slurp error");return c}function Ea(e,n){return e.read_shift(n)===1}function Ca(e){return e.read_shift(2,"u")}function tx(e,n){return ME(e,n,Ca)}function DE(e){var n=e.read_shift(1),a=e.read_shift(1);return a===1?n:n===1}function iu(e,n,a){var c=e.read_shift(a&&a.biff>=12?2:1),u="sbcs-cont";if(a&&a.biff>=8,!a||a.biff==8){var m=e.read_shift(1);m&&(u="dbcs-cont")}else a.biff==12&&(u="wstr");a.biff>=2&&a.biff<=5&&(u="cpstr");var x=c?e.read_shift(c,u):"";return x}function LE(e){var n=e.read_shift(2),a=e.read_shift(1),c=a&4,u=a&8,m=1+(a&1),x=0,o,E={};u&&(x=e.read_shift(2)),c&&(o=e.read_shift(4));var w=m==2?"dbcs-cont":"sbcs-cont",C=n===0?"":e.read_shift(n,w);return u&&(e.l+=4*x),c&&(e.l+=o),E.t=C,u||(E.raw="<t>"+E.t+"</t>",E.r=E.t),E}function xo(e,n,a){var c;if(a){if(a.biff>=2&&a.biff<=5)return e.read_shift(n,"cpstr");if(a.biff>=12)return e.read_shift(n,"dbcs-cont")}var u=e.read_shift(1);return u===0?c=e.read_shift(n,"sbcs-cont"):c=e.read_shift(n,"dbcs-cont"),c}function nu(e,n,a){var c=e.read_shift(a&&a.biff==2?1:2);return c===0?(e.l++,""):xo(e,c,a)}function So(e,n,a){if(a.biff>5)return nu(e,n,a);var c=e.read_shift(1);return c===0?(e.l++,""):e.read_shift(c,a.biff<=4||!e.lens?"cpstr":"sbcs-cont")}function RE(e){var n=e.read_shift(1);e.l++;var a=e.read_shift(2);return e.l+=2,[n,a]}function OE(e){var n=e.read_shift(4),a=e.l,c=!1;n>24&&(e.l+=n-24,e.read_shift(16)==="795881f43b1d7f48af2c825dc4852763"&&(c=!0),e.l=a);var u=e.read_shift((c?n-24:n)>>1,"utf16le").replace(Ii,"");return c&&(e.l+=24),u}function BE(e){for(var n=e.read_shift(2),a="";n-- >0;)a+="../";var c=e.read_shift(0,"lpstr-ansi");if(e.l+=2,e.read_shift(2)!=57005)throw new Error("Bad FileMoniker");var u=e.read_shift(4);if(u===0)return a+c.replace(/\\/g,"/");var m=e.read_shift(4);if(e.read_shift(2)!=3)throw new Error("Bad FileMoniker");var x=e.read_shift(m>>1,"utf16le").replace(Ii,"");return a+x}function zE(e,n){var a=e.read_shift(16);switch(a){case"e0c9ea79f9bace118c8200aa004ba90b":return OE(e);case"0303000000000000c000000000000046":return BE(e);default:throw new Error("Unsupported Moniker "+a)}}function wh(e){var n=e.read_shift(4),a=n>0?e.read_shift(n,"utf16le").replace(Ii,""):"";return a}function NE(e,n){var a=e.l+n,c=e.read_shift(4);if(c!==2)throw new Error("Unrecognized streamVersion: "+c);var u=e.read_shift(2);e.l+=2;var m,x,o,E,w="",C,P;u&16&&(m=wh(e,a-e.l)),u&128&&(x=wh(e,a-e.l)),(u&257)===257&&(o=wh(e,a-e.l)),(u&257)===1&&(E=zE(e,a-e.l)),u&8&&(w=wh(e,a-e.l)),u&32&&(C=e.read_shift(16)),u&64&&(P=fd(e)),e.l=a;var M=x||o||E||"";M&&w&&(M+="#"+w),M||(M="#"+w),u&2&&M.charAt(0)=="/"&&M.charAt(1)!="/"&&(M="file://"+M);var B={Target:M};return C&&(B.guid=C),P&&(B.time=P),m&&(B.Tooltip=m),B}function rx(e){var n=e.read_shift(1),a=e.read_shift(1),c=e.read_shift(1),u=e.read_shift(1);return[n,a,c,u]}function ax(e,n){var a=rx(e);return a[3]=0,a}function Un(e){var n=e.read_shift(2),a=e.read_shift(2),c=e.read_shift(2);return{r:n,c:a,ixfe:c}}function UE(e){var n=e.read_shift(2),a=e.read_shift(2);return e.l+=8,{type:n,flags:a}}function VE(e,n,a){return n===0?"":So(e,n,a)}function $E(e,n,a){var c=a.biff>8?4:2,u=e.read_shift(c),m=e.read_shift(c,"i"),x=e.read_shift(c,"i");return[u,m,x]}function ix(e){var n=e.read_shift(2),a=ud(e);return[n,a]}function jE(e,n,a){e.l+=4,n-=4;var c=e.l+n,u=iu(e,n,a),m=e.read_shift(2);if(c-=e.l,m!==c)throw new Error("Malformed AddinUdf: padding = "+c+" != "+m);return e.l+=m,u}function Zh(e){var n=e.read_shift(2),a=e.read_shift(2),c=e.read_shift(2),u=e.read_shift(2);return{s:{c,r:n},e:{c:u,r:a}}}function nx(e){var n=e.read_shift(2),a=e.read_shift(2),c=e.read_shift(1),u=e.read_shift(1);return{s:{c,r:n},e:{c:u,r:a}}}var GE=nx;function sx(e){e.l+=4;var n=e.read_shift(2),a=e.read_shift(2),c=e.read_shift(2);return e.l+=12,[a,n,c]}function HE(e){var n={};return e.l+=4,e.l+=16,n.fSharedNote=e.read_shift(2),e.l+=4,n}function WE(e){var n={};return e.l+=4,e.cf=e.read_shift(2),n}function li(e){e.l+=2,e.l+=e.read_shift(2)}var qE={0:li,4:li,5:li,6:li,7:WE,8:li,9:li,10:li,11:li,12:li,13:HE,14:li,15:li,16:li,17:li,18:li,19:li,20:li,21:sx};function ZE(e,n){for(var a=e.l+n,c=[];e.l<a;){var u=e.read_shift(2);e.l-=2;try{c.push(qE[u](e,a-e.l))}catch{return e.l=a,c}}return e.l!=a&&(e.l=a),c}function bh(e,n){var a={BIFFVer:0,dt:0};switch(a.BIFFVer=e.read_shift(2),n-=2,n>=2&&(a.dt=e.read_shift(2),e.l-=2),a.BIFFVer){case 1536:case 1280:case 1024:case 768:case 512:case 2:case 7:break;default:if(n>6)throw new Error("Unexpected BIFF Ver "+a.BIFFVer)}return e.read_shift(n),a}function XE(e,n){return n===0||e.read_shift(2),1200}function KE(e,n,a){if(a.enc)return e.l+=n,"";var c=e.l,u=So(e,0,a);return e.read_shift(n+c-e.l),u}function YE(e,n,a){var c=a&&a.biff==8||n==2?e.read_shift(2):(e.l+=n,0);return{fDialog:c&16,fBelow:c&64,fRight:c&128}}function JE(e,n,a){var c=e.read_shift(4),u=e.read_shift(1)&3,m=e.read_shift(1);switch(m){case 0:m="Worksheet";break;case 1:m="Macrosheet";break;case 2:m="Chartsheet";break;case 6:m="VBAModule";break}var x=iu(e,0,a);return x.length===0&&(x="Sheet1"),{pos:c,hs:u,dt:m,name:x}}function QE(e,n){for(var a=e.l+n,c=e.read_shift(4),u=e.read_shift(4),m=[],x=0;x!=u&&e.l<a;++x)m.push(LE(e));return m.Count=c,m.Unique=u,m}function eS(e,n){var a={};return a.dsst=e.read_shift(2),e.l+=n-2,a}function tS(e){var n={};n.r=e.read_shift(2),n.c=e.read_shift(2),n.cnt=e.read_shift(2)-n.c;var a=e.read_shift(2);e.l+=4;var c=e.read_shift(1);return e.l+=3,c&7&&(n.level=c&7),c&32&&(n.hidden=!0),c&64&&(n.hpt=a/20),n}function rS(e){var n=UE(e);if(n.type!=2211)throw new Error("Invalid Future Record "+n.type);var a=e.read_shift(4);return a!==0}function aS(e){return e.read_shift(2),e.read_shift(4)}function cg(e,n,a){var c=0;a&&a.biff==2||(c=e.read_shift(2));var u=e.read_shift(2);a&&a.biff==2&&(c=1-(u>>15),u&=32767);var m={Unsynced:c&1,DyZero:(c&2)>>1,ExAsc:(c&4)>>2,ExDsc:(c&8)>>3};return[m,u]}function iS(e){var n=e.read_shift(2),a=e.read_shift(2),c=e.read_shift(2),u=e.read_shift(2),m=e.read_shift(2),x=e.read_shift(2),o=e.read_shift(2),E=e.read_shift(2),w=e.read_shift(2);return{Pos:[n,a],Dim:[c,u],Flags:m,CurTab:x,FirstTab:o,Selected:E,TabRatio:w}}function nS(e,n,a){if(a&&a.biff>=2&&a.biff<5)return{};var c=e.read_shift(2);return{RTL:c&64}}function sS(){}function oS(e,n,a){var c={dyHeight:e.read_shift(2),fl:e.read_shift(2)};switch(a&&a.biff||8){case 2:break;case 3:case 4:e.l+=2;break;default:e.l+=10;break}return c.name=iu(e,0,a),c}function lS(e){var n=Un(e);return n.isst=e.read_shift(4),n}function cS(e,n,a){a.biffguess&&a.biff==2&&(a.biff=5);var c=e.l+n,u=Un(e);a.biff==2&&e.l++;var m=nu(e,c-e.l,a);return u.val=m,u}function uS(e,n,a){var c=e.read_shift(2),u=So(e,0,a);return[c,u]}var hS=So;function ug(e,n,a){var c=e.l+n,u=a.biff==8||!a.biff?4:2,m=e.read_shift(u),x=e.read_shift(u),o=e.read_shift(2),E=e.read_shift(2);return e.l=c,{s:{r:m,c:o},e:{r:x,c:E}}}function fS(e){var n=e.read_shift(2),a=e.read_shift(2),c=ix(e);return{r:n,c:a,ixfe:c[0],rknum:c[1]}}function dS(e,n){for(var a=e.l+n-2,c=e.read_shift(2),u=e.read_shift(2),m=[];e.l<a;)m.push(ix(e));if(e.l!==a)throw new Error("MulRK read error");var x=e.read_shift(2);if(m.length!=x-u+1)throw new Error("MulRK length mismatch");return{r:c,c:u,C:x,rkrec:m}}function pS(e,n){for(var a=e.l+n-2,c=e.read_shift(2),u=e.read_shift(2),m=[];e.l<a;)m.push(e.read_shift(2));if(e.l!==a)throw new Error("MulBlank read error");var x=e.read_shift(2);if(m.length!=x-u+1)throw new Error("MulBlank length mismatch");return{r:c,c:u,C:x,ixfe:m}}function mS(e,n,a,c){var u={},m=e.read_shift(4),x=e.read_shift(4),o=e.read_shift(4),E=e.read_shift(2);return u.patternType=fE[o>>26],c.cellStyles&&(u.alc=m&7,u.fWrap=m>>3&1,u.alcV=m>>4&7,u.fJustLast=m>>7&1,u.trot=m>>8&255,u.cIndent=m>>16&15,u.fShrinkToFit=m>>20&1,u.iReadOrder=m>>22&2,u.fAtrNum=m>>26&1,u.fAtrFnt=m>>27&1,u.fAtrAlc=m>>28&1,u.fAtrBdr=m>>29&1,u.fAtrPat=m>>30&1,u.fAtrProt=m>>31&1,u.dgLeft=x&15,u.dgRight=x>>4&15,u.dgTop=x>>8&15,u.dgBottom=x>>12&15,u.icvLeft=x>>16&127,u.icvRight=x>>23&127,u.grbitDiag=x>>30&3,u.icvTop=o&127,u.icvBottom=o>>7&127,u.icvDiag=o>>14&127,u.dgDiag=o>>21&15,u.icvFore=E&127,u.icvBack=E>>7&127,u.fsxButton=E>>14&1),u}function gS(e,n,a){var c={};return c.ifnt=e.read_shift(2),c.numFmtId=e.read_shift(2),c.flags=e.read_shift(2),c.fStyle=c.flags>>2&1,n-=6,c.data=mS(e,n,c.fStyle,a),c}function xS(e){e.l+=4;var n=[e.read_shift(2),e.read_shift(2)];if(n[0]!==0&&n[0]--,n[1]!==0&&n[1]--,n[0]>7||n[1]>7)throw new Error("Bad Gutters: "+n.join("|"));return n}function hg(e,n,a){var c=Un(e);(a.biff==2||n==9)&&++e.l;var u=DE(e);return c.val=u,c.t=u===!0||u===!1?"b":"e",c}function _S(e,n,a){a.biffguess&&a.biff==2&&(a.biff=5);var c=Un(e),u=ui(e);return c.val=u,c}var fg=VE;function yS(e,n,a){var c=e.l+n,u=e.read_shift(2),m=e.read_shift(2);if(a.sbcch=m,m==1025||m==14849)return[m,u];if(m<1||m>255)throw new Error("Unexpected SupBook type: "+m);for(var x=xo(e,m),o=[];c>e.l;)o.push(nu(e));return[m,u,x,o]}function dg(e,n,a){var c=e.read_shift(2),u,m={fBuiltIn:c&1,fWantAdvise:c>>>1&1,fWantPict:c>>>2&1,fOle:c>>>3&1,fOleLink:c>>>4&1,cf:c>>>5&1023,fIcon:c>>>15&1};return a.sbcch===14849&&(u=jE(e,n-2,a)),m.body=u||e.read_shift(n-2),typeof u=="string"&&(m.Name=u),m}var vS=["_xlnm.Consolidate_Area","_xlnm.Auto_Open","_xlnm.Auto_Close","_xlnm.Extract","_xlnm.Database","_xlnm.Criteria","_xlnm.Print_Area","_xlnm.Print_Titles","_xlnm.Recorder","_xlnm.Data_Form","_xlnm.Auto_Activate","_xlnm.Auto_Deactivate","_xlnm.Sheet_Title","_xlnm._FilterDatabase"];function pg(e,n,a){var c=e.l+n,u=e.read_shift(2),m=e.read_shift(1),x=e.read_shift(1),o=e.read_shift(a&&a.biff==2?1:2),E=0;(!a||a.biff>=5)&&(a.biff!=5&&(e.l+=2),E=e.read_shift(2),a.biff==5&&(e.l+=2),e.l+=4);var w=xo(e,x,a);u&32&&(w=vS[w.charCodeAt(0)]);var C=c-e.l;a&&a.biff==2&&--C;var P=c==e.l||o===0||!(C>0)?[]:t3(e,C,a,o);return{chKey:m,Name:w,itab:E,rgce:P}}function ox(e,n,a){if(a.biff<8)return wS(e,n,a);for(var c=[],u=e.l+n,m=e.read_shift(a.biff>8?4:2);m--!==0;)c.push($E(e,a.biff>8?12:6,a));if(e.l!=u)throw new Error("Bad ExternSheet: "+e.l+" != "+u);return c}function wS(e,n,a){e[e.l+1]==3&&e[e.l]++;var c=iu(e,n,a);return c.charCodeAt(0)==3?c.slice(1):c}function bS(e,n,a){if(a.biff<8){e.l+=n;return}var c=e.read_shift(2),u=e.read_shift(2),m=xo(e,c,a),x=xo(e,u,a);return[m,x]}function TS(e,n,a){var c=nx(e);e.l++;var u=e.read_shift(1);return n-=8,[r3(e,n,a),u,c]}function mg(e,n,a){var c=GE(e);switch(a.biff){case 2:e.l++,n-=7;break;case 3:case 4:e.l+=2,n-=8;break;default:e.l+=6,n-=12}return[c,Q4(e,n,a)]}function ES(e){var n=e.read_shift(4)!==0,a=e.read_shift(4)!==0,c=e.read_shift(4);return[n,a,c]}function SS(e,n,a){if(!(a.biff<8)){var c=e.read_shift(2),u=e.read_shift(2),m=e.read_shift(2),x=e.read_shift(2),o=So(e,0,a);return a.biff<8&&e.read_shift(1),[{r:c,c:u},o,x,m]}}function kS(e,n,a){return SS(e,n,a)}function CS(e,n){for(var a=[],c=e.read_shift(2);c--;)a.push(Zh(e));return a}function AS(e,n,a){if(a&&a.biff<8)return FS(e,n,a);var c=sx(e),u=ZE(e,n-22,c[1]);return{cmo:c,ft:u}}var IS={8:function(e,n){var a=e.l+n;e.l+=10;var c=e.read_shift(2);e.l+=4,e.l+=2,e.l+=2,e.l+=2,e.l+=4;var u=e.read_shift(1);return e.l+=u,e.l=a,{fmt:c}}};function FS(e,n,a){e.l+=4;var c=e.read_shift(2),u=e.read_shift(2),m=e.read_shift(2);e.l+=2,e.l+=2,e.l+=2,e.l+=2,e.l+=2,e.l+=2,e.l+=2,e.l+=2,e.l+=2,e.l+=6,n-=36;var x=[];return x.push((IS[c]||di)(e,n,a)),{cmo:[u,c,m],ft:x}}function PS(e,n,a){var c=e.l,u="";try{e.l+=4;var m=(a.lastobj||{cmo:[0,0]}).cmo[1],x;[0,5,7,11,12,14].indexOf(m)==-1?e.l+=6:x=RE(e,6,a);var o=e.read_shift(2);e.read_shift(2),Ca(e,2);var E=e.read_shift(2);e.l+=E;for(var w=1;w<e.lens.length-1;++w){if(e.l-c!=e.lens[w])throw new Error("TxO: bad continue record");var C=e[e.l],P=xo(e,e.lens[w+1]-e.lens[w]-1);if(u+=P,u.length>=(C?o:2*o))break}if(u.length!==o&&u.length!==o*2)throw new Error("cchText: "+o+" != "+u.length);return e.l=c+n,{t:u}}catch{return e.l=c+n,{t:u}}}function MS(e,n){var a=Zh(e);e.l+=16;var c=NE(e,n-24);return[a,c]}function DS(e,n){e.read_shift(2);var a=Zh(e),c=e.read_shift((n-10)/2,"dbcs-cont");return c=c.replace(Ii,""),[a,c]}function LS(e){var n=[0,0],a;return a=e.read_shift(2),n[0]=ig[a]||a,a=e.read_shift(2),n[1]=ig[a]||a,n}function RS(e){for(var n=e.read_shift(2),a=[];n-- >0;)a.push(ax(e));return a}function OS(e){for(var n=e.read_shift(2),a=[];n-- >0;)a.push(ax(e));return a}function BS(e){e.l+=2;var n={cxfs:0,crc:0};return n.cxfs=e.read_shift(2),n.crc=e.read_shift(4),n}function lx(e,n,a){if(!a.cellStyles)return di(e,n);var c=a&&a.biff>=12?4:2,u=e.read_shift(c),m=e.read_shift(c),x=e.read_shift(c),o=e.read_shift(c),E=e.read_shift(2);c==2&&(e.l+=2);var w={s:u,e:m,w:x,ixfe:o,flags:E};return(a.biff>=5||!a.biff)&&(w.level=E>>8&7),w}function zS(e,n){var a={};return n<32||(e.l+=16,a.header=ui(e),a.footer=ui(e),e.l+=2),a}function NS(e,n,a){var c={area:!1};if(a.biff!=5)return e.l+=n,c;var u=e.read_shift(1);return e.l+=3,u&16&&(c.area=!0),c}var US=Un,VS=tx,$S=nu;function jS(e){var n=e.read_shift(2),a=e.read_shift(2),c=e.read_shift(4),u={fmt:n,env:a,len:c,data:e.slice(e.l,e.l+c)};return e.l+=c,u}function GS(e,n,a){a.biffguess&&a.biff==5&&(a.biff=2);var c=Un(e);++e.l;var u=So(e,n-7,a);return c.t="str",c.val=u,c}function HS(e){var n=Un(e);++e.l;var a=ui(e);return n.t="n",n.val=a,n}function WS(e){var n=Un(e);++e.l;var a=e.read_shift(2);return n.t="n",n.val=a,n}function qS(e){var n=e.read_shift(1);return n===0?(e.l++,""):e.read_shift(n,"sbcs-cont")}function ZS(e,n){e.l+=6,e.l+=2,e.l+=1,e.l+=3,e.l+=1,e.l+=n-13}function XS(e,n,a){var c=e.l+n,u=Un(e),m=e.read_shift(2),x=xo(e,m,a);return e.l=c,u.t="str",u.val=x,u}var KS=[2,3,48,49,131,139,140,245],gg=function(){var e={1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127,8:865,9:437,10:850,11:437,13:437,14:850,15:437,16:850,17:437,18:850,19:932,20:850,21:437,22:850,23:865,24:437,25:437,26:850,27:437,28:863,29:850,31:852,34:852,35:852,36:860,37:850,38:866,55:850,64:852,77:936,78:949,79:950,80:874,87:1252,88:1252,89:1252,108:863,134:737,135:852,136:857,204:1257,255:16969},n=td({1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127});function a(o,E){var w=[],C=Os(1);switch(E.type){case"base64":C=Tn(Zi(o));break;case"binary":C=Tn(o);break;case"buffer":case"array":C=o;break}Ya(C,0);var P=C.read_shift(1),M=!!(P&136),B=!1,U=!1;switch(P){case 2:break;case 3:break;case 48:B=!0,M=!0;break;case 49:B=!0,M=!0;break;case 131:break;case 139:break;case 140:U=!0;break;case 245:break;default:throw new Error("DBF Unsupported Version: "+P.toString(16))}var N=0,j=521;P==2&&(N=C.read_shift(2)),C.l+=3,P!=2&&(N=C.read_shift(4)),N>1048576&&(N=1e6),P!=2&&(j=C.read_shift(2));var re=C.read_shift(2),pe=E.codepage||1252;P!=2&&(C.l+=16,C.read_shift(1),C[C.l]!==0&&(pe=e[C[C.l]]),C.l+=1,C.l+=2),U&&(C.l+=36);for(var X=[],le={},ye=Math.min(C.length,P==2?521:j-10-(B?264:0)),we=U?32:11;C.l<ye&&C[C.l]!=13;)switch(le={},le.name=Fs.utils.decode(pe,C.slice(C.l,C.l+we)).replace(/[\u0000\r\n].*$/g,""),C.l+=we,le.type=String.fromCharCode(C.read_shift(1)),P!=2&&!U&&(le.offset=C.read_shift(4)),le.len=C.read_shift(1),P==2&&(le.offset=C.read_shift(2)),le.dec=C.read_shift(1),le.name.length&&X.push(le),P!=2&&(C.l+=U?13:14),le.type){case"B":(!B||le.len!=8)&&E.WTF&&console.log("Skipping "+le.name+":"+le.type);break;case"G":case"P":E.WTF&&console.log("Skipping "+le.name+":"+le.type);break;case"+":case"0":case"@":case"C":case"D":case"F":case"I":case"L":case"M":case"N":case"O":case"T":case"Y":break;default:throw new Error("Unknown Field Type: "+le.type)}if(C[C.l]!==13&&(C.l=j-1),C.read_shift(1)!==13)throw new Error("DBF Terminator not found "+C.l+" "+C[C.l]);C.l=j;var ae=0,ze=0;for(w[0]=[],ze=0;ze!=X.length;++ze)w[0][ze]=X[ze].name;for(;N-- >0;){if(C[C.l]===42){C.l+=re;continue}for(++C.l,w[++ae]=[],ze=0,ze=0;ze!=X.length;++ze){var Ie=C.slice(C.l,C.l+X[ze].len);C.l+=X[ze].len,Ya(Ie,0);var $e=Fs.utils.decode(pe,Ie);switch(X[ze].type){case"C":$e.trim().length&&(w[ae][ze]=$e.replace(/\s+$/,""));break;case"D":$e.length===8?w[ae][ze]=new Date(+$e.slice(0,4),+$e.slice(4,6)-1,+$e.slice(6,8)):w[ae][ze]=$e;break;case"F":w[ae][ze]=parseFloat($e.trim());break;case"+":case"I":w[ae][ze]=U?Ie.read_shift(-4,"i")^2147483648:Ie.read_shift(4,"i");break;case"L":switch($e.trim().toUpperCase()){case"Y":case"T":w[ae][ze]=!0;break;case"N":case"F":w[ae][ze]=!1;break;case"":case"?":break;default:throw new Error("DBF Unrecognized L:|"+$e+"|")}break;case"M":if(!M)throw new Error("DBF Unexpected MEMO for type "+P.toString(16));w[ae][ze]="##MEMO##"+(U?parseInt($e.trim(),10):Ie.read_shift(4));break;case"N":$e=$e.replace(/\u0000/g,"").trim(),$e&&$e!="."&&(w[ae][ze]=+$e||0);break;case"@":w[ae][ze]=new Date(Ie.read_shift(-8,"f")-621356832e5);break;case"T":w[ae][ze]=new Date((Ie.read_shift(4)-2440588)*864e5+Ie.read_shift(4));break;case"Y":w[ae][ze]=Ie.read_shift(4,"i")/1e4+Ie.read_shift(4,"i")/1e4*Math.pow(2,32);break;case"O":w[ae][ze]=-Ie.read_shift(-8,"f");break;case"B":if(B&&X[ze].len==8){w[ae][ze]=Ie.read_shift(8,"f");break}case"G":case"P":Ie.l+=X[ze].len;break;case"0":if(X[ze].name==="_NullFlags")break;default:throw new Error("DBF Unsupported data type "+X[ze].type)}}}if(P!=2&&C.l<C.length&&C[C.l++]!=26)throw new Error("DBF EOF Marker missing "+(C.l-1)+" of "+C.length+" "+C[C.l-1].toString(16));return E&&E.sheetRows&&(w=w.slice(0,E.sheetRows)),E.DBF=X,w}function c(o,E){var w=E||{};w.dateNF||(w.dateNF="yyyymmdd");var C=El(a(o,w),w);return C["!cols"]=w.DBF.map(function(P){return{wch:P.len,DBF:P}}),delete w.DBF,C}function u(o,E){try{return zs(c(o,E),E)}catch(w){if(E&&E.WTF)throw w}return{SheetNames:[],Sheets:{}}}var m={B:8,C:250,L:1,D:8,"?":0,"":0};function x(o,E){var w=E||{};if(+w.codepage>=0&&En(+w.codepage),w.type=="string")throw new Error("Cannot write DBF to JS string");var C=P0(),P=V0(o,{header:1,raw:!0,cellDates:!0}),M=P[0],B=P.slice(1),U=o["!cols"]||[],N=0,j=0,re=0,pe=1;for(N=0;N<M.length;++N){if(((U[N]||{}).DBF||{}).name){M[N]=U[N].DBF.name,++re;continue}if(M[N]!=null){if(++re,typeof M[N]=="number"&&(M[N]=M[N].toString(10)),typeof M[N]!="string")throw new Error("DBF Invalid column name "+M[N]+" |"+typeof M[N]+"|");if(M.indexOf(M[N])!==N){for(j=0;j<1024;++j)if(M.indexOf(M[N]+"_"+j)==-1){M[N]+="_"+j;break}}}}var X=pa(o["!ref"]),le=[],ye=[],we=[];for(N=0;N<=X.e.c-X.s.c;++N){var ae="",ze="",Ie=0,$e=[];for(j=0;j<B.length;++j)B[j][N]!=null&&$e.push(B[j][N]);if($e.length==0||M[N]==null){le[N]="?";continue}for(j=0;j<$e.length;++j){switch(typeof $e[j]){case"number":ze="B";break;case"string":ze="C";break;case"boolean":ze="L";break;case"object":ze=$e[j]instanceof Date?"D":"C";break;default:ze="C"}Ie=Math.max(Ie,String($e[j]).length),ae=ae&&ae!=ze?"C":ze}Ie>250&&(Ie=250),ze=((U[N]||{}).DBF||{}).type,ze=="C"&&U[N].DBF.len>Ie&&(Ie=U[N].DBF.len),ae=="B"&&ze=="N"&&(ae="N",we[N]=U[N].DBF.dec,Ie=U[N].DBF.len),ye[N]=ae=="C"||ze=="N"?Ie:m[ae]||0,pe+=ye[N],le[N]=ae}var je=C.next(32);for(je.write_shift(4,318902576),je.write_shift(4,B.length),je.write_shift(2,296+32*re),je.write_shift(2,pe),N=0;N<4;++N)je.write_shift(4,0);for(je.write_shift(4,0|(+n[s1]||3)<<8),N=0,j=0;N<M.length;++N)if(M[N]!=null){var Le=C.next(32),it=(M[N].slice(-10)+"\0\0\0\0\0\0\0\0\0\0\0").slice(0,11);Le.write_shift(1,it,"sbcs"),Le.write_shift(1,le[N]=="?"?"C":le[N],"sbcs"),Le.write_shift(4,j),Le.write_shift(1,ye[N]||m[le[N]]||0),Le.write_shift(1,we[N]||0),Le.write_shift(1,2),Le.write_shift(4,0),Le.write_shift(1,0),Le.write_shift(4,0),Le.write_shift(4,0),j+=ye[N]||m[le[N]]||0}var ft=C.next(264);for(ft.write_shift(4,13),N=0;N<65;++N)ft.write_shift(4,0);for(N=0;N<B.length;++N){var ct=C.next(pe);for(ct.write_shift(1,0),j=0;j<M.length;++j)if(M[j]!=null)switch(le[j]){case"L":ct.write_shift(1,B[N][j]==null?63:B[N][j]?84:70);break;case"B":ct.write_shift(8,B[N][j]||0,"f");break;case"N":var xt="0";for(typeof B[N][j]=="number"&&(xt=B[N][j].toFixed(we[j]||0)),re=0;re<ye[j]-xt.length;++re)ct.write_shift(1,32);ct.write_shift(1,xt,"sbcs");break;case"D":B[N][j]?(ct.write_shift(4,("0000"+B[N][j].getFullYear()).slice(-4),"sbcs"),ct.write_shift(2,("00"+(B[N][j].getMonth()+1)).slice(-2),"sbcs"),ct.write_shift(2,("00"+B[N][j].getDate()).slice(-2),"sbcs")):ct.write_shift(8,"00000000","sbcs");break;case"C":var ht=String(B[N][j]!=null?B[N][j]:"").slice(0,ye[j]);for(ct.write_shift(1,ht,"sbcs"),re=0;re<ye[j]-ht.length;++re)ct.write_shift(1,32);break}}return C.next(1).write_shift(1,26),C.end()}return{to_workbook:u,to_sheet:c,from_sheet:x}}(),YS=function(){var e={AA:"À",BA:"Á",CA:"Â",DA:195,HA:"Ä",JA:197,AE:"È",BE:"É",CE:"Ê",HE:"Ë",AI:"Ì",BI:"Í",CI:"Î",HI:"Ï",AO:"Ò",BO:"Ó",CO:"Ô",DO:213,HO:"Ö",AU:"Ù",BU:"Ú",CU:"Û",HU:"Ü",Aa:"à",Ba:"á",Ca:"â",Da:227,Ha:"ä",Ja:229,Ae:"è",Be:"é",Ce:"ê",He:"ë",Ai:"ì",Bi:"í",Ci:"î",Hi:"ï",Ao:"ò",Bo:"ó",Co:"ô",Do:245,Ho:"ö",Au:"ù",Bu:"ú",Cu:"û",Hu:"ü",KC:"Ç",Kc:"ç",q:"æ",z:"œ",a:"Æ",j:"Œ",DN:209,Dn:241,Hy:255,S:169,c:170,R:174,"B ":180,0:176,1:177,2:178,3:179,5:181,6:182,7:183,Q:185,k:186,b:208,i:216,l:222,s:240,y:248,"!":161,'"':162,"#":163,"(":164,"%":165,"'":167,"H ":168,"+":171,";":187,"<":188,"=":189,">":190,"?":191,"{":223},n=new RegExp("\x1BN("+zn(e).join("|").replace(/\|\|\|/,"|\\||").replace(/([?()+])/g,"\\$1")+"|\\|)","gm"),a=function(M,B){var U=e[B];return typeof U=="number"?Mm(U):U},c=function(M,B,U){var N=B.charCodeAt(0)-32<<4|U.charCodeAt(0)-48;return N==59?M:Mm(N)};e["|"]=254;function u(M,B){switch(B.type){case"base64":return m(Zi(M),B);case"binary":return m(M,B);case"buffer":return m(kr&&Buffer.isBuffer(M)?M.toString("binary"):wo(M),B);case"array":return m(go(M),B)}throw new Error("Unrecognized type "+B.type)}function m(M,B){var U=M.split(/[\n\r]+/),N=-1,j=-1,re=0,pe=0,X=[],le=[],ye=null,we={},ae=[],ze=[],Ie=[],$e=0,je;for(+B.codepage>=0&&En(+B.codepage);re!==U.length;++re){$e=0;var Le=U[re].trim().replace(/\x1B([\x20-\x2F])([\x30-\x3F])/g,c).replace(n,a),it=Le.replace(/;;/g,"\0").split(";").map(function(Se){return Se.replace(/\u0000/g,";")}),ft=it[0],ct;if(Le.length>0)switch(ft){case"ID":break;case"E":break;case"B":break;case"O":break;case"W":break;case"P":it[1].charAt(0)=="P"&&le.push(Le.slice(3).replace(/;;/g,";"));break;case"C":var xt=!1,ht=!1,Yt=!1,He=!1,Nt=-1,Ft=-1;for(pe=1;pe<it.length;++pe)switch(it[pe].charAt(0)){case"A":break;case"X":j=parseInt(it[pe].slice(1))-1,ht=!0;break;case"Y":for(N=parseInt(it[pe].slice(1))-1,ht||(j=0),je=X.length;je<=N;++je)X[je]=[];break;case"K":ct=it[pe].slice(1),ct.charAt(0)==='"'?ct=ct.slice(1,ct.length-1):ct==="TRUE"?ct=!0:ct==="FALSE"?ct=!1:isNaN(kn(ct))?isNaN(_l(ct).getDate())||(ct=Ga(ct)):(ct=kn(ct),ye!==null&&bl(ye)&&(ct=qh(ct))),xt=!0;break;case"E":He=!0;var ue=ml(it[pe].slice(1),{r:N,c:j});X[N][j]=[X[N][j],ue];break;case"S":Yt=!0,X[N][j]=[X[N][j],"S5S"];break;case"G":break;case"R":Nt=parseInt(it[pe].slice(1))-1;break;case"C":Ft=parseInt(it[pe].slice(1))-1;break;default:if(B&&B.WTF)throw new Error("SYLK bad record "+Le)}if(xt&&(X[N][j]&&X[N][j].length==2?X[N][j][0]=ct:X[N][j]=ct,ye=null),Yt){if(He)throw new Error("SYLK shared formula cannot have own formula");var Te=Nt>-1&&X[Nt][Ft];if(!Te||!Te[1])throw new Error("SYLK shared formula cannot find base");X[N][j][1]=_x(Te[1],{r:N-Nt,c:j-Ft})}break;case"F":var Ee=0;for(pe=1;pe<it.length;++pe)switch(it[pe].charAt(0)){case"X":j=parseInt(it[pe].slice(1))-1,++Ee;break;case"Y":for(N=parseInt(it[pe].slice(1))-1,je=X.length;je<=N;++je)X[je]=[];break;case"M":$e=parseInt(it[pe].slice(1))/20;break;case"F":break;case"G":break;case"P":ye=le[parseInt(it[pe].slice(1))];break;case"S":break;case"D":break;case"N":break;case"W":for(Ie=it[pe].slice(1).split(" "),je=parseInt(Ie[0],10);je<=parseInt(Ie[1],10);++je)$e=parseInt(Ie[2],10),ze[je-1]=$e===0?{hidden:!0}:{wch:$e},yl(ze[je-1]);break;case"C":j=parseInt(it[pe].slice(1))-1,ze[j]||(ze[j]={});break;case"R":N=parseInt(it[pe].slice(1))-1,ae[N]||(ae[N]={}),$e>0?(ae[N].hpt=$e,ae[N].hpx=Yc($e)):$e===0&&(ae[N].hidden=!0);break;default:if(B&&B.WTF)throw new Error("SYLK bad record "+Le)}Ee<1&&(ye=null);break;default:if(B&&B.WTF)throw new Error("SYLK bad record "+Le)}}return ae.length>0&&(we["!rows"]=ae),ze.length>0&&(we["!cols"]=ze),B&&B.sheetRows&&(X=X.slice(0,B.sheetRows)),[X,we]}function x(M,B){var U=u(M,B),N=U[0],j=U[1],re=El(N,B);return zn(j).forEach(function(pe){re[pe]=j[pe]}),re}function o(M,B){return zs(x(M,B),B)}function E(M,B,U,N){var j="C;Y"+(U+1)+";X"+(N+1)+";K";switch(M.t){case"n":j+=M.v||0,M.f&&!M.F&&(j+=";E"+BC(M.f,{r:U,c:N}));break;case"b":j+=M.v?"TRUE":"FALSE";break;case"e":j+=M.w||M.v;break;case"d":j+='"'+(M.w||M.v)+'"';break;case"s":j+='"'+M.v.replace(/"/g,"").replace(/;/g,";;")+'"';break}return j}function w(M,B){B.forEach(function(U,N){var j="F;W"+(N+1)+" "+(N+1)+" ";U.hidden?j+="0":(typeof U.width=="number"&&!U.wpx&&(U.wpx=Uh(U.width)),typeof U.wpx=="number"&&!U.wch&&(U.wch=Vh(U.wpx)),typeof U.wch=="number"&&(j+=Math.round(U.wch))),j.charAt(j.length-1)!=" "&&M.push(j)})}function C(M,B){B.forEach(function(U,N){var j="F;";U.hidden?j+="M0;":U.hpt?j+="M"+20*U.hpt+";":U.hpx&&(j+="M"+20*mx(U.hpx)+";"),j.length>2&&M.push(j+"R"+(N+1))})}function P(M,B){var U=["ID;PWXL;N;E"],N=[],j=pa(M["!ref"]),re,pe=Array.isArray(M),X=`\r
`;U.push("P;PGeneral"),U.push("F;P0;DG0G8;M255"),M["!cols"]&&w(U,M["!cols"]),M["!rows"]&&C(U,M["!rows"]),U.push("B;Y"+(j.e.r-j.s.r+1)+";X"+(j.e.c-j.s.c+1)+";D"+[j.s.c,j.s.r,j.e.c,j.e.r].join(" "));for(var le=j.s.r;le<=j.e.r;++le)for(var ye=j.s.c;ye<=j.e.c;++ye){var we=fr({r:le,c:ye});re=pe?(M[le]||[])[ye]:M[we],!(!re||re.v==null&&(!re.f||re.F))&&N.push(E(re,M,le,ye))}return U.join(X)+X+N.join(X)+X+"E"+X}return{to_workbook:o,to_sheet:x,from_sheet:P}}(),JS=function(){function e(m,x){switch(x.type){case"base64":return n(Zi(m),x);case"binary":return n(m,x);case"buffer":return n(kr&&Buffer.isBuffer(m)?m.toString("binary"):wo(m),x);case"array":return n(go(m),x)}throw new Error("Unrecognized type "+x.type)}function n(m,x){for(var o=m.split(`
`),E=-1,w=-1,C=0,P=[];C!==o.length;++C){if(o[C].trim()==="BOT"){P[++E]=[],w=0;continue}if(!(E<0)){var M=o[C].trim().split(","),B=M[0],U=M[1];++C;for(var N=o[C]||"";(N.match(/["]/g)||[]).length&1&&C<o.length-1;)N+=`
`+o[++C];switch(N=N.trim(),+B){case-1:if(N==="BOT"){P[++E]=[],w=0;continue}else if(N!=="EOD")throw new Error("Unrecognized DIF special command "+N);break;case 0:N==="TRUE"?P[E][w]=!0:N==="FALSE"?P[E][w]=!1:isNaN(kn(U))?isNaN(_l(U).getDate())?P[E][w]=U:P[E][w]=Ga(U):P[E][w]=kn(U),++w;break;case 1:N=N.slice(1,N.length-1),N=N.replace(/""/g,'"'),N&&N.match(/^=".*"$/)&&(N=N.slice(2,-1)),P[E][w++]=N!==""?N:null;break}if(N==="EOD")break}}return x&&x.sheetRows&&(P=P.slice(0,x.sheetRows)),P}function a(m,x){return El(e(m,x),x)}function c(m,x){return zs(a(m,x),x)}var u=function(){var m=function(E,w,C,P,M){E.push(w),E.push(C+","+P),E.push('"'+M.replace(/"/g,'""')+'"')},x=function(E,w,C,P){E.push(w+","+C),E.push(w==1?'"'+P.replace(/"/g,'""')+'"':P)};return function(E){var w=[],C=pa(E["!ref"]),P,M=Array.isArray(E);m(w,"TABLE",0,1,"sheetjs"),m(w,"VECTORS",0,C.e.r-C.s.r+1,""),m(w,"TUPLES",0,C.e.c-C.s.c+1,""),m(w,"DATA",0,0,"");for(var B=C.s.r;B<=C.e.r;++B){x(w,-1,0,"BOT");for(var U=C.s.c;U<=C.e.c;++U){var N=fr({r:B,c:U});if(P=M?(E[B]||[])[U]:E[N],!P){x(w,1,0,"");continue}switch(P.t){case"n":var j=P.w;!j&&P.v!=null&&(j=P.v),j==null?P.f&&!P.F?x(w,1,0,"="+P.f):x(w,1,0,""):x(w,0,j,"V");break;case"b":x(w,0,P.v?1:0,P.v?"TRUE":"FALSE");break;case"s":x(w,1,0,isNaN(P.v)?P.v:'="'+P.v+'"');break;case"d":P.w||(P.w=cn(P.z||gr[14],Pi(Ga(P.v)))),x(w,0,P.w,"V");break;default:x(w,1,0,"")}}}x(w,-1,0,"EOD");var re=`\r
`,pe=w.join(re);return pe}}();return{to_workbook:c,to_sheet:a,from_sheet:u}}(),QS=function(){function e(P){return P.replace(/\\b/g,"\\").replace(/\\c/g,":").replace(/\\n/g,`
`)}function n(P){return P.replace(/\\/g,"\\b").replace(/:/g,"\\c").replace(/\n/g,"\\n")}function a(P,M){for(var B=P.split(`
`),U=-1,N=-1,j=0,re=[];j!==B.length;++j){var pe=B[j].trim().split(":");if(pe[0]==="cell"){var X=Ai(pe[1]);if(re.length<=X.r)for(U=re.length;U<=X.r;++U)re[U]||(re[U]=[]);switch(U=X.r,N=X.c,pe[2]){case"t":re[U][N]=e(pe[3]);break;case"v":re[U][N]=+pe[3];break;case"vtf":var le=pe[pe.length-1];case"vtc":switch(pe[3]){case"nl":re[U][N]=!!+pe[4];break;default:re[U][N]=+pe[4];break}pe[2]=="vtf"&&(re[U][N]=[re[U][N],le])}}}return M&&M.sheetRows&&(re=re.slice(0,M.sheetRows)),re}function c(P,M){return El(a(P,M),M)}function u(P,M){return zs(c(P,M),M)}var m=["socialcalc:version:1.5","MIME-Version: 1.0","Content-Type: multipart/mixed; boundary=SocialCalcSpreadsheetControlSave"].join(`
`),x=["--SocialCalcSpreadsheetControlSave","Content-type: text/plain; charset=UTF-8"].join(`
`)+`
`,o=["# SocialCalc Spreadsheet Control Save","part:sheet"].join(`
`),E="--SocialCalcSpreadsheetControlSave--";function w(P){if(!P||!P["!ref"])return"";for(var M=[],B=[],U,N="",j=Tl(P["!ref"]),re=Array.isArray(P),pe=j.s.r;pe<=j.e.r;++pe)for(var X=j.s.c;X<=j.e.c;++X)if(N=fr({r:pe,c:X}),U=re?(P[pe]||[])[X]:P[N],!(!U||U.v==null||U.t==="z")){switch(B=["cell",N,"t"],U.t){case"s":case"str":B.push(n(U.v));break;case"n":U.f?(B[2]="vtf",B[3]="n",B[4]=U.v,B[5]=n(U.f)):(B[2]="v",B[3]=U.v);break;case"b":B[2]="vt"+(U.f?"f":"c"),B[3]="nl",B[4]=U.v?"1":"0",B[5]=n(U.f||(U.v?"TRUE":"FALSE"));break;case"d":var le=Pi(Ga(U.v));B[2]="vtc",B[3]="nd",B[4]=""+le,B[5]=U.w||cn(U.z||gr[14],le);break;case"e":continue}M.push(B.join(":"))}return M.push("sheet:c:"+(j.e.c-j.s.c+1)+":r:"+(j.e.r-j.s.r+1)+":tvf:1"),M.push("valueformat:1:text-wiki"),M.join(`
`)}function C(P){return[m,x,o,x,w(P),E].join(`
`)}return{to_workbook:u,to_sheet:c,from_sheet:C}}(),Xc=function(){function e(C,P,M,B,U){U.raw?P[M][B]=C:C===""||(C==="TRUE"?P[M][B]=!0:C==="FALSE"?P[M][B]=!1:isNaN(kn(C))?isNaN(_l(C).getDate())?P[M][B]=C:P[M][B]=Ga(C):P[M][B]=kn(C))}function n(C,P){var M=P||{},B=[];if(!C||C.length===0)return B;for(var U=C.split(/[\r\n]/),N=U.length-1;N>=0&&U[N].length===0;)--N;for(var j=10,re=0,pe=0;pe<=N;++pe)re=U[pe].indexOf(" "),re==-1?re=U[pe].length:re++,j=Math.max(j,re);for(pe=0;pe<=N;++pe){B[pe]=[];var X=0;for(e(U[pe].slice(0,j).trim(),B,pe,X,M),X=1;X<=(U[pe].length-j)/10+1;++X)e(U[pe].slice(j+(X-1)*10,j+X*10).trim(),B,pe,X,M)}return M.sheetRows&&(B=B.slice(0,M.sheetRows)),B}var a={44:",",9:"	",59:";",124:"|"},c={44:3,9:2,59:1,124:0};function u(C){for(var P={},M=!1,B=0,U=0;B<C.length;++B)(U=C.charCodeAt(B))==34?M=!M:!M&&U in a&&(P[U]=(P[U]||0)+1);U=[];for(B in P)Object.prototype.hasOwnProperty.call(P,B)&&U.push([P[B],B]);if(!U.length){P=c;for(B in P)Object.prototype.hasOwnProperty.call(P,B)&&U.push([P[B],B])}return U.sort(function(N,j){return N[0]-j[0]||c[N[1]]-c[j[1]]}),a[U.pop()[1]]||44}function m(C,P){var M=P||{},B="",U=M.dense?[]:{},N={s:{c:0,r:0},e:{c:0,r:0}};C.slice(0,4)=="sep="?C.charCodeAt(5)==13&&C.charCodeAt(6)==10?(B=C.charAt(4),C=C.slice(7)):C.charCodeAt(5)==13||C.charCodeAt(5)==10?(B=C.charAt(4),C=C.slice(6)):B=u(C.slice(0,1024)):M&&M.FS?B=M.FS:B=u(C.slice(0,1024));var j=0,re=0,pe=0,X=0,le=0,ye=B.charCodeAt(0),we=!1,ae=0,ze=C.charCodeAt(0);C=C.replace(/\r\n/mg,`
`);var Ie=M.dateNF!=null?hT(M.dateNF):null;function $e(){var je=C.slice(X,le),Le={};if(je.charAt(0)=='"'&&je.charAt(je.length-1)=='"'&&(je=je.slice(1,-1).replace(/""/g,'"')),je.length===0)Le.t="z";else if(M.raw)Le.t="s",Le.v=je;else if(je.trim().length===0)Le.t="s",Le.v=je;else if(je.charCodeAt(0)==61)je.charCodeAt(1)==34&&je.charCodeAt(je.length-1)==34?(Le.t="s",Le.v=je.slice(2,-1).replace(/""/g,'"')):NC(je)?(Le.t="n",Le.f=je.slice(1)):(Le.t="s",Le.v=je);else if(je=="TRUE")Le.t="b",Le.v=!0;else if(je=="FALSE")Le.t="b",Le.v=!1;else if(!isNaN(pe=kn(je)))Le.t="n",M.cellText!==!1&&(Le.w=je),Le.v=pe;else if(!isNaN(_l(je).getDate())||Ie&&je.match(Ie)){Le.z=M.dateNF||gr[14];var it=0;Ie&&je.match(Ie)&&(je=fT(je,M.dateNF,je.match(Ie)||[]),it=1),M.cellDates?(Le.t="d",Le.v=Ga(je,it)):(Le.t="n",Le.v=Pi(Ga(je,it))),M.cellText!==!1&&(Le.w=cn(Le.z,Le.v instanceof Date?Pi(Le.v):Le.v)),M.cellNF||delete Le.z}else Le.t="s",Le.v=je;if(Le.t=="z"||(M.dense?(U[j]||(U[j]=[]),U[j][re]=Le):U[fr({c:re,r:j})]=Le),X=le+1,ze=C.charCodeAt(X),N.e.c<re&&(N.e.c=re),N.e.r<j&&(N.e.r=j),ae==ye)++re;else if(re=0,++j,M.sheetRows&&M.sheetRows<=j)return!0}e:for(;le<C.length;++le)switch(ae=C.charCodeAt(le)){case 34:ze===34&&(we=!we);break;case ye:case 10:case 13:if(!we&&$e())break e;break}return le-X>0&&$e(),U["!ref"]=Fr(N),U}function x(C,P){return!(P&&P.PRN)||P.FS||C.slice(0,4)=="sep="||C.indexOf("	")>=0||C.indexOf(",")>=0||C.indexOf(";")>=0?m(C,P):El(n(C,P),P)}function o(C,P){var M="",B=P.type=="string"?[0,0,0,0]:vd(C,P);switch(P.type){case"base64":M=Zi(C);break;case"binary":M=C;break;case"buffer":P.codepage==65001?M=C.toString("utf8"):P.codepage&&typeof Fs<"u"?M=Fs.utils.decode(P.codepage,C):M=kr&&Buffer.isBuffer(C)?C.toString("binary"):wo(C);break;case"array":M=go(C);break;case"string":M=C;break;default:throw new Error("Unrecognized type "+P.type)}return B[0]==239&&B[1]==187&&B[2]==191?M=Xr(M.slice(3)):P.type!="string"&&P.type!="buffer"&&P.codepage==65001?M=Xr(M):P.type=="binary"&&typeof Fs<"u"&&P.codepage&&(M=Fs.utils.decode(P.codepage,Fs.utils.encode(28591,M))),M.slice(0,19)=="socialcalc:version:"?QS.to_sheet(P.type=="string"?M:Xr(M),P):x(M,P)}function E(C,P){return zs(o(C,P),P)}function w(C){for(var P=[],M=pa(C["!ref"]),B,U=Array.isArray(C),N=M.s.r;N<=M.e.r;++N){for(var j=[],re=M.s.c;re<=M.e.c;++re){var pe=fr({r:N,c:re});if(B=U?(C[N]||[])[re]:C[pe],!B||B.v==null){j.push("          ");continue}for(var X=(B.w||(ls(B),B.w)||"").slice(0,10);X.length<10;)X+=" ";j.push(X+(re===0?" ":""))}P.push(j.join(""))}return P.join(`
`)}return{to_workbook:E,to_sheet:o,from_sheet:w}}();function ek(e,n){var a=n||{},c=!!a.WTF;a.WTF=!0;try{var u=YS.to_workbook(e,a);return a.WTF=c,u}catch(m){if(a.WTF=c,!m.message.match(/SYLK bad record ID/)&&c)throw m;return Xc.to_workbook(e,n)}}var Vc=function(){function e(ue,Te,Ee){if(ue){Ya(ue,ue.l||0);for(var Se=Ee.Enum||Nt;ue.l<ue.length;){var Ke=ue.read_shift(2),pt=Se[Ke]||Se[65535],_t=ue.read_shift(2),ut=ue.l+_t,tt=pt.f&&pt.f(ue,_t,Ee);if(ue.l=ut,Te(tt,pt,Ke))return}}}function n(ue,Te){switch(Te.type){case"base64":return a(Tn(Zi(ue)),Te);case"binary":return a(Tn(ue),Te);case"buffer":case"array":return a(ue,Te)}throw"Unsupported type "+Te.type}function a(ue,Te){if(!ue)return ue;var Ee=Te||{},Se=Ee.dense?[]:{},Ke="Sheet1",pt="",_t=0,ut={},tt=[],Zt=[],ge={s:{r:0,c:0},e:{r:0,c:0}},Qt=Ee.sheetRows||0;if(ue[2]==0&&(ue[3]==8||ue[3]==9)&&ue.length>=16&&ue[14]==5&&ue[15]===108)throw new Error("Unsupported Works 3 for Mac file");if(ue[2]==2)Ee.Enum=Nt,e(ue,function(wt,cr,Pr){switch(Pr){case 0:Ee.vers=wt,wt>=4096&&(Ee.qpro=!0);break;case 6:ge=wt;break;case 204:wt&&(pt=wt);break;case 222:pt=wt;break;case 15:case 51:Ee.qpro||(wt[1].v=wt[1].v.slice(1));case 13:case 14:case 16:Pr==14&&(wt[2]&112)==112&&(wt[2]&15)>1&&(wt[2]&15)<15&&(wt[1].z=Ee.dateNF||gr[14],Ee.cellDates&&(wt[1].t="d",wt[1].v=qh(wt[1].v))),Ee.qpro&&wt[3]>_t&&(Se["!ref"]=Fr(ge),ut[Ke]=Se,tt.push(Ke),Se=Ee.dense?[]:{},ge={s:{r:0,c:0},e:{r:0,c:0}},_t=wt[3],Ke=pt||"Sheet"+(_t+1),pt="");var qe=Ee.dense?(Se[wt[0].r]||[])[wt[0].c]:Se[fr(wt[0])];if(qe){qe.t=wt[1].t,qe.v=wt[1].v,wt[1].z!=null&&(qe.z=wt[1].z),wt[1].f!=null&&(qe.f=wt[1].f);break}Ee.dense?(Se[wt[0].r]||(Se[wt[0].r]=[]),Se[wt[0].r][wt[0].c]=wt[1]):Se[fr(wt[0])]=wt[1];break}},Ee);else if(ue[2]==26||ue[2]==14)Ee.Enum=Ft,ue[2]==14&&(Ee.qpro=!0,ue.l=0),e(ue,function(wt,cr,Pr){switch(Pr){case 204:Ke=wt;break;case 22:wt[1].v=wt[1].v.slice(1);case 23:case 24:case 25:case 37:case 39:case 40:if(wt[3]>_t&&(Se["!ref"]=Fr(ge),ut[Ke]=Se,tt.push(Ke),Se=Ee.dense?[]:{},ge={s:{r:0,c:0},e:{r:0,c:0}},_t=wt[3],Ke="Sheet"+(_t+1)),Qt>0&&wt[0].r>=Qt)break;Ee.dense?(Se[wt[0].r]||(Se[wt[0].r]=[]),Se[wt[0].r][wt[0].c]=wt[1]):Se[fr(wt[0])]=wt[1],ge.e.c<wt[0].c&&(ge.e.c=wt[0].c),ge.e.r<wt[0].r&&(ge.e.r=wt[0].r);break;case 27:wt[14e3]&&(Zt[wt[14e3][0]]=wt[14e3][1]);break;case 1537:Zt[wt[0]]=wt[1],wt[0]==_t&&(Ke=wt[1]);break}},Ee);else throw new Error("Unrecognized LOTUS BOF "+ue[2]);if(Se["!ref"]=Fr(ge),ut[pt||Ke]=Se,tt.push(pt||Ke),!Zt.length)return{SheetNames:tt,Sheets:ut};for(var Xt={},or=[],Jt=0;Jt<Zt.length;++Jt)ut[tt[Jt]]?(or.push(Zt[Jt]||tt[Jt]),Xt[Zt[Jt]]=ut[Zt[Jt]]||ut[tt[Jt]]):(or.push(Zt[Jt]),Xt[Zt[Jt]]={"!ref":"A1"});return{SheetNames:or,Sheets:Xt}}function c(ue,Te){var Ee=Te||{};if(+Ee.codepage>=0&&En(+Ee.codepage),Ee.type=="string")throw new Error("Cannot write WK1 to JS string");var Se=P0(),Ke=pa(ue["!ref"]),pt=Array.isArray(ue),_t=[];bn(Se,0,m(1030)),bn(Se,6,E(Ke));for(var ut=Math.min(Ke.e.r,8191),tt=Ke.s.r;tt<=ut;++tt)for(var Zt=Qa(tt),ge=Ke.s.c;ge<=Ke.e.c;++ge){tt===Ke.s.r&&(_t[ge]=Oa(ge));var Qt=_t[ge]+Zt,Xt=pt?(ue[tt]||[])[ge]:ue[Qt];if(!(!Xt||Xt.t=="z"))if(Xt.t=="n")(Xt.v|0)==Xt.v&&Xt.v>=-32768&&Xt.v<=32767?bn(Se,13,B(tt,ge,Xt.v)):bn(Se,14,N(tt,ge,Xt.v));else{var or=ls(Xt);bn(Se,15,P(tt,ge,or.slice(0,239)))}}return bn(Se,1),Se.end()}function u(ue,Te){var Ee=Te||{};if(+Ee.codepage>=0&&En(+Ee.codepage),Ee.type=="string")throw new Error("Cannot write WK3 to JS string");var Se=P0();bn(Se,0,x(ue));for(var Ke=0,pt=0;Ke<ue.SheetNames.length;++Ke)(ue.Sheets[ue.SheetNames[Ke]]||{})["!ref"]&&bn(Se,27,He(ue.SheetNames[Ke],pt++));var _t=0;for(Ke=0;Ke<ue.SheetNames.length;++Ke){var ut=ue.Sheets[ue.SheetNames[Ke]];if(!(!ut||!ut["!ref"])){for(var tt=pa(ut["!ref"]),Zt=Array.isArray(ut),ge=[],Qt=Math.min(tt.e.r,8191),Xt=tt.s.r;Xt<=Qt;++Xt)for(var or=Qa(Xt),Jt=tt.s.c;Jt<=tt.e.c;++Jt){Xt===tt.s.r&&(ge[Jt]=Oa(Jt));var wt=ge[Jt]+or,cr=Zt?(ut[Xt]||[])[Jt]:ut[wt];if(!(!cr||cr.t=="z"))if(cr.t=="n")bn(Se,23,$e(Xt,Jt,_t,cr.v));else{var Pr=ls(cr);bn(Se,22,ae(Xt,Jt,_t,Pr.slice(0,239)))}}++_t}}return bn(Se,1),Se.end()}function m(ue){var Te=Da(2);return Te.write_shift(2,ue),Te}function x(ue){var Te=Da(26);Te.write_shift(2,4096),Te.write_shift(2,4),Te.write_shift(4,0);for(var Ee=0,Se=0,Ke=0,pt=0;pt<ue.SheetNames.length;++pt){var _t=ue.SheetNames[pt],ut=ue.Sheets[_t];if(!(!ut||!ut["!ref"])){++Ke;var tt=Tl(ut["!ref"]);Ee<tt.e.r&&(Ee=tt.e.r),Se<tt.e.c&&(Se=tt.e.c)}}return Ee>8191&&(Ee=8191),Te.write_shift(2,Ee),Te.write_shift(1,Ke),Te.write_shift(1,Se),Te.write_shift(2,0),Te.write_shift(2,0),Te.write_shift(1,1),Te.write_shift(1,2),Te.write_shift(4,0),Te.write_shift(4,0),Te}function o(ue,Te,Ee){var Se={s:{c:0,r:0},e:{c:0,r:0}};return Te==8&&Ee.qpro?(Se.s.c=ue.read_shift(1),ue.l++,Se.s.r=ue.read_shift(2),Se.e.c=ue.read_shift(1),ue.l++,Se.e.r=ue.read_shift(2),Se):(Se.s.c=ue.read_shift(2),Se.s.r=ue.read_shift(2),Te==12&&Ee.qpro&&(ue.l+=2),Se.e.c=ue.read_shift(2),Se.e.r=ue.read_shift(2),Te==12&&Ee.qpro&&(ue.l+=2),Se.s.c==65535&&(Se.s.c=Se.e.c=Se.s.r=Se.e.r=0),Se)}function E(ue){var Te=Da(8);return Te.write_shift(2,ue.s.c),Te.write_shift(2,ue.s.r),Te.write_shift(2,ue.e.c),Te.write_shift(2,ue.e.r),Te}function w(ue,Te,Ee){var Se=[{c:0,r:0},{t:"n",v:0},0,0];return Ee.qpro&&Ee.vers!=20768?(Se[0].c=ue.read_shift(1),Se[3]=ue.read_shift(1),Se[0].r=ue.read_shift(2),ue.l+=2):(Se[2]=ue.read_shift(1),Se[0].c=ue.read_shift(2),Se[0].r=ue.read_shift(2)),Se}function C(ue,Te,Ee){var Se=ue.l+Te,Ke=w(ue,Te,Ee);if(Ke[1].t="s",Ee.vers==20768){ue.l++;var pt=ue.read_shift(1);return Ke[1].v=ue.read_shift(pt,"utf8"),Ke}return Ee.qpro&&ue.l++,Ke[1].v=ue.read_shift(Se-ue.l,"cstr"),Ke}function P(ue,Te,Ee){var Se=Da(7+Ee.length);Se.write_shift(1,255),Se.write_shift(2,Te),Se.write_shift(2,ue),Se.write_shift(1,39);for(var Ke=0;Ke<Se.length;++Ke){var pt=Ee.charCodeAt(Ke);Se.write_shift(1,pt>=128?95:pt)}return Se.write_shift(1,0),Se}function M(ue,Te,Ee){var Se=w(ue,Te,Ee);return Se[1].v=ue.read_shift(2,"i"),Se}function B(ue,Te,Ee){var Se=Da(7);return Se.write_shift(1,255),Se.write_shift(2,Te),Se.write_shift(2,ue),Se.write_shift(2,Ee,"i"),Se}function U(ue,Te,Ee){var Se=w(ue,Te,Ee);return Se[1].v=ue.read_shift(8,"f"),Se}function N(ue,Te,Ee){var Se=Da(13);return Se.write_shift(1,255),Se.write_shift(2,Te),Se.write_shift(2,ue),Se.write_shift(8,Ee,"f"),Se}function j(ue,Te,Ee){var Se=ue.l+Te,Ke=w(ue,Te,Ee);if(Ke[1].v=ue.read_shift(8,"f"),Ee.qpro)ue.l=Se;else{var pt=ue.read_shift(2);le(ue.slice(ue.l,ue.l+pt),Ke),ue.l+=pt}return Ke}function re(ue,Te,Ee){var Se=Te&32768;return Te&=-32769,Te=(Se?ue:0)+(Te>=8192?Te-16384:Te),(Se?"":"$")+(Ee?Oa(Te):Qa(Te))}var pe={51:["FALSE",0],52:["TRUE",0],70:["LEN",1],80:["SUM",69],81:["AVERAGEA",69],82:["COUNTA",69],83:["MINA",69],84:["MAXA",69],111:["T",1]},X=["","","","","","","","","","+","-","*","/","^","=","<>","<=",">=","<",">","","","","","&","","","","","","",""];function le(ue,Te){Ya(ue,0);for(var Ee=[],Se=0,Ke="",pt="",_t="",ut="";ue.l<ue.length;){var tt=ue[ue.l++];switch(tt){case 0:Ee.push(ue.read_shift(8,"f"));break;case 1:pt=re(Te[0].c,ue.read_shift(2),!0),Ke=re(Te[0].r,ue.read_shift(2),!1),Ee.push(pt+Ke);break;case 2:{var Zt=re(Te[0].c,ue.read_shift(2),!0),ge=re(Te[0].r,ue.read_shift(2),!1);pt=re(Te[0].c,ue.read_shift(2),!0),Ke=re(Te[0].r,ue.read_shift(2),!1),Ee.push(Zt+ge+":"+pt+Ke)}break;case 3:if(ue.l<ue.length){console.error("WK1 premature formula end");return}break;case 4:Ee.push("("+Ee.pop()+")");break;case 5:Ee.push(ue.read_shift(2));break;case 6:{for(var Qt="";tt=ue[ue.l++];)Qt+=String.fromCharCode(tt);Ee.push('"'+Qt.replace(/"/g,'""')+'"')}break;case 8:Ee.push("-"+Ee.pop());break;case 23:Ee.push("+"+Ee.pop());break;case 22:Ee.push("NOT("+Ee.pop()+")");break;case 20:case 21:ut=Ee.pop(),_t=Ee.pop(),Ee.push(["AND","OR"][tt-20]+"("+_t+","+ut+")");break;default:if(tt<32&&X[tt])ut=Ee.pop(),_t=Ee.pop(),Ee.push(_t+X[tt]+ut);else if(pe[tt]){if(Se=pe[tt][1],Se==69&&(Se=ue[ue.l++]),Se>Ee.length){console.error("WK1 bad formula parse 0x"+tt.toString(16)+":|"+Ee.join("|")+"|");return}var Xt=Ee.slice(-Se);Ee.length-=Se,Ee.push(pe[tt][0]+"("+Xt.join(",")+")")}else return tt<=7?console.error("WK1 invalid opcode "+tt.toString(16)):tt<=24?console.error("WK1 unsupported op "+tt.toString(16)):tt<=30?console.error("WK1 invalid opcode "+tt.toString(16)):tt<=115?console.error("WK1 unsupported function opcode "+tt.toString(16)):console.error("WK1 unrecognized opcode "+tt.toString(16))}}Ee.length==1?Te[1].f=""+Ee[0]:console.error("WK1 bad formula parse |"+Ee.join("|")+"|")}function ye(ue){var Te=[{c:0,r:0},{t:"n",v:0},0];return Te[0].r=ue.read_shift(2),Te[3]=ue[ue.l++],Te[0].c=ue[ue.l++],Te}function we(ue,Te){var Ee=ye(ue);return Ee[1].t="s",Ee[1].v=ue.read_shift(Te-4,"cstr"),Ee}function ae(ue,Te,Ee,Se){var Ke=Da(6+Se.length);Ke.write_shift(2,ue),Ke.write_shift(1,Ee),Ke.write_shift(1,Te),Ke.write_shift(1,39);for(var pt=0;pt<Se.length;++pt){var _t=Se.charCodeAt(pt);Ke.write_shift(1,_t>=128?95:_t)}return Ke.write_shift(1,0),Ke}function ze(ue,Te){var Ee=ye(ue);Ee[1].v=ue.read_shift(2);var Se=Ee[1].v>>1;if(Ee[1].v&1)switch(Se&7){case 0:Se=(Se>>3)*5e3;break;case 1:Se=(Se>>3)*500;break;case 2:Se=(Se>>3)/20;break;case 3:Se=(Se>>3)/200;break;case 4:Se=(Se>>3)/2e3;break;case 5:Se=(Se>>3)/2e4;break;case 6:Se=(Se>>3)/16;break;case 7:Se=(Se>>3)/64;break}return Ee[1].v=Se,Ee}function Ie(ue,Te){var Ee=ye(ue),Se=ue.read_shift(4),Ke=ue.read_shift(4),pt=ue.read_shift(2);if(pt==65535)return Se===0&&Ke===3221225472?(Ee[1].t="e",Ee[1].v=15):Se===0&&Ke===3489660928?(Ee[1].t="e",Ee[1].v=42):Ee[1].v=0,Ee;var _t=pt&32768;return pt=(pt&32767)-16446,Ee[1].v=(1-_t*2)*(Ke*Math.pow(2,pt+32)+Se*Math.pow(2,pt)),Ee}function $e(ue,Te,Ee,Se){var Ke=Da(14);if(Ke.write_shift(2,ue),Ke.write_shift(1,Ee),Ke.write_shift(1,Te),Se==0)return Ke.write_shift(4,0),Ke.write_shift(4,0),Ke.write_shift(2,65535),Ke;var pt=0,_t=0,ut=0,tt=0;return Se<0&&(pt=1,Se=-Se),_t=Math.log2(Se)|0,Se/=Math.pow(2,_t-31),tt=Se>>>0,tt&2147483648||(Se/=2,++_t,tt=Se>>>0),Se-=tt,tt|=2147483648,tt>>>=0,Se*=Math.pow(2,32),ut=Se>>>0,Ke.write_shift(4,ut),Ke.write_shift(4,tt),_t+=16383+(pt?32768:0),Ke.write_shift(2,_t),Ke}function je(ue,Te){var Ee=Ie(ue);return ue.l+=Te-14,Ee}function Le(ue,Te){var Ee=ye(ue),Se=ue.read_shift(4);return Ee[1].v=Se>>6,Ee}function it(ue,Te){var Ee=ye(ue),Se=ue.read_shift(8,"f");return Ee[1].v=Se,Ee}function ft(ue,Te){var Ee=it(ue);return ue.l+=Te-10,Ee}function ct(ue,Te){return ue[ue.l+Te-1]==0?ue.read_shift(Te,"cstr"):""}function xt(ue,Te){var Ee=ue[ue.l++];Ee>Te-1&&(Ee=Te-1);for(var Se="";Se.length<Ee;)Se+=String.fromCharCode(ue[ue.l++]);return Se}function ht(ue,Te,Ee){if(!(!Ee.qpro||Te<21)){var Se=ue.read_shift(1);ue.l+=17,ue.l+=1,ue.l+=2;var Ke=ue.read_shift(Te-21,"cstr");return[Se,Ke]}}function Yt(ue,Te){for(var Ee={},Se=ue.l+Te;ue.l<Se;){var Ke=ue.read_shift(2);if(Ke==14e3){for(Ee[Ke]=[0,""],Ee[Ke][0]=ue.read_shift(2);ue[ue.l];)Ee[Ke][1]+=String.fromCharCode(ue[ue.l]),ue.l++;ue.l++}}return Ee}function He(ue,Te){var Ee=Da(5+ue.length);Ee.write_shift(2,14e3),Ee.write_shift(2,Te);for(var Se=0;Se<ue.length;++Se){var Ke=ue.charCodeAt(Se);Ee[Ee.l++]=Ke>127?95:Ke}return Ee[Ee.l++]=0,Ee}var Nt={0:{n:"BOF",f:Ca},1:{n:"EOF"},2:{n:"CALCMODE"},3:{n:"CALCORDER"},4:{n:"SPLIT"},5:{n:"SYNC"},6:{n:"RANGE",f:o},7:{n:"WINDOW1"},8:{n:"COLW1"},9:{n:"WINTWO"},10:{n:"COLW2"},11:{n:"NAME"},12:{n:"BLANK"},13:{n:"INTEGER",f:M},14:{n:"NUMBER",f:U},15:{n:"LABEL",f:C},16:{n:"FORMULA",f:j},24:{n:"TABLE"},25:{n:"ORANGE"},26:{n:"PRANGE"},27:{n:"SRANGE"},28:{n:"FRANGE"},29:{n:"KRANGE1"},32:{n:"HRANGE"},35:{n:"KRANGE2"},36:{n:"PROTEC"},37:{n:"FOOTER"},38:{n:"HEADER"},39:{n:"SETUP"},40:{n:"MARGINS"},41:{n:"LABELFMT"},42:{n:"TITLES"},43:{n:"SHEETJS"},45:{n:"GRAPH"},46:{n:"NGRAPH"},47:{n:"CALCCOUNT"},48:{n:"UNFORMATTED"},49:{n:"CURSORW12"},50:{n:"WINDOW"},51:{n:"STRING",f:C},55:{n:"PASSWORD"},56:{n:"LOCKED"},60:{n:"QUERY"},61:{n:"QUERYNAME"},62:{n:"PRINT"},63:{n:"PRINTNAME"},64:{n:"GRAPH2"},65:{n:"GRAPHNAME"},66:{n:"ZOOM"},67:{n:"SYMSPLIT"},68:{n:"NSROWS"},69:{n:"NSCOLS"},70:{n:"RULER"},71:{n:"NNAME"},72:{n:"ACOMM"},73:{n:"AMACRO"},74:{n:"PARSE"},102:{n:"PRANGES??"},103:{n:"RRANGES??"},104:{n:"FNAME??"},105:{n:"MRANGES??"},204:{n:"SHEETNAMECS",f:ct},222:{n:"SHEETNAMELP",f:xt},65535:{n:""}},Ft={0:{n:"BOF"},1:{n:"EOF"},2:{n:"PASSWORD"},3:{n:"CALCSET"},4:{n:"WINDOWSET"},5:{n:"SHEETCELLPTR"},6:{n:"SHEETLAYOUT"},7:{n:"COLUMNWIDTH"},8:{n:"HIDDENCOLUMN"},9:{n:"USERRANGE"},10:{n:"SYSTEMRANGE"},11:{n:"ZEROFORCE"},12:{n:"SORTKEYDIR"},13:{n:"FILESEAL"},14:{n:"DATAFILLNUMS"},15:{n:"PRINTMAIN"},16:{n:"PRINTSTRING"},17:{n:"GRAPHMAIN"},18:{n:"GRAPHSTRING"},19:{n:"??"},20:{n:"ERRCELL"},21:{n:"NACELL"},22:{n:"LABEL16",f:we},23:{n:"NUMBER17",f:Ie},24:{n:"NUMBER18",f:ze},25:{n:"FORMULA19",f:je},26:{n:"FORMULA1A"},27:{n:"XFORMAT",f:Yt},28:{n:"DTLABELMISC"},29:{n:"DTLABELCELL"},30:{n:"GRAPHWINDOW"},31:{n:"CPA"},32:{n:"LPLAUTO"},33:{n:"QUERY"},34:{n:"HIDDENSHEET"},35:{n:"??"},37:{n:"NUMBER25",f:Le},38:{n:"??"},39:{n:"NUMBER27",f:it},40:{n:"FORMULA28",f:ft},142:{n:"??"},147:{n:"??"},150:{n:"??"},151:{n:"??"},152:{n:"??"},153:{n:"??"},154:{n:"??"},155:{n:"??"},156:{n:"??"},163:{n:"??"},174:{n:"??"},175:{n:"??"},176:{n:"??"},177:{n:"??"},184:{n:"??"},185:{n:"??"},186:{n:"??"},187:{n:"??"},188:{n:"??"},195:{n:"??"},201:{n:"??"},204:{n:"SHEETNAMECS",f:ct},205:{n:"??"},206:{n:"??"},207:{n:"??"},208:{n:"??"},256:{n:"??"},259:{n:"??"},260:{n:"??"},261:{n:"??"},262:{n:"??"},263:{n:"??"},265:{n:"??"},266:{n:"??"},267:{n:"??"},268:{n:"??"},270:{n:"??"},271:{n:"??"},384:{n:"??"},389:{n:"??"},390:{n:"??"},393:{n:"??"},396:{n:"??"},512:{n:"??"},514:{n:"??"},513:{n:"??"},516:{n:"??"},517:{n:"??"},640:{n:"??"},641:{n:"??"},642:{n:"??"},643:{n:"??"},644:{n:"??"},645:{n:"??"},646:{n:"??"},647:{n:"??"},648:{n:"??"},658:{n:"??"},659:{n:"??"},660:{n:"??"},661:{n:"??"},662:{n:"??"},665:{n:"??"},666:{n:"??"},768:{n:"??"},772:{n:"??"},1537:{n:"SHEETINFOQP",f:ht},1600:{n:"??"},1602:{n:"??"},1793:{n:"??"},1794:{n:"??"},1795:{n:"??"},1796:{n:"??"},1920:{n:"??"},2048:{n:"??"},2049:{n:"??"},2052:{n:"??"},2688:{n:"??"},10998:{n:"??"},12849:{n:"??"},28233:{n:"??"},28484:{n:"??"},65535:{n:""}};return{sheet_to_wk1:c,book_to_wk3:u,to_workbook:n}}();function tk(e){var n={},a=e.match(pi),c=0,u=!1;if(a)for(;c!=a.length;++c){var m=nr(a[c]);switch(m[0].replace(/\w*:/g,"")){case"<condense":break;case"<extend":break;case"<shadow":if(!m.val)break;case"<shadow>":case"<shadow/>":n.shadow=1;break;case"</shadow>":break;case"<charset":if(m.val=="1")break;n.cp=K0[parseInt(m.val,10)];break;case"<outline":if(!m.val)break;case"<outline>":case"<outline/>":n.outline=1;break;case"</outline>":break;case"<rFont":n.name=m.val;break;case"<sz":n.sz=m.val;break;case"<strike":if(!m.val)break;case"<strike>":case"<strike/>":n.strike=1;break;case"</strike>":break;case"<u":if(!m.val)break;switch(m.val){case"double":n.uval="double";break;case"singleAccounting":n.uval="single-accounting";break;case"doubleAccounting":n.uval="double-accounting";break}case"<u>":case"<u/>":n.u=1;break;case"</u>":break;case"<b":if(m.val=="0")break;case"<b>":case"<b/>":n.b=1;break;case"</b>":break;case"<i":if(m.val=="0")break;case"<i>":case"<i/>":n.i=1;break;case"</i>":break;case"<color":m.rgb&&(n.color=m.rgb.slice(2,8));break;case"<color>":case"<color/>":case"</color>":break;case"<family":n.family=m.val;break;case"<family>":case"<family/>":case"</family>":break;case"<vertAlign":n.valign=m.val;break;case"<vertAlign>":case"<vertAlign/>":case"</vertAlign>":break;case"<scheme":break;case"<scheme>":case"<scheme/>":case"</scheme>":break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":u=!0;break;case"</ext>":u=!1;break;default:if(m[0].charCodeAt(1)!==47&&!u)throw new Error("Unrecognized rich format "+m[0])}}return n}var rk=function(){var e=qc("t"),n=qc("rPr");function a(m){var x=m.match(e);if(!x)return{t:"s",v:""};var o={t:"s",v:Mr(x[1])},E=m.match(n);return E&&(o.s=tk(E[1])),o}var c=/<(?:\w+:)?r>/g,u=/<\/(?:\w+:)?r>/;return function(x){return x.replace(c,"").split(u).map(a).filter(function(o){return o.v})}}(),ak=function(){var n=/(\r\n|\n)/g;function a(u,m,x){var o=[];u.u&&o.push("text-decoration: underline;"),u.uval&&o.push("text-underline-style:"+u.uval+";"),u.sz&&o.push("font-size:"+u.sz+"pt;"),u.outline&&o.push("text-effect: outline;"),u.shadow&&o.push("text-shadow: auto;"),m.push('<span style="'+o.join("")+'">'),u.b&&(m.push("<b>"),x.push("</b>")),u.i&&(m.push("<i>"),x.push("</i>")),u.strike&&(m.push("<s>"),x.push("</s>"));var E=u.valign||"";return E=="superscript"||E=="super"?E="sup":E=="subscript"&&(E="sub"),E!=""&&(m.push("<"+E+">"),x.push("</"+E+">")),x.push("</span>"),u}function c(u){var m=[[],u.v,[]];return u.v?(u.s&&a(u.s,m[0],m[2]),m[0].join("")+m[1].replace(n,"<br/>")+m[2].join("")):""}return function(m){return m.map(c).join("")}}(),ik=/<(?:\w+:)?t[^>]*>([^<]*)<\/(?:\w+:)?t>/g,nk=/<(?:\w+:)?r>/,sk=/<(?:\w+:)?rPh.*?>([\s\S]*?)<\/(?:\w+:)?rPh>/g;function dd(e,n){var a=n?n.cellHTML:!0,c={};return e?(e.match(/^\s*<(?:\w+:)?t[^>]*>/)?(c.t=Mr(Xr(e.slice(e.indexOf(">")+1).split(/<\/(?:\w+:)?t>/)[0]||"")),c.r=Xr(e),a&&(c.h=ad(c.t))):e.match(nk)&&(c.r=Xr(e),c.t=Mr(Xr((e.replace(sk,"").match(ik)||[]).join("").replace(pi,""))),a&&(c.h=ak(rk(c.r)))),c):{t:""}}var ok=/<(?:\w+:)?sst([^>]*)>([\s\S]*)<\/(?:\w+:)?sst>/,lk=/<(?:\w+:)?(?:si|sstItem)>/g,ck=/<\/(?:\w+:)?(?:si|sstItem)>/;function uk(e,n){var a=[],c="";if(!e)return a;var u=e.match(ok);if(u){c=u[2].replace(lk,"").split(ck);for(var m=0;m!=c.length;++m){var x=dd(c[m].trim(),n);x!=null&&(a[a.length]=x)}u=nr(u[1]),a.Count=u.count,a.Unique=u.uniqueCount}return a}function hk(e){return[e.read_shift(4),e.read_shift(4)]}function fk(e,n){var a=[],c=!1;return cs(e,function(m,x,o){switch(o){case 159:a.Count=m[0],a.Unique=m[1];break;case 19:a.push(m);break;case 160:return!0;case 35:c=!0;break;case 36:c=!1;break;default:if(x.T,!c||n.WTF)throw new Error("Unexpected record 0x"+o.toString(16))}}),a}function cx(e){for(var n=[],a=e.split(""),c=0;c<a.length;++c)n[c]=a[c].charCodeAt(0);return n}function os(e,n){var a={};return a.Major=e.read_shift(2),a.Minor=e.read_shift(2),n>=4&&(e.l+=n-4),a}function dk(e){var n={};return n.id=e.read_shift(0,"lpp4"),n.R=os(e,4),n.U=os(e,4),n.W=os(e,4),n}function pk(e){for(var n=e.read_shift(4),a=e.l+n-4,c={},u=e.read_shift(4),m=[];u-- >0;)m.push({t:e.read_shift(4),v:e.read_shift(0,"lpp4")});if(c.name=e.read_shift(0,"lpp4"),c.comps=m,e.l!=a)throw new Error("Bad DataSpaceMapEntry: "+e.l+" != "+a);return c}function mk(e){var n=[];e.l+=4;for(var a=e.read_shift(4);a-- >0;)n.push(pk(e));return n}function gk(e){var n=[];e.l+=4;for(var a=e.read_shift(4);a-- >0;)n.push(e.read_shift(0,"lpp4"));return n}function xk(e){var n={};return e.read_shift(4),e.l+=4,n.id=e.read_shift(0,"lpp4"),n.name=e.read_shift(0,"lpp4"),n.R=os(e,4),n.U=os(e,4),n.W=os(e,4),n}function _k(e){var n=xk(e);if(n.ename=e.read_shift(0,"8lpp4"),n.blksz=e.read_shift(4),n.cmode=e.read_shift(4),e.read_shift(4)!=4)throw new Error("Bad !Primary record");return n}function ux(e,n){var a=e.l+n,c={};c.Flags=e.read_shift(4)&63,e.l+=4,c.AlgID=e.read_shift(4);var u=!1;switch(c.AlgID){case 26126:case 26127:case 26128:u=c.Flags==36;break;case 26625:u=c.Flags==4;break;case 0:u=c.Flags==16||c.Flags==4||c.Flags==36;break;default:throw"Unrecognized encryption algorithm: "+c.AlgID}if(!u)throw new Error("Encryption Flags/AlgID mismatch");return c.AlgIDHash=e.read_shift(4),c.KeySize=e.read_shift(4),c.ProviderType=e.read_shift(4),e.l+=8,c.CSPName=e.read_shift(a-e.l>>1,"utf16le"),e.l=a,c}function hx(e,n){var a={},c=e.l+n;return e.l+=4,a.Salt=e.slice(e.l,e.l+16),e.l+=16,a.Verifier=e.slice(e.l,e.l+16),e.l+=16,e.read_shift(4),a.VerifierHash=e.slice(e.l,c),e.l=c,a}function yk(e){var n=os(e);switch(n.Minor){case 2:return[n.Minor,vk(e)];case 3:return[n.Minor,wk()];case 4:return[n.Minor,bk(e)]}throw new Error("ECMA-376 Encrypted file unrecognized Version: "+n.Minor)}function vk(e){var n=e.read_shift(4);if((n&63)!=36)throw new Error("EncryptionInfo mismatch");var a=e.read_shift(4),c=ux(e,a),u=hx(e,e.length-e.l);return{t:"Std",h:c,v:u}}function wk(){throw new Error("File is password-protected: ECMA-376 Extensible")}function bk(e){var n=["saltSize","blockSize","keyBits","hashSize","cipherAlgorithm","cipherChaining","hashAlgorithm","saltValue"];e.l+=4;var a=e.read_shift(e.length-e.l,"utf8"),c={};return a.replace(pi,function(m){var x=nr(m);switch(Nn(x[0])){case"<?xml":break;case"<encryption":case"</encryption>":break;case"<keyData":n.forEach(function(o){c[o]=x[o]});break;case"<dataIntegrity":c.encryptedHmacKey=x.encryptedHmacKey,c.encryptedHmacValue=x.encryptedHmacValue;break;case"<keyEncryptors>":case"<keyEncryptors":c.encs=[];break;case"</keyEncryptors>":break;case"<keyEncryptor":c.uri=x.uri;break;case"</keyEncryptor>":break;case"<encryptedKey":c.encs.push(x);break;default:throw x[0]}}),c}function Tk(e,n){var a={},c=a.EncryptionVersionInfo=os(e,4);if(n-=4,c.Minor!=2)throw new Error("unrecognized minor version code: "+c.Minor);if(c.Major>4||c.Major<2)throw new Error("unrecognized major version code: "+c.Major);a.Flags=e.read_shift(4),n-=4;var u=e.read_shift(4);return n-=4,a.EncryptionHeader=ux(e,u),n-=u,a.EncryptionVerifier=hx(e,n),a}function Ek(e){var n={},a=n.EncryptionVersionInfo=os(e,4);if(a.Major!=1||a.Minor!=1)throw"unrecognized version code "+a.Major+" : "+a.Minor;return n.Salt=e.read_shift(16),n.EncryptedVerifier=e.read_shift(16),n.EncryptedVerifierHash=e.read_shift(16),n}function Sk(e){var n=0,a,c=cx(e),u=c.length+1,m,x,o,E,w;for(a=Os(u),a[0]=c.length,m=1;m!=u;++m)a[m]=c[m-1];for(m=u-1;m>=0;--m)x=a[m],o=n&16384?1:0,E=n<<1&32767,w=o|E,n=w^x;return n^52811}var fx=function(){var e=[187,255,255,186,255,255,185,128,0,190,15,0,191,15,0],n=[57840,7439,52380,33984,4364,3600,61902,12606,6258,57657,54287,34041,10252,43370,20163],a=[44796,19929,39858,10053,20106,40212,10761,31585,63170,64933,60267,50935,40399,11199,17763,35526,1453,2906,5812,11624,23248,885,1770,3540,7080,14160,28320,56640,55369,41139,20807,41614,21821,43642,17621,28485,56970,44341,19019,38038,14605,29210,60195,50791,40175,10751,21502,43004,24537,18387,36774,3949,7898,15796,31592,63184,47201,24803,49606,37805,14203,28406,56812,17824,35648,1697,3394,6788,13576,27152,43601,17539,35078,557,1114,2228,4456,30388,60776,51953,34243,7079,14158,28316,14128,28256,56512,43425,17251,34502,7597,13105,26210,52420,35241,883,1766,3532,4129,8258,16516,33032,4657,9314,18628],c=function(x){return(x/2|x*128)&255},u=function(x,o){return c(x^o)},m=function(x){for(var o=n[x.length-1],E=104,w=x.length-1;w>=0;--w)for(var C=x[w],P=0;P!=7;++P)C&64&&(o^=a[E]),C*=2,--E;return o};return function(x){for(var o=cx(x),E=m(o),w=o.length,C=Os(16),P=0;P!=16;++P)C[P]=0;var M,B,U;for((w&1)===1&&(M=E>>8,C[w]=u(e[0],M),--w,M=E&255,B=o[o.length-1],C[w]=u(B,M));w>0;)--w,M=E>>8,C[w]=u(o[w],M),--w,M=E&255,C[w]=u(o[w],M);for(w=15,U=15-o.length;U>0;)M=E>>8,C[w]=u(e[U],M),--w,--U,M=E&255,C[w]=u(o[w],M),--w,--U;return C}}(),kk=function(e,n,a,c,u){u||(u=n),c||(c=fx(e));var m,x;for(m=0;m!=n.length;++m)x=n[m],x^=c[a],x=(x>>5|x<<3)&255,u[m]=x,++a;return[u,a,c]},Ck=function(e){var n=0,a=fx(e);return function(c){var u=kk("",c,n,a);return n=u[1],u[0]}};function Ak(e,n,a,c){var u={key:Ca(e),verificationBytes:Ca(e)};return a.password&&(u.verifier=Sk(a.password)),c.valid=u.verificationBytes===u.verifier,c.valid&&(c.insitu=Ck(a.password)),u}function Ik(e,n,a){var c=a||{};return c.Info=e.read_shift(2),e.l-=2,c.Info===1?c.Data=Ek(e):c.Data=Tk(e,n),c}function Fk(e,n,a){var c={Type:a.biff>=8?e.read_shift(2):0};return c.Type?Ik(e,n-2,c):Ak(e,a.biff>=8?n:n-2,a,c),c}var Pk=function(){function e(u,m){switch(m.type){case"base64":return n(Zi(u),m);case"binary":return n(u,m);case"buffer":return n(kr&&Buffer.isBuffer(u)?u.toString("binary"):wo(u),m);case"array":return n(go(u),m)}throw new Error("Unrecognized type "+m.type)}function n(u,m){var x=m||{},o=x.dense?[]:{},E=u.match(/\\trowd.*?\\row\b/g);if(!E.length)throw new Error("RTF missing table");var w={s:{c:0,r:0},e:{c:0,r:E.length-1}};return E.forEach(function(C,P){Array.isArray(o)&&(o[P]=[]);for(var M=/\\\w+\b/g,B=0,U,N=-1;U=M.exec(C);){switch(U[0]){case"\\cell":var j=C.slice(B,M.lastIndex-U[0].length);if(j[0]==" "&&(j=j.slice(1)),++N,j.length){var re={v:j,t:"s"};Array.isArray(o)?o[P][N]=re:o[fr({r:P,c:N})]=re}break}B=M.lastIndex}N>w.e.c&&(w.e.c=N)}),o["!ref"]=Fr(w),o}function a(u,m){return zs(e(u,m),m)}function c(u){for(var m=["{\\rtf1\\ansi"],x=pa(u["!ref"]),o,E=Array.isArray(u),w=x.s.r;w<=x.e.r;++w){m.push("\\trowd\\trautofit1");for(var C=x.s.c;C<=x.e.c;++C)m.push("\\cellx"+(C+1));for(m.push("\\pard\\intbl"),C=x.s.c;C<=x.e.c;++C){var P=fr({r:w,c:C});o=E?(u[w]||[])[C]:u[P],!(!o||o.v==null&&(!o.f||o.F))&&(m.push(" "+(o.w||(ls(o),o.w))),m.push("\\cell"))}m.push("\\pard\\intbl\\row")}return m.join("")+"}"}return{to_workbook:a,to_sheet:e,from_sheet:c}}();function Mk(e){var n=e.slice(e[0]==="#"?1:0).slice(0,6);return[parseInt(n.slice(0,2),16),parseInt(n.slice(2,4),16),parseInt(n.slice(4,6),16)]}function Kc(e){for(var n=0,a=1;n!=3;++n)a=a*256+(e[n]>255?255:e[n]<0?0:e[n]);return a.toString(16).toUpperCase().slice(1)}function Dk(e){var n=e[0]/255,a=e[1]/255,c=e[2]/255,u=Math.max(n,a,c),m=Math.min(n,a,c),x=u-m;if(x===0)return[0,0,n];var o=0,E=0,w=u+m;switch(E=x/(w>1?2-w:w),u){case n:o=((a-c)/x+6)%6;break;case a:o=(c-n)/x+2;break;case c:o=(n-a)/x+4;break}return[o/6,E,w/2]}function Lk(e){var n=e[0],a=e[1],c=e[2],u=a*2*(c<.5?c:1-c),m=c-u/2,x=[m,m,m],o=6*n,E;if(a!==0)switch(o|0){case 0:case 6:E=u*o,x[0]+=u,x[1]+=E;break;case 1:E=u*(2-o),x[0]+=E,x[1]+=u;break;case 2:E=u*(o-2),x[1]+=u,x[2]+=E;break;case 3:E=u*(4-o),x[1]+=E,x[2]+=u;break;case 4:E=u*(o-4),x[2]+=u,x[0]+=E;break;case 5:E=u*(6-o),x[2]+=E,x[0]+=u;break}for(var w=0;w!=3;++w)x[w]=Math.round(x[w]*255);return x}function Nh(e,n){if(n===0)return e;var a=Dk(Mk(e));return n<0?a[2]=a[2]*(1+n):a[2]=1-(1-a[2])*(1-n),Kc(Lk(a))}var dx=6,Rk=15,Ok=1,ki=dx;function Uh(e){return Math.floor((e+Math.round(128/ki)/256)*ki)}function Vh(e){return Math.floor((e-5)/ki*100+.5)/100}function R0(e){return Math.round((e*ki+5)/ki*256)/256}function m0(e){return R0(Vh(Uh(e)))}function pd(e){var n=Math.abs(e-m0(e)),a=ki;if(n>.005)for(ki=Ok;ki<Rk;++ki)Math.abs(e-m0(e))<=n&&(n=Math.abs(e-m0(e)),a=ki);ki=a}function yl(e){e.width?(e.wpx=Uh(e.width),e.wch=Vh(e.wpx),e.MDW=ki):e.wpx?(e.wch=Vh(e.wpx),e.width=R0(e.wch),e.MDW=ki):typeof e.wch=="number"&&(e.width=R0(e.wch),e.wpx=Uh(e.width),e.MDW=ki),e.customWidth&&delete e.customWidth}var Bk=96,px=Bk;function mx(e){return e*96/px}function Yc(e){return e*px/96}var zk={None:"none",Solid:"solid",Gray50:"mediumGray",Gray75:"darkGray",Gray25:"lightGray",HorzStripe:"darkHorizontal",VertStripe:"darkVertical",ReverseDiagStripe:"darkDown",DiagStripe:"darkUp",DiagCross:"darkGrid",ThickDiagCross:"darkTrellis",ThinHorzStripe:"lightHorizontal",ThinVertStripe:"lightVertical",ThinReverseDiagStripe:"lightDown",ThinHorzCross:"lightGrid"};function Nk(e,n,a,c){n.Borders=[];var u={},m=!1;(e[0].match(pi)||[]).forEach(function(x){var o=nr(x);switch(Nn(o[0])){case"<borders":case"<borders>":case"</borders>":break;case"<border":case"<border>":case"<border/>":u={},o.diagonalUp&&(u.diagonalUp=na(o.diagonalUp)),o.diagonalDown&&(u.diagonalDown=na(o.diagonalDown)),n.Borders.push(u);break;case"</border>":break;case"<left/>":break;case"<left":case"<left>":break;case"</left>":break;case"<right/>":break;case"<right":case"<right>":break;case"</right>":break;case"<top/>":break;case"<top":case"<top>":break;case"</top>":break;case"<bottom/>":break;case"<bottom":case"<bottom>":break;case"</bottom>":break;case"<diagonal":case"<diagonal>":case"<diagonal/>":break;case"</diagonal>":break;case"<horizontal":case"<horizontal>":case"<horizontal/>":break;case"</horizontal>":break;case"<vertical":case"<vertical>":case"<vertical/>":break;case"</vertical>":break;case"<start":case"<start>":case"<start/>":break;case"</start>":break;case"<end":case"<end>":case"<end/>":break;case"</end>":break;case"<color":case"<color>":break;case"<color/>":case"</color>":break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":m=!0;break;case"</ext>":m=!1;break;default:if(c&&c.WTF&&!m)throw new Error("unrecognized "+o[0]+" in borders")}})}function Uk(e,n,a,c){n.Fills=[];var u={},m=!1;(e[0].match(pi)||[]).forEach(function(x){var o=nr(x);switch(Nn(o[0])){case"<fills":case"<fills>":case"</fills>":break;case"<fill>":case"<fill":case"<fill/>":u={},n.Fills.push(u);break;case"</fill>":break;case"<gradientFill>":break;case"<gradientFill":case"</gradientFill>":n.Fills.push(u),u={};break;case"<patternFill":case"<patternFill>":o.patternType&&(u.patternType=o.patternType);break;case"<patternFill/>":case"</patternFill>":break;case"<bgColor":u.bgColor||(u.bgColor={}),o.indexed&&(u.bgColor.indexed=parseInt(o.indexed,10)),o.theme&&(u.bgColor.theme=parseInt(o.theme,10)),o.tint&&(u.bgColor.tint=parseFloat(o.tint)),o.rgb&&(u.bgColor.rgb=o.rgb.slice(-6));break;case"<bgColor/>":case"</bgColor>":break;case"<fgColor":u.fgColor||(u.fgColor={}),o.theme&&(u.fgColor.theme=parseInt(o.theme,10)),o.tint&&(u.fgColor.tint=parseFloat(o.tint)),o.rgb!=null&&(u.fgColor.rgb=o.rgb.slice(-6));break;case"<fgColor/>":case"</fgColor>":break;case"<stop":case"<stop/>":break;case"</stop>":break;case"<color":case"<color/>":break;case"</color>":break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":m=!0;break;case"</ext>":m=!1;break;default:if(c&&c.WTF&&!m)throw new Error("unrecognized "+o[0]+" in fills")}})}function Vk(e,n,a,c){n.Fonts=[];var u={},m=!1;(e[0].match(pi)||[]).forEach(function(x){var o=nr(x);switch(Nn(o[0])){case"<fonts":case"<fonts>":case"</fonts>":break;case"<font":case"<font>":break;case"</font>":case"<font/>":n.Fonts.push(u),u={};break;case"<name":o.val&&(u.name=Xr(o.val));break;case"<name/>":case"</name>":break;case"<b":u.bold=o.val?na(o.val):1;break;case"<b/>":u.bold=1;break;case"<i":u.italic=o.val?na(o.val):1;break;case"<i/>":u.italic=1;break;case"<u":switch(o.val){case"none":u.underline=0;break;case"single":u.underline=1;break;case"double":u.underline=2;break;case"singleAccounting":u.underline=33;break;case"doubleAccounting":u.underline=34;break}break;case"<u/>":u.underline=1;break;case"<strike":u.strike=o.val?na(o.val):1;break;case"<strike/>":u.strike=1;break;case"<outline":u.outline=o.val?na(o.val):1;break;case"<outline/>":u.outline=1;break;case"<shadow":u.shadow=o.val?na(o.val):1;break;case"<shadow/>":u.shadow=1;break;case"<condense":u.condense=o.val?na(o.val):1;break;case"<condense/>":u.condense=1;break;case"<extend":u.extend=o.val?na(o.val):1;break;case"<extend/>":u.extend=1;break;case"<sz":o.val&&(u.sz=+o.val);break;case"<sz/>":case"</sz>":break;case"<vertAlign":o.val&&(u.vertAlign=o.val);break;case"<vertAlign/>":case"</vertAlign>":break;case"<family":o.val&&(u.family=parseInt(o.val,10));break;case"<family/>":case"</family>":break;case"<scheme":o.val&&(u.scheme=o.val);break;case"<scheme/>":case"</scheme>":break;case"<charset":if(o.val=="1")break;o.codepage=K0[parseInt(o.val,10)];break;case"<color":if(u.color||(u.color={}),o.auto&&(u.color.auto=na(o.auto)),o.rgb)u.color.rgb=o.rgb.slice(-6);else if(o.indexed){u.color.index=parseInt(o.indexed,10);var E=po[u.color.index];u.color.index==81&&(E=po[1]),E||(E=po[1]),u.color.rgb=E[0].toString(16)+E[1].toString(16)+E[2].toString(16)}else o.theme&&(u.color.theme=parseInt(o.theme,10),o.tint&&(u.color.tint=parseFloat(o.tint)),o.theme&&a.themeElements&&a.themeElements.clrScheme&&(u.color.rgb=Nh(a.themeElements.clrScheme[u.color.theme].rgb,u.color.tint||0)));break;case"<color/>":case"</color>":break;case"<AlternateContent":m=!0;break;case"</AlternateContent>":m=!1;break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":m=!0;break;case"</ext>":m=!1;break;default:if(c&&c.WTF&&!m)throw new Error("unrecognized "+o[0]+" in fonts")}})}function $k(e,n,a){n.NumberFmt=[];for(var c=zn(gr),u=0;u<c.length;++u)n.NumberFmt[c[u]]=gr[c[u]];var m=e[0].match(pi);if(m)for(u=0;u<m.length;++u){var x=nr(m[u]);switch(Nn(x[0])){case"<numFmts":case"</numFmts>":case"<numFmts/>":case"<numFmts>":break;case"<numFmt":{var o=Mr(Xr(x.formatCode)),E=parseInt(x.numFmtId,10);if(n.NumberFmt[E]=o,E>0){if(E>392){for(E=392;E>60&&n.NumberFmt[E]!=null;--E);n.NumberFmt[E]=o}fo(o,E)}}break;case"</numFmt>":break;default:if(a.WTF)throw new Error("unrecognized "+x[0]+" in numFmts")}}}var Th=["numFmtId","fillId","fontId","borderId","xfId"],Eh=["applyAlignment","applyBorder","applyFill","applyFont","applyNumberFormat","applyProtection","pivotButton","quotePrefix"];function jk(e,n,a){n.CellXf=[];var c,u=!1;(e[0].match(pi)||[]).forEach(function(m){var x=nr(m),o=0;switch(Nn(x[0])){case"<cellXfs":case"<cellXfs>":case"<cellXfs/>":case"</cellXfs>":break;case"<xf":case"<xf/>":for(c=x,delete c[0],o=0;o<Th.length;++o)c[Th[o]]&&(c[Th[o]]=parseInt(c[Th[o]],10));for(o=0;o<Eh.length;++o)c[Eh[o]]&&(c[Eh[o]]=na(c[Eh[o]]));if(n.NumberFmt&&c.numFmtId>392){for(o=392;o>60;--o)if(n.NumberFmt[c.numFmtId]==n.NumberFmt[o]){c.numFmtId=o;break}}n.CellXf.push(c);break;case"</xf>":break;case"<alignment":case"<alignment/>":var E={};x.vertical&&(E.vertical=x.vertical),x.horizontal&&(E.horizontal=x.horizontal),x.textRotation!=null&&(E.textRotation=x.textRotation),x.indent&&(E.indent=x.indent),x.wrapText&&(E.wrapText=na(x.wrapText)),c.alignment=E;break;case"</alignment>":break;case"<protection":break;case"</protection>":case"<protection/>":break;case"<AlternateContent":u=!0;break;case"</AlternateContent>":u=!1;break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":u=!0;break;case"</ext>":u=!1;break;default:if(a&&a.WTF&&!u)throw new Error("unrecognized "+x[0]+" in cellXfs")}})}var Gk=function(){var n=/<(?:\w+:)?numFmts([^>]*)>[\S\s]*?<\/(?:\w+:)?numFmts>/,a=/<(?:\w+:)?cellXfs([^>]*)>[\S\s]*?<\/(?:\w+:)?cellXfs>/,c=/<(?:\w+:)?fills([^>]*)>[\S\s]*?<\/(?:\w+:)?fills>/,u=/<(?:\w+:)?fonts([^>]*)>[\S\s]*?<\/(?:\w+:)?fonts>/,m=/<(?:\w+:)?borders([^>]*)>[\S\s]*?<\/(?:\w+:)?borders>/;return function(o,E,w){var C={};if(!o)return C;o=o.replace(/<!--([\s\S]*?)-->/mg,"").replace(/<!DOCTYPE[^\[]*\[[^\]]*\]>/gm,"");var P;return(P=o.match(n))&&$k(P,C,w),(P=o.match(u))&&Vk(P,C,E,w),(P=o.match(c))&&Uk(P,C,E,w),(P=o.match(m))&&Nk(P,C,E,w),(P=o.match(a))&&jk(P,C,w),C}}();function Hk(e,n){var a=e.read_shift(2),c=fi(e);return[a,c]}function Wk(e,n,a){var c={};c.sz=e.read_shift(2)/20;var u=rE(e);u.fItalic&&(c.italic=1),u.fCondense&&(c.condense=1),u.fExtend&&(c.extend=1),u.fShadow&&(c.shadow=1),u.fOutline&&(c.outline=1),u.fStrikeout&&(c.strike=1);var m=e.read_shift(2);switch(m===700&&(c.bold=1),e.read_shift(2)){case 1:c.vertAlign="superscript";break;case 2:c.vertAlign="subscript";break}var x=e.read_shift(1);x!=0&&(c.underline=x);var o=e.read_shift(1);o>0&&(c.family=o);var E=e.read_shift(1);switch(E>0&&(c.charset=E),e.l++,c.color=tE(e),e.read_shift(1)){case 1:c.scheme="major";break;case 2:c.scheme="minor";break}return c.name=fi(e),c}var qk=di;function Zk(e,n){var a=e.l+n,c=e.read_shift(2),u=e.read_shift(2);return e.l=a,{ixfe:c,numFmtId:u}}var Xk=di;function Kk(e,n,a){var c={};c.NumberFmt=[];for(var u in gr)c.NumberFmt[u]=gr[u];c.CellXf=[],c.Fonts=[];var m=[],x=!1;return cs(e,function(E,w,C){switch(C){case 44:c.NumberFmt[E[0]]=E[1],fo(E[1],E[0]);break;case 43:c.Fonts.push(E),E.color.theme!=null&&n&&n.themeElements&&n.themeElements.clrScheme&&(E.color.rgb=Nh(n.themeElements.clrScheme[E.color.theme].rgb,E.color.tint||0));break;case 1025:break;case 45:break;case 46:break;case 47:m[m.length-1]==617&&c.CellXf.push(E);break;case 48:case 507:case 572:case 475:break;case 1171:case 2102:case 1130:case 512:case 2095:case 3072:break;case 35:x=!0;break;case 36:x=!1;break;case 37:m.push(C),x=!0;break;case 38:m.pop(),x=!1;break;default:if(w.T>0)m.push(C);else if(w.T<0)m.pop();else if(!x||a.WTF&&m[m.length-1]!=37)throw new Error("Unexpected record 0x"+C.toString(16))}}),c}var Yk=["</a:lt1>","</a:dk1>","</a:lt2>","</a:dk2>","</a:accent1>","</a:accent2>","</a:accent3>","</a:accent4>","</a:accent5>","</a:accent6>","</a:hlink>","</a:folHlink>"];function Jk(e,n,a){n.themeElements.clrScheme=[];var c={};(e[0].match(pi)||[]).forEach(function(u){var m=nr(u);switch(m[0]){case"<a:clrScheme":case"</a:clrScheme>":break;case"<a:srgbClr":c.rgb=m.val;break;case"<a:sysClr":c.rgb=m.lastClr;break;case"<a:dk1>":case"</a:dk1>":case"<a:lt1>":case"</a:lt1>":case"<a:dk2>":case"</a:dk2>":case"<a:lt2>":case"</a:lt2>":case"<a:accent1>":case"</a:accent1>":case"<a:accent2>":case"</a:accent2>":case"<a:accent3>":case"</a:accent3>":case"<a:accent4>":case"</a:accent4>":case"<a:accent5>":case"</a:accent5>":case"<a:accent6>":case"</a:accent6>":case"<a:hlink>":case"</a:hlink>":case"<a:folHlink>":case"</a:folHlink>":m[0].charAt(1)==="/"?(n.themeElements.clrScheme[Yk.indexOf(m[0])]=c,c={}):c.name=m[0].slice(3,m[0].length-1);break;default:if(a&&a.WTF)throw new Error("Unrecognized "+m[0]+" in clrScheme")}})}function Qk(){}function eC(){}var tC=/<a:clrScheme([^>]*)>[\s\S]*<\/a:clrScheme>/,rC=/<a:fontScheme([^>]*)>[\s\S]*<\/a:fontScheme>/,aC=/<a:fmtScheme([^>]*)>[\s\S]*<\/a:fmtScheme>/;function iC(e,n,a){n.themeElements={};var c;[["clrScheme",tC,Jk],["fontScheme",rC,Qk],["fmtScheme",aC,eC]].forEach(function(u){if(!(c=e.match(u[1])))throw new Error(u[0]+" not found in themeElements");u[2](c,n,a)})}var nC=/<a:themeElements([^>]*)>[\s\S]*<\/a:themeElements>/;function gx(e,n){(!e||e.length===0)&&(e=sC());var a,c={};if(!(a=e.match(nC)))throw new Error("themeElements not found in theme");return iC(a[0],c,n),c.raw=e,c}function sC(e,n){if(n&&n.themeXLSX)return n.themeXLSX;if(e&&typeof e.raw=="string")return e.raw;var a=[C1];return a[a.length]='<a:theme xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" name="Office Theme">',a[a.length]="<a:themeElements>",a[a.length]='<a:clrScheme name="Office">',a[a.length]='<a:dk1><a:sysClr val="windowText" lastClr="000000"/></a:dk1>',a[a.length]='<a:lt1><a:sysClr val="window" lastClr="FFFFFF"/></a:lt1>',a[a.length]='<a:dk2><a:srgbClr val="1F497D"/></a:dk2>',a[a.length]='<a:lt2><a:srgbClr val="EEECE1"/></a:lt2>',a[a.length]='<a:accent1><a:srgbClr val="4F81BD"/></a:accent1>',a[a.length]='<a:accent2><a:srgbClr val="C0504D"/></a:accent2>',a[a.length]='<a:accent3><a:srgbClr val="9BBB59"/></a:accent3>',a[a.length]='<a:accent4><a:srgbClr val="8064A2"/></a:accent4>',a[a.length]='<a:accent5><a:srgbClr val="4BACC6"/></a:accent5>',a[a.length]='<a:accent6><a:srgbClr val="F79646"/></a:accent6>',a[a.length]='<a:hlink><a:srgbClr val="0000FF"/></a:hlink>',a[a.length]='<a:folHlink><a:srgbClr val="800080"/></a:folHlink>',a[a.length]="</a:clrScheme>",a[a.length]='<a:fontScheme name="Office">',a[a.length]="<a:majorFont>",a[a.length]='<a:latin typeface="Cambria"/>',a[a.length]='<a:ea typeface=""/>',a[a.length]='<a:cs typeface=""/>',a[a.length]='<a:font script="Jpan" typeface="ＭＳ Ｐゴシック"/>',a[a.length]='<a:font script="Hang" typeface="맑은 고딕"/>',a[a.length]='<a:font script="Hans" typeface="宋体"/>',a[a.length]='<a:font script="Hant" typeface="新細明體"/>',a[a.length]='<a:font script="Arab" typeface="Times New Roman"/>',a[a.length]='<a:font script="Hebr" typeface="Times New Roman"/>',a[a.length]='<a:font script="Thai" typeface="Tahoma"/>',a[a.length]='<a:font script="Ethi" typeface="Nyala"/>',a[a.length]='<a:font script="Beng" typeface="Vrinda"/>',a[a.length]='<a:font script="Gujr" typeface="Shruti"/>',a[a.length]='<a:font script="Khmr" typeface="MoolBoran"/>',a[a.length]='<a:font script="Knda" typeface="Tunga"/>',a[a.length]='<a:font script="Guru" typeface="Raavi"/>',a[a.length]='<a:font script="Cans" typeface="Euphemia"/>',a[a.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',a[a.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',a[a.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',a[a.length]='<a:font script="Thaa" typeface="MV Boli"/>',a[a.length]='<a:font script="Deva" typeface="Mangal"/>',a[a.length]='<a:font script="Telu" typeface="Gautami"/>',a[a.length]='<a:font script="Taml" typeface="Latha"/>',a[a.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',a[a.length]='<a:font script="Orya" typeface="Kalinga"/>',a[a.length]='<a:font script="Mlym" typeface="Kartika"/>',a[a.length]='<a:font script="Laoo" typeface="DokChampa"/>',a[a.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',a[a.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',a[a.length]='<a:font script="Viet" typeface="Times New Roman"/>',a[a.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',a[a.length]='<a:font script="Geor" typeface="Sylfaen"/>',a[a.length]="</a:majorFont>",a[a.length]="<a:minorFont>",a[a.length]='<a:latin typeface="Calibri"/>',a[a.length]='<a:ea typeface=""/>',a[a.length]='<a:cs typeface=""/>',a[a.length]='<a:font script="Jpan" typeface="ＭＳ Ｐゴシック"/>',a[a.length]='<a:font script="Hang" typeface="맑은 고딕"/>',a[a.length]='<a:font script="Hans" typeface="宋体"/>',a[a.length]='<a:font script="Hant" typeface="新細明體"/>',a[a.length]='<a:font script="Arab" typeface="Arial"/>',a[a.length]='<a:font script="Hebr" typeface="Arial"/>',a[a.length]='<a:font script="Thai" typeface="Tahoma"/>',a[a.length]='<a:font script="Ethi" typeface="Nyala"/>',a[a.length]='<a:font script="Beng" typeface="Vrinda"/>',a[a.length]='<a:font script="Gujr" typeface="Shruti"/>',a[a.length]='<a:font script="Khmr" typeface="DaunPenh"/>',a[a.length]='<a:font script="Knda" typeface="Tunga"/>',a[a.length]='<a:font script="Guru" typeface="Raavi"/>',a[a.length]='<a:font script="Cans" typeface="Euphemia"/>',a[a.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',a[a.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',a[a.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',a[a.length]='<a:font script="Thaa" typeface="MV Boli"/>',a[a.length]='<a:font script="Deva" typeface="Mangal"/>',a[a.length]='<a:font script="Telu" typeface="Gautami"/>',a[a.length]='<a:font script="Taml" typeface="Latha"/>',a[a.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',a[a.length]='<a:font script="Orya" typeface="Kalinga"/>',a[a.length]='<a:font script="Mlym" typeface="Kartika"/>',a[a.length]='<a:font script="Laoo" typeface="DokChampa"/>',a[a.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',a[a.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',a[a.length]='<a:font script="Viet" typeface="Arial"/>',a[a.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',a[a.length]='<a:font script="Geor" typeface="Sylfaen"/>',a[a.length]="</a:minorFont>",a[a.length]="</a:fontScheme>",a[a.length]='<a:fmtScheme name="Office">',a[a.length]="<a:fillStyleLst>",a[a.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',a[a.length]='<a:gradFill rotWithShape="1">',a[a.length]="<a:gsLst>",a[a.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="50000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',a[a.length]='<a:gs pos="35000"><a:schemeClr val="phClr"><a:tint val="37000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',a[a.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="15000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',a[a.length]="</a:gsLst>",a[a.length]='<a:lin ang="16200000" scaled="1"/>',a[a.length]="</a:gradFill>",a[a.length]='<a:gradFill rotWithShape="1">',a[a.length]="<a:gsLst>",a[a.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="100000"/><a:shade val="100000"/><a:satMod val="130000"/></a:schemeClr></a:gs>',a[a.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="50000"/><a:shade val="100000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',a[a.length]="</a:gsLst>",a[a.length]='<a:lin ang="16200000" scaled="0"/>',a[a.length]="</a:gradFill>",a[a.length]="</a:fillStyleLst>",a[a.length]="<a:lnStyleLst>",a[a.length]='<a:ln w="9525" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"><a:shade val="95000"/><a:satMod val="105000"/></a:schemeClr></a:solidFill><a:prstDash val="solid"/></a:ln>',a[a.length]='<a:ln w="25400" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',a[a.length]='<a:ln w="38100" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',a[a.length]="</a:lnStyleLst>",a[a.length]="<a:effectStyleLst>",a[a.length]="<a:effectStyle>",a[a.length]="<a:effectLst>",a[a.length]='<a:outerShdw blurRad="40000" dist="20000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="38000"/></a:srgbClr></a:outerShdw>',a[a.length]="</a:effectLst>",a[a.length]="</a:effectStyle>",a[a.length]="<a:effectStyle>",a[a.length]="<a:effectLst>",a[a.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',a[a.length]="</a:effectLst>",a[a.length]="</a:effectStyle>",a[a.length]="<a:effectStyle>",a[a.length]="<a:effectLst>",a[a.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',a[a.length]="</a:effectLst>",a[a.length]='<a:scene3d><a:camera prst="orthographicFront"><a:rot lat="0" lon="0" rev="0"/></a:camera><a:lightRig rig="threePt" dir="t"><a:rot lat="0" lon="0" rev="1200000"/></a:lightRig></a:scene3d>',a[a.length]='<a:sp3d><a:bevelT w="63500" h="25400"/></a:sp3d>',a[a.length]="</a:effectStyle>",a[a.length]="</a:effectStyleLst>",a[a.length]="<a:bgFillStyleLst>",a[a.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',a[a.length]='<a:gradFill rotWithShape="1">',a[a.length]="<a:gsLst>",a[a.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="40000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',a[a.length]='<a:gs pos="40000"><a:schemeClr val="phClr"><a:tint val="45000"/><a:shade val="99000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',a[a.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="20000"/><a:satMod val="255000"/></a:schemeClr></a:gs>',a[a.length]="</a:gsLst>",a[a.length]='<a:path path="circle"><a:fillToRect l="50000" t="-80000" r="50000" b="180000"/></a:path>',a[a.length]="</a:gradFill>",a[a.length]='<a:gradFill rotWithShape="1">',a[a.length]="<a:gsLst>",a[a.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="80000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',a[a.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="30000"/><a:satMod val="200000"/></a:schemeClr></a:gs>',a[a.length]="</a:gsLst>",a[a.length]='<a:path path="circle"><a:fillToRect l="50000" t="50000" r="50000" b="50000"/></a:path>',a[a.length]="</a:gradFill>",a[a.length]="</a:bgFillStyleLst>",a[a.length]="</a:fmtScheme>",a[a.length]="</a:themeElements>",a[a.length]="<a:objectDefaults>",a[a.length]="<a:spDef>",a[a.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="1"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="3"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="2"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="lt1"/></a:fontRef></a:style>',a[a.length]="</a:spDef>",a[a.length]="<a:lnDef>",a[a.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="2"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="0"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="1"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="tx1"/></a:fontRef></a:style>',a[a.length]="</a:lnDef>",a[a.length]="</a:objectDefaults>",a[a.length]="<a:extraClrSchemeLst/>",a[a.length]="</a:theme>",a.join("")}function oC(e,n,a){var c=e.l+n,u=e.read_shift(4);if(u!==124226){if(!a.cellStyles){e.l=c;return}var m=e.slice(e.l);e.l=c;var x;try{x=k1(m,{type:"array"})}catch{return}var o=qi(x,"theme/theme/theme1.xml",!0);if(o)return gx(o,a)}}function lC(e){return e.read_shift(4)}function cC(e){var n={};switch(n.xclrType=e.read_shift(2),n.nTintShade=e.read_shift(2),n.xclrType){case 0:e.l+=4;break;case 1:n.xclrValue=uC(e,4);break;case 2:n.xclrValue=rx(e);break;case 3:n.xclrValue=lC(e);break;case 4:e.l+=4;break}return e.l+=8,n}function uC(e,n){return di(e,n)}function hC(e,n){return di(e,n)}function fC(e){var n=e.read_shift(2),a=e.read_shift(2)-4,c=[n];switch(n){case 4:case 5:case 7:case 8:case 9:case 10:case 11:case 13:c[1]=cC(e);break;case 6:c[1]=hC(e,a);break;case 14:case 15:c[1]=e.read_shift(a===1?1:2);break;default:throw new Error("Unrecognized ExtProp type: "+n+" "+a)}return c}function dC(e,n){var a=e.l+n;e.l+=2;var c=e.read_shift(2);e.l+=2;for(var u=e.read_shift(2),m=[];u-- >0;)m.push(fC(e,a-e.l));return{ixfe:c,ext:m}}function pC(e,n){n.forEach(function(a){switch(a[0]){}})}function mC(e,n){return{flags:e.read_shift(4),version:e.read_shift(4),name:fi(e)}}function gC(e){for(var n=[],a=e.read_shift(4);a-- >0;)n.push([e.read_shift(4),e.read_shift(4)]);return n}function xC(e){return e.l+=4,e.read_shift(4)!=0}function _C(e,n,a){var c={Types:[],Cell:[],Value:[]},u=a||{},m=[],x=!1,o=2;return cs(e,function(E,w,C){switch(C){case 335:c.Types.push({name:E.name});break;case 51:E.forEach(function(P){o==1?c.Cell.push({type:c.Types[P[0]-1].name,index:P[1]}):o==0&&c.Value.push({type:c.Types[P[0]-1].name,index:P[1]})});break;case 337:o=E?1:0;break;case 338:o=2;break;case 35:m.push(C),x=!0;break;case 36:m.pop(),x=!1;break;default:if(!w.T){if(!x||u.WTF&&m[m.length-1]!=35)throw new Error("Unexpected record 0x"+C.toString(16))}}}),c}function yC(e,n,a){var c={Types:[],Cell:[],Value:[]};if(!e)return c;var u=!1,m=2,x;return e.replace(pi,function(o){var E=nr(o);switch(Nn(E[0])){case"<?xml":break;case"<metadata":case"</metadata>":break;case"<metadataTypes":case"</metadataTypes>":break;case"<metadataType":c.Types.push({name:E.name});break;case"</metadataType>":break;case"<futureMetadata":for(var w=0;w<c.Types.length;++w)c.Types[w].name==E.name&&(x=c.Types[w]);break;case"</futureMetadata>":break;case"<bk>":break;case"</bk>":break;case"<rc":m==1?c.Cell.push({type:c.Types[E.t-1].name,index:+E.v}):m==0&&c.Value.push({type:c.Types[E.t-1].name,index:+E.v});break;case"</rc>":break;case"<cellMetadata":m=1;break;case"</cellMetadata>":m=2;break;case"<valueMetadata":m=0;break;case"</valueMetadata>":m=2;break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":u=!0;break;case"</ext>":u=!1;break;case"<rvb":if(!x)break;x.offsets||(x.offsets=[]),x.offsets.push(+E.i);break;default:if(!u&&a.WTF)throw new Error("unrecognized "+E[0]+" in metadata")}return o}),c}function vC(e){var n=[];if(!e)return n;var a=1;return(e.match(pi)||[]).forEach(function(c){var u=nr(c);switch(u[0]){case"<?xml":break;case"<calcChain":case"<calcChain>":case"</calcChain>":break;case"<c":delete u[0],u.i?a=u.i:u.i=a,n.push(u);break}}),n}function wC(e){var n={};n.i=e.read_shift(4);var a={};a.r=e.read_shift(4),a.c=e.read_shift(4),n.r=fr(a);var c=e.read_shift(1);return c&2&&(n.l="1"),c&8&&(n.a="1"),n}function bC(e,n,a){var c=[];return cs(e,function(m,x,o){switch(o){case 63:c.push(m);break;default:if(!x.T)throw new Error("Unexpected record 0x"+o.toString(16))}}),c}function TC(e,n,a,c){if(!e)return e;var u=c||{},m=!1;cs(e,function(o,E,w){switch(w){case 359:case 363:case 364:case 366:case 367:case 368:case 369:case 370:case 371:case 472:case 577:case 578:case 579:case 580:case 581:case 582:case 583:case 584:case 585:case 586:case 587:break;case 35:m=!0;break;case 36:m=!1;break;default:if(!E.T){if(!m||u.WTF)throw new Error("Unexpected record 0x"+w.toString(16))}}},u)}function EC(e,n){if(!e)return"??";var a=(e.match(/<c:chart [^>]*r:id="([^"]*)"/)||["",""])[1];return n["!id"][a].Target}function xg(e,n,a,c){var u=Array.isArray(e),m;n.forEach(function(x){var o=Ai(x.ref);if(u?(e[o.r]||(e[o.r]=[]),m=e[o.r][o.c]):m=e[x.ref],!m){m={t:"z"},u?e[o.r][o.c]=m:e[x.ref]=m;var E=pa(e["!ref"]||"BDWGO1000001:A1");E.s.r>o.r&&(E.s.r=o.r),E.e.r<o.r&&(E.e.r=o.r),E.s.c>o.c&&(E.s.c=o.c),E.e.c<o.c&&(E.e.c=o.c);var w=Fr(E);w!==e["!ref"]&&(e["!ref"]=w)}m.c||(m.c=[]);var C={a:x.author,t:x.t,r:x.r,T:a};x.h&&(C.h=x.h);for(var P=m.c.length-1;P>=0;--P){if(!a&&m.c[P].T)return;a&&!m.c[P].T&&m.c.splice(P,1)}if(a&&c){for(P=0;P<c.length;++P)if(C.a==c[P].id){C.a=c[P].name||C.a;break}}m.c.push(C)})}function SC(e,n){if(e.match(/<(?:\w+:)?comments *\/>/))return[];var a=[],c=[],u=e.match(/<(?:\w+:)?authors>([\s\S]*)<\/(?:\w+:)?authors>/);u&&u[1]&&u[1].split(/<\/\w*:?author>/).forEach(function(x){if(!(x===""||x.trim()==="")){var o=x.match(/<(?:\w+:)?author[^>]*>(.*)/);o&&a.push(o[1])}});var m=e.match(/<(?:\w+:)?commentList>([\s\S]*)<\/(?:\w+:)?commentList>/);return m&&m[1]&&m[1].split(/<\/\w*:?comment>/).forEach(function(x){if(!(x===""||x.trim()==="")){var o=x.match(/<(?:\w+:)?comment[^>]*>/);if(o){var E=nr(o[0]),w={author:E.authorId&&a[E.authorId]||"sheetjsghost",ref:E.ref,guid:E.guid},C=Ai(E.ref);if(!(n.sheetRows&&n.sheetRows<=C.r)){var P=x.match(/<(?:\w+:)?text>([\s\S]*)<\/(?:\w+:)?text>/),M=!!P&&!!P[1]&&dd(P[1])||{r:"",t:"",h:""};w.r=M.r,M.r=="<t></t>"&&(M.t=M.h=""),w.t=(M.t||"").replace(/\r\n/g,`
`).replace(/\r/g,`
`),n.cellHTML&&(w.h=M.h),c.push(w)}}}}),c}function kC(e,n){var a=[],c=!1,u={},m=0;return e.replace(pi,function(o,E){var w=nr(o);switch(Nn(w[0])){case"<?xml":break;case"<ThreadedComments":break;case"</ThreadedComments>":break;case"<threadedComment":u={author:w.personId,guid:w.id,ref:w.ref,T:1};break;case"</threadedComment>":u.t!=null&&a.push(u);break;case"<text>":case"<text":m=E+o.length;break;case"</text>":u.t=e.slice(m,E).replace(/\r\n/g,`
`).replace(/\r/g,`
`);break;case"<mentions":case"<mentions>":c=!0;break;case"</mentions>":c=!1;break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":c=!0;break;case"</ext>":c=!1;break;default:if(!c&&n.WTF)throw new Error("unrecognized "+w[0]+" in threaded comments")}return o}),a}function CC(e,n){var a=[],c=!1;return e.replace(pi,function(m){var x=nr(m);switch(Nn(x[0])){case"<?xml":break;case"<personList":break;case"</personList>":break;case"<person":a.push({name:x.displayname,id:x.id});break;case"</person>":break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":c=!0;break;case"</ext>":c=!1;break;default:if(!c&&n.WTF)throw new Error("unrecognized "+x[0]+" in threaded comments")}return m}),a}function AC(e){var n={};n.iauthor=e.read_shift(4);var a=To(e);return n.rfx=a.s,n.ref=fr(a.s),e.l+=16,n}var IC=fi;function FC(e,n){var a=[],c=[],u={},m=!1;return cs(e,function(o,E,w){switch(w){case 632:c.push(o);break;case 635:u=o;break;case 637:u.t=o.t,u.h=o.h,u.r=o.r;break;case 636:if(u.author=c[u.iauthor],delete u.iauthor,n.sheetRows&&u.rfx&&n.sheetRows<=u.rfx.r)break;u.t||(u.t=""),delete u.rfx,a.push(u);break;case 3072:break;case 35:m=!0;break;case 36:m=!1;break;case 37:break;case 38:break;default:if(!E.T){if(!m||n.WTF)throw new Error("Unexpected record 0x"+w.toString(16))}}}),a}var PC="application/vnd.ms-office.vbaProject";function MC(e){var n=Ir.utils.cfb_new({root:"R"});return e.FullPaths.forEach(function(a,c){if(!(a.slice(-1)==="/"||!a.match(/_VBA_PROJECT_CUR/))){var u=a.replace(/^[^\/]*/,"R").replace(/\/_VBA_PROJECT_CUR\u0000*/,"");Ir.utils.cfb_add(n,u,e.FileIndex[c].content)}}),Ir.write(n)}function DC(){return{"!type":"dialog"}}function LC(){return{"!type":"dialog"}}function RC(){return{"!type":"macro"}}function OC(){return{"!type":"macro"}}var ml=function(){var e=/(^|[^A-Za-z_])R(\[?-?\d+\]|[1-9]\d*|)C(\[?-?\d+\]|[1-9]\d*|)(?![A-Za-z0-9_])/g,n={r:0,c:0};function a(c,u,m,x){var o=!1,E=!1;m.length==0?E=!0:m.charAt(0)=="["&&(E=!0,m=m.slice(1,-1)),x.length==0?o=!0:x.charAt(0)=="["&&(o=!0,x=x.slice(1,-1));var w=m.length>0?parseInt(m,10)|0:0,C=x.length>0?parseInt(x,10)|0:0;return o?C+=n.c:--C,E?w+=n.r:--w,u+(o?"":"$")+Oa(C)+(E?"":"$")+Qa(w)}return function(u,m){return n=m,u.replace(e,a)}}(),xx=/(^|[^._A-Z0-9])([$]?)([A-Z]{1,2}|[A-W][A-Z]{2}|X[A-E][A-Z]|XF[A-D])([$]?)(10[0-3]\d{4}|104[0-7]\d{3}|1048[0-4]\d{2}|10485[0-6]\d|104857[0-6]|[1-9]\d{0,5})(?![_.\(A-Za-z0-9])/g,BC=function(){return function(n,a){return n.replace(xx,function(c,u,m,x,o,E){var w=od(x)-(m?0:a.c),C=sd(E)-(o?0:a.r),P=C==0?"":o?C+1:"["+C+"]",M=w==0?"":m?w+1:"["+w+"]";return u+"R"+P+"C"+M})}}();function _x(e,n){return e.replace(xx,function(a,c,u,m,x,o){return c+(u=="$"?u+m:Oa(od(m)+n.c))+(x=="$"?x+o:Qa(sd(o)+n.r))})}function zC(e,n,a){var c=Tl(n),u=c.s,m=Ai(a),x={r:m.r-u.r,c:m.c-u.c};return _x(e,x)}function NC(e){return e.length!=1}function _g(e){return e.replace(/_xlfn\./g,"")}function Sa(e){e.l+=1}function Bs(e,n){var a=e.read_shift(n==1?1:2);return[a&16383,a>>14&1,a>>15&1]}function yx(e,n,a){var c=2;if(a){if(a.biff>=2&&a.biff<=5)return vx(e);a.biff==12&&(c=4)}var u=e.read_shift(c),m=e.read_shift(c),x=Bs(e,2),o=Bs(e,2);return{s:{r:u,c:x[0],cRel:x[1],rRel:x[2]},e:{r:m,c:o[0],cRel:o[1],rRel:o[2]}}}function vx(e){var n=Bs(e,2),a=Bs(e,2),c=e.read_shift(1),u=e.read_shift(1);return{s:{r:n[0],c,cRel:n[1],rRel:n[2]},e:{r:a[0],c:u,cRel:a[1],rRel:a[2]}}}function UC(e,n,a){if(a.biff<8)return vx(e);var c=e.read_shift(a.biff==12?4:2),u=e.read_shift(a.biff==12?4:2),m=Bs(e,2),x=Bs(e,2);return{s:{r:c,c:m[0],cRel:m[1],rRel:m[2]},e:{r:u,c:x[0],cRel:x[1],rRel:x[2]}}}function wx(e,n,a){if(a&&a.biff>=2&&a.biff<=5)return VC(e);var c=e.read_shift(a&&a.biff==12?4:2),u=Bs(e,2);return{r:c,c:u[0],cRel:u[1],rRel:u[2]}}function VC(e){var n=Bs(e,2),a=e.read_shift(1);return{r:n[0],c:a,cRel:n[1],rRel:n[2]}}function $C(e){var n=e.read_shift(2),a=e.read_shift(2);return{r:n,c:a&255,fQuoted:!!(a&16384),cRel:a>>15,rRel:a>>15}}function jC(e,n,a){var c=a&&a.biff?a.biff:8;if(c>=2&&c<=5)return GC(e);var u=e.read_shift(c>=12?4:2),m=e.read_shift(2),x=(m&16384)>>14,o=(m&32768)>>15;if(m&=16383,o==1)for(;u>524287;)u-=1048576;if(x==1)for(;m>8191;)m=m-16384;return{r:u,c:m,cRel:x,rRel:o}}function GC(e){var n=e.read_shift(2),a=e.read_shift(1),c=(n&32768)>>15,u=(n&16384)>>14;return n&=16383,c==1&&n>=8192&&(n=n-16384),u==1&&a>=128&&(a=a-256),{r:n,c:a,cRel:u,rRel:c}}function HC(e,n,a){var c=(e[e.l++]&96)>>5,u=yx(e,a.biff>=2&&a.biff<=5?6:8,a);return[c,u]}function WC(e,n,a){var c=(e[e.l++]&96)>>5,u=e.read_shift(2,"i"),m=8;if(a)switch(a.biff){case 5:e.l+=12,m=6;break;case 12:m=12;break}var x=yx(e,m,a);return[c,u,x]}function qC(e,n,a){var c=(e[e.l++]&96)>>5;return e.l+=a&&a.biff>8?12:a.biff<8?6:8,[c]}function ZC(e,n,a){var c=(e[e.l++]&96)>>5,u=e.read_shift(2),m=8;if(a)switch(a.biff){case 5:e.l+=12,m=6;break;case 12:m=12;break}return e.l+=m,[c,u]}function XC(e,n,a){var c=(e[e.l++]&96)>>5,u=UC(e,n-1,a);return[c,u]}function KC(e,n,a){var c=(e[e.l++]&96)>>5;return e.l+=a.biff==2?6:a.biff==12?14:7,[c]}function yg(e){var n=e[e.l+1]&1,a=1;return e.l+=4,[n,a]}function YC(e,n,a){e.l+=2;for(var c=e.read_shift(a&&a.biff==2?1:2),u=[],m=0;m<=c;++m)u.push(e.read_shift(a&&a.biff==2?1:2));return u}function JC(e,n,a){var c=e[e.l+1]&255?1:0;return e.l+=2,[c,e.read_shift(a&&a.biff==2?1:2)]}function QC(e,n,a){var c=e[e.l+1]&255?1:0;return e.l+=2,[c,e.read_shift(a&&a.biff==2?1:2)]}function e4(e){var n=e[e.l+1]&255?1:0;return e.l+=2,[n,e.read_shift(2)]}function t4(e,n,a){var c=e[e.l+1]&255?1:0;return e.l+=a&&a.biff==2?3:4,[c]}function bx(e){var n=e.read_shift(1),a=e.read_shift(1);return[n,a]}function r4(e){return e.read_shift(2),bx(e)}function a4(e){return e.read_shift(2),bx(e)}function i4(e,n,a){var c=(e[e.l]&96)>>5;e.l+=1;var u=wx(e,0,a);return[c,u]}function n4(e,n,a){var c=(e[e.l]&96)>>5;e.l+=1;var u=jC(e,0,a);return[c,u]}function s4(e,n,a){var c=(e[e.l]&96)>>5;e.l+=1;var u=e.read_shift(2);a&&a.biff==5&&(e.l+=12);var m=wx(e,0,a);return[c,u,m]}function o4(e,n,a){var c=(e[e.l]&96)>>5;e.l+=1;var u=e.read_shift(a&&a.biff<=3?1:2);return[l3[u],Sx[u],c]}function l4(e,n,a){var c=e[e.l++],u=e.read_shift(1),m=a&&a.biff<=3?[c==88?-1:0,e.read_shift(1)]:c4(e);return[u,(m[0]===0?Sx:o3)[m[1]]]}function c4(e){return[e[e.l+1]>>7,e.read_shift(2)&32767]}function u4(e,n,a){e.l+=a&&a.biff==2?3:4}function h4(e,n,a){if(e.l++,a&&a.biff==12)return[e.read_shift(4,"i"),0];var c=e.read_shift(2),u=e.read_shift(a&&a.biff==2?1:2);return[c,u]}function f4(e){return e.l++,Eo[e.read_shift(1)]}function d4(e){return e.l++,e.read_shift(2)}function p4(e){return e.l++,e.read_shift(1)!==0}function m4(e){return e.l++,ui(e)}function g4(e,n,a){return e.l++,iu(e,n-1,a)}function x4(e,n){var a=[e.read_shift(1)];if(n==12)switch(a[0]){case 2:a[0]=4;break;case 4:a[0]=16;break;case 0:a[0]=1;break;case 1:a[0]=2;break}switch(a[0]){case 4:a[1]=Ea(e,1)?"TRUE":"FALSE",n!=12&&(e.l+=7);break;case 37:case 16:a[1]=Eo[e[e.l]],e.l+=n==12?4:8;break;case 0:e.l+=8;break;case 1:a[1]=ui(e);break;case 2:a[1]=So(e,0,{biff:n>0&&n<8?2:n});break;default:throw new Error("Bad SerAr: "+a[0])}return a}function _4(e,n,a){for(var c=e.read_shift(a.biff==12?4:2),u=[],m=0;m!=c;++m)u.push((a.biff==12?To:Zh)(e));return u}function y4(e,n,a){var c=0,u=0;a.biff==12?(c=e.read_shift(4),u=e.read_shift(4)):(u=1+e.read_shift(1),c=1+e.read_shift(2)),a.biff>=2&&a.biff<8&&(--c,--u==0&&(u=256));for(var m=0,x=[];m!=c&&(x[m]=[]);++m)for(var o=0;o!=u;++o)x[m][o]=x4(e,a.biff);return x}function v4(e,n,a){var c=e.read_shift(1)>>>5&3,u=!a||a.biff>=8?4:2,m=e.read_shift(u);switch(a.biff){case 2:e.l+=5;break;case 3:case 4:e.l+=8;break;case 5:e.l+=12;break}return[c,0,m]}function w4(e,n,a){if(a.biff==5)return b4(e);var c=e.read_shift(1)>>>5&3,u=e.read_shift(2),m=e.read_shift(4);return[c,u,m]}function b4(e){var n=e.read_shift(1)>>>5&3,a=e.read_shift(2,"i");e.l+=8;var c=e.read_shift(2);return e.l+=12,[n,a,c]}function T4(e,n,a){var c=e.read_shift(1)>>>5&3;e.l+=a&&a.biff==2?3:4;var u=e.read_shift(a&&a.biff==2?1:2);return[c,u]}function E4(e,n,a){var c=e.read_shift(1)>>>5&3,u=e.read_shift(a&&a.biff==2?1:2);return[c,u]}function S4(e,n,a){var c=e.read_shift(1)>>>5&3;return e.l+=4,a.biff<8&&e.l--,a.biff==12&&(e.l+=2),[c]}function k4(e,n,a){var c=(e[e.l++]&96)>>5,u=e.read_shift(2),m=4;if(a)switch(a.biff){case 5:m=15;break;case 12:m=6;break}return e.l+=m,[c,u]}var C4=di,A4=di,I4=di;function su(e,n,a){return e.l+=2,[$C(e)]}function md(e){return e.l+=6,[]}var F4=su,P4=md,M4=md,D4=su;function Tx(e){return e.l+=2,[Ca(e),e.read_shift(2)&1]}var L4=su,R4=Tx,O4=md,B4=su,z4=su,N4=["Data","All","Headers","??","?Data2","??","?DataHeaders","??","Totals","??","??","??","?DataTotals","??","??","??","?Current"];function U4(e){e.l+=2;var n=e.read_shift(2),a=e.read_shift(2),c=e.read_shift(4),u=e.read_shift(2),m=e.read_shift(2),x=N4[a>>2&31];return{ixti:n,coltype:a&3,rt:x,idx:c,c:u,C:m}}function V4(e){return e.l+=2,[e.read_shift(4)]}function $4(e,n,a){return e.l+=5,e.l+=2,e.l+=a.biff==2?1:4,["PTGSHEET"]}function j4(e,n,a){return e.l+=a.biff==2?4:5,["PTGENDSHEET"]}function G4(e){var n=e.read_shift(1)>>>5&3,a=e.read_shift(2);return[n,a]}function H4(e){var n=e.read_shift(1)>>>5&3,a=e.read_shift(2);return[n,a]}function W4(e){return e.l+=4,[0,0]}var vg={1:{n:"PtgExp",f:h4},2:{n:"PtgTbl",f:I4},3:{n:"PtgAdd",f:Sa},4:{n:"PtgSub",f:Sa},5:{n:"PtgMul",f:Sa},6:{n:"PtgDiv",f:Sa},7:{n:"PtgPower",f:Sa},8:{n:"PtgConcat",f:Sa},9:{n:"PtgLt",f:Sa},10:{n:"PtgLe",f:Sa},11:{n:"PtgEq",f:Sa},12:{n:"PtgGe",f:Sa},13:{n:"PtgGt",f:Sa},14:{n:"PtgNe",f:Sa},15:{n:"PtgIsect",f:Sa},16:{n:"PtgUnion",f:Sa},17:{n:"PtgRange",f:Sa},18:{n:"PtgUplus",f:Sa},19:{n:"PtgUminus",f:Sa},20:{n:"PtgPercent",f:Sa},21:{n:"PtgParen",f:Sa},22:{n:"PtgMissArg",f:Sa},23:{n:"PtgStr",f:g4},26:{n:"PtgSheet",f:$4},27:{n:"PtgEndSheet",f:j4},28:{n:"PtgErr",f:f4},29:{n:"PtgBool",f:p4},30:{n:"PtgInt",f:d4},31:{n:"PtgNum",f:m4},32:{n:"PtgArray",f:KC},33:{n:"PtgFunc",f:o4},34:{n:"PtgFuncVar",f:l4},35:{n:"PtgName",f:v4},36:{n:"PtgRef",f:i4},37:{n:"PtgArea",f:HC},38:{n:"PtgMemArea",f:T4},39:{n:"PtgMemErr",f:C4},40:{n:"PtgMemNoMem",f:A4},41:{n:"PtgMemFunc",f:E4},42:{n:"PtgRefErr",f:S4},43:{n:"PtgAreaErr",f:qC},44:{n:"PtgRefN",f:n4},45:{n:"PtgAreaN",f:XC},46:{n:"PtgMemAreaN",f:G4},47:{n:"PtgMemNoMemN",f:H4},57:{n:"PtgNameX",f:w4},58:{n:"PtgRef3d",f:s4},59:{n:"PtgArea3d",f:WC},60:{n:"PtgRefErr3d",f:k4},61:{n:"PtgAreaErr3d",f:ZC},255:{}},q4={64:32,96:32,65:33,97:33,66:34,98:34,67:35,99:35,68:36,100:36,69:37,101:37,70:38,102:38,71:39,103:39,72:40,104:40,73:41,105:41,74:42,106:42,75:43,107:43,76:44,108:44,77:45,109:45,78:46,110:46,79:47,111:47,88:34,120:34,89:57,121:57,90:58,122:58,91:59,123:59,92:60,124:60,93:61,125:61},Z4={1:{n:"PtgElfLel",f:Tx},2:{n:"PtgElfRw",f:B4},3:{n:"PtgElfCol",f:F4},6:{n:"PtgElfRwV",f:z4},7:{n:"PtgElfColV",f:D4},10:{n:"PtgElfRadical",f:L4},11:{n:"PtgElfRadicalS",f:O4},13:{n:"PtgElfColS",f:P4},15:{n:"PtgElfColSV",f:M4},16:{n:"PtgElfRadicalLel",f:R4},25:{n:"PtgList",f:U4},29:{n:"PtgSxName",f:V4},255:{}},X4={0:{n:"PtgAttrNoop",f:W4},1:{n:"PtgAttrSemi",f:t4},2:{n:"PtgAttrIf",f:QC},4:{n:"PtgAttrChoose",f:YC},8:{n:"PtgAttrGoto",f:JC},16:{n:"PtgAttrSum",f:u4},32:{n:"PtgAttrBaxcel",f:yg},33:{n:"PtgAttrBaxcel",f:yg},64:{n:"PtgAttrSpace",f:r4},65:{n:"PtgAttrSpaceSemi",f:a4},128:{n:"PtgAttrIfError",f:e4},255:{}};function ou(e,n,a,c){if(c.biff<8)return di(e,n);for(var u=e.l+n,m=[],x=0;x!==a.length;++x)switch(a[x][0]){case"PtgArray":a[x][1]=y4(e,0,c),m.push(a[x][1]);break;case"PtgMemArea":a[x][2]=_4(e,a[x][1],c),m.push(a[x][2]);break;case"PtgExp":c&&c.biff==12&&(a[x][1][1]=e.read_shift(4),m.push(a[x][1]));break;case"PtgList":case"PtgElfRadicalS":case"PtgElfColS":case"PtgElfColSV":throw"Unsupported "+a[x][0]}return n=u-e.l,n!==0&&m.push(di(e,n)),m}function lu(e,n,a){for(var c=e.l+n,u,m,x=[];c!=e.l;)n=c-e.l,m=e[e.l],u=vg[m]||vg[q4[m]],(m===24||m===25)&&(u=(m===24?Z4:X4)[e[e.l+1]]),!u||!u.f?di(e,n):x.push([u.n,u.f(e,n,a)]);return x}function K4(e){for(var n=[],a=0;a<e.length;++a){for(var c=e[a],u=[],m=0;m<c.length;++m){var x=c[m];if(x)switch(x[0]){case 2:u.push('"'+x[1].replace(/"/g,'""')+'"');break;default:u.push(x[1])}else u.push("")}n.push(u.join(","))}return n.join(";")}var Y4={PtgAdd:"+",PtgConcat:"&",PtgDiv:"/",PtgEq:"=",PtgGe:">=",PtgGt:">",PtgLe:"<=",PtgLt:"<",PtgMul:"*",PtgNe:"<>",PtgPower:"^",PtgSub:"-"};function J4(e,n){if(!e&&!(n&&n.biff<=5&&n.biff>=2))throw new Error("empty sheet name");return/[^\w\u4E00-\u9FFF\u3040-\u30FF]/.test(e)?"'"+e+"'":e}function Ex(e,n,a){if(!e)return"SH33TJSERR0";if(a.biff>8&&(!e.XTI||!e.XTI[n]))return e.SheetNames[n];if(!e.XTI)return"SH33TJSERR6";var c=e.XTI[n];if(a.biff<8)return n>1e4&&(n-=65536),n<0&&(n=-n),n==0?"":e.XTI[n-1];if(!c)return"SH33TJSERR1";var u="";if(a.biff>8)switch(e[c[0]][0]){case 357:return u=c[1]==-1?"#REF":e.SheetNames[c[1]],c[1]==c[2]?u:u+":"+e.SheetNames[c[2]];case 358:return a.SID!=null?e.SheetNames[a.SID]:"SH33TJSSAME"+e[c[0]][0];case 355:default:return"SH33TJSSRC"+e[c[0]][0]}switch(e[c[0]][0][0]){case 1025:return u=c[1]==-1?"#REF":e.SheetNames[c[1]]||"SH33TJSERR3",c[1]==c[2]?u:u+":"+e.SheetNames[c[2]];case 14849:return e[c[0]].slice(1).map(function(m){return m.Name}).join(";;");default:return e[c[0]][0][3]?(u=c[1]==-1?"#REF":e[c[0]][0][3][c[1]]||"SH33TJSERR4",c[1]==c[2]?u:u+":"+e[c[0]][0][3][c[2]]):"SH33TJSERR2"}}function wg(e,n,a){var c=Ex(e,n,a);return c=="#REF"?c:J4(c,a)}function ci(e,n,a,c,u){var m=u&&u.biff||8,x={s:{c:0,r:0},e:{c:0,r:0}},o=[],E,w,C,P=0,M=0,B,U="";if(!e[0]||!e[0][0])return"";for(var N=-1,j="",re=0,pe=e[0].length;re<pe;++re){var X=e[0][re];switch(X[0]){case"PtgUminus":o.push("-"+o.pop());break;case"PtgUplus":o.push("+"+o.pop());break;case"PtgPercent":o.push(o.pop()+"%");break;case"PtgAdd":case"PtgConcat":case"PtgDiv":case"PtgEq":case"PtgGe":case"PtgGt":case"PtgLe":case"PtgLt":case"PtgMul":case"PtgNe":case"PtgPower":case"PtgSub":if(E=o.pop(),w=o.pop(),N>=0){switch(e[0][N][1][0]){case 0:j=da(" ",e[0][N][1][1]);break;case 1:j=da("\r",e[0][N][1][1]);break;default:if(j="",u.WTF)throw new Error("Unexpected PtgAttrSpaceType "+e[0][N][1][0])}w=w+j,N=-1}o.push(w+Y4[X[0]]+E);break;case"PtgIsect":E=o.pop(),w=o.pop(),o.push(w+" "+E);break;case"PtgUnion":E=o.pop(),w=o.pop(),o.push(w+","+E);break;case"PtgRange":E=o.pop(),w=o.pop(),o.push(w+":"+E);break;case"PtgAttrChoose":break;case"PtgAttrGoto":break;case"PtgAttrIf":break;case"PtgAttrIfError":break;case"PtgRef":C=Bc(X[1][1],x,u),o.push(zc(C,m));break;case"PtgRefN":C=a?Bc(X[1][1],a,u):X[1][1],o.push(zc(C,m));break;case"PtgRef3d":P=X[1][1],C=Bc(X[1][2],x,u),U=wg(c,P,u),o.push(U+"!"+zc(C,m));break;case"PtgFunc":case"PtgFuncVar":var le=X[1][0],ye=X[1][1];le||(le=0),le&=127;var we=le==0?[]:o.slice(-le);o.length-=le,ye==="User"&&(ye=we.shift()),o.push(ye+"("+we.join(",")+")");break;case"PtgBool":o.push(X[1]?"TRUE":"FALSE");break;case"PtgInt":o.push(X[1]);break;case"PtgNum":o.push(String(X[1]));break;case"PtgStr":o.push('"'+X[1].replace(/"/g,'""')+'"');break;case"PtgErr":o.push(X[1]);break;case"PtgAreaN":B=tg(X[1][1],a?{s:a}:x,u),o.push(d0(B,u));break;case"PtgArea":B=tg(X[1][1],x,u),o.push(d0(B,u));break;case"PtgArea3d":P=X[1][1],B=X[1][2],U=wg(c,P,u),o.push(U+"!"+d0(B,u));break;case"PtgAttrSum":o.push("SUM("+o.pop()+")");break;case"PtgAttrBaxcel":case"PtgAttrSemi":break;case"PtgName":M=X[1][2];var ae=(c.names||[])[M-1]||(c[0]||[])[M],ze=ae?ae.Name:"SH33TJSNAME"+String(M);ze&&ze.slice(0,6)=="_xlfn."&&!u.xlfn&&(ze=ze.slice(6)),o.push(ze);break;case"PtgNameX":var Ie=X[1][1];M=X[1][2];var $e;if(u.biff<=5)Ie<0&&(Ie=-Ie),c[Ie]&&($e=c[Ie][M]);else{var je="";if(((c[Ie]||[])[0]||[])[0]==14849||(((c[Ie]||[])[0]||[])[0]==1025?c[Ie][M]&&c[Ie][M].itab>0&&(je=c.SheetNames[c[Ie][M].itab-1]+"!"):je=c.SheetNames[M-1]+"!"),c[Ie]&&c[Ie][M])je+=c[Ie][M].Name;else if(c[0]&&c[0][M])je+=c[0][M].Name;else{var Le=(Ex(c,Ie,u)||"").split(";;");Le[M-1]?je=Le[M-1]:je+="SH33TJSERRX"}o.push(je);break}$e||($e={Name:"SH33TJSERRY"}),o.push($e.Name);break;case"PtgParen":var it="(",ft=")";if(N>=0){switch(j="",e[0][N][1][0]){case 2:it=da(" ",e[0][N][1][1])+it;break;case 3:it=da("\r",e[0][N][1][1])+it;break;case 4:ft=da(" ",e[0][N][1][1])+ft;break;case 5:ft=da("\r",e[0][N][1][1])+ft;break;default:if(u.WTF)throw new Error("Unexpected PtgAttrSpaceType "+e[0][N][1][0])}N=-1}o.push(it+o.pop()+ft);break;case"PtgRefErr":o.push("#REF!");break;case"PtgRefErr3d":o.push("#REF!");break;case"PtgExp":C={c:X[1][1],r:X[1][0]};var ct={c:a.c,r:a.r};if(c.sharedf[fr(C)]){var xt=c.sharedf[fr(C)];o.push(ci(xt,x,ct,c,u))}else{var ht=!1;for(E=0;E!=c.arrayf.length;++E)if(w=c.arrayf[E],!(C.c<w[0].s.c||C.c>w[0].e.c)&&!(C.r<w[0].s.r||C.r>w[0].e.r)){o.push(ci(w[1],x,ct,c,u)),ht=!0;break}ht||o.push(X[1])}break;case"PtgArray":o.push("{"+K4(X[1])+"}");break;case"PtgMemArea":break;case"PtgAttrSpace":case"PtgAttrSpaceSemi":N=re;break;case"PtgTbl":break;case"PtgMemErr":break;case"PtgMissArg":o.push("");break;case"PtgAreaErr":o.push("#REF!");break;case"PtgAreaErr3d":o.push("#REF!");break;case"PtgList":o.push("Table"+X[1].idx+"[#"+X[1].rt+"]");break;case"PtgMemAreaN":case"PtgMemNoMemN":case"PtgAttrNoop":case"PtgSheet":case"PtgEndSheet":break;case"PtgMemFunc":break;case"PtgMemNoMem":break;case"PtgElfCol":case"PtgElfColS":case"PtgElfColSV":case"PtgElfColV":case"PtgElfLel":case"PtgElfRadical":case"PtgElfRadicalLel":case"PtgElfRadicalS":case"PtgElfRw":case"PtgElfRwV":throw new Error("Unsupported ELFs");case"PtgSxName":throw new Error("Unrecognized Formula Token: "+String(X));default:throw new Error("Unrecognized Formula Token: "+String(X))}var Yt=["PtgAttrSpace","PtgAttrSpaceSemi","PtgAttrGoto"];if(u.biff!=3&&N>=0&&Yt.indexOf(e[0][re][0])==-1){X=e[0][N];var He=!0;switch(X[1][0]){case 4:He=!1;case 0:j=da(" ",X[1][1]);break;case 5:He=!1;case 1:j=da("\r",X[1][1]);break;default:if(j="",u.WTF)throw new Error("Unexpected PtgAttrSpaceType "+X[1][0])}o.push((He?j:"")+o.pop()+(He?"":j)),N=-1}}if(o.length>1&&u.WTF)throw new Error("bad formula stack");return o[0]}function Q4(e,n,a){var c=e.l+n,u=a.biff==2?1:2,m,x=e.read_shift(u);if(x==65535)return[[],di(e,n-2)];var o=lu(e,x,a);return n!==x+u&&(m=ou(e,n-x-u,o,a)),e.l=c,[o,m]}function e3(e,n,a){var c=e.l+n,u=a.biff==2?1:2,m,x=e.read_shift(u);if(x==65535)return[[],di(e,n-2)];var o=lu(e,x,a);return n!==x+u&&(m=ou(e,n-x-u,o,a)),e.l=c,[o,m]}function t3(e,n,a,c){var u=e.l+n,m=lu(e,c,a),x;return u!==e.l&&(x=ou(e,u-e.l,m,a)),[m,x]}function r3(e,n,a){var c=e.l+n,u,m=e.read_shift(2),x=lu(e,m,a);return m==65535?[[],di(e,n-2)]:(n!==m+2&&(u=ou(e,c-m-2,x,a)),[x,u])}function a3(e){var n;if(ns(e,e.l+6)!==65535)return[ui(e),"n"];switch(e[e.l]){case 0:return e.l+=8,["String","s"];case 1:return n=e[e.l+2]===1,e.l+=8,[n,"b"];case 2:return n=e[e.l+2],e.l+=8,[n,"e"];case 3:return e.l+=8,["","s"]}return[]}function g0(e,n,a){var c=e.l+n,u=Un(e);a.biff==2&&++e.l;var m=a3(e),x=e.read_shift(1);a.biff!=2&&(e.read_shift(1),a.biff>=5&&e.read_shift(4));var o=e3(e,c-e.l,a);return{cell:u,val:m[0],formula:o,shared:x>>3&1,tt:m[1]}}function Xh(e,n,a){var c=e.read_shift(4),u=lu(e,c,a),m=e.read_shift(4),x=m>0?ou(e,m,u,a):null;return[u,x]}var i3=Xh,Kh=Xh,n3=Xh,s3=Xh,o3={0:"BEEP",1:"OPEN",2:"OPEN.LINKS",3:"CLOSE.ALL",4:"SAVE",5:"SAVE.AS",6:"FILE.DELETE",7:"PAGE.SETUP",8:"PRINT",9:"PRINTER.SETUP",10:"QUIT",11:"NEW.WINDOW",12:"ARRANGE.ALL",13:"WINDOW.SIZE",14:"WINDOW.MOVE",15:"FULL",16:"CLOSE",17:"RUN",22:"SET.PRINT.AREA",23:"SET.PRINT.TITLES",24:"SET.PAGE.BREAK",25:"REMOVE.PAGE.BREAK",26:"FONT",27:"DISPLAY",28:"PROTECT.DOCUMENT",29:"PRECISION",30:"A1.R1C1",31:"CALCULATE.NOW",32:"CALCULATION",34:"DATA.FIND",35:"EXTRACT",36:"DATA.DELETE",37:"SET.DATABASE",38:"SET.CRITERIA",39:"SORT",40:"DATA.SERIES",41:"TABLE",42:"FORMAT.NUMBER",43:"ALIGNMENT",44:"STYLE",45:"BORDER",46:"CELL.PROTECTION",47:"COLUMN.WIDTH",48:"UNDO",49:"CUT",50:"COPY",51:"PASTE",52:"CLEAR",53:"PASTE.SPECIAL",54:"EDIT.DELETE",55:"INSERT",56:"FILL.RIGHT",57:"FILL.DOWN",61:"DEFINE.NAME",62:"CREATE.NAMES",63:"FORMULA.GOTO",64:"FORMULA.FIND",65:"SELECT.LAST.CELL",66:"SHOW.ACTIVE.CELL",67:"GALLERY.AREA",68:"GALLERY.BAR",69:"GALLERY.COLUMN",70:"GALLERY.LINE",71:"GALLERY.PIE",72:"GALLERY.SCATTER",73:"COMBINATION",74:"PREFERRED",75:"ADD.OVERLAY",76:"GRIDLINES",77:"SET.PREFERRED",78:"AXES",79:"LEGEND",80:"ATTACH.TEXT",81:"ADD.ARROW",82:"SELECT.CHART",83:"SELECT.PLOT.AREA",84:"PATTERNS",85:"MAIN.CHART",86:"OVERLAY",87:"SCALE",88:"FORMAT.LEGEND",89:"FORMAT.TEXT",90:"EDIT.REPEAT",91:"PARSE",92:"JUSTIFY",93:"HIDE",94:"UNHIDE",95:"WORKSPACE",96:"FORMULA",97:"FORMULA.FILL",98:"FORMULA.ARRAY",99:"DATA.FIND.NEXT",100:"DATA.FIND.PREV",101:"FORMULA.FIND.NEXT",102:"FORMULA.FIND.PREV",103:"ACTIVATE",104:"ACTIVATE.NEXT",105:"ACTIVATE.PREV",106:"UNLOCKED.NEXT",107:"UNLOCKED.PREV",108:"COPY.PICTURE",109:"SELECT",110:"DELETE.NAME",111:"DELETE.FORMAT",112:"VLINE",113:"HLINE",114:"VPAGE",115:"HPAGE",116:"VSCROLL",117:"HSCROLL",118:"ALERT",119:"NEW",120:"CANCEL.COPY",121:"SHOW.CLIPBOARD",122:"MESSAGE",124:"PASTE.LINK",125:"APP.ACTIVATE",126:"DELETE.ARROW",127:"ROW.HEIGHT",128:"FORMAT.MOVE",129:"FORMAT.SIZE",130:"FORMULA.REPLACE",131:"SEND.KEYS",132:"SELECT.SPECIAL",133:"APPLY.NAMES",134:"REPLACE.FONT",135:"FREEZE.PANES",136:"SHOW.INFO",137:"SPLIT",138:"ON.WINDOW",139:"ON.DATA",140:"DISABLE.INPUT",142:"OUTLINE",143:"LIST.NAMES",144:"FILE.CLOSE",145:"SAVE.WORKBOOK",146:"DATA.FORM",147:"COPY.CHART",148:"ON.TIME",149:"WAIT",150:"FORMAT.FONT",151:"FILL.UP",152:"FILL.LEFT",153:"DELETE.OVERLAY",155:"SHORT.MENUS",159:"SET.UPDATE.STATUS",161:"COLOR.PALETTE",162:"DELETE.STYLE",163:"WINDOW.RESTORE",164:"WINDOW.MAXIMIZE",166:"CHANGE.LINK",167:"CALCULATE.DOCUMENT",168:"ON.KEY",169:"APP.RESTORE",170:"APP.MOVE",171:"APP.SIZE",172:"APP.MINIMIZE",173:"APP.MAXIMIZE",174:"BRING.TO.FRONT",175:"SEND.TO.BACK",185:"MAIN.CHART.TYPE",186:"OVERLAY.CHART.TYPE",187:"SELECT.END",188:"OPEN.MAIL",189:"SEND.MAIL",190:"STANDARD.FONT",191:"CONSOLIDATE",192:"SORT.SPECIAL",193:"GALLERY.3D.AREA",194:"GALLERY.3D.COLUMN",195:"GALLERY.3D.LINE",196:"GALLERY.3D.PIE",197:"VIEW.3D",198:"GOAL.SEEK",199:"WORKGROUP",200:"FILL.GROUP",201:"UPDATE.LINK",202:"PROMOTE",203:"DEMOTE",204:"SHOW.DETAIL",206:"UNGROUP",207:"OBJECT.PROPERTIES",208:"SAVE.NEW.OBJECT",209:"SHARE",210:"SHARE.NAME",211:"DUPLICATE",212:"APPLY.STYLE",213:"ASSIGN.TO.OBJECT",214:"OBJECT.PROTECTION",215:"HIDE.OBJECT",216:"SET.EXTRACT",217:"CREATE.PUBLISHER",218:"SUBSCRIBE.TO",219:"ATTRIBUTES",220:"SHOW.TOOLBAR",222:"PRINT.PREVIEW",223:"EDIT.COLOR",224:"SHOW.LEVELS",225:"FORMAT.MAIN",226:"FORMAT.OVERLAY",227:"ON.RECALC",228:"EDIT.SERIES",229:"DEFINE.STYLE",240:"LINE.PRINT",243:"ENTER.DATA",249:"GALLERY.RADAR",250:"MERGE.STYLES",251:"EDITION.OPTIONS",252:"PASTE.PICTURE",253:"PASTE.PICTURE.LINK",254:"SPELLING",256:"ZOOM",259:"INSERT.OBJECT",260:"WINDOW.MINIMIZE",265:"SOUND.NOTE",266:"SOUND.PLAY",267:"FORMAT.SHAPE",268:"EXTEND.POLYGON",269:"FORMAT.AUTO",272:"GALLERY.3D.BAR",273:"GALLERY.3D.SURFACE",274:"FILL.AUTO",276:"CUSTOMIZE.TOOLBAR",277:"ADD.TOOL",278:"EDIT.OBJECT",279:"ON.DOUBLECLICK",280:"ON.ENTRY",281:"WORKBOOK.ADD",282:"WORKBOOK.MOVE",283:"WORKBOOK.COPY",284:"WORKBOOK.OPTIONS",285:"SAVE.WORKSPACE",288:"CHART.WIZARD",289:"DELETE.TOOL",290:"MOVE.TOOL",291:"WORKBOOK.SELECT",292:"WORKBOOK.ACTIVATE",293:"ASSIGN.TO.TOOL",295:"COPY.TOOL",296:"RESET.TOOL",297:"CONSTRAIN.NUMERIC",298:"PASTE.TOOL",302:"WORKBOOK.NEW",305:"SCENARIO.CELLS",306:"SCENARIO.DELETE",307:"SCENARIO.ADD",308:"SCENARIO.EDIT",309:"SCENARIO.SHOW",310:"SCENARIO.SHOW.NEXT",311:"SCENARIO.SUMMARY",312:"PIVOT.TABLE.WIZARD",313:"PIVOT.FIELD.PROPERTIES",314:"PIVOT.FIELD",315:"PIVOT.ITEM",316:"PIVOT.ADD.FIELDS",318:"OPTIONS.CALCULATION",319:"OPTIONS.EDIT",320:"OPTIONS.VIEW",321:"ADDIN.MANAGER",322:"MENU.EDITOR",323:"ATTACH.TOOLBARS",324:"VBAActivate",325:"OPTIONS.CHART",328:"VBA.INSERT.FILE",330:"VBA.PROCEDURE.DEFINITION",336:"ROUTING.SLIP",338:"ROUTE.DOCUMENT",339:"MAIL.LOGON",342:"INSERT.PICTURE",343:"EDIT.TOOL",344:"GALLERY.DOUGHNUT",350:"CHART.TREND",352:"PIVOT.ITEM.PROPERTIES",354:"WORKBOOK.INSERT",355:"OPTIONS.TRANSITION",356:"OPTIONS.GENERAL",370:"FILTER.ADVANCED",373:"MAIL.ADD.MAILER",374:"MAIL.DELETE.MAILER",375:"MAIL.REPLY",376:"MAIL.REPLY.ALL",377:"MAIL.FORWARD",378:"MAIL.NEXT.LETTER",379:"DATA.LABEL",380:"INSERT.TITLE",381:"FONT.PROPERTIES",382:"MACRO.OPTIONS",383:"WORKBOOK.HIDE",384:"WORKBOOK.UNHIDE",385:"WORKBOOK.DELETE",386:"WORKBOOK.NAME",388:"GALLERY.CUSTOM",390:"ADD.CHART.AUTOFORMAT",391:"DELETE.CHART.AUTOFORMAT",392:"CHART.ADD.DATA",393:"AUTO.OUTLINE",394:"TAB.ORDER",395:"SHOW.DIALOG",396:"SELECT.ALL",397:"UNGROUP.SHEETS",398:"SUBTOTAL.CREATE",399:"SUBTOTAL.REMOVE",400:"RENAME.OBJECT",412:"WORKBOOK.SCROLL",413:"WORKBOOK.NEXT",414:"WORKBOOK.PREV",415:"WORKBOOK.TAB.SPLIT",416:"FULL.SCREEN",417:"WORKBOOK.PROTECT",420:"SCROLLBAR.PROPERTIES",421:"PIVOT.SHOW.PAGES",422:"TEXT.TO.COLUMNS",423:"FORMAT.CHARTTYPE",424:"LINK.FORMAT",425:"TRACER.DISPLAY",430:"TRACER.NAVIGATE",431:"TRACER.CLEAR",432:"TRACER.ERROR",433:"PIVOT.FIELD.GROUP",434:"PIVOT.FIELD.UNGROUP",435:"CHECKBOX.PROPERTIES",436:"LABEL.PROPERTIES",437:"LISTBOX.PROPERTIES",438:"EDITBOX.PROPERTIES",439:"PIVOT.REFRESH",440:"LINK.COMBO",441:"OPEN.TEXT",442:"HIDE.DIALOG",443:"SET.DIALOG.FOCUS",444:"ENABLE.OBJECT",445:"PUSHBUTTON.PROPERTIES",446:"SET.DIALOG.DEFAULT",447:"FILTER",448:"FILTER.SHOW.ALL",449:"CLEAR.OUTLINE",450:"FUNCTION.WIZARD",451:"ADD.LIST.ITEM",452:"SET.LIST.ITEM",453:"REMOVE.LIST.ITEM",454:"SELECT.LIST.ITEM",455:"SET.CONTROL.VALUE",456:"SAVE.COPY.AS",458:"OPTIONS.LISTS.ADD",459:"OPTIONS.LISTS.DELETE",460:"SERIES.AXES",461:"SERIES.X",462:"SERIES.Y",463:"ERRORBAR.X",464:"ERRORBAR.Y",465:"FORMAT.CHART",466:"SERIES.ORDER",467:"MAIL.LOGOFF",468:"CLEAR.ROUTING.SLIP",469:"APP.ACTIVATE.MICROSOFT",470:"MAIL.EDIT.MAILER",471:"ON.SHEET",472:"STANDARD.WIDTH",473:"SCENARIO.MERGE",474:"SUMMARY.INFO",475:"FIND.FILE",476:"ACTIVE.CELL.FONT",477:"ENABLE.TIPWIZARD",478:"VBA.MAKE.ADDIN",480:"INSERTDATATABLE",481:"WORKGROUP.OPTIONS",482:"MAIL.SEND.MAILER",485:"AUTOCORRECT",489:"POST.DOCUMENT",491:"PICKLIST",493:"VIEW.SHOW",494:"VIEW.DEFINE",495:"VIEW.DELETE",509:"SHEET.BACKGROUND",510:"INSERT.MAP.OBJECT",511:"OPTIONS.MENONO",517:"MSOCHECKS",518:"NORMAL",519:"LAYOUT",520:"RM.PRINT.AREA",521:"CLEAR.PRINT.AREA",522:"ADD.PRINT.AREA",523:"MOVE.BRK",545:"HIDECURR.NOTE",546:"HIDEALL.NOTES",547:"DELETE.NOTE",548:"TRAVERSE.NOTES",549:"ACTIVATE.NOTES",620:"PROTECT.REVISIONS",621:"UNPROTECT.REVISIONS",647:"OPTIONS.ME",653:"WEB.PUBLISH",667:"NEWWEBQUERY",673:"PIVOT.TABLE.CHART",753:"OPTIONS.SAVE",755:"OPTIONS.SPELL",808:"HIDEALL.INKANNOTS"},Sx={0:"COUNT",1:"IF",2:"ISNA",3:"ISERROR",4:"SUM",5:"AVERAGE",6:"MIN",7:"MAX",8:"ROW",9:"COLUMN",10:"NA",11:"NPV",12:"STDEV",13:"DOLLAR",14:"FIXED",15:"SIN",16:"COS",17:"TAN",18:"ATAN",19:"PI",20:"SQRT",21:"EXP",22:"LN",23:"LOG10",24:"ABS",25:"INT",26:"SIGN",27:"ROUND",28:"LOOKUP",29:"INDEX",30:"REPT",31:"MID",32:"LEN",33:"VALUE",34:"TRUE",35:"FALSE",36:"AND",37:"OR",38:"NOT",39:"MOD",40:"DCOUNT",41:"DSUM",42:"DAVERAGE",43:"DMIN",44:"DMAX",45:"DSTDEV",46:"VAR",47:"DVAR",48:"TEXT",49:"LINEST",50:"TREND",51:"LOGEST",52:"GROWTH",53:"GOTO",54:"HALT",55:"RETURN",56:"PV",57:"FV",58:"NPER",59:"PMT",60:"RATE",61:"MIRR",62:"IRR",63:"RAND",64:"MATCH",65:"DATE",66:"TIME",67:"DAY",68:"MONTH",69:"YEAR",70:"WEEKDAY",71:"HOUR",72:"MINUTE",73:"SECOND",74:"NOW",75:"AREAS",76:"ROWS",77:"COLUMNS",78:"OFFSET",79:"ABSREF",80:"RELREF",81:"ARGUMENT",82:"SEARCH",83:"TRANSPOSE",84:"ERROR",85:"STEP",86:"TYPE",87:"ECHO",88:"SET.NAME",89:"CALLER",90:"DEREF",91:"WINDOWS",92:"SERIES",93:"DOCUMENTS",94:"ACTIVE.CELL",95:"SELECTION",96:"RESULT",97:"ATAN2",98:"ASIN",99:"ACOS",100:"CHOOSE",101:"HLOOKUP",102:"VLOOKUP",103:"LINKS",104:"INPUT",105:"ISREF",106:"GET.FORMULA",107:"GET.NAME",108:"SET.VALUE",109:"LOG",110:"EXEC",111:"CHAR",112:"LOWER",113:"UPPER",114:"PROPER",115:"LEFT",116:"RIGHT",117:"EXACT",118:"TRIM",119:"REPLACE",120:"SUBSTITUTE",121:"CODE",122:"NAMES",123:"DIRECTORY",124:"FIND",125:"CELL",126:"ISERR",127:"ISTEXT",128:"ISNUMBER",129:"ISBLANK",130:"T",131:"N",132:"FOPEN",133:"FCLOSE",134:"FSIZE",135:"FREADLN",136:"FREAD",137:"FWRITELN",138:"FWRITE",139:"FPOS",140:"DATEVALUE",141:"TIMEVALUE",142:"SLN",143:"SYD",144:"DDB",145:"GET.DEF",146:"REFTEXT",147:"TEXTREF",148:"INDIRECT",149:"REGISTER",150:"CALL",151:"ADD.BAR",152:"ADD.MENU",153:"ADD.COMMAND",154:"ENABLE.COMMAND",155:"CHECK.COMMAND",156:"RENAME.COMMAND",157:"SHOW.BAR",158:"DELETE.MENU",159:"DELETE.COMMAND",160:"GET.CHART.ITEM",161:"DIALOG.BOX",162:"CLEAN",163:"MDETERM",164:"MINVERSE",165:"MMULT",166:"FILES",167:"IPMT",168:"PPMT",169:"COUNTA",170:"CANCEL.KEY",171:"FOR",172:"WHILE",173:"BREAK",174:"NEXT",175:"INITIATE",176:"REQUEST",177:"POKE",178:"EXECUTE",179:"TERMINATE",180:"RESTART",181:"HELP",182:"GET.BAR",183:"PRODUCT",184:"FACT",185:"GET.CELL",186:"GET.WORKSPACE",187:"GET.WINDOW",188:"GET.DOCUMENT",189:"DPRODUCT",190:"ISNONTEXT",191:"GET.NOTE",192:"NOTE",193:"STDEVP",194:"VARP",195:"DSTDEVP",196:"DVARP",197:"TRUNC",198:"ISLOGICAL",199:"DCOUNTA",200:"DELETE.BAR",201:"UNREGISTER",204:"USDOLLAR",205:"FINDB",206:"SEARCHB",207:"REPLACEB",208:"LEFTB",209:"RIGHTB",210:"MIDB",211:"LENB",212:"ROUNDUP",213:"ROUNDDOWN",214:"ASC",215:"DBCS",216:"RANK",219:"ADDRESS",220:"DAYS360",221:"TODAY",222:"VDB",223:"ELSE",224:"ELSE.IF",225:"END.IF",226:"FOR.CELL",227:"MEDIAN",228:"SUMPRODUCT",229:"SINH",230:"COSH",231:"TANH",232:"ASINH",233:"ACOSH",234:"ATANH",235:"DGET",236:"CREATE.OBJECT",237:"VOLATILE",238:"LAST.ERROR",239:"CUSTOM.UNDO",240:"CUSTOM.REPEAT",241:"FORMULA.CONVERT",242:"GET.LINK.INFO",243:"TEXT.BOX",244:"INFO",245:"GROUP",246:"GET.OBJECT",247:"DB",248:"PAUSE",251:"RESUME",252:"FREQUENCY",253:"ADD.TOOLBAR",254:"DELETE.TOOLBAR",255:"User",256:"RESET.TOOLBAR",257:"EVALUATE",258:"GET.TOOLBAR",259:"GET.TOOL",260:"SPELLING.CHECK",261:"ERROR.TYPE",262:"APP.TITLE",263:"WINDOW.TITLE",264:"SAVE.TOOLBAR",265:"ENABLE.TOOL",266:"PRESS.TOOL",267:"REGISTER.ID",268:"GET.WORKBOOK",269:"AVEDEV",270:"BETADIST",271:"GAMMALN",272:"BETAINV",273:"BINOMDIST",274:"CHIDIST",275:"CHIINV",276:"COMBIN",277:"CONFIDENCE",278:"CRITBINOM",279:"EVEN",280:"EXPONDIST",281:"FDIST",282:"FINV",283:"FISHER",284:"FISHERINV",285:"FLOOR",286:"GAMMADIST",287:"GAMMAINV",288:"CEILING",289:"HYPGEOMDIST",290:"LOGNORMDIST",291:"LOGINV",292:"NEGBINOMDIST",293:"NORMDIST",294:"NORMSDIST",295:"NORMINV",296:"NORMSINV",297:"STANDARDIZE",298:"ODD",299:"PERMUT",300:"POISSON",301:"TDIST",302:"WEIBULL",303:"SUMXMY2",304:"SUMX2MY2",305:"SUMX2PY2",306:"CHITEST",307:"CORREL",308:"COVAR",309:"FORECAST",310:"FTEST",311:"INTERCEPT",312:"PEARSON",313:"RSQ",314:"STEYX",315:"SLOPE",316:"TTEST",317:"PROB",318:"DEVSQ",319:"GEOMEAN",320:"HARMEAN",321:"SUMSQ",322:"KURT",323:"SKEW",324:"ZTEST",325:"LARGE",326:"SMALL",327:"QUARTILE",328:"PERCENTILE",329:"PERCENTRANK",330:"MODE",331:"TRIMMEAN",332:"TINV",334:"MOVIE.COMMAND",335:"GET.MOVIE",336:"CONCATENATE",337:"POWER",338:"PIVOT.ADD.DATA",339:"GET.PIVOT.TABLE",340:"GET.PIVOT.FIELD",341:"GET.PIVOT.ITEM",342:"RADIANS",343:"DEGREES",344:"SUBTOTAL",345:"SUMIF",346:"COUNTIF",347:"COUNTBLANK",348:"SCENARIO.GET",349:"OPTIONS.LISTS.GET",350:"ISPMT",351:"DATEDIF",352:"DATESTRING",353:"NUMBERSTRING",354:"ROMAN",355:"OPEN.DIALOG",356:"SAVE.DIALOG",357:"VIEW.GET",358:"GETPIVOTDATA",359:"HYPERLINK",360:"PHONETIC",361:"AVERAGEA",362:"MAXA",363:"MINA",364:"STDEVPA",365:"VARPA",366:"STDEVA",367:"VARA",368:"BAHTTEXT",369:"THAIDAYOFWEEK",370:"THAIDIGIT",371:"THAIMONTHOFYEAR",372:"THAINUMSOUND",373:"THAINUMSTRING",374:"THAISTRINGLENGTH",375:"ISTHAIDIGIT",376:"ROUNDBAHTDOWN",377:"ROUNDBAHTUP",378:"THAIYEAR",379:"RTD",380:"CUBEVALUE",381:"CUBEMEMBER",382:"CUBEMEMBERPROPERTY",383:"CUBERANKEDMEMBER",384:"HEX2BIN",385:"HEX2DEC",386:"HEX2OCT",387:"DEC2BIN",388:"DEC2HEX",389:"DEC2OCT",390:"OCT2BIN",391:"OCT2HEX",392:"OCT2DEC",393:"BIN2DEC",394:"BIN2OCT",395:"BIN2HEX",396:"IMSUB",397:"IMDIV",398:"IMPOWER",399:"IMABS",400:"IMSQRT",401:"IMLN",402:"IMLOG2",403:"IMLOG10",404:"IMSIN",405:"IMCOS",406:"IMEXP",407:"IMARGUMENT",408:"IMCONJUGATE",409:"IMAGINARY",410:"IMREAL",411:"COMPLEX",412:"IMSUM",413:"IMPRODUCT",414:"SERIESSUM",415:"FACTDOUBLE",416:"SQRTPI",417:"QUOTIENT",418:"DELTA",419:"GESTEP",420:"ISEVEN",421:"ISODD",422:"MROUND",423:"ERF",424:"ERFC",425:"BESSELJ",426:"BESSELK",427:"BESSELY",428:"BESSELI",429:"XIRR",430:"XNPV",431:"PRICEMAT",432:"YIELDMAT",433:"INTRATE",434:"RECEIVED",435:"DISC",436:"PRICEDISC",437:"YIELDDISC",438:"TBILLEQ",439:"TBILLPRICE",440:"TBILLYIELD",441:"PRICE",442:"YIELD",443:"DOLLARDE",444:"DOLLARFR",445:"NOMINAL",446:"EFFECT",447:"CUMPRINC",448:"CUMIPMT",449:"EDATE",450:"EOMONTH",451:"YEARFRAC",452:"COUPDAYBS",453:"COUPDAYS",454:"COUPDAYSNC",455:"COUPNCD",456:"COUPNUM",457:"COUPPCD",458:"DURATION",459:"MDURATION",460:"ODDLPRICE",461:"ODDLYIELD",462:"ODDFPRICE",463:"ODDFYIELD",464:"RANDBETWEEN",465:"WEEKNUM",466:"AMORDEGRC",467:"AMORLINC",468:"CONVERT",724:"SHEETJS",469:"ACCRINT",470:"ACCRINTM",471:"WORKDAY",472:"NETWORKDAYS",473:"GCD",474:"MULTINOMIAL",475:"LCM",476:"FVSCHEDULE",477:"CUBEKPIMEMBER",478:"CUBESET",479:"CUBESETCOUNT",480:"IFERROR",481:"COUNTIFS",482:"SUMIFS",483:"AVERAGEIF",484:"AVERAGEIFS"},l3={2:1,3:1,10:0,15:1,16:1,17:1,18:1,19:0,20:1,21:1,22:1,23:1,24:1,25:1,26:1,27:2,30:2,31:3,32:1,33:1,34:0,35:0,38:1,39:2,40:3,41:3,42:3,43:3,44:3,45:3,47:3,48:2,53:1,61:3,63:0,65:3,66:3,67:1,68:1,69:1,70:1,71:1,72:1,73:1,74:0,75:1,76:1,77:1,79:2,80:2,83:1,85:0,86:1,89:0,90:1,94:0,95:0,97:2,98:1,99:1,101:3,102:3,105:1,106:1,108:2,111:1,112:1,113:1,114:1,117:2,118:1,119:4,121:1,126:1,127:1,128:1,129:1,130:1,131:1,133:1,134:1,135:1,136:2,137:2,138:2,140:1,141:1,142:3,143:4,144:4,161:1,162:1,163:1,164:1,165:2,172:1,175:2,176:2,177:3,178:2,179:1,184:1,186:1,189:3,190:1,195:3,196:3,197:1,198:1,199:3,201:1,207:4,210:3,211:1,212:2,213:2,214:1,215:1,225:0,229:1,230:1,231:1,232:1,233:1,234:1,235:3,244:1,247:4,252:2,257:1,261:1,271:1,273:4,274:2,275:2,276:2,277:3,278:3,279:1,280:3,281:3,282:3,283:1,284:1,285:2,286:4,287:3,288:2,289:4,290:3,291:3,292:3,293:4,294:1,295:3,296:1,297:3,298:1,299:2,300:3,301:3,302:4,303:2,304:2,305:2,306:2,307:2,308:2,309:3,310:2,311:2,312:2,313:2,314:2,315:2,316:4,325:2,326:2,327:2,328:2,331:2,332:2,337:2,342:1,343:1,346:2,347:1,350:4,351:3,352:1,353:2,360:1,368:1,369:1,370:1,371:1,372:1,373:1,374:1,375:1,376:1,377:1,378:1,382:3,385:1,392:1,393:1,396:2,397:2,398:2,399:1,400:1,401:1,402:1,403:1,404:1,405:1,406:1,407:1,408:1,409:1,410:1,414:4,415:1,416:1,417:2,420:1,421:1,422:2,424:1,425:2,426:2,427:2,428:2,430:3,438:3,439:3,440:3,443:2,444:2,445:2,446:2,447:6,448:6,449:2,450:2,464:2,468:3,476:2,479:1,480:2,65535:0};function bg(e){return e.slice(0,3)=="of:"&&(e=e.slice(3)),e.charCodeAt(0)==61&&(e=e.slice(1),e.charCodeAt(0)==61&&(e=e.slice(1))),e=e.replace(/COM\.MICROSOFT\./g,""),e=e.replace(/\[((?:\.[A-Z]+[0-9]+)(?::\.[A-Z]+[0-9]+)?)\]/g,function(n,a){return a.replace(/\./g,"")}),e=e.replace(/\[.(#[A-Z]*[?!])\]/g,"$1"),e.replace(/[;~]/g,",").replace(/\|/g,";")}function x0(e){var n=e.split(":"),a=n[0].split(".")[0];return[a,n[0].split(".")[1]+(n.length>1?":"+(n[1].split(".")[1]||n[1].split(".")[0]):"")]}var $c={},gl={};function jc(e,n){if(e){var a=[.7,.7,.75,.75,.3,.3];n=="xlml"&&(a=[1,1,1,1,.5,.5]),e.left==null&&(e.left=a[0]),e.right==null&&(e.right=a[1]),e.top==null&&(e.top=a[2]),e.bottom==null&&(e.bottom=a[3]),e.header==null&&(e.header=a[4]),e.footer==null&&(e.footer=a[5])}}function kx(e,n,a,c,u,m){try{c.cellNF&&(e.z=gr[n])}catch(o){if(c.WTF)throw o}if(!(e.t==="z"&&!c.cellStyles)){if(e.t==="d"&&typeof e.v=="string"&&(e.v=Ga(e.v)),(!c||c.cellText!==!1)&&e.t!=="z")try{if(gr[n]==null&&fo(uT[n]||"General",n),e.t==="e")e.w=e.w||Eo[e.v];else if(n===0)if(e.t==="n")(e.v|0)===e.v?e.w=e.v.toString(10):e.w=Wc(e.v);else if(e.t==="d"){var x=Pi(e.v);(x|0)===x?e.w=x.toString(10):e.w=Wc(x)}else{if(e.v===void 0)return"";e.w=mo(e.v,gl)}else e.t==="d"?e.w=cn(n,Pi(e.v),gl):e.w=cn(n,e.v,gl)}catch(o){if(c.WTF)throw o}if(c.cellStyles&&a!=null)try{e.s=m.Fills[a],e.s.fgColor&&e.s.fgColor.theme&&!e.s.fgColor.rgb&&(e.s.fgColor.rgb=Nh(u.themeElements.clrScheme[e.s.fgColor.theme].rgb,e.s.fgColor.tint||0),c.WTF&&(e.s.fgColor.raw_rgb=u.themeElements.clrScheme[e.s.fgColor.theme].rgb)),e.s.bgColor&&e.s.bgColor.theme&&(e.s.bgColor.rgb=Nh(u.themeElements.clrScheme[e.s.bgColor.theme].rgb,e.s.bgColor.tint||0),c.WTF&&(e.s.bgColor.raw_rgb=u.themeElements.clrScheme[e.s.bgColor.theme].rgb))}catch(o){if(c.WTF&&m.Fills)throw o}}}function c3(e,n){var a=pa(n);a.s.r<=a.e.r&&a.s.c<=a.e.c&&a.s.r>=0&&a.s.c>=0&&(e["!ref"]=Fr(a))}var u3=/<(?:\w:)?mergeCell ref="[A-Z0-9:]+"\s*[\/]?>/g,h3=/<(?:\w+:)?sheetData[^>]*>([\s\S]*)<\/(?:\w+:)?sheetData>/,f3=/<(?:\w:)?hyperlink [^>]*>/mg,d3=/"(\w*:\w*)"/,p3=/<(?:\w:)?col\b[^>]*[\/]?>/g,m3=/<(?:\w:)?autoFilter[^>]*([\/]|>([\s\S]*)<\/(?:\w:)?autoFilter)>/g,g3=/<(?:\w:)?pageMargins[^>]*\/>/g,Cx=/<(?:\w:)?sheetPr\b(?:[^>a-z][^>]*)?\/>/,x3=/<(?:\w:)?sheetPr[^>]*(?:[\/]|>([\s\S]*)<\/(?:\w:)?sheetPr)>/,_3=/<(?:\w:)?sheetViews[^>]*(?:[\/]|>([\s\S]*)<\/(?:\w:)?sheetViews)>/;function y3(e,n,a,c,u,m,x){if(!e)return e;c||(c={"!id":{}});var o=n.dense?[]:{},E={s:{r:2e6,c:2e6},e:{r:0,c:0}},w="",C="",P=e.match(h3);P?(w=e.slice(0,P.index),C=e.slice(P.index+P[0].length)):w=C=e;var M=w.match(Cx);M?gd(M[0],o,u,a):(M=w.match(x3))&&v3(M[0],M[1]||"",o,u,a);var B=(w.match(/<(?:\w*:)?dimension/)||{index:-1}).index;if(B>0){var U=w.slice(B,B+50).match(d3);U&&c3(o,U[1])}var N=w.match(_3);N&&N[1]&&k3(N[1],u);var j=[];if(n.cellStyles){var re=w.match(p3);re&&T3(j,re)}P&&C3(P[1],o,n,E,m,x);var pe=C.match(m3);pe&&(o["!autofilter"]=E3(pe[0]));var X=[],le=C.match(u3);if(le)for(B=0;B!=le.length;++B)X[B]=pa(le[B].slice(le[B].indexOf('"')+1));var ye=C.match(f3);ye&&w3(o,ye,c);var we=C.match(g3);if(we&&(o["!margins"]=b3(nr(we[0]))),!o["!ref"]&&E.e.c>=E.s.c&&E.e.r>=E.s.r&&(o["!ref"]=Fr(E)),n.sheetRows>0&&o["!ref"]){var ae=pa(o["!ref"]);n.sheetRows<=+ae.e.r&&(ae.e.r=n.sheetRows-1,ae.e.r>E.e.r&&(ae.e.r=E.e.r),ae.e.r<ae.s.r&&(ae.s.r=ae.e.r),ae.e.c>E.e.c&&(ae.e.c=E.e.c),ae.e.c<ae.s.c&&(ae.s.c=ae.e.c),o["!fullref"]=o["!ref"],o["!ref"]=Fr(ae))}return j.length>0&&(o["!cols"]=j),X.length>0&&(o["!merges"]=X),o}function gd(e,n,a,c){var u=nr(e);a.Sheets[c]||(a.Sheets[c]={}),u.codeName&&(a.Sheets[c].CodeName=Mr(Xr(u.codeName)))}function v3(e,n,a,c,u){gd(e.slice(0,e.indexOf(">")),a,c,u)}function w3(e,n,a){for(var c=Array.isArray(e),u=0;u!=n.length;++u){var m=nr(Xr(n[u]),!0);if(!m.ref)return;var x=((a||{})["!id"]||[])[m.id];x?(m.Target=x.Target,m.location&&(m.Target+="#"+Mr(m.location))):(m.Target="#"+Mr(m.location),x={Target:m.Target,TargetMode:"Internal"}),m.Rel=x,m.tooltip&&(m.Tooltip=m.tooltip,delete m.tooltip);for(var o=pa(m.ref),E=o.s.r;E<=o.e.r;++E)for(var w=o.s.c;w<=o.e.c;++w){var C=fr({c:w,r:E});c?(e[E]||(e[E]=[]),e[E][w]||(e[E][w]={t:"z",v:void 0}),e[E][w].l=m):(e[C]||(e[C]={t:"z",v:void 0}),e[C].l=m)}}}function b3(e){var n={};return["left","right","top","bottom","header","footer"].forEach(function(a){e[a]&&(n[a]=parseFloat(e[a]))}),n}function T3(e,n){for(var a=!1,c=0;c!=n.length;++c){var u=nr(n[c],!0);u.hidden&&(u.hidden=na(u.hidden));var m=parseInt(u.min,10)-1,x=parseInt(u.max,10)-1;for(u.outlineLevel&&(u.level=+u.outlineLevel||0),delete u.min,delete u.max,u.width=+u.width,!a&&u.width&&(a=!0,pd(u.width)),yl(u);m<=x;)e[m++]=Ja(u)}}function E3(e){var n={ref:(e.match(/ref="([^"]*)"/)||[])[1]};return n}var S3=/<(?:\w:)?sheetView(?:[^>a-z][^>]*)?\/?>/;function k3(e,n){n.Views||(n.Views=[{}]),(e.match(S3)||[]).forEach(function(a,c){var u=nr(a);n.Views[c]||(n.Views[c]={}),+u.zoomScale&&(n.Views[c].zoom=+u.zoomScale),na(u.rightToLeft)&&(n.Views[c].RTL=!0)})}var C3=function(){var e=/<(?:\w+:)?c[ \/>]/,n=/<\/(?:\w+:)?row>/,a=/r=["']([^"']*)["']/,c=/<(?:\w+:)?is>([\S\s]*?)<\/(?:\w+:)?is>/,u=/ref=["']([^"']*)["']/,m=qc("v"),x=qc("f");return function(E,w,C,P,M,B){for(var U=0,N="",j=[],re=[],pe=0,X=0,le=0,ye="",we,ae,ze=0,Ie=0,$e,je,Le=0,it=0,ft=Array.isArray(B.CellXf),ct,xt=[],ht=[],Yt=Array.isArray(w),He=[],Nt={},Ft=!1,ue=!!C.sheetStubs,Te=E.split(n),Ee=0,Se=Te.length;Ee!=Se;++Ee){N=Te[Ee].trim();var Ke=N.length;if(Ke!==0){var pt=0;e:for(U=0;U<Ke;++U)switch(N[U]){case">":if(N[U-1]!="/"){++U;break e}if(C&&C.cellStyles){if(ae=nr(N.slice(pt,U),!0),ze=ae.r!=null?parseInt(ae.r,10):ze+1,Ie=-1,C.sheetRows&&C.sheetRows<ze)continue;Nt={},Ft=!1,ae.ht&&(Ft=!0,Nt.hpt=parseFloat(ae.ht),Nt.hpx=Yc(Nt.hpt)),ae.hidden=="1"&&(Ft=!0,Nt.hidden=!0),ae.outlineLevel!=null&&(Ft=!0,Nt.level=+ae.outlineLevel),Ft&&(He[ze-1]=Nt)}break;case"<":pt=U;break}if(pt>=U)break;if(ae=nr(N.slice(pt,U),!0),ze=ae.r!=null?parseInt(ae.r,10):ze+1,Ie=-1,!(C.sheetRows&&C.sheetRows<ze)){P.s.r>ze-1&&(P.s.r=ze-1),P.e.r<ze-1&&(P.e.r=ze-1),C&&C.cellStyles&&(Nt={},Ft=!1,ae.ht&&(Ft=!0,Nt.hpt=parseFloat(ae.ht),Nt.hpx=Yc(Nt.hpt)),ae.hidden=="1"&&(Ft=!0,Nt.hidden=!0),ae.outlineLevel!=null&&(Ft=!0,Nt.level=+ae.outlineLevel),Ft&&(He[ze-1]=Nt)),j=N.slice(U).split(e);for(var _t=0;_t!=j.length&&j[_t].trim().charAt(0)=="<";++_t);for(j=j.slice(_t),U=0;U!=j.length;++U)if(N=j[U].trim(),N.length!==0){if(re=N.match(a),pe=U,X=0,le=0,N="<c "+(N.slice(0,1)=="<"?">":"")+N,re!=null&&re.length===2){for(pe=0,ye=re[1],X=0;X!=ye.length&&!((le=ye.charCodeAt(X)-64)<1||le>26);++X)pe=26*pe+le;--pe,Ie=pe}else++Ie;for(X=0;X!=N.length&&N.charCodeAt(X)!==62;++X);if(++X,ae=nr(N.slice(0,X),!0),ae.r||(ae.r=fr({r:ze-1,c:Ie})),ye=N.slice(X),we={t:""},(re=ye.match(m))!=null&&re[1]!==""&&(we.v=Mr(re[1])),C.cellFormula){if((re=ye.match(x))!=null&&re[1]!==""){if(we.f=Mr(Xr(re[1])).replace(/\r\n/g,`
`),C.xlfn||(we.f=_g(we.f)),re[0].indexOf('t="array"')>-1)we.F=(ye.match(u)||[])[1],we.F.indexOf(":")>-1&&xt.push([pa(we.F),we.F]);else if(re[0].indexOf('t="shared"')>-1){je=nr(re[0]);var ut=Mr(Xr(re[1]));C.xlfn||(ut=_g(ut)),ht[parseInt(je.si,10)]=[je,ut,ae.r]}}else(re=ye.match(/<f[^>]*\/>/))&&(je=nr(re[0]),ht[je.si]&&(we.f=zC(ht[je.si][1],ht[je.si][2],ae.r)));var tt=Ai(ae.r);for(X=0;X<xt.length;++X)tt.r>=xt[X][0].s.r&&tt.r<=xt[X][0].e.r&&tt.c>=xt[X][0].s.c&&tt.c<=xt[X][0].e.c&&(we.F=xt[X][1])}if(ae.t==null&&we.v===void 0)if(we.f||we.F)we.v=0,we.t="n";else if(ue)we.t="z";else continue;else we.t=ae.t||"n";switch(P.s.c>Ie&&(P.s.c=Ie),P.e.c<Ie&&(P.e.c=Ie),we.t){case"n":if(we.v==""||we.v==null){if(!ue)continue;we.t="z"}else we.v=parseFloat(we.v);break;case"s":if(typeof we.v>"u"){if(!ue)continue;we.t="z"}else $e=$c[parseInt(we.v,10)],we.v=$e.t,we.r=$e.r,C.cellHTML&&(we.h=$e.h);break;case"str":we.t="s",we.v=we.v!=null?Xr(we.v):"",C.cellHTML&&(we.h=ad(we.v));break;case"inlineStr":re=ye.match(c),we.t="s",re!=null&&($e=dd(re[1]))?(we.v=$e.t,C.cellHTML&&(we.h=$e.h)):we.v="";break;case"b":we.v=na(we.v);break;case"d":C.cellDates?we.v=Ga(we.v,1):(we.v=Pi(Ga(we.v,1)),we.t="n");break;case"e":(!C||C.cellText!==!1)&&(we.w=we.v),we.v=Z1[we.v];break}if(Le=it=0,ct=null,ft&&ae.s!==void 0&&(ct=B.CellXf[ae.s],ct!=null&&(ct.numFmtId!=null&&(Le=ct.numFmtId),C.cellStyles&&ct.fillId!=null&&(it=ct.fillId))),kx(we,Le,it,C,M,B),C.cellDates&&ft&&we.t=="n"&&bl(gr[Le])&&(we.t="d",we.v=qh(we.v)),ae.cm&&C.xlmeta){var Zt=(C.xlmeta.Cell||[])[+ae.cm-1];Zt&&Zt.type=="XLDAPR"&&(we.D=!0)}if(Yt){var ge=Ai(ae.r);w[ge.r]||(w[ge.r]=[]),w[ge.r][ge.c]=we}else w[ae.r]=we}}}}He.length>0&&(w["!rows"]=He)}}();function A3(e,n){var a={},c=e.l+n;a.r=e.read_shift(4),e.l+=4;var u=e.read_shift(2);e.l+=1;var m=e.read_shift(1);return e.l=c,m&7&&(a.level=m&7),m&16&&(a.hidden=!0),m&32&&(a.hpt=u/20),a}var I3=To;function F3(){}function P3(e,n){var a={},c=e[e.l];return++e.l,a.above=!(c&64),a.left=!(c&128),e.l+=18,a.name=QT(e),a}function M3(e){var n=un(e);return[n]}function D3(e){var n=bo(e);return[n]}function L3(e){var n=un(e),a=e.read_shift(1);return[n,a,"b"]}function R3(e){var n=bo(e),a=e.read_shift(1);return[n,a,"b"]}function O3(e){var n=un(e),a=e.read_shift(1);return[n,a,"e"]}function B3(e){var n=bo(e),a=e.read_shift(1);return[n,a,"e"]}function z3(e){var n=un(e),a=e.read_shift(4);return[n,a,"s"]}function N3(e){var n=bo(e),a=e.read_shift(4);return[n,a,"s"]}function U3(e){var n=un(e),a=ui(e);return[n,a,"n"]}function Ax(e){var n=bo(e),a=ui(e);return[n,a,"n"]}function V3(e){var n=un(e),a=ud(e);return[n,a,"n"]}function $3(e){var n=bo(e),a=ud(e);return[n,a,"n"]}function j3(e){var n=un(e),a=ld(e);return[n,a,"is"]}function G3(e){var n=un(e),a=fi(e);return[n,a,"str"]}function H3(e){var n=bo(e),a=fi(e);return[n,a,"str"]}function W3(e,n,a){var c=e.l+n,u=un(e);u.r=a["!row"];var m=e.read_shift(1),x=[u,m,"b"];if(a.cellFormula){e.l+=2;var o=Kh(e,c-e.l,a);x[3]=ci(o,null,u,a.supbooks,a)}else e.l=c;return x}function q3(e,n,a){var c=e.l+n,u=un(e);u.r=a["!row"];var m=e.read_shift(1),x=[u,m,"e"];if(a.cellFormula){e.l+=2;var o=Kh(e,c-e.l,a);x[3]=ci(o,null,u,a.supbooks,a)}else e.l=c;return x}function Z3(e,n,a){var c=e.l+n,u=un(e);u.r=a["!row"];var m=ui(e),x=[u,m,"n"];if(a.cellFormula){e.l+=2;var o=Kh(e,c-e.l,a);x[3]=ci(o,null,u,a.supbooks,a)}else e.l=c;return x}function X3(e,n,a){var c=e.l+n,u=un(e);u.r=a["!row"];var m=fi(e),x=[u,m,"str"];if(a.cellFormula){e.l+=2;var o=Kh(e,c-e.l,a);x[3]=ci(o,null,u,a.supbooks,a)}else e.l=c;return x}var K3=To;function Y3(e,n){var a=e.l+n,c=To(e),u=cd(e),m=fi(e),x=fi(e),o=fi(e);e.l=a;var E={rfx:c,relId:u,loc:m,display:o};return x&&(E.Tooltip=x),E}function J3(){}function Q3(e,n,a){var c=e.l+n,u=H1(e),m=e.read_shift(1),x=[u];if(x[2]=m,a.cellFormula){var o=i3(e,c-e.l,a);x[1]=o}else e.l=c;return x}function eA(e,n,a){var c=e.l+n,u=To(e),m=[u];if(a.cellFormula){var x=s3(e,c-e.l,a);m[1]=x,e.l=c}else e.l=c;return m}var tA=["left","right","top","bottom","header","footer"];function rA(e){var n={};return tA.forEach(function(a){n[a]=ui(e)}),n}function aA(e){var n=e.read_shift(2);return e.l+=28,{RTL:n&32}}function iA(){}function nA(){}function sA(e,n,a,c,u,m,x){if(!e)return e;var o=n||{};c||(c={"!id":{}});var E=o.dense?[]:{},w,C={s:{r:2e6,c:2e6},e:{r:0,c:0}},P=!1,M=!1,B,U,N,j,re,pe,X,le,ye,we=[];o.biff=12,o["!row"]=0;var ae=0,ze=!1,Ie=[],$e={},je=o.supbooks||u.supbooks||[[]];if(je.sharedf=$e,je.arrayf=Ie,je.SheetNames=u.SheetNames||u.Sheets.map(function(Yt){return Yt.name}),!o.supbooks&&(o.supbooks=je,u.Names))for(var Le=0;Le<u.Names.length;++Le)je[0][Le+1]=u.Names[Le];var it=[],ft=[],ct=!1;$h[16]={n:"BrtShortReal",f:Ax};var xt;if(cs(e,function(He,Nt,Ft){if(!M)switch(Ft){case 148:w=He;break;case 0:B=He,o.sheetRows&&o.sheetRows<=B.r&&(M=!0),le=Qa(j=B.r),o["!row"]=B.r,(He.hidden||He.hpt||He.level!=null)&&(He.hpt&&(He.hpx=Yc(He.hpt)),ft[He.r]=He);break;case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 13:case 14:case 15:case 16:case 17:case 18:case 62:switch(U={t:He[2]},He[2]){case"n":U.v=He[1];break;case"s":X=$c[He[1]],U.v=X.t,U.r=X.r;break;case"b":U.v=!!He[1];break;case"e":U.v=He[1],o.cellText!==!1&&(U.w=Eo[U.v]);break;case"str":U.t="s",U.v=He[1];break;case"is":U.t="s",U.v=He[1].t;break}if((N=x.CellXf[He[0].iStyleRef])&&kx(U,N.numFmtId,null,o,m,x),re=He[0].c==-1?re+1:He[0].c,o.dense?(E[j]||(E[j]=[]),E[j][re]=U):E[Oa(re)+le]=U,o.cellFormula){for(ze=!1,ae=0;ae<Ie.length;++ae){var ue=Ie[ae];B.r>=ue[0].s.r&&B.r<=ue[0].e.r&&re>=ue[0].s.c&&re<=ue[0].e.c&&(U.F=Fr(ue[0]),ze=!0)}!ze&&He.length>3&&(U.f=He[3])}if(C.s.r>B.r&&(C.s.r=B.r),C.s.c>re&&(C.s.c=re),C.e.r<B.r&&(C.e.r=B.r),C.e.c<re&&(C.e.c=re),o.cellDates&&N&&U.t=="n"&&bl(gr[N.numFmtId])){var Te=co(U.v);Te&&(U.t="d",U.v=new Date(Te.y,Te.m-1,Te.d,Te.H,Te.M,Te.S,Te.u))}xt&&(xt.type=="XLDAPR"&&(U.D=!0),xt=void 0);break;case 1:case 12:if(!o.sheetStubs||P)break;U={t:"z",v:void 0},re=He[0].c==-1?re+1:He[0].c,o.dense?(E[j]||(E[j]=[]),E[j][re]=U):E[Oa(re)+le]=U,C.s.r>B.r&&(C.s.r=B.r),C.s.c>re&&(C.s.c=re),C.e.r<B.r&&(C.e.r=B.r),C.e.c<re&&(C.e.c=re),xt&&(xt.type=="XLDAPR"&&(U.D=!0),xt=void 0);break;case 176:we.push(He);break;case 49:xt=((o.xlmeta||{}).Cell||[])[He-1];break;case 494:var Ee=c["!id"][He.relId];for(Ee?(He.Target=Ee.Target,He.loc&&(He.Target+="#"+He.loc),He.Rel=Ee):He.relId==""&&(He.Target="#"+He.loc),j=He.rfx.s.r;j<=He.rfx.e.r;++j)for(re=He.rfx.s.c;re<=He.rfx.e.c;++re)o.dense?(E[j]||(E[j]=[]),E[j][re]||(E[j][re]={t:"z",v:void 0}),E[j][re].l=He):(pe=fr({c:re,r:j}),E[pe]||(E[pe]={t:"z",v:void 0}),E[pe].l=He);break;case 426:if(!o.cellFormula)break;Ie.push(He),ye=o.dense?E[j][re]:E[Oa(re)+le],ye.f=ci(He[1],C,{r:B.r,c:re},je,o),ye.F=Fr(He[0]);break;case 427:if(!o.cellFormula)break;$e[fr(He[0].s)]=He[1],ye=o.dense?E[j][re]:E[Oa(re)+le],ye.f=ci(He[1],C,{r:B.r,c:re},je,o);break;case 60:if(!o.cellStyles)break;for(;He.e>=He.s;)it[He.e--]={width:He.w/256,hidden:!!(He.flags&1),level:He.level},ct||(ct=!0,pd(He.w/256)),yl(it[He.e+1]);break;case 161:E["!autofilter"]={ref:Fr(He)};break;case 476:E["!margins"]=He;break;case 147:u.Sheets[a]||(u.Sheets[a]={}),He.name&&(u.Sheets[a].CodeName=He.name),(He.above||He.left)&&(E["!outline"]={above:He.above,left:He.left});break;case 137:u.Views||(u.Views=[{}]),u.Views[0]||(u.Views[0]={}),He.RTL&&(u.Views[0].RTL=!0);break;case 485:break;case 64:case 1053:break;case 151:break;case 152:case 175:case 644:case 625:case 562:case 396:case 1112:case 1146:case 471:case 1050:case 649:case 1105:case 589:case 607:case 564:case 1055:case 168:case 174:case 1180:case 499:case 507:case 550:case 171:case 167:case 1177:case 169:case 1181:case 551:case 552:case 661:case 639:case 478:case 537:case 477:case 536:case 1103:case 680:case 1104:case 1024:case 663:case 535:case 678:case 504:case 1043:case 428:case 170:case 3072:case 50:case 2070:case 1045:break;case 35:P=!0;break;case 36:P=!1;break;case 37:P=!0;break;case 38:P=!1;break;default:if(!Nt.T){if(!P||o.WTF)throw new Error("Unexpected record 0x"+Ft.toString(16))}}},o),delete o.supbooks,delete o["!row"],!E["!ref"]&&(C.s.r<2e6||w&&(w.e.r>0||w.e.c>0||w.s.r>0||w.s.c>0))&&(E["!ref"]=Fr(w||C)),o.sheetRows&&E["!ref"]){var ht=pa(E["!ref"]);o.sheetRows<=+ht.e.r&&(ht.e.r=o.sheetRows-1,ht.e.r>C.e.r&&(ht.e.r=C.e.r),ht.e.r<ht.s.r&&(ht.s.r=ht.e.r),ht.e.c>C.e.c&&(ht.e.c=C.e.c),ht.e.c<ht.s.c&&(ht.s.c=ht.e.c),E["!fullref"]=E["!ref"],E["!ref"]=Fr(ht))}return we.length>0&&(E["!merges"]=we),it.length>0&&(E["!cols"]=it),ft.length>0&&(E["!rows"]=ft),E}function oA(e){var n=[],a=e.match(/^<c:numCache>/),c;(e.match(/<c:pt idx="(\d*)">(.*?)<\/c:pt>/mg)||[]).forEach(function(m){var x=m.match(/<c:pt idx="(\d*?)"><c:v>(.*)<\/c:v><\/c:pt>/);x&&(n[+x[1]]=a?+x[2]:x[2])});var u=Mr((e.match(/<c:formatCode>([\s\S]*?)<\/c:formatCode>/)||["","General"])[1]);return(e.match(/<c:f>(.*?)<\/c:f>/mg)||[]).forEach(function(m){c=m.replace(/<.*?>/g,"")}),[n,u,c]}function lA(e,n,a,c,u,m){var x=m||{"!type":"chart"};if(!e)return m;var o=0,E=0,w="A",C={s:{r:2e6,c:2e6},e:{r:0,c:0}};return(e.match(/<c:numCache>[\s\S]*?<\/c:numCache>/gm)||[]).forEach(function(P){var M=oA(P);C.s.r=C.s.c=0,C.e.c=o,w=Oa(o),M[0].forEach(function(B,U){x[w+Qa(U)]={t:"n",v:B,z:M[1]},E=U}),C.e.r<E&&(C.e.r=E),++o}),o>0&&(x["!ref"]=Fr(C)),x}function cA(e,n,a,c,u){if(!e)return e;c||(c={"!id":{}});var m={"!type":"chart","!drawel":null,"!rel":""},x,o=e.match(Cx);return o&&gd(o[0],m,u,a),(x=e.match(/drawing r:id="(.*?)"/))&&(m["!rel"]=x[1]),c["!id"][m["!rel"]]&&(m["!drawel"]=c["!id"][m["!rel"]]),m}function uA(e,n){e.l+=10;var a=fi(e);return{name:a}}function hA(e,n,a,c,u){if(!e)return e;c||(c={"!id":{}});var m={"!type":"chart","!drawel":null,"!rel":""},x=!1;return cs(e,function(E,w,C){switch(C){case 550:m["!rel"]=E;break;case 651:u.Sheets[a]||(u.Sheets[a]={}),E.name&&(u.Sheets[a].CodeName=E.name);break;case 562:case 652:case 669:case 679:case 551:case 552:case 476:case 3072:break;case 35:x=!0;break;case 36:x=!1;break;case 37:break;case 38:break;default:if(!(w.T>0)){if(!(w.T<0)){if(!x||n.WTF)throw new Error("Unexpected record 0x"+C.toString(16))}}}},n),c["!id"][m["!rel"]]&&(m["!drawel"]=c["!id"][m["!rel"]]),m}var Ix=[["allowRefreshQuery",!1,"bool"],["autoCompressPictures",!0,"bool"],["backupFile",!1,"bool"],["checkCompatibility",!1,"bool"],["CodeName",""],["date1904",!1,"bool"],["defaultThemeVersion",0,"int"],["filterPrivacy",!1,"bool"],["hidePivotFieldList",!1,"bool"],["promptedSolutions",!1,"bool"],["publishItems",!1,"bool"],["refreshAllConnections",!1,"bool"],["saveExternalLinkValues",!0,"bool"],["showBorderUnselectedTables",!0,"bool"],["showInkAnnotation",!0,"bool"],["showObjects","all"],["showPivotChartFilter",!1,"bool"],["updateLinks","userSet"]],fA=[["activeTab",0,"int"],["autoFilterDateGrouping",!0,"bool"],["firstSheet",0,"int"],["minimized",!1,"bool"],["showHorizontalScroll",!0,"bool"],["showSheetTabs",!0,"bool"],["showVerticalScroll",!0,"bool"],["tabRatio",600,"int"],["visibility","visible"]],dA=[],pA=[["calcCompleted","true"],["calcMode","auto"],["calcOnSave","true"],["concurrentCalc","true"],["fullCalcOnLoad","false"],["fullPrecision","true"],["iterate","false"],["iterateCount","100"],["iterateDelta","0.001"],["refMode","A1"]];function Tg(e,n){for(var a=0;a!=e.length;++a)for(var c=e[a],u=0;u!=n.length;++u){var m=n[u];if(c[m[0]]==null)c[m[0]]=m[1];else switch(m[2]){case"bool":typeof c[m[0]]=="string"&&(c[m[0]]=na(c[m[0]]));break;case"int":typeof c[m[0]]=="string"&&(c[m[0]]=parseInt(c[m[0]],10));break}}}function Eg(e,n){for(var a=0;a!=n.length;++a){var c=n[a];if(e[c[0]]==null)e[c[0]]=c[1];else switch(c[2]){case"bool":typeof e[c[0]]=="string"&&(e[c[0]]=na(e[c[0]]));break;case"int":typeof e[c[0]]=="string"&&(e[c[0]]=parseInt(e[c[0]],10));break}}}function Fx(e){Eg(e.WBProps,Ix),Eg(e.CalcPr,pA),Tg(e.WBView,fA),Tg(e.Sheets,dA),gl.date1904=na(e.WBProps.date1904)}var mA="][*?/\\".split("");function gA(e,n){if(e.length>31){if(n)return!1;throw new Error("Sheet names cannot exceed 31 chars")}var a=!0;return mA.forEach(function(c){if(e.indexOf(c)!=-1){if(!n)throw new Error("Sheet name cannot contain : \\ / ? * [ ]");a=!1}}),a}var xA=/<\w+:workbook/;function _A(e,n){if(!e)throw new Error("Could not find file");var a={AppVersion:{},WBProps:{},WBView:[],Sheets:[],CalcPr:{},Names:[],xmlns:""},c=!1,u="xmlns",m={},x=0;if(e.replace(pi,function(E,w){var C=nr(E);switch(Nn(C[0])){case"<?xml":break;case"<workbook":E.match(xA)&&(u="xmlns"+E.match(/<(\w+):/)[1]),a.xmlns=C[u];break;case"</workbook>":break;case"<fileVersion":delete C[0],a.AppVersion=C;break;case"<fileVersion/>":case"</fileVersion>":break;case"<fileSharing":break;case"<fileSharing/>":break;case"<workbookPr":case"<workbookPr/>":Ix.forEach(function(P){if(C[P[0]]!=null)switch(P[2]){case"bool":a.WBProps[P[0]]=na(C[P[0]]);break;case"int":a.WBProps[P[0]]=parseInt(C[P[0]],10);break;default:a.WBProps[P[0]]=C[P[0]]}}),C.codeName&&(a.WBProps.CodeName=Xr(C.codeName));break;case"</workbookPr>":break;case"<workbookProtection":break;case"<workbookProtection/>":break;case"<bookViews":case"<bookViews>":case"</bookViews>":break;case"<workbookView":case"<workbookView/>":delete C[0],a.WBView.push(C);break;case"</workbookView>":break;case"<sheets":case"<sheets>":case"</sheets>":break;case"<sheet":switch(C.state){case"hidden":C.Hidden=1;break;case"veryHidden":C.Hidden=2;break;default:C.Hidden=0}delete C.state,C.name=Mr(Xr(C.name)),delete C[0],a.Sheets.push(C);break;case"</sheet>":break;case"<functionGroups":case"<functionGroups/>":break;case"<functionGroup":break;case"<externalReferences":case"</externalReferences>":case"<externalReferences>":break;case"<externalReference":break;case"<definedNames/>":break;case"<definedNames>":case"<definedNames":c=!0;break;case"</definedNames>":c=!1;break;case"<definedName":m={},m.Name=Xr(C.name),C.comment&&(m.Comment=C.comment),C.localSheetId&&(m.Sheet=+C.localSheetId),na(C.hidden||"0")&&(m.Hidden=!0),x=w+E.length;break;case"</definedName>":m.Ref=Mr(Xr(e.slice(x,w))),a.Names.push(m);break;case"<definedName/>":break;case"<calcPr":delete C[0],a.CalcPr=C;break;case"<calcPr/>":delete C[0],a.CalcPr=C;break;case"</calcPr>":break;case"<oleSize":break;case"<customWorkbookViews>":case"</customWorkbookViews>":case"<customWorkbookViews":break;case"<customWorkbookView":case"</customWorkbookView>":break;case"<pivotCaches>":case"</pivotCaches>":case"<pivotCaches":break;case"<pivotCache":break;case"<smartTagPr":case"<smartTagPr/>":break;case"<smartTagTypes":case"<smartTagTypes>":case"</smartTagTypes>":break;case"<smartTagType":break;case"<webPublishing":case"<webPublishing/>":break;case"<fileRecoveryPr":case"<fileRecoveryPr/>":break;case"<webPublishObjects>":case"<webPublishObjects":case"</webPublishObjects>":break;case"<webPublishObject":break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":c=!0;break;case"</ext>":c=!1;break;case"<ArchID":break;case"<AlternateContent":case"<AlternateContent>":c=!0;break;case"</AlternateContent>":c=!1;break;case"<revisionPtr":break;default:if(!c&&n.WTF)throw new Error("unrecognized "+C[0]+" in workbook")}return E}),OT.indexOf(a.xmlns)===-1)throw new Error("Unknown Namespace: "+a.xmlns);return Fx(a),a}function yA(e,n){var a={};return a.Hidden=e.read_shift(4),a.iTabID=e.read_shift(4),a.strRelID=M0(e),a.name=fi(e),a}function vA(e,n){var a={},c=e.read_shift(4);a.defaultThemeVersion=e.read_shift(4);var u=n>8?fi(e):"";return u.length>0&&(a.CodeName=u),a.autoCompressPictures=!!(c&65536),a.backupFile=!!(c&64),a.checkCompatibility=!!(c&4096),a.date1904=!!(c&1),a.filterPrivacy=!!(c&8),a.hidePivotFieldList=!!(c&1024),a.promptedSolutions=!!(c&16),a.publishItems=!!(c&2048),a.refreshAllConnections=!!(c&262144),a.saveExternalLinkValues=!!(c&128),a.showBorderUnselectedTables=!!(c&4),a.showInkAnnotation=!!(c&32),a.showObjects=["all","placeholders","none"][c>>13&3],a.showPivotChartFilter=!!(c&32768),a.updateLinks=["userSet","never","always"][c>>8&3],a}function wA(e,n){var a={};return e.read_shift(4),a.ArchID=e.read_shift(4),e.l+=n-8,a}function bA(e,n,a){var c=e.l+n;e.l+=4,e.l+=1;var u=e.read_shift(4),m=eE(e),x=n3(e,0,a),o=cd(e);e.l=c;var E={Name:m,Ptg:x};return u<268435455&&(E.Sheet=u),o&&(E.Comment=o),E}function TA(e,n){var a={AppVersion:{},WBProps:{},WBView:[],Sheets:[],CalcPr:{},xmlns:""},c=[],u=!1;n||(n={}),n.biff=12;var m=[],x=[[]];return x.SheetNames=[],x.XTI=[],$h[16]={n:"BrtFRTArchID$",f:wA},cs(e,function(E,w,C){switch(C){case 156:x.SheetNames.push(E.name),a.Sheets.push(E);break;case 153:a.WBProps=E;break;case 39:E.Sheet!=null&&(n.SID=E.Sheet),E.Ref=ci(E.Ptg,null,null,x,n),delete n.SID,delete E.Ptg,m.push(E);break;case 1036:break;case 357:case 358:case 355:case 667:x[0].length?x.push([C,E]):x[0]=[C,E],x[x.length-1].XTI=[];break;case 362:x.length===0&&(x[0]=[],x[0].XTI=[]),x[x.length-1].XTI=x[x.length-1].XTI.concat(E),x.XTI=x.XTI.concat(E);break;case 361:break;case 2071:case 158:case 143:case 664:case 353:break;case 3072:case 3073:case 534:case 677:case 157:case 610:case 2050:case 155:case 548:case 676:case 128:case 665:case 2128:case 2125:case 549:case 2053:case 596:case 2076:case 2075:case 2082:case 397:case 154:case 1117:case 553:case 2091:break;case 35:c.push(C),u=!0;break;case 36:c.pop(),u=!1;break;case 37:c.push(C),u=!0;break;case 38:c.pop(),u=!1;break;case 16:break;default:if(!w.T){if(!u||n.WTF&&c[c.length-1]!=37&&c[c.length-1]!=35)throw new Error("Unexpected record 0x"+C.toString(16))}}},n),Fx(a),a.Names=m,a.supbooks=x,a}function EA(e,n,a){return n.slice(-4)===".bin"?TA(e,a):_A(e,a)}function SA(e,n,a,c,u,m,x,o){return n.slice(-4)===".bin"?sA(e,c,a,u,m,x,o):y3(e,c,a,u,m,x,o)}function kA(e,n,a,c,u,m,x,o){return n.slice(-4)===".bin"?hA(e,c,a,u,m):cA(e,c,a,u,m)}function CA(e,n,a,c,u,m,x,o){return n.slice(-4)===".bin"?RC():OC()}function AA(e,n,a,c,u,m,x,o){return n.slice(-4)===".bin"?DC():LC()}function IA(e,n,a,c){return n.slice(-4)===".bin"?Kk(e,a,c):Gk(e,a,c)}function FA(e,n,a){return gx(e,a)}function PA(e,n,a){return n.slice(-4)===".bin"?fk(e,a):uk(e,a)}function MA(e,n,a){return n.slice(-4)===".bin"?FC(e,a):SC(e,a)}function DA(e,n,a){return n.slice(-4)===".bin"?bC(e):vC(e)}function LA(e,n,a,c){return a.slice(-4)===".bin"?TC(e,n,a,c):void 0}function RA(e,n,a){return n.slice(-4)===".bin"?_C(e,n,a):yC(e,n,a)}var Px=/([\w:]+)=((?:")([^"]*)(?:")|(?:')([^']*)(?:'))/g,Mx=/([\w:]+)=((?:")(?:[^"]*)(?:")|(?:')(?:[^']*)(?:'))/;function wn(e,n){var a=e.split(/\s+/),c=[];if(n||(c[0]=a[0]),a.length===1)return c;var u=e.match(Px),m,x,o,E;if(u)for(E=0;E!=u.length;++E)m=u[E].match(Mx),(x=m[1].indexOf(":"))===-1?c[m[1]]=m[2].slice(1,m[2].length-1):(m[1].slice(0,6)==="xmlns:"?o="xmlns"+m[1].slice(6):o=m[1].slice(x+1),c[o]=m[2].slice(1,m[2].length-1));return c}function OA(e){var n=e.split(/\s+/),a={};if(n.length===1)return a;var c=e.match(Px),u,m,x,o;if(c)for(o=0;o!=c.length;++o)u=c[o].match(Mx),(m=u[1].indexOf(":"))===-1?a[u[1]]=u[2].slice(1,u[2].length-1):(u[1].slice(0,6)==="xmlns:"?x="xmlns"+u[1].slice(6):x=u[1].slice(m+1),a[x]=u[2].slice(1,u[2].length-1));return a}var Gc;function BA(e,n){var a=Gc[e]||Mr(e);return a==="General"?mo(n):cn(a,n)}function zA(e,n,a,c){var u=c;switch((a[0].match(/dt:dt="([\w.]+)"/)||["",""])[1]){case"boolean":u=na(c);break;case"i2":case"int":u=parseInt(c,10);break;case"r4":case"float":u=parseFloat(c);break;case"date":case"dateTime.tz":u=Ga(c);break;case"i8":case"string":case"fixed":case"uuid":case"bin.base64":break;default:throw new Error("bad custprop:"+a[0])}e[Mr(n)]=u}function NA(e,n,a){if(e.t!=="z"){if(!a||a.cellText!==!1)try{e.t==="e"?e.w=e.w||Eo[e.v]:n==="General"?e.t==="n"?(e.v|0)===e.v?e.w=e.v.toString(10):e.w=Wc(e.v):e.w=mo(e.v):e.w=BA(n||"General",e.v)}catch(m){if(a.WTF)throw m}try{var c=Gc[n]||n||"General";if(a.cellNF&&(e.z=c),a.cellDates&&e.t=="n"&&bl(c)){var u=co(e.v);u&&(e.t="d",e.v=new Date(u.y,u.m-1,u.d,u.H,u.M,u.S,u.u))}}catch(m){if(a.WTF)throw m}}}function UA(e,n,a){if(a.cellStyles&&n.Interior){var c=n.Interior;c.Pattern&&(c.patternType=zk[c.Pattern]||c.Pattern)}e[n.ID]=n}function VA(e,n,a,c,u,m,x,o,E,w){var C="General",P=c.StyleID,M={};w=w||{};var B=[],U=0;for(P===void 0&&o&&(P=o.StyleID),P===void 0&&x&&(P=x.StyleID);m[P]!==void 0&&(m[P].nf&&(C=m[P].nf),m[P].Interior&&B.push(m[P].Interior),!!m[P].Parent);)P=m[P].Parent;switch(a.Type){case"Boolean":c.t="b",c.v=na(e);break;case"String":c.t="s",c.r=Wm(Mr(e)),c.v=e.indexOf("<")>-1?Mr(n||e).replace(/<.*?>/g,""):c.r;break;case"DateTime":e.slice(-1)!="Z"&&(e+="Z"),c.v=(Ga(e)-new Date(Date.UTC(1899,11,30)))/(24*60*60*1e3),c.v!==c.v?c.v=Mr(e):c.v<60&&(c.v=c.v-1),(!C||C=="General")&&(C="yyyy-mm-dd");case"Number":c.v===void 0&&(c.v=+e),c.t||(c.t="n");break;case"Error":c.t="e",c.v=Z1[e],w.cellText!==!1&&(c.w=e);break;default:e==""&&n==""?c.t="z":(c.t="s",c.v=Wm(n||e));break}if(NA(c,C,w),w.cellFormula!==!1)if(c.Formula){var N=Mr(c.Formula);N.charCodeAt(0)==61&&(N=N.slice(1)),c.f=ml(N,u),delete c.Formula,c.ArrayRange=="RC"?c.F=ml("RC:RC",u):c.ArrayRange&&(c.F=ml(c.ArrayRange,u),E.push([pa(c.F),c.F]))}else for(U=0;U<E.length;++U)u.r>=E[U][0].s.r&&u.r<=E[U][0].e.r&&u.c>=E[U][0].s.c&&u.c<=E[U][0].e.c&&(c.F=E[U][1]);w.cellStyles&&(B.forEach(function(j){!M.patternType&&j.patternType&&(M.patternType=j.patternType)}),c.s=M),c.StyleID!==void 0&&(c.ixfe=c.StyleID)}function $A(e){e.t=e.v||"",e.t=e.t.replace(/\r\n/g,`
`).replace(/\r/g,`
`),e.v=e.w=e.ixfe=void 0}function _0(e,n){var a=n||{};y1();var c=Mc(id(e));(a.type=="binary"||a.type=="array"||a.type=="base64")&&(c=Xr(c));var u=c.slice(0,1024).toLowerCase(),m=!1;if(u=u.replace(/".*?"/g,""),(u.indexOf(">")&1023)>Math.min(u.indexOf(",")&1023,u.indexOf(";")&1023)){var x=Ja(a);return x.type="string",Xc.to_workbook(c,x)}if(u.indexOf("<?xml")==-1&&["html","table","head","meta","script","style","div"].forEach(function(cr){u.indexOf("<"+cr)>=0&&(m=!0)}),m)return YA(c,a);Gc={"General Number":"General","General Date":gr[22],"Long Date":"dddd, mmmm dd, yyyy","Medium Date":gr[15],"Short Date":gr[14],"Long Time":gr[19],"Medium Time":gr[18],"Short Time":gr[20],Currency:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',Fixed:gr[2],Standard:gr[4],Percent:gr[10],Scientific:gr[11],"Yes/No":'"Yes";"Yes";"No";@',"True/False":'"True";"True";"False";@',"On/Off":'"Yes";"Yes";"No";@'};var o,E=[],w,C={},P=[],M=a.dense?[]:{},B="",U={},N={},j=wn('<Data ss:Type="String">'),re=0,pe=0,X=0,le={s:{r:2e6,c:2e6},e:{r:0,c:0}},ye={},we={},ae="",ze=0,Ie=[],$e={},je={},Le=0,it=[],ft=[],ct={},xt=[],ht,Yt=!1,He=[],Nt=[],Ft={},ue=0,Te=0,Ee={Sheets:[],WBProps:{date1904:!1}},Se={};Zc.lastIndex=0,c=c.replace(/<!--([\s\S]*?)-->/mg,"");for(var Ke="";o=Zc.exec(c);)switch(o[3]=(Ke=o[3]).toLowerCase()){case"data":if(Ke=="data"){if(o[1]==="/"){if((w=E.pop())[0]!==o[3])throw new Error("Bad state: "+w.join("|"))}else o[0].charAt(o[0].length-2)!=="/"&&E.push([o[3],!0]);break}if(E[E.length-1][1])break;o[1]==="/"?VA(c.slice(re,o.index),ae,j,E[E.length-1][0]=="comment"?ct:U,{c:pe,r:X},ye,xt[pe],N,He,a):(ae="",j=wn(o[0]),re=o.index+o[0].length);break;case"cell":if(o[1]==="/")if(ft.length>0&&(U.c=ft),(!a.sheetRows||a.sheetRows>X)&&U.v!==void 0&&(a.dense?(M[X]||(M[X]=[]),M[X][pe]=U):M[Oa(pe)+Qa(X)]=U),U.HRef&&(U.l={Target:Mr(U.HRef)},U.HRefScreenTip&&(U.l.Tooltip=U.HRefScreenTip),delete U.HRef,delete U.HRefScreenTip),(U.MergeAcross||U.MergeDown)&&(ue=pe+(parseInt(U.MergeAcross,10)|0),Te=X+(parseInt(U.MergeDown,10)|0),Ie.push({s:{c:pe,r:X},e:{c:ue,r:Te}})),!a.sheetStubs)U.MergeAcross?pe=ue+1:++pe;else if(U.MergeAcross||U.MergeDown){for(var pt=pe;pt<=ue;++pt)for(var _t=X;_t<=Te;++_t)(pt>pe||_t>X)&&(a.dense?(M[_t]||(M[_t]=[]),M[_t][pt]={t:"z"}):M[Oa(pt)+Qa(_t)]={t:"z"});pe=ue+1}else++pe;else U=OA(o[0]),U.Index&&(pe=+U.Index-1),pe<le.s.c&&(le.s.c=pe),pe>le.e.c&&(le.e.c=pe),o[0].slice(-2)==="/>"&&++pe,ft=[];break;case"row":o[1]==="/"||o[0].slice(-2)==="/>"?(X<le.s.r&&(le.s.r=X),X>le.e.r&&(le.e.r=X),o[0].slice(-2)==="/>"&&(N=wn(o[0]),N.Index&&(X=+N.Index-1)),pe=0,++X):(N=wn(o[0]),N.Index&&(X=+N.Index-1),Ft={},(N.AutoFitHeight=="0"||N.Height)&&(Ft.hpx=parseInt(N.Height,10),Ft.hpt=mx(Ft.hpx),Nt[X]=Ft),N.Hidden=="1"&&(Ft.hidden=!0,Nt[X]=Ft));break;case"worksheet":if(o[1]==="/"){if((w=E.pop())[0]!==o[3])throw new Error("Bad state: "+w.join("|"));P.push(B),le.s.r<=le.e.r&&le.s.c<=le.e.c&&(M["!ref"]=Fr(le),a.sheetRows&&a.sheetRows<=le.e.r&&(M["!fullref"]=M["!ref"],le.e.r=a.sheetRows-1,M["!ref"]=Fr(le))),Ie.length&&(M["!merges"]=Ie),xt.length>0&&(M["!cols"]=xt),Nt.length>0&&(M["!rows"]=Nt),C[B]=M}else le={s:{r:2e6,c:2e6},e:{r:0,c:0}},X=pe=0,E.push([o[3],!1]),w=wn(o[0]),B=Mr(w.Name),M=a.dense?[]:{},Ie=[],He=[],Nt=[],Se={name:B,Hidden:0},Ee.Sheets.push(Se);break;case"table":if(o[1]==="/"){if((w=E.pop())[0]!==o[3])throw new Error("Bad state: "+w.join("|"))}else{if(o[0].slice(-2)=="/>")break;E.push([o[3],!1]),xt=[],Yt=!1}break;case"style":o[1]==="/"?UA(ye,we,a):we=wn(o[0]);break;case"numberformat":we.nf=Mr(wn(o[0]).Format||"General"),Gc[we.nf]&&(we.nf=Gc[we.nf]);for(var ut=0;ut!=392&&gr[ut]!=we.nf;++ut);if(ut==392){for(ut=57;ut!=392;++ut)if(gr[ut]==null){fo(we.nf,ut);break}}break;case"column":if(E[E.length-1][0]!=="table")break;if(ht=wn(o[0]),ht.Hidden&&(ht.hidden=!0,delete ht.Hidden),ht.Width&&(ht.wpx=parseInt(ht.Width,10)),!Yt&&ht.wpx>10){Yt=!0,ki=dx;for(var tt=0;tt<xt.length;++tt)xt[tt]&&yl(xt[tt])}Yt&&yl(ht),xt[ht.Index-1||xt.length]=ht;for(var Zt=0;Zt<+ht.Span;++Zt)xt[xt.length]=Ja(ht);break;case"namedrange":if(o[1]==="/")break;Ee.Names||(Ee.Names=[]);var ge=nr(o[0]),Qt={Name:ge.Name,Ref:ml(ge.RefersTo.slice(1),{r:0,c:0})};Ee.Sheets.length>0&&(Qt.Sheet=Ee.Sheets.length-1),Ee.Names.push(Qt);break;case"namedcell":break;case"b":break;case"i":break;case"u":break;case"s":break;case"em":break;case"h2":break;case"h3":break;case"sub":break;case"sup":break;case"span":break;case"alignment":break;case"borders":break;case"border":break;case"font":if(o[0].slice(-2)==="/>")break;o[1]==="/"?ae+=c.slice(ze,o.index):ze=o.index+o[0].length;break;case"interior":if(!a.cellStyles)break;we.Interior=wn(o[0]);break;case"protection":break;case"author":case"title":case"description":case"created":case"keywords":case"subject":case"category":case"company":case"lastauthor":case"lastsaved":case"lastprinted":case"version":case"revision":case"totaltime":case"hyperlinkbase":case"manager":case"contentstatus":case"identifier":case"language":case"appname":if(o[0].slice(-2)==="/>")break;o[1]==="/"?SE($e,Ke,c.slice(Le,o.index)):Le=o.index+o[0].length;break;case"paragraphs":break;case"styles":case"workbook":if(o[1]==="/"){if((w=E.pop())[0]!==o[3])throw new Error("Bad state: "+w.join("|"))}else E.push([o[3],!1]);break;case"comment":if(o[1]==="/"){if((w=E.pop())[0]!==o[3])throw new Error("Bad state: "+w.join("|"));$A(ct),ft.push(ct)}else E.push([o[3],!1]),w=wn(o[0]),ct={a:w.Author};break;case"autofilter":if(o[1]==="/"){if((w=E.pop())[0]!==o[3])throw new Error("Bad state: "+w.join("|"))}else if(o[0].charAt(o[0].length-2)!=="/"){var Xt=wn(o[0]);M["!autofilter"]={ref:ml(Xt.Range).replace(/\$/g,"")},E.push([o[3],!0])}break;case"name":break;case"datavalidation":if(o[1]==="/"){if((w=E.pop())[0]!==o[3])throw new Error("Bad state: "+w.join("|"))}else o[0].charAt(o[0].length-2)!=="/"&&E.push([o[3],!0]);break;case"pixelsperinch":break;case"componentoptions":case"documentproperties":case"customdocumentproperties":case"officedocumentsettings":case"pivottable":case"pivotcache":case"names":case"mapinfo":case"pagebreaks":case"querytable":case"sorting":case"schema":case"conditionalformatting":case"smarttagtype":case"smarttags":case"excelworkbook":case"workbookoptions":case"worksheetoptions":if(o[1]==="/"){if((w=E.pop())[0]!==o[3])throw new Error("Bad state: "+w.join("|"))}else o[0].charAt(o[0].length-2)!=="/"&&E.push([o[3],!0]);break;case"null":break;default:if(E.length==0&&o[3]=="document"||E.length==0&&o[3]=="uof")return Fg(c,a);var or=!0;switch(E[E.length-1][0]){case"officedocumentsettings":switch(o[3]){case"allowpng":break;case"removepersonalinformation":break;case"downloadcomponents":break;case"locationofcomponents":break;case"colors":break;case"color":break;case"index":break;case"rgb":break;case"targetscreensize":break;case"readonlyrecommended":break;default:or=!1}break;case"componentoptions":switch(o[3]){case"toolbar":break;case"hideofficelogo":break;case"spreadsheetautofit":break;case"label":break;case"caption":break;case"maxheight":break;case"maxwidth":break;case"nextsheetnumber":break;default:or=!1}break;case"excelworkbook":switch(o[3]){case"date1904":Ee.WBProps.date1904=!0;break;case"windowheight":break;case"windowwidth":break;case"windowtopx":break;case"windowtopy":break;case"tabratio":break;case"protectstructure":break;case"protectwindow":break;case"protectwindows":break;case"activesheet":break;case"displayinknotes":break;case"firstvisiblesheet":break;case"supbook":break;case"sheetname":break;case"sheetindex":break;case"sheetindexfirst":break;case"sheetindexlast":break;case"dll":break;case"acceptlabelsinformulas":break;case"donotsavelinkvalues":break;case"iteration":break;case"maxiterations":break;case"maxchange":break;case"path":break;case"xct":break;case"count":break;case"selectedsheets":break;case"calculation":break;case"uncalced":break;case"startupprompt":break;case"crn":break;case"externname":break;case"formula":break;case"colfirst":break;case"collast":break;case"wantadvise":break;case"boolean":break;case"error":break;case"text":break;case"ole":break;case"noautorecover":break;case"publishobjects":break;case"donotcalculatebeforesave":break;case"number":break;case"refmoder1c1":break;case"embedsavesmarttags":break;default:or=!1}break;case"workbookoptions":switch(o[3]){case"owcversion":break;case"height":break;case"width":break;default:or=!1}break;case"worksheetoptions":switch(o[3]){case"visible":if(o[0].slice(-2)!=="/>")if(o[1]==="/")switch(c.slice(Le,o.index)){case"SheetHidden":Se.Hidden=1;break;case"SheetVeryHidden":Se.Hidden=2;break}else Le=o.index+o[0].length;break;case"header":M["!margins"]||jc(M["!margins"]={},"xlml"),isNaN(+nr(o[0]).Margin)||(M["!margins"].header=+nr(o[0]).Margin);break;case"footer":M["!margins"]||jc(M["!margins"]={},"xlml"),isNaN(+nr(o[0]).Margin)||(M["!margins"].footer=+nr(o[0]).Margin);break;case"pagemargins":var Jt=nr(o[0]);M["!margins"]||jc(M["!margins"]={},"xlml"),isNaN(+Jt.Top)||(M["!margins"].top=+Jt.Top),isNaN(+Jt.Left)||(M["!margins"].left=+Jt.Left),isNaN(+Jt.Right)||(M["!margins"].right=+Jt.Right),isNaN(+Jt.Bottom)||(M["!margins"].bottom=+Jt.Bottom);break;case"displayrighttoleft":Ee.Views||(Ee.Views=[]),Ee.Views[0]||(Ee.Views[0]={}),Ee.Views[0].RTL=!0;break;case"freezepanes":break;case"frozennosplit":break;case"splithorizontal":case"splitvertical":break;case"donotdisplaygridlines":break;case"activerow":break;case"activecol":break;case"toprowbottompane":break;case"leftcolumnrightpane":break;case"unsynced":break;case"print":break;case"printerrors":break;case"panes":break;case"scale":break;case"pane":break;case"number":break;case"layout":break;case"pagesetup":break;case"selected":break;case"protectobjects":break;case"enableselection":break;case"protectscenarios":break;case"validprinterinfo":break;case"horizontalresolution":break;case"verticalresolution":break;case"numberofcopies":break;case"activepane":break;case"toprowvisible":break;case"leftcolumnvisible":break;case"fittopage":break;case"rangeselection":break;case"papersizeindex":break;case"pagelayoutzoom":break;case"pagebreakzoom":break;case"filteron":break;case"fitwidth":break;case"fitheight":break;case"commentslayout":break;case"zoom":break;case"lefttoright":break;case"gridlines":break;case"allowsort":break;case"allowfilter":break;case"allowinsertrows":break;case"allowdeleterows":break;case"allowinsertcols":break;case"allowdeletecols":break;case"allowinserthyperlinks":break;case"allowformatcells":break;case"allowsizecols":break;case"allowsizerows":break;case"nosummaryrowsbelowdetail":M["!outline"]||(M["!outline"]={}),M["!outline"].above=!0;break;case"tabcolorindex":break;case"donotdisplayheadings":break;case"showpagelayoutzoom":break;case"nosummarycolumnsrightdetail":M["!outline"]||(M["!outline"]={}),M["!outline"].left=!0;break;case"blackandwhite":break;case"donotdisplayzeros":break;case"displaypagebreak":break;case"rowcolheadings":break;case"donotdisplayoutline":break;case"noorientation":break;case"allowusepivottables":break;case"zeroheight":break;case"viewablerange":break;case"selection":break;case"protectcontents":break;default:or=!1}break;case"pivottable":case"pivotcache":switch(o[3]){case"immediateitemsondrop":break;case"showpagemultipleitemlabel":break;case"compactrowindent":break;case"location":break;case"pivotfield":break;case"orientation":break;case"layoutform":break;case"layoutsubtotallocation":break;case"layoutcompactrow":break;case"position":break;case"pivotitem":break;case"datatype":break;case"datafield":break;case"sourcename":break;case"parentfield":break;case"ptlineitems":break;case"ptlineitem":break;case"countofsameitems":break;case"item":break;case"itemtype":break;case"ptsource":break;case"cacheindex":break;case"consolidationreference":break;case"filename":break;case"reference":break;case"nocolumngrand":break;case"norowgrand":break;case"blanklineafteritems":break;case"hidden":break;case"subtotal":break;case"basefield":break;case"mapchilditems":break;case"function":break;case"refreshonfileopen":break;case"printsettitles":break;case"mergelabels":break;case"defaultversion":break;case"refreshname":break;case"refreshdate":break;case"refreshdatecopy":break;case"versionlastrefresh":break;case"versionlastupdate":break;case"versionupdateablemin":break;case"versionrefreshablemin":break;case"calculation":break;default:or=!1}break;case"pagebreaks":switch(o[3]){case"colbreaks":break;case"colbreak":break;case"rowbreaks":break;case"rowbreak":break;case"colstart":break;case"colend":break;case"rowend":break;default:or=!1}break;case"autofilter":switch(o[3]){case"autofiltercolumn":break;case"autofiltercondition":break;case"autofilterand":break;case"autofilteror":break;default:or=!1}break;case"querytable":switch(o[3]){case"id":break;case"autoformatfont":break;case"autoformatpattern":break;case"querysource":break;case"querytype":break;case"enableredirections":break;case"refreshedinxl9":break;case"urlstring":break;case"htmltables":break;case"connection":break;case"commandtext":break;case"refreshinfo":break;case"notitles":break;case"nextid":break;case"columninfo":break;case"overwritecells":break;case"donotpromptforfile":break;case"textwizardsettings":break;case"source":break;case"number":break;case"decimal":break;case"thousandseparator":break;case"trailingminusnumbers":break;case"formatsettings":break;case"fieldtype":break;case"delimiters":break;case"tab":break;case"comma":break;case"autoformatname":break;case"versionlastedit":break;case"versionlastrefresh":break;default:or=!1}break;case"datavalidation":switch(o[3]){case"range":break;case"type":break;case"min":break;case"max":break;case"sort":break;case"descending":break;case"order":break;case"casesensitive":break;case"value":break;case"errorstyle":break;case"errormessage":break;case"errortitle":break;case"inputmessage":break;case"inputtitle":break;case"combohide":break;case"inputhide":break;case"condition":break;case"qualifier":break;case"useblank":break;case"value1":break;case"value2":break;case"format":break;case"cellrangelist":break;default:or=!1}break;case"sorting":case"conditionalformatting":switch(o[3]){case"range":break;case"type":break;case"min":break;case"max":break;case"sort":break;case"descending":break;case"order":break;case"casesensitive":break;case"value":break;case"errorstyle":break;case"errormessage":break;case"errortitle":break;case"cellrangelist":break;case"inputmessage":break;case"inputtitle":break;case"combohide":break;case"inputhide":break;case"condition":break;case"qualifier":break;case"useblank":break;case"value1":break;case"value2":break;case"format":break;default:or=!1}break;case"mapinfo":case"schema":case"data":switch(o[3]){case"map":break;case"entry":break;case"range":break;case"xpath":break;case"field":break;case"xsdtype":break;case"filteron":break;case"aggregate":break;case"elementtype":break;case"attributetype":break;case"schema":case"element":case"complextype":case"datatype":case"all":case"attribute":case"extends":break;case"row":break;default:or=!1}break;case"smarttags":break;default:or=!1;break}if(or||o[3].match(/!\[CDATA/))break;if(!E[E.length-1][1])throw"Unrecognized tag: "+o[3]+"|"+E.join("|");if(E[E.length-1][0]==="customdocumentproperties"){if(o[0].slice(-2)==="/>")break;o[1]==="/"?zA(je,Ke,it,c.slice(Le,o.index)):(it=o,Le=o.index+o[0].length);break}if(a.WTF)throw"Unrecognized tag: "+o[3]+"|"+E.join("|")}var wt={};return!a.bookSheets&&!a.bookProps&&(wt.Sheets=C),wt.SheetNames=P,wt.Workbook=Ee,wt.SSF=Ja(gr),wt.Props=$e,wt.Custprops=je,wt}function O0(e,n){switch(yd(n=n||{}),n.type||"base64"){case"base64":return _0(Zi(e),n);case"binary":case"buffer":case"file":return _0(e,n);case"array":return _0(wo(e),n)}}function jA(e){var n={},a=e.content;if(a.l=28,n.AnsiUserType=a.read_shift(0,"lpstr-ansi"),n.AnsiClipboardFormat=aE(a),a.length-a.l<=4)return n;var c=a.read_shift(4);if(c==0||c>40||(a.l-=4,n.Reserved1=a.read_shift(0,"lpstr-ansi"),a.length-a.l<=4)||(c=a.read_shift(4),c!==1907505652)||(n.UnicodeClipboardFormat=iE(a),c=a.read_shift(4),c==0||c>40))return n;a.l-=4,n.Reserved2=a.read_shift(0,"lpwstr")}var GA=[60,1084,2066,2165,2175];function HA(e,n,a,c,u){var m=c,x=[],o=a.slice(a.l,a.l+m);if(u&&u.enc&&u.enc.insitu&&o.length>0)switch(e){case 9:case 521:case 1033:case 2057:case 47:case 405:case 225:case 406:case 312:case 404:case 10:break;case 133:break;default:u.enc.insitu(o)}x.push(o),a.l+=m;for(var E=ns(a,a.l),w=B0[E],C=0;w!=null&&GA.indexOf(E)>-1;)m=ns(a,a.l+2),C=a.l+4,E==2066?C+=4:(E==2165||E==2175)&&(C+=12),o=a.slice(C,a.l+4+m),x.push(o),a.l+=4+m,w=B0[E=ns(a,a.l)];var P=Ps(x);Ya(P,0);var M=0;P.lens=[];for(var B=0;B<x.length;++B)P.lens.push(M),M+=x[B].length;if(P.length<c)throw"XLS Record 0x"+e.toString(16)+" Truncated: "+P.length+" < "+c;return n.f(P,P.length,u)}function On(e,n,a){if(e.t!=="z"&&e.XF){var c=0;try{c=e.z||e.XF.numFmtId||0,n.cellNF&&(e.z=gr[c])}catch(m){if(n.WTF)throw m}if(!n||n.cellText!==!1)try{e.t==="e"?e.w=e.w||Eo[e.v]:c===0||c=="General"?e.t==="n"?(e.v|0)===e.v?e.w=e.v.toString(10):e.w=Wc(e.v):e.w=mo(e.v):e.w=cn(c,e.v,{date1904:!!a,dateNF:n&&n.dateNF})}catch(m){if(n.WTF)throw m}if(n.cellDates&&c&&e.t=="n"&&bl(gr[c]||String(c))){var u=co(e.v);u&&(e.t="d",e.v=new Date(u.y,u.m-1,u.d,u.H,u.M,u.S,u.u))}}}function Sh(e,n,a){return{v:e,ixfe:n,t:a}}function WA(e,n){var a={opts:{}},c={},u=n.dense?[]:{},m={},x={},o=null,E=[],w="",C={},P,M="",B,U,N,j,re={},pe=[],X,le,ye=[],we=[],ae={Sheets:[],WBProps:{date1904:!1},Views:[{}]},ze={},Ie=function(Ht){return Ht<8?po[Ht]:Ht<64&&we[Ht-8]||po[Ht]},$e=function(Ht,br,ot){var Pt=br.XF.data;if(!(!Pt||!Pt.patternType||!ot||!ot.cellStyles)){br.s={},br.s.patternType=Pt.patternType;var Mt;(Mt=Kc(Ie(Pt.icvFore)))&&(br.s.fgColor={rgb:Mt}),(Mt=Kc(Ie(Pt.icvBack)))&&(br.s.bgColor={rgb:Mt})}},je=function(Ht,br,ot){if(!(Ft>1)&&!(ot.sheetRows&&Ht.r>=ot.sheetRows)){if(ot.cellStyles&&br.XF&&br.XF.data&&$e(Ht,br,ot),delete br.ixfe,delete br.XF,P=Ht,M=fr(Ht),(!x||!x.s||!x.e)&&(x={s:{r:0,c:0},e:{r:0,c:0}}),Ht.r<x.s.r&&(x.s.r=Ht.r),Ht.c<x.s.c&&(x.s.c=Ht.c),Ht.r+1>x.e.r&&(x.e.r=Ht.r+1),Ht.c+1>x.e.c&&(x.e.c=Ht.c+1),ot.cellFormula&&br.f){for(var Pt=0;Pt<pe.length;++Pt)if(!(pe[Pt][0].s.c>Ht.c||pe[Pt][0].s.r>Ht.r)&&!(pe[Pt][0].e.c<Ht.c||pe[Pt][0].e.r<Ht.r)){br.F=Fr(pe[Pt][0]),(pe[Pt][0].s.c!=Ht.c||pe[Pt][0].s.r!=Ht.r)&&delete br.f,br.f&&(br.f=""+ci(pe[Pt][1],x,Ht,He,Le));break}}ot.dense?(u[Ht.r]||(u[Ht.r]=[]),u[Ht.r][Ht.c]=br):u[M]=br}},Le={enc:!1,sbcch:0,snames:[],sharedf:re,arrayf:pe,rrtabid:[],lastuser:"",biff:8,codepage:0,winlocked:0,cellStyles:!!n&&!!n.cellStyles,WTF:!!n&&!!n.wtf};n.password&&(Le.password=n.password);var it,ft=[],ct=[],xt=[],ht=[],Yt=!1,He=[];He.SheetNames=Le.snames,He.sharedf=Le.sharedf,He.arrayf=Le.arrayf,He.names=[],He.XTI=[];var Nt=0,Ft=0,ue=0,Te=[],Ee=[],Se;Le.codepage=1200,En(1200);for(var Ke=!1;e.l<e.length-1;){var pt=e.l,_t=e.read_shift(2);if(_t===0&&Nt===10)break;var ut=e.l===e.length?0:e.read_shift(2),tt=B0[_t];if(tt&&tt.f){if(n.bookSheets&&Nt===133&&_t!==133)break;if(Nt=_t,tt.r===2||tt.r==12){var Zt=e.read_shift(2);if(ut-=2,!Le.enc&&Zt!==_t&&((Zt&255)<<8|Zt>>8)!==_t)throw new Error("rt mismatch: "+Zt+"!="+_t);tt.r==12&&(e.l+=10,ut-=10)}var ge={};if(_t===10?ge=tt.f(e,ut,Le):ge=HA(_t,tt,e,ut,Le),Ft==0&&[9,521,1033,2057].indexOf(Nt)===-1)continue;switch(_t){case 34:a.opts.Date1904=ae.WBProps.date1904=ge;break;case 134:a.opts.WriteProtect=!0;break;case 47:if(Le.enc||(e.l=0),Le.enc=ge,!n.password)throw new Error("File is password-protected");if(ge.valid==null)throw new Error("Encryption scheme unsupported");if(!ge.valid)throw new Error("Password is incorrect");break;case 92:Le.lastuser=ge;break;case 66:var Qt=Number(ge);switch(Qt){case 21010:Qt=1200;break;case 32768:Qt=1e4;break;case 32769:Qt=1252;break}En(Le.codepage=Qt),Ke=!0;break;case 317:Le.rrtabid=ge;break;case 25:Le.winlocked=ge;break;case 439:a.opts.RefreshAll=ge;break;case 12:a.opts.CalcCount=ge;break;case 16:a.opts.CalcDelta=ge;break;case 17:a.opts.CalcIter=ge;break;case 13:a.opts.CalcMode=ge;break;case 14:a.opts.CalcPrecision=ge;break;case 95:a.opts.CalcSaveRecalc=ge;break;case 15:Le.CalcRefMode=ge;break;case 2211:a.opts.FullCalc=ge;break;case 129:ge.fDialog&&(u["!type"]="dialog"),ge.fBelow||((u["!outline"]||(u["!outline"]={})).above=!0),ge.fRight||((u["!outline"]||(u["!outline"]={})).left=!0);break;case 224:ye.push(ge);break;case 430:He.push([ge]),He[He.length-1].XTI=[];break;case 35:case 547:He[He.length-1].push(ge);break;case 24:case 536:Se={Name:ge.Name,Ref:ci(ge.rgce,x,null,He,Le)},ge.itab>0&&(Se.Sheet=ge.itab-1),He.names.push(Se),He[0]||(He[0]=[],He[0].XTI=[]),He[He.length-1].push(ge),ge.Name=="_xlnm._FilterDatabase"&&ge.itab>0&&ge.rgce&&ge.rgce[0]&&ge.rgce[0][0]&&ge.rgce[0][0][0]=="PtgArea3d"&&(Ee[ge.itab-1]={ref:Fr(ge.rgce[0][0][1][2])});break;case 22:Le.ExternCount=ge;break;case 23:He.length==0&&(He[0]=[],He[0].XTI=[]),He[He.length-1].XTI=He[He.length-1].XTI.concat(ge),He.XTI=He.XTI.concat(ge);break;case 2196:if(Le.biff<8)break;Se!=null&&(Se.Comment=ge[1]);break;case 18:u["!protect"]=ge;break;case 19:ge!==0&&Le.WTF&&console.error("Password verifier: "+ge);break;case 133:m[ge.pos]=ge,Le.snames.push(ge.name);break;case 10:{if(--Ft)break;if(x.e){if(x.e.r>0&&x.e.c>0){if(x.e.r--,x.e.c--,u["!ref"]=Fr(x),n.sheetRows&&n.sheetRows<=x.e.r){var Xt=x.e.r;x.e.r=n.sheetRows-1,u["!fullref"]=u["!ref"],u["!ref"]=Fr(x),x.e.r=Xt}x.e.r++,x.e.c++}ft.length>0&&(u["!merges"]=ft),ct.length>0&&(u["!objects"]=ct),xt.length>0&&(u["!cols"]=xt),ht.length>0&&(u["!rows"]=ht),ae.Sheets.push(ze)}w===""?C=u:c[w]=u,u=n.dense?[]:{}}break;case 9:case 521:case 1033:case 2057:{if(Le.biff===8&&(Le.biff={9:2,521:3,1033:4}[_t]||{512:2,768:3,1024:4,1280:5,1536:8,2:2,7:2}[ge.BIFFVer]||8),Le.biffguess=ge.BIFFVer==0,ge.BIFFVer==0&&ge.dt==4096&&(Le.biff=5,Ke=!0,En(Le.codepage=28591)),Le.biff==8&&ge.BIFFVer==0&&ge.dt==16&&(Le.biff=2),Ft++)break;if(u=n.dense?[]:{},Le.biff<8&&!Ke&&(Ke=!0,En(Le.codepage=n.codepage||1252)),Le.biff<5||ge.BIFFVer==0&&ge.dt==4096){w===""&&(w="Sheet1"),x={s:{r:0,c:0},e:{r:0,c:0}};var or={pos:e.l-ut,name:w};m[or.pos]=or,Le.snames.push(w)}else w=(m[pt]||{name:""}).name;ge.dt==32&&(u["!type"]="chart"),ge.dt==64&&(u["!type"]="macro"),ft=[],ct=[],Le.arrayf=pe=[],xt=[],ht=[],Yt=!1,ze={Hidden:(m[pt]||{hs:0}).hs,name:w}}break;case 515:case 3:case 2:u["!type"]=="chart"&&(n.dense?(u[ge.r]||[])[ge.c]:u[fr({c:ge.c,r:ge.r})])&&++ge.c,X={ixfe:ge.ixfe,XF:ye[ge.ixfe]||{},v:ge.val,t:"n"},ue>0&&(X.z=Te[X.ixfe>>8&63]),On(X,n,a.opts.Date1904),je({c:ge.c,r:ge.r},X,n);break;case 5:case 517:X={ixfe:ge.ixfe,XF:ye[ge.ixfe],v:ge.val,t:ge.t},ue>0&&(X.z=Te[X.ixfe>>8&63]),On(X,n,a.opts.Date1904),je({c:ge.c,r:ge.r},X,n);break;case 638:X={ixfe:ge.ixfe,XF:ye[ge.ixfe],v:ge.rknum,t:"n"},ue>0&&(X.z=Te[X.ixfe>>8&63]),On(X,n,a.opts.Date1904),je({c:ge.c,r:ge.r},X,n);break;case 189:for(var Jt=ge.c;Jt<=ge.C;++Jt){var wt=ge.rkrec[Jt-ge.c][0];X={ixfe:wt,XF:ye[wt],v:ge.rkrec[Jt-ge.c][1],t:"n"},ue>0&&(X.z=Te[X.ixfe>>8&63]),On(X,n,a.opts.Date1904),je({c:Jt,r:ge.r},X,n)}break;case 6:case 518:case 1030:{if(ge.val=="String"){o=ge;break}if(X=Sh(ge.val,ge.cell.ixfe,ge.tt),X.XF=ye[X.ixfe],n.cellFormula){var cr=ge.formula;if(cr&&cr[0]&&cr[0][0]&&cr[0][0][0]=="PtgExp"){var Pr=cr[0][0][1][0],qe=cr[0][0][1][1],Cr=fr({r:Pr,c:qe});re[Cr]?X.f=""+ci(ge.formula,x,ge.cell,He,Le):X.F=((n.dense?(u[Pr]||[])[qe]:u[Cr])||{}).F}else X.f=""+ci(ge.formula,x,ge.cell,He,Le)}ue>0&&(X.z=Te[X.ixfe>>8&63]),On(X,n,a.opts.Date1904),je(ge.cell,X,n),o=ge}break;case 7:case 519:if(o)o.val=ge,X=Sh(ge,o.cell.ixfe,"s"),X.XF=ye[X.ixfe],n.cellFormula&&(X.f=""+ci(o.formula,x,o.cell,He,Le)),ue>0&&(X.z=Te[X.ixfe>>8&63]),On(X,n,a.opts.Date1904),je(o.cell,X,n),o=null;else throw new Error("String record expects Formula");break;case 33:case 545:{pe.push(ge);var Br=fr(ge[0].s);if(B=n.dense?(u[ge[0].s.r]||[])[ge[0].s.c]:u[Br],n.cellFormula&&B){if(!o||!Br||!B)break;B.f=""+ci(ge[1],x,ge[0],He,Le),B.F=Fr(ge[0])}}break;case 1212:{if(!n.cellFormula)break;if(M){if(!o)break;re[fr(o.cell)]=ge[0],B=n.dense?(u[o.cell.r]||[])[o.cell.c]:u[fr(o.cell)],(B||{}).f=""+ci(ge[0],x,P,He,Le)}}break;case 253:X=Sh(E[ge.isst].t,ge.ixfe,"s"),E[ge.isst].h&&(X.h=E[ge.isst].h),X.XF=ye[X.ixfe],ue>0&&(X.z=Te[X.ixfe>>8&63]),On(X,n,a.opts.Date1904),je({c:ge.c,r:ge.r},X,n);break;case 513:n.sheetStubs&&(X={ixfe:ge.ixfe,XF:ye[ge.ixfe],t:"z"},ue>0&&(X.z=Te[X.ixfe>>8&63]),On(X,n,a.opts.Date1904),je({c:ge.c,r:ge.r},X,n));break;case 190:if(n.sheetStubs)for(var ar=ge.c;ar<=ge.C;++ar){var Gt=ge.ixfe[ar-ge.c];X={ixfe:Gt,XF:ye[Gt],t:"z"},ue>0&&(X.z=Te[X.ixfe>>8&63]),On(X,n,a.opts.Date1904),je({c:ar,r:ge.r},X,n)}break;case 214:case 516:case 4:X=Sh(ge.val,ge.ixfe,"s"),X.XF=ye[X.ixfe],ue>0&&(X.z=Te[X.ixfe>>8&63]),On(X,n,a.opts.Date1904),je({c:ge.c,r:ge.r},X,n);break;case 0:case 512:Ft===1&&(x=ge);break;case 252:E=ge;break;case 1054:if(Le.biff==4){Te[ue++]=ge[1];for(var ur=0;ur<ue+163&&gr[ur]!=ge[1];++ur);ur>=163&&fo(ge[1],ue+163)}else fo(ge[1],ge[0]);break;case 30:{Te[ue++]=ge;for(var ir=0;ir<ue+163&&gr[ir]!=ge;++ir);ir>=163&&fo(ge,ue+163)}break;case 229:ft=ft.concat(ge);break;case 93:ct[ge.cmo[0]]=Le.lastobj=ge;break;case 438:Le.lastobj.TxO=ge;break;case 127:Le.lastobj.ImData=ge;break;case 440:for(j=ge[0].s.r;j<=ge[0].e.r;++j)for(N=ge[0].s.c;N<=ge[0].e.c;++N)B=n.dense?(u[j]||[])[N]:u[fr({c:N,r:j})],B&&(B.l=ge[1]);break;case 2048:for(j=ge[0].s.r;j<=ge[0].e.r;++j)for(N=ge[0].s.c;N<=ge[0].e.c;++N)B=n.dense?(u[j]||[])[N]:u[fr({c:N,r:j})],B&&B.l&&(B.l.Tooltip=ge[1]);break;case 28:{if(Le.biff<=5&&Le.biff>=2)break;B=n.dense?(u[ge[0].r]||[])[ge[0].c]:u[fr(ge[0])];var Dr=ct[ge[2]];B||(n.dense?(u[ge[0].r]||(u[ge[0].r]=[]),B=u[ge[0].r][ge[0].c]={t:"z"}):B=u[fr(ge[0])]={t:"z"},x.e.r=Math.max(x.e.r,ge[0].r),x.s.r=Math.min(x.s.r,ge[0].r),x.e.c=Math.max(x.e.c,ge[0].c),x.s.c=Math.min(x.s.c,ge[0].c)),B.c||(B.c=[]),U={a:ge[1],t:Dr.TxO.t},B.c.push(U)}break;case 2173:pC(ye[ge.ixfe],ge.ext);break;case 125:{if(!Le.cellStyles)break;for(;ge.e>=ge.s;)xt[ge.e--]={width:ge.w/256,level:ge.level||0,hidden:!!(ge.flags&1)},Yt||(Yt=!0,pd(ge.w/256)),yl(xt[ge.e+1])}break;case 520:{var wr={};ge.level!=null&&(ht[ge.r]=wr,wr.level=ge.level),ge.hidden&&(ht[ge.r]=wr,wr.hidden=!0),ge.hpt&&(ht[ge.r]=wr,wr.hpt=ge.hpt,wr.hpx=Yc(ge.hpt))}break;case 38:case 39:case 40:case 41:u["!margins"]||jc(u["!margins"]={}),u["!margins"][{38:"left",39:"right",40:"top",41:"bottom"}[_t]]=ge;break;case 161:u["!margins"]||jc(u["!margins"]={}),u["!margins"].header=ge.header,u["!margins"].footer=ge.footer;break;case 574:ge.RTL&&(ae.Views[0].RTL=!0);break;case 146:we=ge;break;case 2198:it=ge;break;case 140:le=ge;break;case 442:w?ze.CodeName=ge||ze.name:ae.WBProps.CodeName=ge||"ThisWorkbook";break}}else tt||console.error("Missing Info for XLS Record 0x"+_t.toString(16)),e.l+=ut}return a.SheetNames=zn(m).sort(function(Nr,Ht){return Number(Nr)-Number(Ht)}).map(function(Nr){return m[Nr].name}),n.bookSheets||(a.Sheets=c),!a.SheetNames.length&&C["!ref"]?(a.SheetNames.push("Sheet1"),a.Sheets&&(a.Sheets.Sheet1=C)):a.Preamble=C,a.Sheets&&Ee.forEach(function(Nr,Ht){a.Sheets[a.SheetNames[Ht]]["!autofilter"]=Nr}),a.Strings=E,a.SSF=Ja(gr),Le.enc&&(a.Encryption=Le.enc),it&&(a.Themes=it),a.Metadata={},le!==void 0&&(a.Metadata.Country=le),He.names.length>0&&(ae.Names=He.names),a.Workbook=ae,a}var Sg={SI:"e0859ff2f94f6810ab9108002b27b3d9",DSI:"02d5cdd59c2e1b10939708002b2cf9ae",UDI:"05d5cdd59c2e1b10939708002b2cf9ae"};function qA(e,n,a){var c=Ir.find(e,"/!DocumentSummaryInformation");if(c&&c.size>0)try{var u=lg(c,uE,Sg.DSI);for(var m in u)n[m]=u[m]}catch(w){if(a.WTF)throw w}var x=Ir.find(e,"/!SummaryInformation");if(x&&x.size>0)try{var o=lg(x,hE,Sg.SI);for(var E in o)n[E]==null&&(n[E]=o[E])}catch(w){if(a.WTF)throw w}n.HeadingPairs&&n.TitlesOfParts&&(K1(n.HeadingPairs,n.TitlesOfParts,n,a),delete n.HeadingPairs,delete n.TitlesOfParts)}function Dx(e,n){n||(n={}),yd(n),o1(),n.codepage&&Y0(n.codepage);var a,c;if(e.FullPaths){if(Ir.find(e,"/encryption"))throw new Error("File is password-protected");a=Ir.find(e,"!CompObj"),c=Ir.find(e,"/Workbook")||Ir.find(e,"/Book")}else{switch(n.type){case"base64":e=Tn(Zi(e));break;case"binary":e=Tn(e);break;case"buffer":break;case"array":Array.isArray(e)||(e=Array.prototype.slice.call(e));break}Ya(e,0),c={content:e}}var u,m;if(a&&jA(a),n.bookProps&&!n.bookSheets)u={};else{var x=kr?"buffer":"array";if(c&&c.content)u=WA(c.content,n);else if((m=Ir.find(e,"PerfectOffice_MAIN"))&&m.content)u=Vc.to_workbook(m.content,(n.type=x,n));else if((m=Ir.find(e,"NativeContent_MAIN"))&&m.content)u=Vc.to_workbook(m.content,(n.type=x,n));else throw(m=Ir.find(e,"MN0"))&&m.content?new Error("Unsupported Works 4 for Mac file"):new Error("Cannot find Workbook stream");n.bookVBA&&e.FullPaths&&Ir.find(e,"/_VBA_PROJECT_CUR/VBA/dir")&&(u.vbaraw=MC(e))}var o={};return e.FullPaths&&qA(e,o,n),u.Props=u.Custprops=o,n.bookFiles&&(u.cfb=e),u}var $h={0:{f:A3},1:{f:M3},2:{f:V3},3:{f:O3},4:{f:L3},5:{f:U3},6:{f:G3},7:{f:z3},8:{f:X3},9:{f:Z3},10:{f:W3},11:{f:q3},12:{f:D3},13:{f:$3},14:{f:B3},15:{f:R3},16:{f:Ax},17:{f:H3},18:{f:N3},19:{f:ld},20:{},21:{},22:{},23:{},24:{},25:{},26:{},27:{},28:{},29:{},30:{},31:{},32:{},33:{},34:{},35:{T:1},36:{T:-1},37:{T:1},38:{T:-1},39:{f:bA},40:{},42:{},43:{f:Wk},44:{f:Hk},45:{f:qk},46:{f:Xk},47:{f:Zk},48:{},49:{f:KT},50:{},51:{f:gC},52:{T:1},53:{T:-1},54:{T:1},55:{T:-1},56:{T:1},57:{T:-1},58:{},59:{},60:{f:lx},62:{f:j3},63:{f:wC},64:{f:iA},65:{},66:{},67:{},68:{},69:{},70:{},128:{},129:{T:1},130:{T:-1},131:{T:1,f:di,p:0},132:{T:-1},133:{T:1},134:{T:-1},135:{T:1},136:{T:-1},137:{T:1,f:aA},138:{T:-1},139:{T:1},140:{T:-1},141:{T:1},142:{T:-1},143:{T:1},144:{T:-1},145:{T:1},146:{T:-1},147:{f:P3},148:{f:I3,p:16},151:{f:J3},152:{},153:{f:vA},154:{},155:{},156:{f:yA},157:{},158:{},159:{T:1,f:hk},160:{T:-1},161:{T:1,f:To},162:{T:-1},163:{T:1},164:{T:-1},165:{T:1},166:{T:-1},167:{},168:{},169:{},170:{},171:{},172:{T:1},173:{T:-1},174:{},175:{},176:{f:K3},177:{T:1},178:{T:-1},179:{T:1},180:{T:-1},181:{T:1},182:{T:-1},183:{T:1},184:{T:-1},185:{T:1},186:{T:-1},187:{T:1},188:{T:-1},189:{T:1},190:{T:-1},191:{T:1},192:{T:-1},193:{T:1},194:{T:-1},195:{T:1},196:{T:-1},197:{T:1},198:{T:-1},199:{T:1},200:{T:-1},201:{T:1},202:{T:-1},203:{T:1},204:{T:-1},205:{T:1},206:{T:-1},207:{T:1},208:{T:-1},209:{T:1},210:{T:-1},211:{T:1},212:{T:-1},213:{T:1},214:{T:-1},215:{T:1},216:{T:-1},217:{T:1},218:{T:-1},219:{T:1},220:{T:-1},221:{T:1},222:{T:-1},223:{T:1},224:{T:-1},225:{T:1},226:{T:-1},227:{T:1},228:{T:-1},229:{T:1},230:{T:-1},231:{T:1},232:{T:-1},233:{T:1},234:{T:-1},235:{T:1},236:{T:-1},237:{T:1},238:{T:-1},239:{T:1},240:{T:-1},241:{T:1},242:{T:-1},243:{T:1},244:{T:-1},245:{T:1},246:{T:-1},247:{T:1},248:{T:-1},249:{T:1},250:{T:-1},251:{T:1},252:{T:-1},253:{T:1},254:{T:-1},255:{T:1},256:{T:-1},257:{T:1},258:{T:-1},259:{T:1},260:{T:-1},261:{T:1},262:{T:-1},263:{T:1},264:{T:-1},265:{T:1},266:{T:-1},267:{T:1},268:{T:-1},269:{T:1},270:{T:-1},271:{T:1},272:{T:-1},273:{T:1},274:{T:-1},275:{T:1},276:{T:-1},277:{},278:{T:1},279:{T:-1},280:{T:1},281:{T:-1},282:{T:1},283:{T:1},284:{T:-1},285:{T:1},286:{T:-1},287:{T:1},288:{T:-1},289:{T:1},290:{T:-1},291:{T:1},292:{T:-1},293:{T:1},294:{T:-1},295:{T:1},296:{T:-1},297:{T:1},298:{T:-1},299:{T:1},300:{T:-1},301:{T:1},302:{T:-1},303:{T:1},304:{T:-1},305:{T:1},306:{T:-1},307:{T:1},308:{T:-1},309:{T:1},310:{T:-1},311:{T:1},312:{T:-1},313:{T:-1},314:{T:1},315:{T:-1},316:{T:1},317:{T:-1},318:{T:1},319:{T:-1},320:{T:1},321:{T:-1},322:{T:1},323:{T:-1},324:{T:1},325:{T:-1},326:{T:1},327:{T:-1},328:{T:1},329:{T:-1},330:{T:1},331:{T:-1},332:{T:1},333:{T:-1},334:{T:1},335:{f:mC},336:{T:-1},337:{f:xC,T:1},338:{T:-1},339:{T:1},340:{T:-1},341:{T:1},342:{T:-1},343:{T:1},344:{T:-1},345:{T:1},346:{T:-1},347:{T:1},348:{T:-1},349:{T:1},350:{T:-1},351:{},352:{},353:{T:1},354:{T:-1},355:{f:M0},357:{},358:{},359:{},360:{T:1},361:{},362:{f:ox},363:{},364:{},366:{},367:{},368:{},369:{},370:{},371:{},372:{T:1},373:{T:-1},374:{T:1},375:{T:-1},376:{T:1},377:{T:-1},378:{T:1},379:{T:-1},380:{T:1},381:{T:-1},382:{T:1},383:{T:-1},384:{T:1},385:{T:-1},386:{T:1},387:{T:-1},388:{T:1},389:{T:-1},390:{T:1},391:{T:-1},392:{T:1},393:{T:-1},394:{T:1},395:{T:-1},396:{},397:{},398:{},399:{},400:{},401:{T:1},403:{},404:{},405:{},406:{},407:{},408:{},409:{},410:{},411:{},412:{},413:{},414:{},415:{},416:{},417:{},418:{},419:{},420:{},421:{},422:{T:1},423:{T:1},424:{T:-1},425:{T:-1},426:{f:Q3},427:{f:eA},428:{},429:{T:1},430:{T:-1},431:{T:1},432:{T:-1},433:{T:1},434:{T:-1},435:{T:1},436:{T:-1},437:{T:1},438:{T:-1},439:{T:1},440:{T:-1},441:{T:1},442:{T:-1},443:{T:1},444:{T:-1},445:{T:1},446:{T:-1},447:{T:1},448:{T:-1},449:{T:1},450:{T:-1},451:{T:1},452:{T:-1},453:{T:1},454:{T:-1},455:{T:1},456:{T:-1},457:{T:1},458:{T:-1},459:{T:1},460:{T:-1},461:{T:1},462:{T:-1},463:{T:1},464:{T:-1},465:{T:1},466:{T:-1},467:{T:1},468:{T:-1},469:{T:1},470:{T:-1},471:{},472:{},473:{T:1},474:{T:-1},475:{},476:{f:rA},477:{},478:{},479:{T:1},480:{T:-1},481:{T:1},482:{T:-1},483:{T:1},484:{T:-1},485:{f:F3},486:{T:1},487:{T:-1},488:{T:1},489:{T:-1},490:{T:1},491:{T:-1},492:{T:1},493:{T:-1},494:{f:Y3},495:{T:1},496:{T:-1},497:{T:1},498:{T:-1},499:{},500:{T:1},501:{T:-1},502:{T:1},503:{T:-1},504:{},505:{T:1},506:{T:-1},507:{},508:{T:1},509:{T:-1},510:{T:1},511:{T:-1},512:{},513:{},514:{T:1},515:{T:-1},516:{T:1},517:{T:-1},518:{T:1},519:{T:-1},520:{T:1},521:{T:-1},522:{},523:{},524:{},525:{},526:{},527:{},528:{T:1},529:{T:-1},530:{T:1},531:{T:-1},532:{T:1},533:{T:-1},534:{},535:{},536:{},537:{},538:{T:1},539:{T:-1},540:{T:1},541:{T:-1},542:{T:1},548:{},549:{},550:{f:M0},551:{},552:{},553:{},554:{T:1},555:{T:-1},556:{T:1},557:{T:-1},558:{T:1},559:{T:-1},560:{T:1},561:{T:-1},562:{},564:{},565:{T:1},566:{T:-1},569:{T:1},570:{T:-1},572:{},573:{T:1},574:{T:-1},577:{},578:{},579:{},580:{},581:{},582:{},583:{},584:{},585:{},586:{},587:{},588:{T:-1},589:{},590:{T:1},591:{T:-1},592:{T:1},593:{T:-1},594:{T:1},595:{T:-1},596:{},597:{T:1},598:{T:-1},599:{T:1},600:{T:-1},601:{T:1},602:{T:-1},603:{T:1},604:{T:-1},605:{T:1},606:{T:-1},607:{},608:{T:1},609:{T:-1},610:{},611:{T:1},612:{T:-1},613:{T:1},614:{T:-1},615:{T:1},616:{T:-1},617:{T:1},618:{T:-1},619:{T:1},620:{T:-1},625:{},626:{T:1},627:{T:-1},628:{T:1},629:{T:-1},630:{T:1},631:{T:-1},632:{f:IC},633:{T:1},634:{T:-1},635:{T:1,f:AC},636:{T:-1},637:{f:JT},638:{T:1},639:{},640:{T:-1},641:{T:1},642:{T:-1},643:{T:1},644:{},645:{T:-1},646:{T:1},648:{T:1},649:{},650:{T:-1},651:{f:uA},652:{},653:{T:1},654:{T:-1},655:{T:1},656:{T:-1},657:{T:1},658:{T:-1},659:{},660:{T:1},661:{},662:{T:-1},663:{},664:{T:1},665:{},666:{T:-1},667:{},668:{},669:{},671:{T:1},672:{T:-1},673:{T:1},674:{T:-1},675:{},676:{},677:{},678:{},679:{},680:{},681:{},1024:{},1025:{},1026:{T:1},1027:{T:-1},1028:{T:1},1029:{T:-1},1030:{},1031:{T:1},1032:{T:-1},1033:{T:1},1034:{T:-1},1035:{},1036:{},1037:{},1038:{T:1},1039:{T:-1},1040:{},1041:{T:1},1042:{T:-1},1043:{},1044:{},1045:{},1046:{T:1},1047:{T:-1},1048:{T:1},1049:{T:-1},1050:{},1051:{T:1},1052:{T:1},1053:{f:nA},1054:{T:1},1055:{},1056:{T:1},1057:{T:-1},1058:{T:1},1059:{T:-1},1061:{},1062:{T:1},1063:{T:-1},1064:{T:1},1065:{T:-1},1066:{T:1},1067:{T:-1},1068:{T:1},1069:{T:-1},1070:{T:1},1071:{T:-1},1072:{T:1},1073:{T:-1},1075:{T:1},1076:{T:-1},1077:{T:1},1078:{T:-1},1079:{T:1},1080:{T:-1},1081:{T:1},1082:{T:-1},1083:{T:1},1084:{T:-1},1085:{},1086:{T:1},1087:{T:-1},1088:{T:1},1089:{T:-1},1090:{T:1},1091:{T:-1},1092:{T:1},1093:{T:-1},1094:{T:1},1095:{T:-1},1096:{},1097:{T:1},1098:{},1099:{T:-1},1100:{T:1},1101:{T:-1},1102:{},1103:{},1104:{},1105:{},1111:{},1112:{},1113:{T:1},1114:{T:-1},1115:{T:1},1116:{T:-1},1117:{},1118:{T:1},1119:{T:-1},1120:{T:1},1121:{T:-1},1122:{T:1},1123:{T:-1},1124:{T:1},1125:{T:-1},1126:{},1128:{T:1},1129:{T:-1},1130:{},1131:{T:1},1132:{T:-1},1133:{T:1},1134:{T:-1},1135:{T:1},1136:{T:-1},1137:{T:1},1138:{T:-1},1139:{T:1},1140:{T:-1},1141:{},1142:{T:1},1143:{T:-1},1144:{T:1},1145:{T:-1},1146:{},1147:{T:1},1148:{T:-1},1149:{T:1},1150:{T:-1},1152:{T:1},1153:{T:-1},1154:{T:-1},1155:{T:-1},1156:{T:-1},1157:{T:1},1158:{T:-1},1159:{T:1},1160:{T:-1},1161:{T:1},1162:{T:-1},1163:{T:1},1164:{T:-1},1165:{T:1},1166:{T:-1},1167:{T:1},1168:{T:-1},1169:{T:1},1170:{T:-1},1171:{},1172:{T:1},1173:{T:-1},1177:{},1178:{T:1},1180:{},1181:{},1182:{},2048:{T:1},2049:{T:-1},2050:{},2051:{T:1},2052:{T:-1},2053:{},2054:{},2055:{T:1},2056:{T:-1},2057:{T:1},2058:{T:-1},2060:{},2067:{},2068:{T:1},2069:{T:-1},2070:{},2071:{},2072:{T:1},2073:{T:-1},2075:{},2076:{},2077:{T:1},2078:{T:-1},2079:{},2080:{T:1},2081:{T:-1},2082:{},2083:{T:1},2084:{T:-1},2085:{T:1},2086:{T:-1},2087:{T:1},2088:{T:-1},2089:{T:1},2090:{T:-1},2091:{},2092:{},2093:{T:1},2094:{T:-1},2095:{},2096:{T:1},2097:{T:-1},2098:{T:1},2099:{T:-1},2100:{T:1},2101:{T:-1},2102:{},2103:{T:1},2104:{T:-1},2105:{},2106:{T:1},2107:{T:-1},2108:{},2109:{T:1},2110:{T:-1},2111:{T:1},2112:{T:-1},2113:{T:1},2114:{T:-1},2115:{},2116:{},2117:{},2118:{T:1},2119:{T:-1},2120:{},2121:{T:1},2122:{T:-1},2123:{T:1},2124:{T:-1},2125:{},2126:{T:1},2127:{T:-1},2128:{},2129:{T:1},2130:{T:-1},2131:{T:1},2132:{T:-1},2133:{T:1},2134:{},2135:{},2136:{},2137:{T:1},2138:{T:-1},2139:{T:1},2140:{T:-1},2141:{},3072:{},3073:{},4096:{T:1},4097:{T:-1},5002:{T:1},5003:{T:-1},5081:{T:1},5082:{T:-1},5083:{},5084:{T:1},5085:{T:-1},5086:{T:1},5087:{T:-1},5088:{},5089:{},5090:{},5092:{T:1},5093:{T:-1},5094:{},5095:{T:1},5096:{T:-1},5097:{},5099:{},65535:{n:""}},B0={6:{f:g0},10:{f:Is},12:{f:Ca},13:{f:Ca},14:{f:Ea},15:{f:Ea},16:{f:ui},17:{f:Ea},18:{f:Ea},19:{f:Ca},20:{f:fg},21:{f:fg},23:{f:ox},24:{f:pg},25:{f:Ea},26:{},27:{},28:{f:kS},29:{},34:{f:Ea},35:{f:dg},38:{f:ui},39:{f:ui},40:{f:ui},41:{f:ui},42:{f:Ea},43:{f:Ea},47:{f:Fk},49:{f:oS},51:{f:Ca},60:{},61:{f:iS},64:{f:Ea},65:{f:sS},66:{f:Ca},77:{},80:{},81:{},82:{},85:{f:Ca},89:{},90:{},91:{},92:{f:KE},93:{f:AS},94:{},95:{f:Ea},96:{},97:{},99:{f:Ea},125:{f:lx},128:{f:xS},129:{f:YE},130:{f:Ca},131:{f:Ea},132:{f:Ea},133:{f:JE},134:{},140:{f:LS},141:{f:Ca},144:{},146:{f:OS},151:{},152:{},153:{},154:{},155:{},156:{f:Ca},157:{},158:{},160:{f:VS},161:{f:zS},174:{},175:{},176:{},177:{},178:{},180:{},181:{},182:{},184:{},185:{},189:{f:dS},190:{f:pS},193:{f:Is},197:{},198:{},199:{},200:{},201:{},202:{f:Ea},203:{},204:{},205:{},206:{},207:{},208:{},209:{},210:{},211:{},213:{},215:{},216:{},217:{},218:{f:Ca},220:{},221:{f:Ea},222:{},224:{f:gS},225:{f:XE},226:{f:Is},227:{},229:{f:CS},233:{},235:{},236:{},237:{},239:{},240:{},241:{},242:{},244:{},245:{},246:{},247:{},248:{},249:{},251:{},252:{f:QE},253:{f:lS},255:{f:eS},256:{},259:{},290:{},311:{},312:{},315:{},317:{f:tx},318:{},319:{},320:{},330:{},331:{},333:{},334:{},335:{},336:{},337:{},338:{},339:{},340:{},351:{},352:{f:Ea},353:{f:Is},401:{},402:{},403:{},404:{},405:{},406:{},407:{},408:{},425:{},426:{},427:{},428:{},429:{},430:{f:yS},431:{f:Ea},432:{},433:{},434:{},437:{},438:{f:PS},439:{f:Ea},440:{f:MS},441:{},442:{f:nu},443:{},444:{f:Ca},445:{},446:{},448:{f:Is},449:{f:aS,r:2},450:{f:Is},512:{f:ug},513:{f:US},515:{f:_S},516:{f:cS},517:{f:hg},519:{f:$S},520:{f:tS},523:{},545:{f:mg},549:{f:cg},566:{},574:{f:nS},638:{f:fS},659:{},1048:{},1054:{f:uS},1084:{},1212:{f:TS},2048:{f:DS},2049:{},2050:{},2051:{},2052:{},2053:{},2054:{},2055:{},2056:{},2057:{f:bh},2058:{},2059:{},2060:{},2061:{},2062:{},2063:{},2064:{},2066:{},2067:{},2128:{},2129:{},2130:{},2131:{},2132:{},2133:{},2134:{},2135:{},2136:{},2137:{},2138:{},2146:{},2147:{r:12},2148:{},2149:{},2150:{},2151:{f:Is},2152:{},2154:{},2155:{},2156:{},2161:{},2162:{},2164:{},2165:{},2166:{},2167:{},2168:{},2169:{},2170:{},2171:{},2172:{f:BS,r:12},2173:{f:dC,r:12},2174:{},2175:{},2180:{},2181:{},2182:{},2183:{},2184:{},2185:{},2186:{},2187:{},2188:{f:Ea,r:12},2189:{},2190:{r:12},2191:{},2192:{},2194:{},2195:{},2196:{f:bS,r:12},2197:{},2198:{f:oC,r:12},2199:{},2200:{},2201:{},2202:{f:ES,r:12},2203:{f:Is},2204:{},2205:{},2206:{},2207:{},2211:{f:rS},2212:{},2213:{},2214:{},2215:{},4097:{},4098:{},4099:{},4102:{},4103:{},4105:{},4106:{},4107:{},4108:{},4109:{},4116:{},4117:{},4118:{},4119:{},4120:{},4121:{},4122:{},4123:{},4124:{},4125:{},4126:{},4127:{},4128:{},4129:{},4130:{},4132:{},4133:{},4134:{f:Ca},4135:{},4146:{},4147:{},4148:{},4149:{},4154:{},4156:{},4157:{},4158:{},4159:{},4160:{},4161:{},4163:{},4164:{f:NS},4165:{},4166:{},4168:{},4170:{},4171:{},4174:{},4175:{},4176:{},4177:{},4187:{},4188:{f:RS},4189:{},4191:{},4192:{},4193:{},4194:{},4195:{},4196:{},4197:{},4198:{},4199:{},4200:{},0:{f:ug},1:{},2:{f:WS},3:{f:HS},4:{f:GS},5:{f:hg},7:{f:qS},8:{},9:{f:bh},11:{},22:{f:Ca},30:{f:hS},31:{},32:{},33:{f:mg},36:{},37:{f:cg},50:{f:ZS},62:{},52:{},67:{},68:{f:Ca},69:{},86:{},126:{},127:{f:jS},135:{},136:{},137:{},145:{},148:{},149:{},150:{},169:{},171:{},188:{},191:{},192:{},194:{},195:{},214:{f:XS},223:{},234:{},354:{},421:{},518:{f:g0},521:{f:bh},536:{f:pg},547:{f:dg},561:{},579:{},1030:{f:g0},1033:{f:bh},1091:{},2157:{},2163:{},2177:{},2240:{},2241:{},2242:{},2243:{},2244:{},2245:{},2246:{},2247:{},2248:{},2249:{},2250:{},2251:{},2262:{r:12},29282:{}};function bn(e,n,a,c){var u=n;if(!isNaN(u)){var m=c||(a||[]).length||0,x=e.next(4);x.write_shift(2,u),x.write_shift(2,m),m>0&&$1(a)&&e.push(a)}}function kg(e,n){var a=n||{},c=a.dense?[]:{};e=e.replace(/<!--.*?-->/g,"");var u=e.match(/<table/i);if(!u)throw new Error("Invalid HTML: could not find <table>");var m=e.match(/<\/table/i),x=u.index,o=m&&m.index||e.length,E=yT(e.slice(x,o),/(:?<tr[^>]*>)/i,"<tr>"),w=-1,C=0,P=0,M=0,B={s:{r:1e7,c:1e7},e:{r:0,c:0}},U=[];for(x=0;x<E.length;++x){var N=E[x].trim(),j=N.slice(0,3).toLowerCase();if(j=="<tr"){if(++w,a.sheetRows&&a.sheetRows<=w){--w;break}C=0;continue}if(!(j!="<td"&&j!="<th")){var re=N.split(/<\/t[dh]>/i);for(o=0;o<re.length;++o){var pe=re[o].trim();if(pe.match(/<t[dh]/i)){for(var X=pe,le=0;X.charAt(0)=="<"&&(le=X.indexOf(">"))>-1;)X=X.slice(le+1);for(var ye=0;ye<U.length;++ye){var we=U[ye];we.s.c==C&&we.s.r<w&&w<=we.e.r&&(C=we.e.c+1,ye=-1)}var ae=nr(pe.slice(0,pe.indexOf(">")));M=ae.colspan?+ae.colspan:1,((P=+ae.rowspan)>1||M>1)&&U.push({s:{r:w,c:C},e:{r:w+(P||1)-1,c:C+M-1}});var ze=ae.t||ae["data-t"]||"";if(!X.length){C+=M;continue}if(X=I1(X),B.s.r>w&&(B.s.r=w),B.e.r<w&&(B.e.r=w),B.s.c>C&&(B.s.c=C),B.e.c<C&&(B.e.c=C),!X.length){C+=M;continue}var Ie={t:"s",v:X};a.raw||!X.trim().length||ze=="s"||(X==="TRUE"?Ie={t:"b",v:!0}:X==="FALSE"?Ie={t:"b",v:!1}:isNaN(kn(X))?isNaN(_l(X).getDate())||(Ie={t:"d",v:Ga(X)},a.cellDates||(Ie={t:"n",v:Pi(Ie.v)}),Ie.z=a.dateNF||gr[14]):Ie={t:"n",v:kn(X)}),a.dense?(c[w]||(c[w]=[]),c[w][C]=Ie):c[fr({r:w,c:C})]=Ie,C+=M}}}}return c["!ref"]=Fr(B),U.length&&(c["!merges"]=U),c}function ZA(e,n,a,c){for(var u=e["!merges"]||[],m=[],x=n.s.c;x<=n.e.c;++x){for(var o=0,E=0,w=0;w<u.length;++w)if(!(u[w].s.r>a||u[w].s.c>x)&&!(u[w].e.r<a||u[w].e.c<x)){if(u[w].s.r<a||u[w].s.c<x){o=-1;break}o=u[w].e.r-u[w].s.r+1,E=u[w].e.c-u[w].s.c+1;break}if(!(o<0)){var C=fr({r:a,c:x}),P=c.dense?(e[a]||[])[x]:e[C],M=P&&P.v!=null&&(P.h||ad(P.w||(ls(P),P.w)||""))||"",B={};o>1&&(B.rowspan=o),E>1&&(B.colspan=E),c.editable?M='<span contenteditable="true">'+M+"</span>":P&&(B["data-t"]=P&&P.t||"z",P.v!=null&&(B["data-v"]=P.v),P.z!=null&&(B["data-z"]=P.z),P.l&&(P.l.Target||"#").charAt(0)!="#"&&(M='<a href="'+P.l.Target+'">'+M+"</a>")),B.id=(c.id||"sjs")+"-"+C,m.push(LT("td",M,B))}}var U="<tr>";return U+m.join("")+"</tr>"}var XA='<html><head><meta charset="utf-8"/><title>SheetJS Table Export</title></head><body>',KA="</body></html>";function YA(e,n){var a=e.match(/<table[\s\S]*?>[\s\S]*?<\/table>/gi);if(!a||a.length==0)throw new Error("Invalid HTML: could not find <table>");if(a.length==1)return zs(kg(a[0],n),n);var c=wd();return a.forEach(function(u,m){bd(c,kg(u,n),"Sheet"+(m+1))}),c}function JA(e,n,a){var c=[];return c.join("")+"<table"+(a&&a.id?' id="'+a.id+'"':"")+">"}function QA(e,n){var a=n||{},c=a.header!=null?a.header:XA,u=a.footer!=null?a.footer:KA,m=[c],x=Tl(e["!ref"]);a.dense=Array.isArray(e),m.push(JA(e,x,a));for(var o=x.s.r;o<=x.e.r;++o)m.push(ZA(e,x,o,a));return m.push("</table>"+u),m.join("")}function Lx(e,n,a){var c=a||{},u=0,m=0;if(c.origin!=null)if(typeof c.origin=="number")u=c.origin;else{var x=typeof c.origin=="string"?Ai(c.origin):c.origin;u=x.r,m=x.c}var o=n.getElementsByTagName("tr"),E=Math.min(c.sheetRows||1e7,o.length),w={s:{r:0,c:0},e:{r:u,c:m}};if(e["!ref"]){var C=Tl(e["!ref"]);w.s.r=Math.min(w.s.r,C.s.r),w.s.c=Math.min(w.s.c,C.s.c),w.e.r=Math.max(w.e.r,C.e.r),w.e.c=Math.max(w.e.c,C.e.c),u==-1&&(w.e.r=u=C.e.r+1)}var P=[],M=0,B=e["!rows"]||(e["!rows"]=[]),U=0,N=0,j=0,re=0,pe=0,X=0;for(e["!cols"]||(e["!cols"]=[]);U<o.length&&N<E;++U){var le=o[U];if(Cg(le)){if(c.display)continue;B[N]={hidden:!0}}var ye=le.children;for(j=re=0;j<ye.length;++j){var we=ye[j];if(!(c.display&&Cg(we))){var ae=we.hasAttribute("data-v")?we.getAttribute("data-v"):we.hasAttribute("v")?we.getAttribute("v"):I1(we.innerHTML),ze=we.getAttribute("data-z")||we.getAttribute("z");for(M=0;M<P.length;++M){var Ie=P[M];Ie.s.c==re+m&&Ie.s.r<N+u&&N+u<=Ie.e.r&&(re=Ie.e.c+1-m,M=-1)}X=+we.getAttribute("colspan")||1,((pe=+we.getAttribute("rowspan")||1)>1||X>1)&&P.push({s:{r:N+u,c:re+m},e:{r:N+u+(pe||1)-1,c:re+m+(X||1)-1}});var $e={t:"s",v:ae},je=we.getAttribute("data-t")||we.getAttribute("t")||"";ae!=null&&(ae.length==0?$e.t=je||"z":c.raw||ae.trim().length==0||je=="s"||(ae==="TRUE"?$e={t:"b",v:!0}:ae==="FALSE"?$e={t:"b",v:!1}:isNaN(kn(ae))?isNaN(_l(ae).getDate())||($e={t:"d",v:Ga(ae)},c.cellDates||($e={t:"n",v:Pi($e.v)}),$e.z=c.dateNF||gr[14]):$e={t:"n",v:kn(ae)})),$e.z===void 0&&ze!=null&&($e.z=ze);var Le="",it=we.getElementsByTagName("A");if(it&&it.length)for(var ft=0;ft<it.length&&!(it[ft].hasAttribute("href")&&(Le=it[ft].getAttribute("href"),Le.charAt(0)!="#"));++ft);Le&&Le.charAt(0)!="#"&&($e.l={Target:Le}),c.dense?(e[N+u]||(e[N+u]=[]),e[N+u][re+m]=$e):e[fr({c:re+m,r:N+u})]=$e,w.e.c<re+m&&(w.e.c=re+m),re+=X}}++N}return P.length&&(e["!merges"]=(e["!merges"]||[]).concat(P)),w.e.r=Math.max(w.e.r,N-1+u),e["!ref"]=Fr(w),N>=E&&(e["!fullref"]=Fr((w.e.r=o.length-U+N-1+u,w))),e}function Rx(e,n){var a=n||{},c=a.dense?[]:{};return Lx(c,e,n)}function eI(e,n){return zs(Rx(e,n),n)}function Cg(e){var n="",a=tI(e);return a&&(n=a(e).getPropertyValue("display")),n||(n=e.style&&e.style.display),n==="none"}function tI(e){return e.ownerDocument.defaultView&&typeof e.ownerDocument.defaultView.getComputedStyle=="function"?e.ownerDocument.defaultView.getComputedStyle:typeof getComputedStyle=="function"?getComputedStyle:null}function rI(e){var n=e.replace(/[\t\r\n]/g," ").trim().replace(/ +/g," ").replace(/<text:s\/>/g," ").replace(/<text:s text:c="(\d+)"\/>/g,function(c,u){return Array(parseInt(u,10)+1).join(" ")}).replace(/<text:tab[^>]*\/>/g,"	").replace(/<text:line-break\/>/g,`
`),a=Mr(n.replace(/<[^>]*>/g,""));return[a]}var Ag={day:["d","dd"],month:["m","mm"],year:["y","yy"],hours:["h","hh"],minutes:["m","mm"],seconds:["s","ss"],"am-pm":["A/P","AM/PM"],"day-of-week":["ddd","dddd"],era:["e","ee"],quarter:["\\Qm",'m\\"th quarter"']};function Ox(e,n){var a=n||{},c=id(e),u=[],m,x,o={name:""},E="",w=0,C,P,M={},B=[],U=a.dense?[]:{},N,j,re={value:""},pe="",X=0,le=[],ye=-1,we=-1,ae={s:{r:1e6,c:1e7},e:{r:0,c:0}},ze=0,Ie={},$e=[],je={},Le=0,it=0,ft=[],ct=1,xt=1,ht=[],Yt={Names:[]},He={},Nt=["",""],Ft=[],ue={},Te="",Ee=0,Se=!1,Ke=!1,pt=0;for(Zc.lastIndex=0,c=c.replace(/<!--([\s\S]*?)-->/mg,"").replace(/<!DOCTYPE[^\[]*\[[^\]]*\]>/gm,"");N=Zc.exec(c);)switch(N[3]=N[3].replace(/_.*$/,"")){case"table":case"工作表":N[1]==="/"?(ae.e.c>=ae.s.c&&ae.e.r>=ae.s.r?U["!ref"]=Fr(ae):U["!ref"]="A1:A1",a.sheetRows>0&&a.sheetRows<=ae.e.r&&(U["!fullref"]=U["!ref"],ae.e.r=a.sheetRows-1,U["!ref"]=Fr(ae)),$e.length&&(U["!merges"]=$e),ft.length&&(U["!rows"]=ft),C.name=C.名称||C.name,typeof JSON<"u"&&JSON.stringify(C),B.push(C.name),M[C.name]=U,Ke=!1):N[0].charAt(N[0].length-2)!=="/"&&(C=nr(N[0],!1),ye=we=-1,ae.s.r=ae.s.c=1e7,ae.e.r=ae.e.c=0,U=a.dense?[]:{},$e=[],ft=[],Ke=!0);break;case"table-row-group":N[1]==="/"?--ze:++ze;break;case"table-row":case"行":if(N[1]==="/"){ye+=ct,ct=1;break}if(P=nr(N[0],!1),P.行号?ye=P.行号-1:ye==-1&&(ye=0),ct=+P["number-rows-repeated"]||1,ct<10)for(pt=0;pt<ct;++pt)ze>0&&(ft[ye+pt]={level:ze});we=-1;break;case"covered-table-cell":N[1]!=="/"&&++we,a.sheetStubs&&(a.dense?(U[ye]||(U[ye]=[]),U[ye][we]={t:"z"}):U[fr({r:ye,c:we})]={t:"z"}),pe="",le=[];break;case"table-cell":case"数据":if(N[0].charAt(N[0].length-2)==="/")++we,re=nr(N[0],!1),xt=parseInt(re["number-columns-repeated"]||"1",10),j={t:"z",v:null},re.formula&&a.cellFormula!=!1&&(j.f=bg(Mr(re.formula))),(re.数据类型||re["value-type"])=="string"&&(j.t="s",j.v=Mr(re["string-value"]||""),a.dense?(U[ye]||(U[ye]=[]),U[ye][we]=j):U[fr({r:ye,c:we})]=j),we+=xt-1;else if(N[1]!=="/"){++we,pe="",X=0,le=[],xt=1;var _t=ct?ye+ct-1:ye;if(we>ae.e.c&&(ae.e.c=we),we<ae.s.c&&(ae.s.c=we),ye<ae.s.r&&(ae.s.r=ye),_t>ae.e.r&&(ae.e.r=_t),re=nr(N[0],!1),Ft=[],ue={},j={t:re.数据类型||re["value-type"],v:null},a.cellFormula)if(re.formula&&(re.formula=Mr(re.formula)),re["number-matrix-columns-spanned"]&&re["number-matrix-rows-spanned"]&&(Le=parseInt(re["number-matrix-rows-spanned"],10)||0,it=parseInt(re["number-matrix-columns-spanned"],10)||0,je={s:{r:ye,c:we},e:{r:ye+Le-1,c:we+it-1}},j.F=Fr(je),ht.push([je,j.F])),re.formula)j.f=bg(re.formula);else for(pt=0;pt<ht.length;++pt)ye>=ht[pt][0].s.r&&ye<=ht[pt][0].e.r&&we>=ht[pt][0].s.c&&we<=ht[pt][0].e.c&&(j.F=ht[pt][1]);switch((re["number-columns-spanned"]||re["number-rows-spanned"])&&(Le=parseInt(re["number-rows-spanned"],10)||0,it=parseInt(re["number-columns-spanned"],10)||0,je={s:{r:ye,c:we},e:{r:ye+Le-1,c:we+it-1}},$e.push(je)),re["number-columns-repeated"]&&(xt=parseInt(re["number-columns-repeated"],10)),j.t){case"boolean":j.t="b",j.v=na(re["boolean-value"]);break;case"float":j.t="n",j.v=parseFloat(re.value);break;case"percentage":j.t="n",j.v=parseFloat(re.value);break;case"currency":j.t="n",j.v=parseFloat(re.value);break;case"date":j.t="d",j.v=Ga(re["date-value"]),a.cellDates||(j.t="n",j.v=Pi(j.v)),j.z="m/d/yy";break;case"time":j.t="n",j.v=gT(re["time-value"])/86400,a.cellDates&&(j.t="d",j.v=qh(j.v)),j.z="HH:MM:SS";break;case"number":j.t="n",j.v=parseFloat(re.数据数值);break;default:if(j.t==="string"||j.t==="text"||!j.t)j.t="s",re["string-value"]!=null&&(pe=Mr(re["string-value"]),le=[]);else throw new Error("Unsupported value type "+j.t)}}else{if(Se=!1,j.t==="s"&&(j.v=pe||"",le.length&&(j.R=le),Se=X==0),He.Target&&(j.l=He),Ft.length>0&&(j.c=Ft,Ft=[]),pe&&a.cellText!==!1&&(j.w=pe),Se&&(j.t="z",delete j.v),(!Se||a.sheetStubs)&&!(a.sheetRows&&a.sheetRows<=ye))for(var ut=0;ut<ct;++ut){if(xt=parseInt(re["number-columns-repeated"]||"1",10),a.dense)for(U[ye+ut]||(U[ye+ut]=[]),U[ye+ut][we]=ut==0?j:Ja(j);--xt>0;)U[ye+ut][we+xt]=Ja(j);else for(U[fr({r:ye+ut,c:we})]=j;--xt>0;)U[fr({r:ye+ut,c:we+xt})]=Ja(j);ae.e.c<=we&&(ae.e.c=we)}xt=parseInt(re["number-columns-repeated"]||"1",10),we+=xt-1,xt=0,j={},pe="",le=[]}He={};break;case"document":case"document-content":case"电子表格文档":case"spreadsheet":case"主体":case"scripts":case"styles":case"font-face-decls":case"master-styles":if(N[1]==="/"){if((m=u.pop())[0]!==N[3])throw"Bad state: "+m}else N[0].charAt(N[0].length-2)!=="/"&&u.push([N[3],!0]);break;case"annotation":if(N[1]==="/"){if((m=u.pop())[0]!==N[3])throw"Bad state: "+m;ue.t=pe,le.length&&(ue.R=le),ue.a=Te,Ft.push(ue)}else N[0].charAt(N[0].length-2)!=="/"&&u.push([N[3],!1]);Te="",Ee=0,pe="",X=0,le=[];break;case"creator":N[1]==="/"?Te=c.slice(Ee,N.index):Ee=N.index+N[0].length;break;case"meta":case"元数据":case"settings":case"config-item-set":case"config-item-map-indexed":case"config-item-map-entry":case"config-item-map-named":case"shapes":case"frame":case"text-box":case"image":case"data-pilot-tables":case"list-style":case"form":case"dde-links":case"event-listeners":case"chart":if(N[1]==="/"){if((m=u.pop())[0]!==N[3])throw"Bad state: "+m}else N[0].charAt(N[0].length-2)!=="/"&&u.push([N[3],!1]);pe="",X=0,le=[];break;case"scientific-number":break;case"currency-symbol":break;case"currency-style":break;case"number-style":case"percentage-style":case"date-style":case"time-style":if(N[1]==="/"){if(Ie[o.name]=E,(m=u.pop())[0]!==N[3])throw"Bad state: "+m}else N[0].charAt(N[0].length-2)!=="/"&&(E="",o=nr(N[0],!1),u.push([N[3],!0]));break;case"script":break;case"libraries":break;case"automatic-styles":break;case"default-style":case"page-layout":break;case"style":break;case"map":break;case"font-face":break;case"paragraph-properties":break;case"table-properties":break;case"table-column-properties":break;case"table-row-properties":break;case"table-cell-properties":break;case"number":switch(u[u.length-1][0]){case"time-style":case"date-style":x=nr(N[0],!1),E+=Ag[N[3]][x.style==="long"?1:0];break}break;case"fraction":break;case"day":case"month":case"year":case"era":case"day-of-week":case"week-of-year":case"quarter":case"hours":case"minutes":case"seconds":case"am-pm":switch(u[u.length-1][0]){case"time-style":case"date-style":x=nr(N[0],!1),E+=Ag[N[3]][x.style==="long"?1:0];break}break;case"boolean-style":break;case"boolean":break;case"text-style":break;case"text":if(N[0].slice(-2)==="/>")break;if(N[1]==="/")switch(u[u.length-1][0]){case"number-style":case"date-style":case"time-style":E+=c.slice(w,N.index);break}else w=N.index+N[0].length;break;case"named-range":x=nr(N[0],!1),Nt=x0(x["cell-range-address"]);var tt={Name:x.name,Ref:Nt[0]+"!"+Nt[1]};Ke&&(tt.Sheet=B.length),Yt.Names.push(tt);break;case"text-content":break;case"text-properties":break;case"embedded-text":break;case"body":case"电子表格":break;case"forms":break;case"table-column":break;case"table-header-rows":break;case"table-rows":break;case"table-column-group":break;case"table-header-columns":break;case"table-columns":break;case"null-date":break;case"graphic-properties":break;case"calculation-settings":break;case"named-expressions":break;case"label-range":break;case"label-ranges":break;case"named-expression":break;case"sort":break;case"sort-by":break;case"sort-groups":break;case"tab":break;case"line-break":break;case"span":break;case"p":case"文本串":if(["master-styles"].indexOf(u[u.length-1][0])>-1)break;if(N[1]==="/"&&(!re||!re["string-value"])){var Zt=rI(c.slice(X,N.index));pe=(pe.length>0?pe+`
`:"")+Zt[0]}else nr(N[0],!1),X=N.index+N[0].length;break;case"s":break;case"database-range":if(N[1]==="/")break;try{Nt=x0(nr(N[0])["target-range-address"]),M[Nt[0]]["!autofilter"]={ref:Nt[1]}}catch{}break;case"date":break;case"object":break;case"title":case"标题":break;case"desc":break;case"binary-data":break;case"table-source":break;case"scenario":break;case"iteration":break;case"content-validations":break;case"content-validation":break;case"help-message":break;case"error-message":break;case"database-ranges":break;case"filter":break;case"filter-and":break;case"filter-or":break;case"filter-condition":break;case"list-level-style-bullet":break;case"list-level-style-number":break;case"list-level-properties":break;case"sender-firstname":case"sender-lastname":case"sender-initials":case"sender-title":case"sender-position":case"sender-email":case"sender-phone-private":case"sender-fax":case"sender-company":case"sender-phone-work":case"sender-street":case"sender-city":case"sender-postal-code":case"sender-country":case"sender-state-or-province":case"author-name":case"author-initials":case"chapter":case"file-name":case"template-name":case"sheet-name":break;case"event-listener":break;case"initial-creator":case"creation-date":case"print-date":case"generator":case"document-statistic":case"user-defined":case"editing-duration":case"editing-cycles":break;case"config-item":break;case"page-number":break;case"page-count":break;case"time":break;case"cell-range-source":break;case"detective":break;case"operation":break;case"highlighted-range":break;case"data-pilot-table":case"source-cell-range":case"source-service":case"data-pilot-field":case"data-pilot-level":case"data-pilot-subtotals":case"data-pilot-subtotal":case"data-pilot-members":case"data-pilot-member":case"data-pilot-display-info":case"data-pilot-sort-info":case"data-pilot-layout-info":case"data-pilot-field-reference":case"data-pilot-groups":case"data-pilot-group":case"data-pilot-group-member":break;case"rect":break;case"dde-connection-decls":case"dde-connection-decl":case"dde-link":case"dde-source":break;case"properties":break;case"property":break;case"a":if(N[1]!=="/"){if(He=nr(N[0],!1),!He.href)break;He.Target=Mr(He.href),delete He.href,He.Target.charAt(0)=="#"&&He.Target.indexOf(".")>-1?(Nt=x0(He.Target.slice(1)),He.Target="#"+Nt[0]+"!"+Nt[1]):He.Target.match(/^\.\.[\\\/]/)&&(He.Target=He.Target.slice(3))}break;case"table-protection":break;case"data-pilot-grand-total":break;case"office-document-common-attrs":break;default:switch(N[2]){case"dc:":case"calcext:":case"loext:":case"ooo:":case"chartooo:":case"draw:":case"style:":case"chart:":case"form:":case"uof:":case"表:":case"字:":break;default:if(a.WTF)throw new Error(N)}}var ge={Sheets:M,SheetNames:B,Workbook:Yt};return a.bookSheets&&delete ge.Sheets,ge}function Ig(e,n){n=n||{},sn(e,"META-INF/manifest.xml")&&_E(ka(e,"META-INF/manifest.xml"),n);var a=qi(e,"content.xml");if(!a)throw new Error("Missing content.xml in ODS / UOF file");var c=Ox(Xr(a),n);return sn(e,"meta.xml")&&(c.Props=X1(ka(e,"meta.xml"))),c}function Fg(e,n){return Ox(e,n)}/*! sheetjs (C) 2013-present SheetJS -- http://sheetjs.com */function xd(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function z0(e){return typeof TextDecoder<"u"?new TextDecoder().decode(e):Xr(wo(e))}function N0(e){var n=e.reduce(function(u,m){return u+m.length},0),a=new Uint8Array(n),c=0;return e.forEach(function(u){a.set(u,c),c+=u.length}),a}function Pg(e){return e-=e>>1&1431655765,e=(e&858993459)+(e>>2&858993459),(e+(e>>4)&252645135)*16843009>>>24}function aI(e,n){for(var a=(e[n+15]&127)<<7|e[n+14]>>1,c=e[n+14]&1,u=n+13;u>=n;--u)c=c*256+e[u];return(e[n+15]&128?-c:c)*Math.pow(10,a-6176)}function Jc(e,n){var a=n?n[0]:0,c=e[a]&127;e:if(e[a++]>=128&&(c|=(e[a]&127)<<7,e[a++]<128||(c|=(e[a]&127)<<14,e[a++]<128)||(c|=(e[a]&127)<<21,e[a++]<128)||(c+=(e[a]&127)*Math.pow(2,28),++a,e[a++]<128)||(c+=(e[a]&127)*Math.pow(2,35),++a,e[a++]<128)||(c+=(e[a]&127)*Math.pow(2,42),++a,e[a++]<128)))break e;return n&&(n[0]=a),c}function Ba(e){var n=0,a=e[n]&127;e:if(e[n++]>=128){if(a|=(e[n]&127)<<7,e[n++]<128||(a|=(e[n]&127)<<14,e[n++]<128)||(a|=(e[n]&127)<<21,e[n++]<128))break e;a|=(e[n]&127)<<28}return a}function hi(e){for(var n=[],a=[0];a[0]<e.length;){var c=a[0],u=Jc(e,a),m=u&7;u=Math.floor(u/8);var x=0,o;if(u==0)break;switch(m){case 0:{for(var E=a[0];e[a[0]++]>=128;);o=e.slice(E,a[0])}break;case 5:x=4,o=e.slice(a[0],a[0]+x),a[0]+=x;break;case 1:x=8,o=e.slice(a[0],a[0]+x),a[0]+=x;break;case 2:x=Jc(e,a),o=e.slice(a[0],a[0]+x),a[0]+=x;break;case 3:case 4:default:throw new Error("PB Type ".concat(m," for Field ").concat(u," at offset ").concat(c))}var w={data:o,type:m};n[u]==null?n[u]=[w]:n[u].push(w)}return n}function _d(e,n){return e?.map(function(a){return n(a.data)})||[]}function iI(e){for(var n,a=[],c=[0];c[0]<e.length;){var u=Jc(e,c),m=hi(e.slice(c[0],c[0]+u));c[0]+=u;var x={id:Ba(m[1][0].data),messages:[]};m[2].forEach(function(o){var E=hi(o.data),w=Ba(E[3][0].data);x.messages.push({meta:E,data:e.slice(c[0],c[0]+w)}),c[0]+=w}),(n=m[3])!=null&&n[0]&&(x.merge=Ba(m[3][0].data)>>>0>0),a.push(x)}return a}function nI(e,n){if(e!=0)throw new Error("Unexpected Snappy chunk type ".concat(e));for(var a=[0],c=Jc(n,a),u=[];a[0]<n.length;){var m=n[a[0]]&3;if(m==0){var x=n[a[0]++]>>2;if(x<60)++x;else{var o=x-59;x=n[a[0]],o>1&&(x|=n[a[0]+1]<<8),o>2&&(x|=n[a[0]+2]<<16),o>3&&(x|=n[a[0]+3]<<24),x>>>=0,x++,a[0]+=o}u.push(n.slice(a[0],a[0]+x)),a[0]+=x;continue}else{var E=0,w=0;if(m==1?(w=(n[a[0]]>>2&7)+4,E=(n[a[0]++]&224)<<3,E|=n[a[0]++]):(w=(n[a[0]++]>>2)+1,m==2?(E=n[a[0]]|n[a[0]+1]<<8,a[0]+=2):(E=(n[a[0]]|n[a[0]+1]<<8|n[a[0]+2]<<16|n[a[0]+3]<<24)>>>0,a[0]+=4)),u=[N0(u)],E==0)throw new Error("Invalid offset 0");if(E>u[0].length)throw new Error("Invalid offset beyond length");if(w>=E)for(u.push(u[0].slice(-E)),w-=E;w>=u[u.length-1].length;)u.push(u[u.length-1]),w-=u[u.length-1].length;u.push(u[0].slice(-E,-E+w))}}var C=N0(u);if(C.length!=c)throw new Error("Unexpected length: ".concat(C.length," != ").concat(c));return C}function sI(e){for(var n=[],a=0;a<e.length;){var c=e[a++],u=e[a]|e[a+1]<<8|e[a+2]<<16;a+=3,n.push(nI(c,e.slice(a,a+u))),a+=u}if(a!==e.length)throw new Error("data is not a valid framed stream!");return N0(n)}function oI(e,n,a,c){var u=xd(e),m=u.getUint32(4,!0),x=(c>1?12:8)+Pg(m&(c>1?3470:398))*4,o=-1,E=-1,w=NaN,C=new Date(2001,0,1);m&512&&(o=u.getUint32(x,!0),x+=4),x+=Pg(m&(c>1?12288:4096))*4,m&16&&(E=u.getUint32(x,!0),x+=4),m&32&&(w=u.getFloat64(x,!0),x+=8),m&64&&(C.setTime(C.getTime()+u.getFloat64(x,!0)*1e3),x+=8);var P;switch(e[2]){case 0:break;case 2:P={t:"n",v:w};break;case 3:P={t:"s",v:n[E]};break;case 5:P={t:"d",v:C};break;case 6:P={t:"b",v:w>0};break;case 7:P={t:"n",v:w/86400};break;case 8:P={t:"e",v:0};break;case 9:if(o>-1)P={t:"s",v:a[o]};else if(E>-1)P={t:"s",v:n[E]};else if(!isNaN(w))P={t:"n",v:w};else throw new Error("Unsupported cell type ".concat(e.slice(0,4)));break;default:throw new Error("Unsupported cell type ".concat(e.slice(0,4)))}return P}function lI(e,n,a){var c=xd(e),u=c.getUint32(8,!0),m=12,x=-1,o=-1,E=NaN,w=NaN,C=new Date(2001,0,1);u&1&&(E=aI(e,m),m+=16),u&2&&(w=c.getFloat64(m,!0),m+=8),u&4&&(C.setTime(C.getTime()+c.getFloat64(m,!0)*1e3),m+=8),u&8&&(o=c.getUint32(m,!0),m+=4),u&16&&(x=c.getUint32(m,!0),m+=4);var P;switch(e[1]){case 0:break;case 2:P={t:"n",v:E};break;case 3:P={t:"s",v:n[o]};break;case 5:P={t:"d",v:C};break;case 6:P={t:"b",v:w>0};break;case 7:P={t:"n",v:w/86400};break;case 8:P={t:"e",v:0};break;case 9:if(x>-1)P={t:"s",v:a[x]};else throw new Error("Unsupported cell type ".concat(e[1]," : ").concat(u&31," : ").concat(e.slice(0,4)));break;case 10:P={t:"n",v:E};break;default:throw new Error("Unsupported cell type ".concat(e[1]," : ").concat(u&31," : ").concat(e.slice(0,4)))}return P}function cI(e,n,a){switch(e[0]){case 0:case 1:case 2:case 3:return oI(e,n,a,e[0]);case 5:return lI(e,n,a);default:throw new Error("Unsupported payload version ".concat(e[0]))}}function Rs(e){var n=hi(e);return Jc(n[1][0].data)}function Mg(e,n){var a=hi(n.data),c=Ba(a[1][0].data),u=a[3],m=[];return(u||[]).forEach(function(x){var o=hi(x.data),E=Ba(o[1][0].data)>>>0;switch(c){case 1:m[E]=z0(o[3][0].data);break;case 8:{var w=e[Rs(o[9][0].data)][0],C=hi(w.data),P=e[Rs(C[1][0].data)][0],M=Ba(P.meta[1][0].data);if(M!=2001)throw new Error("2000 unexpected reference to ".concat(M));var B=hi(P.data);m[E]=B[3].map(function(U){return z0(U.data)}).join("")}break}}),m}function uI(e,n){var a,c,u,m,x,o,E,w,C,P,M,B,U,N,j=hi(e),re=Ba(j[1][0].data)>>>0,pe=Ba(j[2][0].data)>>>0,X=((c=(a=j[8])==null?void 0:a[0])==null?void 0:c.data)&&Ba(j[8][0].data)>0||!1,le,ye;if((m=(u=j[7])==null?void 0:u[0])!=null&&m.data&&n!=0)le=(o=(x=j[7])==null?void 0:x[0])==null?void 0:o.data,ye=(w=(E=j[6])==null?void 0:E[0])==null?void 0:w.data;else if((P=(C=j[4])==null?void 0:C[0])!=null&&P.data&&n!=1)le=(B=(M=j[4])==null?void 0:M[0])==null?void 0:B.data,ye=(N=(U=j[3])==null?void 0:U[0])==null?void 0:N.data;else throw"NUMBERS Tile missing ".concat(n," cell storage");for(var we=X?4:1,ae=xd(le),ze=[],Ie=0;Ie<le.length/2;++Ie){var $e=ae.getUint16(Ie*2,!0);$e<65535&&ze.push([Ie,$e])}if(ze.length!=pe)throw"Expected ".concat(pe," cells, found ").concat(ze.length);var je=[];for(Ie=0;Ie<ze.length-1;++Ie)je[ze[Ie][0]]=ye.subarray(ze[Ie][1]*we,ze[Ie+1][1]*we);return ze.length>=1&&(je[ze[ze.length-1][0]]=ye.subarray(ze[ze.length-1][1]*we)),{R:re,cells:je}}function hI(e,n){var a,c=hi(n.data),u=(a=c?.[7])!=null&&a[0]?Ba(c[7][0].data)>>>0>0?1:0:-1,m=_d(c[5],function(x){return uI(x,u)});return{nrows:Ba(c[4][0].data)>>>0,data:m.reduce(function(x,o){return x[o.R]||(x[o.R]=[]),o.cells.forEach(function(E,w){if(x[o.R][w])throw new Error("Duplicate cell r=".concat(o.R," c=").concat(w));x[o.R][w]=E}),x},[])}}function fI(e,n,a){var c,u=hi(n.data),m={s:{r:0,c:0},e:{r:0,c:0}};if(m.e.r=(Ba(u[6][0].data)>>>0)-1,m.e.r<0)throw new Error("Invalid row varint ".concat(u[6][0].data));if(m.e.c=(Ba(u[7][0].data)>>>0)-1,m.e.c<0)throw new Error("Invalid col varint ".concat(u[7][0].data));a["!ref"]=Fr(m);var x=hi(u[4][0].data),o=Mg(e,e[Rs(x[4][0].data)][0]),E=(c=x[17])!=null&&c[0]?Mg(e,e[Rs(x[17][0].data)][0]):[],w=hi(x[3][0].data),C=0;w[1].forEach(function(P){var M=hi(P.data),B=e[Rs(M[2][0].data)][0],U=Ba(B.meta[1][0].data);if(U!=6002)throw new Error("6001 unexpected reference to ".concat(U));var N=hI(e,B);N.data.forEach(function(j,re){j.forEach(function(pe,X){var le=fr({r:C+re,c:X}),ye=cI(pe,o,E);ye&&(a[le]=ye)})}),C+=N.nrows})}function dI(e,n){var a=hi(n.data),c={"!ref":"A1"},u=e[Rs(a[2][0].data)],m=Ba(u[0].meta[1][0].data);if(m!=6001)throw new Error("6000 unexpected reference to ".concat(m));return fI(e,u[0],c),c}function pI(e,n){var a,c=hi(n.data),u={name:(a=c[1])!=null&&a[0]?z0(c[1][0].data):"",sheets:[]},m=_d(c[2],Rs);return m.forEach(function(x){e[x].forEach(function(o){var E=Ba(o.meta[1][0].data);E==6e3&&u.sheets.push(dI(e,o))})}),u}function mI(e,n){var a=wd(),c=hi(n.data),u=_d(c[1],Rs);if(u.forEach(function(m){e[m].forEach(function(x){var o=Ba(x.meta[1][0].data);if(o==2){var E=pI(e,x);E.sheets.forEach(function(w,C){bd(a,w,C==0?E.name:E.name+"_"+C,!0)})}})}),a.SheetNames.length==0)throw new Error("Empty NUMBERS file");return a}function y0(e){var n,a,c,u,m={},x=[];if(e.FullPaths.forEach(function(E){if(E.match(/\.iwpv2/))throw new Error("Unsupported password protection")}),e.FileIndex.forEach(function(E){if(E.name.match(/\.iwa$/)){var w;try{w=sI(E.content)}catch(P){return console.log("?? "+E.content.length+" "+(P.message||P))}var C;try{C=iI(w)}catch(P){return console.log("## "+(P.message||P))}C.forEach(function(P){m[P.id]=P.messages,x.push(P.id)})}}),!x.length)throw new Error("File has no messages");var o=((u=(c=(a=(n=m?.[1])==null?void 0:n[0])==null?void 0:a.meta)==null?void 0:c[1])==null?void 0:u[0].data)&&Ba(m[1][0].meta[1][0].data)==1&&m[1][0];if(o||x.forEach(function(E){m[E].forEach(function(w){var C=Ba(w.meta[1][0].data)>>>0;if(C==1)if(!o)o=w;else throw new Error("Document has multiple roots")})}),!o)throw new Error("Cannot find Document root");return mI(m,o)}function gI(e){return function(a){for(var c=0;c!=e.length;++c){var u=e[c];a[u[0]]===void 0&&(a[u[0]]=u[1]),u[2]==="n"&&(a[u[0]]=Number(a[u[0]]))}}}function yd(e){gI([["cellNF",!1],["cellHTML",!0],["cellFormula",!0],["cellStyles",!1],["cellText",!0],["cellDates",!1],["sheetStubs",!1],["sheetRows",0,"n"],["bookDeps",!1],["bookSheets",!1],["bookProps",!1],["bookFiles",!1],["bookVBA",!1],["password",""],["WTF",!1]])(e)}function xI(e){return dl.WS.indexOf(e)>-1?"sheet":e==dl.CS?"chart":e==dl.DS?"dialog":e==dl.MS?"macro":e&&e.length?e:"sheet"}function _I(e,n){if(!e)return 0;try{e=n.map(function(c){return c.id||(c.id=c.strRelID),[c.name,e["!id"][c.id].Target,xI(e["!id"][c.id].Type)]})}catch{return null}return!e||e.length===0?null:e}function yI(e,n,a,c,u,m,x,o,E,w,C,P){try{m[c]=Nc(qi(e,a,!0),n);var M=ka(e,n),B;switch(o){case"sheet":B=SA(M,n,u,E,m[c],w,C,P);break;case"chart":if(B=kA(M,n,u,E,m[c],w,C,P),!B||!B["!drawel"])break;var U=Lc(B["!drawel"].Target,n),N=D0(U),j=EC(qi(e,U,!0),Nc(qi(e,N,!0),U)),re=Lc(j,U),pe=D0(re);B=lA(qi(e,re,!0),re,E,Nc(qi(e,pe,!0),re),w,B);break;case"macro":B=CA(M,n,u,E,m[c],w,C,P);break;case"dialog":B=AA(M,n,u,E,m[c],w,C,P);break;default:throw new Error("Unrecognized sheet type "+o)}x[c]=B;var X=[];m&&m[c]&&zn(m[c]).forEach(function(le){var ye="";if(m[c][le].Type==dl.CMNT){ye=Lc(m[c][le].Target,n);var we=MA(ka(e,ye,!0),ye,E);if(!we||!we.length)return;xg(B,we,!1)}m[c][le].Type==dl.TCMNT&&(ye=Lc(m[c][le].Target,n),X=X.concat(kC(ka(e,ye,!0),E)))}),X&&X.length&&xg(B,X,!0,E.people||[])}catch(le){if(E.WTF)throw le}}function an(e){return e.charAt(0)=="/"?e.slice(1):e}function vI(e,n){if(y1(),n=n||{},yd(n),sn(e,"META-INF/manifest.xml")||sn(e,"objectdata.xml"))return Ig(e,n);if(sn(e,"Index/Document.iwa")){if(typeof Uint8Array>"u")throw new Error("NUMBERS file parsing requires Uint8Array support");if(typeof y0<"u"){if(e.FileIndex)return y0(e);var a=Ir.utils.cfb_new();return Gm(e).forEach(function(ft){wT(a,ft,S1(e,ft))}),y0(a)}throw new Error("Unsupported NUMBERS file")}if(!sn(e,"[Content_Types].xml"))throw sn(e,"index.xml.gz")?new Error("Unsupported NUMBERS 08 file"):sn(e,"index.xml")?new Error("Unsupported NUMBERS 09 file"):new Error("Unsupported ZIP file");var c=Gm(e),u=gE(qi(e,"[Content_Types].xml")),m=!1,x,o;if(u.workbooks.length===0&&(o="xl/workbook.xml",ka(e,o,!0)&&u.workbooks.push(o)),u.workbooks.length===0){if(o="xl/workbook.bin",!ka(e,o,!0))throw new Error("Could not find workbook");u.workbooks.push(o),m=!0}u.workbooks[0].slice(-3)=="bin"&&(m=!0);var E={},w={};if(!n.bookSheets&&!n.bookProps){if($c=[],u.sst)try{$c=PA(ka(e,an(u.sst)),u.sst,n)}catch(ft){if(n.WTF)throw ft}n.cellStyles&&u.themes.length&&(E=FA(qi(e,u.themes[0].replace(/^\//,""),!0)||"",u.themes[0],n)),u.style&&(w=IA(ka(e,an(u.style)),u.style,E,n))}u.links.map(function(ft){try{var ct=Nc(qi(e,D0(an(ft))),ft);return LA(ka(e,an(ft)),ct,ft,n)}catch{}});var C=EA(ka(e,an(u.workbooks[0])),u.workbooks[0],n),P={},M="";u.coreprops.length&&(M=ka(e,an(u.coreprops[0]),!0),M&&(P=X1(M)),u.extprops.length!==0&&(M=ka(e,an(u.extprops[0]),!0),M&&wE(M,P,n)));var B={};(!n.bookSheets||n.bookProps)&&u.custprops.length!==0&&(M=qi(e,an(u.custprops[0]),!0),M&&(B=TE(M,n)));var U={};if((n.bookSheets||n.bookProps)&&(C.Sheets?x=C.Sheets.map(function(ct){return ct.name}):P.Worksheets&&P.SheetNames.length>0&&(x=P.SheetNames),n.bookProps&&(U.Props=P,U.Custprops=B),n.bookSheets&&typeof x<"u"&&(U.SheetNames=x),n.bookSheets?U.SheetNames:n.bookProps))return U;x={};var N={};n.bookDeps&&u.calcchain&&(N=DA(ka(e,an(u.calcchain)),u.calcchain));var j=0,re={},pe,X;{var le=C.Sheets;P.Worksheets=le.length,P.SheetNames=[];for(var ye=0;ye!=le.length;++ye)P.SheetNames[ye]=le[ye].name}var we=m?"bin":"xml",ae=u.workbooks[0].lastIndexOf("/"),ze=(u.workbooks[0].slice(0,ae+1)+"_rels/"+u.workbooks[0].slice(ae+1)+".rels").replace(/^\//,"");sn(e,ze)||(ze="xl/_rels/workbook."+we+".rels");var Ie=Nc(qi(e,ze,!0),ze.replace(/_rels.*/,"s5s"));(u.metadata||[]).length>=1&&(n.xlmeta=RA(ka(e,an(u.metadata[0])),u.metadata[0],n)),(u.people||[]).length>=1&&(n.people=CC(ka(e,an(u.people[0])),n)),Ie&&(Ie=_I(Ie,C.Sheets));var $e=ka(e,"xl/worksheets/sheet.xml",!0)?1:0;e:for(j=0;j!=P.Worksheets;++j){var je="sheet";if(Ie&&Ie[j]?(pe="xl/"+Ie[j][1].replace(/[\/]?xl\//,""),sn(e,pe)||(pe=Ie[j][1]),sn(e,pe)||(pe=ze.replace(/_rels\/.*$/,"")+Ie[j][1]),je=Ie[j][2]):(pe="xl/worksheets/sheet"+(j+1-$e)+"."+we,pe=pe.replace(/sheet0\./,"sheet.")),X=pe.replace(/^(.*)(\/)([^\/]*)$/,"$1/_rels/$3.rels"),n&&n.sheets!=null)switch(typeof n.sheets){case"number":if(j!=n.sheets)continue e;break;case"string":if(P.SheetNames[j].toLowerCase()!=n.sheets.toLowerCase())continue e;break;default:if(Array.isArray&&Array.isArray(n.sheets)){for(var Le=!1,it=0;it!=n.sheets.length;++it)typeof n.sheets[it]=="number"&&n.sheets[it]==j&&(Le=1),typeof n.sheets[it]=="string"&&n.sheets[it].toLowerCase()==P.SheetNames[j].toLowerCase()&&(Le=1);if(!Le)continue e}}yI(e,pe,X,P.SheetNames[j],j,re,x,je,n,C,E,w)}return U={Directory:u,Workbook:C,Props:P,Custprops:B,Deps:N,Sheets:x,SheetNames:P.SheetNames,Strings:$c,Styles:w,Themes:E,SSF:Ja(gr)},n&&n.bookFiles&&(e.files?(U.keys=c,U.files=e.files):(U.keys=[],U.files={},e.FullPaths.forEach(function(ft,ct){ft=ft.replace(/^Root Entry[\/]/,""),U.keys.push(ft),U.files[ft]=e.FileIndex[ct]}))),n&&n.bookVBA&&(u.vba.length>0?U.vbaraw=ka(e,an(u.vba[0]),!0):u.defaults&&u.defaults.bin===PC&&(U.vbaraw=ka(e,"xl/vbaProject.bin",!0))),U}function wI(e,n){var a=n||{},c="Workbook",u=Ir.find(e,c);try{if(c="/!DataSpaces/Version",u=Ir.find(e,c),!u||!u.content)throw new Error("ECMA-376 Encrypted file missing "+c);if(dk(u.content),c="/!DataSpaces/DataSpaceMap",u=Ir.find(e,c),!u||!u.content)throw new Error("ECMA-376 Encrypted file missing "+c);var m=mk(u.content);if(m.length!==1||m[0].comps.length!==1||m[0].comps[0].t!==0||m[0].name!=="StrongEncryptionDataSpace"||m[0].comps[0].v!=="EncryptedPackage")throw new Error("ECMA-376 Encrypted file bad "+c);if(c="/!DataSpaces/DataSpaceInfo/StrongEncryptionDataSpace",u=Ir.find(e,c),!u||!u.content)throw new Error("ECMA-376 Encrypted file missing "+c);var x=gk(u.content);if(x.length!=1||x[0]!="StrongEncryptionTransform")throw new Error("ECMA-376 Encrypted file bad "+c);if(c="/!DataSpaces/TransformInfo/StrongEncryptionTransform/!Primary",u=Ir.find(e,c),!u||!u.content)throw new Error("ECMA-376 Encrypted file missing "+c);_k(u.content)}catch{}if(c="/EncryptionInfo",u=Ir.find(e,c),!u||!u.content)throw new Error("ECMA-376 Encrypted file missing "+c);var o=yk(u.content);if(c="/EncryptedPackage",u=Ir.find(e,c),!u||!u.content)throw new Error("ECMA-376 Encrypted file missing "+c);if(o[0]==4&&typeof decrypt_agile<"u")return decrypt_agile(o[1],u.content,a.password||"",a);if(o[0]==2&&typeof decrypt_std76<"u")return decrypt_std76(o[1],u.content,a.password||"",a);throw new Error("File is password-protected")}function vd(e,n){var a="";switch((n||{}).type||"base64"){case"buffer":return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]];case"base64":a=Zi(e.slice(0,12));break;case"binary":a=e;break;case"array":return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]];default:throw new Error("Unrecognized type "+(n&&n.type||"undefined"))}return[a.charCodeAt(0),a.charCodeAt(1),a.charCodeAt(2),a.charCodeAt(3),a.charCodeAt(4),a.charCodeAt(5),a.charCodeAt(6),a.charCodeAt(7)]}function bI(e,n){return Ir.find(e,"EncryptedPackage")?wI(e,n):Dx(e,n)}function TI(e,n){var a,c=e,u=n||{};return u.type||(u.type=kr&&Buffer.isBuffer(e)?"buffer":"base64"),a=k1(c,u),vI(a,u)}function Bx(e,n){var a=0;e:for(;a<e.length;)switch(e.charCodeAt(a)){case 10:case 13:case 32:++a;break;case 60:return O0(e.slice(a),n);default:break e}return Xc.to_workbook(e,n)}function EI(e,n){var a="",c=vd(e,n);switch(n.type){case"base64":a=Zi(e);break;case"binary":a=e;break;case"buffer":a=e.toString("binary");break;case"array":a=go(e);break;default:throw new Error("Unrecognized type "+n.type)}return c[0]==239&&c[1]==187&&c[2]==191&&(a=Xr(a)),n.type="binary",Bx(a,n)}function SI(e,n){var a=e;return n.type=="base64"&&(a=Zi(a)),a=Fs.utils.decode(1200,a.slice(2),"str"),n.type="binary",Bx(a,n)}function kI(e){return e.match(/[^\x00-\x7F]/)?Rc(e):e}function v0(e,n,a,c){return c?(a.type="string",Xc.to_workbook(e,a)):Xc.to_workbook(n,a)}function U0(e,n){o1();var a=n||{};if(typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer)return U0(new Uint8Array(e),(a=Ja(a),a.type="array",a));typeof Uint8Array<"u"&&e instanceof Uint8Array&&!a.type&&(a.type=typeof Deno<"u"?"buffer":"array");var c=e,u=[0,0,0,0],m=!1;if(a.cellStyles&&(a.cellNF=!0,a.sheetStubs=!0),gl={},a.dateNF&&(gl.dateNF=a.dateNF),a.type||(a.type=kr&&Buffer.isBuffer(e)?"buffer":"base64"),a.type=="file"&&(a.type=kr?"buffer":"binary",c=pT(e),typeof Uint8Array<"u"&&!kr&&(a.type="array")),a.type=="string"&&(m=!0,a.type="binary",a.codepage=65001,c=kI(e)),a.type=="array"&&typeof Uint8Array<"u"&&e instanceof Uint8Array&&typeof ArrayBuffer<"u"){var x=new ArrayBuffer(3),o=new Uint8Array(x);if(o.foo="bar",!o.foo)return a=Ja(a),a.type="array",U0(J0(c),a)}switch((u=vd(c,a))[0]){case 208:if(u[1]===207&&u[2]===17&&u[3]===224&&u[4]===161&&u[5]===177&&u[6]===26&&u[7]===225)return bI(Ir.read(c,a),a);break;case 9:if(u[1]<=8)return Dx(c,a);break;case 60:return O0(c,a);case 73:if(u[1]===73&&u[2]===42&&u[3]===0)throw new Error("TIFF Image File is not a spreadsheet");if(u[1]===68)return ek(c,a);break;case 84:if(u[1]===65&&u[2]===66&&u[3]===76)return JS.to_workbook(c,a);break;case 80:return u[1]===75&&u[2]<9&&u[3]<9?TI(c,a):v0(e,c,a,m);case 239:return u[3]===60?O0(c,a):v0(e,c,a,m);case 255:if(u[1]===254)return SI(c,a);if(u[1]===0&&u[2]===2&&u[3]===0)return Vc.to_workbook(c,a);break;case 0:if(u[1]===0&&(u[2]>=2&&u[3]===0||u[2]===0&&(u[3]===8||u[3]===9)))return Vc.to_workbook(c,a);break;case 3:case 131:case 139:case 140:return gg.to_workbook(c,a);case 123:if(u[1]===92&&u[2]===114&&u[3]===116)return Pk.to_workbook(c,a);break;case 10:case 13:case 32:return EI(c,a);case 137:if(u[1]===80&&u[2]===78&&u[3]===71)throw new Error("PNG Image File is not a spreadsheet");break}return KS.indexOf(u[0])>-1&&u[2]<=12&&u[3]<=31?gg.to_workbook(c,a):v0(e,c,a,m)}function CI(e,n,a,c,u,m,x,o){var E=Qa(a),w=o.defval,C=o.raw||!Object.prototype.hasOwnProperty.call(o,"raw"),P=!0,M=u===1?[]:{};if(u!==1)if(Object.defineProperty)try{Object.defineProperty(M,"__rowNum__",{value:a,enumerable:!1})}catch{M.__rowNum__=a}else M.__rowNum__=a;if(!x||e[a])for(var B=n.s.c;B<=n.e.c;++B){var U=x?e[a][B]:e[c[B]+E];if(U===void 0||U.t===void 0){if(w===void 0)continue;m[B]!=null&&(M[m[B]]=w);continue}var N=U.v;switch(U.t){case"z":if(N==null)break;continue;case"e":N=N==0?null:void 0;break;case"s":case"d":case"b":case"n":break;default:throw new Error("unrecognized type "+U.t)}if(m[B]!=null){if(N==null)if(U.t=="e"&&N===null)M[m[B]]=null;else if(w!==void 0)M[m[B]]=w;else if(C&&N===null)M[m[B]]=null;else continue;else M[m[B]]=C&&(U.t!=="n"||U.t==="n"&&o.rawNumbers!==!1)?N:ls(U,N,o);N!=null&&(P=!1)}}return{row:M,isempty:P}}function V0(e,n){if(e==null||e["!ref"]==null)return[];var a={t:"n",v:0},c=0,u=1,m=[],x=0,o="",E={s:{r:0,c:0},e:{r:0,c:0}},w=n||{},C=w.range!=null?w.range:e["!ref"];switch(w.header===1?c=1:w.header==="A"?c=2:Array.isArray(w.header)?c=3:w.header==null&&(c=0),typeof C){case"string":E=pa(C);break;case"number":E=pa(e["!ref"]),E.s.r=C;break;default:E=C}c>0&&(u=0);var P=Qa(E.s.r),M=[],B=[],U=0,N=0,j=Array.isArray(e),re=E.s.r,pe=0,X={};j&&!e[re]&&(e[re]=[]);var le=w.skipHidden&&e["!cols"]||[],ye=w.skipHidden&&e["!rows"]||[];for(pe=E.s.c;pe<=E.e.c;++pe)if(!(le[pe]||{}).hidden)switch(M[pe]=Oa(pe),a=j?e[re][pe]:e[M[pe]+P],c){case 1:m[pe]=pe-E.s.c;break;case 2:m[pe]=M[pe];break;case 3:m[pe]=w.header[pe-E.s.c];break;default:if(a==null&&(a={w:"__EMPTY",t:"s"}),o=x=ls(a,null,w),N=X[x]||0,!N)X[x]=1;else{do o=x+"_"+N++;while(X[o]);X[x]=N,X[o]=1}m[pe]=o}for(re=E.s.r+u;re<=E.e.r;++re)if(!(ye[re]||{}).hidden){var we=CI(e,E,re,M,c,m,j,w);(we.isempty===!1||(c===1?w.blankrows!==!1:w.blankrows))&&(B[U++]=we.row)}return B.length=U,B}var Dg=/"/g;function AI(e,n,a,c,u,m,x,o){for(var E=!0,w=[],C="",P=Qa(a),M=n.s.c;M<=n.e.c;++M)if(c[M]){var B=o.dense?(e[a]||[])[M]:e[c[M]+P];if(B==null)C="";else if(B.v!=null){E=!1,C=""+(o.rawNumbers&&B.t=="n"?B.v:ls(B,null,o));for(var U=0,N=0;U!==C.length;++U)if((N=C.charCodeAt(U))===u||N===m||N===34||o.forceQuotes){C='"'+C.replace(Dg,'""')+'"';break}C=="ID"&&(C='"ID"')}else B.f!=null&&!B.F?(E=!1,C="="+B.f,C.indexOf(",")>=0&&(C='"'+C.replace(Dg,'""')+'"')):C="";w.push(C)}return o.blankrows===!1&&E?null:w.join(x)}function zx(e,n){var a=[],c=n??{};if(e==null||e["!ref"]==null)return"";var u=pa(e["!ref"]),m=c.FS!==void 0?c.FS:",",x=m.charCodeAt(0),o=c.RS!==void 0?c.RS:`
`,E=o.charCodeAt(0),w=new RegExp((m=="|"?"\\|":m)+"+$"),C="",P=[];c.dense=Array.isArray(e);for(var M=c.skipHidden&&e["!cols"]||[],B=c.skipHidden&&e["!rows"]||[],U=u.s.c;U<=u.e.c;++U)(M[U]||{}).hidden||(P[U]=Oa(U));for(var N=0,j=u.s.r;j<=u.e.r;++j)(B[j]||{}).hidden||(C=AI(e,u,j,P,x,E,m,c),C!=null&&(c.strip&&(C=C.replace(w,"")),(C||c.blankrows!==!1)&&a.push((N++?o:"")+C)));return delete c.dense,a.join("")}function II(e,n){n||(n={}),n.FS="	",n.RS=`
`;var a=zx(e,n);return a}function FI(e){var n="",a,c="";if(e==null||e["!ref"]==null)return[];var u=pa(e["!ref"]),m="",x=[],o,E=[],w=Array.isArray(e);for(o=u.s.c;o<=u.e.c;++o)x[o]=Oa(o);for(var C=u.s.r;C<=u.e.r;++C)for(m=Qa(C),o=u.s.c;o<=u.e.c;++o)if(n=x[o]+m,a=w?(e[C]||[])[o]:e[n],c="",a!==void 0){if(a.F!=null){if(n=a.F,!a.f)continue;c=a.f,n.indexOf(":")==-1&&(n=n+":"+n)}if(a.f!=null)c=a.f;else{if(a.t=="z")continue;if(a.t=="n"&&a.v!=null)c=""+a.v;else if(a.t=="b")c=a.v?"TRUE":"FALSE";else if(a.w!==void 0)c="'"+a.w;else{if(a.v===void 0)continue;a.t=="s"?c="'"+a.v:c=""+a.v}}E[E.length]=n+"="+c}return E}function Nx(e,n,a){var c=a||{},u=+!c.skipHeader,m=e||{},x=0,o=0;if(m&&c.origin!=null)if(typeof c.origin=="number")x=c.origin;else{var E=typeof c.origin=="string"?Ai(c.origin):c.origin;x=E.r,o=E.c}var w,C={s:{c:0,r:0},e:{c:o,r:x+n.length-1+u}};if(m["!ref"]){var P=pa(m["!ref"]);C.e.c=Math.max(C.e.c,P.e.c),C.e.r=Math.max(C.e.r,P.e.r),x==-1&&(x=P.e.r+1,C.e.r=x+n.length-1+u)}else x==-1&&(x=0,C.e.r=n.length-1+u);var M=c.header||[],B=0;n.forEach(function(N,j){zn(N).forEach(function(re){(B=M.indexOf(re))==-1&&(M[B=M.length]=re);var pe=N[re],X="z",le="",ye=fr({c:o+B,r:x+j+u});w=Qc(m,ye),pe&&typeof pe=="object"&&!(pe instanceof Date)?m[ye]=pe:(typeof pe=="number"?X="n":typeof pe=="boolean"?X="b":typeof pe=="string"?X="s":pe instanceof Date?(X="d",c.cellDates||(X="n",pe=Pi(pe)),le=c.dateNF||gr[14]):pe===null&&c.nullError&&(X="e",pe=0),w?(w.t=X,w.v=pe,delete w.w,delete w.R,le&&(w.z=le)):m[ye]=w={t:X,v:pe},le&&(w.z=le))})}),C.e.c=Math.max(C.e.c,o+M.length-1);var U=Qa(x);if(u)for(B=0;B<M.length;++B)m[Oa(B+o)+U]={t:"s",v:M[B]};return m["!ref"]=Fr(C),m}function PI(e,n){return Nx(null,e,n)}function Qc(e,n,a){if(typeof n=="string"){if(Array.isArray(e)){var c=Ai(n);return e[c.r]||(e[c.r]=[]),e[c.r][c.c]||(e[c.r][c.c]={t:"z"})}return e[n]||(e[n]={t:"z"})}return typeof n!="number"?Qc(e,fr(n)):Qc(e,fr({r:n,c:a||0}))}function MI(e,n){if(typeof n=="number"){if(n>=0&&e.SheetNames.length>n)return n;throw new Error("Cannot find sheet # "+n)}else if(typeof n=="string"){var a=e.SheetNames.indexOf(n);if(a>-1)return a;throw new Error("Cannot find sheet name |"+n+"|")}else throw new Error("Cannot find sheet |"+n+"|")}function wd(){return{SheetNames:[],Sheets:{}}}function bd(e,n,a,c){var u=1;if(!a)for(;u<=65535&&e.SheetNames.indexOf(a="Sheet"+u)!=-1;++u,a=void 0);if(!a||e.SheetNames.length>=65535)throw new Error("Too many worksheets");if(c&&e.SheetNames.indexOf(a)>=0){var m=a.match(/(^.*?)(\d+)$/);u=m&&+m[2]||0;var x=m&&m[1]||a;for(++u;u<=65535&&e.SheetNames.indexOf(a=x+u)!=-1;++u);}if(gA(a),e.SheetNames.indexOf(a)>=0)throw new Error("Worksheet with name |"+a+"| already exists!");return e.SheetNames.push(a),e.Sheets[a]=n,a}function DI(e,n,a){e.Workbook||(e.Workbook={}),e.Workbook.Sheets||(e.Workbook.Sheets=[]);var c=MI(e,n);switch(e.Workbook.Sheets[c]||(e.Workbook.Sheets[c]={}),a){case 0:case 1:case 2:break;default:throw new Error("Bad sheet visibility setting "+a)}e.Workbook.Sheets[c].Hidden=a}function LI(e,n){return e.z=n,e}function Ux(e,n,a){return n?(e.l={Target:n},a&&(e.l.Tooltip=a)):delete e.l,e}function RI(e,n,a){return Ux(e,"#"+n,a)}function OI(e,n,a){e.c||(e.c=[]),e.c.push({t:n,a:a||"SheetJS"})}function BI(e,n,a,c){for(var u=typeof n!="string"?n:pa(n),m=typeof n=="string"?n:Fr(n),x=u.s.r;x<=u.e.r;++x)for(var o=u.s.c;o<=u.e.c;++o){var E=Qc(e,x,o);E.t="n",E.F=m,delete E.v,x==u.s.r&&o==u.s.c&&(E.f=a,c&&(E.D=!0))}return e}var zI={encode_col:Oa,encode_row:Qa,encode_cell:fr,encode_range:Fr,decode_col:od,decode_row:sd,split_cell:XT,decode_cell:Ai,decode_range:Tl,format_cell:ls,sheet_add_aoa:G1,sheet_add_json:Nx,sheet_add_dom:Lx,aoa_to_sheet:El,json_to_sheet:PI,table_to_sheet:Rx,table_to_book:eI,sheet_to_csv:zx,sheet_to_txt:II,sheet_to_json:V0,sheet_to_html:QA,sheet_to_formulae:FI,sheet_to_row_object_array:V0,sheet_get_cell:Qc,book_new:wd,book_append_sheet:bd,book_set_sheet_visibility:DI,cell_set_number_format:LI,cell_set_hyperlink:Ux,cell_set_internal_link:RI,cell_add_comment:OI,sheet_set_array_formula:BI,consts:{SHEET_VISIBLE:0,SHEET_HIDDEN:1,SHEET_VERY_HIDDEN:2}};function NI({listCustomer:e,handleCustomer:n}){const[a,c]=Ah.useMessage(),[u,m]=he.useState("list"),[x,o]=he.useState(!1),[E,w]=he.useState(!1),[C,P]=he.useState([]),M=le=>{a.open({type:"warning",content:le})},B=(le="error")=>{a.open({type:"error",content:le})},U=(le="Success")=>{a.open({type:"success",content:le})},N=le=>{switch(le){case"Choose":o(!1);break;case"Import":w(!1);break;default:o(!1),w(!1)}},j=le=>{switch(le){case"Choose":o(!0);break;case"Import":w(!0);break}},re=async le=>{const ye=new FileReader;ye.onload=we=>{const ae=new Uint8Array(we.target.result),ze=U0(ae,{type:"array"}),Ie=ze.SheetNames[0],$e=ze.Sheets[Ie],je=zI.sheet_to_json($e);console.log("json_data",je),P(je)},ye.readAsArrayBuffer(le)},pe=async()=>{const ye=a1(C,["Mã khách hàng","Thứ tự VT","Tần suất"],{isNull:!1}).map(we=>we["Mã khách hàng"]).filter(we=>!!we&&!e.map(ae=>ae.customer_code).includes(we));try{const we=await on.post("/api/method/mbw_dms.api.router.get_customer_import",{customer_codes:ye});console.log("rsImport:::",we),n(ae=>[...ae,...we.result]),M(we.message),w(!1)}catch{B()}},X=he.useCallback(async()=>{const le=e.filter(ae=>ae.longitude&&ae.latitude),ye=e.filter(ae=>!(ae.longitude&&ae.latitude)),we=le.map((ae,ze)=>({id:ze,customer:ae.name,long:ae.longitude,lat:ae.latitude}));try{const Ie=(await on.post("/api/method/mbw_dms.api.helpers.optimal_router.optimal_router",{locations:we})).result.map($e=>le.find(Le=>Le.name==$e.customer));n([...Ie,...ye]),U()}catch(ae){B(ae?.response?.data?.message||"Something was wrong")}},[e]);return Je.jsxs(Je.Fragment,{children:[c,Je.jsxs(ho,{gutter:16,className:"justify-between p-4 pb-5 pt-10 mt-0",children:[Je.jsx(Si,{children:Je.jsxs(ho,{gutter:8,children:[Je.jsx(Si,{span:9,className:"text-[#1677ff]",children:Je.jsx(Ni,{children:Je.jsx(Tv,{defaultValue:"add",options:Uw,onSelect:j})})}),Je.jsx(Si,{span:7,children:Je.jsx(uo,{className:"w-full flex items-center text-[#1677ff] bg-[#1877f214] h-[36px]",icon:Je.jsx(Lw,{}),onClick:X,children:"Tối ưu tuyến"})}),Je.jsx(Si,{span:8,children:Je.jsx(Ni,{children:Je.jsx(Ch,{placeholder:"Tìm kiếm khách hàng",prefix:Je.jsx(Wg,{})})})})]})}),Je.jsxs(Si,{children:[" ",Je.jsxs(a0.Group,{defaultValue:u,onChange:le=>m(le.target.value),size:"middle",children:[Je.jsx(a0.Button,{value:"list",children:Je.jsx(Ow,{size:28})}),Je.jsx(a0.Button,{value:"map",children:Je.jsx(Rw,{size:28})})]})]})]}),Je.jsx("div",{children:u=="list"?Je.jsx(Ww,{data:e,handleData:n}):Je.jsx(Mb,{data:e})}),Je.jsx(k0,{width:1240,open:x,onCancel:N.bind(null,"Choose"),title:Je.jsx("strong",{className:"text-xl",children:"Chọn khách hàng"}),footer:!1,children:Je.jsx(Bb,{selected:e,handleAdd:n,closeModal:o.bind(null,!1)})}),Je.jsx(k0,{width:777,open:E,onCancel:N.bind(null,"Import"),okText:"Tiếp tục",cancelText:"Hủy",title:Je.jsxs(Je.Fragment,{children:[Je.jsx("strong",{className:"text-xl",children:"Nhập dữ liệu khách hàng"}),Je.jsx("br",{}),Je.jsxs(uo,{type:"link",className:"px-0",children:["Tải về file mẫu ",Je.jsx(e1,{})]})]}),onOk:pe,children:Je.jsx(Lb,{handleFile:re})})]})}function UI(){const[e]=S0.useForm(),n=Ev(),{type:a}=Sv(),[c,u]=he.useState([]),[m,x]=Ah.useMessage(),[o,E]=he.useState(),w=()=>{m.open({type:"success",content:"Success!!"})},C=()=>{m.open({type:"error",content:"Something was wrong"})},P=he.useCallback(async B=>{B={...B,customers:c.map(U=>{let N=["customer_id","customer_code","customer_name","display_address","phone_number","customer","frequency","latitude","longitude"];for(let j in U)N.includes(j)||delete U[j];return U})};try{await on.post("/api/method/mbw_dms.api.router.create_router",B),w(),n("/router-control")}catch(U){C(),console.log("error create",U)}},[c]),M=he.useCallback(async B=>{B={...B,customers:c.map(U=>{let N=["customer_id","customer_code","customer_name","display_address","phone_number","customer","frequency","lat","long"];for(let j in U)N.includes(j)||delete U[j];return U})};try{await on.patch("/api/method/mbw_dms.api.router.update_router",{name:a,...B}),w(),n("/router-control")}catch(U){C(),console.log("error create",U)}},[c]);return he.useEffect(()=>{a!=="create-dms-router"&&(async()=>{const B=await on.get("/api/method/mbw_dms.api.router.get_router",{params:{id:a}});E(B.result),B.result&&e.setFieldsValue(B.result),u(B.result?.customers||[])})()},[a]),Je.jsxs(Je.Fragment,{children:[x,Je.jsx(Pv,{title:"Thêm tuyến",buttons:[o?{label:"Lưu",action:e.submit,type:"primary"}:{label:"Thêm",action:e.submit,type:"primary"}]}),Je.jsx("div",{className:"bg-white rounded-md",children:Je.jsx(S0,{layout:"vertical",form:e,onFinish:o?M:P,children:Je.jsx(Mv,{defaultActiveKey:"1",items:[{label:Je.jsx("p",{className:"px-4 mb-0",children:" Thông tin chung"}),key:"1",children:Je.jsx(Hw,{form:e})},{label:Je.jsx("p",{className:"px-4 mb-0",children:"Khách hàng"}),key:"2",children:Je.jsx(NI,{handleCustomer:u,listCustomer:c})}],indicatorSize:B=>B-18})})})]})}function ZI(){return Je.jsxs(Je.Fragment,{children:[Je.jsx(kv,{children:Je.jsx("title",{children:" RouterControll"})}),Je.jsx(UI,{})]})}export{ZI as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/mapbox-gl-ECBi2DK5.js","assets/index-7Ylm8Oqy.js","assets/index-whDyfeiu.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
