import{r as k,A as Ia,_ as mi,a as ii,c as Tt,b as oi,K as an,R as ti,d as Nn,C as Np,e as Ta,f as ri,g as qi,h as Jo,i as tl,m as il,k as Ka,l as js,n as jp,o as jn,u as rl,p as Ku,q as Yu,E as Vp,s as Uu,t as Vs,v as jg,w as Vg,B as na,x as Up,y as qp,z as nl,D as Ug,F as Gp,G as jd,P as qg,I as Zp,J as Hp,M as Sc,N as Gg,O as Wp,Q as Zg,S as Hg,T as ct,U as Ju,V as Wg,W as Xg,X as Kg,Y as Yg,Z as Jg,$ as Qo,a0 as Qg,a1 as Qu,a2 as Xp,a3 as e_,a4 as t_,a5 as Kp,a6 as eh,a7 as Yp,a8 as Vd,a9 as i_,aa as r_,ab as n_,ac as a_,ad as Lu,ae as s_,af as qu,ag as o_,ah as Ud,ai as th,aj as l_,ak as c_,al as u_,am as Gu,an as Jp,ao as h_,ap as d_,aq as p_,ar as Qp,as as ef,at as tf,au as nn,av as rf,aw as f_,ax as qd,ay as Gd,az as m_,aA as g_,aB as __,aC as y_,aD as Zd,aE as Hd,aF as v_,j as Ee,aG as Os,aH as Vr,aI as Jr,aJ as vc,aK as $n,aL as ih,aM as x_,aN as b_,aO as w_,aP as Zu,aQ as S_,aR as nf,aS as C_,aT as Ru,H as T_}from"./index-tKi9Zbpi.js";import{D as I_}from"./index-lF2_SFrl.js";import{L as E_,a as P_}from"./index.esm-GIlV1lKk.js";import{H as M_}from"./header-page-oCzO2R44.js";var A_={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm32 664c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V456c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v272zm-32-344a48.01 48.01 0 010-96 48.01 48.01 0 010 96z"}}]},name:"info-circle",theme:"filled"};const k_=A_;var z_=function(m,b){return k.createElement(Ia,mi({},m,{ref:b,icon:k_}))};const af=k.forwardRef(z_);var sf=k.forwardRef(function(u,m){var b=u.prefixCls,w=u.style,T=u.className,A=u.duration,F=A===void 0?4.5:A,s=u.eventKey,j=u.content,L=u.closable,K=u.closeIcon,ne=K===void 0?"x":K,te=u.props,he=u.onClick,ye=u.onNoticeClose,be=u.times,Se=u.hovering,ve=k.useState(!1),we=ii(ve,2),ge=we[0],xe=we[1],Pe=Se||ge,Re=function(){ye(s)},Ne=function(Te){(Te.key==="Enter"||Te.code==="Enter"||Te.keyCode===an.ENTER)&&Re()};k.useEffect(function(){if(!Pe&&F>0){var Le=setTimeout(function(){Re()},F*1e3);return function(){clearTimeout(Le)}}},[F,Pe,be]);var Fe="".concat(b,"-notice");return k.createElement("div",mi({},te,{ref:m,className:Tt(Fe,T,oi({},"".concat(Fe,"-closable"),L)),style:w,onMouseEnter:function(Te){var Ue;xe(!0),te==null||(Ue=te.onMouseEnter)===null||Ue===void 0||Ue.call(te,Te)},onMouseLeave:function(Te){var Ue;xe(!1),te==null||(Ue=te.onMouseLeave)===null||Ue===void 0||Ue.call(te,Te)},onClick:he}),k.createElement("div",{className:"".concat(Fe,"-content")},j),L&&k.createElement("a",{tabIndex:0,className:"".concat(Fe,"-close"),onKeyDown:Ne,onClick:function(Te){Te.preventDefault(),Te.stopPropagation(),Re()}},ne))}),of=ti.createContext({}),D_=function(m){var b=m.children,w=m.classNames;return ti.createElement(of.Provider,{value:{classNames:w}},b)},Wd=8,Xd=3,Kd=16,L_=function(m){var b={offset:Wd,threshold:Xd,gap:Kd};if(m&&Nn(m)==="object"){var w,T,A;b.offset=(w=m.offset)!==null&&w!==void 0?w:Wd,b.threshold=(T=m.threshold)!==null&&T!==void 0?T:Xd,b.gap=(A=m.gap)!==null&&A!==void 0?A:Kd}return[!!m,b]},R_=["className","style","classNames","styles"],B_=function(m){var b,w=m.configList,T=m.placement,A=m.prefixCls,F=m.className,s=m.style,j=m.motion,L=m.onAllNoticeRemoved,K=m.onNoticeClose,ne=m.stack,te=k.useContext(of),he=te.classNames,ye=k.useRef({}),be=k.useState(null),Se=ii(be,2),ve=Se[0],we=Se[1],ge=k.useState([]),xe=ii(ge,2),Pe=xe[0],Re=xe[1],Ne=w.map(function(st){return{config:st,key:String(st.key)}}),Fe=L_(ne),Le=ii(Fe,2),Te=Le[0],Ue=Le[1],We=Ue.offset,tt=Ue.threshold,Xe=Ue.gap,at=Te&&(Pe.length>0||Ne.length<=tt),Ct=typeof j=="function"?j(T):j;return k.useEffect(function(){Te&&Pe.length>1&&Re(function(st){return st.filter(function(jt){return Ne.some(function(At){var Qt=At.key;return jt===Qt})})})},[Pe,Ne,Te]),k.useEffect(function(){var st;if(Te&&ye.current[(st=Ne[Ne.length-1])===null||st===void 0?void 0:st.key]){var jt;we(ye.current[(jt=Ne[Ne.length-1])===null||jt===void 0?void 0:jt.key])}},[Ne,Te]),ti.createElement(Np,mi({key:T,className:Tt(A,"".concat(A,"-").concat(T),he?.list,F,(b={},oi(b,"".concat(A,"-stack"),!!Te),oi(b,"".concat(A,"-stack-expanded"),at),b)),style:s,keys:Ne,motionAppear:!0},Ct,{onAllRemoved:function(){L(T)}}),function(st,jt){var At=st.config,Qt=st.className,Gt=st.style,ft=st.index,Be=At,gt=Be.key,$t=Be.times,bt=String(gt),Bt=At,Yt=Bt.className,ei=Bt.style,kt=Bt.classNames,gi=Bt.styles,pi=Ta(Bt,R_),Pt=Ne.findIndex(function(Gi){return Gi.key===bt}),li={};if(Te){var Xi=Ne.length-1-(Pt>-1?Pt:ft-1),Ht=T==="top"||T==="bottom"?"-50%":"0";if(Xi>0){var Mi,Oi,gr;li.height=at?(Mi=ye.current[bt])===null||Mi===void 0?void 0:Mi.offsetHeight:ve?.offsetHeight;for(var _e=0,bi=0;bi<Xi;bi++){var Di;_e+=((Di=ye.current[Ne[Ne.length-1-bi].key])===null||Di===void 0?void 0:Di.offsetHeight)+Xe}var Wt=(at?_e:Xi*We)*(T.startsWith("top")?1:-1),Ot=!at&&ve!==null&&ve!==void 0&&ve.offsetWidth&&(Oi=ye.current[bt])!==null&&Oi!==void 0&&Oi.offsetWidth?(ve?.offsetWidth-We*2*(Xi<3?Xi:3))/((gr=ye.current[bt])===null||gr===void 0?void 0:gr.offsetWidth):1;li.transform="translate3d(".concat(Ht,", ").concat(Wt,"px, 0) scaleX(").concat(Ot,")")}else li.transform="translate3d(".concat(Ht,", 0, 0)")}return ti.createElement("div",{ref:jt,className:Tt("".concat(A,"-notice-wrapper"),Qt,kt?.wrapper),style:ri(ri(ri({},Gt),li),gi?.wrapper),onMouseEnter:function(){return Re(function(Ki){return Ki.includes(bt)?Ki:[].concat(qi(Ki),[bt])})},onMouseLeave:function(){return Re(function(Ki){return Ki.filter(function(_i){return _i!==bt})})}},ti.createElement(sf,mi({},pi,{ref:function(Ki){Pt>-1?ye.current[bt]=Ki:delete ye.current[bt]},prefixCls:A,classNames:kt,styles:gi,className:Tt(Yt,he?.notice),style:ei,times:$t,key:gt,eventKey:gt,onNoticeClose:K,hovering:Te&&Pe.length>0})))})},F_=k.forwardRef(function(u,m){var b=u.prefixCls,w=b===void 0?"rc-notification":b,T=u.container,A=u.motion,F=u.maxCount,s=u.className,j=u.style,L=u.onAllRemoved,K=u.stack,ne=u.renderNotifications,te=k.useState([]),he=ii(te,2),ye=he[0],be=he[1],Se=function(Le){var Te,Ue=ye.find(function(We){return We.key===Le});Ue==null||(Te=Ue.onClose)===null||Te===void 0||Te.call(Ue),be(function(We){return We.filter(function(tt){return tt.key!==Le})})};k.useImperativeHandle(m,function(){return{open:function(Le){be(function(Te){var Ue=qi(Te),We=Ue.findIndex(function(at){return at.key===Le.key}),tt=ri({},Le);if(We>=0){var Xe;tt.times=(((Xe=Te[We])===null||Xe===void 0?void 0:Xe.times)||0)+1,Ue[We]=tt}else tt.times=0,Ue.push(tt);return F>0&&Ue.length>F&&(Ue=Ue.slice(-F)),Ue})},close:function(Le){Se(Le)},destroy:function(){be([])}}});var ve=k.useState({}),we=ii(ve,2),ge=we[0],xe=we[1];k.useEffect(function(){var Fe={};ye.forEach(function(Le){var Te=Le.placement,Ue=Te===void 0?"topRight":Te;Ue&&(Fe[Ue]=Fe[Ue]||[],Fe[Ue].push(Le))}),Object.keys(ge).forEach(function(Le){Fe[Le]=Fe[Le]||[]}),xe(Fe)},[ye]);var Pe=function(Le){xe(function(Te){var Ue=ri({},Te),We=Ue[Le]||[];return We.length||delete Ue[Le],Ue})},Re=k.useRef(!1);if(k.useEffect(function(){Object.keys(ge).length>0?Re.current=!0:Re.current&&(L?.(),Re.current=!1)},[ge]),!T)return null;var Ne=Object.keys(ge);return Jo.createPortal(k.createElement(k.Fragment,null,Ne.map(function(Fe){var Le=ge[Fe],Te=k.createElement(B_,{key:Fe,configList:Le,placement:Fe,prefixCls:w,className:s?.(Fe),style:j?.(Fe),motion:A,onNoticeClose:Se,onAllNoticeRemoved:Pe,stack:K});return ne?ne(Te,{prefixCls:w,key:Fe}):Te})),T)}),$_=["getContainer","motion","prefixCls","maxCount","className","style","onAllRemoved","stack","renderNotifications"],O_=function(){return document.body},Yd=0;function N_(){for(var u={},m=arguments.length,b=new Array(m),w=0;w<m;w++)b[w]=arguments[w];return b.forEach(function(T){T&&Object.keys(T).forEach(function(A){var F=T[A];F!==void 0&&(u[A]=F)})}),u}function j_(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},m=u.getContainer,b=m===void 0?O_:m,w=u.motion,T=u.prefixCls,A=u.maxCount,F=u.className,s=u.style,j=u.onAllRemoved,L=u.stack,K=u.renderNotifications,ne=Ta(u,$_),te=k.useState(),he=ii(te,2),ye=he[0],be=he[1],Se=k.useRef(),ve=k.createElement(F_,{container:ye,ref:Se,prefixCls:T,motion:w,maxCount:A,className:F,style:s,onAllRemoved:j,stack:L,renderNotifications:K}),we=k.useState([]),ge=ii(we,2),xe=ge[0],Pe=ge[1],Re=k.useMemo(function(){return{open:function(Fe){var Le=N_(ne,Fe);(Le.key===null||Le.key===void 0)&&(Le.key="rc-notification-".concat(Yd),Yd+=1),Pe(function(Te){return[].concat(qi(Te),[{type:"open",config:Le}])})},close:function(Fe){Pe(function(Le){return[].concat(qi(Le),[{type:"close",key:Fe}])})},destroy:function(){Pe(function(Fe){return[].concat(qi(Fe),[{type:"destroy"}])})}}},[]);return k.useEffect(function(){be(b())}),k.useEffect(function(){Se.current&&xe.length&&(xe.forEach(function(Ne){switch(Ne.type){case"open":Se.current.open(Ne.config);break;case"close":Se.current.close(Ne.key);break;case"destroy":Se.current.destroy();break}}),Pe(function(Ne){return Ne.filter(function(Fe){return!xe.includes(Fe)})}))},[xe]),[Re,ve]}const V_=u=>{const{componentCls:m,iconCls:b,boxShadow:w,colorText:T,colorSuccess:A,colorError:F,colorWarning:s,colorInfo:j,fontSizeLG:L,motionEaseInOutCirc:K,motionDurationSlow:ne,marginXS:te,paddingXS:he,borderRadiusLG:ye,zIndexPopup:be,contentPadding:Se,contentBg:ve}=u,we=`${m}-notice`,ge=new Ka("MessageMoveIn",{"0%":{padding:0,transform:"translateY(-100%)",opacity:0},"100%":{padding:he,transform:"translateY(0)",opacity:1}}),xe=new Ka("MessageMoveOut",{"0%":{maxHeight:u.height,padding:he,opacity:1},"100%":{maxHeight:0,padding:0,opacity:0}}),Pe={padding:he,textAlign:"center",[`${m}-custom-content > ${b}`]:{verticalAlign:"text-bottom",marginInlineEnd:te,fontSize:L},[`${we}-content`]:{display:"inline-block",padding:Se,background:ve,borderRadius:ye,boxShadow:w,pointerEvents:"all"},[`${m}-success > ${b}`]:{color:A},[`${m}-error > ${b}`]:{color:F},[`${m}-warning > ${b}`]:{color:s},[`${m}-info > ${b},
      ${m}-loading > ${b}`]:{color:j}};return[{[m]:Object.assign(Object.assign({},js(u)),{color:T,position:"fixed",top:te,width:"100%",pointerEvents:"none",zIndex:be,[`${m}-move-up`]:{animationFillMode:"forwards"},[`
        ${m}-move-up-appear,
        ${m}-move-up-enter
      `]:{animationName:ge,animationDuration:ne,animationPlayState:"paused",animationTimingFunction:K},[`
        ${m}-move-up-appear${m}-move-up-appear-active,
        ${m}-move-up-enter${m}-move-up-enter-active
      `]:{animationPlayState:"running"},[`${m}-move-up-leave`]:{animationName:xe,animationDuration:ne,animationPlayState:"paused",animationTimingFunction:K},[`${m}-move-up-leave${m}-move-up-leave-active`]:{animationPlayState:"running"},"&-rtl":{direction:"rtl",span:{direction:"rtl"}}})},{[m]:{[`${we}-wrapper`]:Object.assign({},Pe)}},{[`${m}-notice-pure-panel`]:Object.assign(Object.assign({},Pe),{padding:0,textAlign:"start"})}]},U_=u=>({zIndexPopup:u.zIndexPopupBase+jp+10,contentBg:u.colorBgElevated,contentPadding:`${(u.controlHeightLG-u.fontSize*u.lineHeight)/2}px ${u.paddingSM}px`}),lf=tl("Message",u=>{const m=il(u,{height:150});return[V_(m)]},U_);var q_=function(u,m){var b={};for(var w in u)Object.prototype.hasOwnProperty.call(u,w)&&m.indexOf(w)<0&&(b[w]=u[w]);if(u!=null&&typeof Object.getOwnPropertySymbols=="function")for(var T=0,w=Object.getOwnPropertySymbols(u);T<w.length;T++)m.indexOf(w[T])<0&&Object.prototype.propertyIsEnumerable.call(u,w[T])&&(b[w[T]]=u[w[T]]);return b};const G_={info:k.createElement(af,null),success:k.createElement(Ku,null),error:k.createElement(Yu,null),warning:k.createElement(Vp,null),loading:k.createElement(Uu,null)},cf=u=>{let{prefixCls:m,type:b,icon:w,children:T}=u;return k.createElement("div",{className:Tt(`${m}-custom-content`,`${m}-${b}`)},w||G_[b],k.createElement("span",null,T))},Z_=u=>{const{prefixCls:m,className:b,type:w,icon:T,content:A}=u,F=q_(u,["prefixCls","className","type","icon","content"]),{getPrefixCls:s}=k.useContext(jn),j=m||s("message"),L=rl(j),[K,ne,te]=lf(j,L);return K(k.createElement(sf,Object.assign({},F,{prefixCls:j,className:Tt(b,ne,`${j}-notice-pure-panel`,te,L),eventKey:"pure",duration:null,content:k.createElement(cf,{prefixCls:j,type:w,icon:T},A)})))},H_=Z_;function W_(u,m){return{motionName:m??`${u}-move-up`}}function rh(u){let m;const b=new Promise(T=>{m=u(()=>{T(!0)})}),w=()=>{m?.()};return w.then=(T,A)=>b.then(T,A),w.promise=b,w}var X_=function(u,m){var b={};for(var w in u)Object.prototype.hasOwnProperty.call(u,w)&&m.indexOf(w)<0&&(b[w]=u[w]);if(u!=null&&typeof Object.getOwnPropertySymbols=="function")for(var T=0,w=Object.getOwnPropertySymbols(u);T<w.length;T++)m.indexOf(w[T])<0&&Object.prototype.propertyIsEnumerable.call(u,w[T])&&(b[w[T]]=u[w[T]]);return b};const K_=8,Y_=3,J_=u=>{let{children:m,prefixCls:b}=u;const w=rl(b),[T,A,F]=lf(b,w);return T(k.createElement(D_,{classNames:{list:Tt(A,F,w)}},m))},Q_=(u,m)=>{let{prefixCls:b,key:w}=m;return k.createElement(J_,{prefixCls:b,key:w},u)},ey=k.forwardRef((u,m)=>{const{top:b,prefixCls:w,getContainer:T,maxCount:A,duration:F=Y_,rtl:s,transitionName:j,onAllRemoved:L}=u,{getPrefixCls:K,getPopupContainer:ne,message:te}=k.useContext(jn),he=w||K("message"),ye=()=>({left:"50%",transform:"translateX(-50%)",top:b??K_}),be=()=>Tt({[`${he}-rtl`]:s}),Se=()=>W_(he,j),ve=k.createElement("span",{className:`${he}-close-x`},k.createElement(Vs,{className:`${he}-close-icon`})),[we,ge]=j_({prefixCls:he,style:ye,className:be,motion:Se,closable:!1,closeIcon:ve,duration:F,getContainer:()=>T?.()||ne?.()||document.body,maxCount:A,onAllRemoved:L,renderNotifications:Q_});return k.useImperativeHandle(m,()=>Object.assign(Object.assign({},we),{prefixCls:he,message:te})),ge});let Jd=0;function uf(u){const m=k.useRef(null);return jg(),[k.useMemo(()=>{const w=j=>{var L;(L=m.current)===null||L===void 0||L.close(j)},T=j=>{if(!m.current){const Re=()=>{};return Re.then=()=>{},Re}const{open:L,prefixCls:K,message:ne}=m.current,te=`${K}-notice`,{content:he,icon:ye,type:be,key:Se,className:ve,style:we,onClose:ge}=j,xe=X_(j,["content","icon","type","key","className","style","onClose"]);let Pe=Se;return Pe==null&&(Jd+=1,Pe=`antd-message-${Jd}`),rh(Re=>(L(Object.assign(Object.assign({},xe),{key:Pe,content:k.createElement(cf,{prefixCls:K,type:be,icon:ye},he),placement:"top",className:Tt(be&&`${te}-${be}`,ve,ne?.className),style:Object.assign(Object.assign({},ne?.style),we),onClose:()=>{ge?.(),Re()}})),()=>{w(Pe)}))},F={open:T,destroy:j=>{var L;j!==void 0?w(j):(L=m.current)===null||L===void 0||L.destroy()}};return["info","success","warning","error","loading"].forEach(j=>{const L=(K,ne,te)=>{let he;K&&typeof K=="object"&&"content"in K?he=K:he={content:K};let ye,be;typeof ne=="function"?be=ne:(ye=ne,be=te);const Se=Object.assign(Object.assign({onClose:be,duration:ye},he),{type:j});return T(Se)};F[j]=L}),F},[]),k.createElement(ey,Object.assign({key:"message-holder"},u,{ref:m}))]}function ty(u){return uf(u)}function iy(){const[u,m]=k.useState([]),b=k.useCallback(w=>(m(T=>[].concat(qi(T),[w])),()=>{m(T=>T.filter(A=>A!==w))}),[]);return[u,b]}function Qd(u){return!!(u&&u.then)}const ry=u=>{const{type:m,children:b,prefixCls:w,buttonProps:T,close:A,autoFocus:F,emitEvent:s,isSilent:j,quitOnNullishReturnValue:L,actionFn:K}=u,ne=k.useRef(!1),te=k.useRef(null),[he,ye]=Vg(!1),be=function(){A?.apply(void 0,arguments)};k.useEffect(()=>{let we=null;return F&&(we=setTimeout(()=>{var ge;(ge=te.current)===null||ge===void 0||ge.focus()})),()=>{we&&clearTimeout(we)}},[]);const Se=we=>{Qd(we)&&(ye(!0),we.then(function(){ye(!1,!0),be.apply(void 0,arguments),ne.current=!1},ge=>{if(ye(!1,!0),ne.current=!1,!j?.())return Promise.reject(ge)}))},ve=we=>{if(ne.current)return;if(ne.current=!0,!K){be();return}let ge;if(s){if(ge=K(we),L&&!Qd(ge)){ne.current=!1,be(we);return}}else if(K.length)ge=K(A),ne.current=!1;else if(ge=K(),!ge){be();return}Se(ge)};return k.createElement(na,Object.assign({},Up(m),{onClick:ve,loading:he,prefixCls:w},T,{ref:te}),b)},hf=ry,al=ti.createContext({}),{Provider:df}=al,ny=()=>{const{autoFocusButton:u,cancelButtonProps:m,cancelTextLocale:b,isSilent:w,mergedOkCancel:T,rootPrefixCls:A,close:F,onCancel:s,onConfirm:j}=k.useContext(al);return T?ti.createElement(hf,{isSilent:w,actionFn:s,close:function(){F?.apply(void 0,arguments),j?.(!1)},autoFocus:u==="cancel",buttonProps:m,prefixCls:`${A}-btn`},b):null},ep=ny,ay=()=>{const{autoFocusButton:u,close:m,isSilent:b,okButtonProps:w,rootPrefixCls:T,okTextLocale:A,okType:F,onConfirm:s,onOk:j}=k.useContext(al);return ti.createElement(hf,{isSilent:b,type:F||"primary",actionFn:j,close:function(){m?.apply(void 0,arguments),s?.(!0)},autoFocus:u==="ok",buttonProps:w,prefixCls:`${T}-btn`},A)},tp=ay;var pf=k.createContext({});function ip(u,m,b){var w=m;return!w&&b&&(w="".concat(u,"-").concat(b)),w}function rp(u,m){var b=u["page".concat(m?"Y":"X","Offset")],w="scroll".concat(m?"Top":"Left");if(typeof b!="number"){var T=u.document;b=T.documentElement[w],typeof b!="number"&&(b=T.body[w])}return b}function sy(u){var m=u.getBoundingClientRect(),b={left:m.left,top:m.top},w=u.ownerDocument,T=w.defaultView||w.parentWindow;return b.left+=rp(T),b.top+=rp(T,!0),b}const oy=k.memo(function(u){var m=u.children;return m},function(u,m){var b=m.shouldUpdate;return!b});var np={width:0,height:0,overflow:"hidden",outline:"none"},ff=ti.forwardRef(function(u,m){var b=u.prefixCls,w=u.className,T=u.style,A=u.title,F=u.ariaId,s=u.footer,j=u.closable,L=u.closeIcon,K=u.onClose,ne=u.children,te=u.bodyStyle,he=u.bodyProps,ye=u.modalRender,be=u.onMouseDown,Se=u.onMouseUp,ve=u.holderRef,we=u.visible,ge=u.forceRender,xe=u.width,Pe=u.height,Re=u.classNames,Ne=u.styles,Fe=ti.useContext(pf),Le=Fe.panel,Te=qp(ve,Le),Ue=k.useRef(),We=k.useRef();ti.useImperativeHandle(m,function(){return{focus:function(){var At;(At=Ue.current)===null||At===void 0||At.focus()},changeActive:function(At){var Qt=document,Gt=Qt.activeElement;At&&Gt===We.current?Ue.current.focus():!At&&Gt===Ue.current&&We.current.focus()}}});var tt={};xe!==void 0&&(tt.width=xe),Pe!==void 0&&(tt.height=Pe);var Xe;s&&(Xe=ti.createElement("div",{className:Tt("".concat(b,"-footer"),Re?.footer),style:ri({},Ne?.footer)},s));var at;A&&(at=ti.createElement("div",{className:Tt("".concat(b,"-header"),Re?.header),style:ri({},Ne?.header)},ti.createElement("div",{className:"".concat(b,"-title"),id:F},A)));var Ct;j&&(Ct=ti.createElement("button",{type:"button",onClick:K,"aria-label":"Close",className:"".concat(b,"-close")},L||ti.createElement("span",{className:"".concat(b,"-close-x")})));var st=ti.createElement("div",{className:Tt("".concat(b,"-content"),Re?.content),style:Ne?.content},Ct,at,ti.createElement("div",mi({className:Tt("".concat(b,"-body"),Re?.body),style:ri(ri({},te),Ne?.body)},he),ne),Xe);return ti.createElement("div",{key:"dialog-element",role:"dialog","aria-labelledby":A?F:null,"aria-modal":"true",ref:Te,style:ri(ri({},T),tt),className:Tt(b,w),onMouseDown:be,onMouseUp:Se},ti.createElement("div",{tabIndex:0,ref:Ue,style:np,"aria-hidden":"true"}),ti.createElement(oy,{shouldUpdate:we||ge},ye?ye(st):st),ti.createElement("div",{tabIndex:0,ref:We,style:np,"aria-hidden":"true"}))}),mf=k.forwardRef(function(u,m){var b=u.prefixCls,w=u.title,T=u.style,A=u.className,F=u.visible,s=u.forceRender,j=u.destroyOnClose,L=u.motionName,K=u.ariaId,ne=u.onVisibleChanged,te=u.mousePosition,he=k.useRef(),ye=k.useState(),be=ii(ye,2),Se=be[0],ve=be[1],we={};Se&&(we.transformOrigin=Se);function ge(){var xe=sy(he.current);ve(te?"".concat(te.x-xe.left,"px ").concat(te.y-xe.top,"px"):"")}return k.createElement(nl,{visible:F,onVisibleChanged:ne,onAppearPrepare:ge,onEnterPrepare:ge,forceRender:s,motionName:L,removeOnLeave:j,ref:he},function(xe,Pe){var Re=xe.className,Ne=xe.style;return k.createElement(ff,mi({},u,{ref:m,title:w,ariaId:K,prefixCls:b,holderRef:Pe,style:ri(ri(ri({},Ne),T),we),className:Tt(A,Re)}))})});mf.displayName="Content";function ly(u){var m=u.prefixCls,b=u.style,w=u.visible,T=u.maskProps,A=u.motionName,F=u.className;return k.createElement(nl,{key:"mask",visible:w,motionName:A,leavedClassName:"".concat(m,"-mask-hidden")},function(s,j){var L=s.className,K=s.style;return k.createElement("div",mi({ref:j,style:ri(ri({},K),b),className:Tt("".concat(m,"-mask"),L,F)},T))})}function cy(u){var m=u.prefixCls,b=m===void 0?"rc-dialog":m,w=u.zIndex,T=u.visible,A=T===void 0?!1:T,F=u.keyboard,s=F===void 0?!0:F,j=u.focusTriggerAfterClose,L=j===void 0?!0:j,K=u.wrapStyle,ne=u.wrapClassName,te=u.wrapProps,he=u.onClose,ye=u.afterOpenChange,be=u.afterClose,Se=u.transitionName,ve=u.animation,we=u.closable,ge=we===void 0?!0:we,xe=u.mask,Pe=xe===void 0?!0:xe,Re=u.maskTransitionName,Ne=u.maskAnimation,Fe=u.maskClosable,Le=Fe===void 0?!0:Fe,Te=u.maskStyle,Ue=u.maskProps,We=u.rootClassName,tt=u.classNames,Xe=u.styles,at=k.useRef(),Ct=k.useRef(),st=k.useRef(),jt=k.useState(A),At=ii(jt,2),Qt=At[0],Gt=At[1],ft=Ug();function Be(){jd(Ct.current,document.activeElement)||(at.current=document.activeElement)}function gt(){if(!jd(Ct.current,document.activeElement)){var Pt;(Pt=st.current)===null||Pt===void 0||Pt.focus()}}function $t(Pt){if(Pt)gt();else{if(Gt(!1),Pe&&at.current&&L){try{at.current.focus({preventScroll:!0})}catch{}at.current=null}Qt&&be?.()}ye?.(Pt)}function bt(Pt){he?.(Pt)}var Bt=k.useRef(!1),Yt=k.useRef(),ei=function(){clearTimeout(Yt.current),Bt.current=!0},kt=function(){Yt.current=setTimeout(function(){Bt.current=!1})},gi=null;Le&&(gi=function(li){Bt.current?Bt.current=!1:Ct.current===li.target&&bt(li)});function pi(Pt){if(s&&Pt.keyCode===an.ESC){Pt.stopPropagation(),bt(Pt);return}A&&Pt.keyCode===an.TAB&&st.current.changeActive(!Pt.shiftKey)}return k.useEffect(function(){A&&(Gt(!0),Be())},[A]),k.useEffect(function(){return function(){clearTimeout(Yt.current)}},[]),k.createElement("div",mi({className:Tt("".concat(b,"-root"),We)},Gp(u,{data:!0})),k.createElement(ly,{prefixCls:b,visible:Pe&&A,motionName:ip(b,Re,Ne),style:ri(ri({zIndex:w},Te),Xe?.mask),maskProps:Ue,className:tt?.mask}),k.createElement("div",mi({tabIndex:-1,onKeyDown:pi,className:Tt("".concat(b,"-wrap"),ne,tt?.wrapper),ref:Ct,onClick:gi,style:ri(ri(ri({zIndex:w},K),Xe?.wrapper),{},{display:Qt?null:"none"})},te),k.createElement(mf,mi({},u,{onMouseDown:ei,onMouseUp:kt,ref:st,closable:ge,ariaId:ft,prefixCls:b,visible:A&&Qt,onClose:bt,onVisibleChanged:$t,motionName:ip(b,Se,ve)}))))}var gf=function(m){var b=m.visible,w=m.getContainer,T=m.forceRender,A=m.destroyOnClose,F=A===void 0?!1:A,s=m.afterClose,j=m.panelRef,L=k.useState(b),K=ii(L,2),ne=K[0],te=K[1],he=k.useMemo(function(){return{panel:j}},[j]);return k.useEffect(function(){b&&te(!0)},[b]),!T&&F&&!ne?null:k.createElement(pf.Provider,{value:he},k.createElement(qg,{open:b||T||ne,autoDestroy:!1,getContainer:w,autoLock:b||ne},k.createElement(cy,mi({},m,{destroyOnClose:F,afterClose:function(){s?.(),te(!1)}}))))};gf.displayName="Dialog";const uy=()=>Zp()&&window.document.documentElement;function ap(){}const hy=k.createContext({add:ap,remove:ap});function dy(u){const m=k.useContext(hy),b=k.useRef();return Hp(T=>{if(T){const A=u?T.querySelector(u):T;m.add(A),b.current=A}else m.remove(b.current)})}const py=()=>{const{cancelButtonProps:u,cancelTextLocale:m,onCancel:b}=k.useContext(al);return ti.createElement(na,Object.assign({onClick:b},u),m)},sp=py,fy=()=>{const{confirmLoading:u,okButtonProps:m,okType:b,okTextLocale:w,onOk:T}=k.useContext(al);return ti.createElement(na,Object.assign({},Up(b),{loading:u,onClick:T},m),w)},op=fy;function _f(u,m){return ti.createElement("span",{className:`${u}-close-x`},m||ti.createElement(Vs,{className:`${u}-close-icon`}))}const yf=u=>{const{okText:m,okType:b="primary",cancelText:w,confirmLoading:T,onOk:A,onCancel:F,okButtonProps:s,cancelButtonProps:j,footer:L}=u,[K]=Sc("Modal",Wp()),ne=m||K?.okText,te=w||K?.cancelText,he={confirmLoading:T,okButtonProps:s,cancelButtonProps:j,okTextLocale:ne,cancelTextLocale:te,okType:b,onOk:A,onCancel:F},ye=ti.useMemo(()=>he,qi(Object.values(he)));let be;return typeof L=="function"||typeof L>"u"?(be=ti.createElement(ti.Fragment,null,ti.createElement(sp,null),ti.createElement(op,null)),typeof L=="function"&&(be=L(be,{OkBtn:op,CancelBtn:sp})),be=ti.createElement(df,{value:ye},be)):be=L,ti.createElement(Gg,{disabled:!1},be)},my=new Ka("antFadeIn",{"0%":{opacity:0},"100%":{opacity:1}}),gy=new Ka("antFadeOut",{"0%":{opacity:1},"100%":{opacity:0}}),vf=function(u){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const{antCls:b}=u,w=`${b}-fade`,T=m?"&":"";return[Zg(w,my,gy,u.motionDurationMid,m),{[`
        ${T}${w}-enter,
        ${T}${w}-appear
      `]:{opacity:0,animationTimingFunction:"linear"},[`${T}${w}-leave`]:{animationTimingFunction:"linear"}}]};function lp(u){return{position:u,inset:0}}const _y=u=>{const{componentCls:m,antCls:b}=u;return[{[`${m}-root`]:{[`${m}${b}-zoom-enter, ${m}${b}-zoom-appear`]:{transform:"none",opacity:0,animationDuration:u.motionDurationSlow,userSelect:"none"},[`${m}${b}-zoom-leave ${m}-content`]:{pointerEvents:"none"},[`${m}-mask`]:Object.assign(Object.assign({},lp("fixed")),{zIndex:u.zIndexPopupBase,height:"100%",backgroundColor:u.colorBgMask,pointerEvents:"none",[`${m}-hidden`]:{display:"none"}}),[`${m}-wrap`]:Object.assign(Object.assign({},lp("fixed")),{zIndex:u.zIndexPopupBase,overflow:"auto",outline:0,WebkitOverflowScrolling:"touch",[`&:has(${m}${b}-zoom-enter), &:has(${m}${b}-zoom-appear)`]:{pointerEvents:"none"}})}},{[`${m}-root`]:vf(u)}]},yy=u=>{const{componentCls:m}=u;return[{[`${m}-root`]:{[`${m}-wrap-rtl`]:{direction:"rtl"},[`${m}-centered`]:{textAlign:"center","&::before":{display:"inline-block",width:0,height:"100%",verticalAlign:"middle",content:'""'},[m]:{top:0,display:"inline-block",paddingBottom:0,textAlign:"start",verticalAlign:"middle"}},[`@media (max-width: ${u.screenSMMax}px)`]:{[m]:{maxWidth:"calc(100vw - 16px)",margin:`${ct(u.marginXS)} auto`},[`${m}-centered`]:{[m]:{flex:1}}}}},{[m]:Object.assign(Object.assign({},js(u)),{pointerEvents:"none",position:"relative",top:100,width:"auto",maxWidth:`calc(100vw - ${ct(u.calc(u.margin).mul(2).equal())})`,margin:"0 auto",paddingBottom:u.paddingLG,[`${m}-title`]:{margin:0,color:u.titleColor,fontWeight:u.fontWeightStrong,fontSize:u.titleFontSize,lineHeight:u.titleLineHeight,wordWrap:"break-word"},[`${m}-content`]:{position:"relative",backgroundColor:u.contentBg,backgroundClip:"padding-box",border:0,borderRadius:u.borderRadiusLG,boxShadow:u.boxShadow,pointerEvents:"auto",padding:u.contentPadding},[`${m}-close`]:Object.assign({position:"absolute",top:u.calc(u.modalHeaderHeight).sub(u.modalCloseBtnSize).div(2).equal(),insetInlineEnd:u.calc(u.modalHeaderHeight).sub(u.modalCloseBtnSize).div(2).equal(),zIndex:u.calc(u.zIndexPopupBase).add(10).equal(),padding:0,color:u.modalCloseIconColor,fontWeight:u.fontWeightStrong,lineHeight:1,textDecoration:"none",background:"transparent",borderRadius:u.borderRadiusSM,width:u.modalCloseBtnSize,height:u.modalCloseBtnSize,border:0,outline:0,cursor:"pointer",transition:`color ${u.motionDurationMid}, background-color ${u.motionDurationMid}`,"&-x":{display:"flex",fontSize:u.fontSizeLG,fontStyle:"normal",lineHeight:`${ct(u.modalCloseBtnSize)}`,justifyContent:"center",textTransform:"none",textRendering:"auto"},"&:hover":{color:u.modalIconHoverColor,backgroundColor:u.closeBtnHoverBg,textDecoration:"none"},"&:active":{backgroundColor:u.closeBtnActiveBg}},Ju(u)),[`${m}-header`]:{color:u.colorText,background:u.headerBg,borderRadius:`${ct(u.borderRadiusLG)} ${ct(u.borderRadiusLG)} 0 0`,marginBottom:u.headerMarginBottom,padding:u.headerPadding,borderBottom:u.headerBorderBottom},[`${m}-body`]:{fontSize:u.fontSize,lineHeight:u.lineHeight,wordWrap:"break-word",padding:u.bodyPadding},[`${m}-footer`]:{textAlign:"end",background:u.footerBg,marginTop:u.footerMarginTop,padding:u.footerPadding,borderTop:u.footerBorderTop,borderRadius:u.footerBorderRadius,[`> ${u.antCls}-btn + ${u.antCls}-btn`]:{marginInlineStart:u.marginXS}},[`${m}-open`]:{overflow:"hidden"}})},{[`${m}-pure-panel`]:{top:"auto",padding:0,display:"flex",flexDirection:"column",[`${m}-content,
          ${m}-body,
          ${m}-confirm-body-wrapper`]:{display:"flex",flexDirection:"column",flex:"auto"},[`${m}-confirm-body`]:{marginBottom:"auto"}}}]},vy=u=>{const{componentCls:m}=u;return{[`${m}-root`]:{[`${m}-wrap-rtl`]:{direction:"rtl",[`${m}-confirm-body`]:{direction:"rtl"}}}}},xf=u=>{const m=u.padding,b=u.fontSizeHeading5,w=u.lineHeightHeading5;return il(u,{modalHeaderHeight:u.calc(u.calc(w).mul(b).equal()).add(u.calc(m).mul(2).equal()).equal(),modalFooterBorderColorSplit:u.colorSplit,modalFooterBorderStyle:u.lineType,modalFooterBorderWidth:u.lineWidth,modalIconHoverColor:u.colorIconHover,modalCloseIconColor:u.colorIcon,modalCloseBtnSize:u.fontHeight,modalConfirmIconSize:u.fontHeight,modalTitleHeight:u.calc(u.titleFontSize).mul(u.titleLineHeight).equal()})},bf=u=>({footerBg:"transparent",headerBg:u.colorBgElevated,titleLineHeight:u.lineHeightHeading5,titleFontSize:u.fontSizeHeading5,contentBg:u.colorBgElevated,titleColor:u.colorTextHeading,closeBtnHoverBg:u.wireframe?"transparent":u.colorFillContent,closeBtnActiveBg:u.wireframe?"transparent":u.colorFillContentHover,contentPadding:u.wireframe?0:`${ct(u.paddingMD)} ${ct(u.paddingContentHorizontalLG)}`,headerPadding:u.wireframe?`${ct(u.padding)} ${ct(u.paddingLG)}`:0,headerBorderBottom:u.wireframe?`${ct(u.lineWidth)} ${u.lineType} ${u.colorSplit}`:"none",headerMarginBottom:u.wireframe?0:u.marginXS,bodyPadding:u.wireframe?u.paddingLG:0,footerPadding:u.wireframe?`${ct(u.paddingXS)} ${ct(u.padding)}`:0,footerBorderTop:u.wireframe?`${ct(u.lineWidth)} ${u.lineType} ${u.colorSplit}`:"none",footerBorderRadius:u.wireframe?`0 0 ${ct(u.borderRadiusLG)} ${ct(u.borderRadiusLG)}`:0,footerMarginTop:u.wireframe?0:u.marginSM,confirmBodyPadding:u.wireframe?`${ct(u.padding*2)} ${ct(u.padding*2)} ${ct(u.paddingLG)}`:0,confirmIconMarginInlineEnd:u.wireframe?u.margin:u.marginSM,confirmBtnsMarginTop:u.wireframe?u.marginLG:u.marginSM}),wf=tl("Modal",u=>{const m=xf(u);return[yy(m),vy(m),_y(m),Hg(m,"zoom")]},bf,{unitless:{titleLineHeight:!0}});var xy=function(u,m){var b={};for(var w in u)Object.prototype.hasOwnProperty.call(u,w)&&m.indexOf(w)<0&&(b[w]=u[w]);if(u!=null&&typeof Object.getOwnPropertySymbols=="function")for(var T=0,w=Object.getOwnPropertySymbols(u);T<w.length;T++)m.indexOf(w[T])<0&&Object.prototype.propertyIsEnumerable.call(u,w[T])&&(b[w[T]]=u[w[T]]);return b};let Hu;const by=u=>{Hu={x:u.pageX,y:u.pageY},setTimeout(()=>{Hu=null},100)};uy()&&document.documentElement.addEventListener("click",by,!0);const wy=u=>{var m;const{getPopupContainer:b,getPrefixCls:w,direction:T,modal:A}=k.useContext(jn),F=ft=>{const{onCancel:Be}=u;Be?.(ft)},s=ft=>{const{onOk:Be}=u;Be?.(ft)},{prefixCls:j,className:L,rootClassName:K,open:ne,wrapClassName:te,centered:he,getContainer:ye,closeIcon:be,closable:Se,focusTriggerAfterClose:ve=!0,style:we,visible:ge,width:xe=520,footer:Pe,classNames:Re,styles:Ne}=u,Fe=xy(u,["prefixCls","className","rootClassName","open","wrapClassName","centered","getContainer","closeIcon","closable","focusTriggerAfterClose","style","visible","width","footer","classNames","styles"]),Le=w("modal",j),Te=w(),Ue=rl(Le),[We,tt,Xe]=wf(Le,Ue),at=Tt(te,{[`${Le}-centered`]:!!he,[`${Le}-wrap-rtl`]:T==="rtl"}),Ct=Pe!==null&&k.createElement(yf,Object.assign({},u,{onOk:s,onCancel:F})),[st,jt]=Wg(Se,be,ft=>_f(Le,ft),k.createElement(Vs,{className:`${Le}-close-icon`}),!0),At=dy(`.${Le}-content`),[Qt,Gt]=Xg("Modal",Fe.zIndex);return We(k.createElement(Kg,null,k.createElement(Yg,{status:!0,override:!0},k.createElement(Jg.Provider,{value:Gt},k.createElement(gf,Object.assign({width:xe},Fe,{zIndex:Qt,getContainer:ye===void 0?b:ye,prefixCls:Le,rootClassName:Tt(tt,K,Xe,Ue),footer:Ct,visible:ne??ge,mousePosition:(m=Fe.mousePosition)!==null&&m!==void 0?m:Hu,onClose:F,closable:st,closeIcon:jt,focusTriggerAfterClose:ve,transitionName:Qo(Te,"zoom",u.transitionName),maskTransitionName:Qo(Te,"fade",u.maskTransitionName),className:Tt(tt,L,A?.className),style:Object.assign(Object.assign({},A?.style),we),classNames:Object.assign(Object.assign({wrapper:at},A?.classNames),Re),styles:Object.assign(Object.assign({},A?.styles),Ne),panelRef:At}))))))},Sf=wy,Sy=u=>{const{componentCls:m,titleFontSize:b,titleLineHeight:w,modalConfirmIconSize:T,fontSize:A,lineHeight:F,modalTitleHeight:s,fontHeight:j,confirmBodyPadding:L}=u,K=`${m}-confirm`;return{[K]:{"&-rtl":{direction:"rtl"},[`${u.antCls}-modal-header`]:{display:"none"},[`${K}-body-wrapper`]:Object.assign({},Qu()),[`&${m} ${m}-body`]:{padding:L},[`${K}-body`]:{display:"flex",flexWrap:"nowrap",alignItems:"start",[`> ${u.iconCls}`]:{flex:"none",fontSize:T,marginInlineEnd:u.confirmIconMarginInlineEnd,marginTop:u.calc(u.calc(j).sub(T).equal()).div(2).equal()},[`&-has-title > ${u.iconCls}`]:{marginTop:u.calc(u.calc(s).sub(T).equal()).div(2).equal()}},[`${K}-paragraph`]:{display:"flex",flexDirection:"column",flex:"auto",rowGap:u.marginXS,maxWidth:`calc(100% - ${ct(u.calc(u.modalConfirmIconSize).add(u.marginSM).equal())})`},[`${K}-title`]:{color:u.colorTextHeading,fontWeight:u.fontWeightStrong,fontSize:b,lineHeight:w},[`${K}-content`]:{color:u.colorText,fontSize:A,lineHeight:F},[`${K}-btns`]:{textAlign:"end",marginTop:u.confirmBtnsMarginTop,[`${u.antCls}-btn + ${u.antCls}-btn`]:{marginBottom:0,marginInlineStart:u.marginXS}}},[`${K}-error ${K}-body > ${u.iconCls}`]:{color:u.colorError},[`${K}-warning ${K}-body > ${u.iconCls},
        ${K}-confirm ${K}-body > ${u.iconCls}`]:{color:u.colorWarning},[`${K}-info ${K}-body > ${u.iconCls}`]:{color:u.colorInfo},[`${K}-success ${K}-body > ${u.iconCls}`]:{color:u.colorSuccess}}},Cy=Qg(["Modal","confirm"],u=>{const m=xf(u);return[Sy(m)]},bf,{order:-1e3});var Ty=function(u,m){var b={};for(var w in u)Object.prototype.hasOwnProperty.call(u,w)&&m.indexOf(w)<0&&(b[w]=u[w]);if(u!=null&&typeof Object.getOwnPropertySymbols=="function")for(var T=0,w=Object.getOwnPropertySymbols(u);T<w.length;T++)m.indexOf(w[T])<0&&Object.prototype.propertyIsEnumerable.call(u,w[T])&&(b[w[T]]=u[w[T]]);return b};function Cf(u){const{prefixCls:m,icon:b,okText:w,cancelText:T,confirmPrefixCls:A,type:F,okCancel:s,footer:j,locale:L}=u,K=Ty(u,["prefixCls","icon","okText","cancelText","confirmPrefixCls","type","okCancel","footer","locale"]);let ne=b;if(!b&&b!==null)switch(F){case"info":ne=k.createElement(af,null);break;case"success":ne=k.createElement(Ku,null);break;case"error":ne=k.createElement(Yu,null);break;default:ne=k.createElement(Vp,null)}const te=s??F==="confirm",he=u.autoFocusButton===null?!1:u.autoFocusButton||"ok",[ye]=Sc("Modal"),be=L||ye,Se=w||(te?be?.okText:be?.justOkText),ve=T||be?.cancelText,we=Object.assign({autoFocusButton:he,cancelTextLocale:ve,okTextLocale:Se,mergedOkCancel:te},K),ge=k.useMemo(()=>we,qi(Object.values(we))),xe=k.createElement(k.Fragment,null,k.createElement(ep,null),k.createElement(tp,null)),Pe=u.title!==void 0&&u.title!==null,Re=`${A}-body`;return k.createElement("div",{className:`${A}-body-wrapper`},k.createElement("div",{className:Tt(Re,{[`${Re}-has-title`]:Pe})},ne,k.createElement("div",{className:`${A}-paragraph`},Pe&&k.createElement("span",{className:`${A}-title`},u.title),k.createElement("div",{className:`${A}-content`},u.content))),j===void 0||typeof j=="function"?k.createElement(df,{value:ge},k.createElement("div",{className:`${A}-btns`},typeof j=="function"?j(xe,{OkBtn:tp,CancelBtn:ep}):xe)):j,k.createElement(Cy,{prefixCls:m}))}const Iy=u=>{const{close:m,zIndex:b,afterClose:w,open:T,keyboard:A,centered:F,getContainer:s,maskStyle:j,direction:L,prefixCls:K,wrapClassName:ne,rootPrefixCls:te,bodyStyle:he,closable:ye=!1,closeIcon:be,modalRender:Se,focusTriggerAfterClose:ve,onConfirm:we,styles:ge}=u,xe=`${K}-confirm`,Pe=u.width||416,Re=u.style||{},Ne=u.mask===void 0?!0:u.mask,Fe=u.maskClosable===void 0?!1:u.maskClosable,Le=Tt(xe,`${xe}-${u.type}`,{[`${xe}-rtl`]:L==="rtl"},u.className),[,Te]=e_(),Ue=k.useMemo(()=>b!==void 0?b:Te.zIndexPopupBase+jp,[b,Te]);return k.createElement(Sf,{prefixCls:K,className:Le,wrapClassName:Tt({[`${xe}-centered`]:!!u.centered},ne),onCancel:()=>{m?.({triggerCancel:!0}),we?.(!1)},open:T,title:"",footer:null,transitionName:Qo(te||"","zoom",u.transitionName),maskTransitionName:Qo(te||"","fade",u.maskTransitionName),mask:Ne,maskClosable:Fe,style:Re,styles:Object.assign({body:he,mask:j},ge),width:Pe,zIndex:Ue,afterClose:w,keyboard:A,centered:F,getContainer:s,closable:ye,closeIcon:be,modalRender:Se,focusTriggerAfterClose:ve},k.createElement(Cf,Object.assign({},u,{confirmPrefixCls:xe})))},Ey=u=>{const{rootPrefixCls:m,iconPrefixCls:b,direction:w,theme:T}=u;return k.createElement(Xp,{prefixCls:m,iconPrefixCls:b,direction:w,theme:T},k.createElement(Iy,Object.assign({},u)))},Tf=Ey,Wa=[];var Py=function(u,m){var b={};for(var w in u)Object.prototype.hasOwnProperty.call(u,w)&&m.indexOf(w)<0&&(b[w]=u[w]);if(u!=null&&typeof Object.getOwnPropertySymbols=="function")for(var T=0,w=Object.getOwnPropertySymbols(u);T<w.length;T++)m.indexOf(w[T])<0&&Object.prototype.propertyIsEnumerable.call(u,w[T])&&(b[w[T]]=u[w[T]]);return b};let If="";function My(){return If}function sl(u){const m=document.createDocumentFragment();let b=Object.assign(Object.assign({},u),{close:F,open:!0}),w;function T(){for(var j=arguments.length,L=new Array(j),K=0;K<j;K++)L[K]=arguments[K];const ne=L.some(te=>te&&te.triggerCancel);u.onCancel&&ne&&u.onCancel.apply(u,[()=>{}].concat(qi(L.slice(1))));for(let te=0;te<Wa.length;te++)if(Wa[te]===F){Wa.splice(te,1);break}t_(m)}function A(j){var{okText:L,cancelText:K,prefixCls:ne,getContainer:te}=j,he=Py(j,["okText","cancelText","prefixCls","getContainer"]);clearTimeout(w),w=setTimeout(()=>{const ye=Wp(),{getPrefixCls:be,getIconPrefixCls:Se,getTheme:ve}=eh(),we=be(void 0,My()),ge=ne||`${we}-modal`,xe=Se(),Pe=ve();let Re=te;Re===!1&&(Re=void 0),Kp(k.createElement(Tf,Object.assign({},he,{getContainer:Re,prefixCls:ge,rootPrefixCls:we,iconPrefixCls:xe,okText:L,locale:ye,theme:Pe,cancelText:K||ye.cancelText})),m)})}function F(){for(var j=arguments.length,L=new Array(j),K=0;K<j;K++)L[K]=arguments[K];b=Object.assign(Object.assign({},b),{open:!1,afterClose:()=>{typeof u.afterClose=="function"&&u.afterClose(),T.apply(this,L)}}),b.visible&&delete b.visible,A(b)}function s(j){typeof j=="function"?b=j(b):b=Object.assign(Object.assign({},b),j),A(b)}return A(b),Wa.push(F),{destroy:F,update:s}}function Ef(u){return Object.assign(Object.assign({},u),{type:"warning"})}function Pf(u){return Object.assign(Object.assign({},u),{type:"info"})}function Mf(u){return Object.assign(Object.assign({},u),{type:"success"})}function Af(u){return Object.assign(Object.assign({},u),{type:"error"})}function kf(u){return Object.assign(Object.assign({},u),{type:"confirm"})}function Ay(u){let{rootPrefixCls:m}=u;If=m}var ky=function(u,m){var b={};for(var w in u)Object.prototype.hasOwnProperty.call(u,w)&&m.indexOf(w)<0&&(b[w]=u[w]);if(u!=null&&typeof Object.getOwnPropertySymbols=="function")for(var T=0,w=Object.getOwnPropertySymbols(u);T<w.length;T++)m.indexOf(w[T])<0&&Object.prototype.propertyIsEnumerable.call(u,w[T])&&(b[w[T]]=u[w[T]]);return b};const zy=(u,m)=>{var b,{afterClose:w,config:T}=u,A=ky(u,["afterClose","config"]);const[F,s]=k.useState(!0),[j,L]=k.useState(T),{direction:K,getPrefixCls:ne}=k.useContext(jn),te=ne("modal"),he=ne(),ye=()=>{var we;w(),(we=j.afterClose)===null||we===void 0||we.call(j)},be=function(){s(!1);for(var we=arguments.length,ge=new Array(we),xe=0;xe<we;xe++)ge[xe]=arguments[xe];const Pe=ge.some(Re=>Re&&Re.triggerCancel);j.onCancel&&Pe&&j.onCancel.apply(j,[()=>{}].concat(qi(ge.slice(1))))};k.useImperativeHandle(m,()=>({destroy:be,update:we=>{L(ge=>Object.assign(Object.assign({},ge),we))}}));const Se=(b=j.okCancel)!==null&&b!==void 0?b:j.type==="confirm",[ve]=Sc("Modal",Yp.Modal);return k.createElement(Tf,Object.assign({prefixCls:te,rootPrefixCls:he},j,{close:be,open:F,afterClose:ye,okText:j.okText||(Se?ve?.okText:ve?.justOkText),direction:j.direction||K,cancelText:j.cancelText||ve?.cancelText},A))},Dy=k.forwardRef(zy);let cp=0;const Ly=k.memo(k.forwardRef((u,m)=>{const[b,w]=iy();return k.useImperativeHandle(m,()=>({patchElement:w}),[]),k.createElement(k.Fragment,null,b)}));function Ry(){const u=k.useRef(null),[m,b]=k.useState([]);k.useEffect(()=>{m.length&&(qi(m).forEach(F=>{F()}),b([]))},[m]);const w=k.useCallback(A=>function(s){var j;cp+=1;const L=k.createRef();let K;const ne=new Promise(Se=>{K=Se});let te=!1,he;const ye=k.createElement(Dy,{key:`modal-${cp}`,config:A(s),ref:L,afterClose:()=>{he?.()},isSilent:()=>te,onConfirm:Se=>{K(Se)}});return he=(j=u.current)===null||j===void 0?void 0:j.patchElement(ye),he&&Wa.push(he),{destroy:()=>{function Se(){var ve;(ve=L.current)===null||ve===void 0||ve.destroy()}L.current?Se():b(ve=>[].concat(qi(ve),[Se]))},update:Se=>{function ve(){var we;(we=L.current)===null||we===void 0||we.update(Se)}L.current?ve():b(we=>[].concat(qi(we),[ve]))},then:Se=>(te=!0,ne.then(Se))}},[]);return[k.useMemo(()=>({info:w(Pf),success:w(Mf),error:w(Af),warning:w(Ef),confirm:w(kf)}),[]),k.createElement(Ly,{key:"modal-holder",ref:u})]}var By={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M482 152h60q8 0 8 8v704q0 8-8 8h-60q-8 0-8-8V160q0-8 8-8z"}},{tag:"path",attrs:{d:"M192 474h672q8 0 8 8v60q0 8-8 8H160q-8 0-8-8v-60q0-8 8-8z"}}]},name:"plus",theme:"outlined"};const Fy=By;var $y=function(m,b){return k.createElement(Ia,mi({},m,{ref:b,icon:Fy}))};const Oy=k.forwardRef($y);function Ny(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{inkBar:!0,tabPane:!1},m;return u===!1?m={inkBar:!1,tabPane:!1}:u===!0?m={inkBar:!0,tabPane:!1}:m=ri({inkBar:!0},Nn(u)==="object"?u:{}),m.tabPaneMotion&&m.tabPane===void 0&&(m.tabPane=!0),!m.tabPaneMotion&&m.tabPane&&(m.tabPane=!1),m}const Cc=k.createContext(null);var jy=function(m){var b=m.activeTabOffset,w=m.horizontal,T=m.rtl,A=m.indicatorSize,F=k.useState(),s=ii(F,2),j=s[0],L=s[1],K=k.useRef(),ne=function(ye){return typeof A=="function"?A(ye):typeof A=="number"?A:ye};function te(){Vd.cancel(K.current)}return k.useEffect(function(){var he={};return b&&(w?(T?(he.right=b.right+b.width/2,he.transform="translateX(50%)"):(he.left=b.left+b.width/2,he.transform="translateX(-50%)"),he.width=ne(b.width)):(he.top=b.top+b.height/2,he.transform="translateY(-50%)",he.height=ne(b.height))),te(),K.current=Vd(function(){L(he)}),te},[b,w,T,A]),{style:j}},up={width:0,height:0,left:0,top:0};function Vy(u,m,b){return k.useMemo(function(){for(var w,T=new Map,A=m.get((w=u[0])===null||w===void 0?void 0:w.key)||up,F=A.left+A.width,s=0;s<u.length;s+=1){var j=u[s].key,L=m.get(j);if(!L){var K;L=m.get((K=u[s-1])===null||K===void 0?void 0:K.key)||up}var ne=T.get(j)||ri({},L);ne.right=F-ne.left-ne.width,T.set(j,ne)}return T},[u.map(function(w){return w.key}).join("_"),m,b])}function hp(u,m){var b=k.useRef(u),w=k.useState({}),T=ii(w,2),A=T[1];function F(s){var j=typeof s=="function"?s(b.current):s;j!==b.current&&m(j,b.current),b.current=j,A({})}return[b.current,F]}var Uy=.1,dp=.01,yc=20,pp=Math.pow(.995,yc);function qy(u,m){var b=k.useState(),w=ii(b,2),T=w[0],A=w[1],F=k.useState(0),s=ii(F,2),j=s[0],L=s[1],K=k.useState(0),ne=ii(K,2),te=ne[0],he=ne[1],ye=k.useState(),be=ii(ye,2),Se=be[0],ve=be[1],we=k.useRef();function ge(Le){var Te=Le.touches[0],Ue=Te.screenX,We=Te.screenY;A({x:Ue,y:We}),window.clearInterval(we.current)}function xe(Le){if(T){Le.preventDefault();var Te=Le.touches[0],Ue=Te.screenX,We=Te.screenY;A({x:Ue,y:We});var tt=Ue-T.x,Xe=We-T.y;m(tt,Xe);var at=Date.now();L(at),he(at-j),ve({x:tt,y:Xe})}}function Pe(){if(T&&(A(null),ve(null),Se)){var Le=Se.x/te,Te=Se.y/te,Ue=Math.abs(Le),We=Math.abs(Te);if(Math.max(Ue,We)<Uy)return;var tt=Le,Xe=Te;we.current=window.setInterval(function(){if(Math.abs(tt)<dp&&Math.abs(Xe)<dp){window.clearInterval(we.current);return}tt*=pp,Xe*=pp,m(tt*yc,Xe*yc)},yc)}}var Re=k.useRef();function Ne(Le){var Te=Le.deltaX,Ue=Le.deltaY,We=0,tt=Math.abs(Te),Xe=Math.abs(Ue);tt===Xe?We=Re.current==="x"?Te:Ue:tt>Xe?(We=Te,Re.current="x"):(We=Ue,Re.current="y"),m(-We,-We)&&Le.preventDefault()}var Fe=k.useRef(null);Fe.current={onTouchStart:ge,onTouchMove:xe,onTouchEnd:Pe,onWheel:Ne},k.useEffect(function(){function Le(tt){Fe.current.onTouchStart(tt)}function Te(tt){Fe.current.onTouchMove(tt)}function Ue(tt){Fe.current.onTouchEnd(tt)}function We(tt){Fe.current.onWheel(tt)}return document.addEventListener("touchmove",Te,{passive:!1}),document.addEventListener("touchend",Ue,{passive:!1}),u.current.addEventListener("touchstart",Le,{passive:!1}),u.current.addEventListener("wheel",We),function(){document.removeEventListener("touchmove",Te),document.removeEventListener("touchend",Ue)}},[])}function zf(u){var m=k.useState(0),b=ii(m,2),w=b[0],T=b[1],A=k.useRef(0),F=k.useRef();return F.current=u,i_(function(){var s;(s=F.current)===null||s===void 0||s.call(F)},[w]),function(){A.current===w&&(A.current+=1,T(A.current))}}function Gy(u){var m=k.useRef([]),b=k.useState({}),w=ii(b,2),T=w[1],A=k.useRef(typeof u=="function"?u():u),F=zf(function(){var j=A.current;m.current.forEach(function(L){j=L(j)}),m.current=[],A.current=j,T({})});function s(j){m.current.push(j),F()}return[A.current,s]}var fp={width:0,height:0,left:0,top:0,right:0};function Zy(u,m,b,w,T,A,F){var s=F.tabs,j=F.tabPosition,L=F.rtl,K,ne,te;return["top","bottom"].includes(j)?(K="width",ne=L?"right":"left",te=Math.abs(b)):(K="height",ne="top",te=-b),k.useMemo(function(){if(!s.length)return[0,0];for(var he=s.length,ye=he,be=0;be<he;be+=1){var Se=u.get(s[be].key)||fp;if(Se[ne]+Se[K]>te+m){ye=be-1;break}}for(var ve=0,we=he-1;we>=0;we-=1){var ge=u.get(s[we].key)||fp;if(ge[ne]<te){ve=we+1;break}}return ve>=ye?[0,0]:[ve,ye]},[u,m,w,T,A,te,j,s.map(function(he){return he.key}).join("_"),L])}function mp(u){var m;return u instanceof Map?(m={},u.forEach(function(b,w){m[w]=b})):m=u,JSON.stringify(m)}var Hy="TABS_DQ";function Df(u){return String(u).replace(/"/g,Hy)}function Lf(u,m,b,w){return!(!b||w||u===!1||u===void 0&&(m===!1||m===null))}var Rf=k.forwardRef(function(u,m){var b=u.prefixCls,w=u.editable,T=u.locale,A=u.style;return!w||w.showAdd===!1?null:k.createElement("button",{ref:m,type:"button",className:"".concat(b,"-nav-add"),style:A,"aria-label":T?.addAriaLabel||"Add tab",onClick:function(s){w.onEdit("add",{event:s})}},w.addIcon||"+")}),gp=k.forwardRef(function(u,m){var b=u.position,w=u.prefixCls,T=u.extra;if(!T)return null;var A,F={};return Nn(T)==="object"&&!k.isValidElement(T)?F=T:F.right=T,b==="right"&&(A=F.right),b==="left"&&(A=F.left),A?k.createElement("div",{className:"".concat(w,"-extra-content"),ref:m},A):null}),Wy=k.forwardRef(function(u,m){var b=u.prefixCls,w=u.id,T=u.tabs,A=u.locale,F=u.mobile,s=u.moreIcon,j=s===void 0?"More":s,L=u.moreTransitionName,K=u.style,ne=u.className,te=u.editable,he=u.tabBarGutter,ye=u.rtl,be=u.removeAriaLabel,Se=u.onTabClick,ve=u.getPopupContainer,we=u.popupClassName,ge=k.useState(!1),xe=ii(ge,2),Pe=xe[0],Re=xe[1],Ne=k.useState(null),Fe=ii(Ne,2),Le=Fe[0],Te=Fe[1],Ue="".concat(w,"-more-popup"),We="".concat(b,"-dropdown"),tt=Le!==null?"".concat(Ue,"-").concat(Le):null,Xe=A?.dropdownAriaLabel;function at(ft,Be){ft.preventDefault(),ft.stopPropagation(),te.onEdit("remove",{key:Be,event:ft})}var Ct=k.createElement(r_,{onClick:function(Be){var gt=Be.key,$t=Be.domEvent;Se(gt,$t),Re(!1)},prefixCls:"".concat(We,"-menu"),id:Ue,tabIndex:-1,role:"listbox","aria-activedescendant":tt,selectedKeys:[Le],"aria-label":Xe!==void 0?Xe:"expanded dropdown"},T.map(function(ft){var Be=ft.closable,gt=ft.disabled,$t=ft.closeIcon,bt=ft.key,Bt=ft.label,Yt=Lf(Be,$t,te,gt);return k.createElement(n_,{key:bt,id:"".concat(Ue,"-").concat(bt),role:"option","aria-controls":w&&"".concat(w,"-panel-").concat(bt),disabled:gt},k.createElement("span",null,Bt),Yt&&k.createElement("button",{type:"button","aria-label":be||"remove",tabIndex:0,className:"".concat(We,"-menu-item-remove"),onClick:function(kt){kt.stopPropagation(),at(kt,bt)}},$t||te.removeIcon||"Ã—"))}));function st(ft){for(var Be=T.filter(function(Yt){return!Yt.disabled}),gt=Be.findIndex(function(Yt){return Yt.key===Le})||0,$t=Be.length,bt=0;bt<$t;bt+=1){gt=(gt+ft+$t)%$t;var Bt=Be[gt];if(!Bt.disabled){Te(Bt.key);return}}}function jt(ft){var Be=ft.which;if(!Pe){[an.DOWN,an.SPACE,an.ENTER].includes(Be)&&(Re(!0),ft.preventDefault());return}switch(Be){case an.UP:st(-1),ft.preventDefault();break;case an.DOWN:st(1),ft.preventDefault();break;case an.ESC:Re(!1);break;case an.SPACE:case an.ENTER:Le!==null&&Se(Le,ft);break}}k.useEffect(function(){var ft=document.getElementById(tt);ft&&ft.scrollIntoView&&ft.scrollIntoView(!1)},[Le]),k.useEffect(function(){Pe||Te(null)},[Pe]);var At=oi({},ye?"marginRight":"marginLeft",he);T.length||(At.visibility="hidden",At.order=1);var Qt=Tt(oi({},"".concat(We,"-rtl"),ye)),Gt=F?null:k.createElement(a_,{prefixCls:We,overlay:Ct,trigger:["hover"],visible:T.length?Pe:!1,transitionName:L,onVisibleChange:Re,overlayClassName:Tt(Qt,we),mouseEnterDelay:.1,mouseLeaveDelay:.1,getPopupContainer:ve},k.createElement("button",{type:"button",className:"".concat(b,"-nav-more"),style:At,tabIndex:-1,"aria-hidden":"true","aria-haspopup":"listbox","aria-controls":Ue,id:"".concat(w,"-more"),"aria-expanded":Pe,onKeyDown:jt},j));return k.createElement("div",{className:Tt("".concat(b,"-nav-operations"),ne),style:K,ref:m},Gt,k.createElement(Rf,{prefixCls:b,locale:A,editable:te}))});const Xy=k.memo(Wy,function(u,m){return m.tabMoving});var Ky=function(m){var b,w=m.prefixCls,T=m.id,A=m.active,F=m.tab,s=F.key,j=F.label,L=F.disabled,K=F.closeIcon,ne=F.icon,te=m.closable,he=m.renderWrapper,ye=m.removeAriaLabel,be=m.editable,Se=m.onClick,ve=m.onFocus,we=m.style,ge="".concat(w,"-tab"),xe=Lf(te,K,be,L);function Pe(Le){L||Se(Le)}function Re(Le){Le.preventDefault(),Le.stopPropagation(),be.onEdit("remove",{key:s,event:Le})}var Ne=k.useMemo(function(){return ne&&typeof j=="string"?k.createElement("span",null,j):j},[j,ne]),Fe=k.createElement("div",{key:s,"data-node-key":Df(s),className:Tt(ge,(b={},oi(b,"".concat(ge,"-with-remove"),xe),oi(b,"".concat(ge,"-active"),A),oi(b,"".concat(ge,"-disabled"),L),b)),style:we,onClick:Pe},k.createElement("div",{role:"tab","aria-selected":A,id:T&&"".concat(T,"-tab-").concat(s),className:"".concat(ge,"-btn"),"aria-controls":T&&"".concat(T,"-panel-").concat(s),"aria-disabled":L,tabIndex:L?null:0,onClick:function(Te){Te.stopPropagation(),Pe(Te)},onKeyDown:function(Te){[an.SPACE,an.ENTER].includes(Te.which)&&(Te.preventDefault(),Pe(Te))},onFocus:ve},ne&&k.createElement("span",{className:"".concat(ge,"-icon")},ne),j&&Ne),xe&&k.createElement("button",{type:"button","aria-label":ye||"remove",tabIndex:0,className:"".concat(ge,"-remove"),onClick:function(Te){Te.stopPropagation(),Re(Te)}},K||be.removeIcon||"Ã—"));return he?he(Fe):Fe},Yy=function(m,b){var w=m.offsetWidth,T=m.offsetHeight,A=m.offsetTop,F=m.offsetLeft,s=m.getBoundingClientRect(),j=s.width,L=s.height,K=s.x,ne=s.y;return Math.abs(j-w)<1?[j,L,K-b.x,ne-b.y]:[w,T,F,A]},$s=function(m){var b=m.current||{},w=b.offsetWidth,T=w===void 0?0:w,A=b.offsetHeight,F=A===void 0?0:A;if(m.current){var s=m.current.getBoundingClientRect(),j=s.width,L=s.height;if(Math.abs(j-T)<1)return[j,L]}return[T,F]},mc=function(m,b){return m[b?0:1]},_p=k.forwardRef(function(u,m){var b,w=u.className,T=u.style,A=u.id,F=u.animated,s=u.activeKey,j=u.rtl,L=u.extra,K=u.editable,ne=u.locale,te=u.tabPosition,he=u.tabBarGutter,ye=u.children,be=u.onTabClick,Se=u.onTabScroll,ve=u.indicatorSize,we=k.useContext(Cc),ge=we.prefixCls,xe=we.tabs,Pe=k.useRef(null),Re=k.useRef(null),Ne=k.useRef(null),Fe=k.useRef(null),Le=k.useRef(null),Te=k.useRef(null),Ue=k.useRef(null),We=te==="top"||te==="bottom",tt=hp(0,function(Ke,Ye){We&&Se&&Se({direction:Ke>Ye?"left":"right"})}),Xe=ii(tt,2),at=Xe[0],Ct=Xe[1],st=hp(0,function(Ke,Ye){!We&&Se&&Se({direction:Ke>Ye?"top":"bottom"})}),jt=ii(st,2),At=jt[0],Qt=jt[1],Gt=k.useState([0,0]),ft=ii(Gt,2),Be=ft[0],gt=ft[1],$t=k.useState([0,0]),bt=ii($t,2),Bt=bt[0],Yt=bt[1],ei=k.useState([0,0]),kt=ii(ei,2),gi=kt[0],pi=kt[1],Pt=k.useState([0,0]),li=ii(Pt,2),Xi=li[0],Ht=li[1],Mi=Gy(new Map),Oi=ii(Mi,2),gr=Oi[0],_e=Oi[1],bi=Vy(xe,gr,Bt[0]),Di=mc(Be,We),Wt=mc(Bt,We),Ot=mc(gi,We),Gi=mc(Xi,We),Ki=Di<Wt+Ot,_i=Ki?Di-Gi:Di-Ot,sn="".concat(ge,"-nav-operations-hidden"),sr=0,ar=0;We&&j?(sr=0,ar=Math.max(0,Wt-_i)):(sr=Math.min(0,_i-Wt),ar=0);function Ur(Ke){return Ke<sr?sr:Ke>ar?ar:Ke}var je=k.useRef(null),It=k.useState(),wt=ii(It,2),Jt=wt[0],zt=wt[1];function ze(){zt(Date.now())}function mt(){je.current&&clearTimeout(je.current)}qy(Fe,function(Ke,Ye){function Et(Ft,Rt){Ft(function(Dt){var Ni=Ur(Dt+Rt);return Ni})}return Ki?(We?Et(Ct,Ke):Et(Qt,Ye),mt(),ze(),!0):!1}),k.useEffect(function(){return mt(),Jt&&(je.current=setTimeout(function(){zt(0)},100)),mt},[Jt]);var yt=Zy(bi,_i,We?at:At,Wt,Ot,Gi,ri(ri({},u),{},{tabs:xe})),wi=ii(yt,2),Zi=wi[0],Mt=wi[1],qr=Hp(function(){var Ke=arguments.length>0&&arguments[0]!==void 0?arguments[0]:s,Ye=bi.get(Ke)||{width:0,height:0,left:0,right:0,top:0};if(We){var Et=at;j?Ye.right<at?Et=Ye.right:Ye.right+Ye.width>at+_i&&(Et=Ye.right+Ye.width-_i):Ye.left<-at?Et=-Ye.left:Ye.left+Ye.width>-at+_i&&(Et=-(Ye.left+Ye.width-_i)),Qt(0),Ct(Ur(Et))}else{var Ft=At;Ye.top<-At?Ft=-Ye.top:Ye.top+Ye.height>-At+_i&&(Ft=-(Ye.top+Ye.height-_i)),Ct(0),Qt(Ur(Ft))}}),Z={};te==="top"||te==="bottom"?Z[j?"marginRight":"marginLeft"]=he:Z.marginTop=he;var z=xe.map(function(Ke,Ye){var Et=Ke.key;return k.createElement(Ky,{id:A,prefixCls:ge,key:Et,tab:Ke,style:Ye===0?void 0:Z,closable:Ke.closable,editable:K,active:Et===s,renderWrapper:ye,removeAriaLabel:ne?.removeAriaLabel,onClick:function(Rt){be(Et,Rt)},onFocus:function(){qr(Et),ze(),Fe.current&&(j||(Fe.current.scrollLeft=0),Fe.current.scrollTop=0)}})}),R=function(){return _e(function(){var Ye,Et=new Map,Ft=(Ye=Le.current)===null||Ye===void 0?void 0:Ye.getBoundingClientRect();return xe.forEach(function(Rt){var Dt,Ni=Rt.key,ci=(Dt=Le.current)===null||Dt===void 0?void 0:Dt.querySelector('[data-node-key="'.concat(Df(Ni),'"]'));if(ci){var Li=Yy(ci,Ft),Ri=ii(Li,4),Sr=Ri[0],Ja=Ri[1],En=Ri[2],Pn=Ri[3];Et.set(Ni,{width:Sr,height:Ja,left:En,top:Pn})}}),Et})};k.useEffect(function(){R()},[xe.map(function(Ke){return Ke.key}).join("_")]);var N=zf(function(){var Ke=$s(Pe),Ye=$s(Re),Et=$s(Ne);gt([Ke[0]-Ye[0]-Et[0],Ke[1]-Ye[1]-Et[1]]);var Ft=$s(Ue);pi(Ft);var Rt=$s(Te);Ht(Rt);var Dt=$s(Le);Yt([Dt[0]-Ft[0],Dt[1]-Ft[1]]),R()}),W=xe.slice(0,Zi),Y=xe.slice(Mt+1),ce=[].concat(qi(W),qi(Y)),re=bi.get(s),Q=jy({activeTabOffset:re,horizontal:We,rtl:j,indicatorSize:ve}),se=Q.style;k.useEffect(function(){qr()},[s,sr,ar,mp(re),mp(bi),We]),k.useEffect(function(){N()},[j]);var Ce=!!ce.length,Ie="".concat(ge,"-nav-wrap"),Ae,dt,St,nt;return We?j?(dt=at>0,Ae=at!==ar):(Ae=at<0,dt=at!==sr):(St=At<0,nt=At!==sr),k.createElement(Lu,{onResize:N},k.createElement("div",{ref:qp(m,Pe),role:"tablist",className:Tt("".concat(ge,"-nav"),w),style:T,onKeyDown:function(){ze()}},k.createElement(gp,{ref:Re,position:"left",extra:L,prefixCls:ge}),k.createElement(Lu,{onResize:N},k.createElement("div",{className:Tt(Ie,(b={},oi(b,"".concat(Ie,"-ping-left"),Ae),oi(b,"".concat(Ie,"-ping-right"),dt),oi(b,"".concat(Ie,"-ping-top"),St),oi(b,"".concat(Ie,"-ping-bottom"),nt),b)),ref:Fe},k.createElement(Lu,{onResize:N},k.createElement("div",{ref:Le,className:"".concat(ge,"-nav-list"),style:{transform:"translate(".concat(at,"px, ").concat(At,"px)"),transition:Jt?"none":void 0}},z,k.createElement(Rf,{ref:Ue,prefixCls:ge,locale:ne,editable:K,style:ri(ri({},z.length===0?void 0:Z),{},{visibility:Ce?"hidden":null})}),k.createElement("div",{className:Tt("".concat(ge,"-ink-bar"),oi({},"".concat(ge,"-ink-bar-animated"),F.inkBar)),style:se}))))),k.createElement(Xy,mi({},u,{removeAriaLabel:ne?.removeAriaLabel,ref:Te,prefixCls:ge,tabs:ce,className:!Ce&&sn,tabMoving:!!Jt})),k.createElement(gp,{ref:Ne,position:"right",extra:L,prefixCls:ge})))}),Bf=k.forwardRef(function(u,m){var b=u.prefixCls,w=u.className,T=u.style,A=u.id,F=u.active,s=u.tabKey,j=u.children;return k.createElement("div",{id:A&&"".concat(A,"-panel-").concat(s),role:"tabpanel",tabIndex:F?0:-1,"aria-labelledby":A&&"".concat(A,"-tab-").concat(s),"aria-hidden":!F,style:T,className:Tt(b,F&&"".concat(b,"-active"),w),ref:m},j)}),Jy=["renderTabBar"],Qy=["label","key"],ev=function(m){var b=m.renderTabBar,w=Ta(m,Jy),T=k.useContext(Cc),A=T.tabs;if(b){var F=ri(ri({},w),{},{panes:A.map(function(s){var j=s.label,L=s.key,K=Ta(s,Qy);return k.createElement(Bf,mi({tab:j,key:L,tabKey:L},K))})});return b(F,_p)}return k.createElement(_p,w)},tv=["key","forceRender","style","className","destroyInactiveTabPane"],iv=function(m){var b=m.id,w=m.activeKey,T=m.animated,A=m.tabPosition,F=m.destroyInactiveTabPane,s=k.useContext(Cc),j=s.prefixCls,L=s.tabs,K=T.tabPane,ne="".concat(j,"-tabpane");return k.createElement("div",{className:Tt("".concat(j,"-content-holder"))},k.createElement("div",{className:Tt("".concat(j,"-content"),"".concat(j,"-content-").concat(A),oi({},"".concat(j,"-content-animated"),K))},L.map(function(te){var he=te.key,ye=te.forceRender,be=te.style,Se=te.className,ve=te.destroyInactiveTabPane,we=Ta(te,tv),ge=he===w;return k.createElement(nl,mi({key:he,visible:ge,forceRender:ye,removeOnLeave:!!(F||ve),leavedClassName:"".concat(ne,"-hidden")},T.tabPaneMotion),function(xe,Pe){var Re=xe.style,Ne=xe.className;return k.createElement(Bf,mi({},we,{prefixCls:ne,id:b,tabKey:he,animated:K,active:ge,style:ri(ri({},be),Re),className:Tt(Se,Ne),ref:Pe}))})})))},rv=["id","prefixCls","className","items","direction","activeKey","defaultActiveKey","editable","animated","tabPosition","tabBarGutter","tabBarStyle","tabBarExtraContent","locale","moreIcon","moreTransitionName","destroyInactiveTabPane","renderTabBar","onChange","onTabClick","onTabScroll","getPopupContainer","popupClassName","indicatorSize"],yp=0,nv=k.forwardRef(function(u,m){var b,w=u.id,T=u.prefixCls,A=T===void 0?"rc-tabs":T,F=u.className,s=u.items,j=u.direction,L=u.activeKey,K=u.defaultActiveKey,ne=u.editable,te=u.animated,he=u.tabPosition,ye=he===void 0?"top":he,be=u.tabBarGutter,Se=u.tabBarStyle,ve=u.tabBarExtraContent,we=u.locale,ge=u.moreIcon,xe=u.moreTransitionName,Pe=u.destroyInactiveTabPane,Re=u.renderTabBar,Ne=u.onChange,Fe=u.onTabClick,Le=u.onTabScroll,Te=u.getPopupContainer,Ue=u.popupClassName,We=u.indicatorSize,tt=Ta(u,rv),Xe=k.useMemo(function(){return(s||[]).filter(function(Ht){return Ht&&Nn(Ht)==="object"&&"key"in Ht})},[s]),at=j==="rtl",Ct=Ny(te),st=k.useState(!1),jt=ii(st,2),At=jt[0],Qt=jt[1];k.useEffect(function(){Qt(s_())},[]);var Gt=qu(function(){var Ht;return(Ht=Xe[0])===null||Ht===void 0?void 0:Ht.key},{value:L,defaultValue:K}),ft=ii(Gt,2),Be=ft[0],gt=ft[1],$t=k.useState(function(){return Xe.findIndex(function(Ht){return Ht.key===Be})}),bt=ii($t,2),Bt=bt[0],Yt=bt[1];k.useEffect(function(){var Ht=Xe.findIndex(function(Oi){return Oi.key===Be});if(Ht===-1){var Mi;Ht=Math.max(0,Math.min(Bt,Xe.length-1)),gt((Mi=Xe[Ht])===null||Mi===void 0?void 0:Mi.key)}Yt(Ht)},[Xe.map(function(Ht){return Ht.key}).join("_"),Be,Bt]);var ei=qu(null,{value:w}),kt=ii(ei,2),gi=kt[0],pi=kt[1];k.useEffect(function(){w||(pi("rc-tabs-".concat(yp)),yp+=1)},[]);function Pt(Ht,Mi){Fe?.(Ht,Mi);var Oi=Ht!==Be;gt(Ht),Oi&&Ne?.(Ht)}var li={id:gi,activeKey:Be,animated:Ct,tabPosition:ye,rtl:at,mobile:At},Xi=ri(ri({},li),{},{editable:ne,locale:we,moreIcon:ge,moreTransitionName:xe,tabBarGutter:be,onTabClick:Pt,onTabScroll:Le,extra:ve,style:Se,panes:null,getPopupContainer:Te,popupClassName:Ue,indicatorSize:We});return k.createElement(Cc.Provider,{value:{tabs:Xe,prefixCls:A}},k.createElement("div",mi({ref:m,id:w,className:Tt(A,"".concat(A,"-").concat(ye),(b={},oi(b,"".concat(A,"-mobile"),At),oi(b,"".concat(A,"-editable"),ne),oi(b,"".concat(A,"-rtl"),at),b),F)},tt),k.createElement(ev,mi({},Xi,{renderTabBar:Re})),k.createElement(iv,mi({destroyInactiveTabPane:Pe},li,{animated:Ct}))))});const av={motionAppear:!1,motionEnter:!0,motionLeave:!0};function sv(u){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{inkBar:!0,tabPane:!1},b;return m===!1?b={inkBar:!1,tabPane:!1}:m===!0?b={inkBar:!0,tabPane:!0}:b=Object.assign({inkBar:!0},typeof m=="object"?m:{}),b.tabPane&&(b.tabPaneMotion=Object.assign(Object.assign({},av),{motionName:Qo(u,"switch")})),b}var ov=function(u,m){var b={};for(var w in u)Object.prototype.hasOwnProperty.call(u,w)&&m.indexOf(w)<0&&(b[w]=u[w]);if(u!=null&&typeof Object.getOwnPropertySymbols=="function")for(var T=0,w=Object.getOwnPropertySymbols(u);T<w.length;T++)m.indexOf(w[T])<0&&Object.prototype.propertyIsEnumerable.call(u,w[T])&&(b[w[T]]=u[w[T]]);return b};function lv(u){return u.filter(m=>m)}function cv(u,m){if(u)return u;const b=o_(m).map(w=>{if(k.isValidElement(w)){const{key:T,props:A}=w,F=A||{},{tab:s}=F,j=ov(F,["tab"]);return Object.assign(Object.assign({key:String(T)},j),{label:s})}return null});return lv(b)}const uv=u=>{const{componentCls:m,motionDurationSlow:b}=u;return[{[m]:{[`${m}-switch`]:{"&-appear, &-enter":{transition:"none","&-start":{opacity:0},"&-active":{opacity:1,transition:`opacity ${b}`}},"&-leave":{position:"absolute",transition:"none",inset:0,"&-start":{opacity:1},"&-active":{opacity:0,transition:`opacity ${b}`}}}}},[Ud(u,"slide-up"),Ud(u,"slide-down")]]},hv=uv,dv=u=>{const{componentCls:m,tabsCardPadding:b,cardBg:w,cardGutter:T,colorBorderSecondary:A,itemSelectedColor:F}=u;return{[`${m}-card`]:{[`> ${m}-nav, > div > ${m}-nav`]:{[`${m}-tab`]:{margin:0,padding:b,background:w,border:`${ct(u.lineWidth)} ${u.lineType} ${A}`,transition:`all ${u.motionDurationSlow} ${u.motionEaseInOut}`},[`${m}-tab-active`]:{color:F,background:u.colorBgContainer},[`${m}-ink-bar`]:{visibility:"hidden"}},[`&${m}-top, &${m}-bottom`]:{[`> ${m}-nav, > div > ${m}-nav`]:{[`${m}-tab + ${m}-tab`]:{marginLeft:{_skip_check_:!0,value:ct(T)}}}},[`&${m}-top`]:{[`> ${m}-nav, > div > ${m}-nav`]:{[`${m}-tab`]:{borderRadius:`${ct(u.borderRadiusLG)} ${ct(u.borderRadiusLG)} 0 0`},[`${m}-tab-active`]:{borderBottomColor:u.colorBgContainer}}},[`&${m}-bottom`]:{[`> ${m}-nav, > div > ${m}-nav`]:{[`${m}-tab`]:{borderRadius:`0 0 ${ct(u.borderRadiusLG)} ${ct(u.borderRadiusLG)}`},[`${m}-tab-active`]:{borderTopColor:u.colorBgContainer}}},[`&${m}-left, &${m}-right`]:{[`> ${m}-nav, > div > ${m}-nav`]:{[`${m}-tab + ${m}-tab`]:{marginTop:ct(T)}}},[`&${m}-left`]:{[`> ${m}-nav, > div > ${m}-nav`]:{[`${m}-tab`]:{borderRadius:{_skip_check_:!0,value:`${ct(u.borderRadiusLG)} 0 0 ${ct(u.borderRadiusLG)}`}},[`${m}-tab-active`]:{borderRightColor:{_skip_check_:!0,value:u.colorBgContainer}}}},[`&${m}-right`]:{[`> ${m}-nav, > div > ${m}-nav`]:{[`${m}-tab`]:{borderRadius:{_skip_check_:!0,value:`0 ${ct(u.borderRadiusLG)} ${ct(u.borderRadiusLG)} 0`}},[`${m}-tab-active`]:{borderLeftColor:{_skip_check_:!0,value:u.colorBgContainer}}}}}}},pv=u=>{const{componentCls:m,itemHoverColor:b,dropdownEdgeChildVerticalPadding:w}=u;return{[`${m}-dropdown`]:Object.assign(Object.assign({},js(u)),{position:"absolute",top:-9999,left:{_skip_check_:!0,value:-9999},zIndex:u.zIndexPopup,display:"block","&-hidden":{display:"none"},[`${m}-dropdown-menu`]:{maxHeight:u.tabsDropdownHeight,margin:0,padding:`${ct(w)} 0`,overflowX:"hidden",overflowY:"auto",textAlign:{_skip_check_:!0,value:"left"},listStyleType:"none",backgroundColor:u.colorBgContainer,backgroundClip:"padding-box",borderRadius:u.borderRadiusLG,outline:"none",boxShadow:u.boxShadowSecondary,"&-item":Object.assign(Object.assign({},th),{display:"flex",alignItems:"center",minWidth:u.tabsDropdownWidth,margin:0,padding:`${ct(u.paddingXXS)} ${ct(u.paddingSM)}`,color:u.colorText,fontWeight:"normal",fontSize:u.fontSize,lineHeight:u.lineHeight,cursor:"pointer",transition:`all ${u.motionDurationSlow}`,"> span":{flex:1,whiteSpace:"nowrap"},"&-remove":{flex:"none",marginLeft:{_skip_check_:!0,value:u.marginSM},color:u.colorTextDescription,fontSize:u.fontSizeSM,background:"transparent",border:0,cursor:"pointer","&:hover":{color:b}},"&:hover":{background:u.controlItemBgHover},"&-disabled":{"&, &:hover":{color:u.colorTextDisabled,background:"transparent",cursor:"not-allowed"}}})}})}},fv=u=>{const{componentCls:m,margin:b,colorBorderSecondary:w,horizontalMargin:T,verticalItemPadding:A,verticalItemMargin:F,calc:s}=u;return{[`${m}-top, ${m}-bottom`]:{flexDirection:"column",[`> ${m}-nav, > div > ${m}-nav`]:{margin:T,"&::before":{position:"absolute",right:{_skip_check_:!0,value:0},left:{_skip_check_:!0,value:0},borderBottom:`${ct(u.lineWidth)} ${u.lineType} ${w}`,content:"''"},[`${m}-ink-bar`]:{height:u.lineWidthBold,"&-animated":{transition:`width ${u.motionDurationSlow}, left ${u.motionDurationSlow},
            right ${u.motionDurationSlow}`}},[`${m}-nav-wrap`]:{"&::before, &::after":{top:0,bottom:0,width:u.controlHeight},"&::before":{left:{_skip_check_:!0,value:0},boxShadow:u.boxShadowTabsOverflowLeft},"&::after":{right:{_skip_check_:!0,value:0},boxShadow:u.boxShadowTabsOverflowRight},[`&${m}-nav-wrap-ping-left::before`]:{opacity:1},[`&${m}-nav-wrap-ping-right::after`]:{opacity:1}}}},[`${m}-top`]:{[`> ${m}-nav,
        > div > ${m}-nav`]:{"&::before":{bottom:0},[`${m}-ink-bar`]:{bottom:0}}},[`${m}-bottom`]:{[`> ${m}-nav, > div > ${m}-nav`]:{order:1,marginTop:b,marginBottom:0,"&::before":{top:0},[`${m}-ink-bar`]:{top:0}},[`> ${m}-content-holder, > div > ${m}-content-holder`]:{order:0}},[`${m}-left, ${m}-right`]:{[`> ${m}-nav, > div > ${m}-nav`]:{flexDirection:"column",minWidth:s(u.controlHeight).mul(1.25).equal(),[`${m}-tab`]:{padding:A,textAlign:"center"},[`${m}-tab + ${m}-tab`]:{margin:F},[`${m}-nav-wrap`]:{flexDirection:"column","&::before, &::after":{right:{_skip_check_:!0,value:0},left:{_skip_check_:!0,value:0},height:u.controlHeight},"&::before":{top:0,boxShadow:u.boxShadowTabsOverflowTop},"&::after":{bottom:0,boxShadow:u.boxShadowTabsOverflowBottom},[`&${m}-nav-wrap-ping-top::before`]:{opacity:1},[`&${m}-nav-wrap-ping-bottom::after`]:{opacity:1}},[`${m}-ink-bar`]:{width:u.lineWidthBold,"&-animated":{transition:`height ${u.motionDurationSlow}, top ${u.motionDurationSlow}`}},[`${m}-nav-list, ${m}-nav-operations`]:{flex:"1 0 auto",flexDirection:"column"}}},[`${m}-left`]:{[`> ${m}-nav, > div > ${m}-nav`]:{[`${m}-ink-bar`]:{right:{_skip_check_:!0,value:0}}},[`> ${m}-content-holder, > div > ${m}-content-holder`]:{marginLeft:{_skip_check_:!0,value:ct(s(u.lineWidth).mul(-1).equal())},borderLeft:{_skip_check_:!0,value:`${ct(u.lineWidth)} ${u.lineType} ${u.colorBorder}`},[`> ${m}-content > ${m}-tabpane`]:{paddingLeft:{_skip_check_:!0,value:u.paddingLG}}}},[`${m}-right`]:{[`> ${m}-nav, > div > ${m}-nav`]:{order:1,[`${m}-ink-bar`]:{left:{_skip_check_:!0,value:0}}},[`> ${m}-content-holder, > div > ${m}-content-holder`]:{order:0,marginRight:{_skip_check_:!0,value:s(u.lineWidth).mul(-1).equal()},borderRight:{_skip_check_:!0,value:`${ct(u.lineWidth)} ${u.lineType} ${u.colorBorder}`},[`> ${m}-content > ${m}-tabpane`]:{paddingRight:{_skip_check_:!0,value:u.paddingLG}}}}}},mv=u=>{const{componentCls:m,cardPaddingSM:b,cardPaddingLG:w,horizontalItemPaddingSM:T,horizontalItemPaddingLG:A}=u;return{[m]:{"&-small":{[`> ${m}-nav`]:{[`${m}-tab`]:{padding:T,fontSize:u.titleFontSizeSM}}},"&-large":{[`> ${m}-nav`]:{[`${m}-tab`]:{padding:A,fontSize:u.titleFontSizeLG}}}},[`${m}-card`]:{[`&${m}-small`]:{[`> ${m}-nav`]:{[`${m}-tab`]:{padding:b}},[`&${m}-bottom`]:{[`> ${m}-nav ${m}-tab`]:{borderRadius:`0 0 ${ct(u.borderRadius)} ${ct(u.borderRadius)}`}},[`&${m}-top`]:{[`> ${m}-nav ${m}-tab`]:{borderRadius:`${ct(u.borderRadius)} ${ct(u.borderRadius)} 0 0`}},[`&${m}-right`]:{[`> ${m}-nav ${m}-tab`]:{borderRadius:{_skip_check_:!0,value:`0 ${ct(u.borderRadius)} ${ct(u.borderRadius)} 0`}}},[`&${m}-left`]:{[`> ${m}-nav ${m}-tab`]:{borderRadius:{_skip_check_:!0,value:`${ct(u.borderRadius)} 0 0 ${ct(u.borderRadius)}`}}}},[`&${m}-large`]:{[`> ${m}-nav`]:{[`${m}-tab`]:{padding:w}}}}}},gv=u=>{const{componentCls:m,itemActiveColor:b,itemHoverColor:w,iconCls:T,tabsHorizontalItemMargin:A,horizontalItemPadding:F,itemSelectedColor:s,itemColor:j}=u,L=`${m}-tab`;return{[L]:{position:"relative",WebkitTouchCallout:"none",WebkitTapHighlightColor:"transparent",display:"inline-flex",alignItems:"center",padding:F,fontSize:u.titleFontSize,background:"transparent",border:0,outline:"none",cursor:"pointer",color:j,"&-btn, &-remove":Object.assign({"&:focus:not(:focus-visible), &:active":{color:b}},Ju(u)),"&-btn":{outline:"none",transition:"all 0.3s",[`${L}-icon:not(:last-child)`]:{marginInlineEnd:u.marginSM}},"&-remove":{flex:"none",marginRight:{_skip_check_:!0,value:u.calc(u.marginXXS).mul(-1).equal()},marginLeft:{_skip_check_:!0,value:u.marginXS},color:u.colorTextDescription,fontSize:u.fontSizeSM,background:"transparent",border:"none",outline:"none",cursor:"pointer",transition:`all ${u.motionDurationSlow}`,"&:hover":{color:u.colorTextHeading}},"&:hover":{color:w},[`&${L}-active ${L}-btn`]:{color:s,textShadow:u.tabsActiveTextShadow},[`&${L}-disabled`]:{color:u.colorTextDisabled,cursor:"not-allowed"},[`&${L}-disabled ${L}-btn, &${L}-disabled ${m}-remove`]:{"&:focus, &:active":{color:u.colorTextDisabled}},[`& ${L}-remove ${T}`]:{margin:0},[`${T}:not(:last-child)`]:{marginRight:{_skip_check_:!0,value:u.marginSM}}},[`${L} + ${L}`]:{margin:{_skip_check_:!0,value:A}}}},_v=u=>{const{componentCls:m,tabsHorizontalItemMarginRTL:b,iconCls:w,cardGutter:T,calc:A}=u;return{[`${m}-rtl`]:{direction:"rtl",[`${m}-nav`]:{[`${m}-tab`]:{margin:{_skip_check_:!0,value:b},[`${m}-tab:last-of-type`]:{marginLeft:{_skip_check_:!0,value:0}},[w]:{marginRight:{_skip_check_:!0,value:0},marginLeft:{_skip_check_:!0,value:ct(u.marginSM)}},[`${m}-tab-remove`]:{marginRight:{_skip_check_:!0,value:ct(u.marginXS)},marginLeft:{_skip_check_:!0,value:ct(A(u.marginXXS).mul(-1).equal())},[w]:{margin:0}}}},[`&${m}-left`]:{[`> ${m}-nav`]:{order:1},[`> ${m}-content-holder`]:{order:0}},[`&${m}-right`]:{[`> ${m}-nav`]:{order:0},[`> ${m}-content-holder`]:{order:1}},[`&${m}-card${m}-top, &${m}-card${m}-bottom`]:{[`> ${m}-nav, > div > ${m}-nav`]:{[`${m}-tab + ${m}-tab`]:{marginRight:{_skip_check_:!0,value:T},marginLeft:{_skip_check_:!0,value:0}}}}},[`${m}-dropdown-rtl`]:{direction:"rtl"},[`${m}-menu-item`]:{[`${m}-dropdown-rtl`]:{textAlign:{_skip_check_:!0,value:"right"}}}}},yv=u=>{const{componentCls:m,tabsCardPadding:b,cardHeight:w,cardGutter:T,itemHoverColor:A,itemActiveColor:F,colorBorderSecondary:s}=u;return{[m]:Object.assign(Object.assign(Object.assign(Object.assign({},js(u)),{display:"flex",[`> ${m}-nav, > div > ${m}-nav`]:{position:"relative",display:"flex",flex:"none",alignItems:"center",[`${m}-nav-wrap`]:{position:"relative",display:"flex",flex:"auto",alignSelf:"stretch",overflow:"hidden",whiteSpace:"nowrap",transform:"translate(0)","&::before, &::after":{position:"absolute",zIndex:1,opacity:0,transition:`opacity ${u.motionDurationSlow}`,content:"''",pointerEvents:"none"}},[`${m}-nav-list`]:{position:"relative",display:"flex",transition:`opacity ${u.motionDurationSlow}`},[`${m}-nav-operations`]:{display:"flex",alignSelf:"stretch"},[`${m}-nav-operations-hidden`]:{position:"absolute",visibility:"hidden",pointerEvents:"none"},[`${m}-nav-more`]:{position:"relative",padding:b,background:"transparent",border:0,color:u.colorText,"&::after":{position:"absolute",right:{_skip_check_:!0,value:0},bottom:0,left:{_skip_check_:!0,value:0},height:u.calc(u.controlHeightLG).div(8).equal(),transform:"translateY(100%)",content:"''"}},[`${m}-nav-add`]:Object.assign({minWidth:w,minHeight:w,marginLeft:{_skip_check_:!0,value:T},padding:`0 ${ct(u.paddingXS)}`,background:"transparent",border:`${ct(u.lineWidth)} ${u.lineType} ${s}`,borderRadius:`${ct(u.borderRadiusLG)} ${ct(u.borderRadiusLG)} 0 0`,outline:"none",cursor:"pointer",color:u.colorText,transition:`all ${u.motionDurationSlow} ${u.motionEaseInOut}`,"&:hover":{color:A},"&:active, &:focus:not(:focus-visible)":{color:F}},Ju(u))},[`${m}-extra-content`]:{flex:"none"},[`${m}-ink-bar`]:{position:"absolute",background:u.inkBarColor,pointerEvents:"none"}}),gv(u)),{[`${m}-content`]:{position:"relative",width:"100%"},[`${m}-content-holder`]:{flex:"auto",minWidth:0,minHeight:0},[`${m}-tabpane`]:{outline:"none","&-hidden":{display:"none"}}}),[`${m}-centered`]:{[`> ${m}-nav, > div > ${m}-nav`]:{[`${m}-nav-wrap`]:{[`&:not([class*='${m}-nav-wrap-ping'])`]:{justifyContent:"center"}}}}}},vv=u=>{const m=u.controlHeightLG;return{zIndexPopup:u.zIndexPopupBase+50,cardBg:u.colorFillAlter,cardHeight:m,cardPadding:`${(m-Math.round(u.fontSize*u.lineHeight))/2-u.lineWidth}px ${u.padding}px`,cardPaddingSM:`${u.paddingXXS*1.5}px ${u.padding}px`,cardPaddingLG:`${u.paddingXS}px ${u.padding}px ${u.paddingXXS*1.5}px`,titleFontSize:u.fontSize,titleFontSizeLG:u.fontSizeLG,titleFontSizeSM:u.fontSize,inkBarColor:u.colorPrimary,horizontalMargin:`0 0 ${u.margin}px 0`,horizontalItemGutter:32,horizontalItemMargin:"",horizontalItemMarginRTL:"",horizontalItemPadding:`${u.paddingSM}px 0`,horizontalItemPaddingSM:`${u.paddingXS}px 0`,horizontalItemPaddingLG:`${u.padding}px 0`,verticalItemPadding:`${u.paddingXS}px ${u.paddingLG}px`,verticalItemMargin:`${u.margin}px 0 0 0`,itemColor:u.colorText,itemSelectedColor:u.colorPrimary,itemHoverColor:u.colorPrimaryHover,itemActiveColor:u.colorPrimaryActive,cardGutter:u.marginXXS/2}},xv=tl("Tabs",u=>{const m=il(u,{tabsCardPadding:u.cardPadding,dropdownEdgeChildVerticalPadding:u.paddingXXS,tabsActiveTextShadow:"0 0 0.25px currentcolor",tabsDropdownHeight:200,tabsDropdownWidth:120,tabsHorizontalItemMargin:`0 0 0 ${ct(u.horizontalItemGutter)}`,tabsHorizontalItemMarginRTL:`0 0 0 ${ct(u.horizontalItemGutter)}`});return[mv(m),_v(m),fv(m),pv(m),dv(m),yv(m),hv(m)]},vv),bv=()=>null,wv=bv;var Sv=function(u,m){var b={};for(var w in u)Object.prototype.hasOwnProperty.call(u,w)&&m.indexOf(w)<0&&(b[w]=u[w]);if(u!=null&&typeof Object.getOwnPropertySymbols=="function")for(var T=0,w=Object.getOwnPropertySymbols(u);T<w.length;T++)m.indexOf(w[T])<0&&Object.prototype.propertyIsEnumerable.call(u,w[T])&&(b[w[T]]=u[w[T]]);return b};const Ff=u=>{const{type:m,className:b,rootClassName:w,size:T,onEdit:A,hideAdd:F,centered:s,addIcon:j,popupClassName:L,children:K,items:ne,animated:te,style:he,indicatorSize:ye}=u,be=Sv(u,["type","className","rootClassName","size","onEdit","hideAdd","centered","addIcon","popupClassName","children","items","animated","style","indicatorSize"]),{prefixCls:Se,moreIcon:ve=k.createElement(c_,null)}=be,{direction:we,tabs:ge,getPrefixCls:xe,getPopupContainer:Pe}=k.useContext(jn),Re=xe("tabs",Se),Ne=rl(Re),[Fe,Le,Te]=xv(Re,Ne);let Ue;m==="editable-card"&&(Ue={onEdit:(st,jt)=>{let{key:At,event:Qt}=jt;A?.(st==="add"?Qt:At,st)},removeIcon:k.createElement(Vs,null),addIcon:j||k.createElement(Oy,null),showAdd:F!==!0});const We=xe(),tt=cv(ne,K),Xe=sv(Re,te),at=l_(T),Ct=Object.assign(Object.assign({},ge?.style),he);return Fe(k.createElement(nv,Object.assign({direction:we,getPopupContainer:Pe,moreTransitionName:`${We}-slide-up`},be,{items:tt,className:Tt({[`${Re}-${at}`]:at,[`${Re}-card`]:["card","editable-card"].includes(m),[`${Re}-editable-card`]:m==="editable-card",[`${Re}-centered`]:s},ge?.className,b,w,Le,Te,Ne),popupClassName:Tt(L,Le,Te,Ne),style:Ct,editable:Ue,moreIcon:ve,prefixCls:Re,animated:Xe,indicatorSize:ye??ge?.indicatorSize})))};Ff.TabPane=wv;const Cv=Ff;let mn=null,Xa=u=>u(),el=[],xc={};function vp(){const{prefixCls:u,getContainer:m,duration:b,rtl:w,maxCount:T,top:A}=xc,F=u??eh().getPrefixCls("message"),s=m?.()||document.body;return{prefixCls:F,getContainer:()=>s,duration:b,rtl:w,maxCount:T,top:A}}const Tv=k.forwardRef((u,m)=>{const[b,w]=k.useState(vp),[T,A]=uf(b),F=eh(),s=F.getRootPrefixCls(),j=F.getIconPrefixCls(),L=F.getTheme(),K=()=>{w(vp)};return k.useEffect(K,[]),k.useImperativeHandle(m,()=>{const ne=Object.assign({},T);return Object.keys(ne).forEach(te=>{ne[te]=function(){return K(),T[te].apply(T,arguments)}}),{instance:ne,sync:K}}),k.createElement(Xp,{prefixCls:s,iconPrefixCls:j,theme:L},A)});function Tc(){if(!mn){const u=document.createDocumentFragment(),m={fragment:u};mn=m,Xa(()=>{Kp(k.createElement(Tv,{ref:b=>{const{instance:w,sync:T}=b||{};Promise.resolve().then(()=>{!m.instance&&w&&(m.instance=w,m.sync=T,Tc())})}}),u)});return}mn.instance&&(el.forEach(u=>{const{type:m,skipped:b}=u;if(!b)switch(m){case"open":{Xa(()=>{const w=mn.instance.open(Object.assign(Object.assign({},xc),u.config));w?.then(u.resolve),u.setCloseFn(w)});break}case"destroy":Xa(()=>{mn?.instance.destroy(u.key)});break;default:Xa(()=>{var w;const T=(w=mn.instance)[m].apply(w,qi(u.args));T?.then(u.resolve),u.setCloseFn(T)})}}),el=[])}function Iv(u){xc=Object.assign(Object.assign({},xc),u),Xa(()=>{var m;(m=mn?.sync)===null||m===void 0||m.call(mn)})}function Ev(u){const m=rh(b=>{let w;const T={type:"open",config:u,resolve:b,setCloseFn:A=>{w=A}};return el.push(T),()=>{w?Xa(()=>{w()}):T.skipped=!0}});return Tc(),m}function Pv(u,m){const b=rh(w=>{let T;const A={type:u,args:m,resolve:w,setCloseFn:F=>{T=F}};return el.push(A),()=>{T?Xa(()=>{T()}):A.skipped=!0}});return Tc(),b}function Mv(u){el.push({type:"destroy",key:u}),Tc()}const Av=["success","info","warning","error","loading"],kv={open:Ev,destroy:Mv,config:Iv,useMessage:ty,_InternalPanelDoNotUseOrYouWillBeFired:H_},$f=kv;Av.forEach(u=>{$f[u]=function(){for(var m=arguments.length,b=new Array(m),w=0;w<m;w++)b[w]=arguments[w];return Pv(u,b)}});const xp=$f;var zv=function(u,m){var b={};for(var w in u)Object.prototype.hasOwnProperty.call(u,w)&&m.indexOf(w)<0&&(b[w]=u[w]);if(u!=null&&typeof Object.getOwnPropertySymbols=="function")for(var T=0,w=Object.getOwnPropertySymbols(u);T<w.length;T++)m.indexOf(w[T])<0&&Object.prototype.propertyIsEnumerable.call(u,w[T])&&(b[w[T]]=u[w[T]]);return b};const Dv=u=>{const{prefixCls:m,className:b,closeIcon:w,closable:T,type:A,title:F,children:s,footer:j}=u,L=zv(u,["prefixCls","className","closeIcon","closable","type","title","children","footer"]),{getPrefixCls:K}=k.useContext(jn),ne=K(),te=m||K("modal"),he=rl(ne),[ye,be,Se]=wf(te,he),ve=`${te}-confirm`;let we={};return A?we={closable:T??!1,title:"",footer:"",children:k.createElement(Cf,Object.assign({},u,{prefixCls:te,confirmPrefixCls:ve,rootPrefixCls:ne,content:s}))}:we={closable:T??!0,title:F,footer:j!==null&&k.createElement(yf,Object.assign({},u)),children:s},ye(k.createElement(ff,Object.assign({prefixCls:te,className:Tt(be,`${te}-pure-panel`,A&&ve,A&&`${ve}-${A}`,b,Se,he)},L,{closeIcon:_f(te,w),closable:T},we)))},Lv=u_(Dv);function Of(u){return sl(Ef(u))}const In=Sf;In.useModal=Ry;In.info=function(m){return sl(Pf(m))};In.success=function(m){return sl(Mf(m))};In.error=function(m){return sl(Af(m))};In.warning=Of;In.warn=Of;In.confirm=function(m){return sl(kf(m))};In.destroyAll=function(){for(;Wa.length;){const m=Wa.pop();m&&m()}};In.config=Ay;In._InternalPanelDoNotUseOrYouWillBeFired=Lv;const Wu=In;var Rv={percent:0,prefixCls:"rc-progress",strokeColor:"#2db7f5",strokeLinecap:"round",strokeWidth:1,trailColor:"#D9D9D9",trailWidth:1,gapPosition:"bottom"},Bv=function(){var m=k.useRef([]),b=k.useRef(null);return k.useEffect(function(){var w=Date.now(),T=!1;m.current.forEach(function(A){if(A){T=!0;var F=A.style;F.transitionDuration=".3s, .3s, .3s, .06s",b.current&&w-b.current<100&&(F.transitionDuration="0s, 0s")}}),T&&(b.current=Date.now())}),m.current},bp=0,Fv=Zp();function $v(){var u;return Fv?(u=bp,bp+=1):u="TEST_OR_SSR",u}const Ov=function(u){var m=k.useState(),b=ii(m,2),w=b[0],T=b[1];return k.useEffect(function(){T("rc_progress_".concat($v()))},[]),u||w};var wp=function(m){var b=m.bg,w=m.children;return k.createElement("div",{style:{width:"100%",height:"100%",background:b}},w)};function Sp(u,m){return Object.keys(u).map(function(b){var w=parseFloat(b),T="".concat(Math.floor(w*m),"%");return"".concat(u[b]," ").concat(T)})}var Nv=k.forwardRef(function(u,m){var b=u.prefixCls,w=u.color,T=u.gradientId,A=u.radius,F=u.style,s=u.ptg,j=u.strokeLinecap,L=u.strokeWidth,K=u.size,ne=u.gapDegree,te=w&&Nn(w)==="object",he=te?"#FFF":void 0,ye=K/2,be=k.createElement("circle",{className:"".concat(b,"-circle-path"),r:A,cx:ye,cy:ye,stroke:he,strokeLinecap:j,strokeWidth:L,opacity:s===0?0:1,style:F,ref:m});if(!te)return be;var Se="".concat(T,"-conic"),ve=ne?"".concat(180+ne/2,"deg"):"0deg",we=Sp(w,(360-ne)/360),ge=Sp(w,1),xe="conic-gradient(from ".concat(ve,", ").concat(we.join(", "),")"),Pe="linear-gradient(to ".concat(ne?"bottom":"top",", ").concat(ge.join(", "),")");return k.createElement(k.Fragment,null,k.createElement("mask",{id:Se},be),k.createElement("foreignObject",{x:0,y:0,width:K,height:K,mask:"url(#".concat(Se,")")},k.createElement(wp,{bg:Pe},k.createElement(wp,{bg:xe}))))}),Ko=100,Bu=function(m,b,w,T,A,F,s,j,L,K){var ne=arguments.length>10&&arguments[10]!==void 0?arguments[10]:0,te=w/100*360*((360-F)/360),he=F===0?0:{bottom:0,top:180,left:90,right:-90}[s],ye=(100-T)/100*b;L==="round"&&T!==100&&(ye+=K/2,ye>=b&&(ye=b-.01));var be=Ko/2;return{stroke:typeof j=="string"?j:void 0,strokeDasharray:"".concat(b,"px ").concat(m),strokeDashoffset:ye+ne,transform:"rotate(".concat(A+te+he,"deg)"),transformOrigin:"".concat(be,"px ").concat(be,"px"),transition:"stroke-dashoffset .3s ease 0s, stroke-dasharray .3s ease 0s, stroke .3s, stroke-width .06s ease .3s, opacity .3s ease 0s",fillOpacity:0}},jv=["id","prefixCls","steps","strokeWidth","trailWidth","gapDegree","gapPosition","trailColor","strokeLinecap","style","className","strokeColor","percent"];function Cp(u){var m=u??[];return Array.isArray(m)?m:[m]}var Vv=function(m){var b=ri(ri({},Rv),m),w=b.id,T=b.prefixCls,A=b.steps,F=b.strokeWidth,s=b.trailWidth,j=b.gapDegree,L=j===void 0?0:j,K=b.gapPosition,ne=b.trailColor,te=b.strokeLinecap,he=b.style,ye=b.className,be=b.strokeColor,Se=b.percent,ve=Ta(b,jv),we=Ko/2,ge=Ov(w),xe="".concat(ge,"-gradient"),Pe=we-F/2,Re=Math.PI*2*Pe,Ne=L>0?90+L/2:-90,Fe=Re*((360-L)/360),Le=Nn(A)==="object"?A:{count:A,space:2},Te=Le.count,Ue=Le.space,We=Cp(Se),tt=Cp(be),Xe=tt.find(function(Gt){return Gt&&Nn(Gt)==="object"}),at=Xe&&Nn(Xe)==="object",Ct=at?"butt":te,st=Bu(Re,Fe,0,100,Ne,L,K,ne,Ct,F),jt=Bv(),At=function(){var ft=0;return We.map(function(Be,gt){var $t=tt[gt]||tt[tt.length-1],bt=Bu(Re,Fe,ft,Be,Ne,L,K,$t,Ct,F);return ft+=Be,k.createElement(Nv,{key:gt,color:$t,ptg:Be,radius:Pe,prefixCls:T,gradientId:xe,style:bt,strokeLinecap:Ct,strokeWidth:F,gapDegree:L,ref:function(Yt){jt[gt]=Yt},size:Ko})}).reverse()},Qt=function(){var ft=Math.round(Te*(We[0]/100)),Be=100/Te,gt=0;return new Array(Te).fill(null).map(function($t,bt){var Bt=bt<=ft-1?tt[0]:ne,Yt=Bt&&Nn(Bt)==="object"?"url(#".concat(xe,")"):void 0,ei=Bu(Re,Fe,gt,Be,Ne,L,K,Bt,"butt",F,Ue);return gt+=(Fe-ei.strokeDashoffset+Ue)*100/Fe,k.createElement("circle",{key:bt,className:"".concat(T,"-circle-path"),r:Pe,cx:we,cy:we,stroke:Yt,strokeWidth:F,opacity:1,style:ei,ref:function(gi){jt[bt]=gi}})})};return k.createElement("svg",mi({className:Tt("".concat(T,"-circle"),ye),viewBox:"0 0 ".concat(Ko," ").concat(Ko),style:he,id:w,role:"presentation"},ve),!Te&&k.createElement("circle",{className:"".concat(T,"-circle-trail"),r:Pe,cx:we,cy:we,stroke:ne,strokeLinecap:Ct,strokeWidth:s||F,style:st}),Te?Qt():At())};function Ca(u){return!u||u<0?0:u>100?100:u}function bc(u){let{success:m,successPercent:b}=u,w=b;return m&&"progress"in m&&(w=m.progress),m&&"percent"in m&&(w=m.percent),w}const Uv=u=>{let{percent:m,success:b,successPercent:w}=u;const T=Ca(bc({success:b,successPercent:w}));return[T,Ca(Ca(m)-T)]},qv=u=>{let{success:m={},strokeColor:b}=u;const{strokeColor:w}=m;return[w||Gu.green,b||null]},Ic=(u,m,b)=>{var w,T,A,F;let s=-1,j=-1;if(m==="step"){const L=b.steps,K=b.strokeWidth;typeof u=="string"||typeof u>"u"?(s=u==="small"?2:14,j=K??8):typeof u=="number"?[s,j]=[u,u]:[s=14,j=8]=u,s*=L}else if(m==="line"){const L=b?.strokeWidth;typeof u=="string"||typeof u>"u"?j=L||(u==="small"?6:8):typeof u=="number"?[s,j]=[u,u]:[s=-1,j=8]=u}else(m==="circle"||m==="dashboard")&&(typeof u=="string"||typeof u>"u"?[s,j]=u==="small"?[60,60]:[120,120]:typeof u=="number"?[s,j]=[u,u]:(s=(T=(w=u[0])!==null&&w!==void 0?w:u[1])!==null&&T!==void 0?T:120,j=(F=(A=u[0])!==null&&A!==void 0?A:u[1])!==null&&F!==void 0?F:120));return[s,j]},Gv=3,Zv=u=>Gv/u*100,Hv=u=>{const{prefixCls:m,trailColor:b=null,strokeLinecap:w="round",gapPosition:T,gapDegree:A,width:F=120,type:s,children:j,success:L,size:K=F}=u,[ne,te]=Ic(K,"circle");let{strokeWidth:he}=u;he===void 0&&(he=Math.max(Zv(ne),6));const ye={width:ne,height:te,fontSize:ne*.15+6},be=k.useMemo(()=>{if(A||A===0)return A;if(s==="dashboard")return 75},[A,s]),Se=T||s==="dashboard"&&"bottom"||void 0,ve=Object.prototype.toString.call(u.strokeColor)==="[object Object]",we=qv({success:L,strokeColor:u.strokeColor}),ge=Tt(`${m}-inner`,{[`${m}-circle-gradient`]:ve}),xe=k.createElement(Vv,{percent:Uv(u),strokeWidth:he,trailWidth:he,strokeColor:we,strokeLinecap:w,trailColor:b,prefixCls:m,gapDegree:be,gapPosition:Se});return k.createElement("div",{className:ge,style:ye},ne<=20?k.createElement(Jp,{title:j},k.createElement("span",null,xe)):k.createElement(k.Fragment,null,xe,j))},Wv=Hv,wc="--progress-line-stroke-color",Nf="--progress-percent",Tp=u=>{const m=u?"100%":"-100%";return new Ka(`antProgress${u?"RTL":"LTR"}Active`,{"0%":{transform:`translateX(${m}) scaleX(0)`,opacity:.1},"20%":{transform:`translateX(${m}) scaleX(0)`,opacity:.5},to:{transform:"translateX(0) scaleX(1)",opacity:0}})},Xv=u=>{const{componentCls:m,iconCls:b}=u;return{[m]:Object.assign(Object.assign({},js(u)),{display:"inline-block","&-rtl":{direction:"rtl"},"&-line":{position:"relative",width:"100%",fontSize:u.fontSize,marginInlineEnd:u.marginXS,marginBottom:u.marginXS},[`${m}-outer`]:{display:"inline-block",width:"100%"},[`&${m}-show-info`]:{[`${m}-outer`]:{marginInlineEnd:`calc(-2em - ${ct(u.marginXS)})`,paddingInlineEnd:`calc(2em + ${ct(u.paddingXS)})`}},[`${m}-inner`]:{position:"relative",display:"inline-block",width:"100%",overflow:"hidden",verticalAlign:"middle",backgroundColor:u.remainingColor,borderRadius:u.lineBorderRadius},[`${m}-inner:not(${m}-circle-gradient)`]:{[`${m}-circle-path`]:{stroke:u.defaultColor}},[`${m}-success-bg, ${m}-bg`]:{position:"relative",background:u.defaultColor,borderRadius:u.lineBorderRadius,transition:`all ${u.motionDurationSlow} ${u.motionEaseInOutCirc}`},[`${m}-bg`]:{overflow:"hidden","&::after":{content:'""',background:{_multi_value_:!0,value:["inherit",`var(${wc})`]},height:"100%",width:`calc(1 / var(${Nf}) * 100%)`,display:"block"}},[`${m}-success-bg`]:{position:"absolute",insetBlockStart:0,insetInlineStart:0,backgroundColor:u.colorSuccess},[`${m}-text`]:{display:"inline-block",width:"2em",marginInlineStart:u.marginXS,color:u.colorText,lineHeight:1,whiteSpace:"nowrap",textAlign:"start",verticalAlign:"middle",wordBreak:"normal",[b]:{fontSize:u.fontSize}},[`&${m}-status-active`]:{[`${m}-bg::before`]:{position:"absolute",inset:0,backgroundColor:u.colorBgContainer,borderRadius:u.lineBorderRadius,opacity:0,animationName:Tp(),animationDuration:u.progressActiveMotionDuration,animationTimingFunction:u.motionEaseOutQuint,animationIterationCount:"infinite",content:'""'}},[`&${m}-rtl${m}-status-active`]:{[`${m}-bg::before`]:{animationName:Tp(!0)}},[`&${m}-status-exception`]:{[`${m}-bg`]:{backgroundColor:u.colorError},[`${m}-text`]:{color:u.colorError}},[`&${m}-status-exception ${m}-inner:not(${m}-circle-gradient)`]:{[`${m}-circle-path`]:{stroke:u.colorError}},[`&${m}-status-success`]:{[`${m}-bg`]:{backgroundColor:u.colorSuccess},[`${m}-text`]:{color:u.colorSuccess}},[`&${m}-status-success ${m}-inner:not(${m}-circle-gradient)`]:{[`${m}-circle-path`]:{stroke:u.colorSuccess}}})}},Kv=u=>{const{componentCls:m,iconCls:b}=u;return{[m]:{[`${m}-circle-trail`]:{stroke:u.remainingColor},[`&${m}-circle ${m}-inner`]:{position:"relative",lineHeight:1,backgroundColor:"transparent"},[`&${m}-circle ${m}-text`]:{position:"absolute",insetBlockStart:"50%",insetInlineStart:0,width:"100%",margin:0,padding:0,color:u.circleTextColor,fontSize:u.circleTextFontSize,lineHeight:1,whiteSpace:"normal",textAlign:"center",transform:"translateY(-50%)",[b]:{fontSize:u.circleIconFontSize}},[`${m}-circle&-status-exception`]:{[`${m}-text`]:{color:u.colorError}},[`${m}-circle&-status-success`]:{[`${m}-text`]:{color:u.colorSuccess}}},[`${m}-inline-circle`]:{lineHeight:1,[`${m}-inner`]:{verticalAlign:"bottom"}}}},Yv=u=>{const{componentCls:m}=u;return{[m]:{[`${m}-steps`]:{display:"inline-block","&-outer":{display:"flex",flexDirection:"row",alignItems:"center"},"&-item":{flexShrink:0,minWidth:u.progressStepMinWidth,marginInlineEnd:u.progressStepMarginInlineEnd,backgroundColor:u.remainingColor,transition:`all ${u.motionDurationSlow}`,"&-active":{backgroundColor:u.defaultColor}}}}}},Jv=u=>{const{componentCls:m,iconCls:b}=u;return{[m]:{[`${m}-small&-line, ${m}-small&-line ${m}-text ${b}`]:{fontSize:u.fontSizeSM}}}},Qv=u=>({circleTextColor:u.colorText,defaultColor:u.colorInfo,remainingColor:u.colorFillSecondary,lineBorderRadius:100,circleTextFontSize:"1em",circleIconFontSize:`${u.fontSize/u.fontSizeSM}em`}),e0=tl("Progress",u=>{const m=u.calc(u.marginXXS).div(2).equal(),b=il(u,{progressStepMarginInlineEnd:m,progressStepMinWidth:m,progressActiveMotionDuration:"2.4s"});return[Xv(b),Kv(b),Yv(b),Jv(b)]},Qv);var t0=function(u,m){var b={};for(var w in u)Object.prototype.hasOwnProperty.call(u,w)&&m.indexOf(w)<0&&(b[w]=u[w]);if(u!=null&&typeof Object.getOwnPropertySymbols=="function")for(var T=0,w=Object.getOwnPropertySymbols(u);T<w.length;T++)m.indexOf(w[T])<0&&Object.prototype.propertyIsEnumerable.call(u,w[T])&&(b[w[T]]=u[w[T]]);return b};const i0=u=>{let m=[];return Object.keys(u).forEach(b=>{const w=parseFloat(b.replace(/%/g,""));isNaN(w)||m.push({key:w,value:u[b]})}),m=m.sort((b,w)=>b.key-w.key),m.map(b=>{let{key:w,value:T}=b;return`${T} ${w}%`}).join(", ")},r0=(u,m)=>{const{from:b=Gu.blue,to:w=Gu.blue,direction:T=m==="rtl"?"to left":"to right"}=u,A=t0(u,["from","to","direction"]);if(Object.keys(A).length!==0){const s=i0(A),j=`linear-gradient(${T}, ${s})`;return{background:j,[wc]:j}}const F=`linear-gradient(${T}, ${b}, ${w})`;return{background:F,[wc]:F}},n0=u=>{const{prefixCls:m,direction:b,percent:w,size:T,strokeWidth:A,strokeColor:F,strokeLinecap:s="round",children:j,trailColor:L=null,success:K}=u,ne=F&&typeof F!="string"?r0(F,b):{[wc]:F,background:F},te=s==="square"||s==="butt"?0:void 0,he=T??[-1,A||(T==="small"?6:8)],[ye,be]=Ic(he,"line",{strokeWidth:A}),Se={backgroundColor:L||void 0,borderRadius:te},ve=Object.assign(Object.assign({width:`${Ca(w)}%`,height:be,borderRadius:te},ne),{[Nf]:Ca(w)/100}),we=bc(u),ge={width:`${Ca(we)}%`,height:be,borderRadius:te,backgroundColor:K?.strokeColor},xe={width:ye<0?"100%":ye,height:be};return k.createElement(k.Fragment,null,k.createElement("div",{className:`${m}-outer`,style:xe},k.createElement("div",{className:`${m}-inner`,style:Se},k.createElement("div",{className:`${m}-bg`,style:ve}),we!==void 0?k.createElement("div",{className:`${m}-success-bg`,style:ge}):null)),j)},a0=n0,s0=u=>{const{size:m,steps:b,percent:w=0,strokeWidth:T=8,strokeColor:A,trailColor:F=null,prefixCls:s,children:j}=u,L=Math.round(b*(w/100)),ne=m??[m==="small"?2:14,T],[te,he]=Ic(ne,"step",{steps:b,strokeWidth:T}),ye=te/b,be=new Array(b);for(let Se=0;Se<b;Se++){const ve=Array.isArray(A)?A[Se]:A;be[Se]=k.createElement("div",{key:Se,className:Tt(`${s}-steps-item`,{[`${s}-steps-item-active`]:Se<=L-1}),style:{backgroundColor:Se<=L-1?ve:F,width:ye,height:he}})}return k.createElement("div",{className:`${s}-steps-outer`},be,j)},o0=s0;var l0=function(u,m){var b={};for(var w in u)Object.prototype.hasOwnProperty.call(u,w)&&m.indexOf(w)<0&&(b[w]=u[w]);if(u!=null&&typeof Object.getOwnPropertySymbols=="function")for(var T=0,w=Object.getOwnPropertySymbols(u);T<w.length;T++)m.indexOf(w[T])<0&&Object.prototype.propertyIsEnumerable.call(u,w[T])&&(b[w[T]]=u[w[T]]);return b};const c0=["normal","exception","active","success"],u0=k.forwardRef((u,m)=>{const{prefixCls:b,className:w,rootClassName:T,steps:A,strokeColor:F,percent:s=0,size:j="default",showInfo:L=!0,type:K="line",status:ne,format:te,style:he}=u,ye=l0(u,["prefixCls","className","rootClassName","steps","strokeColor","percent","size","showInfo","type","status","format","style"]),be=k.useMemo(()=>{var tt,Xe;const at=bc(u);return parseInt(at!==void 0?(tt=at??0)===null||tt===void 0?void 0:tt.toString():(Xe=s??0)===null||Xe===void 0?void 0:Xe.toString(),10)},[s,u.success,u.successPercent]),Se=k.useMemo(()=>!c0.includes(ne)&&be>=100?"success":ne||"normal",[ne,be]),{getPrefixCls:ve,direction:we,progress:ge}=k.useContext(jn),xe=ve("progress",b),[Pe,Re,Ne]=e0(xe),Fe=k.useMemo(()=>{if(!L)return null;const tt=bc(u);let Xe;const at=te||(st=>`${st}%`),Ct=K==="line";return te||Se!=="exception"&&Se!=="success"?Xe=at(Ca(s),Ca(tt)):Se==="exception"?Xe=Ct?k.createElement(Yu,null):k.createElement(Vs,null):Se==="success"&&(Xe=Ct?k.createElement(Ku,null):k.createElement(d_,null)),k.createElement("span",{className:`${xe}-text`,title:typeof Xe=="string"?Xe:void 0},Xe)},[L,s,be,Se,K,xe,te]),Le=Array.isArray(F)?F[0]:F,Te=typeof F=="string"||Array.isArray(F)?F:void 0;let Ue;K==="line"?Ue=A?k.createElement(o0,Object.assign({},u,{strokeColor:Te,prefixCls:xe,steps:A}),Fe):k.createElement(a0,Object.assign({},u,{strokeColor:Le,prefixCls:xe,direction:we}),Fe):(K==="circle"||K==="dashboard")&&(Ue=k.createElement(Wv,Object.assign({},u,{strokeColor:Le,prefixCls:xe,progressStatus:Se}),Fe));const We=Tt(xe,`${xe}-status-${Se}`,`${xe}-${K==="dashboard"&&"circle"||A&&"steps"||K}`,{[`${xe}-inline-circle`]:K==="circle"&&Ic(j,"circle")[0]<=20,[`${xe}-show-info`]:L,[`${xe}-${j}`]:typeof j=="string",[`${xe}-rtl`]:we==="rtl"},ge?.className,w,T,Re,Ne);return Pe(k.createElement("div",Object.assign({ref:m,style:Object.assign(Object.assign({},ge?.style),he),className:We,role:"progressbar","aria-valuenow":be},h_(ye,["trailColor","strokeWidth","width","gapDegree","gapPosition","strokeLinecap","success","successPercent"])),Ue))}),h0=u0;var d0={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z"}}]},name:"delete",theme:"outlined"};const p0=d0;var f0=function(m,b){return k.createElement(Ia,mi({},m,{ref:b,icon:p0}))};const jf=k.forwardRef(f0),Fu=function(u,m){if(u&&m){var b=Array.isArray(m)?m:m.split(","),w=u.name||"",T=u.type||"",A=T.replace(/\/.*$/,"");return b.some(function(F){var s=F.trim();if(/^\*(\/\*)?$/.test(F))return!0;if(s.charAt(0)==="."){var j=w.toLowerCase(),L=s.toLowerCase(),K=[L];return(L===".jpg"||L===".jpeg")&&(K=[".jpg",".jpeg"]),K.some(function(ne){return j.endsWith(ne)})}return/\/\*$/.test(s)?A===s.replace(/\/.*$/,""):T===s?!0:/^\w+$/.test(s)?(p_(!1,"Upload takes an invalidate 'accept' type '".concat(s,"'.Skip for check.")),!0):!1})}return!0};function m0(u,m){var b="cannot ".concat(u.method," ").concat(u.action," ").concat(m.status,"'"),w=new Error(b);return w.status=m.status,w.method=u.method,w.url=u.action,w}function Ip(u){var m=u.responseText||u.response;if(!m)return m;try{return JSON.parse(m)}catch{return m}}function g0(u){var m=new XMLHttpRequest;u.onProgress&&m.upload&&(m.upload.onprogress=function(A){A.total>0&&(A.percent=A.loaded/A.total*100),u.onProgress(A)});var b=new FormData;u.data&&Object.keys(u.data).forEach(function(T){var A=u.data[T];if(Array.isArray(A)){A.forEach(function(F){b.append("".concat(T,"[]"),F)});return}b.append(T,A)}),u.file instanceof Blob?b.append(u.filename,u.file,u.file.name):b.append(u.filename,u.file),m.onerror=function(A){u.onError(A)},m.onload=function(){return m.status<200||m.status>=300?u.onError(m0(u,m),Ip(m)):u.onSuccess(Ip(m),m)},m.open(u.method,u.action,!0),u.withCredentials&&"withCredentials"in m&&(m.withCredentials=!0);var w=u.headers||{};return w["X-Requested-With"]!==null&&m.setRequestHeader("X-Requested-With","XMLHttpRequest"),Object.keys(w).forEach(function(T){w[T]!==null&&m.setRequestHeader(T,w[T])}),m.send(b),{abort:function(){m.abort()}}}function _0(u,m){var b=u.createReader(),w=[];function T(){b.readEntries(function(A){var F=Array.prototype.slice.apply(A);w=w.concat(F);var s=!F.length;s?m(w):T()})}T()}var y0=function(m,b,w){var T=function A(F,s){F&&(F.path=s||"",F.isFile?F.file(function(j){w(j)&&(F.fullPath&&!j.webkitRelativePath&&(Object.defineProperties(j,{webkitRelativePath:{writable:!0}}),j.webkitRelativePath=F.fullPath.replace(/^\//,""),Object.defineProperties(j,{webkitRelativePath:{writable:!1}})),b([j]))}):F.isDirectory&&_0(F,function(j){j.forEach(function(L){A(L,"".concat(s).concat(F.name,"/"))})}))};m.forEach(function(A){T(A.webkitGetAsEntry())})},v0=+new Date,x0=0;function $u(){return"rc-upload-".concat(v0,"-").concat(++x0)}var b0=["component","prefixCls","className","classNames","disabled","id","style","styles","multiple","accept","capture","children","directory","openFileDialogOnClick","onMouseEnter","onMouseLeave","hasControlInside"],w0=function(u){Qp(b,u);var m=ef(b);function b(){var w;tf(this,b);for(var T=arguments.length,A=new Array(T),F=0;F<T;F++)A[F]=arguments[F];return w=m.call.apply(m,[this].concat(A)),oi(nn(w),"state",{uid:$u()}),oi(nn(w),"reqs",{}),oi(nn(w),"fileInput",void 0),oi(nn(w),"_isMounted",void 0),oi(nn(w),"onChange",function(s){var j=w.props,L=j.accept,K=j.directory,ne=s.target.files,te=qi(ne).filter(function(he){return!K||Fu(he,L)});w.uploadFiles(te),w.reset()}),oi(nn(w),"onClick",function(s){var j=w.fileInput;if(j){var L=s.target,K=w.props.onClick;if(L&&L.tagName==="BUTTON"){var ne=j.parentNode;ne.focus(),L.blur()}j.click(),K&&K(s)}}),oi(nn(w),"onKeyDown",function(s){s.key==="Enter"&&w.onClick(s)}),oi(nn(w),"onFileDrop",function(s){var j=w.props.multiple;if(s.preventDefault(),s.type!=="dragover")if(w.props.directory)y0(Array.prototype.slice.call(s.dataTransfer.items),w.uploadFiles,function(K){return Fu(K,w.props.accept)});else{var L=qi(s.dataTransfer.files).filter(function(K){return Fu(K,w.props.accept)});j===!1&&(L=L.slice(0,1)),w.uploadFiles(L)}}),oi(nn(w),"uploadFiles",function(s){var j=qi(s),L=j.map(function(K){return K.uid=$u(),w.processFile(K,j)});Promise.all(L).then(function(K){var ne=w.props.onBatchStart;ne?.(K.map(function(te){var he=te.origin,ye=te.parsedFile;return{file:he,parsedFile:ye}})),K.filter(function(te){return te.parsedFile!==null}).forEach(function(te){w.post(te)})})}),oi(nn(w),"processFile",function(){var s=f_(qd().mark(function j(L,K){var ne,te,he,ye,be,Se,ve,we,ge;return qd().wrap(function(Pe){for(;;)switch(Pe.prev=Pe.next){case 0:if(ne=w.props.beforeUpload,te=L,!ne){Pe.next=14;break}return Pe.prev=3,Pe.next=6,ne(L,K);case 6:te=Pe.sent,Pe.next=12;break;case 9:Pe.prev=9,Pe.t0=Pe.catch(3),te=!1;case 12:if(te!==!1){Pe.next=14;break}return Pe.abrupt("return",{origin:L,parsedFile:null,action:null,data:null});case 14:if(he=w.props.action,typeof he!="function"){Pe.next=21;break}return Pe.next=18,he(L);case 18:ye=Pe.sent,Pe.next=22;break;case 21:ye=he;case 22:if(be=w.props.data,typeof be!="function"){Pe.next=29;break}return Pe.next=26,be(L);case 26:Se=Pe.sent,Pe.next=30;break;case 29:Se=be;case 30:return ve=(Nn(te)==="object"||typeof te=="string")&&te?te:L,ve instanceof File?we=ve:we=new File([ve],L.name,{type:L.type}),ge=we,ge.uid=L.uid,Pe.abrupt("return",{origin:L,data:Se,parsedFile:ge,action:ye});case 35:case"end":return Pe.stop()}},j,null,[[3,9]])}));return function(j,L){return s.apply(this,arguments)}}()),oi(nn(w),"saveFileInput",function(s){w.fileInput=s}),w}return rf(b,[{key:"componentDidMount",value:function(){this._isMounted=!0}},{key:"componentWillUnmount",value:function(){this._isMounted=!1,this.abort()}},{key:"post",value:function(T){var A=this,F=T.data,s=T.origin,j=T.action,L=T.parsedFile;if(this._isMounted){var K=this.props,ne=K.onStart,te=K.customRequest,he=K.name,ye=K.headers,be=K.withCredentials,Se=K.method,ve=s.uid,we=te||g0,ge={action:j,filename:he,data:F,file:L,headers:ye,withCredentials:be,method:Se||"post",onProgress:function(Pe){var Re=A.props.onProgress;Re?.(Pe,L)},onSuccess:function(Pe,Re){var Ne=A.props.onSuccess;Ne?.(Pe,L,Re),delete A.reqs[ve]},onError:function(Pe,Re){var Ne=A.props.onError;Ne?.(Pe,Re,L),delete A.reqs[ve]}};ne(s),this.reqs[ve]=we(ge)}}},{key:"reset",value:function(){this.setState({uid:$u()})}},{key:"abort",value:function(T){var A=this.reqs;if(T){var F=T.uid?T.uid:T;A[F]&&A[F].abort&&A[F].abort(),delete A[F]}else Object.keys(A).forEach(function(s){A[s]&&A[s].abort&&A[s].abort(),delete A[s]})}},{key:"render",value:function(){var T,A=this.props,F=A.component,s=A.prefixCls,j=A.className,L=A.classNames,K=L===void 0?{}:L,ne=A.disabled,te=A.id,he=A.style,ye=A.styles,be=ye===void 0?{}:ye,Se=A.multiple,ve=A.accept,we=A.capture,ge=A.children,xe=A.directory,Pe=A.openFileDialogOnClick,Re=A.onMouseEnter,Ne=A.onMouseLeave,Fe=A.hasControlInside,Le=Ta(A,b0),Te=Tt((T={},oi(T,s,!0),oi(T,"".concat(s,"-disabled"),ne),oi(T,j,j),T)),Ue=xe?{directory:"directory",webkitdirectory:"webkitdirectory"}:{},We=ne?{}:{onClick:Pe?this.onClick:function(){},onKeyDown:Pe?this.onKeyDown:function(){},onMouseEnter:Re,onMouseLeave:Ne,onDrop:this.onFileDrop,onDragOver:this.onFileDrop,tabIndex:Fe?void 0:"0"};return ti.createElement(F,mi({},We,{className:Te,role:Fe?void 0:"button",style:he}),ti.createElement("input",mi({},Gp(Le,{aria:!0,data:!0}),{id:te,disabled:ne,type:"file",ref:this.saveFileInput,onClick:function(Xe){return Xe.stopPropagation()},key:this.state.uid,style:ri({display:"none"},be.input),className:K.input,accept:ve},Ue,{multiple:Se,onChange:this.onChange},we!=null?{capture:we}:{})),ge)}}]),b}(k.Component);function Ou(){}var Xu=function(u){Qp(b,u);var m=ef(b);function b(){var w;tf(this,b);for(var T=arguments.length,A=new Array(T),F=0;F<T;F++)A[F]=arguments[F];return w=m.call.apply(m,[this].concat(A)),oi(nn(w),"uploader",void 0),oi(nn(w),"saveUploader",function(s){w.uploader=s}),w}return rf(b,[{key:"abort",value:function(T){this.uploader.abort(T)}},{key:"render",value:function(){return ti.createElement(w0,mi({},this.props,{ref:this.saveUploader}))}}]),b}(k.Component);oi(Xu,"defaultProps",{component:"span",prefixCls:"rc-upload",data:{},headers:{},name:"file",multipart:!1,onStart:Ou,onError:Ou,onSuccess:Ou,multiple:!1,beforeUpload:null,customRequest:null,withCredentials:!1,openFileDialogOnClick:!0,hasControlInside:!1});const S0=u=>{const{componentCls:m,iconCls:b}=u;return{[`${m}-wrapper`]:{[`${m}-drag`]:{position:"relative",width:"100%",height:"100%",textAlign:"center",background:u.colorFillAlter,border:`${ct(u.lineWidth)} dashed ${u.colorBorder}`,borderRadius:u.borderRadiusLG,cursor:"pointer",transition:`border-color ${u.motionDurationSlow}`,[m]:{padding:u.padding},[`${m}-btn`]:{display:"table",width:"100%",height:"100%",outline:"none",borderRadius:u.borderRadiusLG,"&:focus-visible":{outline:`${ct(u.lineWidthFocus)} solid ${u.colorPrimaryBorder}`}},[`${m}-drag-container`]:{display:"table-cell",verticalAlign:"middle"},[`
          &:not(${m}-disabled):hover,
          &-hover:not(${m}-disabled)
        `]:{borderColor:u.colorPrimaryHover},[`p${m}-drag-icon`]:{marginBottom:u.margin,[b]:{color:u.colorPrimary,fontSize:u.uploadThumbnailSize}},[`p${m}-text`]:{margin:`0 0 ${ct(u.marginXXS)}`,color:u.colorTextHeading,fontSize:u.fontSizeLG},[`p${m}-hint`]:{color:u.colorTextDescription,fontSize:u.fontSize},[`&${m}-disabled`]:{[`p${m}-drag-icon ${b},
            p${m}-text,
            p${m}-hint
          `]:{color:u.colorTextDisabled}}}}}},C0=u=>{const{componentCls:m,antCls:b,iconCls:w,fontSize:T,lineHeight:A,calc:F}=u,s=`${m}-list-item`,j=`${s}-actions`,L=`${s}-action`,K=u.fontHeightSM;return{[`${m}-wrapper`]:{[`${m}-list`]:Object.assign(Object.assign({},Qu()),{lineHeight:u.lineHeight,[s]:{position:"relative",height:F(u.lineHeight).mul(T).equal(),marginTop:u.marginXS,fontSize:T,display:"flex",alignItems:"center",transition:`background-color ${u.motionDurationSlow}`,"&:hover":{backgroundColor:u.controlItemBgHover},[`${s}-name`]:Object.assign(Object.assign({},th),{padding:`0 ${ct(u.paddingXS)}`,lineHeight:A,flex:"auto",transition:`all ${u.motionDurationSlow}`}),[j]:{[L]:{opacity:0},[w]:{color:u.actionsColor,transition:`all ${u.motionDurationSlow}`},[`
              ${L}:focus-visible,
              &.picture ${L}
            `]:{opacity:1},[`${L}${b}-btn`]:{height:K,border:0,lineHeight:1}},[`${m}-icon ${w}`]:{color:u.colorTextDescription,fontSize:T},[`${s}-progress`]:{position:"absolute",bottom:u.calc(u.uploadProgressOffset).mul(-1).equal(),width:"100%",paddingInlineStart:F(T).add(u.paddingXS).equal(),fontSize:T,lineHeight:0,pointerEvents:"none","> div":{margin:0}}},[`${s}:hover ${L}`]:{opacity:1},[`${s}-error`]:{color:u.colorError,[`${s}-name, ${m}-icon ${w}`]:{color:u.colorError},[j]:{[`${w}, ${w}:hover`]:{color:u.colorError},[L]:{opacity:1}}},[`${m}-list-item-container`]:{transition:`opacity ${u.motionDurationSlow}, height ${u.motionDurationSlow}`,"&::before":{display:"table",width:0,height:0,content:'""'}}})}}},Ep=new Ka("uploadAnimateInlineIn",{from:{width:0,height:0,margin:0,padding:0,opacity:0}}),Pp=new Ka("uploadAnimateInlineOut",{to:{width:0,height:0,margin:0,padding:0,opacity:0}}),T0=u=>{const{componentCls:m}=u,b=`${m}-animate-inline`;return[{[`${m}-wrapper`]:{[`${b}-appear, ${b}-enter, ${b}-leave`]:{animationDuration:u.motionDurationSlow,animationTimingFunction:u.motionEaseInOutCirc,animationFillMode:"forwards"},[`${b}-appear, ${b}-enter`]:{animationName:Ep},[`${b}-leave`]:{animationName:Pp}}},{[`${m}-wrapper`]:vf(u)},Ep,Pp]},I0=u=>{const{componentCls:m,iconCls:b,uploadThumbnailSize:w,uploadProgressOffset:T,calc:A}=u,F=`${m}-list`,s=`${F}-item`;return{[`${m}-wrapper`]:{[`
        ${F}${F}-picture,
        ${F}${F}-picture-card,
        ${F}${F}-picture-circle
      `]:{[s]:{position:"relative",height:A(w).add(A(u.lineWidth).mul(2)).add(A(u.paddingXS).mul(2)).equal(),padding:u.paddingXS,border:`${ct(u.lineWidth)} ${u.lineType} ${u.colorBorder}`,borderRadius:u.borderRadiusLG,"&:hover":{background:"transparent"},[`${s}-thumbnail`]:Object.assign(Object.assign({},th),{width:w,height:w,lineHeight:ct(A(w).add(u.paddingSM).equal()),textAlign:"center",flex:"none",[b]:{fontSize:u.fontSizeHeading2,color:u.colorPrimary},img:{display:"block",width:"100%",height:"100%",overflow:"hidden"}}),[`${s}-progress`]:{bottom:T,width:`calc(100% - ${ct(A(u.paddingSM).mul(2).equal())})`,marginTop:0,paddingInlineStart:A(w).add(u.paddingXS).equal()}},[`${s}-error`]:{borderColor:u.colorError,[`${s}-thumbnail ${b}`]:{[`svg path[fill='${Gd[0]}']`]:{fill:u.colorErrorBg},[`svg path[fill='${Gd.primary}']`]:{fill:u.colorError}}},[`${s}-uploading`]:{borderStyle:"dashed",[`${s}-name`]:{marginBottom:T}}},[`${F}${F}-picture-circle ${s}`]:{[`&, &::before, ${s}-thumbnail`]:{borderRadius:"50%"}}}}},E0=u=>{const{componentCls:m,iconCls:b,fontSizeLG:w,colorTextLightSolid:T,calc:A}=u,F=`${m}-list`,s=`${F}-item`,j=u.uploadPicCardSize;return{[`
      ${m}-wrapper${m}-picture-card-wrapper,
      ${m}-wrapper${m}-picture-circle-wrapper
    `]:Object.assign(Object.assign({},Qu()),{display:"inline-block",width:"100%",[`${m}${m}-select`]:{width:j,height:j,marginInlineEnd:u.marginXS,marginBottom:u.marginXS,textAlign:"center",verticalAlign:"top",backgroundColor:u.colorFillAlter,border:`${ct(u.lineWidth)} dashed ${u.colorBorder}`,borderRadius:u.borderRadiusLG,cursor:"pointer",transition:`border-color ${u.motionDurationSlow}`,[`> ${m}`]:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",textAlign:"center"},[`&:not(${m}-disabled):hover`]:{borderColor:u.colorPrimary}},[`${F}${F}-picture-card, ${F}${F}-picture-circle`]:{[`${F}-item-container`]:{display:"inline-block",width:j,height:j,marginBlock:`0 ${ct(u.marginXS)}`,marginInline:`0 ${ct(u.marginXS)}`,verticalAlign:"top"},"&::after":{display:"none"},[s]:{height:"100%",margin:0,"&::before":{position:"absolute",zIndex:1,width:`calc(100% - ${ct(A(u.paddingXS).mul(2).equal())})`,height:`calc(100% - ${ct(A(u.paddingXS).mul(2).equal())})`,backgroundColor:u.colorBgMask,opacity:0,transition:`all ${u.motionDurationSlow}`,content:'" "'}},[`${s}:hover`]:{[`&::before, ${s}-actions`]:{opacity:1}},[`${s}-actions`]:{position:"absolute",insetInlineStart:0,zIndex:10,width:"100%",whiteSpace:"nowrap",textAlign:"center",opacity:0,transition:`all ${u.motionDurationSlow}`,[`
            ${b}-eye,
            ${b}-download,
            ${b}-delete
          `]:{zIndex:10,width:w,margin:`0 ${ct(u.marginXXS)}`,fontSize:w,cursor:"pointer",transition:`all ${u.motionDurationSlow}`,color:T,"&:hover":{color:T},svg:{verticalAlign:"baseline"}}},[`${s}-thumbnail, ${s}-thumbnail img`]:{position:"static",display:"block",width:"100%",height:"100%",objectFit:"contain"},[`${s}-name`]:{display:"none",textAlign:"center"},[`${s}-file + ${s}-name`]:{position:"absolute",bottom:u.margin,display:"block",width:`calc(100% - ${ct(A(u.paddingXS).mul(2).equal())})`},[`${s}-uploading`]:{[`&${s}`]:{backgroundColor:u.colorFillAlter},[`&::before, ${b}-eye, ${b}-download, ${b}-delete`]:{display:"none"}},[`${s}-progress`]:{bottom:u.marginXL,width:`calc(100% - ${ct(A(u.paddingXS).mul(2).equal())})`,paddingInlineStart:0}}}),[`${m}-wrapper${m}-picture-circle-wrapper`]:{[`${m}${m}-select`]:{borderRadius:"50%"}}}},P0=u=>{const{componentCls:m}=u;return{[`${m}-rtl`]:{direction:"rtl"}}},M0=u=>{const{componentCls:m,colorTextDisabled:b}=u;return{[`${m}-wrapper`]:Object.assign(Object.assign({},js(u)),{[m]:{outline:0,"input[type='file']":{cursor:"pointer"}},[`${m}-select`]:{display:"inline-block"},[`${m}-disabled`]:{color:b,cursor:"not-allowed"}})}},A0=u=>({actionsColor:u.colorTextDescription}),k0=tl("Upload",u=>{const{fontSizeHeading3:m,fontHeight:b,lineWidth:w,controlHeightLG:T,calc:A}=u,F=il(u,{uploadThumbnailSize:A(m).mul(2).equal(),uploadProgressOffset:A(A(b).div(2)).add(w).equal(),uploadPicCardSize:A(T).mul(2.55).equal()});return[M0(F),S0(F),I0(F),E0(F),C0(F),T0(F),P0(F),m_(F)]},A0);var z0={icon:function(m,b){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M534 352V136H232v752h560V394H576a42 42 0 01-42-42z",fill:b}},{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM602 137.8L790.2 326H602V137.8zM792 888H232V136h302v216a42 42 0 0042 42h216v494z",fill:m}}]}},name:"file",theme:"twotone"};const D0=z0;var L0=function(m,b){return k.createElement(Ia,mi({},m,{ref:b,icon:D0}))};const R0=k.forwardRef(L0);var B0={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M779.3 196.6c-94.2-94.2-247.6-94.2-341.7 0l-261 260.8c-1.7 1.7-2.6 4-2.6 6.4s.9 4.7 2.6 6.4l36.9 36.9a9 9 0 0012.7 0l261-260.8c32.4-32.4 75.5-50.2 121.3-50.2s88.9 17.8 121.2 50.2c32.4 32.4 50.2 75.5 50.2 121.2 0 45.8-17.8 88.8-50.2 121.2l-266 265.9-43.1 43.1c-40.3 40.3-105.8 40.3-146.1 0-19.5-19.5-30.2-45.4-30.2-73s10.7-53.5 30.2-73l263.9-263.8c6.7-6.6 15.5-10.3 24.9-10.3h.1c9.4 0 18.1 3.7 24.7 10.3 6.7 6.7 10.3 15.5 10.3 24.9 0 9.3-3.7 18.1-10.3 24.7L372.4 653c-1.7 1.7-2.6 4-2.6 6.4s.9 4.7 2.6 6.4l36.9 36.9a9 9 0 0012.7 0l215.6-215.6c19.9-19.9 30.8-46.3 30.8-74.4s-11-54.6-30.8-74.4c-41.1-41.1-107.9-41-149 0L463 364 224.8 602.1A172.22 172.22 0 00174 724.8c0 46.3 18.1 89.8 50.8 122.5 33.9 33.8 78.3 50.7 122.7 50.7 44.4 0 88.8-16.9 122.6-50.7l309.2-309C824.8 492.7 850 432 850 367.5c.1-64.6-25.1-125.3-70.7-170.9z"}}]},name:"paper-clip",theme:"outlined"};const F0=B0;var $0=function(m,b){return k.createElement(Ia,mi({},m,{ref:b,icon:F0}))};const O0=k.forwardRef($0);var N0={icon:function(m,b){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 632H136v-39.9l138.5-164.3 150.1 178L658.1 489 888 761.6V792zm0-129.8L664.2 396.8c-3.2-3.8-9-3.8-12.2 0L424.6 666.4l-144-170.7c-3.2-3.8-9-3.8-12.2 0L136 652.7V232h752v430.2z",fill:m}},{tag:"path",attrs:{d:"M424.6 765.8l-150.1-178L136 752.1V792h752v-30.4L658.1 489z",fill:b}},{tag:"path",attrs:{d:"M136 652.7l132.4-157c3.2-3.8 9-3.8 12.2 0l144 170.7L652 396.8c3.2-3.8 9-3.8 12.2 0L888 662.2V232H136v420.7zM304 280a88 88 0 110 176 88 88 0 010-176z",fill:b}},{tag:"path",attrs:{d:"M276 368a28 28 0 1056 0 28 28 0 10-56 0z",fill:b}},{tag:"path",attrs:{d:"M304 456a88 88 0 100-176 88 88 0 000 176zm0-116c15.5 0 28 12.5 28 28s-12.5 28-28 28-28-12.5-28-28 12.5-28 28-28z",fill:m}}]}},name:"picture",theme:"twotone"};const j0=N0;var V0=function(m,b){return k.createElement(Ia,mi({},m,{ref:b,icon:j0}))};const U0=k.forwardRef(V0);function gc(u){return Object.assign(Object.assign({},u),{lastModified:u.lastModified,lastModifiedDate:u.lastModifiedDate,name:u.name,size:u.size,type:u.type,uid:u.uid,percent:0,originFileObj:u})}function _c(u,m){const b=qi(m),w=b.findIndex(T=>{let{uid:A}=T;return A===u.uid});return w===-1?b.push(u):b[w]=u,b}function Nu(u,m){const b=u.uid!==void 0?"uid":"name";return m.filter(w=>w[b]===u[b])[0]}function q0(u,m){const b=u.uid!==void 0?"uid":"name",w=m.filter(T=>T[b]!==u[b]);return w.length===m.length?null:w}const G0=function(){const m=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:"").split("/"),w=m[m.length-1].split(/#|\?/)[0];return(/\.[^./\\]*$/.exec(w)||[""])[0]},Vf=u=>u.indexOf("image/")===0,Z0=u=>{if(u.type&&!u.thumbUrl)return Vf(u.type);const m=u.thumbUrl||u.url||"",b=G0(m);return/^data:image\//.test(m)||/(webp|svg|png|gif|jpg|jpeg|jfif|bmp|dpg|ico|heic|heif)$/i.test(b)?!0:!(/^data:/.test(m)||b)},Sa=200;function H0(u){return new Promise(m=>{if(!u.type||!Vf(u.type)){m("");return}const b=document.createElement("canvas");b.width=Sa,b.height=Sa,b.style.cssText=`position: fixed; left: 0; top: 0; width: ${Sa}px; height: ${Sa}px; z-index: 9999; display: none;`,document.body.appendChild(b);const w=b.getContext("2d"),T=new Image;if(T.onload=()=>{const{width:A,height:F}=T;let s=Sa,j=Sa,L=0,K=0;A>F?(j=F*(Sa/A),K=-(j-s)/2):(s=A*(Sa/F),L=-(s-j)/2),w.drawImage(T,L,K,s,j);const ne=b.toDataURL();document.body.removeChild(b),window.URL.revokeObjectURL(T.src),m(ne)},T.crossOrigin="anonymous",u.type.startsWith("image/svg+xml")){const A=new FileReader;A.onload=()=>{A.result&&(T.src=A.result)},A.readAsDataURL(u)}else if(u.type.startsWith("image/gif")){const A=new FileReader;A.onload=()=>{A.result&&m(A.result)},A.readAsDataURL(u)}else T.src=window.URL.createObjectURL(u)})}var W0={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M505.7 661a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9h-74.1V168c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v338.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.8zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"download",theme:"outlined"};const X0=W0;var K0=function(m,b){return k.createElement(Ia,mi({},m,{ref:b,icon:X0}))};const Y0=k.forwardRef(K0),J0=k.forwardRef((u,m)=>{let{prefixCls:b,className:w,style:T,locale:A,listType:F,file:s,items:j,progress:L,iconRender:K,actionIconRender:ne,itemRender:te,isImgUrl:he,showPreviewIcon:ye,showRemoveIcon:be,showDownloadIcon:Se,previewIcon:ve,removeIcon:we,downloadIcon:ge,onPreview:xe,onDownload:Pe,onClose:Re}=u;var Ne,Fe;const{status:Le}=s,[Te,Ue]=k.useState(Le);k.useEffect(()=>{Le!=="removed"&&Ue(Le)},[Le]);const[We,tt]=k.useState(!1);k.useEffect(()=>{const kt=setTimeout(()=>{tt(!0)},300);return()=>{clearTimeout(kt)}},[]);const Xe=K(s);let at=k.createElement("div",{className:`${b}-icon`},Xe);if(F==="picture"||F==="picture-card"||F==="picture-circle")if(Te==="uploading"||!s.thumbUrl&&!s.url){const kt=Tt(`${b}-list-item-thumbnail`,{[`${b}-list-item-file`]:Te!=="uploading"});at=k.createElement("div",{className:kt},Xe)}else{const kt=he?.(s)?k.createElement("img",{src:s.thumbUrl||s.url,alt:s.name,className:`${b}-list-item-image`,crossOrigin:s.crossOrigin}):Xe,gi=Tt(`${b}-list-item-thumbnail`,{[`${b}-list-item-file`]:he&&!he(s)});at=k.createElement("a",{className:gi,onClick:pi=>xe(s,pi),href:s.url||s.thumbUrl,target:"_blank",rel:"noopener noreferrer"},kt)}const Ct=Tt(`${b}-list-item`,`${b}-list-item-${Te}`),st=typeof s.linkProps=="string"?JSON.parse(s.linkProps):s.linkProps,jt=be?ne((typeof we=="function"?we(s):we)||k.createElement(jf,null),()=>Re(s),b,A.removeFile,!0):null,At=Se&&Te==="done"?ne((typeof ge=="function"?ge(s):ge)||k.createElement(Y0,null),()=>Pe(s),b,A.downloadFile):null,Qt=F!=="picture-card"&&F!=="picture-circle"&&k.createElement("span",{key:"download-delete",className:Tt(`${b}-list-item-actions`,{picture:F==="picture"})},At,jt),Gt=Tt(`${b}-list-item-name`),ft=s.url?[k.createElement("a",Object.assign({key:"view",target:"_blank",rel:"noopener noreferrer",className:Gt,title:s.name},st,{href:s.url,onClick:kt=>xe(s,kt)}),s.name),Qt]:[k.createElement("span",{key:"view",className:Gt,onClick:kt=>xe(s,kt),title:s.name},s.name),Qt],Be=ye&&(s.url||s.thumbUrl)?k.createElement("a",{href:s.url||s.thumbUrl,target:"_blank",rel:"noopener noreferrer",onClick:kt=>xe(s,kt),title:A.previewFile},typeof ve=="function"?ve(s):ve||k.createElement(g_,null)):null,gt=(F==="picture-card"||F==="picture-circle")&&Te!=="uploading"&&k.createElement("span",{className:`${b}-list-item-actions`},Be,Te==="done"&&At,jt),{getPrefixCls:$t}=k.useContext(jn),bt=$t(),Bt=k.createElement("div",{className:Ct},at,ft,gt,We&&k.createElement(nl,{motionName:`${bt}-fade`,visible:Te==="uploading",motionDeadline:2e3},kt=>{let{className:gi}=kt;const pi="percent"in s?k.createElement(h0,Object.assign({},L,{type:"line",percent:s.percent,"aria-label":s["aria-label"],"aria-labelledby":s["aria-labelledby"]})):null;return k.createElement("div",{className:Tt(`${b}-list-item-progress`,gi)},pi)})),Yt=s.response&&typeof s.response=="string"?s.response:((Ne=s.error)===null||Ne===void 0?void 0:Ne.statusText)||((Fe=s.error)===null||Fe===void 0?void 0:Fe.message)||A.uploadError,ei=Te==="error"?k.createElement(Jp,{title:Yt,getPopupContainer:kt=>kt.parentNode},Bt):Bt;return k.createElement("div",{className:Tt(`${b}-list-item-container`,w),style:T,ref:m},te?te(ei,s,j,{download:Pe.bind(null,s),preview:xe.bind(null,s),remove:Re.bind(null,s)}):ei)}),Q0=J0,ex=(u,m)=>{const{listType:b="text",previewFile:w=H0,onPreview:T,onDownload:A,onRemove:F,locale:s,iconRender:j,isImageUrl:L=Z0,prefixCls:K,items:ne=[],showPreviewIcon:te=!0,showRemoveIcon:he=!0,showDownloadIcon:ye=!1,removeIcon:be,previewIcon:Se,downloadIcon:ve,progress:we={size:[-1,2],showInfo:!1},appendAction:ge,appendActionVisible:xe=!0,itemRender:Pe,disabled:Re}=u,Ne=__(),[Fe,Le]=k.useState(!1);k.useEffect(()=>{b!=="picture"&&b!=="picture-card"&&b!=="picture-circle"||(ne||[]).forEach(Be=>{typeof document>"u"||typeof window>"u"||!window.FileReader||!window.File||!(Be.originFileObj instanceof File||Be.originFileObj instanceof Blob)||Be.thumbUrl!==void 0||(Be.thumbUrl="",w&&w(Be.originFileObj).then(gt=>{Be.thumbUrl=gt||"",Ne()}))})},[b,ne,w]),k.useEffect(()=>{Le(!0)},[]);const Te=(Be,gt)=>{if(T)return gt?.preventDefault(),T(Be)},Ue=Be=>{typeof A=="function"?A(Be):Be.url&&window.open(Be.url)},We=Be=>{F?.(Be)},tt=Be=>{if(j)return j(Be,b);const gt=Be.status==="uploading",$t=L&&L(Be)?k.createElement(U0,null):k.createElement(R0,null);let bt=gt?k.createElement(Uu,null):k.createElement(O0,null);return b==="picture"?bt=gt?k.createElement(Uu,null):$t:(b==="picture-card"||b==="picture-circle")&&(bt=gt?s.uploading:$t),bt},Xe=(Be,gt,$t,bt,Bt)=>{const Yt={type:"text",size:"small",title:bt,onClick:ei=>{gt(),Hd(Be)&&Be.props.onClick&&Be.props.onClick(ei)},className:`${$t}-list-item-action`};if(Bt&&(Yt.disabled=Re),Hd(Be)){const ei=Zd(Be,Object.assign(Object.assign({},Be.props),{onClick:()=>{}}));return k.createElement(na,Object.assign({},Yt,{icon:ei}))}return k.createElement(na,Object.assign({},Yt),k.createElement("span",null,Be))};k.useImperativeHandle(m,()=>({handlePreview:Te,handleDownload:Ue}));const{getPrefixCls:at}=k.useContext(jn),Ct=at("upload",K),st=at(),jt=Tt(`${Ct}-list`,`${Ct}-list-${b}`),At=qi(ne.map(Be=>({key:Be.uid,file:Be})));let Gt={motionDeadline:2e3,motionName:`${Ct}-${b==="picture-card"||b==="picture-circle"?"animate-inline":"animate"}`,keys:At,motionAppear:Fe};const ft=k.useMemo(()=>{const Be=Object.assign({},y_(st));return delete Be.onAppearEnd,delete Be.onEnterEnd,delete Be.onLeaveEnd,Be},[st]);return b!=="picture-card"&&b!=="picture-circle"&&(Gt=Object.assign(Object.assign({},ft),Gt)),k.createElement("div",{className:jt},k.createElement(Np,Object.assign({},Gt,{component:!1}),Be=>{let{key:gt,file:$t,className:bt,style:Bt}=Be;return k.createElement(Q0,{key:gt,locale:s,prefixCls:Ct,className:bt,style:Bt,file:$t,items:ne,progress:we,listType:b,isImgUrl:L,showPreviewIcon:te,showRemoveIcon:he,showDownloadIcon:ye,removeIcon:be,previewIcon:Se,downloadIcon:ve,iconRender:tt,actionIconRender:Xe,itemRender:Pe,onPreview:Te,onDownload:Ue,onClose:We})}),ge&&k.createElement(nl,Object.assign({},Gt,{visible:xe,forceRender:!0}),Be=>{let{className:gt,style:$t}=Be;return Zd(ge,bt=>({className:Tt(bt.className,gt),style:Object.assign(Object.assign(Object.assign({},$t),{pointerEvents:gt?"none":void 0}),bt.style)}))}))},tx=k.forwardRef(ex),ix=tx;var rx=function(u,m,b,w){function T(A){return A instanceof b?A:new b(function(F){F(A)})}return new(b||(b=Promise))(function(A,F){function s(K){try{L(w.next(K))}catch(ne){F(ne)}}function j(K){try{L(w.throw(K))}catch(ne){F(ne)}}function L(K){K.done?A(K.value):T(K.value).then(s,j)}L((w=w.apply(u,m||[])).next())})};const Yo=`__LIST_IGNORE_${Date.now()}__`,nx=(u,m)=>{const{fileList:b,defaultFileList:w,onRemove:T,showUploadList:A=!0,listType:F="text",onPreview:s,onDownload:j,onChange:L,onDrop:K,previewFile:ne,disabled:te,locale:he,iconRender:ye,isImageUrl:be,progress:Se,prefixCls:ve,className:we,type:ge="select",children:xe,style:Pe,itemRender:Re,maxCount:Ne,data:Fe={},multiple:Le=!1,hasControlInside:Te=!0,action:Ue="",accept:We="",supportServerRender:tt=!0,rootClassName:Xe}=u,at=k.useContext(v_),Ct=te??at,[st,jt]=qu(w||[],{value:b,postState:It=>It??[]}),[At,Qt]=k.useState("drop"),Gt=k.useRef(null);k.useMemo(()=>{const It=Date.now();(b||[]).forEach((wt,Jt)=>{!wt.uid&&!Object.isFrozen(wt)&&(wt.uid=`__AUTO__${It}_${Jt}__`)})},[b]);const ft=(It,wt,Jt)=>{let zt=qi(wt),ze=!1;Ne===1?zt=zt.slice(-1):Ne&&(ze=zt.length>Ne,zt=zt.slice(0,Ne)),Jo.flushSync(()=>{jt(zt)});const mt={file:It,fileList:zt};Jt&&(mt.event=Jt),(!ze||zt.some(yt=>yt.uid===It.uid))&&Jo.flushSync(()=>{L?.(mt)})},Be=(It,wt)=>rx(void 0,void 0,void 0,function*(){const{beforeUpload:Jt,transformFile:zt}=u;let ze=It;if(Jt){const mt=yield Jt(It,wt);if(mt===!1)return!1;if(delete It[Yo],mt===Yo)return Object.defineProperty(It,Yo,{value:!0,configurable:!0}),!1;typeof mt=="object"&&mt&&(ze=mt)}return zt&&(ze=yield zt(ze)),ze}),gt=It=>{const wt=It.filter(ze=>!ze.file[Yo]);if(!wt.length)return;const Jt=wt.map(ze=>gc(ze.file));let zt=qi(st);Jt.forEach(ze=>{zt=_c(ze,zt)}),Jt.forEach((ze,mt)=>{let yt=ze;if(wt[mt].parsedFile)ze.status="uploading";else{const{originFileObj:wi}=ze;let Zi;try{Zi=new File([wi],wi.name,{type:wi.type})}catch{Zi=new Blob([wi],{type:wi.type}),Zi.name=wi.name,Zi.lastModifiedDate=new Date,Zi.lastModified=new Date().getTime()}Zi.uid=ze.uid,yt=Zi}ft(yt,zt)})},$t=(It,wt,Jt)=>{try{typeof It=="string"&&(It=JSON.parse(It))}catch{}if(!Nu(wt,st))return;const zt=gc(wt);zt.status="done",zt.percent=100,zt.response=It,zt.xhr=Jt;const ze=_c(zt,st);ft(zt,ze)},bt=(It,wt)=>{if(!Nu(wt,st))return;const Jt=gc(wt);Jt.status="uploading",Jt.percent=It.percent;const zt=_c(Jt,st);ft(Jt,zt,It)},Bt=(It,wt,Jt)=>{if(!Nu(Jt,st))return;const zt=gc(Jt);zt.error=It,zt.response=wt,zt.status="error";const ze=_c(zt,st);ft(zt,ze)},Yt=It=>{let wt;Promise.resolve(typeof T=="function"?T(It):T).then(Jt=>{var zt;if(Jt===!1)return;const ze=q0(It,st);ze&&(wt=Object.assign(Object.assign({},It),{status:"removed"}),st?.forEach(mt=>{const yt=wt.uid!==void 0?"uid":"name";mt[yt]===wt[yt]&&!Object.isFrozen(mt)&&(mt.status="removed")}),(zt=Gt.current)===null||zt===void 0||zt.abort(wt),ft(wt,ze))})},ei=It=>{Qt(It.type),It.type==="drop"&&K?.(It)};k.useImperativeHandle(m,()=>({onBatchStart:gt,onSuccess:$t,onProgress:bt,onError:Bt,fileList:st,upload:Gt.current}));const{getPrefixCls:kt,direction:gi,upload:pi}=k.useContext(jn),Pt=kt("upload",ve),li=Object.assign(Object.assign({onBatchStart:gt,onError:Bt,onProgress:bt,onSuccess:$t},u),{data:Fe,multiple:Le,action:Ue,accept:We,supportServerRender:tt,prefixCls:Pt,disabled:Ct,beforeUpload:Be,onChange:void 0,hasControlInside:Te});delete li.className,delete li.style,(!xe||Ct)&&delete li.id;const Xi=`${Pt}-wrapper`,[Ht,Mi,Oi]=k0(Pt,Xi),[gr]=Sc("Upload",Yp.Upload),{showRemoveIcon:_e,showPreviewIcon:bi,showDownloadIcon:Di,removeIcon:Wt,previewIcon:Ot,downloadIcon:Gi}=typeof A=="boolean"?{}:A,Ki=typeof _e>"u"?!Ct:!!_e,_i=(It,wt)=>A?k.createElement(ix,{prefixCls:Pt,listType:F,items:st,previewFile:ne,onPreview:s,onDownload:j,onRemove:Yt,showRemoveIcon:Ki,showPreviewIcon:bi,showDownloadIcon:Di,removeIcon:Wt,previewIcon:Ot,downloadIcon:Gi,iconRender:ye,locale:Object.assign(Object.assign({},gr),he),isImageUrl:be,progress:Se,appendAction:It,appendActionVisible:wt,itemRender:Re,disabled:Ct}):It,sn=Tt(Xi,we,Xe,Mi,Oi,pi?.className,{[`${Pt}-rtl`]:gi==="rtl",[`${Pt}-picture-card-wrapper`]:F==="picture-card",[`${Pt}-picture-circle-wrapper`]:F==="picture-circle"}),sr=Object.assign(Object.assign({},pi?.style),Pe);if(ge==="drag"){const It=Tt(Mi,Pt,`${Pt}-drag`,{[`${Pt}-drag-uploading`]:st.some(wt=>wt.status==="uploading"),[`${Pt}-drag-hover`]:At==="dragover",[`${Pt}-disabled`]:Ct,[`${Pt}-rtl`]:gi==="rtl"});return Ht(k.createElement("span",{className:sn},k.createElement("div",{className:It,style:sr,onDrop:ei,onDragOver:ei,onDragLeave:ei},k.createElement(Xu,Object.assign({},li,{ref:Gt,className:`${Pt}-btn`}),k.createElement("div",{className:`${Pt}-drag-container`},xe))),_i()))}const ar=Tt(Pt,`${Pt}-select`,{[`${Pt}-disabled`]:Ct}),je=(It=>k.createElement("div",{className:ar,style:It},k.createElement(Xu,Object.assign({},li,{ref:Gt}))))(xe?void 0:{display:"none"});return Ht(F==="picture-card"||F==="picture-circle"?k.createElement("span",{className:sn},_i(je,!!xe)):k.createElement("span",{className:sn},je,_i()))},ax=k.forwardRef(nx),Uf=ax;var sx=function(u,m){var b={};for(var w in u)Object.prototype.hasOwnProperty.call(u,w)&&m.indexOf(w)<0&&(b[w]=u[w]);if(u!=null&&typeof Object.getOwnPropertySymbols=="function")for(var T=0,w=Object.getOwnPropertySymbols(u);T<w.length;T++)m.indexOf(w[T])<0&&Object.prototype.propertyIsEnumerable.call(u,w[T])&&(b[w[T]]=u[w[T]]);return b};const ox=k.forwardRef((u,m)=>{var{style:b,height:w,hasControlInside:T=!1}=u,A=sx(u,["style","height","hasControlInside"]);return k.createElement(Uf,Object.assign({ref:m,hasControlInside:T},A,{type:"drag",style:Object.assign(Object.assign({},b),{height:w})}))}),lx=ox,nh=Uf;nh.Dragger=lx;nh.LIST_IGNORE=Yo;const cx=nh;var ux={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M885.2 446.3l-.2-.8-112.2-285.1c-5-16.1-19.9-27.2-36.8-27.2H281.2c-17 0-32.1 11.3-36.9 27.6L139.4 443l-.3.7-.2.8c-1.3 4.9-1.7 9.9-1 14.8-.1 1.6-.2 3.2-.2 4.8V830a60.9 60.9 0 0060.8 60.8h627.2c33.5 0 60.8-27.3 60.9-60.8V464.1c0-1.3 0-2.6-.1-3.7.4-4.9 0-9.6-1.3-14.1zm-295.8-43l-.3 15.7c-.8 44.9-31.8 75.1-77.1 75.1-22.1 0-41.1-7.1-54.8-20.6S436 441.2 435.6 419l-.3-15.7H229.5L309 210h399.2l81.7 193.3H589.4zm-375 76.8h157.3c24.3 57.1 76 90.8 140.4 90.8 33.7 0 65-9.4 90.3-27.2 22.2-15.6 39.5-37.4 50.7-63.6h156.5V814H214.4V480.1z"}}]},name:"inbox",theme:"outlined"};const hx=ux;var dx=function(m,b){return k.createElement(Ia,mi({},m,{ref:b,icon:hx}))};const px=k.forwardRef(dx);function ju({children:u,className:m}){return Ee.jsx(Os,{gutter:38,className:"mt-3 first:mt-0 "+m,children:u})}const fx=[{label:"Hoáº¡t Ä‘á»™ng",value:"Active"},{label:"KhÃ³a",value:"Lock"}],mx=[{label:"ThÃªm khÃ¡ch hÃ ng",value:"add"},{label:"Chá»n khÃ¡ch hÃ ng",value:"Choose"},{label:"Import khÃ¡ch hÃ ng",value:"Import"}],ah=[{title:"MÃ£ khÃ¡ch hÃ ng",dataIndex:"customer_id",key:"customerid"},{title:"TÃªn khÃ¡ch hÃ ng",dataIndex:"customer_name",key:"customername"}],qf=[{title:"Äá»‹a chá»‰",dataIndex:"display_address",key:"display_address"},{title:"Sá»‘ Ä‘iá»‡n thoáº¡i",dataIndex:"phone_number",key:"phone_number"}],sh=[{customer_id:"431456",customer_name:"Chu VÄƒn A",display_address:"CT1 Chung cÆ° bá»™ cÃ´ng an",phone_number:"0123456789",frequency:"1;2;3;4;5"},{customer_id:"4314s56",customer_name:"Chu VÄƒn A",display_address:"CT1 Chung cÆ° bá»™ cÃ´ng an",phone_number:"0123456789",frequency:""}],gx=[{label:"1",value:"1"},{label:"2",value:"2"},{label:"3",value:"3"},{label:"4",value:"4"},{label:"5",value:"5"}],_x={customer_type:"Loáº¡i khÃ¡ch hÃ ng",customer_group:"NhÃ³m khÃ¡ch hÃ ng",city:"Tá»‰nh/ThÃ nh phá»‘",district:"Quáº­n/huyá»‡n",ward:"PhÆ°á»ng/xÃ£"};function yx(){return Ee.jsxs("div",{className:"p-4 pt-[43px] pb-[58px]",children:[Ee.jsxs(ju,{children:[Ee.jsx(Vr,{span:12,children:Ee.jsx(Jr,{label:"MÃ£ tuyáº¿n",name:"channel_code",children:Ee.jsx(vc,{})})}),Ee.jsx(Vr,{span:12,children:Ee.jsx(Jr,{label:"TÃªn tuyáº¿n",name:"channel_name",children:Ee.jsx(vc,{})})})]}),Ee.jsxs(ju,{children:[Ee.jsx(Vr,{span:12,children:Ee.jsx(Jr,{label:"Team sale",name:"team_sale",children:Ee.jsx($n,{showSearch:!0})})}),Ee.jsx(Vr,{span:12,children:Ee.jsx(Jr,{label:"NhÃ¢n viÃªn",name:"employee",children:Ee.jsx($n,{showSearch:!0})})})]}),Ee.jsxs(ju,{children:[Ee.jsx(Vr,{span:12,children:Ee.jsx(Jr,{label:"NgÃ y Ä‘i tuyáº¿n",name:"travel_date",children:Ee.jsx(I_,{})})}),Ee.jsx(Vr,{span:12,children:Ee.jsx(Jr,{label:"Tráº¡ng thÃ¡i",name:"status",children:Ee.jsx($n,{options:fx,defaultValue:"Active"})})})]})]})}const vx=({size:u=20})=>Ee.jsx("svg",{width:u,height:u,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:Ee.jsx("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M11.0267 1.13334C11.5534 0.501676 12.5792 0.933342 12.4959 1.75168L11.9076 7.50001H16.6667C16.8251 7.50007 16.9801 7.54524 17.1137 7.63024C17.2473 7.71523 17.3539 7.83653 17.4211 7.97993C17.4882 8.12333 17.5132 8.2829 17.4929 8.43994C17.4726 8.59698 17.4081 8.74501 17.3067 8.86668L8.97339 18.8667C8.44672 19.4983 7.42089 19.0667 7.50422 18.2483L8.09255 12.5H3.33339C3.17504 12.4999 3.01999 12.4548 2.88639 12.3698C2.75279 12.2848 2.64617 12.1635 2.57902 12.0201C2.51187 11.8767 2.48696 11.7171 2.50721 11.5601C2.52747 11.403 2.59205 11.255 2.69339 11.1333L11.0267 1.13334Z",fill:"currentColor"})}),xx=({size:u=20})=>Ee.jsxs("svg",{width:u,height:u,viewBox:"0 0 28 28",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[Ee.jsx("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M9.83847 8.58794C10.1411 8.46187 10.4827 8.4689 10.7798 8.60732L15.0763 10.6088C15.6604 10.8809 15.9133 11.5749 15.6412 12.159C15.3691 12.7431 14.6751 12.996 14.091 12.7239L11.4888 11.5117L11.653 20.2421L15.7503 22.1045V15.7497C15.7503 15.1053 16.2727 14.583 16.917 14.583C17.5613 14.583 18.0837 15.1053 18.0837 15.7497V22.1663L22.7503 20.2219V13.4163C22.7503 12.772 23.2727 12.2497 23.917 12.2497C24.5613 12.2497 25.0837 12.772 25.0837 13.4163V20.9997C25.0837 21.4707 24.8005 21.8955 24.3657 22.0766L17.3657 24.9933C17.0666 25.1179 16.7292 25.1125 16.4342 24.9784L10.5003 22.2812L4.56643 24.9784C4.20532 25.1426 3.78555 25.112 3.45204 24.8972C3.11854 24.6825 2.91699 24.313 2.91699 23.9163V12.2497C2.91699 11.7787 3.20019 11.3539 3.63494 11.1728L9.83847 8.58794ZM9.31945 20.2549L9.15297 11.4013L5.25033 13.0275V22.1045L9.31945 20.2549Z",fill:"currentColor"}),Ee.jsx("path",{d:"M19.8337 8.61425C20.478 8.61425 21.0003 8.09192 21.0003 7.44759C21.0003 6.80326 20.478 6.28092 19.8337 6.28092C19.1893 6.28092 18.667 6.80326 18.667 7.44759C18.667 8.09192 19.1893 8.61425 19.8337 8.61425Z",fill:"currentColor"}),Ee.jsx("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M19.8337 2.33301C17.2197 2.33301 15.167 4.52385 15.167 7.1293C15.167 7.85019 15.4274 8.59094 15.7195 9.21916C16.0229 9.8717 16.4198 10.5259 16.8094 11.1056C17.5898 12.2664 18.4067 13.2245 18.579 13.4238L18.5825 13.4278C18.89 13.7803 19.3411 13.9997 19.8337 13.9997C20.3262 13.9997 20.7773 13.7803 21.0848 13.4278L21.0883 13.4238C21.2606 13.2245 22.0776 12.2664 22.8579 11.1056C23.2476 10.5259 23.6444 9.8717 23.9478 9.21916C24.2399 8.59094 24.5003 7.85019 24.5003 7.1293C24.5003 4.52385 22.4476 2.33301 19.8337 2.33301ZM17.5003 7.1293C17.5003 5.7318 18.5876 4.66634 19.8337 4.66634C21.0797 4.66634 22.167 5.7318 22.167 7.1293C22.167 7.33968 22.0764 7.70972 21.832 8.23544C21.5989 8.73683 21.2738 9.2797 20.9214 9.80382C20.5368 10.376 20.1392 10.8972 19.8337 11.2802C19.5281 10.8972 19.1305 10.376 18.7459 9.80382C18.3936 9.2797 18.0684 8.73683 17.8353 8.23544C17.5909 7.70972 17.5003 7.33968 17.5003 7.1293Z",fill:"currentColor"})]}),bx=({size:u=20,fill:m="#1877F2"})=>Ee.jsx("svg",{width:u,height:u,viewBox:"0 0 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:Ee.jsx("path",{d:"M23.1875 5.25H10.9375C10.6094 5.25 10.3314 5.36393 10.1035 5.5918C9.87565 5.81966 9.76172 6.09766 9.76172 6.42578C9.76172 6.73568 9.87565 7.00456 10.1035 7.23242C10.3314 7.46029 10.6094 7.57422 10.9375 7.57422H23.1875C23.4974 7.57422 23.7663 7.46029 23.9941 7.23242C24.222 7.00456 24.3359 6.73568 24.3359 6.42578C24.3359 6.09766 24.222 5.81966 23.9941 5.5918C23.7663 5.36393 23.4974 5.25 23.1875 5.25ZM23.1875 12.25H10.9375C10.6094 12.25 10.3314 12.3639 10.1035 12.5918C9.87565 12.8197 9.76172 13.0977 9.76172 13.4258C9.76172 13.7357 9.87565 14.0046 10.1035 14.2324C10.3314 14.4603 10.6094 14.5742 10.9375 14.5742H23.1875C23.4974 14.5742 23.7663 14.4603 23.9941 14.2324C24.222 14.0046 24.3359 13.7357 24.3359 13.4258C24.3359 13.0977 24.222 12.8197 23.9941 12.5918C23.7663 12.3639 23.4974 12.25 23.1875 12.25ZM23.1875 19.25H10.9375C10.6094 19.25 10.3314 19.3639 10.1035 19.5918C9.87565 19.8197 9.76172 20.0977 9.76172 20.4258C9.76172 20.7357 9.87565 21.0046 10.1035 21.2324C10.3314 21.4603 10.6094 21.5742 10.9375 21.5742H23.1875C23.4974 21.5742 23.7663 21.4603 23.9941 21.2324C24.222 21.0046 24.3359 20.7357 24.3359 20.4258C24.3359 20.0977 24.222 19.8197 23.9941 19.5918C23.7663 19.3639 23.4974 19.25 23.1875 19.25ZM5.25 18.6758C5.72396 18.6758 6.13411 18.8444 6.48047 19.1816C6.82682 19.5189 7 19.9336 7 20.4258C7 20.8997 6.82682 21.3099 6.48047 21.6562C6.13411 22.0026 5.72396 22.1758 5.25 22.1758C4.75781 22.1758 4.3431 22.0026 4.00586 21.6562C3.66862 21.3099 3.5 20.8997 3.5 20.4258C3.5 19.9336 3.66862 19.5189 4.00586 19.1816C4.3431 18.8444 4.75781 18.6758 5.25 18.6758ZM5.25 15.1758C4.75781 15.1758 4.3431 15.0026 4.00586 14.6562C3.66862 14.3099 3.5 13.8997 3.5 13.4258C3.5 12.9336 3.66862 12.5189 4.00586 12.1816C4.3431 11.8444 4.75781 11.6758 5.25 11.6758C5.72396 11.6758 6.13411 11.8444 6.48047 12.1816C6.82682 12.5189 7 12.9336 7 13.4258C7 13.8997 6.82682 14.3099 6.48047 14.6562C6.13411 15.0026 5.72396 15.1758 5.25 15.1758ZM5.25 8.17578C4.75781 8.17578 4.3431 8.0026 4.00586 7.65625C3.66862 7.3099 3.5 6.89974 3.5 6.42578C3.5 5.93359 3.66862 5.51888 4.00586 5.18164C4.3431 4.8444 4.75781 4.67578 5.25 4.67578C5.72396 4.67578 6.13411 4.8444 6.48047 5.18164C6.82682 5.51888 7 5.93359 7 6.42578C7 6.89974 6.82682 7.3099 6.48047 7.65625C6.13411 8.0026 5.72396 8.17578 5.25 8.17578Z",fill:"currentColor"})}),wx=[{title:"Stt",dataIndex:"stt",key:"stt",render:(u,m,b)=>b+1},...ah,...qf,{title:"Táº§n suáº¥t",dataIndex:"frequency",key:"frequency",render:u=>Ee.jsx($n,{mode:"multiple",options:gx,style:{width:"100%"},placeholder:"Chá»n táº§n suáº¥t",defaultValue:u?u.split(";"):[]})},{title:"HÃ nh Ä‘á»™ng",dataIndex:"",key:"action",render:(u,m)=>Ee.jsx("div",{className:"flex justify-center",children:Ee.jsx(jf,{})})}];function Sx({data:u,handleData:m}){return Ee.jsx("div",{className:"p-4",children:Ee.jsx(ih,{columns:wx,dataSource:u,pagination:!1})})}const Cx=k.createContext(null);function Tx(u,m){const b=Array.isArray(u)?u[0]:u?u.x:0,w=Array.isArray(u)?u[1]:u?u.y:0,T=Array.isArray(m)?m[0]:m?m.x:0,A=Array.isArray(m)?m[1]:m?m.y:0;return b===T&&w===A}function On(u,m){if(u===m)return!0;if(!u||!m)return!1;if(Array.isArray(u)){if(!Array.isArray(m)||u.length!==m.length)return!1;for(let b=0;b<u.length;b++)if(!On(u[b],m[b]))return!1;return!0}else if(Array.isArray(m))return!1;if(typeof u=="object"&&typeof m=="object"){const b=Object.keys(u),w=Object.keys(m);if(b.length!==w.length)return!1;for(const T of b)if(!m.hasOwnProperty(T)||!On(u[T],m[T]))return!1;return!0}return!1}function Ix(u){const m=u.clone();return m.pixelsToGLUnits=u.pixelsToGLUnits,m}function Mp(u,m){if(!u.getProjection)return;const b=u.getProjection(),w=m.getProjection();On(b,w)||m.setProjection(b)}function Ap(u){return{longitude:u.center.lng,latitude:u.center.lat,zoom:u.zoom,pitch:u.pitch,bearing:u.bearing,padding:u.padding}}function kp(u,m){const b=m.viewState||m;let w=!1;if("longitude"in b&&"latitude"in b){const T=u.center;u.center=new T.constructor(b.longitude,b.latitude),w=w||T!==u.center}if("zoom"in b){const T=u.zoom;u.zoom=b.zoom,w=w||T!==u.zoom}if("bearing"in b){const T=u.bearing;u.bearing=b.bearing,w=w||T!==u.bearing}if("pitch"in b){const T=u.pitch;u.pitch=b.pitch,w=w||T!==u.pitch}return b.padding&&!u.isPaddingEqual(b.padding)&&(w=!0,u.padding=b.padding),w}const Ex=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function zp(u){if(!u)return null;if(typeof u=="string"||("toJS"in u&&(u=u.toJS()),!u.layers))return u;const m={};for(const w of u.layers)m[w.id]=w;const b=u.layers.map(w=>{let T=null;"interactive"in w&&(T=Object.assign({},w),delete T.interactive);const A=m[w.ref];if(A){T=T||Object.assign({},w),delete T.ref;for(const F of Ex)F in A&&(T[F]=A[F])}return T||w});return{...u,layers:b}}var Dp={};const Lp={version:8,sources:{},layers:[]},Rp={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},Vu={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},Bp={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},Px=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],Mx=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class Ns{constructor(m,b,w){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=T=>{const A=this.props[Bp[T.type]];A?A(T):T.type==="error"&&console.error(T.error)},this._onPointerEvent=T=>{(T.type==="mousemove"||T.type==="mouseout")&&this._updateHover(T);const A=this.props[Rp[T.type]];A&&(this.props.interactiveLayerIds&&T.type!=="mouseover"&&T.type!=="mouseout"&&(T.features=this._hoveredFeatures||this._queryRenderedFeatures(T.point)),A(T),delete T.features)},this._onCameraEvent=T=>{if(!this._internalUpdate){const A=this.props[Vu[T.type]];A&&A(T)}T.type in this._deferredEvents&&(this._deferredEvents[T.type]=!1)},this._MapClass=m,this.props=b,this._initialize(w)}get map(){return this._map}get transform(){return this._renderTransform}setProps(m){const b=this.props;this.props=m;const w=this._updateSettings(m,b);w&&this._createShadowTransform(this._map);const T=this._updateSize(m),A=this._updateViewState(m,!0);this._updateStyle(m,b),this._updateStyleComponents(m,b),this._updateHandlers(m,b),(w||T||A&&!this._map.isMoving())&&this.redraw()}static reuse(m,b){const w=Ns.savedMaps.pop();if(!w)return null;const T=w.map,A=T.getContainer();for(b.className=A.className;A.childNodes.length>0;)b.appendChild(A.childNodes[0]);T._container=b;const F=T._resizeObserver;F&&(F.disconnect(),F.observe(b)),w.setProps({...m,styleDiffing:!1}),T.resize();const{initialViewState:s}=m;return s&&(s.bounds?T.fitBounds(s.bounds,{...s.fitBoundsOptions,duration:0}):w._updateViewState(s,!1)),T.isStyleLoaded()?T.fire("load"):T.once("styledata",()=>T.fire("load")),T._update(),w}_initialize(m){const{props:b}=this,{mapStyle:w=Lp}=b,T={...b,...b.initialViewState,accessToken:b.mapboxAccessToken||Ax()||null,container:m,style:zp(w)},A=T.initialViewState||T.viewState||T;if(Object.assign(T,{center:[A.longitude||0,A.latitude||0],zoom:A.zoom||0,pitch:A.pitch||0,bearing:A.bearing||0}),b.gl){const K=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=K,b.gl)}const F=new this._MapClass(T);A.padding&&F.setPadding(A.padding),b.cursor&&(F.getCanvas().style.cursor=b.cursor),this._createShadowTransform(F);const s=F._render;F._render=K=>{this._inRender=!0,s.call(F,K),this._inRender=!1};const j=F._renderTaskQueue.run;F._renderTaskQueue.run=K=>{j.call(F._renderTaskQueue,K),this._onBeforeRepaint()},F.on("render",()=>this._onAfterRepaint());const L=F.fire;F.fire=this._fireEvent.bind(this,L),F.on("resize",()=>{this._renderTransform.resize(F.transform.width,F.transform.height)}),F.on("styledata",()=>{this._updateStyleComponents(this.props,{}),Mp(F.transform,this._renderTransform)}),F.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const K in Rp)F.on(K,this._onPointerEvent);for(const K in Vu)F.on(K,this._onCameraEvent);for(const K in Bp)F.on(K,this._onEvent);this._map=F}recycle(){const b=this.map.getContainer().querySelector("[mapboxgl-children]");b?.remove(),Ns.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const m=this._map;!this._inRender&&m.style&&(m._frame&&(m._frame.cancel(),m._frame=null),m._render())}_createShadowTransform(m){const b=Ix(m.transform);m.painter.transform=b,this._renderTransform=b}_updateSize(m){const{viewState:b}=m;if(b){const w=this._map;if(b.width!==w.transform.width||b.height!==w.transform.height)return w.resize(),!0}return!1}_updateViewState(m,b){if(this._internalUpdate)return!1;const w=this._map,T=this._renderTransform,{zoom:A,pitch:F,bearing:s}=T,j=w.isMoving();j&&(T.cameraElevationReference="sea");const L=kp(T,{...Ap(w.transform),...m});if(j&&(T.cameraElevationReference="ground"),L&&b){const K=this._deferredEvents;K.move=!0,K.zoom||(K.zoom=A!==T.zoom),K.rotate||(K.rotate=s!==T.bearing),K.pitch||(K.pitch=F!==T.pitch)}return j||kp(w.transform,m),L}_updateSettings(m,b){const w=this._map;let T=!1;for(const A of Px)if(A in m&&!On(m[A],b[A])){T=!0;const F=w[`set${A[0].toUpperCase()}${A.slice(1)}`];F?.call(w,m[A])}return T}_updateStyle(m,b){if(m.cursor!==b.cursor&&(this._map.getCanvas().style.cursor=m.cursor||""),m.mapStyle!==b.mapStyle){const{mapStyle:w=Lp,styleDiffing:T=!0}=m,A={diff:T};return"localIdeographFontFamily"in m&&(A.localIdeographFontFamily=m.localIdeographFontFamily),this._map.setStyle(zp(w),A),!0}return!1}_updateStyleComponents(m,b){const w=this._map;let T=!1;return w.isStyleLoaded()&&("light"in m&&w.setLight&&!On(m.light,b.light)&&(T=!0,w.setLight(m.light)),"fog"in m&&w.setFog&&!On(m.fog,b.fog)&&(T=!0,w.setFog(m.fog)),"terrain"in m&&w.setTerrain&&!On(m.terrain,b.terrain)&&(!m.terrain||w.getSource(m.terrain.source))&&(T=!0,w.setTerrain(m.terrain))),T}_updateHandlers(m,b){var w,T;const A=this._map;let F=!1;for(const s of Mx){const j=(w=m[s])!==null&&w!==void 0?w:!0,L=(T=b[s])!==null&&T!==void 0?T:!0;On(j,L)||(F=!0,j?A[s].enable(j):A[s].disable())}return F}_queryRenderedFeatures(m){const b=this._map,w=b.transform,{interactiveLayerIds:T=[]}=this.props;try{return b.transform=this._renderTransform,b.queryRenderedFeatures(m,{layers:T.filter(b.getLayer.bind(b))})}catch{return[]}finally{b.transform=w}}_updateHover(m){var b;const{props:w}=this;if(w.interactiveLayerIds&&(w.onMouseMove||w.onMouseEnter||w.onMouseLeave)){const A=m.type,F=((b=this._hoveredFeatures)===null||b===void 0?void 0:b.length)>0,s=this._queryRenderedFeatures(m.point),j=s.length>0;!j&&F&&(m.type="mouseleave",this._onPointerEvent(m)),this._hoveredFeatures=s,j&&!F&&(m.type="mouseenter",this._onPointerEvent(m)),m.type=A}else this._hoveredFeatures=null}_fireEvent(m,b,w){const T=this._map,A=T.transform,F=typeof b=="string"?b:b.type;return F==="move"&&this._updateViewState(this.props,!1),F in Vu&&(typeof b=="object"&&(b.viewState=Ap(A)),this._map.isMoving())?(T.transform=this._renderTransform,m.call(T,b,w),T.transform=A,T):(m.call(T,b,w),T)}_onBeforeRepaint(){const m=this._map;this._internalUpdate=!0;for(const w in this._deferredEvents)this._deferredEvents[w]&&m.fire(w);this._internalUpdate=!1;const b=this._map.transform;m.transform=this._renderTransform,this._onAfterRepaint=()=>{Mp(this._renderTransform,b),m.transform=b}}}Ns.savedMaps=[];function Ax(){let u=null;if(typeof location<"u"){const m=/access_token=([^&\/]*)/.exec(location.search);u=m&&m[1]}try{u=u||Dp.MapboxAccessToken}catch{}try{u=u||Dp.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return u}const kx=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function zx(u){if(!u)return null;const m=u.map,b={getMap:()=>m,getCenter:()=>u.transform.center,getZoom:()=>u.transform.zoom,getBearing:()=>u.transform.bearing,getPitch:()=>u.transform.pitch,getPadding:()=>u.transform.padding,getBounds:()=>u.transform.getBounds(),project:w=>{const T=m.transform;m.transform=u.transform;const A=m.project(w);return m.transform=T,A},unproject:w=>{const T=m.transform;m.transform=u.transform;const A=m.unproject(w);return m.transform=T,A},queryTerrainElevation:(w,T)=>{const A=m.transform;m.transform=u.transform;const F=m.queryTerrainElevation(w,T);return m.transform=A,F},queryRenderedFeatures:(w,T)=>{const A=m.transform;m.transform=u.transform;const F=m.queryRenderedFeatures(w,T);return m.transform=A,F}};for(const w of Dx(m))!(w in b)&&!kx.includes(w)&&(b[w]=m[w].bind(m));return b}function Dx(u){const m=new Set;let b=u;for(;b;){for(const w of Object.getOwnPropertyNames(b))w[0]!=="_"&&typeof u[w]=="function"&&w!=="fire"&&w!=="setEventedParent"&&m.add(w);b=Object.getPrototypeOf(b)}return Array.from(m)}const Lx=typeof document<"u"?k.useLayoutEffect:k.useEffect,Rx=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function Bx(u,m){for(const w of Rx)w in m&&(u[w]=m[w]);const{RTLTextPlugin:b="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=m;b&&u.getRTLTextPluginStatus&&u.getRTLTextPluginStatus()==="unavailable"&&u.setRTLTextPlugin(b,w=>{w&&console.error(w)},!0)}const ol=k.createContext(null);function Fx(u,m,b){const w=k.useContext(Cx),[T,A]=k.useState(null),F=k.useRef(),{current:s}=k.useRef({mapLib:null,map:null});k.useEffect(()=>{const K=u.mapLib;let ne=!0,te;return Promise.resolve(K||b).then(he=>{if(!ne)return;if(!he)throw new Error("Invalid mapLib");const ye="Map"in he?he:he.default;if(!ye.Map)throw new Error("Invalid mapLib");if(Bx(ye,u),!ye.supported||ye.supported(u))u.reuseMaps&&(te=Ns.reuse(u,F.current)),te||(te=new Ns(ye.Map,u,F.current)),s.map=zx(te),s.mapLib=ye,A(te),w?.onMapMount(s.map,u.id);else throw new Error("Map is not supported by this browser")}).catch(he=>{const{onError:ye}=u;ye?ye({type:"error",target:null,originalEvent:null,error:he}):console.error(he)}),()=>{ne=!1,te&&(w?.onMapUnmount(u.id),u.reuseMaps?te.recycle():te.destroy())}},[]),Lx(()=>{T&&T.setProps(u)}),k.useImperativeHandle(m,()=>s.map,[T]);const j=k.useMemo(()=>({position:"relative",width:"100%",height:"100%",...u.style}),[u.style]),L={height:"100%"};return k.createElement("div",{id:u.id,ref:F,style:j},T&&k.createElement(ol.Provider,{value:s},k.createElement("div",{"mapboxgl-children":"",style:L},u.children)))}const $x=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function Ya(u,m){if(!u||!m)return;const b=u.style;for(const w in m){const T=m[w];Number.isFinite(T)&&!$x.test(w)?b[w]=`${T}px`:b[w]=T}}function Ox(u,m){const{map:b,mapLib:w}=k.useContext(ol),T=k.useRef({props:u});T.current.props=u;const A=k.useMemo(()=>{let be=!1;k.Children.forEach(u.children,we=>{we&&(be=!0)});const Se={...u,element:be?document.createElement("div"):null},ve=new w.Marker(Se);return ve.setLngLat([u.longitude,u.latitude]),ve.getElement().addEventListener("click",we=>{var ge,xe;(xe=(ge=T.current.props).onClick)===null||xe===void 0||xe.call(ge,{type:"click",target:ve,originalEvent:we})}),ve.on("dragstart",we=>{var ge,xe;const Pe=we;Pe.lngLat=A.getLngLat(),(xe=(ge=T.current.props).onDragStart)===null||xe===void 0||xe.call(ge,Pe)}),ve.on("drag",we=>{var ge,xe;const Pe=we;Pe.lngLat=A.getLngLat(),(xe=(ge=T.current.props).onDrag)===null||xe===void 0||xe.call(ge,Pe)}),ve.on("dragend",we=>{var ge,xe;const Pe=we;Pe.lngLat=A.getLngLat(),(xe=(ge=T.current.props).onDragEnd)===null||xe===void 0||xe.call(ge,Pe)}),ve},[]);k.useEffect(()=>(A.addTo(b.getMap()),()=>{A.remove()}),[]);const{longitude:F,latitude:s,offset:j,style:L,draggable:K=!1,popup:ne=null,rotation:te=0,rotationAlignment:he="auto",pitchAlignment:ye="auto"}=u;return k.useEffect(()=>{Ya(A.getElement(),L)},[L]),k.useImperativeHandle(m,()=>A,[]),(A.getLngLat().lng!==F||A.getLngLat().lat!==s)&&A.setLngLat([F,s]),j&&!Tx(A.getOffset(),j)&&A.setOffset(j),A.isDraggable()!==K&&A.setDraggable(K),A.getRotation()!==te&&A.setRotation(te),A.getRotationAlignment()!==he&&A.setRotationAlignment(he),A.getPitchAlignment()!==ye&&A.setPitchAlignment(ye),A.getPopup()!==ne&&A.setPopup(ne),Jo.createPortal(u.children,A.getElement())}k.memo(k.forwardRef(Ox));function Fp(u){return new Set(u?u.trim().split(/\s+/):[])}function Nx(u,m){const{map:b,mapLib:w}=k.useContext(ol),T=k.useMemo(()=>document.createElement("div"),[]),A=k.useRef({props:u});A.current.props=u;const F=k.useMemo(()=>{const s={...u},j=new w.Popup(s);return j.setLngLat([u.longitude,u.latitude]),j.once("open",L=>{var K,ne;(ne=(K=A.current.props).onOpen)===null||ne===void 0||ne.call(K,L)}),j},[]);if(k.useEffect(()=>{const s=j=>{var L,K;(K=(L=A.current.props).onClose)===null||K===void 0||K.call(L,j)};return F.on("close",s),F.setDOMContent(T).addTo(b.getMap()),()=>{F.off("close",s),F.isOpen()&&F.remove()}},[]),k.useEffect(()=>{Ya(F.getElement(),u.style)},[u.style]),k.useImperativeHandle(m,()=>F,[]),F.isOpen()&&((F.getLngLat().lng!==u.longitude||F.getLngLat().lat!==u.latitude)&&F.setLngLat([u.longitude,u.latitude]),u.offset&&!On(F.options.offset,u.offset)&&F.setOffset(u.offset),(F.options.anchor!==u.anchor||F.options.maxWidth!==u.maxWidth)&&(F.options.anchor=u.anchor,F.setMaxWidth(u.maxWidth)),F.options.className!==u.className)){const s=Fp(F.options.className),j=Fp(u.className);for(const L of s)j.has(L)||F.removeClassName(L);for(const L of j)s.has(L)||F.addClassName(L);F.options.className=u.className}return Jo.createPortal(u.children,T)}k.memo(k.forwardRef(Nx));function ll(u,m,b,w){const T=k.useContext(ol),A=k.useMemo(()=>u(T),[]);return k.useEffect(()=>{const F=w||b||m,s=typeof m=="function"&&typeof b=="function"?m:null,j=typeof b=="function"?b:typeof m=="function"?m:null,{map:L}=T;return L.hasControl(A)||(L.addControl(A,F?.position),s&&s(T)),()=>{j&&j(T),L.hasControl(A)&&L.removeControl(A)}},[]),A}function jx(u){const m=ll(({mapLib:b})=>new b.AttributionControl(u),{position:u.position});return k.useEffect(()=>{Ya(m._container,u.style)},[u.style]),null}k.memo(jx);function Vx(u){const m=ll(({mapLib:b})=>new b.FullscreenControl({container:u.containerId&&document.getElementById(u.containerId)}),{position:u.position});return k.useEffect(()=>{Ya(m._controlContainer,u.style)},[u.style]),null}k.memo(Vx);function Ux(u,m){const b=k.useRef({props:u}),w=ll(({mapLib:T})=>{const A=new T.GeolocateControl(u),F=A._setupUI;return A._setupUI=s=>{A._container.hasChildNodes()||F(s)},A.on("geolocate",s=>{var j,L;(L=(j=b.current.props).onGeolocate)===null||L===void 0||L.call(j,s)}),A.on("error",s=>{var j,L;(L=(j=b.current.props).onError)===null||L===void 0||L.call(j,s)}),A.on("outofmaxbounds",s=>{var j,L;(L=(j=b.current.props).onOutOfMaxBounds)===null||L===void 0||L.call(j,s)}),A.on("trackuserlocationstart",s=>{var j,L;(L=(j=b.current.props).onTrackUserLocationStart)===null||L===void 0||L.call(j,s)}),A.on("trackuserlocationend",s=>{var j,L;(L=(j=b.current.props).onTrackUserLocationEnd)===null||L===void 0||L.call(j,s)}),A},{position:u.position});return b.current.props=u,k.useImperativeHandle(m,()=>w,[]),k.useEffect(()=>{Ya(w._container,u.style)},[u.style]),null}k.memo(k.forwardRef(Ux));function qx(u){const m=ll(({mapLib:b})=>new b.NavigationControl(u),{position:u.position});return k.useEffect(()=>{Ya(m._container,u.style)},[u.style]),null}k.memo(qx);function Gx(u){const m=ll(({mapLib:A})=>new A.ScaleControl(u),{position:u.position}),b=k.useRef(u),w=b.current;b.current=u;const{style:T}=u;return u.maxWidth!==void 0&&u.maxWidth!==w.maxWidth&&(m.options.maxWidth=u.maxWidth),u.unit!==void 0&&u.unit!==w.unit&&m.setUnit(u.unit),k.useEffect(()=>{Ya(m._container,T)},[T]),null}k.memo(Gx);function $p(u,m){if(!u)throw new Error(m)}let Zx=0;function Hx(u,m,b){if(u.style&&u.style._loaded){const w={...b};return delete w.id,delete w.children,u.addSource(m,w),u.getSource(m)}return null}function Wx(u,m,b){$p(m.id===b.id,"source id changed"),$p(m.type===b.type,"source type changed");let w="",T=0;for(const F in m)F!=="children"&&F!=="id"&&!On(b[F],m[F])&&(w=F,T++);if(!T)return;const A=m.type;if(A==="geojson")u.setData(m.data);else if(A==="image")u.updateImage({url:m.url,coordinates:m.coordinates});else if("setCoordinates"in u&&T===1&&w==="coordinates")u.setCoordinates(m.coordinates);else if("setUrl"in u)switch(w){case"url":u.setUrl(m.url);break;case"tiles":u.setTiles(m.tiles);break}else console.warn(`Unable to update <Source> prop: ${w}`)}function Xx(u){const m=k.useContext(ol).map.getMap(),b=k.useRef(u),[,w]=k.useState(0),T=k.useMemo(()=>u.id||`jsx-source-${Zx++}`,[]);k.useEffect(()=>{if(m){const F=()=>setTimeout(()=>w(s=>s+1),0);return m.on("styledata",F),F(),()=>{var s;if(m.off("styledata",F),m.style&&m.style._loaded&&m.getSource(T)){const j=(s=m.getStyle())===null||s===void 0?void 0:s.layers;if(j)for(const L of j)L.source===T&&m.removeLayer(L.id);m.removeSource(T)}}}},[m]);let A=m&&m.style&&m.getSource(T);return A?Wx(A,u,b.current):A=Hx(m,T,u),b.current=u,A&&k.Children.map(u.children,F=>F&&k.cloneElement(F,{source:T}))||null}const Kx=x_(()=>import("./mapbox-gl-3WlcSu9R.js").then(u=>u.m),__vite__mapDeps([0,1,2])),Yx=k.forwardRef(function(m,b){return Fx(m,b,Kx)}),Jx=Xx;var Gf={exports:{}};(function(u,m){(function(b,w){u.exports=w()})(b_,function(){var b,w,T;function A(s,j){if(!b)b=j;else if(!w)w=j;else{var L="var sharedChunk = {}; ("+b+")(sharedChunk); ("+w+")(sharedChunk);",K={};b(K),T=j(K),typeof window<"u"&&(T.workerUrl=window.URL.createObjectURL(new Blob([L],{type:"text/javascript"})))}}A(["exports"],function(s){function j(i,e,r,a){return new(r||(r=Promise))(function(l,d){function f(S){try{v(a.next(S))}catch(I){d(I)}}function g(S){try{v(a.throw(S))}catch(I){d(I)}}function v(S){var I;S.done?l(S.value):(I=S.value,I instanceof r?I:new r(function(M){M(I)})).then(f,g)}v((a=a.apply(i,e||[])).next())})}function L(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}typeof SuppressedError=="function"&&SuppressedError;var K=ne;function ne(i,e){this.x=i,this.y=e}ne.prototype={clone:function(){return new ne(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,r=i.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),r=Math.sin(i),a=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=a,this},_rotateAround:function(i,e){var r=Math.cos(i),a=Math.sin(i),l=e.y+a*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-a*(this.y-e.y),this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ne.convert=function(i){return i instanceof ne?i:Array.isArray(i)?new ne(i[0],i[1]):i};var te=L(K),he=ye;function ye(i,e,r,a){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(a-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=r,this.p2y=a}ye.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,a=0;a<8;a++){var l=this.sampleCurveX(r)-i;if(Math.abs(l)<e)return r;var d=this.sampleCurveDerivativeX(r);if(Math.abs(d)<1e-6)break;r-=l/d}var f=0,g=1;for(r=i,a=0;a<20&&(l=this.sampleCurveX(r),!(Math.abs(l-i)<e));a++)i>l?f=r:g=r,r=.5*(g-f)+f;return r},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};var be=L(he);let Se,ve;function we(){return Se==null&&(Se=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Se}function ge(){if(ve==null&&(ve=!1,we())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let a=0;a<5*5;a++){const l=4*a;e.fillStyle=`rgb(${l},${l+1},${l+2})`,e.fillRect(a%5,Math.floor(a/5),1,1)}const r=e.getImageData(0,0,5,5).data;for(let a=0;a<5*5*4;a++)if(a%4!=3&&r[a]!==a){ve=!0;break}}}return ve||!1}function xe(i,e,r,a){const l=new be(i,e,r,a);return function(d){return l.solve(d)}}const Pe=xe(.25,.1,.25,1);function Re(i,e,r){return Math.min(r,Math.max(e,i))}function Ne(i,e,r){const a=r-e,l=((i-e)%a+a)%a+e;return l===e?r:l}function Fe(i,...e){for(const r of e)for(const a in r)i[a]=r[a];return i}let Le=1;function Te(i,e,r){const a={};for(const l in i)a[l]=e.call(r||this,i[l],l,i);return a}function Ue(i,e,r){const a={};for(const l in i)e.call(r||this,i[l],l,i)&&(a[l]=i[l]);return a}function We(i){return Array.isArray(i)?i.map(We):typeof i=="object"&&i?Te(i,We):i}const tt={};function Xe(i){tt[i]||(typeof console<"u"&&console.warn(i),tt[i]=!0)}function at(i,e,r){return(r.y-i.y)*(e.x-i.x)>(e.y-i.y)*(r.x-i.x)}function Ct(i){let e=0;for(let r,a,l=0,d=i.length,f=d-1;l<d;f=l++)r=i[l],a=i[f],e+=(a.x-r.x)*(r.y+a.y);return e}function st(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let jt=null;function At(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const Qt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Gt(i,e,r,a,l){return j(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const d=new VideoFrame(i,{timestamp:0});try{const f=d?.format;if(!f||!f.startsWith("BGR")&&!f.startsWith("RGB"))throw new Error(`Unrecognized format ${f}`);const g=f.startsWith("BGR"),v=new Uint8ClampedArray(a*l*4);if(yield d.copyTo(v,function(S,I,M,D,$){const O=4*Math.max(-I,0),U=(Math.max(0,M)-M)*D*4+O,X=4*D,ee=Math.max(0,I),le=Math.max(0,M);return{rect:{x:ee,y:le,width:Math.min(S.width,I+D)-ee,height:Math.min(S.height,M+$)-le},layout:[{offset:U,stride:X}]}}(i,e,r,a,l)),g)for(let S=0;S<v.length;S+=4){const I=v[S];v[S]=v[S+2],v[S+2]=I}return v}finally{d.close()}})}let ft,Be,gt,$t;const bt={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(i){const e=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(i,e=0){return this.getImageCanvasContext(i).getImageData(-e,-e,i.width+2*e,i.height+2*e)},getImageCanvasContext(i){const e=window.document.createElement("canvas"),r=e.getContext("2d",{willReadFrequently:!0});if(!r)throw new Error("failed to create canvas 2d context");return e.width=i.width,e.height=i.height,r.drawImage(i,0,0,i.width,i.height),r},resolveURL:i=>(gt||(gt=document.createElement("a")),gt.href=i,gt.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&($t==null&&($t=matchMedia("(prefers-reduced-motion: reduce)")),$t.matches)}},Bt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class Yt extends Error{constructor(e,r,a,l){super(`AJAXError: ${r} (${e}): ${a}`),this.status=e,this.statusText=r,this.url=a,this.body=l}}const ei=st()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,kt=i=>Bt.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))];function gi(i,e){const r=new AbortController,a=new Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,cache:i.cache,referrer:ei(),signal:r.signal});let l=!1,d=!1;return i.type==="json"&&a.headers.set("Accept","application/json"),d||fetch(a).then(f=>f.ok?(g=>{(i.type==="arrayBuffer"||i.type==="image"?g.arrayBuffer():i.type==="json"?g.json():g.text()).then(v=>{d||(l=!0,e(null,v,g.headers.get("Cache-Control"),g.headers.get("Expires")))}).catch(v=>{d||e(new Error(v.message))})})(f):f.blob().then(g=>e(new Yt(f.status,f.statusText,i.url,g)))).catch(f=>{f.code!==20&&e(new Error(f.message))}),{cancel:()=>{d=!0,l||r.abort()}}}const pi=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){if(st()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e);if(!st())return(kt(i.url)||gi)(i,e)}if(!(/^file:/.test(r=i.url)||/^file:/.test(ei())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return gi(i,e);if(st()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var r;return function(a,l){const d=new XMLHttpRequest;d.open(a.method||"GET",a.url,!0),a.type!=="arrayBuffer"&&a.type!=="image"||(d.responseType="arraybuffer");for(const f in a.headers)d.setRequestHeader(f,a.headers[f]);return a.type==="json"&&(d.responseType="text",d.setRequestHeader("Accept","application/json")),d.withCredentials=a.credentials==="include",d.onerror=()=>{l(new Error(d.statusText))},d.onload=()=>{if((d.status>=200&&d.status<300||d.status===0)&&d.response!==null){let f=d.response;if(a.type==="json")try{f=JSON.parse(d.response)}catch(g){return l(g)}l(null,f,d.getResponseHeader("Cache-Control"),d.getResponseHeader("Expires"))}else{const f=new Blob([d.response],{type:d.getResponseHeader("Content-Type")});l(new Yt(d.status,d.statusText,a.url,f))}},d.send(a.body),{cancel:()=>d.abort()}}(i,e)},Pt=function(i,e){return pi(Fe(i,{type:"arrayBuffer"}),e)};function li(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const e=new URL(i),r=window.location;return e.protocol===r.protocol&&e.host===r.host}function Xi(i,e,r){r[i]&&r[i].indexOf(e)!==-1||(r[i]=r[i]||[],r[i].push(e))}function Ht(i,e,r){if(r&&r[i]){const a=r[i].indexOf(e);a!==-1&&r[i].splice(a,1)}}class Mi{constructor(e,r={}){Fe(this,r),this.type=e}}class Oi extends Mi{constructor(e,r={}){super("error",Fe({error:e},r))}}class gr{on(e,r){return this._listeners=this._listeners||{},Xi(e,r,this._listeners),this}off(e,r){return Ht(e,r,this._listeners),Ht(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Xi(e,r,this._oneTimeListeners),this):new Promise(a=>this.once(e,a))}fire(e,r){typeof e=="string"&&(e=new Mi(e,r||{}));const a=e.type;if(this.listens(a)){e.target=this;const l=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const g of l)g.call(this,e);const d=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const g of d)Ht(a,g,this._oneTimeListeners),g.call(this,e);const f=this._eventedParent;f&&(Fe(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),f.fire(e))}else e instanceof Oi&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var _e={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const bi=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Di(i,e){const r={};for(const a in i)a!=="ref"&&(r[a]=i[a]);return bi.forEach(a=>{a in e&&(r[a]=e[a])}),r}function Wt(i,e){if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let r=0;r<i.length;r++)if(!Wt(i[r],e[r]))return!1;return!0}if(typeof i=="object"&&i!==null&&e!==null){if(typeof e!="object"||Object.keys(i).length!==Object.keys(e).length)return!1;for(const r in i)if(!Wt(i[r],e[r]))return!1;return!0}return i===e}const Ot={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Gi(i,e,r){r.push({command:Ot.addSource,args:[i,e[i]]})}function Ki(i,e,r){e.push({command:Ot.removeSource,args:[i]}),r[i]=!0}function _i(i,e,r,a){Ki(i,r,a),Gi(i,e,r)}function sn(i,e,r){let a;for(a in i[r])if(Object.prototype.hasOwnProperty.call(i[r],a)&&a!=="data"&&!Wt(i[r][a],e[r][a]))return!1;for(a in e[r])if(Object.prototype.hasOwnProperty.call(e[r],a)&&a!=="data"&&!Wt(i[r][a],e[r][a]))return!1;return!0}function sr(i,e,r,a,l,d){let f;for(f in e=e||{},i=i||{})Object.prototype.hasOwnProperty.call(i,f)&&(Wt(i[f],e[f])||r.push({command:d,args:[a,f,e[f],l]}));for(f in e)Object.prototype.hasOwnProperty.call(e,f)&&!Object.prototype.hasOwnProperty.call(i,f)&&(Wt(i[f],e[f])||r.push({command:d,args:[a,f,e[f],l]}))}function ar(i){return i.id}function Ur(i,e){return i[e.id]=e,i}class je{constructor(e,r,a,l){this.message=(e?`${e}: `:"")+a,l&&(this.identifier=l),r!=null&&r.__line__&&(this.line=r.__line__)}}function It(i,...e){for(const r of e)for(const a in r)i[a]=r[a];return i}class wt extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class Jt{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[a,l]of r)this.bindings[a]=l}concat(e){return new Jt(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const zt={kind:"null"},ze={kind:"number"},mt={kind:"string"},yt={kind:"boolean"},wi={kind:"color"},Zi={kind:"object"},Mt={kind:"value"},qr={kind:"collator"},Z={kind:"formatted"},z={kind:"padding"},R={kind:"resolvedImage"},N={kind:"variableAnchorOffsetCollection"};function W(i,e){return{kind:"array",itemType:i,N:e}}function Y(i){if(i.kind==="array"){const e=Y(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const ce=[zt,ze,mt,yt,wi,Z,Zi,W(Mt),z,R,N];function re(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!re(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const r of ce)if(!re(r,e))return null}}return`Expected ${Y(i)} but found ${Y(e)} instead.`}function Q(i,e){return e.some(r=>r.kind===i.kind)}function se(i,e){return e.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}function Ce(i,e){return i.kind==="array"&&e.kind==="array"?i.itemType.kind===e.itemType.kind&&typeof i.N=="number":i.kind===e.kind}const Ie=.96422,Ae=.82521,dt=4/29,St=6/29,nt=3*St*St,Ke=St*St*St,Ye=Math.PI/180,Et=180/Math.PI;function Ft(i){return(i%=360)<0&&(i+=360),i}function Rt([i,e,r,a]){let l,d;const f=Ni((.2225045*(i=Dt(i))+.7168786*(e=Dt(e))+.0606169*(r=Dt(r)))/1);i===e&&e===r?l=d=f:(l=Ni((.4360747*i+.3850649*e+.1430804*r)/Ie),d=Ni((.0139322*i+.0971045*e+.7141733*r)/Ae));const g=116*f-16;return[g<0?0:g,500*(l-f),200*(f-d),a]}function Dt(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Ni(i){return i>Ke?Math.pow(i,1/3):i/nt+dt}function ci([i,e,r,a]){let l=(i+16)/116,d=isNaN(e)?l:l+e/500,f=isNaN(r)?l:l-r/200;return l=1*Ri(l),d=Ie*Ri(d),f=Ae*Ri(f),[Li(3.1338561*d-1.6168667*l-.4906146*f),Li(-.9787684*d+1.9161415*l+.033454*f),Li(.0719453*d-.2289914*l+1.4052427*f),a]}function Li(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function Ri(i){return i>St?i*i*i:nt*(i-dt)}function Sr(i){return parseInt(i.padEnd(2,i),16)/255}function Ja(i,e){return En(e?i/100:i,0,1)}function En(i,e,r){return Math.min(Math.max(e,i),r)}function Pn(i){return!i.some(Number.isNaN)}const Ec={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class ui{constructor(e,r,a,l=1,d=!0){this.r=e,this.g=r,this.b=a,this.a=l,d||(this.r*=l,this.g*=l,this.b*=l,l||this.overwriteGetter("rgb",[e,r,a,l]))}static parse(e){if(e instanceof ui)return e;if(typeof e!="string")return;const r=function(a){if((a=a.toLowerCase().trim())==="transparent")return[0,0,0,0];const l=Ec[a];if(l){const[f,g,v]=l;return[f/255,g/255,v/255,1]}if(a.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(a)){const f=a.length<6?1:2;let g=1;return[Sr(a.slice(g,g+=f)),Sr(a.slice(g,g+=f)),Sr(a.slice(g,g+=f)),Sr(a.slice(g,g+f)||"ff")]}if(a.startsWith("rgb")){const f=a.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(f){const[g,v,S,I,M,D,$,O,U,X,ee,le]=f,ie=[I||" ",$||" ",X].join("");if(ie==="  "||ie==="  /"||ie===",,"||ie===",,,"){const ue=[S,D,U].join(""),pe=ue==="%%%"?100:ue===""?255:0;if(pe){const ke=[En(+v/pe,0,1),En(+M/pe,0,1),En(+O/pe,0,1),ee?Ja(+ee,le):1];if(Pn(ke))return ke}}return}}const d=a.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(d){const[f,g,v,S,I,M,D,$,O]=d,U=[v||" ",I||" ",D].join("");if(U==="  "||U==="  /"||U===",,"||U===",,,"){const X=[+g,En(+S,0,100),En(+M,0,100),$?Ja(+$,O):1];if(Pn(X))return function([ee,le,ie,ue]){function pe(ke){const et=(ke+ee/30)%12,lt=le*Math.min(ie,1-ie);return ie-lt*Math.max(-1,Math.min(et-3,9-et,1))}return ee=Ft(ee),le/=100,ie/=100,[pe(0),pe(8),pe(4),ue]}(X)}}}(e);return r?new ui(...r,!1):void 0}get rgb(){const{r:e,g:r,b:a,a:l}=this,d=l||1/0;return this.overwriteGetter("rgb",[e/d,r/d,a/d,l])}get hcl(){return this.overwriteGetter("hcl",function(e){const[r,a,l,d]=Rt(e),f=Math.sqrt(a*a+l*l);return[Math.round(1e4*f)?Ft(Math.atan2(l,a)*Et):NaN,f,r,d]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Rt(this.rgb))}overwriteGetter(e,r){return Object.defineProperty(this,e,{value:r}),r}toString(){const[e,r,a,l]=this.rgb;return`rgba(${[e,r,a].map(d=>Math.round(255*d)).join(",")},${l})`}}ui.black=new ui(0,0,0,1),ui.white=new ui(1,1,1,1),ui.transparent=new ui(0,0,0,0),ui.red=new ui(1,0,0,1);class Us{constructor(e,r,a){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Qa{constructor(e,r,a,l,d){this.text=e,this.image=r,this.scale=a,this.fontStack=l,this.textColor=d}}class hr{constructor(e){this.sections=e}static fromString(e){return new hr([new Qa(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof hr?e:hr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class zr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof zr)return e;if(typeof e=="number")return new zr([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const r of e)if(typeof r!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new zr(e)}}toString(){return JSON.stringify(this.values)}}const Pc=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Gr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Gr)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let r=0;r<e.length;r+=2){const a=e[r],l=e[r+1];if(typeof a!="string"||!Pc.has(a)||!Array.isArray(l)||l.length!==2||typeof l[0]!="number"||typeof l[1]!="number")return}return new Gr(e)}}toString(){return JSON.stringify(this.values)}}class or{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new or({name:e,available:!1}):null}}function es(i,e,r,a){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[i,e,r,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[i,e,r,a]:[i,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function aa(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof ui||i instanceof Us||i instanceof hr||i instanceof zr||i instanceof Gr||i instanceof or)return!0;if(Array.isArray(i)){for(const e of i)if(!aa(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!aa(i[e]))return!1;return!0}return!1}function Ti(i){if(i===null)return zt;if(typeof i=="string")return mt;if(typeof i=="boolean")return yt;if(typeof i=="number")return ze;if(i instanceof ui)return wi;if(i instanceof Us)return qr;if(i instanceof hr)return Z;if(i instanceof zr)return z;if(i instanceof Gr)return N;if(i instanceof or)return R;if(Array.isArray(i)){const e=i.length;let r;for(const a of i){const l=Ti(a);if(r){if(r===l)continue;r=Mt;break}r=l}return W(r||Mt,e)}return Zi}function ni(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof ui||i instanceof hr||i instanceof zr||i instanceof Gr||i instanceof or?i.toString():JSON.stringify(i)}class Vn{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!aa(e[1]))return r.error("invalid value");const a=e[1];let l=Ti(a);const d=r.expectedType;return l.kind!=="array"||l.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(l=d),new Vn(l,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Ai{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const ts={string:mt,number:ze,boolean:yt,object:Zi};class Zr{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let a,l=1;const d=e[0];if(d==="array"){let g,v;if(e.length>2){const S=e[1];if(typeof S!="string"||!(S in ts)||S==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);g=ts[S],l++}else g=Mt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);v=e[2],l++}a=W(g,v)}else{if(!ts[d])throw new Error(`Types doesn't contain name = ${d}`);a=ts[d]}const f=[];for(;l<e.length;l++){const g=r.parse(e[l],l,Mt);if(!g)return null;f.push(g)}return new Zr(a,f)}evaluate(e){for(let r=0;r<this.args.length;r++){const a=this.args[r].evaluate(e);if(!re(this.type,Ti(a)))return a;if(r===this.args.length-1)throw new Ai(`Expected value to be of type ${Y(this.type)}, but found ${Y(Ti(a))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const qs={"to-boolean":yt,"to-color":wi,"to-number":ze,"to-string":mt};class Mn{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const a=e[0];if(!qs[a])throw new Error(`Can't parse ${a} as it is not part of the known types`);if((a==="to-boolean"||a==="to-string")&&e.length!==2)return r.error("Expected one argument.");const l=qs[a],d=[];for(let f=1;f<e.length;f++){const g=r.parse(e[f],f,Mt);if(!g)return null;d.push(g)}return new Mn(l,d)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let r,a;for(const l of this.args){if(r=l.evaluate(e),a=null,r instanceof ui)return r;if(typeof r=="string"){const d=e.parseColor(r);if(d)return d}else if(Array.isArray(r)&&(a=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:es(r[0],r[1],r[2],r[3]),!a))return new ui(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Ai(a||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const a of this.args){r=a.evaluate(e);const l=zr.parse(r);if(l)return l}throw new Ai(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const a of this.args){r=a.evaluate(e);const l=Gr.parse(r);if(l)return l}throw new Ai(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const a of this.args){if(r=a.evaluate(e),r===null)return 0;const l=Number(r);if(!isNaN(l))return l}throw new Ai(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return hr.fromString(ni(this.args[0].evaluate(e)));case"resolvedImage":return or.fromString(ni(this.args[0].evaluate(e)));default:return ni(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const cl=["Unknown","Point","LineString","Polygon"];class Gs{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?cl[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=ui.parse(e)),r}}class is{constructor(e,r,a=[],l,d=new Jt,f=[]){this.registry=e,this.path=a,this.key=a.map(g=>`[${g}]`).join(""),this.scope=d,this.errors=f,this.expectedType=l,this._isConstant=r}parse(e,r,a,l,d={}){return r?this.concat(r,a,l)._parse(e,d):this._parse(e,d)}_parse(e,r){function a(l,d,f){return f==="assert"?new Zr(d,[l]):f==="coerce"?new Mn(d,[l]):l}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const l=e[0];if(typeof l!="string")return this.error(`Expression name must be a string, but found ${typeof l} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const d=this.registry[l];if(d){let f=d.parse(e,this);if(!f)return null;if(this.expectedType){const g=this.expectedType,v=f.type;if(g.kind!=="string"&&g.kind!=="number"&&g.kind!=="boolean"&&g.kind!=="object"&&g.kind!=="array"||v.kind!=="value")if(g.kind!=="color"&&g.kind!=="formatted"&&g.kind!=="resolvedImage"||v.kind!=="value"&&v.kind!=="string")if(g.kind!=="padding"||v.kind!=="value"&&v.kind!=="number"&&v.kind!=="array")if(g.kind!=="variableAnchorOffsetCollection"||v.kind!=="value"&&v.kind!=="array"){if(this.checkSubtype(g,v))return null}else f=a(f,g,r.typeAnnotation||"coerce");else f=a(f,g,r.typeAnnotation||"coerce");else f=a(f,g,r.typeAnnotation||"coerce");else f=a(f,g,r.typeAnnotation||"assert")}if(!(f instanceof Vn)&&f.type.kind!=="resolvedImage"&&this._isConstant(f)){const g=new Gs;try{f=new Vn(f.type,f.evaluate(g))}catch(v){return this.error(v.message),null}}return f}return this.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,a){const l=typeof e=="number"?this.path.concat(e):this.path,d=a?this.scope.concat(a):this.scope;return new is(this.registry,this._isConstant,l,r||null,d,this.errors)}error(e,...r){const a=`${this.key}${r.map(l=>`[${l}]`).join("")}`;this.errors.push(new wt(a,e))}checkSubtype(e,r){const a=re(e,r);return a&&this.error(a),a}}class rs{constructor(e,r,a){this.type=qr,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const a=e[1];if(typeof a!="object"||Array.isArray(a))return r.error("Collator options argument must be an object.");const l=r.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,yt);if(!l)return null;const d=r.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,yt);if(!d)return null;let f=null;return a.locale&&(f=r.parse(a.locale,1,mt),!f)?null:new rs(l,d,f)}evaluate(e){return new Us(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}const An=8192;function Zs(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function Ea(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function ul(i,e){const r=(180+i[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,l=Math.pow(2,e.z);return[Math.round(r*l*An),Math.round(a*l*An)]}function Mc(i,e,r){const a=i[0]-e[0],l=i[1]-e[1],d=i[0]-r[0],f=i[1]-r[1];return a*f-d*l==0&&a*d<=0&&l*f<=0}function Hs(i,e){let r=!1;for(let f=0,g=e.length;f<g;f++){const v=e[f];for(let S=0,I=v.length;S<I-1;S++){if(Mc(i,v[S],v[S+1]))return!1;(l=v[S])[1]>(a=i)[1]!=(d=v[S+1])[1]>a[1]&&a[0]<(d[0]-l[0])*(a[1]-l[1])/(d[1]-l[1])+l[0]&&(r=!r)}}var a,l,d;return r}function Ws(i,e){for(let r=0;r<e.length;r++)if(Hs(i,e[r]))return!0;return!1}function hl(i,e,r,a){const l=a[0]-r[0],d=a[1]-r[1],f=(i[0]-r[0])*d-l*(i[1]-r[1]),g=(e[0]-r[0])*d-l*(e[1]-r[1]);return f>0&&g<0||f<0&&g>0}function Ac(i,e,r){for(const S of r)for(let I=0;I<S.length-1;++I)if((g=[(f=S[I+1])[0]-(d=S[I])[0],f[1]-d[1]])[0]*(v=[(l=e)[0]-(a=i)[0],l[1]-a[1]])[1]-g[1]*v[0]!=0&&hl(a,l,d,f)&&hl(d,f,a,l))return!0;var a,l,d,f,g,v;return!1}function dl(i,e){for(let r=0;r<i.length;++r)if(!Hs(i[r],e))return!1;for(let r=0;r<i.length-1;++r)if(Ac(i[r],i[r+1],e))return!1;return!0}function pl(i,e){for(let r=0;r<e.length;r++)if(dl(i,e[r]))return!0;return!1}function ns(i,e,r){const a=[];for(let l=0;l<i.length;l++){const d=[];for(let f=0;f<i[l].length;f++){const g=ul(i[l][f],r);Zs(e,g),d.push(g)}a.push(d)}return a}function fl(i,e,r){const a=[];for(let l=0;l<i.length;l++){const d=ns(i[l],e,r);a.push(d)}return a}function ml(i,e,r,a){if(i[0]<r[0]||i[0]>r[2]){const l=.5*a;let d=i[0]-r[0]>l?-a:r[0]-i[0]>l?a:0;d===0&&(d=i[0]-r[2]>l?-a:r[2]-i[0]>l?a:0),i[0]+=d}Zs(e,i)}function Xs(i,e,r,a){const l=Math.pow(2,a.z)*An,d=[a.x*An,a.y*An],f=[];for(const g of i)for(const v of g){const S=[v.x+d[0],v.y+d[1]];ml(S,e,r,l),f.push(S)}return f}function Ks(i,e,r,a){const l=Math.pow(2,a.z)*An,d=[a.x*An,a.y*An],f=[];for(const v of i){const S=[];for(const I of v){const M=[I.x+d[0],I.y+d[1]];Zs(e,M),S.push(M)}f.push(S)}if(e[2]-e[0]<=l/2){(g=e)[0]=g[1]=1/0,g[2]=g[3]=-1/0;for(const v of f)for(const S of v)ml(S,e,r,l)}var g;return f}class Un{constructor(e,r){this.type=yt,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(aa(e[1])){const a=e[1];if(a.type==="FeatureCollection")for(let l=0;l<a.features.length;++l){const d=a.features[l].geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new Un(a,a.features[l].geometry)}else if(a.type==="Feature"){const l=a.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new Un(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new Un(a,a)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,a){const l=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],f=r.canonicalID();if(a.type==="Polygon"){const g=ns(a.coordinates,d,f),v=Xs(r.geometry(),l,d,f);if(!Ea(l,d))return!1;for(const S of v)if(!Hs(S,g))return!1}if(a.type==="MultiPolygon"){const g=fl(a.coordinates,d,f),v=Xs(r.geometry(),l,d,f);if(!Ea(l,d))return!1;for(const S of v)if(!Ws(S,g))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,a){const l=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],f=r.canonicalID();if(a.type==="Polygon"){const g=ns(a.coordinates,d,f),v=Ks(r.geometry(),l,d,f);if(!Ea(l,d))return!1;for(const S of v)if(!dl(S,g))return!1}if(a.type==="MultiPolygon"){const g=fl(a.coordinates,d,f),v=Ks(r.geometry(),l,d,f);if(!Ea(l,d))return!1;for(const S of v)if(!pl(S,g))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class as{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const a=e[1];return r.scope.has(a)?new as(a,r.scope.get(a)):r.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class Hr{constructor(e,r,a,l){this.name=e,this.type=r,this._evaluate=a,this.args=l}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,r){const a=e[0],l=Hr.definitions[a];if(!l)return r.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const d=Array.isArray(l)?l[0]:l.type,f=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,g=f.filter(([S])=>!Array.isArray(S)||S.length===e.length-1);let v=null;for(const[S,I]of g){v=new is(r.registry,ss,r.path,null,r.scope);const M=[];let D=!1;for(let $=1;$<e.length;$++){const O=e[$],U=Array.isArray(S)?S[$-1]:S.type,X=v.parse(O,1+M.length,U);if(!X){D=!0;break}M.push(X)}if(!D)if(Array.isArray(S)&&S.length!==M.length)v.error(`Expected ${S.length} arguments, but found ${M.length} instead.`);else{for(let $=0;$<M.length;$++){const O=Array.isArray(S)?S[$]:S.type,U=M[$];v.concat($+1).checkSubtype(O,U.type)}if(v.errors.length===0)return new Hr(a,d,I,M)}}if(g.length===1)r.errors.push(...v.errors);else{const S=(g.length?g:f).map(([M])=>{return D=M,Array.isArray(D)?`(${D.map(Y).join(", ")})`:`(${Y(D.type)}...)`;var D}).join(" | "),I=[];for(let M=1;M<e.length;M++){const D=r.parse(e[M],1+I.length);if(!D)return null;I.push(Y(D.type))}r.error(`Expected arguments of type ${S}, but found (${I.join(", ")}) instead.`)}return null}static register(e,r){Hr.definitions=r;for(const a in r)e[a]=Hr}}function ss(i){if(i instanceof as)return ss(i.boundExpression);if(i instanceof Hr&&i.name==="error"||i instanceof rs||i instanceof Un)return!1;const e=i instanceof Mn||i instanceof Zr;let r=!0;return i.eachChild(a=>{r=e?r&&ss(a):r&&a instanceof Vn}),!!r&&os(i)&&ls(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function os(i){if(i instanceof Hr&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Un)return!1;let e=!0;return i.eachChild(r=>{e&&!os(r)&&(e=!1)}),e}function Pa(i){if(i instanceof Hr&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(r=>{e&&!Pa(r)&&(e=!1)}),e}function ls(i,e){if(i instanceof Hr&&e.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(a=>{r&&!ls(a,e)&&(r=!1)}),r}function sa(i,e){const r=i.length-1;let a,l,d=0,f=r,g=0;for(;d<=f;)if(g=Math.floor((d+f)/2),a=i[g],l=i[g+1],a<=e){if(g===r||e<l)return g;d=g+1}else{if(!(a>e))throw new Ai("Input is not a number.");f=g-1}return 0}class kn{constructor(e,r,a){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[l,d]of a)this.labels.push(l),this.outputs.push(d)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const a=r.parse(e[1],1,ze);if(!a)return null;const l=[];let d=null;r.expectedType&&r.expectedType.kind!=="value"&&(d=r.expectedType);for(let f=1;f<e.length;f+=2){const g=f===1?-1/0:e[f],v=e[f+1],S=f,I=f+1;if(typeof g!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(l.length&&l[l.length-1][0]>=g)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',S);const M=r.parse(v,I,d);if(!M)return null;d=d||M.type,l.push([g,M])}return new kn(d,a,l)}evaluate(e){const r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(e);const l=this.input.evaluate(e);if(l<=r[0])return a[0].evaluate(e);const d=r.length;return l>=r[d-1]?a[d-1].evaluate(e):a[sa(r,l)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Xt(i,e,r){return i+r*(e-i)}function cs(i,e,r){return i.map((a,l)=>Xt(a,e[l],r))}const Dr={number:Xt,color:function(i,e,r,a="rgb"){switch(a){case"rgb":{const[l,d,f,g]=cs(i.rgb,e.rgb,r);return new ui(l,d,f,g,!1)}case"hcl":{const[l,d,f,g]=i.hcl,[v,S,I,M]=e.hcl;let D,$;if(isNaN(l)||isNaN(v))isNaN(l)?isNaN(v)?D=NaN:(D=v,f!==1&&f!==0||($=S)):(D=l,I!==1&&I!==0||($=d));else{let le=v-l;v>l&&le>180?le-=360:v<l&&l-v>180&&(le+=360),D=l+r*le}const[O,U,X,ee]=function([le,ie,ue,pe]){return le=isNaN(le)?0:le*Ye,ci([ue,Math.cos(le)*ie,Math.sin(le)*ie,pe])}([D,$??Xt(d,S,r),Xt(f,I,r),Xt(g,M,r)]);return new ui(O,U,X,ee,!1)}case"lab":{const[l,d,f,g]=ci(cs(i.lab,e.lab,r));return new ui(l,d,f,g,!1)}}},array:cs,padding:function(i,e,r){return new zr(cs(i.values,e.values,r))},variableAnchorOffsetCollection:function(i,e,r){const a=i.values,l=e.values;if(a.length!==l.length)throw new Ai(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${e.toString()}`);const d=[];for(let f=0;f<a.length;f+=2){if(a[f]!==l[f])throw new Ai(`Cannot interpolate values containing mismatched anchors. from[${f}]: ${a[f]}, to[${f}]: ${l[f]}`);d.push(a[f]);const[g,v]=a[f+1],[S,I]=l[f+1];d.push([Xt(g,S,r),Xt(v,I,r)])}return new Gr(d)}};class Lr{constructor(e,r,a,l,d){this.type=e,this.operator=r,this.interpolation=a,this.input=l,this.labels=[],this.outputs=[];for(const[f,g]of d)this.labels.push(f),this.outputs.push(g)}static interpolationFactor(e,r,a,l){let d=0;if(e.name==="exponential")d=Ys(r,e.base,a,l);else if(e.name==="linear")d=Ys(r,1,a,l);else if(e.name==="cubic-bezier"){const f=e.controlPoints;d=new be(f[0],f[1],f[2],f[3]).solve(Ys(r,1,a,l))}return d}static parse(e,r){let[a,l,d,...f]=e;if(!Array.isArray(l)||l.length===0)return r.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){const S=l[1];if(typeof S!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:S}}else{if(l[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(l[0])}`,1,0);{const S=l.slice(1);if(S.length!==4||S.some(I=>typeof I!="number"||I<0||I>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:S}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(d=r.parse(d,2,ze),!d)return null;const g=[];let v=null;a==="interpolate-hcl"||a==="interpolate-lab"?v=wi:r.expectedType&&r.expectedType.kind!=="value"&&(v=r.expectedType);for(let S=0;S<f.length;S+=2){const I=f[S],M=f[S+1],D=S+3,$=S+4;if(typeof I!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(g.length&&g[g.length-1][0]>=I)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',D);const O=r.parse(M,$,v);if(!O)return null;v=v||O.type,g.push([I,O])}return Ce(v,ze)||Ce(v,wi)||Ce(v,z)||Ce(v,N)||Ce(v,W(ze))?new Lr(v,a,l,d,g):r.error(`Type ${Y(v)} is not interpolatable.`)}evaluate(e){const r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(e);const l=this.input.evaluate(e);if(l<=r[0])return a[0].evaluate(e);const d=r.length;if(l>=r[d-1])return a[d-1].evaluate(e);const f=sa(r,l),g=Lr.interpolationFactor(this.interpolation,l,r[f],r[f+1]),v=a[f].evaluate(e),S=a[f+1].evaluate(e);switch(this.operator){case"interpolate":return Dr[this.type.kind](v,S,g);case"interpolate-hcl":return Dr.color(v,S,g,"hcl");case"interpolate-lab":return Dr.color(v,S,g,"lab")}}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Ys(i,e,r,a){const l=a-r,d=i-r;return l===0?0:e===1?d/l:(Math.pow(e,d)-1)/(Math.pow(e,l)-1)}class us{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let a=null;const l=r.expectedType;l&&l.kind!=="value"&&(a=l);const d=[];for(const g of e.slice(1)){const v=r.parse(g,1+d.length,a,void 0,{typeAnnotation:"omit"});if(!v)return null;a=a||v.type,d.push(v)}if(!a)throw new Error("No output type");const f=l&&d.some(g=>re(l,g.type));return new us(f?Mt:a,d)}evaluate(e){let r,a=null,l=0;for(const d of this.args)if(l++,a=d.evaluate(e),a&&a instanceof or&&!a.available&&(r||(r=a.name),a=null,l===this.args.length&&(a=r)),a!==null)break;return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class hs{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let d=1;d<e.length-1;d+=2){const f=e[d];if(typeof f!="string")return r.error(`Expected string, but found ${typeof f} instead.`,d);if(/[^a-zA-Z0-9_]/.test(f))return r.error("Variable names must contain only alphanumeric characters or '_'.",d);const g=r.parse(e[d+1],d+1);if(!g)return null;a.push([f,g])}const l=r.parse(e[e.length-1],e.length-1,r.expectedType,a);return l?new hs(a,l):null}outputDefined(){return this.result.outputDefined()}}class Js{constructor(e,r,a){this.type=e,this.index=r,this.input=a}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,ze),l=r.parse(e[2],2,W(r.expectedType||Mt));return a&&l?new Js(l.type.itemType,a,l):null}evaluate(e){const r=this.index.evaluate(e),a=this.input.evaluate(e);if(r<0)throw new Ai(`Array index out of bounds: ${r} < 0.`);if(r>=a.length)throw new Ai(`Array index out of bounds: ${r} > ${a.length-1}.`);if(r!==Math.floor(r))throw new Ai(`Array index must be an integer, but found ${r} instead.`);return a[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class Qs{constructor(e,r){this.type=yt,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,Mt),l=r.parse(e[2],2,Mt);return a&&l?Q(a.type,[yt,mt,ze,zt,Mt])?new Qs(a,l):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Y(a.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!a)return!1;if(!se(r,["boolean","string","number","null"]))throw new Ai(`Expected first argument to be of type boolean, string, number or null, but found ${Y(Ti(r))} instead.`);if(!se(a,["string","array"]))throw new Ai(`Expected second argument to be of type array or string, but found ${Y(Ti(a))} instead.`);return a.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class ds{constructor(e,r,a){this.type=ze,this.needle=e,this.haystack=r,this.fromIndex=a}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,Mt),l=r.parse(e[2],2,Mt);if(!a||!l)return null;if(!Q(a.type,[yt,mt,ze,zt,Mt]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Y(a.type)} instead`);if(e.length===4){const d=r.parse(e[3],3,ze);return d?new ds(a,l,d):null}return new ds(a,l)}evaluate(e){const r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!se(r,["boolean","string","number","null"]))throw new Ai(`Expected first argument to be of type boolean, string, number or null, but found ${Y(Ti(r))} instead.`);if(!se(a,["string","array"]))throw new Ai(`Expected second argument to be of type array or string, but found ${Y(Ti(a))} instead.`);if(this.fromIndex){const l=this.fromIndex.evaluate(e);return a.indexOf(r,l)}return a.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class eo{constructor(e,r,a,l,d,f){this.inputType=e,this.type=r,this.input=a,this.cases=l,this.outputs=d,this.otherwise=f}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let a,l;r.expectedType&&r.expectedType.kind!=="value"&&(l=r.expectedType);const d={},f=[];for(let S=2;S<e.length-1;S+=2){let I=e[S];const M=e[S+1];Array.isArray(I)||(I=[I]);const D=r.concat(S);if(I.length===0)return D.error("Expected at least one branch label.");for(const O of I){if(typeof O!="number"&&typeof O!="string")return D.error("Branch labels must be numbers or strings.");if(typeof O=="number"&&Math.abs(O)>Number.MAX_SAFE_INTEGER)return D.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof O=="number"&&Math.floor(O)!==O)return D.error("Numeric branch labels must be integer values.");if(a){if(D.checkSubtype(a,Ti(O)))return null}else a=Ti(O);if(d[String(O)]!==void 0)return D.error("Branch labels must be unique.");d[String(O)]=f.length}const $=r.parse(M,S,l);if(!$)return null;l=l||$.type,f.push($)}const g=r.parse(e[1],1,Mt);if(!g)return null;const v=r.parse(e[e.length-1],e.length-1,l);return v?g.type.kind!=="value"&&r.concat(1).checkSubtype(a,g.type)?null:new eo(a,l,g,d,f,v):null}evaluate(e){const r=this.input.evaluate(e);return(Ti(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class to{constructor(e,r,a){this.type=e,this.branches=r,this.otherwise=a}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let a;r.expectedType&&r.expectedType.kind!=="value"&&(a=r.expectedType);const l=[];for(let f=1;f<e.length-1;f+=2){const g=r.parse(e[f],f,yt);if(!g)return null;const v=r.parse(e[f+1],f+1,a);if(!v)return null;l.push([g,v]),a=a||v.type}const d=r.parse(e[e.length-1],e.length-1,a);if(!d)return null;if(!a)throw new Error("Can't infer output type");return new to(a,l,d)}evaluate(e){for(const[r,a]of this.branches)if(r.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,a]of this.branches)e(r),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class ps{constructor(e,r,a,l){this.type=e,this.input=r,this.beginIndex=a,this.endIndex=l}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,Mt),l=r.parse(e[2],2,ze);if(!a||!l)return null;if(!Q(a.type,[W(Mt),mt,Mt]))return r.error(`Expected first argument to be of type array or string, but found ${Y(a.type)} instead`);if(e.length===4){const d=r.parse(e[3],3,ze);return d?new ps(a.type,a,l,d):null}return new ps(a.type,a,l)}evaluate(e){const r=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!se(r,["string","array"]))throw new Ai(`Expected first argument to be of type array or string, but found ${Y(Ti(r))} instead.`);if(this.endIndex){const l=this.endIndex.evaluate(e);return r.slice(a,l)}return r.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function gl(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function _l(i,e,r,a){return a.compare(e,r)===0}function oa(i,e,r){const a=i!=="=="&&i!=="!=";return class Zf{constructor(d,f,g){this.type=yt,this.lhs=d,this.rhs=f,this.collator=g,this.hasUntypedArgument=d.type.kind==="value"||f.type.kind==="value"}static parse(d,f){if(d.length!==3&&d.length!==4)return f.error("Expected two or three arguments.");const g=d[0];let v=f.parse(d[1],1,Mt);if(!v)return null;if(!gl(g,v.type))return f.concat(1).error(`"${g}" comparisons are not supported for type '${Y(v.type)}'.`);let S=f.parse(d[2],2,Mt);if(!S)return null;if(!gl(g,S.type))return f.concat(2).error(`"${g}" comparisons are not supported for type '${Y(S.type)}'.`);if(v.type.kind!==S.type.kind&&v.type.kind!=="value"&&S.type.kind!=="value")return f.error(`Cannot compare types '${Y(v.type)}' and '${Y(S.type)}'.`);a&&(v.type.kind==="value"&&S.type.kind!=="value"?v=new Zr(S.type,[v]):v.type.kind!=="value"&&S.type.kind==="value"&&(S=new Zr(v.type,[S])));let I=null;if(d.length===4){if(v.type.kind!=="string"&&S.type.kind!=="string"&&v.type.kind!=="value"&&S.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(I=f.parse(d[3],3,qr),!I)return null}return new Zf(v,S,I)}evaluate(d){const f=this.lhs.evaluate(d),g=this.rhs.evaluate(d);if(a&&this.hasUntypedArgument){const v=Ti(f),S=Ti(g);if(v.kind!==S.kind||v.kind!=="string"&&v.kind!=="number")throw new Ai(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${v.kind}, ${S.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const v=Ti(f),S=Ti(g);if(v.kind!=="string"||S.kind!=="string")return e(d,f,g)}return this.collator?r(d,f,g,this.collator.evaluate(d)):e(d,f,g)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}}}const kc=oa("==",function(i,e,r){return e===r},_l),zc=oa("!=",function(i,e,r){return e!==r},function(i,e,r,a){return!_l(0,e,r,a)}),Dc=oa("<",function(i,e,r){return e<r},function(i,e,r,a){return a.compare(e,r)<0}),Lc=oa(">",function(i,e,r){return e>r},function(i,e,r,a){return a.compare(e,r)>0}),Rc=oa("<=",function(i,e,r){return e<=r},function(i,e,r,a){return a.compare(e,r)<=0}),Bc=oa(">=",function(i,e,r){return e>=r},function(i,e,r,a){return a.compare(e,r)>=0});class io{constructor(e,r,a,l,d){this.type=mt,this.number=e,this.locale=r,this.currency=a,this.minFractionDigits=l,this.maxFractionDigits=d}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const a=r.parse(e[1],1,ze);if(!a)return null;const l=e[2];if(typeof l!="object"||Array.isArray(l))return r.error("NumberFormat options argument must be an object.");let d=null;if(l.locale&&(d=r.parse(l.locale,1,mt),!d))return null;let f=null;if(l.currency&&(f=r.parse(l.currency,1,mt),!f))return null;let g=null;if(l["min-fraction-digits"]&&(g=r.parse(l["min-fraction-digits"],1,ze),!g))return null;let v=null;return l["max-fraction-digits"]&&(v=r.parse(l["max-fraction-digits"],1,ze),!v)?null:new io(a,d,f,g,v)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class fs{constructor(e){this.type=Z,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&typeof a=="object")return r.error("First argument must be an image or text section.");const l=[];let d=!1;for(let f=1;f<=e.length-1;++f){const g=e[f];if(d&&typeof g=="object"&&!Array.isArray(g)){d=!1;let v=null;if(g["font-scale"]&&(v=r.parse(g["font-scale"],1,ze),!v))return null;let S=null;if(g["text-font"]&&(S=r.parse(g["text-font"],1,W(mt)),!S))return null;let I=null;if(g["text-color"]&&(I=r.parse(g["text-color"],1,wi),!I))return null;const M=l[l.length-1];M.scale=v,M.font=S,M.textColor=I}else{const v=r.parse(e[f],1,Mt);if(!v)return null;const S=v.type.kind;if(S!=="string"&&S!=="value"&&S!=="null"&&S!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,l.push({content:v,scale:null,font:null,textColor:null})}}return new fs(l)}evaluate(e){return new hr(this.sections.map(r=>{const a=r.content.evaluate(e);return Ti(a)===R?new Qa("",a,null,null,null):new Qa(ni(a),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}}class ro{constructor(e){this.type=R,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const a=r.parse(e[1],1,mt);return a?new ro(a):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),a=or.fromString(r);return a&&e.availableImages&&(a.available=e.availableImages.indexOf(r)>-1),a}eachChild(e){e(this.input)}outputDefined(){return!1}}class no{constructor(e){this.type=ze,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=r.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${Y(a.type)} instead.`):new no(a):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new Ai(`Expected value to be of type string or array, but found ${Y(Ti(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const la={"==":kc,"!=":zc,">":Lc,"<":Dc,">=":Bc,"<=":Rc,array:Zr,at:Js,boolean:Zr,case:to,coalesce:us,collator:rs,format:fs,image:ro,in:Qs,"index-of":ds,interpolate:Lr,"interpolate-hcl":Lr,"interpolate-lab":Lr,length:no,let:hs,literal:Vn,match:eo,number:Zr,"number-format":io,object:Zr,slice:ps,step:kn,string:Zr,"to-boolean":Mn,"to-color":Mn,"to-number":Mn,"to-string":Mn,var:as,within:Un};function yl(i,[e,r,a,l]){e=e.evaluate(i),r=r.evaluate(i),a=a.evaluate(i);const d=l?l.evaluate(i):1,f=es(e,r,a,d);if(f)throw new Ai(f);return new ui(e/255,r/255,a/255,d,!1)}function vl(i,e){return i in e}function ao(i,e){const r=e[i];return r===void 0?null:r}function qn(i){return{type:i}}function xl(i){return{result:"success",value:i}}function zn(i){return{result:"error",value:i}}function ca(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function bl(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function so(i){return!!i.expression&&i.expression.interpolated}function ai(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Ii(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function Fc(i){return i}function Kt(i,e){const r=e.type==="color",a=i.stops&&typeof i.stops[0][0]=="object",l=a||!(a||i.property!==void 0),d=i.type||(so(e)?"exponential":"interval");if(r||e.type==="padding"){const I=r?ui.parse:zr.parse;(i=It({},i)).stops&&(i.stops=i.stops.map(M=>[M[0],I(M[1])])),i.default=I(i.default?i.default:e.default)}if(i.colorSpace&&(f=i.colorSpace)!=="rgb"&&f!=="hcl"&&f!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var f;let g,v,S;if(d==="exponential")g=Ma;else if(d==="interval")g=Si;else if(d==="categorical"){g=Ei,v=Object.create(null);for(const I of i.stops)v[I[0]]=I[1];S=typeof i.stops[0][0]}else{if(d!=="identity")throw new Error(`Unknown function type "${d}"`);g=wl}if(a){const I={},M=[];for(let O=0;O<i.stops.length;O++){const U=i.stops[O],X=U[0].zoom;I[X]===void 0&&(I[X]={zoom:X,type:i.type,property:i.property,default:i.default,stops:[]},M.push(X)),I[X].stops.push([U[0].value,U[1]])}const D=[];for(const O of M)D.push([I[O].zoom,Kt(I[O],e)]);const $={name:"linear"};return{kind:"composite",interpolationType:$,interpolationFactor:Lr.interpolationFactor.bind(void 0,$),zoomStops:D.map(O=>O[0]),evaluate:({zoom:O},U)=>Ma({stops:D,base:i.base},e,O).evaluate(O,U)}}if(l){const I=d==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:I,interpolationFactor:Lr.interpolationFactor.bind(void 0,I),zoomStops:i.stops.map(M=>M[0]),evaluate:({zoom:M})=>g(i,e,M,v,S)}}return{kind:"source",evaluate(I,M){const D=M&&M.properties?M.properties[i.property]:void 0;return D===void 0?Gn(i.default,e.default):g(i,e,D,v,S)}}}function Gn(i,e,r){return i!==void 0?i:e!==void 0?e:r!==void 0?r:void 0}function Ei(i,e,r,a,l){return Gn(typeof r===l?a[r]:void 0,i.default,e.default)}function Si(i,e,r){if(ai(r)!=="number")return Gn(i.default,e.default);const a=i.stops.length;if(a===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[a-1][0])return i.stops[a-1][1];const l=sa(i.stops.map(d=>d[0]),r);return i.stops[l][1]}function Ma(i,e,r){const a=i.base!==void 0?i.base:1;if(ai(r)!=="number")return Gn(i.default,e.default);const l=i.stops.length;if(l===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[l-1][0])return i.stops[l-1][1];const d=sa(i.stops.map(I=>I[0]),r),f=function(I,M,D,$){const O=$-D,U=I-D;return O===0?0:M===1?U/O:(Math.pow(M,U)-1)/(Math.pow(M,O)-1)}(r,a,i.stops[d][0],i.stops[d+1][0]),g=i.stops[d][1],v=i.stops[d+1][1],S=Dr[e.type]||Fc;return typeof g.evaluate=="function"?{evaluate(...I){const M=g.evaluate.apply(void 0,I),D=v.evaluate.apply(void 0,I);if(M!==void 0&&D!==void 0)return S(M,D,f,i.colorSpace)}}:S(g,v,f,i.colorSpace)}function wl(i,e,r){switch(e.type){case"color":r=ui.parse(r);break;case"formatted":r=hr.fromString(r.toString());break;case"resolvedImage":r=or.fromString(r.toString());break;case"padding":r=zr.parse(r);break;default:ai(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0)}return Gn(r,i.default,e.default)}Hr.register(la,{error:[{kind:"error"},[mt],(i,[e])=>{throw new Ai(e.evaluate(i))}],typeof:[mt,[Mt],(i,[e])=>Y(Ti(e.evaluate(i)))],"to-rgba":[W(ze,4),[wi],(i,[e])=>{const[r,a,l,d]=e.evaluate(i).rgb;return[255*r,255*a,255*l,d]}],rgb:[wi,[ze,ze,ze],yl],rgba:[wi,[ze,ze,ze,ze],yl],has:{type:yt,overloads:[[[mt],(i,[e])=>vl(e.evaluate(i),i.properties())],[[mt,Zi],(i,[e,r])=>vl(e.evaluate(i),r.evaluate(i))]]},get:{type:Mt,overloads:[[[mt],(i,[e])=>ao(e.evaluate(i),i.properties())],[[mt,Zi],(i,[e,r])=>ao(e.evaluate(i),r.evaluate(i))]]},"feature-state":[Mt,[mt],(i,[e])=>ao(e.evaluate(i),i.featureState||{})],properties:[Zi,[],i=>i.properties()],"geometry-type":[mt,[],i=>i.geometryType()],id:[Mt,[],i=>i.id()],zoom:[ze,[],i=>i.globals.zoom],"heatmap-density":[ze,[],i=>i.globals.heatmapDensity||0],"line-progress":[ze,[],i=>i.globals.lineProgress||0],accumulated:[Mt,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[ze,qn(ze),(i,e)=>{let r=0;for(const a of e)r+=a.evaluate(i);return r}],"*":[ze,qn(ze),(i,e)=>{let r=1;for(const a of e)r*=a.evaluate(i);return r}],"-":{type:ze,overloads:[[[ze,ze],(i,[e,r])=>e.evaluate(i)-r.evaluate(i)],[[ze],(i,[e])=>-e.evaluate(i)]]},"/":[ze,[ze,ze],(i,[e,r])=>e.evaluate(i)/r.evaluate(i)],"%":[ze,[ze,ze],(i,[e,r])=>e.evaluate(i)%r.evaluate(i)],ln2:[ze,[],()=>Math.LN2],pi:[ze,[],()=>Math.PI],e:[ze,[],()=>Math.E],"^":[ze,[ze,ze],(i,[e,r])=>Math.pow(e.evaluate(i),r.evaluate(i))],sqrt:[ze,[ze],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[ze,[ze],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[ze,[ze],(i,[e])=>Math.log(e.evaluate(i))],log2:[ze,[ze],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[ze,[ze],(i,[e])=>Math.sin(e.evaluate(i))],cos:[ze,[ze],(i,[e])=>Math.cos(e.evaluate(i))],tan:[ze,[ze],(i,[e])=>Math.tan(e.evaluate(i))],asin:[ze,[ze],(i,[e])=>Math.asin(e.evaluate(i))],acos:[ze,[ze],(i,[e])=>Math.acos(e.evaluate(i))],atan:[ze,[ze],(i,[e])=>Math.atan(e.evaluate(i))],min:[ze,qn(ze),(i,e)=>Math.min(...e.map(r=>r.evaluate(i)))],max:[ze,qn(ze),(i,e)=>Math.max(...e.map(r=>r.evaluate(i)))],abs:[ze,[ze],(i,[e])=>Math.abs(e.evaluate(i))],round:[ze,[ze],(i,[e])=>{const r=e.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[ze,[ze],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[ze,[ze],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[yt,[mt,Mt],(i,[e,r])=>i.properties()[e.value]===r.value],"filter-id-==":[yt,[Mt],(i,[e])=>i.id()===e.value],"filter-type-==":[yt,[mt],(i,[e])=>i.geometryType()===e.value],"filter-<":[yt,[mt,Mt],(i,[e,r])=>{const a=i.properties()[e.value],l=r.value;return typeof a==typeof l&&a<l}],"filter-id-<":[yt,[Mt],(i,[e])=>{const r=i.id(),a=e.value;return typeof r==typeof a&&r<a}],"filter->":[yt,[mt,Mt],(i,[e,r])=>{const a=i.properties()[e.value],l=r.value;return typeof a==typeof l&&a>l}],"filter-id->":[yt,[Mt],(i,[e])=>{const r=i.id(),a=e.value;return typeof r==typeof a&&r>a}],"filter-<=":[yt,[mt,Mt],(i,[e,r])=>{const a=i.properties()[e.value],l=r.value;return typeof a==typeof l&&a<=l}],"filter-id-<=":[yt,[Mt],(i,[e])=>{const r=i.id(),a=e.value;return typeof r==typeof a&&r<=a}],"filter->=":[yt,[mt,Mt],(i,[e,r])=>{const a=i.properties()[e.value],l=r.value;return typeof a==typeof l&&a>=l}],"filter-id->=":[yt,[Mt],(i,[e])=>{const r=i.id(),a=e.value;return typeof r==typeof a&&r>=a}],"filter-has":[yt,[Mt],(i,[e])=>e.value in i.properties()],"filter-has-id":[yt,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[yt,[W(mt)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[yt,[W(Mt)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[yt,[mt,W(Mt)],(i,[e,r])=>r.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[yt,[mt,W(Mt)],(i,[e,r])=>function(a,l,d,f){for(;d<=f;){const g=d+f>>1;if(l[g]===a)return!0;l[g]>a?f=g-1:d=g+1}return!1}(i.properties()[e.value],r.value,0,r.value.length-1)],all:{type:yt,overloads:[[[yt,yt],(i,[e,r])=>e.evaluate(i)&&r.evaluate(i)],[qn(yt),(i,e)=>{for(const r of e)if(!r.evaluate(i))return!1;return!0}]]},any:{type:yt,overloads:[[[yt,yt],(i,[e,r])=>e.evaluate(i)||r.evaluate(i)],[qn(yt),(i,e)=>{for(const r of e)if(r.evaluate(i))return!0;return!1}]]},"!":[yt,[yt],(i,[e])=>!e.evaluate(i)],"is-supported-script":[yt,[mt],(i,[e])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(e.evaluate(i))}],upcase:[mt,[mt],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[mt,[mt],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[mt,qn(Mt),(i,e)=>e.map(r=>ni(r.evaluate(i))).join("")],"resolved-locale":[mt,[qr],(i,[e])=>e.evaluate(i).resolvedLocale()]});class oo{constructor(e,r){var a;this.expression=e,this._warningHistory={},this._evaluator=new Gs,this._defaultValue=r?(a=r).type==="color"&&Ii(a.default)?new ui(0,0,0,0):a.type==="color"?ui.parse(a.default)||null:a.type==="padding"?zr.parse(a.default)||null:a.type==="variableAnchorOffsetCollection"?Gr.parse(a.default)||null:a.default===void 0?null:a.default:null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,a,l,d,f){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=a,this._evaluator.canonical=l,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=f,this.expression.evaluate(this._evaluator)}evaluate(e,r,a,l,d,f){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=a||null,this._evaluator.canonical=l,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=f||null;try{const g=this.expression.evaluate(this._evaluator);if(g==null||typeof g=="number"&&g!=g)return this._defaultValue;if(this._enumValues&&!(g in this._enumValues))throw new Ai(`Expected value to be one of ${Object.keys(this._enumValues).map(v=>JSON.stringify(v)).join(", ")}, but found ${JSON.stringify(g)} instead.`);return g}catch(g){return this._warningHistory[g.message]||(this._warningHistory[g.message]=!0,typeof console<"u"&&console.warn(g.message)),this._defaultValue}}}function ms(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in la}function gs(i,e){const r=new is(la,ss,[],e?function(l){const d={color:wi,string:mt,number:ze,enum:mt,boolean:yt,formatted:Z,padding:z,resolvedImage:R,variableAnchorOffsetCollection:N};return l.type==="array"?W(d[l.value]||Mt,l.length):d[l.type]}(e):void 0),a=r.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?xl(new oo(a,e)):zn(r.errors)}class lo{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!Pa(r.expression)}evaluateWithoutErrorHandling(e,r,a,l,d,f){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,l,d,f)}evaluate(e,r,a,l,d,f){return this._styleExpression.evaluate(e,r,a,l,d,f)}}class _s{constructor(e,r,a,l){this.kind=e,this.zoomStops=a,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!Pa(r.expression),this.interpolationType=l}evaluateWithoutErrorHandling(e,r,a,l,d,f){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,l,d,f)}evaluate(e,r,a,l,d,f){return this._styleExpression.evaluate(e,r,a,l,d,f)}interpolationFactor(e,r,a){return this.interpolationType?Lr.interpolationFactor(this.interpolationType,e,r,a):0}}function co(i,e){const r=gs(i,e);if(r.result==="error")return r;const a=r.value.expression,l=os(a);if(!l&&!ca(e))return zn([new wt("","data expressions not supported")]);const d=ls(a,["zoom"]);if(!d&&!bl(e))return zn([new wt("","zoom expressions not supported")]);const f=ka(a);return f||d?f instanceof wt?zn([f]):f instanceof Lr&&!so(e)?zn([new wt("",'"interpolate" expressions cannot be used with this property')]):xl(f?new _s(l?"camera":"composite",r.value,f.labels,f instanceof Lr?f.interpolation:void 0):new lo(l?"constant":"source",r.value)):zn([new wt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Aa{constructor(e,r){this._parameters=e,this._specification=r,It(this,Kt(this._parameters,this._specification))}static deserialize(e){return new Aa(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function ka(i){let e=null;if(i instanceof hs)e=ka(i.result);else if(i instanceof us){for(const r of i.args)if(e=ka(r),e)break}else(i instanceof kn||i instanceof Lr)&&i.input instanceof Hr&&i.input.name==="zoom"&&(e=i);return e instanceof wt||i.eachChild(r=>{const a=ka(r);a instanceof wt?e=a:!e&&a?e=new wt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&a&&e!==a&&(e=new wt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function za(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!za(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const $c={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function uo(i){if(i==null)return{filter:()=>!0,needGeometry:!1};za(i)||(i=ys(i));const e=gs(i,$c);if(e.result==="error")throw new Error(e.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,a,l)=>e.value.evaluate(r,a,{},l),needGeometry:Sl(i)}}function Oc(i,e){return i<e?-1:i>e?1:0}function Sl(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(Sl(i[e]))return!0;return!1}function ys(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?ho(i[1],i[2],"=="):e==="!="?Da(ho(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?ho(i[1],i[2],e):e==="any"?(r=i.slice(1),["any"].concat(r.map(ys))):e==="all"?["all"].concat(i.slice(1).map(ys)):e==="none"?["all"].concat(i.slice(1).map(ys).map(Da)):e==="in"?Cl(i[1],i.slice(2)):e==="!in"?Da(Cl(i[1],i.slice(2))):e==="has"?Tl(i[1]):e==="!has"?Da(Tl(i[1])):e!=="within"||i;var r}function ho(i,e,r){switch(i){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,i,e]}}function Cl(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",i,["literal",e.sort(Oc)]]:["filter-in-small",i,["literal",e]]}}function Tl(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Da(i){return["!",i]}function vs(i){const e=typeof i;if(e==="number"||e==="boolean"||e==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let l="[";for(const d of i)l+=`${vs(d)},`;return`${l}]`}const r=Object.keys(i).sort();let a="{";for(let l=0;l<r.length;l++)a+=`${JSON.stringify(r[l])}:${vs(i[r[l]])},`;return`${a}}`}function xs(i){let e="";for(const r of bi)e+=`/${vs(i[r])}`;return e}function Il(i){const e=i.value;return e?[new je(i.key,e,"constants have been deprecated as of v8")]:[]}function ki(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Zn(i){if(Array.isArray(i))return i.map(Zn);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const r in i)e[r]=Zn(i[r]);return e}return ki(i)}function Cr(i){const e=i.key,r=i.value,a=i.valueSpec||{},l=i.objectElementValidators||{},d=i.style,f=i.styleSpec,g=i.validateSpec;let v=[];const S=ai(r);if(S!=="object")return[new je(e,r,`object expected, ${S} found`)];for(const I in r){const M=I.split(".")[0],D=a[M]||a["*"];let $;if(l[M])$=l[M];else if(a[M])$=g;else if(l["*"])$=l["*"];else{if(!a["*"]){v.push(new je(e,r[I],`unknown property "${I}"`));continue}$=g}v=v.concat($({key:(e&&`${e}.`)+I,value:r[I],valueSpec:D,style:d,styleSpec:f,object:r,objectKey:I,validateSpec:g},r))}for(const I in a)l[I]||a[I].required&&a[I].default===void 0&&r[I]===void 0&&v.push(new je(e,r,`missing required property "${I}"`));return v}function ua(i){const e=i.value,r=i.valueSpec,a=i.style,l=i.styleSpec,d=i.key,f=i.arrayElementValidator||i.validateSpec;if(ai(e)!=="array")return[new je(d,e,`array expected, ${ai(e)} found`)];if(r.length&&e.length!==r.length)return[new je(d,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new je(d,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let g={type:r.value,values:r.values};l.$version<7&&(g.function=r.function),ai(r.value)==="object"&&(g=r.value);let v=[];for(let S=0;S<e.length;S++)v=v.concat(f({array:e,arrayIndex:S,value:e[S],valueSpec:g,validateSpec:i.validateSpec,style:a,styleSpec:l,key:`${d}[${S}]`}));return v}function La(i){const e=i.key,r=i.value,a=i.valueSpec;let l=ai(r);return l==="number"&&r!=r&&(l="NaN"),l!=="number"?[new je(e,r,`number expected, ${l} found`)]:"minimum"in a&&r<a.minimum?[new je(e,r,`${r} is less than the minimum value ${a.minimum}`)]:"maximum"in a&&r>a.maximum?[new je(e,r,`${r} is greater than the maximum value ${a.maximum}`)]:[]}function bs(i){const e=i.valueSpec,r=ki(i.value.type);let a,l,d,f={};const g=r!=="categorical"&&i.value.property===void 0,v=!g,S=ai(i.value.stops)==="array"&&ai(i.value.stops[0])==="array"&&ai(i.value.stops[0][0])==="object",I=Cr({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function($){if(r==="identity")return[new je($.key,$.value,'identity function may not have a "stops" property')];let O=[];const U=$.value;return O=O.concat(ua({key:$.key,value:U,valueSpec:$.valueSpec,validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec,arrayElementValidator:M})),ai(U)==="array"&&U.length===0&&O.push(new je($.key,U,"array must have at least one stop")),O},default:function($){return $.validateSpec({key:$.key,value:$.value,valueSpec:e,validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec})}}});return r==="identity"&&g&&I.push(new je(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||I.push(new je(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!so(i.valueSpec)&&I.push(new je(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(v&&!ca(i.valueSpec)?I.push(new je(i.key,i.value,"property functions not supported")):g&&!bl(i.valueSpec)&&I.push(new je(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!S||i.value.property!==void 0||I.push(new je(i.key,i.value,'"property" property is required')),I;function M($){let O=[];const U=$.value,X=$.key;if(ai(U)!=="array")return[new je(X,U,`array expected, ${ai(U)} found`)];if(U.length!==2)return[new je(X,U,`array length 2 expected, length ${U.length} found`)];if(S){if(ai(U[0])!=="object")return[new je(X,U,`object expected, ${ai(U[0])} found`)];if(U[0].zoom===void 0)return[new je(X,U,"object stop key must have zoom")];if(U[0].value===void 0)return[new je(X,U,"object stop key must have value")];if(d&&d>ki(U[0].zoom))return[new je(X,U[0].zoom,"stop zoom values must appear in ascending order")];ki(U[0].zoom)!==d&&(d=ki(U[0].zoom),l=void 0,f={}),O=O.concat(Cr({key:`${X}[0]`,value:U[0],valueSpec:{zoom:{}},validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec,objectElementValidators:{zoom:La,value:D}}))}else O=O.concat(D({key:`${X}[0]`,value:U[0],valueSpec:{},validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec},U));return ms(Zn(U[1]))?O.concat([new je(`${X}[1]`,U[1],"expressions are not allowed in function stops.")]):O.concat($.validateSpec({key:`${X}[1]`,value:U[1],valueSpec:e,validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec}))}function D($,O){const U=ai($.value),X=ki($.value),ee=$.value!==null?$.value:O;if(a){if(U!==a)return[new je($.key,ee,`${U} stop domain type must match previous stop domain type ${a}`)]}else a=U;if(U!=="number"&&U!=="string"&&U!=="boolean")return[new je($.key,ee,"stop domain value must be a number, string, or boolean")];if(U!=="number"&&r!=="categorical"){let le=`number expected, ${U} found`;return ca(e)&&r===void 0&&(le+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new je($.key,ee,le)]}return r!=="categorical"||U!=="number"||isFinite(X)&&Math.floor(X)===X?r!=="categorical"&&U==="number"&&l!==void 0&&X<l?[new je($.key,ee,"stop domain values must appear in ascending order")]:(l=X,r==="categorical"&&X in f?[new je($.key,ee,"stop domain values must be unique")]:(f[X]=!0,[])):[new je($.key,ee,`integer expected, found ${X}`)]}}function Hn(i){const e=(i.expressionContext==="property"?co:gs)(Zn(i.value),i.valueSpec);if(e.result==="error")return e.value.map(a=>new je(`${i.key}${a.key}`,i.value,a.message));const r=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new je(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!Pa(r))return[new je(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!Pa(r))return[new je(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!ls(r,["zoom","feature-state"]))return[new je(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!os(r))return[new je(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ra(i){const e=i.key,r=i.value,a=i.valueSpec,l=[];return Array.isArray(a.values)?a.values.indexOf(ki(r))===-1&&l.push(new je(e,r,`expected one of [${a.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(a.values).indexOf(ki(r))===-1&&l.push(new je(e,r,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(r)} found`)),l}function ha(i){return za(Zn(i.value))?Hn(It({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):El(i)}function El(i){const e=i.value,r=i.key;if(ai(e)!=="array")return[new je(r,e,`array expected, ${ai(e)} found`)];const a=i.styleSpec;let l,d=[];if(e.length<1)return[new je(r,e,"filter array must have at least 1 element")];switch(d=d.concat(Ra({key:`${r}[0]`,value:e[0],valueSpec:a.filter_operator,style:i.style,styleSpec:i.styleSpec})),ki(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&ki(e[1])==="$type"&&d.push(new je(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&d.push(new je(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(l=ai(e[1]),l!=="string"&&d.push(new je(`${r}[1]`,e[1],`string expected, ${l} found`)));for(let f=2;f<e.length;f++)l=ai(e[f]),ki(e[1])==="$type"?d=d.concat(Ra({key:`${r}[${f}]`,value:e[f],valueSpec:a.geometry_type,style:i.style,styleSpec:i.styleSpec})):l!=="string"&&l!=="number"&&l!=="boolean"&&d.push(new je(`${r}[${f}]`,e[f],`string, number, or boolean expected, ${l} found`));break;case"any":case"all":case"none":for(let f=1;f<e.length;f++)d=d.concat(El({key:`${r}[${f}]`,value:e[f],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":l=ai(e[1]),e.length!==2?d.push(new je(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):l!=="string"&&d.push(new je(`${r}[1]`,e[1],`string expected, ${l} found`));break;case"within":l=ai(e[1]),e.length!==2?d.push(new je(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):l!=="object"&&d.push(new je(`${r}[1]`,e[1],`object expected, ${l} found`))}return d}function Pl(i,e){const r=i.key,a=i.validateSpec,l=i.style,d=i.styleSpec,f=i.value,g=i.objectKey,v=d[`${e}_${i.layerType}`];if(!v)return[];const S=g.match(/^(.*)-transition$/);if(e==="paint"&&S&&v[S[1]]&&v[S[1]].transition)return a({key:r,value:f,valueSpec:d.transition,style:l,styleSpec:d});const I=i.valueSpec||v[g];if(!I)return[new je(r,f,`unknown property "${g}"`)];let M;if(ai(f)==="string"&&ca(I)&&!I.tokens&&(M=/^{([^}]+)}$/.exec(f)))return[new je(r,f,`"${g}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(M[1])} }\`.`)];const D=[];return i.layerType==="symbol"&&(g==="text-field"&&l&&!l.glyphs&&D.push(new je(r,f,'use of "text-field" requires a style "glyphs" property')),g==="text-font"&&Ii(Zn(f))&&ki(f.type)==="identity"&&D.push(new je(r,f,'"text-font" does not support identity functions'))),D.concat(a({key:i.key,value:f,valueSpec:I,style:l,styleSpec:d,expressionContext:"property",propertyType:e,propertyKey:g}))}function Ml(i){return Pl(i,"paint")}function Al(i){return Pl(i,"layout")}function kl(i){let e=[];const r=i.value,a=i.key,l=i.style,d=i.styleSpec;r.type||r.ref||e.push(new je(a,r,'either "type" or "ref" is required'));let f=ki(r.type);const g=ki(r.ref);if(r.id){const v=ki(r.id);for(let S=0;S<i.arrayIndex;S++){const I=l.layers[S];ki(I.id)===v&&e.push(new je(a,r.id,`duplicate layer id "${r.id}", previously used at line ${I.id.__line__}`))}}if("ref"in r){let v;["type","source","source-layer","filter","layout"].forEach(S=>{S in r&&e.push(new je(a,r[S],`"${S}" is prohibited for ref layers`))}),l.layers.forEach(S=>{ki(S.id)===g&&(v=S)}),v?v.ref?e.push(new je(a,r.ref,"ref cannot reference another ref layer")):f=ki(v.type):e.push(new je(a,r.ref,`ref layer "${g}" not found`))}else if(f!=="background")if(r.source){const v=l.sources&&l.sources[r.source],S=v&&ki(v.type);v?S==="vector"&&f==="raster"?e.push(new je(a,r.source,`layer "${r.id}" requires a raster source`)):S!=="raster-dem"&&f==="hillshade"?e.push(new je(a,r.source,`layer "${r.id}" requires a raster-dem source`)):S==="raster"&&f!=="raster"?e.push(new je(a,r.source,`layer "${r.id}" requires a vector source`)):S!=="vector"||r["source-layer"]?S==="raster-dem"&&f!=="hillshade"?e.push(new je(a,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):f!=="line"||!r.paint||!r.paint["line-gradient"]||S==="geojson"&&v.lineMetrics||e.push(new je(a,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new je(a,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new je(a,r.source,`source "${r.source}" not found`))}else e.push(new je(a,r,'missing required property "source"'));return e=e.concat(Cr({key:a,value:r,valueSpec:d.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${a}.type`,value:r.type,valueSpec:d.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:r,objectKey:"type"}),filter:ha,layout:v=>Cr({layer:r,key:v.key,value:v.value,style:v.style,styleSpec:v.styleSpec,validateSpec:v.validateSpec,objectElementValidators:{"*":S=>Al(It({layerType:f},S))}}),paint:v=>Cr({layer:r,key:v.key,value:v.value,style:v.style,styleSpec:v.styleSpec,validateSpec:v.validateSpec,objectElementValidators:{"*":S=>Ml(It({layerType:f},S))}})}})),e}function on(i){const e=i.value,r=i.key,a=ai(e);return a!=="string"?[new je(r,e,`string expected, ${a} found`)]:[]}const Ba={promoteId:function({key:i,value:e}){if(ai(e)==="string")return on({key:i,value:e});{const r=[];for(const a in e)r.push(...on({key:`${i}.${a}`,value:e[a]}));return r}}};function Rr(i){const e=i.value,r=i.key,a=i.styleSpec,l=i.style,d=i.validateSpec;if(!e.type)return[new je(r,e,'"type" is required')];const f=ki(e.type);let g;switch(f){case"vector":case"raster":return g=Cr({key:r,value:e,valueSpec:a[`source_${f.replace("-","_")}`],style:i.style,styleSpec:a,objectElementValidators:Ba,validateSpec:d}),g;case"raster-dem":return g=function(v){var S;const I=(S=v.sourceName)!==null&&S!==void 0?S:"",M=v.value,D=v.styleSpec,$=D.source_raster_dem,O=v.style;let U=[];const X=ai(M);if(M===void 0)return U;if(X!=="object")return U.push(new je("source_raster_dem",M,`object expected, ${X} found`)),U;const ee=ki(M.encoding)==="custom",le=["redFactor","greenFactor","blueFactor","baseShift"],ie=v.value.encoding?`"${v.value.encoding}"`:"Default";for(const ue in M)!ee&&le.includes(ue)?U.push(new je(ue,M[ue],`In "${I}": "${ue}" is only valid when "encoding" is set to "custom". ${ie} encoding found`)):$[ue]?U=U.concat(v.validateSpec({key:ue,value:M[ue],valueSpec:$[ue],validateSpec:v.validateSpec,style:O,styleSpec:D})):U.push(new je(ue,M[ue],`unknown property "${ue}"`));return U}({sourceName:r,value:e,style:i.style,styleSpec:a,validateSpec:d}),g;case"geojson":if(g=Cr({key:r,value:e,valueSpec:a.source_geojson,style:l,styleSpec:a,validateSpec:d,objectElementValidators:Ba}),e.cluster)for(const v in e.clusterProperties){const[S,I]=e.clusterProperties[v],M=typeof S=="string"?[S,["accumulated"],["get",v]]:S;g.push(...Hn({key:`${r}.${v}.map`,value:I,validateSpec:d,expressionContext:"cluster-map"})),g.push(...Hn({key:`${r}.${v}.reduce`,value:M,validateSpec:d,expressionContext:"cluster-reduce"}))}return g;case"video":return Cr({key:r,value:e,valueSpec:a.source_video,style:l,validateSpec:d,styleSpec:a});case"image":return Cr({key:r,value:e,valueSpec:a.source_image,style:l,validateSpec:d,styleSpec:a});case"canvas":return[new je(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ra({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:l,validateSpec:d,styleSpec:a})}}function Fa(i){const e=i.value,r=i.styleSpec,a=r.light,l=i.style;let d=[];const f=ai(e);if(e===void 0)return d;if(f!=="object")return d=d.concat([new je("light",e,`object expected, ${f} found`)]),d;for(const g in e){const v=g.match(/^(.*)-transition$/);d=d.concat(v&&a[v[1]]&&a[v[1]].transition?i.validateSpec({key:g,value:e[g],valueSpec:r.transition,validateSpec:i.validateSpec,style:l,styleSpec:r}):a[g]?i.validateSpec({key:g,value:e[g],valueSpec:a[g],validateSpec:i.validateSpec,style:l,styleSpec:r}):[new je(g,e[g],`unknown property "${g}"`)])}return d}function zl(i){const e=i.value,r=i.styleSpec,a=r.terrain,l=i.style;let d=[];const f=ai(e);if(e===void 0)return d;if(f!=="object")return d=d.concat([new je("terrain",e,`object expected, ${f} found`)]),d;for(const g in e)d=d.concat(a[g]?i.validateSpec({key:g,value:e[g],valueSpec:a[g],validateSpec:i.validateSpec,style:l,styleSpec:r}):[new je(g,e[g],`unknown property "${g}"`)]);return d}function Dl(i){let e=[];const r=i.value,a=i.key;if(Array.isArray(r)){const l=[],d=[];for(const f in r)r[f].id&&l.includes(r[f].id)&&e.push(new je(a,r,`all the sprites' ids must be unique, but ${r[f].id} is duplicated`)),l.push(r[f].id),r[f].url&&d.includes(r[f].url)&&e.push(new je(a,r,`all the sprites' URLs must be unique, but ${r[f].url} is duplicated`)),d.push(r[f].url),e=e.concat(Cr({key:`${a}[${f}]`,value:r[f],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return e}return on({key:a,value:r})}const Ll={"*":()=>[],array:ua,boolean:function(i){const e=i.value,r=i.key,a=ai(e);return a!=="boolean"?[new je(r,e,`boolean expected, ${a} found`)]:[]},number:La,color:function(i){const e=i.key,r=i.value,a=ai(r);return a!=="string"?[new je(e,r,`color expected, ${a} found`)]:ui.parse(String(r))?[]:[new je(e,r,`color expected, "${r}" found`)]},constants:Il,enum:Ra,filter:ha,function:bs,layer:kl,object:Cr,source:Rr,light:Fa,terrain:zl,string:on,formatted:function(i){return on(i).length===0?[]:Hn(i)},resolvedImage:function(i){return on(i).length===0?[]:Hn(i)},padding:function(i){const e=i.key,r=i.value;if(ai(r)==="array"){if(r.length<1||r.length>4)return[new je(e,r,`padding requires 1 to 4 values; ${r.length} values found`)];const a={type:"number"};let l=[];for(let d=0;d<r.length;d++)l=l.concat(i.validateSpec({key:`${e}[${d}]`,value:r[d],validateSpec:i.validateSpec,valueSpec:a}));return l}return La({key:e,value:r,valueSpec:{}})},variableAnchorOffsetCollection:function(i){const e=i.key,r=i.value,a=ai(r),l=i.styleSpec;if(a!=="array"||r.length<1||r.length%2!=0)return[new je(e,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let d=[];for(let f=0;f<r.length;f+=2)d=d.concat(Ra({key:`${e}[${f}]`,value:r[f],valueSpec:l.layout_symbol["text-anchor"]})),d=d.concat(ua({key:`${e}[${f+1}]`,value:r[f+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:l}));return d},sprite:Dl};function gn(i){const e=i.value,r=i.valueSpec,a=i.styleSpec;return i.validateSpec=gn,r.expression&&Ii(ki(e))?bs(i):r.expression&&ms(Zn(e))?Hn(i):r.type&&Ll[r.type]?Ll[r.type](i):Cr(It({},i,{valueSpec:r.type?a[r.type]:r}))}function Rl(i){const e=i.value,r=i.key,a=on(i);return a.length||(e.indexOf("{fontstack}")===-1&&a.push(new je(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&a.push(new je(r,e,'"glyphs" url must include a "{range}" token'))),a}function Wr(i,e=_e){let r=[];return r=r.concat(gn({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,validateSpec:gn,objectElementValidators:{glyphs:Rl,"*":()=>[]}})),i.constants&&(r=r.concat(Il({key:"constants",value:i.constants,style:i,styleSpec:e,validateSpec:gn}))),ws(r)}function _n(i){return function(e){return i({...e,validateSpec:gn})}}function ws(i){return[].concat(i).sort((e,r)=>e.line-r.line)}function yn(i){return function(...e){return ws(i.apply(this,e))}}Wr.source=yn(_n(Rr)),Wr.sprite=yn(_n(Dl)),Wr.glyphs=yn(_n(Rl)),Wr.light=yn(_n(Fa)),Wr.terrain=yn(_n(zl)),Wr.layer=yn(_n(kl)),Wr.filter=yn(_n(ha)),Wr.paintProperty=yn(_n(Ml)),Wr.layoutProperty=yn(_n(Al));const vn=Wr,Nc=vn.light,po=vn.paintProperty,Bl=vn.layoutProperty;function Ss(i,e){let r=!1;if(e&&e.length)for(const a of e)i.fire(new Oi(new Error(a.message))),r=!0;return r}class da{constructor(e,r,a){const l=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const f=new Int32Array(this.arrayBuffer);e=f[0],this.d=(r=f[1])+2*(a=f[2]);for(let v=0;v<this.d*this.d;v++){const S=f[3+v],I=f[3+v+1];l.push(S===I?null:f.subarray(S,I))}const g=f[3+l.length+1];this.keys=f.subarray(f[3+l.length],g),this.bboxes=f.subarray(g),this.insert=this._insertReadonly}else{this.d=r+2*a;for(let f=0;f<this.d*this.d;f++)l.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=e,this.padding=a,this.scale=r/e,this.uid=0;const d=a/r*e;this.min=-d,this.max=e+d}insert(e,r,a,l,d){this._forEachCell(r,a,l,d,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(l),this.bboxes.push(d)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,r,a,l,d,f){this.cells[d].push(f)}query(e,r,a,l,d){const f=this.min,g=this.max;if(e<=f&&r<=f&&g<=a&&g<=l&&!d)return Array.prototype.slice.call(this.keys);{const v=[];return this._forEachCell(e,r,a,l,this._queryCell,v,{},d),v}}_queryCell(e,r,a,l,d,f,g,v){const S=this.cells[d];if(S!==null){const I=this.keys,M=this.bboxes;for(let D=0;D<S.length;D++){const $=S[D];if(g[$]===void 0){const O=4*$;(v?v(M[O+0],M[O+1],M[O+2],M[O+3]):e<=M[O+2]&&r<=M[O+3]&&a>=M[O+0]&&l>=M[O+1])?(g[$]=!0,f.push(I[$])):g[$]=!1}}}}_forEachCell(e,r,a,l,d,f,g,v){const S=this._convertToCellCoord(e),I=this._convertToCellCoord(r),M=this._convertToCellCoord(a),D=this._convertToCellCoord(l);for(let $=S;$<=M;$++)for(let O=I;O<=D;O++){const U=this.d*O+$;if((!v||v(this._convertFromCellCoord($),this._convertFromCellCoord(O),this._convertFromCellCoord($+1),this._convertFromCellCoord(O+1)))&&d.call(this,e,r,a,l,U,f,g,v))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,r=3+this.cells.length+1+1;let a=0;for(let f=0;f<this.cells.length;f++)a+=this.cells[f].length;const l=new Int32Array(r+a+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;let d=r;for(let f=0;f<e.length;f++){const g=e[f];l[3+f]=d,l.set(g,d),d+=g.length}return l[3+e.length]=d,l.set(this.keys,d),d+=this.keys.length,l[3+e.length+1]=d,l.set(this.bboxes,d),d+=this.bboxes.length,l.buffer}static serialize(e,r){const a=e.toArrayBuffer();return r&&r.push(a),{buffer:a}}static deserialize(e){return new da(e.buffer)}}const xn={};function it(i,e,r={}){if(xn[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),xn[i]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}it("Object",Object),it("TransferableGridIndex",da),it("Color",ui),it("Error",Error),it("AJAXError",Yt),it("ResolvedImage",or),it("StylePropertyFunction",Aa),it("StyleExpression",oo,{omit:["_evaluator"]}),it("ZoomDependentExpression",_s),it("ZoomConstantExpression",lo),it("CompoundExpression",Hr,{omit:["_evaluate"]});for(const i in la)la[i]._classRegistryKey||it(`Expression_${i}`,la[i]);function Cs(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Dn(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob)return i;if(Cs(i)||At(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const r=i;return e&&e.push(r.buffer),r}if(i instanceof ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const r=[];for(const a of i)r.push(Dn(a,e));return r}if(typeof i=="object"){const r=i.constructor,a=r._classRegistryKey;if(!a)throw new Error("can't serialize object of unregistered class");if(!xn[a])throw new Error(`${a} is not registered.`);const l=r.serialize?r.serialize(i,e):{};if(r.serialize){if(e&&l===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const d in i){if(!i.hasOwnProperty(d)||xn[a].omit.indexOf(d)>=0)continue;const f=i[d];l[d]=xn[a].shallow.indexOf(d)>=0?f:Dn(f,e)}i instanceof Error&&(l.message=i.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(l.$name=a),l}throw new Error("can't serialize object of type "+typeof i)}function pa(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||Cs(i)||At(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(pa);if(typeof i=="object"){const e=i.$name||"Object";if(!xn[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:r}=xn[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(i);const a=Object.create(r.prototype);for(const l of Object.keys(i)){if(l==="$name")continue;const d=i[l];a[l]=xn[e].shallow.indexOf(l)>=0?d:pa(d)}return a}throw new Error("can't deserialize object of type "+typeof i)}class Fl{constructor(){this.first=!0}update(e,r){const a=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=a,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=a,!0):(this.lastFloorZoom>a?(this.lastIntegerZoom=a+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<a&&(this.lastIntegerZoom=a,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=a,!0))}}const Qe={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function fo(i){for(const e of i)if(go(e.charCodeAt(0)))return!0;return!1}function mo(i){for(const e of i)if(!jc(e.charCodeAt(0)))return!1;return!0}function jc(i){return!(Qe.Arabic(i)||Qe["Arabic Supplement"](i)||Qe["Arabic Extended-A"](i)||Qe["Arabic Presentation Forms-A"](i)||Qe["Arabic Presentation Forms-B"](i))}function go(i){return!(i!==746&&i!==747&&(i<4352||!(Qe["Bopomofo Extended"](i)||Qe.Bopomofo(i)||Qe["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||Qe["CJK Compatibility Ideographs"](i)||Qe["CJK Compatibility"](i)||Qe["CJK Radicals Supplement"](i)||Qe["CJK Strokes"](i)||!(!Qe["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Qe["CJK Unified Ideographs Extension A"](i)||Qe["CJK Unified Ideographs"](i)||Qe["Enclosed CJK Letters and Months"](i)||Qe["Hangul Compatibility Jamo"](i)||Qe["Hangul Jamo Extended-A"](i)||Qe["Hangul Jamo Extended-B"](i)||Qe["Hangul Jamo"](i)||Qe["Hangul Syllables"](i)||Qe.Hiragana(i)||Qe["Ideographic Description Characters"](i)||Qe.Kanbun(i)||Qe["Kangxi Radicals"](i)||Qe["Katakana Phonetic Extensions"](i)||Qe.Katakana(i)&&i!==12540||!(!Qe["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Qe["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||Qe["Unified Canadian Aboriginal Syllabics"](i)||Qe["Unified Canadian Aboriginal Syllabics Extended"](i)||Qe["Vertical Forms"](i)||Qe["Yijing Hexagram Symbols"](i)||Qe["Yi Syllables"](i)||Qe["Yi Radicals"](i))))}function $l(i){return!(go(i)||function(e){return!!(Qe["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Qe["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Qe["Letterlike Symbols"](e)||Qe["Number Forms"](e)||Qe["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Qe["Control Pictures"](e)&&e!==9251||Qe["Optical Character Recognition"](e)||Qe["Enclosed Alphanumerics"](e)||Qe["Geometric Shapes"](e)||Qe["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Qe["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Qe["CJK Symbols and Punctuation"](e)||Qe.Katakana(e)||Qe["Private Use Area"](e)||Qe["CJK Compatibility Forms"](e)||Qe["Small Form Variants"](e)||Qe["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function Ol(i){return i>=1424&&i<=2303||Qe["Arabic Presentation Forms-A"](i)||Qe["Arabic Presentation Forms-B"](i)}function Nl(i,e){return!(!e&&Ol(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||Qe.Khmer(i))}function Vc(i){for(const e of i)if(Ol(e.charCodeAt(0)))return!0;return!1}const _o="deferred",yo="loading",vo="loaded";let xo=null,Tr="unavailable",Ln=null;const $a=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(Tr="error"),xo&&xo(i)};function bo(){Oa.fire(new Mi("pluginStateChange",{pluginStatus:Tr,pluginURL:Ln}))}const Oa=new gr,wo=function(){return Tr},jl=function(){if(Tr!==_o||!Ln)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Tr=yo,bo(),Ln&&Pt({url:Ln},i=>{i?$a(i):(Tr=vo,bo())})},Br={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Tr===vo||Br.applyArabicShaping!=null,isLoading:()=>Tr===yo,setState(i){if(!st())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Tr=i.pluginStatus,Ln=i.pluginURL},isParsed(){if(!st())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return Br.applyArabicShaping!=null&&Br.processBidirectionalText!=null&&Br.processStyledBidirectionalText!=null},getPluginURL(){if(!st())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Ln}};class yi{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Fl,this.transition={})}isSupportedScript(e){return function(r,a){for(const l of r)if(!Nl(l.charCodeAt(0),a))return!1;return!0}(e,Br.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),a=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*a}:{fromScale:.5,toScale:1,t:1-(1-a)*r}}}class Ts{constructor(e,r){this.property=e,this.value=r,this.expression=function(a,l){if(Ii(a))return new Aa(a,l);if(ms(a)){const d=co(a,l);if(d.result==="error")throw new Error(d.value.map(f=>`${f.key}: ${f.message}`).join(", "));return d.value}{let d=a;return l.type==="color"&&typeof a=="string"?d=ui.parse(a):l.type!=="padding"||typeof a!="number"&&!Array.isArray(a)?l.type==="variableAnchorOffsetCollection"&&Array.isArray(a)&&(d=Gr.parse(a)):d=zr.parse(a),{kind:"constant",evaluate:()=>d}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,a){return this.property.possiblyEvaluate(this,e,r,a)}}class So{constructor(e){this.property=e,this.value=new Ts(e,void 0)}transitioned(e,r){return new Ul(this.property,this.value,r,Fe({},e.transition,this.transition),e.now)}untransitioned(){return new Ul(this.property,this.value,null,{},0)}}class Vl{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return We(this._values[e].value.value)}setValue(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new So(this._values[e].property)),this._values[e].value=new Ts(this._values[e].property,r===null?void 0:We(r))}getTransition(e){return We(this._values[e].transition)}setTransition(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new So(this._values[e].property)),this._values[e].transition=We(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const a=this.getValue(r);a!==void 0&&(e[r]=a);const l=this.getTransition(r);l!==void 0&&(e[`${r}-transition`]=l)}return e}transitioned(e,r){const a=new ql(this._properties);for(const l of Object.keys(this._values))a._values[l]=this._values[l].transitioned(e,r._values[l]);return a}untransitioned(){const e=new ql(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class Ul{constructor(e,r,a,l,d){this.property=e,this.value=r,this.begin=d+l.delay||0,this.end=this.begin+l.duration||0,e.specification.transition&&(l.delay||l.duration)&&(this.prior=a)}possiblyEvaluate(e,r,a){const l=e.now||0,d=this.value.possiblyEvaluate(e,r,a),f=this.prior;if(f){if(l>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(l<this.begin)return f.possiblyEvaluate(e,r,a);{const g=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(f.possiblyEvaluate(e,r,a),d,function(v){if(v<=0)return 0;if(v>=1)return 1;const S=v*v,I=S*v;return 4*(v<.5?I:3*(v-S)+I-.75)}(g))}}return d}}class ql{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,a){const l=new Is(this._properties);for(const d of Object.keys(this._values))l._values[d]=this._values[d].possiblyEvaluate(e,r,a);return l}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Uc{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}hasValue(e){return this._values[e].value!==void 0}getValue(e){return We(this._values[e].value)}setValue(e,r){this._values[e]=new Ts(this._values[e].property,r===null?void 0:We(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const a=this.getValue(r);a!==void 0&&(e[r]=a)}return e}possiblyEvaluate(e,r,a){const l=new Is(this._properties);for(const d of Object.keys(this._values))l._values[d]=this._values[d].possiblyEvaluate(e,r,a);return l}}class _r{constructor(e,r,a){this.property=e,this.value=r,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,a,l){return this.property.evaluate(this.value,this.parameters,e,r,a,l)}}class Is{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class pt{constructor(e){this.specification=e}possiblyEvaluate(e,r){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(r)}interpolate(e,r,a){const l=Dr[this.specification.type];return l?l(e,r,a):e}}class vt{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,a,l){return new _r(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},a,l)}:e.expression,r)}interpolate(e,r,a){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new _r(this,{kind:"constant",value:void 0},e.parameters);const l=Dr[this.specification.type];if(l){const d=l(e.value.value,r.value.value,a);return new _r(this,{kind:"constant",value:d},e.parameters)}return e}evaluate(e,r,a,l,d,f){return e.kind==="constant"?e.value:e.evaluate(r,a,l,d,f)}}class Na extends vt{possiblyEvaluate(e,r,a,l){if(e.value===void 0)return new _r(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const d=e.expression.evaluate(r,null,{},a,l),f=e.property.specification.type==="resolvedImage"&&typeof d!="string"?d.name:d,g=this._calculate(f,f,f,r);return new _r(this,{kind:"constant",value:g},r)}if(e.expression.kind==="camera"){const d=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new _r(this,{kind:"constant",value:d},r)}return new _r(this,e.expression,r)}evaluate(e,r,a,l,d,f){if(e.kind==="source"){const g=e.evaluate(r,a,l,d,f);return this._calculate(g,g,g,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},a,l),e.evaluate({zoom:Math.floor(r.zoom)},a,l),e.evaluate({zoom:Math.floor(r.zoom)+1},a,l),r):e.value}_calculate(e,r,a,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:a,to:r}}interpolate(e){return e}}class Co{constructor(e){this.specification=e}possiblyEvaluate(e,r,a,l){if(e.value!==void 0){if(e.expression.kind==="constant"){const d=e.expression.evaluate(r,null,{},a,l);return this._calculate(d,d,d,r)}return this._calculate(e.expression.evaluate(new yi(Math.floor(r.zoom-1),r)),e.expression.evaluate(new yi(Math.floor(r.zoom),r)),e.expression.evaluate(new yi(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,a,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:a,to:r}}interpolate(e){return e}}class To{constructor(e){this.specification=e}possiblyEvaluate(e,r,a,l){return!!e.expression.evaluate(r,null,{},a,l)}interpolate(){return!1}}class ji{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const a=e[r];a.specification.overridable&&this.overridableProperties.push(r);const l=this.defaultPropertyValues[r]=new Ts(a,void 0),d=this.defaultTransitionablePropertyValues[r]=new So(a);this.defaultTransitioningPropertyValues[r]=d.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=l.possiblyEvaluate({})}}}it("DataDrivenProperty",vt),it("DataConstantProperty",pt),it("CrossFadedDataDrivenProperty",Na),it("CrossFadedProperty",Co),it("ColorRampProperty",To);const Io="-transition";class Xr extends gr{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new Uc(r.layout)),r.paint)){this._transitionablePaint=new Vl(r.paint);for(const a in e.paint)this.setPaintProperty(a,e.paint[a],{validate:!1});for(const a in e.layout)this.setLayoutProperty(a,e.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Is(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,a={}){r!=null&&this._validate(Bl,`layers.${this.id}.layout.${e}`,e,r,a)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return e.endsWith(Io)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,a={}){if(r!=null&&this._validate(po,`layers.${this.id}.paint.${e}`,e,r,a))return!1;if(e.endsWith(Io))return this._transitionablePaint.setTransition(e.slice(0,-11),r||void 0),!1;{const l=this._transitionablePaint._values[e],d=l.property.specification["property-type"]==="cross-faded-data-driven",f=l.value.isDataDriven(),g=l.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const v=this._transitionablePaint._values[e].value;return v.isDataDriven()||f||d||this._handleOverridablePaintPropertyUpdate(e,g,v)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,r,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Ue(e,(r,a)=>!(r===void 0||a==="layout"&&!Object.keys(r).length||a==="paint"&&!Object.keys(r).length))}_validate(e,r,a,l,d={}){return(!d||d.validate!==!1)&&Ss(this,e.call(vn,{key:r,layerType:this.type,objectKey:a,value:l,styleSpec:_e,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof _r&&ca(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const Gl={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Wn{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class zi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Pi(i,e=1){let r=0,a=0;return{members:i.map(l=>{const d=Gl[l.type].BYTES_PER_ELEMENT,f=r=fa(r,Math.max(e,d)),g=l.components||1;return a=Math.max(a,d),r+=d*g,{name:l.name,type:l.type,components:g,offset:f}}),size:fa(r,Math.max(a,e)),alignment:e}}function fa(i,e){return Math.ceil(i/e)*e}class ja extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const l=2*e;return this.int16[l+0]=r,this.int16[l+1]=a,e}}ja.prototype.bytesPerElement=4,it("StructArrayLayout2i4",ja);class Va extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,a)}emplace(e,r,a,l){const d=3*e;return this.int16[d+0]=r,this.int16[d+1]=a,this.int16[d+2]=l,e}}Va.prototype.bytesPerElement=6,it("StructArrayLayout3i6",Va);class Xn extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,a,l)}emplace(e,r,a,l,d){const f=4*e;return this.int16[f+0]=r,this.int16[f+1]=a,this.int16[f+2]=l,this.int16[f+3]=d,e}}Xn.prototype.bytesPerElement=8,it("StructArrayLayout4i8",Xn);class Eo extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,l,d,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,r,a,l,d,f)}emplace(e,r,a,l,d,f,g){const v=6*e;return this.int16[v+0]=r,this.int16[v+1]=a,this.int16[v+2]=l,this.int16[v+3]=d,this.int16[v+4]=f,this.int16[v+5]=g,e}}Eo.prototype.bytesPerElement=12,it("StructArrayLayout2i4i12",Eo);class Po extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,l,d,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,r,a,l,d,f)}emplace(e,r,a,l,d,f,g){const v=4*e,S=8*e;return this.int16[v+0]=r,this.int16[v+1]=a,this.uint8[S+4]=l,this.uint8[S+5]=d,this.uint8[S+6]=f,this.uint8[S+7]=g,e}}Po.prototype.bytesPerElement=8,it("StructArrayLayout2i4ub8",Po);class ma extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const l=2*e;return this.float32[l+0]=r,this.float32[l+1]=a,e}}ma.prototype.bytesPerElement=8,it("StructArrayLayout2f8",ma);class Mo extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,l,d,f,g,v,S,I){const M=this.length;return this.resize(M+1),this.emplace(M,e,r,a,l,d,f,g,v,S,I)}emplace(e,r,a,l,d,f,g,v,S,I,M){const D=10*e;return this.uint16[D+0]=r,this.uint16[D+1]=a,this.uint16[D+2]=l,this.uint16[D+3]=d,this.uint16[D+4]=f,this.uint16[D+5]=g,this.uint16[D+6]=v,this.uint16[D+7]=S,this.uint16[D+8]=I,this.uint16[D+9]=M,e}}Mo.prototype.bytesPerElement=20,it("StructArrayLayout10ui20",Mo);class Ao extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,l,d,f,g,v,S,I,M,D){const $=this.length;return this.resize($+1),this.emplace($,e,r,a,l,d,f,g,v,S,I,M,D)}emplace(e,r,a,l,d,f,g,v,S,I,M,D,$){const O=12*e;return this.int16[O+0]=r,this.int16[O+1]=a,this.int16[O+2]=l,this.int16[O+3]=d,this.uint16[O+4]=f,this.uint16[O+5]=g,this.uint16[O+6]=v,this.uint16[O+7]=S,this.int16[O+8]=I,this.int16[O+9]=M,this.int16[O+10]=D,this.int16[O+11]=$,e}}Ao.prototype.bytesPerElement=24,it("StructArrayLayout4i4ui4i24",Ao);class si extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,a)}emplace(e,r,a,l){const d=3*e;return this.float32[d+0]=r,this.float32[d+1]=a,this.float32[d+2]=l,e}}si.prototype.bytesPerElement=12,it("StructArrayLayout3f12",si);class h extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}h.prototype.bytesPerElement=4,it("StructArrayLayout1ul4",h);class t extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,l,d,f,g,v,S){const I=this.length;return this.resize(I+1),this.emplace(I,e,r,a,l,d,f,g,v,S)}emplace(e,r,a,l,d,f,g,v,S,I){const M=10*e,D=5*e;return this.int16[M+0]=r,this.int16[M+1]=a,this.int16[M+2]=l,this.int16[M+3]=d,this.int16[M+4]=f,this.int16[M+5]=g,this.uint32[D+3]=v,this.uint16[M+8]=S,this.uint16[M+9]=I,e}}t.prototype.bytesPerElement=20,it("StructArrayLayout6i1ul2ui20",t);class n extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,l,d,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,r,a,l,d,f)}emplace(e,r,a,l,d,f,g){const v=6*e;return this.int16[v+0]=r,this.int16[v+1]=a,this.int16[v+2]=l,this.int16[v+3]=d,this.int16[v+4]=f,this.int16[v+5]=g,e}}n.prototype.bytesPerElement=12,it("StructArrayLayout2i2i2i12",n);class o extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,l,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,a,l,d)}emplace(e,r,a,l,d,f){const g=4*e,v=8*e;return this.float32[g+0]=r,this.float32[g+1]=a,this.float32[g+2]=l,this.int16[v+6]=d,this.int16[v+7]=f,e}}o.prototype.bytesPerElement=16,it("StructArrayLayout2f1f2i16",o);class c extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,a,l)}emplace(e,r,a,l,d){const f=12*e,g=3*e;return this.uint8[f+0]=r,this.uint8[f+1]=a,this.float32[g+1]=l,this.float32[g+2]=d,e}}c.prototype.bytesPerElement=12,it("StructArrayLayout2ub2f12",c);class p extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,a)}emplace(e,r,a,l){const d=3*e;return this.uint16[d+0]=r,this.uint16[d+1]=a,this.uint16[d+2]=l,e}}p.prototype.bytesPerElement=6,it("StructArrayLayout3ui6",p);class _ extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,l,d,f,g,v,S,I,M,D,$,O,U,X,ee){const le=this.length;return this.resize(le+1),this.emplace(le,e,r,a,l,d,f,g,v,S,I,M,D,$,O,U,X,ee)}emplace(e,r,a,l,d,f,g,v,S,I,M,D,$,O,U,X,ee,le){const ie=24*e,ue=12*e,pe=48*e;return this.int16[ie+0]=r,this.int16[ie+1]=a,this.uint16[ie+2]=l,this.uint16[ie+3]=d,this.uint32[ue+2]=f,this.uint32[ue+3]=g,this.uint32[ue+4]=v,this.uint16[ie+10]=S,this.uint16[ie+11]=I,this.uint16[ie+12]=M,this.float32[ue+7]=D,this.float32[ue+8]=$,this.uint8[pe+36]=O,this.uint8[pe+37]=U,this.uint8[pe+38]=X,this.uint32[ue+10]=ee,this.int16[ie+22]=le,e}}_.prototype.bytesPerElement=48,it("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",_);class y extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,l,d,f,g,v,S,I,M,D,$,O,U,X,ee,le,ie,ue,pe,ke,et,lt,Je,He,qe,rt){const Ge=this.length;return this.resize(Ge+1),this.emplace(Ge,e,r,a,l,d,f,g,v,S,I,M,D,$,O,U,X,ee,le,ie,ue,pe,ke,et,lt,Je,He,qe,rt)}emplace(e,r,a,l,d,f,g,v,S,I,M,D,$,O,U,X,ee,le,ie,ue,pe,ke,et,lt,Je,He,qe,rt,Ge){const Oe=32*e,_t=16*e;return this.int16[Oe+0]=r,this.int16[Oe+1]=a,this.int16[Oe+2]=l,this.int16[Oe+3]=d,this.int16[Oe+4]=f,this.int16[Oe+5]=g,this.int16[Oe+6]=v,this.int16[Oe+7]=S,this.uint16[Oe+8]=I,this.uint16[Oe+9]=M,this.uint16[Oe+10]=D,this.uint16[Oe+11]=$,this.uint16[Oe+12]=O,this.uint16[Oe+13]=U,this.uint16[Oe+14]=X,this.uint16[Oe+15]=ee,this.uint16[Oe+16]=le,this.uint16[Oe+17]=ie,this.uint16[Oe+18]=ue,this.uint16[Oe+19]=pe,this.uint16[Oe+20]=ke,this.uint16[Oe+21]=et,this.uint16[Oe+22]=lt,this.uint32[_t+12]=Je,this.float32[_t+13]=He,this.float32[_t+14]=qe,this.uint16[Oe+30]=rt,this.uint16[Oe+31]=Ge,e}}y.prototype.bytesPerElement=64,it("StructArrayLayout8i15ui1ul2f2ui64",y);class x extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}x.prototype.bytesPerElement=4,it("StructArrayLayout1f4",x);class C extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,a)}emplace(e,r,a,l){const d=3*e;return this.uint16[6*e+0]=r,this.float32[d+1]=a,this.float32[d+2]=l,e}}C.prototype.bytesPerElement=12,it("StructArrayLayout1ui2f12",C);class E extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,a)}emplace(e,r,a,l){const d=4*e;return this.uint32[2*e+0]=r,this.uint16[d+2]=a,this.uint16[d+3]=l,e}}E.prototype.bytesPerElement=8,it("StructArrayLayout1ul2ui8",E);class P extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const l=2*e;return this.uint16[l+0]=r,this.uint16[l+1]=a,e}}P.prototype.bytesPerElement=4,it("StructArrayLayout2ui4",P);class B extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}B.prototype.bytesPerElement=2,it("StructArrayLayout1ui2",B);class G extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,a,l)}emplace(e,r,a,l,d){const f=4*e;return this.float32[f+0]=r,this.float32[f+1]=a,this.float32[f+2]=l,this.float32[f+3]=d,e}}G.prototype.bytesPerElement=16,it("StructArrayLayout4f16",G);class q extends Wn{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new te(this.anchorPointX,this.anchorPointY)}}q.prototype.size=20;class H extends t{get(e){return new q(this,e)}}it("CollisionBoxArray",H);class V extends Wn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}V.prototype.size=48;class ae extends _{get(e){return new V(this,e)}}it("PlacedSymbolArray",ae);class de extends Wn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}de.prototype.size=64;class J extends y{get(e){return new de(this,e)}}it("SymbolInstanceArray",J);class oe extends x{getoffsetX(e){return this.float32[1*e+0]}}it("GlyphOffsetArray",oe);class fe extends Va{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}it("SymbolLineVertexArray",fe);class me extends Wn{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}me.prototype.size=12;class Me extends C{get(e){return new me(this,e)}}it("TextAnchorOffsetArray",Me);class $e extends Wn{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}$e.prototype.size=8;class De extends E{get(e){return new $e(this,e)}}it("FeatureIndexArray",De);class Ve extends ja{}class ot extends ja{}class Ut extends ja{}class Ze extends Eo{}class xt extends Po{}class ut extends ma{}class hi extends Mo{}class Vt extends Ao{}class Lt extends si{}class qt extends h{}class Bi extends n{}class fi extends c{}class lr extends p{}class Yi extends P{}const Vi=Pi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Fr}=Vi;class vi{constructor(e=[]){this.segments=e}prepareSegment(e,r,a,l){let d=this.segments[this.segments.length-1];return e>vi.MAX_VERTEX_ARRAY_LENGTH&&Xe(`Max vertices per segment is ${vi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!d||d.vertexLength+e>vi.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==l)&&(d={vertexOffset:r.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},l!==void 0&&(d.sortKey=l),this.segments.push(d)),d}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,a,l){return new vi([{vertexOffset:e,primitiveOffset:r,vertexLength:a,primitiveLength:l,vaos:{},sortKey:0}])}}function ln(i,e){return 256*(i=Re(Math.floor(i),0,255))+Re(Math.floor(e),0,255)}vi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,it("SegmentVector",vi);const cn=Pi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Rn={exports:{}},Kn={exports:{}};Kn.exports=function(i,e){var r,a,l,d,f,g,v,S;for(a=i.length-(r=3&i.length),l=e,f=3432918353,g=461845907,S=0;S<a;)v=255&i.charCodeAt(S)|(255&i.charCodeAt(++S))<<8|(255&i.charCodeAt(++S))<<16|(255&i.charCodeAt(++S))<<24,++S,l=27492+(65535&(d=5*(65535&(l=(l^=v=(65535&(v=(v=(65535&v)*f+(((v>>>16)*f&65535)<<16)&4294967295)<<15|v>>>17))*g+(((v>>>16)*g&65535)<<16)&4294967295)<<13|l>>>19))+((5*(l>>>16)&65535)<<16)&4294967295))+((58964+(d>>>16)&65535)<<16);switch(v=0,r){case 3:v^=(255&i.charCodeAt(S+2))<<16;case 2:v^=(255&i.charCodeAt(S+1))<<8;case 1:l^=v=(65535&(v=(v=(65535&(v^=255&i.charCodeAt(S)))*f+(((v>>>16)*f&65535)<<16)&4294967295)<<15|v>>>17))*g+(((v>>>16)*g&65535)<<16)&4294967295}return l^=i.length,l=2246822507*(65535&(l^=l>>>16))+((2246822507*(l>>>16)&65535)<<16)&4294967295,l=3266489909*(65535&(l^=l>>>13))+((3266489909*(l>>>16)&65535)<<16)&4294967295,(l^=l>>>16)>>>0};var ga=Kn.exports,dr={exports:{}};dr.exports=function(i,e){for(var r,a=i.length,l=e^a,d=0;a>=4;)r=1540483477*(65535&(r=255&i.charCodeAt(d)|(255&i.charCodeAt(++d))<<8|(255&i.charCodeAt(++d))<<16|(255&i.charCodeAt(++d))<<24))+((1540483477*(r>>>16)&65535)<<16),l=1540483477*(65535&l)+((1540483477*(l>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),a-=4,++d;switch(a){case 3:l^=(255&i.charCodeAt(d+2))<<16;case 2:l^=(255&i.charCodeAt(d+1))<<8;case 1:l=1540483477*(65535&(l^=255&i.charCodeAt(d)))+((1540483477*(l>>>16)&65535)<<16)}return l=1540483477*(65535&(l^=l>>>13))+((1540483477*(l>>>16)&65535)<<16),(l^=l>>>15)>>>0};var cr=ga,yr=dr.exports;Rn.exports=cr,Rn.exports.murmur3=cr,Rn.exports.murmur2=yr;var Yn=L(Rn.exports);class Fi{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,a,l){this.ids.push(Ji(e)),this.positions.push(r,a,l)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=Ji(e);let a=0,l=this.ids.length-1;for(;a<l;){const f=a+l>>1;this.ids[f]>=r?l=f:a=f+1}const d=[];for(;this.ids[a]===r;)d.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return d}static serialize(e,r){const a=new Float64Array(e.ids),l=new Uint32Array(e.positions);return Ir(a,l,0,a.length-1),r&&r.push(a.buffer,l.buffer),{ids:a,positions:l}}static deserialize(e){const r=new Fi;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function Ji(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:Yn(String(i))}function Ir(i,e,r,a){for(;r<a;){const l=i[r+a>>1];let d=r-1,f=a+1;for(;;){do d++;while(i[d]<l);do f--;while(i[f]>l);if(d>=f)break;$i(i,d,f),$i(e,3*d,3*f),$i(e,3*d+1,3*f+1),$i(e,3*d+2,3*f+2)}f-r<a-f?(Ir(i,e,r,f),r=f+1):(Ir(i,e,f+1,a),a=f)}}function $i(i,e,r){const a=i[e];i[e]=i[r],i[r]=a}it("FeaturePositionMap",Fi);class Jn{constructor(e,r){this.gl=e.gl,this.location=r}}class Es extends Jn{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Zl extends Jn{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Hl extends Jn{constructor(e,r){super(e,r),this.current=ui.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const qc=new Float32Array(16);function ko(i){return[ln(255*i.r,255*i.g),ln(255*i.b,255*i.a)]}class un{constructor(e,r,a){this.value=e,this.uniformNames=r.map(l=>`u_${l}`),this.type=a}setUniform(e,r,a){e.set(a.constantOr(this.value))}getBinding(e,r,a){return this.type==="color"?new Hl(e,r):new Es(e,r)}}class Qn{constructor(e,r){this.uniformNames=r.map(a=>`u_${a}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=e.tlbr}setUniform(e,r,a,l){const d=l==="u_pattern_to"?this.patternTo:l==="u_pattern_from"?this.patternFrom:l==="u_pixel_ratio_to"?this.pixelRatioTo:l==="u_pixel_ratio_from"?this.pixelRatioFrom:null;d&&e.set(d)}getBinding(e,r,a){return a.substr(0,9)==="u_pattern"?new Zl(e,r):new Es(e,r)}}class hn{constructor(e,r,a,l){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=r.map(d=>({name:`a_${d}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new l}populatePaintArray(e,r,a,l,d){const f=this.paintVertexArray.length,g=this.expression.evaluate(new yi(0),r,{},l,[],d);this.paintVertexArray.resize(e),this._setPaintValue(f,e,g)}updatePaintArray(e,r,a,l){const d=this.expression.evaluate({zoom:0},a,l);this._setPaintValue(e,r,d)}_setPaintValue(e,r,a){if(this.type==="color"){const l=ko(a);for(let d=e;d<r;d++)this.paintVertexArray.emplace(d,l[0],l[1])}else{for(let l=e;l<r;l++)this.paintVertexArray.emplace(l,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Kr{constructor(e,r,a,l,d,f){this.expression=e,this.uniformNames=r.map(g=>`u_${g}_t`),this.type=a,this.useIntegerZoom=l,this.zoom=d,this.maxValue=0,this.paintVertexAttributes=r.map(g=>({name:`a_${g}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new f}populatePaintArray(e,r,a,l,d){const f=this.expression.evaluate(new yi(this.zoom),r,{},l,[],d),g=this.expression.evaluate(new yi(this.zoom+1),r,{},l,[],d),v=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(v,e,f,g)}updatePaintArray(e,r,a,l){const d=this.expression.evaluate({zoom:this.zoom},a,l),f=this.expression.evaluate({zoom:this.zoom+1},a,l);this._setPaintValue(e,r,d,f)}_setPaintValue(e,r,a,l){if(this.type==="color"){const d=ko(a),f=ko(l);for(let g=e;g<r;g++)this.paintVertexArray.emplace(g,d[0],d[1],f[0],f[1])}else{for(let d=e;d<r;d++)this.paintVertexArray.emplace(d,a,l);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const a=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,l=Re(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);e.set(l)}getBinding(e,r,a){return new Es(e,r)}}class dn{constructor(e,r,a,l,d,f){this.expression=e,this.type=r,this.useIntegerZoom=a,this.zoom=l,this.layerId=f,this.zoomInPaintVertexArray=new d,this.zoomOutPaintVertexArray=new d}populatePaintArray(e,r,a){const l=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(l,e,r.patterns&&r.patterns[this.layerId],a)}updatePaintArray(e,r,a,l,d){this._setPaintValues(e,r,a.patterns&&a.patterns[this.layerId],d)}_setPaintValues(e,r,a,l){if(!l||!a)return;const{min:d,mid:f,max:g}=a,v=l[d],S=l[f],I=l[g];if(v&&S&&I)for(let M=e;M<r;M++)this.zoomInPaintVertexArray.emplace(M,S.tl[0],S.tl[1],S.br[0],S.br[1],v.tl[0],v.tl[1],v.br[0],v.br[1],S.pixelRatio,v.pixelRatio),this.zoomOutPaintVertexArray.emplace(M,S.tl[0],S.tl[1],S.br[0],S.br[1],I.tl[0],I.tl[1],I.br[0],I.br[1],S.pixelRatio,I.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,cn.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,cn.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class zo{constructor(e,r,a){this.binders={},this._buffers=[];const l=[];for(const d in e.paint._values){if(!a(d))continue;const f=e.paint.get(d);if(!(f instanceof _r&&ca(f.property.specification)))continue;const g=Hf(d,e.type),v=f.value,S=f.property.specification.type,I=f.property.useIntegerZoom,M=f.property.specification["property-type"],D=M==="cross-faded"||M==="cross-faded-data-driven";if(v.kind==="constant")this.binders[d]=D?new Qn(v.value,g):new un(v.value,g,S),l.push(`/u_${d}`);else if(v.kind==="source"||D){const $=oh(d,S,"source");this.binders[d]=D?new dn(v,S,I,r,$,e.id):new hn(v,g,S,$),l.push(`/a_${d}`)}else{const $=oh(d,S,"composite");this.binders[d]=new Kr(v,g,S,I,r,$),l.push(`/z_${d}`)}}this.cacheKey=l.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof hn||r instanceof Kr?r.maxValue:0}populatePaintArrays(e,r,a,l,d){for(const f in this.binders){const g=this.binders[f];(g instanceof hn||g instanceof Kr||g instanceof dn)&&g.populatePaintArray(e,r,a,l,d)}}setConstantPatternPositions(e,r){for(const a in this.binders){const l=this.binders[a];l instanceof Qn&&l.setConstantPatternPositions(e,r)}}updatePaintArrays(e,r,a,l,d){let f=!1;for(const g in e){const v=r.getPositions(g);for(const S of v){const I=a.feature(S.index);for(const M in this.binders){const D=this.binders[M];if((D instanceof hn||D instanceof Kr||D instanceof dn)&&D.expression.isStateDependent===!0){const $=l.paint.get(M);D.expression=$.value,D.updatePaintArray(S.start,S.end,I,e[g],d),f=!0}}}}return f}defines(){const e=[];for(const r in this.binders){const a=this.binders[r];(a instanceof un||a instanceof Qn)&&e.push(...a.uniformNames.map(l=>`#define HAS_UNIFORM_${l}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof hn||a instanceof Kr)for(let l=0;l<a.paintVertexAttributes.length;l++)e.push(a.paintVertexAttributes[l].name);else if(a instanceof dn)for(let l=0;l<cn.members.length;l++)e.push(cn.members[l].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof un||a instanceof Qn||a instanceof Kr)for(const l of a.uniformNames)e.push(l)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const a=[];for(const l in this.binders){const d=this.binders[l];if(d instanceof un||d instanceof Qn||d instanceof Kr){for(const f of d.uniformNames)if(r[f]){const g=d.getBinding(e,r[f],f);a.push({name:f,property:l,binding:g})}}}return a}setUniforms(e,r,a,l){for(const{name:d,property:f,binding:g}of r)this.binders[f].setUniform(g,l,a.get(f),d)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const a=this.binders[r];if(e&&a instanceof dn){const l=e.fromScale===2?a.zoomInPaintVertexBuffer:a.zoomOutPaintVertexBuffer;l&&this._buffers.push(l)}else(a instanceof hn||a instanceof Kr)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(e){for(const r in this.binders){const a=this.binders[r];(a instanceof hn||a instanceof Kr||a instanceof dn)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof hn||r instanceof Kr||r instanceof dn)&&r.destroy()}}}class bn{constructor(e,r,a=()=>!0){this.programConfigurations={};for(const l of e)this.programConfigurations[l.id]=new zo(l,r,a);this.needsUpload=!1,this._featureMap=new Fi,this._bufferOffset=0}populatePaintArrays(e,r,a,l,d,f){for(const g in this.programConfigurations)this.programConfigurations[g].populatePaintArrays(e,r,l,d,f);r.id!==void 0&&this._featureMap.add(r.id,a,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,a,l){for(const d of a)this.needsUpload=this.programConfigurations[d.id].updatePaintArrays(e,this._featureMap,r,d,l)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Hf(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function oh(i,e,r){const a={color:{source:ma,composite:G},number:{source:x,composite:ma}},l=function(d){return{"line-pattern":{source:hi,composite:hi},"fill-pattern":{source:hi,composite:hi},"fill-extrusion-pattern":{source:hi,composite:hi}}[d]}(i);return l&&l[r]||a[e][r]}it("ConstantBinder",un),it("CrossFadedConstantBinder",Qn),it("SourceExpressionBinder",hn),it("CrossFadedCompositeBinder",dn),it("CompositeExpressionBinder",Kr),it("ProgramConfiguration",zo,{omit:["_buffers"]}),it("ProgramConfigurationSet",bn);const Hi=8192,Gc=Math.pow(2,14)-1,lh=-Gc-1;function Ua(i){const e=Hi/i.extent,r=i.loadGeometry();for(let a=0;a<r.length;a++){const l=r[a];for(let d=0;d<l.length;d++){const f=l[d],g=Math.round(f.x*e),v=Math.round(f.y*e);f.x=Re(g,lh,Gc),f.y=Re(v,lh,Gc),(g<f.x||g>f.x+1||v<f.y||v>f.y+1)&&Xe("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function qa(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?Ua(i):[]}}function Wl(i,e,r,a,l){i.emplaceBack(2*e+(a+1)/2,2*r+(l+1)/2)}class Zc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new ot,this.indexArray=new lr,this.segments=new vi,this.programConfigurations=new bn(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a){const l=this.layers[0],d=[];let f=null,g=!1;l.type==="circle"&&(f=l.layout.get("circle-sort-key"),g=!f.isConstant());for(const{feature:v,id:S,index:I,sourceLayerIndex:M}of e){const D=this.layers[0]._featureFilter.needGeometry,$=qa(v,D);if(!this.layers[0]._featureFilter.filter(new yi(this.zoom),$,a))continue;const O=g?f.evaluate($,{},a):void 0,U={id:S,properties:v.properties,type:v.type,sourceLayerIndex:M,index:I,geometry:D?$.geometry:Ua(v),patterns:{},sortKey:O};d.push(U)}g&&d.sort((v,S)=>v.sortKey-S.sortKey);for(const v of d){const{geometry:S,index:I,sourceLayerIndex:M}=v,D=e[I].feature;this.addFeature(v,S,I,a),r.featureIndex.insert(D,S,I,M,this.index)}}update(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Fr),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,a,l){for(const d of r)for(const f of d){const g=f.x,v=f.y;if(g<0||g>=Hi||v<0||v>=Hi)continue;const S=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),I=S.vertexLength;Wl(this.layoutVertexArray,g,v,-1,-1),Wl(this.layoutVertexArray,g,v,1,-1),Wl(this.layoutVertexArray,g,v,1,1),Wl(this.layoutVertexArray,g,v,-1,1),this.indexArray.emplaceBack(I,I+1,I+2),this.indexArray.emplaceBack(I,I+3,I+2),S.vertexLength+=4,S.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},l)}}function ch(i,e){for(let r=0;r<i.length;r++)if(Ps(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(Ps(i,e[r]))return!0;return!!Hc(i,e)}function Wf(i,e,r){return!!Ps(i,e)||!!Wc(e,i,r)}function uh(i,e){if(i.length===1)return dh(e,i[0]);for(let r=0;r<e.length;r++){const a=e[r];for(let l=0;l<a.length;l++)if(Ps(i,a[l]))return!0}for(let r=0;r<i.length;r++)if(dh(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(Hc(i,e[r]))return!0;return!1}function Xf(i,e,r){if(i.length>1){if(Hc(i,e))return!0;for(let a=0;a<e.length;a++)if(Wc(e[a],i,r))return!0}for(let a=0;a<i.length;a++)if(Wc(i[a],e,r))return!0;return!1}function Hc(i,e){if(i.length===0||e.length===0)return!1;for(let r=0;r<i.length-1;r++){const a=i[r],l=i[r+1];for(let d=0;d<e.length-1;d++)if(Kf(a,l,e[d],e[d+1]))return!0}return!1}function Kf(i,e,r,a){return at(i,r,a)!==at(e,r,a)&&at(i,e,r)!==at(i,e,a)}function Wc(i,e,r){const a=r*r;if(e.length===1)return i.distSqr(e[0])<a;for(let l=1;l<e.length;l++)if(hh(i,e[l-1],e[l])<a)return!0;return!1}function hh(i,e,r){const a=e.distSqr(r);if(a===0)return i.distSqr(e);const l=((i.x-e.x)*(r.x-e.x)+(i.y-e.y)*(r.y-e.y))/a;return i.distSqr(l<0?e:l>1?r:r.sub(e)._mult(l)._add(e))}function dh(i,e){let r,a,l,d=!1;for(let f=0;f<i.length;f++){r=i[f];for(let g=0,v=r.length-1;g<r.length;v=g++)a=r[g],l=r[v],a.y>e.y!=l.y>e.y&&e.x<(l.x-a.x)*(e.y-a.y)/(l.y-a.y)+a.x&&(d=!d)}return d}function Ps(i,e){let r=!1;for(let a=0,l=i.length-1;a<i.length;l=a++){const d=i[a],f=i[l];d.y>e.y!=f.y>e.y&&e.x<(f.x-d.x)*(e.y-d.y)/(f.y-d.y)+d.x&&(r=!r)}return r}function Yf(i,e,r){const a=r[0],l=r[2];if(i.x<a.x&&e.x<a.x||i.x>l.x&&e.x>l.x||i.y<a.y&&e.y<a.y||i.y>l.y&&e.y>l.y)return!1;const d=at(i,e,r[0]);return d!==at(i,e,r[1])||d!==at(i,e,r[2])||d!==at(i,e,r[3])}function Do(i,e,r){const a=e.paint.get(i).value;return a.kind==="constant"?a.value:r.programConfigurations.get(e.id).getMaxValue(i)}function Xl(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Kl(i,e,r,a,l){if(!e[0]&&!e[1])return i;const d=te.convert(e)._mult(l);r==="viewport"&&d._rotate(-a);const f=[];for(let g=0;g<i.length;g++)f.push(i[g].sub(d));return f}let ph,fh;it("CircleBucket",Zc,{omit:["layers"]});var Jf={get paint(){return fh=fh||new ji({"circle-radius":new vt(_e.paint_circle["circle-radius"]),"circle-color":new vt(_e.paint_circle["circle-color"]),"circle-blur":new vt(_e.paint_circle["circle-blur"]),"circle-opacity":new vt(_e.paint_circle["circle-opacity"]),"circle-translate":new pt(_e.paint_circle["circle-translate"]),"circle-translate-anchor":new pt(_e.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new pt(_e.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new pt(_e.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new vt(_e.paint_circle["circle-stroke-width"]),"circle-stroke-color":new vt(_e.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new vt(_e.paint_circle["circle-stroke-opacity"])})},get layout(){return ph=ph||new ji({"circle-sort-key":new vt(_e.layout_circle["circle-sort-key"])})}},Er=1e-6,Ms=typeof Float32Array<"u"?Float32Array:Array;function Xc(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function mh(i,e,r){var a=e[0],l=e[1],d=e[2],f=e[3],g=e[4],v=e[5],S=e[6],I=e[7],M=e[8],D=e[9],$=e[10],O=e[11],U=e[12],X=e[13],ee=e[14],le=e[15],ie=r[0],ue=r[1],pe=r[2],ke=r[3];return i[0]=ie*a+ue*g+pe*M+ke*U,i[1]=ie*l+ue*v+pe*D+ke*X,i[2]=ie*d+ue*S+pe*$+ke*ee,i[3]=ie*f+ue*I+pe*O+ke*le,i[4]=(ie=r[4])*a+(ue=r[5])*g+(pe=r[6])*M+(ke=r[7])*U,i[5]=ie*l+ue*v+pe*D+ke*X,i[6]=ie*d+ue*S+pe*$+ke*ee,i[7]=ie*f+ue*I+pe*O+ke*le,i[8]=(ie=r[8])*a+(ue=r[9])*g+(pe=r[10])*M+(ke=r[11])*U,i[9]=ie*l+ue*v+pe*D+ke*X,i[10]=ie*d+ue*S+pe*$+ke*ee,i[11]=ie*f+ue*I+pe*O+ke*le,i[12]=(ie=r[12])*a+(ue=r[13])*g+(pe=r[14])*M+(ke=r[15])*U,i[13]=ie*l+ue*v+pe*D+ke*X,i[14]=ie*d+ue*S+pe*$+ke*ee,i[15]=ie*f+ue*I+pe*O+ke*le,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var Lo,Qf=mh;function Yl(i,e,r){var a=e[0],l=e[1],d=e[2],f=e[3];return i[0]=r[0]*a+r[4]*l+r[8]*d+r[12]*f,i[1]=r[1]*a+r[5]*l+r[9]*d+r[13]*f,i[2]=r[2]*a+r[6]*l+r[10]*d+r[14]*f,i[3]=r[3]*a+r[7]*l+r[11]*d+r[15]*f,i}Lo=new Ms(4),Ms!=Float32Array&&(Lo[0]=0,Lo[1]=0,Lo[2]=0,Lo[3]=0);class em extends Xr{constructor(e){super(e,Jf)}createBucket(e){return new Zc(e)}queryRadius(e){const r=e;return Do("circle-radius",this,r)+Do("circle-stroke-width",this,r)+Xl(this.paint.get("circle-translate"))}queryIntersectsFeature(e,r,a,l,d,f,g,v){const S=Kl(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,g),I=this.paint.get("circle-radius").evaluate(r,a)+this.paint.get("circle-stroke-width").evaluate(r,a),M=this.paint.get("circle-pitch-alignment")==="map",D=M?S:function(O,U){return O.map(X=>gh(X,U))}(S,v),$=M?I*g:I;for(const O of l)for(const U of O){const X=M?U:gh(U,v);let ee=$;const le=Yl([],[U.x,U.y,0,1],v);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ee*=le[3]/f.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ee*=f.cameraToCenterDistance/le[3]),Wf(D,X,ee))return!0}return!1}}function gh(i,e){const r=Yl([],[i.x,i.y,0,1],e);return new te(r[0]/r[3],r[1]/r[3])}class _h extends Zc{}let yh;it("HeatmapBucket",_h,{omit:["layers"]});var tm={get paint(){return yh=yh||new ji({"heatmap-radius":new vt(_e.paint_heatmap["heatmap-radius"]),"heatmap-weight":new vt(_e.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new pt(_e.paint_heatmap["heatmap-intensity"]),"heatmap-color":new To(_e.paint_heatmap["heatmap-color"]),"heatmap-opacity":new pt(_e.paint_heatmap["heatmap-opacity"])})}};function Kc(i,{width:e,height:r},a,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==e*r*a)throw new RangeError(`mismatched image size. expected: ${l.length} but got: ${e*r*a}`)}else l=new Uint8Array(e*r*a);return i.width=e,i.height=r,i.data=l,i}function vh(i,{width:e,height:r},a){if(e===i.width&&r===i.height)return;const l=Kc({},{width:e,height:r},a);Yc(i,l,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,r)},a),i.width=e,i.height=r,i.data=l.data}function Yc(i,e,r,a,l,d){if(l.width===0||l.height===0)return e;if(l.width>i.width||l.height>i.height||r.x>i.width-l.width||r.y>i.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>e.width||l.height>e.height||a.x>e.width-l.width||a.y>e.height-l.height)throw new RangeError("out of range destination coordinates for image copy");const f=i.data,g=e.data;if(f===g)throw new Error("srcData equals dstData, so image is already copied");for(let v=0;v<l.height;v++){const S=((r.y+v)*i.width+r.x)*d,I=((a.y+v)*e.width+a.x)*d;for(let M=0;M<l.width*d;M++)g[I+M]=f[S+M]}return e}class Ro{constructor(e,r){Kc(this,e,1,r)}resize(e){vh(this,e,1)}clone(){return new Ro({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,a,l,d){Yc(e,r,a,l,d,1)}}class Qr{constructor(e,r){Kc(this,e,4,r)}resize(e){vh(this,e,4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Qr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,a,l,d){Yc(e,r,a,l,d,4)}}function xh(i){const e={},r=i.resolution||256,a=i.clips?i.clips.length:1,l=i.image||new Qr({width:r,height:a});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const d=(f,g,v)=>{e[i.evaluationKey]=v;const S=i.expression.evaluate(e);l.data[f+g+0]=Math.floor(255*S.r/S.a),l.data[f+g+1]=Math.floor(255*S.g/S.a),l.data[f+g+2]=Math.floor(255*S.b/S.a),l.data[f+g+3]=Math.floor(255*S.a)};if(i.clips)for(let f=0,g=0;f<a;++f,g+=4*r)for(let v=0,S=0;v<r;v++,S+=4){const I=v/(r-1),{start:M,end:D}=i.clips[f];d(g,S,M*(1-I)+D*I)}else for(let f=0,g=0;f<r;f++,g+=4)d(0,g,f/(r-1));return l}it("AlphaImage",Ro),it("RGBAImage",Qr);class im extends Xr{createBucket(e){return new _h(e)}constructor(e){super(e,tm),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=xh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let bh;var rm={get paint(){return bh=bh||new ji({"hillshade-illumination-direction":new pt(_e.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new pt(_e.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new pt(_e.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new pt(_e.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new pt(_e.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new pt(_e.paint_hillshade["hillshade-accent-color"])})}};class nm extends Xr{constructor(e){super(e,rm)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const am=Pi([{name:"a_pos",components:2,type:"Int16"}],4),{members:sm}=am;var Jc={exports:{}};function Jl(i,e,r){r=r||2;var a,l,d,f,g,v,S,I=e&&e.length,M=I?e[0]*r:i.length,D=wh(i,0,M,r,!0),$=[];if(!D||D.next===D.prev)return $;if(I&&(D=function(U,X,ee,le){var ie,ue,pe,ke=[];for(ie=0,ue=X.length;ie<ue;ie++)(pe=wh(U,X[ie]*le,ie<ue-1?X[ie+1]*le:U.length,le,!1))===pe.next&&(pe.steiner=!0),ke.push(fm(pe));for(ke.sort(hm),ie=0;ie<ke.length;ie++)ee=dm(ke[ie],ee);return ee}(i,e,D,r)),i.length>80*r){a=d=i[0],l=f=i[1];for(var O=r;O<M;O+=r)(g=i[O])<a&&(a=g),(v=i[O+1])<l&&(l=v),g>d&&(d=g),v>f&&(f=v);S=(S=Math.max(d-a,f-l))!==0?32767/S:0}return Bo(D,$,r,a,l,S,0),$}function wh(i,e,r,a,l){var d,f;if(l===tu(i,e,r,a)>0)for(d=e;d<r;d+=a)f=Th(d,i[d],i[d+1],f);else for(d=r-a;d>=e;d-=a)f=Th(d,i[d],i[d+1],f);return f&&Ql(f,f.next)&&($o(f),f=f.next),f}function Ga(i,e){if(!i)return i;e||(e=i);var r,a=i;do if(r=!1,a.steiner||!Ql(a,a.next)&&Ui(a.prev,a,a.next)!==0)a=a.next;else{if($o(a),(a=e=a.prev)===a.next)break;r=!0}while(r||a!==e);return e}function Bo(i,e,r,a,l,d,f){if(i){!f&&d&&function(I,M,D,$){var O=I;do O.z===0&&(O.z=Qc(O.x,O.y,M,D,$)),O.prevZ=O.prev,O.nextZ=O.next,O=O.next;while(O!==I);O.prevZ.nextZ=null,O.prevZ=null,function(U){var X,ee,le,ie,ue,pe,ke,et,lt=1;do{for(ee=U,U=null,ue=null,pe=0;ee;){for(pe++,le=ee,ke=0,X=0;X<lt&&(ke++,le=le.nextZ);X++);for(et=lt;ke>0||et>0&&le;)ke!==0&&(et===0||!le||ee.z<=le.z)?(ie=ee,ee=ee.nextZ,ke--):(ie=le,le=le.nextZ,et--),ue?ue.nextZ=ie:U=ie,ie.prevZ=ue,ue=ie;ee=le}ue.nextZ=null,lt*=2}while(pe>1)}(O)}(i,a,l,d);for(var g,v,S=i;i.prev!==i.next;)if(g=i.prev,v=i.next,d?lm(i,a,l,d):om(i))e.push(g.i/r|0),e.push(i.i/r|0),e.push(v.i/r|0),$o(i),i=v.next,S=v.next;else if((i=v)===S){f?f===1?Bo(i=cm(Ga(i),e,r),e,r,a,l,d,2):f===2&&um(i,e,r,a,l,d):Bo(Ga(i),e,r,a,l,d,1);break}}}function om(i){var e=i.prev,r=i,a=i.next;if(Ui(e,r,a)>=0)return!1;for(var l=e.x,d=r.x,f=a.x,g=e.y,v=r.y,S=a.y,I=l<d?l<f?l:f:d<f?d:f,M=g<v?g<S?g:S:v<S?v:S,D=l>d?l>f?l:f:d>f?d:f,$=g>v?g>S?g:S:v>S?v:S,O=a.next;O!==e;){if(O.x>=I&&O.x<=D&&O.y>=M&&O.y<=$&&As(l,g,d,v,f,S,O.x,O.y)&&Ui(O.prev,O,O.next)>=0)return!1;O=O.next}return!0}function lm(i,e,r,a){var l=i.prev,d=i,f=i.next;if(Ui(l,d,f)>=0)return!1;for(var g=l.x,v=d.x,S=f.x,I=l.y,M=d.y,D=f.y,$=g<v?g<S?g:S:v<S?v:S,O=I<M?I<D?I:D:M<D?M:D,U=g>v?g>S?g:S:v>S?v:S,X=I>M?I>D?I:D:M>D?M:D,ee=Qc($,O,e,r,a),le=Qc(U,X,e,r,a),ie=i.prevZ,ue=i.nextZ;ie&&ie.z>=ee&&ue&&ue.z<=le;){if(ie.x>=$&&ie.x<=U&&ie.y>=O&&ie.y<=X&&ie!==l&&ie!==f&&As(g,I,v,M,S,D,ie.x,ie.y)&&Ui(ie.prev,ie,ie.next)>=0||(ie=ie.prevZ,ue.x>=$&&ue.x<=U&&ue.y>=O&&ue.y<=X&&ue!==l&&ue!==f&&As(g,I,v,M,S,D,ue.x,ue.y)&&Ui(ue.prev,ue,ue.next)>=0))return!1;ue=ue.nextZ}for(;ie&&ie.z>=ee;){if(ie.x>=$&&ie.x<=U&&ie.y>=O&&ie.y<=X&&ie!==l&&ie!==f&&As(g,I,v,M,S,D,ie.x,ie.y)&&Ui(ie.prev,ie,ie.next)>=0)return!1;ie=ie.prevZ}for(;ue&&ue.z<=le;){if(ue.x>=$&&ue.x<=U&&ue.y>=O&&ue.y<=X&&ue!==l&&ue!==f&&As(g,I,v,M,S,D,ue.x,ue.y)&&Ui(ue.prev,ue,ue.next)>=0)return!1;ue=ue.nextZ}return!0}function cm(i,e,r){var a=i;do{var l=a.prev,d=a.next.next;!Ql(l,d)&&Sh(l,a,a.next,d)&&Fo(l,d)&&Fo(d,l)&&(e.push(l.i/r|0),e.push(a.i/r|0),e.push(d.i/r|0),$o(a),$o(a.next),a=i=d),a=a.next}while(a!==i);return Ga(a)}function um(i,e,r,a,l,d){var f=i;do{for(var g=f.next.next;g!==f.prev;){if(f.i!==g.i&&mm(f,g)){var v=Ch(f,g);return f=Ga(f,f.next),v=Ga(v,v.next),Bo(f,e,r,a,l,d,0),void Bo(v,e,r,a,l,d,0)}g=g.next}f=f.next}while(f!==i)}function hm(i,e){return i.x-e.x}function dm(i,e){var r=function(l,d){var f,g=d,v=l.x,S=l.y,I=-1/0;do{if(S<=g.y&&S>=g.next.y&&g.next.y!==g.y){var M=g.x+(S-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(M<=v&&M>I&&(I=M,f=g.x<g.next.x?g:g.next,M===v))return f}g=g.next}while(g!==d);if(!f)return null;var D,$=f,O=f.x,U=f.y,X=1/0;g=f;do v>=g.x&&g.x>=O&&v!==g.x&&As(S<U?v:I,S,O,U,S<U?I:v,S,g.x,g.y)&&(D=Math.abs(S-g.y)/(v-g.x),Fo(g,l)&&(D<X||D===X&&(g.x>f.x||g.x===f.x&&pm(f,g)))&&(f=g,X=D)),g=g.next;while(g!==$);return f}(i,e);if(!r)return e;var a=Ch(r,i);return Ga(a,a.next),Ga(r,r.next)}function pm(i,e){return Ui(i.prev,i,e.prev)<0&&Ui(e.next,i,i.next)<0}function Qc(i,e,r,a,l){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*l|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*l|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function fm(i){var e=i,r=i;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==i);return r}function As(i,e,r,a,l,d,f,g){return(l-f)*(e-g)>=(i-f)*(d-g)&&(i-f)*(a-g)>=(r-f)*(e-g)&&(r-f)*(d-g)>=(l-f)*(a-g)}function mm(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(r,a){var l=r;do{if(l.i!==r.i&&l.next.i!==r.i&&l.i!==a.i&&l.next.i!==a.i&&Sh(l,l.next,r,a))return!0;l=l.next}while(l!==r);return!1}(i,e)&&(Fo(i,e)&&Fo(e,i)&&function(r,a){var l=r,d=!1,f=(r.x+a.x)/2,g=(r.y+a.y)/2;do l.y>g!=l.next.y>g&&l.next.y!==l.y&&f<(l.next.x-l.x)*(g-l.y)/(l.next.y-l.y)+l.x&&(d=!d),l=l.next;while(l!==r);return d}(i,e)&&(Ui(i.prev,i,e.prev)||Ui(i,e.prev,e))||Ql(i,e)&&Ui(i.prev,i,i.next)>0&&Ui(e.prev,e,e.next)>0)}function Ui(i,e,r){return(e.y-i.y)*(r.x-e.x)-(e.x-i.x)*(r.y-e.y)}function Ql(i,e){return i.x===e.x&&i.y===e.y}function Sh(i,e,r,a){var l=tc(Ui(i,e,r)),d=tc(Ui(i,e,a)),f=tc(Ui(r,a,i)),g=tc(Ui(r,a,e));return l!==d&&f!==g||!(l!==0||!ec(i,r,e))||!(d!==0||!ec(i,a,e))||!(f!==0||!ec(r,i,a))||!(g!==0||!ec(r,e,a))}function ec(i,e,r){return e.x<=Math.max(i.x,r.x)&&e.x>=Math.min(i.x,r.x)&&e.y<=Math.max(i.y,r.y)&&e.y>=Math.min(i.y,r.y)}function tc(i){return i>0?1:i<0?-1:0}function Fo(i,e){return Ui(i.prev,i,i.next)<0?Ui(i,e,i.next)>=0&&Ui(i,i.prev,e)>=0:Ui(i,e,i.prev)<0||Ui(i,i.next,e)<0}function Ch(i,e){var r=new eu(i.i,i.x,i.y),a=new eu(e.i,e.x,e.y),l=i.next,d=e.prev;return i.next=e,e.prev=i,r.next=l,l.prev=r,a.next=r,r.prev=a,d.next=a,a.prev=d,a}function Th(i,e,r,a){var l=new eu(i,e,r);return a?(l.next=a.next,l.prev=a,a.next.prev=l,a.next=l):(l.prev=l,l.next=l),l}function $o(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function eu(i,e,r){this.i=i,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function tu(i,e,r,a){for(var l=0,d=e,f=r-a;d<r;d+=a)l+=(i[f]-i[d])*(i[d+1]+i[f+1]),f=d;return l}Jc.exports=Jl,Jc.exports.default=Jl,Jl.deviation=function(i,e,r,a){var l=e&&e.length,d=Math.abs(tu(i,0,l?e[0]*r:i.length,r));if(l)for(var f=0,g=e.length;f<g;f++)d-=Math.abs(tu(i,e[f]*r,f<g-1?e[f+1]*r:i.length,r));var v=0;for(f=0;f<a.length;f+=3){var S=a[f]*r,I=a[f+1]*r,M=a[f+2]*r;v+=Math.abs((i[S]-i[M])*(i[I+1]-i[S+1])-(i[S]-i[I])*(i[M+1]-i[S+1]))}return d===0&&v===0?0:Math.abs((v-d)/d)},Jl.flatten=function(i){for(var e=i[0][0].length,r={vertices:[],holes:[],dimensions:e},a=0,l=0;l<i.length;l++){for(var d=0;d<i[l].length;d++)for(var f=0;f<e;f++)r.vertices.push(i[l][d][f]);l>0&&r.holes.push(a+=i[l-1].length)}return r};var Ih=L(Jc.exports);function gm(i,e,r,a,l){Eh(i,e,r||0,a||i.length-1,l||_m)}function Eh(i,e,r,a,l){for(;a>r;){if(a-r>600){var d=a-r+1,f=e-r+1,g=Math.log(d),v=.5*Math.exp(2*g/3),S=.5*Math.sqrt(g*v*(d-v)/d)*(f-d/2<0?-1:1);Eh(i,e,Math.max(r,Math.floor(e-f*v/d+S)),Math.min(a,Math.floor(e+(d-f)*v/d+S)),l)}var I=i[e],M=r,D=a;for(Oo(i,r,e),l(i[a],I)>0&&Oo(i,r,a);M<D;){for(Oo(i,M,D),M++,D--;l(i[M],I)<0;)M++;for(;l(i[D],I)>0;)D--}l(i[r],I)===0?Oo(i,r,D):Oo(i,++D,a),D<=e&&(r=D+1),e<=D&&(a=D-1)}}function Oo(i,e,r){var a=i[e];i[e]=i[r],i[r]=a}function _m(i,e){return i<e?-1:i>e?1:0}function iu(i,e){const r=i.length;if(r<=1)return[i];const a=[];let l,d;for(let f=0;f<r;f++){const g=Ct(i[f]);g!==0&&(i[f].area=Math.abs(g),d===void 0&&(d=g<0),d===g<0?(l&&a.push(l),l=[i[f]]):l.push(i[f]))}if(l&&a.push(l),e>1)for(let f=0;f<a.length;f++)a[f].length<=e||(gm(a[f],e,1,a[f].length-1,ym),a[f]=a[f].slice(0,e));return a}function ym(i,e){return e.area-i.area}function ru(i,e,r){const a=r.patternDependencies;let l=!1;for(const d of e){const f=d.paint.get(`${i}-pattern`);f.isConstant()||(l=!0);const g=f.constantOr(null);g&&(l=!0,a[g.to]=!0,a[g.from]=!0)}return l}function nu(i,e,r,a,l){const d=l.patternDependencies;for(const f of e){const g=f.paint.get(`${i}-pattern`).value;if(g.kind!=="constant"){let v=g.evaluate({zoom:a-1},r,{},l.availableImages),S=g.evaluate({zoom:a},r,{},l.availableImages),I=g.evaluate({zoom:a+1},r,{},l.availableImages);v=v&&v.name?v.name:v,S=S&&S.name?S.name:S,I=I&&I.name?I.name:I,d[v]=!0,d[S]=!0,d[I]=!0,r.patterns[f.id]={min:v,mid:S,max:I}}}return r}class au{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ut,this.indexArray=new lr,this.indexArray2=new Yi,this.programConfigurations=new bn(e.layers,e.zoom),this.segments=new vi,this.segments2=new vi,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a){this.hasPattern=ru("fill",this.layers,r);const l=this.layers[0].layout.get("fill-sort-key"),d=!l.isConstant(),f=[];for(const{feature:g,id:v,index:S,sourceLayerIndex:I}of e){const M=this.layers[0]._featureFilter.needGeometry,D=qa(g,M);if(!this.layers[0]._featureFilter.filter(new yi(this.zoom),D,a))continue;const $=d?l.evaluate(D,{},a,r.availableImages):void 0,O={id:v,properties:g.properties,type:g.type,sourceLayerIndex:I,index:S,geometry:M?D.geometry:Ua(g),patterns:{},sortKey:$};f.push(O)}d&&f.sort((g,v)=>g.sortKey-v.sortKey);for(const g of f){const{geometry:v,index:S,sourceLayerIndex:I}=g;if(this.hasPattern){const M=nu("fill",this.layers,g,this.zoom,r);this.patternFeatures.push(M)}else this.addFeature(g,v,S,a,{});r.featureIndex.insert(e[S].feature,v,S,I,this.index)}}update(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a)}addFeatures(e,r,a){for(const l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,r,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,sm),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,a,l,d){for(const f of iu(r,500)){let g=0;for(const $ of f)g+=$.length;const v=this.segments.prepareSegment(g,this.layoutVertexArray,this.indexArray),S=v.vertexLength,I=[],M=[];for(const $ of f){if($.length===0)continue;$!==f[0]&&M.push(I.length/2);const O=this.segments2.prepareSegment($.length,this.layoutVertexArray,this.indexArray2),U=O.vertexLength;this.layoutVertexArray.emplaceBack($[0].x,$[0].y),this.indexArray2.emplaceBack(U+$.length-1,U),I.push($[0].x),I.push($[0].y);for(let X=1;X<$.length;X++)this.layoutVertexArray.emplaceBack($[X].x,$[X].y),this.indexArray2.emplaceBack(U+X-1,U+X),I.push($[X].x),I.push($[X].y);O.vertexLength+=$.length,O.primitiveLength+=$.length}const D=Ih(I,M);for(let $=0;$<D.length;$+=3)this.indexArray.emplaceBack(S+D[$],S+D[$+1],S+D[$+2]);v.vertexLength+=g,v.primitiveLength+=D.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,d,l)}}let Ph,Mh;it("FillBucket",au,{omit:["layers","patternFeatures"]});var vm={get paint(){return Mh=Mh||new ji({"fill-antialias":new pt(_e.paint_fill["fill-antialias"]),"fill-opacity":new vt(_e.paint_fill["fill-opacity"]),"fill-color":new vt(_e.paint_fill["fill-color"]),"fill-outline-color":new vt(_e.paint_fill["fill-outline-color"]),"fill-translate":new pt(_e.paint_fill["fill-translate"]),"fill-translate-anchor":new pt(_e.paint_fill["fill-translate-anchor"]),"fill-pattern":new Na(_e.paint_fill["fill-pattern"])})},get layout(){return Ph=Ph||new ji({"fill-sort-key":new vt(_e.layout_fill["fill-sort-key"])})}};class xm extends Xr{constructor(e){super(e,vm)}recalculate(e,r){super.recalculate(e,r);const a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new au(e)}queryRadius(){return Xl(this.paint.get("fill-translate"))}queryIntersectsFeature(e,r,a,l,d,f,g){return uh(Kl(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,g),l)}isTileClipped(){return!0}}const bm=Pi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),wm=Pi([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Sm}=bm;var _a={},Cm=K,Ah=ks;function ks(i,e,r,a,l){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=a,this._values=l,i.readFields(Tm,this,e)}function Tm(i,e,r){i==1?e.id=r.readVarint():i==2?function(a,l){for(var d=a.readVarint()+a.pos;a.pos<d;){var f=l._keys[a.readVarint()],g=l._values[a.readVarint()];l.properties[f]=g}}(r,e):i==3?e.type=r.readVarint():i==4&&(e._geometry=r.pos)}function Im(i){for(var e,r,a=0,l=0,d=i.length,f=d-1;l<d;f=l++)a+=((r=i[f]).x-(e=i[l]).x)*(e.y+r.y);return a}ks.types=["Unknown","Point","LineString","Polygon"],ks.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,r=i.readVarint()+i.pos,a=1,l=0,d=0,f=0,g=[];i.pos<r;){if(l<=0){var v=i.readVarint();a=7&v,l=v>>3}if(l--,a===1||a===2)d+=i.readSVarint(),f+=i.readSVarint(),a===1&&(e&&g.push(e),e=[]),e.push(new Cm(d,f));else{if(a!==7)throw new Error("unknown command "+a);e&&e.push(e[0].clone())}}return e&&g.push(e),g},ks.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,r=1,a=0,l=0,d=0,f=1/0,g=-1/0,v=1/0,S=-1/0;i.pos<e;){if(a<=0){var I=i.readVarint();r=7&I,a=I>>3}if(a--,r===1||r===2)(l+=i.readSVarint())<f&&(f=l),l>g&&(g=l),(d+=i.readSVarint())<v&&(v=d),d>S&&(S=d);else if(r!==7)throw new Error("unknown command "+r)}return[f,v,g,S]},ks.prototype.toGeoJSON=function(i,e,r){var a,l,d=this.extent*Math.pow(2,r),f=this.extent*i,g=this.extent*e,v=this.loadGeometry(),S=ks.types[this.type];function I($){for(var O=0;O<$.length;O++){var U=$[O];$[O]=[360*(U.x+f)/d-180,360/Math.PI*Math.atan(Math.exp((180-360*(U.y+g)/d)*Math.PI/180))-90]}}switch(this.type){case 1:var M=[];for(a=0;a<v.length;a++)M[a]=v[a][0];I(v=M);break;case 2:for(a=0;a<v.length;a++)I(v[a]);break;case 3:for(v=function($){var O=$.length;if(O<=1)return[$];for(var U,X,ee=[],le=0;le<O;le++){var ie=Im($[le]);ie!==0&&(X===void 0&&(X=ie<0),X===ie<0?(U&&ee.push(U),U=[$[le]]):U.push($[le]))}return U&&ee.push(U),ee}(v),a=0;a<v.length;a++)for(l=0;l<v[a].length;l++)I(v[a][l])}v.length===1?v=v[0]:S="Multi"+S;var D={type:"Feature",geometry:{type:S,coordinates:v},properties:this.properties};return"id"in this&&(D.id=this.id),D};var Em=Ah,kh=zh;function zh(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(Pm,this,e),this.length=this._features.length}function Pm(i,e,r){i===15?e.version=r.readVarint():i===1?e.name=r.readString():i===5?e.extent=r.readVarint():i===2?e._features.push(r.pos):i===3?e._keys.push(r.readString()):i===4&&e._values.push(function(a){for(var l=null,d=a.readVarint()+a.pos;a.pos<d;){var f=a.readVarint()>>3;l=f===1?a.readString():f===2?a.readFloat():f===3?a.readDouble():f===4?a.readVarint64():f===5?a.readVarint():f===6?a.readSVarint():f===7?a.readBoolean():null}return l}(r))}zh.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new Em(this._pbf,e,this.extent,this._keys,this._values)};var Mm=kh;function Am(i,e,r){if(i===3){var a=new Mm(r,r.readVarint()+r.pos);a.length&&(e[a.name]=a)}}_a.VectorTile=function(i,e){this.layers=i.readFields(Am,{},e)},_a.VectorTileFeature=Ah,_a.VectorTileLayer=kh;const km=_a.VectorTileFeature.types,su=Math.pow(2,13);function No(i,e,r,a,l,d,f,g){i.emplaceBack(e,r,2*Math.floor(a*su)+f,l*su*2,d*su*2,Math.round(g))}class ou{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Ze,this.centroidVertexArray=new Ve,this.indexArray=new lr,this.programConfigurations=new bn(e.layers,e.zoom),this.segments=new vi,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a){this.features=[],this.hasPattern=ru("fill-extrusion",this.layers,r);for(const{feature:l,id:d,index:f,sourceLayerIndex:g}of e){const v=this.layers[0]._featureFilter.needGeometry,S=qa(l,v);if(!this.layers[0]._featureFilter.filter(new yi(this.zoom),S,a))continue;const I={id:d,sourceLayerIndex:g,index:f,geometry:v?S.geometry:Ua(l),properties:l.properties,type:l.type,patterns:{}};this.hasPattern?this.features.push(nu("fill-extrusion",this.layers,I,this.zoom,r)):this.addFeature(I,I.geometry,f,a,{}),r.featureIndex.insert(l,I.geometry,f,g,this.index,!0)}}addFeatures(e,r,a){for(const l of this.features){const{geometry:d}=l;this.addFeature(l,d,l.index,r,a)}}update(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Sm),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,wm.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,r,a,l,d){const f={x:0,y:0,vertexCount:0};for(const g of iu(r,500)){let v=0;for(const O of g)v+=O.length;let S=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const O of g){if(O.length===0||Dm(O))continue;let U=0;for(let X=0;X<O.length;X++){const ee=O[X];if(X>=1){const le=O[X-1];if(!zm(ee,le)){S.vertexLength+4>vi.MAX_VERTEX_ARRAY_LENGTH&&(S=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ie=ee.sub(le)._perp()._unit(),ue=le.dist(ee);U+ue>32768&&(U=0),No(this.layoutVertexArray,ee.x,ee.y,ie.x,ie.y,0,0,U),No(this.layoutVertexArray,ee.x,ee.y,ie.x,ie.y,0,1,U),f.x+=2*ee.x,f.y+=2*ee.y,f.vertexCount+=2,U+=ue,No(this.layoutVertexArray,le.x,le.y,ie.x,ie.y,0,0,U),No(this.layoutVertexArray,le.x,le.y,ie.x,ie.y,0,1,U),f.x+=2*le.x,f.y+=2*le.y,f.vertexCount+=2;const pe=S.vertexLength;this.indexArray.emplaceBack(pe,pe+2,pe+1),this.indexArray.emplaceBack(pe+1,pe+2,pe+3),S.vertexLength+=4,S.primitiveLength+=2}}}}if(S.vertexLength+v>vi.MAX_VERTEX_ARRAY_LENGTH&&(S=this.segments.prepareSegment(v,this.layoutVertexArray,this.indexArray)),km[e.type]!=="Polygon")continue;const I=[],M=[],D=S.vertexLength;for(const O of g)if(O.length!==0){O!==g[0]&&M.push(I.length/2);for(let U=0;U<O.length;U++){const X=O[U];No(this.layoutVertexArray,X.x,X.y,0,0,1,1,0),f.x+=X.x,f.y+=X.y,f.vertexCount+=1,I.push(X.x),I.push(X.y)}}const $=Ih(I,M);for(let O=0;O<$.length;O+=3)this.indexArray.emplaceBack(D+$[O],D+$[O+2],D+$[O+1]);S.primitiveLength+=$.length/3,S.vertexLength+=v}for(let g=0;g<f.vertexCount;g++)this.centroidVertexArray.emplaceBack(Math.floor(f.x/f.vertexCount),Math.floor(f.y/f.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,d,l)}}function zm(i,e){return i.x===e.x&&(i.x<0||i.x>Hi)||i.y===e.y&&(i.y<0||i.y>Hi)}function Dm(i){return i.every(e=>e.x<0)||i.every(e=>e.x>Hi)||i.every(e=>e.y<0)||i.every(e=>e.y>Hi)}let Dh;it("FillExtrusionBucket",ou,{omit:["layers","features"]});var Lm={get paint(){return Dh=Dh||new ji({"fill-extrusion-opacity":new pt(_e["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new vt(_e["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new pt(_e["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new pt(_e["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Na(_e["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new vt(_e["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new vt(_e["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new pt(_e["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Rm extends Xr{constructor(e){super(e,Lm)}createBucket(e){return new ou(e)}queryRadius(){return Xl(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(e,r,a,l,d,f,g,v){const S=Kl(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,g),I=this.paint.get("fill-extrusion-height").evaluate(r,a),M=this.paint.get("fill-extrusion-base").evaluate(r,a),D=function(O,U,X,ee){const le=[];for(const ie of O){const ue=[ie.x,ie.y,0,1];Yl(ue,ue,U),le.push(new te(ue[0]/ue[3],ue[1]/ue[3]))}return le}(S,v),$=function(O,U,X,ee){const le=[],ie=[],ue=ee[8]*U,pe=ee[9]*U,ke=ee[10]*U,et=ee[11]*U,lt=ee[8]*X,Je=ee[9]*X,He=ee[10]*X,qe=ee[11]*X;for(const rt of O){const Ge=[],Oe=[];for(const _t of rt){const ht=_t.x,Nt=_t.y,xi=ee[0]*ht+ee[4]*Nt+ee[12],Ci=ee[1]*ht+ee[5]*Nt+ee[13],er=ee[2]*ht+ee[6]*Nt+ee[14],Yr=ee[3]*ht+ee[7]*Nt+ee[15],Pr=er+ke,Wi=Yr+et,ur=xi+lt,fr=Ci+Je,Mr=er+He,Ar=Yr+qe,tr=new te((xi+ue)/Wi,(Ci+pe)/Wi);tr.z=Pr/Wi,Ge.push(tr);const ir=new te(ur/Ar,fr/Ar);ir.z=Mr/Ar,Oe.push(ir)}le.push(Ge),ie.push(Oe)}return[le,ie]}(l,M,I,v);return function(O,U,X){let ee=1/0;uh(X,U)&&(ee=Lh(X,U[0]));for(let le=0;le<U.length;le++){const ie=U[le],ue=O[le];for(let pe=0;pe<ie.length-1;pe++){const ke=ie[pe],et=[ke,ie[pe+1],ue[pe+1],ue[pe],ke];ch(X,et)&&(ee=Math.min(ee,Lh(X,et)))}}return ee!==1/0&&ee}($[0],$[1],D)}}function jo(i,e){return i.x*e.x+i.y*e.y}function Lh(i,e){if(i.length===1){let r=0;const a=e[r++];let l;for(;!l||a.equals(l);)if(l=e[r++],!l)return 1/0;for(;r<e.length;r++){const d=e[r],f=i[0],g=l.sub(a),v=d.sub(a),S=f.sub(a),I=jo(g,g),M=jo(g,v),D=jo(v,v),$=jo(S,g),O=jo(S,v),U=I*D-M*M,X=(D*$-M*O)/U,ee=(I*O-M*$)/U,le=a.z*(1-X-ee)+l.z*X+d.z*ee;if(isFinite(le))return le}return 1/0}{let r=1/0;for(const a of e)r=Math.min(r,a.z);return r}}const Bm=Pi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Fm}=Bm,$m=Pi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Om}=$m,Nm=_a.VectorTileFeature.types,jm=Math.cos(Math.PI/180*37.5),Rh=Math.pow(2,14)/.5;class lu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new xt,this.layoutVertexArray2=new ut,this.indexArray=new lr,this.programConfigurations=new bn(e.layers,e.zoom),this.segments=new vi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a){this.hasPattern=ru("line",this.layers,r);const l=this.layers[0].layout.get("line-sort-key"),d=!l.isConstant(),f=[];for(const{feature:g,id:v,index:S,sourceLayerIndex:I}of e){const M=this.layers[0]._featureFilter.needGeometry,D=qa(g,M);if(!this.layers[0]._featureFilter.filter(new yi(this.zoom),D,a))continue;const $=d?l.evaluate(D,{},a):void 0,O={id:v,properties:g.properties,type:g.type,sourceLayerIndex:I,index:S,geometry:M?D.geometry:Ua(g),patterns:{},sortKey:$};f.push(O)}d&&f.sort((g,v)=>g.sortKey-v.sortKey);for(const g of f){const{geometry:v,index:S,sourceLayerIndex:I}=g;if(this.hasPattern){const M=nu("line",this.layers,g,this.zoom,r);this.patternFeatures.push(M)}else this.addFeature(g,v,S,a,{});r.featureIndex.insert(e[S].feature,v,S,I,this.index)}}update(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a)}addFeatures(e,r,a){for(const l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,r,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Om)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Fm),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,a,l,d){const f=this.layers[0].layout,g=f.get("line-join").evaluate(e,{}),v=f.get("line-cap"),S=f.get("line-miter-limit"),I=f.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const M of r)this.addLine(M,e,g,v,S,I);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,d,l)}addLine(e,r,a,l,d,f){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ee=0;ee<e.length-1;ee++)this.totalDistance+=e[ee].dist(e[ee+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const g=Nm[r.type]==="Polygon";let v=e.length;for(;v>=2&&e[v-1].equals(e[v-2]);)v--;let S=0;for(;S<v-1&&e[S].equals(e[S+1]);)S++;if(v<(g?3:2))return;a==="bevel"&&(d=1.05);const I=this.overscaling<=16?15*Hi/(512*this.overscaling):0,M=this.segments.prepareSegment(10*v,this.layoutVertexArray,this.indexArray);let D,$,O,U,X;this.e1=this.e2=-1,g&&(D=e[v-2],X=e[S].sub(D)._unit()._perp());for(let ee=S;ee<v;ee++){if(O=ee===v-1?g?e[S+1]:void 0:e[ee+1],O&&e[ee].equals(O))continue;X&&(U=X),D&&($=D),D=e[ee],X=O?O.sub(D)._unit()._perp():U,U=U||X;let le=U.add(X);le.x===0&&le.y===0||le._unit();const ie=U.x*X.x+U.y*X.y,ue=le.x*X.x+le.y*X.y,pe=ue!==0?1/ue:1/0,ke=2*Math.sqrt(2-2*ue),et=ue<jm&&$&&O,lt=U.x*X.y-U.y*X.x>0;if(et&&ee>S){const qe=D.dist($);if(qe>2*I){const rt=D.sub(D.sub($)._mult(I/qe)._round());this.updateDistance($,rt),this.addCurrentVertex(rt,U,0,0,M),$=rt}}const Je=$&&O;let He=Je?a:g?"butt":l;if(Je&&He==="round"&&(pe<f?He="miter":pe<=2&&(He="fakeround")),He==="miter"&&pe>d&&(He="bevel"),He==="bevel"&&(pe>2&&(He="flipbevel"),pe<d&&(He="miter")),$&&this.updateDistance($,D),He==="miter")le._mult(pe),this.addCurrentVertex(D,le,0,0,M);else if(He==="flipbevel"){if(pe>100)le=X.mult(-1);else{const qe=pe*U.add(X).mag()/U.sub(X).mag();le._perp()._mult(qe*(lt?-1:1))}this.addCurrentVertex(D,le,0,0,M),this.addCurrentVertex(D,le.mult(-1),0,0,M)}else if(He==="bevel"||He==="fakeround"){const qe=-Math.sqrt(pe*pe-1),rt=lt?qe:0,Ge=lt?0:qe;if($&&this.addCurrentVertex(D,U,rt,Ge,M),He==="fakeround"){const Oe=Math.round(180*ke/Math.PI/20);for(let _t=1;_t<Oe;_t++){let ht=_t/Oe;if(ht!==.5){const xi=ht-.5;ht+=ht*xi*(ht-1)*((1.0904+ie*(ie*(3.55645-1.43519*ie)-3.2452))*xi*xi+(.848013+ie*(.215638*ie-1.06021)))}const Nt=X.sub(U)._mult(ht)._add(U)._unit()._mult(lt?-1:1);this.addHalfVertex(D,Nt.x,Nt.y,!1,lt,0,M)}}O&&this.addCurrentVertex(D,X,-rt,-Ge,M)}else if(He==="butt")this.addCurrentVertex(D,le,0,0,M);else if(He==="square"){const qe=$?1:-1;this.addCurrentVertex(D,le,qe,qe,M)}else He==="round"&&($&&(this.addCurrentVertex(D,U,0,0,M),this.addCurrentVertex(D,U,1,1,M,!0)),O&&(this.addCurrentVertex(D,X,-1,-1,M,!0),this.addCurrentVertex(D,X,0,0,M)));if(et&&ee<v-1){const qe=D.dist(O);if(qe>2*I){const rt=D.add(O.sub(D)._mult(I/qe)._round());this.updateDistance(D,rt),this.addCurrentVertex(rt,X,0,0,M),D=rt}}}}addCurrentVertex(e,r,a,l,d,f=!1){const g=r.y*l-r.x,v=-r.y-r.x*l;this.addHalfVertex(e,r.x+r.y*a,r.y-r.x*a,f,!1,a,d),this.addHalfVertex(e,g,v,f,!0,-l,d),this.distance>Rh/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,r,a,l,d,f))}addHalfVertex({x:e,y:r},a,l,d,f,g,v){const S=.5*(this.lineClips?this.scaledDistance*(Rh-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(d?1:0),(r<<1)+(f?1:0),Math.round(63*a)+128,Math.round(63*l)+128,1+(g===0?0:g<0?-1:1)|(63&S)<<2,S>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const I=v.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,I),v.primitiveLength++),f?this.e2=I:this.e1=I}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}let Bh,Fh;it("LineBucket",lu,{omit:["layers","patternFeatures"]});var $h={get paint(){return Fh=Fh||new ji({"line-opacity":new vt(_e.paint_line["line-opacity"]),"line-color":new vt(_e.paint_line["line-color"]),"line-translate":new pt(_e.paint_line["line-translate"]),"line-translate-anchor":new pt(_e.paint_line["line-translate-anchor"]),"line-width":new vt(_e.paint_line["line-width"]),"line-gap-width":new vt(_e.paint_line["line-gap-width"]),"line-offset":new vt(_e.paint_line["line-offset"]),"line-blur":new vt(_e.paint_line["line-blur"]),"line-dasharray":new Co(_e.paint_line["line-dasharray"]),"line-pattern":new Na(_e.paint_line["line-pattern"]),"line-gradient":new To(_e.paint_line["line-gradient"])})},get layout(){return Bh=Bh||new ji({"line-cap":new pt(_e.layout_line["line-cap"]),"line-join":new vt(_e.layout_line["line-join"]),"line-miter-limit":new pt(_e.layout_line["line-miter-limit"]),"line-round-limit":new pt(_e.layout_line["line-round-limit"]),"line-sort-key":new vt(_e.layout_line["line-sort-key"])})}};class Vm extends vt{possiblyEvaluate(e,r){return r=new yi(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(e,r)}evaluate(e,r,a,l){return r=Fe({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(e,r,a,l)}}let ic;class Um extends Xr{constructor(e){super(e,$h),this.gradientVersion=0,ic||(ic=new Vm($h.paint.properties["line-width"].specification),ic.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!function(a){return a._styleExpression!==void 0}(r)&&r._styleExpression.expression instanceof kn,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,r){super.recalculate(e,r),this.paint._values["line-floorwidth"]=ic.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new lu(e)}queryRadius(e){const r=e,a=Oh(Do("line-width",this,r),Do("line-gap-width",this,r)),l=Do("line-offset",this,r);return a/2+Math.abs(l)+Xl(this.paint.get("line-translate"))}queryIntersectsFeature(e,r,a,l,d,f,g){const v=Kl(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,g),S=g/2*Oh(this.paint.get("line-width").evaluate(r,a),this.paint.get("line-gap-width").evaluate(r,a)),I=this.paint.get("line-offset").evaluate(r,a);return I&&(l=function(M,D){const $=[];for(let O=0;O<M.length;O++){const U=M[O],X=[];for(let ee=0;ee<U.length;ee++){const le=U[ee-1],ie=U[ee],ue=U[ee+1],pe=ee===0?new te(0,0):ie.sub(le)._unit()._perp(),ke=ee===U.length-1?new te(0,0):ue.sub(ie)._unit()._perp(),et=pe._add(ke)._unit(),lt=et.x*ke.x+et.y*ke.y;lt!==0&&et._mult(1/lt),X.push(et._mult(D)._add(ie))}$.push(X)}return $}(l,I*g)),function(M,D,$){for(let O=0;O<D.length;O++){const U=D[O];if(M.length>=3){for(let X=0;X<U.length;X++)if(Ps(M,U[X]))return!0}if(Xf(M,U,$))return!0}return!1}(v,l,S)}isTileClipped(){return!0}}function Oh(i,e){return e>0?e+2*i:i}const qm=Pi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Gm=Pi([{name:"a_projected_pos",components:3,type:"Float32"}],4);Pi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Zm=Pi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Pi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Nh=Pi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Hm=Pi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Wm(i,e,r){return i.sections.forEach(a=>{a.text=function(l,d,f){const g=d.layout.get("text-transform").evaluate(f,{});return g==="uppercase"?l=l.toLocaleUpperCase():g==="lowercase"&&(l=l.toLocaleLowerCase()),Br.applyArabicShaping&&(l=Br.applyArabicShaping(l)),l}(a.text,e,r)}),i}Pi([{name:"triangle",components:3,type:"Uint16"}]),Pi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Pi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Pi([{type:"Float32",name:"offsetX"}]),Pi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Pi([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Vo={"!":"ï¸•","#":"ï¼ƒ",$:"ï¼„","%":"ï¼…","&":"ï¼†","(":"ï¸µ",")":"ï¸¶","*":"ï¼Š","+":"ï¼‹",",":"ï¸","-":"ï¸²",".":"ãƒ»","/":"ï¼",":":"ï¸“",";":"ï¸”","<":"ï¸¿","=":"ï¼",">":"ï¹€","?":"ï¸–","@":"ï¼ ","[":"ï¹‡","\\":"ï¼¼","]":"ï¹ˆ","^":"ï¼¾",_:"ï¸³","`":"ï½€","{":"ï¸·","|":"â€•","}":"ï¸¸","~":"ï½ž","Â¢":"ï¿ ","Â£":"ï¿¡","Â¥":"ï¿¥","Â¦":"ï¿¤","Â¬":"ï¿¢","Â¯":"ï¿£","â€“":"ï¸²","â€”":"ï¸±","â€˜":"ï¹ƒ","â€™":"ï¹„","â€œ":"ï¹","â€":"ï¹‚","â€¦":"ï¸™","â€§":"ãƒ»","â‚©":"ï¿¦","ã€":"ï¸‘","ã€‚":"ï¸’","ã€ˆ":"ï¸¿","ã€‰":"ï¹€","ã€Š":"ï¸½","ã€‹":"ï¸¾","ã€Œ":"ï¹","ã€":"ï¹‚","ã€Ž":"ï¹ƒ","ã€":"ï¹„","ã€":"ï¸»","ã€‘":"ï¸¼","ã€”":"ï¸¹","ã€•":"ï¸º","ã€–":"ï¸—","ã€—":"ï¸˜","ï¼":"ï¸•","ï¼ˆ":"ï¸µ","ï¼‰":"ï¸¶","ï¼Œ":"ï¸","ï¼":"ï¸²","ï¼Ž":"ãƒ»","ï¼š":"ï¸“","ï¼›":"ï¸”","ï¼œ":"ï¸¿","ï¼ž":"ï¹€","ï¼Ÿ":"ï¸–","ï¼»":"ï¹‡","ï¼½":"ï¹ˆ","ï¼¿":"ï¸³","ï½›":"ï¸·","ï½œ":"â€•","ï½":"ï¸¸","ï½Ÿ":"ï¸µ","ï½ ":"ï¸¶","ï½¡":"ï¸’","ï½¢":"ï¹","ï½£":"ï¹‚"};var Qi=24,jh=di,Vh=function(i,e,r,a,l){var d,f,g=8*l-a-1,v=(1<<g)-1,S=v>>1,I=-7,M=r?l-1:0,D=r?-1:1,$=i[e+M];for(M+=D,d=$&(1<<-I)-1,$>>=-I,I+=g;I>0;d=256*d+i[e+M],M+=D,I-=8);for(f=d&(1<<-I)-1,d>>=-I,I+=a;I>0;f=256*f+i[e+M],M+=D,I-=8);if(d===0)d=1-S;else{if(d===v)return f?NaN:1/0*($?-1:1);f+=Math.pow(2,a),d-=S}return($?-1:1)*f*Math.pow(2,d-a)},Uh=function(i,e,r,a,l,d){var f,g,v,S=8*d-l-1,I=(1<<S)-1,M=I>>1,D=l===23?Math.pow(2,-24)-Math.pow(2,-77):0,$=a?0:d-1,O=a?1:-1,U=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(g=isNaN(e)?1:0,f=I):(f=Math.floor(Math.log(e)/Math.LN2),e*(v=Math.pow(2,-f))<1&&(f--,v*=2),(e+=f+M>=1?D/v:D*Math.pow(2,1-M))*v>=2&&(f++,v/=2),f+M>=I?(g=0,f=I):f+M>=1?(g=(e*v-1)*Math.pow(2,l),f+=M):(g=e*Math.pow(2,M-1)*Math.pow(2,l),f=0));l>=8;i[r+$]=255&g,$+=O,g/=256,l-=8);for(f=f<<l|g,S+=l;S>0;i[r+$]=255&f,$+=O,f/=256,S-=8);i[r+$-O]|=128*U};function di(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}di.Varint=0,di.Fixed64=1,di.Bytes=2,di.Fixed32=5;var cu=4294967296,qh=1/cu,Gh=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ea(i){return i.type===di.Bytes?i.readVarint()+i.pos:i.pos+1}function zs(i,e,r){return r?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function Zh(i,e,r){var a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(a);for(var l=r.pos-1;l>=i;l--)r.buf[l+a]=r.buf[l]}function Xm(i,e){for(var r=0;r<i.length;r++)e.writeVarint(i[r])}function Km(i,e){for(var r=0;r<i.length;r++)e.writeSVarint(i[r])}function Ym(i,e){for(var r=0;r<i.length;r++)e.writeFloat(i[r])}function Jm(i,e){for(var r=0;r<i.length;r++)e.writeDouble(i[r])}function Qm(i,e){for(var r=0;r<i.length;r++)e.writeBoolean(i[r])}function eg(i,e){for(var r=0;r<i.length;r++)e.writeFixed32(i[r])}function tg(i,e){for(var r=0;r<i.length;r++)e.writeSFixed32(i[r])}function ig(i,e){for(var r=0;r<i.length;r++)e.writeFixed64(i[r])}function rg(i,e){for(var r=0;r<i.length;r++)e.writeSFixed64(i[r])}function rc(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function Ds(i,e,r){i[r]=e,i[r+1]=e>>>8,i[r+2]=e>>>16,i[r+3]=e>>>24}function Hh(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}di.prototype={destroy:function(){this.buf=null},readFields:function(i,e,r){for(r=r||this.length;this.pos<r;){var a=this.readVarint(),l=a>>3,d=this.pos;this.type=7&a,i(l,e,this),this.pos===d&&this.skip(a)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=rc(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Hh(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=rc(this.buf,this.pos)+rc(this.buf,this.pos+4)*cu;return this.pos+=8,i},readSFixed64:function(){var i=rc(this.buf,this.pos)+Hh(this.buf,this.pos+4)*cu;return this.pos+=8,i},readFloat:function(){var i=Vh(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Vh(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,r,a=this.buf;return e=127&(r=a[this.pos++]),r<128?e:(e|=(127&(r=a[this.pos++]))<<7,r<128?e:(e|=(127&(r=a[this.pos++]))<<14,r<128?e:(e|=(127&(r=a[this.pos++]))<<21,r<128?e:function(l,d,f){var g,v,S=f.buf;if(g=(112&(v=S[f.pos++]))>>4,v<128||(g|=(127&(v=S[f.pos++]))<<3,v<128)||(g|=(127&(v=S[f.pos++]))<<10,v<128)||(g|=(127&(v=S[f.pos++]))<<17,v<128)||(g|=(127&(v=S[f.pos++]))<<24,v<128)||(g|=(1&(v=S[f.pos++]))<<31,v<128))return zs(l,g,d);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=a[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&Gh?function(r,a,l){return Gh.decode(r.subarray(a,l))}(this.buf,e,i):function(r,a,l){for(var d="",f=a;f<l;){var g,v,S,I=r[f],M=null,D=I>239?4:I>223?3:I>191?2:1;if(f+D>l)break;D===1?I<128&&(M=I):D===2?(192&(g=r[f+1]))==128&&(M=(31&I)<<6|63&g)<=127&&(M=null):D===3?(v=r[f+2],(192&(g=r[f+1]))==128&&(192&v)==128&&((M=(15&I)<<12|(63&g)<<6|63&v)<=2047||M>=55296&&M<=57343)&&(M=null)):D===4&&(v=r[f+2],S=r[f+3],(192&(g=r[f+1]))==128&&(192&v)==128&&(192&S)==128&&((M=(15&I)<<18|(63&g)<<12|(63&v)<<6|63&S)<=65535||M>=1114112)&&(M=null)),M===null?(M=65533,D=1):M>65535&&(M-=65536,d+=String.fromCharCode(M>>>10&1023|55296),M=56320|1023&M),d+=String.fromCharCode(M),f+=D}return d}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==di.Bytes)return i.push(this.readVarint(e));var r=ea(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==di.Bytes)return i.push(this.readSVarint());var e=ea(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==di.Bytes)return i.push(this.readBoolean());var e=ea(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==di.Bytes)return i.push(this.readFloat());var e=ea(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==di.Bytes)return i.push(this.readDouble());var e=ea(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==di.Bytes)return i.push(this.readFixed32());var e=ea(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==di.Bytes)return i.push(this.readSFixed32());var e=ea(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==di.Bytes)return i.push(this.readFixed64());var e=ea(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==di.Bytes)return i.push(this.readSFixed64());var e=ea(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===di.Varint)for(;this.buf[this.pos++]>127;);else if(e===di.Bytes)this.pos=this.readVarint()+this.pos;else if(e===di.Fixed32)this.pos+=4;else{if(e!==di.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Ds(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Ds(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Ds(this.buf,-1&i,this.pos),Ds(this.buf,Math.floor(i*qh),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Ds(this.buf,-1&i,this.pos),Ds(this.buf,Math.floor(i*qh),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,r){var a,l;if(e>=0?(a=e%4294967296|0,l=e/4294967296|0):(l=~(-e/4294967296),4294967295^(a=~(-e%4294967296))?a=a+1|0:(a=0,l=l+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(d,f,g){g.buf[g.pos++]=127&d|128,d>>>=7,g.buf[g.pos++]=127&d|128,d>>>=7,g.buf[g.pos++]=127&d|128,d>>>=7,g.buf[g.pos++]=127&d|128,g.buf[g.pos]=127&(d>>>=7)}(a,0,r),function(d,f){var g=(7&d)<<4;f.buf[f.pos++]|=g|((d>>>=3)?128:0),d&&(f.buf[f.pos++]=127&d|((d>>>=7)?128:0),d&&(f.buf[f.pos++]=127&d|((d>>>=7)?128:0),d&&(f.buf[f.pos++]=127&d|((d>>>=7)?128:0),d&&(f.buf[f.pos++]=127&d|((d>>>=7)?128:0),d&&(f.buf[f.pos++]=127&d)))))}(l,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(a,l,d){for(var f,g,v=0;v<l.length;v++){if((f=l.charCodeAt(v))>55295&&f<57344){if(!g){f>56319||v+1===l.length?(a[d++]=239,a[d++]=191,a[d++]=189):g=f;continue}if(f<56320){a[d++]=239,a[d++]=191,a[d++]=189,g=f;continue}f=g-55296<<10|f-56320|65536,g=null}else g&&(a[d++]=239,a[d++]=191,a[d++]=189,g=null);f<128?a[d++]=f:(f<2048?a[d++]=f>>6|192:(f<65536?a[d++]=f>>12|224:(a[d++]=f>>18|240,a[d++]=f>>12&63|128),a[d++]=f>>6&63|128),a[d++]=63&f|128)}return d}(this.buf,i,this.pos);var r=this.pos-e;r>=128&&Zh(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),Uh(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Uh(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,e){this.pos++;var r=this.pos;i(e,this);var a=this.pos-r;a>=128&&Zh(r,a,this),this.pos=r-1,this.writeVarint(a),this.pos+=a},writeMessage:function(i,e,r){this.writeTag(i,di.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,Xm,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,Km,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,Qm,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,Ym,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,Jm,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,eg,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,tg,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,ig,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,rg,e)},writeBytesField:function(i,e){this.writeTag(i,di.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,di.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,di.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,di.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,di.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,di.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,di.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,di.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,di.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,di.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,!!e)}};var uu=L(jh);const hu=3;function ng(i,e,r){i===1&&r.readMessage(ag,e)}function ag(i,e,r){if(i===3){const{id:a,bitmap:l,width:d,height:f,left:g,top:v,advance:S}=r.readMessage(sg,{});e.push({id:a,bitmap:new Ro({width:d+2*hu,height:f+2*hu},l),metrics:{width:d,height:f,left:g,top:v,advance:S}})}}function sg(i,e,r){i===1?e.id=r.readVarint():i===2?e.bitmap=r.readBytes():i===3?e.width=r.readVarint():i===4?e.height=r.readVarint():i===5?e.left=r.readSVarint():i===6?e.top=r.readSVarint():i===7&&(e.advance=r.readVarint())}const Wh=hu;function Xh(i){let e=0,r=0;for(const f of i)e+=f.w*f.h,r=Math.max(r,f.w);i.sort((f,g)=>g.h-f.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let l=0,d=0;for(const f of i)for(let g=a.length-1;g>=0;g--){const v=a[g];if(!(f.w>v.w||f.h>v.h)){if(f.x=v.x,f.y=v.y,d=Math.max(d,f.y+f.h),l=Math.max(l,f.x+f.w),f.w===v.w&&f.h===v.h){const S=a.pop();g<a.length&&(a[g]=S)}else f.h===v.h?(v.x+=f.w,v.w-=f.w):f.w===v.w?(v.y+=f.h,v.h-=f.h):(a.push({x:v.x+f.w,y:v.y,w:v.w-f.w,h:f.h}),v.y+=f.h,v.h-=f.h);break}}return{w:l,h:d,fill:e/(l*d)||0}}const $r=1;class du{constructor(e,{pixelRatio:r,version:a,stretchX:l,stretchY:d,content:f}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=l,this.stretchY=d,this.content=f,this.version=a}get tl(){return[this.paddedRect.x+$r,this.paddedRect.y+$r]}get br(){return[this.paddedRect.x+this.paddedRect.w-$r,this.paddedRect.y+this.paddedRect.h-$r]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*$r)/this.pixelRatio,(this.paddedRect.h-2*$r)/this.pixelRatio]}}class Kh{constructor(e,r){const a={},l={};this.haveRenderCallbacks=[];const d=[];this.addImages(e,a,d),this.addImages(r,l,d);const{w:f,h:g}=Xh(d),v=new Qr({width:f||1,height:g||1});for(const S in e){const I=e[S],M=a[S].paddedRect;Qr.copy(I.data,v,{x:0,y:0},{x:M.x+$r,y:M.y+$r},I.data)}for(const S in r){const I=r[S],M=l[S].paddedRect,D=M.x+$r,$=M.y+$r,O=I.data.width,U=I.data.height;Qr.copy(I.data,v,{x:0,y:0},{x:D,y:$},I.data),Qr.copy(I.data,v,{x:0,y:U-1},{x:D,y:$-1},{width:O,height:1}),Qr.copy(I.data,v,{x:0,y:0},{x:D,y:$+U},{width:O,height:1}),Qr.copy(I.data,v,{x:O-1,y:0},{x:D-1,y:$},{width:1,height:U}),Qr.copy(I.data,v,{x:0,y:0},{x:D+O,y:$},{width:1,height:U})}this.image=v,this.iconPositions=a,this.patternPositions=l}addImages(e,r,a){for(const l in e){const d=e[l],f={x:0,y:0,w:d.data.width+2*$r,h:d.data.height+2*$r};a.push(f),r[l]=new du(f,d),d.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(e,r){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const a in e.updatedImages)this.patchUpdatedImage(this.iconPositions[a],e.getImage(a),r),this.patchUpdatedImage(this.patternPositions[a],e.getImage(a),r)}patchUpdatedImage(e,r,a){if(!e||!r||e.version===r.version)return;e.version=r.version;const[l,d]=e.tl;a.update(r.data,void 0,{x:l,y:d})}}var ya;it("ImagePosition",du),it("ImageAtlas",Kh),s.ai=void 0,(ya=s.ai||(s.ai={}))[ya.none=0]="none",ya[ya.horizontal=1]="horizontal",ya[ya.vertical=2]="vertical",ya[ya.horizontalOnly=3]="horizontalOnly";const Uo=-17;class qo{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const a=new qo;return a.scale=e||1,a.fontStack=r,a}static forImage(e){const r=new qo;return r.imageName=e,r}}class Ls{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const a=new Ls;for(let l=0;l<e.sections.length;l++){const d=e.sections[l];d.image?a.addImageSection(d):a.addTextSection(d,r)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let r="";for(let a=0;a<e.length;a++){const l=e.charCodeAt(a+1)||null,d=e.charCodeAt(a-1)||null;r+=l&&$l(l)&&!Vo[e[a+1]]||d&&$l(d)&&!Vo[e[a-1]]||!Vo[e[a]]?e[a]:Vo[e[a]]}return r}(this.text)}trim(){let e=0;for(let a=0;a<this.text.length&&ac[this.text.charCodeAt(a)];a++)e++;let r=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&ac[this.text.charCodeAt(a)];a--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const a=new Ls;return a.text=this.text.substring(e,r),a.sectionIndex=this.sectionIndex.slice(e,r),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(qo.forText(e.scale,e.fontStack||r));const a=this.sections.length-1;for(let l=0;l<e.text.length;++l)this.sectionIndex.push(a)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void Xe("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(qo.forImage(r)),this.sectionIndex.push(this.sections.length-1)):Xe("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function nc(i,e,r,a,l,d,f,g,v,S,I,M,D,$,O,U){const X=Ls.fromFeature(i,l);let ee;M===s.ai.vertical&&X.verticalizePunctuation();const{processBidirectionalText:le,processStyledBidirectionalText:ie}=Br;if(le&&X.sections.length===1){ee=[];const ke=le(X.toString(),pu(X,S,d,e,a,$,O));for(const et of ke){const lt=new Ls;lt.text=et,lt.sections=X.sections;for(let Je=0;Je<et.length;Je++)lt.sectionIndex.push(0);ee.push(lt)}}else if(ie){ee=[];const ke=ie(X.text,X.sectionIndex,pu(X,S,d,e,a,$,O));for(const et of ke){const lt=new Ls;lt.text=et[0],lt.sectionIndex=et[1],lt.sections=X.sections,ee.push(lt)}}else ee=function(ke,et){const lt=[],Je=ke.text;let He=0;for(const qe of et)lt.push(ke.substring(He,qe)),He=qe;return He<Je.length&&lt.push(ke.substring(He,Je.length)),lt}(X,pu(X,S,d,e,a,$,O));const ue=[],pe={positionedLines:ue,text:X.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:M,iconsInText:!1,verticalizable:!1};return function(ke,et,lt,Je,He,qe,rt,Ge,Oe,_t,ht,Nt){let xi=0,Ci=Uo,er=0,Yr=0;const Pr=Ge==="right"?1:Ge==="left"?0:.5;let Wi=0;for(const tr of He){tr.trim();const ir=tr.getMaxScale(),vr=(ir-1)*Qi,kr={positionedGlyphs:[],lineOffset:0};ke.positionedLines[Wi]=kr;const xr=kr.positionedGlyphs;let Or=0;if(!tr.length()){Ci+=qe,++Wi;continue}for(let rr=0;rr<tr.length();rr++){const Zt=tr.getSection(rr),br=tr.getSectionIndex(rr),mr=tr.getCharCode(rr);let nr=0,pn=null,wn=null,Sn=null,ta=Qi;const fn=!(Oe===s.ai.horizontal||!ht&&!go(mr)||ht&&(ac[mr]||(ur=mr,Qe.Arabic(ur)||Qe["Arabic Supplement"](ur)||Qe["Arabic Extended-A"](ur)||Qe["Arabic Presentation Forms-A"](ur)||Qe["Arabic Presentation Forms-B"](ur))));if(Zt.imageName){const tn=Je[Zt.imageName];if(!tn)continue;Sn=Zt.imageName,ke.iconsInText=ke.iconsInText||!0,wn=tn.paddedRect;const jr=tn.displaySize;Zt.scale=Zt.scale*Qi/Nt,pn={width:jr[0],height:jr[1],left:$r,top:-Wh,advance:fn?jr[1]:jr[0]},nr=vr+(Qi-jr[1]*Zt.scale),ta=pn.advance;const ia=fn?jr[0]*Zt.scale-Qi*ir:jr[1]*Zt.scale-Qi*ir;ia>0&&ia>Or&&(Or=ia)}else{const tn=lt[Zt.fontStack],jr=tn&&tn[mr];if(jr&&jr.rect)wn=jr.rect,pn=jr.metrics;else{const ia=et[Zt.fontStack],Xo=ia&&ia[mr];if(!Xo)continue;pn=Xo.metrics}nr=(ir-Zt.scale)*Qi}fn?(ke.verticalizable=!0,xr.push({glyph:mr,imageName:Sn,x:xi,y:Ci+nr,vertical:fn,scale:Zt.scale,fontStack:Zt.fontStack,sectionIndex:br,metrics:pn,rect:wn}),xi+=ta*Zt.scale+_t):(xr.push({glyph:mr,imageName:Sn,x:xi,y:Ci+nr,vertical:fn,scale:Zt.scale,fontStack:Zt.fontStack,sectionIndex:br,metrics:pn,rect:wn}),xi+=pn.advance*Zt.scale+_t)}xr.length!==0&&(er=Math.max(xi-_t,er),cg(xr,0,xr.length-1,Pr,Or)),xi=0;const Nr=qe*ir+Or;kr.lineOffset=Math.max(Or,vr),Ci+=Nr,Yr=Math.max(Nr,Yr),++Wi}var ur;const fr=Ci-Uo,{horizontalAlign:Mr,verticalAlign:Ar}=fu(rt);(function(tr,ir,vr,kr,xr,Or,Nr,rr,Zt){const br=(ir-vr)*xr;let mr=0;mr=Or!==Nr?-rr*kr-Uo:(-kr*Zt+.5)*Nr;for(const nr of tr)for(const pn of nr.positionedGlyphs)pn.x+=br,pn.y+=mr})(ke.positionedLines,Pr,Mr,Ar,er,Yr,qe,fr,He.length),ke.top+=-Ar*fr,ke.bottom=ke.top+fr,ke.left+=-Mr*er,ke.right=ke.left+er}(pe,e,r,a,ee,f,g,v,M,S,D,U),!function(ke){for(const et of ke)if(et.positionedGlyphs.length!==0)return!1;return!0}(ue)&&pe}const ac={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},og={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Yh(i,e,r,a,l,d){if(e.imageName){const f=a[e.imageName];return f?f.displaySize[0]*e.scale*Qi/d+l:0}{const f=r[e.fontStack],g=f&&f[i];return g?g.metrics.advance*e.scale+l:0}}function Jh(i,e,r,a){const l=Math.pow(i-e,2);return a?i<e?l/2:2*l:l+Math.abs(r)*r}function lg(i,e,r){let a=0;return i===10&&(a-=1e4),r&&(a+=150),i!==40&&i!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function Qh(i,e,r,a,l,d){let f=null,g=Jh(e,r,l,d);for(const v of a){const S=Jh(e-v.x,r,l,d)+v.badness;S<=g&&(f=v,g=S)}return{index:i,x:e,priorBreak:f,badness:g}}function ed(i){return i?ed(i.priorBreak).concat(i.index):[]}function pu(i,e,r,a,l,d,f){if(d!=="point")return[];if(!i)return[];const g=[],v=function(D,$,O,U,X,ee){let le=0;for(let ie=0;ie<D.length();ie++){const ue=D.getSection(ie);le+=Yh(D.getCharCode(ie),ue,U,X,$,ee)}return le/Math.max(1,Math.ceil(le/O))}(i,e,r,a,l,f),S=i.text.indexOf("â€‹")>=0;let I=0;for(let D=0;D<i.length();D++){const $=i.getSection(D),O=i.getCharCode(D);if(ac[O]||(I+=Yh(O,$,a,l,e,f)),D<i.length()-1){const U=!((M=O)<11904||!(Qe["Bopomofo Extended"](M)||Qe.Bopomofo(M)||Qe["CJK Compatibility Forms"](M)||Qe["CJK Compatibility Ideographs"](M)||Qe["CJK Compatibility"](M)||Qe["CJK Radicals Supplement"](M)||Qe["CJK Strokes"](M)||Qe["CJK Symbols and Punctuation"](M)||Qe["CJK Unified Ideographs Extension A"](M)||Qe["CJK Unified Ideographs"](M)||Qe["Enclosed CJK Letters and Months"](M)||Qe["Halfwidth and Fullwidth Forms"](M)||Qe.Hiragana(M)||Qe["Ideographic Description Characters"](M)||Qe["Kangxi Radicals"](M)||Qe["Katakana Phonetic Extensions"](M)||Qe.Katakana(M)||Qe["Vertical Forms"](M)||Qe["Yi Radicals"](M)||Qe["Yi Syllables"](M)));(og[O]||U||$.imageName)&&g.push(Qh(D+1,I,v,g,lg(O,i.getCharCode(D+1),U&&S),!1))}}var M;return ed(Qh(i.length(),I,v,g,0,!0))}function fu(i){let e=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function cg(i,e,r,a,l){if(!a&&!l)return;const d=i[r],f=(i[r].x+d.metrics.advance*d.scale)*a;for(let g=e;g<=r;g++)i[g].x-=f,i[g].y+=l}function ug(i,e,r){const{horizontalAlign:a,verticalAlign:l}=fu(r),d=e[0]-i.displaySize[0]*a,f=e[1]-i.displaySize[1]*l;return{image:i,top:f,bottom:f+i.displaySize[1],left:d,right:d+i.displaySize[0]}}function td(i,e,r,a,l,d){const f=i.image;let g;if(f.content){const X=f.content,ee=f.pixelRatio||1;g=[X[0]/ee,X[1]/ee,f.displaySize[0]-X[2]/ee,f.displaySize[1]-X[3]/ee]}const v=e.left*d,S=e.right*d;let I,M,D,$;r==="width"||r==="both"?($=l[0]+v-a[3],M=l[0]+S+a[1]):($=l[0]+(v+S-f.displaySize[0])/2,M=$+f.displaySize[0]);const O=e.top*d,U=e.bottom*d;return r==="height"||r==="both"?(I=l[1]+O-a[0],D=l[1]+U+a[2]):(I=l[1]+(O+U-f.displaySize[1])/2,D=I+f.displaySize[1]),{image:f,top:I,right:M,bottom:D,left:$,collisionPadding:g}}const Go=255,Bn=128,va=Go*Bn;function id(i,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new yi(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:l}=r;let d=0;for(;d<a.length&&a[d]<=i;)d++;d=Math.max(0,d-1);let f=d;for(;f<a.length&&a[f]<i+1;)f++;f=Math.min(a.length-1,f);const g=a[d],v=a[f];return r.kind==="composite"?{kind:"composite",minZoom:g,maxZoom:v,interpolationType:l}:{kind:"camera",minZoom:g,maxZoom:v,minSize:r.evaluate(new yi(g)),maxSize:r.evaluate(new yi(v)),interpolationType:l}}}function mu(i,e,r){let a="never";const l=i.get(e);return l?a=l:i.get(r)&&(a="always"),a}const hg=_a.VectorTileFeature.types,dg=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function sc(i,e,r,a,l,d,f,g,v,S,I,M,D){const $=g?Math.min(va,Math.round(g[0])):0,O=g?Math.min(va,Math.round(g[1])):0;i.emplaceBack(e,r,Math.round(32*a),Math.round(32*l),d,f,($<<1)+(v?1:0),O,16*S,16*I,256*M,256*D)}function gu(i,e,r){i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r)}function pg(i){for(const e of i.sections)if(Vc(e.text))return!0;return!1}class _u{constructor(e){this.layoutVertexArray=new Vt,this.indexArray=new lr,this.programConfigurations=e,this.segments=new vi,this.dynamicLayoutVertexArray=new Lt,this.opacityVertexArray=new qt,this.hasVisibleVertices=!1,this.placedSymbolArray=new ae}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,a,l){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,qm.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Gm.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,dg,!0),this.opacityVertexBuffer.itemSize=1),(a||l)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}it("SymbolBuffers",_u);class yu{constructor(e,r,a){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new a,this.segments=new vi,this.collisionVertexArray=new fi}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Zm.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}it("CollisionBuffers",yu);class Rs{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(f=>f.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Xc([]),this.placementViewportMatrix=Xc([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=id(this.zoom,r["text-size"]),this.iconSizeData=id(this.zoom,r["icon-size"]);const a=this.layers[0].layout,l=a.get("symbol-sort-key"),d=a.get("symbol-z-order");this.canOverlap=mu(a,"text-overlap","text-allow-overlap")!=="never"||mu(a,"icon-overlap","icon-allow-overlap")!=="never"||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&!l.isConstant(),this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,a.get("symbol-placement")==="point"&&(this.writingModes=a.get("text-writing-mode").map(f=>s.ai[f])),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id),this.sourceID=e.sourceID}createArrays(){this.text=new _u(new bn(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new _u(new bn(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new oe,this.lineVertexArray=new fe,this.symbolInstances=new J,this.textAnchorOffsets=new Me}calculateGlyphDependencies(e,r,a,l,d){for(let f=0;f<e.length;f++)if(r[e.charCodeAt(f)]=!0,(a||l)&&d){const g=Vo[e.charAt(f)];g&&(r[g.charCodeAt(0)]=!0)}}populate(e,r,a){const l=this.layers[0],d=l.layout,f=d.get("text-font"),g=d.get("text-field"),v=d.get("icon-image"),S=(g.value.kind!=="constant"||g.value.value instanceof hr&&!g.value.value.isEmpty()||g.value.value.toString().length>0)&&(f.value.kind!=="constant"||f.value.value.length>0),I=v.value.kind!=="constant"||!!v.value.value||Object.keys(v.parameters).length>0,M=d.get("symbol-sort-key");if(this.features=[],!S&&!I)return;const D=r.iconDependencies,$=r.glyphDependencies,O=r.availableImages,U=new yi(this.zoom);for(const{feature:X,id:ee,index:le,sourceLayerIndex:ie}of e){const ue=l._featureFilter.needGeometry,pe=qa(X,ue);if(!l._featureFilter.filter(U,pe,a))continue;let ke,et;if(ue||(pe.geometry=Ua(X)),S){const Je=l.getValueAndResolveTokens("text-field",pe,a,O),He=hr.factory(Je);pg(He)&&(this.hasRTLText=!0),(!this.hasRTLText||wo()==="unavailable"||this.hasRTLText&&Br.isParsed())&&(ke=Wm(He,l,pe))}if(I){const Je=l.getValueAndResolveTokens("icon-image",pe,a,O);et=Je instanceof or?Je:or.fromString(Je)}if(!ke&&!et)continue;const lt=this.sortFeaturesByKey?M.evaluate(pe,{},a):void 0;if(this.features.push({id:ee,text:ke,icon:et,index:le,sourceLayerIndex:ie,geometry:pe.geometry,properties:X.properties,type:hg[X.type],sortKey:lt}),et&&(D[et.name]=!0),ke){const Je=f.evaluate(pe,{},a).join(","),He=d.get("text-rotation-alignment")!=="viewport"&&d.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(s.ai.vertical)>=0;for(const qe of ke.sections)if(qe.image)D[qe.image.name]=!0;else{const rt=fo(ke.toString()),Ge=qe.fontStack||Je,Oe=$[Ge]=$[Ge]||{};this.calculateGlyphDependencies(qe.text,Oe,He,this.allowVerticalPlacement,rt)}}}d.get("symbol-placement")==="line"&&(this.features=function(X){const ee={},le={},ie=[];let ue=0;function pe(Je){ie.push(X[Je]),ue++}function ke(Je,He,qe){const rt=le[Je];return delete le[Je],le[He]=rt,ie[rt].geometry[0].pop(),ie[rt].geometry[0]=ie[rt].geometry[0].concat(qe[0]),rt}function et(Je,He,qe){const rt=ee[He];return delete ee[He],ee[Je]=rt,ie[rt].geometry[0].shift(),ie[rt].geometry[0]=qe[0].concat(ie[rt].geometry[0]),rt}function lt(Je,He,qe){const rt=qe?He[0][He[0].length-1]:He[0][0];return`${Je}:${rt.x}:${rt.y}`}for(let Je=0;Je<X.length;Je++){const He=X[Je],qe=He.geometry,rt=He.text?He.text.toString():null;if(!rt){pe(Je);continue}const Ge=lt(rt,qe),Oe=lt(rt,qe,!0);if(Ge in le&&Oe in ee&&le[Ge]!==ee[Oe]){const _t=et(Ge,Oe,qe),ht=ke(Ge,Oe,ie[_t].geometry);delete ee[Ge],delete le[Oe],le[lt(rt,ie[ht].geometry,!0)]=ht,ie[_t].geometry=null}else Ge in le?ke(Ge,Oe,qe):Oe in ee?et(Ge,Oe,qe):(pe(Je),ee[Ge]=ue-1,le[Oe]=ue-1)}return ie.filter(Je=>Je.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((X,ee)=>X.sortKey-ee.sortKey)}update(e,r,a){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,a),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,a))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const a=this.lineVertexArray.length;if(e.segment!==void 0){let l=e.dist(r[e.segment+1]),d=e.dist(r[e.segment]);const f={};for(let g=e.segment+1;g<r.length;g++)f[g]={x:r[g].x,y:r[g].y,tileUnitDistanceFromAnchor:l},g<r.length-1&&(l+=r[g+1].dist(r[g]));for(let g=e.segment||0;g>=0;g--)f[g]={x:r[g].x,y:r[g].y,tileUnitDistanceFromAnchor:d},g>0&&(d+=r[g-1].dist(r[g]));for(let g=0;g<r.length;g++){const v=f[g];this.lineVertexArray.emplaceBack(v.x,v.y,v.tileUnitDistanceFromAnchor)}}return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,r,a,l,d,f,g,v,S,I,M,D){const $=e.indexArray,O=e.layoutVertexArray,U=e.segments.prepareSegment(4*r.length,O,$,this.canOverlap?f.sortKey:void 0),X=this.glyphOffsetArray.length,ee=U.vertexLength,le=this.allowVerticalPlacement&&g===s.ai.vertical?Math.PI/2:0,ie=f.text&&f.text.sections;for(let ue=0;ue<r.length;ue++){const{tl:pe,tr:ke,bl:et,br:lt,tex:Je,pixelOffsetTL:He,pixelOffsetBR:qe,minFontScaleX:rt,minFontScaleY:Ge,glyphOffset:Oe,isSDF:_t,sectionIndex:ht}=r[ue],Nt=U.vertexLength,xi=Oe[1];sc(O,v.x,v.y,pe.x,xi+pe.y,Je.x,Je.y,a,_t,He.x,He.y,rt,Ge),sc(O,v.x,v.y,ke.x,xi+ke.y,Je.x+Je.w,Je.y,a,_t,qe.x,He.y,rt,Ge),sc(O,v.x,v.y,et.x,xi+et.y,Je.x,Je.y+Je.h,a,_t,He.x,qe.y,rt,Ge),sc(O,v.x,v.y,lt.x,xi+lt.y,Je.x+Je.w,Je.y+Je.h,a,_t,qe.x,qe.y,rt,Ge),gu(e.dynamicLayoutVertexArray,v,le),$.emplaceBack(Nt,Nt+1,Nt+2),$.emplaceBack(Nt+1,Nt+2,Nt+3),U.vertexLength+=4,U.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Oe[0]),ue!==r.length-1&&ht===r[ue+1].sectionIndex||e.programConfigurations.populatePaintArrays(O.length,f,f.index,{},D,ie&&ie[ht])}e.placedSymbolArray.emplaceBack(v.x,v.y,X,this.glyphOffsetArray.length-X,ee,S,I,v.segment,a?a[0]:0,a?a[1]:0,l[0],l[1],g,0,!1,0,M)}_addCollisionDebugVertex(e,r,a,l,d,f){return r.emplaceBack(0,0),e.emplaceBack(a.x,a.y,l,d,Math.round(f.x),Math.round(f.y))}addCollisionDebugVertices(e,r,a,l,d,f,g){const v=d.segments.prepareSegment(4,d.layoutVertexArray,d.indexArray),S=v.vertexLength,I=d.layoutVertexArray,M=d.collisionVertexArray,D=g.anchorX,$=g.anchorY;this._addCollisionDebugVertex(I,M,f,D,$,new te(e,r)),this._addCollisionDebugVertex(I,M,f,D,$,new te(a,r)),this._addCollisionDebugVertex(I,M,f,D,$,new te(a,l)),this._addCollisionDebugVertex(I,M,f,D,$,new te(e,l)),v.vertexLength+=4;const O=d.indexArray;O.emplaceBack(S,S+1),O.emplaceBack(S+1,S+2),O.emplaceBack(S+2,S+3),O.emplaceBack(S+3,S),v.primitiveLength+=4}addDebugCollisionBoxes(e,r,a,l){for(let d=e;d<r;d++){const f=this.collisionBoxArray.get(d);this.addCollisionDebugVertices(f.x1,f.y1,f.x2,f.y2,l?this.textCollisionBox:this.iconCollisionBox,f.anchorPoint,a)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new yu(Bi,Nh.members,Yi),this.iconCollisionBox=new yu(Bi,Nh.members,Yi);for(let e=0;e<this.symbolInstances.length;e++){const r=this.symbolInstances.get(e);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(e,r,a,l,d,f,g,v,S){const I={};for(let M=r;M<a;M++){const D=e.get(M);I.textBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},I.textFeatureIndex=D.featureIndex;break}for(let M=l;M<d;M++){const D=e.get(M);I.verticalTextBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},I.verticalTextFeatureIndex=D.featureIndex;break}for(let M=f;M<g;M++){const D=e.get(M);I.iconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},I.iconFeatureIndex=D.featureIndex;break}for(let M=v;M<S;M++){const D=e.get(M);I.verticalIconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},I.verticalIconFeatureIndex=D.featureIndex;break}return I}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const a=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const a=e.placedSymbolArray.get(r),l=a.vertexStartIndex+4*a.numGlyphs;for(let d=a.vertexStartIndex;d<l;d+=4)e.indexArray.emplaceBack(d,d+1,d+2),e.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),a=Math.cos(e),l=[],d=[],f=[];for(let g=0;g<this.symbolInstances.length;++g){f.push(g);const v=this.symbolInstances.get(g);l.push(0|Math.round(r*v.anchorX+a*v.anchorY)),d.push(v.featureIndex)}return f.sort((g,v)=>l[g]-l[v]||d[v]-d[g]),f}addToSortKeyRanges(e,r){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===r?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const a=this.symbolInstances.get(r);this.featureSortOrder.push(a.featureIndex),[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach((l,d,f)=>{l>=0&&f.indexOf(l)===d&&this.addIndicesForPlacedSymbol(this.text,l)}),a.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,a.verticalPlacedTextSymbolIndex),a.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.placedIconSymbolIndex),a.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let rd,nd;it("SymbolBucket",Rs,{omit:["layers","collisionBoxArray","features","compareText"]}),Rs.MAX_GLYPHS=65535,Rs.addDynamicAttributes=gu;var vu={get paint(){return nd=nd||new ji({"icon-opacity":new vt(_e.paint_symbol["icon-opacity"]),"icon-color":new vt(_e.paint_symbol["icon-color"]),"icon-halo-color":new vt(_e.paint_symbol["icon-halo-color"]),"icon-halo-width":new vt(_e.paint_symbol["icon-halo-width"]),"icon-halo-blur":new vt(_e.paint_symbol["icon-halo-blur"]),"icon-translate":new pt(_e.paint_symbol["icon-translate"]),"icon-translate-anchor":new pt(_e.paint_symbol["icon-translate-anchor"]),"text-opacity":new vt(_e.paint_symbol["text-opacity"]),"text-color":new vt(_e.paint_symbol["text-color"],{runtimeType:wi,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new vt(_e.paint_symbol["text-halo-color"]),"text-halo-width":new vt(_e.paint_symbol["text-halo-width"]),"text-halo-blur":new vt(_e.paint_symbol["text-halo-blur"]),"text-translate":new pt(_e.paint_symbol["text-translate"]),"text-translate-anchor":new pt(_e.paint_symbol["text-translate-anchor"])})},get layout(){return rd=rd||new ji({"symbol-placement":new pt(_e.layout_symbol["symbol-placement"]),"symbol-spacing":new pt(_e.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new pt(_e.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new vt(_e.layout_symbol["symbol-sort-key"]),"symbol-z-order":new pt(_e.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new pt(_e.layout_symbol["icon-allow-overlap"]),"icon-overlap":new pt(_e.layout_symbol["icon-overlap"]),"icon-ignore-placement":new pt(_e.layout_symbol["icon-ignore-placement"]),"icon-optional":new pt(_e.layout_symbol["icon-optional"]),"icon-rotation-alignment":new pt(_e.layout_symbol["icon-rotation-alignment"]),"icon-size":new vt(_e.layout_symbol["icon-size"]),"icon-text-fit":new pt(_e.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new pt(_e.layout_symbol["icon-text-fit-padding"]),"icon-image":new vt(_e.layout_symbol["icon-image"]),"icon-rotate":new vt(_e.layout_symbol["icon-rotate"]),"icon-padding":new vt(_e.layout_symbol["icon-padding"]),"icon-keep-upright":new pt(_e.layout_symbol["icon-keep-upright"]),"icon-offset":new vt(_e.layout_symbol["icon-offset"]),"icon-anchor":new vt(_e.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new pt(_e.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new pt(_e.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new pt(_e.layout_symbol["text-rotation-alignment"]),"text-field":new vt(_e.layout_symbol["text-field"]),"text-font":new vt(_e.layout_symbol["text-font"]),"text-size":new vt(_e.layout_symbol["text-size"]),"text-max-width":new vt(_e.layout_symbol["text-max-width"]),"text-line-height":new pt(_e.layout_symbol["text-line-height"]),"text-letter-spacing":new vt(_e.layout_symbol["text-letter-spacing"]),"text-justify":new vt(_e.layout_symbol["text-justify"]),"text-radial-offset":new vt(_e.layout_symbol["text-radial-offset"]),"text-variable-anchor":new pt(_e.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new vt(_e.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new vt(_e.layout_symbol["text-anchor"]),"text-max-angle":new pt(_e.layout_symbol["text-max-angle"]),"text-writing-mode":new pt(_e.layout_symbol["text-writing-mode"]),"text-rotate":new vt(_e.layout_symbol["text-rotate"]),"text-padding":new pt(_e.layout_symbol["text-padding"]),"text-keep-upright":new pt(_e.layout_symbol["text-keep-upright"]),"text-transform":new vt(_e.layout_symbol["text-transform"]),"text-offset":new vt(_e.layout_symbol["text-offset"]),"text-allow-overlap":new pt(_e.layout_symbol["text-allow-overlap"]),"text-overlap":new pt(_e.layout_symbol["text-overlap"]),"text-ignore-placement":new pt(_e.layout_symbol["text-ignore-placement"]),"text-optional":new pt(_e.layout_symbol["text-optional"])})}};class ad{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:zt,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}it("FormatSectionOverride",ad,{omit:["defaultValue"]});class oc extends Xr{constructor(e){super(e,vu)}recalculate(e,r){if(super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const a=this.layout.get("text-writing-mode");if(a){const l=[];for(const d of a)l.indexOf(d)<0&&l.push(d);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,r,a,l){const d=this.layout.get(e).evaluate(r,{},a,l),f=this._unevaluatedLayout._values[e];return f.isDataDriven()||ms(f.value)||!d?d:function(g,v){return v.replace(/{([^{}]+)}/g,(S,I)=>g&&I in g?String(g[I]):"")}(r.properties,d)}createBucket(e){return new Rs(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of vu.paint.overridableProperties){if(!oc.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),a=new ad(r),l=new oo(a,r.property.specification);let d=null;d=r.value.kind==="constant"||r.value.kind==="source"?new lo("source",l):new _s("composite",l,r.value.zoomStops),this.paint._values[e]=new _r(r.property,d,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,a){return!(!this.layout||r.isDataDriven()||a.isDataDriven())&&oc.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const a=e.get("text-field"),l=vu.paint.properties[r];let d=!1;const f=g=>{for(const v of g)if(l.overrides&&l.overrides.hasOverride(v))return void(d=!0)};if(a.value.kind==="constant"&&a.value.value instanceof hr)f(a.value.value.sections);else if(a.value.kind==="source"){const g=S=>{d||(S instanceof Vn&&Ti(S.value)===Z?f(S.value.sections):S instanceof fs?f(S.sections):S.eachChild(g))},v=a.value;v._styleExpression&&g(v._styleExpression.expression)}return d}}let sd;var fg={get paint(){return sd=sd||new ji({"background-color":new pt(_e.paint_background["background-color"]),"background-pattern":new Co(_e.paint_background["background-pattern"]),"background-opacity":new pt(_e.paint_background["background-opacity"])})}};class mg extends Xr{constructor(e){super(e,fg)}}let od;var gg={get paint(){return od=od||new ji({"raster-opacity":new pt(_e.paint_raster["raster-opacity"]),"raster-hue-rotate":new pt(_e.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new pt(_e.paint_raster["raster-brightness-min"]),"raster-brightness-max":new pt(_e.paint_raster["raster-brightness-max"]),"raster-saturation":new pt(_e.paint_raster["raster-saturation"]),"raster-contrast":new pt(_e.paint_raster["raster-contrast"]),"raster-resampling":new pt(_e.paint_raster["raster-resampling"]),"raster-fade-duration":new pt(_e.paint_raster["raster-fade-duration"])})}};class _g extends Xr{constructor(e){super(e,gg)}}class yg extends Xr{constructor(e){super(e,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class vg{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const xu=63710088e-1;class xa{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new xa(Ne(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,a=this.lat*r,l=e.lat*r,d=Math.sin(a)*Math.sin(l)+Math.cos(a)*Math.cos(l)*Math.cos((e.lng-this.lng)*r);return xu*Math.acos(Math.min(d,1))}static convert(e){if(e instanceof xa)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new xa(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new xa(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const ld=2*Math.PI*xu;function cd(i){return ld*Math.cos(i*Math.PI/180)}function ud(i){return(180+i)/360}function hd(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function dd(i,e){return i/cd(e)}function pd(i){return 360*i-180}function bu(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class lc{constructor(e,r,a=0){this.x=+e,this.y=+r,this.z=+a}static fromLngLat(e,r=0){const a=xa.convert(e);return new lc(ud(a.lng),hd(a.lat),dd(r,a.lat))}toLngLat(){return new xa(pd(this.x),bu(this.y))}toAltitude(){return this.z*cd(bu(this.y))}meterInMercatorCoordinateUnits(){return 1/ld*(e=bu(this.y),1/Math.cos(e*Math.PI/180));var e}}function fd(i,e,r){var a=2*Math.PI*6378137/256/Math.pow(2,r);return[i*a-2*Math.PI*6378137/2,e*a-2*Math.PI*6378137/2]}class wu{constructor(e,r,a){if(e<0||e>25||a<0||a>=Math.pow(2,e)||r<0||r>=Math.pow(2,e))throw new Error(`x=${r}, y=${a}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=r,this.y=a,this.key=Zo(0,e,e,r,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r,a){const l=(f=this.y,g=this.z,v=fd(256*(d=this.x),256*(f=Math.pow(2,g)-f-1),g),S=fd(256*(d+1),256*(f+1),g),v[0]+","+v[1]+","+S[0]+","+S[1]);var d,f,g,v,S;const I=function(M,D,$){let O,U="";for(let X=M;X>0;X--)O=1<<X-1,U+=(D&O?1:0)+($&O?2:0);return U}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,I).replace(/{bbox-epsg-3857}/g,l)}isChildOf(e){const r=this.z-e.z;return r>0&&e.x===this.x>>r&&e.y===this.y>>r}getTilePoint(e){const r=Math.pow(2,this.z);return new te((e.x*r-this.x)*Hi,(e.y*r-this.y)*Hi)}toString(){return`${this.z}/${this.x}/${this.y}`}}class md{constructor(e,r){this.wrap=e,this.canonical=r,this.key=Zo(e,r.z,r.z,r.x,r.y)}}class en{constructor(e,r,a,l,d){if(e<a)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${a}`);this.overscaledZ=e,this.wrap=r,this.canonical=new wu(a,+l,+d),this.key=Zo(r,e,a,l,d)}clone(){return new en(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-e;return e>this.canonical.z?new en(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new en(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const a=this.canonical.z-e;return e>this.canonical.z?Zo(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y):Zo(this.wrap*+r,e,e,this.canonical.x>>a,this.canonical.y>>a)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new en(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,a=2*this.canonical.x,l=2*this.canonical.y;return[new en(r,this.wrap,r,a,l),new en(r,this.wrap,r,a+1,l),new en(r,this.wrap,r,a,l+1),new en(r,this.wrap,r,a+1,l+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new en(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new en(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new md(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new lc(e.x-this.wrap,e.y))}}function Zo(i,e,r,a,l){(i*=2)<0&&(i=-1*i-1);const d=1<<r;return(d*d*i+d*l+a).toString(36)+r.toString(36)+e.toString(36)}it("CanonicalTileID",wu),it("OverscaledTileID",en,{omit:["posMatrix"]});class gd{constructor(e,r,a,l=1,d=1,f=1,g=0){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(a&&!["mapbox","terrarium","custom"].includes(a))return void Xe(`"${a}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const v=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),a){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=l,this.greenFactor=d,this.blueFactor=f,this.baseShift=g;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let S=0;S<v;S++)this.data[this._idx(-1,S)]=this.data[this._idx(0,S)],this.data[this._idx(v,S)]=this.data[this._idx(v-1,S)],this.data[this._idx(S,-1)]=this.data[this._idx(S,0)],this.data[this._idx(S,v)]=this.data[this._idx(S,v-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(v,-1)]=this.data[this._idx(v-1,0)],this.data[this._idx(-1,v)]=this.data[this._idx(0,v-1)],this.data[this._idx(v,v)]=this.data[this._idx(v-1,v-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let S=0;S<v;S++)for(let I=0;I<v;I++){const M=this.get(S,I);M>this.max&&(this.max=M),M<this.min&&(this.min=M)}}get(e,r){const a=new Uint8Array(this.data.buffer),l=4*this._idx(e,r);return this.unpack(a[l],a[l+1],a[l+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}unpack(e,r,a){return e*this.redFactor+r*this.greenFactor+a*this.blueFactor-this.baseShift}getPixels(){return new Qr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,r,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let l=r*this.dim,d=r*this.dim+this.dim,f=a*this.dim,g=a*this.dim+this.dim;switch(r){case-1:l=d-1;break;case 1:d=l+1}switch(a){case-1:f=g-1;break;case 1:g=f+1}const v=-r*this.dim,S=-a*this.dim;for(let I=f;I<g;I++)for(let M=l;M<d;M++)this.data[this._idx(M,I)]=e.data[this._idx(M+v,I+S)]}}it("DEMData",gd);class _d{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const a=e[r];this._stringToNumber[a]=r,this._numberToString[r]=a}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class yd{constructor(e,r,a,l,d){this.type="Feature",this._vectorTileFeature=e,e._z=r,e._x=a,e._y=l,this.properties=e.properties,this.id=d}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(e[r]=this[r]);return e}}class vd{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new da(Hi,16,0),this.grid3D=new da(Hi,16,0),this.featureIndexArray=new De,this.promoteId=r}insert(e,r,a,l,d,f){const g=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,l,d);const v=f?this.grid3D:this.grid;for(let S=0;S<r.length;S++){const I=r[S],M=[1/0,1/0,-1/0,-1/0];for(let D=0;D<I.length;D++){const $=I[D];M[0]=Math.min(M[0],$.x),M[1]=Math.min(M[1],$.y),M[2]=Math.max(M[2],$.x),M[3]=Math.max(M[3],$.y)}M[0]<Hi&&M[1]<Hi&&M[2]>=0&&M[3]>=0&&v.insert(g,M[0],M[1],M[2],M[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new _a.VectorTile(new uu(this.rawTileData)).layers,this.sourceLayerCoder=new _d(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,r,a,l){this.loadVTLayers();const d=e.params||{},f=Hi/e.tileSize/e.scale,g=uo(d.filter),v=e.queryGeometry,S=e.queryPadding*f,I=bd(v),M=this.grid.query(I.minX-S,I.minY-S,I.maxX+S,I.maxY+S),D=bd(e.cameraQueryGeometry),$=this.grid3D.query(D.minX-S,D.minY-S,D.maxX+S,D.maxY+S,(X,ee,le,ie)=>function(ue,pe,ke,et,lt){for(const He of ue)if(pe<=He.x&&ke<=He.y&&et>=He.x&&lt>=He.y)return!0;const Je=[new te(pe,ke),new te(pe,lt),new te(et,lt),new te(et,ke)];if(ue.length>2){for(const He of Je)if(Ps(ue,He))return!0}for(let He=0;He<ue.length-1;He++)if(Yf(ue[He],ue[He+1],Je))return!0;return!1}(e.cameraQueryGeometry,X-S,ee-S,le+S,ie+S));for(const X of $)M.push(X);M.sort(xg);const O={};let U;for(let X=0;X<M.length;X++){const ee=M[X];if(ee===U)continue;U=ee;const le=this.featureIndexArray.get(ee);let ie=null;this.loadMatchingFeature(O,le.bucketIndex,le.sourceLayerIndex,le.featureIndex,g,d.layers,d.availableImages,r,a,l,(ue,pe,ke)=>(ie||(ie=Ua(ue)),pe.queryIntersectsFeature(v,ue,ke,ie,this.z,e.transform,f,e.pixelPosMatrix)))}return O}loadMatchingFeature(e,r,a,l,d,f,g,v,S,I,M){const D=this.bucketLayerIDs[r];if(f&&!function(X,ee){for(let le=0;le<X.length;le++)if(ee.indexOf(X[le])>=0)return!0;return!1}(f,D))return;const $=this.sourceLayerCoder.decode(a),O=this.vtLayers[$].feature(l);if(d.needGeometry){const X=qa(O,!0);if(!d.filter(new yi(this.tileID.overscaledZ),X,this.tileID.canonical))return}else if(!d.filter(new yi(this.tileID.overscaledZ),O))return;const U=this.getId(O,$);for(let X=0;X<D.length;X++){const ee=D[X];if(f&&f.indexOf(ee)<0)continue;const le=v[ee];if(!le)continue;let ie={};U&&I&&(ie=I.getState(le.sourceLayer||"_geojsonTileLayer",U));const ue=Fe({},S[ee]);ue.paint=xd(ue.paint,le.paint,O,ie,g),ue.layout=xd(ue.layout,le.layout,O,ie,g);const pe=!M||M(O,le,ie);if(!pe)continue;const ke=new yd(O,this.z,this.x,this.y,U);ke.layer=ue;let et=e[ee];et===void 0&&(et=e[ee]=[]),et.push({featureIndex:l,feature:ke,intersectionZ:pe})}}lookupSymbolFeatures(e,r,a,l,d,f,g,v){const S={};this.loadVTLayers();const I=uo(d);for(const M of e)this.loadMatchingFeature(S,a,l,M,I,f,g,v,r);return S}hasLayer(e){for(const r of this.bucketLayerIDs)for(const a of r)if(e===a)return!0;return!1}getId(e,r){let a=e.id;return this.promoteId&&(a=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof a=="boolean"&&(a=Number(a))),a}}function xd(i,e,r,a,l){return Te(i,(d,f)=>{const g=e instanceof Is?e.get(f):null;return g&&g.evaluate?g.evaluate(r,a,l):g})}function bd(i){let e=1/0,r=1/0,a=-1/0,l=-1/0;for(const d of i)e=Math.min(e,d.x),r=Math.min(r,d.y),a=Math.max(a,d.x),l=Math.max(l,d.y);return{minX:e,minY:r,maxX:a,maxY:l}}function xg(i,e){return e-i}function wd(i,e,r,a,l){const d=[];for(let f=0;f<i.length;f++){const g=i[f];let v;for(let S=0;S<g.length-1;S++){let I=g[S],M=g[S+1];I.x<e&&M.x<e||(I.x<e?I=new te(e,I.y+(e-I.x)/(M.x-I.x)*(M.y-I.y))._round():M.x<e&&(M=new te(e,I.y+(e-I.x)/(M.x-I.x)*(M.y-I.y))._round()),I.y<r&&M.y<r||(I.y<r?I=new te(I.x+(r-I.y)/(M.y-I.y)*(M.x-I.x),r)._round():M.y<r&&(M=new te(I.x+(r-I.y)/(M.y-I.y)*(M.x-I.x),r)._round()),I.x>=a&&M.x>=a||(I.x>=a?I=new te(a,I.y+(a-I.x)/(M.x-I.x)*(M.y-I.y))._round():M.x>=a&&(M=new te(a,I.y+(a-I.x)/(M.x-I.x)*(M.y-I.y))._round()),I.y>=l&&M.y>=l||(I.y>=l?I=new te(I.x+(l-I.y)/(M.y-I.y)*(M.x-I.x),l)._round():M.y>=l&&(M=new te(I.x+(l-I.y)/(M.y-I.y)*(M.x-I.x),l)._round()),v&&I.equals(v[v.length-1])||(v=[I],d.push(v)),v.push(M)))))}}return d}it("FeatureIndex",vd,{omit:["rawTileData","sourceLayerCoder"]});class ba extends te{constructor(e,r,a,l){super(e,r),this.angle=a,l!==void 0&&(this.segment=l)}clone(){return new ba(this.x,this.y,this.angle,this.segment)}}function Sd(i,e,r,a,l){if(e.segment===void 0||r===0)return!0;let d=e,f=e.segment+1,g=0;for(;g>-r/2;){if(f--,f<0)return!1;g-=i[f].dist(d),d=i[f]}g+=i[f].dist(i[f+1]),f++;const v=[];let S=0;for(;g<r/2;){const I=i[f],M=i[f+1];if(!M)return!1;let D=i[f-1].angleTo(I)-I.angleTo(M);for(D=Math.abs((D+3*Math.PI)%(2*Math.PI)-Math.PI),v.push({distance:g,angleDelta:D}),S+=D;g-v[0].distance>a;)S-=v.shift().angleDelta;if(S>l)return!1;f++,g+=I.dist(M)}return!0}function Cd(i){let e=0;for(let r=0;r<i.length-1;r++)e+=i[r].dist(i[r+1]);return e}function Td(i,e,r){return i?.6*e*r:0}function Id(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function bg(i,e,r,a,l,d){const f=Td(r,l,d),g=Id(r,a)*d;let v=0;const S=Cd(i)/2;for(let I=0;I<i.length-1;I++){const M=i[I],D=i[I+1],$=M.dist(D);if(v+$>S){const O=(S-v)/$,U=Dr.number(M.x,D.x,O),X=Dr.number(M.y,D.y,O),ee=new ba(U,X,D.angleTo(M),I);return ee._round(),!f||Sd(i,ee,g,f,e)?ee:void 0}v+=$}}function wg(i,e,r,a,l,d,f,g,v){const S=Td(a,d,f),I=Id(a,l),M=I*f,D=i[0].x===0||i[0].x===v||i[0].y===0||i[0].y===v;return e-M<e/4&&(e=M+e/4),Ed(i,D?e/2*g%e:(I/2+2*d)*f*g%e,e,S,r,M,D,!1,v)}function Ed(i,e,r,a,l,d,f,g,v){const S=d/2,I=Cd(i);let M=0,D=e-r,$=[];for(let O=0;O<i.length-1;O++){const U=i[O],X=i[O+1],ee=U.dist(X),le=X.angleTo(U);for(;D+r<M+ee;){D+=r;const ie=(D-M)/ee,ue=Dr.number(U.x,X.x,ie),pe=Dr.number(U.y,X.y,ie);if(ue>=0&&ue<v&&pe>=0&&pe<v&&D-S>=0&&D+S<=I){const ke=new ba(ue,pe,le,O);ke._round(),a&&!Sd(i,ke,d,a,l)||$.push(ke)}}M+=ee}return g||$.length||f||($=Ed(i,M/2,r,a,l,d,f,!0,v)),$}it("Anchor",ba);const Bs=$r;function Pd(i,e,r,a){const l=[],d=i.image,f=d.pixelRatio,g=d.paddedRect.w-2*Bs,v=d.paddedRect.h-2*Bs,S=i.right-i.left,I=i.bottom-i.top,M=d.stretchX||[[0,g]],D=d.stretchY||[[0,v]],$=(qe,rt)=>qe+rt[1]-rt[0],O=M.reduce($,0),U=D.reduce($,0),X=g-O,ee=v-U;let le=0,ie=O,ue=0,pe=U,ke=0,et=X,lt=0,Je=ee;if(d.content&&a){const qe=d.content;le=cc(M,0,qe[0]),ue=cc(D,0,qe[1]),ie=cc(M,qe[0],qe[2]),pe=cc(D,qe[1],qe[3]),ke=qe[0]-le,lt=qe[1]-ue,et=qe[2]-qe[0]-ie,Je=qe[3]-qe[1]-pe}const He=(qe,rt,Ge,Oe)=>{const _t=uc(qe.stretch-le,ie,S,i.left),ht=hc(qe.fixed-ke,et,qe.stretch,O),Nt=uc(rt.stretch-ue,pe,I,i.top),xi=hc(rt.fixed-lt,Je,rt.stretch,U),Ci=uc(Ge.stretch-le,ie,S,i.left),er=hc(Ge.fixed-ke,et,Ge.stretch,O),Yr=uc(Oe.stretch-ue,pe,I,i.top),Pr=hc(Oe.fixed-lt,Je,Oe.stretch,U),Wi=new te(_t,Nt),ur=new te(Ci,Nt),fr=new te(Ci,Yr),Mr=new te(_t,Yr),Ar=new te(ht/f,xi/f),tr=new te(er/f,Pr/f),ir=e*Math.PI/180;if(ir){const xr=Math.sin(ir),Or=Math.cos(ir),Nr=[Or,-xr,xr,Or];Wi._matMult(Nr),ur._matMult(Nr),Mr._matMult(Nr),fr._matMult(Nr)}const vr=qe.stretch+qe.fixed,kr=rt.stretch+rt.fixed;return{tl:Wi,tr:ur,bl:Mr,br:fr,tex:{x:d.paddedRect.x+Bs+vr,y:d.paddedRect.y+Bs+kr,w:Ge.stretch+Ge.fixed-vr,h:Oe.stretch+Oe.fixed-kr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ar,pixelOffsetBR:tr,minFontScaleX:et/f/S,minFontScaleY:Je/f/I,isSDF:r}};if(a&&(d.stretchX||d.stretchY)){const qe=Md(M,X,O),rt=Md(D,ee,U);for(let Ge=0;Ge<qe.length-1;Ge++){const Oe=qe[Ge],_t=qe[Ge+1];for(let ht=0;ht<rt.length-1;ht++)l.push(He(Oe,rt[ht],_t,rt[ht+1]))}}else l.push(He({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:g+1},{fixed:0,stretch:v+1}));return l}function cc(i,e,r){let a=0;for(const l of i)a+=Math.max(e,Math.min(r,l[1]))-Math.max(e,Math.min(r,l[0]));return a}function Md(i,e,r){const a=[{fixed:-Bs,stretch:0}];for(const[l,d]of i){const f=a[a.length-1];a.push({fixed:l-f.stretch,stretch:f.stretch}),a.push({fixed:l-f.stretch,stretch:f.stretch+(d-l)})}return a.push({fixed:e+Bs,stretch:r}),a}function uc(i,e,r,a){return i/e*r+a}function hc(i,e,r,a){return i-e*r/a}class dc{constructor(e,r,a,l,d,f,g,v,S,I){if(this.boxStartIndex=e.length,S){let M=f.top,D=f.bottom;const $=f.collisionPadding;$&&(M-=$[1],D+=$[3]);let O=D-M;O>0&&(O=Math.max(10,O),this.circleDiameter=O)}else{let M=f.top*g-v[0],D=f.bottom*g+v[2],$=f.left*g-v[3],O=f.right*g+v[1];const U=f.collisionPadding;if(U&&($-=U[0]*g,M-=U[1]*g,O+=U[2]*g,D+=U[3]*g),I){const X=new te($,M),ee=new te(O,M),le=new te($,D),ie=new te(O,D),ue=I*Math.PI/180;X._rotate(ue),ee._rotate(ue),le._rotate(ue),ie._rotate(ue),$=Math.min(X.x,ee.x,le.x,ie.x),O=Math.max(X.x,ee.x,le.x,ie.x),M=Math.min(X.y,ee.y,le.y,ie.y),D=Math.max(X.y,ee.y,le.y,ie.y)}e.emplaceBack(r.x,r.y,$,M,O,D,a,l,d)}this.boxEndIndex=e.length}}class Sg{constructor(e=[],r=Cg){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:a}=this,l=r[e];for(;e>0;){const d=e-1>>1,f=r[d];if(a(l,f)>=0)break;r[e]=f,e=d}r[e]=l}_down(e){const{data:r,compare:a}=this,l=this.length>>1,d=r[e];for(;e<l;){let f=1+(e<<1),g=r[f];const v=f+1;if(v<this.length&&a(r[v],g)<0&&(f=v,g=r[v]),a(g,d)>=0)break;r[e]=g,e=f}r[e]=d}}function Cg(i,e){return i<e?-1:i>e?1:0}function Tg(i,e=1,r=!1){let a=1/0,l=1/0,d=-1/0,f=-1/0;const g=i[0];for(let $=0;$<g.length;$++){const O=g[$];(!$||O.x<a)&&(a=O.x),(!$||O.y<l)&&(l=O.y),(!$||O.x>d)&&(d=O.x),(!$||O.y>f)&&(f=O.y)}const v=Math.min(d-a,f-l);let S=v/2;const I=new Sg([],Ig);if(v===0)return new te(a,l);for(let $=a;$<d;$+=v)for(let O=l;O<f;O+=v)I.push(new Fs($+S,O+S,S,i));let M=function($){let O=0,U=0,X=0;const ee=$[0];for(let le=0,ie=ee.length,ue=ie-1;le<ie;ue=le++){const pe=ee[le],ke=ee[ue],et=pe.x*ke.y-ke.x*pe.y;U+=(pe.x+ke.x)*et,X+=(pe.y+ke.y)*et,O+=3*et}return new Fs(U/O,X/O,0,$)}(i),D=I.length;for(;I.length;){const $=I.pop();($.d>M.d||!M.d)&&(M=$,r&&console.log("found best %d after %d probes",Math.round(1e4*$.d)/1e4,D)),$.max-M.d<=e||(S=$.h/2,I.push(new Fs($.p.x-S,$.p.y-S,S,i)),I.push(new Fs($.p.x+S,$.p.y-S,S,i)),I.push(new Fs($.p.x-S,$.p.y+S,S,i)),I.push(new Fs($.p.x+S,$.p.y+S,S,i)),D+=4)}return r&&(console.log(`num probes: ${D}`),console.log(`best distance: ${M.d}`)),M.p}function Ig(i,e){return e.max-i.max}function Fs(i,e,r,a){this.p=new te(i,e),this.h=r,this.d=function(l,d){let f=!1,g=1/0;for(let v=0;v<d.length;v++){const S=d[v];for(let I=0,M=S.length,D=M-1;I<M;D=I++){const $=S[I],O=S[D];$.y>l.y!=O.y>l.y&&l.x<(O.x-$.x)*(l.y-$.y)/(O.y-$.y)+$.x&&(f=!f),g=Math.min(g,hh(l,$,O))}}return(f?1:-1)*Math.sqrt(g)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}var pr;s.aq=void 0,(pr=s.aq||(s.aq={}))[pr.center=1]="center",pr[pr.left=2]="left",pr[pr.right=3]="right",pr[pr.top=4]="top",pr[pr.bottom=5]="bottom",pr[pr["top-left"]=6]="top-left",pr[pr["top-right"]=7]="top-right",pr[pr["bottom-left"]=8]="bottom-left",pr[pr["bottom-right"]=9]="bottom-right";const wa=7,Su=Number.POSITIVE_INFINITY;function Ad(i,e){return e[1]!==Su?function(r,a,l){let d=0,f=0;switch(a=Math.abs(a),l=Math.abs(l),r){case"top-right":case"top-left":case"top":f=l-wa;break;case"bottom-right":case"bottom-left":case"bottom":f=-l+wa}switch(r){case"top-right":case"bottom-right":case"right":d=-a;break;case"top-left":case"bottom-left":case"left":d=a}return[d,f]}(i,e[0],e[1]):function(r,a){let l=0,d=0;a<0&&(a=0);const f=a/Math.SQRT2;switch(r){case"top-right":case"top-left":d=f-wa;break;case"bottom-right":case"bottom-left":d=-f+wa;break;case"bottom":d=-a+wa;break;case"top":d=a-wa}switch(r){case"top-right":case"bottom-right":l=-f;break;case"top-left":case"bottom-left":l=f;break;case"left":l=a;break;case"right":l=-a}return[l,d]}(i,e[0])}function kd(i,e,r){var a;const l=i.layout,d=(a=l.get("text-variable-anchor-offset"))===null||a===void 0?void 0:a.evaluate(e,{},r);if(d){const g=d.values,v=[];for(let S=0;S<g.length;S+=2){const I=v[S]=g[S],M=g[S+1].map(D=>D*Qi);I.startsWith("top")?M[1]-=wa:I.startsWith("bottom")&&(M[1]+=wa),v[S+1]=M}return new Gr(v)}const f=l.get("text-variable-anchor");if(f){let g;g=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[l.get("text-radial-offset").evaluate(e,{},r)*Qi,Su]:l.get("text-offset").evaluate(e,{},r).map(S=>S*Qi);const v=[];for(const S of f)v.push(S,Ad(S,g));return new Gr(v)}return null}function Cu(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Eg(i,e,r,a,l,d,f,g,v,S,I){let M=d.textMaxSize.evaluate(e,{});M===void 0&&(M=f);const D=i.layers[0].layout,$=D.get("icon-offset").evaluate(e,{},I),O=Dd(r.horizontal),U=f/24,X=i.tilePixelRatio*U,ee=i.tilePixelRatio*M/24,le=i.tilePixelRatio*g,ie=i.tilePixelRatio*D.get("symbol-spacing"),ue=D.get("text-padding")*i.tilePixelRatio,pe=function(Oe,_t,ht,Nt=1){const xi=Oe.get("icon-padding").evaluate(_t,{},ht),Ci=xi&&xi.values;return[Ci[0]*Nt,Ci[1]*Nt,Ci[2]*Nt,Ci[3]*Nt]}(D,e,I,i.tilePixelRatio),ke=D.get("text-max-angle")/180*Math.PI,et=D.get("text-rotation-alignment")!=="viewport"&&D.get("symbol-placement")!=="point",lt=D.get("icon-rotation-alignment")==="map"&&D.get("symbol-placement")!=="point",Je=D.get("symbol-placement"),He=ie/2,qe=D.get("icon-text-fit");let rt;a&&qe!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(rt=td(a,r.vertical,qe,D.get("icon-text-fit-padding"),$,U)),O&&(a=td(a,O,qe,D.get("icon-text-fit-padding"),$,U)));const Ge=(Oe,_t)=>{_t.x<0||_t.x>=Hi||_t.y<0||_t.y>=Hi||function(ht,Nt,xi,Ci,er,Yr,Pr,Wi,ur,fr,Mr,Ar,tr,ir,vr,kr,xr,Or,Nr,rr,Zt,br,mr,nr,pn){const wn=ht.addToLineVertexArray(Nt,xi);let Sn,ta,fn,tn,jr=0,ia=0,Xo=0,Fd=0,zu=-1,Du=-1;const ra={};let $d=Yn("");if(ht.allowVerticalPlacement&&Ci.vertical){const wr=Wi.layout.get("text-rotate").evaluate(Zt,{},nr)+90;fn=new dc(ur,Nt,fr,Mr,Ar,Ci.vertical,tr,ir,vr,wr),Pr&&(tn=new dc(ur,Nt,fr,Mr,Ar,Pr,xr,Or,vr,wr))}if(er){const wr=Wi.layout.get("icon-rotate").evaluate(Zt,{}),rn=Wi.layout.get("icon-text-fit")!=="none",Za=Pd(er,wr,mr,rn),Tn=Pr?Pd(Pr,wr,mr,rn):void 0;ta=new dc(ur,Nt,fr,Mr,Ar,er,xr,Or,!1,wr),jr=4*Za.length;const Ha=ht.iconSizeData;let Fn=null;Ha.kind==="source"?(Fn=[Bn*Wi.layout.get("icon-size").evaluate(Zt,{})],Fn[0]>va&&Xe(`${ht.layerIds[0]}: Value for "icon-size" is >= ${Go}. Reduce your "icon-size".`)):Ha.kind==="composite"&&(Fn=[Bn*br.compositeIconSizes[0].evaluate(Zt,{},nr),Bn*br.compositeIconSizes[1].evaluate(Zt,{},nr)],(Fn[0]>va||Fn[1]>va)&&Xe(`${ht.layerIds[0]}: Value for "icon-size" is >= ${Go}. Reduce your "icon-size".`)),ht.addSymbols(ht.icon,Za,Fn,rr,Nr,Zt,s.ai.none,Nt,wn.lineStartIndex,wn.lineLength,-1,nr),zu=ht.icon.placedSymbolArray.length-1,Tn&&(ia=4*Tn.length,ht.addSymbols(ht.icon,Tn,Fn,rr,Nr,Zt,s.ai.vertical,Nt,wn.lineStartIndex,wn.lineLength,-1,nr),Du=ht.icon.placedSymbolArray.length-1)}const Od=Object.keys(Ci.horizontal);for(const wr of Od){const rn=Ci.horizontal[wr];if(!Sn){$d=Yn(rn.text);const Tn=Wi.layout.get("text-rotate").evaluate(Zt,{},nr);Sn=new dc(ur,Nt,fr,Mr,Ar,rn,tr,ir,vr,Tn)}const Za=rn.positionedLines.length===1;if(Xo+=zd(ht,Nt,rn,Yr,Wi,vr,Zt,kr,wn,Ci.vertical?s.ai.horizontal:s.ai.horizontalOnly,Za?Od:[wr],ra,zu,br,nr),Za)break}Ci.vertical&&(Fd+=zd(ht,Nt,Ci.vertical,Yr,Wi,vr,Zt,kr,wn,s.ai.vertical,["vertical"],ra,Du,br,nr));const Ag=Sn?Sn.boxStartIndex:ht.collisionBoxArray.length,kg=Sn?Sn.boxEndIndex:ht.collisionBoxArray.length,zg=fn?fn.boxStartIndex:ht.collisionBoxArray.length,Dg=fn?fn.boxEndIndex:ht.collisionBoxArray.length,Lg=ta?ta.boxStartIndex:ht.collisionBoxArray.length,Rg=ta?ta.boxEndIndex:ht.collisionBoxArray.length,Bg=tn?tn.boxStartIndex:ht.collisionBoxArray.length,Fg=tn?tn.boxEndIndex:ht.collisionBoxArray.length;let Cn=-1;const fc=(wr,rn)=>wr&&wr.circleDiameter?Math.max(wr.circleDiameter,rn):rn;Cn=fc(Sn,Cn),Cn=fc(fn,Cn),Cn=fc(ta,Cn),Cn=fc(tn,Cn);const Nd=Cn>-1?1:0;Nd&&(Cn*=pn/Qi),ht.glyphOffsetArray.length>=Rs.MAX_GLYPHS&&Xe("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Zt.sortKey!==void 0&&ht.addToSortKeyRanges(ht.symbolInstances.length,Zt.sortKey);const $g=kd(Wi,Zt,nr),[Og,Ng]=function(wr,rn){const Za=wr.length,Tn=rn?.values;if(Tn?.length>0)for(let Ha=0;Ha<Tn.length;Ha+=2){const Fn=Tn[Ha+1];wr.emplaceBack(s.aq[Tn[Ha]],Fn[0],Fn[1])}return[Za,wr.length]}(ht.textAnchorOffsets,$g);ht.symbolInstances.emplaceBack(Nt.x,Nt.y,ra.right>=0?ra.right:-1,ra.center>=0?ra.center:-1,ra.left>=0?ra.left:-1,ra.vertical||-1,zu,Du,$d,Ag,kg,zg,Dg,Lg,Rg,Bg,Fg,fr,Xo,Fd,jr,ia,Nd,0,tr,Cn,Og,Ng)}(i,_t,Oe,r,a,l,rt,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,X,[ue,ue,ue,ue],et,v,le,pe,lt,$,e,d,S,I,f)};if(Je==="line")for(const Oe of wd(e.geometry,0,0,Hi,Hi)){const _t=wg(Oe,ie,ke,r.vertical||O,a,24,ee,i.overscaling,Hi);for(const ht of _t)O&&Pg(i,O.text,He,ht)||Ge(Oe,ht)}else if(Je==="line-center"){for(const Oe of e.geometry)if(Oe.length>1){const _t=bg(Oe,ke,r.vertical||O,a,24,ee);_t&&Ge(Oe,_t)}}else if(e.type==="Polygon")for(const Oe of iu(e.geometry,0)){const _t=Tg(Oe,16);Ge(Oe[0],new ba(_t.x,_t.y,0))}else if(e.type==="LineString")for(const Oe of e.geometry)Ge(Oe,new ba(Oe[0].x,Oe[0].y,0));else if(e.type==="Point")for(const Oe of e.geometry)for(const _t of Oe)Ge([_t],new ba(_t.x,_t.y,0))}function zd(i,e,r,a,l,d,f,g,v,S,I,M,D,$,O){const U=function(le,ie,ue,pe,ke,et,lt,Je){const He=pe.layout.get("text-rotate").evaluate(et,{})*Math.PI/180,qe=[];for(const rt of ie.positionedLines)for(const Ge of rt.positionedGlyphs){if(!Ge.rect)continue;const Oe=Ge.rect||{};let _t=Wh+1,ht=!0,Nt=1,xi=0;const Ci=(ke||Je)&&Ge.vertical,er=Ge.metrics.advance*Ge.scale/2;if(Je&&ie.verticalizable&&(xi=rt.lineOffset/2-(Ge.imageName?-(Qi-Ge.metrics.width*Ge.scale)/2:(Ge.scale-1)*Qi)),Ge.imageName){const rr=lt[Ge.imageName];ht=rr.sdf,Nt=rr.pixelRatio,_t=$r/Nt}const Yr=ke?[Ge.x+er,Ge.y]:[0,0];let Pr=ke?[0,0]:[Ge.x+er+ue[0],Ge.y+ue[1]-xi],Wi=[0,0];Ci&&(Wi=Pr,Pr=[0,0]);const ur=Ge.metrics.isDoubleResolution?2:1,fr=(Ge.metrics.left-_t)*Ge.scale-er+Pr[0],Mr=(-Ge.metrics.top-_t)*Ge.scale+Pr[1],Ar=fr+Oe.w/ur*Ge.scale/Nt,tr=Mr+Oe.h/ur*Ge.scale/Nt,ir=new te(fr,Mr),vr=new te(Ar,Mr),kr=new te(fr,tr),xr=new te(Ar,tr);if(Ci){const rr=new te(-er,er-Uo),Zt=-Math.PI/2,br=Qi/2-er,mr=new te(5-Uo-br,-(Ge.imageName?br:0)),nr=new te(...Wi);ir._rotateAround(Zt,rr)._add(mr)._add(nr),vr._rotateAround(Zt,rr)._add(mr)._add(nr),kr._rotateAround(Zt,rr)._add(mr)._add(nr),xr._rotateAround(Zt,rr)._add(mr)._add(nr)}if(He){const rr=Math.sin(He),Zt=Math.cos(He),br=[Zt,-rr,rr,Zt];ir._matMult(br),vr._matMult(br),kr._matMult(br),xr._matMult(br)}const Or=new te(0,0),Nr=new te(0,0);qe.push({tl:ir,tr:vr,bl:kr,br:xr,tex:Oe,writingMode:ie.writingMode,glyphOffset:Yr,sectionIndex:Ge.sectionIndex,isSDF:ht,pixelOffsetTL:Or,pixelOffsetBR:Nr,minFontScaleX:0,minFontScaleY:0})}return qe}(0,r,g,l,d,f,a,i.allowVerticalPlacement),X=i.textSizeData;let ee=null;X.kind==="source"?(ee=[Bn*l.layout.get("text-size").evaluate(f,{})],ee[0]>va&&Xe(`${i.layerIds[0]}: Value for "text-size" is >= ${Go}. Reduce your "text-size".`)):X.kind==="composite"&&(ee=[Bn*$.compositeTextSizes[0].evaluate(f,{},O),Bn*$.compositeTextSizes[1].evaluate(f,{},O)],(ee[0]>va||ee[1]>va)&&Xe(`${i.layerIds[0]}: Value for "text-size" is >= ${Go}. Reduce your "text-size".`)),i.addSymbols(i.text,U,ee,g,d,f,S,e,v.lineStartIndex,v.lineLength,D,O);for(const le of I)M[le]=i.text.placedSymbolArray.length-1;return 4*U.length}function Dd(i){for(const e in i)return i[e];return null}function Pg(i,e,r,a){const l=i.compareText;if(e in l){const d=l[e];for(let f=d.length-1;f>=0;f--)if(a.dist(d[f])<r)return!0}else l[e]=[];return l[e].push(a),!1}const Ld=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Tu{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,a]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const l=a>>4;if(l!==1)throw new Error(`Got v${l} data when expected v1.`);const d=Ld[15&a];if(!d)throw new Error("Unrecognized array type.");const[f]=new Uint16Array(e,2,1),[g]=new Uint32Array(e,4,1);return new Tu(g,f,d,e)}constructor(e,r=64,a=Float64Array,l){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=a,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const d=Ld.indexOf(this.ArrayType),f=2*e*this.ArrayType.BYTES_PER_ELEMENT,g=e*this.IndexArrayType.BYTES_PER_ELEMENT,v=(8-g%8)%8;if(d<0)throw new Error(`Unexpected typed array class: ${a}.`);l&&l instanceof ArrayBuffer?(this.data=l,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+g+v,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+f+g+v),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+g+v,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+d]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=e,this.coords[this._pos++]=r,a}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Iu(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,a,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:f,nodeSize:g}=this,v=[0,d.length-1,0],S=[];for(;v.length;){const I=v.pop()||0,M=v.pop()||0,D=v.pop()||0;if(M-D<=g){for(let X=D;X<=M;X++){const ee=f[2*X],le=f[2*X+1];ee>=e&&ee<=a&&le>=r&&le<=l&&S.push(d[X])}continue}const $=D+M>>1,O=f[2*$],U=f[2*$+1];O>=e&&O<=a&&U>=r&&U<=l&&S.push(d[$]),(I===0?e<=O:r<=U)&&(v.push(D),v.push($-1),v.push(1-I)),(I===0?a>=O:l>=U)&&(v.push($+1),v.push(M),v.push(1-I))}return S}within(e,r,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:l,coords:d,nodeSize:f}=this,g=[0,l.length-1,0],v=[],S=a*a;for(;g.length;){const I=g.pop()||0,M=g.pop()||0,D=g.pop()||0;if(M-D<=f){for(let X=D;X<=M;X++)Bd(d[2*X],d[2*X+1],e,r)<=S&&v.push(l[X]);continue}const $=D+M>>1,O=d[2*$],U=d[2*$+1];Bd(O,U,e,r)<=S&&v.push(l[$]),(I===0?e-a<=O:r-a<=U)&&(g.push(D),g.push($-1),g.push(1-I)),(I===0?e+a>=O:r+a>=U)&&(g.push($+1),g.push(M),g.push(1-I))}return v}}function Iu(i,e,r,a,l,d){if(l-a<=r)return;const f=a+l>>1;Rd(i,e,f,a,l,d),Iu(i,e,r,a,f-1,1-d),Iu(i,e,r,f+1,l,1-d)}function Rd(i,e,r,a,l,d){for(;l>a;){if(l-a>600){const S=l-a+1,I=r-a+1,M=Math.log(S),D=.5*Math.exp(2*M/3),$=.5*Math.sqrt(M*D*(S-D)/S)*(I-S/2<0?-1:1);Rd(i,e,r,Math.max(a,Math.floor(r-I*D/S+$)),Math.min(l,Math.floor(r+(S-I)*D/S+$)),d)}const f=e[2*r+d];let g=a,v=l;for(Ho(i,e,a,r),e[2*l+d]>f&&Ho(i,e,a,l);g<v;){for(Ho(i,e,g,v),g++,v--;e[2*g+d]<f;)g++;for(;e[2*v+d]>f;)v--}e[2*a+d]===f?Ho(i,e,a,v):(v++,Ho(i,e,v,l)),v<=r&&(a=v+1),r<=v&&(l=v-1)}}function Ho(i,e,r,a){Eu(i,r,a),Eu(e,2*r,2*a),Eu(e,2*r+1,2*a+1)}function Eu(i,e,r){const a=i[e];i[e]=i[r],i[r]=a}function Bd(i,e,r,a){const l=i-r,d=e-a;return l*l+d*d}var Pu;s.bh=void 0,(Pu=s.bh||(s.bh={})).create="create",Pu.load="load",Pu.fullLoad="fullLoad";let pc=null,Wo=[];const Mu=1e3/60,Au="loadTime",ku="fullLoadTime",Mg={mark(i){performance.mark(i)},frame(i){const e=i;pc!=null&&Wo.push(e-pc),pc=e},clearMetrics(){pc=null,Wo=[],performance.clearMeasures(Au),performance.clearMeasures(ku);for(const i in s.bh)performance.clearMarks(s.bh[i])},getPerformanceMetrics(){performance.measure(Au,s.bh.create,s.bh.load),performance.measure(ku,s.bh.create,s.bh.fullLoad);const i=performance.getEntriesByName(Au)[0].duration,e=performance.getEntriesByName(ku)[0].duration,r=Wo.length,a=1/(Wo.reduce((d,f)=>d+f,0)/r/1e3),l=Wo.filter(d=>d>Mu).reduce((d,f)=>d+(f-Mu)/Mu,0);return{loadTime:i,fullLoadTime:e,fps:a,percentDroppedFrames:l/(r+l)*100,totalFrames:r}}};s.$=function(i,e,r){var a,l,d,f,g,v,S,I,M,D,$,O,U=r[0],X=r[1],ee=r[2];return e===i?(i[12]=e[0]*U+e[4]*X+e[8]*ee+e[12],i[13]=e[1]*U+e[5]*X+e[9]*ee+e[13],i[14]=e[2]*U+e[6]*X+e[10]*ee+e[14],i[15]=e[3]*U+e[7]*X+e[11]*ee+e[15]):(l=e[1],d=e[2],f=e[3],g=e[4],v=e[5],S=e[6],I=e[7],M=e[8],D=e[9],$=e[10],O=e[11],i[0]=a=e[0],i[1]=l,i[2]=d,i[3]=f,i[4]=g,i[5]=v,i[6]=S,i[7]=I,i[8]=M,i[9]=D,i[10]=$,i[11]=O,i[12]=a*U+g*X+M*ee+e[12],i[13]=l*U+v*X+D*ee+e[13],i[14]=d*U+S*X+$*ee+e[14],i[15]=f*U+I*X+O*ee+e[15]),i},s.A=Ms,s.B=Dr,s.C=class{constructor(i,e,r){this.receive=a=>{const l=a.data,d=l.id;if(d&&(!l.targetMapId||this.mapId===l.targetMapId))if(l.type==="<cancel>"){delete this.tasks[d];const f=this.cancelCallbacks[d];delete this.cancelCallbacks[d],f&&f()}else st()||l.mustQueue?(this.tasks[d]=l,this.taskQueue.push(d),this.invoker.trigger()):this.processTask(d,l)},this.process=()=>{if(!this.taskQueue.length)return;const a=this.taskQueue.shift(),l=this.tasks[a];delete this.tasks[a],this.taskQueue.length&&this.invoker.trigger(),l&&this.processTask(a,l)},this.target=i,this.parent=e,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new vg(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=st()?i:window}send(i,e,r,a,l=!1){const d=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[d]=r);const f=[],g={id:d,type:i,hasCallback:!!r,targetMapId:a,mustQueue:l,sourceMapId:this.mapId,data:Dn(e,f)};return this.target.postMessage(g,{transfer:f}),{cancel:()=>{r&&delete this.callbacks[d],this.target.postMessage({id:d,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}processTask(i,e){if(e.type==="<response>"){const r=this.callbacks[i];delete this.callbacks[i],r&&(e.error?r(pa(e.error)):r(null,pa(e.data)))}else{let r=!1;const a=[],l=e.hasCallback?(g,v)=>{r=!0,delete this.cancelCallbacks[i];const S={id:i,type:"<response>",sourceMapId:this.mapId,error:g?Dn(g):null,data:Dn(v,a)};this.target.postMessage(S,{transfer:a})}:g=>{r=!0};let d=null;const f=pa(e.data);if(this.parent[e.type])d=this.parent[e.type](e.sourceMapId,f,l);else if("getWorkerSource"in this.parent){const g=e.type.split(".");d=this.parent.getWorkerSource(e.sourceMapId,g[0],f.source)[g[1]](f,l)}else l(new Error(`Could not find function ${e.type}`));!r&&d&&d.cancel&&(this.cancelCallbacks[i]=d.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},s.D=pt,s.E=gr,s.F=function(i,e){const r={};for(let a=0;a<e.length;a++){const l=e[a];l in i&&(r[l]=i[l])}return r},s.G=ud,s.H=hd,s.I=du,s.J=we,s.K=ge,s.L=xa,s.M=Gt,s.N=Hi,s.O=en,s.P=te,s.Q=Pi,s.R=Qr,s.S=vi,s.T=Vl,s.U=lc,s.V=class extends Xn{},s.W=wu,s.X=function(i,e){const r=window.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let a=0;a<i.length;a++){const l=window.document.createElement("source");li(i[a])||(r.crossOrigin="Anonymous"),l.src=i[a],r.appendChild(l)}return{cancel:()=>{}}},s.Y=je,s.Z=function(){var i=new Ms(16);return Ms!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},s._=j,s.a=At,s.a$=class extends B{},s.a0=function(i,e,r){var a=r[0],l=r[1],d=r[2];return i[0]=e[0]*a,i[1]=e[1]*a,i[2]=e[2]*a,i[3]=e[3]*a,i[4]=e[4]*l,i[5]=e[5]*l,i[6]=e[6]*l,i[7]=e[7]*l,i[8]=e[8]*d,i[9]=e[9]*d,i[10]=e[10]*d,i[11]=e[11]*d,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},s.a1=mh,s.a2=function(){return Le++},s.a3=H,s.a4=Rs,s.a5=function(){Br.isLoading()||Br.isLoaded()||wo()!=="deferred"||jl()},s.a6=uo,s.a7=qa,s.a8=yi,s.a9=yd,s.aA=$a,s.aB=function(i){i=i.slice();const e=Object.create(null);for(let r=0;r<i.length;r++)e[i[r].id]=i[r];for(let r=0;r<i.length;r++)"ref"in i[r]&&(i[r]=Di(i[r],e[i[r].ref]));return i},s.aC=function(i){if(i.type==="custom")return new yg(i);switch(i.type){case"background":return new mg(i);case"circle":return new em(i);case"fill":return new xm(i);case"fill-extrusion":return new Rm(i);case"heatmap":return new im(i);case"hillshade":return new nm(i);case"line":return new Um(i);case"raster":return new _g(i);case"symbol":return new oc(i)}},s.aD=We,s.aE=function(i,e){if(!i)return[{command:Ot.setStyle,args:[e]}];let r=[];try{if(!Wt(i.version,e.version))return[{command:Ot.setStyle,args:[e]}];Wt(i.center,e.center)||r.push({command:Ot.setCenter,args:[e.center]}),Wt(i.zoom,e.zoom)||r.push({command:Ot.setZoom,args:[e.zoom]}),Wt(i.bearing,e.bearing)||r.push({command:Ot.setBearing,args:[e.bearing]}),Wt(i.pitch,e.pitch)||r.push({command:Ot.setPitch,args:[e.pitch]}),Wt(i.sprite,e.sprite)||r.push({command:Ot.setSprite,args:[e.sprite]}),Wt(i.glyphs,e.glyphs)||r.push({command:Ot.setGlyphs,args:[e.glyphs]}),Wt(i.transition,e.transition)||r.push({command:Ot.setTransition,args:[e.transition]}),Wt(i.light,e.light)||r.push({command:Ot.setLight,args:[e.light]});const a={},l=[];(function(f,g,v,S){let I;for(I in g=g||{},f=f||{})Object.prototype.hasOwnProperty.call(f,I)&&(Object.prototype.hasOwnProperty.call(g,I)||Ki(I,v,S));for(I in g)Object.prototype.hasOwnProperty.call(g,I)&&(Object.prototype.hasOwnProperty.call(f,I)?Wt(f[I],g[I])||(f[I].type==="geojson"&&g[I].type==="geojson"&&sn(f,g,I)?v.push({command:Ot.setGeoJSONSourceData,args:[I,g[I].data]}):_i(I,g,v,S)):Gi(I,g,v))})(i.sources,e.sources,l,a);const d=[];i.layers&&i.layers.forEach(f=>{a[f.source]?r.push({command:Ot.removeLayer,args:[f.id]}):d.push(f)}),r=r.concat(l),function(f,g,v){g=g||[];const S=(f=f||[]).map(ar),I=g.map(ar),M=f.reduce(Ur,{}),D=g.reduce(Ur,{}),$=S.slice(),O=Object.create(null);let U,X,ee,le,ie,ue,pe;for(U=0,X=0;U<S.length;U++)ee=S[U],Object.prototype.hasOwnProperty.call(D,ee)?X++:(v.push({command:Ot.removeLayer,args:[ee]}),$.splice($.indexOf(ee,X),1));for(U=0,X=0;U<I.length;U++)ee=I[I.length-1-U],$[$.length-1-U]!==ee&&(Object.prototype.hasOwnProperty.call(M,ee)?(v.push({command:Ot.removeLayer,args:[ee]}),$.splice($.lastIndexOf(ee,$.length-X),1)):X++,ue=$[$.length-U],v.push({command:Ot.addLayer,args:[D[ee],ue]}),$.splice($.length-U,0,ee),O[ee]=!0);for(U=0;U<I.length;U++)if(ee=I[U],le=M[ee],ie=D[ee],!O[ee]&&!Wt(le,ie))if(Wt(le.source,ie.source)&&Wt(le["source-layer"],ie["source-layer"])&&Wt(le.type,ie.type)){for(pe in sr(le.layout,ie.layout,v,ee,null,Ot.setLayoutProperty),sr(le.paint,ie.paint,v,ee,null,Ot.setPaintProperty),Wt(le.filter,ie.filter)||v.push({command:Ot.setFilter,args:[ee,ie.filter]}),Wt(le.minzoom,ie.minzoom)&&Wt(le.maxzoom,ie.maxzoom)||v.push({command:Ot.setLayerZoomRange,args:[ee,ie.minzoom,ie.maxzoom]}),le)Object.prototype.hasOwnProperty.call(le,pe)&&pe!=="layout"&&pe!=="paint"&&pe!=="filter"&&pe!=="metadata"&&pe!=="minzoom"&&pe!=="maxzoom"&&(pe.indexOf("paint.")===0?sr(le[pe],ie[pe],v,ee,pe.slice(6),Ot.setPaintProperty):Wt(le[pe],ie[pe])||v.push({command:Ot.setLayerProperty,args:[ee,pe,ie[pe]]}));for(pe in ie)Object.prototype.hasOwnProperty.call(ie,pe)&&!Object.prototype.hasOwnProperty.call(le,pe)&&pe!=="layout"&&pe!=="paint"&&pe!=="filter"&&pe!=="metadata"&&pe!=="minzoom"&&pe!=="maxzoom"&&(pe.indexOf("paint.")===0?sr(le[pe],ie[pe],v,ee,pe.slice(6),Ot.setPaintProperty):Wt(le[pe],ie[pe])||v.push({command:Ot.setLayerProperty,args:[ee,pe,ie[pe]]}))}else v.push({command:Ot.removeLayer,args:[ee]}),ue=$[$.lastIndexOf(ee)+1],v.push({command:Ot.addLayer,args:[ie,ue]})}(d,e.layers,r)}catch(a){console.warn("Unable to compute style diff:",a),r=[{command:Ot.setStyle,args:[e]}]}return r},s.aF=function(i){const e=[],r=i.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},s.aG=function i(e,r){if(Array.isArray(e)){if(!Array.isArray(r)||e.length!==r.length)return!1;for(let a=0;a<e.length;a++)if(!i(e[a],r[a]))return!1;return!0}if(typeof e=="object"&&e!==null&&r!==null){if(typeof r!="object"||Object.keys(e).length!==Object.keys(r).length)return!1;for(const a in e)if(!i(e[a],r[a]))return!1;return!0}return e===r},s.aH=Te,s.aI=Ue,s.aJ=Oa,s.aK=function(i){return i({pluginStatus:Tr,pluginURL:Ln}),Oa.on("pluginStateChange",i),i},s.aL=class extends Jn{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},s.aM=Es,s.aN=class extends Jn{constructor(i,e){super(i,e),this.current=qc}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},s.aO=Zl,s.aP=class extends Jn{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},s.aQ=class extends Jn{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},s.aR=Hl,s.aS=function(i,e,r,a,l,d,f){var g=1/(e-r),v=1/(a-l),S=1/(d-f);return i[0]=-2*g,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*v,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*S,i[11]=0,i[12]=(e+r)*g,i[13]=(l+a)*v,i[14]=(f+d)*S,i[15]=1,i},s.aT=ui,s.aU=Qf,s.aV=class extends o{},s.aW=Hm,s.aX=class extends p{},s.aY=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},s.aZ=xh,s.a_=Ve,s.aa=function(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,a,l,d)=>{const f=l||d;return e[a]=!f||f.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e},s.ab=function(i,e){const r=[];for(const a in i)a in e||r.push(a);return r},s.ac=function(i){if(jt==null){const e=i.navigator?i.navigator.userAgent:null;jt=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return jt},s.ad=Re,s.ae=function(i,e,r){var a=Math.sin(r),l=Math.cos(r),d=e[0],f=e[1],g=e[2],v=e[3],S=e[4],I=e[5],M=e[6],D=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=d*l+S*a,i[1]=f*l+I*a,i[2]=g*l+M*a,i[3]=v*l+D*a,i[4]=S*l-d*a,i[5]=I*l-f*a,i[6]=M*l-g*a,i[7]=D*l-v*a,i},s.af=function(i){var e=new Ms(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},s.ag=Yl,s.ah=function(i,e){let r=0,a=0;if(i.kind==="constant")a=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:l,minZoom:d,maxZoom:f}=i,g=l?Re(Lr.interpolationFactor(l,e,d,f),0,1):0;i.kind==="camera"?a=Dr.number(i.minSize,i.maxSize,g):r=g}return{uSizeT:r,uSize:a}},s.aj=function(i,{uSize:e,uSizeT:r},{lowerSize:a,upperSize:l}){return i.kind==="source"?a/Bn:i.kind==="composite"?Dr.number(a/Bn,l/Bn,r):e},s.ak=gu,s.al=function(i,e,r,a){const l=e.y-i.y,d=e.x-i.x,f=a.y-r.y,g=a.x-r.x,v=f*d-g*l;if(v===0)return null;const S=(g*(i.y-r.y)-f*(i.x-r.x))/v;return new te(i.x+S*d,i.y+S*l)},s.am=wd,s.an=ch,s.ao=Xc,s.ap=Qi,s.ar=mu,s.as=function(i,e){var r=e[0],a=e[1],l=e[2],d=e[3],f=e[4],g=e[5],v=e[6],S=e[7],I=e[8],M=e[9],D=e[10],$=e[11],O=e[12],U=e[13],X=e[14],ee=e[15],le=r*g-a*f,ie=r*v-l*f,ue=r*S-d*f,pe=a*v-l*g,ke=a*S-d*g,et=l*S-d*v,lt=I*U-M*O,Je=I*X-D*O,He=I*ee-$*O,qe=M*X-D*U,rt=M*ee-$*U,Ge=D*ee-$*X,Oe=le*Ge-ie*rt+ue*qe+pe*He-ke*Je+et*lt;return Oe?(i[0]=(g*Ge-v*rt+S*qe)*(Oe=1/Oe),i[1]=(l*rt-a*Ge-d*qe)*Oe,i[2]=(U*et-X*ke+ee*pe)*Oe,i[3]=(D*ke-M*et-$*pe)*Oe,i[4]=(v*He-f*Ge-S*Je)*Oe,i[5]=(r*Ge-l*He+d*Je)*Oe,i[6]=(X*ue-O*et-ee*ie)*Oe,i[7]=(I*et-D*ue+$*ie)*Oe,i[8]=(f*rt-g*He+S*lt)*Oe,i[9]=(a*He-r*rt-d*lt)*Oe,i[10]=(O*ke-U*ue+ee*le)*Oe,i[11]=(M*ue-I*ke-$*le)*Oe,i[12]=(g*Je-f*qe-v*lt)*Oe,i[13]=(r*qe-a*Je+l*lt)*Oe,i[14]=(U*ie-O*pe-X*le)*Oe,i[15]=(I*pe-M*ie+D*le)*Oe,i):null},s.at=Cu,s.au=fu,s.av=Tu,s.aw=function(){const i={},e=_e.$version;for(const r in _e.$root){const a=_e.$root[r];if(a.required){let l=null;l=r==="version"?e:a.type==="array"?[]:{},l!=null&&(i[r]=l)}}return i},s.ax=Ot,s.ay=Fl,s.az=ei,s.b=function(i,e){const r=new Blob([new Uint8Array(i)],{type:"image/png"});createImageBitmap(r).then(a=>{e(null,a)}).catch(a=>{e(new Error(`Could not load image because of ${a.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},s.b0=lr,s.b1=function(i,e){var r=i[0],a=i[1],l=i[2],d=i[3],f=i[4],g=i[5],v=i[6],S=i[7],I=i[8],M=i[9],D=i[10],$=i[11],O=i[12],U=i[13],X=i[14],ee=i[15],le=e[0],ie=e[1],ue=e[2],pe=e[3],ke=e[4],et=e[5],lt=e[6],Je=e[7],He=e[8],qe=e[9],rt=e[10],Ge=e[11],Oe=e[12],_t=e[13],ht=e[14],Nt=e[15];return Math.abs(r-le)<=Er*Math.max(1,Math.abs(r),Math.abs(le))&&Math.abs(a-ie)<=Er*Math.max(1,Math.abs(a),Math.abs(ie))&&Math.abs(l-ue)<=Er*Math.max(1,Math.abs(l),Math.abs(ue))&&Math.abs(d-pe)<=Er*Math.max(1,Math.abs(d),Math.abs(pe))&&Math.abs(f-ke)<=Er*Math.max(1,Math.abs(f),Math.abs(ke))&&Math.abs(g-et)<=Er*Math.max(1,Math.abs(g),Math.abs(et))&&Math.abs(v-lt)<=Er*Math.max(1,Math.abs(v),Math.abs(lt))&&Math.abs(S-Je)<=Er*Math.max(1,Math.abs(S),Math.abs(Je))&&Math.abs(I-He)<=Er*Math.max(1,Math.abs(I),Math.abs(He))&&Math.abs(M-qe)<=Er*Math.max(1,Math.abs(M),Math.abs(qe))&&Math.abs(D-rt)<=Er*Math.max(1,Math.abs(D),Math.abs(rt))&&Math.abs($-Ge)<=Er*Math.max(1,Math.abs($),Math.abs(Ge))&&Math.abs(O-Oe)<=Er*Math.max(1,Math.abs(O),Math.abs(Oe))&&Math.abs(U-_t)<=Er*Math.max(1,Math.abs(U),Math.abs(_t))&&Math.abs(X-ht)<=Er*Math.max(1,Math.abs(X),Math.abs(ht))&&Math.abs(ee-Nt)<=Er*Math.max(1,Math.abs(ee),Math.abs(Nt))},s.b2=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},s.b3=function(i,e,r){return i[0]=e[0]*r[0],i[1]=e[1]*r[1],i[2]=e[2]*r[2],i[3]=e[3]*r[3],i},s.b4=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]},s.b5=Ne,s.b6=md,s.b7=dd,s.b8=function(i,e,r,a,l){var d,f=1/Math.tan(e/2);return i[0]=f/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=f,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,l!=null&&l!==1/0?(i[10]=(l+a)*(d=1/(a-l)),i[14]=2*l*a*d):(i[10]=-1,i[14]=-2*a),i},s.b9=function(i,e,r){var a=Math.sin(r),l=Math.cos(r),d=e[4],f=e[5],g=e[6],v=e[7],S=e[8],I=e[9],M=e[10],D=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=d*l+S*a,i[5]=f*l+I*a,i[6]=g*l+M*a,i[7]=v*l+D*a,i[8]=S*l-d*a,i[9]=I*l-f*a,i[10]=M*l-g*a,i[11]=D*l-v*a,i},s.bA=K,s.bB=jh,s.bC=gs,s.bD=Br,s.ba=xe,s.bb=Pe,s.bc=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},s.bd=class extends Va{},s.be=xu,s.bf=pd,s.bg=Mg,s.bi=Yt,s.bj=function(i,e,r=!1){if(Tr===_o||Tr===yo||Tr===vo)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ln=bt.resolveURL(i),Tr=_o,xo=e,bo(),r||jl()},s.bk=wo,s.bl=function(i,e){const r={};for(let l=0;l<i.length;l++){const d=e&&e[i[l].id]||xs(i[l]);e&&(e[i[l].id]=d);let f=r[d];f||(f=r[d]=[]),f.push(i[l])}const a=[];for(const l in r)a.push(r[l]);return a},s.bm=it,s.bn=_d,s.bo=vd,s.bp=Kh,s.bq=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=Hi/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const e=i.bucket.layers[0],r=e.layout,a=e._unevaluatedLayout._values,l={layoutIconSize:a["icon-size"].possiblyEvaluate(new yi(i.bucket.zoom+1),i.canonical),layoutTextSize:a["text-size"].possiblyEvaluate(new yi(i.bucket.zoom+1),i.canonical),textMaxSize:a["text-size"].possiblyEvaluate(new yi(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:S,maxZoom:I}=i.bucket.textSizeData;l.compositeTextSizes=[a["text-size"].possiblyEvaluate(new yi(S),i.canonical),a["text-size"].possiblyEvaluate(new yi(I),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:S,maxZoom:I}=i.bucket.iconSizeData;l.compositeIconSizes=[a["icon-size"].possiblyEvaluate(new yi(S),i.canonical),a["icon-size"].possiblyEvaluate(new yi(I),i.canonical)]}const d=r.get("text-line-height")*Qi,f=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",g=r.get("text-keep-upright"),v=r.get("text-size");for(const S of i.bucket.features){const I=r.get("text-font").evaluate(S,{},i.canonical).join(","),M=v.evaluate(S,{},i.canonical),D=l.layoutTextSize.evaluate(S,{},i.canonical),$=l.layoutIconSize.evaluate(S,{},i.canonical),O={horizontal:{},vertical:void 0},U=S.text;let X,ee=[0,0];if(U){const ue=U.toString(),pe=r.get("text-letter-spacing").evaluate(S,{},i.canonical)*Qi,ke=mo(ue)?pe:0,et=r.get("text-anchor").evaluate(S,{},i.canonical),lt=kd(e,S,i.canonical);if(!lt){const Ge=r.get("text-radial-offset").evaluate(S,{},i.canonical);ee=Ge?Ad(et,[Ge*Qi,Su]):r.get("text-offset").evaluate(S,{},i.canonical).map(Oe=>Oe*Qi)}let Je=f?"center":r.get("text-justify").evaluate(S,{},i.canonical);const He=r.get("symbol-placement"),qe=He==="point"?r.get("text-max-width").evaluate(S,{},i.canonical)*Qi:0,rt=()=>{i.bucket.allowVerticalPlacement&&fo(ue)&&(O.vertical=nc(U,i.glyphMap,i.glyphPositions,i.imagePositions,I,qe,d,et,"left",ke,ee,s.ai.vertical,!0,He,D,M))};if(!f&&lt){const Ge=new Set;if(Je==="auto")for(let _t=0;_t<lt.values.length;_t+=2)Ge.add(Cu(lt.values[_t]));else Ge.add(Je);let Oe=!1;for(const _t of Ge)if(!O.horizontal[_t])if(Oe)O.horizontal[_t]=O.horizontal[0];else{const ht=nc(U,i.glyphMap,i.glyphPositions,i.imagePositions,I,qe,d,"center",_t,ke,ee,s.ai.horizontal,!1,He,D,M);ht&&(O.horizontal[_t]=ht,Oe=ht.positionedLines.length===1)}rt()}else{Je==="auto"&&(Je=Cu(et));const Ge=nc(U,i.glyphMap,i.glyphPositions,i.imagePositions,I,qe,d,et,Je,ke,ee,s.ai.horizontal,!1,He,D,M);Ge&&(O.horizontal[Je]=Ge),rt(),fo(ue)&&f&&g&&(O.vertical=nc(U,i.glyphMap,i.glyphPositions,i.imagePositions,I,qe,d,et,Je,ke,ee,s.ai.vertical,!1,He,D,M))}}let le=!1;if(S.icon&&S.icon.name){const ue=i.imageMap[S.icon.name];ue&&(X=ug(i.imagePositions[S.icon.name],r.get("icon-offset").evaluate(S,{},i.canonical),r.get("icon-anchor").evaluate(S,{},i.canonical)),le=!!ue.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=le:i.bucket.sdfIcons!==le&&Xe("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ue.pixelRatio!==i.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const ie=Dd(O.horizontal)||O.vertical;i.bucket.iconsInText=!!ie&&ie.iconsInText,(ie||X)&&Eg(i.bucket,S,O,X,i.imageMap,l,D,$,ee,le,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},s.br=lu,s.bs=au,s.bt=ou,s.bu=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},s.bv=uu,s.bw=_a,s.bx=function(i,e,r,a,l){return j(this,void 0,void 0,function*(){if(ge())try{return yield Gt(i,e,r,a,l)}catch{}return function(d,f,g,v,S){const I=d.width,M=d.height;ft&&Be||(ft=new OffscreenCanvas(I,M),Be=ft.getContext("2d",{willReadFrequently:!0})),ft.width=I,ft.height=M,Be.drawImage(d,0,0,I,M);const D=Be.getImageData(f,g,v,S);return Be.clearRect(0,0,I,M),D.data}(i,e,r,a,l)})},s.by=gd,s.bz=L,s.c=Bt,s.d=function(i,e){const r=new Image;r.onload=()=>{e(null,r),URL.revokeObjectURL(r.src),r.onload=null,window.requestAnimationFrame(()=>{r.src=Qt})},r.onerror=()=>e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const a=new Blob([new Uint8Array(i)],{type:"image/png"});r.src=i.byteLength?URL.createObjectURL(a):Qt},s.e=Fe,s.f=function(i,e){return pi(Fe(i,{type:"json"}),e)},s.g=kt,s.h=bt,s.i=st,s.j=Oi,s.k=Mi,s.l=Pt,s.m=pi,s.n=function(i){return new uu(i).readFields(ng,[])},s.o=function(i,e,r){if(!i.length)return r(null,[]);let a=i.length;const l=new Array(i.length);let d=null;i.forEach((f,g)=>{e(f,(v,S)=>{v&&(d=v),l[g]=S,--a==0&&r(d,l)})})},s.p=Xh,s.q=Ro,s.r=ji,s.s=li,s.t=Nc,s.u=Qe,s.v=_e,s.w=Xe,s.x=Ss,s.y=vn,s.z=function([i,e,r]){return e+=90,e*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(r),y:i*Math.sin(e)*Math.sin(r),z:i*Math.cos(r)}}}),A(["./shared"],function(s){class j{constructor(z){this.keyCache={},z&&this.replace(z)}replace(z){this._layerConfigs={},this._layers={},this.update(z,[])}update(z,R){for(const W of z){this._layerConfigs[W.id]=W;const Y=this._layers[W.id]=s.aC(W);Y._featureFilter=s.a6(Y.filter),this.keyCache[W.id]&&delete this.keyCache[W.id]}for(const W of R)delete this.keyCache[W],delete this._layerConfigs[W],delete this._layers[W];this.familiesBySource={};const N=s.bl(Object.values(this._layerConfigs),this.keyCache);for(const W of N){const Y=W.map(Ie=>this._layers[Ie.id]),ce=Y[0];if(ce.visibility==="none")continue;const re=ce.source||"";let Q=this.familiesBySource[re];Q||(Q=this.familiesBySource[re]={});const se=ce.sourceLayer||"_geojsonTileLayer";let Ce=Q[se];Ce||(Ce=Q[se]=[]),Ce.push(Y)}}}class L{constructor(z){const R={},N=[];for(const re in z){const Q=z[re],se=R[re]={};for(const Ce in Q){const Ie=Q[+Ce];if(!Ie||Ie.bitmap.width===0||Ie.bitmap.height===0)continue;const Ae={x:0,y:0,w:Ie.bitmap.width+2,h:Ie.bitmap.height+2};N.push(Ae),se[Ce]={rect:Ae,metrics:Ie.metrics}}}const{w:W,h:Y}=s.p(N),ce=new s.q({width:W||1,height:Y||1});for(const re in z){const Q=z[re];for(const se in Q){const Ce=Q[+se];if(!Ce||Ce.bitmap.width===0||Ce.bitmap.height===0)continue;const Ie=R[re][se].rect;s.q.copy(Ce.bitmap,ce,{x:0,y:0},{x:Ie.x+1,y:Ie.y+1},Ce.bitmap)}}this.image=ce,this.positions=R}}s.bm("GlyphAtlas",L);class K{constructor(z){this.tileID=new s.O(z.tileID.overscaledZ,z.tileID.wrap,z.tileID.canonical.z,z.tileID.canonical.x,z.tileID.canonical.y),this.uid=z.uid,this.zoom=z.zoom,this.pixelRatio=z.pixelRatio,this.tileSize=z.tileSize,this.source=z.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=z.showCollisionBoxes,this.collectResourceTiming=!!z.collectResourceTiming,this.returnDependencies=!!z.returnDependencies,this.promoteId=z.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(z,R,N,W,Y){this.status="parsing",this.data=z,this.collisionBoxArray=new s.a3;const ce=new s.bn(Object.keys(z.layers).sort()),re=new s.bo(this.tileID,this.promoteId);re.bucketLayerIDs=[];const Q={},se={featureIndex:re,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:N},Ce=R.familiesBySource[this.source];for(const Rt in Ce){const Dt=z.layers[Rt];if(!Dt)continue;Dt.version===1&&s.w(`Vector tile source "${this.source}" layer "${Rt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ni=ce.encode(Rt),ci=[];for(let Li=0;Li<Dt.length;Li++){const Ri=Dt.feature(Li),Sr=re.getId(Ri,Rt);ci.push({feature:Ri,id:Sr,index:Li,sourceLayerIndex:Ni})}for(const Li of Ce[Rt]){const Ri=Li[0];Ri.source!==this.source&&s.w(`layer.source = ${Ri.source} does not equal this.source = ${this.source}`),Ri.minzoom&&this.zoom<Math.floor(Ri.minzoom)||Ri.maxzoom&&this.zoom>=Ri.maxzoom||Ri.visibility!=="none"&&(ne(Li,this.zoom,N),(Q[Ri.id]=Ri.createBucket({index:re.bucketLayerIDs.length,layers:Li,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ni,sourceID:this.source})).populate(ci,se,this.tileID.canonical),re.bucketLayerIDs.push(Li.map(Sr=>Sr.id)))}}let Ie,Ae,dt,St;const nt=s.aH(se.glyphDependencies,Rt=>Object.keys(Rt).map(Number));this.inFlightDependencies.forEach(Rt=>Rt?.cancel()),this.inFlightDependencies=[];const Ke=++this.dependencySentinel;Object.keys(nt).length?this.inFlightDependencies.push(W.send("getGlyphs",{uid:this.uid,stacks:nt,source:this.source,tileID:this.tileID,type:"glyphs"},(Rt,Dt)=>{Ke===this.dependencySentinel&&(Ie||(Ie=Rt,Ae=Dt,Ft.call(this)))})):Ae={};const Ye=Object.keys(se.iconDependencies);Ye.length?this.inFlightDependencies.push(W.send("getImages",{icons:Ye,source:this.source,tileID:this.tileID,type:"icons"},(Rt,Dt)=>{Ke===this.dependencySentinel&&(Ie||(Ie=Rt,dt=Dt,Ft.call(this)))})):dt={};const Et=Object.keys(se.patternDependencies);function Ft(){if(Ie)return Y(Ie);if(Ae&&dt&&St){const Rt=new L(Ae),Dt=new s.bp(dt,St);for(const Ni in Q){const ci=Q[Ni];ci instanceof s.a4?(ne(ci.layers,this.zoom,N),s.bq({bucket:ci,glyphMap:Ae,glyphPositions:Rt.positions,imageMap:dt,imagePositions:Dt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):ci.hasPattern&&(ci instanceof s.br||ci instanceof s.bs||ci instanceof s.bt)&&(ne(ci.layers,this.zoom,N),ci.addFeatures(se,this.tileID.canonical,Dt.patternPositions))}this.status="done",Y(null,{buckets:Object.values(Q).filter(Ni=>!Ni.isEmpty()),featureIndex:re,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Rt.image,imageAtlas:Dt,glyphMap:this.returnDependencies?Ae:null,iconMap:this.returnDependencies?dt:null,glyphPositions:this.returnDependencies?Rt.positions:null})}}Et.length?this.inFlightDependencies.push(W.send("getImages",{icons:Et,source:this.source,tileID:this.tileID,type:"patterns"},(Rt,Dt)=>{Ke===this.dependencySentinel&&(Ie||(Ie=Rt,St=Dt,Ft.call(this)))})):St={},Ft.call(this)}}function ne(Z,z,R){const N=new s.a8(z);for(const W of Z)W.recalculate(N,R)}function te(Z,z){const R=s.l(Z.request,(N,W,Y,ce)=>{if(N)z(N);else if(W)try{const re=new s.bw.VectorTile(new s.bv(W));z(null,{vectorTile:re,rawData:W,cacheControl:Y,expires:ce})}catch(re){const Q=new Uint8Array(W);let se=`Unable to parse the tile at ${Z.request.url}, `;se+=Q[0]===31&&Q[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${re.messge}`,z(new Error(se))}});return()=>{R.cancel(),z()}}class he{constructor(z,R,N,W){this.actor=z,this.layerIndex=R,this.availableImages=N,this.loadVectorData=W||te,this.fetching={},this.loading={},this.loaded={}}loadTile(z,R){const N=z.uid;this.loading||(this.loading={});const W=!!(z&&z.request&&z.request.collectResourceTiming)&&new s.bu(z.request),Y=this.loading[N]=new K(z);Y.abort=this.loadVectorData(z,(ce,re)=>{if(delete this.loading[N],ce||!re)return Y.status="done",this.loaded[N]=Y,R(ce);const Q=re.rawData,se={};re.expires&&(se.expires=re.expires),re.cacheControl&&(se.cacheControl=re.cacheControl);const Ce={};if(W){const Ie=W.finish();Ie&&(Ce.resourceTiming=JSON.parse(JSON.stringify(Ie)))}Y.vectorTile=re.vectorTile,Y.parse(re.vectorTile,this.layerIndex,this.availableImages,this.actor,(Ie,Ae)=>{if(delete this.fetching[N],Ie||!Ae)return R(Ie);R(null,s.e({rawTileData:Q.slice(0)},Ae,se,Ce))}),this.loaded=this.loaded||{},this.loaded[N]=Y,this.fetching[N]={rawTileData:Q,cacheControl:se,resourceTiming:Ce}})}reloadTile(z,R){const N=this.loaded,W=z.uid;if(N&&N[W]){const Y=N[W];Y.showCollisionBoxes=z.showCollisionBoxes,Y.status==="parsing"?Y.parse(Y.vectorTile,this.layerIndex,this.availableImages,this.actor,(ce,re)=>{if(ce||!re)return R(ce,re);let Q;if(this.fetching[W]){const{rawTileData:se,cacheControl:Ce,resourceTiming:Ie}=this.fetching[W];delete this.fetching[W],Q=s.e({rawTileData:se.slice(0)},re,Ce,Ie)}else Q=re;R(null,Q)}):Y.status==="done"&&(Y.vectorTile?Y.parse(Y.vectorTile,this.layerIndex,this.availableImages,this.actor,R):R())}}abortTile(z,R){const N=this.loading,W=z.uid;N&&N[W]&&N[W].abort&&(N[W].abort(),delete N[W]),R()}removeTile(z,R){const N=this.loaded,W=z.uid;N&&N[W]&&delete N[W],R()}}class ye{constructor(){this.loaded={}}loadTile(z,R){return s._(this,void 0,void 0,function*(){const{uid:N,encoding:W,rawImageData:Y,redFactor:ce,greenFactor:re,blueFactor:Q,baseShift:se}=z,Ce=Y.width+2,Ie=Y.height+2,Ae=s.a(Y)?new s.R({width:Ce,height:Ie},yield s.bx(Y,-1,-1,Ce,Ie)):Y,dt=new s.by(N,Ae,W,ce,re,Q,se);this.loaded=this.loaded||{},this.loaded[N]=dt,R(null,dt)})}removeTile(z){const R=this.loaded,N=z.uid;R&&R[N]&&delete R[N]}}function be(Z,z){if(Z.length!==0){Se(Z[0],z);for(var R=1;R<Z.length;R++)Se(Z[R],!z)}}function Se(Z,z){for(var R=0,N=0,W=0,Y=Z.length,ce=Y-1;W<Y;ce=W++){var re=(Z[W][0]-Z[ce][0])*(Z[ce][1]+Z[W][1]),Q=R+re;N+=Math.abs(R)>=Math.abs(re)?R-Q+re:re-Q+R,R=Q}R+N>=0!=!!z&&Z.reverse()}var ve=s.bz(function Z(z,R){var N,W=z&&z.type;if(W==="FeatureCollection")for(N=0;N<z.features.length;N++)Z(z.features[N],R);else if(W==="GeometryCollection")for(N=0;N<z.geometries.length;N++)Z(z.geometries[N],R);else if(W==="Feature")Z(z.geometry,R);else if(W==="Polygon")be(z.coordinates,R);else if(W==="MultiPolygon")for(N=0;N<z.coordinates.length;N++)be(z.coordinates[N],R);return z});const we=s.bw.VectorTileFeature.prototype.toGeoJSON;var ge={exports:{}},xe=s.bA,Pe=s.bw.VectorTileFeature,Re=Ne;function Ne(Z,z){this.options=z||{},this.features=Z,this.length=Z.length}function Fe(Z,z){this.id=typeof Z.id=="number"?Z.id:void 0,this.type=Z.type,this.rawGeometry=Z.type===1?[Z.geometry]:Z.geometry,this.properties=Z.tags,this.extent=z||4096}Ne.prototype.feature=function(Z){return new Fe(this.features[Z],this.options.extent)},Fe.prototype.loadGeometry=function(){var Z=this.rawGeometry;this.geometry=[];for(var z=0;z<Z.length;z++){for(var R=Z[z],N=[],W=0;W<R.length;W++)N.push(new xe(R[W][0],R[W][1]));this.geometry.push(N)}return this.geometry},Fe.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Z=this.geometry,z=1/0,R=-1/0,N=1/0,W=-1/0,Y=0;Y<Z.length;Y++)for(var ce=Z[Y],re=0;re<ce.length;re++){var Q=ce[re];z=Math.min(z,Q.x),R=Math.max(R,Q.x),N=Math.min(N,Q.y),W=Math.max(W,Q.y)}return[z,N,R,W]},Fe.prototype.toGeoJSON=Pe.prototype.toGeoJSON;var Le=s.bB,Te=Re;function Ue(Z){var z=new Le;return function(R,N){for(var W in R.layers)N.writeMessage(3,We,R.layers[W])}(Z,z),z.finish()}function We(Z,z){var R;z.writeVarintField(15,Z.version||1),z.writeStringField(1,Z.name||""),z.writeVarintField(5,Z.extent||4096);var N={keys:[],values:[],keycache:{},valuecache:{}};for(R=0;R<Z.length;R++)N.feature=Z.feature(R),z.writeMessage(2,tt,N);var W=N.keys;for(R=0;R<W.length;R++)z.writeStringField(3,W[R]);var Y=N.values;for(R=0;R<Y.length;R++)z.writeMessage(4,jt,Y[R])}function tt(Z,z){var R=Z.feature;R.id!==void 0&&z.writeVarintField(1,R.id),z.writeMessage(2,Xe,Z),z.writeVarintField(3,R.type),z.writeMessage(4,st,R)}function Xe(Z,z){var R=Z.feature,N=Z.keys,W=Z.values,Y=Z.keycache,ce=Z.valuecache;for(var re in R.properties){var Q=R.properties[re],se=Y[re];if(Q!==null){se===void 0&&(N.push(re),Y[re]=se=N.length-1),z.writeVarint(se);var Ce=typeof Q;Ce!=="string"&&Ce!=="boolean"&&Ce!=="number"&&(Q=JSON.stringify(Q));var Ie=Ce+":"+Q,Ae=ce[Ie];Ae===void 0&&(W.push(Q),ce[Ie]=Ae=W.length-1),z.writeVarint(Ae)}}}function at(Z,z){return(z<<3)+(7&Z)}function Ct(Z){return Z<<1^Z>>31}function st(Z,z){for(var R=Z.loadGeometry(),N=Z.type,W=0,Y=0,ce=R.length,re=0;re<ce;re++){var Q=R[re],se=1;N===1&&(se=Q.length),z.writeVarint(at(1,se));for(var Ce=N===3?Q.length-1:Q.length,Ie=0;Ie<Ce;Ie++){Ie===1&&N!==1&&z.writeVarint(at(2,Ce-1));var Ae=Q[Ie].x-W,dt=Q[Ie].y-Y;z.writeVarint(Ct(Ae)),z.writeVarint(Ct(dt)),W+=Ae,Y+=dt}N===3&&z.writeVarint(at(7,1))}}function jt(Z,z){var R=typeof Z;R==="string"?z.writeStringField(1,Z):R==="boolean"?z.writeBooleanField(7,Z):R==="number"&&(Z%1!=0?z.writeDoubleField(3,Z):Z<0?z.writeSVarintField(6,Z):z.writeVarintField(5,Z))}ge.exports=Ue,ge.exports.fromVectorTileJs=Ue,ge.exports.fromGeojsonVt=function(Z,z){z=z||{};var R={};for(var N in Z)R[N]=new Te(Z[N].features,z),R[N].name=N,R[N].version=z.version,R[N].extent=z.extent;return Ue({layers:R})},ge.exports.GeoJSONWrapper=Te;var At=s.bz(ge.exports);const Qt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Z=>Z},Gt=Math.fround||(ft=new Float32Array(1),Z=>(ft[0]=+Z,ft[0]));var ft;const Be=3,gt=5,$t=6;class bt{constructor(z){this.options=Object.assign(Object.create(Qt),z),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(z){const{log:R,minZoom:N,maxZoom:W}=this.options;R&&console.time("total time");const Y=`prepare ${z.length} points`;R&&console.time(Y),this.points=z;const ce=[];for(let Q=0;Q<z.length;Q++){const se=z[Q];if(!se.geometry)continue;const[Ce,Ie]=se.geometry.coordinates,Ae=Gt(ei(Ce)),dt=Gt(kt(Ie));ce.push(Ae,dt,1/0,Q,-1,1),this.options.reduce&&ce.push(0)}let re=this.trees[W+1]=this._createTree(ce);R&&console.timeEnd(Y);for(let Q=W;Q>=N;Q--){const se=+Date.now();re=this.trees[Q]=this._createTree(this._cluster(re,Q)),R&&console.log("z%d: %d clusters in %dms",Q,re.numItems,+Date.now()-se)}return R&&console.timeEnd("total time"),this}getClusters(z,R){let N=((z[0]+180)%360+360)%360-180;const W=Math.max(-90,Math.min(90,z[1]));let Y=z[2]===180?180:((z[2]+180)%360+360)%360-180;const ce=Math.max(-90,Math.min(90,z[3]));if(z[2]-z[0]>=360)N=-180,Y=180;else if(N>Y){const Ie=this.getClusters([N,W,180,ce],R),Ae=this.getClusters([-180,W,Y,ce],R);return Ie.concat(Ae)}const re=this.trees[this._limitZoom(R)],Q=re.range(ei(N),kt(ce),ei(Y),kt(W)),se=re.data,Ce=[];for(const Ie of Q){const Ae=this.stride*Ie;Ce.push(se[Ae+gt]>1?Bt(se,Ae,this.clusterProps):this.points[se[Ae+Be]])}return Ce}getChildren(z){const R=this._getOriginId(z),N=this._getOriginZoom(z),W="No cluster with the specified id.",Y=this.trees[N];if(!Y)throw new Error(W);const ce=Y.data;if(R*this.stride>=ce.length)throw new Error(W);const re=this.options.radius/(this.options.extent*Math.pow(2,N-1)),Q=Y.within(ce[R*this.stride],ce[R*this.stride+1],re),se=[];for(const Ce of Q){const Ie=Ce*this.stride;ce[Ie+4]===z&&se.push(ce[Ie+gt]>1?Bt(ce,Ie,this.clusterProps):this.points[ce[Ie+Be]])}if(se.length===0)throw new Error(W);return se}getLeaves(z,R,N){const W=[];return this._appendLeaves(W,z,R=R||10,N=N||0,0),W}getTile(z,R,N){const W=this.trees[this._limitZoom(z)],Y=Math.pow(2,z),{extent:ce,radius:re}=this.options,Q=re/ce,se=(N-Q)/Y,Ce=(N+1+Q)/Y,Ie={features:[]};return this._addTileFeatures(W.range((R-Q)/Y,se,(R+1+Q)/Y,Ce),W.data,R,N,Y,Ie),R===0&&this._addTileFeatures(W.range(1-Q/Y,se,1,Ce),W.data,Y,N,Y,Ie),R===Y-1&&this._addTileFeatures(W.range(0,se,Q/Y,Ce),W.data,-1,N,Y,Ie),Ie.features.length?Ie:null}getClusterExpansionZoom(z){let R=this._getOriginZoom(z)-1;for(;R<=this.options.maxZoom;){const N=this.getChildren(z);if(R++,N.length!==1)break;z=N[0].properties.cluster_id}return R}_appendLeaves(z,R,N,W,Y){const ce=this.getChildren(R);for(const re of ce){const Q=re.properties;if(Q&&Q.cluster?Y+Q.point_count<=W?Y+=Q.point_count:Y=this._appendLeaves(z,Q.cluster_id,N,W,Y):Y<W?Y++:z.push(re),z.length===N)break}return Y}_createTree(z){const R=new s.av(z.length/this.stride|0,this.options.nodeSize,Float32Array);for(let N=0;N<z.length;N+=this.stride)R.add(z[N],z[N+1]);return R.finish(),R.data=z,R}_addTileFeatures(z,R,N,W,Y,ce){for(const re of z){const Q=re*this.stride,se=R[Q+gt]>1;let Ce,Ie,Ae;if(se)Ce=Yt(R,Q,this.clusterProps),Ie=R[Q],Ae=R[Q+1];else{const nt=this.points[R[Q+Be]];Ce=nt.properties;const[Ke,Ye]=nt.geometry.coordinates;Ie=ei(Ke),Ae=kt(Ye)}const dt={type:1,geometry:[[Math.round(this.options.extent*(Ie*Y-N)),Math.round(this.options.extent*(Ae*Y-W))]],tags:Ce};let St;St=se||this.options.generateId?R[Q+Be]:this.points[R[Q+Be]].id,St!==void 0&&(dt.id=St),ce.features.push(dt)}}_limitZoom(z){return Math.max(this.options.minZoom,Math.min(Math.floor(+z),this.options.maxZoom+1))}_cluster(z,R){const{radius:N,extent:W,reduce:Y,minPoints:ce}=this.options,re=N/(W*Math.pow(2,R)),Q=z.data,se=[],Ce=this.stride;for(let Ie=0;Ie<Q.length;Ie+=Ce){if(Q[Ie+2]<=R)continue;Q[Ie+2]=R;const Ae=Q[Ie],dt=Q[Ie+1],St=z.within(Q[Ie],Q[Ie+1],re),nt=Q[Ie+gt];let Ke=nt;for(const Ye of St){const Et=Ye*Ce;Q[Et+2]>R&&(Ke+=Q[Et+gt])}if(Ke>nt&&Ke>=ce){let Ye,Et=Ae*nt,Ft=dt*nt,Rt=-1;const Dt=((Ie/Ce|0)<<5)+(R+1)+this.points.length;for(const Ni of St){const ci=Ni*Ce;if(Q[ci+2]<=R)continue;Q[ci+2]=R;const Li=Q[ci+gt];Et+=Q[ci]*Li,Ft+=Q[ci+1]*Li,Q[ci+4]=Dt,Y&&(Ye||(Ye=this._map(Q,Ie,!0),Rt=this.clusterProps.length,this.clusterProps.push(Ye)),Y(Ye,this._map(Q,ci)))}Q[Ie+4]=Dt,se.push(Et/Ke,Ft/Ke,1/0,Dt,-1,Ke),Y&&se.push(Rt)}else{for(let Ye=0;Ye<Ce;Ye++)se.push(Q[Ie+Ye]);if(Ke>1)for(const Ye of St){const Et=Ye*Ce;if(!(Q[Et+2]<=R)){Q[Et+2]=R;for(let Ft=0;Ft<Ce;Ft++)se.push(Q[Et+Ft])}}}}return se}_getOriginId(z){return z-this.points.length>>5}_getOriginZoom(z){return(z-this.points.length)%32}_map(z,R,N){if(z[R+gt]>1){const ce=this.clusterProps[z[R+$t]];return N?Object.assign({},ce):ce}const W=this.points[z[R+Be]].properties,Y=this.options.map(W);return N&&Y===W?Object.assign({},Y):Y}}function Bt(Z,z,R){return{type:"Feature",id:Z[z+Be],properties:Yt(Z,z,R),geometry:{type:"Point",coordinates:[(N=Z[z],360*(N-.5)),gi(Z[z+1])]}};var N}function Yt(Z,z,R){const N=Z[z+gt],W=N>=1e4?`${Math.round(N/1e3)}k`:N>=1e3?Math.round(N/100)/10+"k":N,Y=Z[z+$t],ce=Y===-1?{}:Object.assign({},R[Y]);return Object.assign(ce,{cluster:!0,cluster_id:Z[z+Be],point_count:N,point_count_abbreviated:W})}function ei(Z){return Z/360+.5}function kt(Z){const z=Math.sin(Z*Math.PI/180),R=.5-.25*Math.log((1+z)/(1-z))/Math.PI;return R<0?0:R>1?1:R}function gi(Z){const z=(180-360*Z)*Math.PI/180;return 360*Math.atan(Math.exp(z))/Math.PI-90}function pi(Z,z,R,N){for(var W,Y=N,ce=R-z>>1,re=R-z,Q=Z[z],se=Z[z+1],Ce=Z[R],Ie=Z[R+1],Ae=z+3;Ae<R;Ae+=3){var dt=Pt(Z[Ae],Z[Ae+1],Q,se,Ce,Ie);if(dt>Y)W=Ae,Y=dt;else if(dt===Y){var St=Math.abs(Ae-ce);St<re&&(W=Ae,re=St)}}Y>N&&(W-z>3&&pi(Z,z,W,N),Z[W+2]=Y,R-W>3&&pi(Z,W,R,N))}function Pt(Z,z,R,N,W,Y){var ce=W-R,re=Y-N;if(ce!==0||re!==0){var Q=((Z-R)*ce+(z-N)*re)/(ce*ce+re*re);Q>1?(R=W,N=Y):Q>0&&(R+=ce*Q,N+=re*Q)}return(ce=Z-R)*ce+(re=z-N)*re}function li(Z,z,R,N){var W={id:Z===void 0?null:Z,type:z,geometry:R,tags:N,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Y){var ce=Y.geometry,re=Y.type;if(re==="Point"||re==="MultiPoint"||re==="LineString")Xi(Y,ce);else if(re==="Polygon"||re==="MultiLineString")for(var Q=0;Q<ce.length;Q++)Xi(Y,ce[Q]);else if(re==="MultiPolygon")for(Q=0;Q<ce.length;Q++)for(var se=0;se<ce[Q].length;se++)Xi(Y,ce[Q][se])}(W),W}function Xi(Z,z){for(var R=0;R<z.length;R+=3)Z.minX=Math.min(Z.minX,z[R]),Z.minY=Math.min(Z.minY,z[R+1]),Z.maxX=Math.max(Z.maxX,z[R]),Z.maxY=Math.max(Z.maxY,z[R+1])}function Ht(Z,z,R,N){if(z.geometry){var W=z.geometry.coordinates,Y=z.geometry.type,ce=Math.pow(R.tolerance/((1<<R.maxZoom)*R.extent),2),re=[],Q=z.id;if(R.promoteId?Q=z.properties[R.promoteId]:R.generateId&&(Q=N||0),Y==="Point")Mi(W,re);else if(Y==="MultiPoint")for(var se=0;se<W.length;se++)Mi(W[se],re);else if(Y==="LineString")Oi(W,re,ce,!1);else if(Y==="MultiLineString"){if(R.lineMetrics){for(se=0;se<W.length;se++)Oi(W[se],re=[],ce,!1),Z.push(li(Q,"LineString",re,z.properties));return}gr(W,re,ce,!1)}else if(Y==="Polygon")gr(W,re,ce,!0);else{if(Y!=="MultiPolygon"){if(Y==="GeometryCollection"){for(se=0;se<z.geometry.geometries.length;se++)Ht(Z,{id:Q,geometry:z.geometry.geometries[se],properties:z.properties},R,N);return}throw new Error("Input data is not a valid GeoJSON object.")}for(se=0;se<W.length;se++){var Ce=[];gr(W[se],Ce,ce,!0),re.push(Ce)}}Z.push(li(Q,Y,re,z.properties))}}function Mi(Z,z){z.push(_e(Z[0])),z.push(bi(Z[1])),z.push(0)}function Oi(Z,z,R,N){for(var W,Y,ce=0,re=0;re<Z.length;re++){var Q=_e(Z[re][0]),se=bi(Z[re][1]);z.push(Q),z.push(se),z.push(0),re>0&&(ce+=N?(W*se-Q*Y)/2:Math.sqrt(Math.pow(Q-W,2)+Math.pow(se-Y,2))),W=Q,Y=se}var Ce=z.length-3;z[2]=1,pi(z,0,Ce,R),z[Ce+2]=1,z.size=Math.abs(ce),z.start=0,z.end=z.size}function gr(Z,z,R,N){for(var W=0;W<Z.length;W++){var Y=[];Oi(Z[W],Y,R,N),z.push(Y)}}function _e(Z){return Z/360+.5}function bi(Z){var z=Math.sin(Z*Math.PI/180),R=.5-.25*Math.log((1+z)/(1-z))/Math.PI;return R<0?0:R>1?1:R}function Di(Z,z,R,N,W,Y,ce,re){if(N/=z,Y>=(R/=z)&&ce<N)return Z;if(ce<R||Y>=N)return null;for(var Q=[],se=0;se<Z.length;se++){var Ce=Z[se],Ie=Ce.geometry,Ae=Ce.type,dt=W===0?Ce.minX:Ce.minY,St=W===0?Ce.maxX:Ce.maxY;if(dt>=R&&St<N)Q.push(Ce);else if(!(St<R||dt>=N)){var nt=[];if(Ae==="Point"||Ae==="MultiPoint")Wt(Ie,nt,R,N,W);else if(Ae==="LineString")Ot(Ie,nt,R,N,W,!1,re.lineMetrics);else if(Ae==="MultiLineString")Ki(Ie,nt,R,N,W,!1);else if(Ae==="Polygon")Ki(Ie,nt,R,N,W,!0);else if(Ae==="MultiPolygon")for(var Ke=0;Ke<Ie.length;Ke++){var Ye=[];Ki(Ie[Ke],Ye,R,N,W,!0),Ye.length&&nt.push(Ye)}if(nt.length){if(re.lineMetrics&&Ae==="LineString"){for(Ke=0;Ke<nt.length;Ke++)Q.push(li(Ce.id,Ae,nt[Ke],Ce.tags));continue}Ae!=="LineString"&&Ae!=="MultiLineString"||(nt.length===1?(Ae="LineString",nt=nt[0]):Ae="MultiLineString"),Ae!=="Point"&&Ae!=="MultiPoint"||(Ae=nt.length===3?"Point":"MultiPoint"),Q.push(li(Ce.id,Ae,nt,Ce.tags))}}}return Q.length?Q:null}function Wt(Z,z,R,N,W){for(var Y=0;Y<Z.length;Y+=3){var ce=Z[Y+W];ce>=R&&ce<=N&&(z.push(Z[Y]),z.push(Z[Y+1]),z.push(Z[Y+2]))}}function Ot(Z,z,R,N,W,Y,ce){for(var re,Q,se=Gi(Z),Ce=W===0?sn:sr,Ie=Z.start,Ae=0;Ae<Z.length-3;Ae+=3){var dt=Z[Ae],St=Z[Ae+1],nt=Z[Ae+2],Ke=Z[Ae+3],Ye=Z[Ae+4],Et=W===0?dt:St,Ft=W===0?Ke:Ye,Rt=!1;ce&&(re=Math.sqrt(Math.pow(dt-Ke,2)+Math.pow(St-Ye,2))),Et<R?Ft>R&&(Q=Ce(se,dt,St,Ke,Ye,R),ce&&(se.start=Ie+re*Q)):Et>N?Ft<N&&(Q=Ce(se,dt,St,Ke,Ye,N),ce&&(se.start=Ie+re*Q)):_i(se,dt,St,nt),Ft<R&&Et>=R&&(Q=Ce(se,dt,St,Ke,Ye,R),Rt=!0),Ft>N&&Et<=N&&(Q=Ce(se,dt,St,Ke,Ye,N),Rt=!0),!Y&&Rt&&(ce&&(se.end=Ie+re*Q),z.push(se),se=Gi(Z)),ce&&(Ie+=re)}var Dt=Z.length-3;dt=Z[Dt],St=Z[Dt+1],nt=Z[Dt+2],(Et=W===0?dt:St)>=R&&Et<=N&&_i(se,dt,St,nt),Dt=se.length-3,Y&&Dt>=3&&(se[Dt]!==se[0]||se[Dt+1]!==se[1])&&_i(se,se[0],se[1],se[2]),se.length&&z.push(se)}function Gi(Z){var z=[];return z.size=Z.size,z.start=Z.start,z.end=Z.end,z}function Ki(Z,z,R,N,W,Y){for(var ce=0;ce<Z.length;ce++)Ot(Z[ce],z,R,N,W,Y,!1)}function _i(Z,z,R,N){Z.push(z),Z.push(R),Z.push(N)}function sn(Z,z,R,N,W,Y){var ce=(Y-z)/(N-z);return Z.push(Y),Z.push(R+(W-R)*ce),Z.push(1),ce}function sr(Z,z,R,N,W,Y){var ce=(Y-R)/(W-R);return Z.push(z+(N-z)*ce),Z.push(Y),Z.push(1),ce}function ar(Z,z){for(var R=[],N=0;N<Z.length;N++){var W,Y=Z[N],ce=Y.type;if(ce==="Point"||ce==="MultiPoint"||ce==="LineString")W=Ur(Y.geometry,z);else if(ce==="MultiLineString"||ce==="Polygon"){W=[];for(var re=0;re<Y.geometry.length;re++)W.push(Ur(Y.geometry[re],z))}else if(ce==="MultiPolygon")for(W=[],re=0;re<Y.geometry.length;re++){for(var Q=[],se=0;se<Y.geometry[re].length;se++)Q.push(Ur(Y.geometry[re][se],z));W.push(Q)}R.push(li(Y.id,ce,W,Y.tags))}return R}function Ur(Z,z){var R=[];R.size=Z.size,Z.start!==void 0&&(R.start=Z.start,R.end=Z.end);for(var N=0;N<Z.length;N+=3)R.push(Z[N]+z,Z[N+1],Z[N+2]);return R}function je(Z,z){if(Z.transformed)return Z;var R,N,W,Y=1<<Z.z,ce=Z.x,re=Z.y;for(R=0;R<Z.features.length;R++){var Q=Z.features[R],se=Q.geometry,Ce=Q.type;if(Q.geometry=[],Ce===1)for(N=0;N<se.length;N+=2)Q.geometry.push(It(se[N],se[N+1],z,Y,ce,re));else for(N=0;N<se.length;N++){var Ie=[];for(W=0;W<se[N].length;W+=2)Ie.push(It(se[N][W],se[N][W+1],z,Y,ce,re));Q.geometry.push(Ie)}}return Z.transformed=!0,Z}function It(Z,z,R,N,W,Y){return[Math.round(R*(Z*N-W)),Math.round(R*(z*N-Y))]}function wt(Z,z,R,N,W){for(var Y=z===W.maxZoom?0:W.tolerance/((1<<z)*W.extent),ce={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:R,y:N,z,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},re=0;re<Z.length;re++){ce.numFeatures++,Jt(ce,Z[re],Y,W);var Q=Z[re].minX,se=Z[re].minY,Ce=Z[re].maxX,Ie=Z[re].maxY;Q<ce.minX&&(ce.minX=Q),se<ce.minY&&(ce.minY=se),Ce>ce.maxX&&(ce.maxX=Ce),Ie>ce.maxY&&(ce.maxY=Ie)}return ce}function Jt(Z,z,R,N){var W=z.geometry,Y=z.type,ce=[];if(Y==="Point"||Y==="MultiPoint")for(var re=0;re<W.length;re+=3)ce.push(W[re]),ce.push(W[re+1]),Z.numPoints++,Z.numSimplified++;else if(Y==="LineString")zt(ce,W,Z,R,!1,!1);else if(Y==="MultiLineString"||Y==="Polygon")for(re=0;re<W.length;re++)zt(ce,W[re],Z,R,Y==="Polygon",re===0);else if(Y==="MultiPolygon")for(var Q=0;Q<W.length;Q++){var se=W[Q];for(re=0;re<se.length;re++)zt(ce,se[re],Z,R,!0,re===0)}if(ce.length){var Ce=z.tags||null;if(Y==="LineString"&&N.lineMetrics){for(var Ie in Ce={},z.tags)Ce[Ie]=z.tags[Ie];Ce.mapbox_clip_start=W.start/W.size,Ce.mapbox_clip_end=W.end/W.size}var Ae={geometry:ce,type:Y==="Polygon"||Y==="MultiPolygon"?3:Y==="LineString"||Y==="MultiLineString"?2:1,tags:Ce};z.id!==null&&(Ae.id=z.id),Z.features.push(Ae)}}function zt(Z,z,R,N,W,Y){var ce=N*N;if(N>0&&z.size<(W?ce:N))R.numPoints+=z.length/3;else{for(var re=[],Q=0;Q<z.length;Q+=3)(N===0||z[Q+2]>ce)&&(R.numSimplified++,re.push(z[Q]),re.push(z[Q+1])),R.numPoints++;W&&function(se,Ce){for(var Ie=0,Ae=0,dt=se.length,St=dt-2;Ae<dt;St=Ae,Ae+=2)Ie+=(se[Ae]-se[St])*(se[Ae+1]+se[St+1]);if(Ie>0===Ce)for(Ae=0,dt=se.length;Ae<dt/2;Ae+=2){var nt=se[Ae],Ke=se[Ae+1];se[Ae]=se[dt-2-Ae],se[Ae+1]=se[dt-1-Ae],se[dt-2-Ae]=nt,se[dt-1-Ae]=Ke}}(re,Y),Z.push(re)}}function ze(Z,z){var R=(z=this.options=function(W,Y){for(var ce in Y)W[ce]=Y[ce];return W}(Object.create(this.options),z)).debug;if(R&&console.time("preprocess data"),z.maxZoom<0||z.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(z.promoteId&&z.generateId)throw new Error("promoteId and generateId cannot be used together.");var N=function(W,Y){var ce=[];if(W.type==="FeatureCollection")for(var re=0;re<W.features.length;re++)Ht(ce,W.features[re],Y,re);else Ht(ce,W.type==="Feature"?W:{geometry:W},Y);return ce}(Z,z);this.tiles={},this.tileCoords=[],R&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",z.indexMaxZoom,z.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),N=function(W,Y){var ce=Y.buffer/Y.extent,re=W,Q=Di(W,1,-1-ce,ce,0,-1,2,Y),se=Di(W,1,1-ce,2+ce,0,-1,2,Y);return(Q||se)&&(re=Di(W,1,-ce,1+ce,0,-1,2,Y)||[],Q&&(re=ar(Q,1).concat(re)),se&&(re=re.concat(ar(se,-1)))),re}(N,z),N.length&&this.splitTile(N,0,0,0),R&&(N.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function mt(Z,z,R){return 32*((1<<Z)*R+z)+Z}function yt(Z,z){return z?Z.properties[z]:Z.id}function wi(Z,z){if(Z==null)return!0;if(Z.type==="Feature")return yt(Z,z)!=null;if(Z.type==="FeatureCollection"){const R=new Set;for(const N of Z.features){const W=yt(N,z);if(W==null||R.has(W))return!1;R.add(W)}return!0}return!1}function Zi(Z,z){const R=new Map;if(Z!=null)if(Z.type==="Feature")R.set(yt(Z,z),Z);else for(const N of Z.features)R.set(yt(N,z),N);return R}ze.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ze.prototype.splitTile=function(Z,z,R,N,W,Y,ce){for(var re=[Z,z,R,N],Q=this.options,se=Q.debug;re.length;){N=re.pop(),R=re.pop(),z=re.pop(),Z=re.pop();var Ce=1<<z,Ie=mt(z,R,N),Ae=this.tiles[Ie];if(!Ae&&(se>1&&console.time("creation"),Ae=this.tiles[Ie]=wt(Z,z,R,N,Q),this.tileCoords.push({z,x:R,y:N}),se)){se>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",z,R,N,Ae.numFeatures,Ae.numPoints,Ae.numSimplified),console.timeEnd("creation"));var dt="z"+z;this.stats[dt]=(this.stats[dt]||0)+1,this.total++}if(Ae.source=Z,W){if(z===Q.maxZoom||z===W)continue;var St=1<<W-z;if(R!==Math.floor(Y/St)||N!==Math.floor(ce/St))continue}else if(z===Q.indexMaxZoom||Ae.numPoints<=Q.indexMaxPoints)continue;if(Ae.source=null,Z.length!==0){se>1&&console.time("clipping");var nt,Ke,Ye,Et,Ft,Rt,Dt=.5*Q.buffer/Q.extent,Ni=.5-Dt,ci=.5+Dt,Li=1+Dt;nt=Ke=Ye=Et=null,Ft=Di(Z,Ce,R-Dt,R+ci,0,Ae.minX,Ae.maxX,Q),Rt=Di(Z,Ce,R+Ni,R+Li,0,Ae.minX,Ae.maxX,Q),Z=null,Ft&&(nt=Di(Ft,Ce,N-Dt,N+ci,1,Ae.minY,Ae.maxY,Q),Ke=Di(Ft,Ce,N+Ni,N+Li,1,Ae.minY,Ae.maxY,Q),Ft=null),Rt&&(Ye=Di(Rt,Ce,N-Dt,N+ci,1,Ae.minY,Ae.maxY,Q),Et=Di(Rt,Ce,N+Ni,N+Li,1,Ae.minY,Ae.maxY,Q),Rt=null),se>1&&console.timeEnd("clipping"),re.push(nt||[],z+1,2*R,2*N),re.push(Ke||[],z+1,2*R,2*N+1),re.push(Ye||[],z+1,2*R+1,2*N),re.push(Et||[],z+1,2*R+1,2*N+1)}}},ze.prototype.getTile=function(Z,z,R){var N=this.options,W=N.extent,Y=N.debug;if(Z<0||Z>24)return null;var ce=1<<Z,re=mt(Z,z=(z%ce+ce)%ce,R);if(this.tiles[re])return je(this.tiles[re],W);Y>1&&console.log("drilling down to z%d-%d-%d",Z,z,R);for(var Q,se=Z,Ce=z,Ie=R;!Q&&se>0;)se--,Ce=Math.floor(Ce/2),Ie=Math.floor(Ie/2),Q=this.tiles[mt(se,Ce,Ie)];return Q&&Q.source?(Y>1&&console.log("found parent tile z%d-%d-%d",se,Ce,Ie),Y>1&&console.time("drilling down"),this.splitTile(Q.source,se,Ce,Ie,Z,z,R),Y>1&&console.timeEnd("drilling down"),this.tiles[re]?je(this.tiles[re],W):null):null};class Mt extends he{constructor(z,R,N,W){super(z,R,N),this._dataUpdateable=new Map,this.loadGeoJSON=(Y,ce)=>{const{promoteId:re}=Y;if(Y.request)return s.f(Y.request,(Q,se,Ce,Ie)=>{this._dataUpdateable=wi(se,re)?Zi(se,re):void 0,ce(Q,se,Ce,Ie)});if(typeof Y.data=="string")try{const Q=JSON.parse(Y.data);this._dataUpdateable=wi(Q,re)?Zi(Q,re):void 0,ce(null,Q)}catch{ce(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`))}else Y.dataDiff?this._dataUpdateable?(function(Q,se,Ce){var Ie,Ae,dt,St;if(se.removeAll&&Q.clear(),se.remove)for(const nt of se.remove)Q.delete(nt);if(se.add)for(const nt of se.add){const Ke=yt(nt,Ce);Ke!=null&&Q.set(Ke,nt)}if(se.update)for(const nt of se.update){let Ke=Q.get(nt.id);if(Ke==null)continue;const Ye=!nt.removeAllProperties&&(((Ie=nt.removeProperties)===null||Ie===void 0?void 0:Ie.length)>0||((Ae=nt.addOrUpdateProperties)===null||Ae===void 0?void 0:Ae.length)>0);if((nt.newGeometry||nt.removeAllProperties||Ye)&&(Ke=Object.assign({},Ke),Q.set(nt.id,Ke),Ye&&(Ke.properties=Object.assign({},Ke.properties))),nt.newGeometry&&(Ke.geometry=nt.newGeometry),nt.removeAllProperties)Ke.properties={};else if(((dt=nt.removeProperties)===null||dt===void 0?void 0:dt.length)>0)for(const Et of nt.removeProperties)Object.prototype.hasOwnProperty.call(Ke.properties,Et)&&delete Ke.properties[Et];if(((St=nt.addOrUpdateProperties)===null||St===void 0?void 0:St.length)>0)for(const{key:Et,value:Ft}of nt.addOrUpdateProperties)Ke.properties[Et]=Ft}}(this._dataUpdateable,Y.dataDiff,re),ce(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):ce(new Error(`Cannot update existing geojson data in ${Y.source}`)):ce(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},this.loadVectorData=this.loadGeoJSONTile,W&&(this.loadGeoJSON=W)}loadGeoJSONTile(z,R){const N=z.tileID.canonical;if(!this._geoJSONIndex)return R(null,null);const W=this._geoJSONIndex.getTile(N.z,N.x,N.y);if(!W)return R(null,null);const Y=new class{constructor(re){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.N,this.length=re.length,this._features=re}feature(re){return new class{constructor(Q){this._feature=Q,this.extent=s.N,this.type=Q.type,this.properties=Q.tags,"id"in Q&&!isNaN(Q.id)&&(this.id=parseInt(Q.id,10))}loadGeometry(){if(this._feature.type===1){const Q=[];for(const se of this._feature.geometry)Q.push([new s.P(se[0],se[1])]);return Q}{const Q=[];for(const se of this._feature.geometry){const Ce=[];for(const Ie of se)Ce.push(new s.P(Ie[0],Ie[1]));Q.push(Ce)}return Q}}toGeoJSON(Q,se,Ce){return we.call(this,Q,se,Ce)}}(this._features[re])}}(W.features);let ce=At(Y);ce.byteOffset===0&&ce.byteLength===ce.buffer.byteLength||(ce=new Uint8Array(ce)),R(null,{vectorTile:Y,rawData:ce.buffer})}loadData(z,R){var N;(N=this._pendingRequest)===null||N===void 0||N.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const W=!!(z&&z.request&&z.request.collectResourceTiming)&&new s.bu(z.request);this._pendingCallback=R,this._pendingRequest=this.loadGeoJSON(z,(Y,ce)=>{if(delete this._pendingCallback,delete this._pendingRequest,Y||!ce)return R(Y);if(typeof ce!="object")return R(new Error(`Input data given to '${z.source}' is not a valid GeoJSON object.`));{ve(ce,!0);try{if(z.filter){const Q=s.bC(z.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Q.result==="error")throw new Error(Q.value.map(Ce=>`${Ce.key}: ${Ce.message}`).join(", "));ce={type:"FeatureCollection",features:ce.features.filter(Ce=>Q.value.evaluate({zoom:0},Ce))}}this._geoJSONIndex=z.cluster?new bt(function({superclusterOptions:Q,clusterProperties:se}){if(!se||!Q)return Q;const Ce={},Ie={},Ae={accumulated:null,zoom:0},dt={properties:null},St=Object.keys(se);for(const nt of St){const[Ke,Ye]=se[nt],Et=s.bC(Ye),Ft=s.bC(typeof Ke=="string"?[Ke,["accumulated"],["get",nt]]:Ke);Ce[nt]=Et.value,Ie[nt]=Ft.value}return Q.map=nt=>{dt.properties=nt;const Ke={};for(const Ye of St)Ke[Ye]=Ce[Ye].evaluate(Ae,dt);return Ke},Q.reduce=(nt,Ke)=>{dt.properties=Ke;for(const Ye of St)Ae.accumulated=nt[Ye],nt[Ye]=Ie[Ye].evaluate(Ae,dt)},Q}(z)).load(ce.features):function(Q,se){return new ze(Q,se)}(ce,z.geojsonVtOptions)}catch(Q){return R(Q)}this.loaded={};const re={};if(W){const Q=W.finish();Q&&(re.resourceTiming={},re.resourceTiming[z.source]=JSON.parse(JSON.stringify(Q)))}R(null,re)}})}reloadTile(z,R){const N=this.loaded;return N&&N[z.uid]?super.reloadTile(z,R):this.loadTile(z,R)}removeSource(z,R){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),R()}getClusterExpansionZoom(z,R){try{R(null,this._geoJSONIndex.getClusterExpansionZoom(z.clusterId))}catch(N){R(N)}}getClusterChildren(z,R){try{R(null,this._geoJSONIndex.getChildren(z.clusterId))}catch(N){R(N)}}getClusterLeaves(z,R){try{R(null,this._geoJSONIndex.getLeaves(z.clusterId,z.limit,z.offset))}catch(N){R(N)}}}class qr{constructor(z){this.self=z,this.actor=new s.C(z,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:he,geojson:Mt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(R,N)=>{if(this.workerSourceTypes[R])throw new Error(`Worker source with name "${R}" already registered.`);this.workerSourceTypes[R]=N},this.self.registerRTLTextPlugin=R=>{if(s.bD.isParsed())throw new Error("RTL text plugin already registered.");s.bD.applyArabicShaping=R.applyArabicShaping,s.bD.processBidirectionalText=R.processBidirectionalText,s.bD.processStyledBidirectionalText=R.processStyledBidirectionalText}}setReferrer(z,R){this.referrer=R}setImages(z,R,N){this.availableImages[z]=R;for(const W in this.workerSources[z]){const Y=this.workerSources[z][W];for(const ce in Y)Y[ce].availableImages=R}N()}setLayers(z,R,N){this.getLayerIndex(z).replace(R),N()}updateLayers(z,R,N){this.getLayerIndex(z).update(R.layers,R.removedIds),N()}loadTile(z,R,N){this.getWorkerSource(z,R.type,R.source).loadTile(R,N)}loadDEMTile(z,R,N){this.getDEMWorkerSource(z,R.source).loadTile(R,N)}reloadTile(z,R,N){this.getWorkerSource(z,R.type,R.source).reloadTile(R,N)}abortTile(z,R,N){this.getWorkerSource(z,R.type,R.source).abortTile(R,N)}removeTile(z,R,N){this.getWorkerSource(z,R.type,R.source).removeTile(R,N)}removeDEMTile(z,R){this.getDEMWorkerSource(z,R.source).removeTile(R)}removeSource(z,R,N){if(!this.workerSources[z]||!this.workerSources[z][R.type]||!this.workerSources[z][R.type][R.source])return;const W=this.workerSources[z][R.type][R.source];delete this.workerSources[z][R.type][R.source],W.removeSource!==void 0?W.removeSource(R,N):N()}loadWorkerSource(z,R,N){try{this.self.importScripts(R.url),N()}catch(W){N(W.toString())}}syncRTLPluginState(z,R,N){try{s.bD.setState(R);const W=s.bD.getPluginURL();if(s.bD.isLoaded()&&!s.bD.isParsed()&&W!=null){this.self.importScripts(W);const Y=s.bD.isParsed();N(Y?void 0:new Error(`RTL Text Plugin failed to import scripts from ${W}`),Y)}}catch(W){N(W.toString())}}getAvailableImages(z){let R=this.availableImages[z];return R||(R=[]),R}getLayerIndex(z){let R=this.layerIndexes[z];return R||(R=this.layerIndexes[z]=new j),R}getWorkerSource(z,R,N){return this.workerSources[z]||(this.workerSources[z]={}),this.workerSources[z][R]||(this.workerSources[z][R]={}),this.workerSources[z][R][N]||(this.workerSources[z][R][N]=new this.workerSourceTypes[R]({send:(W,Y,ce)=>{this.actor.send(W,Y,ce,z)}},this.getLayerIndex(z),this.getAvailableImages(z))),this.workerSources[z][R][N]}getDEMWorkerSource(z,R){return this.demWorkerSources[z]||(this.demWorkerSources[z]={}),this.demWorkerSources[z][R]||(this.demWorkerSources[z][R]=new ye),this.demWorkerSources[z][R]}}return s.i()&&(self.worker=new qr(self)),qr}),A(["./shared"],function(s){var j="3.6.2";class L{static testProp(t){if(!L.docStyle)return t[0];for(let n=0;n<t.length;n++)if(t[n]in L.docStyle)return t[n];return t[0]}static create(t,n,o){const c=window.document.createElement(t);return n!==void 0&&(c.className=n),o&&o.appendChild(c),c}static createNS(t,n){return window.document.createElementNS(t,n)}static disableDrag(){L.docStyle&&L.selectProp&&(L.userSelect=L.docStyle[L.selectProp],L.docStyle[L.selectProp]="none")}static enableDrag(){L.docStyle&&L.selectProp&&(L.docStyle[L.selectProp]=L.userSelect)}static setTransform(t,n){t.style[L.transformProp]=n}static addEventListener(t,n,o,c={}){t.addEventListener(n,o,"passive"in c?c:c.capture)}static removeEventListener(t,n,o,c={}){t.removeEventListener(n,o,"passive"in c?c:c.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",L.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",L.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",L.suppressClickInternal,!0)},0)}static mousePos(t,n){const o=t.getBoundingClientRect();return new s.P(n.clientX-o.left-t.clientLeft,n.clientY-o.top-t.clientTop)}static touchPos(t,n){const o=t.getBoundingClientRect(),c=[];for(let p=0;p<n.length;p++)c.push(new s.P(n[p].clientX-o.left-t.clientLeft,n[p].clientY-o.top-t.clientTop));return c}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}L.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,L.selectProp=L.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),L.transformProp=L.testProp(["transform","WebkitTransform"]);const K={supported:!1,testSupport:function(h){!he&&te&&(ye?be(h):ne=h)}};let ne,te,he=!1,ye=!1;function be(h){const t=h.createTexture();h.bindTexture(h.TEXTURE_2D,t);try{if(h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,te),h.isContextLost())return;K.supported=!0}catch{}h.deleteTexture(t),he=!0}var Se,ve;typeof document<"u"&&(te=document.createElement("img"),te.onload=function(){ne&&be(ne),ne=null,ye=!0},te.onerror=function(){he=!0,ne=null},te.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(h){let t,n,o,c;h.resetRequestQueue=()=>{t=[],n=0,o=0,c={}},h.addThrottleControl=C=>{const E=o++;return c[E]=C,E},h.removeThrottleControl=C=>{delete c[C],y()},h.getImage=(C,E,P=!0)=>{K.supported&&(C.headers||(C.headers={}),C.headers.accept="image/webp,*/*");const B={requestParameters:C,supportImageRefresh:P,callback:E,cancelled:!1,completed:!1,cancel:()=>{B.completed||B.cancelled||(B.cancelled=!0,B.innerRequest&&(B.innerRequest.cancel(),n--),y())}};return t.push(B),y(),B};const p=C=>{const{requestParameters:E,supportImageRefresh:P,callback:B}=C;return s.e(E,{type:"image"}),(P!==!1||s.i()||s.g(E.url)||E.headers&&!Object.keys(E.headers).reduce((G,q)=>G&&q==="accept",!0)?s.m:x)(E,(G,q,H,V)=>{_(C,B,G,q,H,V)})},_=(C,E,P,B,G,q)=>{P?E(P):B instanceof HTMLImageElement||s.a(B)?E(null,B):B&&((H,V)=>{typeof createImageBitmap=="function"?s.b(H,V):s.d(H,V)})(B,(H,V)=>{H!=null?E(H):V!=null&&E(null,V,{cacheControl:G,expires:q})}),C.cancelled||(C.completed=!0,n--,y())},y=()=>{const C=(()=>{const E=Object.keys(c);let P=!1;if(E.length>0){for(const B of E)if(P=c[B](),P)break}return P})()?s.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:s.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let E=n;E<C&&t.length>0;E++){const P=t.shift();if(P.cancelled){E--;continue}const B=p(P);n++,P.innerRequest=B}},x=(C,E)=>{const P=new Image,B=C.url;let G=!1;const q=C.credentials;return q&&q==="include"?P.crossOrigin="use-credentials":(q&&q==="same-origin"||!s.s(B))&&(P.crossOrigin="anonymous"),P.fetchPriority="high",P.onload=()=>{E(null,P),P.onerror=P.onload=null},P.onerror=()=>{G||E(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),P.onerror=P.onload=null},P.src=B,{cancel:()=>{G=!0,P.src=""}}}}(Se||(Se={})),Se.resetRequestQueue(),function(h){h.Glyphs="Glyphs",h.Image="Image",h.Source="Source",h.SpriteImage="SpriteImage",h.SpriteJSON="SpriteJSON",h.Style="Style",h.Tile="Tile",h.Unknown="Unknown"}(ve||(ve={}));class we{constructor(t){this._transformRequestFn=t}transformRequest(t,n){return this._transformRequestFn&&this._transformRequestFn(t,n)||{url:t}}normalizeSpriteURL(t,n,o){const c=function(p){const _=p.match(ge);if(!_)throw new Error(`Unable to parse URL "${p}"`);return{protocol:_[1],authority:_[2],path:_[3]||"/",params:_[4]?_[4].split("&"):[]}}(t);return c.path+=`${n}${o}`,function(p){const _=p.params.length?`?${p.params.join("&")}`:"";return`${p.protocol}://${p.authority}${p.path}${_}`}(c)}setTransformRequest(t){this._transformRequestFn=t}}const ge=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function xe(h){var t=new s.A(3);return t[0]=h[0],t[1]=h[1],t[2]=h[2],t}var Pe,Re=function(h,t,n){return h[0]=t[0]-n[0],h[1]=t[1]-n[1],h[2]=t[2]-n[2],h};Pe=new s.A(3),s.A!=Float32Array&&(Pe[0]=0,Pe[1]=0,Pe[2]=0);var Ne=function(h){var t=h[0],n=h[1];return t*t+n*n};function Fe(h){const t=[];if(typeof h=="string")t.push({id:"default",url:h});else if(h&&h.length>0){const n=[];for(const{id:o,url:c}of h){const p=`${o}${c}`;n.indexOf(p)===-1&&(n.push(p),t.push({id:o,url:c}))}}return t}function Le(h,t,n,o,c){if(o)return void h(o);if(c!==Object.values(t).length||c!==Object.values(n).length)return;const p={};for(const _ in t){p[_]={};const y=s.h.getImageCanvasContext(n[_]),x=t[_];for(const C in x){const{width:E,height:P,x:B,y:G,sdf:q,pixelRatio:H,stretchX:V,stretchY:ae,content:de}=x[C];p[_][C]={data:null,pixelRatio:H,sdf:q,stretchX:V,stretchY:ae,content:de,spriteData:{width:E,height:P,x:B,y:G,context:y}}}}h(null,p)}(function(){var h=new s.A(2);s.A!=Float32Array&&(h[0]=0,h[1]=0)})();class Te{constructor(t,n,o,c){this.context=t,this.format=o,this.texture=t.gl.createTexture(),this.update(n,c)}update(t,n,o){const{width:c,height:p}=t,_=!(this.size&&this.size[0]===c&&this.size[1]===p||o),{context:y}=this,{gl:x}=y;if(this.useMipmap=!!(n&&n.useMipmap),x.bindTexture(x.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!n||n.premultiply!==!1)),_)this.size=[c,p],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||s.a(t)?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,t):x.texImage2D(x.TEXTURE_2D,0,this.format,c,p,0,this.format,x.UNSIGNED_BYTE,t.data);else{const{x:C,y:E}=o||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||s.a(t)?x.texSubImage2D(x.TEXTURE_2D,0,C,E,x.RGBA,x.UNSIGNED_BYTE,t):x.texSubImage2D(x.TEXTURE_2D,0,C,E,c,p,x.RGBA,x.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&x.generateMipmap(x.TEXTURE_2D)}bind(t,n,o){const{context:c}=this,{gl:p}=c;p.bindTexture(p.TEXTURE_2D,this.texture),o!==p.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(o=p.LINEAR),t!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,t),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,o||t),this.filter=t),n!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,n),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function Ue(h){const{userImage:t}=h;return!!(t&&t.render&&t.render())&&(h.data.replace(new Uint8Array(t.data.buffer)),!0)}class We extends s.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:n,callback:o}of this.requestors)this._notify(n,o);this.requestors=[]}}getImage(t){const n=this.images[t];if(n&&!n.data&&n.spriteData){const o=n.spriteData;n.data=new s.R({width:o.width,height:o.height},o.context.getImageData(o.x,o.y,o.width,o.height).data),n.spriteData=null}return n}addImage(t,n){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,n)&&(this.images[t]=n)}_validate(t,n){let o=!0;const c=n.data||n.spriteData;return this._validateStretch(n.stretchX,c&&c.width)||(this.fire(new s.j(new Error(`Image "${t}" has invalid "stretchX" value`))),o=!1),this._validateStretch(n.stretchY,c&&c.height)||(this.fire(new s.j(new Error(`Image "${t}" has invalid "stretchY" value`))),o=!1),this._validateContent(n.content,n)||(this.fire(new s.j(new Error(`Image "${t}" has invalid "content" value`))),o=!1),o}_validateStretch(t,n){if(!t)return!0;let o=0;for(const c of t){if(c[0]<o||c[1]<c[0]||n<c[1])return!1;o=c[1]}return!0}_validateContent(t,n){if(!t)return!0;if(t.length!==4)return!1;const o=n.spriteData,c=o&&o.width||n.data.width,p=o&&o.height||n.data.height;return!(t[0]<0||c<t[0]||t[1]<0||p<t[1]||t[2]<0||c<t[2]||t[3]<0||p<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,n,o=!0){const c=this.getImage(t);if(o&&(c.data.width!==n.data.width||c.data.height!==n.data.height))throw new Error(`size mismatch between old image (${c.data.width}x${c.data.height}) and new image (${n.data.width}x${n.data.height}).`);n.version=c.version+1,this.images[t]=n,this.updatedImages[t]=!0}removeImage(t){const n=this.images[t];delete this.images[t],delete this.patterns[t],n.userImage&&n.userImage.onRemove&&n.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,n){let o=!0;if(!this.isLoaded())for(const c of t)this.images[c]||(o=!1);this.isLoaded()||o?this._notify(t,n):this.requestors.push({ids:t,callback:n})}_notify(t,n){const o={};for(const c of t){let p=this.getImage(c);p||(this.fire(new s.k("styleimagemissing",{id:c})),p=this.getImage(c)),p?o[c]={data:p.data.clone(),pixelRatio:p.pixelRatio,sdf:p.sdf,version:p.version,stretchX:p.stretchX,stretchY:p.stretchY,content:p.content,hasRenderCallback:!!(p.userImage&&p.userImage.render)}:s.w(`Image "${c}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}n(null,o)}getPixelSize(){const{width:t,height:n}=this.atlasImage;return{width:t,height:n}}getPattern(t){const n=this.patterns[t],o=this.getImage(t);if(!o)return null;if(n&&n.position.version===o.version)return n.position;if(n)n.position.version=o.version;else{const c={w:o.data.width+2,h:o.data.height+2,x:0,y:0},p=new s.I(c,o);this.patterns[t]={bin:c,position:p}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const n=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Te(t,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const p in this.patterns)t.push(this.patterns[p].bin);const{w:n,h:o}=s.p(t),c=this.atlasImage;c.resize({width:n||1,height:o||1});for(const p in this.patterns){const{bin:_}=this.patterns[p],y=_.x+1,x=_.y+1,C=this.getImage(p).data,E=C.width,P=C.height;s.R.copy(C,c,{x:0,y:0},{x:y,y:x},{width:E,height:P}),s.R.copy(C,c,{x:0,y:P-1},{x:y,y:x-1},{width:E,height:1}),s.R.copy(C,c,{x:0,y:0},{x:y,y:x+P},{width:E,height:1}),s.R.copy(C,c,{x:E-1,y:0},{x:y-1,y:x},{width:1,height:P}),s.R.copy(C,c,{x:0,y:0},{x:y+E,y:x},{width:1,height:P})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const n of t){if(this.callbackDispatchedThisFrame[n])continue;this.callbackDispatchedThisFrame[n]=!0;const o=this.getImage(n);o||s.w(`Image with ID: "${n}" was not found`),Ue(o)&&this.updateImage(n,o)}}}const tt=1e20;function Xe(h,t,n,o,c,p,_,y,x){for(let C=t;C<t+o;C++)at(h,n*p+C,p,c,_,y,x);for(let C=n;C<n+c;C++)at(h,C*p+t,1,o,_,y,x)}function at(h,t,n,o,c,p,_){p[0]=0,_[0]=-tt,_[1]=tt,c[0]=h[t];for(let y=1,x=0,C=0;y<o;y++){c[y]=h[t+y*n];const E=y*y;do{const P=p[x];C=(c[y]-c[P]+E-P*P)/(y-P)/2}while(C<=_[x]&&--x>-1);x++,p[x]=y,_[x]=C,_[x+1]=tt}for(let y=0,x=0;y<o;y++){for(;_[x+1]<y;)x++;const C=p[x],E=y-C;h[t+y*n]=c[C]+E*E}}class Ct{constructor(t,n){this.requestManager=t,this.localIdeographFontFamily=n,this.entries={}}setURL(t){this.url=t}getGlyphs(t,n){const o=[];for(const c in t)for(const p of t[c])o.push({stack:c,id:p});s.o(o,({stack:c,id:p},_)=>{let y=this.entries[c];y||(y=this.entries[c]={glyphs:{},requests:{},ranges:{}});let x=y.glyphs[p];if(x!==void 0)return void _(null,{stack:c,id:p,glyph:x});if(x=this._tinySDF(y,c,p),x)return y.glyphs[p]=x,void _(null,{stack:c,id:p,glyph:x});const C=Math.floor(p/256);if(256*C>65535)return void _(new Error("glyphs > 65535 not supported"));if(y.ranges[C])return void _(null,{stack:c,id:p,glyph:x});if(!this.url)return void _(new Error("glyphsUrl is not set"));let E=y.requests[C];E||(E=y.requests[C]=[],Ct.loadGlyphRange(c,C,this.url,this.requestManager,(P,B)=>{if(B){for(const G in B)this._doesCharSupportLocalGlyph(+G)||(y.glyphs[+G]=B[+G]);y.ranges[C]=!0}for(const G of E)G(P,B);delete y.requests[C]})),E.push((P,B)=>{P?_(P):B&&_(null,{stack:c,id:p,glyph:B[p]||null})})},(c,p)=>{if(c)n(c);else if(p){const _={};for(const{stack:y,id:x,glyph:C}of p)(_[y]||(_[y]={}))[x]=C&&{id:C.id,bitmap:C.bitmap.clone(),metrics:C.metrics};n(null,_)}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(s.u["CJK Unified Ideographs"](t)||s.u["Hangul Syllables"](t)||s.u.Hiragana(t)||s.u.Katakana(t))}_tinySDF(t,n,o){const c=this.localIdeographFontFamily;if(!c||!this._doesCharSupportLocalGlyph(o))return;let p=t.tinySDF;if(!p){let y="400";/bold/i.test(n)?y="900":/medium/i.test(n)?y="500":/light/i.test(n)&&(y="200"),p=t.tinySDF=new Ct.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:c,fontWeight:y})}const _=p.draw(String.fromCharCode(o));return{id:o,bitmap:new s.q({width:_.width||60,height:_.height||60},_.data),metrics:{width:_.glyphWidth/2||24,height:_.glyphHeight/2||24,left:_.glyphLeft/2+.5||0,top:_.glyphTop/2-27.5||-8,advance:_.glyphAdvance/2||24,isDoubleResolution:!0}}}}Ct.loadGlyphRange=function(h,t,n,o,c){const p=256*t,_=p+255,y=o.transformRequest(n.replace("{fontstack}",h).replace("{range}",`${p}-${_}`),ve.Glyphs);s.l(y,(x,C)=>{if(x)c(x);else if(C){const E={};for(const P of s.n(C))E[P.id]=P;c(null,E)}})},Ct.TinySDF=class{constructor({fontSize:h=24,buffer:t=3,radius:n=8,cutoff:o=.25,fontFamily:c="sans-serif",fontWeight:p="normal",fontStyle:_="normal"}={}){this.buffer=t,this.cutoff=o,this.radius=n;const y=this.size=h+4*t,x=this._createCanvas(y),C=this.ctx=x.getContext("2d",{willReadFrequently:!0});C.font=`${_} ${p} ${h}px ${c}`,C.textBaseline="alphabetic",C.textAlign="left",C.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(h){const t=document.createElement("canvas");return t.width=t.height=h,t}draw(h){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:o,actualBoundingBoxLeft:c,actualBoundingBoxRight:p}=this.ctx.measureText(h),_=Math.ceil(n),y=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-c))),x=Math.min(this.size-this.buffer,_+Math.ceil(o)),C=y+2*this.buffer,E=x+2*this.buffer,P=Math.max(C*E,0),B=new Uint8ClampedArray(P),G={data:B,width:C,height:E,glyphWidth:y,glyphHeight:x,glyphTop:_,glyphLeft:0,glyphAdvance:t};if(y===0||x===0)return G;const{ctx:q,buffer:H,gridInner:V,gridOuter:ae}=this;q.clearRect(H,H,y,x),q.fillText(h,H,H+_);const de=q.getImageData(H,H,y,x);ae.fill(tt,0,P),V.fill(0,0,P);for(let J=0;J<x;J++)for(let oe=0;oe<y;oe++){const fe=de.data[4*(J*y+oe)+3]/255;if(fe===0)continue;const me=(J+H)*C+oe+H;if(fe===1)ae[me]=0,V[me]=tt;else{const Me=.5-fe;ae[me]=Me>0?Me*Me:0,V[me]=Me<0?Me*Me:0}}Xe(ae,0,0,C,E,C,this.f,this.v,this.z),Xe(V,H,H,y,x,C,this.f,this.v,this.z);for(let J=0;J<P;J++){const oe=Math.sqrt(ae[J])-Math.sqrt(V[J]);B[J]=Math.round(255-255*(oe/this.radius+this.cutoff))}return G}};class st{constructor(){this.specification=s.v.light.position}possiblyEvaluate(t,n){return s.z(t.expression.evaluate(n))}interpolate(t,n,o){return{x:s.B.number(t.x,n.x,o),y:s.B.number(t.y,n.y,o),z:s.B.number(t.z,n.z,o)}}}let jt;class At extends s.E{constructor(t){super(),jt=jt||new s.r({anchor:new s.D(s.v.light.anchor),position:new st,color:new s.D(s.v.light.color),intensity:new s.D(s.v.light.intensity)}),this._transitionable=new s.T(jt),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,n={}){if(!this._validate(s.t,t,n))for(const o in t){const c=t[o];o.endsWith("-transition")?this._transitionable.setTransition(o.slice(0,-11),c):this._transitionable.setValue(o,c)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,o){return(!o||o.validate!==!1)&&s.x(this,t.call(s.y,s.e({value:n,style:{glyphs:!0,sprite:!0},styleSpec:s.v})))}}class Qt{constructor(t,n){this.width=t,this.height=n,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,n){const o=t.join(",")+String(n);return this.dashEntry[o]||(this.dashEntry[o]=this.addDash(t,n)),this.dashEntry[o]}getDashRanges(t,n,o){const c=[];let p=t.length%2==1?-t[t.length-1]*o:0,_=t[0]*o,y=!0;c.push({left:p,right:_,isDash:y,zeroLength:t[0]===0});let x=t[0];for(let C=1;C<t.length;C++){y=!y;const E=t[C];p=x*o,x+=E,_=x*o,c.push({left:p,right:_,isDash:y,zeroLength:E===0})}return c}addRoundDash(t,n,o){const c=n/2;for(let p=-o;p<=o;p++){const _=this.width*(this.nextRow+o+p);let y=0,x=t[y];for(let C=0;C<this.width;C++){C/x.right>1&&(x=t[++y]);const E=Math.abs(C-x.left),P=Math.abs(C-x.right),B=Math.min(E,P);let G;const q=p/o*(c+1);if(x.isDash){const H=c-Math.abs(q);G=Math.sqrt(B*B+H*H)}else G=c-Math.sqrt(B*B+q*q);this.data[_+C]=Math.max(0,Math.min(255,G+128))}}}addRegularDash(t){for(let y=t.length-1;y>=0;--y){const x=t[y],C=t[y+1];x.zeroLength?t.splice(y,1):C&&C.isDash===x.isDash&&(C.left=x.left,t.splice(y,1))}const n=t[0],o=t[t.length-1];n.isDash===o.isDash&&(n.left=o.left-this.width,o.right=n.right+this.width);const c=this.width*this.nextRow;let p=0,_=t[p];for(let y=0;y<this.width;y++){y/_.right>1&&(_=t[++p]);const x=Math.abs(y-_.left),C=Math.abs(y-_.right),E=Math.min(x,C);this.data[c+y]=Math.max(0,Math.min(255,(_.isDash?E:-E)+128))}}addDash(t,n){const o=n?7:0,c=2*o+1;if(this.nextRow+c>this.height)return s.w("LineAtlas out of space"),null;let p=0;for(let y=0;y<t.length;y++)p+=t[y];if(p!==0){const y=this.width/p,x=this.getDashRanges(t,this.width,y);n?this.addRoundDash(x,y,o):this.addRegularDash(x)}const _={y:(this.nextRow+o+.5)/this.height,height:2*o/this.height,width:p};return this.nextRow+=c,this.dirty=!0,_}bind(t){const n=t.gl;this.texture?(n.bindTexture(n.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,n.texSubImage2D(n.TEXTURE_2D,0,0,0,this.width,this.height,n.ALPHA,n.UNSIGNED_BYTE,this.data))):(this.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texImage2D(n.TEXTURE_2D,0,n.ALPHA,this.width,this.height,0,n.ALPHA,n.UNSIGNED_BYTE,this.data))}}class Gt{constructor(t,n,o){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=o;const c=this.workerPool.acquire(o);for(let p=0;p<c.length;p++){const _=new s.C(c[p],n,o);_.name=`Worker ${p}`,this.actors.push(_)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,n,o){s.o(this.actors,(c,p)=>{c.send(t,n,p)},o=o||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(n=>{n.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}}function ft(h,t,n){const o=function(c,p){if(c)return n(c);if(p){const _=s.F(s.e(p,h),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);p.vector_layers&&(_.vectorLayers=p.vector_layers,_.vectorLayerIds=_.vectorLayers.map(y=>y.id)),n(null,_)}};return h.url?s.f(t.transformRequest(h.url,ve.Source),o):s.h.frame(()=>o(null,h))}class Be{constructor(t,n){t&&(n?this.setSouthWest(t).setNorthEast(n):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof s.L?new s.L(t.lng,t.lat):s.L.convert(t),this}setSouthWest(t){return this._sw=t instanceof s.L?new s.L(t.lng,t.lat):s.L.convert(t),this}extend(t){const n=this._sw,o=this._ne;let c,p;if(t instanceof s.L)c=t,p=t;else{if(!(t instanceof Be))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Be.convert(t)):this.extend(s.L.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(s.L.convert(t)):this;if(c=t._sw,p=t._ne,!c||!p)return this}return n||o?(n.lng=Math.min(c.lng,n.lng),n.lat=Math.min(c.lat,n.lat),o.lng=Math.max(p.lng,o.lng),o.lat=Math.max(p.lat,o.lat)):(this._sw=new s.L(c.lng,c.lat),this._ne=new s.L(p.lng,p.lat)),this}getCenter(){return new s.L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new s.L(this.getWest(),this.getNorth())}getSouthEast(){return new s.L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:n,lat:o}=s.L.convert(t);let c=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&c}static convert(t){return t instanceof Be?t:t&&new Be(t)}static fromLngLat(t,n=0){const o=360*n/40075017,c=o/Math.cos(Math.PI/180*t.lat);return new Be(new s.L(t.lng-c,t.lat-o),new s.L(t.lng+c,t.lat+o))}}class gt{constructor(t,n,o){this.bounds=Be.convert(this.validateBounds(t)),this.minzoom=n||0,this.maxzoom=o||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const n=Math.pow(2,t.z),o=Math.floor(s.G(this.bounds.getWest())*n),c=Math.floor(s.H(this.bounds.getNorth())*n),p=Math.ceil(s.G(this.bounds.getEast())*n),_=Math.ceil(s.H(this.bounds.getSouth())*n);return t.x>=o&&t.x<p&&t.y>=c&&t.y<_}}class $t extends s.E{constructor(t,n,o,c){if(super(),this.load=()=>{this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this._tileJSONRequest=ft(this._options,this.map._requestManager,(p,_)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),p?this.fire(new s.j(p)):_&&(s.e(this,_),_.bounds&&(this.tileBounds=new gt(_.bounds,this.minzoom,this.maxzoom)),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>s.e({},this._options),this.id=t,this.dispatcher=o,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.e(this,s.F(n,["url","scheme","tileSize","promoteId"])),this._options=s.e({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(c)}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(t,n){const o=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c={request:this.map._requestManager.transformRequest(o,ve.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function p(_,y){return delete t.request,t.aborted?n(null):_&&_.status!==404?n(_):(y&&y.resourceTiming&&(t.resourceTiming=y.resourceTiming),this.map._refreshExpiredTiles&&y&&t.setExpiryData(y),t.loadVectorData(y,this.map.painter),n(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}c.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired"?t.state==="loading"?t.reloadCallback=n:t.request=t.actor.send("reloadTile",c,p.bind(this)):(t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",c,p.bind(this)))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class bt extends s.E{constructor(t,n,o,c){super(),this.id=t,this.dispatcher=o,this.setEventedParent(c),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.e({type:"raster"},n),s.e(this,s.F(n,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this._tileJSONRequest=ft(this._options,this.map._requestManager,(t,n)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new s.j(t)):n&&(s.e(this,n),n.bounds&&(this.tileBounds=new gt(n.bounds,this.minzoom,this.maxzoom)),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}serialize(){return s.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,n){const o=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.request=Se.getImage(this.map._requestManager.transformRequest(o,ve.Tile),(c,p,_)=>{if(delete t.request,t.aborted)t.state="unloaded",n(null);else if(c)t.state="errored",n(c);else if(p){this.map._refreshExpiredTiles&&_&&t.setExpiryData(_);const y=this.map.painter.context,x=y.gl;t.texture=this.map.painter.getTileTexture(p.width),t.texture?t.texture.update(p,{useMipmap:!0}):(t.texture=new Te(y,p,x.RGBA,{useMipmap:!0}),t.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE,x.LINEAR_MIPMAP_NEAREST),y.extTextureFilterAnisotropic&&x.texParameterf(x.TEXTURE_2D,y.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,y.extTextureFilterAnisotropicMax)),t.state="loaded",n(null)}},this.map._refreshExpiredTiles)}abortTile(t,n){t.request&&(t.request.cancel(),delete t.request),n()}unloadTile(t,n){t.texture&&this.map.painter.saveTileTexture(t.texture),n()}hasTransition(){return!1}}class Bt extends bt{constructor(t,n,o,c){super(t,n,o,c),this.type="raster-dem",this.maxzoom=22,this._options=s.e({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox",this.redFactor=n.redFactor,this.greenFactor=n.greenFactor,this.blueFactor=n.blueFactor,this.baseShift=n.baseShift}loadTile(t,n){const o=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c=this.map._requestManager.transformRequest(o,ve.Tile);function p(_,y){_&&(t.state="errored",n(_)),y&&(t.dem=y,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded",n(null))}t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.request=Se.getImage(c,(_,y,x)=>s._(this,void 0,void 0,function*(){if(delete t.request,t.aborted)t.state="unloaded",n(null);else if(_)t.state="errored",n(_);else if(y){this.map._refreshExpiredTiles&&t.setExpiryData(x);const C=s.a(y)&&s.J()?y:yield function(P){return s._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&s.K()){const B=P.width+2,G=P.height+2;try{return new s.R({width:B,height:G},yield s.M(P,-1,-1,B,G))}catch{}}return s.h.getImageData(P,1)})}(y),E={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:C,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};t.actor&&t.state!=="expired"||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",E,p))}}),this.map._refreshExpiredTiles)}_getNeighboringTiles(t){const n=t.canonical,o=Math.pow(2,n.z),c=(n.x-1+o)%o,p=n.x===0?t.wrap-1:t.wrap,_=(n.x+1+o)%o,y=n.x+1===o?t.wrap+1:t.wrap,x={};return x[new s.O(t.overscaledZ,p,n.z,c,n.y).key]={backfilled:!1},x[new s.O(t.overscaledZ,y,n.z,_,n.y).key]={backfilled:!1},n.y>0&&(x[new s.O(t.overscaledZ,p,n.z,c,n.y-1).key]={backfilled:!1},x[new s.O(t.overscaledZ,t.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},x[new s.O(t.overscaledZ,y,n.z,_,n.y-1).key]={backfilled:!1}),n.y+1<o&&(x[new s.O(t.overscaledZ,p,n.z,c,n.y+1).key]={backfilled:!1},x[new s.O(t.overscaledZ,t.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},x[new s.O(t.overscaledZ,y,n.z,_,n.y+1).key]={backfilled:!1}),x}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})}}class Yt extends s.E{constructor(t,n,o,c){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>s.e({},this._options,{type:this.type,data:this._data}),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=o.getActor(),this.setEventedParent(c),this._data=n.data,this._options=s.e({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const p=s.N/this.tileSize;this.workerOptions=s.e({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*p,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*p,extent:s.N,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:s.N,radius:(n.clusterRadius||50)*p,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=t.clusterRadius),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=t.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(t,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},n),this}getClusterChildren(t,n){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},n),this}getClusterLeaves(t,n,o,c){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:n,offset:o},c),this}_updateWorkerData(t){const n=s.e({},this.workerOptions);t?n.dataDiff=t:typeof this._data=="string"?(n.request=this.map._requestManager.transformRequest(s.h.resolveURL(this._data),ve.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new s.k("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,n,(o,c)=>{if(this._pendingLoads--,this._removed||c&&c.abandoned)return void this.fire(new s.k("dataabort",{dataType:"source"}));let p=null;if(c&&c.resourceTiming&&c.resourceTiming[this.id]&&(p=c.resourceTiming[this.id].slice(0)),o)return void this.fire(new s.j(o));const _={dataType:"source"};this._collectResourceTiming&&p&&p.length>0&&s.e(_,{resourceTiming:p}),this.fire(new s.k("data",Object.assign(Object.assign({},_),{sourceDataType:"metadata"}))),this.fire(new s.k("data",Object.assign(Object.assign({},_),{sourceDataType:"content"})))})}loaded(){return this._pendingLoads===0}loadTile(t,n){const o=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const c={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.request=this.actor.send(o,c,(p,_)=>(delete t.request,t.unloadVectorData(),t.aborted?n(null):p?n(p):(t.loadVectorData(_,this.map.painter,o==="reloadTile"),n(null))))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var ei=s.Q([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class kt extends s.E{constructor(t,n,o,c){super(),this.load=(p,_)=>{this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=Se.getImage(this.map._requestManager.transformRequest(this.url,ve.Image),(y,x)=>{this._request=null,this._loaded=!0,y?this.fire(new s.j(y)):x&&(this.image=x,p&&(this.coordinates=p),_&&_(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;const p=this.map.painter.context,_=p.gl;this.boundsBuffer||(this.boundsBuffer=p.createVertexBuffer(this._boundsArray,ei.members)),this.boundsSegments||(this.boundsSegments=s.S.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Te(p,this.image,_.RGBA),this.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE));let y=!1;for(const x in this.tiles){const C=this.tiles[x];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture,y=!0)}y&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=t,this.dispatcher=o,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(c),this.options=n}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(t){this.coordinates=t;const n=t.map(s.U.fromLngLat);this.tileID=function(c){let p=1/0,_=1/0,y=-1/0,x=-1/0;for(const B of c)p=Math.min(p,B.x),_=Math.min(_,B.y),y=Math.max(y,B.x),x=Math.max(x,B.y);const C=Math.max(y-p,x-_),E=Math.max(0,Math.floor(-Math.log(C)/Math.LN2)),P=Math.pow(2,E);return new s.W(E,Math.floor((p+y)/2*P),Math.floor((_+x)/2*P))}(n),this.minzoom=this.maxzoom=this.tileID.z;const o=n.map(c=>this.tileID.getTilePoint(c)._round());return this._boundsArray=new s.V,this._boundsArray.emplaceBack(o[0].x,o[0].y,0,0),this._boundsArray.emplaceBack(o[1].x,o[1].y,s.N,0),this._boundsArray.emplaceBack(o[3].x,o[3].y,0,s.N),this._boundsArray.emplaceBack(o[2].x,o[2].y,s.N,s.N),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(t,n){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},n(null)):(t.state="errored",n(null))}hasTransition(){return!1}}class gi extends kt{constructor(t,n,o,c){super(t,n,o,c),this.load=()=>{this._loaded=!1;const p=this.options;this.urls=[];for(const _ of p.urls)this.urls.push(this.map._requestManager.transformRequest(_,ve.Source).url);s.X(this.urls,(_,y)=>{this._loaded=!0,_?this.fire(new s.j(_)):y&&(this.video=y,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const p=this.map.painter.context,_=p.gl;this.boundsBuffer||(this.boundsBuffer=p.createVertexBuffer(this._boundsArray,ei.members)),this.boundsSegments||(this.boundsSegments=s.S.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE),_.texSubImage2D(_.TEXTURE_2D,0,0,0,_.RGBA,_.UNSIGNED_BYTE,this.video)):(this.texture=new Te(p,this.video,_.RGBA),this.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE));let y=!1;for(const x in this.tiles){const C=this.tiles[x];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture,y=!0)}y&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=n}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const n=this.video.seekable;t<n.start(0)||t>n.end(0)?this.fire(new s.j(new s.Y(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class pi extends kt{constructor(t,n,o,c){super(t,n,o,c),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const _=this.map.painter.context,y=_.gl;this.boundsBuffer||(this.boundsBuffer=_.createVertexBuffer(this._boundsArray,ei.members)),this.boundsSegments||(this.boundsSegments=s.S.simpleSegment(0,0,4,2)),this.texture?(p||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Te(_,this.canvas,y.RGBA,{premultiply:!0});let x=!1;for(const C in this.tiles){const E=this.tiles[C];E.state!=="loaded"&&(E.state="loaded",E.texture=this.texture,x=!0)}x&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(p=>!Array.isArray(p)||p.length!==2||p.some(_=>typeof _!="number"))||this.fire(new s.j(new s.Y(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.j(new s.Y(`sources.${t}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new s.j(new s.Y(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new s.j(new s.Y(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.j(new s.Y(`sources.${t}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const Pt={},li=h=>{switch(h){case"geojson":return Yt;case"image":return kt;case"raster":return bt;case"raster-dem":return Bt;case"vector":return $t;case"video":return gi;case"canvas":return pi}return Pt[h]};function Xi(h,t){const n=s.Z();return s.$(n,n,[1,1,0]),s.a0(n,n,[.5*h.width,.5*h.height,1]),s.a1(n,n,h.calculatePosMatrix(t.toUnwrapped()))}function Ht(h,t,n,o,c,p){const _=function(P,B,G){if(P)for(const q of P){const H=B[q];if(H&&H.source===G&&H.type==="fill-extrusion")return!0}else for(const q in B){const H=B[q];if(H.source===G&&H.type==="fill-extrusion")return!0}return!1}(c&&c.layers,t,h.id),y=p.maxPitchScaleFactor(),x=h.tilesIn(o,y,_);x.sort(Mi);const C=[];for(const P of x)C.push({wrappedTileID:P.tileID.wrapped().key,queryResults:P.tile.queryRenderedFeatures(t,n,h._state,P.queryGeometry,P.cameraQueryGeometry,P.scale,c,p,y,Xi(h.transform,P.tileID))});const E=function(P){const B={},G={};for(const q of P){const H=q.queryResults,V=q.wrappedTileID,ae=G[V]=G[V]||{};for(const de in H){const J=H[de],oe=ae[de]=ae[de]||{},fe=B[de]=B[de]||[];for(const me of J)oe[me.featureIndex]||(oe[me.featureIndex]=!0,fe.push(me))}}return B}(C);for(const P in E)E[P].forEach(B=>{const G=B.feature,q=h.getFeatureState(G.layer["source-layer"],G.id);G.source=G.layer.source,G.layer["source-layer"]&&(G.sourceLayer=G.layer["source-layer"]),G.state=q});return E}function Mi(h,t){const n=h.tileID,o=t.tileID;return n.overscaledZ-o.overscaledZ||n.canonical.y-o.canonical.y||n.wrap-o.wrap||n.canonical.x-o.canonical.x}class Oi{constructor(t,n){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=s.a2(),this.uses=0,this.tileSize=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const n=t+this.timeAdded;n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,n,o){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(c,p){const _={};if(!p)return _;for(const y of c){const x=y.layerIds.map(C=>p.getLayer(C)).filter(Boolean);if(x.length!==0){y.layers=x,y.stateDependentLayerIds&&(y.stateDependentLayers=y.stateDependentLayerIds.map(C=>x.filter(E=>E.id===C)[0]));for(const C of x)_[C.id]=y}}return _}(t.buckets,n.style),this.hasSymbolBuckets=!1;for(const c in this.buckets){const p=this.buckets[c];if(p instanceof s.a4){if(this.hasSymbolBuckets=!0,!o)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const c in this.buckets){const p=this.buckets[c];if(p instanceof s.a4&&p.hasRTLText){this.hasRTLText=!0,s.a5();break}}this.queryPadding=0;for(const c in this.buckets){const p=this.buckets[c];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(c).queryRadius(p))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new s.a3}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const o in this.buckets){const c=this.buckets[o];c.uploadPending()&&c.upload(t)}const n=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Te(t,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Te(t,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,n,o,c,p,_,y,x,C,E){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:c,cameraQueryGeometry:p,scale:_,tileSize:this.tileSize,pixelPosMatrix:E,transform:x,params:y,queryPadding:this.queryPadding*C},t,n,o):{}}querySourceFeatures(t,n){const o=this.latestFeatureIndex;if(!o||!o.rawTileData)return;const c=o.loadVTLayers(),p=n&&n.sourceLayer?n.sourceLayer:"",_=c._geojsonTileLayer||c[p];if(!_)return;const y=s.a6(n&&n.filter),{z:x,x:C,y:E}=this.tileID.canonical,P={z:x,x:C,y:E};for(let B=0;B<_.length;B++){const G=_.feature(B);if(y.needGeometry){const V=s.a7(G,!0);if(!y.filter(new s.a8(this.tileID.overscaledZ),V,this.tileID.canonical))continue}else if(!y.filter(new s.a8(this.tileID.overscaledZ),G))continue;const q=o.getId(G,p),H=new s.a9(G,x,C,E,q);H.tile=P,t.push(H)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const n=this.expirationTime;if(t.cacheControl){const o=s.aa(t.cacheControl);o["max-age"]&&(this.expirationTime=Date.now()+1e3*o["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const o=Date.now();let c=!1;if(this.expirationTime>o)c=!1;else if(n)if(this.expirationTime<n)c=!0;else{const p=this.expirationTime-n;p?this.expirationTime=o+Math.max(p,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const o=this.latestFeatureIndex.loadVTLayers();for(const c in this.buckets){if(!n.style.hasLayer(c))continue;const p=this.buckets[c],_=p.layers[0].sourceLayer||"_geojsonTileLayer",y=o[_],x=t[_];if(!y||!x||Object.keys(x).length===0)continue;p.update(x,y,this.imageAtlas&&this.imageAtlas.patternPositions||{});const C=n&&n.style&&n.style.getLayer(c);C&&(this.queryPadding=Math.max(this.queryPadding,C.queryRadius(p)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.h.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=s.h.now()+t}setDependencies(t,n){const o={};for(const c of n)o[c]=!0;this.dependencies[t]=o}hasDependency(t,n){for(const o of t){const c=this.dependencies[o];if(c){for(const p of n)if(c[p])return!0}}return!1}}class gr{constructor(t,n){this.max=t,this.onRemove=n,this.reset()}reset(){for(const t in this.data)for(const n of this.data[t])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(t,n,o){const c=t.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);const p={value:n,timeout:void 0};if(o!==void 0&&(p.timeout=setTimeout(()=>{this.remove(t,p)},o)),this.data[c].push(p),this.order.push(c),this.order.length>this.max){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const n=this.data[t].shift();return n.timeout&&clearTimeout(n.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),n.value}getByKey(t){const n=this.data[t];return n?n[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,n){if(!this.has(t))return this;const o=t.wrapped().key,c=n===void 0?0:this.data[o].indexOf(n),p=this.data[o][c];return this.data[o].splice(c,1),p.timeout&&clearTimeout(p.timeout),this.data[o].length===0&&delete this.data[o],this.onRemove(p.value),this.order.splice(this.order.indexOf(o),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(t){const n=[];for(const o in this.data)for(const c of this.data[o])t(c.value)||n.push(c);for(const o of n)this.remove(o.value.tileID,o)}}class _e{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,n,o){const c=String(n);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][c]=this.stateChanges[t][c]||{},s.e(this.stateChanges[t][c],o),this.deletedStates[t]===null){this.deletedStates[t]={};for(const p in this.state[t])p!==c&&(this.deletedStates[t][p]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][c]===null){this.deletedStates[t][c]={};for(const p in this.state[t][c])o[p]||(this.deletedStates[t][c][p]=null)}else for(const p in o)this.deletedStates[t]&&this.deletedStates[t][c]&&this.deletedStates[t][c][p]===null&&delete this.deletedStates[t][c][p]}removeFeatureState(t,n,o){if(this.deletedStates[t]===null)return;const c=String(n);if(this.deletedStates[t]=this.deletedStates[t]||{},o&&n!==void 0)this.deletedStates[t][c]!==null&&(this.deletedStates[t][c]=this.deletedStates[t][c]||{},this.deletedStates[t][c][o]=null);else if(n!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][c])for(o in this.deletedStates[t][c]={},this.stateChanges[t][c])this.deletedStates[t][c][o]=null;else this.deletedStates[t][c]=null;else this.deletedStates[t]=null}getState(t,n){const o=String(n),c=s.e({},(this.state[t]||{})[o],(this.stateChanges[t]||{})[o]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const p=this.deletedStates[t][n];if(p===null)return{};for(const _ in p)delete c[_]}return c}initializeTileState(t,n){t.setFeatureState(this.state,n)}coalesceChanges(t,n){const o={};for(const c in this.stateChanges){this.state[c]=this.state[c]||{};const p={};for(const _ in this.stateChanges[c])this.state[c][_]||(this.state[c][_]={}),s.e(this.state[c][_],this.stateChanges[c][_]),p[_]=this.state[c][_];o[c]=p}for(const c in this.deletedStates){this.state[c]=this.state[c]||{};const p={};if(this.deletedStates[c]===null)for(const _ in this.state[c])p[_]={},this.state[c][_]={};else for(const _ in this.deletedStates[c]){if(this.deletedStates[c][_]===null)this.state[c][_]={};else for(const y of Object.keys(this.deletedStates[c][_]))delete this.state[c][_][y];p[_]=this.state[c][_]}o[c]=o[c]||{},s.e(o[c],p)}if(this.stateChanges={},this.deletedStates={},Object.keys(o).length!==0)for(const c in t)t[c].setFeatureState(o,n)}}class bi extends s.E{constructor(t,n,o){super(),this.id=t,this.dispatcher=o,this.on("data",c=>{c.dataType==="source"&&c.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&c.dataType==="source"&&c.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((c,p,_,y)=>{const x=new(li(p.type))(c,p,_,y);if(x.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${x.id}`);return x})(t,n,o,this),this._tiles={},this._cache=new gr(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new _e,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const n=this._tiles[t];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,n){return this._source.loadTile(t,n)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){this._source.abortTile&&this._source.abortTile(t,()=>{}),this._source.fire(new s.k("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const o=this._tiles[n];o.upload(t),o.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(Di).map(t=>t.key)}getRenderableIds(t){const n=[];for(const o in this._tiles)this._isIdRenderable(o,t)&&n.push(this._tiles[o]);return t?n.sort((o,c)=>{const p=o.tileID,_=c.tileID,y=new s.P(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),x=new s.P(_.canonical.x,_.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-_.overscaledZ||x.y-y.y||x.x-y.x}).map(o=>o.tileID.key):n.map(o=>o.tileID).sort(Di).map(o=>o.key)}hasRenderableParent(t){const n=this.findLoadedParent(t,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(t,n){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(n||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,n){const o=this._tiles[t];o&&(o.state!=="loading"&&(o.state=n),this._loadTile(o,this._tileLoaded.bind(this,o,t,n)))}_tileLoaded(t,n,o,c){if(c)return t.state="errored",void(c.status!==404?this._source.fire(new s.j(c,{tile:t})):this.update(this.transform,this.terrain));t.timeAdded=s.h.now(),o==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(n,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new s.k("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const n=this.getRenderableIds();for(let c=0;c<n.length;c++){const p=n[c];if(t.neighboringTiles&&t.neighboringTiles[p]){const _=this.getTileByID(p);o(t,_),o(_,t)}}function o(c,p){c.needsHillshadePrepare=!0,c.needsTerrainPrepare=!0;let _=p.tileID.canonical.x-c.tileID.canonical.x;const y=p.tileID.canonical.y-c.tileID.canonical.y,x=Math.pow(2,c.tileID.canonical.z),C=p.tileID.key;_===0&&y===0||Math.abs(y)>1||(Math.abs(_)>1&&(Math.abs(_+x)===1?_+=x:Math.abs(_-x)===1&&(_-=x)),p.dem&&c.dem&&(c.dem.backfillBorder(p.dem,_,y),c.neighboringTiles&&c.neighboringTiles[C]&&(c.neighboringTiles[C].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,n,o,c){for(const p in this._tiles){let _=this._tiles[p];if(c[p]||!_.hasData()||_.tileID.overscaledZ<=n||_.tileID.overscaledZ>o)continue;let y=_.tileID;for(;_&&_.tileID.overscaledZ>n+1;){const C=_.tileID.scaledTo(_.tileID.overscaledZ-1);_=this._tiles[C.key],_&&_.hasData()&&(y=C)}let x=y;for(;x.overscaledZ>n;)if(x=x.scaledTo(x.overscaledZ-1),t[x.key]){c[y.key]=y;break}}}findLoadedParent(t,n){if(t.key in this._loadedParentTiles){const o=this._loadedParentTiles[t.key];return o&&o.tileID.overscaledZ>=n?o:null}for(let o=t.overscaledZ-1;o>=n;o--){const c=t.scaledTo(o),p=this._getLoadedTile(c);if(p)return p}}_getLoadedTile(t){const n=this._tiles[t.key];return n&&n.hasData()?n:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const n=Math.ceil(t.width/this._source.tileSize)+1,o=Math.ceil(t.height/this._source.tileSize)+1,c=Math.floor(n*o*(this._maxTileCacheZoomLevels===null?s.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),p=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,c):c;this._cache.setMaxSize(p)}handleWrapJump(t){const n=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,n){const o={};for(const c in this._tiles){const p=this._tiles[c];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+n),o[p.tileID.key]=p}this._tiles=o;for(const c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(const c in this._tiles)this._setTileReloadTimer(c,this._tiles[c])}}update(t,n){if(this.transform=t,this.terrain=n,!this._sourceLoaded||this._paused)return;let o;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?o=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(E=>new s.O(E.canonical.z,E.wrap,E.canonical.z,E.canonical.x,E.canonical.y)):(o=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:n}),this._source.hasTile&&(o=o.filter(E=>this._source.hasTile(E)))):o=[];const c=t.coveringZoomLevel(this._source),p=Math.max(c-bi.maxOverzooming,this._source.minzoom),_=Math.max(c+bi.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const E={};for(const P of o)if(P.canonical.z>this._source.minzoom){const B=P.scaledTo(P.canonical.z-1);E[B.key]=B;const G=P.scaledTo(Math.max(this._source.minzoom,Math.min(P.canonical.z,5)));E[G.key]=G}o=o.concat(Object.values(E))}const y=o.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,y&&this.fire(new s.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const x=this._updateRetainedTiles(o,c);if(Wt(this._source.type)){const E={},P={},B=Object.keys(x),G=s.h.now();for(const q of B){const H=x[q],V=this._tiles[q];if(!V||V.fadeEndTime!==0&&V.fadeEndTime<=G)continue;const ae=this.findLoadedParent(H,p);ae&&(this._addTile(ae.tileID),E[ae.tileID.key]=ae.tileID),P[q]=H}this._retainLoadedChildren(P,c,_,x);for(const q in E)x[q]||(this._coveredTiles[q]=!0,x[q]=E[q]);if(n){const q={},H={};for(const V of o)this._tiles[V.key].hasData()?q[V.key]=V:H[V.key]=V;for(const V in H){const ae=H[V].children(this._source.maxzoom);this._tiles[ae[0].key]&&this._tiles[ae[1].key]&&this._tiles[ae[2].key]&&this._tiles[ae[3].key]&&(q[ae[0].key]=x[ae[0].key]=ae[0],q[ae[1].key]=x[ae[1].key]=ae[1],q[ae[2].key]=x[ae[2].key]=ae[2],q[ae[3].key]=x[ae[3].key]=ae[3],delete H[V])}for(const V in H){const ae=this.findLoadedParent(H[V],this._source.minzoom);if(ae){q[ae.tileID.key]=x[ae.tileID.key]=ae.tileID;for(const de in q)q[de].isChildOf(ae.tileID)&&delete q[de]}}for(const V in this._tiles)q[V]||(this._coveredTiles[V]=!0)}}for(const E in x)this._tiles[E].clearFadeHold();const C=s.ab(this._tiles,x);for(const E of C){const P=this._tiles[E];P.hasSymbolBuckets&&!P.holdingForFade()?P.setHoldDuration(this.map._fadeDuration):P.hasSymbolBuckets&&!P.symbolFadeFinished()||this._removeTile(E)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,n){const o={},c={},p=Math.max(n-bi.maxOverzooming,this._source.minzoom),_=Math.max(n+bi.maxUnderzooming,this._source.minzoom),y={};for(const x of t){const C=this._addTile(x);o[x.key]=x,C.hasData()||n<this._source.maxzoom&&(y[x.key]=x)}this._retainLoadedChildren(y,n,_,o);for(const x of t){let C=this._tiles[x.key];if(C.hasData())continue;if(n+1>this._source.maxzoom){const P=x.children(this._source.maxzoom)[0],B=this.getTile(P);if(B&&B.hasData()){o[P.key]=P;continue}}else{const P=x.children(this._source.maxzoom);if(o[P[0].key]&&o[P[1].key]&&o[P[2].key]&&o[P[3].key])continue}let E=C.wasRequested();for(let P=x.overscaledZ-1;P>=p;--P){const B=x.scaledTo(P);if(c[B.key])break;if(c[B.key]=!0,C=this.getTile(B),!C&&E&&(C=this._addTile(B)),C){const G=C.hasData();if((E||G)&&(o[B.key]=B),E=C.wasRequested(),G)break}}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const n=[];let o,c=this._tiles[t].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){o=this._loadedParentTiles[c.key];break}n.push(c.key);const p=c.scaledTo(c.overscaledZ-1);if(o=this._getLoadedTile(p),o)break;c=p}for(const p of n)this._loadedParentTiles[p]=o}}_addTile(t){let n=this._tiles[t.key];if(n)return n;n=this._cache.getAndRemove(t),n&&(this._setTileReloadTimer(t.key,n),n.tileID=t,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,n)));const o=n;return n||(n=new Oi(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(n,this._tileLoaded.bind(this,n,t.key,n.state))),n.uses++,this._tiles[t.key]=n,o||this._source.fire(new s.k("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(t,n){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const o=n.getExpiryTimeout();o&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},o))}_removeTile(t){const n=this._tiles[t];n&&(n.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,n,o){const c=[],p=this.transform;if(!p)return c;const _=o?p.getCameraQueryGeometry(t):t,y=t.map(q=>p.pointCoordinate(q,this.terrain)),x=_.map(q=>p.pointCoordinate(q,this.terrain)),C=this.getIds();let E=1/0,P=1/0,B=-1/0,G=-1/0;for(const q of x)E=Math.min(E,q.x),P=Math.min(P,q.y),B=Math.max(B,q.x),G=Math.max(G,q.y);for(let q=0;q<C.length;q++){const H=this._tiles[C[q]];if(H.holdingForFade())continue;const V=H.tileID,ae=Math.pow(2,p.zoom-H.tileID.overscaledZ),de=n*H.queryPadding*s.N/H.tileSize/ae,J=[V.getTilePoint(new s.U(E,P)),V.getTilePoint(new s.U(B,G))];if(J[0].x-de<s.N&&J[0].y-de<s.N&&J[1].x+de>=0&&J[1].y+de>=0){const oe=y.map(me=>V.getTilePoint(me)),fe=x.map(me=>V.getTilePoint(me));c.push({tile:H,tileID:V,queryGeometry:oe,cameraQueryGeometry:fe,scale:ae})}}return c}getVisibleCoordinates(t){const n=this.getRenderableIds(t).map(o=>this._tiles[o].tileID);for(const o of n)o.posMatrix=this.transform.calculatePosMatrix(o.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(Wt(this._source.type)){const t=s.h.now();for(const n in this._tiles)if(this._tiles[n].fadeEndTime>=t)return!0}return!1}setFeatureState(t,n,o){this._state.updateState(t=t||"_geojsonTileLayer",n,o)}removeFeatureState(t,n,o){this._state.removeFeatureState(t=t||"_geojsonTileLayer",n,o)}getFeatureState(t,n){return this._state.getState(t=t||"_geojsonTileLayer",n)}setDependencies(t,n,o){const c=this._tiles[t];c&&c.setDependencies(n,o)}reloadTilesForDependencies(t,n){for(const o in this._tiles)this._tiles[o].hasDependency(t,n)&&this._reloadTile(o,"reloading");this._cache.filter(o=>!o.hasDependency(t,n))}}function Di(h,t){const n=Math.abs(2*h.wrap)-+(h.wrap<0),o=Math.abs(2*t.wrap)-+(t.wrap<0);return h.overscaledZ-t.overscaledZ||o-n||t.canonical.y-h.canonical.y||t.canonical.x-h.canonical.x}function Wt(h){return h==="raster"||h==="image"||h==="video"}bi.maxOverzooming=10,bi.maxUnderzooming=3;const Ot="mapboxgl_preloaded_worker_pool";class Gi{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Gi.workerCount;)this.workers.push(new Worker(s.c.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ot]}numActive(){return Object.keys(this.active).length}}const Ki=Math.floor(s.h.hardwareConcurrency/2);let _i;function sn(){return _i||(_i=new Gi),_i}Gi.workerCount=s.ac(globalThis)?Math.max(Math.min(Ki,3),1):1;class sr{constructor(t,n){this.reset(t,n)}reset(t,n){this.points=t||[],this._distances=[0];for(let o=1;o<this.points.length;o++)this._distances[o]=this._distances[o-1]+this.points[o].dist(this.points[o-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=s.ad(t,0,1);let n=1,o=this._distances[n];const c=t*this.paddedLength+this.padding;for(;o<c&&n<this._distances.length;)o=this._distances[++n];const p=n-1,_=this._distances[p],y=o-_,x=y>0?(c-_)/y:0;return this.points[p].mult(1-x).add(this.points[n].mult(x))}}function ar(h,t){let n=!0;return h==="always"||h!=="never"&&t!=="never"||(n=!1),n}class Ur{constructor(t,n,o){const c=this.boxCells=[],p=this.circleCells=[];this.xCellCount=Math.ceil(t/o),this.yCellCount=Math.ceil(n/o);for(let _=0;_<this.xCellCount*this.yCellCount;_++)c.push([]),p.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=n,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,n,o,c,p){this._forEachCell(n,o,c,p,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(c),this.bboxes.push(p)}insertCircle(t,n,o,c){this._forEachCell(n-c,o-c,n+c,o+c,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(n),this.circles.push(o),this.circles.push(c)}_insertBoxCell(t,n,o,c,p,_){this.boxCells[p].push(_)}_insertCircleCell(t,n,o,c,p,_){this.circleCells[p].push(_)}_query(t,n,o,c,p,_,y){if(o<0||t>this.width||c<0||n>this.height)return[];const x=[];if(t<=0&&n<=0&&this.width<=o&&this.height<=c){if(p)return[{key:null,x1:t,y1:n,x2:o,y2:c}];for(let C=0;C<this.boxKeys.length;C++)x.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const E=this.circles[3*C],P=this.circles[3*C+1],B=this.circles[3*C+2];x.push({key:this.circleKeys[C],x1:E-B,y1:P-B,x2:E+B,y2:P+B})}}else this._forEachCell(t,n,o,c,this._queryCell,x,{hitTest:p,overlapMode:_,seenUids:{box:{},circle:{}}},y);return x}query(t,n,o,c){return this._query(t,n,o,c,!1,null)}hitTest(t,n,o,c,p,_){return this._query(t,n,o,c,!0,p,_).length>0}hitTestCircle(t,n,o,c,p){const _=t-o,y=t+o,x=n-o,C=n+o;if(y<0||_>this.width||C<0||x>this.height)return!1;const E=[];return this._forEachCell(_,x,y,C,this._queryCellCircle,E,{hitTest:!0,overlapMode:c,circle:{x:t,y:n,radius:o},seenUids:{box:{},circle:{}}},p),E.length>0}_queryCell(t,n,o,c,p,_,y,x){const{seenUids:C,hitTest:E,overlapMode:P}=y,B=this.boxCells[p];if(B!==null){const q=this.bboxes;for(const H of B)if(!C.box[H]){C.box[H]=!0;const V=4*H,ae=this.boxKeys[H];if(t<=q[V+2]&&n<=q[V+3]&&o>=q[V+0]&&c>=q[V+1]&&(!x||x(ae))&&(!E||!ar(P,ae.overlapMode))&&(_.push({key:ae,x1:q[V],y1:q[V+1],x2:q[V+2],y2:q[V+3]}),E))return!0}}const G=this.circleCells[p];if(G!==null){const q=this.circles;for(const H of G)if(!C.circle[H]){C.circle[H]=!0;const V=3*H,ae=this.circleKeys[H];if(this._circleAndRectCollide(q[V],q[V+1],q[V+2],t,n,o,c)&&(!x||x(ae))&&(!E||!ar(P,ae.overlapMode))){const de=q[V],J=q[V+1],oe=q[V+2];if(_.push({key:ae,x1:de-oe,y1:J-oe,x2:de+oe,y2:J+oe}),E)return!0}}}return!1}_queryCellCircle(t,n,o,c,p,_,y,x){const{circle:C,seenUids:E,overlapMode:P}=y,B=this.boxCells[p];if(B!==null){const q=this.bboxes;for(const H of B)if(!E.box[H]){E.box[H]=!0;const V=4*H,ae=this.boxKeys[H];if(this._circleAndRectCollide(C.x,C.y,C.radius,q[V+0],q[V+1],q[V+2],q[V+3])&&(!x||x(ae))&&!ar(P,ae.overlapMode))return _.push(!0),!0}}const G=this.circleCells[p];if(G!==null){const q=this.circles;for(const H of G)if(!E.circle[H]){E.circle[H]=!0;const V=3*H,ae=this.circleKeys[H];if(this._circlesCollide(q[V],q[V+1],q[V+2],C.x,C.y,C.radius)&&(!x||x(ae))&&!ar(P,ae.overlapMode))return _.push(!0),!0}}}_forEachCell(t,n,o,c,p,_,y,x){const C=this._convertToXCellCoord(t),E=this._convertToYCellCoord(n),P=this._convertToXCellCoord(o),B=this._convertToYCellCoord(c);for(let G=C;G<=P;G++)for(let q=E;q<=B;q++)if(p.call(this,t,n,o,c,this.xCellCount*q+G,_,y,x))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,n,o,c,p,_){const y=c-t,x=p-n,C=o+_;return C*C>y*y+x*x}_circleAndRectCollide(t,n,o,c,p,_,y){const x=(_-c)/2,C=Math.abs(t-(c+x));if(C>x+o)return!1;const E=(y-p)/2,P=Math.abs(n-(p+E));if(P>E+o)return!1;if(C<=x||P<=E)return!0;const B=C-x,G=P-E;return B*B+G*G<=o*o}}function je(h,t,n,o,c){const p=s.Z();return t?(s.a0(p,p,[1/c,1/c,1]),n||s.ae(p,p,o.angle)):s.a1(p,o.labelPlaneMatrix,h),p}function It(h,t,n,o,c){if(t){const p=s.af(h);return s.a0(p,p,[c,c,1]),n||s.ae(p,p,-o.angle),p}return o.glCoordMatrix}function wt(h,t,n){let o;n?(o=[h.x,h.y,n(h.x,h.y),1],s.ag(o,o,t)):(o=[h.x,h.y,0,1],W(o,o,t));const c=o[3];return{point:new s.P(o[0]/c,o[1]/c),signedDistanceFromCamera:c}}function Jt(h,t){return .5+h/t*.5}function zt(h,t){const n=h[0]/h[3],o=h[1]/h[3];return n>=-t[0]&&n<=t[0]&&o>=-t[1]&&o<=t[1]}function ze(h,t,n,o,c,p,_,y,x,C){const E=o?h.textSizeData:h.iconSizeData,P=s.ah(E,n.transform.zoom),B=[256/n.width*2+1,256/n.height*2+1],G=o?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;G.clear();const q=h.lineVertexArray,H=o?h.text.placedSymbolArray:h.icon.placedSymbolArray,V=n.transform.width/n.transform.height;let ae=!1;for(let de=0;de<H.length;de++){const J=H.get(de);if(J.hidden||J.writingMode===s.ai.vertical&&!ae){N(J.numGlyphs,G);continue}let oe;if(ae=!1,C?(oe=[J.anchorX,J.anchorY,C(J.anchorX,J.anchorY),1],s.ag(oe,oe,t)):(oe=[J.anchorX,J.anchorY,0,1],W(oe,oe,t)),!zt(oe,B)){N(J.numGlyphs,G);continue}const fe=Jt(n.transform.cameraToCenterDistance,oe[3]),me=s.aj(E,P,J),Me=_?me/fe:me*fe,$e=new s.P(J.anchorX,J.anchorY),De=wt($e,c,C).point,Ve={projections:{},offsets:{}},ot=wi(J,Me,!1,y,t,c,p,h.glyphOffsetArray,q,G,De,$e,Ve,V,x,C);ae=ot.useVertical,(ot.notEnoughRoom||ae||ot.needsFlipping&&wi(J,Me,!0,y,t,c,p,h.glyphOffsetArray,q,G,De,$e,Ve,V,x,C).notEnoughRoom)&&N(J.numGlyphs,G)}o?h.text.dynamicLayoutVertexBuffer.updateData(G):h.icon.dynamicLayoutVertexBuffer.updateData(G)}function mt(h,t,n,o,c,p,_,y,x,C,E,P,B){const G=y.glyphStartIndex+y.numGlyphs,q=y.lineStartIndex,H=y.lineStartIndex+y.lineLength,V=t.getoffsetX(y.glyphStartIndex),ae=t.getoffsetX(G-1),de=z(h*V,n,o,c,p,_,y.segment,q,H,x,C,E,P,B);if(!de)return null;const J=z(h*ae,n,o,c,p,_,y.segment,q,H,x,C,E,P,B);return J?{first:de,last:J}:null}function yt(h,t,n,o){return h===s.ai.horizontal&&Math.abs(n.y-t.y)>Math.abs(n.x-t.x)*o?{useVertical:!0}:(h===s.ai.vertical?t.y<n.y:t.x>n.x)?{needsFlipping:!0}:null}function wi(h,t,n,o,c,p,_,y,x,C,E,P,B,G,q,H){const V=t/24,ae=h.lineOffsetX*V,de=h.lineOffsetY*V;let J;if(h.numGlyphs>1){const oe=h.glyphStartIndex+h.numGlyphs,fe=h.lineStartIndex,me=h.lineStartIndex+h.lineLength,Me=mt(V,y,ae,de,n,E,P,h,x,p,B,q,H);if(!Me)return{notEnoughRoom:!0};const $e=wt(Me.first.point,_,H).point,De=wt(Me.last.point,_,H).point;if(o&&!n){const Ve=yt(h.writingMode,$e,De,G);if(Ve)return Ve}J=[Me.first];for(let Ve=h.glyphStartIndex+1;Ve<oe-1;Ve++)J.push(z(V*y.getoffsetX(Ve),ae,de,n,E,P,h.segment,fe,me,x,p,B,q,H));J.push(Me.last)}else{if(o&&!n){const fe=wt(P,c,H).point,me=h.lineStartIndex+h.segment+1,Me=new s.P(x.getx(me),x.gety(me)),$e=wt(Me,c,H),De=$e.signedDistanceFromCamera>0?$e.point:Zi(P,Me,fe,1,c,H),Ve=yt(h.writingMode,fe,De,G);if(Ve)return Ve}const oe=z(V*y.getoffsetX(h.glyphStartIndex),ae,de,n,E,P,h.segment,h.lineStartIndex,h.lineStartIndex+h.lineLength,x,p,B,q,H);if(!oe)return{notEnoughRoom:!0};J=[oe]}for(const oe of J)s.ak(C,oe.point,oe.angle);return{}}function Zi(h,t,n,o,c,p){const _=wt(h.add(h.sub(t)._unit()),c,p).point,y=n.sub(_);return n.add(y._mult(o/y.mag()))}function Mt(h,t){const{projectionCache:n,lineVertexArray:o,labelPlaneMatrix:c,tileAnchorPoint:p,distanceFromAnchor:_,getElevation:y,previousVertex:x,direction:C,absOffsetX:E}=t;if(n.projections[h])return n.projections[h];const P=new s.P(o.getx(h),o.gety(h)),B=wt(P,c,y);if(B.signedDistanceFromCamera>0)return n.projections[h]=B.point,B.point;const G=h-C;return Zi(_===0?p:new s.P(o.getx(G),o.gety(G)),P,x,E-_+1,c,y)}function qr(h,t,n){return h._unit()._perp()._mult(t*n)}function Z(h,t,n,o,c,p,_,y){const{projectionCache:x,direction:C}=y;if(x.offsets[h])return x.offsets[h];const E=n.add(t);if(h+C<o||h+C>=c)return x.offsets[h]=E,E;const P=Mt(h+C,y),B=qr(P.sub(n),_,C),G=n.add(B),q=P.add(B);return x.offsets[h]=s.al(p,E,G,q)||E,x.offsets[h]}function z(h,t,n,o,c,p,_,y,x,C,E,P,B,G){const q=o?h-t:h+t;let H=q>0?1:-1,V=0;o&&(H*=-1,V=Math.PI),H<0&&(V+=Math.PI);let ae,de,J=H>0?y+_:y+_+1,oe=c,fe=c,me=0,Me=0;const $e=Math.abs(q),De=[];let Ve;for(;me+Me<=$e;){if(J+=H,J<y||J>=x)return null;me+=Me,fe=oe,de=ae;const Ze={projectionCache:P,lineVertexArray:C,labelPlaneMatrix:E,tileAnchorPoint:p,distanceFromAnchor:me,getElevation:G,previousVertex:fe,direction:H,absOffsetX:$e};if(oe=Mt(J,Ze),n===0)De.push(fe),Ve=oe.sub(fe);else{let xt;const ut=oe.sub(fe);xt=ut.mag()===0?qr(Mt(J+H,Ze).sub(oe),n,H):qr(ut,n,H),de||(de=fe.add(xt)),ae=Z(J,xt,oe,y,x,de,n,Ze),De.push(de),Ve=ae.sub(de)}Me=Ve.mag()}const ot=Ve._mult(($e-me)/Me)._add(de||fe),Ut=V+Math.atan2(oe.y-fe.y,oe.x-fe.x);return De.push(ot),{point:ot,angle:B?Ut:0,path:De}}const R=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function N(h,t){for(let n=0;n<h;n++){const o=t.length;t.resize(o+4),t.float32.set(R,3*o)}}function W(h,t,n){const o=t[0],c=t[1];return h[0]=n[0]*o+n[4]*c+n[12],h[1]=n[1]*o+n[5]*c+n[13],h[3]=n[3]*o+n[7]*c+n[15],h}const Y=100;class ce{constructor(t,n=new Ur(t.width+200,t.height+200,25),o=new Ur(t.width+200,t.height+200,25)){this.transform=t,this.grid=n,this.ignoredGrid=o,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Y,this.screenBottomBoundary=t.height+Y,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,n,o,c,p,_){const y=this.projectAndGetPerspectiveRatio(c,t.anchorPointX,t.anchorPointY,_),x=o*y.perspectiveRatio,C=t.x1*x+y.point.x,E=t.y1*x+y.point.y,P=t.x2*x+y.point.x,B=t.y2*x+y.point.y;return!this.isInsideGrid(C,E,P,B)||n!=="always"&&this.grid.hitTest(C,E,P,B,n,p)||y.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[C,E,P,B],offscreen:this.isOffscreen(C,E,P,B)}}placeCollisionCircles(t,n,o,c,p,_,y,x,C,E,P,B,G,q){const H=[],V=new s.P(n.anchorX,n.anchorY),ae=wt(V,_,q),de=Jt(this.transform.cameraToCenterDistance,ae.signedDistanceFromCamera),J=(E?p/de:p*de)/s.ap,oe=wt(V,y,q).point,fe=mt(J,c,n.lineOffsetX*J,n.lineOffsetY*J,!1,oe,V,n,o,y,{projections:{},offsets:{}},!1,q);let me=!1,Me=!1,$e=!0;if(fe){const De=.5*B*de+G,Ve=new s.P(-100,-100),ot=new s.P(this.screenRightBoundary,this.screenBottomBoundary),Ut=new sr,Ze=fe.first,xt=fe.last;let ut=[];for(let Lt=Ze.path.length-1;Lt>=1;Lt--)ut.push(Ze.path[Lt]);for(let Lt=1;Lt<xt.path.length;Lt++)ut.push(xt.path[Lt]);const hi=2.5*De;if(x){const Lt=ut.map(qt=>wt(qt,x,q));ut=Lt.some(qt=>qt.signedDistanceFromCamera<=0)?[]:Lt.map(qt=>qt.point)}let Vt=[];if(ut.length>0){const Lt=ut[0].clone(),qt=ut[0].clone();for(let Bi=1;Bi<ut.length;Bi++)Lt.x=Math.min(Lt.x,ut[Bi].x),Lt.y=Math.min(Lt.y,ut[Bi].y),qt.x=Math.max(qt.x,ut[Bi].x),qt.y=Math.max(qt.y,ut[Bi].y);Vt=Lt.x>=Ve.x&&qt.x<=ot.x&&Lt.y>=Ve.y&&qt.y<=ot.y?[ut]:qt.x<Ve.x||Lt.x>ot.x||qt.y<Ve.y||Lt.y>ot.y?[]:s.am([ut],Ve.x,Ve.y,ot.x,ot.y)}for(const Lt of Vt){Ut.reset(Lt,.25*De);let qt=0;qt=Ut.length<=.5*De?1:Math.ceil(Ut.paddedLength/hi)+1;for(let Bi=0;Bi<qt;Bi++){const fi=Bi/Math.max(qt-1,1),lr=Ut.lerp(fi),Yi=lr.x+Y,Vi=lr.y+Y;H.push(Yi,Vi,De,0);const Fr=Yi-De,vi=Vi-De,ln=Yi+De,cn=Vi+De;if($e=$e&&this.isOffscreen(Fr,vi,ln,cn),Me=Me||this.isInsideGrid(Fr,vi,ln,cn),t!=="always"&&this.grid.hitTestCircle(Yi,Vi,De,t,P)&&(me=!0,!C))return{circles:[],offscreen:!1,collisionDetected:me}}}}return{circles:!C&&me||!Me||de<this.perspectiveRatioCutoff?[]:H,offscreen:$e,collisionDetected:me}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const n=[];let o=1/0,c=1/0,p=-1/0,_=-1/0;for(const E of t){const P=new s.P(E.x+Y,E.y+Y);o=Math.min(o,P.x),c=Math.min(c,P.y),p=Math.max(p,P.x),_=Math.max(_,P.y),n.push(P)}const y=this.grid.query(o,c,p,_).concat(this.ignoredGrid.query(o,c,p,_)),x={},C={};for(const E of y){const P=E.key;if(x[P.bucketInstanceId]===void 0&&(x[P.bucketInstanceId]={}),x[P.bucketInstanceId][P.featureIndex])continue;const B=[new s.P(E.x1,E.y1),new s.P(E.x2,E.y1),new s.P(E.x2,E.y2),new s.P(E.x1,E.y2)];s.an(n,B)&&(x[P.bucketInstanceId][P.featureIndex]=!0,C[P.bucketInstanceId]===void 0&&(C[P.bucketInstanceId]=[]),C[P.bucketInstanceId].push(P.featureIndex))}return C}insertCollisionBox(t,n,o,c,p,_){(o?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:p,collisionGroupID:_,overlapMode:n},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,n,o,c,p,_){const y=o?this.ignoredGrid:this.grid,x={bucketInstanceId:c,featureIndex:p,collisionGroupID:_,overlapMode:n};for(let C=0;C<t.length;C+=4)y.insertCircle(x,t[C],t[C+1],t[C+2])}projectAndGetPerspectiveRatio(t,n,o,c){let p;return c?(p=[n,o,c(n,o),1],s.ag(p,p,t)):(p=[n,o,0,1],W(p,p,t)),{point:new s.P((p[0]/p[3]+1)/2*this.transform.width+Y,(-p[1]/p[3]+1)/2*this.transform.height+Y),perspectiveRatio:.5+this.transform.cameraToCenterDistance/p[3]*.5}}isOffscreen(t,n,o,c){return o<Y||t>=this.screenRightBoundary||c<Y||n>this.screenBottomBoundary}isInsideGrid(t,n,o,c){return o>=0&&t<this.gridRightBoundary&&c>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const t=s.ao([]);return s.$(t,t,[-100,-100,0]),t}}function re(h,t,n){return t*(s.N/(h.tileSize*Math.pow(2,n-h.tileID.overscaledZ)))}class Q{constructor(t,n,o,c){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?n:-n))):c&&o?1:0,this.placed=o}isHidden(){return this.opacity===0&&!this.placed}}class se{constructor(t,n,o,c,p){this.text=new Q(t?t.text:null,n,o,p),this.icon=new Q(t?t.icon:null,n,c,p)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ce{constructor(t,n,o){this.text=t,this.icon=n,this.skipFade=o}}class Ie{constructor(){this.invProjMatrix=s.Z(),this.viewportMatrix=s.Z(),this.circles=[]}}class Ae{constructor(t,n,o,c,p){this.bucketInstanceId=t,this.featureIndex=n,this.sourceLayerIndex=o,this.bucketIndex=c,this.tileID=p}}class dt{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const n=++this.maxGroupID;this.collisionGroups[t]={ID:n,predicate:o=>o.collisionGroupID===n}}return this.collisionGroups[t]}}function St(h,t,n,o,c){const{horizontalAlign:p,verticalAlign:_}=s.au(h);return new s.P(-(p-.5)*t+o[0]*c,-(_-.5)*n+o[1]*c)}function nt(h,t,n,o,c,p){const{x1:_,x2:y,y1:x,y2:C,anchorPointX:E,anchorPointY:P}=h,B=new s.P(t,n);return o&&B._rotate(c?p:-p),{x1:_+B.x,y1:x+B.y,x2:y+B.x,y2:C+B.y,anchorPointX:E,anchorPointY:P}}class Ke{constructor(t,n,o,c,p){this.transform=t.clone(),this.terrain=n,this.collisionIndex=new ce(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=o,this.retainedQueryData={},this.collisionGroups=new dt(c),this.collisionCircleArrays={},this.prevPlacement=p,p&&(p.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,n,o,c){const p=o.getBucket(n),_=o.latestFeatureIndex;if(!p||!_||n.id!==p.layerIds[0])return;const y=o.collisionBoxArray,x=p.layers[0].layout,C=Math.pow(2,this.transform.zoom-o.tileID.overscaledZ),E=o.tileSize/s.N,P=this.transform.calculatePosMatrix(o.tileID.toUnwrapped()),B=x.get("text-pitch-alignment")==="map",G=x.get("text-rotation-alignment")==="map",q=re(o,1,this.transform.zoom),H=je(P,B,G,this.transform,q);let V=null;if(B){const de=It(P,B,G,this.transform,q);V=s.a1([],this.transform.labelPlaneMatrix,de)}this.retainedQueryData[p.bucketInstanceId]=new Ae(p.bucketInstanceId,_,p.sourceLayerIndex,p.index,o.tileID);const ae={bucket:p,layout:x,posMatrix:P,textLabelPlaneMatrix:H,labelToScreenMatrix:V,scale:C,textPixelRatio:E,holdingForFade:o.holdingForFade(),collisionBoxArray:y,partiallyEvaluatedTextSize:s.ah(p.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(p.sourceID)};if(c)for(const de of p.sortKeyRanges){const{sortKey:J,symbolInstanceStart:oe,symbolInstanceEnd:fe}=de;t.push({sortKey:J,symbolInstanceStart:oe,symbolInstanceEnd:fe,parameters:ae})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:p.symbolInstances.length,parameters:ae})}attemptAnchorPlacement(t,n,o,c,p,_,y,x,C,E,P,B,G,q,H,V){const ae=s.aq[t.textAnchor],de=[t.textOffset0,t.textOffset1],J=St(ae,o,c,de,p),oe=this.collisionIndex.placeCollisionBox(nt(n,J.x,J.y,_,y,this.transform.angle),P,x,C,E.predicate,V);if((!H||this.collisionIndex.placeCollisionBox(nt(H,J.x,J.y,_,y,this.transform.angle),P,x,C,E.predicate,V).box.length!==0)&&oe.box.length>0){let fe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[B.crossTileID]&&this.prevPlacement.placements[B.crossTileID]&&this.prevPlacement.placements[B.crossTileID].text&&(fe=this.prevPlacement.variableOffsets[B.crossTileID].anchor),B.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[B.crossTileID]={textOffset:de,width:o,height:c,anchor:ae,textBoxScale:p,prevAnchor:fe},this.markUsedJustification(G,ae,B,q),G.allowVerticalPlacement&&(this.markUsedOrientation(G,q,B),this.placedOrientations[B.crossTileID]=q),{shift:J,placedGlyphBoxes:oe}}}placeLayerBucketPart(t,n,o){const{bucket:c,layout:p,posMatrix:_,textLabelPlaneMatrix:y,labelToScreenMatrix:x,textPixelRatio:C,holdingForFade:E,collisionBoxArray:P,partiallyEvaluatedTextSize:B,collisionGroup:G}=t.parameters,q=p.get("text-optional"),H=p.get("icon-optional"),V=s.ar(p,"text-overlap","text-allow-overlap"),ae=V==="always",de=s.ar(p,"icon-overlap","icon-allow-overlap"),J=de==="always",oe=p.get("text-rotation-alignment")==="map",fe=p.get("text-pitch-alignment")==="map",me=p.get("icon-text-fit")!=="none",Me=p.get("symbol-z-order")==="viewport-y",$e=ae&&(J||!c.hasIconData()||H),De=J&&(ae||!c.hasTextData()||q);!c.collisionArrays&&P&&c.deserializeCollisionBoxes(P);const Ve=this.retainedQueryData[c.bucketInstanceId].tileID,ot=this.terrain?(Ze,xt)=>this.terrain.getElevation(Ve,Ze,xt):null,Ut=(Ze,xt)=>{var ut,hi;if(n[Ze.crossTileID])return;if(E)return void(this.placements[Ze.crossTileID]=new Ce(!1,!1,!1));let Vt=!1,Lt=!1,qt=!0,Bi=null,fi={box:null,offscreen:null},lr={box:null,offscreen:null},Yi=null,Vi=null,Fr=null,vi=0,ln=0,cn=0;xt.textFeatureIndex?vi=xt.textFeatureIndex:Ze.useRuntimeCollisionCircles&&(vi=Ze.featureIndex),xt.verticalTextFeatureIndex&&(ln=xt.verticalTextFeatureIndex);const Rn=xt.textBox;if(Rn){const dr=Fi=>{let Ji=s.ai.horizontal;if(c.allowVerticalPlacement&&!Fi&&this.prevPlacement){const Ir=this.prevPlacement.placedOrientations[Ze.crossTileID];Ir&&(this.placedOrientations[Ze.crossTileID]=Ir,Ji=Ir,this.markUsedOrientation(c,Ji,Ze))}return Ji},cr=(Fi,Ji)=>{if(c.allowVerticalPlacement&&Ze.numVerticalGlyphVertices>0&&xt.verticalTextBox){for(const Ir of c.writingModes)if(Ir===s.ai.vertical?(fi=Ji(),lr=fi):fi=Fi(),fi&&fi.box&&fi.box.length)break}else fi=Fi()},yr=Ze.textAnchorOffsetStartIndex,Yn=Ze.textAnchorOffsetEndIndex;if(Yn===yr){const Fi=(Ji,Ir)=>{const $i=this.collisionIndex.placeCollisionBox(Ji,V,C,_,G.predicate,ot);return $i&&$i.box&&$i.box.length&&(this.markUsedOrientation(c,Ir,Ze),this.placedOrientations[Ze.crossTileID]=Ir),$i};cr(()=>Fi(Rn,s.ai.horizontal),()=>{const Ji=xt.verticalTextBox;return c.allowVerticalPlacement&&Ze.numVerticalGlyphVertices>0&&Ji?Fi(Ji,s.ai.vertical):{box:null,offscreen:null}}),dr(fi&&fi.box&&fi.box.length)}else{let Fi=s.aq[(hi=(ut=this.prevPlacement)===null||ut===void 0?void 0:ut.variableOffsets[Ze.crossTileID])===null||hi===void 0?void 0:hi.anchor];const Ji=($i,Jn,Es)=>{const Zl=$i.x2-$i.x1,Hl=$i.y2-$i.y1,qc=Ze.textBoxScale,ko=me&&de==="never"?Jn:null;let un={box:[],offscreen:!1},Qn=V==="never"?1:2,hn="never";Fi&&Qn++;for(let Kr=0;Kr<Qn;Kr++){for(let dn=yr;dn<Yn;dn++){const zo=c.textAnchorOffsets.get(dn);if(Fi&&zo.textAnchor!==Fi)continue;const bn=this.attemptAnchorPlacement(zo,$i,Zl,Hl,qc,oe,fe,C,_,G,hn,Ze,c,Es,ko,ot);if(bn&&(un=bn.placedGlyphBoxes,un&&un.box&&un.box.length))return Vt=!0,Bi=bn.shift,un}Fi?Fi=null:hn=V}return un};cr(()=>Ji(Rn,xt.iconBox,s.ai.horizontal),()=>{const $i=xt.verticalTextBox;return c.allowVerticalPlacement&&!(fi&&fi.box&&fi.box.length)&&Ze.numVerticalGlyphVertices>0&&$i?Ji($i,xt.verticalIconBox,s.ai.vertical):{box:null,offscreen:null}}),fi&&(Vt=fi.box,qt=fi.offscreen);const Ir=dr(fi&&fi.box);if(!Vt&&this.prevPlacement){const $i=this.prevPlacement.variableOffsets[Ze.crossTileID];$i&&(this.variableOffsets[Ze.crossTileID]=$i,this.markUsedJustification(c,$i.anchor,Ze,Ir))}}}if(Yi=fi,Vt=Yi&&Yi.box&&Yi.box.length>0,qt=Yi&&Yi.offscreen,Ze.useRuntimeCollisionCircles){const dr=c.text.placedSymbolArray.get(Ze.centerJustifiedTextSymbolIndex),cr=s.aj(c.textSizeData,B,dr),yr=p.get("text-padding");Vi=this.collisionIndex.placeCollisionCircles(V,dr,c.lineVertexArray,c.glyphOffsetArray,cr,_,y,x,o,fe,G.predicate,Ze.collisionCircleDiameter,yr,ot),Vi.circles.length&&Vi.collisionDetected&&!o&&s.w("Collisions detected, but collision boxes are not shown"),Vt=ae||Vi.circles.length>0&&!Vi.collisionDetected,qt=qt&&Vi.offscreen}if(xt.iconFeatureIndex&&(cn=xt.iconFeatureIndex),xt.iconBox){const dr=cr=>{const yr=me&&Bi?nt(cr,Bi.x,Bi.y,oe,fe,this.transform.angle):cr;return this.collisionIndex.placeCollisionBox(yr,de,C,_,G.predicate,ot)};lr&&lr.box&&lr.box.length&&xt.verticalIconBox?(Fr=dr(xt.verticalIconBox),Lt=Fr.box.length>0):(Fr=dr(xt.iconBox),Lt=Fr.box.length>0),qt=qt&&Fr.offscreen}const Kn=q||Ze.numHorizontalGlyphVertices===0&&Ze.numVerticalGlyphVertices===0,ga=H||Ze.numIconVertices===0;if(Kn||ga?ga?Kn||(Lt=Lt&&Vt):Vt=Lt&&Vt:Lt=Vt=Lt&&Vt,Vt&&Yi&&Yi.box&&this.collisionIndex.insertCollisionBox(Yi.box,V,p.get("text-ignore-placement"),c.bucketInstanceId,lr&&lr.box&&ln?ln:vi,G.ID),Lt&&Fr&&this.collisionIndex.insertCollisionBox(Fr.box,de,p.get("icon-ignore-placement"),c.bucketInstanceId,cn,G.ID),Vi&&(Vt&&this.collisionIndex.insertCollisionCircles(Vi.circles,V,p.get("text-ignore-placement"),c.bucketInstanceId,vi,G.ID),o)){const dr=c.bucketInstanceId;let cr=this.collisionCircleArrays[dr];cr===void 0&&(cr=this.collisionCircleArrays[dr]=new Ie);for(let yr=0;yr<Vi.circles.length;yr+=4)cr.circles.push(Vi.circles[yr+0]),cr.circles.push(Vi.circles[yr+1]),cr.circles.push(Vi.circles[yr+2]),cr.circles.push(Vi.collisionDetected?1:0)}if(Ze.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(c.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ze.crossTileID]=new Ce(Vt||$e,Lt||De,qt||c.justReloaded),n[Ze.crossTileID]=!0};if(Me){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Ze=c.getSortedSymbolIndexes(this.transform.angle);for(let xt=Ze.length-1;xt>=0;--xt){const ut=Ze[xt];Ut(c.symbolInstances.get(ut),c.collisionArrays[ut])}}else for(let Ze=t.symbolInstanceStart;Ze<t.symbolInstanceEnd;Ze++)Ut(c.symbolInstances.get(Ze),c.collisionArrays[Ze]);if(o&&c.bucketInstanceId in this.collisionCircleArrays){const Ze=this.collisionCircleArrays[c.bucketInstanceId];s.as(Ze.invProjMatrix,_),Ze.viewportMatrix=this.collisionIndex.getViewportMatrix()}c.justReloaded=!1}markUsedJustification(t,n,o,c){let p;p=c===s.ai.vertical?o.verticalPlacedTextSymbolIndex:{left:o.leftJustifiedTextSymbolIndex,center:o.centerJustifiedTextSymbolIndex,right:o.rightJustifiedTextSymbolIndex}[s.at(n)];const _=[o.leftJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.rightJustifiedTextSymbolIndex,o.verticalPlacedTextSymbolIndex];for(const y of _)y>=0&&(t.text.placedSymbolArray.get(y).crossTileID=p>=0&&y!==p?0:o.crossTileID)}markUsedOrientation(t,n,o){const c=n===s.ai.horizontal||n===s.ai.horizontalOnly?n:0,p=n===s.ai.vertical?n:0,_=[o.leftJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.rightJustifiedTextSymbolIndex];for(const y of _)t.text.placedSymbolArray.get(y).placedOrientation=c;o.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(o.verticalPlacedTextSymbolIndex).placedOrientation=p)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let o=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const c=n?n.symbolFadeChange(t):1,p=n?n.opacities:{},_=n?n.variableOffsets:{},y=n?n.placedOrientations:{};for(const x in this.placements){const C=this.placements[x],E=p[x];E?(this.opacities[x]=new se(E,c,C.text,C.icon),o=o||C.text!==E.text.placed||C.icon!==E.icon.placed):(this.opacities[x]=new se(null,c,C.text,C.icon,C.skipFade),o=o||C.text||C.icon)}for(const x in p){const C=p[x];if(!this.opacities[x]){const E=new se(C,c,!1,!1);E.isHidden()||(this.opacities[x]=E,o=o||C.text.placed||C.icon.placed)}}for(const x in _)this.variableOffsets[x]||!this.opacities[x]||this.opacities[x].isHidden()||(this.variableOffsets[x]=_[x]);for(const x in y)this.placedOrientations[x]||!this.opacities[x]||this.opacities[x].isHidden()||(this.placedOrientations[x]=y[x]);if(n&&n.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");o?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:t)}updateLayerOpacities(t,n){const o={};for(const c of n){const p=c.getBucket(t);p&&c.latestFeatureIndex&&t.id===p.layerIds[0]&&this.updateBucketOpacities(p,o,c.collisionBoxArray)}}updateBucketOpacities(t,n,o){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const c=t.layers[0],p=c.layout,_=new se(null,0,!1,!1,!0),y=p.get("text-allow-overlap"),x=p.get("icon-allow-overlap"),C=c._unevaluatedLayout.hasValue("text-variable-anchor")||c._unevaluatedLayout.hasValue("text-variable-anchor-offset"),E=p.get("text-rotation-alignment")==="map",P=p.get("text-pitch-alignment")==="map",B=p.get("icon-text-fit")!=="none",G=new se(null,0,y&&(x||!t.hasIconData()||p.get("icon-optional")),x&&(y||!t.hasTextData()||p.get("text-optional")),!0);!t.collisionArrays&&o&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(o);const q=(H,V,ae)=>{for(let de=0;de<V/4;de++)H.opacityVertexArray.emplaceBack(ae);H.hasVisibleVertices=H.hasVisibleVertices||ae!==Sr};for(let H=0;H<t.symbolInstances.length;H++){const V=t.symbolInstances.get(H),{numHorizontalGlyphVertices:ae,numVerticalGlyphVertices:de,crossTileID:J}=V;let oe=this.opacities[J];n[J]?oe=_:oe||(oe=G,this.opacities[J]=oe),n[J]=!0;const fe=V.numIconVertices>0,me=this.placedOrientations[V.crossTileID],Me=me===s.ai.vertical,$e=me===s.ai.horizontal||me===s.ai.horizontalOnly;if(ae>0||de>0){const De=Ri(oe.text);q(t.text,ae,Me?Sr:De),q(t.text,de,$e?Sr:De);const Ve=oe.text.isHidden();[V.rightJustifiedTextSymbolIndex,V.centerJustifiedTextSymbolIndex,V.leftJustifiedTextSymbolIndex].forEach(Ze=>{Ze>=0&&(t.text.placedSymbolArray.get(Ze).hidden=Ve||Me?1:0)}),V.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(V.verticalPlacedTextSymbolIndex).hidden=Ve||$e?1:0);const ot=this.variableOffsets[V.crossTileID];ot&&this.markUsedJustification(t,ot.anchor,V,me);const Ut=this.placedOrientations[V.crossTileID];Ut&&(this.markUsedJustification(t,"left",V,Ut),this.markUsedOrientation(t,Ut,V))}if(fe){const De=Ri(oe.icon),Ve=!(B&&V.verticalPlacedIconSymbolIndex&&Me);V.placedIconSymbolIndex>=0&&(q(t.icon,V.numIconVertices,Ve?De:Sr),t.icon.placedSymbolArray.get(V.placedIconSymbolIndex).hidden=oe.icon.isHidden()),V.verticalPlacedIconSymbolIndex>=0&&(q(t.icon,V.numVerticalIconVertices,Ve?Sr:De),t.icon.placedSymbolArray.get(V.verticalPlacedIconSymbolIndex).hidden=oe.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const De=t.collisionArrays[H];if(De){let Ve=new s.P(0,0);if(De.textBox||De.verticalTextBox){let Ut=!0;if(C){const Ze=this.variableOffsets[J];Ze?(Ve=St(Ze.anchor,Ze.width,Ze.height,Ze.textOffset,Ze.textBoxScale),E&&Ve._rotate(P?this.transform.angle:-this.transform.angle)):Ut=!1}De.textBox&&Ye(t.textCollisionBox.collisionVertexArray,oe.text.placed,!Ut||Me,Ve.x,Ve.y),De.verticalTextBox&&Ye(t.textCollisionBox.collisionVertexArray,oe.text.placed,!Ut||$e,Ve.x,Ve.y)}const ot=!!(!$e&&De.verticalIconBox);De.iconBox&&Ye(t.iconCollisionBox.collisionVertexArray,oe.icon.placed,ot,B?Ve.x:0,B?Ve.y:0),De.verticalIconBox&&Ye(t.iconCollisionBox.collisionVertexArray,oe.icon.placed,!ot,B?Ve.x:0,B?Ve.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const H=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=H.invProjMatrix,t.placementViewportMatrix=H.viewportMatrix,t.collisionCircleArray=H.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,n){const o=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*o>t}setStale(){this.stale=!0}}function Ye(h,t,n,o,c){h.emplaceBack(t?1:0,n?1:0,o||0,c||0),h.emplaceBack(t?1:0,n?1:0,o||0,c||0),h.emplaceBack(t?1:0,n?1:0,o||0,c||0),h.emplaceBack(t?1:0,n?1:0,o||0,c||0)}const Et=Math.pow(2,25),Ft=Math.pow(2,24),Rt=Math.pow(2,17),Dt=Math.pow(2,16),Ni=Math.pow(2,9),ci=Math.pow(2,8),Li=Math.pow(2,1);function Ri(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;const t=h.placed?1:0,n=Math.floor(127*h.opacity);return n*Et+t*Ft+n*Rt+t*Dt+n*Ni+t*ci+n*Li+t}const Sr=0;class Ja{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,n,o,c,p){const _=this._bucketParts;for(;this._currentTileIndex<t.length;)if(n.getBucketParts(_,c,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,p())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,_.sort((y,x)=>y.sortKey-x.sortKey));this._currentPartIndex<_.length;)if(n.placeLayerBucketPart(_[this._currentPartIndex],this._seenCrossTileIDs,o),this._currentPartIndex++,p())return!0;return!1}}class En{constructor(t,n,o,c,p,_,y,x){this.placement=new Ke(t,n,_,y,x),this._currentPlacementIndex=o.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=p,this._done=!1}isDone(){return this._done}continuePlacement(t,n,o){const c=s.h.now(),p=()=>!this._forceFullPlacement&&s.h.now()-c>2;for(;this._currentPlacementIndex>=0;){const _=n[t[this._currentPlacementIndex]],y=this.placement.collisionIndex.transform.zoom;if(_.type==="symbol"&&(!_.minzoom||_.minzoom<=y)&&(!_.maxzoom||_.maxzoom>y)){if(this._inProgressLayer||(this._inProgressLayer=new Ja(_)),this._inProgressLayer.continuePlacement(o[_.source],this.placement,this._showCollisionBoxes,_,p))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Pn=512/s.N/2;class Ec{constructor(t,n,o){this.tileID=t,this.bucketInstanceId=o,this._symbolsByKey={};const c=new Map;for(let p=0;p<n.length;p++){const _=n.get(p),y=_.key,x=c.get(y);x?x.push(_):c.set(y,[_])}for(const[p,_]of c){const y={positions:_.map(x=>({x:Math.floor(x.anchorX*Pn),y:Math.floor(x.anchorY*Pn)})),crossTileIDs:_.map(x=>x.crossTileID)};if(y.positions.length>128){const x=new s.av(y.positions.length,16,Uint16Array);for(const{x:C,y:E}of y.positions)x.add(C,E);x.finish(),delete y.positions,y.index=x}this._symbolsByKey[p]=y}}getScaledCoordinates(t,n){const{x:o,y:c,z:p}=this.tileID.canonical,{x:_,y,z:x}=n.canonical,C=Pn/Math.pow(2,x-p),E=(y*s.N+t.anchorY)*C,P=c*s.N*Pn;return{x:Math.floor((_*s.N+t.anchorX)*C-o*s.N*Pn),y:Math.floor(E-P)}}findMatches(t,n,o){const c=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z);for(let p=0;p<t.length;p++){const _=t.get(p);if(_.crossTileID)continue;const y=this._symbolsByKey[_.key];if(!y)continue;const x=this.getScaledCoordinates(_,n);if(y.index){const C=y.index.range(x.x-c,x.y-c,x.x+c,x.y+c).sort();for(const E of C){const P=y.crossTileIDs[E];if(!o[P]){o[P]=!0,_.crossTileID=P;break}}}else if(y.positions)for(let C=0;C<y.positions.length;C++){const E=y.positions[C],P=y.crossTileIDs[C];if(Math.abs(E.x-x.x)<=c&&Math.abs(E.y-x.y)<=c&&!o[P]){o[P]=!0,_.crossTileID=P;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class ui{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Us{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const n=Math.round((t-this.lng)/360);if(n!==0)for(const o in this.indexes){const c=this.indexes[o],p={};for(const _ in c){const y=c[_];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+n),p[y.tileID.key]=y}this.indexes[o]=p}this.lng=t}addBucket(t,n,o){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let p=0;p<n.symbolInstances.length;p++)n.symbolInstances.get(p).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const c=this.usedCrossTileIDs[t.overscaledZ];for(const p in this.indexes){const _=this.indexes[p];if(Number(p)>t.overscaledZ)for(const y in _){const x=_[y];x.tileID.isChildOf(t)&&x.findMatches(n.symbolInstances,t,c)}else{const y=_[t.scaledTo(Number(p)).key];y&&y.findMatches(n.symbolInstances,t,c)}}for(let p=0;p<n.symbolInstances.length;p++){const _=n.symbolInstances.get(p);_.crossTileID||(_.crossTileID=o.generate(),c[_.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Ec(t,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(t,n){for(const o of n.getCrossTileIDsLists())for(const c of o)delete this.usedCrossTileIDs[t][c]}removeStaleBuckets(t){let n=!1;for(const o in this.indexes){const c=this.indexes[o];for(const p in c)t[c[p].bucketInstanceId]||(this.removeBucketCrossTileIDs(o,c[p]),delete c[p],n=!0)}return n}}class Qa{constructor(){this.layerIndexes={},this.crossTileIDs=new ui,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,n,o){let c=this.layerIndexes[t.id];c===void 0&&(c=this.layerIndexes[t.id]=new Us);let p=!1;const _={};c.handleWrapJump(o);for(const y of n){const x=y.getBucket(t);x&&t.id===x.layerIds[0]&&(x.bucketInstanceId||(x.bucketInstanceId=++this.maxBucketInstanceId),c.addBucket(y.tileID,x,this.crossTileIDs)&&(p=!0),_[x.bucketInstanceId]=!0)}return c.removeStaleBuckets(_)&&(p=!0),p}pruneUnusedLayers(t){const n={};t.forEach(o=>{n[o]=!0});for(const o in this.layerIndexes)n[o]||delete this.layerIndexes[o]}}const hr=(h,t)=>s.x(h,t&&t.filter(n=>n.identifier!=="source.canvas")),zr=s.F(s.ax,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),Pc=s.F(s.ax,["setCenter","setZoom","setBearing","setPitch"]),Gr=s.aw();class or extends s.E{constructor(t,n={}){super(),this.map=t,this.dispatcher=new Gt(sn(),this,t._getMapId()),this.imageManager=new We,this.imageManager.setEventedParent(this),this.glyphManager=new Ct(t._requestManager,n.localIdeographFontFamily),this.lineAtlas=new Qt(256,512),this.crossTileSymbolIndex=new Qa,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new s.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.az());const o=this;this._rtlTextPluginCallback=or.registerForPluginStateChange(c=>{o.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:c.pluginStatus,pluginURL:c.pluginURL},(p,_)=>{if(s.aA(p),_&&_.every(y=>y))for(const y in o.sourceCaches){const x=o.sourceCaches[y].getSource().type;x!=="vector"&&x!=="geojson"||o.sourceCaches[y].reload()}})}),this.on("data",c=>{if(c.dataType!=="source"||c.sourceDataType!=="metadata")return;const p=this.sourceCaches[c.sourceId];if(!p)return;const _=p.getSource();if(_&&_.vectorLayerIds)for(const y in this._layers){const x=this._layers[y];x.source===_.id&&this._validateLayer(x)}})}loadURL(t,n={},o){this.fire(new s.k("dataloading",{dataType:"style"})),n.validate=typeof n.validate!="boolean"||n.validate;const c=this.map._requestManager.transformRequest(t,ve.Style);this._request=s.f(c,(p,_)=>{this._request=null,p?this.fire(new s.j(p)):_&&this._load(_,n,o)})}loadJSON(t,n={},o){this.fire(new s.k("dataloading",{dataType:"style"})),this._request=s.h.frame(()=>{this._request=null,n.validate=n.validate!==!1,this._load(t,n,o)})}loadEmpty(){this.fire(new s.k("dataloading",{dataType:"style"})),this._load(Gr,{validate:!1})}_load(t,n,o){var c;const p=n.transformStyle?n.transformStyle(o,t):t;if(!n.validate||!hr(this,s.y(p))){this._loaded=!0,this.stylesheet=p;for(const _ in p.sources)this.addSource(_,p.sources[_],{validate:!1});p.sprite?this._loadSprite(p.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(p.glyphs),this._createLayers(),this.light=new At(this.stylesheet.light),this.map.setTerrain((c=this.stylesheet.terrain)!==null&&c!==void 0?c:null),this.fire(new s.k("data",{dataType:"style"})),this.fire(new s.k("style.load"))}}_createLayers(){const t=s.aB(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",t),this._order=t.map(n=>n.id),this._layers={},this._serializedLayers=null;for(const n of t){const o=s.aC(n);o.setEventedParent(this,{layer:{id:n.id}}),this._layers[n.id]=o}}_loadSprite(t,n=!1,o=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(c,p,_,y){const x=Fe(c),C=x.length,E=_>1?"@2x":"",P={},B={},G={};for(const{id:q,url:H}of x){const V=p.transformRequest(p.normalizeSpriteURL(H,E,".json"),ve.SpriteJSON),ae=`${q}_${V.url}`;P[ae]=s.f(V,(oe,fe)=>{delete P[ae],B[q]=fe,Le(y,B,G,oe,C)});const de=p.transformRequest(p.normalizeSpriteURL(H,E,".png"),ve.SpriteImage),J=`${q}_${de.url}`;P[J]=Se.getImage(de,(oe,fe)=>{delete P[J],G[q]=fe,Le(y,B,G,oe,C)})}return{cancel(){for(const q of Object.values(P))q.cancel()}}}(t,this.map._requestManager,this.map.getPixelRatio(),(c,p)=>{if(this._spriteRequest=null,c)this.fire(new s.j(c));else if(p)for(const _ in p){this._spritesImagesIds[_]=[];const y=this._spritesImagesIds[_]?this._spritesImagesIds[_].filter(x=>!(x in p)):[];for(const x of y)this.imageManager.removeImage(x),this._changedImages[x]=!0;for(const x in p[_]){const C=_==="default"?x:`${_}:${x}`;this._spritesImagesIds[_].push(C),C in this.imageManager.images?this.imageManager.updateImage(C,p[_][x],!1):this.imageManager.addImage(C,p[_][x]),n&&(this._changedImages[C]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),n&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"})),o&&o(c)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}_validateLayer(t){const n=this.sourceCaches[t.source];if(!n)return;const o=t.sourceLayer;if(!o)return;const c=n.getSource();(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(o)===-1)&&this.fire(new s.j(new Error(`Source layer "${o}" does not exist on source "${c.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t){const n=this._serializedAllLayers();if(!t||t.length===0)return Object.values(n);const o=[];for(const c of t)n[c]&&o.push(n[c]);return o}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const n=Object.keys(this._layers);for(const o of n){const c=this._layers[o];c.type!=="custom"&&(t[o]=c.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const n=this._changed;if(this._changed){const c=Object.keys(this._updatedLayers),p=Object.keys(this._removedLayers);(c.length||p.length)&&this._updateWorkerLayers(c,p);for(const _ in this._updatedSources){const y=this._updatedSources[_];if(y==="reload")this._reloadSource(_);else{if(y!=="clear")throw new Error(`Invalid action ${y}`);this._clearSource(_)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const _ in this._updatedPaintProps)this._layers[_].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const o={};for(const c in this.sourceCaches){const p=this.sourceCaches[c];o[c]=p.used,p.used=!1}for(const c of this._order){const p=this._layers[c];p.recalculate(t,this._availableImages),!p.isHidden(t.zoom)&&p.source&&(this.sourceCaches[p.source].used=!0)}for(const c in o){const p=this.sourceCaches[c];o[c]!==p.used&&p.fire(new s.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:c}))}this.light.recalculate(t),this.z=t.zoom,n&&this.fire(new s.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const n in this.sourceCaches)this.sourceCaches[n].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,n){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(t),removedIds:n})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,n={}){this._checkLoaded();const o=this.serialize();if(t=n.transformStyle?n.transformStyle(o,t):t,hr(this,s.y(t)))return!1;(t=s.aD(t)).layers=s.aB(t.layers);const c=s.aE(o,t).filter(_=>!(_.command in Pc));if(c.length===0)return!1;const p=c.filter(_=>!(_.command in zr));if(p.length>0)throw new Error(`Unimplemented: ${p.map(_=>_.command).join(", ")}.`);for(const _ of c)_.command!=="setTransition"&&this[_.command].apply(this,_.args);return this.stylesheet=t,this._serializedLayers=null,!0}addImage(t,n){if(this.getImage(t))return this.fire(new s.j(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,n),this._afterImageUpdated(t)}updateImage(t,n){this.imageManager.updateImage(t,n)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new s.j(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,n,o={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(s.y.source,`sources.${t}`,n,null,o))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const c=this.sourceCaches[t]=new bi(t,n,this.dispatcher);c.style=this,c.setEventedParent(this,()=>({isSourceLoaded:c.loaded(),source:c.serialize(),sourceId:t})),c.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const o in this._layers)if(this._layers[o].source===t)return this.fire(new s.j(new Error(`Source "${t}" cannot be removed while layer "${o}" is using it.`)));const n=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],n.fire(new s.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),n.setEventedParent(null),n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,n){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const o=this.sourceCaches[t].getSource();if(o.type!=="geojson")throw new Error(`geojsonSource.type is ${o.type}, which is !== 'geojson`);o.setData(n),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,n,o={}){this._checkLoaded();const c=t.id;if(this.getLayer(c))return void this.fire(new s.j(new Error(`Layer "${c}" already exists on this map.`)));let p;if(t.type==="custom"){if(hr(this,s.aF(t)))return;p=s.aC(t)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(c,t.source),t=s.aD(t),t=s.e(t,{source:c})),this._validate(s.y.layer,`layers.${c}`,t,{arrayIndex:-1},o))return;p=s.aC(t),this._validateLayer(p),p.setEventedParent(this,{layer:{id:c}})}const _=n?this._order.indexOf(n):this._order.length;if(n&&_===-1)this.fire(new s.j(new Error(`Cannot add layer "${c}" before non-existing layer "${n}".`)));else{if(this._order.splice(_,0,c),this._layerOrderChanged=!0,this._layers[c]=p,this._removedLayers[c]&&p.source&&p.type!=="custom"){const y=this._removedLayers[c];delete this._removedLayers[c],y.type!==p.type?this._updatedSources[p.source]="clear":(this._updatedSources[p.source]="reload",this.sourceCaches[p.source].pause())}this._updateLayer(p),p.onAdd&&p.onAdd(this.map)}}moveLayer(t,n){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new s.j(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===n)return;const o=this._order.indexOf(t);this._order.splice(o,1);const c=n?this._order.indexOf(n):this._order.length;n&&c===-1?this.fire(new s.j(new Error(`Cannot move layer "${t}" before non-existing layer "${n}".`))):(this._order.splice(c,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const n=this._layers[t];if(!n)return void this.fire(new s.j(new Error(`Cannot remove non-existing layer "${t}".`)));n.setEventedParent(null);const o=this._order.indexOf(t);this._order.splice(o,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=n,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],n.onRemove&&n.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,n,o){this._checkLoaded();const c=this.getLayer(t);c?c.minzoom===n&&c.maxzoom===o||(n!=null&&(c.minzoom=n),o!=null&&(c.maxzoom=o),this._updateLayer(c)):this.fire(new s.j(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,n,o={}){this._checkLoaded();const c=this.getLayer(t);if(c){if(!s.aG(c.filter,n))return n==null?(c.filter=void 0,void this._updateLayer(c)):void(this._validate(s.y.filter,`layers.${c.id}.filter`,n,null,o)||(c.filter=s.aD(n),this._updateLayer(c)))}else this.fire(new s.j(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return s.aD(this.getLayer(t).filter)}setLayoutProperty(t,n,o,c={}){this._checkLoaded();const p=this.getLayer(t);p?s.aG(p.getLayoutProperty(n),o)||(p.setLayoutProperty(n,o,c),this._updateLayer(p)):this.fire(new s.j(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,n){const o=this.getLayer(t);if(o)return o.getLayoutProperty(n);this.fire(new s.j(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,n,o,c={}){this._checkLoaded();const p=this.getLayer(t);p?s.aG(p.getPaintProperty(n),o)||(p.setPaintProperty(n,o,c)&&this._updateLayer(p),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new s.j(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,n){return this.getLayer(t).getPaintProperty(n)}setFeatureState(t,n){this._checkLoaded();const o=t.source,c=t.sourceLayer,p=this.sourceCaches[o];if(p===void 0)return void this.fire(new s.j(new Error(`The source '${o}' does not exist in the map's style.`)));const _=p.getSource().type;_==="geojson"&&c?this.fire(new s.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):_!=="vector"||c?(t.id===void 0&&this.fire(new s.j(new Error("The feature id parameter must be provided."))),p.setFeatureState(c,t.id,n)):this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,n){this._checkLoaded();const o=t.source,c=this.sourceCaches[o];if(c===void 0)return void this.fire(new s.j(new Error(`The source '${o}' does not exist in the map's style.`)));const p=c.getSource().type,_=p==="vector"?t.sourceLayer:void 0;p!=="vector"||_?n&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new s.j(new Error("A feature id is required to remove its specific state property."))):c.removeFeatureState(_,t.id,n):this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const n=t.source,o=t.sourceLayer,c=this.sourceCaches[n];if(c!==void 0)return c.getSource().type!=="vector"||o?(t.id===void 0&&this.fire(new s.j(new Error("The feature id parameter must be provided."))),c.getFeatureState(o,t.id)):void this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new s.j(new Error(`The source '${n}' does not exist in the map's style.`)))}getTransition(){return s.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=s.aH(this.sourceCaches,p=>p.serialize()),n=this._serializeByIds(this._order),o=this.map.getTerrain()||void 0,c=this.stylesheet;return s.aI({version:c.version,name:c.name,metadata:c.metadata,light:c.light,center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch,sprite:c.sprite,glyphs:c.glyphs,transition:c.transition,sources:t,layers:n,terrain:o},p=>p!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const n=_=>this._layers[_].type==="fill-extrusion",o={},c=[];for(let _=this._order.length-1;_>=0;_--){const y=this._order[_];if(n(y)){o[y]=_;for(const x of t){const C=x[y];if(C)for(const E of C)c.push(E)}}}c.sort((_,y)=>y.intersectionZ-_.intersectionZ);const p=[];for(let _=this._order.length-1;_>=0;_--){const y=this._order[_];if(n(y))for(let x=c.length-1;x>=0;x--){const C=c[x].feature;if(o[C.layer.id]<_)break;p.push(C),c.pop()}else for(const x of t){const C=x[y];if(C)for(const E of C)p.push(E.feature)}}return p}queryRenderedFeatures(t,n,o){n&&n.filter&&this._validate(s.y.filter,"queryRenderedFeatures.filter",n.filter,null,n);const c={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new s.j(new Error("parameters.layers must be an Array."))),[];for(const y of n.layers){const x=this._layers[y];if(!x)return this.fire(new s.j(new Error(`The layer '${y}' does not exist in the map's style and cannot be queried for features.`))),[];c[x.source]=!0}}const p=[];n.availableImages=this._availableImages;const _=this._serializedAllLayers();for(const y in this.sourceCaches)n.layers&&!c[y]||p.push(Ht(this.sourceCaches[y],this._layers,_,t,n,o));return this.placement&&p.push(function(y,x,C,E,P,B,G){const q={},H=B.queryRenderedSymbols(E),V=[];for(const ae of Object.keys(H).map(Number))V.push(G[ae]);V.sort(Mi);for(const ae of V){const de=ae.featureIndex.lookupSymbolFeatures(H[ae.bucketInstanceId],x,ae.bucketIndex,ae.sourceLayerIndex,P.filter,P.layers,P.availableImages,y);for(const J in de){const oe=q[J]=q[J]||[],fe=de[J];fe.sort((me,Me)=>{const $e=ae.featureSortOrder;if($e){const De=$e.indexOf(me.featureIndex);return $e.indexOf(Me.featureIndex)-De}return Me.featureIndex-me.featureIndex});for(const me of fe)oe.push(me)}}for(const ae in q)q[ae].forEach(de=>{const J=de.feature,oe=C[y[ae].source].getFeatureState(J.layer["source-layer"],J.id);J.source=J.layer.source,J.layer["source-layer"]&&(J.sourceLayer=J.layer["source-layer"]),J.state=oe});return q}(this._layers,_,this.sourceCaches,t,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(p)}querySourceFeatures(t,n){n&&n.filter&&this._validate(s.y.filter,"querySourceFeatures.filter",n.filter,null,n);const o=this.sourceCaches[t];return o?function(c,p){const _=c.getRenderableIds().map(C=>c.getTileByID(C)),y=[],x={};for(let C=0;C<_.length;C++){const E=_[C],P=E.tileID.canonical.key;x[P]||(x[P]=!0,E.querySourceFeatures(y,p))}return y}(o,n):[]}addSourceType(t,n,o){return li(t)?o(new Error(`A source type called "${t}" already exists.`)):(((c,p)=>{Pt[c]=p})(t,n),n.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:n.workerSourceURL},o):o(null,null))}getLight(){return this.light.getLight()}setLight(t,n={}){this._checkLoaded();const o=this.light.getLight();let c=!1;for(const _ in t)if(!s.aG(t[_],o[_])){c=!0;break}if(!c)return;const p={now:s.h.now(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,n),this.light.updateTransitions(p)}_validate(t,n,o,c,p={}){return(!p||p.validate!==!1)&&hr(this,t.call(s.y,s.e({key:n,style:this.serialize(),value:o,styleSpec:s.v},c)))}_remove(t=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.aJ.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this.sourceCaches){const o=this.sourceCaches[n];o.setEventedParent(null),o.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const n in this.sourceCaches)this.sourceCaches[n].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,n,o,c,p=!1){let _=!1,y=!1;const x={};for(const C of this._order){const E=this._layers[C];if(E.type!=="symbol")continue;if(!x[E.source]){const B=this.sourceCaches[E.source];x[E.source]=B.getRenderableIds(!0).map(G=>B.getTileByID(G)).sort((G,q)=>q.tileID.overscaledZ-G.tileID.overscaledZ||(G.tileID.isLessThan(q.tileID)?-1:1))}const P=this.crossTileSymbolIndex.addLayer(E,x[E.source],t.center.lng);_=_||P}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((p=p||this._layerOrderChanged||o===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.h.now(),t.zoom))&&(this.pauseablePlacement=new En(t,this.map.terrain,this._order,p,n,o,c,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,x),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.h.now()),y=!0),_&&this.pauseablePlacement.placement.setStale()),y||_)for(const C of this._order){const E=this._layers[C];E.type==="symbol"&&this.placement.updateLayerOpacities(E,x[E.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.h.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,n,o){this.imageManager.getImages(n.icons,o),this._updateTilesForChangedImages();const c=this.sourceCaches[n.source];c&&c.setDependencies(n.tileID.key,n.type,n.icons)}getGlyphs(t,n,o){this.glyphManager.getGlyphs(n.stacks,o);const c=this.sourceCaches[n.source];c&&c.setDependencies(n.tileID.key,n.type,[""])}getResource(t,n,o){return s.m(n,o)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,n={}){this._checkLoaded(),t&&this._validate(s.y.glyphs,"glyphs",t,null,n)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,n,o={},c){this._checkLoaded();const p=[{id:t,url:n}],_=[...Fe(this.stylesheet.sprite),...p];this._validate(s.y.sprite,"sprite",_,null,o)||(this.stylesheet.sprite=_,this._loadSprite(p,!0,c))}removeSprite(t){this._checkLoaded();const n=Fe(this.stylesheet.sprite);if(n.find(o=>o.id===t)){if(this._spritesImagesIds[t])for(const o of this._spritesImagesIds[t])this.imageManager.removeImage(o),this._changedImages[o]=!0;n.splice(n.findIndex(o=>o.id===t),1),this.stylesheet.sprite=n.length>0?n:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}else this.fire(new s.j(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return Fe(this.stylesheet.sprite)}setSprite(t,n={},o){this._checkLoaded(),t&&this._validate(s.y.sprite,"sprite",t,null,n)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,o):(this._unloadSprite(),o&&o(null)))}}or.registerForPluginStateChange=s.aK;var es=s.Q([{name:"a_pos",type:"Int16",components:2}]),aa="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const Ti={prelude:ni(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:ni(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:ni(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:ni(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:ni("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ni(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:ni(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:ni("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ni("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:ni("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:ni(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:ni(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:ni(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:ni(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:ni(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:ni(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:ni(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ni(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:ni(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:ni(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:ni(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:ni(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:ni(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:ni(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:ni(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:ni(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:ni("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",aa),terrainDepth:ni("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",aa),terrainCoords:ni("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",aa)};function ni(h,t){const n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,o=t.match(/attribute ([\w]+) ([\w]+)/g),c=h.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),p=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),_=p?p.concat(c):c,y={};return{fragmentSource:h=h.replace(n,(x,C,E,P,B)=>(y[B]=!0,C==="define"?`
#ifndef HAS_UNIFORM_u_${B}
varying ${E} ${P} ${B};
#else
uniform ${E} ${P} u_${B};
#endif
`:`
#ifdef HAS_UNIFORM_u_${B}
    ${E} ${P} ${B} = u_${B};
#endif
`)),vertexSource:t=t.replace(n,(x,C,E,P,B)=>{const G=P==="float"?"vec2":"vec4",q=B.match(/color/)?"color":G;return y[B]?C==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
attribute ${E} ${G} a_${B};
varying ${E} ${P} ${B};
#else
uniform ${E} ${P} u_${B};
#endif
`:q==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = a_${B};
#else
    ${E} ${P} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = unpack_mix_${q}(a_${B}, u_${B}_t);
#else
    ${E} ${P} ${B} = u_${B};
#endif
`:C==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
attribute ${E} ${G} a_${B};
#else
uniform ${E} ${P} u_${B};
#endif
`:q==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${E} ${P} ${B} = a_${B};
#else
    ${E} ${P} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${E} ${P} ${B} = unpack_mix_${q}(a_${B}, u_${B}_t);
#else
    ${E} ${P} ${B} = u_${B};
#endif
`}),staticAttributes:o,staticUniforms:_}}class Vn{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,n,o,c,p,_,y,x,C){this.context=t;let E=this.boundPaintVertexBuffers.length!==c.length;for(let P=0;!E&&P<c.length;P++)this.boundPaintVertexBuffers[P]!==c[P]&&(E=!0);!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==o||E||this.boundIndexBuffer!==p||this.boundVertexOffset!==_||this.boundDynamicVertexBuffer!==y||this.boundDynamicVertexBuffer2!==x||this.boundDynamicVertexBuffer3!==C?this.freshBind(n,o,c,p,_,y,x,C):(t.bindVertexArray.set(this.vao),y&&y.bind(),p&&p.dynamicDraw&&p.bind(),x&&x.bind(),C&&C.bind())}freshBind(t,n,o,c,p,_,y,x){const C=t.numAttributes,E=this.context,P=E.gl;this.vao&&this.destroy(),this.vao=E.createVertexArray(),E.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=o,this.boundIndexBuffer=c,this.boundVertexOffset=p,this.boundDynamicVertexBuffer=_,this.boundDynamicVertexBuffer2=y,this.boundDynamicVertexBuffer3=x,n.enableAttributes(P,t);for(const B of o)B.enableAttributes(P,t);_&&_.enableAttributes(P,t),y&&y.enableAttributes(P,t),x&&x.enableAttributes(P,t),n.bind(),n.setVertexAttribPointers(P,t,p);for(const B of o)B.bind(),B.setVertexAttribPointers(P,t,p);_&&(_.bind(),_.setVertexAttribPointers(P,t,p)),c&&c.bind(),y&&(y.bind(),y.setVertexAttribPointers(P,t,p)),x&&(x.bind(),x.setVertexAttribPointers(P,t,p)),E.currentNumAttributes=C}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Ai(h){const t=[];for(let n=0;n<h.length;n++){if(h[n]===null)continue;const o=h[n].split(" ");t.push(o.pop())}return t}class ts{constructor(t,n,o,c,p,_){const y=t.gl;this.program=y.createProgram();const x=Ai(n.staticAttributes),C=o?o.getBinderAttributes():[],E=x.concat(C),P=Ti.prelude.staticUniforms?Ai(Ti.prelude.staticUniforms):[],B=n.staticUniforms?Ai(n.staticUniforms):[],G=o?o.getBinderUniforms():[],q=P.concat(B).concat(G),H=[];for(const me of q)H.indexOf(me)<0&&H.push(me);const V=o?o.defines():[];p&&V.push("#define OVERDRAW_INSPECTOR;"),_&&V.push("#define TERRAIN3D;");const ae=V.concat(Ti.prelude.fragmentSource,n.fragmentSource).join(`
`),de=V.concat(Ti.prelude.vertexSource,n.vertexSource).join(`
`),J=y.createShader(y.FRAGMENT_SHADER);if(y.isContextLost())return void(this.failedToCreate=!0);if(y.shaderSource(J,ae),y.compileShader(J),!y.getShaderParameter(J,y.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${y.getShaderInfoLog(J)}`);y.attachShader(this.program,J);const oe=y.createShader(y.VERTEX_SHADER);if(y.isContextLost())return void(this.failedToCreate=!0);if(y.shaderSource(oe,de),y.compileShader(oe),!y.getShaderParameter(oe,y.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${y.getShaderInfoLog(oe)}`);y.attachShader(this.program,oe),this.attributes={};const fe={};this.numAttributes=E.length;for(let me=0;me<this.numAttributes;me++)E[me]&&(y.bindAttribLocation(this.program,me,E[me]),this.attributes[E[me]]=me);if(y.linkProgram(this.program),!y.getProgramParameter(this.program,y.LINK_STATUS))throw new Error(`Program failed to link: ${y.getProgramInfoLog(this.program)}`);y.deleteShader(oe),y.deleteShader(J);for(let me=0;me<H.length;me++){const Me=H[me];if(Me&&!fe[Me]){const $e=y.getUniformLocation(this.program,Me);$e&&(fe[Me]=$e)}}this.fixedUniforms=c(t,fe),this.terrainUniforms=((me,Me)=>({u_depth:new s.aL(me,Me.u_depth),u_terrain:new s.aL(me,Me.u_terrain),u_terrain_dim:new s.aM(me,Me.u_terrain_dim),u_terrain_matrix:new s.aN(me,Me.u_terrain_matrix),u_terrain_unpack:new s.aO(me,Me.u_terrain_unpack),u_terrain_exaggeration:new s.aM(me,Me.u_terrain_exaggeration)}))(t,fe),this.binderUniforms=o?o.getUniforms(t,fe):[]}draw(t,n,o,c,p,_,y,x,C,E,P,B,G,q,H,V,ae,de){const J=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(o),t.setStencilMode(c),t.setColorMode(p),t.setCullFace(_),x){t.activeTexture.set(J.TEXTURE2),J.bindTexture(J.TEXTURE_2D,x.depthTexture),t.activeTexture.set(J.TEXTURE3),J.bindTexture(J.TEXTURE_2D,x.texture);for(const fe in this.terrainUniforms)this.terrainUniforms[fe].set(x[fe])}for(const fe in this.fixedUniforms)this.fixedUniforms[fe].set(y[fe]);H&&H.setUniforms(t,this.binderUniforms,G,{zoom:q});let oe=0;switch(n){case J.LINES:oe=2;break;case J.TRIANGLES:oe=3;break;case J.LINE_STRIP:oe=1}for(const fe of B.get()){const me=fe.vaos||(fe.vaos={});(me[C]||(me[C]=new Vn)).bind(t,this,E,H?H.getPaintVertexBuffers():[],P,fe.vertexOffset,V,ae,de),J.drawElements(n,fe.primitiveLength*oe,J.UNSIGNED_SHORT,fe.primitiveOffset*oe*2)}}}function Zr(h,t,n){const o=1/re(n,1,t.transform.tileZoom),c=Math.pow(2,n.tileID.overscaledZ),p=n.tileSize*Math.pow(2,t.transform.tileZoom)/c,_=p*(n.tileID.canonical.x+n.tileID.wrap*c),y=p*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[o,h.fromScale,h.toScale],u_fade:h.t,u_pixel_coord_upper:[_>>16,y>>16],u_pixel_coord_lower:[65535&_,65535&y]}}const qs=(h,t,n,o)=>{const c=t.style.light,p=c.properties.get("position"),_=[p.x,p.y,p.z],y=function(){var C=new s.A(9);return s.A!=Float32Array&&(C[1]=0,C[2]=0,C[3]=0,C[5]=0,C[6]=0,C[7]=0),C[0]=1,C[4]=1,C[8]=1,C}();c.properties.get("anchor")==="viewport"&&function(C,E){var P=Math.sin(E),B=Math.cos(E);C[0]=B,C[1]=P,C[2]=0,C[3]=-P,C[4]=B,C[5]=0,C[6]=0,C[7]=0,C[8]=1}(y,-t.transform.angle),function(C,E,P){var B=E[0],G=E[1],q=E[2];C[0]=B*P[0]+G*P[3]+q*P[6],C[1]=B*P[1]+G*P[4]+q*P[7],C[2]=B*P[2]+G*P[5]+q*P[8]}(_,_,y);const x=c.properties.get("color");return{u_matrix:h,u_lightpos:_,u_lightintensity:c.properties.get("intensity"),u_lightcolor:[x.r,x.g,x.b],u_vertical_gradient:+n,u_opacity:o}},Mn=(h,t,n,o,c,p,_)=>s.e(qs(h,t,n,o),Zr(p,t,_),{u_height_factor:-Math.pow(2,c.overscaledZ)/_.tileSize/8}),cl=h=>({u_matrix:h}),Gs=(h,t,n,o)=>s.e(cl(h),Zr(n,t,o)),is=(h,t)=>({u_matrix:h,u_world:t}),rs=(h,t,n,o,c)=>s.e(Gs(h,t,n,o),{u_world:c}),An=(h,t,n,o)=>{const c=h.transform;let p,_;if(o.paint.get("circle-pitch-alignment")==="map"){const y=re(n,1,c.zoom);p=!0,_=[y,y]}else p=!1,_=c.pixelsToGLUnits;return{u_camera_to_center_distance:c.cameraToCenterDistance,u_scale_with_map:+(o.paint.get("circle-pitch-scale")==="map"),u_matrix:h.translatePosMatrix(t.posMatrix,n,o.paint.get("circle-translate"),o.paint.get("circle-translate-anchor")),u_pitch_with_map:+p,u_device_pixel_ratio:h.pixelRatio,u_extrude_scale:_}},Zs=(h,t,n)=>{const o=re(n,1,t.zoom),c=Math.pow(2,t.zoom-n.tileID.overscaledZ),p=n.tileID.overscaleFactor();return{u_matrix:h,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:o,u_extrude_scale:[t.pixelsToGLUnits[0]/(o*c),t.pixelsToGLUnits[1]/(o*c)],u_overscale_factor:p}},Ea=(h,t,n=1)=>({u_matrix:h,u_color:t,u_overlay:0,u_overlay_scale:n}),ul=h=>({u_matrix:h}),Mc=(h,t,n,o)=>({u_matrix:h,u_extrude_scale:re(t,1,n),u_intensity:o});function Hs(h,t){const n=Math.pow(2,t.canonical.z),o=t.canonical.y;return[new s.U(0,o/n).toLngLat().lat,new s.U(0,(o+1)/n).toLngLat().lat]}const Ws=(h,t,n,o)=>{const c=h.transform;return{u_matrix:ns(h,t,n,o),u_ratio:1/re(t,1,c.zoom),u_device_pixel_ratio:h.pixelRatio,u_units_to_pixels:[1/c.pixelsToGLUnits[0],1/c.pixelsToGLUnits[1]]}},hl=(h,t,n,o,c)=>s.e(Ws(h,t,n,c),{u_image:0,u_image_height:o}),Ac=(h,t,n,o,c)=>{const p=h.transform,_=pl(t,p);return{u_matrix:ns(h,t,n,c),u_texsize:t.imageAtlasTexture.size,u_ratio:1/re(t,1,p.zoom),u_device_pixel_ratio:h.pixelRatio,u_image:0,u_scale:[_,o.fromScale,o.toScale],u_fade:o.t,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},dl=(h,t,n,o,c,p)=>{const _=h.lineAtlas,y=pl(t,h.transform),x=n.layout.get("line-cap")==="round",C=_.getDash(o.from,x),E=_.getDash(o.to,x),P=C.width*c.fromScale,B=E.width*c.toScale;return s.e(Ws(h,t,n,p),{u_patternscale_a:[y/P,-C.height/2],u_patternscale_b:[y/B,-E.height/2],u_sdfgamma:_.width/(256*Math.min(P,B)*h.pixelRatio)/2,u_image:0,u_tex_y_a:C.y,u_tex_y_b:E.y,u_mix:c.t})};function pl(h,t){return 1/re(h,1,t.tileZoom)}function ns(h,t,n,o){return h.translatePosMatrix(o?o.posMatrix:t.tileID.posMatrix,t,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const fl=(h,t,n,o,c)=>{return{u_matrix:h,u_tl_parent:t,u_scale_parent:n,u_buffer_scale:1,u_fade_t:o.mix,u_opacity:o.opacity*c.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:c.paint.get("raster-brightness-min"),u_brightness_high:c.paint.get("raster-brightness-max"),u_saturation_factor:(_=c.paint.get("raster-saturation"),_>0?1-1/(1.001-_):-_),u_contrast_factor:(p=c.paint.get("raster-contrast"),p>0?1/(1-p):1+p),u_spin_weights:ml(c.paint.get("raster-hue-rotate"))};var p,_};function ml(h){h*=Math.PI/180;const t=Math.sin(h),n=Math.cos(h);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}const Xs=(h,t,n,o,c,p,_,y,x,C)=>{const E=c.transform;return{u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:E.cameraToCenterDistance,u_pitch:E.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:E.width/E.height,u_fade_change:c.options.fadeDuration?c.symbolFadeChange:1,u_matrix:p,u_label_plane_matrix:_,u_coord_matrix:y,u_is_text:+x,u_pitch_with_map:+o,u_texsize:C,u_texture:0}},Ks=(h,t,n,o,c,p,_,y,x,C,E)=>{const P=c.transform;return s.e(Xs(h,t,n,o,c,p,_,y,x,C),{u_gamma_scale:o?Math.cos(P._pitch)*P.cameraToCenterDistance:1,u_device_pixel_ratio:c.pixelRatio,u_is_halo:+E})},Un=(h,t,n,o,c,p,_,y,x,C)=>s.e(Ks(h,t,n,o,c,p,_,y,!0,x,!0),{u_texsize_icon:C,u_texture_icon:1}),as=(h,t,n)=>({u_matrix:h,u_opacity:t,u_color:n}),Hr=(h,t,n,o,c,p)=>s.e(function(_,y,x,C){const E=x.imageManager.getPattern(_.from.toString()),P=x.imageManager.getPattern(_.to.toString()),{width:B,height:G}=x.imageManager.getPixelSize(),q=Math.pow(2,C.tileID.overscaledZ),H=C.tileSize*Math.pow(2,x.transform.tileZoom)/q,V=H*(C.tileID.canonical.x+C.tileID.wrap*q),ae=H*C.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:E.tl,u_pattern_br_a:E.br,u_pattern_tl_b:P.tl,u_pattern_br_b:P.br,u_texsize:[B,G],u_mix:y.t,u_pattern_size_a:E.displaySize,u_pattern_size_b:P.displaySize,u_scale_a:y.fromScale,u_scale_b:y.toScale,u_tile_units_to_pixels:1/re(C,1,x.transform.tileZoom),u_pixel_coord_upper:[V>>16,ae>>16],u_pixel_coord_lower:[65535&V,65535&ae]}}(o,p,n,c),{u_matrix:h,u_opacity:t}),ss={fillExtrusion:(h,t)=>({u_matrix:new s.aN(h,t.u_matrix),u_lightpos:new s.aP(h,t.u_lightpos),u_lightintensity:new s.aM(h,t.u_lightintensity),u_lightcolor:new s.aP(h,t.u_lightcolor),u_vertical_gradient:new s.aM(h,t.u_vertical_gradient),u_opacity:new s.aM(h,t.u_opacity)}),fillExtrusionPattern:(h,t)=>({u_matrix:new s.aN(h,t.u_matrix),u_lightpos:new s.aP(h,t.u_lightpos),u_lightintensity:new s.aM(h,t.u_lightintensity),u_lightcolor:new s.aP(h,t.u_lightcolor),u_vertical_gradient:new s.aM(h,t.u_vertical_gradient),u_height_factor:new s.aM(h,t.u_height_factor),u_image:new s.aL(h,t.u_image),u_texsize:new s.aQ(h,t.u_texsize),u_pixel_coord_upper:new s.aQ(h,t.u_pixel_coord_upper),u_pixel_coord_lower:new s.aQ(h,t.u_pixel_coord_lower),u_scale:new s.aP(h,t.u_scale),u_fade:new s.aM(h,t.u_fade),u_opacity:new s.aM(h,t.u_opacity)}),fill:(h,t)=>({u_matrix:new s.aN(h,t.u_matrix)}),fillPattern:(h,t)=>({u_matrix:new s.aN(h,t.u_matrix),u_image:new s.aL(h,t.u_image),u_texsize:new s.aQ(h,t.u_texsize),u_pixel_coord_upper:new s.aQ(h,t.u_pixel_coord_upper),u_pixel_coord_lower:new s.aQ(h,t.u_pixel_coord_lower),u_scale:new s.aP(h,t.u_scale),u_fade:new s.aM(h,t.u_fade)}),fillOutline:(h,t)=>({u_matrix:new s.aN(h,t.u_matrix),u_world:new s.aQ(h,t.u_world)}),fillOutlinePattern:(h,t)=>({u_matrix:new s.aN(h,t.u_matrix),u_world:new s.aQ(h,t.u_world),u_image:new s.aL(h,t.u_image),u_texsize:new s.aQ(h,t.u_texsize),u_pixel_coord_upper:new s.aQ(h,t.u_pixel_coord_upper),u_pixel_coord_lower:new s.aQ(h,t.u_pixel_coord_lower),u_scale:new s.aP(h,t.u_scale),u_fade:new s.aM(h,t.u_fade)}),circle:(h,t)=>({u_camera_to_center_distance:new s.aM(h,t.u_camera_to_center_distance),u_scale_with_map:new s.aL(h,t.u_scale_with_map),u_pitch_with_map:new s.aL(h,t.u_pitch_with_map),u_extrude_scale:new s.aQ(h,t.u_extrude_scale),u_device_pixel_ratio:new s.aM(h,t.u_device_pixel_ratio),u_matrix:new s.aN(h,t.u_matrix)}),collisionBox:(h,t)=>({u_matrix:new s.aN(h,t.u_matrix),u_camera_to_center_distance:new s.aM(h,t.u_camera_to_center_distance),u_pixels_to_tile_units:new s.aM(h,t.u_pixels_to_tile_units),u_extrude_scale:new s.aQ(h,t.u_extrude_scale),u_overscale_factor:new s.aM(h,t.u_overscale_factor)}),collisionCircle:(h,t)=>({u_matrix:new s.aN(h,t.u_matrix),u_inv_matrix:new s.aN(h,t.u_inv_matrix),u_camera_to_center_distance:new s.aM(h,t.u_camera_to_center_distance),u_viewport_size:new s.aQ(h,t.u_viewport_size)}),debug:(h,t)=>({u_color:new s.aR(h,t.u_color),u_matrix:new s.aN(h,t.u_matrix),u_overlay:new s.aL(h,t.u_overlay),u_overlay_scale:new s.aM(h,t.u_overlay_scale)}),clippingMask:(h,t)=>({u_matrix:new s.aN(h,t.u_matrix)}),heatmap:(h,t)=>({u_extrude_scale:new s.aM(h,t.u_extrude_scale),u_intensity:new s.aM(h,t.u_intensity),u_matrix:new s.aN(h,t.u_matrix)}),heatmapTexture:(h,t)=>({u_matrix:new s.aN(h,t.u_matrix),u_world:new s.aQ(h,t.u_world),u_image:new s.aL(h,t.u_image),u_color_ramp:new s.aL(h,t.u_color_ramp),u_opacity:new s.aM(h,t.u_opacity)}),hillshade:(h,t)=>({u_matrix:new s.aN(h,t.u_matrix),u_image:new s.aL(h,t.u_image),u_latrange:new s.aQ(h,t.u_latrange),u_light:new s.aQ(h,t.u_light),u_shadow:new s.aR(h,t.u_shadow),u_highlight:new s.aR(h,t.u_highlight),u_accent:new s.aR(h,t.u_accent)}),hillshadePrepare:(h,t)=>({u_matrix:new s.aN(h,t.u_matrix),u_image:new s.aL(h,t.u_image),u_dimension:new s.aQ(h,t.u_dimension),u_zoom:new s.aM(h,t.u_zoom),u_unpack:new s.aO(h,t.u_unpack)}),line:(h,t)=>({u_matrix:new s.aN(h,t.u_matrix),u_ratio:new s.aM(h,t.u_ratio),u_device_pixel_ratio:new s.aM(h,t.u_device_pixel_ratio),u_units_to_pixels:new s.aQ(h,t.u_units_to_pixels)}),lineGradient:(h,t)=>({u_matrix:new s.aN(h,t.u_matrix),u_ratio:new s.aM(h,t.u_ratio),u_device_pixel_ratio:new s.aM(h,t.u_device_pixel_ratio),u_units_to_pixels:new s.aQ(h,t.u_units_to_pixels),u_image:new s.aL(h,t.u_image),u_image_height:new s.aM(h,t.u_image_height)}),linePattern:(h,t)=>({u_matrix:new s.aN(h,t.u_matrix),u_texsize:new s.aQ(h,t.u_texsize),u_ratio:new s.aM(h,t.u_ratio),u_device_pixel_ratio:new s.aM(h,t.u_device_pixel_ratio),u_image:new s.aL(h,t.u_image),u_units_to_pixels:new s.aQ(h,t.u_units_to_pixels),u_scale:new s.aP(h,t.u_scale),u_fade:new s.aM(h,t.u_fade)}),lineSDF:(h,t)=>({u_matrix:new s.aN(h,t.u_matrix),u_ratio:new s.aM(h,t.u_ratio),u_device_pixel_ratio:new s.aM(h,t.u_device_pixel_ratio),u_units_to_pixels:new s.aQ(h,t.u_units_to_pixels),u_patternscale_a:new s.aQ(h,t.u_patternscale_a),u_patternscale_b:new s.aQ(h,t.u_patternscale_b),u_sdfgamma:new s.aM(h,t.u_sdfgamma),u_image:new s.aL(h,t.u_image),u_tex_y_a:new s.aM(h,t.u_tex_y_a),u_tex_y_b:new s.aM(h,t.u_tex_y_b),u_mix:new s.aM(h,t.u_mix)}),raster:(h,t)=>({u_matrix:new s.aN(h,t.u_matrix),u_tl_parent:new s.aQ(h,t.u_tl_parent),u_scale_parent:new s.aM(h,t.u_scale_parent),u_buffer_scale:new s.aM(h,t.u_buffer_scale),u_fade_t:new s.aM(h,t.u_fade_t),u_opacity:new s.aM(h,t.u_opacity),u_image0:new s.aL(h,t.u_image0),u_image1:new s.aL(h,t.u_image1),u_brightness_low:new s.aM(h,t.u_brightness_low),u_brightness_high:new s.aM(h,t.u_brightness_high),u_saturation_factor:new s.aM(h,t.u_saturation_factor),u_contrast_factor:new s.aM(h,t.u_contrast_factor),u_spin_weights:new s.aP(h,t.u_spin_weights)}),symbolIcon:(h,t)=>({u_is_size_zoom_constant:new s.aL(h,t.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aL(h,t.u_is_size_feature_constant),u_size_t:new s.aM(h,t.u_size_t),u_size:new s.aM(h,t.u_size),u_camera_to_center_distance:new s.aM(h,t.u_camera_to_center_distance),u_pitch:new s.aM(h,t.u_pitch),u_rotate_symbol:new s.aL(h,t.u_rotate_symbol),u_aspect_ratio:new s.aM(h,t.u_aspect_ratio),u_fade_change:new s.aM(h,t.u_fade_change),u_matrix:new s.aN(h,t.u_matrix),u_label_plane_matrix:new s.aN(h,t.u_label_plane_matrix),u_coord_matrix:new s.aN(h,t.u_coord_matrix),u_is_text:new s.aL(h,t.u_is_text),u_pitch_with_map:new s.aL(h,t.u_pitch_with_map),u_texsize:new s.aQ(h,t.u_texsize),u_texture:new s.aL(h,t.u_texture)}),symbolSDF:(h,t)=>({u_is_size_zoom_constant:new s.aL(h,t.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aL(h,t.u_is_size_feature_constant),u_size_t:new s.aM(h,t.u_size_t),u_size:new s.aM(h,t.u_size),u_camera_to_center_distance:new s.aM(h,t.u_camera_to_center_distance),u_pitch:new s.aM(h,t.u_pitch),u_rotate_symbol:new s.aL(h,t.u_rotate_symbol),u_aspect_ratio:new s.aM(h,t.u_aspect_ratio),u_fade_change:new s.aM(h,t.u_fade_change),u_matrix:new s.aN(h,t.u_matrix),u_label_plane_matrix:new s.aN(h,t.u_label_plane_matrix),u_coord_matrix:new s.aN(h,t.u_coord_matrix),u_is_text:new s.aL(h,t.u_is_text),u_pitch_with_map:new s.aL(h,t.u_pitch_with_map),u_texsize:new s.aQ(h,t.u_texsize),u_texture:new s.aL(h,t.u_texture),u_gamma_scale:new s.aM(h,t.u_gamma_scale),u_device_pixel_ratio:new s.aM(h,t.u_device_pixel_ratio),u_is_halo:new s.aL(h,t.u_is_halo)}),symbolTextAndIcon:(h,t)=>({u_is_size_zoom_constant:new s.aL(h,t.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aL(h,t.u_is_size_feature_constant),u_size_t:new s.aM(h,t.u_size_t),u_size:new s.aM(h,t.u_size),u_camera_to_center_distance:new s.aM(h,t.u_camera_to_center_distance),u_pitch:new s.aM(h,t.u_pitch),u_rotate_symbol:new s.aL(h,t.u_rotate_symbol),u_aspect_ratio:new s.aM(h,t.u_aspect_ratio),u_fade_change:new s.aM(h,t.u_fade_change),u_matrix:new s.aN(h,t.u_matrix),u_label_plane_matrix:new s.aN(h,t.u_label_plane_matrix),u_coord_matrix:new s.aN(h,t.u_coord_matrix),u_is_text:new s.aL(h,t.u_is_text),u_pitch_with_map:new s.aL(h,t.u_pitch_with_map),u_texsize:new s.aQ(h,t.u_texsize),u_texsize_icon:new s.aQ(h,t.u_texsize_icon),u_texture:new s.aL(h,t.u_texture),u_texture_icon:new s.aL(h,t.u_texture_icon),u_gamma_scale:new s.aM(h,t.u_gamma_scale),u_device_pixel_ratio:new s.aM(h,t.u_device_pixel_ratio),u_is_halo:new s.aL(h,t.u_is_halo)}),background:(h,t)=>({u_matrix:new s.aN(h,t.u_matrix),u_opacity:new s.aM(h,t.u_opacity),u_color:new s.aR(h,t.u_color)}),backgroundPattern:(h,t)=>({u_matrix:new s.aN(h,t.u_matrix),u_opacity:new s.aM(h,t.u_opacity),u_image:new s.aL(h,t.u_image),u_pattern_tl_a:new s.aQ(h,t.u_pattern_tl_a),u_pattern_br_a:new s.aQ(h,t.u_pattern_br_a),u_pattern_tl_b:new s.aQ(h,t.u_pattern_tl_b),u_pattern_br_b:new s.aQ(h,t.u_pattern_br_b),u_texsize:new s.aQ(h,t.u_texsize),u_mix:new s.aM(h,t.u_mix),u_pattern_size_a:new s.aQ(h,t.u_pattern_size_a),u_pattern_size_b:new s.aQ(h,t.u_pattern_size_b),u_scale_a:new s.aM(h,t.u_scale_a),u_scale_b:new s.aM(h,t.u_scale_b),u_pixel_coord_upper:new s.aQ(h,t.u_pixel_coord_upper),u_pixel_coord_lower:new s.aQ(h,t.u_pixel_coord_lower),u_tile_units_to_pixels:new s.aM(h,t.u_tile_units_to_pixels)}),terrain:(h,t)=>({u_matrix:new s.aN(h,t.u_matrix),u_texture:new s.aL(h,t.u_texture),u_ele_delta:new s.aM(h,t.u_ele_delta)}),terrainDepth:(h,t)=>({u_matrix:new s.aN(h,t.u_matrix),u_ele_delta:new s.aM(h,t.u_ele_delta)}),terrainCoords:(h,t)=>({u_matrix:new s.aN(h,t.u_matrix),u_texture:new s.aL(h,t.u_texture),u_terrain_coords_id:new s.aM(h,t.u_terrain_coords_id),u_ele_delta:new s.aM(h,t.u_ele_delta)})};class os{constructor(t,n,o){this.context=t;const c=t.gl;this.buffer=c.createBuffer(),this.dynamicDraw=!!o,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),c.bufferData(c.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?c.DYNAMIC_DRAW:c.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const n=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Pa={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ls{constructor(t,n,o,c){this.length=n.length,this.attributes=o,this.itemSize=n.bytesPerElement,this.dynamicDraw=c,this.context=t;const p=t.gl;this.buffer=p.createBuffer(),t.bindVertexBuffer.set(this.buffer),p.bufferData(p.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,n){for(let o=0;o<this.attributes.length;o++){const c=n.attributes[this.attributes[o].name];c!==void 0&&t.enableVertexAttribArray(c)}}setVertexAttribPointers(t,n,o){for(let c=0;c<this.attributes.length;c++){const p=this.attributes[c],_=n.attributes[p.name];_!==void 0&&t.vertexAttribPointer(_,p.components,t[Pa[p.type]],!1,this.itemSize,p.offset+this.itemSize*(o||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const sa=new WeakMap;function kn(h){var t;if(sa.has(h))return sa.get(h);{const n=(t=h.getParameter(h.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return sa.set(h,n),n}}class Xt{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class cs extends Xt{getDefault(){return s.aT.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Dr extends Xt{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Lr extends Xt{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Ys extends Xt{getDefault(){return[!0,!0,!0,!0]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class us extends Xt{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class hs extends Xt{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Js extends Xt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const n=this.current;(t.func!==n.func||t.ref!==n.ref||t.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Qs extends Xt{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class ds extends Xt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=t,this.dirty=!1}}class eo extends Xt{getDefault(){return[0,1]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class to extends Xt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=t,this.dirty=!1}}class ps extends Xt{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class gl extends Xt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.BLEND):n.disable(n.BLEND),this.current=t,this.dirty=!1}}class _l extends Xt{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class oa extends Xt{getDefault(){return s.aT.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class kc extends Xt{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class zc extends Xt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=t,this.dirty=!1}}class Dc extends Xt{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Lc extends Xt{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class Rc extends Xt{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class Bc extends Xt{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class io extends Xt{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class fs extends Xt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class ro extends Xt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class no extends Xt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class la extends Xt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class yl extends Xt{getDefault(){return null}set(t){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class vl extends Xt{getDefault(){return null}set(t){var n;if(t===this.current&&!this.dirty)return;const o=this.gl;kn(o)?o.bindVertexArray(t):(n=o.getExtension("OES_vertex_array_object"))===null||n===void 0||n.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class ao extends Xt{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class qn extends Xt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class xl extends Xt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class zn extends Xt{constructor(t,n){super(t),this.context=t,this.parent=n}getDefault(){return null}}class ca extends zn{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class bl extends zn{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class so extends zn{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class ai{constructor(t,n,o,c,p){this.context=t,this.width=n,this.height=o;const _=t.gl,y=this.framebuffer=_.createFramebuffer();if(this.colorAttachment=new ca(t,y),c)this.depthAttachment=p?new so(t,y):new bl(t,y);else if(p)throw new Error("Stencil cannot be setted without depth");if(_.checkFramebufferStatus(_.FRAMEBUFFER)!==_.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,n=this.colorAttachment.get();if(n&&t.deleteTexture(n),this.depthAttachment){const o=this.depthAttachment.get();o&&t.deleteRenderbuffer(o)}t.deleteFramebuffer(this.framebuffer)}}class Ii{constructor(t,n,o){this.blendFunction=t,this.blendColor=n,this.mask=o}}Ii.Replace=[1,0],Ii.disabled=new Ii(Ii.Replace,s.aT.transparent,[!1,!1,!1,!1]),Ii.unblended=new Ii(Ii.Replace,s.aT.transparent,[!0,!0,!0,!0]),Ii.alphaBlended=new Ii([1,771],s.aT.transparent,[!0,!0,!0,!0]);class Fc{constructor(t){var n,o;if(this.gl=t,this.clearColor=new cs(this),this.clearDepth=new Dr(this),this.clearStencil=new Lr(this),this.colorMask=new Ys(this),this.depthMask=new us(this),this.stencilMask=new hs(this),this.stencilFunc=new Js(this),this.stencilOp=new Qs(this),this.stencilTest=new ds(this),this.depthRange=new eo(this),this.depthTest=new to(this),this.depthFunc=new ps(this),this.blend=new gl(this),this.blendFunc=new _l(this),this.blendColor=new oa(this),this.blendEquation=new kc(this),this.cullFace=new zc(this),this.cullFaceSide=new Dc(this),this.frontFace=new Lc(this),this.program=new Rc(this),this.activeTexture=new Bc(this),this.viewport=new io(this),this.bindFramebuffer=new fs(this),this.bindRenderbuffer=new ro(this),this.bindTexture=new no(this),this.bindVertexBuffer=new la(this),this.bindElementBuffer=new yl(this),this.bindVertexArray=new vl(this),this.pixelStoreUnpack=new ao(this),this.pixelStoreUnpackPremultiplyAlpha=new qn(this),this.pixelStoreUnpackFlipY=new xl(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),kn(t)){this.HALF_FLOAT=t.HALF_FLOAT;const c=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(n=t.RGBA16F)!==null&&n!==void 0?n:c?.RGBA16F_EXT,this.RGB16F=(o=t.RGB16F)!==null&&o!==void 0?o:c?.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const c=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=c?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,n){return new os(this,t,n)}createVertexBuffer(t,n,o){return new ls(this,t,n,o)}createRenderbuffer(t,n,o){const c=this.gl,p=c.createRenderbuffer();return this.bindRenderbuffer.set(p),c.renderbufferStorage(c.RENDERBUFFER,t,n,o),this.bindRenderbuffer.set(null),p}createFramebuffer(t,n,o,c){return new ai(this,t,n,o,c)}clear({color:t,depth:n,stencil:o}){const c=this.gl;let p=0;t&&(p|=c.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),n!==void 0&&(p|=c.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),o!==void 0&&(p|=c.STENCIL_BUFFER_BIT,this.clearStencil.set(o),this.stencilMask.set(255)),c.clear(p)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){s.aG(t.blendFunction,Ii.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return kn(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var n;return kn(this.gl)?this.gl.deleteVertexArray(t):(n=this.gl.getExtension("OES_vertex_array_object"))===null||n===void 0?void 0:n.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}class Kt{constructor(t,n,o){this.func=t,this.mask=n,this.range=o}}Kt.ReadOnly=!1,Kt.ReadWrite=!0,Kt.disabled=new Kt(519,Kt.ReadOnly,[0,1]);const Gn=7680;class Ei{constructor(t,n,o,c,p,_){this.test=t,this.ref=n,this.mask=o,this.fail=c,this.depthFail=p,this.pass=_}}Ei.disabled=new Ei({func:519,mask:0},0,0,Gn,Gn,Gn);class Si{constructor(t,n,o){this.enable=t,this.mode=n,this.frontFace=o}}let Ma;function wl(h,t,n,o,c,p,_){const y=h.context,x=y.gl,C=h.useProgram("collisionBox"),E=[];let P=0,B=0;for(let J=0;J<o.length;J++){const oe=o[J],fe=t.getTile(oe),me=fe.getBucket(n);if(!me)continue;let Me=oe.posMatrix;c[0]===0&&c[1]===0||(Me=h.translatePosMatrix(oe.posMatrix,fe,c,p));const $e=_?me.textCollisionBox:me.iconCollisionBox,De=me.collisionCircleArray;if(De.length>0){const Ve=s.Z(),ot=Me;s.aU(Ve,me.placementInvProjMatrix,h.transform.glCoordMatrix),s.aU(Ve,Ve,me.placementViewportMatrix),E.push({circleArray:De,circleOffset:B,transform:ot,invTransform:Ve,coord:oe}),P+=De.length/4,B=P}$e&&C.draw(y,x.LINES,Kt.disabled,Ei.disabled,h.colorModeForRenderPass(),Si.disabled,Zs(Me,h.transform,fe),h.style.map.terrain&&h.style.map.terrain.getTerrainData(oe),n.id,$e.layoutVertexBuffer,$e.indexBuffer,$e.segments,null,h.transform.zoom,null,null,$e.collisionVertexBuffer)}if(!_||!E.length)return;const G=h.useProgram("collisionCircle"),q=new s.aV;q.resize(4*P),q._trim();let H=0;for(const J of E)for(let oe=0;oe<J.circleArray.length/4;oe++){const fe=4*oe,me=J.circleArray[fe+0],Me=J.circleArray[fe+1],$e=J.circleArray[fe+2],De=J.circleArray[fe+3];q.emplace(H++,me,Me,$e,De,0),q.emplace(H++,me,Me,$e,De,1),q.emplace(H++,me,Me,$e,De,2),q.emplace(H++,me,Me,$e,De,3)}(!Ma||Ma.length<2*P)&&(Ma=function(J){const oe=2*J,fe=new s.aX;fe.resize(oe),fe._trim();for(let me=0;me<oe;me++){const Me=6*me;fe.uint16[Me+0]=4*me+0,fe.uint16[Me+1]=4*me+1,fe.uint16[Me+2]=4*me+2,fe.uint16[Me+3]=4*me+2,fe.uint16[Me+4]=4*me+3,fe.uint16[Me+5]=4*me+0}return fe}(P));const V=y.createIndexBuffer(Ma,!0),ae=y.createVertexBuffer(q,s.aW.members,!0);for(const J of E){const oe={u_matrix:J.transform,u_inv_matrix:J.invTransform,u_camera_to_center_distance:(de=h.transform).cameraToCenterDistance,u_viewport_size:[de.width,de.height]};G.draw(y,x.TRIANGLES,Kt.disabled,Ei.disabled,h.colorModeForRenderPass(),Si.disabled,oe,h.style.map.terrain&&h.style.map.terrain.getTerrainData(J.coord),n.id,ae,V,s.S.simpleSegment(0,2*J.circleOffset,J.circleArray.length,J.circleArray.length/2),null,h.transform.zoom,null,null,null)}var de;ae.destroy(),V.destroy()}Si.disabled=new Si(!1,1029,2305),Si.backCCW=new Si(!0,1029,2305);const oo=s.ao(new Float32Array(16));function ms(h,t,n,o,c,p){const{horizontalAlign:_,verticalAlign:y}=s.au(h);return new s.P((-(_-.5)*t/c+o[0])*p,(-(y-.5)*n/c+o[1])*p)}function gs(h,t,n,o,c,p,_,y,x,C,E){const P=h.text.placedSymbolArray,B=h.text.dynamicLayoutVertexArray,G=h.icon.dynamicLayoutVertexArray,q={};B.clear();for(let H=0;H<P.length;H++){const V=P.get(H),ae=V.hidden||!V.crossTileID||h.allowVerticalPlacement&&!V.placedOrientation?null:o[V.crossTileID];if(ae){const de=new s.P(V.anchorX,V.anchorY),J=wt(de,n?_:p,E),oe=Jt(c.cameraToCenterDistance,J.signedDistanceFromCamera);let fe=s.aj(h.textSizeData,x,V)*oe/s.ap;n&&(fe*=h.tilePixelRatio/y);const{width:me,height:Me,anchor:$e,textOffset:De,textBoxScale:Ve}=ae,ot=ms($e,me,Me,De,Ve,fe),Ut=n?wt(de.add(ot),p,E).point:J.point.add(t?ot.rotate(-c.angle):ot),Ze=h.allowVerticalPlacement&&V.placedOrientation===s.ai.vertical?Math.PI/2:0;for(let xt=0;xt<V.numGlyphs;xt++)s.ak(B,Ut,Ze);C&&V.associatedIconIndex>=0&&(q[V.associatedIconIndex]={shiftedAnchor:Ut,angle:Ze})}else N(V.numGlyphs,B)}if(C){G.clear();const H=h.icon.placedSymbolArray;for(let V=0;V<H.length;V++){const ae=H.get(V);if(ae.hidden)N(ae.numGlyphs,G);else{const de=q[V];if(de)for(let J=0;J<ae.numGlyphs;J++)s.ak(G,de.shiftedAnchor,de.angle);else N(ae.numGlyphs,G)}}h.icon.dynamicLayoutVertexBuffer.updateData(G)}h.text.dynamicLayoutVertexBuffer.updateData(B)}function lo(h,t,n){return n.iconsInText&&t?"symbolTextAndIcon":h?"symbolSDF":"symbolIcon"}function _s(h,t,n,o,c,p,_,y,x,C,E,P){const B=h.context,G=B.gl,q=h.transform,H=y==="map",V=x==="map",ae=y!=="viewport"&&n.layout.get("symbol-placement")!=="point",de=H&&!V&&!ae,J=!n.layout.get("symbol-sort-key").isConstant();let oe=!1;const fe=h.depthModeForSublayer(0,Kt.ReadOnly),me=n._unevaluatedLayout.hasValue("text-variable-anchor")||n._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Me=[];for(const $e of o){const De=t.getTile($e),Ve=De.getBucket(n);if(!Ve)continue;const ot=c?Ve.text:Ve.icon;if(!ot||!ot.segments.get().length||!ot.hasVisibleVertices)continue;const Ut=ot.programConfigurations.get(n.id),Ze=c||Ve.sdfIcons,xt=c?Ve.textSizeData:Ve.iconSizeData,ut=V||q.pitch!==0,hi=h.useProgram(lo(Ze,c,Ve),Ut),Vt=s.ah(xt,q.zoom),Lt=h.style.map.terrain&&h.style.map.terrain.getTerrainData($e);let qt,Bi,fi,lr,Yi=[0,0],Vi=null;if(c)Bi=De.glyphAtlasTexture,fi=G.LINEAR,qt=De.glyphAtlasTexture.size,Ve.iconsInText&&(Yi=De.imageAtlasTexture.size,Vi=De.imageAtlasTexture,lr=ut||h.options.rotating||h.options.zooming||xt.kind==="composite"||xt.kind==="camera"?G.LINEAR:G.NEAREST);else{const Fi=n.layout.get("icon-size").constantOr(0)!==1||Ve.iconsNeedLinear;Bi=De.imageAtlasTexture,fi=Ze||h.options.rotating||h.options.zooming||Fi||ut?G.LINEAR:G.NEAREST,qt=De.imageAtlasTexture.size}const Fr=re(De,1,h.transform.zoom),vi=je($e.posMatrix,V,H,h.transform,Fr),ln=It($e.posMatrix,V,H,h.transform,Fr),cn=me&&Ve.hasTextData(),Rn=n.layout.get("icon-text-fit")!=="none"&&cn&&Ve.hasIconData();if(ae){const Fi=h.style.map.terrain?(Ir,$i)=>h.style.map.terrain.getElevation($e,Ir,$i):null,Ji=n.layout.get("text-rotation-alignment")==="map";ze(Ve,$e.posMatrix,h,c,vi,ln,V,C,Ji,Fi)}const Kn=h.translatePosMatrix($e.posMatrix,De,p,_),ga=ae||c&&me||Rn?oo:vi,dr=h.translatePosMatrix(ln,De,p,_,!0),cr=Ze&&n.paint.get(c?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let yr;yr=Ze?Ve.iconsInText?Un(xt.kind,Vt,de,V,h,Kn,ga,dr,qt,Yi):Ks(xt.kind,Vt,de,V,h,Kn,ga,dr,c,qt,!0):Xs(xt.kind,Vt,de,V,h,Kn,ga,dr,c,qt);const Yn={program:hi,buffers:ot,uniformValues:yr,atlasTexture:Bi,atlasTextureIcon:Vi,atlasInterpolation:fi,atlasInterpolationIcon:lr,isSDF:Ze,hasHalo:cr};if(J&&Ve.canOverlap){oe=!0;const Fi=ot.segments.get();for(const Ji of Fi)Me.push({segments:new s.S([Ji]),sortKey:Ji.sortKey,state:Yn,terrainData:Lt})}else Me.push({segments:ot.segments,sortKey:0,state:Yn,terrainData:Lt})}oe&&Me.sort(($e,De)=>$e.sortKey-De.sortKey);for(const $e of Me){const De=$e.state;if(B.activeTexture.set(G.TEXTURE0),De.atlasTexture.bind(De.atlasInterpolation,G.CLAMP_TO_EDGE),De.atlasTextureIcon&&(B.activeTexture.set(G.TEXTURE1),De.atlasTextureIcon&&De.atlasTextureIcon.bind(De.atlasInterpolationIcon,G.CLAMP_TO_EDGE)),De.isSDF){const Ve=De.uniformValues;De.hasHalo&&(Ve.u_is_halo=1,co(De.buffers,$e.segments,n,h,De.program,fe,E,P,Ve,$e.terrainData)),Ve.u_is_halo=0}co(De.buffers,$e.segments,n,h,De.program,fe,E,P,De.uniformValues,$e.terrainData)}}function co(h,t,n,o,c,p,_,y,x,C){const E=o.context;c.draw(E,E.gl.TRIANGLES,p,_,y,Si.disabled,x,C,n.id,h.layoutVertexBuffer,h.indexBuffer,t,n.paint,o.transform.zoom,h.programConfigurations.get(n.id),h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer)}function Aa(h,t,n,o,c){if(!n||!o||!o.imageAtlas)return;const p=o.imageAtlas.patternPositions;let _=p[n.to.toString()],y=p[n.from.toString()];if(!_&&y&&(_=y),!y&&_&&(y=_),!_||!y){const x=c.getPaintProperty(t);_=p[x],y=p[x]}_&&y&&h.setConstantPatternPositions(_,y)}function ka(h,t,n,o,c,p,_){const y=h.context.gl,x="fill-pattern",C=n.paint.get(x),E=C&&C.constantOr(1),P=n.getCrossfadeParameters();let B,G,q,H,V;_?(G=E&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=y.LINES):(G=E?"fillPattern":"fill",B=y.TRIANGLES);const ae=C.constantOr(null);for(const de of o){const J=t.getTile(de);if(E&&!J.patternsLoaded())continue;const oe=J.getBucket(n);if(!oe)continue;const fe=oe.programConfigurations.get(n.id),me=h.useProgram(G,fe),Me=h.style.map.terrain&&h.style.map.terrain.getTerrainData(de);E&&(h.context.activeTexture.set(y.TEXTURE0),J.imageAtlasTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),fe.updatePaintBuffers(P)),Aa(fe,x,ae,J,n);const $e=Me?de:null,De=h.translatePosMatrix($e?$e.posMatrix:de.posMatrix,J,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));if(_){H=oe.indexBuffer2,V=oe.segments2;const Ve=[y.drawingBufferWidth,y.drawingBufferHeight];q=G==="fillOutlinePattern"&&E?rs(De,h,P,J,Ve):is(De,Ve)}else H=oe.indexBuffer,V=oe.segments,q=E?Gs(De,h,P,J):cl(De);me.draw(h.context,B,c,h.stencilModeForClipping(de),p,Si.disabled,q,Me,n.id,oe.layoutVertexBuffer,H,V,n.paint,h.transform.zoom,fe)}}function za(h,t,n,o,c,p,_){const y=h.context,x=y.gl,C="fill-extrusion-pattern",E=n.paint.get(C),P=E.constantOr(1),B=n.getCrossfadeParameters(),G=n.paint.get("fill-extrusion-opacity"),q=E.constantOr(null);for(const H of o){const V=t.getTile(H),ae=V.getBucket(n);if(!ae)continue;const de=h.style.map.terrain&&h.style.map.terrain.getTerrainData(H),J=ae.programConfigurations.get(n.id),oe=h.useProgram(P?"fillExtrusionPattern":"fillExtrusion",J);P&&(h.context.activeTexture.set(x.TEXTURE0),V.imageAtlasTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE),J.updatePaintBuffers(B)),Aa(J,C,q,V,n);const fe=h.translatePosMatrix(H.posMatrix,V,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),me=n.paint.get("fill-extrusion-vertical-gradient"),Me=P?Mn(fe,h,me,G,H,B,V):qs(fe,h,me,G);oe.draw(y,y.gl.TRIANGLES,c,p,_,Si.backCCW,Me,de,n.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,n.paint,h.transform.zoom,J,h.style.map.terrain&&ae.centroidVertexBuffer)}}function $c(h,t,n,o,c,p,_){const y=h.context,x=y.gl,C=n.fbo;if(!C)return;const E=h.useProgram("hillshade"),P=h.style.map.terrain&&h.style.map.terrain.getTerrainData(t);y.activeTexture.set(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,C.colorAttachment.get()),E.draw(y,x.TRIANGLES,c,p,_,Si.disabled,((B,G,q,H)=>{const V=q.paint.get("hillshade-shadow-color"),ae=q.paint.get("hillshade-highlight-color"),de=q.paint.get("hillshade-accent-color");let J=q.paint.get("hillshade-illumination-direction")*(Math.PI/180);q.paint.get("hillshade-illumination-anchor")==="viewport"&&(J-=B.transform.angle);const oe=!B.options.moving;return{u_matrix:H?H.posMatrix:B.transform.calculatePosMatrix(G.tileID.toUnwrapped(),oe),u_image:0,u_latrange:Hs(0,G.tileID),u_light:[q.paint.get("hillshade-exaggeration"),J],u_shadow:V,u_highlight:ae,u_accent:de}})(h,n,o,P?t:null),P,o.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments)}function uo(h,t,n,o,c,p){const _=h.context,y=_.gl,x=t.dem;if(x&&x.data){const C=x.dim,E=x.stride,P=x.getPixels();if(_.activeTexture.set(y.TEXTURE1),_.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||h.getTileTexture(E),t.demTexture){const G=t.demTexture;G.update(P,{premultiply:!1}),G.bind(y.NEAREST,y.CLAMP_TO_EDGE)}else t.demTexture=new Te(_,P,y.RGBA,{premultiply:!1}),t.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE);_.activeTexture.set(y.TEXTURE0);let B=t.fbo;if(!B){const G=new Te(_,{width:C,height:C,data:null},y.RGBA);G.bind(y.LINEAR,y.CLAMP_TO_EDGE),B=t.fbo=_.createFramebuffer(C,C,!0,!1),B.colorAttachment.set(G.texture)}_.bindFramebuffer.set(B.framebuffer),_.viewport.set([0,0,C,C]),h.useProgram("hillshadePrepare").draw(_,y.TRIANGLES,o,c,p,Si.disabled,((G,q)=>{const H=q.stride,V=s.Z();return s.aS(V,0,s.N,-s.N,0,0,1),s.$(V,V,[0,-s.N,0]),{u_matrix:V,u_image:1,u_dimension:[H,H],u_zoom:G.overscaledZ,u_unpack:q.getUnpackVector()}})(t.tileID,x),null,n.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function Oc(h,t,n,o,c,p){const _=o.paint.get("raster-fade-duration");if(!p&&_>0){const y=s.h.now(),x=(y-h.timeAdded)/_,C=t?(y-t.timeAdded)/_:-1,E=n.getSource(),P=c.coveringZoomLevel({tileSize:E.tileSize,roundZoom:E.roundZoom}),B=!t||Math.abs(t.tileID.overscaledZ-P)>Math.abs(h.tileID.overscaledZ-P),G=B&&h.refreshedUponExpiration?1:s.ad(B?x:1-C,0,1);return h.refreshedUponExpiration&&x>=1&&(h.refreshedUponExpiration=!1),t?{opacity:1,mix:1-G}:{opacity:G,mix:0}}return{opacity:1,mix:0}}const Sl=new s.aT(1,0,0,1),ys=new s.aT(0,1,0,1),ho=new s.aT(0,0,1,1),Cl=new s.aT(1,0,1,1),Tl=new s.aT(0,1,1,1);function Da(h,t,n,o){xs(h,0,t+n/2,h.transform.width,n,o)}function vs(h,t,n,o){xs(h,t-n/2,0,n,h.transform.height,o)}function xs(h,t,n,o,c,p){const _=h.context,y=_.gl;y.enable(y.SCISSOR_TEST),y.scissor(t*h.pixelRatio,n*h.pixelRatio,o*h.pixelRatio,c*h.pixelRatio),_.clear({color:p}),y.disable(y.SCISSOR_TEST)}function Il(h,t,n){const o=h.context,c=o.gl,p=n.posMatrix,_=h.useProgram("debug"),y=Kt.disabled,x=Ei.disabled,C=h.colorModeForRenderPass(),E="$debug",P=h.style.map.terrain&&h.style.map.terrain.getTerrainData(n);o.activeTexture.set(c.TEXTURE0);const B=t.getTileByID(n.key).latestRawTileData,G=Math.floor((B&&B.byteLength||0)/1024),q=t.getTile(n).tileSize,H=512/Math.min(q,512)*(n.overscaledZ/h.transform.zoom)*.5;let V=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(V+=` => ${n.overscaledZ}`),function(ae,de){ae.initDebugOverlayCanvas();const J=ae.debugOverlayCanvas,oe=ae.context.gl,fe=ae.debugOverlayCanvas.getContext("2d");fe.clearRect(0,0,J.width,J.height),fe.shadowColor="white",fe.shadowBlur=2,fe.lineWidth=1.5,fe.strokeStyle="white",fe.textBaseline="top",fe.font="bold 36px Open Sans, sans-serif",fe.fillText(de,5,5),fe.strokeText(de,5,5),ae.debugOverlayTexture.update(J),ae.debugOverlayTexture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE)}(h,`${V} ${G}kB`),_.draw(o,c.TRIANGLES,y,x,Ii.alphaBlended,Si.disabled,Ea(p,s.aT.transparent,H),null,E,h.debugBuffer,h.quadTriangleIndexBuffer,h.debugSegments),_.draw(o,c.LINE_STRIP,y,x,C,Si.disabled,Ea(p,s.aT.red),P,E,h.debugBuffer,h.tileBorderIndexBuffer,h.debugSegments)}function ki(h,t,n){const o=h.context,c=o.gl,p=h.colorModeForRenderPass(),_=new Kt(c.LEQUAL,Kt.ReadWrite,h.depthRangeFor3D),y=h.useProgram("terrain"),x=t.getTerrainMesh();o.bindFramebuffer.set(null),o.viewport.set([0,0,h.width,h.height]);for(const C of n){const E=h.renderToTexture.getTexture(C),P=t.getTerrainData(C.tileID);o.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,E.texture);const B={u_matrix:h.transform.calculatePosMatrix(C.tileID.toUnwrapped()),u_texture:0,u_ele_delta:t.getMeshFrameDelta(h.transform.zoom)};y.draw(o,c.TRIANGLES,_,Ei.disabled,p,Si.backCCW,B,P,"terrain",x.vertexBuffer,x.indexBuffer,x.segments)}}class Zn{constructor(t,n){this.context=new Fc(t),this.transform=n,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:s.Z(),renderTime:0},this.setup(),this.numSublayers=bi.maxUnderzooming+bi.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Qa}resize(t,n,o){if(this.width=Math.floor(t*o),this.height=Math.floor(n*o),this.pixelRatio=o,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const c of this.style._order)this.style._layers[c].resize()}setup(){const t=this.context,n=new s.a_;n.emplaceBack(0,0),n.emplaceBack(s.N,0),n.emplaceBack(0,s.N),n.emplaceBack(s.N,s.N),this.tileExtentBuffer=t.createVertexBuffer(n,es.members),this.tileExtentSegments=s.S.simpleSegment(0,0,4,2);const o=new s.a_;o.emplaceBack(0,0),o.emplaceBack(s.N,0),o.emplaceBack(0,s.N),o.emplaceBack(s.N,s.N),this.debugBuffer=t.createVertexBuffer(o,es.members),this.debugSegments=s.S.simpleSegment(0,0,4,5);const c=new s.V;c.emplaceBack(0,0,0,0),c.emplaceBack(s.N,0,s.N,0),c.emplaceBack(0,s.N,0,s.N),c.emplaceBack(s.N,s.N,s.N,s.N),this.rasterBoundsBuffer=t.createVertexBuffer(c,ei.members),this.rasterBoundsSegments=s.S.simpleSegment(0,0,4,2);const p=new s.a_;p.emplaceBack(0,0),p.emplaceBack(1,0),p.emplaceBack(0,1),p.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(p,es.members),this.viewportSegments=s.S.simpleSegment(0,0,4,2);const _=new s.a$;_.emplaceBack(0),_.emplaceBack(1),_.emplaceBack(3),_.emplaceBack(2),_.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(_);const y=new s.b0;y.emplaceBack(0,1,2),y.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(y);const x=this.context.gl;this.stencilClearMode=new Ei({func:x.ALWAYS,mask:0},0,255,x.ZERO,x.ZERO,x.ZERO)}clearStencil(){const t=this.context,n=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const o=s.Z();s.aS(o,0,this.width,this.height,0,0,1),s.a0(o,o,[n.drawingBufferWidth,n.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,n.TRIANGLES,Kt.disabled,this.stencilClearMode,Ii.disabled,Si.disabled,ul(o),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,n){if(this.currentStencilSource===t.source||!t.isTileClipped()||!n||!n.length)return;this.currentStencilSource=t.source;const o=this.context,c=o.gl;this.nextStencilID+n.length>256&&this.clearStencil(),o.setColorMode(Ii.disabled),o.setDepthMode(Kt.disabled);const p=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const _ of n){const y=this._tileClippingMaskIDs[_.key]=this.nextStencilID++,x=this.style.map.terrain&&this.style.map.terrain.getTerrainData(_);p.draw(o,c.TRIANGLES,Kt.disabled,new Ei({func:c.ALWAYS,mask:0},y,255,c.KEEP,c.KEEP,c.REPLACE),Ii.disabled,Si.disabled,ul(_.posMatrix),x,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,n=this.context.gl;return new Ei({func:n.NOTEQUAL,mask:255},t,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(t){const n=this.context.gl;return new Ei({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(t){const n=this.context.gl,o=t.sort((_,y)=>y.overscaledZ-_.overscaledZ),c=o[o.length-1].overscaledZ,p=o[0].overscaledZ-c+1;if(p>1){this.currentStencilSource=void 0,this.nextStencilID+p>256&&this.clearStencil();const _={};for(let y=0;y<p;y++)_[y+c]=new Ei({func:n.GEQUAL,mask:255},y+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=p,[_,o]}return[{[c]:Ei.disabled},o]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Ii([t.CONSTANT_COLOR,t.ONE],new s.aT(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ii.unblended:Ii.alphaBlended}depthModeForSublayer(t,n,o){if(!this.opaquePassEnabledForLayer())return Kt.disabled;const c=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Kt(o||this.context.gl.LEQUAL,n,[c,c])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,n){this.style=t,this.options=n,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(s.h.now()),this.imageManager.beginFrame();const o=this.style._order,c=this.style.sourceCaches,p={},_={},y={};for(const x in c){const C=c[x];C.used&&C.prepare(this.context),p[x]=C.getVisibleCoordinates(),_[x]=p[x].slice().reverse(),y[x]=C.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let x=0;x<o.length;x++)if(this.style._layers[o[x]].is3D()){this.opaquePassCutoff=x;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const x=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!s.b1(this.terrainFacilitator.matrix,this.transform.projMatrix)||x.length)&&(s.b2(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(C,E){const P=C.context,B=P.gl,G=Ii.unblended,q=new Kt(B.LEQUAL,Kt.ReadWrite,[0,1]),H=E.getTerrainMesh(),V=E.sourceCache.getRenderableTiles(),ae=C.useProgram("terrainDepth");P.bindFramebuffer.set(E.getFramebuffer("depth").framebuffer),P.viewport.set([0,0,C.width/devicePixelRatio,C.height/devicePixelRatio]),P.clear({color:s.aT.transparent,depth:1});for(const de of V){const J=E.getTerrainData(de.tileID),oe={u_matrix:C.transform.calculatePosMatrix(de.tileID.toUnwrapped()),u_ele_delta:E.getMeshFrameDelta(C.transform.zoom)};ae.draw(P,B.TRIANGLES,q,Ei.disabled,G,Si.backCCW,oe,J,"terrain",H.vertexBuffer,H.indexBuffer,H.segments)}P.bindFramebuffer.set(null),P.viewport.set([0,0,C.width,C.height])}(this,this.style.map.terrain),function(C,E){const P=C.context,B=P.gl,G=Ii.unblended,q=new Kt(B.LEQUAL,Kt.ReadWrite,[0,1]),H=E.getTerrainMesh(),V=E.getCoordsTexture(),ae=E.sourceCache.getRenderableTiles(),de=C.useProgram("terrainCoords");P.bindFramebuffer.set(E.getFramebuffer("coords").framebuffer),P.viewport.set([0,0,C.width/devicePixelRatio,C.height/devicePixelRatio]),P.clear({color:s.aT.transparent,depth:1}),E.coordsIndex=[];for(const J of ae){const oe=E.getTerrainData(J.tileID);P.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,V.texture);const fe={u_matrix:C.transform.calculatePosMatrix(J.tileID.toUnwrapped()),u_terrain_coords_id:(255-E.coordsIndex.length)/255,u_texture:0,u_ele_delta:E.getMeshFrameDelta(C.transform.zoom)};de.draw(P,B.TRIANGLES,q,Ei.disabled,G,Si.backCCW,fe,oe,"terrain",H.vertexBuffer,H.indexBuffer,H.segments),E.coordsIndex.push(J.tileID.key)}P.bindFramebuffer.set(null),P.viewport.set([0,0,C.width,C.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const x of o){const C=this.style._layers[x];if(!C.hasOffscreenPass()||C.isHidden(this.transform.zoom))continue;const E=_[C.source];(C.type==="custom"||E.length)&&this.renderLayer(this,c[C.source],C,E)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?s.aT.black:s.aT.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=o.length-1;this.currentLayer>=0;this.currentLayer--){const x=this.style._layers[o[this.currentLayer]],C=c[x.source],E=p[x.source];this._renderTileClippingMasks(x,E),this.renderLayer(this,C,x,E)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<o.length;this.currentLayer++){const x=this.style._layers[o[this.currentLayer]],C=c[x.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(x))continue;const E=(x.type==="symbol"?y:_)[x.source];this._renderTileClippingMasks(x,p[x.source]),this.renderLayer(this,C,x,E)}if(this.options.showTileBoundaries){const x=function(C,E){let P=null;const B=Object.values(C._layers).flatMap(V=>V.source&&!V.isHidden(E)?[C.sourceCaches[V.source]]:[]),G=B.filter(V=>V.getSource().type==="vector"),q=B.filter(V=>V.getSource().type!=="vector"),H=V=>{(!P||P.getSource().maxzoom<V.getSource().maxzoom)&&(P=V)};return G.forEach(V=>H(V)),P||q.forEach(V=>H(V)),P}(this.style,this.transform.zoom);x&&function(C,E,P){for(let B=0;B<P.length;B++)Il(C,E,P[B])}(this,x,x.getVisibleCoordinates())}this.options.showPadding&&function(x){const C=x.transform.padding;Da(x,x.transform.height-(C.top||0),3,Sl),Da(x,C.bottom||0,3,ys),vs(x,C.left||0,3,ho),vs(x,x.transform.width-(C.right||0),3,Cl);const E=x.transform.centerPoint;(function(P,B,G,q){xs(P,B-1,G-10,2,20,q),xs(P,B-10,G-1,20,2,q)})(x,E.x,x.transform.height-E.y,Tl)}(this),this.context.setDefault()}renderLayer(t,n,o,c){if(!o.isHidden(this.transform.zoom)&&(o.type==="background"||o.type==="custom"||(c||[]).length))switch(this.id=o.id,o.type){case"symbol":(function(p,_,y,x,C){if(p.renderPass!=="translucent")return;const E=Ei.disabled,P=p.colorModeForRenderPass();(y._unevaluatedLayout.hasValue("text-variable-anchor")||y._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(B,G,q,H,V,ae,de){const J=G.transform,oe=V==="map",fe=ae==="map";for(const me of B){const Me=H.getTile(me),$e=Me.getBucket(q);if(!$e||!$e.text||!$e.text.segments.get().length)continue;const De=s.ah($e.textSizeData,J.zoom),Ve=re(Me,1,G.transform.zoom),ot=je(me.posMatrix,fe,oe,G.transform,Ve),Ut=q.layout.get("icon-text-fit")!=="none"&&$e.hasIconData();if(De){const Ze=Math.pow(2,J.zoom-Me.tileID.overscaledZ);gs($e,oe,fe,de,J,ot,me.posMatrix,Ze,De,Ut,G.style.map.terrain?(xt,ut)=>G.style.map.terrain.getElevation(me,xt,ut):null)}}}(x,p,y,_,y.layout.get("text-rotation-alignment"),y.layout.get("text-pitch-alignment"),C),y.paint.get("icon-opacity").constantOr(1)!==0&&_s(p,_,y,x,!1,y.paint.get("icon-translate"),y.paint.get("icon-translate-anchor"),y.layout.get("icon-rotation-alignment"),y.layout.get("icon-pitch-alignment"),y.layout.get("icon-keep-upright"),E,P),y.paint.get("text-opacity").constantOr(1)!==0&&_s(p,_,y,x,!0,y.paint.get("text-translate"),y.paint.get("text-translate-anchor"),y.layout.get("text-rotation-alignment"),y.layout.get("text-pitch-alignment"),y.layout.get("text-keep-upright"),E,P),_.map.showCollisionBoxes&&(wl(p,_,y,x,y.paint.get("text-translate"),y.paint.get("text-translate-anchor"),!0),wl(p,_,y,x,y.paint.get("icon-translate"),y.paint.get("icon-translate-anchor"),!1))})(t,n,o,c,this.style.placement.variableOffsets);break;case"circle":(function(p,_,y,x){if(p.renderPass!=="translucent")return;const C=y.paint.get("circle-opacity"),E=y.paint.get("circle-stroke-width"),P=y.paint.get("circle-stroke-opacity"),B=!y.layout.get("circle-sort-key").isConstant();if(C.constantOr(1)===0&&(E.constantOr(1)===0||P.constantOr(1)===0))return;const G=p.context,q=G.gl,H=p.depthModeForSublayer(0,Kt.ReadOnly),V=Ei.disabled,ae=p.colorModeForRenderPass(),de=[];for(let J=0;J<x.length;J++){const oe=x[J],fe=_.getTile(oe),me=fe.getBucket(y);if(!me)continue;const Me=me.programConfigurations.get(y.id),$e=p.useProgram("circle",Me),De=me.layoutVertexBuffer,Ve=me.indexBuffer,ot=p.style.map.terrain&&p.style.map.terrain.getTerrainData(oe),Ut={programConfiguration:Me,program:$e,layoutVertexBuffer:De,indexBuffer:Ve,uniformValues:An(p,oe,fe,y),terrainData:ot};if(B){const Ze=me.segments.get();for(const xt of Ze)de.push({segments:new s.S([xt]),sortKey:xt.sortKey,state:Ut})}else de.push({segments:me.segments,sortKey:0,state:Ut})}B&&de.sort((J,oe)=>J.sortKey-oe.sortKey);for(const J of de){const{programConfiguration:oe,program:fe,layoutVertexBuffer:me,indexBuffer:Me,uniformValues:$e,terrainData:De}=J.state;fe.draw(G,q.TRIANGLES,H,V,ae,Si.disabled,$e,De,y.id,me,Me,J.segments,y.paint,p.transform.zoom,oe)}})(t,n,o,c);break;case"heatmap":(function(p,_,y,x){if(y.paint.get("heatmap-opacity")!==0)if(p.renderPass==="offscreen"){const C=p.context,E=C.gl,P=Ei.disabled,B=new Ii([E.ONE,E.ONE],s.aT.transparent,[!0,!0,!0,!0]);(function(G,q,H){const V=G.gl;G.activeTexture.set(V.TEXTURE1),G.viewport.set([0,0,q.width/4,q.height/4]);let ae=H.heatmapFbo;if(ae)V.bindTexture(V.TEXTURE_2D,ae.colorAttachment.get()),G.bindFramebuffer.set(ae.framebuffer);else{const de=V.createTexture();V.bindTexture(V.TEXTURE_2D,de),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_WRAP_S,V.CLAMP_TO_EDGE),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_WRAP_T,V.CLAMP_TO_EDGE),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_MIN_FILTER,V.LINEAR),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_MAG_FILTER,V.LINEAR),ae=H.heatmapFbo=G.createFramebuffer(q.width/4,q.height/4,!1,!1),function(J,oe,fe,me){var Me,$e;const De=J.gl,Ve=(Me=J.HALF_FLOAT)!==null&&Me!==void 0?Me:De.UNSIGNED_BYTE,ot=($e=J.RGBA16F)!==null&&$e!==void 0?$e:De.RGBA;De.texImage2D(De.TEXTURE_2D,0,ot,oe.width/4,oe.height/4,0,De.RGBA,Ve,null),me.colorAttachment.set(fe)}(G,q,de,ae)}})(C,p,y),C.clear({color:s.aT.transparent});for(let G=0;G<x.length;G++){const q=x[G];if(_.hasRenderableParent(q))continue;const H=_.getTile(q),V=H.getBucket(y);if(!V)continue;const ae=V.programConfigurations.get(y.id),de=p.useProgram("heatmap",ae),{zoom:J}=p.transform;de.draw(C,E.TRIANGLES,Kt.disabled,P,B,Si.disabled,Mc(q.posMatrix,H,J,y.paint.get("heatmap-intensity")),null,y.id,V.layoutVertexBuffer,V.indexBuffer,V.segments,y.paint,p.transform.zoom,ae)}C.viewport.set([0,0,p.width,p.height])}else p.renderPass==="translucent"&&(p.context.setColorMode(p.colorModeForRenderPass()),function(C,E){const P=C.context,B=P.gl,G=E.heatmapFbo;if(!G)return;P.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,G.colorAttachment.get()),P.activeTexture.set(B.TEXTURE1);let q=E.colorRampTexture;q||(q=E.colorRampTexture=new Te(P,E.colorRamp,B.RGBA)),q.bind(B.LINEAR,B.CLAMP_TO_EDGE),C.useProgram("heatmapTexture").draw(P,B.TRIANGLES,Kt.disabled,Ei.disabled,C.colorModeForRenderPass(),Si.disabled,((H,V,ae,de)=>{const J=s.Z();s.aS(J,0,H.width,H.height,0,0,1);const oe=H.context.gl;return{u_matrix:J,u_world:[oe.drawingBufferWidth,oe.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:V.paint.get("heatmap-opacity")}})(C,E),null,E.id,C.viewportBuffer,C.quadTriangleIndexBuffer,C.viewportSegments,E.paint,C.transform.zoom)}(p,y))})(t,n,o,c);break;case"line":(function(p,_,y,x){if(p.renderPass!=="translucent")return;const C=y.paint.get("line-opacity"),E=y.paint.get("line-width");if(C.constantOr(1)===0||E.constantOr(1)===0)return;const P=p.depthModeForSublayer(0,Kt.ReadOnly),B=p.colorModeForRenderPass(),G=y.paint.get("line-dasharray"),q=y.paint.get("line-pattern"),H=q.constantOr(1),V=y.paint.get("line-gradient"),ae=y.getCrossfadeParameters(),de=H?"linePattern":G?"lineSDF":V?"lineGradient":"line",J=p.context,oe=J.gl;let fe=!0;for(const me of x){const Me=_.getTile(me);if(H&&!Me.patternsLoaded())continue;const $e=Me.getBucket(y);if(!$e)continue;const De=$e.programConfigurations.get(y.id),Ve=p.context.program.get(),ot=p.useProgram(de,De),Ut=fe||ot.program!==Ve,Ze=p.style.map.terrain&&p.style.map.terrain.getTerrainData(me),xt=q.constantOr(null);if(xt&&Me.imageAtlas){const Vt=Me.imageAtlas,Lt=Vt.patternPositions[xt.to.toString()],qt=Vt.patternPositions[xt.from.toString()];Lt&&qt&&De.setConstantPatternPositions(Lt,qt)}const ut=Ze?me:null,hi=H?Ac(p,Me,y,ae,ut):G?dl(p,Me,y,G,ae,ut):V?hl(p,Me,y,$e.lineClipsArray.length,ut):Ws(p,Me,y,ut);if(H)J.activeTexture.set(oe.TEXTURE0),Me.imageAtlasTexture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE),De.updatePaintBuffers(ae);else if(G&&(Ut||p.lineAtlas.dirty))J.activeTexture.set(oe.TEXTURE0),p.lineAtlas.bind(J);else if(V){const Vt=$e.gradients[y.id];let Lt=Vt.texture;if(y.gradientVersion!==Vt.version){let qt=256;if(y.stepInterpolant){const Bi=_.getSource().maxzoom,fi=me.canonical.z===Bi?Math.ceil(1<<p.transform.maxZoom-me.canonical.z):1;qt=s.ad(s.aY($e.maxLineLength/s.N*1024*fi),256,J.maxTextureSize)}Vt.gradient=s.aZ({expression:y.gradientExpression(),evaluationKey:"lineProgress",resolution:qt,image:Vt.gradient||void 0,clips:$e.lineClipsArray}),Vt.texture?Vt.texture.update(Vt.gradient):Vt.texture=new Te(J,Vt.gradient,oe.RGBA),Vt.version=y.gradientVersion,Lt=Vt.texture}J.activeTexture.set(oe.TEXTURE0),Lt.bind(y.stepInterpolant?oe.NEAREST:oe.LINEAR,oe.CLAMP_TO_EDGE)}ot.draw(J,oe.TRIANGLES,P,p.stencilModeForClipping(me),B,Si.disabled,hi,Ze,y.id,$e.layoutVertexBuffer,$e.indexBuffer,$e.segments,y.paint,p.transform.zoom,De,$e.layoutVertexBuffer2),fe=!1}})(t,n,o,c);break;case"fill":(function(p,_,y,x){const C=y.paint.get("fill-color"),E=y.paint.get("fill-opacity");if(E.constantOr(1)===0)return;const P=p.colorModeForRenderPass(),B=y.paint.get("fill-pattern"),G=p.opaquePassEnabledForLayer()&&!B.constantOr(1)&&C.constantOr(s.aT.transparent).a===1&&E.constantOr(0)===1?"opaque":"translucent";if(p.renderPass===G){const q=p.depthModeForSublayer(1,p.renderPass==="opaque"?Kt.ReadWrite:Kt.ReadOnly);ka(p,_,y,x,q,P,!1)}if(p.renderPass==="translucent"&&y.paint.get("fill-antialias")){const q=p.depthModeForSublayer(y.getPaintProperty("fill-outline-color")?2:0,Kt.ReadOnly);ka(p,_,y,x,q,P,!0)}})(t,n,o,c);break;case"fill-extrusion":(function(p,_,y,x){const C=y.paint.get("fill-extrusion-opacity");if(C!==0&&p.renderPass==="translucent"){const E=new Kt(p.context.gl.LEQUAL,Kt.ReadWrite,p.depthRangeFor3D);if(C!==1||y.paint.get("fill-extrusion-pattern").constantOr(1))za(p,_,y,x,E,Ei.disabled,Ii.disabled),za(p,_,y,x,E,p.stencilModeFor3D(),p.colorModeForRenderPass());else{const P=p.colorModeForRenderPass();za(p,_,y,x,E,Ei.disabled,P)}}})(t,n,o,c);break;case"hillshade":(function(p,_,y,x){if(p.renderPass!=="offscreen"&&p.renderPass!=="translucent")return;const C=p.context,E=p.depthModeForSublayer(0,Kt.ReadOnly),P=p.colorModeForRenderPass(),[B,G]=p.renderPass==="translucent"?p.stencilConfigForOverlap(x):[{},x];for(const q of G){const H=_.getTile(q);H.needsHillshadePrepare!==void 0&&H.needsHillshadePrepare&&p.renderPass==="offscreen"?uo(p,H,y,E,Ei.disabled,P):p.renderPass==="translucent"&&$c(p,q,H,y,E,B[q.overscaledZ],P)}C.viewport.set([0,0,p.width,p.height])})(t,n,o,c);break;case"raster":(function(p,_,y,x){if(p.renderPass!=="translucent"||y.paint.get("raster-opacity")===0||!x.length)return;const C=p.context,E=C.gl,P=_.getSource(),B=p.useProgram("raster"),G=p.colorModeForRenderPass(),[q,H]=P instanceof kt?[{},x]:p.stencilConfigForOverlap(x),V=H[H.length-1].overscaledZ,ae=!p.options.moving;for(const de of H){const J=p.depthModeForSublayer(de.overscaledZ-V,y.paint.get("raster-opacity")===1?Kt.ReadWrite:Kt.ReadOnly,E.LESS),oe=_.getTile(de);oe.registerFadeDuration(y.paint.get("raster-fade-duration"));const fe=_.findLoadedParent(de,0),me=Oc(oe,fe,_,y,p.transform,p.style.map.terrain);let Me,$e;const De=y.paint.get("raster-resampling")==="nearest"?E.NEAREST:E.LINEAR;C.activeTexture.set(E.TEXTURE0),oe.texture.bind(De,E.CLAMP_TO_EDGE,E.LINEAR_MIPMAP_NEAREST),C.activeTexture.set(E.TEXTURE1),fe?(fe.texture.bind(De,E.CLAMP_TO_EDGE,E.LINEAR_MIPMAP_NEAREST),Me=Math.pow(2,fe.tileID.overscaledZ-oe.tileID.overscaledZ),$e=[oe.tileID.canonical.x*Me%1,oe.tileID.canonical.y*Me%1]):oe.texture.bind(De,E.CLAMP_TO_EDGE,E.LINEAR_MIPMAP_NEAREST);const Ve=p.style.map.terrain&&p.style.map.terrain.getTerrainData(de),ot=Ve?de:null,Ut=ot?ot.posMatrix:p.transform.calculatePosMatrix(de.toUnwrapped(),ae),Ze=fl(Ut,$e||[0,0],Me||1,me,y);P instanceof kt?B.draw(C,E.TRIANGLES,J,Ei.disabled,G,Si.disabled,Ze,Ve,y.id,P.boundsBuffer,p.quadTriangleIndexBuffer,P.boundsSegments):B.draw(C,E.TRIANGLES,J,q[de.overscaledZ],G,Si.disabled,Ze,Ve,y.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments)}})(t,n,o,c);break;case"background":(function(p,_,y,x){const C=y.paint.get("background-color"),E=y.paint.get("background-opacity");if(E===0)return;const P=p.context,B=P.gl,G=p.transform,q=G.tileSize,H=y.paint.get("background-pattern");if(p.isPatternMissing(H))return;const V=!H&&C.a===1&&E===1&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==V)return;const ae=Ei.disabled,de=p.depthModeForSublayer(0,V==="opaque"?Kt.ReadWrite:Kt.ReadOnly),J=p.colorModeForRenderPass(),oe=p.useProgram(H?"backgroundPattern":"background"),fe=x||G.coveringTiles({tileSize:q,terrain:p.style.map.terrain});H&&(P.activeTexture.set(B.TEXTURE0),p.imageManager.bind(p.context));const me=y.getCrossfadeParameters();for(const Me of fe){const $e=x?Me.posMatrix:p.transform.calculatePosMatrix(Me.toUnwrapped()),De=H?Hr($e,E,p,H,{tileID:Me,tileSize:q},me):as($e,E,C),Ve=p.style.map.terrain&&p.style.map.terrain.getTerrainData(Me);oe.draw(P,B.TRIANGLES,de,ae,J,Si.disabled,De,Ve,y.id,p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}})(t,0,o,c);break;case"custom":(function(p,_,y){const x=p.context,C=y.implementation;if(p.renderPass==="offscreen"){const E=C.prerender;E&&(p.setCustomLayerDefaults(),x.setColorMode(p.colorModeForRenderPass()),E.call(C,x.gl,p.transform.customLayerMatrix()),x.setDirty(),p.setBaseState())}else if(p.renderPass==="translucent"){p.setCustomLayerDefaults(),x.setColorMode(p.colorModeForRenderPass()),x.setStencilMode(Ei.disabled);const E=C.renderingMode==="3d"?new Kt(p.context.gl.LEQUAL,Kt.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,Kt.ReadOnly);x.setDepthMode(E),C.render(x.gl,p.transform.customLayerMatrix()),x.setDirty(),p.setBaseState(),x.bindFramebuffer.set(null)}})(t,0,o)}}translatePosMatrix(t,n,o,c,p){if(!o[0]&&!o[1])return t;const _=p?c==="map"?this.transform.angle:0:c==="viewport"?-this.transform.angle:0;if(_){const C=Math.sin(_),E=Math.cos(_);o=[o[0]*E-o[1]*C,o[0]*C+o[1]*E]}const y=[p?o[0]:re(n,o[0],this.transform.zoom),p?o[1]:re(n,o[1],this.transform.zoom),0],x=new Float32Array(16);return s.$(x,t,y),x}saveTileTexture(t){const n=this._tileTextures[t.size[0]];n?n.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const n=this._tileTextures[t];return n&&n.length>0?n.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const n=this.imageManager.getPattern(t.from.toString()),o=this.imageManager.getPattern(t.to.toString());return!n||!o}useProgram(t,n){this.cache=this.cache||{};const o=t+(n?n.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[o]||(this.cache[o]=new ts(this.context,Ti[t],n,ss[t],this._showOverdrawInspector,this.style.map.terrain)),this.cache[o]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Te(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:n}=this.context.gl;return this.width!==t||this.height!==n}}class Cr{constructor(t,n){this.points=t,this.planes=n}static fromInvProjectionMatrix(t,n,o){const c=Math.pow(2,o),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(y=>{const x=1/(y=s.ag([],y,t))[3]/n*c;return s.b3(y,y,[x,x,1/y[3],x])}),_=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(y=>{const x=function(B,G){var q=G[0],H=G[1],V=G[2],ae=q*q+H*H+V*V;return ae>0&&(ae=1/Math.sqrt(ae)),B[0]=G[0]*ae,B[1]=G[1]*ae,B[2]=G[2]*ae,B}([],function(B,G,q){var H=G[0],V=G[1],ae=G[2],de=q[0],J=q[1],oe=q[2];return B[0]=V*oe-ae*J,B[1]=ae*de-H*oe,B[2]=H*J-V*de,B}([],Re([],p[y[0]],p[y[1]]),Re([],p[y[2]],p[y[1]]))),C=-((E=x)[0]*(P=p[y[1]])[0]+E[1]*P[1]+E[2]*P[2]);var E,P;return x.concat(C)});return new Cr(p,_)}}class ua{constructor(t,n){this.min=t,this.max=n,this.center=function(o,c,p){return o[0]=.5*c[0],o[1]=.5*c[1],o[2]=.5*c[2],o}([],function(o,c,p){return o[0]=c[0]+p[0],o[1]=c[1]+p[1],o[2]=c[2]+p[2],o}([],this.min,this.max))}quadrant(t){const n=[t%2==0,t<2],o=xe(this.min),c=xe(this.max);for(let p=0;p<n.length;p++)o[p]=n[p]?this.min[p]:this.center[p],c[p]=n[p]?this.center[p]:this.max[p];return c[2]=this.max[2],new ua(o,c)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const n=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let o=!0;for(let c=0;c<t.planes.length;c++){const p=t.planes[c];let _=0;for(let y=0;y<n.length;y++)s.b4(p,n[y])>=0&&_++;if(_===0)return 0;_!==n.length&&(o=!1)}if(o)return 2;for(let c=0;c<3;c++){let p=Number.MAX_VALUE,_=-Number.MAX_VALUE;for(let y=0;y<t.points.length;y++){const x=t.points[y][c]-this.min[c];p=Math.min(p,x),_=Math.max(_,x)}if(_<0||p>this.max[c]-this.min[c])return 0}return 1}}class La{constructor(t=0,n=0,o=0,c=0){if(isNaN(t)||t<0||isNaN(n)||n<0||isNaN(o)||o<0||isNaN(c)||c<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=n,this.left=o,this.right=c}interpolate(t,n,o){return n.top!=null&&t.top!=null&&(this.top=s.B.number(t.top,n.top,o)),n.bottom!=null&&t.bottom!=null&&(this.bottom=s.B.number(t.bottom,n.bottom,o)),n.left!=null&&t.left!=null&&(this.left=s.B.number(t.left,n.left,o)),n.right!=null&&t.right!=null&&(this.right=s.B.number(t.right,n.right,o)),this}getCenter(t,n){const o=s.ad((this.left+t-this.right)/2,0,t),c=s.ad((this.top+n-this.bottom)/2,0,n);return new s.P(o,c)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new La(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class bs{constructor(t,n,o,c,p){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=p===void 0||!!p,this._minZoom=t||0,this._maxZoom=n||22,this._minPitch=o??0,this._maxPitch=c??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new s.L(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new La,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const t=new bs(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this._minEleveationForCurrentTile=t._minEleveationForCurrentTile,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const n=-s.b5(t,-180,180)*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=function(){var o=new s.A(4);return s.A!=Float32Array&&(o[1]=0,o[2]=0),o[0]=1,o[3]=1,o}(),function(o,c,p){var _=c[0],y=c[1],x=c[2],C=c[3],E=Math.sin(p),P=Math.cos(p);o[0]=_*P+x*E,o[1]=y*P+C*E,o[2]=_*-E+x*P,o[3]=y*-E+C*P}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const n=s.ad(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const n=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==n&&(this._unmodified=!1,this._zoom=n,this.tileZoom=Math.max(0,Math.floor(n)),this.scale=this.zoomScale(n),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,n,o){this._unmodified=!1,this._edgeInsets.interpolate(t,n,o),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const n=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,n)}getVisibleUnwrappedCoordinates(t){const n=[new s.b6(0,t)];if(this._renderWorldCopies){const o=this.pointCoordinate(new s.P(0,0)),c=this.pointCoordinate(new s.P(this.width,0)),p=this.pointCoordinate(new s.P(this.width,this.height)),_=this.pointCoordinate(new s.P(0,this.height)),y=Math.floor(Math.min(o.x,c.x,p.x,_.x)),x=Math.floor(Math.max(o.x,c.x,p.x,_.x)),C=1;for(let E=y-C;E<=x+C;E++)E!==0&&n.push(new s.b6(E,t))}return n}coveringTiles(t){var n,o;let c=this.coveringZoomLevel(t);const p=c;if(t.minzoom!==void 0&&c<t.minzoom)return[];t.maxzoom!==void 0&&c>t.maxzoom&&(c=t.maxzoom);const _=this.pointCoordinate(this.getCameraPoint()),y=s.U.fromLngLat(this.center),x=Math.pow(2,c),C=[x*_.x,x*_.y,0],E=[x*y.x,x*y.y,0],P=Cr.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c);let B=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(B=c);const G=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,q=J=>({aabb:new ua([J*x,0,0],[(J+1)*x,x,0]),zoom:0,x:0,y:0,wrap:J,fullyVisible:!1}),H=[],V=[],ae=c,de=t.reparseOverscaled?p:c;if(this._renderWorldCopies)for(let J=1;J<=3;J++)H.push(q(-J)),H.push(q(J));for(H.push(q(0));H.length>0;){const J=H.pop(),oe=J.x,fe=J.y;let me=J.fullyVisible;if(!me){const ot=J.aabb.intersects(P);if(ot===0)continue;me=ot===2}const Me=t.terrain?C:E,$e=J.aabb.distanceX(Me),De=J.aabb.distanceY(Me),Ve=Math.max(Math.abs($e),Math.abs(De));if(J.zoom===ae||Ve>G+(1<<ae-J.zoom)-2&&J.zoom>=B){const ot=ae-J.zoom,Ut=C[0]-.5-(oe<<ot),Ze=C[1]-.5-(fe<<ot);V.push({tileID:new s.O(J.zoom===ae?de:J.zoom,J.wrap,J.zoom,oe,fe),distanceSq:Ne([E[0]-.5-oe,E[1]-.5-fe]),tileDistanceToCamera:Math.sqrt(Ut*Ut+Ze*Ze)})}else for(let ot=0;ot<4;ot++){const Ut=(oe<<1)+ot%2,Ze=(fe<<1)+(ot>>1),xt=J.zoom+1;let ut=J.aabb.quadrant(ot);if(t.terrain){const hi=new s.O(xt,J.wrap,xt,Ut,Ze),Vt=t.terrain.getMinMaxElevation(hi),Lt=(n=Vt.minElevation)!==null&&n!==void 0?n:this.elevation,qt=(o=Vt.maxElevation)!==null&&o!==void 0?o:this.elevation;ut=new ua([ut.min[0],ut.min[1],Lt],[ut.max[0],ut.max[1],qt])}H.push({aabb:ut,zoom:xt,x:Ut,y:Ze,wrap:J.wrap,fullyVisible:me})}}return V.sort((J,oe)=>J.distanceSq-oe.distanceSq).map(J=>J.tileID)}resize(t,n){this.width=t,this.height=n,this.pixelsToGLUnits=[2/t,-2/n],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const n=s.ad(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new s.P(s.G(t.lng)*this.worldSize,s.H(n)*this.worldSize)}unproject(t){return new s.U(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const n=this.pointLocation(this.centerPoint,t),o=t.getElevationForLngLatZoom(n,this.tileZoom);if(!(this.elevation-o))return;const c=this.getCameraPosition(),p=s.U.fromLngLat(c.lngLat,c.altitude),_=s.U.fromLngLat(n,o),y=p.x-_.x,x=p.y-_.y,C=p.z-_.z,E=Math.sqrt(y*y+x*x+C*C),P=this.scaleZoom(this.cameraToCenterDistance/E/this.tileSize);this._elevation=o,this._center=n,this.zoom=P}setLocationAtPoint(t,n){const o=this.pointCoordinate(n),c=this.pointCoordinate(this.centerPoint),p=this.locationCoordinate(t),_=new s.U(p.x-(o.x-c.x),p.y-(o.y-c.y));this.center=this.coordinateLocation(_),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,n){return n?this.coordinatePoint(this.locationCoordinate(t),n.getElevationForLngLatZoom(t,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,n){return this.coordinateLocation(this.pointCoordinate(t,n))}locationCoordinate(t){return s.U.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,n){if(n){const B=n.pointCoordinate(t);if(B!=null)return B}const o=[t.x,t.y,0,1],c=[t.x,t.y,1,1];s.ag(o,o,this.pixelMatrixInverse),s.ag(c,c,this.pixelMatrixInverse);const p=o[3],_=c[3],y=o[1]/p,x=c[1]/_,C=o[2]/p,E=c[2]/_,P=C===E?0:(0-C)/(E-C);return new s.U(s.B.number(o[0]/p,c[0]/_,P)/this.worldSize,s.B.number(y,x,P)/this.worldSize)}coordinatePoint(t,n=0,o=this.pixelMatrix){const c=[t.x*this.worldSize,t.y*this.worldSize,n,1];return s.ag(c,c,o),new s.P(c[0]/c[3],c[1]/c[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new Be().extend(this.pointLocation(new s.P(0,t))).extend(this.pointLocation(new s.P(this.width,t))).extend(this.pointLocation(new s.P(this.width,this.height))).extend(this.pointLocation(new s.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Be([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(t,n=!1){const o=t.key,c=n?this._alignedPosMatrixCache:this._posMatrixCache;if(c[o])return c[o];const p=t.canonical,_=this.worldSize/this.zoomScale(p.z),y=p.x+Math.pow(2,p.z)*t.wrap,x=s.ao(new Float64Array(16));return s.$(x,x,[y*_,p.y*_,0]),s.a0(x,x,[_/s.N,_/s.N,1]),s.a1(x,n?this.alignedProjMatrix:this.projMatrix,x),c[o]=new Float32Array(x),c[o]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t,n,o,c,p=-90,_=90,y=-180,x=180;const C=this.size,E=this._unmodified;if(this.latRange){const G=this.latRange;p=s.H(G[1])*this.worldSize,_=s.H(G[0])*this.worldSize,t=_-p<C.y?C.y/(_-p):0}if(this.lngRange){const G=this.lngRange;y=s.b5(s.G(G[0])*this.worldSize,0,this.worldSize),x=s.b5(s.G(G[1])*this.worldSize,0,this.worldSize),x<y&&(x+=this.worldSize),n=x-y<C.x?C.x/(x-y):0}const P=this.point,B=Math.max(n||0,t||0);if(B)return this.center=this.unproject(new s.P(n?(x+y)/2:P.x,t?(_+p)/2:P.y)),this.zoom+=this.scaleZoom(B),this._unmodified=E,void(this._constraining=!1);if(this.latRange){const G=P.y,q=C.y/2;G-q<p&&(c=p+q),G+q>_&&(c=_-q)}if(this.lngRange){const G=(y+x)/2,q=s.b5(P.x,G-this.worldSize/2,G+this.worldSize/2),H=C.x/2;q-H<y&&(o=y+H),q+H>x&&(o=x-H)}o===void 0&&c===void 0||(this.center=this.unproject(new s.P(o!==void 0?o:P.x,c!==void 0?c:P.y)).wrap()),this._unmodified=E,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,n=this.point.x,o=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=s.b7(1,this.center.lat)*this.worldSize;let c=s.ao(new Float64Array(16));s.a0(c,c,[this.width/2,-this.height/2,1]),s.$(c,c,[1,-1,0]),this.labelPlaneMatrix=c,c=s.ao(new Float64Array(16)),s.a0(c,c,[1,-1,1]),s.$(c,c,[-1,-1,0]),s.a0(c,c,[2/this.width,2/this.height,1]),this.glCoordMatrix=c;const p=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),_=Math.min(this.elevation,this._minEleveationForCurrentTile),y=p-_*this._pixelPerMeter/Math.cos(this._pitch),x=_<0?y:p,C=Math.PI/2+this._pitch,E=this._fov*(.5+t.y/this.height),P=Math.sin(E)*x/Math.sin(s.ad(Math.PI-C-E,.01,Math.PI-.01)),B=this.getHorizon(),G=2*Math.atan(B/this.cameraToCenterDistance)*(.5+t.y/(2*B)),q=Math.sin(G)*x/Math.sin(s.ad(Math.PI-C-G,.01,Math.PI-.01)),H=Math.min(P,q),V=1.01*(Math.cos(Math.PI/2-this._pitch)*H+x),ae=this.height/50;c=new Float64Array(16),s.b8(c,this._fov,this.width/this.height,ae,V),c[8]=2*-t.x/this.width,c[9]=2*t.y/this.height,s.a0(c,c,[1,-1,1]),s.$(c,c,[0,0,-this.cameraToCenterDistance]),s.b9(c,c,this._pitch),s.ae(c,c,this.angle),s.$(c,c,[-n,-o,0]),this.mercatorMatrix=s.a0([],c,[this.worldSize,this.worldSize,this.worldSize]),s.a0(c,c,[1,1,this._pixelPerMeter]),this.pixelMatrix=s.a1(new Float64Array(16),this.labelPlaneMatrix,c),s.$(c,c,[0,0,-this.elevation]),this.projMatrix=c,this.invProjMatrix=s.as([],c),this.pixelMatrix3D=s.a1(new Float64Array(16),this.labelPlaneMatrix,c);const de=this.width%2/2,J=this.height%2/2,oe=Math.cos(this.angle),fe=Math.sin(this.angle),me=n-Math.round(n)+oe*de+fe*J,Me=o-Math.round(o)+oe*J+fe*de,$e=new Float64Array(c);if(s.$($e,$e,[me>.5?me-1:me,Me>.5?Me-1:Me,0]),this.alignedProjMatrix=$e,c=s.as(new Float64Array(16),this.pixelMatrix),!c)throw new Error("failed to invert matrix");this.pixelMatrixInverse=c,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new s.P(0,0)),n=[t.x*this.worldSize,t.y*this.worldSize,0,1];return s.ag(n,n,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,t))}getCameraQueryGeometry(t){const n=this.getCameraPoint();if(t.length===1)return[t[0],n];{let o=n.x,c=n.y,p=n.x,_=n.y;for(const y of t)o=Math.min(o,y.x),c=Math.min(c,y.y),p=Math.max(p,y.x),_=Math.max(_,y.y);return[new s.P(o,c),new s.P(p,c),new s.P(p,_),new s.P(o,_),new s.P(o,c)]}}}function Hn(h,t){let n,o=!1,c=null,p=null;const _=()=>{c=null,o&&(h.apply(p,n),c=setTimeout(_,t),o=!1)};return(...y)=>(o=!0,p=this,n=y,c||_(),c)}class Ra{constructor(t){this._getCurrentHash=()=>{const n=window.location.hash.replace("#","");if(this._hashName){let o;return n.split("&").map(c=>c.split("=")).forEach(c=>{c[0]===this._hashName&&(o=c)}),(o&&o[1]||"").split("/")}return n.split("/")},this._onHashChange=()=>{const n=this._getCurrentHash();if(n.length>=3&&!n.some(o=>isNaN(o))){const o=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:o,pitch:+(n[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const n=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,n)}catch{}},this._updateHash=Hn(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const n=this._map.getCenter(),o=Math.round(100*this._map.getZoom())/100,c=Math.ceil((o*Math.LN2+Math.log(512/360/.5))/Math.LN10),p=Math.pow(10,c),_=Math.round(n.lng*p)/p,y=Math.round(n.lat*p)/p,x=this._map.getBearing(),C=this._map.getPitch();let E="";if(E+=t?`/${_}/${y}/${o}`:`${o}/${y}/${_}`,(x||C)&&(E+="/"+Math.round(10*x)/10),C&&(E+=`/${Math.round(C)}`),this._hashName){const P=this._hashName;let B=!1;const G=window.location.hash.slice(1).split("&").map(q=>{const H=q.split("=")[0];return H===P?(B=!0,`${H}=${E}`):q}).filter(q=>q);return B||G.push(`${P}=${E}`),`#${G.join("&")}`}return`#${E}`}}const ha={linearity:.3,easing:s.ba(0,0,.3,1)},El=s.e({deceleration:2500,maxSpeed:1400},ha),Pl=s.e({deceleration:20,maxSpeed:1400},ha),Ml=s.e({deceleration:1e3,maxSpeed:360},ha),Al=s.e({deceleration:1e3,maxSpeed:90},ha);class kl{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.h.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,n=s.h.now();for(;t.length>0&&n-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:p}of this._inertiaBuffer)n.zoom+=p.zoomDelta||0,n.bearing+=p.bearingDelta||0,n.pitch+=p.pitchDelta||0,p.panDelta&&n.pan._add(p.panDelta),p.around&&(n.around=p.around),p.pinchAround&&(n.pinchAround=p.pinchAround);const o=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,c={};if(n.pan.mag()){const p=Ba(n.pan.mag(),o,s.e({},El,t||{}));c.offset=n.pan.mult(p.amount/n.pan.mag()),c.center=this._map.transform.center,on(c,p)}if(n.zoom){const p=Ba(n.zoom,o,Pl);c.zoom=this._map.transform.zoom+p.amount,on(c,p)}if(n.bearing){const p=Ba(n.bearing,o,Ml);c.bearing=this._map.transform.bearing+s.ad(p.amount,-179,179),on(c,p)}if(n.pitch){const p=Ba(n.pitch,o,Al);c.pitch=this._map.transform.pitch+p.amount,on(c,p)}if(c.zoom||c.bearing){const p=n.pinchAround===void 0?n.around:n.pinchAround;c.around=p?this._map.unproject(p):this._map.getCenter()}return this.clear(),s.e(c,{noMoveStart:!0})}}function on(h,t){(!h.duration||h.duration<t.duration)&&(h.duration=t.duration,h.easing=t.easing)}function Ba(h,t,n){const{maxSpeed:o,linearity:c,deceleration:p}=n,_=s.ad(h*c/(t/1e3),-o,o),y=Math.abs(_)/(p*c);return{easing:n.easing,duration:1e3*y,amount:_*(y/2)}}class Rr extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,o,c={}){const p=L.mousePos(n.getCanvasContainer(),o),_=n.unproject(p);super(t,s.e({point:p,lngLat:_,originalEvent:o},c)),this._defaultPrevented=!1,this.target=n}}class Fa extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,o){const c=t==="touchend"?o.changedTouches:o.touches,p=L.touchPos(n.getCanvasContainer(),c),_=p.map(x=>n.unproject(x)),y=p.reduce((x,C,E,P)=>x.add(C.div(P.length)),new s.P(0,0));super(t,{points:p,point:y,lngLats:_,lngLat:n.unproject(y),originalEvent:o}),this._defaultPrevented=!1}}class zl extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,o){super(t,{originalEvent:o}),this._defaultPrevented=!1}}class Dl{constructor(t,n){this._map=t,this._clickTolerance=n.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new zl(t.type,this._map,t))}mousedown(t,n){return this._mousedownPos=n,this._firePreventable(new Rr(t.type,this._map,t))}mouseup(t){this._map.fire(new Rr(t.type,this._map,t))}click(t,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||this._map.fire(new Rr(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Rr(t.type,this._map,t))}mouseover(t){this._map.fire(new Rr(t.type,this._map,t))}mouseout(t){this._map.fire(new Rr(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Fa(t.type,this._map,t))}touchmove(t){this._map.fire(new Fa(t.type,this._map,t))}touchend(t){this._map.fire(new Fa(t.type,this._map,t))}touchcancel(t){this._map.fire(new Fa(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ll{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Rr(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Rr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Rr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class gn{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(s.P.convert(t),this._map.terrain)}}class Rl{constructor(t,n){this._map=t,this._tr=new gn(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,n){this.isEnabled()&&t.shiftKey&&t.button===0&&(L.disableDrag(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(t,n){if(!this._active)return;const o=n;if(this._lastPos.equals(o)||!this._box&&o.dist(this._startPos)<this._clickTolerance)return;const c=this._startPos;this._lastPos=o,this._box||(this._box=L.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const p=Math.min(c.x,o.x),_=Math.max(c.x,o.x),y=Math.min(c.y,o.y),x=Math.max(c.y,o.y);L.setTransform(this._box,`translate(${p}px,${y}px)`),this._box.style.width=_-p+"px",this._box.style.height=x-y+"px"}mouseupWindow(t,n){if(!this._active||t.button!==0)return;const o=this._startPos,c=n;if(this.reset(),L.suppressClick(),o.x!==c.x||o.y!==c.y)return this._map.fire(new s.k("boxzoomend",{originalEvent:t})),{cameraAnimation:p=>p.fitScreenCoordinates(o,c,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(L.remove(this._box),this._box=null),L.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,n){return this._map.fire(new s.k(t,{originalEvent:n}))}}function Wr(h,t){if(h.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${h.length}, points ${t.length}`);const n={};for(let o=0;o<h.length;o++)n[h[o].identifier]=t[o];return n}class _n{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,n,o){(this.centroid||o.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),o.length===this.numTouches&&(this.centroid=function(c){const p=new s.P(0,0);for(const _ of c)p._add(_);return p.div(c.length)}(n),this.touches=Wr(o,n)))}touchmove(t,n,o){if(this.aborted||!this.centroid)return;const c=Wr(o,n);for(const p in this.touches){const _=c[p];(!_||_.dist(this.touches[p])>30)&&(this.aborted=!0)}}touchend(t,n,o){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),o.length===0){const c=!this.aborted&&this.centroid;if(this.reset(),c)return c}}}class ws{constructor(t){this.singleTap=new _n(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,n,o){this.singleTap.touchstart(t,n,o)}touchmove(t,n,o){this.singleTap.touchmove(t,n,o)}touchend(t,n,o){const c=this.singleTap.touchend(t,n,o);if(c){const p=t.timeStamp-this.lastTime<500,_=!this.lastTap||this.lastTap.dist(c)<30;if(p&&_||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=c,this.count===this.numTaps)return this.reset(),c}}}class yn{constructor(t){this._tr=new gn(t),this._zoomIn=new ws({numTouches:1,numTaps:2}),this._zoomOut=new ws({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,n,o){this._zoomIn.touchstart(t,n,o),this._zoomOut.touchstart(t,n,o)}touchmove(t,n,o){this._zoomIn.touchmove(t,n,o),this._zoomOut.touchmove(t,n,o)}touchend(t,n,o){const c=this._zoomIn.touchend(t,n,o),p=this._zoomOut.touchend(t,n,o),_=this._tr;return c?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:y=>y.easeTo({duration:300,zoom:_.zoom+1,around:_.unproject(c)},{originalEvent:t})}):p?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:y=>y.easeTo({duration:300,zoom:_.zoom-1,around:_.unproject(p)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vn{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const n=this._moveFunction(...t);if(n.bearingDelta||n.pitchDelta||n.around||n.panDelta)return this._active=!0,n}dragStart(t,n){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=n.length?n[0]:n,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,n){if(!this.isEnabled())return;const o=this._lastPoint;if(!o)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const c=n.length?n[0]:n;return!this._moved&&c.dist(o)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=c,this._move(o,c))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&L.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Nc={0:1,2:2};class po{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const n=L.mouseButton(t);this._eventButton=n}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(n,o){const c=Nc[o];return n.buttons===void 0||(n.buttons&c)!==c}(t,this._eventButton)}isValidEndEvent(t){return L.mouseButton(t)===this._eventButton}}class Bl{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}const Ss=h=>{h.mousedown=h.dragStart,h.mousemoveWindow=h.dragMove,h.mouseup=h.dragEnd,h.contextmenu=function(t){t.preventDefault()}},da=({enable:h,clickTolerance:t,bearingDegreesPerPixelMoved:n=.8})=>{const o=new po({checkCorrectEvent:c=>L.mouseButton(c)===0&&c.ctrlKey||L.mouseButton(c)===2});return new vn({clickTolerance:t,move:(c,p)=>({bearingDelta:(p.x-c.x)*n}),moveStateManager:o,enable:h,assignEvents:Ss})},xn=({enable:h,clickTolerance:t,pitchDegreesPerPixelMoved:n=-.5})=>{const o=new po({checkCorrectEvent:c=>L.mouseButton(c)===0&&c.ctrlKey||L.mouseButton(c)===2});return new vn({clickTolerance:t,move:(c,p)=>({pitchDelta:(p.y-c.y)*n}),moveStateManager:o,enable:h,assignEvents:Ss})};class it{constructor(t,n){this._minTouches=t.cooperativeGestures?2:1,this._clickTolerance=t.clickTolerance||1,this._map=n,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(t,n,o){return this._calculateTransform(t,n,o)}touchmove(t,n,o){if(this._map._cooperativeGestures&&(this._minTouches===2&&o.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(t,!1,o.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(o.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,n,o)}touchend(t,n,o){this._calculateTransform(t,n,o),this._active&&o.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,n,o){o.length>0&&(this._active=!0);const c=Wr(o,n),p=new s.P(0,0),_=new s.P(0,0);let y=0;for(const C in c){const E=c[C],P=this._touches[C];P&&(p._add(E),_._add(E.sub(P)),y++,c[C]=E)}if(this._touches=c,y<this._minTouches||!_.mag())return;const x=_.div(y);return this._sum._add(x),this._sum.mag()<this._clickTolerance?void 0:{around:p.div(y),panDelta:x}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Cs{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,n,o){this._firstTwoTouches||o.length<2||(this._firstTwoTouches=[o[0].identifier,o[1].identifier],this._start([n[0],n[1]]))}touchmove(t,n,o){if(!this._firstTwoTouches)return;t.preventDefault();const[c,p]=this._firstTwoTouches,_=Dn(o,n,c),y=Dn(o,n,p);if(!_||!y)return;const x=this._aroundCenter?null:_.add(y).div(2);return this._move([_,y],x,t)}touchend(t,n,o){if(!this._firstTwoTouches)return;const[c,p]=this._firstTwoTouches,_=Dn(o,n,c),y=Dn(o,n,p);_&&y||(this._active&&L.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Dn(h,t,n){for(let o=0;o<h.length;o++)if(h[o].identifier===n)return t[o]}function pa(h,t){return Math.log(h/t)/Math.LN2}class Fl extends Cs{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,n){const o=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(pa(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:pa(this._distance,o),pinchAround:n}}}function Qe(h,t){return 180*h.angleWith(t)/Math.PI}class fo extends Cs{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,n){const o=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Qe(this._vector,o),pinchAround:n}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const n=25/(Math.PI*this._minDiameter)*360,o=Qe(t,this._startVector);return Math.abs(o)<n}}function mo(h){return Math.abs(h.y)>Math.abs(h.x)}class jc extends Cs{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,n,o){super.touchstart(t,n,o),this._currentTouchCount=o.length}_start(t){this._lastPoints=t,mo(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,n,o){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const c=t[0].sub(this._lastPoints[0]),p=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(c,p,o.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(c.y+p.y)/2*-.5}):void 0}gestureBeginsVertically(t,n,o){if(this._valid!==void 0)return this._valid;const c=t.mag()>=2,p=n.mag()>=2;if(!c&&!p)return;if(!c||!p)return this._firstMove===void 0&&(this._firstMove=o),o-this._firstMove<100&&void 0;const _=t.y>0==n.y>0;return mo(t)&&mo(n)&&_}}const go={panStep:100,bearingStep:15,pitchStep:10};class $l{constructor(t){this._tr=new gn(t);const n=go;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let n=0,o=0,c=0,p=0,_=0;switch(t.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:t.shiftKey?o=-1:(t.preventDefault(),p=-1);break;case 39:t.shiftKey?o=1:(t.preventDefault(),p=1);break;case 38:t.shiftKey?c=1:(t.preventDefault(),_=-1);break;case 40:t.shiftKey?c=-1:(t.preventDefault(),_=1);break;default:return}return this._rotationDisabled&&(o=0,c=0),{cameraAnimation:y=>{const x=this._tr;y.easeTo({duration:300,easeId:"keyboardHandler",easing:Ol,zoom:n?Math.round(x.zoom)+n*(t.shiftKey?2:1):x.zoom,bearing:x.bearing+o*this._bearingStep,pitch:x.pitch+c*this._pitchStep,offset:[-p*this._panStep,-_*this._panStep],center:x.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Ol(h){return h*(2-h)}const Nl=4.000244140625;class Vc{constructor(t,n){this._onTimeout=o=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)},this._map=t,this._tr=new gn(t),this._el=t.getCanvasContainer(),this._triggerRenderFrame=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!t[this._map._metaKey])return;t.preventDefault()}let n=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const o=s.h.now(),c=o-(this._lastWheelEventTime||0);this._lastWheelEventTime=o,n!==0&&n%Nl==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":c>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(c*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),t.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=t,this._delta-=n,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=L.mousePos(this._el,t),o=this._tr;this._around=s.L.convert(this._aroundCenter?o.center:o.unproject(n)),this._aroundPoint=o.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(this._delta!==0){const y=this._type==="wheel"&&Math.abs(this._delta)>Nl?this._wheelZoomRate:this._defaultZoomRate;let x=2/(1+Math.exp(-Math.abs(this._delta*y)));this._delta<0&&x!==0&&(x=1/x);const C=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(C*x))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const n=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,o=this._startZoom,c=this._easing;let p,_=!1;if(this._type==="wheel"&&o&&c){const y=Math.min((s.h.now()-this._lastWheelEventTime)/200,1),x=c(y);p=s.B.number(o,n,x),y<1?this._frameId||(this._frameId=!0):_=!0}else p=n,_=!0;return this._active=!0,_&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!_,zoomDelta:p-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let n=s.bb;if(this._prevEase){const o=this._prevEase,c=(s.h.now()-o.start)/o.duration,p=o.easing(c+.01)-o.easing(c),_=.27/Math.sqrt(p*p+1e-4)*.01,y=Math.sqrt(.0729-_*_);n=s.ba(_,y,.25,1)}return this._prevEase={start:s.h.now(),duration:t,easing:n},n}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class _o{constructor(t,n){this._clickZoom=t,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class yo{constructor(t){this._tr=new gn(t),this.reset()}reset(){this._active=!1}dblclick(t,n){return t.preventDefault(),{cameraAnimation:o=>{o.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(n)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vo{constructor(){this._tap=new ws({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,n,o){if(!this._swipePoint)if(this._tapTime){const c=n[0],p=t.timeStamp-this._tapTime<500,_=this._tapPoint.dist(c)<30;p&&_?o.length>0&&(this._swipePoint=c,this._swipeTouch=o[0].identifier):this.reset()}else this._tap.touchstart(t,n,o)}touchmove(t,n,o){if(this._tapTime){if(this._swipePoint){if(o[0].identifier!==this._swipeTouch)return;const c=n[0],p=c.y-this._swipePoint.y;return this._swipePoint=c,t.preventDefault(),this._active=!0,{zoomDelta:p/128}}}else this._tap.touchmove(t,n,o)}touchend(t,n,o){if(this._tapTime)this._swipePoint&&o.length===0&&this.reset();else{const c=this._tap.touchend(t,n,o);c&&(this._tapTime=t.timeStamp,this._tapPoint=c)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xo{constructor(t,n,o){this._el=t,this._mousePan=n,this._touchPan=o}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Tr{constructor(t,n,o){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=n,this._mousePitch=o}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ln{constructor(t,n,o,c){this._el=t,this._touchZoom=n,this._touchRotate=o,this._tapDragZoom=c,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const $a=h=>h.zoom||h.drag||h.pitch||h.rotate;class bo extends s.k{}function Oa(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class wo{constructor(t,n){this.handleWindowEvent=c=>{this.handleEvent(c,`${c.type}Window`)},this.handleEvent=(c,p)=>{if(c.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const _=c.type==="renderFrame"?void 0:c,y={needsRenderFrame:!1},x={},C={},E=c.touches,P=E?this._getMapTouches(E):void 0,B=P?L.touchPos(this._el,P):L.mousePos(this._el,c);for(const{handlerName:H,handler:V,allowed:ae}of this._handlers){if(!V.isEnabled())continue;let de;this._blockedByActive(C,ae,H)?V.reset():V[p||c.type]&&(de=V[p||c.type](c,B,P),this.mergeHandlerResult(y,x,de,H,_),de&&de.needsRenderFrame&&this._triggerRenderFrame()),(de||V.isActive())&&(C[H]=V)}const G={};for(const H in this._previousActiveHandlers)C[H]||(G[H]=_);this._previousActiveHandlers=C,(Object.keys(G).length||Oa(y))&&(this._changes.push([y,x,G]),this._triggerRenderFrame()),(Object.keys(C).length||Oa(y))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:q}=y;q&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],q(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new kl(t),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(n);const o=this._el;this._listeners=[[o,"touchstart",{passive:!0}],[o,"touchmove",{passive:!1}],[o,"touchend",void 0],[o,"touchcancel",void 0],[o,"mousedown",void 0],[o,"mousemove",void 0],[o,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[o,"mouseover",void 0],[o,"mouseout",void 0],[o,"dblclick",void 0],[o,"click",void 0],[o,"keydown",{capture:!1}],[o,"keyup",void 0],[o,"wheel",{passive:!1}],[o,"contextmenu",void 0],[window,"blur",void 0]];for(const[c,p,_]of this._listeners)L.addEventListener(c,p,c===document?this.handleWindowEvent:this.handleEvent,_)}destroy(){for(const[t,n,o]of this._listeners)L.removeEventListener(t,n,t===document?this.handleWindowEvent:this.handleEvent,o)}_addDefaultHandlers(t){const n=this._map,o=n.getCanvasContainer();this._add("mapEvent",new Dl(n,t));const c=n.boxZoom=new Rl(n,t);this._add("boxZoom",c),t.interactive&&t.boxZoom&&c.enable();const p=new yn(n),_=new yo(n);n.doubleClickZoom=new _o(_,p),this._add("tapZoom",p),this._add("clickZoom",_),t.interactive&&t.doubleClickZoom&&n.doubleClickZoom.enable();const y=new vo;this._add("tapDragZoom",y);const x=n.touchPitch=new jc(n);this._add("touchPitch",x),t.interactive&&t.touchPitch&&n.touchPitch.enable(t.touchPitch);const C=da(t),E=xn(t);n.dragRotate=new Tr(t,C,E),this._add("mouseRotate",C,["mousePitch"]),this._add("mousePitch",E,["mouseRotate"]),t.interactive&&t.dragRotate&&n.dragRotate.enable();const P=(({enable:ae,clickTolerance:de})=>{const J=new po({checkCorrectEvent:oe=>L.mouseButton(oe)===0&&!oe.ctrlKey});return new vn({clickTolerance:de,move:(oe,fe)=>({around:fe,panDelta:fe.sub(oe)}),activateOnStart:!0,moveStateManager:J,enable:ae,assignEvents:Ss})})(t),B=new it(t,n);n.dragPan=new xo(o,P,B),this._add("mousePan",P),this._add("touchPan",B,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&n.dragPan.enable(t.dragPan);const G=new fo,q=new Fl;n.touchZoomRotate=new Ln(o,q,G,y),this._add("touchRotate",G,["touchPan","touchZoom"]),this._add("touchZoom",q,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&n.touchZoomRotate.enable(t.touchZoomRotate);const H=n.scrollZoom=new Vc(n,()=>this._triggerRenderFrame());this._add("scrollZoom",H,["mousePan"]),t.interactive&&t.scrollZoom&&n.scrollZoom.enable(t.scrollZoom);const V=n.keyboard=new $l(n);this._add("keyboard",V),t.interactive&&t.keyboard&&n.keyboard.enable(),this._add("blockableMapEvent",new Ll(n))}_add(t,n,o){this._handlers.push({handlerName:t,handler:n,allowed:o}),this._handlersById[t]=n}stop(t){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!$a(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,n,o){for(const c in t)if(c!==o&&(!n||n.indexOf(c)<0))return!0;return!1}_getMapTouches(t){const n=[];for(const o of t)this._el.contains(o.target)&&n.push(o);return n}mergeHandlerResult(t,n,o,c,p){if(!o)return;s.e(t,o);const _={handlerName:c,originalEvent:o.originalEvent||p};o.zoomDelta!==void 0&&(n.zoom=_),o.panDelta!==void 0&&(n.drag=_),o.pitchDelta!==void 0&&(n.pitch=_),o.bearingDelta!==void 0&&(n.rotate=_)}_applyChanges(){const t={},n={},o={};for(const[c,p,_]of this._changes)c.panDelta&&(t.panDelta=(t.panDelta||new s.P(0,0))._add(c.panDelta)),c.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+c.zoomDelta),c.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+c.bearingDelta),c.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+c.pitchDelta),c.around!==void 0&&(t.around=c.around),c.pinchAround!==void 0&&(t.pinchAround=c.pinchAround),c.noInertia&&(t.noInertia=c.noInertia),s.e(n,p),s.e(o,_);this._updateMapTransform(t,n,o),this._changes=[]}_updateMapTransform(t,n,o){const c=this._map,p=c._getTransformForUpdate(),_=c.terrain;if(!(Oa(t)||_&&this._terrainMovement))return this._fireEvents(n,o,!0);let{panDelta:y,zoomDelta:x,bearingDelta:C,pitchDelta:E,around:P,pinchAround:B}=t;B!==void 0&&(P=B),c._stop(!0),P=P||c.transform.centerPoint;const G=p.pointLocation(y?P.sub(y):P);C&&(p.bearing+=C),E&&(p.pitch+=E),x&&(p.zoom+=x),_?this._terrainMovement||!n.drag&&!n.zoom?n.drag&&this._terrainMovement?p.center=p.pointLocation(p.centerPoint.sub(y)):p.setLocationAtPoint(G,P):(this._terrainMovement=!0,this._map._elevationFreeze=!0,p.setLocationAtPoint(G,P),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,p.recalculateZoom(c.terrain)})):p.setLocationAtPoint(G,P),c._applyUpdatedTransform(p),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(n,o,!0)}_fireEvents(t,n,o){const c=$a(this._eventsInProgress),p=$a(t),_={};for(const E in t){const{originalEvent:P}=t[E];this._eventsInProgress[E]||(_[`${E}start`]=P),this._eventsInProgress[E]=t[E]}!c&&p&&this._fireEvent("movestart",p.originalEvent);for(const E in _)this._fireEvent(E,_[E]);p&&this._fireEvent("move",p.originalEvent);for(const E in t){const{originalEvent:P}=t[E];this._fireEvent(E,P)}const y={};let x;for(const E in this._eventsInProgress){const{handlerName:P,originalEvent:B}=this._eventsInProgress[E];this._handlersById[P].isActive()||(delete this._eventsInProgress[E],x=n[P]||B,y[`${E}end`]=x)}for(const E in y)this._fireEvent(E,y[E]);const C=$a(this._eventsInProgress);if(o&&(c||p)&&!C){this._updatingCamera=!0;const E=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),P=B=>B!==0&&-this._bearingSnap<B&&B<this._bearingSnap;!E||!E.essential&&s.h.prefersReducedMotion?(this._map.fire(new s.k("moveend",{originalEvent:x})),P(this._map.getBearing())&&this._map.resetNorth()):(P(E.bearing||this._map.getBearing())&&(E.bearing=0),E.freezeElevation=!0,this._map.easeTo(E,{originalEvent:x})),this._updatingCamera=!1}}_fireEvent(t,n){this._map.fire(new s.k(t,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new bo("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class jl extends s.E{constructor(t,n){super(),this._renderFrameCallback=()=>{const o=Math.min((s.h.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(o)),o<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=n.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new s.L(this.transform.center.lng,this.transform.center.lat)}setCenter(t,n){return this.jumpTo({center:t},n)}panBy(t,n,o){return t=s.P.convert(t).mult(-1),this.panTo(this.transform.center,s.e({offset:t},n),o)}panTo(t,n,o){return this.easeTo(s.e({center:t},n),o)}getZoom(){return this.transform.zoom}setZoom(t,n){return this.jumpTo({zoom:t},n),this}zoomTo(t,n,o){return this.easeTo(s.e({zoom:t},n),o)}zoomIn(t,n){return this.zoomTo(this.getZoom()+1,t,n),this}zoomOut(t,n){return this.zoomTo(this.getZoom()-1,t,n),this}getBearing(){return this.transform.bearing}setBearing(t,n){return this.jumpTo({bearing:t},n),this}getPadding(){return this.transform.padding}setPadding(t,n){return this.jumpTo({padding:t},n),this}rotateTo(t,n,o){return this.easeTo(s.e({bearing:t},n),o)}resetNorth(t,n){return this.rotateTo(0,s.e({duration:1e3},t),n),this}resetNorthPitch(t,n){return this.easeTo(s.e({bearing:0,pitch:0,duration:1e3},t),n),this}snapToNorth(t,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,n):this}getPitch(){return this.transform.pitch}setPitch(t,n){return this.jumpTo({pitch:t},n),this}cameraForBounds(t,n){t=Be.convert(t);const o=n&&n.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),o,n)}_cameraForBoxAndBearing(t,n,o,c){const p={top:0,bottom:0,right:0,left:0};if(typeof(c=s.e({padding:p,offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding=="number"){const fe=c.padding;c.padding={top:fe,bottom:fe,right:fe,left:fe}}c.padding=s.e(p,c.padding);const _=this.transform,y=_.padding,x=_.project(s.L.convert(t)),C=_.project(s.L.convert(n)),E=x.rotate(-o*Math.PI/180),P=C.rotate(-o*Math.PI/180),B=new s.P(Math.max(E.x,P.x),Math.max(E.y,P.y)),G=new s.P(Math.min(E.x,P.x),Math.min(E.y,P.y)),q=B.sub(G),H=(_.width-(y.left+y.right+c.padding.left+c.padding.right))/q.x,V=(_.height-(y.top+y.bottom+c.padding.top+c.padding.bottom))/q.y;if(V<0||H<0)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ae=Math.min(_.scaleZoom(_.scale*Math.min(H,V)),c.maxZoom),de=s.P.convert(c.offset),J=new s.P((c.padding.left-c.padding.right)/2,(c.padding.top-c.padding.bottom)/2).rotate(o*Math.PI/180),oe=de.add(J).mult(_.scale/_.zoomScale(ae));return{center:_.unproject(x.add(C).div(2).sub(oe)),zoom:ae,bearing:o}}fitBounds(t,n,o){return this._fitInternal(this.cameraForBounds(t,n),n,o)}fitScreenCoordinates(t,n,o,c,p){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(s.P.convert(t)),this.transform.pointLocation(s.P.convert(n)),o,c),c,p)}_fitInternal(t,n,o){return t?(delete(n=s.e(t,n)).padding,n.linear?this.easeTo(n,o):this.flyTo(n,o)):this}jumpTo(t,n){this.stop();const o=this._getTransformForUpdate();let c=!1,p=!1,_=!1;return"zoom"in t&&o.zoom!==+t.zoom&&(c=!0,o.zoom=+t.zoom),t.center!==void 0&&(o.center=s.L.convert(t.center)),"bearing"in t&&o.bearing!==+t.bearing&&(p=!0,o.bearing=+t.bearing),"pitch"in t&&o.pitch!==+t.pitch&&(_=!0,o.pitch=+t.pitch),t.padding==null||o.isPaddingEqual(t.padding)||(o.padding=t.padding),this._applyUpdatedTransform(o),this.fire(new s.k("movestart",n)).fire(new s.k("move",n)),c&&this.fire(new s.k("zoomstart",n)).fire(new s.k("zoom",n)).fire(new s.k("zoomend",n)),p&&this.fire(new s.k("rotatestart",n)).fire(new s.k("rotate",n)).fire(new s.k("rotateend",n)),_&&this.fire(new s.k("pitchstart",n)).fire(new s.k("pitch",n)).fire(new s.k("pitchend",n)),this.fire(new s.k("moveend",n))}calculateCameraOptionsFromTo(t,n,o,c=0){const p=s.U.fromLngLat(t,n),_=s.U.fromLngLat(o,c),y=_.x-p.x,x=_.y-p.y,C=_.z-p.z,E=Math.hypot(y,x,C);if(E===0)throw new Error("Can't calculate camera options with same From and To");const P=Math.hypot(y,x),B=this.transform.scaleZoom(this.transform.cameraToCenterDistance/E/this.transform.tileSize),G=180*Math.atan2(y,-x)/Math.PI;let q=180*Math.acos(P/E)/Math.PI;return q=C<0?90-q:90+q,{center:_.toLngLat(),zoom:B,pitch:q,bearing:G}}easeTo(t,n){this._stop(!1,t.easeId),((t=s.e({offset:[0,0],duration:500,easing:s.bb},t)).animate===!1||!t.essential&&s.h.prefersReducedMotion)&&(t.duration=0);const o=this._getTransformForUpdate(),c=this.getZoom(),p=this.getBearing(),_=this.getPitch(),y=this.getPadding(),x="zoom"in t?+t.zoom:c,C="bearing"in t?this._normalizeBearing(t.bearing,p):p,E="pitch"in t?+t.pitch:_,P="padding"in t?t.padding:o.padding,B=s.P.convert(t.offset);let G=o.centerPoint.add(B);const q=o.pointLocation(G),H=s.L.convert(t.center||q);this._normalizeCenter(H);const V=o.project(q),ae=o.project(H).sub(V),de=o.zoomScale(x-c);let J,oe;t.around&&(J=s.L.convert(t.around),oe=o.locationPoint(J));const fe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||x!==c,this._rotating=this._rotating||p!==C,this._pitching=this._pitching||E!==_,this._padding=!o.isPaddingEqual(P),this._easeId=t.easeId,this._prepareEase(n,t.noMoveStart,fe),this.terrain&&this._prepareElevation(H),this._ease(me=>{if(this._zooming&&(o.zoom=s.B.number(c,x,me)),this._rotating&&(o.bearing=s.B.number(p,C,me)),this._pitching&&(o.pitch=s.B.number(_,E,me)),this._padding&&(o.interpolatePadding(y,P,me),G=o.centerPoint.add(B)),this.terrain&&!t.freezeElevation&&this._updateElevation(me),J)o.setLocationAtPoint(J,oe);else{const Me=o.zoomScale(o.zoom-c),$e=x>c?Math.min(2,de):Math.max(.5,de),De=Math.pow($e,1-me),Ve=o.unproject(V.add(ae.mult(me*De)).mult(Me));o.setLocationAtPoint(o.renderWorldCopies?Ve.wrap():Ve,G)}this._applyUpdatedTransform(o),this._fireMoveEvents(n)},me=>{this.terrain&&this._finalizeElevation(),this._afterEase(n,me)},t),this}_prepareEase(t,n,o={}){this._moving=!0,n||o.moving||this.fire(new s.k("movestart",t)),this._zooming&&!o.zooming&&this.fire(new s.k("zoomstart",t)),this._rotating&&!o.rotating&&this.fire(new s.k("rotatestart",t)),this._pitching&&!o.pitching&&this.fire(new s.k("pitchstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const n=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&n!==this._elevationTarget){const o=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(o-(n-(o*t+this._elevationStart))/(1-t)),this._elevationTarget=n}this.transform.elevation=s.B.number(this._elevationStart,this._elevationTarget,t)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(t){if(!this.transformCameraUpdate)return;const n=t.clone(),{center:o,zoom:c,pitch:p,bearing:_,elevation:y}=this.transformCameraUpdate(n);o&&(n.center=o),c!==void 0&&(n.zoom=c),p!==void 0&&(n.pitch=p),_!==void 0&&(n.bearing=_),y!==void 0&&(n.elevation=y),this.transform.apply(n)}_fireMoveEvents(t){this.fire(new s.k("move",t)),this._zooming&&this.fire(new s.k("zoom",t)),this._rotating&&this.fire(new s.k("rotate",t)),this._pitching&&this.fire(new s.k("pitch",t))}_afterEase(t,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId;const o=this._zooming,c=this._rotating,p=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,o&&this.fire(new s.k("zoomend",t)),c&&this.fire(new s.k("rotateend",t)),p&&this.fire(new s.k("pitchend",t)),this.fire(new s.k("moveend",t))}flyTo(t,n){if(!t.essential&&s.h.prefersReducedMotion){const ut=s.F(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(ut,n)}this.stop(),t=s.e({offset:[0,0],speed:1.2,curve:1.42,easing:s.bb},t);const o=this._getTransformForUpdate(),c=this.getZoom(),p=this.getBearing(),_=this.getPitch(),y=this.getPadding(),x="zoom"in t?s.ad(+t.zoom,o.minZoom,o.maxZoom):c,C="bearing"in t?this._normalizeBearing(t.bearing,p):p,E="pitch"in t?+t.pitch:_,P="padding"in t?t.padding:o.padding,B=o.zoomScale(x-c),G=s.P.convert(t.offset);let q=o.centerPoint.add(G);const H=o.pointLocation(q),V=s.L.convert(t.center||H);this._normalizeCenter(V);const ae=o.project(H),de=o.project(V).sub(ae);let J=t.curve;const oe=Math.max(o.width,o.height),fe=oe/B,me=de.mag();if("minZoom"in t){const ut=s.ad(Math.min(t.minZoom,c,x),o.minZoom,o.maxZoom),hi=oe/o.zoomScale(ut-c);J=Math.sqrt(hi/me*2)}const Me=J*J;function $e(ut){const hi=(fe*fe-oe*oe+(ut?-1:1)*Me*Me*me*me)/(2*(ut?fe:oe)*Me*me);return Math.log(Math.sqrt(hi*hi+1)-hi)}function De(ut){return(Math.exp(ut)-Math.exp(-ut))/2}function Ve(ut){return(Math.exp(ut)+Math.exp(-ut))/2}const ot=$e(!1);let Ut=function(ut){return Ve(ot)/Ve(ot+J*ut)},Ze=function(ut){return oe*((Ve(ot)*(De(hi=ot+J*ut)/Ve(hi))-De(ot))/Me)/me;var hi},xt=($e(!0)-ot)/J;if(Math.abs(me)<1e-6||!isFinite(xt)){if(Math.abs(oe-fe)<1e-6)return this.easeTo(t,n);const ut=fe<oe?-1:1;xt=Math.abs(Math.log(fe/oe))/J,Ze=function(){return 0},Ut=function(hi){return Math.exp(ut*J*hi)}}return t.duration="duration"in t?+t.duration:1e3*xt/("screenSpeed"in t?+t.screenSpeed/J:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=p!==C,this._pitching=E!==_,this._padding=!o.isPaddingEqual(P),this._prepareEase(n,!1),this.terrain&&this._prepareElevation(V),this._ease(ut=>{const hi=ut*xt,Vt=1/Ut(hi);o.zoom=ut===1?x:c+o.scaleZoom(Vt),this._rotating&&(o.bearing=s.B.number(p,C,ut)),this._pitching&&(o.pitch=s.B.number(_,E,ut)),this._padding&&(o.interpolatePadding(y,P,ut),q=o.centerPoint.add(G)),this.terrain&&!t.freezeElevation&&this._updateElevation(ut);const Lt=ut===1?V:o.unproject(ae.add(de.mult(Ze(hi))).mult(Vt));o.setLocationAtPoint(o.renderWorldCopies?Lt.wrap():Lt,q),this._applyUpdatedTransform(o),this._fireMoveEvents(n)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(n)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,n){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const o=this._onEaseEnd;delete this._onEaseEnd,o.call(this,n)}if(!t){const o=this.handlers;o&&o.stop(!1)}return this}_ease(t,n,o){o.animate===!1||o.duration===0?(t(1),n()):(this._easeStart=s.h.now(),this._easeOptions=o,this._onEaseFrame=t,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,n){t=s.b5(t,-180,180);const o=Math.abs(t-n);return Math.abs(t-360-n)<o&&(t-=360),Math.abs(t+360-n)<o&&(t+=360),t}_normalizeCenter(t){const n=this.transform;if(!n.renderWorldCopies||n.lngRange)return;const o=t.lng-n.center.lng;t.lng+=o>180?-360:o<-180?360:0}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(s.L.convert(t),this.transform.tileZoom)-this.transform.elevation:null}}class Br{constructor(t={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=n=>{!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"&&n.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options&&this.options.compact,this._container=L.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=L.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=L.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){L.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,n){const o=this._map._getUIString(`AttributionControl.${n}`);t.title=o,t.setAttribute("aria-label",o)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(c=>typeof c!="string"?"":c)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const c=this._map.style.stylesheet;this.styleOwner=c.owner,this.styleId=c.id}const n=this._map.style.sourceCaches;for(const c in n){const p=n[c];if(p.used||p.usedForTerrain){const _=p.getSource();_.attribution&&t.indexOf(_.attribution)<0&&t.push(_.attribution)}}t=t.filter(c=>String(c).trim()),t.sort((c,p)=>c.length-p.length),t=t.filter((c,p)=>{for(let _=p+1;_<t.length;_++)if(t[_].indexOf(c)>=0)return!1;return!0});const o=t.join(" | ");o!==this._attribHTML&&(this._attribHTML=o,t.length?(this._innerContainer.innerHTML=o,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class yi{constructor(t={}){this._updateCompact=()=>{const n=this._container.children;if(n.length){const o=n[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&o.classList.add("maplibregl-compact"):o.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=L.create("div","maplibregl-ctrl");const n=L.create("a","maplibregl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://maplibre.org/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){L.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Ts{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const n=++this._id;return this._queue.push({callback:t,id:n,cancelled:!1}),n}remove(t){const n=this._currentlyRunning,o=n?this._queue.concat(n):this._queue;for(const c of o)if(c.id===t)return void(c.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const n=this._currentlyRunning=this._queue;this._queue=[];for(const o of n)if(!o.cancelled&&(o.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const So={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var Vl=s.Q([{name:"a_pos3d",type:"Int16",components:3}]);class Ul extends s.E{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,n){this.sourceCache.update(t,n),this._renderableTilesKeys=[];const o={};for(const c of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:n}))o[c.key]=!0,this._renderableTilesKeys.push(c.key),this._tiles[c.key]||(c.posMatrix=new Float64Array(16),s.aS(c.posMatrix,0,s.N,0,s.N,0,1),this._tiles[c.key]=new Oi(c,this.tileSize));for(const c in this._tiles)o[c]||delete this._tiles[c]}freeRtt(t){for(const n in this._tiles){const o=this._tiles[n];(!t||o.tileID.equals(t)||o.tileID.isChildOf(t)||t.isChildOf(o.tileID))&&(o.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const n={};for(const o of this._renderableTilesKeys){const c=this._tiles[o].tileID;if(c.canonical.equals(t.canonical)){const p=t.clone();p.posMatrix=new Float64Array(16),s.aS(p.posMatrix,0,s.N,0,s.N,0,1),n[o]=p}else if(c.canonical.isChildOf(t.canonical)){const p=t.clone();p.posMatrix=new Float64Array(16);const _=c.canonical.z-t.canonical.z,y=c.canonical.x-(c.canonical.x>>_<<_),x=c.canonical.y-(c.canonical.y>>_<<_),C=s.N>>_;s.aS(p.posMatrix,0,C,0,C,0,1),s.$(p.posMatrix,p.posMatrix,[-y*C,-x*C,0]),n[o]=p}else if(t.canonical.isChildOf(c.canonical)){const p=t.clone();p.posMatrix=new Float64Array(16);const _=t.canonical.z-c.canonical.z,y=t.canonical.x-(t.canonical.x>>_<<_),x=t.canonical.y-(t.canonical.y>>_<<_),C=s.N>>_;s.aS(p.posMatrix,0,s.N,0,s.N,0,1),s.$(p.posMatrix,p.posMatrix,[y*C,x*C,0]),s.a0(p.posMatrix,p.posMatrix,[1/2**_,1/2**_,0]),n[o]=p}}return n}getSourceTile(t,n){const o=this.sourceCache._source;let c=t.overscaledZ-this.deltaZoom;if(c>o.maxzoom&&(c=o.maxzoom),c<o.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(c).key);let p=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!p||!p.dem)&&n)for(;c>=o.minzoom&&(!p||!p.dem);)p=this.sourceCache.getTileByID(t.scaledTo(c--).key);return p}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(n=>n.timeAdded>=t)}}class ql{constructor(t,n,o){this.painter=t,this.sourceCache=new Ul(n),this.options=o,this.exaggeration=typeof o.exaggeration=="number"?o.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,n,o,c=s.N){var p;if(!(n>=0&&n<c&&o>=0&&o<c))return 0;const _=this.getTerrainData(t),y=(p=_.tile)===null||p===void 0?void 0:p.dem;if(!y)return 0;const x=function(q,H,V){var ae=H[0],de=H[1];return q[0]=V[0]*ae+V[4]*de+V[12],q[1]=V[1]*ae+V[5]*de+V[13],q}([],[n/c*s.N,o/c*s.N],_.u_terrain_matrix),C=[x[0]*y.dim,x[1]*y.dim],E=Math.floor(C[0]),P=Math.floor(C[1]),B=C[0]-E,G=C[1]-P;return y.get(E,P)*(1-B)*(1-G)+y.get(E+1,P)*B*(1-G)+y.get(E,P+1)*(1-B)*G+y.get(E+1,P+1)*B*G}getElevationForLngLatZoom(t,n){const{tileID:o,mercatorX:c,mercatorY:p}=this._getOverscaledTileIDFromLngLatZoom(t,n);return this.getElevation(o,c%s.N,p%s.N,s.N)}getElevation(t,n,o,c=s.N){return this.getDEMElevation(t,n,o,c)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const c=this.painter.context,p=new s.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Te(c,p,c.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Te(c,new s.R({width:1,height:1}),c.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=s.ao([])}const n=this.sourceCache.getSourceTile(t,!0);if(n&&n.dem&&(!n.demTexture||n.needsTerrainPrepare)){const c=this.painter.context;n.demTexture=this.painter.getTileTexture(n.dem.stride),n.demTexture?n.demTexture.update(n.dem.getPixels(),{premultiply:!1}):n.demTexture=new Te(c,n.dem.getPixels(),c.gl.RGBA,{premultiply:!1}),n.demTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),n.needsTerrainPrepare=!1}const o=n&&n+n.tileID.key+t.key;if(o&&!this._demMatrixCache[o]){const c=this.sourceCache.sourceCache._source.maxzoom;let p=t.canonical.z-n.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=c?p=t.canonical.z-c:s.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const _=t.canonical.x-(t.canonical.x>>p<<p),y=t.canonical.y-(t.canonical.y>>p<<p),x=s.bc(new Float64Array(16),[1/(s.N<<p),1/(s.N<<p),0]);s.$(x,x,[_*s.N,y*s.N,0]),this._demMatrixCache[t.key]={matrix:x,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:n&&n.dem&&n.dem.dim||1,u_terrain_matrix:o?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:n&&n.dem&&n.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(n&&n.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:n}}getFramebuffer(t){const n=this.painter,o=n.width/devicePixelRatio,c=n.height/devicePixelRatio;return!this._fbo||this._fbo.width===o&&this._fbo.height===c||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Te(n.context,{width:o,height:c,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Te(n.context,{width:o,height:c,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=n.context.createFramebuffer(o,c,!0,!1),this._fbo.depthAttachment.set(n.context.createRenderbuffer(n.context.gl.DEPTH_COMPONENT16,o,c))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const n=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let p=0,_=0;p<this._coordsTextureSize;p++)for(let y=0;y<this._coordsTextureSize;y++,_+=4)n[_+0]=255&y,n[_+1]=255&p,n[_+2]=y>>8<<4|p>>8,n[_+3]=0;const o=new s.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(n.buffer)),c=new Te(t,o,t.gl.RGBA,{premultiply:!1});return c.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=c,c}pointCoordinate(t){const n=new Uint8Array(4),o=this.painter.context,c=o.gl;o.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),c.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,c.RGBA,c.UNSIGNED_BYTE,n),o.bindFramebuffer.set(null);const p=n[0]+(n[2]>>4<<8),_=n[1]+((15&n[2])<<8),y=this.coordsIndex[255-n[3]],x=y&&this.sourceCache.getTileByID(y);if(!x)return null;const C=this._coordsTextureSize,E=(1<<x.tileID.canonical.z)*C;return new s.U(this._allowMercatorOverflow(t,(x.tileID.canonical.x*C+p)/E),(x.tileID.canonical.y*C+_)/E,this.getElevation(x.tileID,p,_,C))}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.painter.context,n=new s.bd,o=new s.b0,c=this.meshSize,p=s.N/c,_=c*c;for(let P=0;P<=c;P++)for(let B=0;B<=c;B++)n.emplaceBack(B*p,P*p,0);for(let P=0;P<_;P+=c+1)for(let B=0;B<c;B++)o.emplaceBack(B+P,c+B+P+1,c+B+P+2),o.emplaceBack(B+P,c+B+P+2,B+P+1);const y=n.length,x=y+2*(c+1);for(const P of[0,1])for(let B=0;B<=c;B++)for(const G of[0,1])n.emplaceBack(B*p,P*s.N,G);for(let P=0;P<2*c;P+=2)o.emplaceBack(x+P,x+P+1,x+P+3),o.emplaceBack(x+P,x+P+3,x+P+2),o.emplaceBack(y+P,y+P+3,y+P+1),o.emplaceBack(y+P,y+P+2,y+P+3);const C=n.length,E=C+2*(c+1);for(const P of[0,1])for(let B=0;B<=c;B++)for(const G of[0,1])n.emplaceBack(P*s.N,B*p,G);for(let P=0;P<2*c;P+=2)o.emplaceBack(C+P,C+P+1,C+P+3),o.emplaceBack(C+P,C+P+3,C+P+2),o.emplaceBack(E+P,E+P+3,E+P+1),o.emplaceBack(E+P,E+P+2,E+P+3);return this._mesh={indexBuffer:t.createIndexBuffer(o),vertexBuffer:t.createVertexBuffer(n,Vl.members),segments:s.S.simpleSegment(0,0,n.length,o.length)},this._mesh}getMeshFrameDelta(t){return 2*Math.PI*s.be/Math.pow(2,t)/5}getMinTileElevationForLngLatZoom(t,n){var o;const{tileID:c}=this._getOverscaledTileIDFromLngLatZoom(t,n);return(o=this.getMinMaxElevation(c).minElevation)!==null&&o!==void 0?o:0}getMinMaxElevation(t){const n=this.getTerrainData(t).tile,o={minElevation:null,maxElevation:null};return n&&n.dem&&(o.minElevation=n.dem.min*this.exaggeration,o.maxElevation=n.dem.max*this.exaggeration),o}_getOverscaledTileIDFromLngLatZoom(t,n){const o=s.U.fromLngLat(t.wrap()),c=(1<<n)*s.N,p=o.x*c,_=o.y*c,y=Math.floor(p/s.N),x=Math.floor(_/s.N);return{tileID:new s.O(n,0,n,y,x),mercatorX:p,mercatorY:_}}_allowMercatorOverflow(t,n){const o=t.x<this.painter.width/2;let c=s.bf(n);const p=this.painter.transform.center.lng;return o&&Math.sign(c)>0&&Math.sign(p)<0||!o&&Math.sign(c)<0&&Math.sign(p)>0?(c=360*Math.sign(p)+c,s.G(c)):n}}class Uc{constructor(t,n,o){this._context=t,this._size=n,this._tileSize=o,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const n=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),o=new Te(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return o.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),n.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),n.colorAttachment.set(o.texture),{id:t,fbo:n,texture:o,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(n=>t.id!==n),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const n of this._recentlyUsed)if(!this._objects[n].inUse)return this._objects[n];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const _r={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Is{constructor(t,n){this.painter=t,this.terrain=n,this.pool=new Uc(t.context,30,n.sourceCache.tileSize*n.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,n){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(o=>!t._layers[o].isHidden(n)),this._coordsDescendingInv={};for(const o in t.sourceCaches){this._coordsDescendingInv[o]={};const c=t.sourceCaches[o].getVisibleCoordinates();for(const p of c){const _=this.terrain.sourceCache.getTerrainCoords(p);for(const y in _)this._coordsDescendingInv[o][y]||(this._coordsDescendingInv[o][y]=[]),this._coordsDescendingInv[o][y].push(_[y])}}this._coordsDescendingInvStr={};for(const o of t._order){const c=t._layers[o],p=c.source;if(_r[c.type]&&!this._coordsDescendingInvStr[p]){this._coordsDescendingInvStr[p]={};for(const _ in this._coordsDescendingInv[p])this._coordsDescendingInvStr[p][_]=this._coordsDescendingInv[p][_].map(y=>y.key).sort().join()}}for(const o of this._renderableTiles)for(const c in this._coordsDescendingInvStr){const p=this._coordsDescendingInvStr[c][o.tileID.key];p&&p!==o.rttCoords[c]&&(o.rtt=[])}}renderLayer(t){if(t.isHidden(this.painter.transform.zoom))return!1;const n=t.type,o=this.painter,c=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(_r[n]&&(this._prevType&&_r[this._prevType]||this._stacks.push([]),this._prevType=n,this._stacks[this._stacks.length-1].push(t.id),!c))return!0;if(_r[this._prevType]||_r[n]&&c){this._prevType=n;const p=this._stacks.length-1,_=this._stacks[p]||[];for(const y of this._renderableTiles){if(this.pool.isFull()&&(ki(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(y),y.rtt[p]){const C=this.pool.getObjectForId(y.rtt[p].id);if(C.stamp===y.rtt[p].stamp){this.pool.useObject(C);continue}}const x=this.pool.getOrCreateFreeObject();this.pool.useObject(x),this.pool.stampObject(x),y.rtt[p]={id:x.id,stamp:x.stamp},o.context.bindFramebuffer.set(x.fbo.framebuffer),o.context.clear({color:s.aT.transparent,stencil:0}),o.currentStencilSource=void 0;for(let C=0;C<_.length;C++){const E=o.style._layers[_[C]],P=E.source?this._coordsDescendingInv[E.source][y.tileID.key]:[y.tileID];o.context.viewport.set([0,0,x.fbo.width,x.fbo.height]),o._renderTileClippingMasks(E,P),o.renderLayer(o,o.style.sourceCaches[E.source],E,P),E.source&&(y.rttCoords[E.source]=this._coordsDescendingInvStr[E.source][y.tileID.key])}}return ki(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),_r[n]}return!1}}const pt=j,vt={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:s.c.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},Na=h=>{h.touchstart=h.dragStart,h.touchmoveWindow=h.dragMove,h.touchend=h.dragEnd},Co={showCompass:!0,showZoom:!0,visualizePitch:!1};class To{constructor(t,n,o=!1){this.mousedown=_=>{this.startMouse(s.e({},_,{ctrlKey:!0,preventDefault:()=>_.preventDefault()}),L.mousePos(this.element,_)),L.addEventListener(window,"mousemove",this.mousemove),L.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=_=>{this.moveMouse(_,L.mousePos(this.element,_))},this.mouseup=_=>{this.mouseRotate.dragEnd(_),this.mousePitch&&this.mousePitch.dragEnd(_),this.offTemp()},this.touchstart=_=>{_.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=L.touchPos(this.element,_.targetTouches)[0],this.startTouch(_,this._startPos),L.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),L.addEventListener(window,"touchend",this.touchend))},this.touchmove=_=>{_.targetTouches.length!==1?this.reset():(this._lastPos=L.touchPos(this.element,_.targetTouches)[0],this.moveTouch(_,this._lastPos))},this.touchend=_=>{_.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const c=t.dragRotate._mouseRotate.getClickTolerance(),p=t.dragRotate._mousePitch.getClickTolerance();this.element=n,this.mouseRotate=da({clickTolerance:c,enable:!0}),this.touchRotate=(({enable:_,clickTolerance:y,bearingDegreesPerPixelMoved:x=.8})=>{const C=new Bl;return new vn({clickTolerance:y,move:(E,P)=>({bearingDelta:(P.x-E.x)*x}),moveStateManager:C,enable:_,assignEvents:Na})})({clickTolerance:c,enable:!0}),this.map=t,o&&(this.mousePitch=xn({clickTolerance:p,enable:!0}),this.touchPitch=(({enable:_,clickTolerance:y,pitchDegreesPerPixelMoved:x=-.5})=>{const C=new Bl;return new vn({clickTolerance:y,move:(E,P)=>({pitchDelta:(P.y-E.y)*x}),moveStateManager:C,enable:_,assignEvents:Na})})({clickTolerance:p,enable:!0})),L.addEventListener(n,"mousedown",this.mousedown),L.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),L.addEventListener(n,"touchcancel",this.reset)}startMouse(t,n){this.mouseRotate.dragStart(t,n),this.mousePitch&&this.mousePitch.dragStart(t,n),L.disableDrag()}startTouch(t,n){this.touchRotate.dragStart(t,n),this.touchPitch&&this.touchPitch.dragStart(t,n),L.disableDrag()}moveMouse(t,n){const o=this.map,{bearingDelta:c}=this.mouseRotate.dragMove(t,n)||{};if(c&&o.setBearing(o.getBearing()+c),this.mousePitch){const{pitchDelta:p}=this.mousePitch.dragMove(t,n)||{};p&&o.setPitch(o.getPitch()+p)}}moveTouch(t,n){const o=this.map,{bearingDelta:c}=this.touchRotate.dragMove(t,n)||{};if(c&&o.setBearing(o.getBearing()+c),this.touchPitch){const{pitchDelta:p}=this.touchPitch.dragMove(t,n)||{};p&&o.setPitch(o.getPitch()+p)}}off(){const t=this.element;L.removeEventListener(t,"mousedown",this.mousedown),L.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),L.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),L.removeEventListener(window,"touchend",this.touchend),L.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){L.enableDrag(),L.removeEventListener(window,"mousemove",this.mousemove),L.removeEventListener(window,"mouseup",this.mouseup),L.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),L.removeEventListener(window,"touchend",this.touchend)}}let ji;function Io(h,t,n){if(h=new s.L(h.lng,h.lat),t){const o=new s.L(h.lng-360,h.lat),c=new s.L(h.lng+360,h.lat),p=n.locationPoint(h).distSqr(t);n.locationPoint(o).distSqr(t)<p?h=o:n.locationPoint(c).distSqr(t)<p&&(h=c)}for(;Math.abs(h.lng-n.center.lng)>180;){const o=n.locationPoint(h);if(o.x>=0&&o.y>=0&&o.x<=n.width&&o.y<=n.height)break;h.lng>n.center.lng?h.lng-=360:h.lng+=360}return h}const Xr={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Gl(h,t,n){const o=h.classList;for(const c in Xr)o.remove(`maplibregl-${n}-anchor-${c}`);o.add(`maplibregl-${n}-anchor-${t}`)}class Wn extends s.E{constructor(t){if(super(),this._onKeyPress=n=>{const o=n.code,c=n.charCode||n.keyCode;o!=="Space"&&o!=="Enter"&&c!==32&&c!==13||this.togglePopup()},this._onMapClick=n=>{const o=n.originalEvent.target,c=this._element;this._popup&&(o===c||c.contains(o))&&this.togglePopup()},this._update=n=>{if(!this._map)return;const o=this._map.loaded()&&!this._map.isMoving();(n?.type==="terrain"||n?.type==="render"&&!o)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=Io(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let c="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?c=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(c=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let p="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?p="rotateX(0deg)":this._pitchAlignment==="map"&&(p=`rotateX(${this._map.getPitch()}deg)`),n&&n.type!=="moveend"||(this._pos=this._pos.round()),L.setTransform(this._element,`${Xr[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${p} ${c}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const _=this._map.unproject(this._pos),y=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=_.distanceTo(this._lngLat)>20*y?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=n=>{if(!this._isDragging){const o=this._clickTolerance||this._map._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=o}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.k("dragstart"))),this.fire(new s.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.k("dragend")),this._state="inactive"},this._addDragHandler=n=>{this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos).add(this._offset),this._pointerdownPos=n.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=s.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=L.create("div"),this._element.setAttribute("aria-label","Map marker");const n=L.createNS("http://www.w3.org/2000/svg","svg"),o=41,c=27;n.setAttributeNS(null,"display","block"),n.setAttributeNS(null,"height",`${o}px`),n.setAttributeNS(null,"width",`${c}px`),n.setAttributeNS(null,"viewBox",`0 0 ${c} ${o}`);const p=L.createNS("http://www.w3.org/2000/svg","g");p.setAttributeNS(null,"stroke","none"),p.setAttributeNS(null,"stroke-width","1"),p.setAttributeNS(null,"fill","none"),p.setAttributeNS(null,"fill-rule","evenodd");const _=L.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"fill-rule","nonzero");const y=L.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"transform","translate(3.0, 29.0)"),y.setAttributeNS(null,"fill","#000000");const x=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ae of x){const de=L.createNS("http://www.w3.org/2000/svg","ellipse");de.setAttributeNS(null,"opacity","0.04"),de.setAttributeNS(null,"cx","10.5"),de.setAttributeNS(null,"cy","5.80029008"),de.setAttributeNS(null,"rx",ae.rx),de.setAttributeNS(null,"ry",ae.ry),y.appendChild(de)}const C=L.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill",this._color);const E=L.createNS("http://www.w3.org/2000/svg","path");E.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),C.appendChild(E);const P=L.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"opacity","0.25"),P.setAttributeNS(null,"fill","#000000");const B=L.createNS("http://www.w3.org/2000/svg","path");B.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),P.appendChild(B);const G=L.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"transform","translate(6.0, 7.0)"),G.setAttributeNS(null,"fill","#FFFFFF");const q=L.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"transform","translate(8.0, 8.0)");const H=L.createNS("http://www.w3.org/2000/svg","circle");H.setAttributeNS(null,"fill","#000000"),H.setAttributeNS(null,"opacity","0.25"),H.setAttributeNS(null,"cx","5.5"),H.setAttributeNS(null,"cy","5.5"),H.setAttributeNS(null,"r","5.4999962");const V=L.createNS("http://www.w3.org/2000/svg","circle");V.setAttributeNS(null,"fill","#FFFFFF"),V.setAttributeNS(null,"cx","5.5"),V.setAttributeNS(null,"cy","5.5"),V.setAttributeNS(null,"r","5.4999962"),q.appendChild(H),q.appendChild(V),_.appendChild(y),_.appendChild(C),_.appendChild(P),_.appendChild(G),_.appendChild(q),n.appendChild(_),n.setAttributeNS(null,"height",o*this._scale+"px"),n.setAttributeNS(null,"width",c*this._scale+"px"),this._element.appendChild(n),this._offset=s.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",n=>{n.preventDefault()}),this._element.addEventListener("mousedown",n=>{n.preventDefault()}),Gl(this._element,this._anchor,"marker"),t&&t.className)for(const n of t.className.split(" "))this._element.classList.add(n);this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),L.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=s.L.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const c=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[c,-1*(38.1-13.5+c)],"bottom-right":[-c,-1*(38.1-13.5+c)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(t){return this._offset=s.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const zi={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Pi=0,fa=!1;const ja={maxWidth:100,unit:"metric"};function Va(h,t,n){const o=n&&n.maxWidth||100,c=h._container.clientHeight/2,p=h.unproject([0,c]),_=h.unproject([o,c]),y=p.distanceTo(_);if(n&&n.unit==="imperial"){const x=3.2808*y;x>5280?Xn(t,o,x/5280,h._getUIString("ScaleControl.Miles")):Xn(t,o,x,h._getUIString("ScaleControl.Feet"))}else n&&n.unit==="nautical"?Xn(t,o,y/1852,h._getUIString("ScaleControl.NauticalMiles")):y>=1e3?Xn(t,o,y/1e3,h._getUIString("ScaleControl.Kilometers")):Xn(t,o,y,h._getUIString("ScaleControl.Meters"))}function Xn(h,t,n,o){const c=function(p){const _=Math.pow(10,`${Math.floor(p)}`.length-1);let y=p/_;return y=y>=10?10:y>=5?5:y>=3?3:y>=2?2:y>=1?1:function(x){const C=Math.pow(10,Math.ceil(-Math.log(x)/Math.LN10));return Math.round(x*C)/C}(y),_*y}(n);h.style.width=t*(c/n)+"px",h.innerHTML=`${c}&nbsp;${o}`}const Eo={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Po=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ma(h){if(h){if(typeof h=="number"){const t=Math.round(Math.abs(h)/Math.SQRT2);return{center:new s.P(0,0),top:new s.P(0,h),"top-left":new s.P(t,t),"top-right":new s.P(-t,t),bottom:new s.P(0,-h),"bottom-left":new s.P(t,-t),"bottom-right":new s.P(-t,-t),left:new s.P(h,0),right:new s.P(-h,0)}}if(h instanceof s.P||Array.isArray(h)){const t=s.P.convert(h);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:s.P.convert(h.center||[0,0]),top:s.P.convert(h.top||[0,0]),"top-left":s.P.convert(h["top-left"]||[0,0]),"top-right":s.P.convert(h["top-right"]||[0,0]),bottom:s.P.convert(h.bottom||[0,0]),"bottom-left":s.P.convert(h["bottom-left"]||[0,0]),"bottom-right":s.P.convert(h["bottom-right"]||[0,0]),left:s.P.convert(h.left||[0,0]),right:s.P.convert(h.right||[0,0])}}return ma(new s.P(0,0))}const Mo={extend:(h,...t)=>s.e(h,...t),run(h){h()},logToElement(h,t=!1,n="log"){const o=window.document.getElementById(n);o&&(t&&(o.innerHTML=""),o.innerHTML+=`<br>${h}`)}},Ao=j;class si{static get version(){return Ao}static get workerCount(){return Gi.workerCount}static set workerCount(t){Gi.workerCount=t}static get maxParallelImageRequests(){return s.c.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(t){s.c.MAX_PARALLEL_IMAGE_REQUESTS=t}static get workerUrl(){return s.c.WORKER_URL}static set workerUrl(t){s.c.WORKER_URL=t}static addProtocol(t,n){s.c.REGISTERED_PROTOCOLS[t]=n}static removeProtocol(t){delete s.c.REGISTERED_PROTOCOLS[t]}}return si.Map=class extends jl{constructor(h){if(s.bg.mark(s.bh.create),(h=s.e({},vt,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new bs(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies),{bearingSnap:h.bearingSnap}),this._cooperativeGesturesOnWheel=t=>{this._onCooperativeGesture(t,t[this._metaKey],1)},this._contextLost=t=>{t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.k("webglcontextlost",{originalEvent:t}))},this._contextRestored=t=>{this._setupPainter(),this.resize(),this._update(),this.fire(new s.k("webglcontextrestored",{originalEvent:t}))},this._onMapScroll=t=>{if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=h.interactive,this._cooperativeGestures=h.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=h.maxTileCacheSize,this._maxTileCacheZoomLevels=h.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._crossSourceCollisions=h.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=h.collectResourceTiming,this._renderTaskQueue=new Ts,this._controls=[],this._mapId=s.a2(),this._locale=s.e({},So,h.locale),this._clickTolerance=h.clickTolerance,this._overridePixelRatio=h.pixelRatio,this._maxCanvasSize=h.maxCanvasSize,this.transformCameraUpdate=h.transformCameraUpdate,this._imageQueueHandle=Se.addThrottleControl(()=>this.isMoving()),this._requestManager=new we(h.transformRequest),typeof h.container=="string"){if(this._container=document.getElementById(h.container),!this._container)throw new Error(`Container '${h.container}' not found.`)}else{if(!(h.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(h.maxBounds&&this.setMaxBounds(h.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let t=!1;const n=Hn(o=>{this._trackResize&&!this._removed&&this.resize(o)._update()},50);this._resizeObserver=new ResizeObserver(o=>{t?n(o):t=!0}),this._resizeObserver.observe(this._container)}this.handlers=new wo(this,h),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=h.hash&&new Ra(typeof h.hash=="string"&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,s.e({},h.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=h.localIdeographFontFamily,this._validateStyle=h.validateStyle,h.style&&this.setStyle(h.style,{localIdeographFontFamily:h.localIdeographFontFamily}),h.attributionControl&&this.addControl(new Br({customAttribution:h.customAttribution})),h.maplibreLogo&&this.addControl(new yi,h.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update(t.dataType==="style"),this.fire(new s.k(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new s.k(`${t.dataType}dataloading`,t))}),this.on("dataabort",t=>{this.fire(new s.k("sourcedataabort",t))})}_getMapId(){return this._mapId}addControl(h,t){if(t===void 0&&(t=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new s.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=h.onAdd(this);this._controls.push(h);const o=this._controlPositions[t];return t.indexOf("bottom")!==-1?o.insertBefore(n,o.firstChild):o.appendChild(n),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new s.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(h);return t>-1&&this._controls.splice(t,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}calculateCameraOptionsFromTo(h,t,n,o){return o==null&&this.terrain&&(o=this.terrain.getElevationForLngLatZoom(n,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(h,t,n,o)}resize(h){var t;const n=this._containerDimensions(),o=n[0],c=n[1],p=this._getClampedPixelRatio(o,c);if(this._resizeCanvas(o,c,p),this.painter.resize(o,c,p),this.painter.overLimit()){const y=this.painter.context.gl;this._maxCanvasSize=[y.drawingBufferWidth,y.drawingBufferHeight];const x=this._getClampedPixelRatio(o,c);this._resizeCanvas(o,c,x),this.painter.resize(o,c,x)}this.transform.resize(o,c),(t=this._requestedCameraState)===null||t===void 0||t.resize(o,c);const _=!this._moving;return _&&(this.stop(),this.fire(new s.k("movestart",h)).fire(new s.k("move",h))),this.fire(new s.k("resize",h)),_&&this.fire(new s.k("moveend",h)),this}_getClampedPixelRatio(h,t){const{0:n,1:o}=this._maxCanvasSize,c=this.getPixelRatio(),p=h*c,_=t*c;return Math.min(p>n?n/p:1,_>o?o/_:1)*c}getPixelRatio(){var h;return(h=this._overridePixelRatio)!==null&&h!==void 0?h:devicePixelRatio}setPixelRatio(h){this._overridePixelRatio=h,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(h){return this.transform.setMaxBounds(Be.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h&&this.setZoom(h),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h&&this.setZoom(h),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h&&this.setPitch(h),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h&&this.setPitch(h),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(h){return this._cooperativeGestures=h,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(h){return this.transform.locationPoint(s.L.convert(h),this.style&&this.terrain)}unproject(h){return this.transform.pointLocation(s.P.convert(h),this.terrain)}isMoving(){var h;return this._moving||((h=this.handlers)===null||h===void 0?void 0:h.isMoving())}isZooming(){var h;return this._zooming||((h=this.handlers)===null||h===void 0?void 0:h.isZooming())}isRotating(){var h;return this._rotating||((h=this.handlers)===null||h===void 0?void 0:h.isRotating())}_createDelegatedListener(h,t,n){if(h==="mouseenter"||h==="mouseover"){let o=!1;return{layer:t,listener:n,delegates:{mousemove:p=>{const _=this.getLayer(t)?this.queryRenderedFeatures(p.point,{layers:[t]}):[];_.length?o||(o=!0,n.call(this,new Rr(h,this,p.originalEvent,{features:_}))):o=!1},mouseout:()=>{o=!1}}}}if(h==="mouseleave"||h==="mouseout"){let o=!1;return{layer:t,listener:n,delegates:{mousemove:_=>{(this.getLayer(t)?this.queryRenderedFeatures(_.point,{layers:[t]}):[]).length?o=!0:o&&(o=!1,n.call(this,new Rr(h,this,_.originalEvent)))},mouseout:_=>{o&&(o=!1,n.call(this,new Rr(h,this,_.originalEvent)))}}}}{const o=c=>{const p=this.getLayer(t)?this.queryRenderedFeatures(c.point,{layers:[t]}):[];p.length&&(c.features=p,n.call(this,c),delete c.features)};return{layer:t,listener:n,delegates:{[h]:o}}}}on(h,t,n){if(n===void 0)return super.on(h,t);const o=this._createDelegatedListener(h,t,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(o);for(const c in o.delegates)this.on(c,o.delegates[c]);return this}once(h,t,n){if(n===void 0)return super.once(h,t);const o=this._createDelegatedListener(h,t,n);for(const c in o.delegates)this.once(c,o.delegates[c]);return this}off(h,t,n){return n===void 0?super.off(h,t):(this._delegatedListeners&&this._delegatedListeners[h]&&(o=>{const c=this._delegatedListeners[h];for(let p=0;p<c.length;p++){const _=c[p];if(_.layer===t&&_.listener===n){for(const y in _.delegates)this.off(y,_.delegates[y]);return c.splice(p,1),this}}})(),this)}queryRenderedFeatures(h,t){if(!this.style)return[];let n;const o=h instanceof s.P||Array.isArray(h),c=o?h:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(o?{}:h)||{},c instanceof s.P||typeof c[0]=="number")n=[s.P.convert(c)];else{const p=s.P.convert(c[0]),_=s.P.convert(c[1]);n=[p,new s.P(_.x,p.y),_,new s.P(p.x,_.y),p]}return this.style.queryRenderedFeatures(n,t,this.transform)}querySourceFeatures(h,t){return this.style.querySourceFeatures(h,t)}setStyle(h,t){return(t=s.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&h?(this._diffStyle(h,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(h,t))}setTransformRequest(h){return this._requestManager.setTransformRequest(h),this}_getUIString(h){const t=this._locale[h];if(t==null)throw new Error(`Missing UI string '${h}'`);return t}_updateStyle(h,t){if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(h,t));const n=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!h)),h?(this.style=new or(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h,t,n):this.style.loadJSON(h,t,n),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new or(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(h,t){if(typeof h=="string"){const n=this._requestManager.transformRequest(h,ve.Style);s.f(n,(o,c)=>{o?this.fire(new s.j(o)):c&&this._updateDiff(c,t)})}else typeof h=="object"&&this._updateDiff(h,t)}_updateDiff(h,t){try{this.style.setState(h,t)&&this._update(!0)}catch(n){s.w(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(h,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():s.w("There is no style added to the map.")}addSource(h,t){return this._lazyInitEmptyStyle(),this.style.addSource(h,t),this._update(!0)}isSourceLoaded(h){const t=this.style&&this.style.sourceCaches[h];if(t!==void 0)return t.loaded();this.fire(new s.j(new Error(`There is no source with ID '${h}'`)))}setTerrain(h){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),h){const t=this.style.sourceCaches[h.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${h.source}`);for(const n in this.style._layers){const o=this.style._layers[n];o.type==="hillshade"&&o.source===h.source&&s.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new ql(this.painter,t,h),this.painter.renderToTexture=new Is(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=n=>{n.dataType==="style"?this.terrain.sourceCache.freeRtt():n.dataType==="source"&&n.tile&&(n.sourceId!==h.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(n.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new s.k("terrain",{terrain:h})),this}getTerrain(){var h,t;return(t=(h=this.terrain)===null||h===void 0?void 0:h.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const h=this.style&&this.style.sourceCaches;for(const t in h){const n=h[t]._tiles;for(const o in n){const c=n[o];if(c.state!=="loaded"&&c.state!=="errored")return!1}}return!0}addSourceType(h,t,n){return this._lazyInitEmptyStyle(),this.style.addSourceType(h,t,n)}removeSource(h){return this.style.removeSource(h),this._update(!0)}getSource(h){return this.style.getSource(h)}addImage(h,t,n={}){const{pixelRatio:o=1,sdf:c=!1,stretchX:p,stretchY:_,content:y}=n;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||s.a(t))){if(t.width===void 0||t.height===void 0)return this.fire(new s.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:x,height:C,data:E}=t,P=t;return this.style.addImage(h,{data:new s.R({width:x,height:C},new Uint8Array(E)),pixelRatio:o,stretchX:p,stretchY:_,content:y,sdf:c,version:0,userImage:P}),P.onAdd&&P.onAdd(this,h),this}}{const{width:x,height:C,data:E}=s.h.getImageData(t);this.style.addImage(h,{data:new s.R({width:x,height:C},E),pixelRatio:o,stretchX:p,stretchY:_,content:y,sdf:c,version:0})}}updateImage(h,t){const n=this.style.getImage(h);if(!n)return this.fire(new s.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const o=t instanceof HTMLImageElement||s.a(t)?s.h.getImageData(t):t,{width:c,height:p,data:_}=o;if(c===void 0||p===void 0)return this.fire(new s.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(c!==n.data.width||p!==n.data.height)return this.fire(new s.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const y=!(t instanceof HTMLImageElement||s.a(t));return n.data.replace(_,y),this.style.updateImage(h,n),this}getImage(h){return this.style.getImage(h)}hasImage(h){return h?!!this.style.getImage(h):(this.fire(new s.j(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(h)}loadImage(h,t){Se.getImage(this._requestManager.transformRequest(h,ve.Image),t)}listImages(){return this.style.listImages()}addLayer(h,t){return this._lazyInitEmptyStyle(),this.style.addLayer(h,t),this._update(!0)}moveLayer(h,t){return this.style.moveLayer(h,t),this._update(!0)}removeLayer(h){return this.style.removeLayer(h),this._update(!0)}getLayer(h){return this.style.getLayer(h)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(h,t,n){return this.style.setLayerZoomRange(h,t,n),this._update(!0)}setFilter(h,t,n={}){return this.style.setFilter(h,t,n),this._update(!0)}getFilter(h){return this.style.getFilter(h)}setPaintProperty(h,t,n,o={}){return this.style.setPaintProperty(h,t,n,o),this._update(!0)}getPaintProperty(h,t){return this.style.getPaintProperty(h,t)}setLayoutProperty(h,t,n,o={}){return this.style.setLayoutProperty(h,t,n,o),this._update(!0)}getLayoutProperty(h,t){return this.style.getLayoutProperty(h,t)}setGlyphs(h,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(h,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(h,t,n={}){return this._lazyInitEmptyStyle(),this.style.addSprite(h,t,n,o=>{o||this._update(!0)}),this}removeSprite(h){return this._lazyInitEmptyStyle(),this.style.removeSprite(h),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(h,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(h,t,n=>{n||this._update(!0)}),this}setLight(h,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(h,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(h,t){return this.style.setFeatureState(h,t),this._update()}removeFeatureState(h,t){return this.style.removeFeatureState(h,t),this._update()}getFeatureState(h){return this.style.getFeatureState(h)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let h=0,t=0;return this._container&&(h=this._container.clientWidth||400,t=this._container.clientHeight||300),[h,t]}_setupContainer(){const h=this._container;h.classList.add("maplibregl-map");const t=this._canvasContainer=L.create("div","maplibregl-canvas-container",h);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=L.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const n=this._containerDimensions(),o=this._getClampedPixelRatio(n[0],n[1]);this._resizeCanvas(n[0],n[1],o);const c=this._controlContainer=L.create("div","maplibregl-control-container",h),p=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(_=>{p[_]=L.create("div",`maplibregl-ctrl-${_} `,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=L.create("div","maplibregl-cooperative-gesture-screen",this._container);let h=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(h=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use âŒ˜ + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${h}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){L.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(h,t,n){this._canvas.width=Math.floor(n*h),this._canvas.height=Math.floor(n*t),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const h={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let t=null;this._canvas.addEventListener("webglcontextcreationerror",o=>{t={requestedAttributes:h},o&&(t.statusMessage=o.statusMessage,t.type=o.type)},{once:!0});const n=this._canvas.getContext("webgl2",h)||this._canvas.getContext("webgl",h);if(!n){const o="Failed to initialize WebGL";throw t?(t.message=o,new Error(JSON.stringify(t))):new Error(o)}this.painter=new Zn(n,this.transform),K.testSupport(n)}_onCooperativeGesture(h,t,n){return!t&&n<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(h){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_render(h){const t=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(h),this._removed)return;let n=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const c=this.transform.zoom,p=s.h.now();this.style.zoomHistory.update(c,p);const _=new s.a8(c,{now:p,fadeDuration:t,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),y=_.crossFadingFactor();y===1&&y===this._crossFadingFactor||(n=!0,this._crossFadingFactor=y),this.style.update(_)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,t,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:t,showPadding:this.showPadding}),this.fire(new s.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,s.bg.mark(s.bh.load),this.fire(new s.k("load"))),this.style&&(this.style.hasTransitions()||n)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const o=this._sourcesDirty||this._styleDirty||this._placementDirty;return o||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.k("idle")),!this._loaded||this._fullyLoaded||o||(this._fullyLoaded=!0,s.bg.mark(s.bh.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var h;this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Se.removeThrottleControl(this._imageQueueHandle),(h=this._resizeObserver)===null||h===void 0||h.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),L.remove(this._canvasContainer),L.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),s.bg.clearMetrics(),this._removed=!0,this.fire(new s.k("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=s.h.frame(h=>{s.bg.frame(h),this._frame=null,this._render(h)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}get version(){return pt}getCameraTargetElevation(){return this.transform.elevation}},si.NavigationControl=class{constructor(h){this._updateZoomButtons=()=>{const t=this._map.getZoom(),n=t===this._map.getMaxZoom(),o=t===this._map.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=o,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",o.toString())},this._rotateCompassArrow=()=>{const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t},this._setButtonTitle=(t,n)=>{const o=this._map._getUIString(`NavigationControl.${n}`);t.title=o,t.setAttribute("aria-label",o)},this.options=s.e({},Co,h),this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),L.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),L.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=L.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new To(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){L.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(h,t){const n=L.create("button",h,this._container);return n.type="button",n.addEventListener("click",t),n}},si.GeolocateControl=class extends s.E{constructor(h){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new s.k("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new s.k("geolocate",t)),this._finish()}},this._updateCamera=t=>{const n=new s.L(t.coords.longitude,t.coords.latitude),o=t.coords.accuracy,c=this._map.getBearing(),p=s.e({bearing:c},this.options.fitBoundsOptions),_=Be.fromLngLat(n,o);this._map.fitBounds(_,p,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const n=new s.L(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(this.options.trackUserLocation)if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&fa)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new s.k("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=t=>{if(this._map){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=L.create("button","maplibregl-ctrl-geolocate",this._container),L.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",t===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=L.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Wn({element:this._dotElement}),this._circleElement=L.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Wn({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new s.k("trackuserlocationend")))})}},this.options=s.e({},zi,h)}onAdd(h){return this._map=h,this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(t,n=!1){ji===void 0||n?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(o=>{ji=o.state!=="denied",t(ji)}).catch(()=>{ji=!!window.navigator.geolocation,t(ji)}):(ji=!!window.navigator.geolocation,t(ji)):t(ji)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),L.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Pi=0,fa=!1}_isOutOfMapMaxBounds(h){const t=this._map.getMaxBounds(),n=h.coords;return t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const h=this._map.getBounds(),t=h.getSouthEast(),n=h.getNorthEast(),o=t.distanceTo(n),c=Math.ceil(this._accuracy/(o/this._map._container.clientHeight)*2);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Pi--,fa=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new s.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Pi++,Pi>1?(h={maximumAge:6e5,timeout:0},fa=!0):(h=this.options.positionOptions,fa=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,h)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},si.AttributionControl=Br,si.LogoControl=yi,si.ScaleControl=class{constructor(h){this._onMove=()=>{Va(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,Va(this._map,this._container,this.options)},this.options=s.e({},ja,h)}getDefaultPosition(){return"bottom-left"}onAdd(h){return this._map=h,this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-scale",h.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){L.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},si.FullscreenControl=class extends s.E{constructor(h={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,h&&h.container&&(h.container instanceof HTMLElement?this._container=h.container:s.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=L.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){L.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const h=this._fullscreenButton=L.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);L.create("span","maplibregl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.title=h}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new s.k("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new s.k("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},si.TerrainControl=class{constructor(h){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=h}onAdd(h){return this._map=h,this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=L.create("button","maplibregl-ctrl-terrain",this._container),L.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){L.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},si.Popup=class extends s.E{constructor(h){super(),this.remove=()=>(this._content&&L.remove(this._content),this._container&&(L.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new s.k("close")),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=L.create("div","maplibregl-popup",this._map.getContainer()),this._tip=L.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const _ of this.options.className.split(" "))this._container.classList.add(_);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Io(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!t)return;const n=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);let o=this.options.anchor;const c=ma(this.options.offset);if(!o){const _=this._container.offsetWidth,y=this._container.offsetHeight;let x;x=n.y+c.bottom.y<y?["top"]:n.y>this._map.transform.height-y?["bottom"]:[],n.x<_/2?x.push("left"):n.x>this._map.transform.width-_/2&&x.push("right"),o=x.length===0?"bottom":x.join("-")}const p=n.add(c[o]).round();L.setTransform(this._container,`${Xr[o]} translate(${p.x}px,${p.y}px)`),Gl(this._container,o,"popup")},this._onClose=()=>{this.remove()},this.options=s.e(Object.create(Eo),h)}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new s.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(h){return this._lngLat=s.L.convert(h),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(document.createTextNode(h))}setHTML(h){const t=document.createDocumentFragment(),n=document.createElement("body");let o;for(n.innerHTML=h;o=n.firstChild,o;)t.appendChild(o);return this.setDOMContent(t)}getMaxWidth(){var h;return(h=this._container)===null||h===void 0?void 0:h.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=L.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(h),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(h){this._container&&this._container.classList.add(h)}removeClassName(h){this._container&&this._container.classList.remove(h)}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){if(this._container)return this._container.classList.toggle(h)}_createCloseButton(){this.options.closeButton&&(this._closeButton=L.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(Po);h&&h.focus()}},si.Marker=Wn,si.Style=or,si.LngLat=s.L,si.LngLatBounds=Be,si.Point=s.P,si.MercatorCoordinate=s.U,si.Evented=s.E,si.AJAXError=s.bi,si.config=s.c,si.CanvasSource=pi,si.GeoJSONSource=Yt,si.ImageSource=kt,si.RasterDEMTileSource=Bt,si.RasterTileSource=bt,si.VectorTileSource=$t,si.VideoSource=gi,si.setRTLTextPlugin=s.bj,si.getRTLTextPluginStatus=s.bk,si.prewarm=function(){sn().acquire(Ot)},si.clearPrewarmedResources=function(){const h=_i;h&&(h.isPreloaded()&&h.numActive()===1?(h.release(Ot),_i=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},Mo.extend(si,{isSafari:s.ac,getPerformanceMetrics:s.bg.getPerformanceMetrics}),si});var F=T;return F})})(Gf);var Qx=Gf.exports;const eb=w_(Qx);function tb(){const[u,m]=k.useState(!1);return Ee.jsx("div",{className:u?"fixed top-0 right-0 bottom-0 left-0 z-[9999]":"w-full h-full relative",children:Ee.jsx(Yx,{mapLib:eb,style:{width:"100%",height:" 100%",position:"relative"},mapStyle:"https://api.ekgis.vn/v2/mapstyles/style/osmplus/standard/style.json?api_key=wtpM0U1ZmE2s87LEZNSHf63Osc1a2sboaozCQNsy",children:Ee.jsx(Jx,{id:"raster-tiles",type:"raster",tileSize:256,tiles:["https://api.ekgis.vn/v1/maps/roadmap/{z}/{x}/{y}.png?api_key=wtpM0U1ZmE2s87LEZNSHf63Osc1a2sboaozCQNsy"]})})})}function ib({data:u}){return Ee.jsxs(Os,{className:"h-[500px]",children:[Ee.jsx(Vr,{span:8,children:Ee.jsx(ih,{columns:[{title:"Stt",dataIndex:"stt",key:"stt",render:(m,b,w)=>w+1},...ah],dataSource:sh,pagination:!1})}),Ee.jsx(Vr,{span:16,children:Ee.jsx(tb,{})})]})}const{Dragger:rb}=cx,nb={name:"file",multiple:!0,action:"https://run.mocky.io/v3/435e224c-44fb-4773-9faf-380c5e6a2188",onChange(u){const{status:m}=u.file;m!=="uploading"&&console.log(u.file,u.fileList),m==="done"?xp.success(`${u.file.name} file uploaded successfully.`):m==="error"&&xp.error(`${u.file.name} file upload failed.`)},onDrop(u){console.log("Dropped files",u.dataTransfer.files)}};function ab(){return Ee.jsxs(rb,{...nb,children:[Ee.jsx("p",{className:"ant-upload-drag-icon",children:Ee.jsx(px,{})}),Ee.jsx("p",{className:"ant-upload-text",children:"Click or drag file to this area to upload"}),Ee.jsx("p",{className:"ant-upload-hint",children:"Support for a single or bulk upload. Strictly prohibited from uploading company data or other banned files."})]})}function sb({form:u,filter:m,setFilter:b}){return k.useEffect(()=>{u.setFieldsValue(m)},[m]),Ee.jsxs(Zu,{form:u,layout:"vertical",onFinish:b,children:[Ee.jsx(Jr,{label:"Loáº¡i khÃ¡ch hÃ ng",name:"customer_type",children:Ee.jsx($n,{options:[{label:"Chá»n loáº¡i ",value:""},{label:"Loáº¡i A",value:"Type A"},{label:"Loáº¡i B",value:"Type B"}]})}),Ee.jsx(Jr,{label:"NhÃ³m khÃ¡ch hÃ ng",name:"customer_group",children:Ee.jsx($n,{options:[{label:"Chá»n NhÃ³m ",value:""},{label:"NhÃ³m A",value:"Group A"},{label:"NhÃ³m B",value:"Group B"}]})}),Ee.jsx("p",{className:"font-medium text-sm",children:"Äá»‹a chá»‰"}),Ee.jsx(Jr,{label:"Tá»‰nh/ThÃ nh phá»‘",name:"city",children:Ee.jsx($n,{})}),Ee.jsx(Jr,{label:"Quáº­n/huyá»‡n",name:"district",children:Ee.jsx($n,{})}),Ee.jsx(Jr,{label:"PhÆ°á»ng/xÃ£",name:"ward",children:Ee.jsx($n,{})})]})}const ob=[...ah,{title:"Loáº¡i khÃ¡ch hÃ ng",dataIndex:"customer_id",key:"customer_type"},{title:"NhÃ³m khÃ¡ch hÃ ng",dataIndex:"customer_name",key:"customer_group"},...qf],Op=u=>{let m=[];for(let b in u)u[b]&&(m=[...m,{key:[_x[b]],value:u[b],key2:b}]);return m};function lb(){const[u]=S_(),[m,b]=k.useState([]),[w,T]=k.useState(sh),[A,F]=k.useState({}),[s,j]=k.useState(!1),L={onChange:(te,he)=>{b(he)}},K=()=>{u.submit(),j(!1)},ne=te=>{if(te){let he={...A};delete he[te.key2],u.setFieldsValue(he),F(ye=>(delete ye[te.key2],{...ye}))}else console.log("há»ƒ"),u.resetFields(),F({})};return Ee.jsxs(Ee.Fragment,{children:[Ee.jsxs(Os,{className:"justify-between",children:[Ee.jsxs(Vr,{className:"inline-flex ",children:[Ee.jsx(Jr,{children:Ee.jsx(vc,{placeholder:"TÃ¬m kiáº¿m khÃ¡ch hÃ ng",prefix:Ee.jsx(nf,{})})}),Ee.jsxs("div",{className:"flex justify-center items-center ml-4",children:[Ee.jsx(na,{className:"flex items-center text-nowrap !text-[13px] !leading-[21px] !font-normal  border-r-[0.1px] rounded-r-none h-[36px]",icon:Ee.jsx(E_,{style:{fontSize:"20px"}}),onClick:j.bind(null,!0),children:"Filter"}),Ee.jsx(na,{className:"border-l-[0.1px] rounded-l-none h-[36px]",onClick:()=>ne(),children:Ee.jsx(P_,{style:{fontSize:"20px"}})})]})]}),Ee.jsxs(Vr,{className:"inline-flex items-center",children:[Ee.jsxs("span",{className:"mr-4",children:["ÄÃ£ chá»n ",m.length," khÃ¡ch hÃ ng"]}),Ee.jsx(na,{type:"primary",children:"ThÃªm"})]})]}),Ee.jsxs("div",{className:"py-5 px-4",children:[Ee.jsxs("span",{children:[w.length," káº¿t quáº£ hiá»ƒn thá»‹"]}),Op(A).length>0&&Ee.jsxs(Os,{className:"items-center",children:[Op(A).map(te=>Ee.jsxs(C_,{closeIcon:Ee.jsx(Vs,{}),onClose:()=>{ne(te)},children:[te.key,": ",te.value]})),Ee.jsx("span",{className:"cursor-pointer",onClick:()=>ne(),children:"Clear all"})]})]}),Ee.jsx(ih,{rowSelection:{type:"checkbox",...L},columns:ob,dataSource:w.map(te=>({key:te.customer_id,...te}))}),Ee.jsx(Wu,{width:451,title:"Bá»™ lá»c",open:s,okText:"Ãp dá»¥ng",cancelText:"Äáº·t láº¡i",onCancel:j.bind(null,!1),onOk:K,children:Ee.jsx(sb,{filter:A,setFilter:F,form:u})})]})}function cb(){const[u,m]=k.useState("list"),[b,w]=k.useState([]),[T,A]=k.useState(!1),[F,s]=k.useState(!1),j=K=>{switch(K){case"Choose":A(!1);break;case"Import":s(!1);break;default:A(!1),s(!1)}},L=K=>{switch(K){case"Choose":A(!0);break;case"Import":s(!0);break}};return k.useEffect(()=>{w(sh)},[]),Ee.jsxs(Ee.Fragment,{children:[Ee.jsxs(Os,{gutter:16,className:"justify-between p-4 pb-5 pt-10 mt-0",children:[Ee.jsx(Vr,{children:Ee.jsxs(Os,{gutter:8,children:[Ee.jsx(Vr,{span:9,className:"text-[#1677ff]",children:Ee.jsx(Jr,{children:Ee.jsx($n,{defaultValue:"add",options:mx,onSelect:L})})}),Ee.jsx(Vr,{span:7,children:Ee.jsx(na,{className:"w-full flex items-center text-[#1677ff] bg-[#1877f214] h-[36px]",icon:Ee.jsx(vx,{}),children:"Tá»‘i Æ°u tuyáº¿n"})}),Ee.jsx(Vr,{span:8,children:Ee.jsx(Jr,{children:Ee.jsx(vc,{placeholder:"TÃ¬m kiáº¿m khÃ¡ch hÃ ng",prefix:Ee.jsx(nf,{})})})})]})}),Ee.jsxs(Vr,{children:[" ",Ee.jsxs(Ru.Group,{defaultValue:u,onChange:K=>m(K.target.value),size:"middle",children:[Ee.jsx(Ru.Button,{value:"list",children:Ee.jsx(bx,{size:28})}),Ee.jsx(Ru.Button,{value:"map",children:Ee.jsx(xx,{size:28})})]})]})]}),Ee.jsx("div",{children:u=="list"?Ee.jsx(Sx,{data:b,handleData:w}):Ee.jsx(ib,{data:b})}),Ee.jsx(Wu,{width:1240,open:T,onCancel:j.bind(null,"Choose"),title:Ee.jsx("strong",{className:"text-xl",children:"Chá»n khÃ¡ch hÃ ng"}),footer:!1,children:Ee.jsx(lb,{})}),Ee.jsx(Wu,{width:777,open:F,onCancel:j.bind(null,"Import"),okText:"Tiáº¿p tá»¥c",cancelText:"Há»§y",title:Ee.jsx("strong",{className:"text-xl",children:"Nháº­p dá»¯ liá»‡u khÃ¡ch hÃ ng"}),children:Ee.jsx(ab,{})})]})}function ub(){const[u]=Zu.useForm();return Ee.jsxs(Ee.Fragment,{children:[Ee.jsx(M_,{title:"ThÃªm tuyáº¿n",buttons:[{label:"ThÃªm",action:u.submit,type:"primary"}]}),Ee.jsx("div",{className:"bg-white rounded-md",children:Ee.jsx(Zu,{layout:"vertical",form:u,onFinish:m=>{console.log(m)},children:Ee.jsx(Cv,{defaultActiveKey:"1",items:[{label:Ee.jsx("p",{className:"px-4 mb-0",children:" ThÃ´ng tin chung"}),key:"1",children:Ee.jsx(yx,{})},{label:Ee.jsx("p",{className:"px-4 mb-0",children:"KhÃ¡ch hÃ ng"}),key:"2",children:Ee.jsx(cb,{})}],indicatorSize:m=>m-18})})})]})}function mb(){return Ee.jsxs(Ee.Fragment,{children:[Ee.jsx(T_,{children:Ee.jsx("title",{children:" RouterControll"})}),Ee.jsx(ub,{})]})}export{mb as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/mapbox-gl-3WlcSu9R.js","assets/index-tKi9Zbpi.js","assets/index-I_Hp2o1k.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
