import{u as D,r as s,j as e,R as f,C as l,F as i,S as c,B as r,T as M,H as O}from"./index-ckSIsfCB.js";import{L as X,V as $,P as G}from"./index.esm-nphTk6AV.js";import{L as Q,a as U,b as Z}from"./index.esm-N1Nf5KW7.js";import{H as J}from"./header-page-b2wshbk0.js";import{A as d}from"./server-IAE00OTD.js";import{u as g}from"./useDebount-dqddzOVc.js";const W=[{title:"Mã tuyến",dataIndex:"channel_code",key:"channel_code"},{title:"Tên tuyến",dataIndex:"channel_name",key:"channel_name"},{title:"NVBH",dataIndex:"employee",key:"employee"},{title:"Trạng thái",dataIndex:"status",key:"status"},{title:"Ngày tạo",dataIndex:"modified",key:"modified"},{title:"Người tạo",dataIndex:"modified_by",key:"modified_by"},{title:"Ngày cập nhật",dataIndex:"modified",key:"modified"},{title:"Người cập nhật",dataIndex:"modified_by",key:"modified_by"}];function Y(){const j=D(),[S,b]=s.useState([]),[N,_]=s.useState(""),[v,w]=s.useState("");let u=g(N,300),m=g(v,500);const[k,C]=s.useState([]),[R,F]=s.useState([]),[o,E]=s.useState(),[p,L]=s.useState(),[x,I]=s.useState(),[h,T]=s.useState(1),y=20,[z,q]=s.useState([]),[A,P]=s.useState(0),H={selectedRowKeys:S,onChange:t=>{console.log("selectedRowKeys changed: ",t),b(t)}},K=t=>{I(t)},B=t=>{console.log("search:",t)},V=(t,a)=>(a?.label??"").toLowerCase().includes(t.toLowerCase());return s.useEffect(()=>{(async()=>{let t=await d.get("/api/method/frappe.desk.search.search_link",{params:{txt:u,doctype:"Employee",ignore_user_permissions:0,reference_doctype:"Attendance",query:"erpnext.controllers.queries.employee_query"}}),{results:a}=t;C(a.map(n=>({value:n.value,label:n.description})))})()},[u]),s.useEffect(()=>{(async()=>{let t=await d.get("/api/method/frappe.desk.search.search_link",{params:{txt:m,doctype:"DMS Router",ignore_user_permissions:0,reference_doctype:"Attendance",query:"mbw_dms.api.controller.queries.router_query"}}),{results:a}=t;console.log(a),F(a.map(n=>({value:n.value,label:n.description.split(",")[0],desc:n.description.split(",")[1]})))})()},[m]),s.useEffect(()=>{(async()=>{const t=await d.get("/api/method/mbw_dms.api.router.get_list_router",{params:{page_size:y,page_number:h,status:x,router:o&&o.reduce((a,n)=>`${a};${n}`),employee:p}});q(t?.result?.data),P(t?.result?.total)})()},[o,p,x,h]),e.jsxs(e.Fragment,{children:[e.jsx(J,{title:"Quản lý tuyến",buttons:[{label:"Xuất excel",icon:e.jsx(X,{className:"text-xl"}),size:"20px",className:"flex items-center mr-2"},{label:"Nhập excel",icon:e.jsx(Q,{className:"text-xl"}),size:"20px",className:"flex items-center mr-2"},{label:"Thêm mới",type:"primary",icon:e.jsx($,{className:"text-xl"}),size:"20px",className:"flex items-center",action:()=>j("/router-create")}]}),e.jsx("div",{className:"bg-[#f9fafa]",children:e.jsx("div",{className:"mx-2 pt-5 pb-10",children:e.jsx("div",{className:"pt-5",children:e.jsxs("div",{className:"h-auto bg-white py-7 px-4 rounded-lg",children:[e.jsxs(f,{className:"justify-between w-full",children:[e.jsx(l,{span:14,children:e.jsxs(f,{gutter:8,children:[e.jsx(l,{span:8,children:e.jsx(i,{name:"employee",required:!0,children:e.jsx(c,{mode:"multiple",filterOption:!1,onChange:t=>{console.log("router",o),E(t)},showSearch:!0,placeholder:"Tuyến",notFoundContent:null,onSearch:t=>w(t),options:R,optionRender:t=>e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{role:"img","aria-label":t.data.label,className:"my-1",children:t.data.label}),e.jsx("span",{className:"text-xs !font-semibold",children:t.data.desc})]})})})}),e.jsx(l,{span:8,children:e.jsx(i,{name:"employee",required:!0,children:e.jsx(c,{placeholder:"Nhân viên bán hàng",showSearch:!0,notFoundContent:null,onSearch:t=>_(t),options:k,onChange:t=>{L(t)}})})}),e.jsx(l,{span:8,children:e.jsx(i,{className:"w-[150px] border-none",children:e.jsx(c,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",optionFilterProp:"children",onChange:K,onSearch:B,filterOption:V,defaultValue:"",options:[{value:"",label:"Trạng thái"},{value:"Active",label:"Hoạt động"},{value:"Lock",label:"Khóa"}]})})})]})}),e.jsx(l,{children:e.jsxs("div",{className:"flex flex-wrap items-center",children:[e.jsxs("div",{className:"flex justify-center items-center mr-4",children:[e.jsx(r,{className:"flex items-center text-nowrap !text-[13px] !leading-[21px] !font-normal  border-r-[0.1px] rounded-r-none h-[32px]",icon:e.jsx(U,{style:{fontSize:"20px"}}),children:"Filter"}),e.jsx(r,{className:"border-l-[0.1px] rounded-l-none h-[32px]",children:e.jsx(Z,{style:{fontSize:"20px"}})})]}),e.jsxs("div",{className:"flex justify-center items-center rounded-md",children:[e.jsx(r,{className:"border-r-[0.1px] rounded-r-none",children:e.jsx(G,{style:{fontSize:"20px"}})}),e.jsx(r,{className:"border-l-[0.1px] rounded-l-none",children:"Last update on"})]})]})})]}),e.jsx("div",{className:"pt-5",children:e.jsx("div",{children:e.jsx(M,{rowSelection:H,columns:W,dataSource:z?.map(t=>({key:t.channel_code,...t})),pagination:{defaultPageSize:y,total:A,onChange(t,a){T(t)}}})})})]})})})})]})}function re(){return e.jsxs(e.Fragment,{children:[e.jsx(O,{children:e.jsx("title",{children:" RouterControll"})}),e.jsx(Y,{})]})}export{re as default};
