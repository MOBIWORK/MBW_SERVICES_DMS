import{r as q,_ as is,a as Qr,c as Ut,b as Ui,K as f_,R as Cs,d as Ks,C as vf,e as Cc,f as Ts,g as Yr,h as el,i as Tc,m as Ic,k as On,l as Ec,n as xf,o as Es,u as Pc,p as wh,q as Sh,E as bf,L as mh,s as Ac,t as wf,v as Ni,w as m_,x as g_,y as Sf,z as Cf,A as Mc,D as __,G as gh,J as Tf,M as y_,N as v_,O as Ua,P as x_,Q as If,U as Ef,V as Pf,W as Jr,X as Af,Y as b_,Z as w_,$ as gp,a0 as Mf,a1 as kf,a2 as _p,a3 as S_,a4 as C_,a5 as zf,a6 as T_,a7 as I_,a8 as yp,a9 as vp,B as ja,aa as E_,ab as P_,ac as A_,ad as M_,j as ye,ae as Ys,af as Df,ag as Rr,F as qr,I as yc,S as Sn,T as Ch,ah as k_,ai as z_,aj as _h,ak as D_,al as Lf,am as L_,an as R_,ao as qu,ap as F_,H as B_}from"./index-xfynDe6l.js";import{I as Rf,i as O_,M as yh,T as $_}from"./index-eeZMsLw4.js";import{a as N_,b as j_}from"./index.esm-MmghhTxH.js";import{H as V_}from"./header-page-KqLsgQoe.js";var Th=q.forwardRef(function(f,m){var b=f.prefixCls,S=f.style,T=f.className,k=f.duration,B=k===void 0?4.5:k,a=f.eventKey,W=f.content,F=f.closable,ne=f.closeIcon,ie=ne===void 0?"x":ne,ue=f.props,_e=f.onClick,Ee=f.onNoticeClose,ke=f.times,Me=f.hovering,ze=q.useState(!1),je=is(ze,2),Ne=je[0],me=je[1],Ie=Me||Ne,it=function(){Ee(a)},Ye=function(De){(De.key==="Enter"||De.code==="Enter"||De.keyCode===f_.ENTER)&&it()};q.useEffect(function(){if(!Ie&&B>0){var at=setTimeout(function(){it()},B*1e3);return function(){clearTimeout(at)}}},[B,Ie,ke]);var Ge="".concat(b,"-notice");return q.createElement("div",Qr({},ue,{ref:m,className:Ut(Ge,T,Ui({},"".concat(Ge,"-closable"),F)),style:S,onMouseEnter:function(De){var rt;me(!0),ue==null||(rt=ue.onMouseEnter)===null||rt===void 0||rt.call(ue,De)},onMouseLeave:function(De){var rt;me(!1),ue==null||(rt=ue.onMouseLeave)===null||rt===void 0||rt.call(ue,De)},onClick:_e}),q.createElement("div",{className:"".concat(Ge,"-content")},W),F&&q.createElement("a",{tabIndex:0,className:"".concat(Ge,"-close"),onKeyDown:Ye,onClick:function(De){De.preventDefault(),De.stopPropagation(),it()}},ie))}),Ff=Cs.createContext({}),Bf=function(m){var b=m.children,S=m.classNames;return Cs.createElement(Ff.Provider,{value:{classNames:S}},b)},xp=8,bp=3,wp=16,U_=function(m){var b={offset:xp,threshold:bp,gap:wp};if(m&&Ks(m)==="object"){var S,T,k;b.offset=(S=m.offset)!==null&&S!==void 0?S:xp,b.threshold=(T=m.threshold)!==null&&T!==void 0?T:bp,b.gap=(k=m.gap)!==null&&k!==void 0?k:wp}return[!!m,b]},q_=["className","style","classNames","styles"],Z_=function(m){var b,S=m.configList,T=m.placement,k=m.prefixCls,B=m.className,a=m.style,W=m.motion,F=m.onAllNoticeRemoved,ne=m.onNoticeClose,ie=m.stack,ue=q.useContext(Ff),_e=ue.classNames,Ee=q.useRef({}),ke=q.useState(null),Me=is(ke,2),ze=Me[0],je=Me[1],Ne=q.useState([]),me=is(Ne,2),Ie=me[0],it=me[1],Ye=S.map(function(ft){return{config:ft,key:String(ft.key)}}),Ge=U_(ie),at=is(Ge,2),De=at[0],rt=at[1],xt=rt.offset,Pt=rt.threshold,gt=rt.gap,At=De&&(Ie.length>0||Ye.length<=Pt),Bt=typeof W=="function"?W(T):W;return q.useEffect(function(){De&&Ie.length>1&&it(function(ft){return ft.filter(function(si){return Ye.some(function(Mi){var Ki=Mi.key;return si===Ki})})})},[Ie,Ye,De]),q.useEffect(function(){var ft;if(De&&Ee.current[(ft=Ye[Ye.length-1])===null||ft===void 0?void 0:ft.key]){var si;je(Ee.current[(si=Ye[Ye.length-1])===null||si===void 0?void 0:si.key])}},[Ye,De]),Cs.createElement(vf,Qr({key:T,className:Ut(k,"".concat(k,"-").concat(T),_e?.list,B,(b={},Ui(b,"".concat(k,"-stack"),!!De),Ui(b,"".concat(k,"-stack-expanded"),At),b)),style:a,keys:Ye,motionAppear:!0},Bt,{onAllRemoved:function(){F(T)}}),function(ft,si){var Mi=ft.config,Ki=ft.className,ai=ft.style,Kt=ft.index,Ze=Mi,yt=Ze.key,Jt=Ze.times,Mt=String(yt),Yt=Mi,gi=Yt.className,Qt=Yt.style,Rt=Yt.classNames,ki=Yt.styles,bi=Cc(Yt,q_),Xt=Ye.findIndex(function(qi){return qi.key===Mt}),Ti={};if(De){var nr=Ye.length-1-(Xt>-1?Xt:Kt-1),fr=T==="top"||T==="bottom"?"-50%":"0";if(nr>0){var sr,mr,Cr;Ti.height=At?(sr=Ee.current[Mt])===null||sr===void 0?void 0:sr.offsetHeight:ze?.offsetHeight;for(var ge=0,Ii=0;Ii<nr;Ii++){var ji;ge+=((ji=Ee.current[Ye[Ye.length-1-Ii].key])===null||ji===void 0?void 0:ji.offsetHeight)+gt}var jt=(At?ge:nr*xt)*(T.startsWith("top")?1:-1),kt=!At&&ze!==null&&ze!==void 0&&ze.offsetWidth&&(mr=Ee.current[Mt])!==null&&mr!==void 0&&mr.offsetWidth?(ze?.offsetWidth-xt*2*(nr<3?nr:3))/((Cr=Ee.current[Mt])===null||Cr===void 0?void 0:Cr.offsetWidth):1;Ti.transform="translate3d(".concat(fr,", ").concat(jt,"px, 0) scaleX(").concat(kt,")")}else Ti.transform="translate3d(".concat(fr,", 0, 0)")}return Cs.createElement("div",{ref:si,className:Ut("".concat(k,"-notice-wrapper"),Ki,Rt?.wrapper),style:Ts(Ts(Ts({},ai),Ti),ki?.wrapper),onMouseEnter:function(){return it(function(Ji){return Ji.includes(Mt)?Ji:[].concat(Yr(Ji),[Mt])})},onMouseLeave:function(){return it(function(Ji){return Ji.filter(function(ar){return ar!==Mt})})}},Cs.createElement(Th,Qr({},bi,{ref:function(Ji){Xt>-1?Ee.current[Mt]=Ji:delete Ee.current[Mt]},prefixCls:k,classNames:Rt,styles:ki,className:Ut(gi,_e?.notice),style:Qt,times:Jt,key:yt,eventKey:yt,onNoticeClose:ne,hovering:De&&Ie.length>0})))})},G_=q.forwardRef(function(f,m){var b=f.prefixCls,S=b===void 0?"rc-notification":b,T=f.container,k=f.motion,B=f.maxCount,a=f.className,W=f.style,F=f.onAllRemoved,ne=f.stack,ie=f.renderNotifications,ue=q.useState([]),_e=is(ue,2),Ee=_e[0],ke=_e[1],Me=function(at){var De,rt=Ee.find(function(xt){return xt.key===at});rt==null||(De=rt.onClose)===null||De===void 0||De.call(rt),ke(function(xt){return xt.filter(function(Pt){return Pt.key!==at})})};q.useImperativeHandle(m,function(){return{open:function(at){ke(function(De){var rt=Yr(De),xt=rt.findIndex(function(At){return At.key===at.key}),Pt=Ts({},at);if(xt>=0){var gt;Pt.times=(((gt=De[xt])===null||gt===void 0?void 0:gt.times)||0)+1,rt[xt]=Pt}else Pt.times=0,rt.push(Pt);return B>0&&rt.length>B&&(rt=rt.slice(-B)),rt})},close:function(at){Me(at)},destroy:function(){ke([])}}});var ze=q.useState({}),je=is(ze,2),Ne=je[0],me=je[1];q.useEffect(function(){var Ge={};Ee.forEach(function(at){var De=at.placement,rt=De===void 0?"topRight":De;rt&&(Ge[rt]=Ge[rt]||[],Ge[rt].push(at))}),Object.keys(Ne).forEach(function(at){Ge[at]=Ge[at]||[]}),me(Ge)},[Ee]);var Ie=function(at){me(function(De){var rt=Ts({},De),xt=rt[at]||[];return xt.length||delete rt[at],rt})},it=q.useRef(!1);if(q.useEffect(function(){Object.keys(Ne).length>0?it.current=!0:it.current&&(F?.(),it.current=!1)},[Ne]),!T)return null;var Ye=Object.keys(Ne);return el.createPortal(q.createElement(q.Fragment,null,Ye.map(function(Ge){var at=Ne[Ge],De=q.createElement(Z_,{key:Ge,configList:at,placement:Ge,prefixCls:S,className:a?.(Ge),style:W?.(Ge),motion:k,onNoticeClose:Me,onAllNoticeRemoved:Ie,stack:ne});return ie?ie(De,{prefixCls:S,key:Ge}):De})),T)}),H_=["getContainer","motion","prefixCls","maxCount","className","style","onAllRemoved","stack","renderNotifications"],W_=function(){return document.body},Sp=0;function X_(){for(var f={},m=arguments.length,b=new Array(m),S=0;S<m;S++)b[S]=arguments[S];return b.forEach(function(T){T&&Object.keys(T).forEach(function(k){var B=T[k];B!==void 0&&(f[k]=B)})}),f}function Of(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},m=f.getContainer,b=m===void 0?W_:m,S=f.motion,T=f.prefixCls,k=f.maxCount,B=f.className,a=f.style,W=f.onAllRemoved,F=f.stack,ne=f.renderNotifications,ie=Cc(f,H_),ue=q.useState(),_e=is(ue,2),Ee=_e[0],ke=_e[1],Me=q.useRef(),ze=q.createElement(G_,{container:Ee,ref:Me,prefixCls:T,motion:S,maxCount:k,className:B,style:a,onAllRemoved:W,stack:F,renderNotifications:ne}),je=q.useState([]),Ne=is(je,2),me=Ne[0],Ie=Ne[1],it=q.useMemo(function(){return{open:function(Ge){var at=X_(ie,Ge);(at.key===null||at.key===void 0)&&(at.key="rc-notification-".concat(Sp),Sp+=1),Ie(function(De){return[].concat(Yr(De),[{type:"open",config:at}])})},close:function(Ge){Ie(function(at){return[].concat(Yr(at),[{type:"close",key:Ge}])})},destroy:function(){Ie(function(Ge){return[].concat(Yr(Ge),[{type:"destroy"}])})}}},[]);return q.useEffect(function(){ke(b())}),q.useEffect(function(){Me.current&&me.length&&(me.forEach(function(Ye){switch(Ye.type){case"open":Me.current.open(Ye.config);break;case"close":Me.current.close(Ye.key);break;case"destroy":Me.current.destroy();break}}),Ie(function(Ye){return Ye.filter(function(Ge){return!me.includes(Ge)})}))},[me]),[it,ze]}const K_=f=>{const{componentCls:m,iconCls:b,boxShadow:S,colorText:T,colorSuccess:k,colorError:B,colorWarning:a,colorInfo:W,fontSizeLG:F,motionEaseInOutCirc:ne,motionDurationSlow:ie,marginXS:ue,paddingXS:_e,borderRadiusLG:Ee,zIndexPopup:ke,contentPadding:Me,contentBg:ze}=f,je=`${m}-notice`,Ne=new On("MessageMoveIn",{"0%":{padding:0,transform:"translateY(-100%)",opacity:0},"100%":{padding:_e,transform:"translateY(0)",opacity:1}}),me=new On("MessageMoveOut",{"0%":{maxHeight:f.height,padding:_e,opacity:1},"100%":{maxHeight:0,padding:0,opacity:0}}),Ie={padding:_e,textAlign:"center",[`${m}-custom-content > ${b}`]:{verticalAlign:"text-bottom",marginInlineEnd:ue,fontSize:F},[`${je}-content`]:{display:"inline-block",padding:Me,background:ze,borderRadius:Ee,boxShadow:S,pointerEvents:"all"},[`${m}-success > ${b}`]:{color:k},[`${m}-error > ${b}`]:{color:B},[`${m}-warning > ${b}`]:{color:a},[`${m}-info > ${b},
      ${m}-loading > ${b}`]:{color:W}};return[{[m]:Object.assign(Object.assign({},Ec(f)),{color:T,position:"fixed",top:ue,width:"100%",pointerEvents:"none",zIndex:ke,[`${m}-move-up`]:{animationFillMode:"forwards"},[`
        ${m}-move-up-appear,
        ${m}-move-up-enter
      `]:{animationName:Ne,animationDuration:ie,animationPlayState:"paused",animationTimingFunction:ne},[`
        ${m}-move-up-appear${m}-move-up-appear-active,
        ${m}-move-up-enter${m}-move-up-enter-active
      `]:{animationPlayState:"running"},[`${m}-move-up-leave`]:{animationName:me,animationDuration:ie,animationPlayState:"paused",animationTimingFunction:ne},[`${m}-move-up-leave${m}-move-up-leave-active`]:{animationPlayState:"running"},"&-rtl":{direction:"rtl",span:{direction:"rtl"}}})},{[m]:{[`${je}-wrapper`]:Object.assign({},Ie)}},{[`${m}-notice-pure-panel`]:Object.assign(Object.assign({},Ie),{padding:0,textAlign:"start"})}]},J_=f=>({zIndexPopup:f.zIndexPopupBase+xf+10,contentBg:f.colorBgElevated,contentPadding:`${(f.controlHeightLG-f.fontSize*f.lineHeight)/2}px ${f.paddingSM}px`}),$f=Tc("Message",f=>{const m=Ic(f,{height:150});return[K_(m)]},J_);var Y_=function(f,m){var b={};for(var S in f)Object.prototype.hasOwnProperty.call(f,S)&&m.indexOf(S)<0&&(b[S]=f[S]);if(f!=null&&typeof Object.getOwnPropertySymbols=="function")for(var T=0,S=Object.getOwnPropertySymbols(f);T<S.length;T++)m.indexOf(S[T])<0&&Object.prototype.propertyIsEnumerable.call(f,S[T])&&(b[S[T]]=f[S[T]]);return b};const Q_={info:q.createElement(Rf,null),success:q.createElement(wh,null),error:q.createElement(Sh,null),warning:q.createElement(bf,null),loading:q.createElement(mh,null)},Nf=f=>{let{prefixCls:m,type:b,icon:S,children:T}=f;return q.createElement("div",{className:Ut(`${m}-custom-content`,`${m}-${b}`)},S||Q_[b],q.createElement("span",null,T))},ey=f=>{const{prefixCls:m,className:b,type:S,icon:T,content:k}=f,B=Y_(f,["prefixCls","className","type","icon","content"]),{getPrefixCls:a}=q.useContext(Es),W=m||a("message"),F=Pc(W),[ne,ie,ue]=$f(W,F);return ne(q.createElement(Th,Object.assign({},B,{prefixCls:W,className:Ut(b,ie,`${W}-notice-pure-panel`,ue,F),eventKey:"pure",duration:null,content:q.createElement(Nf,{prefixCls:W,type:S,icon:T},k)})))},ty=ey;function iy(f,m){return{motionName:m??`${f}-move-up`}}function Ih(f){let m;const b=new Promise(T=>{m=f(()=>{T(!0)})}),S=()=>{m?.()};return S.then=(T,k)=>b.then(T,k),S.promise=b,S}var ry=function(f,m){var b={};for(var S in f)Object.prototype.hasOwnProperty.call(f,S)&&m.indexOf(S)<0&&(b[S]=f[S]);if(f!=null&&typeof Object.getOwnPropertySymbols=="function")for(var T=0,S=Object.getOwnPropertySymbols(f);T<S.length;T++)m.indexOf(S[T])<0&&Object.prototype.propertyIsEnumerable.call(f,S[T])&&(b[S[T]]=f[S[T]]);return b};const ny=8,sy=3,ay=f=>{let{children:m,prefixCls:b}=f;const S=Pc(b),[T,k,B]=$f(b,S);return T(q.createElement(Bf,{classNames:{list:Ut(k,B,S)}},m))},oy=(f,m)=>{let{prefixCls:b,key:S}=m;return q.createElement(ay,{prefixCls:b,key:S},f)},ly=q.forwardRef((f,m)=>{const{top:b,prefixCls:S,getContainer:T,maxCount:k,duration:B=sy,rtl:a,transitionName:W,onAllRemoved:F}=f,{getPrefixCls:ne,getPopupContainer:ie,message:ue}=q.useContext(Es),_e=S||ne("message"),Ee=()=>({left:"50%",transform:"translateX(-50%)",top:b??ny}),ke=()=>Ut({[`${_e}-rtl`]:a}),Me=()=>iy(_e,W),ze=q.createElement("span",{className:`${_e}-close-x`},q.createElement(Ac,{className:`${_e}-close-icon`})),[je,Ne]=Of({prefixCls:_e,style:Ee,className:ke,motion:Me,closable:!1,closeIcon:ze,duration:B,getContainer:()=>T?.()||ie?.()||document.body,maxCount:k,onAllRemoved:F,renderNotifications:oy});return q.useImperativeHandle(m,()=>Object.assign(Object.assign({},je),{prefixCls:_e,message:ue})),Ne});let Cp=0;function jf(f){const m=q.useRef(null);return wf(),[q.useMemo(()=>{const S=W=>{var F;(F=m.current)===null||F===void 0||F.close(W)},T=W=>{if(!m.current){const it=()=>{};return it.then=()=>{},it}const{open:F,prefixCls:ne,message:ie}=m.current,ue=`${ne}-notice`,{content:_e,icon:Ee,type:ke,key:Me,className:ze,style:je,onClose:Ne}=W,me=ry(W,["content","icon","type","key","className","style","onClose"]);let Ie=Me;return Ie==null&&(Cp+=1,Ie=`antd-message-${Cp}`),Ih(it=>(F(Object.assign(Object.assign({},me),{key:Ie,content:q.createElement(Nf,{prefixCls:ne,type:ke,icon:Ee},_e),placement:"top",className:Ut(ke&&`${ue}-${ke}`,ze,ie?.className),style:Object.assign(Object.assign({},ie?.style),je),onClose:()=>{Ne?.(),it()}})),()=>{S(Ie)}))},B={open:T,destroy:W=>{var F;W!==void 0?S(W):(F=m.current)===null||F===void 0||F.destroy()}};return["info","success","warning","error","loading"].forEach(W=>{const F=(ne,ie,ue)=>{let _e;ne&&typeof ne=="object"&&"content"in ne?_e=ne:_e={content:ne};let Ee,ke;typeof ie=="function"?ke=ie:(Ee=ie,ke=ue);const Me=Object.assign(Object.assign({onClose:ke,duration:Ee},_e),{type:W});return T(Me)};B[W]=F}),B},[]),q.createElement(ly,Object.assign({key:"message-holder"},f,{ref:m}))]}function cy(f){return jf(f)}const uy=f=>{const{componentCls:m,notificationMarginEdge:b,animationMaxHeight:S}=f,T=`${m}-notice`,k=new On("antNotificationFadeIn",{"0%":{transform:"translate3d(100%, 0, 0)",opacity:0},"100%":{transform:"translate3d(0, 0, 0)",opacity:1}}),B=new On("antNotificationTopFadeIn",{"0%":{top:-S,opacity:0},"100%":{top:0,opacity:1}}),a=new On("antNotificationBottomFadeIn",{"0%":{bottom:f.calc(S).mul(-1).equal(),opacity:0},"100%":{bottom:0,opacity:1}}),W=new On("antNotificationLeftFadeIn",{"0%":{transform:"translate3d(-100%, 0, 0)",opacity:0},"100%":{transform:"translate3d(0, 0, 0)",opacity:1}});return{[m]:{[`&${m}-top, &${m}-bottom`]:{marginInline:0,[T]:{marginInline:"auto auto"}},[`&${m}-top`]:{[`${m}-fade-enter${m}-fade-enter-active, ${m}-fade-appear${m}-fade-appear-active`]:{animationName:B}},[`&${m}-bottom`]:{[`${m}-fade-enter${m}-fade-enter-active, ${m}-fade-appear${m}-fade-appear-active`]:{animationName:a}},[`&${m}-topRight, &${m}-bottomRight`]:{[`${m}-fade-enter${m}-fade-enter-active, ${m}-fade-appear${m}-fade-appear-active`]:{animationName:k}},[`&${m}-topLeft, &${m}-bottomLeft`]:{marginRight:{value:0,_skip_check_:!0},marginLeft:{value:b,_skip_check_:!0},[T]:{marginInlineEnd:"auto",marginInlineStart:0},[`${m}-fade-enter${m}-fade-enter-active, ${m}-fade-appear${m}-fade-appear-active`]:{animationName:W}}}}},hy=uy,dy=["top","topLeft","topRight","bottom","bottomLeft","bottomRight"],py={topLeft:"left",topRight:"right",bottomLeft:"left",bottomRight:"right",top:"left",bottom:"left"},fy=(f,m)=>{const{componentCls:b}=f;return{[`${b}-${m}`]:{[`&${b}-stack > ${b}-notice-wrapper`]:{[m.startsWith("top")?"top":"bottom"]:0,[py[m]]:{value:0,_skip_check_:!0}}}}},my=f=>{const m={};for(let b=1;b<f.notificationStackLayer;b++)m[`&:nth-last-child(${b+1})`]={overflow:"hidden",[`& > ${f.componentCls}-notice`]:{opacity:0,transition:`opacity ${f.motionDurationMid}`}};return Object.assign({[`&:not(:nth-last-child(-n+${f.notificationStackLayer}))`]:{opacity:0,overflow:"hidden",color:"transparent",pointerEvents:"none"}},m)},gy=f=>{const m={};for(let b=1;b<f.notificationStackLayer;b++)m[`&:nth-last-child(${b+1})`]={background:f.colorBgBlur,backdropFilter:"blur(10px)","-webkit-backdrop-filter":"blur(10px)"};return Object.assign({},m)},_y=f=>{const{componentCls:m}=f;return Object.assign({[`${m}-stack`]:{[`& > ${m}-notice-wrapper`]:Object.assign({transition:`all ${f.motionDurationSlow}, backdrop-filter 0s`,position:"absolute"},my(f))},[`${m}-stack:not(${m}-stack-expanded)`]:{[`& > ${m}-notice-wrapper`]:Object.assign({},gy(f))},[`${m}-stack${m}-stack-expanded`]:{[`& > ${m}-notice-wrapper`]:{"&:not(:nth-last-child(-n + 1))":{opacity:1,overflow:"unset",color:"inherit",pointerEvents:"auto",[`& > ${f.componentCls}-notice`]:{opacity:1}},"&:after":{content:'""',position:"absolute",height:f.margin,width:"100%",insetInline:0,bottom:f.calc(f.margin).mul(-1).equal(),background:"transparent",pointerEvents:"auto"}}}},dy.map(b=>fy(f,b)).reduce((b,S)=>Object.assign(Object.assign({},b),S),{}))},yy=_y,Vf=f=>{const{iconCls:m,componentCls:b,boxShadow:S,fontSizeLG:T,notificationMarginBottom:k,borderRadiusLG:B,colorSuccess:a,colorInfo:W,colorWarning:F,colorError:ne,colorTextHeading:ie,notificationBg:ue,notificationPadding:_e,notificationMarginEdge:Ee,fontSize:ke,lineHeight:Me,width:ze,notificationIconSize:je,colorText:Ne}=f,me=`${b}-notice`;return{position:"relative",marginBottom:k,marginInlineStart:"auto",background:ue,borderRadius:B,boxShadow:S,[me]:{padding:_e,width:ze,maxWidth:`calc(100vw - ${Ni(f.calc(Ee).mul(2).equal())})`,overflow:"hidden",lineHeight:Me,wordWrap:"break-word"},[`${b}-close-icon`]:{fontSize:ke,cursor:"pointer"},[`${me}-message`]:{marginBottom:f.marginXS,color:ie,fontSize:T,lineHeight:f.lineHeightLG},[`${me}-description`]:{fontSize:ke,color:Ne},[`${me}-closable ${me}-message`]:{paddingInlineEnd:f.paddingLG},[`${me}-with-icon ${me}-message`]:{marginBottom:f.marginXS,marginInlineStart:f.calc(f.marginSM).add(je).equal(),fontSize:T},[`${me}-with-icon ${me}-description`]:{marginInlineStart:f.calc(f.marginSM).add(je).equal(),fontSize:ke},[`${me}-icon`]:{position:"absolute",fontSize:je,lineHeight:1,[`&-success${m}`]:{color:a},[`&-info${m}`]:{color:W},[`&-warning${m}`]:{color:F},[`&-error${m}`]:{color:ne}},[`${me}-close`]:{position:"absolute",top:f.notificationPaddingVertical,insetInlineEnd:f.notificationPaddingHorizontal,color:f.colorIcon,outline:"none",width:f.notificationCloseButtonSize,height:f.notificationCloseButtonSize,borderRadius:f.borderRadiusSM,transition:`background-color ${f.motionDurationMid}, color ${f.motionDurationMid}`,display:"flex",alignItems:"center",justifyContent:"center","&:hover":{color:f.colorIconHover,backgroundColor:f.closeBtnHoverBg}},[`${me}-btn`]:{float:"right",marginTop:f.marginSM}}},vy=f=>{const{componentCls:m,notificationMarginBottom:b,notificationMarginEdge:S,motionDurationMid:T,motionEaseInOut:k}=f,B=`${m}-notice`,a=new On("antNotificationFadeOut",{"0%":{maxHeight:f.animationMaxHeight,marginBottom:b},"100%":{maxHeight:0,marginBottom:0,paddingTop:0,paddingBottom:0,opacity:0}});return[{[m]:Object.assign(Object.assign({},Ec(f)),{position:"fixed",zIndex:f.zIndexPopup,marginRight:{value:S,_skip_check_:!0},[`${m}-hook-holder`]:{position:"relative"},[`${m}-fade-appear-prepare`]:{opacity:"0 !important"},[`${m}-fade-enter, ${m}-fade-appear`]:{animationDuration:f.motionDurationMid,animationTimingFunction:k,animationFillMode:"both",opacity:0,animationPlayState:"paused"},[`${m}-fade-leave`]:{animationTimingFunction:k,animationFillMode:"both",animationDuration:T,animationPlayState:"paused"},[`${m}-fade-enter${m}-fade-enter-active, ${m}-fade-appear${m}-fade-appear-active`]:{animationPlayState:"running"},[`${m}-fade-leave${m}-fade-leave-active`]:{animationName:a,animationPlayState:"running"},"&-rtl":{direction:"rtl",[`${B}-btn`]:{float:"left"}}})},{[m]:{[`${B}-wrapper`]:Object.assign({},Vf(f))}}]},Uf=f=>({zIndexPopup:f.zIndexPopupBase+xf+50,width:384,closeBtnHoverBg:f.wireframe?"transparent":f.colorFillContent}),qf=f=>{const m=f.paddingMD,b=f.paddingLG;return Ic(f,{notificationBg:f.colorBgElevated,notificationPaddingVertical:m,notificationPaddingHorizontal:b,notificationIconSize:f.calc(f.fontSizeLG).mul(f.lineHeightLG).equal(),notificationCloseButtonSize:f.calc(f.controlHeightLG).mul(.55).equal(),notificationMarginBottom:f.margin,notificationPadding:`${Ni(f.paddingMD)} ${Ni(f.paddingContentHorizontalLG)}`,notificationMarginEdge:f.marginLG,animationMaxHeight:150,notificationStackLayer:3})},Zf=Tc("Notification",f=>{const m=qf(f);return[vy(m),hy(m),yy(m)]},Uf),xy=m_(["Notification","PurePanel"],f=>{const m=`${f.componentCls}-notice`,b=qf(f);return{[`${m}-pure-panel`]:Object.assign(Object.assign({},Vf(b)),{width:b.width,maxWidth:`calc(100vw - ${Ni(f.calc(b.notificationMarginEdge).mul(2).equal())})`,margin:0})}},Uf);var by=function(f,m){var b={};for(var S in f)Object.prototype.hasOwnProperty.call(f,S)&&m.indexOf(S)<0&&(b[S]=f[S]);if(f!=null&&typeof Object.getOwnPropertySymbols=="function")for(var T=0,S=Object.getOwnPropertySymbols(f);T<S.length;T++)m.indexOf(S[T])<0&&Object.prototype.propertyIsEnumerable.call(f,S[T])&&(b[S[T]]=f[S[T]]);return b};function Eh(f,m){return m===null||m===!1?null:m||q.createElement("span",{className:`${f}-close-x`},q.createElement(Ac,{className:`${f}-close-icon`}))}const wy={success:wh,info:Rf,error:Sh,warning:bf},Gf=f=>{const{prefixCls:m,icon:b,type:S,message:T,description:k,btn:B,role:a="alert"}=f;let W=null;return b?W=q.createElement("span",{className:`${m}-icon`},b):S&&(W=q.createElement(wy[S]||null,{className:Ut(`${m}-icon`,`${m}-icon-${S}`)})),q.createElement("div",{className:Ut({[`${m}-with-icon`]:W}),role:a},W,q.createElement("div",{className:`${m}-message`},T),q.createElement("div",{className:`${m}-description`},k),B&&q.createElement("div",{className:`${m}-btn`},B))},Sy=f=>{const{prefixCls:m,className:b,icon:S,type:T,message:k,description:B,btn:a,closable:W=!0,closeIcon:F,className:ne}=f,ie=by(f,["prefixCls","className","icon","type","message","description","btn","closable","closeIcon","className"]),{getPrefixCls:ue}=q.useContext(Es),_e=m||ue("notification"),Ee=`${_e}-notice`,ke=Pc(_e),[Me,ze,je]=Zf(_e,ke);return Me(q.createElement("div",{className:Ut(`${Ee}-pure-panel`,ze,b,je,ke)},q.createElement(xy,{prefixCls:_e}),q.createElement(Th,Object.assign({},ie,{prefixCls:_e,eventKey:"pure",duration:null,closable:W,className:Ut({notificationClassName:ne}),closeIcon:Eh(_e,F),content:q.createElement(Gf,{prefixCls:Ee,icon:S,type:T,message:k,description:B,btn:a})}))))},Cy=Sy;function Ty(f,m,b){let S;switch(f){case"top":S={left:"50%",transform:"translateX(-50%)",right:"auto",top:m,bottom:"auto"};break;case"topLeft":S={left:0,top:m,bottom:"auto"};break;case"topRight":S={right:0,top:m,bottom:"auto"};break;case"bottom":S={left:"50%",transform:"translateX(-50%)",right:"auto",top:"auto",bottom:b};break;case"bottomLeft":S={left:0,top:"auto",bottom:b};break;default:S={right:0,top:"auto",bottom:b};break}return S}function Iy(f){return{motionName:`${f}-fade`}}var Ey=function(f,m){var b={};for(var S in f)Object.prototype.hasOwnProperty.call(f,S)&&m.indexOf(S)<0&&(b[S]=f[S]);if(f!=null&&typeof Object.getOwnPropertySymbols=="function")for(var T=0,S=Object.getOwnPropertySymbols(f);T<S.length;T++)m.indexOf(S[T])<0&&Object.prototype.propertyIsEnumerable.call(f,S[T])&&(b[S[T]]=f[S[T]]);return b};const Tp=24,Py=4.5,Ay="topRight",My=f=>{let{children:m,prefixCls:b}=f;const S=Pc(b),[T,k,B]=Zf(b,S);return T(q.createElement(Bf,{classNames:{list:Ut(k,B,S)}},m))},ky=(f,m)=>{let{prefixCls:b,key:S}=m;return q.createElement(My,{prefixCls:b,key:S},f)},zy=q.forwardRef((f,m)=>{const{top:b,bottom:S,prefixCls:T,getContainer:k,maxCount:B,rtl:a,onAllRemoved:W,stack:F}=f,{getPrefixCls:ne,getPopupContainer:ie,notification:ue}=q.useContext(Es),[,_e]=g_(),Ee=T||ne("notification"),ke=me=>Ty(me,b??Tp,S??Tp),Me=()=>Ut({[`${Ee}-rtl`]:a}),ze=()=>Iy(Ee),[je,Ne]=Of({prefixCls:Ee,style:ke,className:Me,motion:ze,closable:!0,closeIcon:Eh(Ee),duration:Py,getContainer:()=>k?.()||ie?.()||document.body,maxCount:B,onAllRemoved:W,renderNotifications:ky,stack:F===!1?!1:{threshold:typeof F=="object"?F?.threshold:void 0,offset:8,gap:_e.margin}});return q.useImperativeHandle(m,()=>Object.assign(Object.assign({},je),{prefixCls:Ee,notification:ue})),Ne});function Hf(f){const m=q.useRef(null);return wf(),[q.useMemo(()=>{const S=a=>{var W;if(!m.current)return;const{open:F,prefixCls:ne,notification:ie}=m.current,ue=`${ne}-notice`,{message:_e,description:Ee,icon:ke,type:Me,btn:ze,className:je,style:Ne,role:me="alert",closeIcon:Ie}=a,it=Ey(a,["message","description","icon","type","btn","className","style","role","closeIcon"]),Ye=Eh(ue,Ie);return F(Object.assign(Object.assign({placement:(W=f?.placement)!==null&&W!==void 0?W:Ay},it),{content:q.createElement(Gf,{prefixCls:ue,icon:ke,type:Me,message:_e,description:Ee,btn:ze,role:me}),className:Ut(Me&&`${ue}-${Me}`,je,ie?.className),style:Object.assign(Object.assign({},ie?.style),Ne),closeIcon:Ye,closable:!!Ye}))},k={open:S,destroy:a=>{var W,F;a!==void 0?(W=m.current)===null||W===void 0||W.close(a):(F=m.current)===null||F===void 0||F.destroy()}};return["success","info","warning","error"].forEach(a=>{k[a]=W=>S(Object.assign(Object.assign({},W),{type:a}))}),k},[]),q.createElement(zy,Object.assign({key:"notification-holder"},f,{ref:m}))]}function Dy(f){return Hf(f)}let un=null,Js=f=>f(),tl=[],vc={};function Ip(){const{prefixCls:f,getContainer:m,duration:b,rtl:S,maxCount:T,top:k}=vc,B=f??Mc().getPrefixCls("message"),a=m?.()||document.body;return{prefixCls:B,getContainer:()=>a,duration:b,rtl:S,maxCount:T,top:k}}const Ly=q.forwardRef((f,m)=>{const[b,S]=q.useState(Ip),[T,k]=jf(b),B=Mc(),a=B.getRootPrefixCls(),W=B.getIconPrefixCls(),F=B.getTheme(),ne=()=>{S(Ip)};return q.useEffect(ne,[]),q.useImperativeHandle(m,()=>{const ie=Object.assign({},T);return Object.keys(ie).forEach(ue=>{ie[ue]=function(){return ne(),T[ue].apply(T,arguments)}}),{instance:ie,sync:ne}}),q.createElement(Cf,{prefixCls:a,iconPrefixCls:W,theme:F},k)});function kc(){if(!un){const f=document.createDocumentFragment(),m={fragment:f};un=m,Js(()=>{Sf(q.createElement(Ly,{ref:b=>{const{instance:S,sync:T}=b||{};Promise.resolve().then(()=>{!m.instance&&S&&(m.instance=S,m.sync=T,kc())})}}),f)});return}un.instance&&(tl.forEach(f=>{const{type:m,skipped:b}=f;if(!b)switch(m){case"open":{Js(()=>{const S=un.instance.open(Object.assign(Object.assign({},vc),f.config));S?.then(f.resolve),f.setCloseFn(S)});break}case"destroy":Js(()=>{un?.instance.destroy(f.key)});break;default:Js(()=>{var S;const T=(S=un.instance)[m].apply(S,Yr(f.args));T?.then(f.resolve),f.setCloseFn(T)})}}),tl=[])}function Ry(f){vc=Object.assign(Object.assign({},vc),f),Js(()=>{var m;(m=un?.sync)===null||m===void 0||m.call(un)})}function Fy(f){const m=Ih(b=>{let S;const T={type:"open",config:f,resolve:b,setCloseFn:k=>{S=k}};return tl.push(T),()=>{S?Js(()=>{S()}):T.skipped=!0}});return kc(),m}function By(f,m){const b=Ih(S=>{let T;const k={type:f,args:m,resolve:S,setCloseFn:B=>{T=B}};return tl.push(k),()=>{T?Js(()=>{T()}):k.skipped=!0}});return kc(),b}function Oy(f){tl.push({type:"destroy",key:f}),kc()}const $y=["success","info","warning","error","loading"],Ny={open:Fy,destroy:Oy,config:Ry,useMessage:cy,_InternalPanelDoNotUseOrYouWillBeFired:ty},Wf=Ny;$y.forEach(f=>{Wf[f]=function(){for(var m=arguments.length,b=new Array(m),S=0;S<m;S++)b[S]=arguments[S];return By(f,b)}});const Ep=Wf;let wn=null,mc=f=>f(),xc=[],bc={};function Pp(){const{prefixCls:f,getContainer:m,rtl:b,maxCount:S,top:T,bottom:k}=bc,B=f??Mc().getPrefixCls("notification"),a=m?.()||document.body;return{prefixCls:B,getContainer:()=>a,rtl:b,maxCount:S,top:T,bottom:k}}const jy=q.forwardRef((f,m)=>{const[b,S]=q.useState(Pp),[T,k]=Hf(b),B=Mc(),a=B.getRootPrefixCls(),W=B.getIconPrefixCls(),F=B.getTheme(),ne=()=>{S(Pp)};return q.useEffect(ne,[]),q.useImperativeHandle(m,()=>{const ie=Object.assign({},T);return Object.keys(ie).forEach(ue=>{ie[ue]=function(){return ne(),T[ue].apply(T,arguments)}}),{instance:ie,sync:ne}}),q.createElement(Cf,{prefixCls:a,iconPrefixCls:W,theme:F},k)});function Ph(){if(!wn){const f=document.createDocumentFragment(),m={fragment:f};wn=m,mc(()=>{Sf(q.createElement(jy,{ref:b=>{const{instance:S,sync:T}=b||{};Promise.resolve().then(()=>{!m.instance&&S&&(m.instance=S,m.sync=T,Ph())})}}),f)});return}wn.instance&&(xc.forEach(f=>{switch(f.type){case"open":{mc(()=>{wn.instance.open(Object.assign(Object.assign({},bc),f.config))});break}case"destroy":mc(()=>{wn?.instance.destroy(f.key)});break}}),xc=[])}function Vy(f){bc=Object.assign(Object.assign({},bc),f),mc(()=>{var m;(m=wn?.sync)===null||m===void 0||m.call(wn)})}function Xf(f){xc.push({type:"open",config:f}),Ph()}function Uy(f){xc.push({type:"destroy",key:f}),Ph()}const qy=["success","info","warning","error"],Zy={open:Xf,destroy:Uy,config:Vy,useNotification:Dy,_InternalPanelDoNotUseOrYouWillBeFired:Cy},Kf=Zy;qy.forEach(f=>{Kf[f]=m=>Xf(Object.assign(Object.assign({},m),{type:f}))});var Gy={percent:0,prefixCls:"rc-progress",strokeColor:"#2db7f5",strokeLinecap:"round",strokeWidth:1,trailColor:"#D9D9D9",trailWidth:1,gapPosition:"bottom"},Hy=function(){var m=q.useRef([]),b=q.useRef(null);return q.useEffect(function(){var S=Date.now(),T=!1;m.current.forEach(function(k){if(k){T=!0;var B=k.style;B.transitionDuration=".3s, .3s, .3s, .06s",b.current&&S-b.current<100&&(B.transitionDuration="0s, 0s")}}),T&&(b.current=Date.now())}),m.current},Ap=0,Wy=__();function Xy(){var f;return Wy?(f=Ap,Ap+=1):f="TEST_OR_SSR",f}const Ky=function(f){var m=q.useState(),b=is(m,2),S=b[0],T=b[1];return q.useEffect(function(){T("rc_progress_".concat(Xy()))},[]),f||S};var Mp=function(m){var b=m.bg,S=m.children;return q.createElement("div",{style:{width:"100%",height:"100%",background:b}},S)};function kp(f,m){return Object.keys(f).map(function(b){var S=parseFloat(b),T="".concat(Math.floor(S*m),"%");return"".concat(f[b]," ").concat(T)})}var Jy=q.forwardRef(function(f,m){var b=f.prefixCls,S=f.color,T=f.gradientId,k=f.radius,B=f.style,a=f.ptg,W=f.strokeLinecap,F=f.strokeWidth,ne=f.size,ie=f.gapDegree,ue=S&&Ks(S)==="object",_e=ue?"#FFF":void 0,Ee=ne/2,ke=q.createElement("circle",{className:"".concat(b,"-circle-path"),r:k,cx:Ee,cy:Ee,stroke:_e,strokeLinecap:W,strokeWidth:F,opacity:a===0?0:1,style:B,ref:m});if(!ue)return ke;var Me="".concat(T,"-conic"),ze=ie?"".concat(180+ie/2,"deg"):"0deg",je=kp(S,(360-ie)/360),Ne=kp(S,1),me="conic-gradient(from ".concat(ze,", ").concat(je.join(", "),")"),Ie="linear-gradient(to ".concat(ie?"bottom":"top",", ").concat(Ne.join(", "),")");return q.createElement(q.Fragment,null,q.createElement("mask",{id:Me},ke),q.createElement("foreignObject",{x:0,y:0,width:ne,height:ne,mask:"url(#".concat(Me,")")},q.createElement(Mp,{bg:Ie},q.createElement(Mp,{bg:me}))))}),Jo=100,Zu=function(m,b,S,T,k,B,a,W,F,ne){var ie=arguments.length>10&&arguments[10]!==void 0?arguments[10]:0,ue=S/100*360*((360-B)/360),_e=B===0?0:{bottom:0,top:180,left:90,right:-90}[a],Ee=(100-T)/100*b;F==="round"&&T!==100&&(Ee+=ne/2,Ee>=b&&(Ee=b-.01));var ke=Jo/2;return{stroke:typeof W=="string"?W:void 0,strokeDasharray:"".concat(b,"px ").concat(m),strokeDashoffset:Ee+ie,transform:"rotate(".concat(k+ue+_e,"deg)"),transformOrigin:"".concat(ke,"px ").concat(ke,"px"),transition:"stroke-dashoffset .3s ease 0s, stroke-dasharray .3s ease 0s, stroke .3s, stroke-width .06s ease .3s, opacity .3s ease 0s",fillOpacity:0}},Yy=["id","prefixCls","steps","strokeWidth","trailWidth","gapDegree","gapPosition","trailColor","strokeLinecap","style","className","strokeColor","percent"];function zp(f){var m=f??[];return Array.isArray(m)?m:[m]}var Qy=function(m){var b=Ts(Ts({},Gy),m),S=b.id,T=b.prefixCls,k=b.steps,B=b.strokeWidth,a=b.trailWidth,W=b.gapDegree,F=W===void 0?0:W,ne=b.gapPosition,ie=b.trailColor,ue=b.strokeLinecap,_e=b.style,Ee=b.className,ke=b.strokeColor,Me=b.percent,ze=Cc(b,Yy),je=Jo/2,Ne=Ky(S),me="".concat(Ne,"-gradient"),Ie=je-B/2,it=Math.PI*2*Ie,Ye=F>0?90+F/2:-90,Ge=it*((360-F)/360),at=Ks(k)==="object"?k:{count:k,space:2},De=at.count,rt=at.space,xt=zp(Me),Pt=zp(ke),gt=Pt.find(function(ai){return ai&&Ks(ai)==="object"}),At=gt&&Ks(gt)==="object",Bt=At?"butt":ue,ft=Zu(it,Ge,0,100,Ye,F,ne,ie,Bt,B),si=Hy(),Mi=function(){var Kt=0;return xt.map(function(Ze,yt){var Jt=Pt[yt]||Pt[Pt.length-1],Mt=Zu(it,Ge,Kt,Ze,Ye,F,ne,Jt,Bt,B);return Kt+=Ze,q.createElement(Jy,{key:yt,color:Jt,ptg:Ze,radius:Ie,prefixCls:T,gradientId:me,style:Mt,strokeLinecap:Bt,strokeWidth:B,gapDegree:F,ref:function(gi){si[yt]=gi},size:Jo})}).reverse()},Ki=function(){var Kt=Math.round(De*(xt[0]/100)),Ze=100/De,yt=0;return new Array(De).fill(null).map(function(Jt,Mt){var Yt=Mt<=Kt-1?Pt[0]:ie,gi=Yt&&Ks(Yt)==="object"?"url(#".concat(me,")"):void 0,Qt=Zu(it,Ge,yt,Ze,Ye,F,ne,Yt,"butt",B,rt);return yt+=(Ge-Qt.strokeDashoffset+rt)*100/Ge,q.createElement("circle",{key:Mt,className:"".concat(T,"-circle-path"),r:Ie,cx:je,cy:je,stroke:gi,strokeWidth:B,opacity:1,style:Qt,ref:function(ki){si[Mt]=ki}})})};return q.createElement("svg",Qr({className:Ut("".concat(T,"-circle"),Ee),viewBox:"0 0 ".concat(Jo," ").concat(Jo),style:_e,id:S,role:"presentation"},ze),!De&&q.createElement("circle",{className:"".concat(T,"-circle-trail"),r:Ie,cx:je,cy:je,stroke:ie,strokeLinecap:Bt,strokeWidth:a||B,style:ft}),De?Ki():Mi())};function Is(f){return!f||f<0?0:f>100?100:f}function wc(f){let{success:m,successPercent:b}=f,S=b;return m&&"progress"in m&&(S=m.progress),m&&"percent"in m&&(S=m.percent),S}const e0=f=>{let{percent:m,success:b,successPercent:S}=f;const T=Is(wc({success:b,successPercent:S}));return[T,Is(Is(m)-T)]},t0=f=>{let{success:m={},strokeColor:b}=f;const{strokeColor:S}=m;return[S||gh.green,b||null]},zc=(f,m,b)=>{var S,T,k,B;let a=-1,W=-1;if(m==="step"){const F=b.steps,ne=b.strokeWidth;typeof f=="string"||typeof f>"u"?(a=f==="small"?2:14,W=ne??8):typeof f=="number"?[a,W]=[f,f]:[a=14,W=8]=f,a*=F}else if(m==="line"){const F=b?.strokeWidth;typeof f=="string"||typeof f>"u"?W=F||(f==="small"?6:8):typeof f=="number"?[a,W]=[f,f]:[a=-1,W=8]=f}else(m==="circle"||m==="dashboard")&&(typeof f=="string"||typeof f>"u"?[a,W]=f==="small"?[60,60]:[120,120]:typeof f=="number"?[a,W]=[f,f]:(a=(T=(S=f[0])!==null&&S!==void 0?S:f[1])!==null&&T!==void 0?T:120,W=(B=(k=f[0])!==null&&k!==void 0?k:f[1])!==null&&B!==void 0?B:120));return[a,W]},i0=3,r0=f=>i0/f*100,n0=f=>{const{prefixCls:m,trailColor:b=null,strokeLinecap:S="round",gapPosition:T,gapDegree:k,width:B=120,type:a,children:W,success:F,size:ne=B}=f,[ie,ue]=zc(ne,"circle");let{strokeWidth:_e}=f;_e===void 0&&(_e=Math.max(r0(ie),6));const Ee={width:ie,height:ue,fontSize:ie*.15+6},ke=q.useMemo(()=>{if(k||k===0)return k;if(a==="dashboard")return 75},[k,a]),Me=T||a==="dashboard"&&"bottom"||void 0,ze=Object.prototype.toString.call(f.strokeColor)==="[object Object]",je=t0({success:F,strokeColor:f.strokeColor}),Ne=Ut(`${m}-inner`,{[`${m}-circle-gradient`]:ze}),me=q.createElement(Qy,{percent:e0(f),strokeWidth:_e,trailWidth:_e,strokeColor:je,strokeLinecap:S,trailColor:b,prefixCls:m,gapDegree:ke,gapPosition:Me});return q.createElement("div",{className:Ne,style:Ee},ie<=20?q.createElement(Tf,{title:W},q.createElement("span",null,me)):q.createElement(q.Fragment,null,me,W))},s0=n0,Sc="--progress-line-stroke-color",Jf="--progress-percent",Dp=f=>{const m=f?"100%":"-100%";return new On(`antProgress${f?"RTL":"LTR"}Active`,{"0%":{transform:`translateX(${m}) scaleX(0)`,opacity:.1},"20%":{transform:`translateX(${m}) scaleX(0)`,opacity:.5},to:{transform:"translateX(0) scaleX(1)",opacity:0}})},a0=f=>{const{componentCls:m,iconCls:b}=f;return{[m]:Object.assign(Object.assign({},Ec(f)),{display:"inline-block","&-rtl":{direction:"rtl"},"&-line":{position:"relative",width:"100%",fontSize:f.fontSize,marginInlineEnd:f.marginXS,marginBottom:f.marginXS},[`${m}-outer`]:{display:"inline-block",width:"100%"},[`&${m}-show-info`]:{[`${m}-outer`]:{marginInlineEnd:`calc(-2em - ${Ni(f.marginXS)})`,paddingInlineEnd:`calc(2em + ${Ni(f.paddingXS)})`}},[`${m}-inner`]:{position:"relative",display:"inline-block",width:"100%",overflow:"hidden",verticalAlign:"middle",backgroundColor:f.remainingColor,borderRadius:f.lineBorderRadius},[`${m}-inner:not(${m}-circle-gradient)`]:{[`${m}-circle-path`]:{stroke:f.defaultColor}},[`${m}-success-bg, ${m}-bg`]:{position:"relative",background:f.defaultColor,borderRadius:f.lineBorderRadius,transition:`all ${f.motionDurationSlow} ${f.motionEaseInOutCirc}`},[`${m}-bg`]:{overflow:"hidden","&::after":{content:'""',background:{_multi_value_:!0,value:["inherit",`var(${Sc})`]},height:"100%",width:`calc(1 / var(${Jf}) * 100%)`,display:"block"}},[`${m}-success-bg`]:{position:"absolute",insetBlockStart:0,insetInlineStart:0,backgroundColor:f.colorSuccess},[`${m}-text`]:{display:"inline-block",width:"2em",marginInlineStart:f.marginXS,color:f.colorText,lineHeight:1,whiteSpace:"nowrap",textAlign:"start",verticalAlign:"middle",wordBreak:"normal",[b]:{fontSize:f.fontSize}},[`&${m}-status-active`]:{[`${m}-bg::before`]:{position:"absolute",inset:0,backgroundColor:f.colorBgContainer,borderRadius:f.lineBorderRadius,opacity:0,animationName:Dp(),animationDuration:f.progressActiveMotionDuration,animationTimingFunction:f.motionEaseOutQuint,animationIterationCount:"infinite",content:'""'}},[`&${m}-rtl${m}-status-active`]:{[`${m}-bg::before`]:{animationName:Dp(!0)}},[`&${m}-status-exception`]:{[`${m}-bg`]:{backgroundColor:f.colorError},[`${m}-text`]:{color:f.colorError}},[`&${m}-status-exception ${m}-inner:not(${m}-circle-gradient)`]:{[`${m}-circle-path`]:{stroke:f.colorError}},[`&${m}-status-success`]:{[`${m}-bg`]:{backgroundColor:f.colorSuccess},[`${m}-text`]:{color:f.colorSuccess}},[`&${m}-status-success ${m}-inner:not(${m}-circle-gradient)`]:{[`${m}-circle-path`]:{stroke:f.colorSuccess}}})}},o0=f=>{const{componentCls:m,iconCls:b}=f;return{[m]:{[`${m}-circle-trail`]:{stroke:f.remainingColor},[`&${m}-circle ${m}-inner`]:{position:"relative",lineHeight:1,backgroundColor:"transparent"},[`&${m}-circle ${m}-text`]:{position:"absolute",insetBlockStart:"50%",insetInlineStart:0,width:"100%",margin:0,padding:0,color:f.circleTextColor,fontSize:f.circleTextFontSize,lineHeight:1,whiteSpace:"normal",textAlign:"center",transform:"translateY(-50%)",[b]:{fontSize:f.circleIconFontSize}},[`${m}-circle&-status-exception`]:{[`${m}-text`]:{color:f.colorError}},[`${m}-circle&-status-success`]:{[`${m}-text`]:{color:f.colorSuccess}}},[`${m}-inline-circle`]:{lineHeight:1,[`${m}-inner`]:{verticalAlign:"bottom"}}}},l0=f=>{const{componentCls:m}=f;return{[m]:{[`${m}-steps`]:{display:"inline-block","&-outer":{display:"flex",flexDirection:"row",alignItems:"center"},"&-item":{flexShrink:0,minWidth:f.progressStepMinWidth,marginInlineEnd:f.progressStepMarginInlineEnd,backgroundColor:f.remainingColor,transition:`all ${f.motionDurationSlow}`,"&-active":{backgroundColor:f.defaultColor}}}}}},c0=f=>{const{componentCls:m,iconCls:b}=f;return{[m]:{[`${m}-small&-line, ${m}-small&-line ${m}-text ${b}`]:{fontSize:f.fontSizeSM}}}},u0=f=>({circleTextColor:f.colorText,defaultColor:f.colorInfo,remainingColor:f.colorFillSecondary,lineBorderRadius:100,circleTextFontSize:"1em",circleIconFontSize:`${f.fontSize/f.fontSizeSM}em`}),h0=Tc("Progress",f=>{const m=f.calc(f.marginXXS).div(2).equal(),b=Ic(f,{progressStepMarginInlineEnd:m,progressStepMinWidth:m,progressActiveMotionDuration:"2.4s"});return[a0(b),o0(b),l0(b),c0(b)]},u0);var d0=function(f,m){var b={};for(var S in f)Object.prototype.hasOwnProperty.call(f,S)&&m.indexOf(S)<0&&(b[S]=f[S]);if(f!=null&&typeof Object.getOwnPropertySymbols=="function")for(var T=0,S=Object.getOwnPropertySymbols(f);T<S.length;T++)m.indexOf(S[T])<0&&Object.prototype.propertyIsEnumerable.call(f,S[T])&&(b[S[T]]=f[S[T]]);return b};const p0=f=>{let m=[];return Object.keys(f).forEach(b=>{const S=parseFloat(b.replace(/%/g,""));isNaN(S)||m.push({key:S,value:f[b]})}),m=m.sort((b,S)=>b.key-S.key),m.map(b=>{let{key:S,value:T}=b;return`${T} ${S}%`}).join(", ")},f0=(f,m)=>{const{from:b=gh.blue,to:S=gh.blue,direction:T=m==="rtl"?"to left":"to right"}=f,k=d0(f,["from","to","direction"]);if(Object.keys(k).length!==0){const a=p0(k),W=`linear-gradient(${T}, ${a})`;return{background:W,[Sc]:W}}const B=`linear-gradient(${T}, ${b}, ${S})`;return{background:B,[Sc]:B}},m0=f=>{const{prefixCls:m,direction:b,percent:S,size:T,strokeWidth:k,strokeColor:B,strokeLinecap:a="round",children:W,trailColor:F=null,success:ne}=f,ie=B&&typeof B!="string"?f0(B,b):{[Sc]:B,background:B},ue=a==="square"||a==="butt"?0:void 0,_e=T??[-1,k||(T==="small"?6:8)],[Ee,ke]=zc(_e,"line",{strokeWidth:k}),Me={backgroundColor:F||void 0,borderRadius:ue},ze=Object.assign(Object.assign({width:`${Is(S)}%`,height:ke,borderRadius:ue},ie),{[Jf]:Is(S)/100}),je=wc(f),Ne={width:`${Is(je)}%`,height:ke,borderRadius:ue,backgroundColor:ne?.strokeColor},me={width:Ee<0?"100%":Ee,height:ke};return q.createElement(q.Fragment,null,q.createElement("div",{className:`${m}-outer`,style:me},q.createElement("div",{className:`${m}-inner`,style:Me},q.createElement("div",{className:`${m}-bg`,style:ze}),je!==void 0?q.createElement("div",{className:`${m}-success-bg`,style:Ne}):null)),W)},g0=m0,_0=f=>{const{size:m,steps:b,percent:S=0,strokeWidth:T=8,strokeColor:k,trailColor:B=null,prefixCls:a,children:W}=f,F=Math.round(b*(S/100)),ie=m??[m==="small"?2:14,T],[ue,_e]=zc(ie,"step",{steps:b,strokeWidth:T}),Ee=ue/b,ke=new Array(b);for(let Me=0;Me<b;Me++){const ze=Array.isArray(k)?k[Me]:k;ke[Me]=q.createElement("div",{key:Me,className:Ut(`${a}-steps-item`,{[`${a}-steps-item-active`]:Me<=F-1}),style:{backgroundColor:Me<=F-1?ze:B,width:Ee,height:_e}})}return q.createElement("div",{className:`${a}-steps-outer`},ke,W)},y0=_0;var v0=function(f,m){var b={};for(var S in f)Object.prototype.hasOwnProperty.call(f,S)&&m.indexOf(S)<0&&(b[S]=f[S]);if(f!=null&&typeof Object.getOwnPropertySymbols=="function")for(var T=0,S=Object.getOwnPropertySymbols(f);T<S.length;T++)m.indexOf(S[T])<0&&Object.prototype.propertyIsEnumerable.call(f,S[T])&&(b[S[T]]=f[S[T]]);return b};const x0=["normal","exception","active","success"],b0=q.forwardRef((f,m)=>{const{prefixCls:b,className:S,rootClassName:T,steps:k,strokeColor:B,percent:a=0,size:W="default",showInfo:F=!0,type:ne="line",status:ie,format:ue,style:_e}=f,Ee=v0(f,["prefixCls","className","rootClassName","steps","strokeColor","percent","size","showInfo","type","status","format","style"]),ke=q.useMemo(()=>{var Pt,gt;const At=wc(f);return parseInt(At!==void 0?(Pt=At??0)===null||Pt===void 0?void 0:Pt.toString():(gt=a??0)===null||gt===void 0?void 0:gt.toString(),10)},[a,f.success,f.successPercent]),Me=q.useMemo(()=>!x0.includes(ie)&&ke>=100?"success":ie||"normal",[ie,ke]),{getPrefixCls:ze,direction:je,progress:Ne}=q.useContext(Es),me=ze("progress",b),[Ie,it,Ye]=h0(me),Ge=q.useMemo(()=>{if(!F)return null;const Pt=wc(f);let gt;const At=ue||(ft=>`${ft}%`),Bt=ne==="line";return ue||Me!=="exception"&&Me!=="success"?gt=At(Is(a),Is(Pt)):Me==="exception"?gt=Bt?q.createElement(Sh,null):q.createElement(Ac,null):Me==="success"&&(gt=Bt?q.createElement(wh,null):q.createElement(v_,null)),q.createElement("span",{className:`${me}-text`,title:typeof gt=="string"?gt:void 0},gt)},[F,a,ke,Me,ne,me,ue]),at=Array.isArray(B)?B[0]:B,De=typeof B=="string"||Array.isArray(B)?B:void 0;let rt;ne==="line"?rt=k?q.createElement(y0,Object.assign({},f,{strokeColor:De,prefixCls:me,steps:k}),Ge):q.createElement(g0,Object.assign({},f,{strokeColor:at,prefixCls:me,direction:je}),Ge):(ne==="circle"||ne==="dashboard")&&(rt=q.createElement(s0,Object.assign({},f,{strokeColor:at,prefixCls:me,progressStatus:Me}),Ge));const xt=Ut(me,`${me}-status-${Me}`,`${me}-${ne==="dashboard"&&"circle"||k&&"steps"||ne}`,{[`${me}-inline-circle`]:ne==="circle"&&zc(W,"circle")[0]<=20,[`${me}-show-info`]:F,[`${me}-${W}`]:typeof W=="string",[`${me}-rtl`]:je==="rtl"},Ne?.className,S,T,it,Ye);return Ie(q.createElement("div",Object.assign({ref:m,style:Object.assign(Object.assign({},Ne?.style),_e),className:xt,role:"progressbar","aria-valuenow":ke},y_(Ee,["trailColor","strokeWidth","width","gapDegree","gapPosition","strokeLinecap","success","successPercent"])),rt))}),w0=b0;var S0={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z"}}]},name:"delete",theme:"outlined"};const C0=S0;var T0=function(m,b){return q.createElement(Ua,Qr({},m,{ref:b,icon:C0}))};const Yf=q.forwardRef(T0),Gu=function(f,m){if(f&&m){var b=Array.isArray(m)?m:m.split(","),S=f.name||"",T=f.type||"",k=T.replace(/\/.*$/,"");return b.some(function(B){var a=B.trim();if(/^\*(\/\*)?$/.test(B))return!0;if(a.charAt(0)==="."){var W=S.toLowerCase(),F=a.toLowerCase(),ne=[F];return(F===".jpg"||F===".jpeg")&&(ne=[".jpg",".jpeg"]),ne.some(function(ie){return W.endsWith(ie)})}return/\/\*$/.test(a)?k===a.replace(/\/.*$/,""):T===a?!0:/^\w+$/.test(a)?(x_(!1,"Upload takes an invalidate 'accept' type '".concat(a,"'.Skip for check.")),!0):!1})}return!0};function I0(f,m){var b="cannot ".concat(f.method," ").concat(f.action," ").concat(m.status,"'"),S=new Error(b);return S.status=m.status,S.method=f.method,S.url=f.action,S}function Lp(f){var m=f.responseText||f.response;if(!m)return m;try{return JSON.parse(m)}catch{return m}}function E0(f){var m=new XMLHttpRequest;f.onProgress&&m.upload&&(m.upload.onprogress=function(k){k.total>0&&(k.percent=k.loaded/k.total*100),f.onProgress(k)});var b=new FormData;f.data&&Object.keys(f.data).forEach(function(T){var k=f.data[T];if(Array.isArray(k)){k.forEach(function(B){b.append("".concat(T,"[]"),B)});return}b.append(T,k)}),f.file instanceof Blob?b.append(f.filename,f.file,f.file.name):b.append(f.filename,f.file),m.onerror=function(k){f.onError(k)},m.onload=function(){return m.status<200||m.status>=300?f.onError(I0(f,m),Lp(m)):f.onSuccess(Lp(m),m)},m.open(f.method,f.action,!0),f.withCredentials&&"withCredentials"in m&&(m.withCredentials=!0);var S=f.headers||{};return S["X-Requested-With"]!==null&&m.setRequestHeader("X-Requested-With","XMLHttpRequest"),Object.keys(S).forEach(function(T){S[T]!==null&&m.setRequestHeader(T,S[T])}),m.send(b),{abort:function(){m.abort()}}}function P0(f,m){var b=f.createReader(),S=[];function T(){b.readEntries(function(k){var B=Array.prototype.slice.apply(k);S=S.concat(B);var a=!B.length;a?m(S):T()})}T()}var A0=function(m,b,S){var T=function k(B,a){B&&(B.path=a||"",B.isFile?B.file(function(W){S(W)&&(B.fullPath&&!W.webkitRelativePath&&(Object.defineProperties(W,{webkitRelativePath:{writable:!0}}),W.webkitRelativePath=B.fullPath.replace(/^\//,""),Object.defineProperties(W,{webkitRelativePath:{writable:!1}})),b([W]))}):B.isDirectory&&P0(B,function(W){W.forEach(function(F){k(F,"".concat(a).concat(B.name,"/"))})}))};m.forEach(function(k){T(k.webkitGetAsEntry())})},M0=+new Date,k0=0;function Hu(){return"rc-upload-".concat(M0,"-").concat(++k0)}var z0=["component","prefixCls","className","classNames","disabled","id","style","styles","multiple","accept","capture","children","directory","openFileDialogOnClick","onMouseEnter","onMouseLeave","hasControlInside"],D0=function(f){If(b,f);var m=Ef(b);function b(){var S;Pf(this,b);for(var T=arguments.length,k=new Array(T),B=0;B<T;B++)k[B]=arguments[B];return S=m.call.apply(m,[this].concat(k)),Ui(Jr(S),"state",{uid:Hu()}),Ui(Jr(S),"reqs",{}),Ui(Jr(S),"fileInput",void 0),Ui(Jr(S),"_isMounted",void 0),Ui(Jr(S),"onChange",function(a){var W=S.props,F=W.accept,ne=W.directory,ie=a.target.files,ue=Yr(ie).filter(function(_e){return!ne||Gu(_e,F)});S.uploadFiles(ue),S.reset()}),Ui(Jr(S),"onClick",function(a){var W=S.fileInput;if(W){var F=a.target,ne=S.props.onClick;if(F&&F.tagName==="BUTTON"){var ie=W.parentNode;ie.focus(),F.blur()}W.click(),ne&&ne(a)}}),Ui(Jr(S),"onKeyDown",function(a){a.key==="Enter"&&S.onClick(a)}),Ui(Jr(S),"onFileDrop",function(a){var W=S.props.multiple;if(a.preventDefault(),a.type!=="dragover")if(S.props.directory)A0(Array.prototype.slice.call(a.dataTransfer.items),S.uploadFiles,function(ne){return Gu(ne,S.props.accept)});else{var F=Yr(a.dataTransfer.files).filter(function(ne){return Gu(ne,S.props.accept)});W===!1&&(F=F.slice(0,1)),S.uploadFiles(F)}}),Ui(Jr(S),"uploadFiles",function(a){var W=Yr(a),F=W.map(function(ne){return ne.uid=Hu(),S.processFile(ne,W)});Promise.all(F).then(function(ne){var ie=S.props.onBatchStart;ie?.(ne.map(function(ue){var _e=ue.origin,Ee=ue.parsedFile;return{file:_e,parsedFile:Ee}})),ne.filter(function(ue){return ue.parsedFile!==null}).forEach(function(ue){S.post(ue)})})}),Ui(Jr(S),"processFile",function(){var a=w_(gp().mark(function W(F,ne){var ie,ue,_e,Ee,ke,Me,ze,je,Ne;return gp().wrap(function(Ie){for(;;)switch(Ie.prev=Ie.next){case 0:if(ie=S.props.beforeUpload,ue=F,!ie){Ie.next=14;break}return Ie.prev=3,Ie.next=6,ie(F,ne);case 6:ue=Ie.sent,Ie.next=12;break;case 9:Ie.prev=9,Ie.t0=Ie.catch(3),ue=!1;case 12:if(ue!==!1){Ie.next=14;break}return Ie.abrupt("return",{origin:F,parsedFile:null,action:null,data:null});case 14:if(_e=S.props.action,typeof _e!="function"){Ie.next=21;break}return Ie.next=18,_e(F);case 18:Ee=Ie.sent,Ie.next=22;break;case 21:Ee=_e;case 22:if(ke=S.props.data,typeof ke!="function"){Ie.next=29;break}return Ie.next=26,ke(F);case 26:Me=Ie.sent,Ie.next=30;break;case 29:Me=ke;case 30:return ze=(Ks(ue)==="object"||typeof ue=="string")&&ue?ue:F,ze instanceof File?je=ze:je=new File([ze],F.name,{type:F.type}),Ne=je,Ne.uid=F.uid,Ie.abrupt("return",{origin:F,data:Me,parsedFile:Ne,action:Ee});case 35:case"end":return Ie.stop()}},W,null,[[3,9]])}));return function(W,F){return a.apply(this,arguments)}}()),Ui(Jr(S),"saveFileInput",function(a){S.fileInput=a}),S}return Af(b,[{key:"componentDidMount",value:function(){this._isMounted=!0}},{key:"componentWillUnmount",value:function(){this._isMounted=!1,this.abort()}},{key:"post",value:function(T){var k=this,B=T.data,a=T.origin,W=T.action,F=T.parsedFile;if(this._isMounted){var ne=this.props,ie=ne.onStart,ue=ne.customRequest,_e=ne.name,Ee=ne.headers,ke=ne.withCredentials,Me=ne.method,ze=a.uid,je=ue||E0,Ne={action:W,filename:_e,data:B,file:F,headers:Ee,withCredentials:ke,method:Me||"post",onProgress:function(Ie){var it=k.props.onProgress;it?.(Ie,F)},onSuccess:function(Ie,it){var Ye=k.props.onSuccess;Ye?.(Ie,F,it),delete k.reqs[ze]},onError:function(Ie,it){var Ye=k.props.onError;Ye?.(Ie,it,F),delete k.reqs[ze]}};ie(a),this.reqs[ze]=je(Ne)}}},{key:"reset",value:function(){this.setState({uid:Hu()})}},{key:"abort",value:function(T){var k=this.reqs;if(T){var B=T.uid?T.uid:T;k[B]&&k[B].abort&&k[B].abort(),delete k[B]}else Object.keys(k).forEach(function(a){k[a]&&k[a].abort&&k[a].abort(),delete k[a]})}},{key:"render",value:function(){var T,k=this.props,B=k.component,a=k.prefixCls,W=k.className,F=k.classNames,ne=F===void 0?{}:F,ie=k.disabled,ue=k.id,_e=k.style,Ee=k.styles,ke=Ee===void 0?{}:Ee,Me=k.multiple,ze=k.accept,je=k.capture,Ne=k.children,me=k.directory,Ie=k.openFileDialogOnClick,it=k.onMouseEnter,Ye=k.onMouseLeave,Ge=k.hasControlInside,at=Cc(k,z0),De=Ut((T={},Ui(T,a,!0),Ui(T,"".concat(a,"-disabled"),ie),Ui(T,W,W),T)),rt=me?{directory:"directory",webkitdirectory:"webkitdirectory"}:{},xt=ie?{}:{onClick:Ie?this.onClick:function(){},onKeyDown:Ie?this.onKeyDown:function(){},onMouseEnter:it,onMouseLeave:Ye,onDrop:this.onFileDrop,onDragOver:this.onFileDrop,tabIndex:Ge?void 0:"0"};return Cs.createElement(B,Qr({},xt,{className:De,role:Ge?void 0:"button",style:_e}),Cs.createElement("input",Qr({},b_(at,{aria:!0,data:!0}),{id:ue,disabled:ie,type:"file",ref:this.saveFileInput,onClick:function(gt){return gt.stopPropagation()},key:this.state.uid,style:Ts({display:"none"},ke.input),className:ne.input,accept:ze},rt,{multiple:Me,onChange:this.onChange},je!=null?{capture:je}:{})),Ne)}}]),b}(q.Component);function Wu(){}var vh=function(f){If(b,f);var m=Ef(b);function b(){var S;Pf(this,b);for(var T=arguments.length,k=new Array(T),B=0;B<T;B++)k[B]=arguments[B];return S=m.call.apply(m,[this].concat(k)),Ui(Jr(S),"uploader",void 0),Ui(Jr(S),"saveUploader",function(a){S.uploader=a}),S}return Af(b,[{key:"abort",value:function(T){this.uploader.abort(T)}},{key:"render",value:function(){return Cs.createElement(D0,Qr({},this.props,{ref:this.saveUploader}))}}]),b}(q.Component);Ui(vh,"defaultProps",{component:"span",prefixCls:"rc-upload",data:{},headers:{},name:"file",multipart:!1,onStart:Wu,onError:Wu,onSuccess:Wu,multiple:!1,beforeUpload:null,customRequest:null,withCredentials:!1,openFileDialogOnClick:!0,hasControlInside:!1});const L0=f=>{const{componentCls:m,iconCls:b}=f;return{[`${m}-wrapper`]:{[`${m}-drag`]:{position:"relative",width:"100%",height:"100%",textAlign:"center",background:f.colorFillAlter,border:`${Ni(f.lineWidth)} dashed ${f.colorBorder}`,borderRadius:f.borderRadiusLG,cursor:"pointer",transition:`border-color ${f.motionDurationSlow}`,[m]:{padding:f.padding},[`${m}-btn`]:{display:"table",width:"100%",height:"100%",outline:"none",borderRadius:f.borderRadiusLG,"&:focus-visible":{outline:`${Ni(f.lineWidthFocus)} solid ${f.colorPrimaryBorder}`}},[`${m}-drag-container`]:{display:"table-cell",verticalAlign:"middle"},[`
          &:not(${m}-disabled):hover,
          &-hover:not(${m}-disabled)
        `]:{borderColor:f.colorPrimaryHover},[`p${m}-drag-icon`]:{marginBottom:f.margin,[b]:{color:f.colorPrimary,fontSize:f.uploadThumbnailSize}},[`p${m}-text`]:{margin:`0 0 ${Ni(f.marginXXS)}`,color:f.colorTextHeading,fontSize:f.fontSizeLG},[`p${m}-hint`]:{color:f.colorTextDescription,fontSize:f.fontSize},[`&${m}-disabled`]:{[`p${m}-drag-icon ${b},
            p${m}-text,
            p${m}-hint
          `]:{color:f.colorTextDisabled}}}}}},R0=f=>{const{componentCls:m,antCls:b,iconCls:S,fontSize:T,lineHeight:k,calc:B}=f,a=`${m}-list-item`,W=`${a}-actions`,F=`${a}-action`,ne=f.fontHeightSM;return{[`${m}-wrapper`]:{[`${m}-list`]:Object.assign(Object.assign({},Mf()),{lineHeight:f.lineHeight,[a]:{position:"relative",height:B(f.lineHeight).mul(T).equal(),marginTop:f.marginXS,fontSize:T,display:"flex",alignItems:"center",transition:`background-color ${f.motionDurationSlow}`,"&:hover":{backgroundColor:f.controlItemBgHover},[`${a}-name`]:Object.assign(Object.assign({},kf),{padding:`0 ${Ni(f.paddingXS)}`,lineHeight:k,flex:"auto",transition:`all ${f.motionDurationSlow}`}),[W]:{[F]:{opacity:0},[S]:{color:f.actionsColor,transition:`all ${f.motionDurationSlow}`},[`
              ${F}:focus-visible,
              &.picture ${F}
            `]:{opacity:1},[`${F}${b}-btn`]:{height:ne,border:0,lineHeight:1}},[`${m}-icon ${S}`]:{color:f.colorTextDescription,fontSize:T},[`${a}-progress`]:{position:"absolute",bottom:f.calc(f.uploadProgressOffset).mul(-1).equal(),width:"100%",paddingInlineStart:B(T).add(f.paddingXS).equal(),fontSize:T,lineHeight:0,pointerEvents:"none","> div":{margin:0}}},[`${a}:hover ${F}`]:{opacity:1},[`${a}-error`]:{color:f.colorError,[`${a}-name, ${m}-icon ${S}`]:{color:f.colorError},[W]:{[`${S}, ${S}:hover`]:{color:f.colorError},[F]:{opacity:1}}},[`${m}-list-item-container`]:{transition:`opacity ${f.motionDurationSlow}, height ${f.motionDurationSlow}`,"&::before":{display:"table",width:0,height:0,content:'""'}}})}}},Rp=new On("uploadAnimateInlineIn",{from:{width:0,height:0,margin:0,padding:0,opacity:0}}),Fp=new On("uploadAnimateInlineOut",{to:{width:0,height:0,margin:0,padding:0,opacity:0}}),F0=f=>{const{componentCls:m}=f,b=`${m}-animate-inline`;return[{[`${m}-wrapper`]:{[`${b}-appear, ${b}-enter, ${b}-leave`]:{animationDuration:f.motionDurationSlow,animationTimingFunction:f.motionEaseInOutCirc,animationFillMode:"forwards"},[`${b}-appear, ${b}-enter`]:{animationName:Rp},[`${b}-leave`]:{animationName:Fp}}},{[`${m}-wrapper`]:O_(f)},Rp,Fp]},B0=f=>{const{componentCls:m,iconCls:b,uploadThumbnailSize:S,uploadProgressOffset:T,calc:k}=f,B=`${m}-list`,a=`${B}-item`;return{[`${m}-wrapper`]:{[`
        ${B}${B}-picture,
        ${B}${B}-picture-card,
        ${B}${B}-picture-circle
      `]:{[a]:{position:"relative",height:k(S).add(k(f.lineWidth).mul(2)).add(k(f.paddingXS).mul(2)).equal(),padding:f.paddingXS,border:`${Ni(f.lineWidth)} ${f.lineType} ${f.colorBorder}`,borderRadius:f.borderRadiusLG,"&:hover":{background:"transparent"},[`${a}-thumbnail`]:Object.assign(Object.assign({},kf),{width:S,height:S,lineHeight:Ni(k(S).add(f.paddingSM).equal()),textAlign:"center",flex:"none",[b]:{fontSize:f.fontSizeHeading2,color:f.colorPrimary},img:{display:"block",width:"100%",height:"100%",overflow:"hidden"}}),[`${a}-progress`]:{bottom:T,width:`calc(100% - ${Ni(k(f.paddingSM).mul(2).equal())})`,marginTop:0,paddingInlineStart:k(S).add(f.paddingXS).equal()}},[`${a}-error`]:{borderColor:f.colorError,[`${a}-thumbnail ${b}`]:{[`svg path[fill='${_p[0]}']`]:{fill:f.colorErrorBg},[`svg path[fill='${_p.primary}']`]:{fill:f.colorError}}},[`${a}-uploading`]:{borderStyle:"dashed",[`${a}-name`]:{marginBottom:T}}},[`${B}${B}-picture-circle ${a}`]:{[`&, &::before, ${a}-thumbnail`]:{borderRadius:"50%"}}}}},O0=f=>{const{componentCls:m,iconCls:b,fontSizeLG:S,colorTextLightSolid:T,calc:k}=f,B=`${m}-list`,a=`${B}-item`,W=f.uploadPicCardSize;return{[`
      ${m}-wrapper${m}-picture-card-wrapper,
      ${m}-wrapper${m}-picture-circle-wrapper
    `]:Object.assign(Object.assign({},Mf()),{display:"inline-block",width:"100%",[`${m}${m}-select`]:{width:W,height:W,marginInlineEnd:f.marginXS,marginBottom:f.marginXS,textAlign:"center",verticalAlign:"top",backgroundColor:f.colorFillAlter,border:`${Ni(f.lineWidth)} dashed ${f.colorBorder}`,borderRadius:f.borderRadiusLG,cursor:"pointer",transition:`border-color ${f.motionDurationSlow}`,[`> ${m}`]:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",textAlign:"center"},[`&:not(${m}-disabled):hover`]:{borderColor:f.colorPrimary}},[`${B}${B}-picture-card, ${B}${B}-picture-circle`]:{[`${B}-item-container`]:{display:"inline-block",width:W,height:W,marginBlock:`0 ${Ni(f.marginXS)}`,marginInline:`0 ${Ni(f.marginXS)}`,verticalAlign:"top"},"&::after":{display:"none"},[a]:{height:"100%",margin:0,"&::before":{position:"absolute",zIndex:1,width:`calc(100% - ${Ni(k(f.paddingXS).mul(2).equal())})`,height:`calc(100% - ${Ni(k(f.paddingXS).mul(2).equal())})`,backgroundColor:f.colorBgMask,opacity:0,transition:`all ${f.motionDurationSlow}`,content:'" "'}},[`${a}:hover`]:{[`&::before, ${a}-actions`]:{opacity:1}},[`${a}-actions`]:{position:"absolute",insetInlineStart:0,zIndex:10,width:"100%",whiteSpace:"nowrap",textAlign:"center",opacity:0,transition:`all ${f.motionDurationSlow}`,[`
            ${b}-eye,
            ${b}-download,
            ${b}-delete
          `]:{zIndex:10,width:S,margin:`0 ${Ni(f.marginXXS)}`,fontSize:S,cursor:"pointer",transition:`all ${f.motionDurationSlow}`,color:T,"&:hover":{color:T},svg:{verticalAlign:"baseline"}}},[`${a}-thumbnail, ${a}-thumbnail img`]:{position:"static",display:"block",width:"100%",height:"100%",objectFit:"contain"},[`${a}-name`]:{display:"none",textAlign:"center"},[`${a}-file + ${a}-name`]:{position:"absolute",bottom:f.margin,display:"block",width:`calc(100% - ${Ni(k(f.paddingXS).mul(2).equal())})`},[`${a}-uploading`]:{[`&${a}`]:{backgroundColor:f.colorFillAlter},[`&::before, ${b}-eye, ${b}-download, ${b}-delete`]:{display:"none"}},[`${a}-progress`]:{bottom:f.marginXL,width:`calc(100% - ${Ni(k(f.paddingXS).mul(2).equal())})`,paddingInlineStart:0}}}),[`${m}-wrapper${m}-picture-circle-wrapper`]:{[`${m}${m}-select`]:{borderRadius:"50%"}}}},$0=f=>{const{componentCls:m}=f;return{[`${m}-rtl`]:{direction:"rtl"}}},N0=f=>{const{componentCls:m,colorTextDisabled:b}=f;return{[`${m}-wrapper`]:Object.assign(Object.assign({},Ec(f)),{[m]:{outline:0,"input[type='file']":{cursor:"pointer"}},[`${m}-select`]:{display:"inline-block"},[`${m}-disabled`]:{color:b,cursor:"not-allowed"}})}},j0=f=>({actionsColor:f.colorTextDescription}),V0=Tc("Upload",f=>{const{fontSizeHeading3:m,fontHeight:b,lineWidth:S,controlHeightLG:T,calc:k}=f,B=Ic(f,{uploadThumbnailSize:k(m).mul(2).equal(),uploadProgressOffset:k(k(b).div(2)).add(S).equal(),uploadPicCardSize:k(T).mul(2.55).equal()});return[N0(B),L0(B),B0(B),O0(B),R0(B),F0(B),$0(B),S_(B)]},j0);var U0={icon:function(m,b){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M534 352V136H232v752h560V394H576a42 42 0 01-42-42z",fill:b}},{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM602 137.8L790.2 326H602V137.8zM792 888H232V136h302v216a42 42 0 0042 42h216v494z",fill:m}}]}},name:"file",theme:"twotone"};const q0=U0;var Z0=function(m,b){return q.createElement(Ua,Qr({},m,{ref:b,icon:q0}))};const G0=q.forwardRef(Z0);var H0={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M779.3 196.6c-94.2-94.2-247.6-94.2-341.7 0l-261 260.8c-1.7 1.7-2.6 4-2.6 6.4s.9 4.7 2.6 6.4l36.9 36.9a9 9 0 0012.7 0l261-260.8c32.4-32.4 75.5-50.2 121.3-50.2s88.9 17.8 121.2 50.2c32.4 32.4 50.2 75.5 50.2 121.2 0 45.8-17.8 88.8-50.2 121.2l-266 265.9-43.1 43.1c-40.3 40.3-105.8 40.3-146.1 0-19.5-19.5-30.2-45.4-30.2-73s10.7-53.5 30.2-73l263.9-263.8c6.7-6.6 15.5-10.3 24.9-10.3h.1c9.4 0 18.1 3.7 24.7 10.3 6.7 6.7 10.3 15.5 10.3 24.9 0 9.3-3.7 18.1-10.3 24.7L372.4 653c-1.7 1.7-2.6 4-2.6 6.4s.9 4.7 2.6 6.4l36.9 36.9a9 9 0 0012.7 0l215.6-215.6c19.9-19.9 30.8-46.3 30.8-74.4s-11-54.6-30.8-74.4c-41.1-41.1-107.9-41-149 0L463 364 224.8 602.1A172.22 172.22 0 00174 724.8c0 46.3 18.1 89.8 50.8 122.5 33.9 33.8 78.3 50.7 122.7 50.7 44.4 0 88.8-16.9 122.6-50.7l309.2-309C824.8 492.7 850 432 850 367.5c.1-64.6-25.1-125.3-70.7-170.9z"}}]},name:"paper-clip",theme:"outlined"};const W0=H0;var X0=function(m,b){return q.createElement(Ua,Qr({},m,{ref:b,icon:W0}))};const K0=q.forwardRef(X0);var J0={icon:function(m,b){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 632H136v-39.9l138.5-164.3 150.1 178L658.1 489 888 761.6V792zm0-129.8L664.2 396.8c-3.2-3.8-9-3.8-12.2 0L424.6 666.4l-144-170.7c-3.2-3.8-9-3.8-12.2 0L136 652.7V232h752v430.2z",fill:m}},{tag:"path",attrs:{d:"M424.6 765.8l-150.1-178L136 752.1V792h752v-30.4L658.1 489z",fill:b}},{tag:"path",attrs:{d:"M136 652.7l132.4-157c3.2-3.8 9-3.8 12.2 0l144 170.7L652 396.8c3.2-3.8 9-3.8 12.2 0L888 662.2V232H136v420.7zM304 280a88 88 0 110 176 88 88 0 010-176z",fill:b}},{tag:"path",attrs:{d:"M276 368a28 28 0 1056 0 28 28 0 10-56 0z",fill:b}},{tag:"path",attrs:{d:"M304 456a88 88 0 100-176 88 88 0 000 176zm0-116c15.5 0 28 12.5 28 28s-12.5 28-28 28-28-12.5-28-28 12.5-28 28-28z",fill:m}}]}},name:"picture",theme:"twotone"};const Y0=J0;var Q0=function(m,b){return q.createElement(Ua,Qr({},m,{ref:b,icon:Y0}))};const ev=q.forwardRef(Q0);function dc(f){return Object.assign(Object.assign({},f),{lastModified:f.lastModified,lastModifiedDate:f.lastModifiedDate,name:f.name,size:f.size,type:f.type,uid:f.uid,percent:0,originFileObj:f})}function pc(f,m){const b=Yr(m),S=b.findIndex(T=>{let{uid:k}=T;return k===f.uid});return S===-1?b.push(f):b[S]=f,b}function Xu(f,m){const b=f.uid!==void 0?"uid":"name";return m.filter(S=>S[b]===f[b])[0]}function tv(f,m){const b=f.uid!==void 0?"uid":"name",S=m.filter(T=>T[b]!==f[b]);return S.length===m.length?null:S}const iv=function(){const m=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:"").split("/"),S=m[m.length-1].split(/#|\?/)[0];return(/\.[^./\\]*$/.exec(S)||[""])[0]},Qf=f=>f.indexOf("image/")===0,rv=f=>{if(f.type&&!f.thumbUrl)return Qf(f.type);const m=f.thumbUrl||f.url||"",b=iv(m);return/^data:image\//.test(m)||/(webp|svg|png|gif|jpg|jpeg|jfif|bmp|dpg|ico|heic|heif)$/i.test(b)?!0:!(/^data:/.test(m)||b)},Ss=200;function nv(f){return new Promise(m=>{if(!f.type||!Qf(f.type)){m("");return}const b=document.createElement("canvas");b.width=Ss,b.height=Ss,b.style.cssText=`position: fixed; left: 0; top: 0; width: ${Ss}px; height: ${Ss}px; z-index: 9999; display: none;`,document.body.appendChild(b);const S=b.getContext("2d"),T=new Image;if(T.onload=()=>{const{width:k,height:B}=T;let a=Ss,W=Ss,F=0,ne=0;k>B?(W=B*(Ss/k),ne=-(W-a)/2):(a=k*(Ss/B),F=-(a-W)/2),S.drawImage(T,F,ne,a,W);const ie=b.toDataURL();document.body.removeChild(b),window.URL.revokeObjectURL(T.src),m(ie)},T.crossOrigin="anonymous",f.type.startsWith("image/svg+xml")){const k=new FileReader;k.onload=()=>{k.result&&(T.src=k.result)},k.readAsDataURL(f)}else if(f.type.startsWith("image/gif")){const k=new FileReader;k.onload=()=>{k.result&&m(k.result)},k.readAsDataURL(f)}else T.src=window.URL.createObjectURL(f)})}var sv={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M505.7 661a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9h-74.1V168c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v338.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.8zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"download",theme:"outlined"};const av=sv;var ov=function(m,b){return q.createElement(Ua,Qr({},m,{ref:b,icon:av}))};const lv=q.forwardRef(ov),cv=q.forwardRef((f,m)=>{let{prefixCls:b,className:S,style:T,locale:k,listType:B,file:a,items:W,progress:F,iconRender:ne,actionIconRender:ie,itemRender:ue,isImgUrl:_e,showPreviewIcon:Ee,showRemoveIcon:ke,showDownloadIcon:Me,previewIcon:ze,removeIcon:je,downloadIcon:Ne,onPreview:me,onDownload:Ie,onClose:it}=f;var Ye,Ge;const{status:at}=a,[De,rt]=q.useState(at);q.useEffect(()=>{at!=="removed"&&rt(at)},[at]);const[xt,Pt]=q.useState(!1);q.useEffect(()=>{const Rt=setTimeout(()=>{Pt(!0)},300);return()=>{clearTimeout(Rt)}},[]);const gt=ne(a);let At=q.createElement("div",{className:`${b}-icon`},gt);if(B==="picture"||B==="picture-card"||B==="picture-circle")if(De==="uploading"||!a.thumbUrl&&!a.url){const Rt=Ut(`${b}-list-item-thumbnail`,{[`${b}-list-item-file`]:De!=="uploading"});At=q.createElement("div",{className:Rt},gt)}else{const Rt=_e?.(a)?q.createElement("img",{src:a.thumbUrl||a.url,alt:a.name,className:`${b}-list-item-image`,crossOrigin:a.crossOrigin}):gt,ki=Ut(`${b}-list-item-thumbnail`,{[`${b}-list-item-file`]:_e&&!_e(a)});At=q.createElement("a",{className:ki,onClick:bi=>me(a,bi),href:a.url||a.thumbUrl,target:"_blank",rel:"noopener noreferrer"},Rt)}const Bt=Ut(`${b}-list-item`,`${b}-list-item-${De}`),ft=typeof a.linkProps=="string"?JSON.parse(a.linkProps):a.linkProps,si=ke?ie((typeof je=="function"?je(a):je)||q.createElement(Yf,null),()=>it(a),b,k.removeFile,!0):null,Mi=Me&&De==="done"?ie((typeof Ne=="function"?Ne(a):Ne)||q.createElement(lv,null),()=>Ie(a),b,k.downloadFile):null,Ki=B!=="picture-card"&&B!=="picture-circle"&&q.createElement("span",{key:"download-delete",className:Ut(`${b}-list-item-actions`,{picture:B==="picture"})},Mi,si),ai=Ut(`${b}-list-item-name`),Kt=a.url?[q.createElement("a",Object.assign({key:"view",target:"_blank",rel:"noopener noreferrer",className:ai,title:a.name},ft,{href:a.url,onClick:Rt=>me(a,Rt)}),a.name),Ki]:[q.createElement("span",{key:"view",className:ai,onClick:Rt=>me(a,Rt),title:a.name},a.name),Ki],Ze=Ee&&(a.url||a.thumbUrl)?q.createElement("a",{href:a.url||a.thumbUrl,target:"_blank",rel:"noopener noreferrer",onClick:Rt=>me(a,Rt),title:k.previewFile},typeof ze=="function"?ze(a):ze||q.createElement(C_,null)):null,yt=(B==="picture-card"||B==="picture-circle")&&De!=="uploading"&&q.createElement("span",{className:`${b}-list-item-actions`},Ze,De==="done"&&Mi,si),{getPrefixCls:Jt}=q.useContext(Es),Mt=Jt(),Yt=q.createElement("div",{className:Bt},At,Kt,yt,xt&&q.createElement(zf,{motionName:`${Mt}-fade`,visible:De==="uploading",motionDeadline:2e3},Rt=>{let{className:ki}=Rt;const bi="percent"in a?q.createElement(w0,Object.assign({},F,{type:"line",percent:a.percent,"aria-label":a["aria-label"],"aria-labelledby":a["aria-labelledby"]})):null;return q.createElement("div",{className:Ut(`${b}-list-item-progress`,ki)},bi)})),gi=a.response&&typeof a.response=="string"?a.response:((Ye=a.error)===null||Ye===void 0?void 0:Ye.statusText)||((Ge=a.error)===null||Ge===void 0?void 0:Ge.message)||k.uploadError,Qt=De==="error"?q.createElement(Tf,{title:gi,getPopupContainer:Rt=>Rt.parentNode},Yt):Yt;return q.createElement("div",{className:Ut(`${b}-list-item-container`,S),style:T,ref:m},ue?ue(Qt,a,W,{download:Ie.bind(null,a),preview:me.bind(null,a),remove:it.bind(null,a)}):Qt)}),uv=cv,hv=(f,m)=>{const{listType:b="text",previewFile:S=nv,onPreview:T,onDownload:k,onRemove:B,locale:a,iconRender:W,isImageUrl:F=rv,prefixCls:ne,items:ie=[],showPreviewIcon:ue=!0,showRemoveIcon:_e=!0,showDownloadIcon:Ee=!1,removeIcon:ke,previewIcon:Me,downloadIcon:ze,progress:je={size:[-1,2],showInfo:!1},appendAction:Ne,appendActionVisible:me=!0,itemRender:Ie,disabled:it}=f,Ye=T_(),[Ge,at]=q.useState(!1);q.useEffect(()=>{b!=="picture"&&b!=="picture-card"&&b!=="picture-circle"||(ie||[]).forEach(Ze=>{typeof document>"u"||typeof window>"u"||!window.FileReader||!window.File||!(Ze.originFileObj instanceof File||Ze.originFileObj instanceof Blob)||Ze.thumbUrl!==void 0||(Ze.thumbUrl="",S&&S(Ze.originFileObj).then(yt=>{Ze.thumbUrl=yt||"",Ye()}))})},[b,ie,S]),q.useEffect(()=>{at(!0)},[]);const De=(Ze,yt)=>{if(T)return yt?.preventDefault(),T(Ze)},rt=Ze=>{typeof k=="function"?k(Ze):Ze.url&&window.open(Ze.url)},xt=Ze=>{B?.(Ze)},Pt=Ze=>{if(W)return W(Ze,b);const yt=Ze.status==="uploading",Jt=F&&F(Ze)?q.createElement(ev,null):q.createElement(G0,null);let Mt=yt?q.createElement(mh,null):q.createElement(K0,null);return b==="picture"?Mt=yt?q.createElement(mh,null):Jt:(b==="picture-card"||b==="picture-circle")&&(Mt=yt?a.uploading:Jt),Mt},gt=(Ze,yt,Jt,Mt,Yt)=>{const gi={type:"text",size:"small",title:Mt,onClick:Qt=>{yt(),vp(Ze)&&Ze.props.onClick&&Ze.props.onClick(Qt)},className:`${Jt}-list-item-action`};if(Yt&&(gi.disabled=it),vp(Ze)){const Qt=yp(Ze,Object.assign(Object.assign({},Ze.props),{onClick:()=>{}}));return q.createElement(ja,Object.assign({},gi,{icon:Qt}))}return q.createElement(ja,Object.assign({},gi),q.createElement("span",null,Ze))};q.useImperativeHandle(m,()=>({handlePreview:De,handleDownload:rt}));const{getPrefixCls:At}=q.useContext(Es),Bt=At("upload",ne),ft=At(),si=Ut(`${Bt}-list`,`${Bt}-list-${b}`),Mi=Yr(ie.map(Ze=>({key:Ze.uid,file:Ze})));let ai={motionDeadline:2e3,motionName:`${Bt}-${b==="picture-card"||b==="picture-circle"?"animate-inline":"animate"}`,keys:Mi,motionAppear:Ge};const Kt=q.useMemo(()=>{const Ze=Object.assign({},I_(ft));return delete Ze.onAppearEnd,delete Ze.onEnterEnd,delete Ze.onLeaveEnd,Ze},[ft]);return b!=="picture-card"&&b!=="picture-circle"&&(ai=Object.assign(Object.assign({},Kt),ai)),q.createElement("div",{className:si},q.createElement(vf,Object.assign({},ai,{component:!1}),Ze=>{let{key:yt,file:Jt,className:Mt,style:Yt}=Ze;return q.createElement(uv,{key:yt,locale:a,prefixCls:Bt,className:Mt,style:Yt,file:Jt,items:ie,progress:je,listType:b,isImgUrl:F,showPreviewIcon:ue,showRemoveIcon:_e,showDownloadIcon:Ee,removeIcon:ke,previewIcon:Me,downloadIcon:ze,iconRender:Pt,actionIconRender:gt,itemRender:Ie,onPreview:De,onDownload:rt,onClose:xt})}),Ne&&q.createElement(zf,Object.assign({},ai,{visible:me,forceRender:!0}),Ze=>{let{className:yt,style:Jt}=Ze;return yp(Ne,Mt=>({className:Ut(Mt.className,yt),style:Object.assign(Object.assign(Object.assign({},Jt),{pointerEvents:yt?"none":void 0}),Mt.style)}))}))},dv=q.forwardRef(hv),pv=dv;var fv=function(f,m,b,S){function T(k){return k instanceof b?k:new b(function(B){B(k)})}return new(b||(b=Promise))(function(k,B){function a(ne){try{F(S.next(ne))}catch(ie){B(ie)}}function W(ne){try{F(S.throw(ne))}catch(ie){B(ie)}}function F(ne){ne.done?k(ne.value):T(ne.value).then(a,W)}F((S=S.apply(f,m||[])).next())})};const Yo=`__LIST_IGNORE_${Date.now()}__`,mv=(f,m)=>{const{fileList:b,defaultFileList:S,onRemove:T,showUploadList:k=!0,listType:B="text",onPreview:a,onDownload:W,onChange:F,onDrop:ne,previewFile:ie,disabled:ue,locale:_e,iconRender:Ee,isImageUrl:ke,progress:Me,prefixCls:ze,className:je,type:Ne="select",children:me,style:Ie,itemRender:it,maxCount:Ye,data:Ge={},multiple:at=!1,hasControlInside:De=!0,action:rt="",accept:xt="",supportServerRender:Pt=!0,rootClassName:gt}=f,At=q.useContext(E_),Bt=ue??At,[ft,si]=P_(S||[],{value:b,postState:mt=>mt??[]}),[Mi,Ki]=q.useState("drop"),ai=q.useRef(null);q.useMemo(()=>{const mt=Date.now();(b||[]).forEach((dt,qt)=>{!dt.uid&&!Object.isFrozen(dt)&&(dt.uid=`__AUTO__${mt}_${qt}__`)})},[b]);const Kt=(mt,dt,qt)=>{let wt=Yr(dt),Te=!1;Ye===1?wt=wt.slice(-1):Ye&&(Te=wt.length>Ye,wt=wt.slice(0,Ye)),el.flushSync(()=>{si(wt)});const ot={file:mt,fileList:wt};qt&&(ot.event=qt),(!Te||wt.some(ct=>ct.uid===mt.uid))&&el.flushSync(()=>{F?.(ot)})},Ze=(mt,dt)=>fv(void 0,void 0,void 0,function*(){const{beforeUpload:qt,transformFile:wt}=f;let Te=mt;if(qt){const ot=yield qt(mt,dt);if(ot===!1)return!1;if(delete mt[Yo],ot===Yo)return Object.defineProperty(mt,Yo,{value:!0,configurable:!0}),!1;typeof ot=="object"&&ot&&(Te=ot)}return wt&&(Te=yield wt(Te)),Te}),yt=mt=>{const dt=mt.filter(Te=>!Te.file[Yo]);if(!dt.length)return;const qt=dt.map(Te=>dc(Te.file));let wt=Yr(ft);qt.forEach(Te=>{wt=pc(Te,wt)}),qt.forEach((Te,ot)=>{let ct=Te;if(dt[ot].parsedFile)Te.status="uploading";else{const{originFileObj:_i}=Te;let Vi;try{Vi=new File([_i],_i.name,{type:_i.type})}catch{Vi=new Blob([_i],{type:_i.type}),Vi.name=_i.name,Vi.lastModifiedDate=new Date,Vi.lastModified=new Date().getTime()}Vi.uid=Te.uid,ct=Vi}Kt(ct,wt)})},Jt=(mt,dt,qt)=>{try{typeof mt=="string"&&(mt=JSON.parse(mt))}catch{}if(!Xu(dt,ft))return;const wt=dc(dt);wt.status="done",wt.percent=100,wt.response=mt,wt.xhr=qt;const Te=pc(wt,ft);Kt(wt,Te)},Mt=(mt,dt)=>{if(!Xu(dt,ft))return;const qt=dc(dt);qt.status="uploading",qt.percent=mt.percent;const wt=pc(qt,ft);Kt(qt,wt,mt)},Yt=(mt,dt,qt)=>{if(!Xu(qt,ft))return;const wt=dc(qt);wt.error=mt,wt.response=dt,wt.status="error";const Te=pc(wt,ft);Kt(wt,Te)},gi=mt=>{let dt;Promise.resolve(typeof T=="function"?T(mt):T).then(qt=>{var wt;if(qt===!1)return;const Te=tv(mt,ft);Te&&(dt=Object.assign(Object.assign({},mt),{status:"removed"}),ft?.forEach(ot=>{const ct=dt.uid!==void 0?"uid":"name";ot[ct]===dt[ct]&&!Object.isFrozen(ot)&&(ot.status="removed")}),(wt=ai.current)===null||wt===void 0||wt.abort(dt),Kt(dt,Te))})},Qt=mt=>{Ki(mt.type),mt.type==="drop"&&ne?.(mt)};q.useImperativeHandle(m,()=>({onBatchStart:yt,onSuccess:Jt,onProgress:Mt,onError:Yt,fileList:ft,upload:ai.current}));const{getPrefixCls:Rt,direction:ki,upload:bi}=q.useContext(Es),Xt=Rt("upload",ze),Ti=Object.assign(Object.assign({onBatchStart:yt,onError:Yt,onProgress:Mt,onSuccess:Jt},f),{data:Ge,multiple:at,action:rt,accept:xt,supportServerRender:Pt,prefixCls:Xt,disabled:Bt,beforeUpload:Ze,onChange:void 0,hasControlInside:De});delete Ti.className,delete Ti.style,(!me||Bt)&&delete Ti.id;const nr=`${Xt}-wrapper`,[fr,sr,mr]=V0(Xt,nr),[Cr]=A_("Upload",M_.Upload),{showRemoveIcon:ge,showPreviewIcon:Ii,showDownloadIcon:ji,removeIcon:jt,previewIcon:kt,downloadIcon:qi}=typeof k=="boolean"?{}:k,Ji=typeof ge>"u"?!Bt:!!ge,ar=(mt,dt)=>k?q.createElement(pv,{prefixCls:Xt,listType:B,items:ft,previewFile:ie,onPreview:a,onDownload:W,onRemove:gi,showRemoveIcon:Ji,showPreviewIcon:Ii,showDownloadIcon:ji,removeIcon:jt,previewIcon:kt,downloadIcon:qi,iconRender:Ee,locale:Object.assign(Object.assign({},Cr),_e),isImageUrl:ke,progress:Me,appendAction:mt,appendActionVisible:dt,itemRender:it,disabled:Bt}):mt,Tn=Ut(nr,je,gt,sr,mr,bi?.className,{[`${Xt}-rtl`]:ki==="rtl",[`${Xt}-picture-card-wrapper`]:B==="picture-card",[`${Xt}-picture-circle-wrapper`]:B==="picture-circle"}),In=Object.assign(Object.assign({},bi?.style),Ie);if(Ne==="drag"){const mt=Ut(sr,Xt,`${Xt}-drag`,{[`${Xt}-drag-uploading`]:ft.some(dt=>dt.status==="uploading"),[`${Xt}-drag-hover`]:Mi==="dragover",[`${Xt}-disabled`]:Bt,[`${Xt}-rtl`]:ki==="rtl"});return fr(q.createElement("span",{className:Tn},q.createElement("div",{className:mt,style:In,onDrop:Qt,onDragOver:Qt,onDragLeave:Qt},q.createElement(vh,Object.assign({},Ti,{ref:ai,className:`${Xt}-btn`}),q.createElement("div",{className:`${Xt}-drag-container`},me))),ar()))}const en=Ut(Xt,`${Xt}-select`,{[`${Xt}-disabled`]:Bt}),Re=(mt=>q.createElement("div",{className:en,style:mt},q.createElement(vh,Object.assign({},Ti,{ref:ai}))))(me?void 0:{display:"none"});return fr(B==="picture-card"||B==="picture-circle"?q.createElement("span",{className:Tn},ar(Re,!!me)):q.createElement("span",{className:Tn},Re,ar()))},gv=q.forwardRef(mv),em=gv;var _v=function(f,m){var b={};for(var S in f)Object.prototype.hasOwnProperty.call(f,S)&&m.indexOf(S)<0&&(b[S]=f[S]);if(f!=null&&typeof Object.getOwnPropertySymbols=="function")for(var T=0,S=Object.getOwnPropertySymbols(f);T<S.length;T++)m.indexOf(S[T])<0&&Object.prototype.propertyIsEnumerable.call(f,S[T])&&(b[S[T]]=f[S[T]]);return b};const yv=q.forwardRef((f,m)=>{var{style:b,height:S,hasControlInside:T=!1}=f,k=_v(f,["style","height","hasControlInside"]);return q.createElement(em,Object.assign({ref:m,hasControlInside:T},k,{type:"drag",style:Object.assign(Object.assign({},b),{height:S})}))}),vv=yv,Ah=em;Ah.Dragger=vv;Ah.LIST_IGNORE=Yo;const xv=Ah;var bv={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M885.2 446.3l-.2-.8-112.2-285.1c-5-16.1-19.9-27.2-36.8-27.2H281.2c-17 0-32.1 11.3-36.9 27.6L139.4 443l-.3.7-.2.8c-1.3 4.9-1.7 9.9-1 14.8-.1 1.6-.2 3.2-.2 4.8V830a60.9 60.9 0 0060.8 60.8h627.2c33.5 0 60.8-27.3 60.9-60.8V464.1c0-1.3 0-2.6-.1-3.7.4-4.9 0-9.6-1.3-14.1zm-295.8-43l-.3 15.7c-.8 44.9-31.8 75.1-77.1 75.1-22.1 0-41.1-7.1-54.8-20.6S436 441.2 435.6 419l-.3-15.7H229.5L309 210h399.2l81.7 193.3H589.4zm-375 76.8h157.3c24.3 57.1 76 90.8 140.4 90.8 33.7 0 65-9.4 90.3-27.2 22.2-15.6 39.5-37.4 50.7-63.6h156.5V814H214.4V480.1z"}}]},name:"inbox",theme:"outlined"};const wv=bv;var Sv=function(m,b){return q.createElement(Ua,Qr({},m,{ref:b,icon:wv}))};const Cv=q.forwardRef(Sv);function Ku({children:f,className:m}){return ye.jsx(Ys,{gutter:38,className:"mt-3 first:mt-0 "+m,children:f})}const Tv=[{label:"Hoạt động",value:"Active"},{label:"Khóa",value:"Lock"}],Iv=[{label:"Thêm khách hàng",value:"add"},{label:"Chọn khách hàng",value:"Choose"},{label:"Import khách hàng",value:"Import"}],Mh=[{title:"Mã khách hàng",dataIndex:"customer_id",key:"customerid"},{title:"Tên khách hàng",dataIndex:"customer_name",key:"customername"}],tm=[{title:"Địa chỉ",dataIndex:"display_address",key:"display_address"},{title:"Số điện thoại",dataIndex:"phone_number",key:"phone_number"}],im=[{customer_id:"431456",customer_name:"Chu Văn A",display_address:"CT1 Chung cư bộ công an",phone_number:"0123456789",frequency:"1;2;3;4;5"},{customer_id:"4314s56",customer_name:"Chu Văn A",display_address:"CT1 Chung cư bộ công an",phone_number:"0123456789",frequency:""}],Ev=[{label:"1",value:"1"},{label:"2",value:"2"},{label:"3",value:"3"},{label:"4",value:"4"},{label:"5",value:"5"}],Pv={customer_type:"Loại khách hàng",customer_group:"Nhóm khách hàng",city:"Tỉnh/Thành phố",district:"Quận/huyện",ward:"Phường/xã"},Av=[{label:"Thứ 2",value:"Thứ 2"},{label:"Thứ 3",value:"Thứ 3"},{label:"Thứ 4",value:"Thứ 4"},{label:"Thứ 5",value:"Thứ 5"},{label:"Thứ 6",value:"Thứ 6"},{label:"Thứ 7",value:"Thứ 7"},{label:"Chủ nhật",value:"Chủ nhật"}];var kh={exports:{}},rm=function(m,b){return function(){for(var T=new Array(arguments.length),k=0;k<T.length;k++)T[k]=arguments[k];return m.apply(b,T)}},Mv=rm,Ps=Object.prototype.toString;function zh(f){return Array.isArray(f)}function xh(f){return typeof f>"u"}function kv(f){return f!==null&&!xh(f)&&f.constructor!==null&&!xh(f.constructor)&&typeof f.constructor.isBuffer=="function"&&f.constructor.isBuffer(f)}function nm(f){return Ps.call(f)==="[object ArrayBuffer]"}function zv(f){return Ps.call(f)==="[object FormData]"}function Dv(f){var m;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?m=ArrayBuffer.isView(f):m=f&&f.buffer&&nm(f.buffer),m}function Lv(f){return typeof f=="string"}function Rv(f){return typeof f=="number"}function sm(f){return f!==null&&typeof f=="object"}function gc(f){if(Ps.call(f)!=="[object Object]")return!1;var m=Object.getPrototypeOf(f);return m===null||m===Object.prototype}function Fv(f){return Ps.call(f)==="[object Date]"}function Bv(f){return Ps.call(f)==="[object File]"}function Ov(f){return Ps.call(f)==="[object Blob]"}function am(f){return Ps.call(f)==="[object Function]"}function $v(f){return sm(f)&&am(f.pipe)}function Nv(f){return Ps.call(f)==="[object URLSearchParams]"}function jv(f){return f.trim?f.trim():f.replace(/^\s+|\s+$/g,"")}function Vv(){return typeof navigator<"u"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window<"u"&&typeof document<"u"}function Dh(f,m){if(!(f===null||typeof f>"u"))if(typeof f!="object"&&(f=[f]),zh(f))for(var b=0,S=f.length;b<S;b++)m.call(null,f[b],b,f);else for(var T in f)Object.prototype.hasOwnProperty.call(f,T)&&m.call(null,f[T],T,f)}function bh(){var f={};function m(T,k){gc(f[k])&&gc(T)?f[k]=bh(f[k],T):gc(T)?f[k]=bh({},T):zh(T)?f[k]=T.slice():f[k]=T}for(var b=0,S=arguments.length;b<S;b++)Dh(arguments[b],m);return f}function Uv(f,m,b){return Dh(m,function(T,k){b&&typeof T=="function"?f[k]=Mv(T,b):f[k]=T}),f}function qv(f){return f.charCodeAt(0)===65279&&(f=f.slice(1)),f}var Zr={isArray:zh,isArrayBuffer:nm,isBuffer:kv,isFormData:zv,isArrayBufferView:Dv,isString:Lv,isNumber:Rv,isObject:sm,isPlainObject:gc,isUndefined:xh,isDate:Fv,isFile:Bv,isBlob:Ov,isFunction:am,isStream:$v,isURLSearchParams:Nv,isStandardBrowserEnv:Vv,forEach:Dh,merge:bh,extend:Uv,trim:jv,stripBOM:qv},$a=Zr;function Bp(f){return encodeURIComponent(f).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var om=function(m,b,S){if(!b)return m;var T;if(S)T=S(b);else if($a.isURLSearchParams(b))T=b.toString();else{var k=[];$a.forEach(b,function(W,F){W===null||typeof W>"u"||($a.isArray(W)?F=F+"[]":W=[W],$a.forEach(W,function(ie){$a.isDate(ie)?ie=ie.toISOString():$a.isObject(ie)&&(ie=JSON.stringify(ie)),k.push(Bp(F)+"="+Bp(ie))}))}),T=k.join("&")}if(T){var B=m.indexOf("#");B!==-1&&(m=m.slice(0,B)),m+=(m.indexOf("?")===-1?"?":"&")+T}return m},Zv=Zr;function Dc(){this.handlers=[]}Dc.prototype.use=function(m,b,S){return this.handlers.push({fulfilled:m,rejected:b,synchronous:S?S.synchronous:!1,runWhen:S?S.runWhen:null}),this.handlers.length-1};Dc.prototype.eject=function(m){this.handlers[m]&&(this.handlers[m]=null)};Dc.prototype.forEach=function(m){Zv.forEach(this.handlers,function(S){S!==null&&m(S)})};var Gv=Dc,Hv=Zr,Wv=function(m,b){Hv.forEach(m,function(T,k){k!==b&&k.toUpperCase()===b.toUpperCase()&&(m[b]=T,delete m[k])})},lm=function(m,b,S,T,k){return m.config=b,S&&(m.code=S),m.request=T,m.response=k,m.isAxiosError=!0,m.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},m},cm={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Ju,Op;function um(){if(Op)return Ju;Op=1;var f=lm;return Ju=function(b,S,T,k,B){var a=new Error(b);return f(a,S,T,k,B)},Ju}var Yu,$p;function Xv(){if($p)return Yu;$p=1;var f=um();return Yu=function(b,S,T){var k=T.config.validateStatus;!T.status||!k||k(T.status)?b(T):S(f("Request failed with status code "+T.status,T.config,null,T.request,T))},Yu}var Qu,Np;function Kv(){if(Np)return Qu;Np=1;var f=Zr;return Qu=f.isStandardBrowserEnv()?function(){return{write:function(S,T,k,B,a,W){var F=[];F.push(S+"="+encodeURIComponent(T)),f.isNumber(k)&&F.push("expires="+new Date(k).toGMTString()),f.isString(B)&&F.push("path="+B),f.isString(a)&&F.push("domain="+a),W===!0&&F.push("secure"),document.cookie=F.join("; ")},read:function(S){var T=document.cookie.match(new RegExp("(^|;\\s*)("+S+")=([^;]*)"));return T?decodeURIComponent(T[3]):null},remove:function(S){this.write(S,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),Qu}var eh,jp;function Jv(){return jp||(jp=1,eh=function(m){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(m)}),eh}var th,Vp;function Yv(){return Vp||(Vp=1,th=function(m,b){return b?m.replace(/\/+$/,"")+"/"+b.replace(/^\/+/,""):m}),th}var ih,Up;function Qv(){if(Up)return ih;Up=1;var f=Jv(),m=Yv();return ih=function(S,T){return S&&!f(T)?m(S,T):T},ih}var rh,qp;function ex(){if(qp)return rh;qp=1;var f=Zr,m=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return rh=function(S){var T={},k,B,a;return S&&f.forEach(S.split(`
`),function(F){if(a=F.indexOf(":"),k=f.trim(F.substr(0,a)).toLowerCase(),B=f.trim(F.substr(a+1)),k){if(T[k]&&m.indexOf(k)>=0)return;k==="set-cookie"?T[k]=(T[k]?T[k]:[]).concat([B]):T[k]=T[k]?T[k]+", "+B:B}}),T},rh}var nh,Zp;function tx(){if(Zp)return nh;Zp=1;var f=Zr;return nh=f.isStandardBrowserEnv()?function(){var b=/(msie|trident)/i.test(navigator.userAgent),S=document.createElement("a"),T;function k(B){var a=B;return b&&(S.setAttribute("href",a),a=S.href),S.setAttribute("href",a),{href:S.href,protocol:S.protocol?S.protocol.replace(/:$/,""):"",host:S.host,search:S.search?S.search.replace(/^\?/,""):"",hash:S.hash?S.hash.replace(/^#/,""):"",hostname:S.hostname,port:S.port,pathname:S.pathname.charAt(0)==="/"?S.pathname:"/"+S.pathname}}return T=k(window.location.href),function(a){var W=f.isString(a)?k(a):a;return W.protocol===T.protocol&&W.host===T.host}}():function(){return function(){return!0}}(),nh}var sh,Gp;function Lc(){if(Gp)return sh;Gp=1;function f(m){this.message=m}return f.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},f.prototype.__CANCEL__=!0,sh=f,sh}var ah,Hp;function Wp(){if(Hp)return ah;Hp=1;var f=Zr,m=Xv(),b=Kv(),S=om,T=Qv(),k=ex(),B=tx(),a=um(),W=cm,F=Lc();return ah=function(ie){return new Promise(function(_e,Ee){var ke=ie.data,Me=ie.headers,ze=ie.responseType,je;function Ne(){ie.cancelToken&&ie.cancelToken.unsubscribe(je),ie.signal&&ie.signal.removeEventListener("abort",je)}f.isFormData(ke)&&delete Me["Content-Type"];var me=new XMLHttpRequest;if(ie.auth){var Ie=ie.auth.username||"",it=ie.auth.password?unescape(encodeURIComponent(ie.auth.password)):"";Me.Authorization="Basic "+btoa(Ie+":"+it)}var Ye=T(ie.baseURL,ie.url);me.open(ie.method.toUpperCase(),S(Ye,ie.params,ie.paramsSerializer),!0),me.timeout=ie.timeout;function Ge(){if(me){var De="getAllResponseHeaders"in me?k(me.getAllResponseHeaders()):null,rt=!ze||ze==="text"||ze==="json"?me.responseText:me.response,xt={data:rt,status:me.status,statusText:me.statusText,headers:De,config:ie,request:me};m(function(gt){_e(gt),Ne()},function(gt){Ee(gt),Ne()},xt),me=null}}if("onloadend"in me?me.onloadend=Ge:me.onreadystatechange=function(){!me||me.readyState!==4||me.status===0&&!(me.responseURL&&me.responseURL.indexOf("file:")===0)||setTimeout(Ge)},me.onabort=function(){me&&(Ee(a("Request aborted",ie,"ECONNABORTED",me)),me=null)},me.onerror=function(){Ee(a("Network Error",ie,null,me)),me=null},me.ontimeout=function(){var rt=ie.timeout?"timeout of "+ie.timeout+"ms exceeded":"timeout exceeded",xt=ie.transitional||W;ie.timeoutErrorMessage&&(rt=ie.timeoutErrorMessage),Ee(a(rt,ie,xt.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",me)),me=null},f.isStandardBrowserEnv()){var at=(ie.withCredentials||B(Ye))&&ie.xsrfCookieName?b.read(ie.xsrfCookieName):void 0;at&&(Me[ie.xsrfHeaderName]=at)}"setRequestHeader"in me&&f.forEach(Me,function(rt,xt){typeof ke>"u"&&xt.toLowerCase()==="content-type"?delete Me[xt]:me.setRequestHeader(xt,rt)}),f.isUndefined(ie.withCredentials)||(me.withCredentials=!!ie.withCredentials),ze&&ze!=="json"&&(me.responseType=ie.responseType),typeof ie.onDownloadProgress=="function"&&me.addEventListener("progress",ie.onDownloadProgress),typeof ie.onUploadProgress=="function"&&me.upload&&me.upload.addEventListener("progress",ie.onUploadProgress),(ie.cancelToken||ie.signal)&&(je=function(De){me&&(Ee(!De||De&&De.type?new F("canceled"):De),me.abort(),me=null)},ie.cancelToken&&ie.cancelToken.subscribe(je),ie.signal&&(ie.signal.aborted?je():ie.signal.addEventListener("abort",je))),ke||(ke=null),me.send(ke)})},ah}var pr=Zr,Xp=Wv,ix=lm,rx=cm,nx={"Content-Type":"application/x-www-form-urlencoded"};function Kp(f,m){!pr.isUndefined(f)&&pr.isUndefined(f["Content-Type"])&&(f["Content-Type"]=m)}function sx(){var f;return(typeof XMLHttpRequest<"u"||typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]")&&(f=Wp()),f}function ax(f,m,b){if(pr.isString(f))try{return(m||JSON.parse)(f),pr.trim(f)}catch(S){if(S.name!=="SyntaxError")throw S}return(b||JSON.stringify)(f)}var Rc={transitional:rx,adapter:sx(),transformRequest:[function(m,b){return Xp(b,"Accept"),Xp(b,"Content-Type"),pr.isFormData(m)||pr.isArrayBuffer(m)||pr.isBuffer(m)||pr.isStream(m)||pr.isFile(m)||pr.isBlob(m)?m:pr.isArrayBufferView(m)?m.buffer:pr.isURLSearchParams(m)?(Kp(b,"application/x-www-form-urlencoded;charset=utf-8"),m.toString()):pr.isObject(m)||b&&b["Content-Type"]==="application/json"?(Kp(b,"application/json"),ax(m)):m}],transformResponse:[function(m){var b=this.transitional||Rc.transitional,S=b&&b.silentJSONParsing,T=b&&b.forcedJSONParsing,k=!S&&this.responseType==="json";if(k||T&&pr.isString(m)&&m.length)try{return JSON.parse(m)}catch(B){if(k)throw B.name==="SyntaxError"?ix(B,this,"E_JSON_PARSE"):B}return m}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(m){return m>=200&&m<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};pr.forEach(["delete","get","head"],function(m){Rc.headers[m]={}});pr.forEach(["post","put","patch"],function(m){Rc.headers[m]=pr.merge(nx)});var Lh=Rc,ox=Zr,lx=Lh,cx=function(m,b,S){var T=this||lx;return ox.forEach(S,function(B){m=B.call(T,m,b)}),m},oh,Jp;function hm(){return Jp||(Jp=1,oh=function(m){return!!(m&&m.__CANCEL__)}),oh}var Yp=Zr,lh=cx,ux=hm(),hx=Lh,dx=Lc();function ch(f){if(f.cancelToken&&f.cancelToken.throwIfRequested(),f.signal&&f.signal.aborted)throw new dx("canceled")}var px=function(m){ch(m),m.headers=m.headers||{},m.data=lh.call(m,m.data,m.headers,m.transformRequest),m.headers=Yp.merge(m.headers.common||{},m.headers[m.method]||{},m.headers),Yp.forEach(["delete","get","head","post","put","patch","common"],function(T){delete m.headers[T]});var b=m.adapter||hx.adapter;return b(m).then(function(T){return ch(m),T.data=lh.call(m,T.data,T.headers,m.transformResponse),T},function(T){return ux(T)||(ch(m),T&&T.response&&(T.response.data=lh.call(m,T.response.data,T.response.headers,m.transformResponse))),Promise.reject(T)})},Kr=Zr,dm=function(m,b){b=b||{};var S={};function T(ne,ie){return Kr.isPlainObject(ne)&&Kr.isPlainObject(ie)?Kr.merge(ne,ie):Kr.isPlainObject(ie)?Kr.merge({},ie):Kr.isArray(ie)?ie.slice():ie}function k(ne){if(Kr.isUndefined(b[ne])){if(!Kr.isUndefined(m[ne]))return T(void 0,m[ne])}else return T(m[ne],b[ne])}function B(ne){if(!Kr.isUndefined(b[ne]))return T(void 0,b[ne])}function a(ne){if(Kr.isUndefined(b[ne])){if(!Kr.isUndefined(m[ne]))return T(void 0,m[ne])}else return T(void 0,b[ne])}function W(ne){if(ne in b)return T(m[ne],b[ne]);if(ne in m)return T(void 0,m[ne])}var F={url:B,method:B,data:B,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:W};return Kr.forEach(Object.keys(m).concat(Object.keys(b)),function(ie){var ue=F[ie]||k,_e=ue(ie);Kr.isUndefined(_e)&&ue!==W||(S[ie]=_e)}),S},uh,Qp;function pm(){return Qp||(Qp=1,uh={version:"0.26.1"}),uh}var fx=pm().version,Rh={};["object","boolean","number","function","string","symbol"].forEach(function(f,m){Rh[f]=function(S){return typeof S===f||"a"+(m<1?"n ":" ")+f}});var ef={};Rh.transitional=function(m,b,S){function T(k,B){return"[Axios v"+fx+"] Transitional option '"+k+"'"+B+(S?". "+S:"")}return function(k,B,a){if(m===!1)throw new Error(T(B," has been removed"+(b?" in "+b:"")));return b&&!ef[B]&&(ef[B]=!0,console.warn(T(B," has been deprecated since v"+b+" and will be removed in the near future"))),m?m(k,B,a):!0}};function mx(f,m,b){if(typeof f!="object")throw new TypeError("options must be an object");for(var S=Object.keys(f),T=S.length;T-- >0;){var k=S[T],B=m[k];if(B){var a=f[k],W=a===void 0||B(a,k,f);if(W!==!0)throw new TypeError("option "+k+" must be "+W);continue}if(b!==!0)throw Error("Unknown option "+k)}}var gx={assertOptions:mx,validators:Rh},fm=Zr,_x=om,tf=Gv,rf=px,Fc=dm,mm=gx,Na=mm.validators;function il(f){this.defaults=f,this.interceptors={request:new tf,response:new tf}}il.prototype.request=function(m,b){typeof m=="string"?(b=b||{},b.url=m):b=m||{},b=Fc(this.defaults,b),b.method?b.method=b.method.toLowerCase():this.defaults.method?b.method=this.defaults.method.toLowerCase():b.method="get";var S=b.transitional;S!==void 0&&mm.assertOptions(S,{silentJSONParsing:Na.transitional(Na.boolean),forcedJSONParsing:Na.transitional(Na.boolean),clarifyTimeoutError:Na.transitional(Na.boolean)},!1);var T=[],k=!0;this.interceptors.request.forEach(function(_e){typeof _e.runWhen=="function"&&_e.runWhen(b)===!1||(k=k&&_e.synchronous,T.unshift(_e.fulfilled,_e.rejected))});var B=[];this.interceptors.response.forEach(function(_e){B.push(_e.fulfilled,_e.rejected)});var a;if(!k){var W=[rf,void 0];for(Array.prototype.unshift.apply(W,T),W=W.concat(B),a=Promise.resolve(b);W.length;)a=a.then(W.shift(),W.shift());return a}for(var F=b;T.length;){var ne=T.shift(),ie=T.shift();try{F=ne(F)}catch(ue){ie(ue);break}}try{a=rf(F)}catch(ue){return Promise.reject(ue)}for(;B.length;)a=a.then(B.shift(),B.shift());return a};il.prototype.getUri=function(m){return m=Fc(this.defaults,m),_x(m.url,m.params,m.paramsSerializer).replace(/^\?/,"")};fm.forEach(["delete","get","head","options"],function(m){il.prototype[m]=function(b,S){return this.request(Fc(S||{},{method:m,url:b,data:(S||{}).data}))}});fm.forEach(["post","put","patch"],function(m){il.prototype[m]=function(b,S,T){return this.request(Fc(T||{},{method:m,url:b,data:S}))}});var yx=il,hh,nf;function vx(){if(nf)return hh;nf=1;var f=Lc();function m(b){if(typeof b!="function")throw new TypeError("executor must be a function.");var S;this.promise=new Promise(function(B){S=B});var T=this;this.promise.then(function(k){if(T._listeners){var B,a=T._listeners.length;for(B=0;B<a;B++)T._listeners[B](k);T._listeners=null}}),this.promise.then=function(k){var B,a=new Promise(function(W){T.subscribe(W),B=W}).then(k);return a.cancel=function(){T.unsubscribe(B)},a},b(function(B){T.reason||(T.reason=new f(B),S(T.reason))})}return m.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},m.prototype.subscribe=function(S){if(this.reason){S(this.reason);return}this._listeners?this._listeners.push(S):this._listeners=[S]},m.prototype.unsubscribe=function(S){if(this._listeners){var T=this._listeners.indexOf(S);T!==-1&&this._listeners.splice(T,1)}},m.source=function(){var S,T=new m(function(B){S=B});return{token:T,cancel:S}},hh=m,hh}var dh,sf;function xx(){return sf||(sf=1,dh=function(m){return function(S){return m.apply(null,S)}}),dh}var ph,af;function bx(){if(af)return ph;af=1;var f=Zr;return ph=function(b){return f.isObject(b)&&b.isAxiosError===!0},ph}var of=Zr,wx=rm,_c=yx,Sx=dm,Cx=Lh;function gm(f){var m=new _c(f),b=wx(_c.prototype.request,m);return of.extend(b,_c.prototype,m),of.extend(b,m),b.create=function(T){return gm(Sx(f,T))},b}var $n=gm(Cx);$n.Axios=_c;$n.Cancel=Lc();$n.CancelToken=vx();$n.isCancel=hm();$n.VERSION=pm().version;$n.all=function(m){return Promise.all(m)};$n.spread=xx();$n.isAxiosError=bx();kh.exports=$n;kh.exports.default=$n;var Tx=kh.exports,Ix=Tx;const _m=Df(Ix);var Qo={VITE_BASE_PATH:"/mbw_desk",VITE_KEY_MAP:"wtpM0U1ZmE2s87LEZNSHf63Osc1a2sboaozCQNsy",BASE_URL:"/assets/mbw_dms/mbw_fe/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};let Cn=_m;console.log(Qo.VITE_BASE_URL);Qo.VITE_BASE_URL&&(console.log("vao day"),Cn=_m.create({baseURL:Qo.VITE_BASE_URL}),Cn.interceptors.request.use(function(f){const m=`Basic ${btoa(`${Qo.VITE_AUTH_KEY}:${Qo.VITE_AUTH_SECRET}`)}`;return f.headers.Authorization=m,f},function(f){return Promise.reject(f)}));Cn.interceptors.response.use(function(f){return console.log("response",f),f.data},function(f){return Promise.reject(f)});let fc;const Ex=(f,m)=>{console.log(f),fc&&(clearTimeout(fc),fc=null),f?fc=setTimeout(()=>{m(f)},300):m("")};function Px(){const[f,m]=q.useState(""),[b,S]=q.useState([]),[T,k]=q.useState([]);q.useEffect(()=>{(async()=>{let a=await Cn.get("/api/method/mbw_dms.api.router.get_team_sale");S(a.result.map(W=>({label:W,value:W})))})()},[]),q.useEffect(()=>{(async()=>{let a=await Cn.get("/api/method/frappe.desk.search.search_link",{params:{txt:f,doctype:"Employee",ignore_user_permissions:0,reference_doctype:"Attendance",query:"erpnext.controllers.queries.employee_query"}}),{results:W}=a;k(W.map(F=>({value:F.value,label:F.description})))})()},[f]),console.log("listEmployees",T);const B=a=>{Ex(a,m)};return ye.jsxs("div",{className:"p-4 pt-[43px] pb-[58px]",children:[ye.jsxs(Ku,{children:[ye.jsx(Rr,{span:12,children:ye.jsx(qr,{label:"Mã tuyến",name:"channel_code",required:!0,children:ye.jsx(yc,{})})}),ye.jsx(Rr,{span:12,children:ye.jsx(qr,{label:"Tên tuyến",name:"channel_name",required:!0,children:ye.jsx(yc,{})})})]}),ye.jsxs(Ku,{children:[ye.jsx(Rr,{span:12,children:ye.jsx(qr,{label:"Team sale",name:"team_sale",required:!0,children:ye.jsx(Sn,{showSearch:!0,options:b,defaultActiveFirstOption:!1})})}),ye.jsx(Rr,{span:12,children:ye.jsx(qr,{label:"Nhân viên",name:"employee",required:!0,children:ye.jsx(Sn,{showSearch:!0,notFoundContent:null,onSearch:B,options:T})})})]}),ye.jsxs(Ku,{children:[ye.jsx(Rr,{span:12,children:ye.jsx(qr,{label:"Ngày đi tuyến",name:"travel_date",required:!0,children:ye.jsx(Sn,{options:Av})})}),ye.jsx(Rr,{span:12,children:ye.jsx(qr,{label:"Trạng thái",name:"status",children:ye.jsx(Sn,{options:Tv,defaultValue:"Active"})})})]})]})}const Ax=({size:f=20})=>ye.jsx("svg",{width:f,height:f,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:ye.jsx("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M11.0267 1.13334C11.5534 0.501676 12.5792 0.933342 12.4959 1.75168L11.9076 7.50001H16.6667C16.8251 7.50007 16.9801 7.54524 17.1137 7.63024C17.2473 7.71523 17.3539 7.83653 17.4211 7.97993C17.4882 8.12333 17.5132 8.2829 17.4929 8.43994C17.4726 8.59698 17.4081 8.74501 17.3067 8.86668L8.97339 18.8667C8.44672 19.4983 7.42089 19.0667 7.50422 18.2483L8.09255 12.5H3.33339C3.17504 12.4999 3.01999 12.4548 2.88639 12.3698C2.75279 12.2848 2.64617 12.1635 2.57902 12.0201C2.51187 11.8767 2.48696 11.7171 2.50721 11.5601C2.52747 11.403 2.59205 11.255 2.69339 11.1333L11.0267 1.13334Z",fill:"currentColor"})}),Mx=({size:f=20})=>ye.jsxs("svg",{width:f,height:f,viewBox:"0 0 28 28",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[ye.jsx("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M9.83847 8.58794C10.1411 8.46187 10.4827 8.4689 10.7798 8.60732L15.0763 10.6088C15.6604 10.8809 15.9133 11.5749 15.6412 12.159C15.3691 12.7431 14.6751 12.996 14.091 12.7239L11.4888 11.5117L11.653 20.2421L15.7503 22.1045V15.7497C15.7503 15.1053 16.2727 14.583 16.917 14.583C17.5613 14.583 18.0837 15.1053 18.0837 15.7497V22.1663L22.7503 20.2219V13.4163C22.7503 12.772 23.2727 12.2497 23.917 12.2497C24.5613 12.2497 25.0837 12.772 25.0837 13.4163V20.9997C25.0837 21.4707 24.8005 21.8955 24.3657 22.0766L17.3657 24.9933C17.0666 25.1179 16.7292 25.1125 16.4342 24.9784L10.5003 22.2812L4.56643 24.9784C4.20532 25.1426 3.78555 25.112 3.45204 24.8972C3.11854 24.6825 2.91699 24.313 2.91699 23.9163V12.2497C2.91699 11.7787 3.20019 11.3539 3.63494 11.1728L9.83847 8.58794ZM9.31945 20.2549L9.15297 11.4013L5.25033 13.0275V22.1045L9.31945 20.2549Z",fill:"currentColor"}),ye.jsx("path",{d:"M19.8337 8.61425C20.478 8.61425 21.0003 8.09192 21.0003 7.44759C21.0003 6.80326 20.478 6.28092 19.8337 6.28092C19.1893 6.28092 18.667 6.80326 18.667 7.44759C18.667 8.09192 19.1893 8.61425 19.8337 8.61425Z",fill:"currentColor"}),ye.jsx("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M19.8337 2.33301C17.2197 2.33301 15.167 4.52385 15.167 7.1293C15.167 7.85019 15.4274 8.59094 15.7195 9.21916C16.0229 9.8717 16.4198 10.5259 16.8094 11.1056C17.5898 12.2664 18.4067 13.2245 18.579 13.4238L18.5825 13.4278C18.89 13.7803 19.3411 13.9997 19.8337 13.9997C20.3262 13.9997 20.7773 13.7803 21.0848 13.4278L21.0883 13.4238C21.2606 13.2245 22.0776 12.2664 22.8579 11.1056C23.2476 10.5259 23.6444 9.8717 23.9478 9.21916C24.2399 8.59094 24.5003 7.85019 24.5003 7.1293C24.5003 4.52385 22.4476 2.33301 19.8337 2.33301ZM17.5003 7.1293C17.5003 5.7318 18.5876 4.66634 19.8337 4.66634C21.0797 4.66634 22.167 5.7318 22.167 7.1293C22.167 7.33968 22.0764 7.70972 21.832 8.23544C21.5989 8.73683 21.2738 9.2797 20.9214 9.80382C20.5368 10.376 20.1392 10.8972 19.8337 11.2802C19.5281 10.8972 19.1305 10.376 18.7459 9.80382C18.3936 9.2797 18.0684 8.73683 17.8353 8.23544C17.5909 7.70972 17.5003 7.33968 17.5003 7.1293Z",fill:"currentColor"})]}),kx=({size:f=20,fill:m="#1877F2"})=>ye.jsx("svg",{width:f,height:f,viewBox:"0 0 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:ye.jsx("path",{d:"M23.1875 5.25H10.9375C10.6094 5.25 10.3314 5.36393 10.1035 5.5918C9.87565 5.81966 9.76172 6.09766 9.76172 6.42578C9.76172 6.73568 9.87565 7.00456 10.1035 7.23242C10.3314 7.46029 10.6094 7.57422 10.9375 7.57422H23.1875C23.4974 7.57422 23.7663 7.46029 23.9941 7.23242C24.222 7.00456 24.3359 6.73568 24.3359 6.42578C24.3359 6.09766 24.222 5.81966 23.9941 5.5918C23.7663 5.36393 23.4974 5.25 23.1875 5.25ZM23.1875 12.25H10.9375C10.6094 12.25 10.3314 12.3639 10.1035 12.5918C9.87565 12.8197 9.76172 13.0977 9.76172 13.4258C9.76172 13.7357 9.87565 14.0046 10.1035 14.2324C10.3314 14.4603 10.6094 14.5742 10.9375 14.5742H23.1875C23.4974 14.5742 23.7663 14.4603 23.9941 14.2324C24.222 14.0046 24.3359 13.7357 24.3359 13.4258C24.3359 13.0977 24.222 12.8197 23.9941 12.5918C23.7663 12.3639 23.4974 12.25 23.1875 12.25ZM23.1875 19.25H10.9375C10.6094 19.25 10.3314 19.3639 10.1035 19.5918C9.87565 19.8197 9.76172 20.0977 9.76172 20.4258C9.76172 20.7357 9.87565 21.0046 10.1035 21.2324C10.3314 21.4603 10.6094 21.5742 10.9375 21.5742H23.1875C23.4974 21.5742 23.7663 21.4603 23.9941 21.2324C24.222 21.0046 24.3359 20.7357 24.3359 20.4258C24.3359 20.0977 24.222 19.8197 23.9941 19.5918C23.7663 19.3639 23.4974 19.25 23.1875 19.25ZM5.25 18.6758C5.72396 18.6758 6.13411 18.8444 6.48047 19.1816C6.82682 19.5189 7 19.9336 7 20.4258C7 20.8997 6.82682 21.3099 6.48047 21.6562C6.13411 22.0026 5.72396 22.1758 5.25 22.1758C4.75781 22.1758 4.3431 22.0026 4.00586 21.6562C3.66862 21.3099 3.5 20.8997 3.5 20.4258C3.5 19.9336 3.66862 19.5189 4.00586 19.1816C4.3431 18.8444 4.75781 18.6758 5.25 18.6758ZM5.25 15.1758C4.75781 15.1758 4.3431 15.0026 4.00586 14.6562C3.66862 14.3099 3.5 13.8997 3.5 13.4258C3.5 12.9336 3.66862 12.5189 4.00586 12.1816C4.3431 11.8444 4.75781 11.6758 5.25 11.6758C5.72396 11.6758 6.13411 11.8444 6.48047 12.1816C6.82682 12.5189 7 12.9336 7 13.4258C7 13.8997 6.82682 14.3099 6.48047 14.6562C6.13411 15.0026 5.72396 15.1758 5.25 15.1758ZM5.25 8.17578C4.75781 8.17578 4.3431 8.0026 4.00586 7.65625C3.66862 7.3099 3.5 6.89974 3.5 6.42578C3.5 5.93359 3.66862 5.51888 4.00586 5.18164C4.3431 4.8444 4.75781 4.67578 5.25 4.67578C5.72396 4.67578 6.13411 4.8444 6.48047 5.18164C6.82682 5.51888 7 5.93359 7 6.42578C7 6.89974 6.82682 7.3099 6.48047 7.65625C6.13411 8.0026 5.72396 8.17578 5.25 8.17578Z",fill:"currentColor"})});function zx({data:f,handleData:m}){const b=[{title:"Stt",dataIndex:"stt",key:"stt",render:(S,T,k)=>k+1},...Mh,...tm,{title:"Tần suất",dataIndex:"frequency",key:"frequency",render:(S,T)=>ye.jsx(Sn,{mode:"multiple",options:Ev,style:{width:"100%"},placeholder:"Chọn tần suất",onChange:k=>{m(B=>B.map(a=>(a.customer_id==T.customer_id&&(a.frequency=k.toString().replaceAll(",",";")),a)))},defaultValue:S?S.split(";"):[]})},{title:"Hành động",dataIndex:"",key:"action",render:(S,T)=>ye.jsx("div",{className:"flex justify-center",onClick:()=>{m(k=>[...k.filter(B=>B.customer_id!=T.customer_id)])},children:ye.jsx(Yf,{})})}];return ye.jsx("div",{className:"p-4",children:ye.jsx(Ch,{columns:b,dataSource:f,pagination:!1})})}const Dx=q.createContext(null);function Lx(f,m){const b=Array.isArray(f)?f[0]:f?f.x:0,S=Array.isArray(f)?f[1]:f?f.y:0,T=Array.isArray(m)?m[0]:m?m.x:0,k=Array.isArray(m)?m[1]:m?m.y:0;return b===T&&S===k}function Bn(f,m){if(f===m)return!0;if(!f||!m)return!1;if(Array.isArray(f)){if(!Array.isArray(m)||f.length!==m.length)return!1;for(let b=0;b<f.length;b++)if(!Bn(f[b],m[b]))return!1;return!0}else if(Array.isArray(m))return!1;if(typeof f=="object"&&typeof m=="object"){const b=Object.keys(f),S=Object.keys(m);if(b.length!==S.length)return!1;for(const T of b)if(!m.hasOwnProperty(T)||!Bn(f[T],m[T]))return!1;return!0}return!1}function Rx(f){const m=f.clone();return m.pixelsToGLUnits=f.pixelsToGLUnits,m}function lf(f,m){if(!f.getProjection)return;const b=f.getProjection(),S=m.getProjection();Bn(b,S)||m.setProjection(b)}function cf(f){return{longitude:f.center.lng,latitude:f.center.lat,zoom:f.zoom,pitch:f.pitch,bearing:f.bearing,padding:f.padding}}function uf(f,m){const b=m.viewState||m;let S=!1;if("longitude"in b&&"latitude"in b){const T=f.center;f.center=new T.constructor(b.longitude,b.latitude),S=S||T!==f.center}if("zoom"in b){const T=f.zoom;f.zoom=b.zoom,S=S||T!==f.zoom}if("bearing"in b){const T=f.bearing;f.bearing=b.bearing,S=S||T!==f.bearing}if("pitch"in b){const T=f.pitch;f.pitch=b.pitch,S=S||T!==f.pitch}return b.padding&&!f.isPaddingEqual(b.padding)&&(S=!0,f.padding=b.padding),S}const Fx=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function hf(f){if(!f)return null;if(typeof f=="string"||("toJS"in f&&(f=f.toJS()),!f.layers))return f;const m={};for(const S of f.layers)m[S.id]=S;const b=f.layers.map(S=>{let T=null;"interactive"in S&&(T=Object.assign({},S),delete T.interactive);const k=m[S.ref];if(k){T=T||Object.assign({},S),delete T.ref;for(const B of Fx)B in k&&(T[B]=k[B])}return T||S});return{...f,layers:b}}var df={};const pf={version:8,sources:{},layers:[]},ff={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},fh={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},mf={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},Bx=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],Ox=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class Va{constructor(m,b,S){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=T=>{const k=this.props[mf[T.type]];k?k(T):T.type==="error"&&console.error(T.error)},this._onPointerEvent=T=>{(T.type==="mousemove"||T.type==="mouseout")&&this._updateHover(T);const k=this.props[ff[T.type]];k&&(this.props.interactiveLayerIds&&T.type!=="mouseover"&&T.type!=="mouseout"&&(T.features=this._hoveredFeatures||this._queryRenderedFeatures(T.point)),k(T),delete T.features)},this._onCameraEvent=T=>{if(!this._internalUpdate){const k=this.props[fh[T.type]];k&&k(T)}T.type in this._deferredEvents&&(this._deferredEvents[T.type]=!1)},this._MapClass=m,this.props=b,this._initialize(S)}get map(){return this._map}get transform(){return this._renderTransform}setProps(m){const b=this.props;this.props=m;const S=this._updateSettings(m,b);S&&this._createShadowTransform(this._map);const T=this._updateSize(m),k=this._updateViewState(m,!0);this._updateStyle(m,b),this._updateStyleComponents(m,b),this._updateHandlers(m,b),(S||T||k&&!this._map.isMoving())&&this.redraw()}static reuse(m,b){const S=Va.savedMaps.pop();if(!S)return null;const T=S.map,k=T.getContainer();for(b.className=k.className;k.childNodes.length>0;)b.appendChild(k.childNodes[0]);T._container=b;const B=T._resizeObserver;B&&(B.disconnect(),B.observe(b)),S.setProps({...m,styleDiffing:!1}),T.resize();const{initialViewState:a}=m;return a&&(a.bounds?T.fitBounds(a.bounds,{...a.fitBoundsOptions,duration:0}):S._updateViewState(a,!1)),T.isStyleLoaded()?T.fire("load"):T.once("styledata",()=>T.fire("load")),T._update(),S}_initialize(m){const{props:b}=this,{mapStyle:S=pf}=b,T={...b,...b.initialViewState,accessToken:b.mapboxAccessToken||$x()||null,container:m,style:hf(S)},k=T.initialViewState||T.viewState||T;if(Object.assign(T,{center:[k.longitude||0,k.latitude||0],zoom:k.zoom||0,pitch:k.pitch||0,bearing:k.bearing||0}),b.gl){const ne=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=ne,b.gl)}const B=new this._MapClass(T);k.padding&&B.setPadding(k.padding),b.cursor&&(B.getCanvas().style.cursor=b.cursor),this._createShadowTransform(B);const a=B._render;B._render=ne=>{this._inRender=!0,a.call(B,ne),this._inRender=!1};const W=B._renderTaskQueue.run;B._renderTaskQueue.run=ne=>{W.call(B._renderTaskQueue,ne),this._onBeforeRepaint()},B.on("render",()=>this._onAfterRepaint());const F=B.fire;B.fire=this._fireEvent.bind(this,F),B.on("resize",()=>{this._renderTransform.resize(B.transform.width,B.transform.height)}),B.on("styledata",()=>{this._updateStyleComponents(this.props,{}),lf(B.transform,this._renderTransform)}),B.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const ne in ff)B.on(ne,this._onPointerEvent);for(const ne in fh)B.on(ne,this._onCameraEvent);for(const ne in mf)B.on(ne,this._onEvent);this._map=B}recycle(){const b=this.map.getContainer().querySelector("[mapboxgl-children]");b?.remove(),Va.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const m=this._map;!this._inRender&&m.style&&(m._frame&&(m._frame.cancel(),m._frame=null),m._render())}_createShadowTransform(m){const b=Rx(m.transform);m.painter.transform=b,this._renderTransform=b}_updateSize(m){const{viewState:b}=m;if(b){const S=this._map;if(b.width!==S.transform.width||b.height!==S.transform.height)return S.resize(),!0}return!1}_updateViewState(m,b){if(this._internalUpdate)return!1;const S=this._map,T=this._renderTransform,{zoom:k,pitch:B,bearing:a}=T,W=S.isMoving();W&&(T.cameraElevationReference="sea");const F=uf(T,{...cf(S.transform),...m});if(W&&(T.cameraElevationReference="ground"),F&&b){const ne=this._deferredEvents;ne.move=!0,ne.zoom||(ne.zoom=k!==T.zoom),ne.rotate||(ne.rotate=a!==T.bearing),ne.pitch||(ne.pitch=B!==T.pitch)}return W||uf(S.transform,m),F}_updateSettings(m,b){const S=this._map;let T=!1;for(const k of Bx)if(k in m&&!Bn(m[k],b[k])){T=!0;const B=S[`set${k[0].toUpperCase()}${k.slice(1)}`];B?.call(S,m[k])}return T}_updateStyle(m,b){if(m.cursor!==b.cursor&&(this._map.getCanvas().style.cursor=m.cursor||""),m.mapStyle!==b.mapStyle){const{mapStyle:S=pf,styleDiffing:T=!0}=m,k={diff:T};return"localIdeographFontFamily"in m&&(k.localIdeographFontFamily=m.localIdeographFontFamily),this._map.setStyle(hf(S),k),!0}return!1}_updateStyleComponents(m,b){const S=this._map;let T=!1;return S.isStyleLoaded()&&("light"in m&&S.setLight&&!Bn(m.light,b.light)&&(T=!0,S.setLight(m.light)),"fog"in m&&S.setFog&&!Bn(m.fog,b.fog)&&(T=!0,S.setFog(m.fog)),"terrain"in m&&S.setTerrain&&!Bn(m.terrain,b.terrain)&&(!m.terrain||S.getSource(m.terrain.source))&&(T=!0,S.setTerrain(m.terrain))),T}_updateHandlers(m,b){var S,T;const k=this._map;let B=!1;for(const a of Ox){const W=(S=m[a])!==null&&S!==void 0?S:!0,F=(T=b[a])!==null&&T!==void 0?T:!0;Bn(W,F)||(B=!0,W?k[a].enable(W):k[a].disable())}return B}_queryRenderedFeatures(m){const b=this._map,S=b.transform,{interactiveLayerIds:T=[]}=this.props;try{return b.transform=this._renderTransform,b.queryRenderedFeatures(m,{layers:T.filter(b.getLayer.bind(b))})}catch{return[]}finally{b.transform=S}}_updateHover(m){var b;const{props:S}=this;if(S.interactiveLayerIds&&(S.onMouseMove||S.onMouseEnter||S.onMouseLeave)){const k=m.type,B=((b=this._hoveredFeatures)===null||b===void 0?void 0:b.length)>0,a=this._queryRenderedFeatures(m.point),W=a.length>0;!W&&B&&(m.type="mouseleave",this._onPointerEvent(m)),this._hoveredFeatures=a,W&&!B&&(m.type="mouseenter",this._onPointerEvent(m)),m.type=k}else this._hoveredFeatures=null}_fireEvent(m,b,S){const T=this._map,k=T.transform,B=typeof b=="string"?b:b.type;return B==="move"&&this._updateViewState(this.props,!1),B in fh&&(typeof b=="object"&&(b.viewState=cf(k)),this._map.isMoving())?(T.transform=this._renderTransform,m.call(T,b,S),T.transform=k,T):(m.call(T,b,S),T)}_onBeforeRepaint(){const m=this._map;this._internalUpdate=!0;for(const S in this._deferredEvents)this._deferredEvents[S]&&m.fire(S);this._internalUpdate=!1;const b=this._map.transform;m.transform=this._renderTransform,this._onAfterRepaint=()=>{lf(this._renderTransform,b),m.transform=b}}}Va.savedMaps=[];function $x(){let f=null;if(typeof location<"u"){const m=/access_token=([^&\/]*)/.exec(location.search);f=m&&m[1]}try{f=f||df.MapboxAccessToken}catch{}try{f=f||df.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return f}const Nx=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function jx(f){if(!f)return null;const m=f.map,b={getMap:()=>m,getCenter:()=>f.transform.center,getZoom:()=>f.transform.zoom,getBearing:()=>f.transform.bearing,getPitch:()=>f.transform.pitch,getPadding:()=>f.transform.padding,getBounds:()=>f.transform.getBounds(),project:S=>{const T=m.transform;m.transform=f.transform;const k=m.project(S);return m.transform=T,k},unproject:S=>{const T=m.transform;m.transform=f.transform;const k=m.unproject(S);return m.transform=T,k},queryTerrainElevation:(S,T)=>{const k=m.transform;m.transform=f.transform;const B=m.queryTerrainElevation(S,T);return m.transform=k,B},queryRenderedFeatures:(S,T)=>{const k=m.transform;m.transform=f.transform;const B=m.queryRenderedFeatures(S,T);return m.transform=k,B}};for(const S of Vx(m))!(S in b)&&!Nx.includes(S)&&(b[S]=m[S].bind(m));return b}function Vx(f){const m=new Set;let b=f;for(;b;){for(const S of Object.getOwnPropertyNames(b))S[0]!=="_"&&typeof f[S]=="function"&&S!=="fire"&&S!=="setEventedParent"&&m.add(S);b=Object.getPrototypeOf(b)}return Array.from(m)}const Ux=typeof document<"u"?q.useLayoutEffect:q.useEffect,qx=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function Zx(f,m){for(const S of qx)S in m&&(f[S]=m[S]);const{RTLTextPlugin:b="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=m;b&&f.getRTLTextPluginStatus&&f.getRTLTextPluginStatus()==="unavailable"&&f.setRTLTextPlugin(b,S=>{S&&console.error(S)},!0)}const rl=q.createContext(null);function Gx(f,m,b){const S=q.useContext(Dx),[T,k]=q.useState(null),B=q.useRef(),{current:a}=q.useRef({mapLib:null,map:null});q.useEffect(()=>{const ne=f.mapLib;let ie=!0,ue;return Promise.resolve(ne||b).then(_e=>{if(!ie)return;if(!_e)throw new Error("Invalid mapLib");const Ee="Map"in _e?_e:_e.default;if(!Ee.Map)throw new Error("Invalid mapLib");if(Zx(Ee,f),!Ee.supported||Ee.supported(f))f.reuseMaps&&(ue=Va.reuse(f,B.current)),ue||(ue=new Va(Ee.Map,f,B.current)),a.map=jx(ue),a.mapLib=Ee,k(ue),S?.onMapMount(a.map,f.id);else throw new Error("Map is not supported by this browser")}).catch(_e=>{const{onError:Ee}=f;Ee?Ee({type:"error",target:null,originalEvent:null,error:_e}):console.error(_e)}),()=>{ie=!1,ue&&(S?.onMapUnmount(f.id),f.reuseMaps?ue.recycle():ue.destroy())}},[]),Ux(()=>{T&&T.setProps(f)}),q.useImperativeHandle(m,()=>a.map,[T]);const W=q.useMemo(()=>({position:"relative",width:"100%",height:"100%",...f.style}),[f.style]),F={height:"100%"};return q.createElement("div",{id:f.id,ref:B,style:W},T&&q.createElement(rl.Provider,{value:a},q.createElement("div",{"mapboxgl-children":"",style:F},f.children)))}const Hx=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function Qs(f,m){if(!f||!m)return;const b=f.style;for(const S in m){const T=m[S];Number.isFinite(T)&&!Hx.test(S)?b[S]=`${T}px`:b[S]=T}}function Wx(f,m){const{map:b,mapLib:S}=q.useContext(rl),T=q.useRef({props:f});T.current.props=f;const k=q.useMemo(()=>{let ke=!1;q.Children.forEach(f.children,je=>{je&&(ke=!0)});const Me={...f,element:ke?document.createElement("div"):null},ze=new S.Marker(Me);return ze.setLngLat([f.longitude,f.latitude]),ze.getElement().addEventListener("click",je=>{var Ne,me;(me=(Ne=T.current.props).onClick)===null||me===void 0||me.call(Ne,{type:"click",target:ze,originalEvent:je})}),ze.on("dragstart",je=>{var Ne,me;const Ie=je;Ie.lngLat=k.getLngLat(),(me=(Ne=T.current.props).onDragStart)===null||me===void 0||me.call(Ne,Ie)}),ze.on("drag",je=>{var Ne,me;const Ie=je;Ie.lngLat=k.getLngLat(),(me=(Ne=T.current.props).onDrag)===null||me===void 0||me.call(Ne,Ie)}),ze.on("dragend",je=>{var Ne,me;const Ie=je;Ie.lngLat=k.getLngLat(),(me=(Ne=T.current.props).onDragEnd)===null||me===void 0||me.call(Ne,Ie)}),ze},[]);q.useEffect(()=>(k.addTo(b.getMap()),()=>{k.remove()}),[]);const{longitude:B,latitude:a,offset:W,style:F,draggable:ne=!1,popup:ie=null,rotation:ue=0,rotationAlignment:_e="auto",pitchAlignment:Ee="auto"}=f;return q.useEffect(()=>{Qs(k.getElement(),F)},[F]),q.useImperativeHandle(m,()=>k,[]),(k.getLngLat().lng!==B||k.getLngLat().lat!==a)&&k.setLngLat([B,a]),W&&!Lx(k.getOffset(),W)&&k.setOffset(W),k.isDraggable()!==ne&&k.setDraggable(ne),k.getRotation()!==ue&&k.setRotation(ue),k.getRotationAlignment()!==_e&&k.setRotationAlignment(_e),k.getPitchAlignment()!==Ee&&k.setPitchAlignment(Ee),k.getPopup()!==ie&&k.setPopup(ie),el.createPortal(f.children,k.getElement())}q.memo(q.forwardRef(Wx));function gf(f){return new Set(f?f.trim().split(/\s+/):[])}function Xx(f,m){const{map:b,mapLib:S}=q.useContext(rl),T=q.useMemo(()=>document.createElement("div"),[]),k=q.useRef({props:f});k.current.props=f;const B=q.useMemo(()=>{const a={...f},W=new S.Popup(a);return W.setLngLat([f.longitude,f.latitude]),W.once("open",F=>{var ne,ie;(ie=(ne=k.current.props).onOpen)===null||ie===void 0||ie.call(ne,F)}),W},[]);if(q.useEffect(()=>{const a=W=>{var F,ne;(ne=(F=k.current.props).onClose)===null||ne===void 0||ne.call(F,W)};return B.on("close",a),B.setDOMContent(T).addTo(b.getMap()),()=>{B.off("close",a),B.isOpen()&&B.remove()}},[]),q.useEffect(()=>{Qs(B.getElement(),f.style)},[f.style]),q.useImperativeHandle(m,()=>B,[]),B.isOpen()&&((B.getLngLat().lng!==f.longitude||B.getLngLat().lat!==f.latitude)&&B.setLngLat([f.longitude,f.latitude]),f.offset&&!Bn(B.options.offset,f.offset)&&B.setOffset(f.offset),(B.options.anchor!==f.anchor||B.options.maxWidth!==f.maxWidth)&&(B.options.anchor=f.anchor,B.setMaxWidth(f.maxWidth)),B.options.className!==f.className)){const a=gf(B.options.className),W=gf(f.className);for(const F of a)W.has(F)||B.removeClassName(F);for(const F of W)a.has(F)||B.addClassName(F);B.options.className=f.className}return el.createPortal(f.children,T)}q.memo(q.forwardRef(Xx));function nl(f,m,b,S){const T=q.useContext(rl),k=q.useMemo(()=>f(T),[]);return q.useEffect(()=>{const B=S||b||m,a=typeof m=="function"&&typeof b=="function"?m:null,W=typeof b=="function"?b:typeof m=="function"?m:null,{map:F}=T;return F.hasControl(k)||(F.addControl(k,B?.position),a&&a(T)),()=>{W&&W(T),F.hasControl(k)&&F.removeControl(k)}},[]),k}function Kx(f){const m=nl(({mapLib:b})=>new b.AttributionControl(f),{position:f.position});return q.useEffect(()=>{Qs(m._container,f.style)},[f.style]),null}q.memo(Kx);function Jx(f){const m=nl(({mapLib:b})=>new b.FullscreenControl({container:f.containerId&&document.getElementById(f.containerId)}),{position:f.position});return q.useEffect(()=>{Qs(m._controlContainer,f.style)},[f.style]),null}q.memo(Jx);function Yx(f,m){const b=q.useRef({props:f}),S=nl(({mapLib:T})=>{const k=new T.GeolocateControl(f),B=k._setupUI;return k._setupUI=a=>{k._container.hasChildNodes()||B(a)},k.on("geolocate",a=>{var W,F;(F=(W=b.current.props).onGeolocate)===null||F===void 0||F.call(W,a)}),k.on("error",a=>{var W,F;(F=(W=b.current.props).onError)===null||F===void 0||F.call(W,a)}),k.on("outofmaxbounds",a=>{var W,F;(F=(W=b.current.props).onOutOfMaxBounds)===null||F===void 0||F.call(W,a)}),k.on("trackuserlocationstart",a=>{var W,F;(F=(W=b.current.props).onTrackUserLocationStart)===null||F===void 0||F.call(W,a)}),k.on("trackuserlocationend",a=>{var W,F;(F=(W=b.current.props).onTrackUserLocationEnd)===null||F===void 0||F.call(W,a)}),k},{position:f.position});return b.current.props=f,q.useImperativeHandle(m,()=>S,[]),q.useEffect(()=>{Qs(S._container,f.style)},[f.style]),null}q.memo(q.forwardRef(Yx));function Qx(f){const m=nl(({mapLib:b})=>new b.NavigationControl(f),{position:f.position});return q.useEffect(()=>{Qs(m._container,f.style)},[f.style]),null}q.memo(Qx);function e1(f){const m=nl(({mapLib:k})=>new k.ScaleControl(f),{position:f.position}),b=q.useRef(f),S=b.current;b.current=f;const{style:T}=f;return f.maxWidth!==void 0&&f.maxWidth!==S.maxWidth&&(m.options.maxWidth=f.maxWidth),f.unit!==void 0&&f.unit!==S.unit&&m.setUnit(f.unit),q.useEffect(()=>{Qs(m._container,T)},[T]),null}q.memo(e1);function _f(f,m){if(!f)throw new Error(m)}let t1=0;function i1(f,m,b){if(f.style&&f.style._loaded){const S={...b};return delete S.id,delete S.children,f.addSource(m,S),f.getSource(m)}return null}function r1(f,m,b){_f(m.id===b.id,"source id changed"),_f(m.type===b.type,"source type changed");let S="",T=0;for(const B in m)B!=="children"&&B!=="id"&&!Bn(b[B],m[B])&&(S=B,T++);if(!T)return;const k=m.type;if(k==="geojson")f.setData(m.data);else if(k==="image")f.updateImage({url:m.url,coordinates:m.coordinates});else if("setCoordinates"in f&&T===1&&S==="coordinates")f.setCoordinates(m.coordinates);else if("setUrl"in f)switch(S){case"url":f.setUrl(m.url);break;case"tiles":f.setTiles(m.tiles);break}else console.warn(`Unable to update <Source> prop: ${S}`)}function n1(f){const m=q.useContext(rl).map.getMap(),b=q.useRef(f),[,S]=q.useState(0),T=q.useMemo(()=>f.id||`jsx-source-${t1++}`,[]);q.useEffect(()=>{if(m){const B=()=>setTimeout(()=>S(a=>a+1),0);return m.on("styledata",B),B(),()=>{var a;if(m.off("styledata",B),m.style&&m.style._loaded&&m.getSource(T)){const W=(a=m.getStyle())===null||a===void 0?void 0:a.layers;if(W)for(const F of W)F.source===T&&m.removeLayer(F.id);m.removeSource(T)}}}},[m]);let k=m&&m.style&&m.getSource(T);return k?r1(k,f,b.current):k=i1(m,T,f),b.current=f,k&&q.Children.map(f.children,B=>B&&q.cloneElement(B,{source:T}))||null}const s1=k_(()=>import("./mapbox-gl-bjBPhUos.js").then(f=>f.m),__vite__mapDeps([0,1,2])),a1=q.forwardRef(function(m,b){return Gx(m,b,s1)}),o1=n1;var ym={exports:{}};(function(f,m){(function(b,S){f.exports=S()})(z_,function(){var b,S,T;function k(a,W){if(!b)b=W;else if(!S)S=W;else{var F="var sharedChunk = {}; ("+b+")(sharedChunk); ("+S+")(sharedChunk);",ne={};b(ne),T=W(ne),typeof window<"u"&&(T.workerUrl=window.URL.createObjectURL(new Blob([F],{type:"text/javascript"})))}}k(["exports"],function(a){function W(i,e,r,s){return new(r||(r=Promise))(function(l,h){function p(w){try{v(s.next(w))}catch(I){h(I)}}function g(w){try{v(s.throw(w))}catch(I){h(I)}}function v(w){var I;w.done?l(w.value):(I=w.value,I instanceof r?I:new r(function(A){A(I)})).then(p,g)}v((s=s.apply(i,e||[])).next())})}function F(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}typeof SuppressedError=="function"&&SuppressedError;var ne=ie;function ie(i,e){this.x=i,this.y=e}ie.prototype={clone:function(){return new ie(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,r=i.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),r=Math.sin(i),s=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=s,this},_rotateAround:function(i,e){var r=Math.cos(i),s=Math.sin(i),l=e.y+s*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-s*(this.y-e.y),this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ie.convert=function(i){return i instanceof ie?i:Array.isArray(i)?new ie(i[0],i[1]):i};var ue=F(ne),_e=Ee;function Ee(i,e,r,s){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=r,this.p2y=s}Ee.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,s=0;s<8;s++){var l=this.sampleCurveX(r)-i;if(Math.abs(l)<e)return r;var h=this.sampleCurveDerivativeX(r);if(Math.abs(h)<1e-6)break;r-=l/h}var p=0,g=1;for(r=i,s=0;s<20&&(l=this.sampleCurveX(r),!(Math.abs(l-i)<e));s++)i>l?p=r:g=r,r=.5*(g-p)+p;return r},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};var ke=F(_e);let Me,ze;function je(){return Me==null&&(Me=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Me}function Ne(){if(ze==null&&(ze=!1,je())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let s=0;s<5*5;s++){const l=4*s;e.fillStyle=`rgb(${l},${l+1},${l+2})`,e.fillRect(s%5,Math.floor(s/5),1,1)}const r=e.getImageData(0,0,5,5).data;for(let s=0;s<5*5*4;s++)if(s%4!=3&&r[s]!==s){ze=!0;break}}}return ze||!1}function me(i,e,r,s){const l=new ke(i,e,r,s);return function(h){return l.solve(h)}}const Ie=me(.25,.1,.25,1);function it(i,e,r){return Math.min(r,Math.max(e,i))}function Ye(i,e,r){const s=r-e,l=((i-e)%s+s)%s+e;return l===e?r:l}function Ge(i,...e){for(const r of e)for(const s in r)i[s]=r[s];return i}let at=1;function De(i,e,r){const s={};for(const l in i)s[l]=e.call(r||this,i[l],l,i);return s}function rt(i,e,r){const s={};for(const l in i)e.call(r||this,i[l],l,i)&&(s[l]=i[l]);return s}function xt(i){return Array.isArray(i)?i.map(xt):typeof i=="object"&&i?De(i,xt):i}const Pt={};function gt(i){Pt[i]||(typeof console<"u"&&console.warn(i),Pt[i]=!0)}function At(i,e,r){return(r.y-i.y)*(e.x-i.x)>(e.y-i.y)*(r.x-i.x)}function Bt(i){let e=0;for(let r,s,l=0,h=i.length,p=h-1;l<h;p=l++)r=i[l],s=i[p],e+=(s.x-r.x)*(r.y+s.y);return e}function ft(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let si=null;function Mi(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const Ki="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ai(i,e,r,s,l){return W(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const h=new VideoFrame(i,{timestamp:0});try{const p=h?.format;if(!p||!p.startsWith("BGR")&&!p.startsWith("RGB"))throw new Error(`Unrecognized format ${p}`);const g=p.startsWith("BGR"),v=new Uint8ClampedArray(s*l*4);if(yield h.copyTo(v,function(w,I,A,z,R){const O=4*Math.max(-I,0),j=(Math.max(0,A)-A)*z*4+O,X=4*z,Y=Math.max(0,I),oe=Math.max(0,A);return{rect:{x:Y,y:oe,width:Math.min(w.width,I+z)-Y,height:Math.min(w.height,A+R)-oe},layout:[{offset:j,stride:X}]}}(i,e,r,s,l)),g)for(let w=0;w<v.length;w+=4){const I=v[w];v[w]=v[w+2],v[w+2]=I}return v}finally{h.close()}})}let Kt,Ze,yt,Jt;const Mt={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(i){const e=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(i,e=0){return this.getImageCanvasContext(i).getImageData(-e,-e,i.width+2*e,i.height+2*e)},getImageCanvasContext(i){const e=window.document.createElement("canvas"),r=e.getContext("2d",{willReadFrequently:!0});if(!r)throw new Error("failed to create canvas 2d context");return e.width=i.width,e.height=i.height,r.drawImage(i,0,0,i.width,i.height),r},resolveURL:i=>(yt||(yt=document.createElement("a")),yt.href=i,yt.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Jt==null&&(Jt=matchMedia("(prefers-reduced-motion: reduce)")),Jt.matches)}},Yt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class gi extends Error{constructor(e,r,s,l){super(`AJAXError: ${r} (${e}): ${s}`),this.status=e,this.statusText=r,this.url=s,this.body=l}}const Qt=ft()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,Rt=i=>Yt.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))];function ki(i,e){const r=new AbortController,s=new Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,cache:i.cache,referrer:Qt(),signal:r.signal});let l=!1,h=!1;return i.type==="json"&&s.headers.set("Accept","application/json"),h||fetch(s).then(p=>p.ok?(g=>{(i.type==="arrayBuffer"||i.type==="image"?g.arrayBuffer():i.type==="json"?g.json():g.text()).then(v=>{h||(l=!0,e(null,v,g.headers.get("Cache-Control"),g.headers.get("Expires")))}).catch(v=>{h||e(new Error(v.message))})})(p):p.blob().then(g=>e(new gi(p.status,p.statusText,i.url,g)))).catch(p=>{p.code!==20&&e(new Error(p.message))}),{cancel:()=>{h=!0,l||r.abort()}}}const bi=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){if(ft()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e);if(!ft())return(Rt(i.url)||ki)(i,e)}if(!(/^file:/.test(r=i.url)||/^file:/.test(Qt())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return ki(i,e);if(ft()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var r;return function(s,l){const h=new XMLHttpRequest;h.open(s.method||"GET",s.url,!0),s.type!=="arrayBuffer"&&s.type!=="image"||(h.responseType="arraybuffer");for(const p in s.headers)h.setRequestHeader(p,s.headers[p]);return s.type==="json"&&(h.responseType="text",h.setRequestHeader("Accept","application/json")),h.withCredentials=s.credentials==="include",h.onerror=()=>{l(new Error(h.statusText))},h.onload=()=>{if((h.status>=200&&h.status<300||h.status===0)&&h.response!==null){let p=h.response;if(s.type==="json")try{p=JSON.parse(h.response)}catch(g){return l(g)}l(null,p,h.getResponseHeader("Cache-Control"),h.getResponseHeader("Expires"))}else{const p=new Blob([h.response],{type:h.getResponseHeader("Content-Type")});l(new gi(h.status,h.statusText,s.url,p))}},h.send(s.body),{cancel:()=>h.abort()}}(i,e)},Xt=function(i,e){return bi(Ge(i,{type:"arrayBuffer"}),e)};function Ti(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const e=new URL(i),r=window.location;return e.protocol===r.protocol&&e.host===r.host}function nr(i,e,r){r[i]&&r[i].indexOf(e)!==-1||(r[i]=r[i]||[],r[i].push(e))}function fr(i,e,r){if(r&&r[i]){const s=r[i].indexOf(e);s!==-1&&r[i].splice(s,1)}}class sr{constructor(e,r={}){Ge(this,r),this.type=e}}class mr extends sr{constructor(e,r={}){super("error",Ge({error:e},r))}}class Cr{on(e,r){return this._listeners=this._listeners||{},nr(e,r,this._listeners),this}off(e,r){return fr(e,r,this._listeners),fr(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},nr(e,r,this._oneTimeListeners),this):new Promise(s=>this.once(e,s))}fire(e,r){typeof e=="string"&&(e=new sr(e,r||{}));const s=e.type;if(this.listens(s)){e.target=this;const l=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const g of l)g.call(this,e);const h=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const g of h)fr(s,g,this._oneTimeListeners),g.call(this,e);const p=this._eventedParent;p&&(Ge(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(e))}else e instanceof mr&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var ge={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Ii=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function ji(i,e){const r={};for(const s in i)s!=="ref"&&(r[s]=i[s]);return Ii.forEach(s=>{s in e&&(r[s]=e[s])}),r}function jt(i,e){if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let r=0;r<i.length;r++)if(!jt(i[r],e[r]))return!1;return!0}if(typeof i=="object"&&i!==null&&e!==null){if(typeof e!="object"||Object.keys(i).length!==Object.keys(e).length)return!1;for(const r in i)if(!jt(i[r],e[r]))return!1;return!0}return i===e}const kt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function qi(i,e,r){r.push({command:kt.addSource,args:[i,e[i]]})}function Ji(i,e,r){e.push({command:kt.removeSource,args:[i]}),r[i]=!0}function ar(i,e,r,s){Ji(i,r,s),qi(i,e,r)}function Tn(i,e,r){let s;for(s in i[r])if(Object.prototype.hasOwnProperty.call(i[r],s)&&s!=="data"&&!jt(i[r][s],e[r][s]))return!1;for(s in e[r])if(Object.prototype.hasOwnProperty.call(e[r],s)&&s!=="data"&&!jt(i[r][s],e[r][s]))return!1;return!0}function In(i,e,r,s,l,h){let p;for(p in e=e||{},i=i||{})Object.prototype.hasOwnProperty.call(i,p)&&(jt(i[p],e[p])||r.push({command:h,args:[s,p,e[p],l]}));for(p in e)Object.prototype.hasOwnProperty.call(e,p)&&!Object.prototype.hasOwnProperty.call(i,p)&&(jt(i[p],e[p])||r.push({command:h,args:[s,p,e[p],l]}))}function en(i){return i.id}function En(i,e){return i[e.id]=e,i}class Re{constructor(e,r,s,l){this.message=(e?`${e}: `:"")+s,l&&(this.identifier=l),r!=null&&r.__line__&&(this.line=r.__line__)}}function mt(i,...e){for(const r of e)for(const s in r)i[s]=r[s];return i}class dt extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class qt{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[s,l]of r)this.bindings[s]=l}concat(e){return new qt(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const wt={kind:"null"},Te={kind:"number"},ot={kind:"string"},ct={kind:"boolean"},_i={kind:"color"},Vi={kind:"object"},vt={kind:"value"},hn={kind:"collator"},Z={kind:"formatted"},M={kind:"padding"},D={kind:"resolvedImage"},$={kind:"variableAnchorOffsetCollection"};function H(i,e){return{kind:"array",itemType:i,N:e}}function K(i){if(i.kind==="array"){const e=K(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const le=[wt,Te,ot,ct,_i,Z,Vi,H(vt),M,D,$];function te(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!te(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const r of le)if(!te(r,e))return null}}return`Expected ${K(i)} but found ${K(e)} instead.`}function Q(i,e){return e.some(r=>r.kind===i.kind)}function ae(i,e){return e.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}function ve(i,e){return i.kind==="array"&&e.kind==="array"?i.itemType.kind===e.itemType.kind&&typeof i.N=="number":i.kind===e.kind}const xe=.96422,Se=.82521,nt=4/29,pt=6/29,Xe=3*pt*pt,lt=pt*pt*pt,_t=Math.PI/180,Vt=180/Math.PI;function Ht(i){return(i%=360)<0&&(i+=360),i}function Ft([i,e,r,s]){let l,h;const p=Yi((.2225045*(i=Lt(i))+.7168786*(e=Lt(e))+.0606169*(r=Lt(r)))/1);i===e&&e===r?l=h=p:(l=Yi((.4360747*i+.3850649*e+.1430804*r)/xe),h=Yi((.0139322*i+.0971045*e+.7141733*r)/Se));const g=116*p-16;return[g<0?0:g,500*(l-p),200*(p-h),s]}function Lt(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Yi(i){return i>lt?Math.pow(i,1/3):i/Xe+nt}function ei([i,e,r,s]){let l=(i+16)/116,h=isNaN(e)?l:l+e/500,p=isNaN(r)?l:l-r/200;return l=1*Zi(l),h=xe*Zi(h),p=Se*Zi(p),[Ei(3.1338561*h-1.6168667*l-.4906146*p),Ei(-.9787684*h+1.9161415*l+.033454*p),Ei(.0719453*h-.2289914*l+1.4052427*p),s]}function Ei(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function Zi(i){return i>pt?i*i*i:Xe*(i-nt)}function Fr(i){return parseInt(i.padEnd(2,i),16)/255}function sl(i,e){return rs(e?i/100:i,0,1)}function rs(i,e,r){return Math.min(Math.max(e,i),r)}function ns(i){return!i.some(Number.isNaN)}const Bc={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Zt{constructor(e,r,s,l=1,h=!0){this.r=e,this.g=r,this.b=s,this.a=l,h||(this.r*=l,this.g*=l,this.b*=l,l||this.overwriteGetter("rgb",[e,r,s,l]))}static parse(e){if(e instanceof Zt)return e;if(typeof e!="string")return;const r=function(s){if((s=s.toLowerCase().trim())==="transparent")return[0,0,0,0];const l=Bc[s];if(l){const[p,g,v]=l;return[p/255,g/255,v/255,1]}if(s.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(s)){const p=s.length<6?1:2;let g=1;return[Fr(s.slice(g,g+=p)),Fr(s.slice(g,g+=p)),Fr(s.slice(g,g+=p)),Fr(s.slice(g,g+p)||"ff")]}if(s.startsWith("rgb")){const p=s.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(p){const[g,v,w,I,A,z,R,O,j,X,Y,oe]=p,ee=[I||" ",R||" ",X].join("");if(ee==="  "||ee==="  /"||ee===",,"||ee===",,,"){const ce=[w,z,j].join(""),de=ce==="%%%"?100:ce===""?255:0;if(de){const we=[rs(+v/de,0,1),rs(+A/de,0,1),rs(+O/de,0,1),Y?sl(+Y,oe):1];if(ns(we))return we}}return}}const h=s.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(h){const[p,g,v,w,I,A,z,R,O]=h,j=[v||" ",I||" ",z].join("");if(j==="  "||j==="  /"||j===",,"||j===",,,"){const X=[+g,rs(+w,0,100),rs(+A,0,100),R?sl(+R,O):1];if(ns(X))return function([Y,oe,ee,ce]){function de(we){const qe=(we+Y/30)%12,Je=oe*Math.min(ee,1-ee);return ee-Je*Math.max(-1,Math.min(qe-3,9-qe,1))}return Y=Ht(Y),oe/=100,ee/=100,[de(0),de(8),de(4),ce]}(X)}}}(e);return r?new Zt(...r,!1):void 0}get rgb(){const{r:e,g:r,b:s,a:l}=this,h=l||1/0;return this.overwriteGetter("rgb",[e/h,r/h,s/h,l])}get hcl(){return this.overwriteGetter("hcl",function(e){const[r,s,l,h]=Ft(e),p=Math.sqrt(s*s+l*l);return[Math.round(1e4*p)?Ht(Math.atan2(l,s)*Vt):NaN,p,r,h]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Ft(this.rgb))}overwriteGetter(e,r){return Object.defineProperty(this,e,{value:r}),r}toString(){const[e,r,s,l]=this.rgb;return`rgba(${[e,r,s].map(h=>Math.round(255*h)).join(",")},${l})`}}Zt.black=new Zt(0,0,0,1),Zt.white=new Zt(1,1,1,1),Zt.transparent=new Zt(0,0,0,0),Zt.red=new Zt(1,0,0,1);class qa{constructor(e,r,s){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ea{constructor(e,r,s,l,h){this.text=e,this.image=r,this.scale=s,this.fontStack=l,this.textColor=h}}class Qi{constructor(e){this.sections=e}static fromString(e){return new Qi([new ea(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Qi?e:Qi.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class Tr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Tr)return e;if(typeof e=="number")return new Tr([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const r of e)if(typeof r!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new Tr(e)}}toString(){return JSON.stringify(this.values)}}const Oc=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Br{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Br)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let r=0;r<e.length;r+=2){const s=e[r],l=e[r+1];if(typeof s!="string"||!Oc.has(s)||!Array.isArray(l)||l.length!==2||typeof l[0]!="number"||typeof l[1]!="number")return}return new Br(e)}}toString(){return JSON.stringify(this.values)}}class Gi{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Gi({name:e,available:!1}):null}}function ta(i,e,r,s){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[i,e,r,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[i,e,r,s]:[i,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ss(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Zt||i instanceof qa||i instanceof Qi||i instanceof Tr||i instanceof Br||i instanceof Gi)return!0;if(Array.isArray(i)){for(const e of i)if(!ss(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!ss(i[e]))return!1;return!0}return!1}function ci(i){if(i===null)return wt;if(typeof i=="string")return ot;if(typeof i=="boolean")return ct;if(typeof i=="number")return Te;if(i instanceof Zt)return _i;if(i instanceof qa)return hn;if(i instanceof Qi)return Z;if(i instanceof Tr)return M;if(i instanceof Br)return $;if(i instanceof Gi)return D;if(Array.isArray(i)){const e=i.length;let r;for(const s of i){const l=ci(s);if(r){if(r===l)continue;r=vt;break}r=l}return H(r||vt,e)}return Vi}function Ot(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof Zt||i instanceof Qi||i instanceof Tr||i instanceof Br||i instanceof Gi?i.toString():JSON.stringify(i)}class Nn{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ss(e[1]))return r.error("invalid value");const s=e[1];let l=ci(s);const h=r.expectedType;return l.kind!=="array"||l.N!==0||!h||h.kind!=="array"||typeof h.N=="number"&&h.N!==0||(l=h),new Nn(l,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class pi{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const ia={string:ot,number:Te,boolean:ct,object:Vi};class Or{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let s,l=1;const h=e[0];if(h==="array"){let g,v;if(e.length>2){const w=e[1];if(typeof w!="string"||!(w in ia)||w==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);g=ia[w],l++}else g=vt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);v=e[2],l++}s=H(g,v)}else{if(!ia[h])throw new Error(`Types doesn't contain name = ${h}`);s=ia[h]}const p=[];for(;l<e.length;l++){const g=r.parse(e[l],l,vt);if(!g)return null;p.push(g)}return new Or(s,p)}evaluate(e){for(let r=0;r<this.args.length;r++){const s=this.args[r].evaluate(e);if(!te(this.type,ci(s)))return s;if(r===this.args.length-1)throw new pi(`Expected value to be of type ${K(this.type)}, but found ${K(ci(s))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Za={"to-boolean":ct,"to-color":_i,"to-number":Te,"to-string":ot};class Pn{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const s=e[0];if(!Za[s])throw new Error(`Can't parse ${s} as it is not part of the known types`);if((s==="to-boolean"||s==="to-string")&&e.length!==2)return r.error("Expected one argument.");const l=Za[s],h=[];for(let p=1;p<e.length;p++){const g=r.parse(e[p],p,vt);if(!g)return null;h.push(g)}return new Pn(l,h)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let r,s;for(const l of this.args){if(r=l.evaluate(e),s=null,r instanceof Zt)return r;if(typeof r=="string"){const h=e.parseColor(r);if(h)return h}else if(Array.isArray(r)&&(s=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:ta(r[0],r[1],r[2],r[3]),!s))return new Zt(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new pi(s||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const s of this.args){r=s.evaluate(e);const l=Tr.parse(r);if(l)return l}throw new pi(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const s of this.args){r=s.evaluate(e);const l=Br.parse(r);if(l)return l}throw new pi(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const s of this.args){if(r=s.evaluate(e),r===null)return 0;const l=Number(r);if(!isNaN(l))return l}throw new pi(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return Qi.fromString(Ot(this.args[0].evaluate(e)));case"resolvedImage":return Gi.fromString(Ot(this.args[0].evaluate(e)));default:return Ot(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const al=["Unknown","Point","LineString","Polygon"];class Ga{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?al[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=Zt.parse(e)),r}}class ra{constructor(e,r,s=[],l,h=new qt,p=[]){this.registry=e,this.path=s,this.key=s.map(g=>`[${g}]`).join(""),this.scope=h,this.errors=p,this.expectedType=l,this._isConstant=r}parse(e,r,s,l,h={}){return r?this.concat(r,s,l)._parse(e,h):this._parse(e,h)}_parse(e,r){function s(l,h,p){return p==="assert"?new Or(h,[l]):p==="coerce"?new Pn(h,[l]):l}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const l=e[0];if(typeof l!="string")return this.error(`Expression name must be a string, but found ${typeof l} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const h=this.registry[l];if(h){let p=h.parse(e,this);if(!p)return null;if(this.expectedType){const g=this.expectedType,v=p.type;if(g.kind!=="string"&&g.kind!=="number"&&g.kind!=="boolean"&&g.kind!=="object"&&g.kind!=="array"||v.kind!=="value")if(g.kind!=="color"&&g.kind!=="formatted"&&g.kind!=="resolvedImage"||v.kind!=="value"&&v.kind!=="string")if(g.kind!=="padding"||v.kind!=="value"&&v.kind!=="number"&&v.kind!=="array")if(g.kind!=="variableAnchorOffsetCollection"||v.kind!=="value"&&v.kind!=="array"){if(this.checkSubtype(g,v))return null}else p=s(p,g,r.typeAnnotation||"coerce");else p=s(p,g,r.typeAnnotation||"coerce");else p=s(p,g,r.typeAnnotation||"coerce");else p=s(p,g,r.typeAnnotation||"assert")}if(!(p instanceof Nn)&&p.type.kind!=="resolvedImage"&&this._isConstant(p)){const g=new Ga;try{p=new Nn(p.type,p.evaluate(g))}catch(v){return this.error(v.message),null}}return p}return this.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,s){const l=typeof e=="number"?this.path.concat(e):this.path,h=s?this.scope.concat(s):this.scope;return new ra(this.registry,this._isConstant,l,r||null,h,this.errors)}error(e,...r){const s=`${this.key}${r.map(l=>`[${l}]`).join("")}`;this.errors.push(new dt(s,e))}checkSubtype(e,r){const s=te(e,r);return s&&this.error(s),s}}class na{constructor(e,r,s){this.type=hn,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const s=e[1];if(typeof s!="object"||Array.isArray(s))return r.error("Collator options argument must be an object.");const l=r.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,ct);if(!l)return null;const h=r.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,ct);if(!h)return null;let p=null;return s.locale&&(p=r.parse(s.locale,1,ot),!p)?null:new na(l,h,p)}evaluate(e){return new qa(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}const An=8192;function Ha(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function As(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function ol(i,e){const r=(180+i[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,l=Math.pow(2,e.z);return[Math.round(r*l*An),Math.round(s*l*An)]}function $c(i,e,r){const s=i[0]-e[0],l=i[1]-e[1],h=i[0]-r[0],p=i[1]-r[1];return s*p-h*l==0&&s*h<=0&&l*p<=0}function Wa(i,e){let r=!1;for(let p=0,g=e.length;p<g;p++){const v=e[p];for(let w=0,I=v.length;w<I-1;w++){if($c(i,v[w],v[w+1]))return!1;(l=v[w])[1]>(s=i)[1]!=(h=v[w+1])[1]>s[1]&&s[0]<(h[0]-l[0])*(s[1]-l[1])/(h[1]-l[1])+l[0]&&(r=!r)}}var s,l,h;return r}function Xa(i,e){for(let r=0;r<e.length;r++)if(Wa(i,e[r]))return!0;return!1}function ll(i,e,r,s){const l=s[0]-r[0],h=s[1]-r[1],p=(i[0]-r[0])*h-l*(i[1]-r[1]),g=(e[0]-r[0])*h-l*(e[1]-r[1]);return p>0&&g<0||p<0&&g>0}function Nc(i,e,r){for(const w of r)for(let I=0;I<w.length-1;++I)if((g=[(p=w[I+1])[0]-(h=w[I])[0],p[1]-h[1]])[0]*(v=[(l=e)[0]-(s=i)[0],l[1]-s[1]])[1]-g[1]*v[0]!=0&&ll(s,l,h,p)&&ll(h,p,s,l))return!0;var s,l,h,p,g,v;return!1}function cl(i,e){for(let r=0;r<i.length;++r)if(!Wa(i[r],e))return!1;for(let r=0;r<i.length-1;++r)if(Nc(i[r],i[r+1],e))return!1;return!0}function ul(i,e){for(let r=0;r<e.length;r++)if(cl(i,e[r]))return!0;return!1}function sa(i,e,r){const s=[];for(let l=0;l<i.length;l++){const h=[];for(let p=0;p<i[l].length;p++){const g=ol(i[l][p],r);Ha(e,g),h.push(g)}s.push(h)}return s}function hl(i,e,r){const s=[];for(let l=0;l<i.length;l++){const h=sa(i[l],e,r);s.push(h)}return s}function dl(i,e,r,s){if(i[0]<r[0]||i[0]>r[2]){const l=.5*s;let h=i[0]-r[0]>l?-s:r[0]-i[0]>l?s:0;h===0&&(h=i[0]-r[2]>l?-s:r[2]-i[0]>l?s:0),i[0]+=h}Ha(e,i)}function Ka(i,e,r,s){const l=Math.pow(2,s.z)*An,h=[s.x*An,s.y*An],p=[];for(const g of i)for(const v of g){const w=[v.x+h[0],v.y+h[1]];dl(w,e,r,l),p.push(w)}return p}function Ja(i,e,r,s){const l=Math.pow(2,s.z)*An,h=[s.x*An,s.y*An],p=[];for(const v of i){const w=[];for(const I of v){const A=[I.x+h[0],I.y+h[1]];Ha(e,A),w.push(A)}p.push(w)}if(e[2]-e[0]<=l/2){(g=e)[0]=g[1]=1/0,g[2]=g[3]=-1/0;for(const v of p)for(const w of v)dl(w,e,r,l)}var g;return p}class jn{constructor(e,r){this.type=ct,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ss(e[1])){const s=e[1];if(s.type==="FeatureCollection")for(let l=0;l<s.features.length;++l){const h=s.features[l].geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new jn(s,s.features[l].geometry)}else if(s.type==="Feature"){const l=s.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new jn(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new jn(s,s)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,s){const l=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],p=r.canonicalID();if(s.type==="Polygon"){const g=sa(s.coordinates,h,p),v=Ka(r.geometry(),l,h,p);if(!As(l,h))return!1;for(const w of v)if(!Wa(w,g))return!1}if(s.type==="MultiPolygon"){const g=hl(s.coordinates,h,p),v=Ka(r.geometry(),l,h,p);if(!As(l,h))return!1;for(const w of v)if(!Xa(w,g))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,s){const l=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],p=r.canonicalID();if(s.type==="Polygon"){const g=sa(s.coordinates,h,p),v=Ja(r.geometry(),l,h,p);if(!As(l,h))return!1;for(const w of v)if(!cl(w,g))return!1}if(s.type==="MultiPolygon"){const g=hl(s.coordinates,h,p),v=Ja(r.geometry(),l,h,p);if(!As(l,h))return!1;for(const w of v)if(!ul(w,g))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class aa{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const s=e[1];return r.scope.has(s)?new aa(s,r.scope.get(s)):r.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class $r{constructor(e,r,s,l){this.name=e,this.type=r,this._evaluate=s,this.args=l}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,r){const s=e[0],l=$r.definitions[s];if(!l)return r.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const h=Array.isArray(l)?l[0]:l.type,p=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,g=p.filter(([w])=>!Array.isArray(w)||w.length===e.length-1);let v=null;for(const[w,I]of g){v=new ra(r.registry,oa,r.path,null,r.scope);const A=[];let z=!1;for(let R=1;R<e.length;R++){const O=e[R],j=Array.isArray(w)?w[R-1]:w.type,X=v.parse(O,1+A.length,j);if(!X){z=!0;break}A.push(X)}if(!z)if(Array.isArray(w)&&w.length!==A.length)v.error(`Expected ${w.length} arguments, but found ${A.length} instead.`);else{for(let R=0;R<A.length;R++){const O=Array.isArray(w)?w[R]:w.type,j=A[R];v.concat(R+1).checkSubtype(O,j.type)}if(v.errors.length===0)return new $r(s,h,I,A)}}if(g.length===1)r.errors.push(...v.errors);else{const w=(g.length?g:p).map(([A])=>{return z=A,Array.isArray(z)?`(${z.map(K).join(", ")})`:`(${K(z.type)}...)`;var z}).join(" | "),I=[];for(let A=1;A<e.length;A++){const z=r.parse(e[A],1+I.length);if(!z)return null;I.push(K(z.type))}r.error(`Expected arguments of type ${w}, but found (${I.join(", ")}) instead.`)}return null}static register(e,r){$r.definitions=r;for(const s in r)e[s]=$r}}function oa(i){if(i instanceof aa)return oa(i.boundExpression);if(i instanceof $r&&i.name==="error"||i instanceof na||i instanceof jn)return!1;const e=i instanceof Pn||i instanceof Or;let r=!0;return i.eachChild(s=>{r=e?r&&oa(s):r&&s instanceof Nn}),!!r&&la(i)&&ca(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function la(i){if(i instanceof $r&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof jn)return!1;let e=!0;return i.eachChild(r=>{e&&!la(r)&&(e=!1)}),e}function Ms(i){if(i instanceof $r&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(r=>{e&&!Ms(r)&&(e=!1)}),e}function ca(i,e){if(i instanceof $r&&e.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(s=>{r&&!ca(s,e)&&(r=!1)}),r}function as(i,e){const r=i.length-1;let s,l,h=0,p=r,g=0;for(;h<=p;)if(g=Math.floor((h+p)/2),s=i[g],l=i[g+1],s<=e){if(g===r||e<l)return g;h=g+1}else{if(!(s>e))throw new pi("Input is not a number.");p=g-1}return 0}class Mn{constructor(e,r,s){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[l,h]of s)this.labels.push(l),this.outputs.push(h)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const s=r.parse(e[1],1,Te);if(!s)return null;const l=[];let h=null;r.expectedType&&r.expectedType.kind!=="value"&&(h=r.expectedType);for(let p=1;p<e.length;p+=2){const g=p===1?-1/0:e[p],v=e[p+1],w=p,I=p+1;if(typeof g!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',w);if(l.length&&l[l.length-1][0]>=g)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',w);const A=r.parse(v,I,h);if(!A)return null;h=h||A.type,l.push([g,A])}return new Mn(h,s,l)}evaluate(e){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(e);const l=this.input.evaluate(e);if(l<=r[0])return s[0].evaluate(e);const h=r.length;return l>=r[h-1]?s[h-1].evaluate(e):s[as(r,l)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function zt(i,e,r){return i+r*(e-i)}function ua(i,e,r){return i.map((s,l)=>zt(s,e[l],r))}const Ir={number:zt,color:function(i,e,r,s="rgb"){switch(s){case"rgb":{const[l,h,p,g]=ua(i.rgb,e.rgb,r);return new Zt(l,h,p,g,!1)}case"hcl":{const[l,h,p,g]=i.hcl,[v,w,I,A]=e.hcl;let z,R;if(isNaN(l)||isNaN(v))isNaN(l)?isNaN(v)?z=NaN:(z=v,p!==1&&p!==0||(R=w)):(z=l,I!==1&&I!==0||(R=h));else{let oe=v-l;v>l&&oe>180?oe-=360:v<l&&l-v>180&&(oe+=360),z=l+r*oe}const[O,j,X,Y]=function([oe,ee,ce,de]){return oe=isNaN(oe)?0:oe*_t,ei([ce,Math.cos(oe)*ee,Math.sin(oe)*ee,de])}([z,R??zt(h,w,r),zt(p,I,r),zt(g,A,r)]);return new Zt(O,j,X,Y,!1)}case"lab":{const[l,h,p,g]=ei(ua(i.lab,e.lab,r));return new Zt(l,h,p,g,!1)}}},array:ua,padding:function(i,e,r){return new Tr(ua(i.values,e.values,r))},variableAnchorOffsetCollection:function(i,e,r){const s=i.values,l=e.values;if(s.length!==l.length)throw new pi(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${e.toString()}`);const h=[];for(let p=0;p<s.length;p+=2){if(s[p]!==l[p])throw new pi(`Cannot interpolate values containing mismatched anchors. from[${p}]: ${s[p]}, to[${p}]: ${l[p]}`);h.push(s[p]);const[g,v]=s[p+1],[w,I]=l[p+1];h.push([zt(g,w,r),zt(v,I,r)])}return new Br(h)}};class Er{constructor(e,r,s,l,h){this.type=e,this.operator=r,this.interpolation=s,this.input=l,this.labels=[],this.outputs=[];for(const[p,g]of h)this.labels.push(p),this.outputs.push(g)}static interpolationFactor(e,r,s,l){let h=0;if(e.name==="exponential")h=Ya(r,e.base,s,l);else if(e.name==="linear")h=Ya(r,1,s,l);else if(e.name==="cubic-bezier"){const p=e.controlPoints;h=new ke(p[0],p[1],p[2],p[3]).solve(Ya(r,1,s,l))}return h}static parse(e,r){let[s,l,h,...p]=e;if(!Array.isArray(l)||l.length===0)return r.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){const w=l[1];if(typeof w!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:w}}else{if(l[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(l[0])}`,1,0);{const w=l.slice(1);if(w.length!==4||w.some(I=>typeof I!="number"||I<0||I>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:w}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(h=r.parse(h,2,Te),!h)return null;const g=[];let v=null;s==="interpolate-hcl"||s==="interpolate-lab"?v=_i:r.expectedType&&r.expectedType.kind!=="value"&&(v=r.expectedType);for(let w=0;w<p.length;w+=2){const I=p[w],A=p[w+1],z=w+3,R=w+4;if(typeof I!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(g.length&&g[g.length-1][0]>=I)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',z);const O=r.parse(A,R,v);if(!O)return null;v=v||O.type,g.push([I,O])}return ve(v,Te)||ve(v,_i)||ve(v,M)||ve(v,$)||ve(v,H(Te))?new Er(v,s,l,h,g):r.error(`Type ${K(v)} is not interpolatable.`)}evaluate(e){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(e);const l=this.input.evaluate(e);if(l<=r[0])return s[0].evaluate(e);const h=r.length;if(l>=r[h-1])return s[h-1].evaluate(e);const p=as(r,l),g=Er.interpolationFactor(this.interpolation,l,r[p],r[p+1]),v=s[p].evaluate(e),w=s[p+1].evaluate(e);switch(this.operator){case"interpolate":return Ir[this.type.kind](v,w,g);case"interpolate-hcl":return Ir.color(v,w,g,"hcl");case"interpolate-lab":return Ir.color(v,w,g,"lab")}}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Ya(i,e,r,s){const l=s-r,h=i-r;return l===0?0:e===1?h/l:(Math.pow(e,h)-1)/(Math.pow(e,l)-1)}class ha{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let s=null;const l=r.expectedType;l&&l.kind!=="value"&&(s=l);const h=[];for(const g of e.slice(1)){const v=r.parse(g,1+h.length,s,void 0,{typeAnnotation:"omit"});if(!v)return null;s=s||v.type,h.push(v)}if(!s)throw new Error("No output type");const p=l&&h.some(g=>te(l,g.type));return new ha(p?vt:s,h)}evaluate(e){let r,s=null,l=0;for(const h of this.args)if(l++,s=h.evaluate(e),s&&s instanceof Gi&&!s.available&&(r||(r=s.name),s=null,l===this.args.length&&(s=r)),s!==null)break;return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class da{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let h=1;h<e.length-1;h+=2){const p=e[h];if(typeof p!="string")return r.error(`Expected string, but found ${typeof p} instead.`,h);if(/[^a-zA-Z0-9_]/.test(p))return r.error("Variable names must contain only alphanumeric characters or '_'.",h);const g=r.parse(e[h+1],h+1);if(!g)return null;s.push([p,g])}const l=r.parse(e[e.length-1],e.length-1,r.expectedType,s);return l?new da(s,l):null}outputDefined(){return this.result.outputDefined()}}class Qa{constructor(e,r,s){this.type=e,this.index=r,this.input=s}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,Te),l=r.parse(e[2],2,H(r.expectedType||vt));return s&&l?new Qa(l.type.itemType,s,l):null}evaluate(e){const r=this.index.evaluate(e),s=this.input.evaluate(e);if(r<0)throw new pi(`Array index out of bounds: ${r} < 0.`);if(r>=s.length)throw new pi(`Array index out of bounds: ${r} > ${s.length-1}.`);if(r!==Math.floor(r))throw new pi(`Array index must be an integer, but found ${r} instead.`);return s[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class eo{constructor(e,r){this.type=ct,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,vt),l=r.parse(e[2],2,vt);return s&&l?Q(s.type,[ct,ot,Te,wt,vt])?new eo(s,l):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${K(s.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!s)return!1;if(!ae(r,["boolean","string","number","null"]))throw new pi(`Expected first argument to be of type boolean, string, number or null, but found ${K(ci(r))} instead.`);if(!ae(s,["string","array"]))throw new pi(`Expected second argument to be of type array or string, but found ${K(ci(s))} instead.`);return s.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class pa{constructor(e,r,s){this.type=Te,this.needle=e,this.haystack=r,this.fromIndex=s}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,vt),l=r.parse(e[2],2,vt);if(!s||!l)return null;if(!Q(s.type,[ct,ot,Te,wt,vt]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${K(s.type)} instead`);if(e.length===4){const h=r.parse(e[3],3,Te);return h?new pa(s,l,h):null}return new pa(s,l)}evaluate(e){const r=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!ae(r,["boolean","string","number","null"]))throw new pi(`Expected first argument to be of type boolean, string, number or null, but found ${K(ci(r))} instead.`);if(!ae(s,["string","array"]))throw new pi(`Expected second argument to be of type array or string, but found ${K(ci(s))} instead.`);if(this.fromIndex){const l=this.fromIndex.evaluate(e);return s.indexOf(r,l)}return s.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class to{constructor(e,r,s,l,h,p){this.inputType=e,this.type=r,this.input=s,this.cases=l,this.outputs=h,this.otherwise=p}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let s,l;r.expectedType&&r.expectedType.kind!=="value"&&(l=r.expectedType);const h={},p=[];for(let w=2;w<e.length-1;w+=2){let I=e[w];const A=e[w+1];Array.isArray(I)||(I=[I]);const z=r.concat(w);if(I.length===0)return z.error("Expected at least one branch label.");for(const O of I){if(typeof O!="number"&&typeof O!="string")return z.error("Branch labels must be numbers or strings.");if(typeof O=="number"&&Math.abs(O)>Number.MAX_SAFE_INTEGER)return z.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof O=="number"&&Math.floor(O)!==O)return z.error("Numeric branch labels must be integer values.");if(s){if(z.checkSubtype(s,ci(O)))return null}else s=ci(O);if(h[String(O)]!==void 0)return z.error("Branch labels must be unique.");h[String(O)]=p.length}const R=r.parse(A,w,l);if(!R)return null;l=l||R.type,p.push(R)}const g=r.parse(e[1],1,vt);if(!g)return null;const v=r.parse(e[e.length-1],e.length-1,l);return v?g.type.kind!=="value"&&r.concat(1).checkSubtype(s,g.type)?null:new to(s,l,g,h,p,v):null}evaluate(e){const r=this.input.evaluate(e);return(ci(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class io{constructor(e,r,s){this.type=e,this.branches=r,this.otherwise=s}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let s;r.expectedType&&r.expectedType.kind!=="value"&&(s=r.expectedType);const l=[];for(let p=1;p<e.length-1;p+=2){const g=r.parse(e[p],p,ct);if(!g)return null;const v=r.parse(e[p+1],p+1,s);if(!v)return null;l.push([g,v]),s=s||v.type}const h=r.parse(e[e.length-1],e.length-1,s);if(!h)return null;if(!s)throw new Error("Can't infer output type");return new io(s,l,h)}evaluate(e){for(const[r,s]of this.branches)if(r.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,s]of this.branches)e(r),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class fa{constructor(e,r,s,l){this.type=e,this.input=r,this.beginIndex=s,this.endIndex=l}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,vt),l=r.parse(e[2],2,Te);if(!s||!l)return null;if(!Q(s.type,[H(vt),ot,vt]))return r.error(`Expected first argument to be of type array or string, but found ${K(s.type)} instead`);if(e.length===4){const h=r.parse(e[3],3,Te);return h?new fa(s.type,s,l,h):null}return new fa(s.type,s,l)}evaluate(e){const r=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!ae(r,["string","array"]))throw new pi(`Expected first argument to be of type array or string, but found ${K(ci(r))} instead.`);if(this.endIndex){const l=this.endIndex.evaluate(e);return r.slice(s,l)}return r.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function pl(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function fl(i,e,r,s){return s.compare(e,r)===0}function os(i,e,r){const s=i!=="=="&&i!=="!=";return class vm{constructor(h,p,g){this.type=ct,this.lhs=h,this.rhs=p,this.collator=g,this.hasUntypedArgument=h.type.kind==="value"||p.type.kind==="value"}static parse(h,p){if(h.length!==3&&h.length!==4)return p.error("Expected two or three arguments.");const g=h[0];let v=p.parse(h[1],1,vt);if(!v)return null;if(!pl(g,v.type))return p.concat(1).error(`"${g}" comparisons are not supported for type '${K(v.type)}'.`);let w=p.parse(h[2],2,vt);if(!w)return null;if(!pl(g,w.type))return p.concat(2).error(`"${g}" comparisons are not supported for type '${K(w.type)}'.`);if(v.type.kind!==w.type.kind&&v.type.kind!=="value"&&w.type.kind!=="value")return p.error(`Cannot compare types '${K(v.type)}' and '${K(w.type)}'.`);s&&(v.type.kind==="value"&&w.type.kind!=="value"?v=new Or(w.type,[v]):v.type.kind!=="value"&&w.type.kind==="value"&&(w=new Or(v.type,[w])));let I=null;if(h.length===4){if(v.type.kind!=="string"&&w.type.kind!=="string"&&v.type.kind!=="value"&&w.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(I=p.parse(h[3],3,hn),!I)return null}return new vm(v,w,I)}evaluate(h){const p=this.lhs.evaluate(h),g=this.rhs.evaluate(h);if(s&&this.hasUntypedArgument){const v=ci(p),w=ci(g);if(v.kind!==w.kind||v.kind!=="string"&&v.kind!=="number")throw new pi(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${v.kind}, ${w.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const v=ci(p),w=ci(g);if(v.kind!=="string"||w.kind!=="string")return e(h,p,g)}return this.collator?r(h,p,g,this.collator.evaluate(h)):e(h,p,g)}eachChild(h){h(this.lhs),h(this.rhs),this.collator&&h(this.collator)}outputDefined(){return!0}}}const jc=os("==",function(i,e,r){return e===r},fl),Vc=os("!=",function(i,e,r){return e!==r},function(i,e,r,s){return!fl(0,e,r,s)}),Uc=os("<",function(i,e,r){return e<r},function(i,e,r,s){return s.compare(e,r)<0}),qc=os(">",function(i,e,r){return e>r},function(i,e,r,s){return s.compare(e,r)>0}),Zc=os("<=",function(i,e,r){return e<=r},function(i,e,r,s){return s.compare(e,r)<=0}),Gc=os(">=",function(i,e,r){return e>=r},function(i,e,r,s){return s.compare(e,r)>=0});class ro{constructor(e,r,s,l,h){this.type=ot,this.number=e,this.locale=r,this.currency=s,this.minFractionDigits=l,this.maxFractionDigits=h}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const s=r.parse(e[1],1,Te);if(!s)return null;const l=e[2];if(typeof l!="object"||Array.isArray(l))return r.error("NumberFormat options argument must be an object.");let h=null;if(l.locale&&(h=r.parse(l.locale,1,ot),!h))return null;let p=null;if(l.currency&&(p=r.parse(l.currency,1,ot),!p))return null;let g=null;if(l["min-fraction-digits"]&&(g=r.parse(l["min-fraction-digits"],1,Te),!g))return null;let v=null;return l["max-fraction-digits"]&&(v=r.parse(l["max-fraction-digits"],1,Te),!v)?null:new ro(s,h,p,g,v)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class ma{constructor(e){this.type=Z,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&typeof s=="object")return r.error("First argument must be an image or text section.");const l=[];let h=!1;for(let p=1;p<=e.length-1;++p){const g=e[p];if(h&&typeof g=="object"&&!Array.isArray(g)){h=!1;let v=null;if(g["font-scale"]&&(v=r.parse(g["font-scale"],1,Te),!v))return null;let w=null;if(g["text-font"]&&(w=r.parse(g["text-font"],1,H(ot)),!w))return null;let I=null;if(g["text-color"]&&(I=r.parse(g["text-color"],1,_i),!I))return null;const A=l[l.length-1];A.scale=v,A.font=w,A.textColor=I}else{const v=r.parse(e[p],1,vt);if(!v)return null;const w=v.type.kind;if(w!=="string"&&w!=="value"&&w!=="null"&&w!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");h=!0,l.push({content:v,scale:null,font:null,textColor:null})}}return new ma(l)}evaluate(e){return new Qi(this.sections.map(r=>{const s=r.content.evaluate(e);return ci(s)===D?new ea("",s,null,null,null):new ea(Ot(s),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}}class no{constructor(e){this.type=D,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const s=r.parse(e[1],1,ot);return s?new no(s):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),s=Gi.fromString(r);return s&&e.availableImages&&(s.available=e.availableImages.indexOf(r)>-1),s}eachChild(e){e(this.input)}outputDefined(){return!1}}class so{constructor(e){this.type=Te,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=r.parse(e[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${K(s.type)} instead.`):new so(s):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new pi(`Expected value to be of type string or array, but found ${K(ci(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const ls={"==":jc,"!=":Vc,">":qc,"<":Uc,">=":Gc,"<=":Zc,array:Or,at:Qa,boolean:Or,case:io,coalesce:ha,collator:na,format:ma,image:no,in:eo,"index-of":pa,interpolate:Er,"interpolate-hcl":Er,"interpolate-lab":Er,length:so,let:da,literal:Nn,match:to,number:Or,"number-format":ro,object:Or,slice:fa,step:Mn,string:Or,"to-boolean":Pn,"to-color":Pn,"to-number":Pn,"to-string":Pn,var:aa,within:jn};function ml(i,[e,r,s,l]){e=e.evaluate(i),r=r.evaluate(i),s=s.evaluate(i);const h=l?l.evaluate(i):1,p=ta(e,r,s,h);if(p)throw new pi(p);return new Zt(e/255,r/255,s/255,h,!1)}function gl(i,e){return i in e}function ao(i,e){const r=e[i];return r===void 0?null:r}function Vn(i){return{type:i}}function _l(i){return{result:"success",value:i}}function kn(i){return{result:"error",value:i}}function cs(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function yl(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function oo(i){return!!i.expression&&i.expression.interpolated}function $t(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function ui(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function Hc(i){return i}function Dt(i,e){const r=e.type==="color",s=i.stops&&typeof i.stops[0][0]=="object",l=s||!(s||i.property!==void 0),h=i.type||(oo(e)?"exponential":"interval");if(r||e.type==="padding"){const I=r?Zt.parse:Tr.parse;(i=mt({},i)).stops&&(i.stops=i.stops.map(A=>[A[0],I(A[1])])),i.default=I(i.default?i.default:e.default)}if(i.colorSpace&&(p=i.colorSpace)!=="rgb"&&p!=="hcl"&&p!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var p;let g,v,w;if(h==="exponential")g=ks;else if(h==="interval")g=oi;else if(h==="categorical"){g=hi,v=Object.create(null);for(const I of i.stops)v[I[0]]=I[1];w=typeof i.stops[0][0]}else{if(h!=="identity")throw new Error(`Unknown function type "${h}"`);g=vl}if(s){const I={},A=[];for(let O=0;O<i.stops.length;O++){const j=i.stops[O],X=j[0].zoom;I[X]===void 0&&(I[X]={zoom:X,type:i.type,property:i.property,default:i.default,stops:[]},A.push(X)),I[X].stops.push([j[0].value,j[1]])}const z=[];for(const O of A)z.push([I[O].zoom,Dt(I[O],e)]);const R={name:"linear"};return{kind:"composite",interpolationType:R,interpolationFactor:Er.interpolationFactor.bind(void 0,R),zoomStops:z.map(O=>O[0]),evaluate:({zoom:O},j)=>ks({stops:z,base:i.base},e,O).evaluate(O,j)}}if(l){const I=h==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:I,interpolationFactor:Er.interpolationFactor.bind(void 0,I),zoomStops:i.stops.map(A=>A[0]),evaluate:({zoom:A})=>g(i,e,A,v,w)}}return{kind:"source",evaluate(I,A){const z=A&&A.properties?A.properties[i.property]:void 0;return z===void 0?Un(i.default,e.default):g(i,e,z,v,w)}}}function Un(i,e,r){return i!==void 0?i:e!==void 0?e:r!==void 0?r:void 0}function hi(i,e,r,s,l){return Un(typeof r===l?s[r]:void 0,i.default,e.default)}function oi(i,e,r){if($t(r)!=="number")return Un(i.default,e.default);const s=i.stops.length;if(s===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[s-1][0])return i.stops[s-1][1];const l=as(i.stops.map(h=>h[0]),r);return i.stops[l][1]}function ks(i,e,r){const s=i.base!==void 0?i.base:1;if($t(r)!=="number")return Un(i.default,e.default);const l=i.stops.length;if(l===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[l-1][0])return i.stops[l-1][1];const h=as(i.stops.map(I=>I[0]),r),p=function(I,A,z,R){const O=R-z,j=I-z;return O===0?0:A===1?j/O:(Math.pow(A,j)-1)/(Math.pow(A,O)-1)}(r,s,i.stops[h][0],i.stops[h+1][0]),g=i.stops[h][1],v=i.stops[h+1][1],w=Ir[e.type]||Hc;return typeof g.evaluate=="function"?{evaluate(...I){const A=g.evaluate.apply(void 0,I),z=v.evaluate.apply(void 0,I);if(A!==void 0&&z!==void 0)return w(A,z,p,i.colorSpace)}}:w(g,v,p,i.colorSpace)}function vl(i,e,r){switch(e.type){case"color":r=Zt.parse(r);break;case"formatted":r=Qi.fromString(r.toString());break;case"resolvedImage":r=Gi.fromString(r.toString());break;case"padding":r=Tr.parse(r);break;default:$t(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0)}return Un(r,i.default,e.default)}$r.register(ls,{error:[{kind:"error"},[ot],(i,[e])=>{throw new pi(e.evaluate(i))}],typeof:[ot,[vt],(i,[e])=>K(ci(e.evaluate(i)))],"to-rgba":[H(Te,4),[_i],(i,[e])=>{const[r,s,l,h]=e.evaluate(i).rgb;return[255*r,255*s,255*l,h]}],rgb:[_i,[Te,Te,Te],ml],rgba:[_i,[Te,Te,Te,Te],ml],has:{type:ct,overloads:[[[ot],(i,[e])=>gl(e.evaluate(i),i.properties())],[[ot,Vi],(i,[e,r])=>gl(e.evaluate(i),r.evaluate(i))]]},get:{type:vt,overloads:[[[ot],(i,[e])=>ao(e.evaluate(i),i.properties())],[[ot,Vi],(i,[e,r])=>ao(e.evaluate(i),r.evaluate(i))]]},"feature-state":[vt,[ot],(i,[e])=>ao(e.evaluate(i),i.featureState||{})],properties:[Vi,[],i=>i.properties()],"geometry-type":[ot,[],i=>i.geometryType()],id:[vt,[],i=>i.id()],zoom:[Te,[],i=>i.globals.zoom],"heatmap-density":[Te,[],i=>i.globals.heatmapDensity||0],"line-progress":[Te,[],i=>i.globals.lineProgress||0],accumulated:[vt,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Te,Vn(Te),(i,e)=>{let r=0;for(const s of e)r+=s.evaluate(i);return r}],"*":[Te,Vn(Te),(i,e)=>{let r=1;for(const s of e)r*=s.evaluate(i);return r}],"-":{type:Te,overloads:[[[Te,Te],(i,[e,r])=>e.evaluate(i)-r.evaluate(i)],[[Te],(i,[e])=>-e.evaluate(i)]]},"/":[Te,[Te,Te],(i,[e,r])=>e.evaluate(i)/r.evaluate(i)],"%":[Te,[Te,Te],(i,[e,r])=>e.evaluate(i)%r.evaluate(i)],ln2:[Te,[],()=>Math.LN2],pi:[Te,[],()=>Math.PI],e:[Te,[],()=>Math.E],"^":[Te,[Te,Te],(i,[e,r])=>Math.pow(e.evaluate(i),r.evaluate(i))],sqrt:[Te,[Te],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[Te,[Te],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[Te,[Te],(i,[e])=>Math.log(e.evaluate(i))],log2:[Te,[Te],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[Te,[Te],(i,[e])=>Math.sin(e.evaluate(i))],cos:[Te,[Te],(i,[e])=>Math.cos(e.evaluate(i))],tan:[Te,[Te],(i,[e])=>Math.tan(e.evaluate(i))],asin:[Te,[Te],(i,[e])=>Math.asin(e.evaluate(i))],acos:[Te,[Te],(i,[e])=>Math.acos(e.evaluate(i))],atan:[Te,[Te],(i,[e])=>Math.atan(e.evaluate(i))],min:[Te,Vn(Te),(i,e)=>Math.min(...e.map(r=>r.evaluate(i)))],max:[Te,Vn(Te),(i,e)=>Math.max(...e.map(r=>r.evaluate(i)))],abs:[Te,[Te],(i,[e])=>Math.abs(e.evaluate(i))],round:[Te,[Te],(i,[e])=>{const r=e.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[Te,[Te],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[Te,[Te],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[ct,[ot,vt],(i,[e,r])=>i.properties()[e.value]===r.value],"filter-id-==":[ct,[vt],(i,[e])=>i.id()===e.value],"filter-type-==":[ct,[ot],(i,[e])=>i.geometryType()===e.value],"filter-<":[ct,[ot,vt],(i,[e,r])=>{const s=i.properties()[e.value],l=r.value;return typeof s==typeof l&&s<l}],"filter-id-<":[ct,[vt],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r<s}],"filter->":[ct,[ot,vt],(i,[e,r])=>{const s=i.properties()[e.value],l=r.value;return typeof s==typeof l&&s>l}],"filter-id->":[ct,[vt],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r>s}],"filter-<=":[ct,[ot,vt],(i,[e,r])=>{const s=i.properties()[e.value],l=r.value;return typeof s==typeof l&&s<=l}],"filter-id-<=":[ct,[vt],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r<=s}],"filter->=":[ct,[ot,vt],(i,[e,r])=>{const s=i.properties()[e.value],l=r.value;return typeof s==typeof l&&s>=l}],"filter-id->=":[ct,[vt],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r>=s}],"filter-has":[ct,[vt],(i,[e])=>e.value in i.properties()],"filter-has-id":[ct,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[ct,[H(ot)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[ct,[H(vt)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[ct,[ot,H(vt)],(i,[e,r])=>r.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[ct,[ot,H(vt)],(i,[e,r])=>function(s,l,h,p){for(;h<=p;){const g=h+p>>1;if(l[g]===s)return!0;l[g]>s?p=g-1:h=g+1}return!1}(i.properties()[e.value],r.value,0,r.value.length-1)],all:{type:ct,overloads:[[[ct,ct],(i,[e,r])=>e.evaluate(i)&&r.evaluate(i)],[Vn(ct),(i,e)=>{for(const r of e)if(!r.evaluate(i))return!1;return!0}]]},any:{type:ct,overloads:[[[ct,ct],(i,[e,r])=>e.evaluate(i)||r.evaluate(i)],[Vn(ct),(i,e)=>{for(const r of e)if(r.evaluate(i))return!0;return!1}]]},"!":[ct,[ct],(i,[e])=>!e.evaluate(i)],"is-supported-script":[ct,[ot],(i,[e])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(e.evaluate(i))}],upcase:[ot,[ot],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[ot,[ot],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[ot,Vn(vt),(i,e)=>e.map(r=>Ot(r.evaluate(i))).join("")],"resolved-locale":[ot,[hn],(i,[e])=>e.evaluate(i).resolvedLocale()]});class lo{constructor(e,r){var s;this.expression=e,this._warningHistory={},this._evaluator=new Ga,this._defaultValue=r?(s=r).type==="color"&&ui(s.default)?new Zt(0,0,0,0):s.type==="color"?Zt.parse(s.default)||null:s.type==="padding"?Tr.parse(s.default)||null:s.type==="variableAnchorOffsetCollection"?Br.parse(s.default)||null:s.default===void 0?null:s.default:null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,s,l,h,p){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=s,this._evaluator.canonical=l,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=p,this.expression.evaluate(this._evaluator)}evaluate(e,r,s,l,h,p){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=s||null,this._evaluator.canonical=l,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=p||null;try{const g=this.expression.evaluate(this._evaluator);if(g==null||typeof g=="number"&&g!=g)return this._defaultValue;if(this._enumValues&&!(g in this._enumValues))throw new pi(`Expected value to be one of ${Object.keys(this._enumValues).map(v=>JSON.stringify(v)).join(", ")}, but found ${JSON.stringify(g)} instead.`);return g}catch(g){return this._warningHistory[g.message]||(this._warningHistory[g.message]=!0,typeof console<"u"&&console.warn(g.message)),this._defaultValue}}}function ga(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in ls}function _a(i,e){const r=new ra(ls,oa,[],e?function(l){const h={color:_i,string:ot,number:Te,enum:ot,boolean:ct,formatted:Z,padding:M,resolvedImage:D,variableAnchorOffsetCollection:$};return l.type==="array"?H(h[l.value]||vt,l.length):h[l.type]}(e):void 0),s=r.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return s?_l(new lo(s,e)):kn(r.errors)}class co{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!Ms(r.expression)}evaluateWithoutErrorHandling(e,r,s,l,h,p){return this._styleExpression.evaluateWithoutErrorHandling(e,r,s,l,h,p)}evaluate(e,r,s,l,h,p){return this._styleExpression.evaluate(e,r,s,l,h,p)}}class ya{constructor(e,r,s,l){this.kind=e,this.zoomStops=s,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!Ms(r.expression),this.interpolationType=l}evaluateWithoutErrorHandling(e,r,s,l,h,p){return this._styleExpression.evaluateWithoutErrorHandling(e,r,s,l,h,p)}evaluate(e,r,s,l,h,p){return this._styleExpression.evaluate(e,r,s,l,h,p)}interpolationFactor(e,r,s){return this.interpolationType?Er.interpolationFactor(this.interpolationType,e,r,s):0}}function uo(i,e){const r=_a(i,e);if(r.result==="error")return r;const s=r.value.expression,l=la(s);if(!l&&!cs(e))return kn([new dt("","data expressions not supported")]);const h=ca(s,["zoom"]);if(!h&&!yl(e))return kn([new dt("","zoom expressions not supported")]);const p=Ds(s);return p||h?p instanceof dt?kn([p]):p instanceof Er&&!oo(e)?kn([new dt("",'"interpolate" expressions cannot be used with this property')]):_l(p?new ya(l?"camera":"composite",r.value,p.labels,p instanceof Er?p.interpolation:void 0):new co(l?"constant":"source",r.value)):kn([new dt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class zs{constructor(e,r){this._parameters=e,this._specification=r,mt(this,Dt(this._parameters,this._specification))}static deserialize(e){return new zs(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Ds(i){let e=null;if(i instanceof da)e=Ds(i.result);else if(i instanceof ha){for(const r of i.args)if(e=Ds(r),e)break}else(i instanceof Mn||i instanceof Er)&&i.input instanceof $r&&i.input.name==="zoom"&&(e=i);return e instanceof dt||i.eachChild(r=>{const s=Ds(r);s instanceof dt?e=s:!e&&s?e=new dt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&s&&e!==s&&(e=new dt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Ls(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!Ls(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const Wc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ho(i){if(i==null)return{filter:()=>!0,needGeometry:!1};Ls(i)||(i=va(i));const e=_a(i,Wc);if(e.result==="error")throw new Error(e.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,s,l)=>e.value.evaluate(r,s,{},l),needGeometry:xl(i)}}function Xc(i,e){return i<e?-1:i>e?1:0}function xl(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(xl(i[e]))return!0;return!1}function va(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?po(i[1],i[2],"=="):e==="!="?Rs(po(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?po(i[1],i[2],e):e==="any"?(r=i.slice(1),["any"].concat(r.map(va))):e==="all"?["all"].concat(i.slice(1).map(va)):e==="none"?["all"].concat(i.slice(1).map(va).map(Rs)):e==="in"?bl(i[1],i.slice(2)):e==="!in"?Rs(bl(i[1],i.slice(2))):e==="has"?wl(i[1]):e==="!has"?Rs(wl(i[1])):e!=="within"||i;var r}function po(i,e,r){switch(i){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,i,e]}}function bl(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",i,["literal",e.sort(Xc)]]:["filter-in-small",i,["literal",e]]}}function wl(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Rs(i){return["!",i]}function xa(i){const e=typeof i;if(e==="number"||e==="boolean"||e==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let l="[";for(const h of i)l+=`${xa(h)},`;return`${l}]`}const r=Object.keys(i).sort();let s="{";for(let l=0;l<r.length;l++)s+=`${JSON.stringify(r[l])}:${xa(i[r[l]])},`;return`${s}}`}function ba(i){let e="";for(const r of Ii)e+=`/${xa(i[r])}`;return e}function Sl(i){const e=i.value;return e?[new Re(i.key,e,"constants have been deprecated as of v8")]:[]}function fi(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function qn(i){if(Array.isArray(i))return i.map(qn);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const r in i)e[r]=qn(i[r]);return e}return fi(i)}function gr(i){const e=i.key,r=i.value,s=i.valueSpec||{},l=i.objectElementValidators||{},h=i.style,p=i.styleSpec,g=i.validateSpec;let v=[];const w=$t(r);if(w!=="object")return[new Re(e,r,`object expected, ${w} found`)];for(const I in r){const A=I.split(".")[0],z=s[A]||s["*"];let R;if(l[A])R=l[A];else if(s[A])R=g;else if(l["*"])R=l["*"];else{if(!s["*"]){v.push(new Re(e,r[I],`unknown property "${I}"`));continue}R=g}v=v.concat(R({key:(e&&`${e}.`)+I,value:r[I],valueSpec:z,style:h,styleSpec:p,object:r,objectKey:I,validateSpec:g},r))}for(const I in s)l[I]||s[I].required&&s[I].default===void 0&&r[I]===void 0&&v.push(new Re(e,r,`missing required property "${I}"`));return v}function us(i){const e=i.value,r=i.valueSpec,s=i.style,l=i.styleSpec,h=i.key,p=i.arrayElementValidator||i.validateSpec;if($t(e)!=="array")return[new Re(h,e,`array expected, ${$t(e)} found`)];if(r.length&&e.length!==r.length)return[new Re(h,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new Re(h,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let g={type:r.value,values:r.values};l.$version<7&&(g.function=r.function),$t(r.value)==="object"&&(g=r.value);let v=[];for(let w=0;w<e.length;w++)v=v.concat(p({array:e,arrayIndex:w,value:e[w],valueSpec:g,validateSpec:i.validateSpec,style:s,styleSpec:l,key:`${h}[${w}]`}));return v}function Fs(i){const e=i.key,r=i.value,s=i.valueSpec;let l=$t(r);return l==="number"&&r!=r&&(l="NaN"),l!=="number"?[new Re(e,r,`number expected, ${l} found`)]:"minimum"in s&&r<s.minimum?[new Re(e,r,`${r} is less than the minimum value ${s.minimum}`)]:"maximum"in s&&r>s.maximum?[new Re(e,r,`${r} is greater than the maximum value ${s.maximum}`)]:[]}function wa(i){const e=i.valueSpec,r=fi(i.value.type);let s,l,h,p={};const g=r!=="categorical"&&i.value.property===void 0,v=!g,w=$t(i.value.stops)==="array"&&$t(i.value.stops[0])==="array"&&$t(i.value.stops[0][0])==="object",I=gr({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(R){if(r==="identity")return[new Re(R.key,R.value,'identity function may not have a "stops" property')];let O=[];const j=R.value;return O=O.concat(us({key:R.key,value:j,valueSpec:R.valueSpec,validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec,arrayElementValidator:A})),$t(j)==="array"&&j.length===0&&O.push(new Re(R.key,j,"array must have at least one stop")),O},default:function(R){return R.validateSpec({key:R.key,value:R.value,valueSpec:e,validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec})}}});return r==="identity"&&g&&I.push(new Re(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||I.push(new Re(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!oo(i.valueSpec)&&I.push(new Re(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(v&&!cs(i.valueSpec)?I.push(new Re(i.key,i.value,"property functions not supported")):g&&!yl(i.valueSpec)&&I.push(new Re(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!w||i.value.property!==void 0||I.push(new Re(i.key,i.value,'"property" property is required')),I;function A(R){let O=[];const j=R.value,X=R.key;if($t(j)!=="array")return[new Re(X,j,`array expected, ${$t(j)} found`)];if(j.length!==2)return[new Re(X,j,`array length 2 expected, length ${j.length} found`)];if(w){if($t(j[0])!=="object")return[new Re(X,j,`object expected, ${$t(j[0])} found`)];if(j[0].zoom===void 0)return[new Re(X,j,"object stop key must have zoom")];if(j[0].value===void 0)return[new Re(X,j,"object stop key must have value")];if(h&&h>fi(j[0].zoom))return[new Re(X,j[0].zoom,"stop zoom values must appear in ascending order")];fi(j[0].zoom)!==h&&(h=fi(j[0].zoom),l=void 0,p={}),O=O.concat(gr({key:`${X}[0]`,value:j[0],valueSpec:{zoom:{}},validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec,objectElementValidators:{zoom:Fs,value:z}}))}else O=O.concat(z({key:`${X}[0]`,value:j[0],valueSpec:{},validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec},j));return ga(qn(j[1]))?O.concat([new Re(`${X}[1]`,j[1],"expressions are not allowed in function stops.")]):O.concat(R.validateSpec({key:`${X}[1]`,value:j[1],valueSpec:e,validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec}))}function z(R,O){const j=$t(R.value),X=fi(R.value),Y=R.value!==null?R.value:O;if(s){if(j!==s)return[new Re(R.key,Y,`${j} stop domain type must match previous stop domain type ${s}`)]}else s=j;if(j!=="number"&&j!=="string"&&j!=="boolean")return[new Re(R.key,Y,"stop domain value must be a number, string, or boolean")];if(j!=="number"&&r!=="categorical"){let oe=`number expected, ${j} found`;return cs(e)&&r===void 0&&(oe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Re(R.key,Y,oe)]}return r!=="categorical"||j!=="number"||isFinite(X)&&Math.floor(X)===X?r!=="categorical"&&j==="number"&&l!==void 0&&X<l?[new Re(R.key,Y,"stop domain values must appear in ascending order")]:(l=X,r==="categorical"&&X in p?[new Re(R.key,Y,"stop domain values must be unique")]:(p[X]=!0,[])):[new Re(R.key,Y,`integer expected, found ${X}`)]}}function Zn(i){const e=(i.expressionContext==="property"?uo:_a)(qn(i.value),i.valueSpec);if(e.result==="error")return e.value.map(s=>new Re(`${i.key}${s.key}`,i.value,s.message));const r=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new Re(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!Ms(r))return[new Re(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!Ms(r))return[new Re(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!ca(r,["zoom","feature-state"]))return[new Re(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!la(r))return[new Re(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Bs(i){const e=i.key,r=i.value,s=i.valueSpec,l=[];return Array.isArray(s.values)?s.values.indexOf(fi(r))===-1&&l.push(new Re(e,r,`expected one of [${s.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(s.values).indexOf(fi(r))===-1&&l.push(new Re(e,r,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(r)} found`)),l}function hs(i){return Ls(qn(i.value))?Zn(mt({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Cl(i)}function Cl(i){const e=i.value,r=i.key;if($t(e)!=="array")return[new Re(r,e,`array expected, ${$t(e)} found`)];const s=i.styleSpec;let l,h=[];if(e.length<1)return[new Re(r,e,"filter array must have at least 1 element")];switch(h=h.concat(Bs({key:`${r}[0]`,value:e[0],valueSpec:s.filter_operator,style:i.style,styleSpec:i.styleSpec})),fi(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&fi(e[1])==="$type"&&h.push(new Re(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&h.push(new Re(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(l=$t(e[1]),l!=="string"&&h.push(new Re(`${r}[1]`,e[1],`string expected, ${l} found`)));for(let p=2;p<e.length;p++)l=$t(e[p]),fi(e[1])==="$type"?h=h.concat(Bs({key:`${r}[${p}]`,value:e[p],valueSpec:s.geometry_type,style:i.style,styleSpec:i.styleSpec})):l!=="string"&&l!=="number"&&l!=="boolean"&&h.push(new Re(`${r}[${p}]`,e[p],`string, number, or boolean expected, ${l} found`));break;case"any":case"all":case"none":for(let p=1;p<e.length;p++)h=h.concat(Cl({key:`${r}[${p}]`,value:e[p],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":l=$t(e[1]),e.length!==2?h.push(new Re(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):l!=="string"&&h.push(new Re(`${r}[1]`,e[1],`string expected, ${l} found`));break;case"within":l=$t(e[1]),e.length!==2?h.push(new Re(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):l!=="object"&&h.push(new Re(`${r}[1]`,e[1],`object expected, ${l} found`))}return h}function Tl(i,e){const r=i.key,s=i.validateSpec,l=i.style,h=i.styleSpec,p=i.value,g=i.objectKey,v=h[`${e}_${i.layerType}`];if(!v)return[];const w=g.match(/^(.*)-transition$/);if(e==="paint"&&w&&v[w[1]]&&v[w[1]].transition)return s({key:r,value:p,valueSpec:h.transition,style:l,styleSpec:h});const I=i.valueSpec||v[g];if(!I)return[new Re(r,p,`unknown property "${g}"`)];let A;if($t(p)==="string"&&cs(I)&&!I.tokens&&(A=/^{([^}]+)}$/.exec(p)))return[new Re(r,p,`"${g}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(A[1])} }\`.`)];const z=[];return i.layerType==="symbol"&&(g==="text-field"&&l&&!l.glyphs&&z.push(new Re(r,p,'use of "text-field" requires a style "glyphs" property')),g==="text-font"&&ui(qn(p))&&fi(p.type)==="identity"&&z.push(new Re(r,p,'"text-font" does not support identity functions'))),z.concat(s({key:i.key,value:p,valueSpec:I,style:l,styleSpec:h,expressionContext:"property",propertyType:e,propertyKey:g}))}function Il(i){return Tl(i,"paint")}function El(i){return Tl(i,"layout")}function Pl(i){let e=[];const r=i.value,s=i.key,l=i.style,h=i.styleSpec;r.type||r.ref||e.push(new Re(s,r,'either "type" or "ref" is required'));let p=fi(r.type);const g=fi(r.ref);if(r.id){const v=fi(r.id);for(let w=0;w<i.arrayIndex;w++){const I=l.layers[w];fi(I.id)===v&&e.push(new Re(s,r.id,`duplicate layer id "${r.id}", previously used at line ${I.id.__line__}`))}}if("ref"in r){let v;["type","source","source-layer","filter","layout"].forEach(w=>{w in r&&e.push(new Re(s,r[w],`"${w}" is prohibited for ref layers`))}),l.layers.forEach(w=>{fi(w.id)===g&&(v=w)}),v?v.ref?e.push(new Re(s,r.ref,"ref cannot reference another ref layer")):p=fi(v.type):e.push(new Re(s,r.ref,`ref layer "${g}" not found`))}else if(p!=="background")if(r.source){const v=l.sources&&l.sources[r.source],w=v&&fi(v.type);v?w==="vector"&&p==="raster"?e.push(new Re(s,r.source,`layer "${r.id}" requires a raster source`)):w!=="raster-dem"&&p==="hillshade"?e.push(new Re(s,r.source,`layer "${r.id}" requires a raster-dem source`)):w==="raster"&&p!=="raster"?e.push(new Re(s,r.source,`layer "${r.id}" requires a vector source`)):w!=="vector"||r["source-layer"]?w==="raster-dem"&&p!=="hillshade"?e.push(new Re(s,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):p!=="line"||!r.paint||!r.paint["line-gradient"]||w==="geojson"&&v.lineMetrics||e.push(new Re(s,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Re(s,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new Re(s,r.source,`source "${r.source}" not found`))}else e.push(new Re(s,r,'missing required property "source"'));return e=e.concat(gr({key:s,value:r,valueSpec:h.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${s}.type`,value:r.type,valueSpec:h.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:r,objectKey:"type"}),filter:hs,layout:v=>gr({layer:r,key:v.key,value:v.value,style:v.style,styleSpec:v.styleSpec,validateSpec:v.validateSpec,objectElementValidators:{"*":w=>El(mt({layerType:p},w))}}),paint:v=>gr({layer:r,key:v.key,value:v.value,style:v.style,styleSpec:v.styleSpec,validateSpec:v.validateSpec,objectElementValidators:{"*":w=>Il(mt({layerType:p},w))}})}})),e}function tn(i){const e=i.value,r=i.key,s=$t(e);return s!=="string"?[new Re(r,e,`string expected, ${s} found`)]:[]}const Os={promoteId:function({key:i,value:e}){if($t(e)==="string")return tn({key:i,value:e});{const r=[];for(const s in e)r.push(...tn({key:`${i}.${s}`,value:e[s]}));return r}}};function Pr(i){const e=i.value,r=i.key,s=i.styleSpec,l=i.style,h=i.validateSpec;if(!e.type)return[new Re(r,e,'"type" is required')];const p=fi(e.type);let g;switch(p){case"vector":case"raster":return g=gr({key:r,value:e,valueSpec:s[`source_${p.replace("-","_")}`],style:i.style,styleSpec:s,objectElementValidators:Os,validateSpec:h}),g;case"raster-dem":return g=function(v){var w;const I=(w=v.sourceName)!==null&&w!==void 0?w:"",A=v.value,z=v.styleSpec,R=z.source_raster_dem,O=v.style;let j=[];const X=$t(A);if(A===void 0)return j;if(X!=="object")return j.push(new Re("source_raster_dem",A,`object expected, ${X} found`)),j;const Y=fi(A.encoding)==="custom",oe=["redFactor","greenFactor","blueFactor","baseShift"],ee=v.value.encoding?`"${v.value.encoding}"`:"Default";for(const ce in A)!Y&&oe.includes(ce)?j.push(new Re(ce,A[ce],`In "${I}": "${ce}" is only valid when "encoding" is set to "custom". ${ee} encoding found`)):R[ce]?j=j.concat(v.validateSpec({key:ce,value:A[ce],valueSpec:R[ce],validateSpec:v.validateSpec,style:O,styleSpec:z})):j.push(new Re(ce,A[ce],`unknown property "${ce}"`));return j}({sourceName:r,value:e,style:i.style,styleSpec:s,validateSpec:h}),g;case"geojson":if(g=gr({key:r,value:e,valueSpec:s.source_geojson,style:l,styleSpec:s,validateSpec:h,objectElementValidators:Os}),e.cluster)for(const v in e.clusterProperties){const[w,I]=e.clusterProperties[v],A=typeof w=="string"?[w,["accumulated"],["get",v]]:w;g.push(...Zn({key:`${r}.${v}.map`,value:I,validateSpec:h,expressionContext:"cluster-map"})),g.push(...Zn({key:`${r}.${v}.reduce`,value:A,validateSpec:h,expressionContext:"cluster-reduce"}))}return g;case"video":return gr({key:r,value:e,valueSpec:s.source_video,style:l,validateSpec:h,styleSpec:s});case"image":return gr({key:r,value:e,valueSpec:s.source_image,style:l,validateSpec:h,styleSpec:s});case"canvas":return[new Re(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Bs({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:l,validateSpec:h,styleSpec:s})}}function $s(i){const e=i.value,r=i.styleSpec,s=r.light,l=i.style;let h=[];const p=$t(e);if(e===void 0)return h;if(p!=="object")return h=h.concat([new Re("light",e,`object expected, ${p} found`)]),h;for(const g in e){const v=g.match(/^(.*)-transition$/);h=h.concat(v&&s[v[1]]&&s[v[1]].transition?i.validateSpec({key:g,value:e[g],valueSpec:r.transition,validateSpec:i.validateSpec,style:l,styleSpec:r}):s[g]?i.validateSpec({key:g,value:e[g],valueSpec:s[g],validateSpec:i.validateSpec,style:l,styleSpec:r}):[new Re(g,e[g],`unknown property "${g}"`)])}return h}function Al(i){const e=i.value,r=i.styleSpec,s=r.terrain,l=i.style;let h=[];const p=$t(e);if(e===void 0)return h;if(p!=="object")return h=h.concat([new Re("terrain",e,`object expected, ${p} found`)]),h;for(const g in e)h=h.concat(s[g]?i.validateSpec({key:g,value:e[g],valueSpec:s[g],validateSpec:i.validateSpec,style:l,styleSpec:r}):[new Re(g,e[g],`unknown property "${g}"`)]);return h}function Ml(i){let e=[];const r=i.value,s=i.key;if(Array.isArray(r)){const l=[],h=[];for(const p in r)r[p].id&&l.includes(r[p].id)&&e.push(new Re(s,r,`all the sprites' ids must be unique, but ${r[p].id} is duplicated`)),l.push(r[p].id),r[p].url&&h.includes(r[p].url)&&e.push(new Re(s,r,`all the sprites' URLs must be unique, but ${r[p].url} is duplicated`)),h.push(r[p].url),e=e.concat(gr({key:`${s}[${p}]`,value:r[p],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return e}return tn({key:s,value:r})}const kl={"*":()=>[],array:us,boolean:function(i){const e=i.value,r=i.key,s=$t(e);return s!=="boolean"?[new Re(r,e,`boolean expected, ${s} found`)]:[]},number:Fs,color:function(i){const e=i.key,r=i.value,s=$t(r);return s!=="string"?[new Re(e,r,`color expected, ${s} found`)]:Zt.parse(String(r))?[]:[new Re(e,r,`color expected, "${r}" found`)]},constants:Sl,enum:Bs,filter:hs,function:wa,layer:Pl,object:gr,source:Pr,light:$s,terrain:Al,string:tn,formatted:function(i){return tn(i).length===0?[]:Zn(i)},resolvedImage:function(i){return tn(i).length===0?[]:Zn(i)},padding:function(i){const e=i.key,r=i.value;if($t(r)==="array"){if(r.length<1||r.length>4)return[new Re(e,r,`padding requires 1 to 4 values; ${r.length} values found`)];const s={type:"number"};let l=[];for(let h=0;h<r.length;h++)l=l.concat(i.validateSpec({key:`${e}[${h}]`,value:r[h],validateSpec:i.validateSpec,valueSpec:s}));return l}return Fs({key:e,value:r,valueSpec:{}})},variableAnchorOffsetCollection:function(i){const e=i.key,r=i.value,s=$t(r),l=i.styleSpec;if(s!=="array"||r.length<1||r.length%2!=0)return[new Re(e,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let h=[];for(let p=0;p<r.length;p+=2)h=h.concat(Bs({key:`${e}[${p}]`,value:r[p],valueSpec:l.layout_symbol["text-anchor"]})),h=h.concat(us({key:`${e}[${p+1}]`,value:r[p+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:l}));return h},sprite:Ml};function dn(i){const e=i.value,r=i.valueSpec,s=i.styleSpec;return i.validateSpec=dn,r.expression&&ui(fi(e))?wa(i):r.expression&&ga(qn(e))?Zn(i):r.type&&kl[r.type]?kl[r.type](i):gr(mt({},i,{valueSpec:r.type?s[r.type]:r}))}function zl(i){const e=i.value,r=i.key,s=tn(i);return s.length||(e.indexOf("{fontstack}")===-1&&s.push(new Re(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&s.push(new Re(r,e,'"glyphs" url must include a "{range}" token'))),s}function Nr(i,e=ge){let r=[];return r=r.concat(dn({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,validateSpec:dn,objectElementValidators:{glyphs:zl,"*":()=>[]}})),i.constants&&(r=r.concat(Sl({key:"constants",value:i.constants,style:i,styleSpec:e,validateSpec:dn}))),Sa(r)}function pn(i){return function(e){return i({...e,validateSpec:dn})}}function Sa(i){return[].concat(i).sort((e,r)=>e.line-r.line)}function fn(i){return function(...e){return Sa(i.apply(this,e))}}Nr.source=fn(pn(Pr)),Nr.sprite=fn(pn(Ml)),Nr.glyphs=fn(pn(zl)),Nr.light=fn(pn($s)),Nr.terrain=fn(pn(Al)),Nr.layer=fn(pn(Pl)),Nr.filter=fn(pn(hs)),Nr.paintProperty=fn(pn(Il)),Nr.layoutProperty=fn(pn(El));const mn=Nr,Kc=mn.light,fo=mn.paintProperty,Dl=mn.layoutProperty;function Ca(i,e){let r=!1;if(e&&e.length)for(const s of e)i.fire(new mr(new Error(s.message))),r=!0;return r}class ds{constructor(e,r,s){const l=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const p=new Int32Array(this.arrayBuffer);e=p[0],this.d=(r=p[1])+2*(s=p[2]);for(let v=0;v<this.d*this.d;v++){const w=p[3+v],I=p[3+v+1];l.push(w===I?null:p.subarray(w,I))}const g=p[3+l.length+1];this.keys=p.subarray(p[3+l.length],g),this.bboxes=p.subarray(g),this.insert=this._insertReadonly}else{this.d=r+2*s;for(let p=0;p<this.d*this.d;p++)l.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=e,this.padding=s,this.scale=r/e,this.uid=0;const h=s/r*e;this.min=-h,this.max=e+h}insert(e,r,s,l,h){this._forEachCell(r,s,l,h,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(r),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(h)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,r,s,l,h,p){this.cells[h].push(p)}query(e,r,s,l,h){const p=this.min,g=this.max;if(e<=p&&r<=p&&g<=s&&g<=l&&!h)return Array.prototype.slice.call(this.keys);{const v=[];return this._forEachCell(e,r,s,l,this._queryCell,v,{},h),v}}_queryCell(e,r,s,l,h,p,g,v){const w=this.cells[h];if(w!==null){const I=this.keys,A=this.bboxes;for(let z=0;z<w.length;z++){const R=w[z];if(g[R]===void 0){const O=4*R;(v?v(A[O+0],A[O+1],A[O+2],A[O+3]):e<=A[O+2]&&r<=A[O+3]&&s>=A[O+0]&&l>=A[O+1])?(g[R]=!0,p.push(I[R])):g[R]=!1}}}}_forEachCell(e,r,s,l,h,p,g,v){const w=this._convertToCellCoord(e),I=this._convertToCellCoord(r),A=this._convertToCellCoord(s),z=this._convertToCellCoord(l);for(let R=w;R<=A;R++)for(let O=I;O<=z;O++){const j=this.d*O+R;if((!v||v(this._convertFromCellCoord(R),this._convertFromCellCoord(O),this._convertFromCellCoord(R+1),this._convertFromCellCoord(O+1)))&&h.call(this,e,r,s,l,j,p,g,v))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,r=3+this.cells.length+1+1;let s=0;for(let p=0;p<this.cells.length;p++)s+=this.cells[p].length;const l=new Int32Array(r+s+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;let h=r;for(let p=0;p<e.length;p++){const g=e[p];l[3+p]=h,l.set(g,h),h+=g.length}return l[3+e.length]=h,l.set(this.keys,h),h+=this.keys.length,l[3+e.length+1]=h,l.set(this.bboxes,h),h+=this.bboxes.length,l.buffer}static serialize(e,r){const s=e.toArrayBuffer();return r&&r.push(s),{buffer:s}}static deserialize(e){return new ds(e.buffer)}}const gn={};function He(i,e,r={}){if(gn[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),gn[i]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}He("Object",Object),He("TransferableGridIndex",ds),He("Color",Zt),He("Error",Error),He("AJAXError",gi),He("ResolvedImage",Gi),He("StylePropertyFunction",zs),He("StyleExpression",lo,{omit:["_evaluator"]}),He("ZoomDependentExpression",ya),He("ZoomConstantExpression",co),He("CompoundExpression",$r,{omit:["_evaluate"]});for(const i in ls)ls[i]._classRegistryKey||He(`Expression_${i}`,ls[i]);function Ta(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function zn(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob)return i;if(Ta(i)||Mi(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const r=i;return e&&e.push(r.buffer),r}if(i instanceof ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const r=[];for(const s of i)r.push(zn(s,e));return r}if(typeof i=="object"){const r=i.constructor,s=r._classRegistryKey;if(!s)throw new Error("can't serialize object of unregistered class");if(!gn[s])throw new Error(`${s} is not registered.`);const l=r.serialize?r.serialize(i,e):{};if(r.serialize){if(e&&l===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const h in i){if(!i.hasOwnProperty(h)||gn[s].omit.indexOf(h)>=0)continue;const p=i[h];l[h]=gn[s].shallow.indexOf(h)>=0?p:zn(p,e)}i instanceof Error&&(l.message=i.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(l.$name=s),l}throw new Error("can't serialize object of type "+typeof i)}function ps(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||Ta(i)||Mi(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(ps);if(typeof i=="object"){const e=i.$name||"Object";if(!gn[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:r}=gn[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(i);const s=Object.create(r.prototype);for(const l of Object.keys(i)){if(l==="$name")continue;const h=i[l];s[l]=gn[e].shallow.indexOf(l)>=0?h:ps(h)}return s}throw new Error("can't deserialize object of type "+typeof i)}class Ll{constructor(){this.first=!0}update(e,r){const s=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=s,!0))}}const Ue={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function mo(i){for(const e of i)if(_o(e.charCodeAt(0)))return!0;return!1}function go(i){for(const e of i)if(!Jc(e.charCodeAt(0)))return!1;return!0}function Jc(i){return!(Ue.Arabic(i)||Ue["Arabic Supplement"](i)||Ue["Arabic Extended-A"](i)||Ue["Arabic Presentation Forms-A"](i)||Ue["Arabic Presentation Forms-B"](i))}function _o(i){return!(i!==746&&i!==747&&(i<4352||!(Ue["Bopomofo Extended"](i)||Ue.Bopomofo(i)||Ue["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||Ue["CJK Compatibility Ideographs"](i)||Ue["CJK Compatibility"](i)||Ue["CJK Radicals Supplement"](i)||Ue["CJK Strokes"](i)||!(!Ue["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Ue["CJK Unified Ideographs Extension A"](i)||Ue["CJK Unified Ideographs"](i)||Ue["Enclosed CJK Letters and Months"](i)||Ue["Hangul Compatibility Jamo"](i)||Ue["Hangul Jamo Extended-A"](i)||Ue["Hangul Jamo Extended-B"](i)||Ue["Hangul Jamo"](i)||Ue["Hangul Syllables"](i)||Ue.Hiragana(i)||Ue["Ideographic Description Characters"](i)||Ue.Kanbun(i)||Ue["Kangxi Radicals"](i)||Ue["Katakana Phonetic Extensions"](i)||Ue.Katakana(i)&&i!==12540||!(!Ue["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Ue["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||Ue["Unified Canadian Aboriginal Syllabics"](i)||Ue["Unified Canadian Aboriginal Syllabics Extended"](i)||Ue["Vertical Forms"](i)||Ue["Yijing Hexagram Symbols"](i)||Ue["Yi Syllables"](i)||Ue["Yi Radicals"](i))))}function Rl(i){return!(_o(i)||function(e){return!!(Ue["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Ue["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Ue["Letterlike Symbols"](e)||Ue["Number Forms"](e)||Ue["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Ue["Control Pictures"](e)&&e!==9251||Ue["Optical Character Recognition"](e)||Ue["Enclosed Alphanumerics"](e)||Ue["Geometric Shapes"](e)||Ue["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Ue["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Ue["CJK Symbols and Punctuation"](e)||Ue.Katakana(e)||Ue["Private Use Area"](e)||Ue["CJK Compatibility Forms"](e)||Ue["Small Form Variants"](e)||Ue["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function Fl(i){return i>=1424&&i<=2303||Ue["Arabic Presentation Forms-A"](i)||Ue["Arabic Presentation Forms-B"](i)}function Bl(i,e){return!(!e&&Fl(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||Ue.Khmer(i))}function Yc(i){for(const e of i)if(Fl(e.charCodeAt(0)))return!0;return!1}const yo="deferred",vo="loading",xo="loaded";let bo=null,_r="unavailable",Dn=null;const Ns=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(_r="error"),bo&&bo(i)};function wo(){js.fire(new sr("pluginStateChange",{pluginStatus:_r,pluginURL:Dn}))}const js=new Cr,So=function(){return _r},Ol=function(){if(_r!==yo||!Dn)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");_r=vo,wo(),Dn&&Xt({url:Dn},i=>{i?Ns(i):(_r=xo,wo())})},Ar={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>_r===xo||Ar.applyArabicShaping!=null,isLoading:()=>_r===vo,setState(i){if(!ft())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");_r=i.pluginStatus,Dn=i.pluginURL},isParsed(){if(!ft())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return Ar.applyArabicShaping!=null&&Ar.processBidirectionalText!=null&&Ar.processStyledBidirectionalText!=null},getPluginURL(){if(!ft())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Dn}};class ii{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Ll,this.transition={})}isSupportedScript(e){return function(r,s){for(const l of r)if(!Bl(l.charCodeAt(0),s))return!1;return!0}(e,Ar.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),s=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*r}}}class Ia{constructor(e,r){this.property=e,this.value=r,this.expression=function(s,l){if(ui(s))return new zs(s,l);if(ga(s)){const h=uo(s,l);if(h.result==="error")throw new Error(h.value.map(p=>`${p.key}: ${p.message}`).join(", "));return h.value}{let h=s;return l.type==="color"&&typeof s=="string"?h=Zt.parse(s):l.type!=="padding"||typeof s!="number"&&!Array.isArray(s)?l.type==="variableAnchorOffsetCollection"&&Array.isArray(s)&&(h=Br.parse(s)):h=Tr.parse(s),{kind:"constant",evaluate:()=>h}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,s){return this.property.possiblyEvaluate(this,e,r,s)}}class Co{constructor(e){this.property=e,this.value=new Ia(e,void 0)}transitioned(e,r){return new Nl(this.property,this.value,r,Ge({},e.transition,this.transition),e.now)}untransitioned(){return new Nl(this.property,this.value,null,{},0)}}class $l{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return xt(this._values[e].value.value)}setValue(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Co(this._values[e].property)),this._values[e].value=new Ia(this._values[e].property,r===null?void 0:xt(r))}getTransition(e){return xt(this._values[e].transition)}setTransition(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Co(this._values[e].property)),this._values[e].transition=xt(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(e[r]=s);const l=this.getTransition(r);l!==void 0&&(e[`${r}-transition`]=l)}return e}transitioned(e,r){const s=new jl(this._properties);for(const l of Object.keys(this._values))s._values[l]=this._values[l].transitioned(e,r._values[l]);return s}untransitioned(){const e=new jl(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class Nl{constructor(e,r,s,l,h){this.property=e,this.value=r,this.begin=h+l.delay||0,this.end=this.begin+l.duration||0,e.specification.transition&&(l.delay||l.duration)&&(this.prior=s)}possiblyEvaluate(e,r,s){const l=e.now||0,h=this.value.possiblyEvaluate(e,r,s),p=this.prior;if(p){if(l>this.end)return this.prior=null,h;if(this.value.isDataDriven())return this.prior=null,h;if(l<this.begin)return p.possiblyEvaluate(e,r,s);{const g=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,r,s),h,function(v){if(v<=0)return 0;if(v>=1)return 1;const w=v*v,I=w*v;return 4*(v<.5?I:3*(v-w)+I-.75)}(g))}}return h}}class jl{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,s){const l=new Ea(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].possiblyEvaluate(e,r,s);return l}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Qc{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}hasValue(e){return this._values[e].value!==void 0}getValue(e){return xt(this._values[e].value)}setValue(e,r){this._values[e]=new Ia(this._values[e].property,r===null?void 0:xt(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(e[r]=s)}return e}possiblyEvaluate(e,r,s){const l=new Ea(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].possiblyEvaluate(e,r,s);return l}}class or{constructor(e,r,s){this.property=e,this.value=r,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,s,l){return this.property.evaluate(this.value,this.parameters,e,r,s,l)}}class Ea{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class tt{constructor(e){this.specification=e}possiblyEvaluate(e,r){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(r)}interpolate(e,r,s){const l=Ir[this.specification.type];return l?l(e,r,s):e}}class ut{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,s,l){return new or(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},s,l)}:e.expression,r)}interpolate(e,r,s){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new or(this,{kind:"constant",value:void 0},e.parameters);const l=Ir[this.specification.type];if(l){const h=l(e.value.value,r.value.value,s);return new or(this,{kind:"constant",value:h},e.parameters)}return e}evaluate(e,r,s,l,h,p){return e.kind==="constant"?e.value:e.evaluate(r,s,l,h,p)}}class Vs extends ut{possiblyEvaluate(e,r,s,l){if(e.value===void 0)return new or(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const h=e.expression.evaluate(r,null,{},s,l),p=e.property.specification.type==="resolvedImage"&&typeof h!="string"?h.name:h,g=this._calculate(p,p,p,r);return new or(this,{kind:"constant",value:g},r)}if(e.expression.kind==="camera"){const h=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new or(this,{kind:"constant",value:h},r)}return new or(this,e.expression,r)}evaluate(e,r,s,l,h,p){if(e.kind==="source"){const g=e.evaluate(r,s,l,h,p);return this._calculate(g,g,g,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},s,l),e.evaluate({zoom:Math.floor(r.zoom)},s,l),e.evaluate({zoom:Math.floor(r.zoom)+1},s,l),r):e.value}_calculate(e,r,s,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:s,to:r}}interpolate(e){return e}}class To{constructor(e){this.specification=e}possiblyEvaluate(e,r,s,l){if(e.value!==void 0){if(e.expression.kind==="constant"){const h=e.expression.evaluate(r,null,{},s,l);return this._calculate(h,h,h,r)}return this._calculate(e.expression.evaluate(new ii(Math.floor(r.zoom-1),r)),e.expression.evaluate(new ii(Math.floor(r.zoom),r)),e.expression.evaluate(new ii(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,s,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:s,to:r}}interpolate(e){return e}}class Io{constructor(e){this.specification=e}possiblyEvaluate(e,r,s,l){return!!e.expression.evaluate(r,null,{},s,l)}interpolate(){return!1}}class wi{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const s=e[r];s.specification.overridable&&this.overridableProperties.push(r);const l=this.defaultPropertyValues[r]=new Ia(s,void 0),h=this.defaultTransitionablePropertyValues[r]=new Co(s);this.defaultTransitioningPropertyValues[r]=h.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=l.possiblyEvaluate({})}}}He("DataDrivenProperty",ut),He("DataConstantProperty",tt),He("CrossFadedDataDrivenProperty",Vs),He("CrossFadedProperty",To),He("ColorRampProperty",Io);const Eo="-transition";class jr extends Cr{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new Qc(r.layout)),r.paint)){this._transitionablePaint=new $l(r.paint);for(const s in e.paint)this.setPaintProperty(s,e.paint[s],{validate:!1});for(const s in e.layout)this.setLayoutProperty(s,e.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ea(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,s={}){r!=null&&this._validate(Dl,`layers.${this.id}.layout.${e}`,e,r,s)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return e.endsWith(Eo)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,s={}){if(r!=null&&this._validate(fo,`layers.${this.id}.paint.${e}`,e,r,s))return!1;if(e.endsWith(Eo))return this._transitionablePaint.setTransition(e.slice(0,-11),r||void 0),!1;{const l=this._transitionablePaint._values[e],h=l.property.specification["property-type"]==="cross-faded-data-driven",p=l.value.isDataDriven(),g=l.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const v=this._transitionablePaint._values[e].value;return v.isDataDriven()||p||h||this._handleOverridablePaintPropertyUpdate(e,g,v)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,r,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),rt(e,(r,s)=>!(r===void 0||s==="layout"&&!Object.keys(r).length||s==="paint"&&!Object.keys(r).length))}_validate(e,r,s,l,h={}){return(!h||h.validate!==!1)&&Ca(this,e.call(mn,{key:r,layerType:this.type,objectKey:s,value:l,styleSpec:ge,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof or&&cs(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const Vl={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Gn{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class mi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function di(i,e=1){let r=0,s=0;return{members:i.map(l=>{const h=Vl[l.type].BYTES_PER_ELEMENT,p=r=fs(r,Math.max(e,h)),g=l.components||1;return s=Math.max(s,h),r+=h*g,{name:l.name,type:l.type,components:g,offset:p}}),size:fs(r,Math.max(s,e)),alignment:e}}function fs(i,e){return Math.ceil(i/e)*e}class Us extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const l=2*e;return this.int16[l+0]=r,this.int16[l+1]=s,e}}Us.prototype.bytesPerElement=4,He("StructArrayLayout2i4",Us);class qs extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,s)}emplace(e,r,s,l){const h=3*e;return this.int16[h+0]=r,this.int16[h+1]=s,this.int16[h+2]=l,e}}qs.prototype.bytesPerElement=6,He("StructArrayLayout3i6",qs);class Hn extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,s,l)}emplace(e,r,s,l,h){const p=4*e;return this.int16[p+0]=r,this.int16[p+1]=s,this.int16[p+2]=l,this.int16[p+3]=h,e}}Hn.prototype.bytesPerElement=8,He("StructArrayLayout4i8",Hn);class Po extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,l,h,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,r,s,l,h,p)}emplace(e,r,s,l,h,p,g){const v=6*e;return this.int16[v+0]=r,this.int16[v+1]=s,this.int16[v+2]=l,this.int16[v+3]=h,this.int16[v+4]=p,this.int16[v+5]=g,e}}Po.prototype.bytesPerElement=12,He("StructArrayLayout2i4i12",Po);class Ao extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,l,h,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,r,s,l,h,p)}emplace(e,r,s,l,h,p,g){const v=4*e,w=8*e;return this.int16[v+0]=r,this.int16[v+1]=s,this.uint8[w+4]=l,this.uint8[w+5]=h,this.uint8[w+6]=p,this.uint8[w+7]=g,e}}Ao.prototype.bytesPerElement=8,He("StructArrayLayout2i4ub8",Ao);class ms extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const l=2*e;return this.float32[l+0]=r,this.float32[l+1]=s,e}}ms.prototype.bytesPerElement=8,He("StructArrayLayout2f8",ms);class Mo extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,l,h,p,g,v,w,I){const A=this.length;return this.resize(A+1),this.emplace(A,e,r,s,l,h,p,g,v,w,I)}emplace(e,r,s,l,h,p,g,v,w,I,A){const z=10*e;return this.uint16[z+0]=r,this.uint16[z+1]=s,this.uint16[z+2]=l,this.uint16[z+3]=h,this.uint16[z+4]=p,this.uint16[z+5]=g,this.uint16[z+6]=v,this.uint16[z+7]=w,this.uint16[z+8]=I,this.uint16[z+9]=A,e}}Mo.prototype.bytesPerElement=20,He("StructArrayLayout10ui20",Mo);class ko extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,l,h,p,g,v,w,I,A,z){const R=this.length;return this.resize(R+1),this.emplace(R,e,r,s,l,h,p,g,v,w,I,A,z)}emplace(e,r,s,l,h,p,g,v,w,I,A,z,R){const O=12*e;return this.int16[O+0]=r,this.int16[O+1]=s,this.int16[O+2]=l,this.int16[O+3]=h,this.uint16[O+4]=p,this.uint16[O+5]=g,this.uint16[O+6]=v,this.uint16[O+7]=w,this.int16[O+8]=I,this.int16[O+9]=A,this.int16[O+10]=z,this.int16[O+11]=R,e}}ko.prototype.bytesPerElement=24,He("StructArrayLayout4i4ui4i24",ko);class Nt extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,s)}emplace(e,r,s,l){const h=3*e;return this.float32[h+0]=r,this.float32[h+1]=s,this.float32[h+2]=l,e}}Nt.prototype.bytesPerElement=12,He("StructArrayLayout3f12",Nt);class u extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}u.prototype.bytesPerElement=4,He("StructArrayLayout1ul4",u);class t extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,l,h,p,g,v,w){const I=this.length;return this.resize(I+1),this.emplace(I,e,r,s,l,h,p,g,v,w)}emplace(e,r,s,l,h,p,g,v,w,I){const A=10*e,z=5*e;return this.int16[A+0]=r,this.int16[A+1]=s,this.int16[A+2]=l,this.int16[A+3]=h,this.int16[A+4]=p,this.int16[A+5]=g,this.uint32[z+3]=v,this.uint16[A+8]=w,this.uint16[A+9]=I,e}}t.prototype.bytesPerElement=20,He("StructArrayLayout6i1ul2ui20",t);class n extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,l,h,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,r,s,l,h,p)}emplace(e,r,s,l,h,p,g){const v=6*e;return this.int16[v+0]=r,this.int16[v+1]=s,this.int16[v+2]=l,this.int16[v+3]=h,this.int16[v+4]=p,this.int16[v+5]=g,e}}n.prototype.bytesPerElement=12,He("StructArrayLayout2i2i2i12",n);class o extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,s,l,h)}emplace(e,r,s,l,h,p){const g=4*e,v=8*e;return this.float32[g+0]=r,this.float32[g+1]=s,this.float32[g+2]=l,this.int16[v+6]=h,this.int16[v+7]=p,e}}o.prototype.bytesPerElement=16,He("StructArrayLayout2f1f2i16",o);class c extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,s,l)}emplace(e,r,s,l,h){const p=12*e,g=3*e;return this.uint8[p+0]=r,this.uint8[p+1]=s,this.float32[g+1]=l,this.float32[g+2]=h,e}}c.prototype.bytesPerElement=12,He("StructArrayLayout2ub2f12",c);class d extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,s)}emplace(e,r,s,l){const h=3*e;return this.uint16[h+0]=r,this.uint16[h+1]=s,this.uint16[h+2]=l,e}}d.prototype.bytesPerElement=6,He("StructArrayLayout3ui6",d);class _ extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,l,h,p,g,v,w,I,A,z,R,O,j,X,Y){const oe=this.length;return this.resize(oe+1),this.emplace(oe,e,r,s,l,h,p,g,v,w,I,A,z,R,O,j,X,Y)}emplace(e,r,s,l,h,p,g,v,w,I,A,z,R,O,j,X,Y,oe){const ee=24*e,ce=12*e,de=48*e;return this.int16[ee+0]=r,this.int16[ee+1]=s,this.uint16[ee+2]=l,this.uint16[ee+3]=h,this.uint32[ce+2]=p,this.uint32[ce+3]=g,this.uint32[ce+4]=v,this.uint16[ee+10]=w,this.uint16[ee+11]=I,this.uint16[ee+12]=A,this.float32[ce+7]=z,this.float32[ce+8]=R,this.uint8[de+36]=O,this.uint8[de+37]=j,this.uint8[de+38]=X,this.uint32[ce+10]=Y,this.int16[ee+22]=oe,e}}_.prototype.bytesPerElement=48,He("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",_);class y extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,l,h,p,g,v,w,I,A,z,R,O,j,X,Y,oe,ee,ce,de,we,qe,Je,Ve,$e,Fe,We){const Be=this.length;return this.resize(Be+1),this.emplace(Be,e,r,s,l,h,p,g,v,w,I,A,z,R,O,j,X,Y,oe,ee,ce,de,we,qe,Je,Ve,$e,Fe,We)}emplace(e,r,s,l,h,p,g,v,w,I,A,z,R,O,j,X,Y,oe,ee,ce,de,we,qe,Je,Ve,$e,Fe,We,Be){const Ae=32*e,st=16*e;return this.int16[Ae+0]=r,this.int16[Ae+1]=s,this.int16[Ae+2]=l,this.int16[Ae+3]=h,this.int16[Ae+4]=p,this.int16[Ae+5]=g,this.int16[Ae+6]=v,this.int16[Ae+7]=w,this.uint16[Ae+8]=I,this.uint16[Ae+9]=A,this.uint16[Ae+10]=z,this.uint16[Ae+11]=R,this.uint16[Ae+12]=O,this.uint16[Ae+13]=j,this.uint16[Ae+14]=X,this.uint16[Ae+15]=Y,this.uint16[Ae+16]=oe,this.uint16[Ae+17]=ee,this.uint16[Ae+18]=ce,this.uint16[Ae+19]=de,this.uint16[Ae+20]=we,this.uint16[Ae+21]=qe,this.uint16[Ae+22]=Je,this.uint32[st+12]=Ve,this.float32[st+13]=$e,this.float32[st+14]=Fe,this.uint16[Ae+30]=We,this.uint16[Ae+31]=Be,e}}y.prototype.bytesPerElement=64,He("StructArrayLayout8i15ui1ul2f2ui64",y);class x extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}x.prototype.bytesPerElement=4,He("StructArrayLayout1f4",x);class C extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,s)}emplace(e,r,s,l){const h=3*e;return this.uint16[6*e+0]=r,this.float32[h+1]=s,this.float32[h+2]=l,e}}C.prototype.bytesPerElement=12,He("StructArrayLayout1ui2f12",C);class E extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,s)}emplace(e,r,s,l){const h=4*e;return this.uint32[2*e+0]=r,this.uint16[h+2]=s,this.uint16[h+3]=l,e}}E.prototype.bytesPerElement=8,He("StructArrayLayout1ul2ui8",E);class P extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const l=2*e;return this.uint16[l+0]=r,this.uint16[l+1]=s,e}}P.prototype.bytesPerElement=4,He("StructArrayLayout2ui4",P);class L extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}L.prototype.bytesPerElement=2,He("StructArrayLayout1ui2",L);class U extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,s,l)}emplace(e,r,s,l,h){const p=4*e;return this.float32[p+0]=r,this.float32[p+1]=s,this.float32[p+2]=l,this.float32[p+3]=h,e}}U.prototype.bytesPerElement=16,He("StructArrayLayout4f16",U);class V extends Gn{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new ue(this.anchorPointX,this.anchorPointY)}}V.prototype.size=20;class G extends t{get(e){return new V(this,e)}}He("CollisionBoxArray",G);class N extends Gn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}N.prototype.size=48;class re extends _{get(e){return new N(this,e)}}He("PlacedSymbolArray",re);class he extends Gn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}he.prototype.size=64;class J extends y{get(e){return new he(this,e)}}He("SymbolInstanceArray",J);class se extends x{getoffsetX(e){return this.float32[1*e+0]}}He("GlyphOffsetArray",se);class pe extends qs{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}He("SymbolLineVertexArray",pe);class fe extends Gn{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}fe.prototype.size=12;class be extends C{get(e){return new fe(this,e)}}He("TextAnchorOffsetArray",be);class Pe extends Gn{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Pe.prototype.size=8;class Ce extends E{get(e){return new Pe(this,e)}}He("FeatureIndexArray",Ce);class Le extends Us{}class Ke extends Us{}class Tt extends Us{}class Oe extends Po{}class ht extends Ao{}class Qe extends ms{}class Gt extends Mo{}class Ct extends ko{}class bt extends Nt{}class It extends u{}class yi extends n{}class ti extends c{}class Hi extends d{}class zi extends P{}const Si=di([{name:"a_pos",components:2,type:"Int16"}],4),{members:Mr}=Si;class ri{constructor(e=[]){this.segments=e}prepareSegment(e,r,s,l){let h=this.segments[this.segments.length-1];return e>ri.MAX_VERTEX_ARRAY_LENGTH&&gt(`Max vertices per segment is ${ri.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!h||h.vertexLength+e>ri.MAX_VERTEX_ARRAY_LENGTH||h.sortKey!==l)&&(h={vertexOffset:r.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},l!==void 0&&(h.sortKey=l),this.segments.push(h)),h}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,s,l){return new ri([{vertexOffset:e,primitiveOffset:r,vertexLength:s,primitiveLength:l,vaos:{},sortKey:0}])}}function rn(i,e){return 256*(i=it(Math.floor(i),0,255))+it(Math.floor(e),0,255)}ri.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,He("SegmentVector",ri);const nn=di([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Ln={exports:{}},Wn={exports:{}};Wn.exports=function(i,e){var r,s,l,h,p,g,v,w;for(s=i.length-(r=3&i.length),l=e,p=3432918353,g=461845907,w=0;w<s;)v=255&i.charCodeAt(w)|(255&i.charCodeAt(++w))<<8|(255&i.charCodeAt(++w))<<16|(255&i.charCodeAt(++w))<<24,++w,l=27492+(65535&(h=5*(65535&(l=(l^=v=(65535&(v=(v=(65535&v)*p+(((v>>>16)*p&65535)<<16)&4294967295)<<15|v>>>17))*g+(((v>>>16)*g&65535)<<16)&4294967295)<<13|l>>>19))+((5*(l>>>16)&65535)<<16)&4294967295))+((58964+(h>>>16)&65535)<<16);switch(v=0,r){case 3:v^=(255&i.charCodeAt(w+2))<<16;case 2:v^=(255&i.charCodeAt(w+1))<<8;case 1:l^=v=(65535&(v=(v=(65535&(v^=255&i.charCodeAt(w)))*p+(((v>>>16)*p&65535)<<16)&4294967295)<<15|v>>>17))*g+(((v>>>16)*g&65535)<<16)&4294967295}return l^=i.length,l=2246822507*(65535&(l^=l>>>16))+((2246822507*(l>>>16)&65535)<<16)&4294967295,l=3266489909*(65535&(l^=l>>>13))+((3266489909*(l>>>16)&65535)<<16)&4294967295,(l^=l>>>16)>>>0};var gs=Wn.exports,er={exports:{}};er.exports=function(i,e){for(var r,s=i.length,l=e^s,h=0;s>=4;)r=1540483477*(65535&(r=255&i.charCodeAt(h)|(255&i.charCodeAt(++h))<<8|(255&i.charCodeAt(++h))<<16|(255&i.charCodeAt(++h))<<24))+((1540483477*(r>>>16)&65535)<<16),l=1540483477*(65535&l)+((1540483477*(l>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),s-=4,++h;switch(s){case 3:l^=(255&i.charCodeAt(h+2))<<16;case 2:l^=(255&i.charCodeAt(h+1))<<8;case 1:l=1540483477*(65535&(l^=255&i.charCodeAt(h)))+((1540483477*(l>>>16)&65535)<<16)}return l=1540483477*(65535&(l^=l>>>13))+((1540483477*(l>>>16)&65535)<<16),(l^=l>>>15)>>>0};var Wi=gs,lr=er.exports;Ln.exports=Wi,Ln.exports.murmur3=Wi,Ln.exports.murmur2=lr;var Xn=F(Ln.exports);class vi{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,s,l){this.ids.push(Di(e)),this.positions.push(r,s,l)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=Di(e);let s=0,l=this.ids.length-1;for(;s<l;){const p=s+l>>1;this.ids[p]>=r?l=p:s=p+1}const h=[];for(;this.ids[s]===r;)h.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return h}static serialize(e,r){const s=new Float64Array(e.ids),l=new Uint32Array(e.positions);return yr(s,l,0,s.length-1),r&&r.push(s.buffer,l.buffer),{ids:s,positions:l}}static deserialize(e){const r=new vi;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function Di(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:Xn(String(i))}function yr(i,e,r,s){for(;r<s;){const l=i[r+s>>1];let h=r-1,p=s+1;for(;;){do h++;while(i[h]<l);do p--;while(i[p]>l);if(h>=p)break;xi(i,h,p),xi(e,3*h,3*p),xi(e,3*h+1,3*p+1),xi(e,3*h+2,3*p+2)}p-r<s-p?(yr(i,e,r,p),r=p+1):(yr(i,e,p+1,s),s=p)}}function xi(i,e,r){const s=i[e];i[e]=i[r],i[r]=s}He("FeaturePositionMap",vi);class Kn{constructor(e,r){this.gl=e.gl,this.location=r}}class Pa extends Kn{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Ul extends Kn{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class ql extends Kn{constructor(e,r){super(e,r),this.current=Zt.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const eu=new Float32Array(16);function zo(i){return[rn(255*i.r,255*i.g),rn(255*i.b,255*i.a)]}class sn{constructor(e,r,s){this.value=e,this.uniformNames=r.map(l=>`u_${l}`),this.type=s}setUniform(e,r,s){e.set(s.constantOr(this.value))}getBinding(e,r,s){return this.type==="color"?new ql(e,r):new Pa(e,r)}}class Jn{constructor(e,r){this.uniformNames=r.map(s=>`u_${s}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=e.tlbr}setUniform(e,r,s,l){const h=l==="u_pattern_to"?this.patternTo:l==="u_pattern_from"?this.patternFrom:l==="u_pixel_ratio_to"?this.pixelRatioTo:l==="u_pixel_ratio_from"?this.pixelRatioFrom:null;h&&e.set(h)}getBinding(e,r,s){return s.substr(0,9)==="u_pattern"?new Ul(e,r):new Pa(e,r)}}class an{constructor(e,r,s,l){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=r.map(h=>({name:`a_${h}`,type:"Float32",components:s==="color"?2:1,offset:0})),this.paintVertexArray=new l}populatePaintArray(e,r,s,l,h){const p=this.paintVertexArray.length,g=this.expression.evaluate(new ii(0),r,{},l,[],h);this.paintVertexArray.resize(e),this._setPaintValue(p,e,g)}updatePaintArray(e,r,s,l){const h=this.expression.evaluate({zoom:0},s,l);this._setPaintValue(e,r,h)}_setPaintValue(e,r,s){if(this.type==="color"){const l=zo(s);for(let h=e;h<r;h++)this.paintVertexArray.emplace(h,l[0],l[1])}else{for(let l=e;l<r;l++)this.paintVertexArray.emplace(l,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Vr{constructor(e,r,s,l,h,p){this.expression=e,this.uniformNames=r.map(g=>`u_${g}_t`),this.type=s,this.useIntegerZoom=l,this.zoom=h,this.maxValue=0,this.paintVertexAttributes=r.map(g=>({name:`a_${g}`,type:"Float32",components:s==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,r,s,l,h){const p=this.expression.evaluate(new ii(this.zoom),r,{},l,[],h),g=this.expression.evaluate(new ii(this.zoom+1),r,{},l,[],h),v=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(v,e,p,g)}updatePaintArray(e,r,s,l){const h=this.expression.evaluate({zoom:this.zoom},s,l),p=this.expression.evaluate({zoom:this.zoom+1},s,l);this._setPaintValue(e,r,h,p)}_setPaintValue(e,r,s,l){if(this.type==="color"){const h=zo(s),p=zo(l);for(let g=e;g<r;g++)this.paintVertexArray.emplace(g,h[0],h[1],p[0],p[1])}else{for(let h=e;h<r;h++)this.paintVertexArray.emplace(h,s,l);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const s=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,l=it(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);e.set(l)}getBinding(e,r,s){return new Pa(e,r)}}class on{constructor(e,r,s,l,h,p){this.expression=e,this.type=r,this.useIntegerZoom=s,this.zoom=l,this.layerId=p,this.zoomInPaintVertexArray=new h,this.zoomOutPaintVertexArray=new h}populatePaintArray(e,r,s){const l=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(l,e,r.patterns&&r.patterns[this.layerId],s)}updatePaintArray(e,r,s,l,h){this._setPaintValues(e,r,s.patterns&&s.patterns[this.layerId],h)}_setPaintValues(e,r,s,l){if(!l||!s)return;const{min:h,mid:p,max:g}=s,v=l[h],w=l[p],I=l[g];if(v&&w&&I)for(let A=e;A<r;A++)this.zoomInPaintVertexArray.emplace(A,w.tl[0],w.tl[1],w.br[0],w.br[1],v.tl[0],v.tl[1],v.br[0],v.br[1],w.pixelRatio,v.pixelRatio),this.zoomOutPaintVertexArray.emplace(A,w.tl[0],w.tl[1],w.br[0],w.br[1],I.tl[0],I.tl[1],I.br[0],I.br[1],w.pixelRatio,I.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,nn.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,nn.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Do{constructor(e,r,s){this.binders={},this._buffers=[];const l=[];for(const h in e.paint._values){if(!s(h))continue;const p=e.paint.get(h);if(!(p instanceof or&&cs(p.property.specification)))continue;const g=xm(h,e.type),v=p.value,w=p.property.specification.type,I=p.property.useIntegerZoom,A=p.property.specification["property-type"],z=A==="cross-faded"||A==="cross-faded-data-driven";if(v.kind==="constant")this.binders[h]=z?new Jn(v.value,g):new sn(v.value,g,w),l.push(`/u_${h}`);else if(v.kind==="source"||z){const R=Fh(h,w,"source");this.binders[h]=z?new on(v,w,I,r,R,e.id):new an(v,g,w,R),l.push(`/a_${h}`)}else{const R=Fh(h,w,"composite");this.binders[h]=new Vr(v,g,w,I,r,R),l.push(`/z_${h}`)}}this.cacheKey=l.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof an||r instanceof Vr?r.maxValue:0}populatePaintArrays(e,r,s,l,h){for(const p in this.binders){const g=this.binders[p];(g instanceof an||g instanceof Vr||g instanceof on)&&g.populatePaintArray(e,r,s,l,h)}}setConstantPatternPositions(e,r){for(const s in this.binders){const l=this.binders[s];l instanceof Jn&&l.setConstantPatternPositions(e,r)}}updatePaintArrays(e,r,s,l,h){let p=!1;for(const g in e){const v=r.getPositions(g);for(const w of v){const I=s.feature(w.index);for(const A in this.binders){const z=this.binders[A];if((z instanceof an||z instanceof Vr||z instanceof on)&&z.expression.isStateDependent===!0){const R=l.paint.get(A);z.expression=R.value,z.updatePaintArray(w.start,w.end,I,e[g],h),p=!0}}}}return p}defines(){const e=[];for(const r in this.binders){const s=this.binders[r];(s instanceof sn||s instanceof Jn)&&e.push(...s.uniformNames.map(l=>`#define HAS_UNIFORM_${l}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof an||s instanceof Vr)for(let l=0;l<s.paintVertexAttributes.length;l++)e.push(s.paintVertexAttributes[l].name);else if(s instanceof on)for(let l=0;l<nn.members.length;l++)e.push(nn.members[l].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof sn||s instanceof Jn||s instanceof Vr)for(const l of s.uniformNames)e.push(l)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const s=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof sn||h instanceof Jn||h instanceof Vr){for(const p of h.uniformNames)if(r[p]){const g=h.getBinding(e,r[p],p);s.push({name:p,property:l,binding:g})}}}return s}setUniforms(e,r,s,l){for(const{name:h,property:p,binding:g}of r)this.binders[p].setUniform(g,l,s.get(p),h)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const s=this.binders[r];if(e&&s instanceof on){const l=e.fromScale===2?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;l&&this._buffers.push(l)}else(s instanceof an||s instanceof Vr)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(e){for(const r in this.binders){const s=this.binders[r];(s instanceof an||s instanceof Vr||s instanceof on)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof an||r instanceof Vr||r instanceof on)&&r.destroy()}}}class _n{constructor(e,r,s=()=>!0){this.programConfigurations={};for(const l of e)this.programConfigurations[l.id]=new Do(l,r,s);this.needsUpload=!1,this._featureMap=new vi,this._bufferOffset=0}populatePaintArrays(e,r,s,l,h,p){for(const g in this.programConfigurations)this.programConfigurations[g].populatePaintArrays(e,r,l,h,p);r.id!==void 0&&this._featureMap.add(r.id,s,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,s,l){for(const h of s)this.needsUpload=this.programConfigurations[h.id].updatePaintArrays(e,this._featureMap,r,h,l)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function xm(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function Fh(i,e,r){const s={color:{source:ms,composite:U},number:{source:x,composite:ms}},l=function(h){return{"line-pattern":{source:Gt,composite:Gt},"fill-pattern":{source:Gt,composite:Gt},"fill-extrusion-pattern":{source:Gt,composite:Gt}}[h]}(i);return l&&l[r]||s[e][r]}He("ConstantBinder",sn),He("CrossFadedConstantBinder",Jn),He("SourceExpressionBinder",an),He("CrossFadedCompositeBinder",on),He("CompositeExpressionBinder",Vr),He("ProgramConfiguration",Do,{omit:["_buffers"]}),He("ProgramConfigurationSet",_n);const Pi=8192,tu=Math.pow(2,14)-1,Bh=-tu-1;function Zs(i){const e=Pi/i.extent,r=i.loadGeometry();for(let s=0;s<r.length;s++){const l=r[s];for(let h=0;h<l.length;h++){const p=l[h],g=Math.round(p.x*e),v=Math.round(p.y*e);p.x=it(g,Bh,tu),p.y=it(v,Bh,tu),(g<p.x||g>p.x+1||v<p.y||v>p.y+1)&&gt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function Gs(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?Zs(i):[]}}function Zl(i,e,r,s,l){i.emplaceBack(2*e+(s+1)/2,2*r+(l+1)/2)}class iu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Ke,this.indexArray=new Hi,this.segments=new ri,this.programConfigurations=new _n(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){const l=this.layers[0],h=[];let p=null,g=!1;l.type==="circle"&&(p=l.layout.get("circle-sort-key"),g=!p.isConstant());for(const{feature:v,id:w,index:I,sourceLayerIndex:A}of e){const z=this.layers[0]._featureFilter.needGeometry,R=Gs(v,z);if(!this.layers[0]._featureFilter.filter(new ii(this.zoom),R,s))continue;const O=g?p.evaluate(R,{},s):void 0,j={id:w,properties:v.properties,type:v.type,sourceLayerIndex:A,index:I,geometry:z?R.geometry:Zs(v),patterns:{},sortKey:O};h.push(j)}g&&h.sort((v,w)=>v.sortKey-w.sortKey);for(const v of h){const{geometry:w,index:I,sourceLayerIndex:A}=v,z=e[I].feature;this.addFeature(v,w,I,s),r.featureIndex.insert(z,w,I,A,this.index)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Mr),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,s,l){for(const h of r)for(const p of h){const g=p.x,v=p.y;if(g<0||g>=Pi||v<0||v>=Pi)continue;const w=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),I=w.vertexLength;Zl(this.layoutVertexArray,g,v,-1,-1),Zl(this.layoutVertexArray,g,v,1,-1),Zl(this.layoutVertexArray,g,v,1,1),Zl(this.layoutVertexArray,g,v,-1,1),this.indexArray.emplaceBack(I,I+1,I+2),this.indexArray.emplaceBack(I,I+3,I+2),w.vertexLength+=4,w.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},l)}}function Oh(i,e){for(let r=0;r<i.length;r++)if(Aa(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(Aa(i,e[r]))return!0;return!!ru(i,e)}function bm(i,e,r){return!!Aa(i,e)||!!nu(e,i,r)}function $h(i,e){if(i.length===1)return jh(e,i[0]);for(let r=0;r<e.length;r++){const s=e[r];for(let l=0;l<s.length;l++)if(Aa(i,s[l]))return!0}for(let r=0;r<i.length;r++)if(jh(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(ru(i,e[r]))return!0;return!1}function wm(i,e,r){if(i.length>1){if(ru(i,e))return!0;for(let s=0;s<e.length;s++)if(nu(e[s],i,r))return!0}for(let s=0;s<i.length;s++)if(nu(i[s],e,r))return!0;return!1}function ru(i,e){if(i.length===0||e.length===0)return!1;for(let r=0;r<i.length-1;r++){const s=i[r],l=i[r+1];for(let h=0;h<e.length-1;h++)if(Sm(s,l,e[h],e[h+1]))return!0}return!1}function Sm(i,e,r,s){return At(i,r,s)!==At(e,r,s)&&At(i,e,r)!==At(i,e,s)}function nu(i,e,r){const s=r*r;if(e.length===1)return i.distSqr(e[0])<s;for(let l=1;l<e.length;l++)if(Nh(i,e[l-1],e[l])<s)return!0;return!1}function Nh(i,e,r){const s=e.distSqr(r);if(s===0)return i.distSqr(e);const l=((i.x-e.x)*(r.x-e.x)+(i.y-e.y)*(r.y-e.y))/s;return i.distSqr(l<0?e:l>1?r:r.sub(e)._mult(l)._add(e))}function jh(i,e){let r,s,l,h=!1;for(let p=0;p<i.length;p++){r=i[p];for(let g=0,v=r.length-1;g<r.length;v=g++)s=r[g],l=r[v],s.y>e.y!=l.y>e.y&&e.x<(l.x-s.x)*(e.y-s.y)/(l.y-s.y)+s.x&&(h=!h)}return h}function Aa(i,e){let r=!1;for(let s=0,l=i.length-1;s<i.length;l=s++){const h=i[s],p=i[l];h.y>e.y!=p.y>e.y&&e.x<(p.x-h.x)*(e.y-h.y)/(p.y-h.y)+h.x&&(r=!r)}return r}function Cm(i,e,r){const s=r[0],l=r[2];if(i.x<s.x&&e.x<s.x||i.x>l.x&&e.x>l.x||i.y<s.y&&e.y<s.y||i.y>l.y&&e.y>l.y)return!1;const h=At(i,e,r[0]);return h!==At(i,e,r[1])||h!==At(i,e,r[2])||h!==At(i,e,r[3])}function Lo(i,e,r){const s=e.paint.get(i).value;return s.kind==="constant"?s.value:r.programConfigurations.get(e.id).getMaxValue(i)}function Gl(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Hl(i,e,r,s,l){if(!e[0]&&!e[1])return i;const h=ue.convert(e)._mult(l);r==="viewport"&&h._rotate(-s);const p=[];for(let g=0;g<i.length;g++)p.push(i[g].sub(h));return p}let Vh,Uh;He("CircleBucket",iu,{omit:["layers"]});var Tm={get paint(){return Uh=Uh||new wi({"circle-radius":new ut(ge.paint_circle["circle-radius"]),"circle-color":new ut(ge.paint_circle["circle-color"]),"circle-blur":new ut(ge.paint_circle["circle-blur"]),"circle-opacity":new ut(ge.paint_circle["circle-opacity"]),"circle-translate":new tt(ge.paint_circle["circle-translate"]),"circle-translate-anchor":new tt(ge.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new tt(ge.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new tt(ge.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ut(ge.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ut(ge.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ut(ge.paint_circle["circle-stroke-opacity"])})},get layout(){return Vh=Vh||new wi({"circle-sort-key":new ut(ge.layout_circle["circle-sort-key"])})}},vr=1e-6,Ma=typeof Float32Array<"u"?Float32Array:Array;function su(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function qh(i,e,r){var s=e[0],l=e[1],h=e[2],p=e[3],g=e[4],v=e[5],w=e[6],I=e[7],A=e[8],z=e[9],R=e[10],O=e[11],j=e[12],X=e[13],Y=e[14],oe=e[15],ee=r[0],ce=r[1],de=r[2],we=r[3];return i[0]=ee*s+ce*g+de*A+we*j,i[1]=ee*l+ce*v+de*z+we*X,i[2]=ee*h+ce*w+de*R+we*Y,i[3]=ee*p+ce*I+de*O+we*oe,i[4]=(ee=r[4])*s+(ce=r[5])*g+(de=r[6])*A+(we=r[7])*j,i[5]=ee*l+ce*v+de*z+we*X,i[6]=ee*h+ce*w+de*R+we*Y,i[7]=ee*p+ce*I+de*O+we*oe,i[8]=(ee=r[8])*s+(ce=r[9])*g+(de=r[10])*A+(we=r[11])*j,i[9]=ee*l+ce*v+de*z+we*X,i[10]=ee*h+ce*w+de*R+we*Y,i[11]=ee*p+ce*I+de*O+we*oe,i[12]=(ee=r[12])*s+(ce=r[13])*g+(de=r[14])*A+(we=r[15])*j,i[13]=ee*l+ce*v+de*z+we*X,i[14]=ee*h+ce*w+de*R+we*Y,i[15]=ee*p+ce*I+de*O+we*oe,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var Ro,Im=qh;function Wl(i,e,r){var s=e[0],l=e[1],h=e[2],p=e[3];return i[0]=r[0]*s+r[4]*l+r[8]*h+r[12]*p,i[1]=r[1]*s+r[5]*l+r[9]*h+r[13]*p,i[2]=r[2]*s+r[6]*l+r[10]*h+r[14]*p,i[3]=r[3]*s+r[7]*l+r[11]*h+r[15]*p,i}Ro=new Ma(4),Ma!=Float32Array&&(Ro[0]=0,Ro[1]=0,Ro[2]=0,Ro[3]=0);class Em extends jr{constructor(e){super(e,Tm)}createBucket(e){return new iu(e)}queryRadius(e){const r=e;return Lo("circle-radius",this,r)+Lo("circle-stroke-width",this,r)+Gl(this.paint.get("circle-translate"))}queryIntersectsFeature(e,r,s,l,h,p,g,v){const w=Hl(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,g),I=this.paint.get("circle-radius").evaluate(r,s)+this.paint.get("circle-stroke-width").evaluate(r,s),A=this.paint.get("circle-pitch-alignment")==="map",z=A?w:function(O,j){return O.map(X=>Zh(X,j))}(w,v),R=A?I*g:I;for(const O of l)for(const j of O){const X=A?j:Zh(j,v);let Y=R;const oe=Wl([],[j.x,j.y,0,1],v);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Y*=oe[3]/p.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Y*=p.cameraToCenterDistance/oe[3]),bm(z,X,Y))return!0}return!1}}function Zh(i,e){const r=Wl([],[i.x,i.y,0,1],e);return new ue(r[0]/r[3],r[1]/r[3])}class Gh extends iu{}let Hh;He("HeatmapBucket",Gh,{omit:["layers"]});var Pm={get paint(){return Hh=Hh||new wi({"heatmap-radius":new ut(ge.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ut(ge.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new tt(ge.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Io(ge.paint_heatmap["heatmap-color"]),"heatmap-opacity":new tt(ge.paint_heatmap["heatmap-opacity"])})}};function au(i,{width:e,height:r},s,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==e*r*s)throw new RangeError(`mismatched image size. expected: ${l.length} but got: ${e*r*s}`)}else l=new Uint8Array(e*r*s);return i.width=e,i.height=r,i.data=l,i}function Wh(i,{width:e,height:r},s){if(e===i.width&&r===i.height)return;const l=au({},{width:e,height:r},s);ou(i,l,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,r)},s),i.width=e,i.height=r,i.data=l.data}function ou(i,e,r,s,l,h){if(l.width===0||l.height===0)return e;if(l.width>i.width||l.height>i.height||r.x>i.width-l.width||r.y>i.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>e.width||l.height>e.height||s.x>e.width-l.width||s.y>e.height-l.height)throw new RangeError("out of range destination coordinates for image copy");const p=i.data,g=e.data;if(p===g)throw new Error("srcData equals dstData, so image is already copied");for(let v=0;v<l.height;v++){const w=((r.y+v)*i.width+r.x)*h,I=((s.y+v)*e.width+s.x)*h;for(let A=0;A<l.width*h;A++)g[I+A]=p[w+A]}return e}class Fo{constructor(e,r){au(this,e,1,r)}resize(e){Wh(this,e,1)}clone(){return new Fo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,s,l,h){ou(e,r,s,l,h,1)}}class Gr{constructor(e,r){au(this,e,4,r)}resize(e){Wh(this,e,4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Gr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,s,l,h){ou(e,r,s,l,h,4)}}function Xh(i){const e={},r=i.resolution||256,s=i.clips?i.clips.length:1,l=i.image||new Gr({width:r,height:s});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const h=(p,g,v)=>{e[i.evaluationKey]=v;const w=i.expression.evaluate(e);l.data[p+g+0]=Math.floor(255*w.r/w.a),l.data[p+g+1]=Math.floor(255*w.g/w.a),l.data[p+g+2]=Math.floor(255*w.b/w.a),l.data[p+g+3]=Math.floor(255*w.a)};if(i.clips)for(let p=0,g=0;p<s;++p,g+=4*r)for(let v=0,w=0;v<r;v++,w+=4){const I=v/(r-1),{start:A,end:z}=i.clips[p];h(g,w,A*(1-I)+z*I)}else for(let p=0,g=0;p<r;p++,g+=4)h(0,g,p/(r-1));return l}He("AlphaImage",Fo),He("RGBAImage",Gr);class Am extends jr{createBucket(e){return new Gh(e)}constructor(e){super(e,Pm),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Xh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Kh;var Mm={get paint(){return Kh=Kh||new wi({"hillshade-illumination-direction":new tt(ge.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new tt(ge.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new tt(ge.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new tt(ge.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new tt(ge.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new tt(ge.paint_hillshade["hillshade-accent-color"])})}};class km extends jr{constructor(e){super(e,Mm)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const zm=di([{name:"a_pos",components:2,type:"Int16"}],4),{members:Dm}=zm;var lu={exports:{}};function Xl(i,e,r){r=r||2;var s,l,h,p,g,v,w,I=e&&e.length,A=I?e[0]*r:i.length,z=Jh(i,0,A,r,!0),R=[];if(!z||z.next===z.prev)return R;if(I&&(z=function(j,X,Y,oe){var ee,ce,de,we=[];for(ee=0,ce=X.length;ee<ce;ee++)(de=Jh(j,X[ee]*oe,ee<ce-1?X[ee+1]*oe:j.length,oe,!1))===de.next&&(de.steiner=!0),we.push(jm(de));for(we.sort(Om),ee=0;ee<we.length;ee++)Y=$m(we[ee],Y);return Y}(i,e,z,r)),i.length>80*r){s=h=i[0],l=p=i[1];for(var O=r;O<A;O+=r)(g=i[O])<s&&(s=g),(v=i[O+1])<l&&(l=v),g>h&&(h=g),v>p&&(p=v);w=(w=Math.max(h-s,p-l))!==0?32767/w:0}return Bo(z,R,r,s,l,w,0),R}function Jh(i,e,r,s,l){var h,p;if(l===hu(i,e,r,s)>0)for(h=e;h<r;h+=s)p=ed(h,i[h],i[h+1],p);else for(h=r-s;h>=e;h-=s)p=ed(h,i[h],i[h+1],p);return p&&Kl(p,p.next)&&($o(p),p=p.next),p}function Hs(i,e){if(!i)return i;e||(e=i);var r,s=i;do if(r=!1,s.steiner||!Kl(s,s.next)&&Ci(s.prev,s,s.next)!==0)s=s.next;else{if($o(s),(s=e=s.prev)===s.next)break;r=!0}while(r||s!==e);return e}function Bo(i,e,r,s,l,h,p){if(i){!p&&h&&function(I,A,z,R){var O=I;do O.z===0&&(O.z=cu(O.x,O.y,A,z,R)),O.prevZ=O.prev,O.nextZ=O.next,O=O.next;while(O!==I);O.prevZ.nextZ=null,O.prevZ=null,function(j){var X,Y,oe,ee,ce,de,we,qe,Je=1;do{for(Y=j,j=null,ce=null,de=0;Y;){for(de++,oe=Y,we=0,X=0;X<Je&&(we++,oe=oe.nextZ);X++);for(qe=Je;we>0||qe>0&&oe;)we!==0&&(qe===0||!oe||Y.z<=oe.z)?(ee=Y,Y=Y.nextZ,we--):(ee=oe,oe=oe.nextZ,qe--),ce?ce.nextZ=ee:j=ee,ee.prevZ=ce,ce=ee;Y=oe}ce.nextZ=null,Je*=2}while(de>1)}(O)}(i,s,l,h);for(var g,v,w=i;i.prev!==i.next;)if(g=i.prev,v=i.next,h?Rm(i,s,l,h):Lm(i))e.push(g.i/r|0),e.push(i.i/r|0),e.push(v.i/r|0),$o(i),i=v.next,w=v.next;else if((i=v)===w){p?p===1?Bo(i=Fm(Hs(i),e,r),e,r,s,l,h,2):p===2&&Bm(i,e,r,s,l,h):Bo(Hs(i),e,r,s,l,h,1);break}}}function Lm(i){var e=i.prev,r=i,s=i.next;if(Ci(e,r,s)>=0)return!1;for(var l=e.x,h=r.x,p=s.x,g=e.y,v=r.y,w=s.y,I=l<h?l<p?l:p:h<p?h:p,A=g<v?g<w?g:w:v<w?v:w,z=l>h?l>p?l:p:h>p?h:p,R=g>v?g>w?g:w:v>w?v:w,O=s.next;O!==e;){if(O.x>=I&&O.x<=z&&O.y>=A&&O.y<=R&&ka(l,g,h,v,p,w,O.x,O.y)&&Ci(O.prev,O,O.next)>=0)return!1;O=O.next}return!0}function Rm(i,e,r,s){var l=i.prev,h=i,p=i.next;if(Ci(l,h,p)>=0)return!1;for(var g=l.x,v=h.x,w=p.x,I=l.y,A=h.y,z=p.y,R=g<v?g<w?g:w:v<w?v:w,O=I<A?I<z?I:z:A<z?A:z,j=g>v?g>w?g:w:v>w?v:w,X=I>A?I>z?I:z:A>z?A:z,Y=cu(R,O,e,r,s),oe=cu(j,X,e,r,s),ee=i.prevZ,ce=i.nextZ;ee&&ee.z>=Y&&ce&&ce.z<=oe;){if(ee.x>=R&&ee.x<=j&&ee.y>=O&&ee.y<=X&&ee!==l&&ee!==p&&ka(g,I,v,A,w,z,ee.x,ee.y)&&Ci(ee.prev,ee,ee.next)>=0||(ee=ee.prevZ,ce.x>=R&&ce.x<=j&&ce.y>=O&&ce.y<=X&&ce!==l&&ce!==p&&ka(g,I,v,A,w,z,ce.x,ce.y)&&Ci(ce.prev,ce,ce.next)>=0))return!1;ce=ce.nextZ}for(;ee&&ee.z>=Y;){if(ee.x>=R&&ee.x<=j&&ee.y>=O&&ee.y<=X&&ee!==l&&ee!==p&&ka(g,I,v,A,w,z,ee.x,ee.y)&&Ci(ee.prev,ee,ee.next)>=0)return!1;ee=ee.prevZ}for(;ce&&ce.z<=oe;){if(ce.x>=R&&ce.x<=j&&ce.y>=O&&ce.y<=X&&ce!==l&&ce!==p&&ka(g,I,v,A,w,z,ce.x,ce.y)&&Ci(ce.prev,ce,ce.next)>=0)return!1;ce=ce.nextZ}return!0}function Fm(i,e,r){var s=i;do{var l=s.prev,h=s.next.next;!Kl(l,h)&&Yh(l,s,s.next,h)&&Oo(l,h)&&Oo(h,l)&&(e.push(l.i/r|0),e.push(s.i/r|0),e.push(h.i/r|0),$o(s),$o(s.next),s=i=h),s=s.next}while(s!==i);return Hs(s)}function Bm(i,e,r,s,l,h){var p=i;do{for(var g=p.next.next;g!==p.prev;){if(p.i!==g.i&&Vm(p,g)){var v=Qh(p,g);return p=Hs(p,p.next),v=Hs(v,v.next),Bo(p,e,r,s,l,h,0),void Bo(v,e,r,s,l,h,0)}g=g.next}p=p.next}while(p!==i)}function Om(i,e){return i.x-e.x}function $m(i,e){var r=function(l,h){var p,g=h,v=l.x,w=l.y,I=-1/0;do{if(w<=g.y&&w>=g.next.y&&g.next.y!==g.y){var A=g.x+(w-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(A<=v&&A>I&&(I=A,p=g.x<g.next.x?g:g.next,A===v))return p}g=g.next}while(g!==h);if(!p)return null;var z,R=p,O=p.x,j=p.y,X=1/0;g=p;do v>=g.x&&g.x>=O&&v!==g.x&&ka(w<j?v:I,w,O,j,w<j?I:v,w,g.x,g.y)&&(z=Math.abs(w-g.y)/(v-g.x),Oo(g,l)&&(z<X||z===X&&(g.x>p.x||g.x===p.x&&Nm(p,g)))&&(p=g,X=z)),g=g.next;while(g!==R);return p}(i,e);if(!r)return e;var s=Qh(r,i);return Hs(s,s.next),Hs(r,r.next)}function Nm(i,e){return Ci(i.prev,i,e.prev)<0&&Ci(e.next,i,i.next)<0}function cu(i,e,r,s,l){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*l|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*l|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function jm(i){var e=i,r=i;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==i);return r}function ka(i,e,r,s,l,h,p,g){return(l-p)*(e-g)>=(i-p)*(h-g)&&(i-p)*(s-g)>=(r-p)*(e-g)&&(r-p)*(h-g)>=(l-p)*(s-g)}function Vm(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(r,s){var l=r;do{if(l.i!==r.i&&l.next.i!==r.i&&l.i!==s.i&&l.next.i!==s.i&&Yh(l,l.next,r,s))return!0;l=l.next}while(l!==r);return!1}(i,e)&&(Oo(i,e)&&Oo(e,i)&&function(r,s){var l=r,h=!1,p=(r.x+s.x)/2,g=(r.y+s.y)/2;do l.y>g!=l.next.y>g&&l.next.y!==l.y&&p<(l.next.x-l.x)*(g-l.y)/(l.next.y-l.y)+l.x&&(h=!h),l=l.next;while(l!==r);return h}(i,e)&&(Ci(i.prev,i,e.prev)||Ci(i,e.prev,e))||Kl(i,e)&&Ci(i.prev,i,i.next)>0&&Ci(e.prev,e,e.next)>0)}function Ci(i,e,r){return(e.y-i.y)*(r.x-e.x)-(e.x-i.x)*(r.y-e.y)}function Kl(i,e){return i.x===e.x&&i.y===e.y}function Yh(i,e,r,s){var l=Yl(Ci(i,e,r)),h=Yl(Ci(i,e,s)),p=Yl(Ci(r,s,i)),g=Yl(Ci(r,s,e));return l!==h&&p!==g||!(l!==0||!Jl(i,r,e))||!(h!==0||!Jl(i,s,e))||!(p!==0||!Jl(r,i,s))||!(g!==0||!Jl(r,e,s))}function Jl(i,e,r){return e.x<=Math.max(i.x,r.x)&&e.x>=Math.min(i.x,r.x)&&e.y<=Math.max(i.y,r.y)&&e.y>=Math.min(i.y,r.y)}function Yl(i){return i>0?1:i<0?-1:0}function Oo(i,e){return Ci(i.prev,i,i.next)<0?Ci(i,e,i.next)>=0&&Ci(i,i.prev,e)>=0:Ci(i,e,i.prev)<0||Ci(i,i.next,e)<0}function Qh(i,e){var r=new uu(i.i,i.x,i.y),s=new uu(e.i,e.x,e.y),l=i.next,h=e.prev;return i.next=e,e.prev=i,r.next=l,l.prev=r,s.next=r,r.prev=s,h.next=s,s.prev=h,s}function ed(i,e,r,s){var l=new uu(i,e,r);return s?(l.next=s.next,l.prev=s,s.next.prev=l,s.next=l):(l.prev=l,l.next=l),l}function $o(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function uu(i,e,r){this.i=i,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function hu(i,e,r,s){for(var l=0,h=e,p=r-s;h<r;h+=s)l+=(i[p]-i[h])*(i[h+1]+i[p+1]),p=h;return l}lu.exports=Xl,lu.exports.default=Xl,Xl.deviation=function(i,e,r,s){var l=e&&e.length,h=Math.abs(hu(i,0,l?e[0]*r:i.length,r));if(l)for(var p=0,g=e.length;p<g;p++)h-=Math.abs(hu(i,e[p]*r,p<g-1?e[p+1]*r:i.length,r));var v=0;for(p=0;p<s.length;p+=3){var w=s[p]*r,I=s[p+1]*r,A=s[p+2]*r;v+=Math.abs((i[w]-i[A])*(i[I+1]-i[w+1])-(i[w]-i[I])*(i[A+1]-i[w+1]))}return h===0&&v===0?0:Math.abs((v-h)/h)},Xl.flatten=function(i){for(var e=i[0][0].length,r={vertices:[],holes:[],dimensions:e},s=0,l=0;l<i.length;l++){for(var h=0;h<i[l].length;h++)for(var p=0;p<e;p++)r.vertices.push(i[l][h][p]);l>0&&r.holes.push(s+=i[l-1].length)}return r};var td=F(lu.exports);function Um(i,e,r,s,l){id(i,e,r||0,s||i.length-1,l||qm)}function id(i,e,r,s,l){for(;s>r;){if(s-r>600){var h=s-r+1,p=e-r+1,g=Math.log(h),v=.5*Math.exp(2*g/3),w=.5*Math.sqrt(g*v*(h-v)/h)*(p-h/2<0?-1:1);id(i,e,Math.max(r,Math.floor(e-p*v/h+w)),Math.min(s,Math.floor(e+(h-p)*v/h+w)),l)}var I=i[e],A=r,z=s;for(No(i,r,e),l(i[s],I)>0&&No(i,r,s);A<z;){for(No(i,A,z),A++,z--;l(i[A],I)<0;)A++;for(;l(i[z],I)>0;)z--}l(i[r],I)===0?No(i,r,z):No(i,++z,s),z<=e&&(r=z+1),e<=z&&(s=z-1)}}function No(i,e,r){var s=i[e];i[e]=i[r],i[r]=s}function qm(i,e){return i<e?-1:i>e?1:0}function du(i,e){const r=i.length;if(r<=1)return[i];const s=[];let l,h;for(let p=0;p<r;p++){const g=Bt(i[p]);g!==0&&(i[p].area=Math.abs(g),h===void 0&&(h=g<0),h===g<0?(l&&s.push(l),l=[i[p]]):l.push(i[p]))}if(l&&s.push(l),e>1)for(let p=0;p<s.length;p++)s[p].length<=e||(Um(s[p],e,1,s[p].length-1,Zm),s[p]=s[p].slice(0,e));return s}function Zm(i,e){return e.area-i.area}function pu(i,e,r){const s=r.patternDependencies;let l=!1;for(const h of e){const p=h.paint.get(`${i}-pattern`);p.isConstant()||(l=!0);const g=p.constantOr(null);g&&(l=!0,s[g.to]=!0,s[g.from]=!0)}return l}function fu(i,e,r,s,l){const h=l.patternDependencies;for(const p of e){const g=p.paint.get(`${i}-pattern`).value;if(g.kind!=="constant"){let v=g.evaluate({zoom:s-1},r,{},l.availableImages),w=g.evaluate({zoom:s},r,{},l.availableImages),I=g.evaluate({zoom:s+1},r,{},l.availableImages);v=v&&v.name?v.name:v,w=w&&w.name?w.name:w,I=I&&I.name?I.name:I,h[v]=!0,h[w]=!0,h[I]=!0,r.patterns[p.id]={min:v,mid:w,max:I}}}return r}class mu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Tt,this.indexArray=new Hi,this.indexArray2=new zi,this.programConfigurations=new _n(e.layers,e.zoom),this.segments=new ri,this.segments2=new ri,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){this.hasPattern=pu("fill",this.layers,r);const l=this.layers[0].layout.get("fill-sort-key"),h=!l.isConstant(),p=[];for(const{feature:g,id:v,index:w,sourceLayerIndex:I}of e){const A=this.layers[0]._featureFilter.needGeometry,z=Gs(g,A);if(!this.layers[0]._featureFilter.filter(new ii(this.zoom),z,s))continue;const R=h?l.evaluate(z,{},s,r.availableImages):void 0,O={id:v,properties:g.properties,type:g.type,sourceLayerIndex:I,index:w,geometry:A?z.geometry:Zs(g),patterns:{},sortKey:R};p.push(O)}h&&p.sort((g,v)=>g.sortKey-v.sortKey);for(const g of p){const{geometry:v,index:w,sourceLayerIndex:I}=g;if(this.hasPattern){const A=fu("fill",this.layers,g,this.zoom,r);this.patternFeatures.push(A)}else this.addFeature(g,v,w,s,{});r.featureIndex.insert(e[w].feature,v,w,I,this.index)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s)}addFeatures(e,r,s){for(const l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,r,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Dm),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,s,l,h){for(const p of du(r,500)){let g=0;for(const R of p)g+=R.length;const v=this.segments.prepareSegment(g,this.layoutVertexArray,this.indexArray),w=v.vertexLength,I=[],A=[];for(const R of p){if(R.length===0)continue;R!==p[0]&&A.push(I.length/2);const O=this.segments2.prepareSegment(R.length,this.layoutVertexArray,this.indexArray2),j=O.vertexLength;this.layoutVertexArray.emplaceBack(R[0].x,R[0].y),this.indexArray2.emplaceBack(j+R.length-1,j),I.push(R[0].x),I.push(R[0].y);for(let X=1;X<R.length;X++)this.layoutVertexArray.emplaceBack(R[X].x,R[X].y),this.indexArray2.emplaceBack(j+X-1,j+X),I.push(R[X].x),I.push(R[X].y);O.vertexLength+=R.length,O.primitiveLength+=R.length}const z=td(I,A);for(let R=0;R<z.length;R+=3)this.indexArray.emplaceBack(w+z[R],w+z[R+1],w+z[R+2]);v.vertexLength+=g,v.primitiveLength+=z.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,h,l)}}let rd,nd;He("FillBucket",mu,{omit:["layers","patternFeatures"]});var Gm={get paint(){return nd=nd||new wi({"fill-antialias":new tt(ge.paint_fill["fill-antialias"]),"fill-opacity":new ut(ge.paint_fill["fill-opacity"]),"fill-color":new ut(ge.paint_fill["fill-color"]),"fill-outline-color":new ut(ge.paint_fill["fill-outline-color"]),"fill-translate":new tt(ge.paint_fill["fill-translate"]),"fill-translate-anchor":new tt(ge.paint_fill["fill-translate-anchor"]),"fill-pattern":new Vs(ge.paint_fill["fill-pattern"])})},get layout(){return rd=rd||new wi({"fill-sort-key":new ut(ge.layout_fill["fill-sort-key"])})}};class Hm extends jr{constructor(e){super(e,Gm)}recalculate(e,r){super.recalculate(e,r);const s=this.paint._values["fill-outline-color"];s.value.kind==="constant"&&s.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new mu(e)}queryRadius(){return Gl(this.paint.get("fill-translate"))}queryIntersectsFeature(e,r,s,l,h,p,g){return $h(Hl(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,g),l)}isTileClipped(){return!0}}const Wm=di([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Xm=di([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Km}=Wm;var _s={},Jm=ne,sd=za;function za(i,e,r,s,l){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=s,this._values=l,i.readFields(Ym,this,e)}function Ym(i,e,r){i==1?e.id=r.readVarint():i==2?function(s,l){for(var h=s.readVarint()+s.pos;s.pos<h;){var p=l._keys[s.readVarint()],g=l._values[s.readVarint()];l.properties[p]=g}}(r,e):i==3?e.type=r.readVarint():i==4&&(e._geometry=r.pos)}function Qm(i){for(var e,r,s=0,l=0,h=i.length,p=h-1;l<h;p=l++)s+=((r=i[p]).x-(e=i[l]).x)*(e.y+r.y);return s}za.types=["Unknown","Point","LineString","Polygon"],za.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,r=i.readVarint()+i.pos,s=1,l=0,h=0,p=0,g=[];i.pos<r;){if(l<=0){var v=i.readVarint();s=7&v,l=v>>3}if(l--,s===1||s===2)h+=i.readSVarint(),p+=i.readSVarint(),s===1&&(e&&g.push(e),e=[]),e.push(new Jm(h,p));else{if(s!==7)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&g.push(e),g},za.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,r=1,s=0,l=0,h=0,p=1/0,g=-1/0,v=1/0,w=-1/0;i.pos<e;){if(s<=0){var I=i.readVarint();r=7&I,s=I>>3}if(s--,r===1||r===2)(l+=i.readSVarint())<p&&(p=l),l>g&&(g=l),(h+=i.readSVarint())<v&&(v=h),h>w&&(w=h);else if(r!==7)throw new Error("unknown command "+r)}return[p,v,g,w]},za.prototype.toGeoJSON=function(i,e,r){var s,l,h=this.extent*Math.pow(2,r),p=this.extent*i,g=this.extent*e,v=this.loadGeometry(),w=za.types[this.type];function I(R){for(var O=0;O<R.length;O++){var j=R[O];R[O]=[360*(j.x+p)/h-180,360/Math.PI*Math.atan(Math.exp((180-360*(j.y+g)/h)*Math.PI/180))-90]}}switch(this.type){case 1:var A=[];for(s=0;s<v.length;s++)A[s]=v[s][0];I(v=A);break;case 2:for(s=0;s<v.length;s++)I(v[s]);break;case 3:for(v=function(R){var O=R.length;if(O<=1)return[R];for(var j,X,Y=[],oe=0;oe<O;oe++){var ee=Qm(R[oe]);ee!==0&&(X===void 0&&(X=ee<0),X===ee<0?(j&&Y.push(j),j=[R[oe]]):j.push(R[oe]))}return j&&Y.push(j),Y}(v),s=0;s<v.length;s++)for(l=0;l<v[s].length;l++)I(v[s][l])}v.length===1?v=v[0]:w="Multi"+w;var z={type:"Feature",geometry:{type:w,coordinates:v},properties:this.properties};return"id"in this&&(z.id=this.id),z};var eg=sd,ad=od;function od(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(tg,this,e),this.length=this._features.length}function tg(i,e,r){i===15?e.version=r.readVarint():i===1?e.name=r.readString():i===5?e.extent=r.readVarint():i===2?e._features.push(r.pos):i===3?e._keys.push(r.readString()):i===4&&e._values.push(function(s){for(var l=null,h=s.readVarint()+s.pos;s.pos<h;){var p=s.readVarint()>>3;l=p===1?s.readString():p===2?s.readFloat():p===3?s.readDouble():p===4?s.readVarint64():p===5?s.readVarint():p===6?s.readSVarint():p===7?s.readBoolean():null}return l}(r))}od.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new eg(this._pbf,e,this.extent,this._keys,this._values)};var ig=ad;function rg(i,e,r){if(i===3){var s=new ig(r,r.readVarint()+r.pos);s.length&&(e[s.name]=s)}}_s.VectorTile=function(i,e){this.layers=i.readFields(rg,{},e)},_s.VectorTileFeature=sd,_s.VectorTileLayer=ad;const ng=_s.VectorTileFeature.types,gu=Math.pow(2,13);function jo(i,e,r,s,l,h,p,g){i.emplaceBack(e,r,2*Math.floor(s*gu)+p,l*gu*2,h*gu*2,Math.round(g))}class _u{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Oe,this.centroidVertexArray=new Le,this.indexArray=new Hi,this.programConfigurations=new _n(e.layers,e.zoom),this.segments=new ri,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){this.features=[],this.hasPattern=pu("fill-extrusion",this.layers,r);for(const{feature:l,id:h,index:p,sourceLayerIndex:g}of e){const v=this.layers[0]._featureFilter.needGeometry,w=Gs(l,v);if(!this.layers[0]._featureFilter.filter(new ii(this.zoom),w,s))continue;const I={id:h,sourceLayerIndex:g,index:p,geometry:v?w.geometry:Zs(l),properties:l.properties,type:l.type,patterns:{}};this.hasPattern?this.features.push(fu("fill-extrusion",this.layers,I,this.zoom,r)):this.addFeature(I,I.geometry,p,s,{}),r.featureIndex.insert(l,I.geometry,p,g,this.index,!0)}}addFeatures(e,r,s){for(const l of this.features){const{geometry:h}=l;this.addFeature(l,h,l.index,r,s)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Km),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Xm.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,r,s,l,h){const p={x:0,y:0,vertexCount:0};for(const g of du(r,500)){let v=0;for(const O of g)v+=O.length;let w=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const O of g){if(O.length===0||ag(O))continue;let j=0;for(let X=0;X<O.length;X++){const Y=O[X];if(X>=1){const oe=O[X-1];if(!sg(Y,oe)){w.vertexLength+4>ri.MAX_VERTEX_ARRAY_LENGTH&&(w=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ee=Y.sub(oe)._perp()._unit(),ce=oe.dist(Y);j+ce>32768&&(j=0),jo(this.layoutVertexArray,Y.x,Y.y,ee.x,ee.y,0,0,j),jo(this.layoutVertexArray,Y.x,Y.y,ee.x,ee.y,0,1,j),p.x+=2*Y.x,p.y+=2*Y.y,p.vertexCount+=2,j+=ce,jo(this.layoutVertexArray,oe.x,oe.y,ee.x,ee.y,0,0,j),jo(this.layoutVertexArray,oe.x,oe.y,ee.x,ee.y,0,1,j),p.x+=2*oe.x,p.y+=2*oe.y,p.vertexCount+=2;const de=w.vertexLength;this.indexArray.emplaceBack(de,de+2,de+1),this.indexArray.emplaceBack(de+1,de+2,de+3),w.vertexLength+=4,w.primitiveLength+=2}}}}if(w.vertexLength+v>ri.MAX_VERTEX_ARRAY_LENGTH&&(w=this.segments.prepareSegment(v,this.layoutVertexArray,this.indexArray)),ng[e.type]!=="Polygon")continue;const I=[],A=[],z=w.vertexLength;for(const O of g)if(O.length!==0){O!==g[0]&&A.push(I.length/2);for(let j=0;j<O.length;j++){const X=O[j];jo(this.layoutVertexArray,X.x,X.y,0,0,1,1,0),p.x+=X.x,p.y+=X.y,p.vertexCount+=1,I.push(X.x),I.push(X.y)}}const R=td(I,A);for(let O=0;O<R.length;O+=3)this.indexArray.emplaceBack(z+R[O],z+R[O+2],z+R[O+1]);w.primitiveLength+=R.length/3,w.vertexLength+=v}for(let g=0;g<p.vertexCount;g++)this.centroidVertexArray.emplaceBack(Math.floor(p.x/p.vertexCount),Math.floor(p.y/p.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,h,l)}}function sg(i,e){return i.x===e.x&&(i.x<0||i.x>Pi)||i.y===e.y&&(i.y<0||i.y>Pi)}function ag(i){return i.every(e=>e.x<0)||i.every(e=>e.x>Pi)||i.every(e=>e.y<0)||i.every(e=>e.y>Pi)}let ld;He("FillExtrusionBucket",_u,{omit:["layers","features"]});var og={get paint(){return ld=ld||new wi({"fill-extrusion-opacity":new tt(ge["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ut(ge["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new tt(ge["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new tt(ge["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Vs(ge["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ut(ge["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ut(ge["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new tt(ge["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class lg extends jr{constructor(e){super(e,og)}createBucket(e){return new _u(e)}queryRadius(){return Gl(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(e,r,s,l,h,p,g,v){const w=Hl(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,g),I=this.paint.get("fill-extrusion-height").evaluate(r,s),A=this.paint.get("fill-extrusion-base").evaluate(r,s),z=function(O,j,X,Y){const oe=[];for(const ee of O){const ce=[ee.x,ee.y,0,1];Wl(ce,ce,j),oe.push(new ue(ce[0]/ce[3],ce[1]/ce[3]))}return oe}(w,v),R=function(O,j,X,Y){const oe=[],ee=[],ce=Y[8]*j,de=Y[9]*j,we=Y[10]*j,qe=Y[11]*j,Je=Y[8]*X,Ve=Y[9]*X,$e=Y[10]*X,Fe=Y[11]*X;for(const We of O){const Be=[],Ae=[];for(const st of We){const et=st.x,St=st.y,ni=Y[0]*et+Y[4]*St+Y[12],li=Y[1]*et+Y[5]*St+Y[13],Ri=Y[2]*et+Y[6]*St+Y[14],Ur=Y[3]*et+Y[7]*St+Y[15],xr=Ri+we,Ai=Ur+qe,Xi=ni+Je,ir=li+Ve,br=Ri+$e,wr=Ur+Fe,Fi=new ue((ni+ce)/Ai,(li+de)/Ai);Fi.z=xr/Ai,Be.push(Fi);const Bi=new ue(Xi/wr,ir/wr);Bi.z=br/wr,Ae.push(Bi)}oe.push(Be),ee.push(Ae)}return[oe,ee]}(l,A,I,v);return function(O,j,X){let Y=1/0;$h(X,j)&&(Y=cd(X,j[0]));for(let oe=0;oe<j.length;oe++){const ee=j[oe],ce=O[oe];for(let de=0;de<ee.length-1;de++){const we=ee[de],qe=[we,ee[de+1],ce[de+1],ce[de],we];Oh(X,qe)&&(Y=Math.min(Y,cd(X,qe)))}}return Y!==1/0&&Y}(R[0],R[1],z)}}function Vo(i,e){return i.x*e.x+i.y*e.y}function cd(i,e){if(i.length===1){let r=0;const s=e[r++];let l;for(;!l||s.equals(l);)if(l=e[r++],!l)return 1/0;for(;r<e.length;r++){const h=e[r],p=i[0],g=l.sub(s),v=h.sub(s),w=p.sub(s),I=Vo(g,g),A=Vo(g,v),z=Vo(v,v),R=Vo(w,g),O=Vo(w,v),j=I*z-A*A,X=(z*R-A*O)/j,Y=(I*O-A*R)/j,oe=s.z*(1-X-Y)+l.z*X+h.z*Y;if(isFinite(oe))return oe}return 1/0}{let r=1/0;for(const s of e)r=Math.min(r,s.z);return r}}const cg=di([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:ug}=cg,hg=di([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:dg}=hg,pg=_s.VectorTileFeature.types,fg=Math.cos(Math.PI/180*37.5),ud=Math.pow(2,14)/.5;class yu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new ht,this.layoutVertexArray2=new Qe,this.indexArray=new Hi,this.programConfigurations=new _n(e.layers,e.zoom),this.segments=new ri,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){this.hasPattern=pu("line",this.layers,r);const l=this.layers[0].layout.get("line-sort-key"),h=!l.isConstant(),p=[];for(const{feature:g,id:v,index:w,sourceLayerIndex:I}of e){const A=this.layers[0]._featureFilter.needGeometry,z=Gs(g,A);if(!this.layers[0]._featureFilter.filter(new ii(this.zoom),z,s))continue;const R=h?l.evaluate(z,{},s):void 0,O={id:v,properties:g.properties,type:g.type,sourceLayerIndex:I,index:w,geometry:A?z.geometry:Zs(g),patterns:{},sortKey:R};p.push(O)}h&&p.sort((g,v)=>g.sortKey-v.sortKey);for(const g of p){const{geometry:v,index:w,sourceLayerIndex:I}=g;if(this.hasPattern){const A=fu("line",this.layers,g,this.zoom,r);this.patternFeatures.push(A)}else this.addFeature(g,v,w,s,{});r.featureIndex.insert(e[w].feature,v,w,I,this.index)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s)}addFeatures(e,r,s){for(const l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,r,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,dg)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ug),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,s,l,h){const p=this.layers[0].layout,g=p.get("line-join").evaluate(e,{}),v=p.get("line-cap"),w=p.get("line-miter-limit"),I=p.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const A of r)this.addLine(A,e,g,v,w,I);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,h,l)}addLine(e,r,s,l,h,p){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Y=0;Y<e.length-1;Y++)this.totalDistance+=e[Y].dist(e[Y+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const g=pg[r.type]==="Polygon";let v=e.length;for(;v>=2&&e[v-1].equals(e[v-2]);)v--;let w=0;for(;w<v-1&&e[w].equals(e[w+1]);)w++;if(v<(g?3:2))return;s==="bevel"&&(h=1.05);const I=this.overscaling<=16?15*Pi/(512*this.overscaling):0,A=this.segments.prepareSegment(10*v,this.layoutVertexArray,this.indexArray);let z,R,O,j,X;this.e1=this.e2=-1,g&&(z=e[v-2],X=e[w].sub(z)._unit()._perp());for(let Y=w;Y<v;Y++){if(O=Y===v-1?g?e[w+1]:void 0:e[Y+1],O&&e[Y].equals(O))continue;X&&(j=X),z&&(R=z),z=e[Y],X=O?O.sub(z)._unit()._perp():j,j=j||X;let oe=j.add(X);oe.x===0&&oe.y===0||oe._unit();const ee=j.x*X.x+j.y*X.y,ce=oe.x*X.x+oe.y*X.y,de=ce!==0?1/ce:1/0,we=2*Math.sqrt(2-2*ce),qe=ce<fg&&R&&O,Je=j.x*X.y-j.y*X.x>0;if(qe&&Y>w){const Fe=z.dist(R);if(Fe>2*I){const We=z.sub(z.sub(R)._mult(I/Fe)._round());this.updateDistance(R,We),this.addCurrentVertex(We,j,0,0,A),R=We}}const Ve=R&&O;let $e=Ve?s:g?"butt":l;if(Ve&&$e==="round"&&(de<p?$e="miter":de<=2&&($e="fakeround")),$e==="miter"&&de>h&&($e="bevel"),$e==="bevel"&&(de>2&&($e="flipbevel"),de<h&&($e="miter")),R&&this.updateDistance(R,z),$e==="miter")oe._mult(de),this.addCurrentVertex(z,oe,0,0,A);else if($e==="flipbevel"){if(de>100)oe=X.mult(-1);else{const Fe=de*j.add(X).mag()/j.sub(X).mag();oe._perp()._mult(Fe*(Je?-1:1))}this.addCurrentVertex(z,oe,0,0,A),this.addCurrentVertex(z,oe.mult(-1),0,0,A)}else if($e==="bevel"||$e==="fakeround"){const Fe=-Math.sqrt(de*de-1),We=Je?Fe:0,Be=Je?0:Fe;if(R&&this.addCurrentVertex(z,j,We,Be,A),$e==="fakeround"){const Ae=Math.round(180*we/Math.PI/20);for(let st=1;st<Ae;st++){let et=st/Ae;if(et!==.5){const ni=et-.5;et+=et*ni*(et-1)*((1.0904+ee*(ee*(3.55645-1.43519*ee)-3.2452))*ni*ni+(.848013+ee*(.215638*ee-1.06021)))}const St=X.sub(j)._mult(et)._add(j)._unit()._mult(Je?-1:1);this.addHalfVertex(z,St.x,St.y,!1,Je,0,A)}}O&&this.addCurrentVertex(z,X,-We,-Be,A)}else if($e==="butt")this.addCurrentVertex(z,oe,0,0,A);else if($e==="square"){const Fe=R?1:-1;this.addCurrentVertex(z,oe,Fe,Fe,A)}else $e==="round"&&(R&&(this.addCurrentVertex(z,j,0,0,A),this.addCurrentVertex(z,j,1,1,A,!0)),O&&(this.addCurrentVertex(z,X,-1,-1,A,!0),this.addCurrentVertex(z,X,0,0,A)));if(qe&&Y<v-1){const Fe=z.dist(O);if(Fe>2*I){const We=z.add(O.sub(z)._mult(I/Fe)._round());this.updateDistance(z,We),this.addCurrentVertex(We,X,0,0,A),z=We}}}}addCurrentVertex(e,r,s,l,h,p=!1){const g=r.y*l-r.x,v=-r.y-r.x*l;this.addHalfVertex(e,r.x+r.y*s,r.y-r.x*s,p,!1,s,h),this.addHalfVertex(e,g,v,p,!0,-l,h),this.distance>ud/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,r,s,l,h,p))}addHalfVertex({x:e,y:r},s,l,h,p,g,v){const w=.5*(this.lineClips?this.scaledDistance*(ud-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(h?1:0),(r<<1)+(p?1:0),Math.round(63*s)+128,Math.round(63*l)+128,1+(g===0?0:g<0?-1:1)|(63&w)<<2,w>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const I=v.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,I),v.primitiveLength++),p?this.e2=I:this.e1=I}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}let hd,dd;He("LineBucket",yu,{omit:["layers","patternFeatures"]});var pd={get paint(){return dd=dd||new wi({"line-opacity":new ut(ge.paint_line["line-opacity"]),"line-color":new ut(ge.paint_line["line-color"]),"line-translate":new tt(ge.paint_line["line-translate"]),"line-translate-anchor":new tt(ge.paint_line["line-translate-anchor"]),"line-width":new ut(ge.paint_line["line-width"]),"line-gap-width":new ut(ge.paint_line["line-gap-width"]),"line-offset":new ut(ge.paint_line["line-offset"]),"line-blur":new ut(ge.paint_line["line-blur"]),"line-dasharray":new To(ge.paint_line["line-dasharray"]),"line-pattern":new Vs(ge.paint_line["line-pattern"]),"line-gradient":new Io(ge.paint_line["line-gradient"])})},get layout(){return hd=hd||new wi({"line-cap":new tt(ge.layout_line["line-cap"]),"line-join":new ut(ge.layout_line["line-join"]),"line-miter-limit":new tt(ge.layout_line["line-miter-limit"]),"line-round-limit":new tt(ge.layout_line["line-round-limit"]),"line-sort-key":new ut(ge.layout_line["line-sort-key"])})}};class mg extends ut{possiblyEvaluate(e,r){return r=new ii(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(e,r)}evaluate(e,r,s,l){return r=Ge({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(e,r,s,l)}}let Ql;class gg extends jr{constructor(e){super(e,pd),this.gradientVersion=0,Ql||(Ql=new mg(pd.paint.properties["line-width"].specification),Ql.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!function(s){return s._styleExpression!==void 0}(r)&&r._styleExpression.expression instanceof Mn,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,r){super.recalculate(e,r),this.paint._values["line-floorwidth"]=Ql.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new yu(e)}queryRadius(e){const r=e,s=fd(Lo("line-width",this,r),Lo("line-gap-width",this,r)),l=Lo("line-offset",this,r);return s/2+Math.abs(l)+Gl(this.paint.get("line-translate"))}queryIntersectsFeature(e,r,s,l,h,p,g){const v=Hl(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,g),w=g/2*fd(this.paint.get("line-width").evaluate(r,s),this.paint.get("line-gap-width").evaluate(r,s)),I=this.paint.get("line-offset").evaluate(r,s);return I&&(l=function(A,z){const R=[];for(let O=0;O<A.length;O++){const j=A[O],X=[];for(let Y=0;Y<j.length;Y++){const oe=j[Y-1],ee=j[Y],ce=j[Y+1],de=Y===0?new ue(0,0):ee.sub(oe)._unit()._perp(),we=Y===j.length-1?new ue(0,0):ce.sub(ee)._unit()._perp(),qe=de._add(we)._unit(),Je=qe.x*we.x+qe.y*we.y;Je!==0&&qe._mult(1/Je),X.push(qe._mult(z)._add(ee))}R.push(X)}return R}(l,I*g)),function(A,z,R){for(let O=0;O<z.length;O++){const j=z[O];if(A.length>=3){for(let X=0;X<j.length;X++)if(Aa(A,j[X]))return!0}if(wm(A,j,R))return!0}return!1}(v,l,w)}isTileClipped(){return!0}}function fd(i,e){return e>0?e+2*i:i}const _g=di([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),yg=di([{name:"a_projected_pos",components:3,type:"Float32"}],4);di([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const vg=di([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);di([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const md=di([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),xg=di([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function bg(i,e,r){return i.sections.forEach(s=>{s.text=function(l,h,p){const g=h.layout.get("text-transform").evaluate(p,{});return g==="uppercase"?l=l.toLocaleUpperCase():g==="lowercase"&&(l=l.toLocaleLowerCase()),Ar.applyArabicShaping&&(l=Ar.applyArabicShaping(l)),l}(s.text,e,r)}),i}di([{name:"triangle",components:3,type:"Uint16"}]),di([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),di([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),di([{type:"Float32",name:"offsetX"}]),di([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),di([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Uo={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Li=24,gd=Wt,_d=function(i,e,r,s,l){var h,p,g=8*l-s-1,v=(1<<g)-1,w=v>>1,I=-7,A=r?l-1:0,z=r?-1:1,R=i[e+A];for(A+=z,h=R&(1<<-I)-1,R>>=-I,I+=g;I>0;h=256*h+i[e+A],A+=z,I-=8);for(p=h&(1<<-I)-1,h>>=-I,I+=s;I>0;p=256*p+i[e+A],A+=z,I-=8);if(h===0)h=1-w;else{if(h===v)return p?NaN:1/0*(R?-1:1);p+=Math.pow(2,s),h-=w}return(R?-1:1)*p*Math.pow(2,h-s)},yd=function(i,e,r,s,l,h){var p,g,v,w=8*h-l-1,I=(1<<w)-1,A=I>>1,z=l===23?Math.pow(2,-24)-Math.pow(2,-77):0,R=s?0:h-1,O=s?1:-1,j=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(g=isNaN(e)?1:0,p=I):(p=Math.floor(Math.log(e)/Math.LN2),e*(v=Math.pow(2,-p))<1&&(p--,v*=2),(e+=p+A>=1?z/v:z*Math.pow(2,1-A))*v>=2&&(p++,v/=2),p+A>=I?(g=0,p=I):p+A>=1?(g=(e*v-1)*Math.pow(2,l),p+=A):(g=e*Math.pow(2,A-1)*Math.pow(2,l),p=0));l>=8;i[r+R]=255&g,R+=O,g/=256,l-=8);for(p=p<<l|g,w+=l;w>0;i[r+R]=255&p,R+=O,p/=256,w-=8);i[r+R-O]|=128*j};function Wt(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Wt.Varint=0,Wt.Fixed64=1,Wt.Bytes=2,Wt.Fixed32=5;var vu=4294967296,vd=1/vu,xd=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Yn(i){return i.type===Wt.Bytes?i.readVarint()+i.pos:i.pos+1}function Da(i,e,r){return r?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function bd(i,e,r){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(s);for(var l=r.pos-1;l>=i;l--)r.buf[l+s]=r.buf[l]}function wg(i,e){for(var r=0;r<i.length;r++)e.writeVarint(i[r])}function Sg(i,e){for(var r=0;r<i.length;r++)e.writeSVarint(i[r])}function Cg(i,e){for(var r=0;r<i.length;r++)e.writeFloat(i[r])}function Tg(i,e){for(var r=0;r<i.length;r++)e.writeDouble(i[r])}function Ig(i,e){for(var r=0;r<i.length;r++)e.writeBoolean(i[r])}function Eg(i,e){for(var r=0;r<i.length;r++)e.writeFixed32(i[r])}function Pg(i,e){for(var r=0;r<i.length;r++)e.writeSFixed32(i[r])}function Ag(i,e){for(var r=0;r<i.length;r++)e.writeFixed64(i[r])}function Mg(i,e){for(var r=0;r<i.length;r++)e.writeSFixed64(i[r])}function ec(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function La(i,e,r){i[r]=e,i[r+1]=e>>>8,i[r+2]=e>>>16,i[r+3]=e>>>24}function wd(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}Wt.prototype={destroy:function(){this.buf=null},readFields:function(i,e,r){for(r=r||this.length;this.pos<r;){var s=this.readVarint(),l=s>>3,h=this.pos;this.type=7&s,i(l,e,this),this.pos===h&&this.skip(s)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=ec(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=wd(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=ec(this.buf,this.pos)+ec(this.buf,this.pos+4)*vu;return this.pos+=8,i},readSFixed64:function(){var i=ec(this.buf,this.pos)+wd(this.buf,this.pos+4)*vu;return this.pos+=8,i},readFloat:function(){var i=_d(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=_d(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,r,s=this.buf;return e=127&(r=s[this.pos++]),r<128?e:(e|=(127&(r=s[this.pos++]))<<7,r<128?e:(e|=(127&(r=s[this.pos++]))<<14,r<128?e:(e|=(127&(r=s[this.pos++]))<<21,r<128?e:function(l,h,p){var g,v,w=p.buf;if(g=(112&(v=w[p.pos++]))>>4,v<128||(g|=(127&(v=w[p.pos++]))<<3,v<128)||(g|=(127&(v=w[p.pos++]))<<10,v<128)||(g|=(127&(v=w[p.pos++]))<<17,v<128)||(g|=(127&(v=w[p.pos++]))<<24,v<128)||(g|=(1&(v=w[p.pos++]))<<31,v<128))return Da(l,g,h);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=s[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&xd?function(r,s,l){return xd.decode(r.subarray(s,l))}(this.buf,e,i):function(r,s,l){for(var h="",p=s;p<l;){var g,v,w,I=r[p],A=null,z=I>239?4:I>223?3:I>191?2:1;if(p+z>l)break;z===1?I<128&&(A=I):z===2?(192&(g=r[p+1]))==128&&(A=(31&I)<<6|63&g)<=127&&(A=null):z===3?(v=r[p+2],(192&(g=r[p+1]))==128&&(192&v)==128&&((A=(15&I)<<12|(63&g)<<6|63&v)<=2047||A>=55296&&A<=57343)&&(A=null)):z===4&&(v=r[p+2],w=r[p+3],(192&(g=r[p+1]))==128&&(192&v)==128&&(192&w)==128&&((A=(15&I)<<18|(63&g)<<12|(63&v)<<6|63&w)<=65535||A>=1114112)&&(A=null)),A===null?(A=65533,z=1):A>65535&&(A-=65536,h+=String.fromCharCode(A>>>10&1023|55296),A=56320|1023&A),h+=String.fromCharCode(A),p+=z}return h}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==Wt.Bytes)return i.push(this.readVarint(e));var r=Yn(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==Wt.Bytes)return i.push(this.readSVarint());var e=Yn(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Wt.Bytes)return i.push(this.readBoolean());var e=Yn(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Wt.Bytes)return i.push(this.readFloat());var e=Yn(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Wt.Bytes)return i.push(this.readDouble());var e=Yn(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Wt.Bytes)return i.push(this.readFixed32());var e=Yn(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Wt.Bytes)return i.push(this.readSFixed32());var e=Yn(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Wt.Bytes)return i.push(this.readFixed64());var e=Yn(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Wt.Bytes)return i.push(this.readSFixed64());var e=Yn(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===Wt.Varint)for(;this.buf[this.pos++]>127;);else if(e===Wt.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Wt.Fixed32)this.pos+=4;else{if(e!==Wt.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),La(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),La(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),La(this.buf,-1&i,this.pos),La(this.buf,Math.floor(i*vd),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),La(this.buf,-1&i,this.pos),La(this.buf,Math.floor(i*vd),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,r){var s,l;if(e>=0?(s=e%4294967296|0,l=e/4294967296|0):(l=~(-e/4294967296),4294967295^(s=~(-e%4294967296))?s=s+1|0:(s=0,l=l+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(h,p,g){g.buf[g.pos++]=127&h|128,h>>>=7,g.buf[g.pos++]=127&h|128,h>>>=7,g.buf[g.pos++]=127&h|128,h>>>=7,g.buf[g.pos++]=127&h|128,g.buf[g.pos]=127&(h>>>=7)}(s,0,r),function(h,p){var g=(7&h)<<4;p.buf[p.pos++]|=g|((h>>>=3)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h)))))}(l,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(s,l,h){for(var p,g,v=0;v<l.length;v++){if((p=l.charCodeAt(v))>55295&&p<57344){if(!g){p>56319||v+1===l.length?(s[h++]=239,s[h++]=191,s[h++]=189):g=p;continue}if(p<56320){s[h++]=239,s[h++]=191,s[h++]=189,g=p;continue}p=g-55296<<10|p-56320|65536,g=null}else g&&(s[h++]=239,s[h++]=191,s[h++]=189,g=null);p<128?s[h++]=p:(p<2048?s[h++]=p>>6|192:(p<65536?s[h++]=p>>12|224:(s[h++]=p>>18|240,s[h++]=p>>12&63|128),s[h++]=p>>6&63|128),s[h++]=63&p|128)}return h}(this.buf,i,this.pos);var r=this.pos-e;r>=128&&bd(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),yd(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),yd(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,e){this.pos++;var r=this.pos;i(e,this);var s=this.pos-r;s>=128&&bd(r,s,this),this.pos=r-1,this.writeVarint(s),this.pos+=s},writeMessage:function(i,e,r){this.writeTag(i,Wt.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,wg,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,Sg,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,Ig,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,Cg,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,Tg,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,Eg,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,Pg,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,Ag,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,Mg,e)},writeBytesField:function(i,e){this.writeTag(i,Wt.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,Wt.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,Wt.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,Wt.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,Wt.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,Wt.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,Wt.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,Wt.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,Wt.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,Wt.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,!!e)}};var xu=F(gd);const bu=3;function kg(i,e,r){i===1&&r.readMessage(zg,e)}function zg(i,e,r){if(i===3){const{id:s,bitmap:l,width:h,height:p,left:g,top:v,advance:w}=r.readMessage(Dg,{});e.push({id:s,bitmap:new Fo({width:h+2*bu,height:p+2*bu},l),metrics:{width:h,height:p,left:g,top:v,advance:w}})}}function Dg(i,e,r){i===1?e.id=r.readVarint():i===2?e.bitmap=r.readBytes():i===3?e.width=r.readVarint():i===4?e.height=r.readVarint():i===5?e.left=r.readSVarint():i===6?e.top=r.readSVarint():i===7&&(e.advance=r.readVarint())}const Sd=bu;function Cd(i){let e=0,r=0;for(const p of i)e+=p.w*p.h,r=Math.max(r,p.w);i.sort((p,g)=>g.h-p.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let l=0,h=0;for(const p of i)for(let g=s.length-1;g>=0;g--){const v=s[g];if(!(p.w>v.w||p.h>v.h)){if(p.x=v.x,p.y=v.y,h=Math.max(h,p.y+p.h),l=Math.max(l,p.x+p.w),p.w===v.w&&p.h===v.h){const w=s.pop();g<s.length&&(s[g]=w)}else p.h===v.h?(v.x+=p.w,v.w-=p.w):p.w===v.w?(v.y+=p.h,v.h-=p.h):(s.push({x:v.x+p.w,y:v.y,w:v.w-p.w,h:p.h}),v.y+=p.h,v.h-=p.h);break}}return{w:l,h,fill:e/(l*h)||0}}const kr=1;class wu{constructor(e,{pixelRatio:r,version:s,stretchX:l,stretchY:h,content:p}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=l,this.stretchY=h,this.content=p,this.version=s}get tl(){return[this.paddedRect.x+kr,this.paddedRect.y+kr]}get br(){return[this.paddedRect.x+this.paddedRect.w-kr,this.paddedRect.y+this.paddedRect.h-kr]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*kr)/this.pixelRatio,(this.paddedRect.h-2*kr)/this.pixelRatio]}}class Td{constructor(e,r){const s={},l={};this.haveRenderCallbacks=[];const h=[];this.addImages(e,s,h),this.addImages(r,l,h);const{w:p,h:g}=Cd(h),v=new Gr({width:p||1,height:g||1});for(const w in e){const I=e[w],A=s[w].paddedRect;Gr.copy(I.data,v,{x:0,y:0},{x:A.x+kr,y:A.y+kr},I.data)}for(const w in r){const I=r[w],A=l[w].paddedRect,z=A.x+kr,R=A.y+kr,O=I.data.width,j=I.data.height;Gr.copy(I.data,v,{x:0,y:0},{x:z,y:R},I.data),Gr.copy(I.data,v,{x:0,y:j-1},{x:z,y:R-1},{width:O,height:1}),Gr.copy(I.data,v,{x:0,y:0},{x:z,y:R+j},{width:O,height:1}),Gr.copy(I.data,v,{x:O-1,y:0},{x:z-1,y:R},{width:1,height:j}),Gr.copy(I.data,v,{x:0,y:0},{x:z+O,y:R},{width:1,height:j})}this.image=v,this.iconPositions=s,this.patternPositions=l}addImages(e,r,s){for(const l in e){const h=e[l],p={x:0,y:0,w:h.data.width+2*kr,h:h.data.height+2*kr};s.push(p),r[l]=new wu(p,h),h.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(e,r){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in e.updatedImages)this.patchUpdatedImage(this.iconPositions[s],e.getImage(s),r),this.patchUpdatedImage(this.patternPositions[s],e.getImage(s),r)}patchUpdatedImage(e,r,s){if(!e||!r||e.version===r.version)return;e.version=r.version;const[l,h]=e.tl;s.update(r.data,void 0,{x:l,y:h})}}var ys;He("ImagePosition",wu),He("ImageAtlas",Td),a.ai=void 0,(ys=a.ai||(a.ai={}))[ys.none=0]="none",ys[ys.horizontal=1]="horizontal",ys[ys.vertical=2]="vertical",ys[ys.horizontalOnly=3]="horizontalOnly";const qo=-17;class Zo{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const s=new Zo;return s.scale=e||1,s.fontStack=r,s}static forImage(e){const r=new Zo;return r.imageName=e,r}}class Ra{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const s=new Ra;for(let l=0;l<e.sections.length;l++){const h=e.sections[l];h.image?s.addImageSection(h):s.addTextSection(h,r)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let r="";for(let s=0;s<e.length;s++){const l=e.charCodeAt(s+1)||null,h=e.charCodeAt(s-1)||null;r+=l&&Rl(l)&&!Uo[e[s+1]]||h&&Rl(h)&&!Uo[e[s-1]]||!Uo[e[s]]?e[s]:Uo[e[s]]}return r}(this.text)}trim(){let e=0;for(let s=0;s<this.text.length&&ic[this.text.charCodeAt(s)];s++)e++;let r=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&ic[this.text.charCodeAt(s)];s--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const s=new Ra;return s.text=this.text.substring(e,r),s.sectionIndex=this.sectionIndex.slice(e,r),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(Zo.forText(e.scale,e.fontStack||r));const s=this.sections.length-1;for(let l=0;l<e.text.length;++l)this.sectionIndex.push(s)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void gt("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(Zo.forImage(r)),this.sectionIndex.push(this.sections.length-1)):gt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function tc(i,e,r,s,l,h,p,g,v,w,I,A,z,R,O,j){const X=Ra.fromFeature(i,l);let Y;A===a.ai.vertical&&X.verticalizePunctuation();const{processBidirectionalText:oe,processStyledBidirectionalText:ee}=Ar;if(oe&&X.sections.length===1){Y=[];const we=oe(X.toString(),Su(X,w,h,e,s,R,O));for(const qe of we){const Je=new Ra;Je.text=qe,Je.sections=X.sections;for(let Ve=0;Ve<qe.length;Ve++)Je.sectionIndex.push(0);Y.push(Je)}}else if(ee){Y=[];const we=ee(X.text,X.sectionIndex,Su(X,w,h,e,s,R,O));for(const qe of we){const Je=new Ra;Je.text=qe[0],Je.sectionIndex=qe[1],Je.sections=X.sections,Y.push(Je)}}else Y=function(we,qe){const Je=[],Ve=we.text;let $e=0;for(const Fe of qe)Je.push(we.substring($e,Fe)),$e=Fe;return $e<Ve.length&&Je.push(we.substring($e,Ve.length)),Je}(X,Su(X,w,h,e,s,R,O));const ce=[],de={positionedLines:ce,text:X.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:A,iconsInText:!1,verticalizable:!1};return function(we,qe,Je,Ve,$e,Fe,We,Be,Ae,st,et,St){let ni=0,li=qo,Ri=0,Ur=0;const xr=Be==="right"?1:Be==="left"?0:.5;let Ai=0;for(const Fi of $e){Fi.trim();const Bi=Fi.getMaxScale(),cr=(Bi-1)*Li,Sr={positionedGlyphs:[],lineOffset:0};we.positionedLines[Ai]=Sr;const ur=Sr.positionedGlyphs;let zr=0;if(!Fi.length()){li+=Fe,++Ai;continue}for(let Oi=0;Oi<Fi.length();Oi++){const Et=Fi.getSection(Oi),hr=Fi.getSectionIndex(Oi),rr=Fi.getCharCode(Oi);let $i=0,ln=null,yn=null,vn=null,Qn=Li;const cn=!(Ae===a.ai.horizontal||!et&&!_o(rr)||et&&(ic[rr]||(Xi=rr,Ue.Arabic(Xi)||Ue["Arabic Supplement"](Xi)||Ue["Arabic Extended-A"](Xi)||Ue["Arabic Presentation Forms-A"](Xi)||Ue["Arabic Presentation Forms-B"](Xi))));if(Et.imageName){const Wr=Ve[Et.imageName];if(!Wr)continue;vn=Et.imageName,we.iconsInText=we.iconsInText||!0,yn=Wr.paddedRect;const Lr=Wr.displaySize;Et.scale=Et.scale*Li/St,ln={width:Lr[0],height:Lr[1],left:kr,top:-Sd,advance:cn?Lr[1]:Lr[0]},$i=cr+(Li-Lr[1]*Et.scale),Qn=ln.advance;const es=cn?Lr[0]*Et.scale-Li*Bi:Lr[1]*Et.scale-Li*Bi;es>0&&es>zr&&(zr=es)}else{const Wr=Je[Et.fontStack],Lr=Wr&&Wr[rr];if(Lr&&Lr.rect)yn=Lr.rect,ln=Lr.metrics;else{const es=qe[Et.fontStack],Ko=es&&es[rr];if(!Ko)continue;ln=Ko.metrics}$i=(Bi-Et.scale)*Li}cn?(we.verticalizable=!0,ur.push({glyph:rr,imageName:vn,x:ni,y:li+$i,vertical:cn,scale:Et.scale,fontStack:Et.fontStack,sectionIndex:hr,metrics:ln,rect:yn}),ni+=Qn*Et.scale+st):(ur.push({glyph:rr,imageName:vn,x:ni,y:li+$i,vertical:cn,scale:Et.scale,fontStack:Et.fontStack,sectionIndex:hr,metrics:ln,rect:yn}),ni+=ln.advance*Et.scale+st)}ur.length!==0&&(Ri=Math.max(ni-st,Ri),Fg(ur,0,ur.length-1,xr,zr)),ni=0;const Dr=Fe*Bi+zr;Sr.lineOffset=Math.max(zr,cr),li+=Dr,Ur=Math.max(Dr,Ur),++Ai}var Xi;const ir=li-qo,{horizontalAlign:br,verticalAlign:wr}=Cu(We);(function(Fi,Bi,cr,Sr,ur,zr,Dr,Oi,Et){const hr=(Bi-cr)*ur;let rr=0;rr=zr!==Dr?-Oi*Sr-qo:(-Sr*Et+.5)*Dr;for(const $i of Fi)for(const ln of $i.positionedGlyphs)ln.x+=hr,ln.y+=rr})(we.positionedLines,xr,br,wr,Ri,Ur,Fe,ir,$e.length),we.top+=-wr*ir,we.bottom=we.top+ir,we.left+=-br*Ri,we.right=we.left+Ri}(de,e,r,s,Y,p,g,v,A,w,z,j),!function(we){for(const qe of we)if(qe.positionedGlyphs.length!==0)return!1;return!0}(ce)&&de}const ic={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Lg={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Id(i,e,r,s,l,h){if(e.imageName){const p=s[e.imageName];return p?p.displaySize[0]*e.scale*Li/h+l:0}{const p=r[e.fontStack],g=p&&p[i];return g?g.metrics.advance*e.scale+l:0}}function Ed(i,e,r,s){const l=Math.pow(i-e,2);return s?i<e?l/2:2*l:l+Math.abs(r)*r}function Rg(i,e,r){let s=0;return i===10&&(s-=1e4),r&&(s+=150),i!==40&&i!==65288||(s+=50),e!==41&&e!==65289||(s+=50),s}function Pd(i,e,r,s,l,h){let p=null,g=Ed(e,r,l,h);for(const v of s){const w=Ed(e-v.x,r,l,h)+v.badness;w<=g&&(p=v,g=w)}return{index:i,x:e,priorBreak:p,badness:g}}function Ad(i){return i?Ad(i.priorBreak).concat(i.index):[]}function Su(i,e,r,s,l,h,p){if(h!=="point")return[];if(!i)return[];const g=[],v=function(z,R,O,j,X,Y){let oe=0;for(let ee=0;ee<z.length();ee++){const ce=z.getSection(ee);oe+=Id(z.getCharCode(ee),ce,j,X,R,Y)}return oe/Math.max(1,Math.ceil(oe/O))}(i,e,r,s,l,p),w=i.text.indexOf("​")>=0;let I=0;for(let z=0;z<i.length();z++){const R=i.getSection(z),O=i.getCharCode(z);if(ic[O]||(I+=Id(O,R,s,l,e,p)),z<i.length()-1){const j=!((A=O)<11904||!(Ue["Bopomofo Extended"](A)||Ue.Bopomofo(A)||Ue["CJK Compatibility Forms"](A)||Ue["CJK Compatibility Ideographs"](A)||Ue["CJK Compatibility"](A)||Ue["CJK Radicals Supplement"](A)||Ue["CJK Strokes"](A)||Ue["CJK Symbols and Punctuation"](A)||Ue["CJK Unified Ideographs Extension A"](A)||Ue["CJK Unified Ideographs"](A)||Ue["Enclosed CJK Letters and Months"](A)||Ue["Halfwidth and Fullwidth Forms"](A)||Ue.Hiragana(A)||Ue["Ideographic Description Characters"](A)||Ue["Kangxi Radicals"](A)||Ue["Katakana Phonetic Extensions"](A)||Ue.Katakana(A)||Ue["Vertical Forms"](A)||Ue["Yi Radicals"](A)||Ue["Yi Syllables"](A)));(Lg[O]||j||R.imageName)&&g.push(Pd(z+1,I,v,g,Rg(O,i.getCharCode(z+1),j&&w),!1))}}var A;return Ad(Pd(i.length(),I,v,g,0,!0))}function Cu(i){let e=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function Fg(i,e,r,s,l){if(!s&&!l)return;const h=i[r],p=(i[r].x+h.metrics.advance*h.scale)*s;for(let g=e;g<=r;g++)i[g].x-=p,i[g].y+=l}function Bg(i,e,r){const{horizontalAlign:s,verticalAlign:l}=Cu(r),h=e[0]-i.displaySize[0]*s,p=e[1]-i.displaySize[1]*l;return{image:i,top:p,bottom:p+i.displaySize[1],left:h,right:h+i.displaySize[0]}}function Md(i,e,r,s,l,h){const p=i.image;let g;if(p.content){const X=p.content,Y=p.pixelRatio||1;g=[X[0]/Y,X[1]/Y,p.displaySize[0]-X[2]/Y,p.displaySize[1]-X[3]/Y]}const v=e.left*h,w=e.right*h;let I,A,z,R;r==="width"||r==="both"?(R=l[0]+v-s[3],A=l[0]+w+s[1]):(R=l[0]+(v+w-p.displaySize[0])/2,A=R+p.displaySize[0]);const O=e.top*h,j=e.bottom*h;return r==="height"||r==="both"?(I=l[1]+O-s[0],z=l[1]+j+s[2]):(I=l[1]+(O+j-p.displaySize[1])/2,z=I+p.displaySize[1]),{image:p,top:I,right:A,bottom:z,left:R,collisionPadding:g}}const Go=255,Rn=128,vs=Go*Rn;function kd(i,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new ii(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:s,interpolationType:l}=r;let h=0;for(;h<s.length&&s[h]<=i;)h++;h=Math.max(0,h-1);let p=h;for(;p<s.length&&s[p]<i+1;)p++;p=Math.min(s.length-1,p);const g=s[h],v=s[p];return r.kind==="composite"?{kind:"composite",minZoom:g,maxZoom:v,interpolationType:l}:{kind:"camera",minZoom:g,maxZoom:v,minSize:r.evaluate(new ii(g)),maxSize:r.evaluate(new ii(v)),interpolationType:l}}}function Tu(i,e,r){let s="never";const l=i.get(e);return l?s=l:i.get(r)&&(s="always"),s}const Og=_s.VectorTileFeature.types,$g=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function rc(i,e,r,s,l,h,p,g,v,w,I,A,z){const R=g?Math.min(vs,Math.round(g[0])):0,O=g?Math.min(vs,Math.round(g[1])):0;i.emplaceBack(e,r,Math.round(32*s),Math.round(32*l),h,p,(R<<1)+(v?1:0),O,16*w,16*I,256*A,256*z)}function Iu(i,e,r){i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r)}function Ng(i){for(const e of i.sections)if(Yc(e.text))return!0;return!1}class Eu{constructor(e){this.layoutVertexArray=new Ct,this.indexArray=new Hi,this.programConfigurations=e,this.segments=new ri,this.dynamicLayoutVertexArray=new bt,this.opacityVertexArray=new It,this.hasVisibleVertices=!1,this.placedSymbolArray=new re}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,s,l){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,_g.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,yg.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,$g,!0),this.opacityVertexBuffer.itemSize=1),(s||l)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}He("SymbolBuffers",Eu);class Pu{constructor(e,r,s){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new s,this.segments=new ri,this.collisionVertexArray=new ti}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,vg.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}He("CollisionBuffers",Pu);class Fa{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=su([]),this.placementViewportMatrix=su([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=kd(this.zoom,r["text-size"]),this.iconSizeData=kd(this.zoom,r["icon-size"]);const s=this.layers[0].layout,l=s.get("symbol-sort-key"),h=s.get("symbol-z-order");this.canOverlap=Tu(s,"text-overlap","text-allow-overlap")!=="never"||Tu(s,"icon-overlap","icon-allow-overlap")!=="never"||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=h!=="viewport-y"&&!l.isConstant(),this.sortFeaturesByY=(h==="viewport-y"||h==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,s.get("symbol-placement")==="point"&&(this.writingModes=s.get("text-writing-mode").map(p=>a.ai[p])),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID}createArrays(){this.text=new Eu(new _n(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Eu(new _n(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new se,this.lineVertexArray=new pe,this.symbolInstances=new J,this.textAnchorOffsets=new be}calculateGlyphDependencies(e,r,s,l,h){for(let p=0;p<e.length;p++)if(r[e.charCodeAt(p)]=!0,(s||l)&&h){const g=Uo[e.charAt(p)];g&&(r[g.charCodeAt(0)]=!0)}}populate(e,r,s){const l=this.layers[0],h=l.layout,p=h.get("text-font"),g=h.get("text-field"),v=h.get("icon-image"),w=(g.value.kind!=="constant"||g.value.value instanceof Qi&&!g.value.value.isEmpty()||g.value.value.toString().length>0)&&(p.value.kind!=="constant"||p.value.value.length>0),I=v.value.kind!=="constant"||!!v.value.value||Object.keys(v.parameters).length>0,A=h.get("symbol-sort-key");if(this.features=[],!w&&!I)return;const z=r.iconDependencies,R=r.glyphDependencies,O=r.availableImages,j=new ii(this.zoom);for(const{feature:X,id:Y,index:oe,sourceLayerIndex:ee}of e){const ce=l._featureFilter.needGeometry,de=Gs(X,ce);if(!l._featureFilter.filter(j,de,s))continue;let we,qe;if(ce||(de.geometry=Zs(X)),w){const Ve=l.getValueAndResolveTokens("text-field",de,s,O),$e=Qi.factory(Ve);Ng($e)&&(this.hasRTLText=!0),(!this.hasRTLText||So()==="unavailable"||this.hasRTLText&&Ar.isParsed())&&(we=bg($e,l,de))}if(I){const Ve=l.getValueAndResolveTokens("icon-image",de,s,O);qe=Ve instanceof Gi?Ve:Gi.fromString(Ve)}if(!we&&!qe)continue;const Je=this.sortFeaturesByKey?A.evaluate(de,{},s):void 0;if(this.features.push({id:Y,text:we,icon:qe,index:oe,sourceLayerIndex:ee,geometry:de.geometry,properties:X.properties,type:Og[X.type],sortKey:Je}),qe&&(z[qe.name]=!0),we){const Ve=p.evaluate(de,{},s).join(","),$e=h.get("text-rotation-alignment")!=="viewport"&&h.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(a.ai.vertical)>=0;for(const Fe of we.sections)if(Fe.image)z[Fe.image.name]=!0;else{const We=mo(we.toString()),Be=Fe.fontStack||Ve,Ae=R[Be]=R[Be]||{};this.calculateGlyphDependencies(Fe.text,Ae,$e,this.allowVerticalPlacement,We)}}}h.get("symbol-placement")==="line"&&(this.features=function(X){const Y={},oe={},ee=[];let ce=0;function de(Ve){ee.push(X[Ve]),ce++}function we(Ve,$e,Fe){const We=oe[Ve];return delete oe[Ve],oe[$e]=We,ee[We].geometry[0].pop(),ee[We].geometry[0]=ee[We].geometry[0].concat(Fe[0]),We}function qe(Ve,$e,Fe){const We=Y[$e];return delete Y[$e],Y[Ve]=We,ee[We].geometry[0].shift(),ee[We].geometry[0]=Fe[0].concat(ee[We].geometry[0]),We}function Je(Ve,$e,Fe){const We=Fe?$e[0][$e[0].length-1]:$e[0][0];return`${Ve}:${We.x}:${We.y}`}for(let Ve=0;Ve<X.length;Ve++){const $e=X[Ve],Fe=$e.geometry,We=$e.text?$e.text.toString():null;if(!We){de(Ve);continue}const Be=Je(We,Fe),Ae=Je(We,Fe,!0);if(Be in oe&&Ae in Y&&oe[Be]!==Y[Ae]){const st=qe(Be,Ae,Fe),et=we(Be,Ae,ee[st].geometry);delete Y[Be],delete oe[Ae],oe[Je(We,ee[et].geometry,!0)]=et,ee[st].geometry=null}else Be in oe?we(Be,Ae,Fe):Ae in Y?qe(Be,Ae,Fe):(de(Ve),Y[Be]=ce-1,oe[Ae]=ce-1)}return ee.filter(Ve=>Ve.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((X,Y)=>X.sortKey-Y.sortKey)}update(e,r,s){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,s),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,s))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const s=this.lineVertexArray.length;if(e.segment!==void 0){let l=e.dist(r[e.segment+1]),h=e.dist(r[e.segment]);const p={};for(let g=e.segment+1;g<r.length;g++)p[g]={x:r[g].x,y:r[g].y,tileUnitDistanceFromAnchor:l},g<r.length-1&&(l+=r[g+1].dist(r[g]));for(let g=e.segment||0;g>=0;g--)p[g]={x:r[g].x,y:r[g].y,tileUnitDistanceFromAnchor:h},g>0&&(h+=r[g-1].dist(r[g]));for(let g=0;g<r.length;g++){const v=p[g];this.lineVertexArray.emplaceBack(v.x,v.y,v.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,r,s,l,h,p,g,v,w,I,A,z){const R=e.indexArray,O=e.layoutVertexArray,j=e.segments.prepareSegment(4*r.length,O,R,this.canOverlap?p.sortKey:void 0),X=this.glyphOffsetArray.length,Y=j.vertexLength,oe=this.allowVerticalPlacement&&g===a.ai.vertical?Math.PI/2:0,ee=p.text&&p.text.sections;for(let ce=0;ce<r.length;ce++){const{tl:de,tr:we,bl:qe,br:Je,tex:Ve,pixelOffsetTL:$e,pixelOffsetBR:Fe,minFontScaleX:We,minFontScaleY:Be,glyphOffset:Ae,isSDF:st,sectionIndex:et}=r[ce],St=j.vertexLength,ni=Ae[1];rc(O,v.x,v.y,de.x,ni+de.y,Ve.x,Ve.y,s,st,$e.x,$e.y,We,Be),rc(O,v.x,v.y,we.x,ni+we.y,Ve.x+Ve.w,Ve.y,s,st,Fe.x,$e.y,We,Be),rc(O,v.x,v.y,qe.x,ni+qe.y,Ve.x,Ve.y+Ve.h,s,st,$e.x,Fe.y,We,Be),rc(O,v.x,v.y,Je.x,ni+Je.y,Ve.x+Ve.w,Ve.y+Ve.h,s,st,Fe.x,Fe.y,We,Be),Iu(e.dynamicLayoutVertexArray,v,oe),R.emplaceBack(St,St+1,St+2),R.emplaceBack(St+1,St+2,St+3),j.vertexLength+=4,j.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ae[0]),ce!==r.length-1&&et===r[ce+1].sectionIndex||e.programConfigurations.populatePaintArrays(O.length,p,p.index,{},z,ee&&ee[et])}e.placedSymbolArray.emplaceBack(v.x,v.y,X,this.glyphOffsetArray.length-X,Y,w,I,v.segment,s?s[0]:0,s?s[1]:0,l[0],l[1],g,0,!1,0,A)}_addCollisionDebugVertex(e,r,s,l,h,p){return r.emplaceBack(0,0),e.emplaceBack(s.x,s.y,l,h,Math.round(p.x),Math.round(p.y))}addCollisionDebugVertices(e,r,s,l,h,p,g){const v=h.segments.prepareSegment(4,h.layoutVertexArray,h.indexArray),w=v.vertexLength,I=h.layoutVertexArray,A=h.collisionVertexArray,z=g.anchorX,R=g.anchorY;this._addCollisionDebugVertex(I,A,p,z,R,new ue(e,r)),this._addCollisionDebugVertex(I,A,p,z,R,new ue(s,r)),this._addCollisionDebugVertex(I,A,p,z,R,new ue(s,l)),this._addCollisionDebugVertex(I,A,p,z,R,new ue(e,l)),v.vertexLength+=4;const O=h.indexArray;O.emplaceBack(w,w+1),O.emplaceBack(w+1,w+2),O.emplaceBack(w+2,w+3),O.emplaceBack(w+3,w),v.primitiveLength+=4}addDebugCollisionBoxes(e,r,s,l){for(let h=e;h<r;h++){const p=this.collisionBoxArray.get(h);this.addCollisionDebugVertices(p.x1,p.y1,p.x2,p.y2,l?this.textCollisionBox:this.iconCollisionBox,p.anchorPoint,s)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Pu(yi,md.members,zi),this.iconCollisionBox=new Pu(yi,md.members,zi);for(let e=0;e<this.symbolInstances.length;e++){const r=this.symbolInstances.get(e);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(e,r,s,l,h,p,g,v,w){const I={};for(let A=r;A<s;A++){const z=e.get(A);I.textBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},I.textFeatureIndex=z.featureIndex;break}for(let A=l;A<h;A++){const z=e.get(A);I.verticalTextBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},I.verticalTextFeatureIndex=z.featureIndex;break}for(let A=p;A<g;A++){const z=e.get(A);I.iconBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},I.iconFeatureIndex=z.featureIndex;break}for(let A=v;A<w;A++){const z=e.get(A);I.verticalIconBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},I.verticalIconFeatureIndex=z.featureIndex;break}return I}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const s=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const s=e.placedSymbolArray.get(r),l=s.vertexStartIndex+4*s.numGlyphs;for(let h=s.vertexStartIndex;h<l;h+=4)e.indexArray.emplaceBack(h,h+1,h+2),e.indexArray.emplaceBack(h+1,h+2,h+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),s=Math.cos(e),l=[],h=[],p=[];for(let g=0;g<this.symbolInstances.length;++g){p.push(g);const v=this.symbolInstances.get(g);l.push(0|Math.round(r*v.anchorX+s*v.anchorY)),h.push(v.featureIndex)}return p.sort((g,v)=>l[g]-l[v]||h[v]-h[g]),p}addToSortKeyRanges(e,r){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===r?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const s=this.symbolInstances.get(r);this.featureSortOrder.push(s.featureIndex),[s.rightJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.leftJustifiedTextSymbolIndex].forEach((l,h,p)=>{l>=0&&p.indexOf(l)===h&&this.addIndicesForPlacedSymbol(this.text,l)}),s.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,s.verticalPlacedTextSymbolIndex),s.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.placedIconSymbolIndex),s.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let zd,Dd;He("SymbolBucket",Fa,{omit:["layers","collisionBoxArray","features","compareText"]}),Fa.MAX_GLYPHS=65535,Fa.addDynamicAttributes=Iu;var Au={get paint(){return Dd=Dd||new wi({"icon-opacity":new ut(ge.paint_symbol["icon-opacity"]),"icon-color":new ut(ge.paint_symbol["icon-color"]),"icon-halo-color":new ut(ge.paint_symbol["icon-halo-color"]),"icon-halo-width":new ut(ge.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ut(ge.paint_symbol["icon-halo-blur"]),"icon-translate":new tt(ge.paint_symbol["icon-translate"]),"icon-translate-anchor":new tt(ge.paint_symbol["icon-translate-anchor"]),"text-opacity":new ut(ge.paint_symbol["text-opacity"]),"text-color":new ut(ge.paint_symbol["text-color"],{runtimeType:_i,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new ut(ge.paint_symbol["text-halo-color"]),"text-halo-width":new ut(ge.paint_symbol["text-halo-width"]),"text-halo-blur":new ut(ge.paint_symbol["text-halo-blur"]),"text-translate":new tt(ge.paint_symbol["text-translate"]),"text-translate-anchor":new tt(ge.paint_symbol["text-translate-anchor"])})},get layout(){return zd=zd||new wi({"symbol-placement":new tt(ge.layout_symbol["symbol-placement"]),"symbol-spacing":new tt(ge.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new tt(ge.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ut(ge.layout_symbol["symbol-sort-key"]),"symbol-z-order":new tt(ge.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new tt(ge.layout_symbol["icon-allow-overlap"]),"icon-overlap":new tt(ge.layout_symbol["icon-overlap"]),"icon-ignore-placement":new tt(ge.layout_symbol["icon-ignore-placement"]),"icon-optional":new tt(ge.layout_symbol["icon-optional"]),"icon-rotation-alignment":new tt(ge.layout_symbol["icon-rotation-alignment"]),"icon-size":new ut(ge.layout_symbol["icon-size"]),"icon-text-fit":new tt(ge.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new tt(ge.layout_symbol["icon-text-fit-padding"]),"icon-image":new ut(ge.layout_symbol["icon-image"]),"icon-rotate":new ut(ge.layout_symbol["icon-rotate"]),"icon-padding":new ut(ge.layout_symbol["icon-padding"]),"icon-keep-upright":new tt(ge.layout_symbol["icon-keep-upright"]),"icon-offset":new ut(ge.layout_symbol["icon-offset"]),"icon-anchor":new ut(ge.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new tt(ge.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new tt(ge.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new tt(ge.layout_symbol["text-rotation-alignment"]),"text-field":new ut(ge.layout_symbol["text-field"]),"text-font":new ut(ge.layout_symbol["text-font"]),"text-size":new ut(ge.layout_symbol["text-size"]),"text-max-width":new ut(ge.layout_symbol["text-max-width"]),"text-line-height":new tt(ge.layout_symbol["text-line-height"]),"text-letter-spacing":new ut(ge.layout_symbol["text-letter-spacing"]),"text-justify":new ut(ge.layout_symbol["text-justify"]),"text-radial-offset":new ut(ge.layout_symbol["text-radial-offset"]),"text-variable-anchor":new tt(ge.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new ut(ge.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new ut(ge.layout_symbol["text-anchor"]),"text-max-angle":new tt(ge.layout_symbol["text-max-angle"]),"text-writing-mode":new tt(ge.layout_symbol["text-writing-mode"]),"text-rotate":new ut(ge.layout_symbol["text-rotate"]),"text-padding":new tt(ge.layout_symbol["text-padding"]),"text-keep-upright":new tt(ge.layout_symbol["text-keep-upright"]),"text-transform":new ut(ge.layout_symbol["text-transform"]),"text-offset":new ut(ge.layout_symbol["text-offset"]),"text-allow-overlap":new tt(ge.layout_symbol["text-allow-overlap"]),"text-overlap":new tt(ge.layout_symbol["text-overlap"]),"text-ignore-placement":new tt(ge.layout_symbol["text-ignore-placement"]),"text-optional":new tt(ge.layout_symbol["text-optional"])})}};class Ld{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:wt,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}He("FormatSectionOverride",Ld,{omit:["defaultValue"]});class nc extends jr{constructor(e){super(e,Au)}recalculate(e,r){if(super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const s=this.layout.get("text-writing-mode");if(s){const l=[];for(const h of s)l.indexOf(h)<0&&l.push(h);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,r,s,l){const h=this.layout.get(e).evaluate(r,{},s,l),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||ga(p.value)||!h?h:function(g,v){return v.replace(/{([^{}]+)}/g,(w,I)=>g&&I in g?String(g[I]):"")}(r.properties,h)}createBucket(e){return new Fa(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of Au.paint.overridableProperties){if(!nc.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),s=new Ld(r),l=new lo(s,r.property.specification);let h=null;h=r.value.kind==="constant"||r.value.kind==="source"?new co("source",l):new ya("composite",l,r.value.zoomStops),this.paint._values[e]=new or(r.property,h,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,s){return!(!this.layout||r.isDataDriven()||s.isDataDriven())&&nc.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const s=e.get("text-field"),l=Au.paint.properties[r];let h=!1;const p=g=>{for(const v of g)if(l.overrides&&l.overrides.hasOverride(v))return void(h=!0)};if(s.value.kind==="constant"&&s.value.value instanceof Qi)p(s.value.value.sections);else if(s.value.kind==="source"){const g=w=>{h||(w instanceof Nn&&ci(w.value)===Z?p(w.value.sections):w instanceof ma?p(w.sections):w.eachChild(g))},v=s.value;v._styleExpression&&g(v._styleExpression.expression)}return h}}let Rd;var jg={get paint(){return Rd=Rd||new wi({"background-color":new tt(ge.paint_background["background-color"]),"background-pattern":new To(ge.paint_background["background-pattern"]),"background-opacity":new tt(ge.paint_background["background-opacity"])})}};class Vg extends jr{constructor(e){super(e,jg)}}let Fd;var Ug={get paint(){return Fd=Fd||new wi({"raster-opacity":new tt(ge.paint_raster["raster-opacity"]),"raster-hue-rotate":new tt(ge.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new tt(ge.paint_raster["raster-brightness-min"]),"raster-brightness-max":new tt(ge.paint_raster["raster-brightness-max"]),"raster-saturation":new tt(ge.paint_raster["raster-saturation"]),"raster-contrast":new tt(ge.paint_raster["raster-contrast"]),"raster-resampling":new tt(ge.paint_raster["raster-resampling"]),"raster-fade-duration":new tt(ge.paint_raster["raster-fade-duration"])})}};class qg extends jr{constructor(e){super(e,Ug)}}class Zg extends jr{constructor(e){super(e,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Gg{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Mu=63710088e-1;class xs{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new xs(Ye(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,s=this.lat*r,l=e.lat*r,h=Math.sin(s)*Math.sin(l)+Math.cos(s)*Math.cos(l)*Math.cos((e.lng-this.lng)*r);return Mu*Math.acos(Math.min(h,1))}static convert(e){if(e instanceof xs)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new xs(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new xs(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Bd=2*Math.PI*Mu;function Od(i){return Bd*Math.cos(i*Math.PI/180)}function $d(i){return(180+i)/360}function Nd(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function jd(i,e){return i/Od(e)}function Vd(i){return 360*i-180}function ku(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class sc{constructor(e,r,s=0){this.x=+e,this.y=+r,this.z=+s}static fromLngLat(e,r=0){const s=xs.convert(e);return new sc($d(s.lng),Nd(s.lat),jd(r,s.lat))}toLngLat(){return new xs(Vd(this.x),ku(this.y))}toAltitude(){return this.z*Od(ku(this.y))}meterInMercatorCoordinateUnits(){return 1/Bd*(e=ku(this.y),1/Math.cos(e*Math.PI/180));var e}}function Ud(i,e,r){var s=2*Math.PI*6378137/256/Math.pow(2,r);return[i*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}class zu{constructor(e,r,s){if(e<0||e>25||s<0||s>=Math.pow(2,e)||r<0||r>=Math.pow(2,e))throw new Error(`x=${r}, y=${s}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=r,this.y=s,this.key=Ho(0,e,e,r,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r,s){const l=(p=this.y,g=this.z,v=Ud(256*(h=this.x),256*(p=Math.pow(2,g)-p-1),g),w=Ud(256*(h+1),256*(p+1),g),v[0]+","+v[1]+","+w[0]+","+w[1]);var h,p,g,v,w;const I=function(A,z,R){let O,j="";for(let X=A;X>0;X--)O=1<<X-1,j+=(z&O?1:0)+(R&O?2:0);return j}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,I).replace(/{bbox-epsg-3857}/g,l)}isChildOf(e){const r=this.z-e.z;return r>0&&e.x===this.x>>r&&e.y===this.y>>r}getTilePoint(e){const r=Math.pow(2,this.z);return new ue((e.x*r-this.x)*Pi,(e.y*r-this.y)*Pi)}toString(){return`${this.z}/${this.x}/${this.y}`}}class qd{constructor(e,r){this.wrap=e,this.canonical=r,this.key=Ho(e,r.z,r.z,r.x,r.y)}}class Hr{constructor(e,r,s,l,h){if(e<s)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${s}`);this.overscaledZ=e,this.wrap=r,this.canonical=new zu(s,+l,+h),this.key=Ho(r,e,s,l,h)}clone(){return new Hr(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-e;return e>this.canonical.z?new Hr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Hr(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-e;return e>this.canonical.z?Ho(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y):Ho(this.wrap*+r,e,e,this.canonical.x>>s,this.canonical.y>>s)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new Hr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,s=2*this.canonical.x,l=2*this.canonical.y;return[new Hr(r,this.wrap,r,s,l),new Hr(r,this.wrap,r,s+1,l),new Hr(r,this.wrap,r,s,l+1),new Hr(r,this.wrap,r,s+1,l+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Hr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Hr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new qd(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new sc(e.x-this.wrap,e.y))}}function Ho(i,e,r,s,l){(i*=2)<0&&(i=-1*i-1);const h=1<<r;return(h*h*i+h*l+s).toString(36)+r.toString(36)+e.toString(36)}He("CanonicalTileID",zu),He("OverscaledTileID",Hr,{omit:["posMatrix"]});class Zd{constructor(e,r,s,l=1,h=1,p=1,g=0){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(s&&!["mapbox","terrarium","custom"].includes(s))return void gt(`"${s}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const v=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),s){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=l,this.greenFactor=h,this.blueFactor=p,this.baseShift=g;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let w=0;w<v;w++)this.data[this._idx(-1,w)]=this.data[this._idx(0,w)],this.data[this._idx(v,w)]=this.data[this._idx(v-1,w)],this.data[this._idx(w,-1)]=this.data[this._idx(w,0)],this.data[this._idx(w,v)]=this.data[this._idx(w,v-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(v,-1)]=this.data[this._idx(v-1,0)],this.data[this._idx(-1,v)]=this.data[this._idx(0,v-1)],this.data[this._idx(v,v)]=this.data[this._idx(v-1,v-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let w=0;w<v;w++)for(let I=0;I<v;I++){const A=this.get(w,I);A>this.max&&(this.max=A),A<this.min&&(this.min=A)}}get(e,r){const s=new Uint8Array(this.data.buffer),l=4*this._idx(e,r);return this.unpack(s[l],s[l+1],s[l+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}unpack(e,r,s){return e*this.redFactor+r*this.greenFactor+s*this.blueFactor-this.baseShift}getPixels(){return new Gr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,r,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let l=r*this.dim,h=r*this.dim+this.dim,p=s*this.dim,g=s*this.dim+this.dim;switch(r){case-1:l=h-1;break;case 1:h=l+1}switch(s){case-1:p=g-1;break;case 1:g=p+1}const v=-r*this.dim,w=-s*this.dim;for(let I=p;I<g;I++)for(let A=l;A<h;A++)this.data[this._idx(A,I)]=e.data[this._idx(A+v,I+w)]}}He("DEMData",Zd);class Gd{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const s=e[r];this._stringToNumber[s]=r,this._numberToString[r]=s}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class Hd{constructor(e,r,s,l,h){this.type="Feature",this._vectorTileFeature=e,e._z=r,e._x=s,e._y=l,this.properties=e.properties,this.id=h}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(e[r]=this[r]);return e}}class Wd{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new ds(Pi,16,0),this.grid3D=new ds(Pi,16,0),this.featureIndexArray=new Ce,this.promoteId=r}insert(e,r,s,l,h,p){const g=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,l,h);const v=p?this.grid3D:this.grid;for(let w=0;w<r.length;w++){const I=r[w],A=[1/0,1/0,-1/0,-1/0];for(let z=0;z<I.length;z++){const R=I[z];A[0]=Math.min(A[0],R.x),A[1]=Math.min(A[1],R.y),A[2]=Math.max(A[2],R.x),A[3]=Math.max(A[3],R.y)}A[0]<Pi&&A[1]<Pi&&A[2]>=0&&A[3]>=0&&v.insert(g,A[0],A[1],A[2],A[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new _s.VectorTile(new xu(this.rawTileData)).layers,this.sourceLayerCoder=new Gd(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,r,s,l){this.loadVTLayers();const h=e.params||{},p=Pi/e.tileSize/e.scale,g=ho(h.filter),v=e.queryGeometry,w=e.queryPadding*p,I=Kd(v),A=this.grid.query(I.minX-w,I.minY-w,I.maxX+w,I.maxY+w),z=Kd(e.cameraQueryGeometry),R=this.grid3D.query(z.minX-w,z.minY-w,z.maxX+w,z.maxY+w,(X,Y,oe,ee)=>function(ce,de,we,qe,Je){for(const $e of ce)if(de<=$e.x&&we<=$e.y&&qe>=$e.x&&Je>=$e.y)return!0;const Ve=[new ue(de,we),new ue(de,Je),new ue(qe,Je),new ue(qe,we)];if(ce.length>2){for(const $e of Ve)if(Aa(ce,$e))return!0}for(let $e=0;$e<ce.length-1;$e++)if(Cm(ce[$e],ce[$e+1],Ve))return!0;return!1}(e.cameraQueryGeometry,X-w,Y-w,oe+w,ee+w));for(const X of R)A.push(X);A.sort(Hg);const O={};let j;for(let X=0;X<A.length;X++){const Y=A[X];if(Y===j)continue;j=Y;const oe=this.featureIndexArray.get(Y);let ee=null;this.loadMatchingFeature(O,oe.bucketIndex,oe.sourceLayerIndex,oe.featureIndex,g,h.layers,h.availableImages,r,s,l,(ce,de,we)=>(ee||(ee=Zs(ce)),de.queryIntersectsFeature(v,ce,we,ee,this.z,e.transform,p,e.pixelPosMatrix)))}return O}loadMatchingFeature(e,r,s,l,h,p,g,v,w,I,A){const z=this.bucketLayerIDs[r];if(p&&!function(X,Y){for(let oe=0;oe<X.length;oe++)if(Y.indexOf(X[oe])>=0)return!0;return!1}(p,z))return;const R=this.sourceLayerCoder.decode(s),O=this.vtLayers[R].feature(l);if(h.needGeometry){const X=Gs(O,!0);if(!h.filter(new ii(this.tileID.overscaledZ),X,this.tileID.canonical))return}else if(!h.filter(new ii(this.tileID.overscaledZ),O))return;const j=this.getId(O,R);for(let X=0;X<z.length;X++){const Y=z[X];if(p&&p.indexOf(Y)<0)continue;const oe=v[Y];if(!oe)continue;let ee={};j&&I&&(ee=I.getState(oe.sourceLayer||"_geojsonTileLayer",j));const ce=Ge({},w[Y]);ce.paint=Xd(ce.paint,oe.paint,O,ee,g),ce.layout=Xd(ce.layout,oe.layout,O,ee,g);const de=!A||A(O,oe,ee);if(!de)continue;const we=new Hd(O,this.z,this.x,this.y,j);we.layer=ce;let qe=e[Y];qe===void 0&&(qe=e[Y]=[]),qe.push({featureIndex:l,feature:we,intersectionZ:de})}}lookupSymbolFeatures(e,r,s,l,h,p,g,v){const w={};this.loadVTLayers();const I=ho(h);for(const A of e)this.loadMatchingFeature(w,s,l,A,I,p,g,v,r);return w}hasLayer(e){for(const r of this.bucketLayerIDs)for(const s of r)if(e===s)return!0;return!1}getId(e,r){let s=e.id;return this.promoteId&&(s=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof s=="boolean"&&(s=Number(s))),s}}function Xd(i,e,r,s,l){return De(i,(h,p)=>{const g=e instanceof Ea?e.get(p):null;return g&&g.evaluate?g.evaluate(r,s,l):g})}function Kd(i){let e=1/0,r=1/0,s=-1/0,l=-1/0;for(const h of i)e=Math.min(e,h.x),r=Math.min(r,h.y),s=Math.max(s,h.x),l=Math.max(l,h.y);return{minX:e,minY:r,maxX:s,maxY:l}}function Hg(i,e){return e-i}function Jd(i,e,r,s,l){const h=[];for(let p=0;p<i.length;p++){const g=i[p];let v;for(let w=0;w<g.length-1;w++){let I=g[w],A=g[w+1];I.x<e&&A.x<e||(I.x<e?I=new ue(e,I.y+(e-I.x)/(A.x-I.x)*(A.y-I.y))._round():A.x<e&&(A=new ue(e,I.y+(e-I.x)/(A.x-I.x)*(A.y-I.y))._round()),I.y<r&&A.y<r||(I.y<r?I=new ue(I.x+(r-I.y)/(A.y-I.y)*(A.x-I.x),r)._round():A.y<r&&(A=new ue(I.x+(r-I.y)/(A.y-I.y)*(A.x-I.x),r)._round()),I.x>=s&&A.x>=s||(I.x>=s?I=new ue(s,I.y+(s-I.x)/(A.x-I.x)*(A.y-I.y))._round():A.x>=s&&(A=new ue(s,I.y+(s-I.x)/(A.x-I.x)*(A.y-I.y))._round()),I.y>=l&&A.y>=l||(I.y>=l?I=new ue(I.x+(l-I.y)/(A.y-I.y)*(A.x-I.x),l)._round():A.y>=l&&(A=new ue(I.x+(l-I.y)/(A.y-I.y)*(A.x-I.x),l)._round()),v&&I.equals(v[v.length-1])||(v=[I],h.push(v)),v.push(A)))))}}return h}He("FeatureIndex",Wd,{omit:["rawTileData","sourceLayerCoder"]});class bs extends ue{constructor(e,r,s,l){super(e,r),this.angle=s,l!==void 0&&(this.segment=l)}clone(){return new bs(this.x,this.y,this.angle,this.segment)}}function Yd(i,e,r,s,l){if(e.segment===void 0||r===0)return!0;let h=e,p=e.segment+1,g=0;for(;g>-r/2;){if(p--,p<0)return!1;g-=i[p].dist(h),h=i[p]}g+=i[p].dist(i[p+1]),p++;const v=[];let w=0;for(;g<r/2;){const I=i[p],A=i[p+1];if(!A)return!1;let z=i[p-1].angleTo(I)-I.angleTo(A);for(z=Math.abs((z+3*Math.PI)%(2*Math.PI)-Math.PI),v.push({distance:g,angleDelta:z}),w+=z;g-v[0].distance>s;)w-=v.shift().angleDelta;if(w>l)return!1;p++,g+=I.dist(A)}return!0}function Qd(i){let e=0;for(let r=0;r<i.length-1;r++)e+=i[r].dist(i[r+1]);return e}function ep(i,e,r){return i?.6*e*r:0}function tp(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function Wg(i,e,r,s,l,h){const p=ep(r,l,h),g=tp(r,s)*h;let v=0;const w=Qd(i)/2;for(let I=0;I<i.length-1;I++){const A=i[I],z=i[I+1],R=A.dist(z);if(v+R>w){const O=(w-v)/R,j=Ir.number(A.x,z.x,O),X=Ir.number(A.y,z.y,O),Y=new bs(j,X,z.angleTo(A),I);return Y._round(),!p||Yd(i,Y,g,p,e)?Y:void 0}v+=R}}function Xg(i,e,r,s,l,h,p,g,v){const w=ep(s,h,p),I=tp(s,l),A=I*p,z=i[0].x===0||i[0].x===v||i[0].y===0||i[0].y===v;return e-A<e/4&&(e=A+e/4),ip(i,z?e/2*g%e:(I/2+2*h)*p*g%e,e,w,r,A,z,!1,v)}function ip(i,e,r,s,l,h,p,g,v){const w=h/2,I=Qd(i);let A=0,z=e-r,R=[];for(let O=0;O<i.length-1;O++){const j=i[O],X=i[O+1],Y=j.dist(X),oe=X.angleTo(j);for(;z+r<A+Y;){z+=r;const ee=(z-A)/Y,ce=Ir.number(j.x,X.x,ee),de=Ir.number(j.y,X.y,ee);if(ce>=0&&ce<v&&de>=0&&de<v&&z-w>=0&&z+w<=I){const we=new bs(ce,de,oe,O);we._round(),s&&!Yd(i,we,h,s,l)||R.push(we)}}A+=Y}return g||R.length||p||(R=ip(i,A/2,r,s,l,h,p,!0,v)),R}He("Anchor",bs);const Ba=kr;function rp(i,e,r,s){const l=[],h=i.image,p=h.pixelRatio,g=h.paddedRect.w-2*Ba,v=h.paddedRect.h-2*Ba,w=i.right-i.left,I=i.bottom-i.top,A=h.stretchX||[[0,g]],z=h.stretchY||[[0,v]],R=(Fe,We)=>Fe+We[1]-We[0],O=A.reduce(R,0),j=z.reduce(R,0),X=g-O,Y=v-j;let oe=0,ee=O,ce=0,de=j,we=0,qe=X,Je=0,Ve=Y;if(h.content&&s){const Fe=h.content;oe=ac(A,0,Fe[0]),ce=ac(z,0,Fe[1]),ee=ac(A,Fe[0],Fe[2]),de=ac(z,Fe[1],Fe[3]),we=Fe[0]-oe,Je=Fe[1]-ce,qe=Fe[2]-Fe[0]-ee,Ve=Fe[3]-Fe[1]-de}const $e=(Fe,We,Be,Ae)=>{const st=oc(Fe.stretch-oe,ee,w,i.left),et=lc(Fe.fixed-we,qe,Fe.stretch,O),St=oc(We.stretch-ce,de,I,i.top),ni=lc(We.fixed-Je,Ve,We.stretch,j),li=oc(Be.stretch-oe,ee,w,i.left),Ri=lc(Be.fixed-we,qe,Be.stretch,O),Ur=oc(Ae.stretch-ce,de,I,i.top),xr=lc(Ae.fixed-Je,Ve,Ae.stretch,j),Ai=new ue(st,St),Xi=new ue(li,St),ir=new ue(li,Ur),br=new ue(st,Ur),wr=new ue(et/p,ni/p),Fi=new ue(Ri/p,xr/p),Bi=e*Math.PI/180;if(Bi){const ur=Math.sin(Bi),zr=Math.cos(Bi),Dr=[zr,-ur,ur,zr];Ai._matMult(Dr),Xi._matMult(Dr),br._matMult(Dr),ir._matMult(Dr)}const cr=Fe.stretch+Fe.fixed,Sr=We.stretch+We.fixed;return{tl:Ai,tr:Xi,bl:br,br:ir,tex:{x:h.paddedRect.x+Ba+cr,y:h.paddedRect.y+Ba+Sr,w:Be.stretch+Be.fixed-cr,h:Ae.stretch+Ae.fixed-Sr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:wr,pixelOffsetBR:Fi,minFontScaleX:qe/p/w,minFontScaleY:Ve/p/I,isSDF:r}};if(s&&(h.stretchX||h.stretchY)){const Fe=np(A,X,O),We=np(z,Y,j);for(let Be=0;Be<Fe.length-1;Be++){const Ae=Fe[Be],st=Fe[Be+1];for(let et=0;et<We.length-1;et++)l.push($e(Ae,We[et],st,We[et+1]))}}else l.push($e({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:g+1},{fixed:0,stretch:v+1}));return l}function ac(i,e,r){let s=0;for(const l of i)s+=Math.max(e,Math.min(r,l[1]))-Math.max(e,Math.min(r,l[0]));return s}function np(i,e,r){const s=[{fixed:-Ba,stretch:0}];for(const[l,h]of i){const p=s[s.length-1];s.push({fixed:l-p.stretch,stretch:p.stretch}),s.push({fixed:l-p.stretch,stretch:p.stretch+(h-l)})}return s.push({fixed:e+Ba,stretch:r}),s}function oc(i,e,r,s){return i/e*r+s}function lc(i,e,r,s){return i-e*r/s}class cc{constructor(e,r,s,l,h,p,g,v,w,I){if(this.boxStartIndex=e.length,w){let A=p.top,z=p.bottom;const R=p.collisionPadding;R&&(A-=R[1],z+=R[3]);let O=z-A;O>0&&(O=Math.max(10,O),this.circleDiameter=O)}else{let A=p.top*g-v[0],z=p.bottom*g+v[2],R=p.left*g-v[3],O=p.right*g+v[1];const j=p.collisionPadding;if(j&&(R-=j[0]*g,A-=j[1]*g,O+=j[2]*g,z+=j[3]*g),I){const X=new ue(R,A),Y=new ue(O,A),oe=new ue(R,z),ee=new ue(O,z),ce=I*Math.PI/180;X._rotate(ce),Y._rotate(ce),oe._rotate(ce),ee._rotate(ce),R=Math.min(X.x,Y.x,oe.x,ee.x),O=Math.max(X.x,Y.x,oe.x,ee.x),A=Math.min(X.y,Y.y,oe.y,ee.y),z=Math.max(X.y,Y.y,oe.y,ee.y)}e.emplaceBack(r.x,r.y,R,A,O,z,s,l,h)}this.boxEndIndex=e.length}}class Kg{constructor(e=[],r=Jg){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:s}=this,l=r[e];for(;e>0;){const h=e-1>>1,p=r[h];if(s(l,p)>=0)break;r[e]=p,e=h}r[e]=l}_down(e){const{data:r,compare:s}=this,l=this.length>>1,h=r[e];for(;e<l;){let p=1+(e<<1),g=r[p];const v=p+1;if(v<this.length&&s(r[v],g)<0&&(p=v,g=r[v]),s(g,h)>=0)break;r[e]=g,e=p}r[e]=h}}function Jg(i,e){return i<e?-1:i>e?1:0}function Yg(i,e=1,r=!1){let s=1/0,l=1/0,h=-1/0,p=-1/0;const g=i[0];for(let R=0;R<g.length;R++){const O=g[R];(!R||O.x<s)&&(s=O.x),(!R||O.y<l)&&(l=O.y),(!R||O.x>h)&&(h=O.x),(!R||O.y>p)&&(p=O.y)}const v=Math.min(h-s,p-l);let w=v/2;const I=new Kg([],Qg);if(v===0)return new ue(s,l);for(let R=s;R<h;R+=v)for(let O=l;O<p;O+=v)I.push(new Oa(R+w,O+w,w,i));let A=function(R){let O=0,j=0,X=0;const Y=R[0];for(let oe=0,ee=Y.length,ce=ee-1;oe<ee;ce=oe++){const de=Y[oe],we=Y[ce],qe=de.x*we.y-we.x*de.y;j+=(de.x+we.x)*qe,X+=(de.y+we.y)*qe,O+=3*qe}return new Oa(j/O,X/O,0,R)}(i),z=I.length;for(;I.length;){const R=I.pop();(R.d>A.d||!A.d)&&(A=R,r&&console.log("found best %d after %d probes",Math.round(1e4*R.d)/1e4,z)),R.max-A.d<=e||(w=R.h/2,I.push(new Oa(R.p.x-w,R.p.y-w,w,i)),I.push(new Oa(R.p.x+w,R.p.y-w,w,i)),I.push(new Oa(R.p.x-w,R.p.y+w,w,i)),I.push(new Oa(R.p.x+w,R.p.y+w,w,i)),z+=4)}return r&&(console.log(`num probes: ${z}`),console.log(`best distance: ${A.d}`)),A.p}function Qg(i,e){return e.max-i.max}function Oa(i,e,r,s){this.p=new ue(i,e),this.h=r,this.d=function(l,h){let p=!1,g=1/0;for(let v=0;v<h.length;v++){const w=h[v];for(let I=0,A=w.length,z=A-1;I<A;z=I++){const R=w[I],O=w[z];R.y>l.y!=O.y>l.y&&l.x<(O.x-R.x)*(l.y-R.y)/(O.y-R.y)+R.x&&(p=!p),g=Math.min(g,Nh(l,R,O))}}return(p?1:-1)*Math.sqrt(g)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}var tr;a.aq=void 0,(tr=a.aq||(a.aq={}))[tr.center=1]="center",tr[tr.left=2]="left",tr[tr.right=3]="right",tr[tr.top=4]="top",tr[tr.bottom=5]="bottom",tr[tr["top-left"]=6]="top-left",tr[tr["top-right"]=7]="top-right",tr[tr["bottom-left"]=8]="bottom-left",tr[tr["bottom-right"]=9]="bottom-right";const ws=7,Du=Number.POSITIVE_INFINITY;function sp(i,e){return e[1]!==Du?function(r,s,l){let h=0,p=0;switch(s=Math.abs(s),l=Math.abs(l),r){case"top-right":case"top-left":case"top":p=l-ws;break;case"bottom-right":case"bottom-left":case"bottom":p=-l+ws}switch(r){case"top-right":case"bottom-right":case"right":h=-s;break;case"top-left":case"bottom-left":case"left":h=s}return[h,p]}(i,e[0],e[1]):function(r,s){let l=0,h=0;s<0&&(s=0);const p=s/Math.SQRT2;switch(r){case"top-right":case"top-left":h=p-ws;break;case"bottom-right":case"bottom-left":h=-p+ws;break;case"bottom":h=-s+ws;break;case"top":h=s-ws}switch(r){case"top-right":case"bottom-right":l=-p;break;case"top-left":case"bottom-left":l=p;break;case"left":l=s;break;case"right":l=-s}return[l,h]}(i,e[0])}function ap(i,e,r){var s;const l=i.layout,h=(s=l.get("text-variable-anchor-offset"))===null||s===void 0?void 0:s.evaluate(e,{},r);if(h){const g=h.values,v=[];for(let w=0;w<g.length;w+=2){const I=v[w]=g[w],A=g[w+1].map(z=>z*Li);I.startsWith("top")?A[1]-=ws:I.startsWith("bottom")&&(A[1]+=ws),v[w+1]=A}return new Br(v)}const p=l.get("text-variable-anchor");if(p){let g;g=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[l.get("text-radial-offset").evaluate(e,{},r)*Li,Du]:l.get("text-offset").evaluate(e,{},r).map(w=>w*Li);const v=[];for(const w of p)v.push(w,sp(w,g));return new Br(v)}return null}function Lu(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function e_(i,e,r,s,l,h,p,g,v,w,I){let A=h.textMaxSize.evaluate(e,{});A===void 0&&(A=p);const z=i.layers[0].layout,R=z.get("icon-offset").evaluate(e,{},I),O=lp(r.horizontal),j=p/24,X=i.tilePixelRatio*j,Y=i.tilePixelRatio*A/24,oe=i.tilePixelRatio*g,ee=i.tilePixelRatio*z.get("symbol-spacing"),ce=z.get("text-padding")*i.tilePixelRatio,de=function(Ae,st,et,St=1){const ni=Ae.get("icon-padding").evaluate(st,{},et),li=ni&&ni.values;return[li[0]*St,li[1]*St,li[2]*St,li[3]*St]}(z,e,I,i.tilePixelRatio),we=z.get("text-max-angle")/180*Math.PI,qe=z.get("text-rotation-alignment")!=="viewport"&&z.get("symbol-placement")!=="point",Je=z.get("icon-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",Ve=z.get("symbol-placement"),$e=ee/2,Fe=z.get("icon-text-fit");let We;s&&Fe!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(We=Md(s,r.vertical,Fe,z.get("icon-text-fit-padding"),R,j)),O&&(s=Md(s,O,Fe,z.get("icon-text-fit-padding"),R,j)));const Be=(Ae,st)=>{st.x<0||st.x>=Pi||st.y<0||st.y>=Pi||function(et,St,ni,li,Ri,Ur,xr,Ai,Xi,ir,br,wr,Fi,Bi,cr,Sr,ur,zr,Dr,Oi,Et,hr,rr,$i,ln){const yn=et.addToLineVertexArray(St,ni);let vn,Qn,cn,Wr,Lr=0,es=0,Ko=0,dp=0,Vu=-1,Uu=-1;const ts={};let pp=Xn("");if(et.allowVerticalPlacement&&li.vertical){const dr=Ai.layout.get("text-rotate").evaluate(Et,{},$i)+90;cn=new cc(Xi,St,ir,br,wr,li.vertical,Fi,Bi,cr,dr),xr&&(Wr=new cc(Xi,St,ir,br,wr,xr,ur,zr,cr,dr))}if(Ri){const dr=Ai.layout.get("icon-rotate").evaluate(Et,{}),Xr=Ai.layout.get("icon-text-fit")!=="none",Ws=rp(Ri,dr,rr,Xr),bn=xr?rp(xr,dr,rr,Xr):void 0;Qn=new cc(Xi,St,ir,br,wr,Ri,ur,zr,!1,dr),Lr=4*Ws.length;const Xs=et.iconSizeData;let Fn=null;Xs.kind==="source"?(Fn=[Rn*Ai.layout.get("icon-size").evaluate(Et,{})],Fn[0]>vs&&gt(`${et.layerIds[0]}: Value for "icon-size" is >= ${Go}. Reduce your "icon-size".`)):Xs.kind==="composite"&&(Fn=[Rn*hr.compositeIconSizes[0].evaluate(Et,{},$i),Rn*hr.compositeIconSizes[1].evaluate(Et,{},$i)],(Fn[0]>vs||Fn[1]>vs)&&gt(`${et.layerIds[0]}: Value for "icon-size" is >= ${Go}. Reduce your "icon-size".`)),et.addSymbols(et.icon,Ws,Fn,Oi,Dr,Et,a.ai.none,St,yn.lineStartIndex,yn.lineLength,-1,$i),Vu=et.icon.placedSymbolArray.length-1,bn&&(es=4*bn.length,et.addSymbols(et.icon,bn,Fn,Oi,Dr,Et,a.ai.vertical,St,yn.lineStartIndex,yn.lineLength,-1,$i),Uu=et.icon.placedSymbolArray.length-1)}const fp=Object.keys(li.horizontal);for(const dr of fp){const Xr=li.horizontal[dr];if(!vn){pp=Xn(Xr.text);const bn=Ai.layout.get("text-rotate").evaluate(Et,{},$i);vn=new cc(Xi,St,ir,br,wr,Xr,Fi,Bi,cr,bn)}const Ws=Xr.positionedLines.length===1;if(Ko+=op(et,St,Xr,Ur,Ai,cr,Et,Sr,yn,li.vertical?a.ai.horizontal:a.ai.horizontalOnly,Ws?fp:[dr],ts,Vu,hr,$i),Ws)break}li.vertical&&(dp+=op(et,St,li.vertical,Ur,Ai,cr,Et,Sr,yn,a.ai.vertical,["vertical"],ts,Uu,hr,$i));const r_=vn?vn.boxStartIndex:et.collisionBoxArray.length,n_=vn?vn.boxEndIndex:et.collisionBoxArray.length,s_=cn?cn.boxStartIndex:et.collisionBoxArray.length,a_=cn?cn.boxEndIndex:et.collisionBoxArray.length,o_=Qn?Qn.boxStartIndex:et.collisionBoxArray.length,l_=Qn?Qn.boxEndIndex:et.collisionBoxArray.length,c_=Wr?Wr.boxStartIndex:et.collisionBoxArray.length,u_=Wr?Wr.boxEndIndex:et.collisionBoxArray.length;let xn=-1;const hc=(dr,Xr)=>dr&&dr.circleDiameter?Math.max(dr.circleDiameter,Xr):Xr;xn=hc(vn,xn),xn=hc(cn,xn),xn=hc(Qn,xn),xn=hc(Wr,xn);const mp=xn>-1?1:0;mp&&(xn*=ln/Li),et.glyphOffsetArray.length>=Fa.MAX_GLYPHS&&gt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Et.sortKey!==void 0&&et.addToSortKeyRanges(et.symbolInstances.length,Et.sortKey);const h_=ap(Ai,Et,$i),[d_,p_]=function(dr,Xr){const Ws=dr.length,bn=Xr?.values;if(bn?.length>0)for(let Xs=0;Xs<bn.length;Xs+=2){const Fn=bn[Xs+1];dr.emplaceBack(a.aq[bn[Xs]],Fn[0],Fn[1])}return[Ws,dr.length]}(et.textAnchorOffsets,h_);et.symbolInstances.emplaceBack(St.x,St.y,ts.right>=0?ts.right:-1,ts.center>=0?ts.center:-1,ts.left>=0?ts.left:-1,ts.vertical||-1,Vu,Uu,pp,r_,n_,s_,a_,o_,l_,c_,u_,ir,Ko,dp,Lr,es,mp,0,Fi,xn,d_,p_)}(i,st,Ae,r,s,l,We,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,X,[ce,ce,ce,ce],qe,v,oe,de,Je,R,e,h,w,I,p)};if(Ve==="line")for(const Ae of Jd(e.geometry,0,0,Pi,Pi)){const st=Xg(Ae,ee,we,r.vertical||O,s,24,Y,i.overscaling,Pi);for(const et of st)O&&t_(i,O.text,$e,et)||Be(Ae,et)}else if(Ve==="line-center"){for(const Ae of e.geometry)if(Ae.length>1){const st=Wg(Ae,we,r.vertical||O,s,24,Y);st&&Be(Ae,st)}}else if(e.type==="Polygon")for(const Ae of du(e.geometry,0)){const st=Yg(Ae,16);Be(Ae[0],new bs(st.x,st.y,0))}else if(e.type==="LineString")for(const Ae of e.geometry)Be(Ae,new bs(Ae[0].x,Ae[0].y,0));else if(e.type==="Point")for(const Ae of e.geometry)for(const st of Ae)Be([st],new bs(st.x,st.y,0))}function op(i,e,r,s,l,h,p,g,v,w,I,A,z,R,O){const j=function(oe,ee,ce,de,we,qe,Je,Ve){const $e=de.layout.get("text-rotate").evaluate(qe,{})*Math.PI/180,Fe=[];for(const We of ee.positionedLines)for(const Be of We.positionedGlyphs){if(!Be.rect)continue;const Ae=Be.rect||{};let st=Sd+1,et=!0,St=1,ni=0;const li=(we||Ve)&&Be.vertical,Ri=Be.metrics.advance*Be.scale/2;if(Ve&&ee.verticalizable&&(ni=We.lineOffset/2-(Be.imageName?-(Li-Be.metrics.width*Be.scale)/2:(Be.scale-1)*Li)),Be.imageName){const Oi=Je[Be.imageName];et=Oi.sdf,St=Oi.pixelRatio,st=kr/St}const Ur=we?[Be.x+Ri,Be.y]:[0,0];let xr=we?[0,0]:[Be.x+Ri+ce[0],Be.y+ce[1]-ni],Ai=[0,0];li&&(Ai=xr,xr=[0,0]);const Xi=Be.metrics.isDoubleResolution?2:1,ir=(Be.metrics.left-st)*Be.scale-Ri+xr[0],br=(-Be.metrics.top-st)*Be.scale+xr[1],wr=ir+Ae.w/Xi*Be.scale/St,Fi=br+Ae.h/Xi*Be.scale/St,Bi=new ue(ir,br),cr=new ue(wr,br),Sr=new ue(ir,Fi),ur=new ue(wr,Fi);if(li){const Oi=new ue(-Ri,Ri-qo),Et=-Math.PI/2,hr=Li/2-Ri,rr=new ue(5-qo-hr,-(Be.imageName?hr:0)),$i=new ue(...Ai);Bi._rotateAround(Et,Oi)._add(rr)._add($i),cr._rotateAround(Et,Oi)._add(rr)._add($i),Sr._rotateAround(Et,Oi)._add(rr)._add($i),ur._rotateAround(Et,Oi)._add(rr)._add($i)}if($e){const Oi=Math.sin($e),Et=Math.cos($e),hr=[Et,-Oi,Oi,Et];Bi._matMult(hr),cr._matMult(hr),Sr._matMult(hr),ur._matMult(hr)}const zr=new ue(0,0),Dr=new ue(0,0);Fe.push({tl:Bi,tr:cr,bl:Sr,br:ur,tex:Ae,writingMode:ee.writingMode,glyphOffset:Ur,sectionIndex:Be.sectionIndex,isSDF:et,pixelOffsetTL:zr,pixelOffsetBR:Dr,minFontScaleX:0,minFontScaleY:0})}return Fe}(0,r,g,l,h,p,s,i.allowVerticalPlacement),X=i.textSizeData;let Y=null;X.kind==="source"?(Y=[Rn*l.layout.get("text-size").evaluate(p,{})],Y[0]>vs&&gt(`${i.layerIds[0]}: Value for "text-size" is >= ${Go}. Reduce your "text-size".`)):X.kind==="composite"&&(Y=[Rn*R.compositeTextSizes[0].evaluate(p,{},O),Rn*R.compositeTextSizes[1].evaluate(p,{},O)],(Y[0]>vs||Y[1]>vs)&&gt(`${i.layerIds[0]}: Value for "text-size" is >= ${Go}. Reduce your "text-size".`)),i.addSymbols(i.text,j,Y,g,h,p,w,e,v.lineStartIndex,v.lineLength,z,O);for(const oe of I)A[oe]=i.text.placedSymbolArray.length-1;return 4*j.length}function lp(i){for(const e in i)return i[e];return null}function t_(i,e,r,s){const l=i.compareText;if(e in l){const h=l[e];for(let p=h.length-1;p>=0;p--)if(s.dist(h[p])<r)return!0}else l[e]=[];return l[e].push(s),!1}const cp=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Ru{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,s]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const l=s>>4;if(l!==1)throw new Error(`Got v${l} data when expected v1.`);const h=cp[15&s];if(!h)throw new Error("Unrecognized array type.");const[p]=new Uint16Array(e,2,1),[g]=new Uint32Array(e,4,1);return new Ru(g,p,h,e)}constructor(e,r=64,s=Float64Array,l){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=s,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const h=cp.indexOf(this.ArrayType),p=2*e*this.ArrayType.BYTES_PER_ELEMENT,g=e*this.IndexArrayType.BYTES_PER_ELEMENT,v=(8-g%8)%8;if(h<0)throw new Error(`Unexpected typed array class: ${s}.`);l&&l instanceof ArrayBuffer?(this.data=l,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+g+v,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+p+g+v),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+g+v,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+h]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=e,this.coords[this._pos++]=r,s}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Fu(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,s,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:p,nodeSize:g}=this,v=[0,h.length-1,0],w=[];for(;v.length;){const I=v.pop()||0,A=v.pop()||0,z=v.pop()||0;if(A-z<=g){for(let X=z;X<=A;X++){const Y=p[2*X],oe=p[2*X+1];Y>=e&&Y<=s&&oe>=r&&oe<=l&&w.push(h[X])}continue}const R=z+A>>1,O=p[2*R],j=p[2*R+1];O>=e&&O<=s&&j>=r&&j<=l&&w.push(h[R]),(I===0?e<=O:r<=j)&&(v.push(z),v.push(R-1),v.push(1-I)),(I===0?s>=O:l>=j)&&(v.push(R+1),v.push(A),v.push(1-I))}return w}within(e,r,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:l,coords:h,nodeSize:p}=this,g=[0,l.length-1,0],v=[],w=s*s;for(;g.length;){const I=g.pop()||0,A=g.pop()||0,z=g.pop()||0;if(A-z<=p){for(let X=z;X<=A;X++)hp(h[2*X],h[2*X+1],e,r)<=w&&v.push(l[X]);continue}const R=z+A>>1,O=h[2*R],j=h[2*R+1];hp(O,j,e,r)<=w&&v.push(l[R]),(I===0?e-s<=O:r-s<=j)&&(g.push(z),g.push(R-1),g.push(1-I)),(I===0?e+s>=O:r+s>=j)&&(g.push(R+1),g.push(A),g.push(1-I))}return v}}function Fu(i,e,r,s,l,h){if(l-s<=r)return;const p=s+l>>1;up(i,e,p,s,l,h),Fu(i,e,r,s,p-1,1-h),Fu(i,e,r,p+1,l,1-h)}function up(i,e,r,s,l,h){for(;l>s;){if(l-s>600){const w=l-s+1,I=r-s+1,A=Math.log(w),z=.5*Math.exp(2*A/3),R=.5*Math.sqrt(A*z*(w-z)/w)*(I-w/2<0?-1:1);up(i,e,r,Math.max(s,Math.floor(r-I*z/w+R)),Math.min(l,Math.floor(r+(w-I)*z/w+R)),h)}const p=e[2*r+h];let g=s,v=l;for(Wo(i,e,s,r),e[2*l+h]>p&&Wo(i,e,s,l);g<v;){for(Wo(i,e,g,v),g++,v--;e[2*g+h]<p;)g++;for(;e[2*v+h]>p;)v--}e[2*s+h]===p?Wo(i,e,s,v):(v++,Wo(i,e,v,l)),v<=r&&(s=v+1),r<=v&&(l=v-1)}}function Wo(i,e,r,s){Bu(i,r,s),Bu(e,2*r,2*s),Bu(e,2*r+1,2*s+1)}function Bu(i,e,r){const s=i[e];i[e]=i[r],i[r]=s}function hp(i,e,r,s){const l=i-r,h=e-s;return l*l+h*h}var Ou;a.bh=void 0,(Ou=a.bh||(a.bh={})).create="create",Ou.load="load",Ou.fullLoad="fullLoad";let uc=null,Xo=[];const $u=1e3/60,Nu="loadTime",ju="fullLoadTime",i_={mark(i){performance.mark(i)},frame(i){const e=i;uc!=null&&Xo.push(e-uc),uc=e},clearMetrics(){uc=null,Xo=[],performance.clearMeasures(Nu),performance.clearMeasures(ju);for(const i in a.bh)performance.clearMarks(a.bh[i])},getPerformanceMetrics(){performance.measure(Nu,a.bh.create,a.bh.load),performance.measure(ju,a.bh.create,a.bh.fullLoad);const i=performance.getEntriesByName(Nu)[0].duration,e=performance.getEntriesByName(ju)[0].duration,r=Xo.length,s=1/(Xo.reduce((h,p)=>h+p,0)/r/1e3),l=Xo.filter(h=>h>$u).reduce((h,p)=>h+(p-$u)/$u,0);return{loadTime:i,fullLoadTime:e,fps:s,percentDroppedFrames:l/(r+l)*100,totalFrames:r}}};a.$=function(i,e,r){var s,l,h,p,g,v,w,I,A,z,R,O,j=r[0],X=r[1],Y=r[2];return e===i?(i[12]=e[0]*j+e[4]*X+e[8]*Y+e[12],i[13]=e[1]*j+e[5]*X+e[9]*Y+e[13],i[14]=e[2]*j+e[6]*X+e[10]*Y+e[14],i[15]=e[3]*j+e[7]*X+e[11]*Y+e[15]):(l=e[1],h=e[2],p=e[3],g=e[4],v=e[5],w=e[6],I=e[7],A=e[8],z=e[9],R=e[10],O=e[11],i[0]=s=e[0],i[1]=l,i[2]=h,i[3]=p,i[4]=g,i[5]=v,i[6]=w,i[7]=I,i[8]=A,i[9]=z,i[10]=R,i[11]=O,i[12]=s*j+g*X+A*Y+e[12],i[13]=l*j+v*X+z*Y+e[13],i[14]=h*j+w*X+R*Y+e[14],i[15]=p*j+I*X+O*Y+e[15]),i},a.A=Ma,a.B=Ir,a.C=class{constructor(i,e,r){this.receive=s=>{const l=s.data,h=l.id;if(h&&(!l.targetMapId||this.mapId===l.targetMapId))if(l.type==="<cancel>"){delete this.tasks[h];const p=this.cancelCallbacks[h];delete this.cancelCallbacks[h],p&&p()}else ft()||l.mustQueue?(this.tasks[h]=l,this.taskQueue.push(h),this.invoker.trigger()):this.processTask(h,l)},this.process=()=>{if(!this.taskQueue.length)return;const s=this.taskQueue.shift(),l=this.tasks[s];delete this.tasks[s],this.taskQueue.length&&this.invoker.trigger(),l&&this.processTask(s,l)},this.target=i,this.parent=e,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new Gg(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=ft()?i:window}send(i,e,r,s,l=!1){const h=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[h]=r);const p=[],g={id:h,type:i,hasCallback:!!r,targetMapId:s,mustQueue:l,sourceMapId:this.mapId,data:zn(e,p)};return this.target.postMessage(g,{transfer:p}),{cancel:()=>{r&&delete this.callbacks[h],this.target.postMessage({id:h,type:"<cancel>",targetMapId:s,sourceMapId:this.mapId})}}}processTask(i,e){if(e.type==="<response>"){const r=this.callbacks[i];delete this.callbacks[i],r&&(e.error?r(ps(e.error)):r(null,ps(e.data)))}else{let r=!1;const s=[],l=e.hasCallback?(g,v)=>{r=!0,delete this.cancelCallbacks[i];const w={id:i,type:"<response>",sourceMapId:this.mapId,error:g?zn(g):null,data:zn(v,s)};this.target.postMessage(w,{transfer:s})}:g=>{r=!0};let h=null;const p=ps(e.data);if(this.parent[e.type])h=this.parent[e.type](e.sourceMapId,p,l);else if("getWorkerSource"in this.parent){const g=e.type.split(".");h=this.parent.getWorkerSource(e.sourceMapId,g[0],p.source)[g[1]](p,l)}else l(new Error(`Could not find function ${e.type}`));!r&&h&&h.cancel&&(this.cancelCallbacks[i]=h.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},a.D=tt,a.E=Cr,a.F=function(i,e){const r={};for(let s=0;s<e.length;s++){const l=e[s];l in i&&(r[l]=i[l])}return r},a.G=$d,a.H=Nd,a.I=wu,a.J=je,a.K=Ne,a.L=xs,a.M=ai,a.N=Pi,a.O=Hr,a.P=ue,a.Q=di,a.R=Gr,a.S=ri,a.T=$l,a.U=sc,a.V=class extends Hn{},a.W=zu,a.X=function(i,e){const r=window.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let s=0;s<i.length;s++){const l=window.document.createElement("source");Ti(i[s])||(r.crossOrigin="Anonymous"),l.src=i[s],r.appendChild(l)}return{cancel:()=>{}}},a.Y=Re,a.Z=function(){var i=new Ma(16);return Ma!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},a._=W,a.a=Mi,a.a$=class extends L{},a.a0=function(i,e,r){var s=r[0],l=r[1],h=r[2];return i[0]=e[0]*s,i[1]=e[1]*s,i[2]=e[2]*s,i[3]=e[3]*s,i[4]=e[4]*l,i[5]=e[5]*l,i[6]=e[6]*l,i[7]=e[7]*l,i[8]=e[8]*h,i[9]=e[9]*h,i[10]=e[10]*h,i[11]=e[11]*h,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},a.a1=qh,a.a2=function(){return at++},a.a3=G,a.a4=Fa,a.a5=function(){Ar.isLoading()||Ar.isLoaded()||So()!=="deferred"||Ol()},a.a6=ho,a.a7=Gs,a.a8=ii,a.a9=Hd,a.aA=Ns,a.aB=function(i){i=i.slice();const e=Object.create(null);for(let r=0;r<i.length;r++)e[i[r].id]=i[r];for(let r=0;r<i.length;r++)"ref"in i[r]&&(i[r]=ji(i[r],e[i[r].ref]));return i},a.aC=function(i){if(i.type==="custom")return new Zg(i);switch(i.type){case"background":return new Vg(i);case"circle":return new Em(i);case"fill":return new Hm(i);case"fill-extrusion":return new lg(i);case"heatmap":return new Am(i);case"hillshade":return new km(i);case"line":return new gg(i);case"raster":return new qg(i);case"symbol":return new nc(i)}},a.aD=xt,a.aE=function(i,e){if(!i)return[{command:kt.setStyle,args:[e]}];let r=[];try{if(!jt(i.version,e.version))return[{command:kt.setStyle,args:[e]}];jt(i.center,e.center)||r.push({command:kt.setCenter,args:[e.center]}),jt(i.zoom,e.zoom)||r.push({command:kt.setZoom,args:[e.zoom]}),jt(i.bearing,e.bearing)||r.push({command:kt.setBearing,args:[e.bearing]}),jt(i.pitch,e.pitch)||r.push({command:kt.setPitch,args:[e.pitch]}),jt(i.sprite,e.sprite)||r.push({command:kt.setSprite,args:[e.sprite]}),jt(i.glyphs,e.glyphs)||r.push({command:kt.setGlyphs,args:[e.glyphs]}),jt(i.transition,e.transition)||r.push({command:kt.setTransition,args:[e.transition]}),jt(i.light,e.light)||r.push({command:kt.setLight,args:[e.light]});const s={},l=[];(function(p,g,v,w){let I;for(I in g=g||{},p=p||{})Object.prototype.hasOwnProperty.call(p,I)&&(Object.prototype.hasOwnProperty.call(g,I)||Ji(I,v,w));for(I in g)Object.prototype.hasOwnProperty.call(g,I)&&(Object.prototype.hasOwnProperty.call(p,I)?jt(p[I],g[I])||(p[I].type==="geojson"&&g[I].type==="geojson"&&Tn(p,g,I)?v.push({command:kt.setGeoJSONSourceData,args:[I,g[I].data]}):ar(I,g,v,w)):qi(I,g,v))})(i.sources,e.sources,l,s);const h=[];i.layers&&i.layers.forEach(p=>{s[p.source]?r.push({command:kt.removeLayer,args:[p.id]}):h.push(p)}),r=r.concat(l),function(p,g,v){g=g||[];const w=(p=p||[]).map(en),I=g.map(en),A=p.reduce(En,{}),z=g.reduce(En,{}),R=w.slice(),O=Object.create(null);let j,X,Y,oe,ee,ce,de;for(j=0,X=0;j<w.length;j++)Y=w[j],Object.prototype.hasOwnProperty.call(z,Y)?X++:(v.push({command:kt.removeLayer,args:[Y]}),R.splice(R.indexOf(Y,X),1));for(j=0,X=0;j<I.length;j++)Y=I[I.length-1-j],R[R.length-1-j]!==Y&&(Object.prototype.hasOwnProperty.call(A,Y)?(v.push({command:kt.removeLayer,args:[Y]}),R.splice(R.lastIndexOf(Y,R.length-X),1)):X++,ce=R[R.length-j],v.push({command:kt.addLayer,args:[z[Y],ce]}),R.splice(R.length-j,0,Y),O[Y]=!0);for(j=0;j<I.length;j++)if(Y=I[j],oe=A[Y],ee=z[Y],!O[Y]&&!jt(oe,ee))if(jt(oe.source,ee.source)&&jt(oe["source-layer"],ee["source-layer"])&&jt(oe.type,ee.type)){for(de in In(oe.layout,ee.layout,v,Y,null,kt.setLayoutProperty),In(oe.paint,ee.paint,v,Y,null,kt.setPaintProperty),jt(oe.filter,ee.filter)||v.push({command:kt.setFilter,args:[Y,ee.filter]}),jt(oe.minzoom,ee.minzoom)&&jt(oe.maxzoom,ee.maxzoom)||v.push({command:kt.setLayerZoomRange,args:[Y,ee.minzoom,ee.maxzoom]}),oe)Object.prototype.hasOwnProperty.call(oe,de)&&de!=="layout"&&de!=="paint"&&de!=="filter"&&de!=="metadata"&&de!=="minzoom"&&de!=="maxzoom"&&(de.indexOf("paint.")===0?In(oe[de],ee[de],v,Y,de.slice(6),kt.setPaintProperty):jt(oe[de],ee[de])||v.push({command:kt.setLayerProperty,args:[Y,de,ee[de]]}));for(de in ee)Object.prototype.hasOwnProperty.call(ee,de)&&!Object.prototype.hasOwnProperty.call(oe,de)&&de!=="layout"&&de!=="paint"&&de!=="filter"&&de!=="metadata"&&de!=="minzoom"&&de!=="maxzoom"&&(de.indexOf("paint.")===0?In(oe[de],ee[de],v,Y,de.slice(6),kt.setPaintProperty):jt(oe[de],ee[de])||v.push({command:kt.setLayerProperty,args:[Y,de,ee[de]]}))}else v.push({command:kt.removeLayer,args:[Y]}),ce=R[R.lastIndexOf(Y)+1],v.push({command:kt.addLayer,args:[ee,ce]})}(h,e.layers,r)}catch(s){console.warn("Unable to compute style diff:",s),r=[{command:kt.setStyle,args:[e]}]}return r},a.aF=function(i){const e=[],r=i.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},a.aG=function i(e,r){if(Array.isArray(e)){if(!Array.isArray(r)||e.length!==r.length)return!1;for(let s=0;s<e.length;s++)if(!i(e[s],r[s]))return!1;return!0}if(typeof e=="object"&&e!==null&&r!==null){if(typeof r!="object"||Object.keys(e).length!==Object.keys(r).length)return!1;for(const s in e)if(!i(e[s],r[s]))return!1;return!0}return e===r},a.aH=De,a.aI=rt,a.aJ=js,a.aK=function(i){return i({pluginStatus:_r,pluginURL:Dn}),js.on("pluginStateChange",i),i},a.aL=class extends Kn{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},a.aM=Pa,a.aN=class extends Kn{constructor(i,e){super(i,e),this.current=eu}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},a.aO=Ul,a.aP=class extends Kn{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},a.aQ=class extends Kn{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},a.aR=ql,a.aS=function(i,e,r,s,l,h,p){var g=1/(e-r),v=1/(s-l),w=1/(h-p);return i[0]=-2*g,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*v,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*w,i[11]=0,i[12]=(e+r)*g,i[13]=(l+s)*v,i[14]=(p+h)*w,i[15]=1,i},a.aT=Zt,a.aU=Im,a.aV=class extends o{},a.aW=xg,a.aX=class extends d{},a.aY=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},a.aZ=Xh,a.a_=Le,a.aa=function(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,s,l,h)=>{const p=l||h;return e[s]=!p||p.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e},a.ab=function(i,e){const r=[];for(const s in i)s in e||r.push(s);return r},a.ac=function(i){if(si==null){const e=i.navigator?i.navigator.userAgent:null;si=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return si},a.ad=it,a.ae=function(i,e,r){var s=Math.sin(r),l=Math.cos(r),h=e[0],p=e[1],g=e[2],v=e[3],w=e[4],I=e[5],A=e[6],z=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=h*l+w*s,i[1]=p*l+I*s,i[2]=g*l+A*s,i[3]=v*l+z*s,i[4]=w*l-h*s,i[5]=I*l-p*s,i[6]=A*l-g*s,i[7]=z*l-v*s,i},a.af=function(i){var e=new Ma(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},a.ag=Wl,a.ah=function(i,e){let r=0,s=0;if(i.kind==="constant")s=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:l,minZoom:h,maxZoom:p}=i,g=l?it(Er.interpolationFactor(l,e,h,p),0,1):0;i.kind==="camera"?s=Ir.number(i.minSize,i.maxSize,g):r=g}return{uSizeT:r,uSize:s}},a.aj=function(i,{uSize:e,uSizeT:r},{lowerSize:s,upperSize:l}){return i.kind==="source"?s/Rn:i.kind==="composite"?Ir.number(s/Rn,l/Rn,r):e},a.ak=Iu,a.al=function(i,e,r,s){const l=e.y-i.y,h=e.x-i.x,p=s.y-r.y,g=s.x-r.x,v=p*h-g*l;if(v===0)return null;const w=(g*(i.y-r.y)-p*(i.x-r.x))/v;return new ue(i.x+w*h,i.y+w*l)},a.am=Jd,a.an=Oh,a.ao=su,a.ap=Li,a.ar=Tu,a.as=function(i,e){var r=e[0],s=e[1],l=e[2],h=e[3],p=e[4],g=e[5],v=e[6],w=e[7],I=e[8],A=e[9],z=e[10],R=e[11],O=e[12],j=e[13],X=e[14],Y=e[15],oe=r*g-s*p,ee=r*v-l*p,ce=r*w-h*p,de=s*v-l*g,we=s*w-h*g,qe=l*w-h*v,Je=I*j-A*O,Ve=I*X-z*O,$e=I*Y-R*O,Fe=A*X-z*j,We=A*Y-R*j,Be=z*Y-R*X,Ae=oe*Be-ee*We+ce*Fe+de*$e-we*Ve+qe*Je;return Ae?(i[0]=(g*Be-v*We+w*Fe)*(Ae=1/Ae),i[1]=(l*We-s*Be-h*Fe)*Ae,i[2]=(j*qe-X*we+Y*de)*Ae,i[3]=(z*we-A*qe-R*de)*Ae,i[4]=(v*$e-p*Be-w*Ve)*Ae,i[5]=(r*Be-l*$e+h*Ve)*Ae,i[6]=(X*ce-O*qe-Y*ee)*Ae,i[7]=(I*qe-z*ce+R*ee)*Ae,i[8]=(p*We-g*$e+w*Je)*Ae,i[9]=(s*$e-r*We-h*Je)*Ae,i[10]=(O*we-j*ce+Y*oe)*Ae,i[11]=(A*ce-I*we-R*oe)*Ae,i[12]=(g*Ve-p*Fe-v*Je)*Ae,i[13]=(r*Fe-s*Ve+l*Je)*Ae,i[14]=(j*ee-O*de-X*oe)*Ae,i[15]=(I*de-A*ee+z*oe)*Ae,i):null},a.at=Lu,a.au=Cu,a.av=Ru,a.aw=function(){const i={},e=ge.$version;for(const r in ge.$root){const s=ge.$root[r];if(s.required){let l=null;l=r==="version"?e:s.type==="array"?[]:{},l!=null&&(i[r]=l)}}return i},a.ax=kt,a.ay=Ll,a.az=Qt,a.b=function(i,e){const r=new Blob([new Uint8Array(i)],{type:"image/png"});createImageBitmap(r).then(s=>{e(null,s)}).catch(s=>{e(new Error(`Could not load image because of ${s.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},a.b0=Hi,a.b1=function(i,e){var r=i[0],s=i[1],l=i[2],h=i[3],p=i[4],g=i[5],v=i[6],w=i[7],I=i[8],A=i[9],z=i[10],R=i[11],O=i[12],j=i[13],X=i[14],Y=i[15],oe=e[0],ee=e[1],ce=e[2],de=e[3],we=e[4],qe=e[5],Je=e[6],Ve=e[7],$e=e[8],Fe=e[9],We=e[10],Be=e[11],Ae=e[12],st=e[13],et=e[14],St=e[15];return Math.abs(r-oe)<=vr*Math.max(1,Math.abs(r),Math.abs(oe))&&Math.abs(s-ee)<=vr*Math.max(1,Math.abs(s),Math.abs(ee))&&Math.abs(l-ce)<=vr*Math.max(1,Math.abs(l),Math.abs(ce))&&Math.abs(h-de)<=vr*Math.max(1,Math.abs(h),Math.abs(de))&&Math.abs(p-we)<=vr*Math.max(1,Math.abs(p),Math.abs(we))&&Math.abs(g-qe)<=vr*Math.max(1,Math.abs(g),Math.abs(qe))&&Math.abs(v-Je)<=vr*Math.max(1,Math.abs(v),Math.abs(Je))&&Math.abs(w-Ve)<=vr*Math.max(1,Math.abs(w),Math.abs(Ve))&&Math.abs(I-$e)<=vr*Math.max(1,Math.abs(I),Math.abs($e))&&Math.abs(A-Fe)<=vr*Math.max(1,Math.abs(A),Math.abs(Fe))&&Math.abs(z-We)<=vr*Math.max(1,Math.abs(z),Math.abs(We))&&Math.abs(R-Be)<=vr*Math.max(1,Math.abs(R),Math.abs(Be))&&Math.abs(O-Ae)<=vr*Math.max(1,Math.abs(O),Math.abs(Ae))&&Math.abs(j-st)<=vr*Math.max(1,Math.abs(j),Math.abs(st))&&Math.abs(X-et)<=vr*Math.max(1,Math.abs(X),Math.abs(et))&&Math.abs(Y-St)<=vr*Math.max(1,Math.abs(Y),Math.abs(St))},a.b2=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},a.b3=function(i,e,r){return i[0]=e[0]*r[0],i[1]=e[1]*r[1],i[2]=e[2]*r[2],i[3]=e[3]*r[3],i},a.b4=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]},a.b5=Ye,a.b6=qd,a.b7=jd,a.b8=function(i,e,r,s,l){var h,p=1/Math.tan(e/2);return i[0]=p/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=p,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,l!=null&&l!==1/0?(i[10]=(l+s)*(h=1/(s-l)),i[14]=2*l*s*h):(i[10]=-1,i[14]=-2*s),i},a.b9=function(i,e,r){var s=Math.sin(r),l=Math.cos(r),h=e[4],p=e[5],g=e[6],v=e[7],w=e[8],I=e[9],A=e[10],z=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=h*l+w*s,i[5]=p*l+I*s,i[6]=g*l+A*s,i[7]=v*l+z*s,i[8]=w*l-h*s,i[9]=I*l-p*s,i[10]=A*l-g*s,i[11]=z*l-v*s,i},a.bA=ne,a.bB=gd,a.bC=_a,a.bD=Ar,a.ba=me,a.bb=Ie,a.bc=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},a.bd=class extends qs{},a.be=Mu,a.bf=Vd,a.bg=i_,a.bi=gi,a.bj=function(i,e,r=!1){if(_r===yo||_r===vo||_r===xo)throw new Error("setRTLTextPlugin cannot be called multiple times.");Dn=Mt.resolveURL(i),_r=yo,bo=e,wo(),r||Ol()},a.bk=So,a.bl=function(i,e){const r={};for(let l=0;l<i.length;l++){const h=e&&e[i[l].id]||ba(i[l]);e&&(e[i[l].id]=h);let p=r[h];p||(p=r[h]=[]),p.push(i[l])}const s=[];for(const l in r)s.push(r[l]);return s},a.bm=He,a.bn=Gd,a.bo=Wd,a.bp=Td,a.bq=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=Pi/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const e=i.bucket.layers[0],r=e.layout,s=e._unevaluatedLayout._values,l={layoutIconSize:s["icon-size"].possiblyEvaluate(new ii(i.bucket.zoom+1),i.canonical),layoutTextSize:s["text-size"].possiblyEvaluate(new ii(i.bucket.zoom+1),i.canonical),textMaxSize:s["text-size"].possiblyEvaluate(new ii(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:w,maxZoom:I}=i.bucket.textSizeData;l.compositeTextSizes=[s["text-size"].possiblyEvaluate(new ii(w),i.canonical),s["text-size"].possiblyEvaluate(new ii(I),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:w,maxZoom:I}=i.bucket.iconSizeData;l.compositeIconSizes=[s["icon-size"].possiblyEvaluate(new ii(w),i.canonical),s["icon-size"].possiblyEvaluate(new ii(I),i.canonical)]}const h=r.get("text-line-height")*Li,p=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",g=r.get("text-keep-upright"),v=r.get("text-size");for(const w of i.bucket.features){const I=r.get("text-font").evaluate(w,{},i.canonical).join(","),A=v.evaluate(w,{},i.canonical),z=l.layoutTextSize.evaluate(w,{},i.canonical),R=l.layoutIconSize.evaluate(w,{},i.canonical),O={horizontal:{},vertical:void 0},j=w.text;let X,Y=[0,0];if(j){const ce=j.toString(),de=r.get("text-letter-spacing").evaluate(w,{},i.canonical)*Li,we=go(ce)?de:0,qe=r.get("text-anchor").evaluate(w,{},i.canonical),Je=ap(e,w,i.canonical);if(!Je){const Be=r.get("text-radial-offset").evaluate(w,{},i.canonical);Y=Be?sp(qe,[Be*Li,Du]):r.get("text-offset").evaluate(w,{},i.canonical).map(Ae=>Ae*Li)}let Ve=p?"center":r.get("text-justify").evaluate(w,{},i.canonical);const $e=r.get("symbol-placement"),Fe=$e==="point"?r.get("text-max-width").evaluate(w,{},i.canonical)*Li:0,We=()=>{i.bucket.allowVerticalPlacement&&mo(ce)&&(O.vertical=tc(j,i.glyphMap,i.glyphPositions,i.imagePositions,I,Fe,h,qe,"left",we,Y,a.ai.vertical,!0,$e,z,A))};if(!p&&Je){const Be=new Set;if(Ve==="auto")for(let st=0;st<Je.values.length;st+=2)Be.add(Lu(Je.values[st]));else Be.add(Ve);let Ae=!1;for(const st of Be)if(!O.horizontal[st])if(Ae)O.horizontal[st]=O.horizontal[0];else{const et=tc(j,i.glyphMap,i.glyphPositions,i.imagePositions,I,Fe,h,"center",st,we,Y,a.ai.horizontal,!1,$e,z,A);et&&(O.horizontal[st]=et,Ae=et.positionedLines.length===1)}We()}else{Ve==="auto"&&(Ve=Lu(qe));const Be=tc(j,i.glyphMap,i.glyphPositions,i.imagePositions,I,Fe,h,qe,Ve,we,Y,a.ai.horizontal,!1,$e,z,A);Be&&(O.horizontal[Ve]=Be),We(),mo(ce)&&p&&g&&(O.vertical=tc(j,i.glyphMap,i.glyphPositions,i.imagePositions,I,Fe,h,qe,Ve,we,Y,a.ai.vertical,!1,$e,z,A))}}let oe=!1;if(w.icon&&w.icon.name){const ce=i.imageMap[w.icon.name];ce&&(X=Bg(i.imagePositions[w.icon.name],r.get("icon-offset").evaluate(w,{},i.canonical),r.get("icon-anchor").evaluate(w,{},i.canonical)),oe=!!ce.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=oe:i.bucket.sdfIcons!==oe&&gt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ce.pixelRatio!==i.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const ee=lp(O.horizontal)||O.vertical;i.bucket.iconsInText=!!ee&&ee.iconsInText,(ee||X)&&e_(i.bucket,w,O,X,i.imageMap,l,z,R,Y,oe,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},a.br=yu,a.bs=mu,a.bt=_u,a.bu=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},a.bv=xu,a.bw=_s,a.bx=function(i,e,r,s,l){return W(this,void 0,void 0,function*(){if(Ne())try{return yield ai(i,e,r,s,l)}catch{}return function(h,p,g,v,w){const I=h.width,A=h.height;Kt&&Ze||(Kt=new OffscreenCanvas(I,A),Ze=Kt.getContext("2d",{willReadFrequently:!0})),Kt.width=I,Kt.height=A,Ze.drawImage(h,0,0,I,A);const z=Ze.getImageData(p,g,v,w);return Ze.clearRect(0,0,I,A),z.data}(i,e,r,s,l)})},a.by=Zd,a.bz=F,a.c=Yt,a.d=function(i,e){const r=new Image;r.onload=()=>{e(null,r),URL.revokeObjectURL(r.src),r.onload=null,window.requestAnimationFrame(()=>{r.src=Ki})},r.onerror=()=>e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const s=new Blob([new Uint8Array(i)],{type:"image/png"});r.src=i.byteLength?URL.createObjectURL(s):Ki},a.e=Ge,a.f=function(i,e){return bi(Ge(i,{type:"json"}),e)},a.g=Rt,a.h=Mt,a.i=ft,a.j=mr,a.k=sr,a.l=Xt,a.m=bi,a.n=function(i){return new xu(i).readFields(kg,[])},a.o=function(i,e,r){if(!i.length)return r(null,[]);let s=i.length;const l=new Array(i.length);let h=null;i.forEach((p,g)=>{e(p,(v,w)=>{v&&(h=v),l[g]=w,--s==0&&r(h,l)})})},a.p=Cd,a.q=Fo,a.r=wi,a.s=Ti,a.t=Kc,a.u=Ue,a.v=ge,a.w=gt,a.x=Ca,a.y=mn,a.z=function([i,e,r]){return e+=90,e*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(r),y:i*Math.sin(e)*Math.sin(r),z:i*Math.cos(r)}}}),k(["./shared"],function(a){class W{constructor(M){this.keyCache={},M&&this.replace(M)}replace(M){this._layerConfigs={},this._layers={},this.update(M,[])}update(M,D){for(const H of M){this._layerConfigs[H.id]=H;const K=this._layers[H.id]=a.aC(H);K._featureFilter=a.a6(K.filter),this.keyCache[H.id]&&delete this.keyCache[H.id]}for(const H of D)delete this.keyCache[H],delete this._layerConfigs[H],delete this._layers[H];this.familiesBySource={};const $=a.bl(Object.values(this._layerConfigs),this.keyCache);for(const H of $){const K=H.map(xe=>this._layers[xe.id]),le=K[0];if(le.visibility==="none")continue;const te=le.source||"";let Q=this.familiesBySource[te];Q||(Q=this.familiesBySource[te]={});const ae=le.sourceLayer||"_geojsonTileLayer";let ve=Q[ae];ve||(ve=Q[ae]=[]),ve.push(K)}}}class F{constructor(M){const D={},$=[];for(const te in M){const Q=M[te],ae=D[te]={};for(const ve in Q){const xe=Q[+ve];if(!xe||xe.bitmap.width===0||xe.bitmap.height===0)continue;const Se={x:0,y:0,w:xe.bitmap.width+2,h:xe.bitmap.height+2};$.push(Se),ae[ve]={rect:Se,metrics:xe.metrics}}}const{w:H,h:K}=a.p($),le=new a.q({width:H||1,height:K||1});for(const te in M){const Q=M[te];for(const ae in Q){const ve=Q[+ae];if(!ve||ve.bitmap.width===0||ve.bitmap.height===0)continue;const xe=D[te][ae].rect;a.q.copy(ve.bitmap,le,{x:0,y:0},{x:xe.x+1,y:xe.y+1},ve.bitmap)}}this.image=le,this.positions=D}}a.bm("GlyphAtlas",F);class ne{constructor(M){this.tileID=new a.O(M.tileID.overscaledZ,M.tileID.wrap,M.tileID.canonical.z,M.tileID.canonical.x,M.tileID.canonical.y),this.uid=M.uid,this.zoom=M.zoom,this.pixelRatio=M.pixelRatio,this.tileSize=M.tileSize,this.source=M.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=M.showCollisionBoxes,this.collectResourceTiming=!!M.collectResourceTiming,this.returnDependencies=!!M.returnDependencies,this.promoteId=M.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(M,D,$,H,K){this.status="parsing",this.data=M,this.collisionBoxArray=new a.a3;const le=new a.bn(Object.keys(M.layers).sort()),te=new a.bo(this.tileID,this.promoteId);te.bucketLayerIDs=[];const Q={},ae={featureIndex:te,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:$},ve=D.familiesBySource[this.source];for(const Ft in ve){const Lt=M.layers[Ft];if(!Lt)continue;Lt.version===1&&a.w(`Vector tile source "${this.source}" layer "${Ft}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Yi=le.encode(Ft),ei=[];for(let Ei=0;Ei<Lt.length;Ei++){const Zi=Lt.feature(Ei),Fr=te.getId(Zi,Ft);ei.push({feature:Zi,id:Fr,index:Ei,sourceLayerIndex:Yi})}for(const Ei of ve[Ft]){const Zi=Ei[0];Zi.source!==this.source&&a.w(`layer.source = ${Zi.source} does not equal this.source = ${this.source}`),Zi.minzoom&&this.zoom<Math.floor(Zi.minzoom)||Zi.maxzoom&&this.zoom>=Zi.maxzoom||Zi.visibility!=="none"&&(ie(Ei,this.zoom,$),(Q[Zi.id]=Zi.createBucket({index:te.bucketLayerIDs.length,layers:Ei,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Yi,sourceID:this.source})).populate(ei,ae,this.tileID.canonical),te.bucketLayerIDs.push(Ei.map(Fr=>Fr.id)))}}let xe,Se,nt,pt;const Xe=a.aH(ae.glyphDependencies,Ft=>Object.keys(Ft).map(Number));this.inFlightDependencies.forEach(Ft=>Ft?.cancel()),this.inFlightDependencies=[];const lt=++this.dependencySentinel;Object.keys(Xe).length?this.inFlightDependencies.push(H.send("getGlyphs",{uid:this.uid,stacks:Xe,source:this.source,tileID:this.tileID,type:"glyphs"},(Ft,Lt)=>{lt===this.dependencySentinel&&(xe||(xe=Ft,Se=Lt,Ht.call(this)))})):Se={};const _t=Object.keys(ae.iconDependencies);_t.length?this.inFlightDependencies.push(H.send("getImages",{icons:_t,source:this.source,tileID:this.tileID,type:"icons"},(Ft,Lt)=>{lt===this.dependencySentinel&&(xe||(xe=Ft,nt=Lt,Ht.call(this)))})):nt={};const Vt=Object.keys(ae.patternDependencies);function Ht(){if(xe)return K(xe);if(Se&&nt&&pt){const Ft=new F(Se),Lt=new a.bp(nt,pt);for(const Yi in Q){const ei=Q[Yi];ei instanceof a.a4?(ie(ei.layers,this.zoom,$),a.bq({bucket:ei,glyphMap:Se,glyphPositions:Ft.positions,imageMap:nt,imagePositions:Lt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):ei.hasPattern&&(ei instanceof a.br||ei instanceof a.bs||ei instanceof a.bt)&&(ie(ei.layers,this.zoom,$),ei.addFeatures(ae,this.tileID.canonical,Lt.patternPositions))}this.status="done",K(null,{buckets:Object.values(Q).filter(Yi=>!Yi.isEmpty()),featureIndex:te,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ft.image,imageAtlas:Lt,glyphMap:this.returnDependencies?Se:null,iconMap:this.returnDependencies?nt:null,glyphPositions:this.returnDependencies?Ft.positions:null})}}Vt.length?this.inFlightDependencies.push(H.send("getImages",{icons:Vt,source:this.source,tileID:this.tileID,type:"patterns"},(Ft,Lt)=>{lt===this.dependencySentinel&&(xe||(xe=Ft,pt=Lt,Ht.call(this)))})):pt={},Ht.call(this)}}function ie(Z,M,D){const $=new a.a8(M);for(const H of Z)H.recalculate($,D)}function ue(Z,M){const D=a.l(Z.request,($,H,K,le)=>{if($)M($);else if(H)try{const te=new a.bw.VectorTile(new a.bv(H));M(null,{vectorTile:te,rawData:H,cacheControl:K,expires:le})}catch(te){const Q=new Uint8Array(H);let ae=`Unable to parse the tile at ${Z.request.url}, `;ae+=Q[0]===31&&Q[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${te.messge}`,M(new Error(ae))}});return()=>{D.cancel(),M()}}class _e{constructor(M,D,$,H){this.actor=M,this.layerIndex=D,this.availableImages=$,this.loadVectorData=H||ue,this.fetching={},this.loading={},this.loaded={}}loadTile(M,D){const $=M.uid;this.loading||(this.loading={});const H=!!(M&&M.request&&M.request.collectResourceTiming)&&new a.bu(M.request),K=this.loading[$]=new ne(M);K.abort=this.loadVectorData(M,(le,te)=>{if(delete this.loading[$],le||!te)return K.status="done",this.loaded[$]=K,D(le);const Q=te.rawData,ae={};te.expires&&(ae.expires=te.expires),te.cacheControl&&(ae.cacheControl=te.cacheControl);const ve={};if(H){const xe=H.finish();xe&&(ve.resourceTiming=JSON.parse(JSON.stringify(xe)))}K.vectorTile=te.vectorTile,K.parse(te.vectorTile,this.layerIndex,this.availableImages,this.actor,(xe,Se)=>{if(delete this.fetching[$],xe||!Se)return D(xe);D(null,a.e({rawTileData:Q.slice(0)},Se,ae,ve))}),this.loaded=this.loaded||{},this.loaded[$]=K,this.fetching[$]={rawTileData:Q,cacheControl:ae,resourceTiming:ve}})}reloadTile(M,D){const $=this.loaded,H=M.uid;if($&&$[H]){const K=$[H];K.showCollisionBoxes=M.showCollisionBoxes,K.status==="parsing"?K.parse(K.vectorTile,this.layerIndex,this.availableImages,this.actor,(le,te)=>{if(le||!te)return D(le,te);let Q;if(this.fetching[H]){const{rawTileData:ae,cacheControl:ve,resourceTiming:xe}=this.fetching[H];delete this.fetching[H],Q=a.e({rawTileData:ae.slice(0)},te,ve,xe)}else Q=te;D(null,Q)}):K.status==="done"&&(K.vectorTile?K.parse(K.vectorTile,this.layerIndex,this.availableImages,this.actor,D):D())}}abortTile(M,D){const $=this.loading,H=M.uid;$&&$[H]&&$[H].abort&&($[H].abort(),delete $[H]),D()}removeTile(M,D){const $=this.loaded,H=M.uid;$&&$[H]&&delete $[H],D()}}class Ee{constructor(){this.loaded={}}loadTile(M,D){return a._(this,void 0,void 0,function*(){const{uid:$,encoding:H,rawImageData:K,redFactor:le,greenFactor:te,blueFactor:Q,baseShift:ae}=M,ve=K.width+2,xe=K.height+2,Se=a.a(K)?new a.R({width:ve,height:xe},yield a.bx(K,-1,-1,ve,xe)):K,nt=new a.by($,Se,H,le,te,Q,ae);this.loaded=this.loaded||{},this.loaded[$]=nt,D(null,nt)})}removeTile(M){const D=this.loaded,$=M.uid;D&&D[$]&&delete D[$]}}function ke(Z,M){if(Z.length!==0){Me(Z[0],M);for(var D=1;D<Z.length;D++)Me(Z[D],!M)}}function Me(Z,M){for(var D=0,$=0,H=0,K=Z.length,le=K-1;H<K;le=H++){var te=(Z[H][0]-Z[le][0])*(Z[le][1]+Z[H][1]),Q=D+te;$+=Math.abs(D)>=Math.abs(te)?D-Q+te:te-Q+D,D=Q}D+$>=0!=!!M&&Z.reverse()}var ze=a.bz(function Z(M,D){var $,H=M&&M.type;if(H==="FeatureCollection")for($=0;$<M.features.length;$++)Z(M.features[$],D);else if(H==="GeometryCollection")for($=0;$<M.geometries.length;$++)Z(M.geometries[$],D);else if(H==="Feature")Z(M.geometry,D);else if(H==="Polygon")ke(M.coordinates,D);else if(H==="MultiPolygon")for($=0;$<M.coordinates.length;$++)ke(M.coordinates[$],D);return M});const je=a.bw.VectorTileFeature.prototype.toGeoJSON;var Ne={exports:{}},me=a.bA,Ie=a.bw.VectorTileFeature,it=Ye;function Ye(Z,M){this.options=M||{},this.features=Z,this.length=Z.length}function Ge(Z,M){this.id=typeof Z.id=="number"?Z.id:void 0,this.type=Z.type,this.rawGeometry=Z.type===1?[Z.geometry]:Z.geometry,this.properties=Z.tags,this.extent=M||4096}Ye.prototype.feature=function(Z){return new Ge(this.features[Z],this.options.extent)},Ge.prototype.loadGeometry=function(){var Z=this.rawGeometry;this.geometry=[];for(var M=0;M<Z.length;M++){for(var D=Z[M],$=[],H=0;H<D.length;H++)$.push(new me(D[H][0],D[H][1]));this.geometry.push($)}return this.geometry},Ge.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Z=this.geometry,M=1/0,D=-1/0,$=1/0,H=-1/0,K=0;K<Z.length;K++)for(var le=Z[K],te=0;te<le.length;te++){var Q=le[te];M=Math.min(M,Q.x),D=Math.max(D,Q.x),$=Math.min($,Q.y),H=Math.max(H,Q.y)}return[M,$,D,H]},Ge.prototype.toGeoJSON=Ie.prototype.toGeoJSON;var at=a.bB,De=it;function rt(Z){var M=new at;return function(D,$){for(var H in D.layers)$.writeMessage(3,xt,D.layers[H])}(Z,M),M.finish()}function xt(Z,M){var D;M.writeVarintField(15,Z.version||1),M.writeStringField(1,Z.name||""),M.writeVarintField(5,Z.extent||4096);var $={keys:[],values:[],keycache:{},valuecache:{}};for(D=0;D<Z.length;D++)$.feature=Z.feature(D),M.writeMessage(2,Pt,$);var H=$.keys;for(D=0;D<H.length;D++)M.writeStringField(3,H[D]);var K=$.values;for(D=0;D<K.length;D++)M.writeMessage(4,si,K[D])}function Pt(Z,M){var D=Z.feature;D.id!==void 0&&M.writeVarintField(1,D.id),M.writeMessage(2,gt,Z),M.writeVarintField(3,D.type),M.writeMessage(4,ft,D)}function gt(Z,M){var D=Z.feature,$=Z.keys,H=Z.values,K=Z.keycache,le=Z.valuecache;for(var te in D.properties){var Q=D.properties[te],ae=K[te];if(Q!==null){ae===void 0&&($.push(te),K[te]=ae=$.length-1),M.writeVarint(ae);var ve=typeof Q;ve!=="string"&&ve!=="boolean"&&ve!=="number"&&(Q=JSON.stringify(Q));var xe=ve+":"+Q,Se=le[xe];Se===void 0&&(H.push(Q),le[xe]=Se=H.length-1),M.writeVarint(Se)}}}function At(Z,M){return(M<<3)+(7&Z)}function Bt(Z){return Z<<1^Z>>31}function ft(Z,M){for(var D=Z.loadGeometry(),$=Z.type,H=0,K=0,le=D.length,te=0;te<le;te++){var Q=D[te],ae=1;$===1&&(ae=Q.length),M.writeVarint(At(1,ae));for(var ve=$===3?Q.length-1:Q.length,xe=0;xe<ve;xe++){xe===1&&$!==1&&M.writeVarint(At(2,ve-1));var Se=Q[xe].x-H,nt=Q[xe].y-K;M.writeVarint(Bt(Se)),M.writeVarint(Bt(nt)),H+=Se,K+=nt}$===3&&M.writeVarint(At(7,1))}}function si(Z,M){var D=typeof Z;D==="string"?M.writeStringField(1,Z):D==="boolean"?M.writeBooleanField(7,Z):D==="number"&&(Z%1!=0?M.writeDoubleField(3,Z):Z<0?M.writeSVarintField(6,Z):M.writeVarintField(5,Z))}Ne.exports=rt,Ne.exports.fromVectorTileJs=rt,Ne.exports.fromGeojsonVt=function(Z,M){M=M||{};var D={};for(var $ in Z)D[$]=new De(Z[$].features,M),D[$].name=$,D[$].version=M.version,D[$].extent=M.extent;return rt({layers:D})},Ne.exports.GeoJSONWrapper=De;var Mi=a.bz(Ne.exports);const Ki={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Z=>Z},ai=Math.fround||(Kt=new Float32Array(1),Z=>(Kt[0]=+Z,Kt[0]));var Kt;const Ze=3,yt=5,Jt=6;class Mt{constructor(M){this.options=Object.assign(Object.create(Ki),M),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(M){const{log:D,minZoom:$,maxZoom:H}=this.options;D&&console.time("total time");const K=`prepare ${M.length} points`;D&&console.time(K),this.points=M;const le=[];for(let Q=0;Q<M.length;Q++){const ae=M[Q];if(!ae.geometry)continue;const[ve,xe]=ae.geometry.coordinates,Se=ai(Qt(ve)),nt=ai(Rt(xe));le.push(Se,nt,1/0,Q,-1,1),this.options.reduce&&le.push(0)}let te=this.trees[H+1]=this._createTree(le);D&&console.timeEnd(K);for(let Q=H;Q>=$;Q--){const ae=+Date.now();te=this.trees[Q]=this._createTree(this._cluster(te,Q)),D&&console.log("z%d: %d clusters in %dms",Q,te.numItems,+Date.now()-ae)}return D&&console.timeEnd("total time"),this}getClusters(M,D){let $=((M[0]+180)%360+360)%360-180;const H=Math.max(-90,Math.min(90,M[1]));let K=M[2]===180?180:((M[2]+180)%360+360)%360-180;const le=Math.max(-90,Math.min(90,M[3]));if(M[2]-M[0]>=360)$=-180,K=180;else if($>K){const xe=this.getClusters([$,H,180,le],D),Se=this.getClusters([-180,H,K,le],D);return xe.concat(Se)}const te=this.trees[this._limitZoom(D)],Q=te.range(Qt($),Rt(le),Qt(K),Rt(H)),ae=te.data,ve=[];for(const xe of Q){const Se=this.stride*xe;ve.push(ae[Se+yt]>1?Yt(ae,Se,this.clusterProps):this.points[ae[Se+Ze]])}return ve}getChildren(M){const D=this._getOriginId(M),$=this._getOriginZoom(M),H="No cluster with the specified id.",K=this.trees[$];if(!K)throw new Error(H);const le=K.data;if(D*this.stride>=le.length)throw new Error(H);const te=this.options.radius/(this.options.extent*Math.pow(2,$-1)),Q=K.within(le[D*this.stride],le[D*this.stride+1],te),ae=[];for(const ve of Q){const xe=ve*this.stride;le[xe+4]===M&&ae.push(le[xe+yt]>1?Yt(le,xe,this.clusterProps):this.points[le[xe+Ze]])}if(ae.length===0)throw new Error(H);return ae}getLeaves(M,D,$){const H=[];return this._appendLeaves(H,M,D=D||10,$=$||0,0),H}getTile(M,D,$){const H=this.trees[this._limitZoom(M)],K=Math.pow(2,M),{extent:le,radius:te}=this.options,Q=te/le,ae=($-Q)/K,ve=($+1+Q)/K,xe={features:[]};return this._addTileFeatures(H.range((D-Q)/K,ae,(D+1+Q)/K,ve),H.data,D,$,K,xe),D===0&&this._addTileFeatures(H.range(1-Q/K,ae,1,ve),H.data,K,$,K,xe),D===K-1&&this._addTileFeatures(H.range(0,ae,Q/K,ve),H.data,-1,$,K,xe),xe.features.length?xe:null}getClusterExpansionZoom(M){let D=this._getOriginZoom(M)-1;for(;D<=this.options.maxZoom;){const $=this.getChildren(M);if(D++,$.length!==1)break;M=$[0].properties.cluster_id}return D}_appendLeaves(M,D,$,H,K){const le=this.getChildren(D);for(const te of le){const Q=te.properties;if(Q&&Q.cluster?K+Q.point_count<=H?K+=Q.point_count:K=this._appendLeaves(M,Q.cluster_id,$,H,K):K<H?K++:M.push(te),M.length===$)break}return K}_createTree(M){const D=new a.av(M.length/this.stride|0,this.options.nodeSize,Float32Array);for(let $=0;$<M.length;$+=this.stride)D.add(M[$],M[$+1]);return D.finish(),D.data=M,D}_addTileFeatures(M,D,$,H,K,le){for(const te of M){const Q=te*this.stride,ae=D[Q+yt]>1;let ve,xe,Se;if(ae)ve=gi(D,Q,this.clusterProps),xe=D[Q],Se=D[Q+1];else{const Xe=this.points[D[Q+Ze]];ve=Xe.properties;const[lt,_t]=Xe.geometry.coordinates;xe=Qt(lt),Se=Rt(_t)}const nt={type:1,geometry:[[Math.round(this.options.extent*(xe*K-$)),Math.round(this.options.extent*(Se*K-H))]],tags:ve};let pt;pt=ae||this.options.generateId?D[Q+Ze]:this.points[D[Q+Ze]].id,pt!==void 0&&(nt.id=pt),le.features.push(nt)}}_limitZoom(M){return Math.max(this.options.minZoom,Math.min(Math.floor(+M),this.options.maxZoom+1))}_cluster(M,D){const{radius:$,extent:H,reduce:K,minPoints:le}=this.options,te=$/(H*Math.pow(2,D)),Q=M.data,ae=[],ve=this.stride;for(let xe=0;xe<Q.length;xe+=ve){if(Q[xe+2]<=D)continue;Q[xe+2]=D;const Se=Q[xe],nt=Q[xe+1],pt=M.within(Q[xe],Q[xe+1],te),Xe=Q[xe+yt];let lt=Xe;for(const _t of pt){const Vt=_t*ve;Q[Vt+2]>D&&(lt+=Q[Vt+yt])}if(lt>Xe&&lt>=le){let _t,Vt=Se*Xe,Ht=nt*Xe,Ft=-1;const Lt=((xe/ve|0)<<5)+(D+1)+this.points.length;for(const Yi of pt){const ei=Yi*ve;if(Q[ei+2]<=D)continue;Q[ei+2]=D;const Ei=Q[ei+yt];Vt+=Q[ei]*Ei,Ht+=Q[ei+1]*Ei,Q[ei+4]=Lt,K&&(_t||(_t=this._map(Q,xe,!0),Ft=this.clusterProps.length,this.clusterProps.push(_t)),K(_t,this._map(Q,ei)))}Q[xe+4]=Lt,ae.push(Vt/lt,Ht/lt,1/0,Lt,-1,lt),K&&ae.push(Ft)}else{for(let _t=0;_t<ve;_t++)ae.push(Q[xe+_t]);if(lt>1)for(const _t of pt){const Vt=_t*ve;if(!(Q[Vt+2]<=D)){Q[Vt+2]=D;for(let Ht=0;Ht<ve;Ht++)ae.push(Q[Vt+Ht])}}}}return ae}_getOriginId(M){return M-this.points.length>>5}_getOriginZoom(M){return(M-this.points.length)%32}_map(M,D,$){if(M[D+yt]>1){const le=this.clusterProps[M[D+Jt]];return $?Object.assign({},le):le}const H=this.points[M[D+Ze]].properties,K=this.options.map(H);return $&&K===H?Object.assign({},K):K}}function Yt(Z,M,D){return{type:"Feature",id:Z[M+Ze],properties:gi(Z,M,D),geometry:{type:"Point",coordinates:[($=Z[M],360*($-.5)),ki(Z[M+1])]}};var $}function gi(Z,M,D){const $=Z[M+yt],H=$>=1e4?`${Math.round($/1e3)}k`:$>=1e3?Math.round($/100)/10+"k":$,K=Z[M+Jt],le=K===-1?{}:Object.assign({},D[K]);return Object.assign(le,{cluster:!0,cluster_id:Z[M+Ze],point_count:$,point_count_abbreviated:H})}function Qt(Z){return Z/360+.5}function Rt(Z){const M=Math.sin(Z*Math.PI/180),D=.5-.25*Math.log((1+M)/(1-M))/Math.PI;return D<0?0:D>1?1:D}function ki(Z){const M=(180-360*Z)*Math.PI/180;return 360*Math.atan(Math.exp(M))/Math.PI-90}function bi(Z,M,D,$){for(var H,K=$,le=D-M>>1,te=D-M,Q=Z[M],ae=Z[M+1],ve=Z[D],xe=Z[D+1],Se=M+3;Se<D;Se+=3){var nt=Xt(Z[Se],Z[Se+1],Q,ae,ve,xe);if(nt>K)H=Se,K=nt;else if(nt===K){var pt=Math.abs(Se-le);pt<te&&(H=Se,te=pt)}}K>$&&(H-M>3&&bi(Z,M,H,$),Z[H+2]=K,D-H>3&&bi(Z,H,D,$))}function Xt(Z,M,D,$,H,K){var le=H-D,te=K-$;if(le!==0||te!==0){var Q=((Z-D)*le+(M-$)*te)/(le*le+te*te);Q>1?(D=H,$=K):Q>0&&(D+=le*Q,$+=te*Q)}return(le=Z-D)*le+(te=M-$)*te}function Ti(Z,M,D,$){var H={id:Z===void 0?null:Z,type:M,geometry:D,tags:$,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(K){var le=K.geometry,te=K.type;if(te==="Point"||te==="MultiPoint"||te==="LineString")nr(K,le);else if(te==="Polygon"||te==="MultiLineString")for(var Q=0;Q<le.length;Q++)nr(K,le[Q]);else if(te==="MultiPolygon")for(Q=0;Q<le.length;Q++)for(var ae=0;ae<le[Q].length;ae++)nr(K,le[Q][ae])}(H),H}function nr(Z,M){for(var D=0;D<M.length;D+=3)Z.minX=Math.min(Z.minX,M[D]),Z.minY=Math.min(Z.minY,M[D+1]),Z.maxX=Math.max(Z.maxX,M[D]),Z.maxY=Math.max(Z.maxY,M[D+1])}function fr(Z,M,D,$){if(M.geometry){var H=M.geometry.coordinates,K=M.geometry.type,le=Math.pow(D.tolerance/((1<<D.maxZoom)*D.extent),2),te=[],Q=M.id;if(D.promoteId?Q=M.properties[D.promoteId]:D.generateId&&(Q=$||0),K==="Point")sr(H,te);else if(K==="MultiPoint")for(var ae=0;ae<H.length;ae++)sr(H[ae],te);else if(K==="LineString")mr(H,te,le,!1);else if(K==="MultiLineString"){if(D.lineMetrics){for(ae=0;ae<H.length;ae++)mr(H[ae],te=[],le,!1),Z.push(Ti(Q,"LineString",te,M.properties));return}Cr(H,te,le,!1)}else if(K==="Polygon")Cr(H,te,le,!0);else{if(K!=="MultiPolygon"){if(K==="GeometryCollection"){for(ae=0;ae<M.geometry.geometries.length;ae++)fr(Z,{id:Q,geometry:M.geometry.geometries[ae],properties:M.properties},D,$);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ae=0;ae<H.length;ae++){var ve=[];Cr(H[ae],ve,le,!0),te.push(ve)}}Z.push(Ti(Q,K,te,M.properties))}}function sr(Z,M){M.push(ge(Z[0])),M.push(Ii(Z[1])),M.push(0)}function mr(Z,M,D,$){for(var H,K,le=0,te=0;te<Z.length;te++){var Q=ge(Z[te][0]),ae=Ii(Z[te][1]);M.push(Q),M.push(ae),M.push(0),te>0&&(le+=$?(H*ae-Q*K)/2:Math.sqrt(Math.pow(Q-H,2)+Math.pow(ae-K,2))),H=Q,K=ae}var ve=M.length-3;M[2]=1,bi(M,0,ve,D),M[ve+2]=1,M.size=Math.abs(le),M.start=0,M.end=M.size}function Cr(Z,M,D,$){for(var H=0;H<Z.length;H++){var K=[];mr(Z[H],K,D,$),M.push(K)}}function ge(Z){return Z/360+.5}function Ii(Z){var M=Math.sin(Z*Math.PI/180),D=.5-.25*Math.log((1+M)/(1-M))/Math.PI;return D<0?0:D>1?1:D}function ji(Z,M,D,$,H,K,le,te){if($/=M,K>=(D/=M)&&le<$)return Z;if(le<D||K>=$)return null;for(var Q=[],ae=0;ae<Z.length;ae++){var ve=Z[ae],xe=ve.geometry,Se=ve.type,nt=H===0?ve.minX:ve.minY,pt=H===0?ve.maxX:ve.maxY;if(nt>=D&&pt<$)Q.push(ve);else if(!(pt<D||nt>=$)){var Xe=[];if(Se==="Point"||Se==="MultiPoint")jt(xe,Xe,D,$,H);else if(Se==="LineString")kt(xe,Xe,D,$,H,!1,te.lineMetrics);else if(Se==="MultiLineString")Ji(xe,Xe,D,$,H,!1);else if(Se==="Polygon")Ji(xe,Xe,D,$,H,!0);else if(Se==="MultiPolygon")for(var lt=0;lt<xe.length;lt++){var _t=[];Ji(xe[lt],_t,D,$,H,!0),_t.length&&Xe.push(_t)}if(Xe.length){if(te.lineMetrics&&Se==="LineString"){for(lt=0;lt<Xe.length;lt++)Q.push(Ti(ve.id,Se,Xe[lt],ve.tags));continue}Se!=="LineString"&&Se!=="MultiLineString"||(Xe.length===1?(Se="LineString",Xe=Xe[0]):Se="MultiLineString"),Se!=="Point"&&Se!=="MultiPoint"||(Se=Xe.length===3?"Point":"MultiPoint"),Q.push(Ti(ve.id,Se,Xe,ve.tags))}}}return Q.length?Q:null}function jt(Z,M,D,$,H){for(var K=0;K<Z.length;K+=3){var le=Z[K+H];le>=D&&le<=$&&(M.push(Z[K]),M.push(Z[K+1]),M.push(Z[K+2]))}}function kt(Z,M,D,$,H,K,le){for(var te,Q,ae=qi(Z),ve=H===0?Tn:In,xe=Z.start,Se=0;Se<Z.length-3;Se+=3){var nt=Z[Se],pt=Z[Se+1],Xe=Z[Se+2],lt=Z[Se+3],_t=Z[Se+4],Vt=H===0?nt:pt,Ht=H===0?lt:_t,Ft=!1;le&&(te=Math.sqrt(Math.pow(nt-lt,2)+Math.pow(pt-_t,2))),Vt<D?Ht>D&&(Q=ve(ae,nt,pt,lt,_t,D),le&&(ae.start=xe+te*Q)):Vt>$?Ht<$&&(Q=ve(ae,nt,pt,lt,_t,$),le&&(ae.start=xe+te*Q)):ar(ae,nt,pt,Xe),Ht<D&&Vt>=D&&(Q=ve(ae,nt,pt,lt,_t,D),Ft=!0),Ht>$&&Vt<=$&&(Q=ve(ae,nt,pt,lt,_t,$),Ft=!0),!K&&Ft&&(le&&(ae.end=xe+te*Q),M.push(ae),ae=qi(Z)),le&&(xe+=te)}var Lt=Z.length-3;nt=Z[Lt],pt=Z[Lt+1],Xe=Z[Lt+2],(Vt=H===0?nt:pt)>=D&&Vt<=$&&ar(ae,nt,pt,Xe),Lt=ae.length-3,K&&Lt>=3&&(ae[Lt]!==ae[0]||ae[Lt+1]!==ae[1])&&ar(ae,ae[0],ae[1],ae[2]),ae.length&&M.push(ae)}function qi(Z){var M=[];return M.size=Z.size,M.start=Z.start,M.end=Z.end,M}function Ji(Z,M,D,$,H,K){for(var le=0;le<Z.length;le++)kt(Z[le],M,D,$,H,K,!1)}function ar(Z,M,D,$){Z.push(M),Z.push(D),Z.push($)}function Tn(Z,M,D,$,H,K){var le=(K-M)/($-M);return Z.push(K),Z.push(D+(H-D)*le),Z.push(1),le}function In(Z,M,D,$,H,K){var le=(K-D)/(H-D);return Z.push(M+($-M)*le),Z.push(K),Z.push(1),le}function en(Z,M){for(var D=[],$=0;$<Z.length;$++){var H,K=Z[$],le=K.type;if(le==="Point"||le==="MultiPoint"||le==="LineString")H=En(K.geometry,M);else if(le==="MultiLineString"||le==="Polygon"){H=[];for(var te=0;te<K.geometry.length;te++)H.push(En(K.geometry[te],M))}else if(le==="MultiPolygon")for(H=[],te=0;te<K.geometry.length;te++){for(var Q=[],ae=0;ae<K.geometry[te].length;ae++)Q.push(En(K.geometry[te][ae],M));H.push(Q)}D.push(Ti(K.id,le,H,K.tags))}return D}function En(Z,M){var D=[];D.size=Z.size,Z.start!==void 0&&(D.start=Z.start,D.end=Z.end);for(var $=0;$<Z.length;$+=3)D.push(Z[$]+M,Z[$+1],Z[$+2]);return D}function Re(Z,M){if(Z.transformed)return Z;var D,$,H,K=1<<Z.z,le=Z.x,te=Z.y;for(D=0;D<Z.features.length;D++){var Q=Z.features[D],ae=Q.geometry,ve=Q.type;if(Q.geometry=[],ve===1)for($=0;$<ae.length;$+=2)Q.geometry.push(mt(ae[$],ae[$+1],M,K,le,te));else for($=0;$<ae.length;$++){var xe=[];for(H=0;H<ae[$].length;H+=2)xe.push(mt(ae[$][H],ae[$][H+1],M,K,le,te));Q.geometry.push(xe)}}return Z.transformed=!0,Z}function mt(Z,M,D,$,H,K){return[Math.round(D*(Z*$-H)),Math.round(D*(M*$-K))]}function dt(Z,M,D,$,H){for(var K=M===H.maxZoom?0:H.tolerance/((1<<M)*H.extent),le={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:D,y:$,z:M,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},te=0;te<Z.length;te++){le.numFeatures++,qt(le,Z[te],K,H);var Q=Z[te].minX,ae=Z[te].minY,ve=Z[te].maxX,xe=Z[te].maxY;Q<le.minX&&(le.minX=Q),ae<le.minY&&(le.minY=ae),ve>le.maxX&&(le.maxX=ve),xe>le.maxY&&(le.maxY=xe)}return le}function qt(Z,M,D,$){var H=M.geometry,K=M.type,le=[];if(K==="Point"||K==="MultiPoint")for(var te=0;te<H.length;te+=3)le.push(H[te]),le.push(H[te+1]),Z.numPoints++,Z.numSimplified++;else if(K==="LineString")wt(le,H,Z,D,!1,!1);else if(K==="MultiLineString"||K==="Polygon")for(te=0;te<H.length;te++)wt(le,H[te],Z,D,K==="Polygon",te===0);else if(K==="MultiPolygon")for(var Q=0;Q<H.length;Q++){var ae=H[Q];for(te=0;te<ae.length;te++)wt(le,ae[te],Z,D,!0,te===0)}if(le.length){var ve=M.tags||null;if(K==="LineString"&&$.lineMetrics){for(var xe in ve={},M.tags)ve[xe]=M.tags[xe];ve.mapbox_clip_start=H.start/H.size,ve.mapbox_clip_end=H.end/H.size}var Se={geometry:le,type:K==="Polygon"||K==="MultiPolygon"?3:K==="LineString"||K==="MultiLineString"?2:1,tags:ve};M.id!==null&&(Se.id=M.id),Z.features.push(Se)}}function wt(Z,M,D,$,H,K){var le=$*$;if($>0&&M.size<(H?le:$))D.numPoints+=M.length/3;else{for(var te=[],Q=0;Q<M.length;Q+=3)($===0||M[Q+2]>le)&&(D.numSimplified++,te.push(M[Q]),te.push(M[Q+1])),D.numPoints++;H&&function(ae,ve){for(var xe=0,Se=0,nt=ae.length,pt=nt-2;Se<nt;pt=Se,Se+=2)xe+=(ae[Se]-ae[pt])*(ae[Se+1]+ae[pt+1]);if(xe>0===ve)for(Se=0,nt=ae.length;Se<nt/2;Se+=2){var Xe=ae[Se],lt=ae[Se+1];ae[Se]=ae[nt-2-Se],ae[Se+1]=ae[nt-1-Se],ae[nt-2-Se]=Xe,ae[nt-1-Se]=lt}}(te,K),Z.push(te)}}function Te(Z,M){var D=(M=this.options=function(H,K){for(var le in K)H[le]=K[le];return H}(Object.create(this.options),M)).debug;if(D&&console.time("preprocess data"),M.maxZoom<0||M.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(M.promoteId&&M.generateId)throw new Error("promoteId and generateId cannot be used together.");var $=function(H,K){var le=[];if(H.type==="FeatureCollection")for(var te=0;te<H.features.length;te++)fr(le,H.features[te],K,te);else fr(le,H.type==="Feature"?H:{geometry:H},K);return le}(Z,M);this.tiles={},this.tileCoords=[],D&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",M.indexMaxZoom,M.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),$=function(H,K){var le=K.buffer/K.extent,te=H,Q=ji(H,1,-1-le,le,0,-1,2,K),ae=ji(H,1,1-le,2+le,0,-1,2,K);return(Q||ae)&&(te=ji(H,1,-le,1+le,0,-1,2,K)||[],Q&&(te=en(Q,1).concat(te)),ae&&(te=te.concat(en(ae,-1)))),te}($,M),$.length&&this.splitTile($,0,0,0),D&&($.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ot(Z,M,D){return 32*((1<<Z)*D+M)+Z}function ct(Z,M){return M?Z.properties[M]:Z.id}function _i(Z,M){if(Z==null)return!0;if(Z.type==="Feature")return ct(Z,M)!=null;if(Z.type==="FeatureCollection"){const D=new Set;for(const $ of Z.features){const H=ct($,M);if(H==null||D.has(H))return!1;D.add(H)}return!0}return!1}function Vi(Z,M){const D=new Map;if(Z!=null)if(Z.type==="Feature")D.set(ct(Z,M),Z);else for(const $ of Z.features)D.set(ct($,M),$);return D}Te.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Te.prototype.splitTile=function(Z,M,D,$,H,K,le){for(var te=[Z,M,D,$],Q=this.options,ae=Q.debug;te.length;){$=te.pop(),D=te.pop(),M=te.pop(),Z=te.pop();var ve=1<<M,xe=ot(M,D,$),Se=this.tiles[xe];if(!Se&&(ae>1&&console.time("creation"),Se=this.tiles[xe]=dt(Z,M,D,$,Q),this.tileCoords.push({z:M,x:D,y:$}),ae)){ae>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",M,D,$,Se.numFeatures,Se.numPoints,Se.numSimplified),console.timeEnd("creation"));var nt="z"+M;this.stats[nt]=(this.stats[nt]||0)+1,this.total++}if(Se.source=Z,H){if(M===Q.maxZoom||M===H)continue;var pt=1<<H-M;if(D!==Math.floor(K/pt)||$!==Math.floor(le/pt))continue}else if(M===Q.indexMaxZoom||Se.numPoints<=Q.indexMaxPoints)continue;if(Se.source=null,Z.length!==0){ae>1&&console.time("clipping");var Xe,lt,_t,Vt,Ht,Ft,Lt=.5*Q.buffer/Q.extent,Yi=.5-Lt,ei=.5+Lt,Ei=1+Lt;Xe=lt=_t=Vt=null,Ht=ji(Z,ve,D-Lt,D+ei,0,Se.minX,Se.maxX,Q),Ft=ji(Z,ve,D+Yi,D+Ei,0,Se.minX,Se.maxX,Q),Z=null,Ht&&(Xe=ji(Ht,ve,$-Lt,$+ei,1,Se.minY,Se.maxY,Q),lt=ji(Ht,ve,$+Yi,$+Ei,1,Se.minY,Se.maxY,Q),Ht=null),Ft&&(_t=ji(Ft,ve,$-Lt,$+ei,1,Se.minY,Se.maxY,Q),Vt=ji(Ft,ve,$+Yi,$+Ei,1,Se.minY,Se.maxY,Q),Ft=null),ae>1&&console.timeEnd("clipping"),te.push(Xe||[],M+1,2*D,2*$),te.push(lt||[],M+1,2*D,2*$+1),te.push(_t||[],M+1,2*D+1,2*$),te.push(Vt||[],M+1,2*D+1,2*$+1)}}},Te.prototype.getTile=function(Z,M,D){var $=this.options,H=$.extent,K=$.debug;if(Z<0||Z>24)return null;var le=1<<Z,te=ot(Z,M=(M%le+le)%le,D);if(this.tiles[te])return Re(this.tiles[te],H);K>1&&console.log("drilling down to z%d-%d-%d",Z,M,D);for(var Q,ae=Z,ve=M,xe=D;!Q&&ae>0;)ae--,ve=Math.floor(ve/2),xe=Math.floor(xe/2),Q=this.tiles[ot(ae,ve,xe)];return Q&&Q.source?(K>1&&console.log("found parent tile z%d-%d-%d",ae,ve,xe),K>1&&console.time("drilling down"),this.splitTile(Q.source,ae,ve,xe,Z,M,D),K>1&&console.timeEnd("drilling down"),this.tiles[te]?Re(this.tiles[te],H):null):null};class vt extends _e{constructor(M,D,$,H){super(M,D,$),this._dataUpdateable=new Map,this.loadGeoJSON=(K,le)=>{const{promoteId:te}=K;if(K.request)return a.f(K.request,(Q,ae,ve,xe)=>{this._dataUpdateable=_i(ae,te)?Vi(ae,te):void 0,le(Q,ae,ve,xe)});if(typeof K.data=="string")try{const Q=JSON.parse(K.data);this._dataUpdateable=_i(Q,te)?Vi(Q,te):void 0,le(null,Q)}catch{le(new Error(`Input data given to '${K.source}' is not a valid GeoJSON object.`))}else K.dataDiff?this._dataUpdateable?(function(Q,ae,ve){var xe,Se,nt,pt;if(ae.removeAll&&Q.clear(),ae.remove)for(const Xe of ae.remove)Q.delete(Xe);if(ae.add)for(const Xe of ae.add){const lt=ct(Xe,ve);lt!=null&&Q.set(lt,Xe)}if(ae.update)for(const Xe of ae.update){let lt=Q.get(Xe.id);if(lt==null)continue;const _t=!Xe.removeAllProperties&&(((xe=Xe.removeProperties)===null||xe===void 0?void 0:xe.length)>0||((Se=Xe.addOrUpdateProperties)===null||Se===void 0?void 0:Se.length)>0);if((Xe.newGeometry||Xe.removeAllProperties||_t)&&(lt=Object.assign({},lt),Q.set(Xe.id,lt),_t&&(lt.properties=Object.assign({},lt.properties))),Xe.newGeometry&&(lt.geometry=Xe.newGeometry),Xe.removeAllProperties)lt.properties={};else if(((nt=Xe.removeProperties)===null||nt===void 0?void 0:nt.length)>0)for(const Vt of Xe.removeProperties)Object.prototype.hasOwnProperty.call(lt.properties,Vt)&&delete lt.properties[Vt];if(((pt=Xe.addOrUpdateProperties)===null||pt===void 0?void 0:pt.length)>0)for(const{key:Vt,value:Ht}of Xe.addOrUpdateProperties)lt.properties[Vt]=Ht}}(this._dataUpdateable,K.dataDiff,te),le(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):le(new Error(`Cannot update existing geojson data in ${K.source}`)):le(new Error(`Input data given to '${K.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},this.loadVectorData=this.loadGeoJSONTile,H&&(this.loadGeoJSON=H)}loadGeoJSONTile(M,D){const $=M.tileID.canonical;if(!this._geoJSONIndex)return D(null,null);const H=this._geoJSONIndex.getTile($.z,$.x,$.y);if(!H)return D(null,null);const K=new class{constructor(te){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.N,this.length=te.length,this._features=te}feature(te){return new class{constructor(Q){this._feature=Q,this.extent=a.N,this.type=Q.type,this.properties=Q.tags,"id"in Q&&!isNaN(Q.id)&&(this.id=parseInt(Q.id,10))}loadGeometry(){if(this._feature.type===1){const Q=[];for(const ae of this._feature.geometry)Q.push([new a.P(ae[0],ae[1])]);return Q}{const Q=[];for(const ae of this._feature.geometry){const ve=[];for(const xe of ae)ve.push(new a.P(xe[0],xe[1]));Q.push(ve)}return Q}}toGeoJSON(Q,ae,ve){return je.call(this,Q,ae,ve)}}(this._features[te])}}(H.features);let le=Mi(K);le.byteOffset===0&&le.byteLength===le.buffer.byteLength||(le=new Uint8Array(le)),D(null,{vectorTile:K,rawData:le.buffer})}loadData(M,D){var $;($=this._pendingRequest)===null||$===void 0||$.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const H=!!(M&&M.request&&M.request.collectResourceTiming)&&new a.bu(M.request);this._pendingCallback=D,this._pendingRequest=this.loadGeoJSON(M,(K,le)=>{if(delete this._pendingCallback,delete this._pendingRequest,K||!le)return D(K);if(typeof le!="object")return D(new Error(`Input data given to '${M.source}' is not a valid GeoJSON object.`));{ze(le,!0);try{if(M.filter){const Q=a.bC(M.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Q.result==="error")throw new Error(Q.value.map(ve=>`${ve.key}: ${ve.message}`).join(", "));le={type:"FeatureCollection",features:le.features.filter(ve=>Q.value.evaluate({zoom:0},ve))}}this._geoJSONIndex=M.cluster?new Mt(function({superclusterOptions:Q,clusterProperties:ae}){if(!ae||!Q)return Q;const ve={},xe={},Se={accumulated:null,zoom:0},nt={properties:null},pt=Object.keys(ae);for(const Xe of pt){const[lt,_t]=ae[Xe],Vt=a.bC(_t),Ht=a.bC(typeof lt=="string"?[lt,["accumulated"],["get",Xe]]:lt);ve[Xe]=Vt.value,xe[Xe]=Ht.value}return Q.map=Xe=>{nt.properties=Xe;const lt={};for(const _t of pt)lt[_t]=ve[_t].evaluate(Se,nt);return lt},Q.reduce=(Xe,lt)=>{nt.properties=lt;for(const _t of pt)Se.accumulated=Xe[_t],Xe[_t]=xe[_t].evaluate(Se,nt)},Q}(M)).load(le.features):function(Q,ae){return new Te(Q,ae)}(le,M.geojsonVtOptions)}catch(Q){return D(Q)}this.loaded={};const te={};if(H){const Q=H.finish();Q&&(te.resourceTiming={},te.resourceTiming[M.source]=JSON.parse(JSON.stringify(Q)))}D(null,te)}})}reloadTile(M,D){const $=this.loaded;return $&&$[M.uid]?super.reloadTile(M,D):this.loadTile(M,D)}removeSource(M,D){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),D()}getClusterExpansionZoom(M,D){try{D(null,this._geoJSONIndex.getClusterExpansionZoom(M.clusterId))}catch($){D($)}}getClusterChildren(M,D){try{D(null,this._geoJSONIndex.getChildren(M.clusterId))}catch($){D($)}}getClusterLeaves(M,D){try{D(null,this._geoJSONIndex.getLeaves(M.clusterId,M.limit,M.offset))}catch($){D($)}}}class hn{constructor(M){this.self=M,this.actor=new a.C(M,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:_e,geojson:vt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(D,$)=>{if(this.workerSourceTypes[D])throw new Error(`Worker source with name "${D}" already registered.`);this.workerSourceTypes[D]=$},this.self.registerRTLTextPlugin=D=>{if(a.bD.isParsed())throw new Error("RTL text plugin already registered.");a.bD.applyArabicShaping=D.applyArabicShaping,a.bD.processBidirectionalText=D.processBidirectionalText,a.bD.processStyledBidirectionalText=D.processStyledBidirectionalText}}setReferrer(M,D){this.referrer=D}setImages(M,D,$){this.availableImages[M]=D;for(const H in this.workerSources[M]){const K=this.workerSources[M][H];for(const le in K)K[le].availableImages=D}$()}setLayers(M,D,$){this.getLayerIndex(M).replace(D),$()}updateLayers(M,D,$){this.getLayerIndex(M).update(D.layers,D.removedIds),$()}loadTile(M,D,$){this.getWorkerSource(M,D.type,D.source).loadTile(D,$)}loadDEMTile(M,D,$){this.getDEMWorkerSource(M,D.source).loadTile(D,$)}reloadTile(M,D,$){this.getWorkerSource(M,D.type,D.source).reloadTile(D,$)}abortTile(M,D,$){this.getWorkerSource(M,D.type,D.source).abortTile(D,$)}removeTile(M,D,$){this.getWorkerSource(M,D.type,D.source).removeTile(D,$)}removeDEMTile(M,D){this.getDEMWorkerSource(M,D.source).removeTile(D)}removeSource(M,D,$){if(!this.workerSources[M]||!this.workerSources[M][D.type]||!this.workerSources[M][D.type][D.source])return;const H=this.workerSources[M][D.type][D.source];delete this.workerSources[M][D.type][D.source],H.removeSource!==void 0?H.removeSource(D,$):$()}loadWorkerSource(M,D,$){try{this.self.importScripts(D.url),$()}catch(H){$(H.toString())}}syncRTLPluginState(M,D,$){try{a.bD.setState(D);const H=a.bD.getPluginURL();if(a.bD.isLoaded()&&!a.bD.isParsed()&&H!=null){this.self.importScripts(H);const K=a.bD.isParsed();$(K?void 0:new Error(`RTL Text Plugin failed to import scripts from ${H}`),K)}}catch(H){$(H.toString())}}getAvailableImages(M){let D=this.availableImages[M];return D||(D=[]),D}getLayerIndex(M){let D=this.layerIndexes[M];return D||(D=this.layerIndexes[M]=new W),D}getWorkerSource(M,D,$){return this.workerSources[M]||(this.workerSources[M]={}),this.workerSources[M][D]||(this.workerSources[M][D]={}),this.workerSources[M][D][$]||(this.workerSources[M][D][$]=new this.workerSourceTypes[D]({send:(H,K,le)=>{this.actor.send(H,K,le,M)}},this.getLayerIndex(M),this.getAvailableImages(M))),this.workerSources[M][D][$]}getDEMWorkerSource(M,D){return this.demWorkerSources[M]||(this.demWorkerSources[M]={}),this.demWorkerSources[M][D]||(this.demWorkerSources[M][D]=new Ee),this.demWorkerSources[M][D]}}return a.i()&&(self.worker=new hn(self)),hn}),k(["./shared"],function(a){var W="3.6.2";class F{static testProp(t){if(!F.docStyle)return t[0];for(let n=0;n<t.length;n++)if(t[n]in F.docStyle)return t[n];return t[0]}static create(t,n,o){const c=window.document.createElement(t);return n!==void 0&&(c.className=n),o&&o.appendChild(c),c}static createNS(t,n){return window.document.createElementNS(t,n)}static disableDrag(){F.docStyle&&F.selectProp&&(F.userSelect=F.docStyle[F.selectProp],F.docStyle[F.selectProp]="none")}static enableDrag(){F.docStyle&&F.selectProp&&(F.docStyle[F.selectProp]=F.userSelect)}static setTransform(t,n){t.style[F.transformProp]=n}static addEventListener(t,n,o,c={}){t.addEventListener(n,o,"passive"in c?c:c.capture)}static removeEventListener(t,n,o,c={}){t.removeEventListener(n,o,"passive"in c?c:c.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",F.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",F.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",F.suppressClickInternal,!0)},0)}static mousePos(t,n){const o=t.getBoundingClientRect();return new a.P(n.clientX-o.left-t.clientLeft,n.clientY-o.top-t.clientTop)}static touchPos(t,n){const o=t.getBoundingClientRect(),c=[];for(let d=0;d<n.length;d++)c.push(new a.P(n[d].clientX-o.left-t.clientLeft,n[d].clientY-o.top-t.clientTop));return c}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}F.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,F.selectProp=F.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),F.transformProp=F.testProp(["transform","WebkitTransform"]);const ne={supported:!1,testSupport:function(u){!_e&&ue&&(Ee?ke(u):ie=u)}};let ie,ue,_e=!1,Ee=!1;function ke(u){const t=u.createTexture();u.bindTexture(u.TEXTURE_2D,t);try{if(u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,ue),u.isContextLost())return;ne.supported=!0}catch{}u.deleteTexture(t),_e=!0}var Me,ze;typeof document<"u"&&(ue=document.createElement("img"),ue.onload=function(){ie&&ke(ie),ie=null,Ee=!0},ue.onerror=function(){_e=!0,ie=null},ue.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(u){let t,n,o,c;u.resetRequestQueue=()=>{t=[],n=0,o=0,c={}},u.addThrottleControl=C=>{const E=o++;return c[E]=C,E},u.removeThrottleControl=C=>{delete c[C],y()},u.getImage=(C,E,P=!0)=>{ne.supported&&(C.headers||(C.headers={}),C.headers.accept="image/webp,*/*");const L={requestParameters:C,supportImageRefresh:P,callback:E,cancelled:!1,completed:!1,cancel:()=>{L.completed||L.cancelled||(L.cancelled=!0,L.innerRequest&&(L.innerRequest.cancel(),n--),y())}};return t.push(L),y(),L};const d=C=>{const{requestParameters:E,supportImageRefresh:P,callback:L}=C;return a.e(E,{type:"image"}),(P!==!1||a.i()||a.g(E.url)||E.headers&&!Object.keys(E.headers).reduce((U,V)=>U&&V==="accept",!0)?a.m:x)(E,(U,V,G,N)=>{_(C,L,U,V,G,N)})},_=(C,E,P,L,U,V)=>{P?E(P):L instanceof HTMLImageElement||a.a(L)?E(null,L):L&&((G,N)=>{typeof createImageBitmap=="function"?a.b(G,N):a.d(G,N)})(L,(G,N)=>{G!=null?E(G):N!=null&&E(null,N,{cacheControl:U,expires:V})}),C.cancelled||(C.completed=!0,n--,y())},y=()=>{const C=(()=>{const E=Object.keys(c);let P=!1;if(E.length>0){for(const L of E)if(P=c[L](),P)break}return P})()?a.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:a.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let E=n;E<C&&t.length>0;E++){const P=t.shift();if(P.cancelled){E--;continue}const L=d(P);n++,P.innerRequest=L}},x=(C,E)=>{const P=new Image,L=C.url;let U=!1;const V=C.credentials;return V&&V==="include"?P.crossOrigin="use-credentials":(V&&V==="same-origin"||!a.s(L))&&(P.crossOrigin="anonymous"),P.fetchPriority="high",P.onload=()=>{E(null,P),P.onerror=P.onload=null},P.onerror=()=>{U||E(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),P.onerror=P.onload=null},P.src=L,{cancel:()=>{U=!0,P.src=""}}}}(Me||(Me={})),Me.resetRequestQueue(),function(u){u.Glyphs="Glyphs",u.Image="Image",u.Source="Source",u.SpriteImage="SpriteImage",u.SpriteJSON="SpriteJSON",u.Style="Style",u.Tile="Tile",u.Unknown="Unknown"}(ze||(ze={}));class je{constructor(t){this._transformRequestFn=t}transformRequest(t,n){return this._transformRequestFn&&this._transformRequestFn(t,n)||{url:t}}normalizeSpriteURL(t,n,o){const c=function(d){const _=d.match(Ne);if(!_)throw new Error(`Unable to parse URL "${d}"`);return{protocol:_[1],authority:_[2],path:_[3]||"/",params:_[4]?_[4].split("&"):[]}}(t);return c.path+=`${n}${o}`,function(d){const _=d.params.length?`?${d.params.join("&")}`:"";return`${d.protocol}://${d.authority}${d.path}${_}`}(c)}setTransformRequest(t){this._transformRequestFn=t}}const Ne=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function me(u){var t=new a.A(3);return t[0]=u[0],t[1]=u[1],t[2]=u[2],t}var Ie,it=function(u,t,n){return u[0]=t[0]-n[0],u[1]=t[1]-n[1],u[2]=t[2]-n[2],u};Ie=new a.A(3),a.A!=Float32Array&&(Ie[0]=0,Ie[1]=0,Ie[2]=0);var Ye=function(u){var t=u[0],n=u[1];return t*t+n*n};function Ge(u){const t=[];if(typeof u=="string")t.push({id:"default",url:u});else if(u&&u.length>0){const n=[];for(const{id:o,url:c}of u){const d=`${o}${c}`;n.indexOf(d)===-1&&(n.push(d),t.push({id:o,url:c}))}}return t}function at(u,t,n,o,c){if(o)return void u(o);if(c!==Object.values(t).length||c!==Object.values(n).length)return;const d={};for(const _ in t){d[_]={};const y=a.h.getImageCanvasContext(n[_]),x=t[_];for(const C in x){const{width:E,height:P,x:L,y:U,sdf:V,pixelRatio:G,stretchX:N,stretchY:re,content:he}=x[C];d[_][C]={data:null,pixelRatio:G,sdf:V,stretchX:N,stretchY:re,content:he,spriteData:{width:E,height:P,x:L,y:U,context:y}}}}u(null,d)}(function(){var u=new a.A(2);a.A!=Float32Array&&(u[0]=0,u[1]=0)})();class De{constructor(t,n,o,c){this.context=t,this.format=o,this.texture=t.gl.createTexture(),this.update(n,c)}update(t,n,o){const{width:c,height:d}=t,_=!(this.size&&this.size[0]===c&&this.size[1]===d||o),{context:y}=this,{gl:x}=y;if(this.useMipmap=!!(n&&n.useMipmap),x.bindTexture(x.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!n||n.premultiply!==!1)),_)this.size=[c,d],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||a.a(t)?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,t):x.texImage2D(x.TEXTURE_2D,0,this.format,c,d,0,this.format,x.UNSIGNED_BYTE,t.data);else{const{x:C,y:E}=o||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||a.a(t)?x.texSubImage2D(x.TEXTURE_2D,0,C,E,x.RGBA,x.UNSIGNED_BYTE,t):x.texSubImage2D(x.TEXTURE_2D,0,C,E,c,d,x.RGBA,x.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&x.generateMipmap(x.TEXTURE_2D)}bind(t,n,o){const{context:c}=this,{gl:d}=c;d.bindTexture(d.TEXTURE_2D,this.texture),o!==d.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(o=d.LINEAR),t!==this.filter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,t),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,o||t),this.filter=t),n!==this.wrap&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,n),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function rt(u){const{userImage:t}=u;return!!(t&&t.render&&t.render())&&(u.data.replace(new Uint8Array(t.data.buffer)),!0)}class xt extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:n,callback:o}of this.requestors)this._notify(n,o);this.requestors=[]}}getImage(t){const n=this.images[t];if(n&&!n.data&&n.spriteData){const o=n.spriteData;n.data=new a.R({width:o.width,height:o.height},o.context.getImageData(o.x,o.y,o.width,o.height).data),n.spriteData=null}return n}addImage(t,n){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,n)&&(this.images[t]=n)}_validate(t,n){let o=!0;const c=n.data||n.spriteData;return this._validateStretch(n.stretchX,c&&c.width)||(this.fire(new a.j(new Error(`Image "${t}" has invalid "stretchX" value`))),o=!1),this._validateStretch(n.stretchY,c&&c.height)||(this.fire(new a.j(new Error(`Image "${t}" has invalid "stretchY" value`))),o=!1),this._validateContent(n.content,n)||(this.fire(new a.j(new Error(`Image "${t}" has invalid "content" value`))),o=!1),o}_validateStretch(t,n){if(!t)return!0;let o=0;for(const c of t){if(c[0]<o||c[1]<c[0]||n<c[1])return!1;o=c[1]}return!0}_validateContent(t,n){if(!t)return!0;if(t.length!==4)return!1;const o=n.spriteData,c=o&&o.width||n.data.width,d=o&&o.height||n.data.height;return!(t[0]<0||c<t[0]||t[1]<0||d<t[1]||t[2]<0||c<t[2]||t[3]<0||d<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,n,o=!0){const c=this.getImage(t);if(o&&(c.data.width!==n.data.width||c.data.height!==n.data.height))throw new Error(`size mismatch between old image (${c.data.width}x${c.data.height}) and new image (${n.data.width}x${n.data.height}).`);n.version=c.version+1,this.images[t]=n,this.updatedImages[t]=!0}removeImage(t){const n=this.images[t];delete this.images[t],delete this.patterns[t],n.userImage&&n.userImage.onRemove&&n.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,n){let o=!0;if(!this.isLoaded())for(const c of t)this.images[c]||(o=!1);this.isLoaded()||o?this._notify(t,n):this.requestors.push({ids:t,callback:n})}_notify(t,n){const o={};for(const c of t){let d=this.getImage(c);d||(this.fire(new a.k("styleimagemissing",{id:c})),d=this.getImage(c)),d?o[c]={data:d.data.clone(),pixelRatio:d.pixelRatio,sdf:d.sdf,version:d.version,stretchX:d.stretchX,stretchY:d.stretchY,content:d.content,hasRenderCallback:!!(d.userImage&&d.userImage.render)}:a.w(`Image "${c}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}n(null,o)}getPixelSize(){const{width:t,height:n}=this.atlasImage;return{width:t,height:n}}getPattern(t){const n=this.patterns[t],o=this.getImage(t);if(!o)return null;if(n&&n.position.version===o.version)return n.position;if(n)n.position.version=o.version;else{const c={w:o.data.width+2,h:o.data.height+2,x:0,y:0},d=new a.I(c,o);this.patterns[t]={bin:c,position:d}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const n=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new De(t,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const d in this.patterns)t.push(this.patterns[d].bin);const{w:n,h:o}=a.p(t),c=this.atlasImage;c.resize({width:n||1,height:o||1});for(const d in this.patterns){const{bin:_}=this.patterns[d],y=_.x+1,x=_.y+1,C=this.getImage(d).data,E=C.width,P=C.height;a.R.copy(C,c,{x:0,y:0},{x:y,y:x},{width:E,height:P}),a.R.copy(C,c,{x:0,y:P-1},{x:y,y:x-1},{width:E,height:1}),a.R.copy(C,c,{x:0,y:0},{x:y,y:x+P},{width:E,height:1}),a.R.copy(C,c,{x:E-1,y:0},{x:y-1,y:x},{width:1,height:P}),a.R.copy(C,c,{x:0,y:0},{x:y+E,y:x},{width:1,height:P})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const n of t){if(this.callbackDispatchedThisFrame[n])continue;this.callbackDispatchedThisFrame[n]=!0;const o=this.getImage(n);o||a.w(`Image with ID: "${n}" was not found`),rt(o)&&this.updateImage(n,o)}}}const Pt=1e20;function gt(u,t,n,o,c,d,_,y,x){for(let C=t;C<t+o;C++)At(u,n*d+C,d,c,_,y,x);for(let C=n;C<n+c;C++)At(u,C*d+t,1,o,_,y,x)}function At(u,t,n,o,c,d,_){d[0]=0,_[0]=-Pt,_[1]=Pt,c[0]=u[t];for(let y=1,x=0,C=0;y<o;y++){c[y]=u[t+y*n];const E=y*y;do{const P=d[x];C=(c[y]-c[P]+E-P*P)/(y-P)/2}while(C<=_[x]&&--x>-1);x++,d[x]=y,_[x]=C,_[x+1]=Pt}for(let y=0,x=0;y<o;y++){for(;_[x+1]<y;)x++;const C=d[x],E=y-C;u[t+y*n]=c[C]+E*E}}class Bt{constructor(t,n){this.requestManager=t,this.localIdeographFontFamily=n,this.entries={}}setURL(t){this.url=t}getGlyphs(t,n){const o=[];for(const c in t)for(const d of t[c])o.push({stack:c,id:d});a.o(o,({stack:c,id:d},_)=>{let y=this.entries[c];y||(y=this.entries[c]={glyphs:{},requests:{},ranges:{}});let x=y.glyphs[d];if(x!==void 0)return void _(null,{stack:c,id:d,glyph:x});if(x=this._tinySDF(y,c,d),x)return y.glyphs[d]=x,void _(null,{stack:c,id:d,glyph:x});const C=Math.floor(d/256);if(256*C>65535)return void _(new Error("glyphs > 65535 not supported"));if(y.ranges[C])return void _(null,{stack:c,id:d,glyph:x});if(!this.url)return void _(new Error("glyphsUrl is not set"));let E=y.requests[C];E||(E=y.requests[C]=[],Bt.loadGlyphRange(c,C,this.url,this.requestManager,(P,L)=>{if(L){for(const U in L)this._doesCharSupportLocalGlyph(+U)||(y.glyphs[+U]=L[+U]);y.ranges[C]=!0}for(const U of E)U(P,L);delete y.requests[C]})),E.push((P,L)=>{P?_(P):L&&_(null,{stack:c,id:d,glyph:L[d]||null})})},(c,d)=>{if(c)n(c);else if(d){const _={};for(const{stack:y,id:x,glyph:C}of d)(_[y]||(_[y]={}))[x]=C&&{id:C.id,bitmap:C.bitmap.clone(),metrics:C.metrics};n(null,_)}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(a.u["CJK Unified Ideographs"](t)||a.u["Hangul Syllables"](t)||a.u.Hiragana(t)||a.u.Katakana(t))}_tinySDF(t,n,o){const c=this.localIdeographFontFamily;if(!c||!this._doesCharSupportLocalGlyph(o))return;let d=t.tinySDF;if(!d){let y="400";/bold/i.test(n)?y="900":/medium/i.test(n)?y="500":/light/i.test(n)&&(y="200"),d=t.tinySDF=new Bt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:c,fontWeight:y})}const _=d.draw(String.fromCharCode(o));return{id:o,bitmap:new a.q({width:_.width||60,height:_.height||60},_.data),metrics:{width:_.glyphWidth/2||24,height:_.glyphHeight/2||24,left:_.glyphLeft/2+.5||0,top:_.glyphTop/2-27.5||-8,advance:_.glyphAdvance/2||24,isDoubleResolution:!0}}}}Bt.loadGlyphRange=function(u,t,n,o,c){const d=256*t,_=d+255,y=o.transformRequest(n.replace("{fontstack}",u).replace("{range}",`${d}-${_}`),ze.Glyphs);a.l(y,(x,C)=>{if(x)c(x);else if(C){const E={};for(const P of a.n(C))E[P.id]=P;c(null,E)}})},Bt.TinySDF=class{constructor({fontSize:u=24,buffer:t=3,radius:n=8,cutoff:o=.25,fontFamily:c="sans-serif",fontWeight:d="normal",fontStyle:_="normal"}={}){this.buffer=t,this.cutoff=o,this.radius=n;const y=this.size=u+4*t,x=this._createCanvas(y),C=this.ctx=x.getContext("2d",{willReadFrequently:!0});C.font=`${_} ${d} ${u}px ${c}`,C.textBaseline="alphabetic",C.textAlign="left",C.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(u){const t=document.createElement("canvas");return t.width=t.height=u,t}draw(u){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:o,actualBoundingBoxLeft:c,actualBoundingBoxRight:d}=this.ctx.measureText(u),_=Math.ceil(n),y=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(d-c))),x=Math.min(this.size-this.buffer,_+Math.ceil(o)),C=y+2*this.buffer,E=x+2*this.buffer,P=Math.max(C*E,0),L=new Uint8ClampedArray(P),U={data:L,width:C,height:E,glyphWidth:y,glyphHeight:x,glyphTop:_,glyphLeft:0,glyphAdvance:t};if(y===0||x===0)return U;const{ctx:V,buffer:G,gridInner:N,gridOuter:re}=this;V.clearRect(G,G,y,x),V.fillText(u,G,G+_);const he=V.getImageData(G,G,y,x);re.fill(Pt,0,P),N.fill(0,0,P);for(let J=0;J<x;J++)for(let se=0;se<y;se++){const pe=he.data[4*(J*y+se)+3]/255;if(pe===0)continue;const fe=(J+G)*C+se+G;if(pe===1)re[fe]=0,N[fe]=Pt;else{const be=.5-pe;re[fe]=be>0?be*be:0,N[fe]=be<0?be*be:0}}gt(re,0,0,C,E,C,this.f,this.v,this.z),gt(N,G,G,y,x,C,this.f,this.v,this.z);for(let J=0;J<P;J++){const se=Math.sqrt(re[J])-Math.sqrt(N[J]);L[J]=Math.round(255-255*(se/this.radius+this.cutoff))}return U}};class ft{constructor(){this.specification=a.v.light.position}possiblyEvaluate(t,n){return a.z(t.expression.evaluate(n))}interpolate(t,n,o){return{x:a.B.number(t.x,n.x,o),y:a.B.number(t.y,n.y,o),z:a.B.number(t.z,n.z,o)}}}let si;class Mi extends a.E{constructor(t){super(),si=si||new a.r({anchor:new a.D(a.v.light.anchor),position:new ft,color:new a.D(a.v.light.color),intensity:new a.D(a.v.light.intensity)}),this._transitionable=new a.T(si),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,n={}){if(!this._validate(a.t,t,n))for(const o in t){const c=t[o];o.endsWith("-transition")?this._transitionable.setTransition(o.slice(0,-11),c):this._transitionable.setValue(o,c)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,o){return(!o||o.validate!==!1)&&a.x(this,t.call(a.y,a.e({value:n,style:{glyphs:!0,sprite:!0},styleSpec:a.v})))}}class Ki{constructor(t,n){this.width=t,this.height=n,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,n){const o=t.join(",")+String(n);return this.dashEntry[o]||(this.dashEntry[o]=this.addDash(t,n)),this.dashEntry[o]}getDashRanges(t,n,o){const c=[];let d=t.length%2==1?-t[t.length-1]*o:0,_=t[0]*o,y=!0;c.push({left:d,right:_,isDash:y,zeroLength:t[0]===0});let x=t[0];for(let C=1;C<t.length;C++){y=!y;const E=t[C];d=x*o,x+=E,_=x*o,c.push({left:d,right:_,isDash:y,zeroLength:E===0})}return c}addRoundDash(t,n,o){const c=n/2;for(let d=-o;d<=o;d++){const _=this.width*(this.nextRow+o+d);let y=0,x=t[y];for(let C=0;C<this.width;C++){C/x.right>1&&(x=t[++y]);const E=Math.abs(C-x.left),P=Math.abs(C-x.right),L=Math.min(E,P);let U;const V=d/o*(c+1);if(x.isDash){const G=c-Math.abs(V);U=Math.sqrt(L*L+G*G)}else U=c-Math.sqrt(L*L+V*V);this.data[_+C]=Math.max(0,Math.min(255,U+128))}}}addRegularDash(t){for(let y=t.length-1;y>=0;--y){const x=t[y],C=t[y+1];x.zeroLength?t.splice(y,1):C&&C.isDash===x.isDash&&(C.left=x.left,t.splice(y,1))}const n=t[0],o=t[t.length-1];n.isDash===o.isDash&&(n.left=o.left-this.width,o.right=n.right+this.width);const c=this.width*this.nextRow;let d=0,_=t[d];for(let y=0;y<this.width;y++){y/_.right>1&&(_=t[++d]);const x=Math.abs(y-_.left),C=Math.abs(y-_.right),E=Math.min(x,C);this.data[c+y]=Math.max(0,Math.min(255,(_.isDash?E:-E)+128))}}addDash(t,n){const o=n?7:0,c=2*o+1;if(this.nextRow+c>this.height)return a.w("LineAtlas out of space"),null;let d=0;for(let y=0;y<t.length;y++)d+=t[y];if(d!==0){const y=this.width/d,x=this.getDashRanges(t,this.width,y);n?this.addRoundDash(x,y,o):this.addRegularDash(x)}const _={y:(this.nextRow+o+.5)/this.height,height:2*o/this.height,width:d};return this.nextRow+=c,this.dirty=!0,_}bind(t){const n=t.gl;this.texture?(n.bindTexture(n.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,n.texSubImage2D(n.TEXTURE_2D,0,0,0,this.width,this.height,n.ALPHA,n.UNSIGNED_BYTE,this.data))):(this.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texImage2D(n.TEXTURE_2D,0,n.ALPHA,this.width,this.height,0,n.ALPHA,n.UNSIGNED_BYTE,this.data))}}class ai{constructor(t,n,o){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=o;const c=this.workerPool.acquire(o);for(let d=0;d<c.length;d++){const _=new a.C(c[d],n,o);_.name=`Worker ${d}`,this.actors.push(_)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,n,o){a.o(this.actors,(c,d)=>{c.send(t,n,d)},o=o||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(n=>{n.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}}function Kt(u,t,n){const o=function(c,d){if(c)return n(c);if(d){const _=a.F(a.e(d,u),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);d.vector_layers&&(_.vectorLayers=d.vector_layers,_.vectorLayerIds=_.vectorLayers.map(y=>y.id)),n(null,_)}};return u.url?a.f(t.transformRequest(u.url,ze.Source),o):a.h.frame(()=>o(null,u))}class Ze{constructor(t,n){t&&(n?this.setSouthWest(t).setNorthEast(n):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof a.L?new a.L(t.lng,t.lat):a.L.convert(t),this}setSouthWest(t){return this._sw=t instanceof a.L?new a.L(t.lng,t.lat):a.L.convert(t),this}extend(t){const n=this._sw,o=this._ne;let c,d;if(t instanceof a.L)c=t,d=t;else{if(!(t instanceof Ze))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Ze.convert(t)):this.extend(a.L.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(a.L.convert(t)):this;if(c=t._sw,d=t._ne,!c||!d)return this}return n||o?(n.lng=Math.min(c.lng,n.lng),n.lat=Math.min(c.lat,n.lat),o.lng=Math.max(d.lng,o.lng),o.lat=Math.max(d.lat,o.lat)):(this._sw=new a.L(c.lng,c.lat),this._ne=new a.L(d.lng,d.lat)),this}getCenter(){return new a.L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new a.L(this.getWest(),this.getNorth())}getSouthEast(){return new a.L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:n,lat:o}=a.L.convert(t);let c=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&c}static convert(t){return t instanceof Ze?t:t&&new Ze(t)}static fromLngLat(t,n=0){const o=360*n/40075017,c=o/Math.cos(Math.PI/180*t.lat);return new Ze(new a.L(t.lng-c,t.lat-o),new a.L(t.lng+c,t.lat+o))}}class yt{constructor(t,n,o){this.bounds=Ze.convert(this.validateBounds(t)),this.minzoom=n||0,this.maxzoom=o||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const n=Math.pow(2,t.z),o=Math.floor(a.G(this.bounds.getWest())*n),c=Math.floor(a.H(this.bounds.getNorth())*n),d=Math.ceil(a.G(this.bounds.getEast())*n),_=Math.ceil(a.H(this.bounds.getSouth())*n);return t.x>=o&&t.x<d&&t.y>=c&&t.y<_}}class Jt extends a.E{constructor(t,n,o,c){if(super(),this.load=()=>{this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Kt(this._options,this.map._requestManager,(d,_)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),d?this.fire(new a.j(d)):_&&(a.e(this,_),_.bounds&&(this.tileBounds=new yt(_.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>a.e({},this._options),this.id=t,this.dispatcher=o,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.e(this,a.F(n,["url","scheme","tileSize","promoteId"])),this._options=a.e({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(c)}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(t,n){const o=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c={request:this.map._requestManager.transformRequest(o,ze.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function d(_,y){return delete t.request,t.aborted?n(null):_&&_.status!==404?n(_):(y&&y.resourceTiming&&(t.resourceTiming=y.resourceTiming),this.map._refreshExpiredTiles&&y&&t.setExpiryData(y),t.loadVectorData(y,this.map.painter),n(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}c.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired"?t.state==="loading"?t.reloadCallback=n:t.request=t.actor.send("reloadTile",c,d.bind(this)):(t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",c,d.bind(this)))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Mt extends a.E{constructor(t,n,o,c){super(),this.id=t,this.dispatcher=o,this.setEventedParent(c),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.e({type:"raster"},n),a.e(this,a.F(n,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Kt(this._options,this.map._requestManager,(t,n)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new a.j(t)):n&&(a.e(this,n),n.bounds&&(this.tileBounds=new yt(n.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}serialize(){return a.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,n){const o=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.request=Me.getImage(this.map._requestManager.transformRequest(o,ze.Tile),(c,d,_)=>{if(delete t.request,t.aborted)t.state="unloaded",n(null);else if(c)t.state="errored",n(c);else if(d){this.map._refreshExpiredTiles&&_&&t.setExpiryData(_);const y=this.map.painter.context,x=y.gl;t.texture=this.map.painter.getTileTexture(d.width),t.texture?t.texture.update(d,{useMipmap:!0}):(t.texture=new De(y,d,x.RGBA,{useMipmap:!0}),t.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE,x.LINEAR_MIPMAP_NEAREST),y.extTextureFilterAnisotropic&&x.texParameterf(x.TEXTURE_2D,y.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,y.extTextureFilterAnisotropicMax)),t.state="loaded",n(null)}},this.map._refreshExpiredTiles)}abortTile(t,n){t.request&&(t.request.cancel(),delete t.request),n()}unloadTile(t,n){t.texture&&this.map.painter.saveTileTexture(t.texture),n()}hasTransition(){return!1}}class Yt extends Mt{constructor(t,n,o,c){super(t,n,o,c),this.type="raster-dem",this.maxzoom=22,this._options=a.e({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox",this.redFactor=n.redFactor,this.greenFactor=n.greenFactor,this.blueFactor=n.blueFactor,this.baseShift=n.baseShift}loadTile(t,n){const o=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c=this.map._requestManager.transformRequest(o,ze.Tile);function d(_,y){_&&(t.state="errored",n(_)),y&&(t.dem=y,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded",n(null))}t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.request=Me.getImage(c,(_,y,x)=>a._(this,void 0,void 0,function*(){if(delete t.request,t.aborted)t.state="unloaded",n(null);else if(_)t.state="errored",n(_);else if(y){this.map._refreshExpiredTiles&&t.setExpiryData(x);const C=a.a(y)&&a.J()?y:yield function(P){return a._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&a.K()){const L=P.width+2,U=P.height+2;try{return new a.R({width:L,height:U},yield a.M(P,-1,-1,L,U))}catch{}}return a.h.getImageData(P,1)})}(y),E={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:C,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};t.actor&&t.state!=="expired"||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",E,d))}}),this.map._refreshExpiredTiles)}_getNeighboringTiles(t){const n=t.canonical,o=Math.pow(2,n.z),c=(n.x-1+o)%o,d=n.x===0?t.wrap-1:t.wrap,_=(n.x+1+o)%o,y=n.x+1===o?t.wrap+1:t.wrap,x={};return x[new a.O(t.overscaledZ,d,n.z,c,n.y).key]={backfilled:!1},x[new a.O(t.overscaledZ,y,n.z,_,n.y).key]={backfilled:!1},n.y>0&&(x[new a.O(t.overscaledZ,d,n.z,c,n.y-1).key]={backfilled:!1},x[new a.O(t.overscaledZ,t.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},x[new a.O(t.overscaledZ,y,n.z,_,n.y-1).key]={backfilled:!1}),n.y+1<o&&(x[new a.O(t.overscaledZ,d,n.z,c,n.y+1).key]={backfilled:!1},x[new a.O(t.overscaledZ,t.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},x[new a.O(t.overscaledZ,y,n.z,_,n.y+1).key]={backfilled:!1}),x}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})}}class gi extends a.E{constructor(t,n,o,c){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>a.e({},this._options,{type:this.type,data:this._data}),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=o.getActor(),this.setEventedParent(c),this._data=n.data,this._options=a.e({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const d=a.N/this.tileSize;this.workerOptions=a.e({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*d,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*d,extent:a.N,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:a.N,radius:(n.clusterRadius||50)*d,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=t.clusterRadius),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=t.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(t,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},n),this}getClusterChildren(t,n){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},n),this}getClusterLeaves(t,n,o,c){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:n,offset:o},c),this}_updateWorkerData(t){const n=a.e({},this.workerOptions);t?n.dataDiff=t:typeof this._data=="string"?(n.request=this.map._requestManager.transformRequest(a.h.resolveURL(this._data),ze.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new a.k("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,n,(o,c)=>{if(this._pendingLoads--,this._removed||c&&c.abandoned)return void this.fire(new a.k("dataabort",{dataType:"source"}));let d=null;if(c&&c.resourceTiming&&c.resourceTiming[this.id]&&(d=c.resourceTiming[this.id].slice(0)),o)return void this.fire(new a.j(o));const _={dataType:"source"};this._collectResourceTiming&&d&&d.length>0&&a.e(_,{resourceTiming:d}),this.fire(new a.k("data",Object.assign(Object.assign({},_),{sourceDataType:"metadata"}))),this.fire(new a.k("data",Object.assign(Object.assign({},_),{sourceDataType:"content"})))})}loaded(){return this._pendingLoads===0}loadTile(t,n){const o=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const c={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.request=this.actor.send(o,c,(d,_)=>(delete t.request,t.unloadVectorData(),t.aborted?n(null):d?n(d):(t.loadVectorData(_,this.map.painter,o==="reloadTile"),n(null))))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var Qt=a.Q([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Rt extends a.E{constructor(t,n,o,c){super(),this.load=(d,_)=>{this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=Me.getImage(this.map._requestManager.transformRequest(this.url,ze.Image),(y,x)=>{this._request=null,this._loaded=!0,y?this.fire(new a.j(y)):x&&(this.image=x,d&&(this.coordinates=d),_&&_(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;const d=this.map.painter.context,_=d.gl;this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,Qt.members)),this.boundsSegments||(this.boundsSegments=a.S.simpleSegment(0,0,4,2)),this.texture||(this.texture=new De(d,this.image,_.RGBA),this.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE));let y=!1;for(const x in this.tiles){const C=this.tiles[x];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture,y=!0)}y&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=t,this.dispatcher=o,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(c),this.options=n}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(t){this.coordinates=t;const n=t.map(a.U.fromLngLat);this.tileID=function(c){let d=1/0,_=1/0,y=-1/0,x=-1/0;for(const L of c)d=Math.min(d,L.x),_=Math.min(_,L.y),y=Math.max(y,L.x),x=Math.max(x,L.y);const C=Math.max(y-d,x-_),E=Math.max(0,Math.floor(-Math.log(C)/Math.LN2)),P=Math.pow(2,E);return new a.W(E,Math.floor((d+y)/2*P),Math.floor((_+x)/2*P))}(n),this.minzoom=this.maxzoom=this.tileID.z;const o=n.map(c=>this.tileID.getTilePoint(c)._round());return this._boundsArray=new a.V,this._boundsArray.emplaceBack(o[0].x,o[0].y,0,0),this._boundsArray.emplaceBack(o[1].x,o[1].y,a.N,0),this._boundsArray.emplaceBack(o[3].x,o[3].y,0,a.N),this._boundsArray.emplaceBack(o[2].x,o[2].y,a.N,a.N),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(t,n){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},n(null)):(t.state="errored",n(null))}hasTransition(){return!1}}class ki extends Rt{constructor(t,n,o,c){super(t,n,o,c),this.load=()=>{this._loaded=!1;const d=this.options;this.urls=[];for(const _ of d.urls)this.urls.push(this.map._requestManager.transformRequest(_,ze.Source).url);a.X(this.urls,(_,y)=>{this._loaded=!0,_?this.fire(new a.j(_)):y&&(this.video=y,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const d=this.map.painter.context,_=d.gl;this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,Qt.members)),this.boundsSegments||(this.boundsSegments=a.S.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE),_.texSubImage2D(_.TEXTURE_2D,0,0,0,_.RGBA,_.UNSIGNED_BYTE,this.video)):(this.texture=new De(d,this.video,_.RGBA),this.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE));let y=!1;for(const x in this.tiles){const C=this.tiles[x];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture,y=!0)}y&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=n}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const n=this.video.seekable;t<n.start(0)||t>n.end(0)?this.fire(new a.j(new a.Y(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class bi extends Rt{constructor(t,n,o,c){super(t,n,o,c),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const _=this.map.painter.context,y=_.gl;this.boundsBuffer||(this.boundsBuffer=_.createVertexBuffer(this._boundsArray,Qt.members)),this.boundsSegments||(this.boundsSegments=a.S.simpleSegment(0,0,4,2)),this.texture?(d||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new De(_,this.canvas,y.RGBA,{premultiply:!0});let x=!1;for(const C in this.tiles){const E=this.tiles[C];E.state!=="loaded"&&(E.state="loaded",E.texture=this.texture,x=!0)}x&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(d=>!Array.isArray(d)||d.length!==2||d.some(_=>typeof _!="number"))||this.fire(new a.j(new a.Y(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.j(new a.Y(`sources.${t}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new a.j(new a.Y(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new a.j(new a.Y(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.j(new a.Y(`sources.${t}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const Xt={},Ti=u=>{switch(u){case"geojson":return gi;case"image":return Rt;case"raster":return Mt;case"raster-dem":return Yt;case"vector":return Jt;case"video":return ki;case"canvas":return bi}return Xt[u]};function nr(u,t){const n=a.Z();return a.$(n,n,[1,1,0]),a.a0(n,n,[.5*u.width,.5*u.height,1]),a.a1(n,n,u.calculatePosMatrix(t.toUnwrapped()))}function fr(u,t,n,o,c,d){const _=function(P,L,U){if(P)for(const V of P){const G=L[V];if(G&&G.source===U&&G.type==="fill-extrusion")return!0}else for(const V in L){const G=L[V];if(G.source===U&&G.type==="fill-extrusion")return!0}return!1}(c&&c.layers,t,u.id),y=d.maxPitchScaleFactor(),x=u.tilesIn(o,y,_);x.sort(sr);const C=[];for(const P of x)C.push({wrappedTileID:P.tileID.wrapped().key,queryResults:P.tile.queryRenderedFeatures(t,n,u._state,P.queryGeometry,P.cameraQueryGeometry,P.scale,c,d,y,nr(u.transform,P.tileID))});const E=function(P){const L={},U={};for(const V of P){const G=V.queryResults,N=V.wrappedTileID,re=U[N]=U[N]||{};for(const he in G){const J=G[he],se=re[he]=re[he]||{},pe=L[he]=L[he]||[];for(const fe of J)se[fe.featureIndex]||(se[fe.featureIndex]=!0,pe.push(fe))}}return L}(C);for(const P in E)E[P].forEach(L=>{const U=L.feature,V=u.getFeatureState(U.layer["source-layer"],U.id);U.source=U.layer.source,U.layer["source-layer"]&&(U.sourceLayer=U.layer["source-layer"]),U.state=V});return E}function sr(u,t){const n=u.tileID,o=t.tileID;return n.overscaledZ-o.overscaledZ||n.canonical.y-o.canonical.y||n.wrap-o.wrap||n.canonical.x-o.canonical.x}class mr{constructor(t,n){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=a.a2(),this.uses=0,this.tileSize=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const n=t+this.timeAdded;n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,n,o){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(c,d){const _={};if(!d)return _;for(const y of c){const x=y.layerIds.map(C=>d.getLayer(C)).filter(Boolean);if(x.length!==0){y.layers=x,y.stateDependentLayerIds&&(y.stateDependentLayers=y.stateDependentLayerIds.map(C=>x.filter(E=>E.id===C)[0]));for(const C of x)_[C.id]=y}}return _}(t.buckets,n.style),this.hasSymbolBuckets=!1;for(const c in this.buckets){const d=this.buckets[c];if(d instanceof a.a4){if(this.hasSymbolBuckets=!0,!o)break;d.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const c in this.buckets){const d=this.buckets[c];if(d instanceof a.a4&&d.hasRTLText){this.hasRTLText=!0,a.a5();break}}this.queryPadding=0;for(const c in this.buckets){const d=this.buckets[c];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(c).queryRadius(d))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new a.a3}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const o in this.buckets){const c=this.buckets[o];c.uploadPending()&&c.upload(t)}const n=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new De(t,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new De(t,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,n,o,c,d,_,y,x,C,E){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:c,cameraQueryGeometry:d,scale:_,tileSize:this.tileSize,pixelPosMatrix:E,transform:x,params:y,queryPadding:this.queryPadding*C},t,n,o):{}}querySourceFeatures(t,n){const o=this.latestFeatureIndex;if(!o||!o.rawTileData)return;const c=o.loadVTLayers(),d=n&&n.sourceLayer?n.sourceLayer:"",_=c._geojsonTileLayer||c[d];if(!_)return;const y=a.a6(n&&n.filter),{z:x,x:C,y:E}=this.tileID.canonical,P={z:x,x:C,y:E};for(let L=0;L<_.length;L++){const U=_.feature(L);if(y.needGeometry){const N=a.a7(U,!0);if(!y.filter(new a.a8(this.tileID.overscaledZ),N,this.tileID.canonical))continue}else if(!y.filter(new a.a8(this.tileID.overscaledZ),U))continue;const V=o.getId(U,d),G=new a.a9(U,x,C,E,V);G.tile=P,t.push(G)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const n=this.expirationTime;if(t.cacheControl){const o=a.aa(t.cacheControl);o["max-age"]&&(this.expirationTime=Date.now()+1e3*o["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const o=Date.now();let c=!1;if(this.expirationTime>o)c=!1;else if(n)if(this.expirationTime<n)c=!0;else{const d=this.expirationTime-n;d?this.expirationTime=o+Math.max(d,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const o=this.latestFeatureIndex.loadVTLayers();for(const c in this.buckets){if(!n.style.hasLayer(c))continue;const d=this.buckets[c],_=d.layers[0].sourceLayer||"_geojsonTileLayer",y=o[_],x=t[_];if(!y||!x||Object.keys(x).length===0)continue;d.update(x,y,this.imageAtlas&&this.imageAtlas.patternPositions||{});const C=n&&n.style&&n.style.getLayer(c);C&&(this.queryPadding=Math.max(this.queryPadding,C.queryRadius(d)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<a.h.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=a.h.now()+t}setDependencies(t,n){const o={};for(const c of n)o[c]=!0;this.dependencies[t]=o}hasDependency(t,n){for(const o of t){const c=this.dependencies[o];if(c){for(const d of n)if(c[d])return!0}}return!1}}class Cr{constructor(t,n){this.max=t,this.onRemove=n,this.reset()}reset(){for(const t in this.data)for(const n of this.data[t])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(t,n,o){const c=t.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);const d={value:n,timeout:void 0};if(o!==void 0&&(d.timeout=setTimeout(()=>{this.remove(t,d)},o)),this.data[c].push(d),this.order.push(c),this.order.length>this.max){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const n=this.data[t].shift();return n.timeout&&clearTimeout(n.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),n.value}getByKey(t){const n=this.data[t];return n?n[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,n){if(!this.has(t))return this;const o=t.wrapped().key,c=n===void 0?0:this.data[o].indexOf(n),d=this.data[o][c];return this.data[o].splice(c,1),d.timeout&&clearTimeout(d.timeout),this.data[o].length===0&&delete this.data[o],this.onRemove(d.value),this.order.splice(this.order.indexOf(o),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(t){const n=[];for(const o in this.data)for(const c of this.data[o])t(c.value)||n.push(c);for(const o of n)this.remove(o.value.tileID,o)}}class ge{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,n,o){const c=String(n);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][c]=this.stateChanges[t][c]||{},a.e(this.stateChanges[t][c],o),this.deletedStates[t]===null){this.deletedStates[t]={};for(const d in this.state[t])d!==c&&(this.deletedStates[t][d]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][c]===null){this.deletedStates[t][c]={};for(const d in this.state[t][c])o[d]||(this.deletedStates[t][c][d]=null)}else for(const d in o)this.deletedStates[t]&&this.deletedStates[t][c]&&this.deletedStates[t][c][d]===null&&delete this.deletedStates[t][c][d]}removeFeatureState(t,n,o){if(this.deletedStates[t]===null)return;const c=String(n);if(this.deletedStates[t]=this.deletedStates[t]||{},o&&n!==void 0)this.deletedStates[t][c]!==null&&(this.deletedStates[t][c]=this.deletedStates[t][c]||{},this.deletedStates[t][c][o]=null);else if(n!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][c])for(o in this.deletedStates[t][c]={},this.stateChanges[t][c])this.deletedStates[t][c][o]=null;else this.deletedStates[t][c]=null;else this.deletedStates[t]=null}getState(t,n){const o=String(n),c=a.e({},(this.state[t]||{})[o],(this.stateChanges[t]||{})[o]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const d=this.deletedStates[t][n];if(d===null)return{};for(const _ in d)delete c[_]}return c}initializeTileState(t,n){t.setFeatureState(this.state,n)}coalesceChanges(t,n){const o={};for(const c in this.stateChanges){this.state[c]=this.state[c]||{};const d={};for(const _ in this.stateChanges[c])this.state[c][_]||(this.state[c][_]={}),a.e(this.state[c][_],this.stateChanges[c][_]),d[_]=this.state[c][_];o[c]=d}for(const c in this.deletedStates){this.state[c]=this.state[c]||{};const d={};if(this.deletedStates[c]===null)for(const _ in this.state[c])d[_]={},this.state[c][_]={};else for(const _ in this.deletedStates[c]){if(this.deletedStates[c][_]===null)this.state[c][_]={};else for(const y of Object.keys(this.deletedStates[c][_]))delete this.state[c][_][y];d[_]=this.state[c][_]}o[c]=o[c]||{},a.e(o[c],d)}if(this.stateChanges={},this.deletedStates={},Object.keys(o).length!==0)for(const c in t)t[c].setFeatureState(o,n)}}class Ii extends a.E{constructor(t,n,o){super(),this.id=t,this.dispatcher=o,this.on("data",c=>{c.dataType==="source"&&c.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&c.dataType==="source"&&c.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((c,d,_,y)=>{const x=new(Ti(d.type))(c,d,_,y);if(x.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${x.id}`);return x})(t,n,o,this),this._tiles={},this._cache=new Cr(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new ge,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const n=this._tiles[t];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,n){return this._source.loadTile(t,n)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){this._source.abortTile&&this._source.abortTile(t,()=>{}),this._source.fire(new a.k("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const o=this._tiles[n];o.upload(t),o.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(ji).map(t=>t.key)}getRenderableIds(t){const n=[];for(const o in this._tiles)this._isIdRenderable(o,t)&&n.push(this._tiles[o]);return t?n.sort((o,c)=>{const d=o.tileID,_=c.tileID,y=new a.P(d.canonical.x,d.canonical.y)._rotate(this.transform.angle),x=new a.P(_.canonical.x,_.canonical.y)._rotate(this.transform.angle);return d.overscaledZ-_.overscaledZ||x.y-y.y||x.x-y.x}).map(o=>o.tileID.key):n.map(o=>o.tileID).sort(ji).map(o=>o.key)}hasRenderableParent(t){const n=this.findLoadedParent(t,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(t,n){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(n||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,n){const o=this._tiles[t];o&&(o.state!=="loading"&&(o.state=n),this._loadTile(o,this._tileLoaded.bind(this,o,t,n)))}_tileLoaded(t,n,o,c){if(c)return t.state="errored",void(c.status!==404?this._source.fire(new a.j(c,{tile:t})):this.update(this.transform,this.terrain));t.timeAdded=a.h.now(),o==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(n,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new a.k("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const n=this.getRenderableIds();for(let c=0;c<n.length;c++){const d=n[c];if(t.neighboringTiles&&t.neighboringTiles[d]){const _=this.getTileByID(d);o(t,_),o(_,t)}}function o(c,d){c.needsHillshadePrepare=!0,c.needsTerrainPrepare=!0;let _=d.tileID.canonical.x-c.tileID.canonical.x;const y=d.tileID.canonical.y-c.tileID.canonical.y,x=Math.pow(2,c.tileID.canonical.z),C=d.tileID.key;_===0&&y===0||Math.abs(y)>1||(Math.abs(_)>1&&(Math.abs(_+x)===1?_+=x:Math.abs(_-x)===1&&(_-=x)),d.dem&&c.dem&&(c.dem.backfillBorder(d.dem,_,y),c.neighboringTiles&&c.neighboringTiles[C]&&(c.neighboringTiles[C].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,n,o,c){for(const d in this._tiles){let _=this._tiles[d];if(c[d]||!_.hasData()||_.tileID.overscaledZ<=n||_.tileID.overscaledZ>o)continue;let y=_.tileID;for(;_&&_.tileID.overscaledZ>n+1;){const C=_.tileID.scaledTo(_.tileID.overscaledZ-1);_=this._tiles[C.key],_&&_.hasData()&&(y=C)}let x=y;for(;x.overscaledZ>n;)if(x=x.scaledTo(x.overscaledZ-1),t[x.key]){c[y.key]=y;break}}}findLoadedParent(t,n){if(t.key in this._loadedParentTiles){const o=this._loadedParentTiles[t.key];return o&&o.tileID.overscaledZ>=n?o:null}for(let o=t.overscaledZ-1;o>=n;o--){const c=t.scaledTo(o),d=this._getLoadedTile(c);if(d)return d}}_getLoadedTile(t){const n=this._tiles[t.key];return n&&n.hasData()?n:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const n=Math.ceil(t.width/this._source.tileSize)+1,o=Math.ceil(t.height/this._source.tileSize)+1,c=Math.floor(n*o*(this._maxTileCacheZoomLevels===null?a.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),d=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,c):c;this._cache.setMaxSize(d)}handleWrapJump(t){const n=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,n){const o={};for(const c in this._tiles){const d=this._tiles[c];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+n),o[d.tileID.key]=d}this._tiles=o;for(const c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(const c in this._tiles)this._setTileReloadTimer(c,this._tiles[c])}}update(t,n){if(this.transform=t,this.terrain=n,!this._sourceLoaded||this._paused)return;let o;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?o=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(E=>new a.O(E.canonical.z,E.wrap,E.canonical.z,E.canonical.x,E.canonical.y)):(o=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:n}),this._source.hasTile&&(o=o.filter(E=>this._source.hasTile(E)))):o=[];const c=t.coveringZoomLevel(this._source),d=Math.max(c-Ii.maxOverzooming,this._source.minzoom),_=Math.max(c+Ii.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const E={};for(const P of o)if(P.canonical.z>this._source.minzoom){const L=P.scaledTo(P.canonical.z-1);E[L.key]=L;const U=P.scaledTo(Math.max(this._source.minzoom,Math.min(P.canonical.z,5)));E[U.key]=U}o=o.concat(Object.values(E))}const y=o.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,y&&this.fire(new a.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const x=this._updateRetainedTiles(o,c);if(jt(this._source.type)){const E={},P={},L=Object.keys(x),U=a.h.now();for(const V of L){const G=x[V],N=this._tiles[V];if(!N||N.fadeEndTime!==0&&N.fadeEndTime<=U)continue;const re=this.findLoadedParent(G,d);re&&(this._addTile(re.tileID),E[re.tileID.key]=re.tileID),P[V]=G}this._retainLoadedChildren(P,c,_,x);for(const V in E)x[V]||(this._coveredTiles[V]=!0,x[V]=E[V]);if(n){const V={},G={};for(const N of o)this._tiles[N.key].hasData()?V[N.key]=N:G[N.key]=N;for(const N in G){const re=G[N].children(this._source.maxzoom);this._tiles[re[0].key]&&this._tiles[re[1].key]&&this._tiles[re[2].key]&&this._tiles[re[3].key]&&(V[re[0].key]=x[re[0].key]=re[0],V[re[1].key]=x[re[1].key]=re[1],V[re[2].key]=x[re[2].key]=re[2],V[re[3].key]=x[re[3].key]=re[3],delete G[N])}for(const N in G){const re=this.findLoadedParent(G[N],this._source.minzoom);if(re){V[re.tileID.key]=x[re.tileID.key]=re.tileID;for(const he in V)V[he].isChildOf(re.tileID)&&delete V[he]}}for(const N in this._tiles)V[N]||(this._coveredTiles[N]=!0)}}for(const E in x)this._tiles[E].clearFadeHold();const C=a.ab(this._tiles,x);for(const E of C){const P=this._tiles[E];P.hasSymbolBuckets&&!P.holdingForFade()?P.setHoldDuration(this.map._fadeDuration):P.hasSymbolBuckets&&!P.symbolFadeFinished()||this._removeTile(E)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,n){const o={},c={},d=Math.max(n-Ii.maxOverzooming,this._source.minzoom),_=Math.max(n+Ii.maxUnderzooming,this._source.minzoom),y={};for(const x of t){const C=this._addTile(x);o[x.key]=x,C.hasData()||n<this._source.maxzoom&&(y[x.key]=x)}this._retainLoadedChildren(y,n,_,o);for(const x of t){let C=this._tiles[x.key];if(C.hasData())continue;if(n+1>this._source.maxzoom){const P=x.children(this._source.maxzoom)[0],L=this.getTile(P);if(L&&L.hasData()){o[P.key]=P;continue}}else{const P=x.children(this._source.maxzoom);if(o[P[0].key]&&o[P[1].key]&&o[P[2].key]&&o[P[3].key])continue}let E=C.wasRequested();for(let P=x.overscaledZ-1;P>=d;--P){const L=x.scaledTo(P);if(c[L.key])break;if(c[L.key]=!0,C=this.getTile(L),!C&&E&&(C=this._addTile(L)),C){const U=C.hasData();if((E||U)&&(o[L.key]=L),E=C.wasRequested(),U)break}}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const n=[];let o,c=this._tiles[t].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){o=this._loadedParentTiles[c.key];break}n.push(c.key);const d=c.scaledTo(c.overscaledZ-1);if(o=this._getLoadedTile(d),o)break;c=d}for(const d of n)this._loadedParentTiles[d]=o}}_addTile(t){let n=this._tiles[t.key];if(n)return n;n=this._cache.getAndRemove(t),n&&(this._setTileReloadTimer(t.key,n),n.tileID=t,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,n)));const o=n;return n||(n=new mr(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(n,this._tileLoaded.bind(this,n,t.key,n.state))),n.uses++,this._tiles[t.key]=n,o||this._source.fire(new a.k("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(t,n){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const o=n.getExpiryTimeout();o&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},o))}_removeTile(t){const n=this._tiles[t];n&&(n.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,n,o){const c=[],d=this.transform;if(!d)return c;const _=o?d.getCameraQueryGeometry(t):t,y=t.map(V=>d.pointCoordinate(V,this.terrain)),x=_.map(V=>d.pointCoordinate(V,this.terrain)),C=this.getIds();let E=1/0,P=1/0,L=-1/0,U=-1/0;for(const V of x)E=Math.min(E,V.x),P=Math.min(P,V.y),L=Math.max(L,V.x),U=Math.max(U,V.y);for(let V=0;V<C.length;V++){const G=this._tiles[C[V]];if(G.holdingForFade())continue;const N=G.tileID,re=Math.pow(2,d.zoom-G.tileID.overscaledZ),he=n*G.queryPadding*a.N/G.tileSize/re,J=[N.getTilePoint(new a.U(E,P)),N.getTilePoint(new a.U(L,U))];if(J[0].x-he<a.N&&J[0].y-he<a.N&&J[1].x+he>=0&&J[1].y+he>=0){const se=y.map(fe=>N.getTilePoint(fe)),pe=x.map(fe=>N.getTilePoint(fe));c.push({tile:G,tileID:N,queryGeometry:se,cameraQueryGeometry:pe,scale:re})}}return c}getVisibleCoordinates(t){const n=this.getRenderableIds(t).map(o=>this._tiles[o].tileID);for(const o of n)o.posMatrix=this.transform.calculatePosMatrix(o.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(jt(this._source.type)){const t=a.h.now();for(const n in this._tiles)if(this._tiles[n].fadeEndTime>=t)return!0}return!1}setFeatureState(t,n,o){this._state.updateState(t=t||"_geojsonTileLayer",n,o)}removeFeatureState(t,n,o){this._state.removeFeatureState(t=t||"_geojsonTileLayer",n,o)}getFeatureState(t,n){return this._state.getState(t=t||"_geojsonTileLayer",n)}setDependencies(t,n,o){const c=this._tiles[t];c&&c.setDependencies(n,o)}reloadTilesForDependencies(t,n){for(const o in this._tiles)this._tiles[o].hasDependency(t,n)&&this._reloadTile(o,"reloading");this._cache.filter(o=>!o.hasDependency(t,n))}}function ji(u,t){const n=Math.abs(2*u.wrap)-+(u.wrap<0),o=Math.abs(2*t.wrap)-+(t.wrap<0);return u.overscaledZ-t.overscaledZ||o-n||t.canonical.y-u.canonical.y||t.canonical.x-u.canonical.x}function jt(u){return u==="raster"||u==="image"||u==="video"}Ii.maxOverzooming=10,Ii.maxUnderzooming=3;const kt="mapboxgl_preloaded_worker_pool";class qi{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<qi.workerCount;)this.workers.push(new Worker(a.c.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[kt]}numActive(){return Object.keys(this.active).length}}const Ji=Math.floor(a.h.hardwareConcurrency/2);let ar;function Tn(){return ar||(ar=new qi),ar}qi.workerCount=a.ac(globalThis)?Math.max(Math.min(Ji,3),1):1;class In{constructor(t,n){this.reset(t,n)}reset(t,n){this.points=t||[],this._distances=[0];for(let o=1;o<this.points.length;o++)this._distances[o]=this._distances[o-1]+this.points[o].dist(this.points[o-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=a.ad(t,0,1);let n=1,o=this._distances[n];const c=t*this.paddedLength+this.padding;for(;o<c&&n<this._distances.length;)o=this._distances[++n];const d=n-1,_=this._distances[d],y=o-_,x=y>0?(c-_)/y:0;return this.points[d].mult(1-x).add(this.points[n].mult(x))}}function en(u,t){let n=!0;return u==="always"||u!=="never"&&t!=="never"||(n=!1),n}class En{constructor(t,n,o){const c=this.boxCells=[],d=this.circleCells=[];this.xCellCount=Math.ceil(t/o),this.yCellCount=Math.ceil(n/o);for(let _=0;_<this.xCellCount*this.yCellCount;_++)c.push([]),d.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=n,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,n,o,c,d){this._forEachCell(n,o,c,d,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(c),this.bboxes.push(d)}insertCircle(t,n,o,c){this._forEachCell(n-c,o-c,n+c,o+c,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(n),this.circles.push(o),this.circles.push(c)}_insertBoxCell(t,n,o,c,d,_){this.boxCells[d].push(_)}_insertCircleCell(t,n,o,c,d,_){this.circleCells[d].push(_)}_query(t,n,o,c,d,_,y){if(o<0||t>this.width||c<0||n>this.height)return[];const x=[];if(t<=0&&n<=0&&this.width<=o&&this.height<=c){if(d)return[{key:null,x1:t,y1:n,x2:o,y2:c}];for(let C=0;C<this.boxKeys.length;C++)x.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const E=this.circles[3*C],P=this.circles[3*C+1],L=this.circles[3*C+2];x.push({key:this.circleKeys[C],x1:E-L,y1:P-L,x2:E+L,y2:P+L})}}else this._forEachCell(t,n,o,c,this._queryCell,x,{hitTest:d,overlapMode:_,seenUids:{box:{},circle:{}}},y);return x}query(t,n,o,c){return this._query(t,n,o,c,!1,null)}hitTest(t,n,o,c,d,_){return this._query(t,n,o,c,!0,d,_).length>0}hitTestCircle(t,n,o,c,d){const _=t-o,y=t+o,x=n-o,C=n+o;if(y<0||_>this.width||C<0||x>this.height)return!1;const E=[];return this._forEachCell(_,x,y,C,this._queryCellCircle,E,{hitTest:!0,overlapMode:c,circle:{x:t,y:n,radius:o},seenUids:{box:{},circle:{}}},d),E.length>0}_queryCell(t,n,o,c,d,_,y,x){const{seenUids:C,hitTest:E,overlapMode:P}=y,L=this.boxCells[d];if(L!==null){const V=this.bboxes;for(const G of L)if(!C.box[G]){C.box[G]=!0;const N=4*G,re=this.boxKeys[G];if(t<=V[N+2]&&n<=V[N+3]&&o>=V[N+0]&&c>=V[N+1]&&(!x||x(re))&&(!E||!en(P,re.overlapMode))&&(_.push({key:re,x1:V[N],y1:V[N+1],x2:V[N+2],y2:V[N+3]}),E))return!0}}const U=this.circleCells[d];if(U!==null){const V=this.circles;for(const G of U)if(!C.circle[G]){C.circle[G]=!0;const N=3*G,re=this.circleKeys[G];if(this._circleAndRectCollide(V[N],V[N+1],V[N+2],t,n,o,c)&&(!x||x(re))&&(!E||!en(P,re.overlapMode))){const he=V[N],J=V[N+1],se=V[N+2];if(_.push({key:re,x1:he-se,y1:J-se,x2:he+se,y2:J+se}),E)return!0}}}return!1}_queryCellCircle(t,n,o,c,d,_,y,x){const{circle:C,seenUids:E,overlapMode:P}=y,L=this.boxCells[d];if(L!==null){const V=this.bboxes;for(const G of L)if(!E.box[G]){E.box[G]=!0;const N=4*G,re=this.boxKeys[G];if(this._circleAndRectCollide(C.x,C.y,C.radius,V[N+0],V[N+1],V[N+2],V[N+3])&&(!x||x(re))&&!en(P,re.overlapMode))return _.push(!0),!0}}const U=this.circleCells[d];if(U!==null){const V=this.circles;for(const G of U)if(!E.circle[G]){E.circle[G]=!0;const N=3*G,re=this.circleKeys[G];if(this._circlesCollide(V[N],V[N+1],V[N+2],C.x,C.y,C.radius)&&(!x||x(re))&&!en(P,re.overlapMode))return _.push(!0),!0}}}_forEachCell(t,n,o,c,d,_,y,x){const C=this._convertToXCellCoord(t),E=this._convertToYCellCoord(n),P=this._convertToXCellCoord(o),L=this._convertToYCellCoord(c);for(let U=C;U<=P;U++)for(let V=E;V<=L;V++)if(d.call(this,t,n,o,c,this.xCellCount*V+U,_,y,x))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,n,o,c,d,_){const y=c-t,x=d-n,C=o+_;return C*C>y*y+x*x}_circleAndRectCollide(t,n,o,c,d,_,y){const x=(_-c)/2,C=Math.abs(t-(c+x));if(C>x+o)return!1;const E=(y-d)/2,P=Math.abs(n-(d+E));if(P>E+o)return!1;if(C<=x||P<=E)return!0;const L=C-x,U=P-E;return L*L+U*U<=o*o}}function Re(u,t,n,o,c){const d=a.Z();return t?(a.a0(d,d,[1/c,1/c,1]),n||a.ae(d,d,o.angle)):a.a1(d,o.labelPlaneMatrix,u),d}function mt(u,t,n,o,c){if(t){const d=a.af(u);return a.a0(d,d,[c,c,1]),n||a.ae(d,d,-o.angle),d}return o.glCoordMatrix}function dt(u,t,n){let o;n?(o=[u.x,u.y,n(u.x,u.y),1],a.ag(o,o,t)):(o=[u.x,u.y,0,1],H(o,o,t));const c=o[3];return{point:new a.P(o[0]/c,o[1]/c),signedDistanceFromCamera:c}}function qt(u,t){return .5+u/t*.5}function wt(u,t){const n=u[0]/u[3],o=u[1]/u[3];return n>=-t[0]&&n<=t[0]&&o>=-t[1]&&o<=t[1]}function Te(u,t,n,o,c,d,_,y,x,C){const E=o?u.textSizeData:u.iconSizeData,P=a.ah(E,n.transform.zoom),L=[256/n.width*2+1,256/n.height*2+1],U=o?u.text.dynamicLayoutVertexArray:u.icon.dynamicLayoutVertexArray;U.clear();const V=u.lineVertexArray,G=o?u.text.placedSymbolArray:u.icon.placedSymbolArray,N=n.transform.width/n.transform.height;let re=!1;for(let he=0;he<G.length;he++){const J=G.get(he);if(J.hidden||J.writingMode===a.ai.vertical&&!re){$(J.numGlyphs,U);continue}let se;if(re=!1,C?(se=[J.anchorX,J.anchorY,C(J.anchorX,J.anchorY),1],a.ag(se,se,t)):(se=[J.anchorX,J.anchorY,0,1],H(se,se,t)),!wt(se,L)){$(J.numGlyphs,U);continue}const pe=qt(n.transform.cameraToCenterDistance,se[3]),fe=a.aj(E,P,J),be=_?fe/pe:fe*pe,Pe=new a.P(J.anchorX,J.anchorY),Ce=dt(Pe,c,C).point,Le={projections:{},offsets:{}},Ke=_i(J,be,!1,y,t,c,d,u.glyphOffsetArray,V,U,Ce,Pe,Le,N,x,C);re=Ke.useVertical,(Ke.notEnoughRoom||re||Ke.needsFlipping&&_i(J,be,!0,y,t,c,d,u.glyphOffsetArray,V,U,Ce,Pe,Le,N,x,C).notEnoughRoom)&&$(J.numGlyphs,U)}o?u.text.dynamicLayoutVertexBuffer.updateData(U):u.icon.dynamicLayoutVertexBuffer.updateData(U)}function ot(u,t,n,o,c,d,_,y,x,C,E,P,L){const U=y.glyphStartIndex+y.numGlyphs,V=y.lineStartIndex,G=y.lineStartIndex+y.lineLength,N=t.getoffsetX(y.glyphStartIndex),re=t.getoffsetX(U-1),he=M(u*N,n,o,c,d,_,y.segment,V,G,x,C,E,P,L);if(!he)return null;const J=M(u*re,n,o,c,d,_,y.segment,V,G,x,C,E,P,L);return J?{first:he,last:J}:null}function ct(u,t,n,o){return u===a.ai.horizontal&&Math.abs(n.y-t.y)>Math.abs(n.x-t.x)*o?{useVertical:!0}:(u===a.ai.vertical?t.y<n.y:t.x>n.x)?{needsFlipping:!0}:null}function _i(u,t,n,o,c,d,_,y,x,C,E,P,L,U,V,G){const N=t/24,re=u.lineOffsetX*N,he=u.lineOffsetY*N;let J;if(u.numGlyphs>1){const se=u.glyphStartIndex+u.numGlyphs,pe=u.lineStartIndex,fe=u.lineStartIndex+u.lineLength,be=ot(N,y,re,he,n,E,P,u,x,d,L,V,G);if(!be)return{notEnoughRoom:!0};const Pe=dt(be.first.point,_,G).point,Ce=dt(be.last.point,_,G).point;if(o&&!n){const Le=ct(u.writingMode,Pe,Ce,U);if(Le)return Le}J=[be.first];for(let Le=u.glyphStartIndex+1;Le<se-1;Le++)J.push(M(N*y.getoffsetX(Le),re,he,n,E,P,u.segment,pe,fe,x,d,L,V,G));J.push(be.last)}else{if(o&&!n){const pe=dt(P,c,G).point,fe=u.lineStartIndex+u.segment+1,be=new a.P(x.getx(fe),x.gety(fe)),Pe=dt(be,c,G),Ce=Pe.signedDistanceFromCamera>0?Pe.point:Vi(P,be,pe,1,c,G),Le=ct(u.writingMode,pe,Ce,U);if(Le)return Le}const se=M(N*y.getoffsetX(u.glyphStartIndex),re,he,n,E,P,u.segment,u.lineStartIndex,u.lineStartIndex+u.lineLength,x,d,L,V,G);if(!se)return{notEnoughRoom:!0};J=[se]}for(const se of J)a.ak(C,se.point,se.angle);return{}}function Vi(u,t,n,o,c,d){const _=dt(u.add(u.sub(t)._unit()),c,d).point,y=n.sub(_);return n.add(y._mult(o/y.mag()))}function vt(u,t){const{projectionCache:n,lineVertexArray:o,labelPlaneMatrix:c,tileAnchorPoint:d,distanceFromAnchor:_,getElevation:y,previousVertex:x,direction:C,absOffsetX:E}=t;if(n.projections[u])return n.projections[u];const P=new a.P(o.getx(u),o.gety(u)),L=dt(P,c,y);if(L.signedDistanceFromCamera>0)return n.projections[u]=L.point,L.point;const U=u-C;return Vi(_===0?d:new a.P(o.getx(U),o.gety(U)),P,x,E-_+1,c,y)}function hn(u,t,n){return u._unit()._perp()._mult(t*n)}function Z(u,t,n,o,c,d,_,y){const{projectionCache:x,direction:C}=y;if(x.offsets[u])return x.offsets[u];const E=n.add(t);if(u+C<o||u+C>=c)return x.offsets[u]=E,E;const P=vt(u+C,y),L=hn(P.sub(n),_,C),U=n.add(L),V=P.add(L);return x.offsets[u]=a.al(d,E,U,V)||E,x.offsets[u]}function M(u,t,n,o,c,d,_,y,x,C,E,P,L,U){const V=o?u-t:u+t;let G=V>0?1:-1,N=0;o&&(G*=-1,N=Math.PI),G<0&&(N+=Math.PI);let re,he,J=G>0?y+_:y+_+1,se=c,pe=c,fe=0,be=0;const Pe=Math.abs(V),Ce=[];let Le;for(;fe+be<=Pe;){if(J+=G,J<y||J>=x)return null;fe+=be,pe=se,he=re;const Oe={projectionCache:P,lineVertexArray:C,labelPlaneMatrix:E,tileAnchorPoint:d,distanceFromAnchor:fe,getElevation:U,previousVertex:pe,direction:G,absOffsetX:Pe};if(se=vt(J,Oe),n===0)Ce.push(pe),Le=se.sub(pe);else{let ht;const Qe=se.sub(pe);ht=Qe.mag()===0?hn(vt(J+G,Oe).sub(se),n,G):hn(Qe,n,G),he||(he=pe.add(ht)),re=Z(J,ht,se,y,x,he,n,Oe),Ce.push(he),Le=re.sub(he)}be=Le.mag()}const Ke=Le._mult((Pe-fe)/be)._add(he||pe),Tt=N+Math.atan2(se.y-pe.y,se.x-pe.x);return Ce.push(Ke),{point:Ke,angle:L?Tt:0,path:Ce}}const D=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function $(u,t){for(let n=0;n<u;n++){const o=t.length;t.resize(o+4),t.float32.set(D,3*o)}}function H(u,t,n){const o=t[0],c=t[1];return u[0]=n[0]*o+n[4]*c+n[12],u[1]=n[1]*o+n[5]*c+n[13],u[3]=n[3]*o+n[7]*c+n[15],u}const K=100;class le{constructor(t,n=new En(t.width+200,t.height+200,25),o=new En(t.width+200,t.height+200,25)){this.transform=t,this.grid=n,this.ignoredGrid=o,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+K,this.screenBottomBoundary=t.height+K,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,n,o,c,d,_){const y=this.projectAndGetPerspectiveRatio(c,t.anchorPointX,t.anchorPointY,_),x=o*y.perspectiveRatio,C=t.x1*x+y.point.x,E=t.y1*x+y.point.y,P=t.x2*x+y.point.x,L=t.y2*x+y.point.y;return!this.isInsideGrid(C,E,P,L)||n!=="always"&&this.grid.hitTest(C,E,P,L,n,d)||y.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[C,E,P,L],offscreen:this.isOffscreen(C,E,P,L)}}placeCollisionCircles(t,n,o,c,d,_,y,x,C,E,P,L,U,V){const G=[],N=new a.P(n.anchorX,n.anchorY),re=dt(N,_,V),he=qt(this.transform.cameraToCenterDistance,re.signedDistanceFromCamera),J=(E?d/he:d*he)/a.ap,se=dt(N,y,V).point,pe=ot(J,c,n.lineOffsetX*J,n.lineOffsetY*J,!1,se,N,n,o,y,{projections:{},offsets:{}},!1,V);let fe=!1,be=!1,Pe=!0;if(pe){const Ce=.5*L*he+U,Le=new a.P(-100,-100),Ke=new a.P(this.screenRightBoundary,this.screenBottomBoundary),Tt=new In,Oe=pe.first,ht=pe.last;let Qe=[];for(let bt=Oe.path.length-1;bt>=1;bt--)Qe.push(Oe.path[bt]);for(let bt=1;bt<ht.path.length;bt++)Qe.push(ht.path[bt]);const Gt=2.5*Ce;if(x){const bt=Qe.map(It=>dt(It,x,V));Qe=bt.some(It=>It.signedDistanceFromCamera<=0)?[]:bt.map(It=>It.point)}let Ct=[];if(Qe.length>0){const bt=Qe[0].clone(),It=Qe[0].clone();for(let yi=1;yi<Qe.length;yi++)bt.x=Math.min(bt.x,Qe[yi].x),bt.y=Math.min(bt.y,Qe[yi].y),It.x=Math.max(It.x,Qe[yi].x),It.y=Math.max(It.y,Qe[yi].y);Ct=bt.x>=Le.x&&It.x<=Ke.x&&bt.y>=Le.y&&It.y<=Ke.y?[Qe]:It.x<Le.x||bt.x>Ke.x||It.y<Le.y||bt.y>Ke.y?[]:a.am([Qe],Le.x,Le.y,Ke.x,Ke.y)}for(const bt of Ct){Tt.reset(bt,.25*Ce);let It=0;It=Tt.length<=.5*Ce?1:Math.ceil(Tt.paddedLength/Gt)+1;for(let yi=0;yi<It;yi++){const ti=yi/Math.max(It-1,1),Hi=Tt.lerp(ti),zi=Hi.x+K,Si=Hi.y+K;G.push(zi,Si,Ce,0);const Mr=zi-Ce,ri=Si-Ce,rn=zi+Ce,nn=Si+Ce;if(Pe=Pe&&this.isOffscreen(Mr,ri,rn,nn),be=be||this.isInsideGrid(Mr,ri,rn,nn),t!=="always"&&this.grid.hitTestCircle(zi,Si,Ce,t,P)&&(fe=!0,!C))return{circles:[],offscreen:!1,collisionDetected:fe}}}}return{circles:!C&&fe||!be||he<this.perspectiveRatioCutoff?[]:G,offscreen:Pe,collisionDetected:fe}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const n=[];let o=1/0,c=1/0,d=-1/0,_=-1/0;for(const E of t){const P=new a.P(E.x+K,E.y+K);o=Math.min(o,P.x),c=Math.min(c,P.y),d=Math.max(d,P.x),_=Math.max(_,P.y),n.push(P)}const y=this.grid.query(o,c,d,_).concat(this.ignoredGrid.query(o,c,d,_)),x={},C={};for(const E of y){const P=E.key;if(x[P.bucketInstanceId]===void 0&&(x[P.bucketInstanceId]={}),x[P.bucketInstanceId][P.featureIndex])continue;const L=[new a.P(E.x1,E.y1),new a.P(E.x2,E.y1),new a.P(E.x2,E.y2),new a.P(E.x1,E.y2)];a.an(n,L)&&(x[P.bucketInstanceId][P.featureIndex]=!0,C[P.bucketInstanceId]===void 0&&(C[P.bucketInstanceId]=[]),C[P.bucketInstanceId].push(P.featureIndex))}return C}insertCollisionBox(t,n,o,c,d,_){(o?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:d,collisionGroupID:_,overlapMode:n},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,n,o,c,d,_){const y=o?this.ignoredGrid:this.grid,x={bucketInstanceId:c,featureIndex:d,collisionGroupID:_,overlapMode:n};for(let C=0;C<t.length;C+=4)y.insertCircle(x,t[C],t[C+1],t[C+2])}projectAndGetPerspectiveRatio(t,n,o,c){let d;return c?(d=[n,o,c(n,o),1],a.ag(d,d,t)):(d=[n,o,0,1],H(d,d,t)),{point:new a.P((d[0]/d[3]+1)/2*this.transform.width+K,(-d[1]/d[3]+1)/2*this.transform.height+K),perspectiveRatio:.5+this.transform.cameraToCenterDistance/d[3]*.5}}isOffscreen(t,n,o,c){return o<K||t>=this.screenRightBoundary||c<K||n>this.screenBottomBoundary}isInsideGrid(t,n,o,c){return o>=0&&t<this.gridRightBoundary&&c>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const t=a.ao([]);return a.$(t,t,[-100,-100,0]),t}}function te(u,t,n){return t*(a.N/(u.tileSize*Math.pow(2,n-u.tileID.overscaledZ)))}class Q{constructor(t,n,o,c){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?n:-n))):c&&o?1:0,this.placed=o}isHidden(){return this.opacity===0&&!this.placed}}class ae{constructor(t,n,o,c,d){this.text=new Q(t?t.text:null,n,o,d),this.icon=new Q(t?t.icon:null,n,c,d)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ve{constructor(t,n,o){this.text=t,this.icon=n,this.skipFade=o}}class xe{constructor(){this.invProjMatrix=a.Z(),this.viewportMatrix=a.Z(),this.circles=[]}}class Se{constructor(t,n,o,c,d){this.bucketInstanceId=t,this.featureIndex=n,this.sourceLayerIndex=o,this.bucketIndex=c,this.tileID=d}}class nt{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const n=++this.maxGroupID;this.collisionGroups[t]={ID:n,predicate:o=>o.collisionGroupID===n}}return this.collisionGroups[t]}}function pt(u,t,n,o,c){const{horizontalAlign:d,verticalAlign:_}=a.au(u);return new a.P(-(d-.5)*t+o[0]*c,-(_-.5)*n+o[1]*c)}function Xe(u,t,n,o,c,d){const{x1:_,x2:y,y1:x,y2:C,anchorPointX:E,anchorPointY:P}=u,L=new a.P(t,n);return o&&L._rotate(c?d:-d),{x1:_+L.x,y1:x+L.y,x2:y+L.x,y2:C+L.y,anchorPointX:E,anchorPointY:P}}class lt{constructor(t,n,o,c,d){this.transform=t.clone(),this.terrain=n,this.collisionIndex=new le(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=o,this.retainedQueryData={},this.collisionGroups=new nt(c),this.collisionCircleArrays={},this.prevPlacement=d,d&&(d.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,n,o,c){const d=o.getBucket(n),_=o.latestFeatureIndex;if(!d||!_||n.id!==d.layerIds[0])return;const y=o.collisionBoxArray,x=d.layers[0].layout,C=Math.pow(2,this.transform.zoom-o.tileID.overscaledZ),E=o.tileSize/a.N,P=this.transform.calculatePosMatrix(o.tileID.toUnwrapped()),L=x.get("text-pitch-alignment")==="map",U=x.get("text-rotation-alignment")==="map",V=te(o,1,this.transform.zoom),G=Re(P,L,U,this.transform,V);let N=null;if(L){const he=mt(P,L,U,this.transform,V);N=a.a1([],this.transform.labelPlaneMatrix,he)}this.retainedQueryData[d.bucketInstanceId]=new Se(d.bucketInstanceId,_,d.sourceLayerIndex,d.index,o.tileID);const re={bucket:d,layout:x,posMatrix:P,textLabelPlaneMatrix:G,labelToScreenMatrix:N,scale:C,textPixelRatio:E,holdingForFade:o.holdingForFade(),collisionBoxArray:y,partiallyEvaluatedTextSize:a.ah(d.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(d.sourceID)};if(c)for(const he of d.sortKeyRanges){const{sortKey:J,symbolInstanceStart:se,symbolInstanceEnd:pe}=he;t.push({sortKey:J,symbolInstanceStart:se,symbolInstanceEnd:pe,parameters:re})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:d.symbolInstances.length,parameters:re})}attemptAnchorPlacement(t,n,o,c,d,_,y,x,C,E,P,L,U,V,G,N){const re=a.aq[t.textAnchor],he=[t.textOffset0,t.textOffset1],J=pt(re,o,c,he,d),se=this.collisionIndex.placeCollisionBox(Xe(n,J.x,J.y,_,y,this.transform.angle),P,x,C,E.predicate,N);if((!G||this.collisionIndex.placeCollisionBox(Xe(G,J.x,J.y,_,y,this.transform.angle),P,x,C,E.predicate,N).box.length!==0)&&se.box.length>0){let pe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[L.crossTileID]&&this.prevPlacement.placements[L.crossTileID]&&this.prevPlacement.placements[L.crossTileID].text&&(pe=this.prevPlacement.variableOffsets[L.crossTileID].anchor),L.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[L.crossTileID]={textOffset:he,width:o,height:c,anchor:re,textBoxScale:d,prevAnchor:pe},this.markUsedJustification(U,re,L,V),U.allowVerticalPlacement&&(this.markUsedOrientation(U,V,L),this.placedOrientations[L.crossTileID]=V),{shift:J,placedGlyphBoxes:se}}}placeLayerBucketPart(t,n,o){const{bucket:c,layout:d,posMatrix:_,textLabelPlaneMatrix:y,labelToScreenMatrix:x,textPixelRatio:C,holdingForFade:E,collisionBoxArray:P,partiallyEvaluatedTextSize:L,collisionGroup:U}=t.parameters,V=d.get("text-optional"),G=d.get("icon-optional"),N=a.ar(d,"text-overlap","text-allow-overlap"),re=N==="always",he=a.ar(d,"icon-overlap","icon-allow-overlap"),J=he==="always",se=d.get("text-rotation-alignment")==="map",pe=d.get("text-pitch-alignment")==="map",fe=d.get("icon-text-fit")!=="none",be=d.get("symbol-z-order")==="viewport-y",Pe=re&&(J||!c.hasIconData()||G),Ce=J&&(re||!c.hasTextData()||V);!c.collisionArrays&&P&&c.deserializeCollisionBoxes(P);const Le=this.retainedQueryData[c.bucketInstanceId].tileID,Ke=this.terrain?(Oe,ht)=>this.terrain.getElevation(Le,Oe,ht):null,Tt=(Oe,ht)=>{var Qe,Gt;if(n[Oe.crossTileID])return;if(E)return void(this.placements[Oe.crossTileID]=new ve(!1,!1,!1));let Ct=!1,bt=!1,It=!0,yi=null,ti={box:null,offscreen:null},Hi={box:null,offscreen:null},zi=null,Si=null,Mr=null,ri=0,rn=0,nn=0;ht.textFeatureIndex?ri=ht.textFeatureIndex:Oe.useRuntimeCollisionCircles&&(ri=Oe.featureIndex),ht.verticalTextFeatureIndex&&(rn=ht.verticalTextFeatureIndex);const Ln=ht.textBox;if(Ln){const er=vi=>{let Di=a.ai.horizontal;if(c.allowVerticalPlacement&&!vi&&this.prevPlacement){const yr=this.prevPlacement.placedOrientations[Oe.crossTileID];yr&&(this.placedOrientations[Oe.crossTileID]=yr,Di=yr,this.markUsedOrientation(c,Di,Oe))}return Di},Wi=(vi,Di)=>{if(c.allowVerticalPlacement&&Oe.numVerticalGlyphVertices>0&&ht.verticalTextBox){for(const yr of c.writingModes)if(yr===a.ai.vertical?(ti=Di(),Hi=ti):ti=vi(),ti&&ti.box&&ti.box.length)break}else ti=vi()},lr=Oe.textAnchorOffsetStartIndex,Xn=Oe.textAnchorOffsetEndIndex;if(Xn===lr){const vi=(Di,yr)=>{const xi=this.collisionIndex.placeCollisionBox(Di,N,C,_,U.predicate,Ke);return xi&&xi.box&&xi.box.length&&(this.markUsedOrientation(c,yr,Oe),this.placedOrientations[Oe.crossTileID]=yr),xi};Wi(()=>vi(Ln,a.ai.horizontal),()=>{const Di=ht.verticalTextBox;return c.allowVerticalPlacement&&Oe.numVerticalGlyphVertices>0&&Di?vi(Di,a.ai.vertical):{box:null,offscreen:null}}),er(ti&&ti.box&&ti.box.length)}else{let vi=a.aq[(Gt=(Qe=this.prevPlacement)===null||Qe===void 0?void 0:Qe.variableOffsets[Oe.crossTileID])===null||Gt===void 0?void 0:Gt.anchor];const Di=(xi,Kn,Pa)=>{const Ul=xi.x2-xi.x1,ql=xi.y2-xi.y1,eu=Oe.textBoxScale,zo=fe&&he==="never"?Kn:null;let sn={box:[],offscreen:!1},Jn=N==="never"?1:2,an="never";vi&&Jn++;for(let Vr=0;Vr<Jn;Vr++){for(let on=lr;on<Xn;on++){const Do=c.textAnchorOffsets.get(on);if(vi&&Do.textAnchor!==vi)continue;const _n=this.attemptAnchorPlacement(Do,xi,Ul,ql,eu,se,pe,C,_,U,an,Oe,c,Pa,zo,Ke);if(_n&&(sn=_n.placedGlyphBoxes,sn&&sn.box&&sn.box.length))return Ct=!0,yi=_n.shift,sn}vi?vi=null:an=N}return sn};Wi(()=>Di(Ln,ht.iconBox,a.ai.horizontal),()=>{const xi=ht.verticalTextBox;return c.allowVerticalPlacement&&!(ti&&ti.box&&ti.box.length)&&Oe.numVerticalGlyphVertices>0&&xi?Di(xi,ht.verticalIconBox,a.ai.vertical):{box:null,offscreen:null}}),ti&&(Ct=ti.box,It=ti.offscreen);const yr=er(ti&&ti.box);if(!Ct&&this.prevPlacement){const xi=this.prevPlacement.variableOffsets[Oe.crossTileID];xi&&(this.variableOffsets[Oe.crossTileID]=xi,this.markUsedJustification(c,xi.anchor,Oe,yr))}}}if(zi=ti,Ct=zi&&zi.box&&zi.box.length>0,It=zi&&zi.offscreen,Oe.useRuntimeCollisionCircles){const er=c.text.placedSymbolArray.get(Oe.centerJustifiedTextSymbolIndex),Wi=a.aj(c.textSizeData,L,er),lr=d.get("text-padding");Si=this.collisionIndex.placeCollisionCircles(N,er,c.lineVertexArray,c.glyphOffsetArray,Wi,_,y,x,o,pe,U.predicate,Oe.collisionCircleDiameter,lr,Ke),Si.circles.length&&Si.collisionDetected&&!o&&a.w("Collisions detected, but collision boxes are not shown"),Ct=re||Si.circles.length>0&&!Si.collisionDetected,It=It&&Si.offscreen}if(ht.iconFeatureIndex&&(nn=ht.iconFeatureIndex),ht.iconBox){const er=Wi=>{const lr=fe&&yi?Xe(Wi,yi.x,yi.y,se,pe,this.transform.angle):Wi;return this.collisionIndex.placeCollisionBox(lr,he,C,_,U.predicate,Ke)};Hi&&Hi.box&&Hi.box.length&&ht.verticalIconBox?(Mr=er(ht.verticalIconBox),bt=Mr.box.length>0):(Mr=er(ht.iconBox),bt=Mr.box.length>0),It=It&&Mr.offscreen}const Wn=V||Oe.numHorizontalGlyphVertices===0&&Oe.numVerticalGlyphVertices===0,gs=G||Oe.numIconVertices===0;if(Wn||gs?gs?Wn||(bt=bt&&Ct):Ct=bt&&Ct:bt=Ct=bt&&Ct,Ct&&zi&&zi.box&&this.collisionIndex.insertCollisionBox(zi.box,N,d.get("text-ignore-placement"),c.bucketInstanceId,Hi&&Hi.box&&rn?rn:ri,U.ID),bt&&Mr&&this.collisionIndex.insertCollisionBox(Mr.box,he,d.get("icon-ignore-placement"),c.bucketInstanceId,nn,U.ID),Si&&(Ct&&this.collisionIndex.insertCollisionCircles(Si.circles,N,d.get("text-ignore-placement"),c.bucketInstanceId,ri,U.ID),o)){const er=c.bucketInstanceId;let Wi=this.collisionCircleArrays[er];Wi===void 0&&(Wi=this.collisionCircleArrays[er]=new xe);for(let lr=0;lr<Si.circles.length;lr+=4)Wi.circles.push(Si.circles[lr+0]),Wi.circles.push(Si.circles[lr+1]),Wi.circles.push(Si.circles[lr+2]),Wi.circles.push(Si.collisionDetected?1:0)}if(Oe.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(c.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Oe.crossTileID]=new ve(Ct||Pe,bt||Ce,It||c.justReloaded),n[Oe.crossTileID]=!0};if(be){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Oe=c.getSortedSymbolIndexes(this.transform.angle);for(let ht=Oe.length-1;ht>=0;--ht){const Qe=Oe[ht];Tt(c.symbolInstances.get(Qe),c.collisionArrays[Qe])}}else for(let Oe=t.symbolInstanceStart;Oe<t.symbolInstanceEnd;Oe++)Tt(c.symbolInstances.get(Oe),c.collisionArrays[Oe]);if(o&&c.bucketInstanceId in this.collisionCircleArrays){const Oe=this.collisionCircleArrays[c.bucketInstanceId];a.as(Oe.invProjMatrix,_),Oe.viewportMatrix=this.collisionIndex.getViewportMatrix()}c.justReloaded=!1}markUsedJustification(t,n,o,c){let d;d=c===a.ai.vertical?o.verticalPlacedTextSymbolIndex:{left:o.leftJustifiedTextSymbolIndex,center:o.centerJustifiedTextSymbolIndex,right:o.rightJustifiedTextSymbolIndex}[a.at(n)];const _=[o.leftJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.rightJustifiedTextSymbolIndex,o.verticalPlacedTextSymbolIndex];for(const y of _)y>=0&&(t.text.placedSymbolArray.get(y).crossTileID=d>=0&&y!==d?0:o.crossTileID)}markUsedOrientation(t,n,o){const c=n===a.ai.horizontal||n===a.ai.horizontalOnly?n:0,d=n===a.ai.vertical?n:0,_=[o.leftJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.rightJustifiedTextSymbolIndex];for(const y of _)t.text.placedSymbolArray.get(y).placedOrientation=c;o.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(o.verticalPlacedTextSymbolIndex).placedOrientation=d)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let o=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const c=n?n.symbolFadeChange(t):1,d=n?n.opacities:{},_=n?n.variableOffsets:{},y=n?n.placedOrientations:{};for(const x in this.placements){const C=this.placements[x],E=d[x];E?(this.opacities[x]=new ae(E,c,C.text,C.icon),o=o||C.text!==E.text.placed||C.icon!==E.icon.placed):(this.opacities[x]=new ae(null,c,C.text,C.icon,C.skipFade),o=o||C.text||C.icon)}for(const x in d){const C=d[x];if(!this.opacities[x]){const E=new ae(C,c,!1,!1);E.isHidden()||(this.opacities[x]=E,o=o||C.text.placed||C.icon.placed)}}for(const x in _)this.variableOffsets[x]||!this.opacities[x]||this.opacities[x].isHidden()||(this.variableOffsets[x]=_[x]);for(const x in y)this.placedOrientations[x]||!this.opacities[x]||this.opacities[x].isHidden()||(this.placedOrientations[x]=y[x]);if(n&&n.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");o?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:t)}updateLayerOpacities(t,n){const o={};for(const c of n){const d=c.getBucket(t);d&&c.latestFeatureIndex&&t.id===d.layerIds[0]&&this.updateBucketOpacities(d,o,c.collisionBoxArray)}}updateBucketOpacities(t,n,o){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const c=t.layers[0],d=c.layout,_=new ae(null,0,!1,!1,!0),y=d.get("text-allow-overlap"),x=d.get("icon-allow-overlap"),C=c._unevaluatedLayout.hasValue("text-variable-anchor")||c._unevaluatedLayout.hasValue("text-variable-anchor-offset"),E=d.get("text-rotation-alignment")==="map",P=d.get("text-pitch-alignment")==="map",L=d.get("icon-text-fit")!=="none",U=new ae(null,0,y&&(x||!t.hasIconData()||d.get("icon-optional")),x&&(y||!t.hasTextData()||d.get("text-optional")),!0);!t.collisionArrays&&o&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(o);const V=(G,N,re)=>{for(let he=0;he<N/4;he++)G.opacityVertexArray.emplaceBack(re);G.hasVisibleVertices=G.hasVisibleVertices||re!==Fr};for(let G=0;G<t.symbolInstances.length;G++){const N=t.symbolInstances.get(G),{numHorizontalGlyphVertices:re,numVerticalGlyphVertices:he,crossTileID:J}=N;let se=this.opacities[J];n[J]?se=_:se||(se=U,this.opacities[J]=se),n[J]=!0;const pe=N.numIconVertices>0,fe=this.placedOrientations[N.crossTileID],be=fe===a.ai.vertical,Pe=fe===a.ai.horizontal||fe===a.ai.horizontalOnly;if(re>0||he>0){const Ce=Zi(se.text);V(t.text,re,be?Fr:Ce),V(t.text,he,Pe?Fr:Ce);const Le=se.text.isHidden();[N.rightJustifiedTextSymbolIndex,N.centerJustifiedTextSymbolIndex,N.leftJustifiedTextSymbolIndex].forEach(Oe=>{Oe>=0&&(t.text.placedSymbolArray.get(Oe).hidden=Le||be?1:0)}),N.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(N.verticalPlacedTextSymbolIndex).hidden=Le||Pe?1:0);const Ke=this.variableOffsets[N.crossTileID];Ke&&this.markUsedJustification(t,Ke.anchor,N,fe);const Tt=this.placedOrientations[N.crossTileID];Tt&&(this.markUsedJustification(t,"left",N,Tt),this.markUsedOrientation(t,Tt,N))}if(pe){const Ce=Zi(se.icon),Le=!(L&&N.verticalPlacedIconSymbolIndex&&be);N.placedIconSymbolIndex>=0&&(V(t.icon,N.numIconVertices,Le?Ce:Fr),t.icon.placedSymbolArray.get(N.placedIconSymbolIndex).hidden=se.icon.isHidden()),N.verticalPlacedIconSymbolIndex>=0&&(V(t.icon,N.numVerticalIconVertices,Le?Fr:Ce),t.icon.placedSymbolArray.get(N.verticalPlacedIconSymbolIndex).hidden=se.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Ce=t.collisionArrays[G];if(Ce){let Le=new a.P(0,0);if(Ce.textBox||Ce.verticalTextBox){let Tt=!0;if(C){const Oe=this.variableOffsets[J];Oe?(Le=pt(Oe.anchor,Oe.width,Oe.height,Oe.textOffset,Oe.textBoxScale),E&&Le._rotate(P?this.transform.angle:-this.transform.angle)):Tt=!1}Ce.textBox&&_t(t.textCollisionBox.collisionVertexArray,se.text.placed,!Tt||be,Le.x,Le.y),Ce.verticalTextBox&&_t(t.textCollisionBox.collisionVertexArray,se.text.placed,!Tt||Pe,Le.x,Le.y)}const Ke=!!(!Pe&&Ce.verticalIconBox);Ce.iconBox&&_t(t.iconCollisionBox.collisionVertexArray,se.icon.placed,Ke,L?Le.x:0,L?Le.y:0),Ce.verticalIconBox&&_t(t.iconCollisionBox.collisionVertexArray,se.icon.placed,!Ke,L?Le.x:0,L?Le.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const G=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=G.invProjMatrix,t.placementViewportMatrix=G.viewportMatrix,t.collisionCircleArray=G.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,n){const o=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*o>t}setStale(){this.stale=!0}}function _t(u,t,n,o,c){u.emplaceBack(t?1:0,n?1:0,o||0,c||0),u.emplaceBack(t?1:0,n?1:0,o||0,c||0),u.emplaceBack(t?1:0,n?1:0,o||0,c||0),u.emplaceBack(t?1:0,n?1:0,o||0,c||0)}const Vt=Math.pow(2,25),Ht=Math.pow(2,24),Ft=Math.pow(2,17),Lt=Math.pow(2,16),Yi=Math.pow(2,9),ei=Math.pow(2,8),Ei=Math.pow(2,1);function Zi(u){if(u.opacity===0&&!u.placed)return 0;if(u.opacity===1&&u.placed)return 4294967295;const t=u.placed?1:0,n=Math.floor(127*u.opacity);return n*Vt+t*Ht+n*Ft+t*Lt+n*Yi+t*ei+n*Ei+t}const Fr=0;class sl{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,n,o,c,d){const _=this._bucketParts;for(;this._currentTileIndex<t.length;)if(n.getBucketParts(_,c,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,d())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,_.sort((y,x)=>y.sortKey-x.sortKey));this._currentPartIndex<_.length;)if(n.placeLayerBucketPart(_[this._currentPartIndex],this._seenCrossTileIDs,o),this._currentPartIndex++,d())return!0;return!1}}class rs{constructor(t,n,o,c,d,_,y,x){this.placement=new lt(t,n,_,y,x),this._currentPlacementIndex=o.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=d,this._done=!1}isDone(){return this._done}continuePlacement(t,n,o){const c=a.h.now(),d=()=>!this._forceFullPlacement&&a.h.now()-c>2;for(;this._currentPlacementIndex>=0;){const _=n[t[this._currentPlacementIndex]],y=this.placement.collisionIndex.transform.zoom;if(_.type==="symbol"&&(!_.minzoom||_.minzoom<=y)&&(!_.maxzoom||_.maxzoom>y)){if(this._inProgressLayer||(this._inProgressLayer=new sl(_)),this._inProgressLayer.continuePlacement(o[_.source],this.placement,this._showCollisionBoxes,_,d))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const ns=512/a.N/2;class Bc{constructor(t,n,o){this.tileID=t,this.bucketInstanceId=o,this._symbolsByKey={};const c=new Map;for(let d=0;d<n.length;d++){const _=n.get(d),y=_.key,x=c.get(y);x?x.push(_):c.set(y,[_])}for(const[d,_]of c){const y={positions:_.map(x=>({x:Math.floor(x.anchorX*ns),y:Math.floor(x.anchorY*ns)})),crossTileIDs:_.map(x=>x.crossTileID)};if(y.positions.length>128){const x=new a.av(y.positions.length,16,Uint16Array);for(const{x:C,y:E}of y.positions)x.add(C,E);x.finish(),delete y.positions,y.index=x}this._symbolsByKey[d]=y}}getScaledCoordinates(t,n){const{x:o,y:c,z:d}=this.tileID.canonical,{x:_,y,z:x}=n.canonical,C=ns/Math.pow(2,x-d),E=(y*a.N+t.anchorY)*C,P=c*a.N*ns;return{x:Math.floor((_*a.N+t.anchorX)*C-o*a.N*ns),y:Math.floor(E-P)}}findMatches(t,n,o){const c=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z);for(let d=0;d<t.length;d++){const _=t.get(d);if(_.crossTileID)continue;const y=this._symbolsByKey[_.key];if(!y)continue;const x=this.getScaledCoordinates(_,n);if(y.index){const C=y.index.range(x.x-c,x.y-c,x.x+c,x.y+c).sort();for(const E of C){const P=y.crossTileIDs[E];if(!o[P]){o[P]=!0,_.crossTileID=P;break}}}else if(y.positions)for(let C=0;C<y.positions.length;C++){const E=y.positions[C],P=y.crossTileIDs[C];if(Math.abs(E.x-x.x)<=c&&Math.abs(E.y-x.y)<=c&&!o[P]){o[P]=!0,_.crossTileID=P;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class Zt{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class qa{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const n=Math.round((t-this.lng)/360);if(n!==0)for(const o in this.indexes){const c=this.indexes[o],d={};for(const _ in c){const y=c[_];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+n),d[y.tileID.key]=y}this.indexes[o]=d}this.lng=t}addBucket(t,n,o){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let d=0;d<n.symbolInstances.length;d++)n.symbolInstances.get(d).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const c=this.usedCrossTileIDs[t.overscaledZ];for(const d in this.indexes){const _=this.indexes[d];if(Number(d)>t.overscaledZ)for(const y in _){const x=_[y];x.tileID.isChildOf(t)&&x.findMatches(n.symbolInstances,t,c)}else{const y=_[t.scaledTo(Number(d)).key];y&&y.findMatches(n.symbolInstances,t,c)}}for(let d=0;d<n.symbolInstances.length;d++){const _=n.symbolInstances.get(d);_.crossTileID||(_.crossTileID=o.generate(),c[_.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Bc(t,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(t,n){for(const o of n.getCrossTileIDsLists())for(const c of o)delete this.usedCrossTileIDs[t][c]}removeStaleBuckets(t){let n=!1;for(const o in this.indexes){const c=this.indexes[o];for(const d in c)t[c[d].bucketInstanceId]||(this.removeBucketCrossTileIDs(o,c[d]),delete c[d],n=!0)}return n}}class ea{constructor(){this.layerIndexes={},this.crossTileIDs=new Zt,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,n,o){let c=this.layerIndexes[t.id];c===void 0&&(c=this.layerIndexes[t.id]=new qa);let d=!1;const _={};c.handleWrapJump(o);for(const y of n){const x=y.getBucket(t);x&&t.id===x.layerIds[0]&&(x.bucketInstanceId||(x.bucketInstanceId=++this.maxBucketInstanceId),c.addBucket(y.tileID,x,this.crossTileIDs)&&(d=!0),_[x.bucketInstanceId]=!0)}return c.removeStaleBuckets(_)&&(d=!0),d}pruneUnusedLayers(t){const n={};t.forEach(o=>{n[o]=!0});for(const o in this.layerIndexes)n[o]||delete this.layerIndexes[o]}}const Qi=(u,t)=>a.x(u,t&&t.filter(n=>n.identifier!=="source.canvas")),Tr=a.F(a.ax,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),Oc=a.F(a.ax,["setCenter","setZoom","setBearing","setPitch"]),Br=a.aw();class Gi extends a.E{constructor(t,n={}){super(),this.map=t,this.dispatcher=new ai(Tn(),this,t._getMapId()),this.imageManager=new xt,this.imageManager.setEventedParent(this),this.glyphManager=new Bt(t._requestManager,n.localIdeographFontFamily),this.lineAtlas=new Ki(256,512),this.crossTileSymbolIndex=new ea,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",a.az());const o=this;this._rtlTextPluginCallback=Gi.registerForPluginStateChange(c=>{o.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:c.pluginStatus,pluginURL:c.pluginURL},(d,_)=>{if(a.aA(d),_&&_.every(y=>y))for(const y in o.sourceCaches){const x=o.sourceCaches[y].getSource().type;x!=="vector"&&x!=="geojson"||o.sourceCaches[y].reload()}})}),this.on("data",c=>{if(c.dataType!=="source"||c.sourceDataType!=="metadata")return;const d=this.sourceCaches[c.sourceId];if(!d)return;const _=d.getSource();if(_&&_.vectorLayerIds)for(const y in this._layers){const x=this._layers[y];x.source===_.id&&this._validateLayer(x)}})}loadURL(t,n={},o){this.fire(new a.k("dataloading",{dataType:"style"})),n.validate=typeof n.validate!="boolean"||n.validate;const c=this.map._requestManager.transformRequest(t,ze.Style);this._request=a.f(c,(d,_)=>{this._request=null,d?this.fire(new a.j(d)):_&&this._load(_,n,o)})}loadJSON(t,n={},o){this.fire(new a.k("dataloading",{dataType:"style"})),this._request=a.h.frame(()=>{this._request=null,n.validate=n.validate!==!1,this._load(t,n,o)})}loadEmpty(){this.fire(new a.k("dataloading",{dataType:"style"})),this._load(Br,{validate:!1})}_load(t,n,o){var c;const d=n.transformStyle?n.transformStyle(o,t):t;if(!n.validate||!Qi(this,a.y(d))){this._loaded=!0,this.stylesheet=d;for(const _ in d.sources)this.addSource(_,d.sources[_],{validate:!1});d.sprite?this._loadSprite(d.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(d.glyphs),this._createLayers(),this.light=new Mi(this.stylesheet.light),this.map.setTerrain((c=this.stylesheet.terrain)!==null&&c!==void 0?c:null),this.fire(new a.k("data",{dataType:"style"})),this.fire(new a.k("style.load"))}}_createLayers(){const t=a.aB(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",t),this._order=t.map(n=>n.id),this._layers={},this._serializedLayers=null;for(const n of t){const o=a.aC(n);o.setEventedParent(this,{layer:{id:n.id}}),this._layers[n.id]=o}}_loadSprite(t,n=!1,o=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(c,d,_,y){const x=Ge(c),C=x.length,E=_>1?"@2x":"",P={},L={},U={};for(const{id:V,url:G}of x){const N=d.transformRequest(d.normalizeSpriteURL(G,E,".json"),ze.SpriteJSON),re=`${V}_${N.url}`;P[re]=a.f(N,(se,pe)=>{delete P[re],L[V]=pe,at(y,L,U,se,C)});const he=d.transformRequest(d.normalizeSpriteURL(G,E,".png"),ze.SpriteImage),J=`${V}_${he.url}`;P[J]=Me.getImage(he,(se,pe)=>{delete P[J],U[V]=pe,at(y,L,U,se,C)})}return{cancel(){for(const V of Object.values(P))V.cancel()}}}(t,this.map._requestManager,this.map.getPixelRatio(),(c,d)=>{if(this._spriteRequest=null,c)this.fire(new a.j(c));else if(d)for(const _ in d){this._spritesImagesIds[_]=[];const y=this._spritesImagesIds[_]?this._spritesImagesIds[_].filter(x=>!(x in d)):[];for(const x of y)this.imageManager.removeImage(x),this._changedImages[x]=!0;for(const x in d[_]){const C=_==="default"?x:`${_}:${x}`;this._spritesImagesIds[_].push(C),C in this.imageManager.images?this.imageManager.updateImage(C,d[_][x],!1):this.imageManager.addImage(C,d[_][x]),n&&(this._changedImages[C]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),n&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.k("data",{dataType:"style"})),o&&o(c)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}_validateLayer(t){const n=this.sourceCaches[t.source];if(!n)return;const o=t.sourceLayer;if(!o)return;const c=n.getSource();(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(o)===-1)&&this.fire(new a.j(new Error(`Source layer "${o}" does not exist on source "${c.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t){const n=this._serializedAllLayers();if(!t||t.length===0)return Object.values(n);const o=[];for(const c of t)n[c]&&o.push(n[c]);return o}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const n=Object.keys(this._layers);for(const o of n){const c=this._layers[o];c.type!=="custom"&&(t[o]=c.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const n=this._changed;if(this._changed){const c=Object.keys(this._updatedLayers),d=Object.keys(this._removedLayers);(c.length||d.length)&&this._updateWorkerLayers(c,d);for(const _ in this._updatedSources){const y=this._updatedSources[_];if(y==="reload")this._reloadSource(_);else{if(y!=="clear")throw new Error(`Invalid action ${y}`);this._clearSource(_)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const _ in this._updatedPaintProps)this._layers[_].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const o={};for(const c in this.sourceCaches){const d=this.sourceCaches[c];o[c]=d.used,d.used=!1}for(const c of this._order){const d=this._layers[c];d.recalculate(t,this._availableImages),!d.isHidden(t.zoom)&&d.source&&(this.sourceCaches[d.source].used=!0)}for(const c in o){const d=this.sourceCaches[c];o[c]!==d.used&&d.fire(new a.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:c}))}this.light.recalculate(t),this.z=t.zoom,n&&this.fire(new a.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const n in this.sourceCaches)this.sourceCaches[n].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,n){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(t),removedIds:n})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,n={}){this._checkLoaded();const o=this.serialize();if(t=n.transformStyle?n.transformStyle(o,t):t,Qi(this,a.y(t)))return!1;(t=a.aD(t)).layers=a.aB(t.layers);const c=a.aE(o,t).filter(_=>!(_.command in Oc));if(c.length===0)return!1;const d=c.filter(_=>!(_.command in Tr));if(d.length>0)throw new Error(`Unimplemented: ${d.map(_=>_.command).join(", ")}.`);for(const _ of c)_.command!=="setTransition"&&this[_.command].apply(this,_.args);return this.stylesheet=t,this._serializedLayers=null,!0}addImage(t,n){if(this.getImage(t))return this.fire(new a.j(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,n),this._afterImageUpdated(t)}updateImage(t,n){this.imageManager.updateImage(t,n)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new a.j(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,n,o={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(a.y.source,`sources.${t}`,n,null,o))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const c=this.sourceCaches[t]=new Ii(t,n,this.dispatcher);c.style=this,c.setEventedParent(this,()=>({isSourceLoaded:c.loaded(),source:c.serialize(),sourceId:t})),c.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const o in this._layers)if(this._layers[o].source===t)return this.fire(new a.j(new Error(`Source "${t}" cannot be removed while layer "${o}" is using it.`)));const n=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],n.fire(new a.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),n.setEventedParent(null),n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,n){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const o=this.sourceCaches[t].getSource();if(o.type!=="geojson")throw new Error(`geojsonSource.type is ${o.type}, which is !== 'geojson`);o.setData(n),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,n,o={}){this._checkLoaded();const c=t.id;if(this.getLayer(c))return void this.fire(new a.j(new Error(`Layer "${c}" already exists on this map.`)));let d;if(t.type==="custom"){if(Qi(this,a.aF(t)))return;d=a.aC(t)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(c,t.source),t=a.aD(t),t=a.e(t,{source:c})),this._validate(a.y.layer,`layers.${c}`,t,{arrayIndex:-1},o))return;d=a.aC(t),this._validateLayer(d),d.setEventedParent(this,{layer:{id:c}})}const _=n?this._order.indexOf(n):this._order.length;if(n&&_===-1)this.fire(new a.j(new Error(`Cannot add layer "${c}" before non-existing layer "${n}".`)));else{if(this._order.splice(_,0,c),this._layerOrderChanged=!0,this._layers[c]=d,this._removedLayers[c]&&d.source&&d.type!=="custom"){const y=this._removedLayers[c];delete this._removedLayers[c],y.type!==d.type?this._updatedSources[d.source]="clear":(this._updatedSources[d.source]="reload",this.sourceCaches[d.source].pause())}this._updateLayer(d),d.onAdd&&d.onAdd(this.map)}}moveLayer(t,n){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new a.j(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===n)return;const o=this._order.indexOf(t);this._order.splice(o,1);const c=n?this._order.indexOf(n):this._order.length;n&&c===-1?this.fire(new a.j(new Error(`Cannot move layer "${t}" before non-existing layer "${n}".`))):(this._order.splice(c,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const n=this._layers[t];if(!n)return void this.fire(new a.j(new Error(`Cannot remove non-existing layer "${t}".`)));n.setEventedParent(null);const o=this._order.indexOf(t);this._order.splice(o,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=n,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],n.onRemove&&n.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,n,o){this._checkLoaded();const c=this.getLayer(t);c?c.minzoom===n&&c.maxzoom===o||(n!=null&&(c.minzoom=n),o!=null&&(c.maxzoom=o),this._updateLayer(c)):this.fire(new a.j(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,n,o={}){this._checkLoaded();const c=this.getLayer(t);if(c){if(!a.aG(c.filter,n))return n==null?(c.filter=void 0,void this._updateLayer(c)):void(this._validate(a.y.filter,`layers.${c.id}.filter`,n,null,o)||(c.filter=a.aD(n),this._updateLayer(c)))}else this.fire(new a.j(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return a.aD(this.getLayer(t).filter)}setLayoutProperty(t,n,o,c={}){this._checkLoaded();const d=this.getLayer(t);d?a.aG(d.getLayoutProperty(n),o)||(d.setLayoutProperty(n,o,c),this._updateLayer(d)):this.fire(new a.j(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,n){const o=this.getLayer(t);if(o)return o.getLayoutProperty(n);this.fire(new a.j(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,n,o,c={}){this._checkLoaded();const d=this.getLayer(t);d?a.aG(d.getPaintProperty(n),o)||(d.setPaintProperty(n,o,c)&&this._updateLayer(d),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new a.j(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,n){return this.getLayer(t).getPaintProperty(n)}setFeatureState(t,n){this._checkLoaded();const o=t.source,c=t.sourceLayer,d=this.sourceCaches[o];if(d===void 0)return void this.fire(new a.j(new Error(`The source '${o}' does not exist in the map's style.`)));const _=d.getSource().type;_==="geojson"&&c?this.fire(new a.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):_!=="vector"||c?(t.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),d.setFeatureState(c,t.id,n)):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,n){this._checkLoaded();const o=t.source,c=this.sourceCaches[o];if(c===void 0)return void this.fire(new a.j(new Error(`The source '${o}' does not exist in the map's style.`)));const d=c.getSource().type,_=d==="vector"?t.sourceLayer:void 0;d!=="vector"||_?n&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new a.j(new Error("A feature id is required to remove its specific state property."))):c.removeFeatureState(_,t.id,n):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const n=t.source,o=t.sourceLayer,c=this.sourceCaches[n];if(c!==void 0)return c.getSource().type!=="vector"||o?(t.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),c.getFeatureState(o,t.id)):void this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.j(new Error(`The source '${n}' does not exist in the map's style.`)))}getTransition(){return a.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=a.aH(this.sourceCaches,d=>d.serialize()),n=this._serializeByIds(this._order),o=this.map.getTerrain()||void 0,c=this.stylesheet;return a.aI({version:c.version,name:c.name,metadata:c.metadata,light:c.light,center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch,sprite:c.sprite,glyphs:c.glyphs,transition:c.transition,sources:t,layers:n,terrain:o},d=>d!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const n=_=>this._layers[_].type==="fill-extrusion",o={},c=[];for(let _=this._order.length-1;_>=0;_--){const y=this._order[_];if(n(y)){o[y]=_;for(const x of t){const C=x[y];if(C)for(const E of C)c.push(E)}}}c.sort((_,y)=>y.intersectionZ-_.intersectionZ);const d=[];for(let _=this._order.length-1;_>=0;_--){const y=this._order[_];if(n(y))for(let x=c.length-1;x>=0;x--){const C=c[x].feature;if(o[C.layer.id]<_)break;d.push(C),c.pop()}else for(const x of t){const C=x[y];if(C)for(const E of C)d.push(E.feature)}}return d}queryRenderedFeatures(t,n,o){n&&n.filter&&this._validate(a.y.filter,"queryRenderedFeatures.filter",n.filter,null,n);const c={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new a.j(new Error("parameters.layers must be an Array."))),[];for(const y of n.layers){const x=this._layers[y];if(!x)return this.fire(new a.j(new Error(`The layer '${y}' does not exist in the map's style and cannot be queried for features.`))),[];c[x.source]=!0}}const d=[];n.availableImages=this._availableImages;const _=this._serializedAllLayers();for(const y in this.sourceCaches)n.layers&&!c[y]||d.push(fr(this.sourceCaches[y],this._layers,_,t,n,o));return this.placement&&d.push(function(y,x,C,E,P,L,U){const V={},G=L.queryRenderedSymbols(E),N=[];for(const re of Object.keys(G).map(Number))N.push(U[re]);N.sort(sr);for(const re of N){const he=re.featureIndex.lookupSymbolFeatures(G[re.bucketInstanceId],x,re.bucketIndex,re.sourceLayerIndex,P.filter,P.layers,P.availableImages,y);for(const J in he){const se=V[J]=V[J]||[],pe=he[J];pe.sort((fe,be)=>{const Pe=re.featureSortOrder;if(Pe){const Ce=Pe.indexOf(fe.featureIndex);return Pe.indexOf(be.featureIndex)-Ce}return be.featureIndex-fe.featureIndex});for(const fe of pe)se.push(fe)}}for(const re in V)V[re].forEach(he=>{const J=he.feature,se=C[y[re].source].getFeatureState(J.layer["source-layer"],J.id);J.source=J.layer.source,J.layer["source-layer"]&&(J.sourceLayer=J.layer["source-layer"]),J.state=se});return V}(this._layers,_,this.sourceCaches,t,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(d)}querySourceFeatures(t,n){n&&n.filter&&this._validate(a.y.filter,"querySourceFeatures.filter",n.filter,null,n);const o=this.sourceCaches[t];return o?function(c,d){const _=c.getRenderableIds().map(C=>c.getTileByID(C)),y=[],x={};for(let C=0;C<_.length;C++){const E=_[C],P=E.tileID.canonical.key;x[P]||(x[P]=!0,E.querySourceFeatures(y,d))}return y}(o,n):[]}addSourceType(t,n,o){return Ti(t)?o(new Error(`A source type called "${t}" already exists.`)):(((c,d)=>{Xt[c]=d})(t,n),n.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:n.workerSourceURL},o):o(null,null))}getLight(){return this.light.getLight()}setLight(t,n={}){this._checkLoaded();const o=this.light.getLight();let c=!1;for(const _ in t)if(!a.aG(t[_],o[_])){c=!0;break}if(!c)return;const d={now:a.h.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,n),this.light.updateTransitions(d)}_validate(t,n,o,c,d={}){return(!d||d.validate!==!1)&&Qi(this,t.call(a.y,a.e({key:n,style:this.serialize(),value:o,styleSpec:a.v},c)))}_remove(t=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.aJ.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this.sourceCaches){const o=this.sourceCaches[n];o.setEventedParent(null),o.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const n in this.sourceCaches)this.sourceCaches[n].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,n,o,c,d=!1){let _=!1,y=!1;const x={};for(const C of this._order){const E=this._layers[C];if(E.type!=="symbol")continue;if(!x[E.source]){const L=this.sourceCaches[E.source];x[E.source]=L.getRenderableIds(!0).map(U=>L.getTileByID(U)).sort((U,V)=>V.tileID.overscaledZ-U.tileID.overscaledZ||(U.tileID.isLessThan(V.tileID)?-1:1))}const P=this.crossTileSymbolIndex.addLayer(E,x[E.source],t.center.lng);_=_||P}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((d=d||this._layerOrderChanged||o===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.h.now(),t.zoom))&&(this.pauseablePlacement=new rs(t,this.map.terrain,this._order,d,n,o,c,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,x),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.h.now()),y=!0),_&&this.pauseablePlacement.placement.setStale()),y||_)for(const C of this._order){const E=this._layers[C];E.type==="symbol"&&this.placement.updateLayerOpacities(E,x[E.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.h.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,n,o){this.imageManager.getImages(n.icons,o),this._updateTilesForChangedImages();const c=this.sourceCaches[n.source];c&&c.setDependencies(n.tileID.key,n.type,n.icons)}getGlyphs(t,n,o){this.glyphManager.getGlyphs(n.stacks,o);const c=this.sourceCaches[n.source];c&&c.setDependencies(n.tileID.key,n.type,[""])}getResource(t,n,o){return a.m(n,o)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,n={}){this._checkLoaded(),t&&this._validate(a.y.glyphs,"glyphs",t,null,n)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,n,o={},c){this._checkLoaded();const d=[{id:t,url:n}],_=[...Ge(this.stylesheet.sprite),...d];this._validate(a.y.sprite,"sprite",_,null,o)||(this.stylesheet.sprite=_,this._loadSprite(d,!0,c))}removeSprite(t){this._checkLoaded();const n=Ge(this.stylesheet.sprite);if(n.find(o=>o.id===t)){if(this._spritesImagesIds[t])for(const o of this._spritesImagesIds[t])this.imageManager.removeImage(o),this._changedImages[o]=!0;n.splice(n.findIndex(o=>o.id===t),1),this.stylesheet.sprite=n.length>0?n:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}else this.fire(new a.j(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return Ge(this.stylesheet.sprite)}setSprite(t,n={},o){this._checkLoaded(),t&&this._validate(a.y.sprite,"sprite",t,null,n)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,o):(this._unloadSprite(),o&&o(null)))}}Gi.registerForPluginStateChange=a.aK;var ta=a.Q([{name:"a_pos",type:"Int16",components:2}]),ss="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const ci={prelude:Ot(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Ot(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Ot(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Ot(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Ot("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ot(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Ot(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Ot("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ot("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Ot("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Ot(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Ot(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Ot(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Ot(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Ot(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Ot(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Ot(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ot(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Ot(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Ot(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Ot(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Ot(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Ot(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Ot(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Ot(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Ot(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Ot("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",ss),terrainDepth:Ot("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",ss),terrainCoords:Ot("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",ss)};function Ot(u,t){const n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,o=t.match(/attribute ([\w]+) ([\w]+)/g),c=u.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),d=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),_=d?d.concat(c):c,y={};return{fragmentSource:u=u.replace(n,(x,C,E,P,L)=>(y[L]=!0,C==="define"?`
#ifndef HAS_UNIFORM_u_${L}
varying ${E} ${P} ${L};
#else
uniform ${E} ${P} u_${L};
#endif
`:`
#ifdef HAS_UNIFORM_u_${L}
    ${E} ${P} ${L} = u_${L};
#endif
`)),vertexSource:t=t.replace(n,(x,C,E,P,L)=>{const U=P==="float"?"vec2":"vec4",V=L.match(/color/)?"color":U;return y[L]?C==="define"?`
#ifndef HAS_UNIFORM_u_${L}
uniform lowp float u_${L}_t;
attribute ${E} ${U} a_${L};
varying ${E} ${P} ${L};
#else
uniform ${E} ${P} u_${L};
#endif
`:V==="vec4"?`
#ifndef HAS_UNIFORM_u_${L}
    ${L} = a_${L};
#else
    ${E} ${P} ${L} = u_${L};
#endif
`:`
#ifndef HAS_UNIFORM_u_${L}
    ${L} = unpack_mix_${V}(a_${L}, u_${L}_t);
#else
    ${E} ${P} ${L} = u_${L};
#endif
`:C==="define"?`
#ifndef HAS_UNIFORM_u_${L}
uniform lowp float u_${L}_t;
attribute ${E} ${U} a_${L};
#else
uniform ${E} ${P} u_${L};
#endif
`:V==="vec4"?`
#ifndef HAS_UNIFORM_u_${L}
    ${E} ${P} ${L} = a_${L};
#else
    ${E} ${P} ${L} = u_${L};
#endif
`:`
#ifndef HAS_UNIFORM_u_${L}
    ${E} ${P} ${L} = unpack_mix_${V}(a_${L}, u_${L}_t);
#else
    ${E} ${P} ${L} = u_${L};
#endif
`}),staticAttributes:o,staticUniforms:_}}class Nn{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,n,o,c,d,_,y,x,C){this.context=t;let E=this.boundPaintVertexBuffers.length!==c.length;for(let P=0;!E&&P<c.length;P++)this.boundPaintVertexBuffers[P]!==c[P]&&(E=!0);!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==o||E||this.boundIndexBuffer!==d||this.boundVertexOffset!==_||this.boundDynamicVertexBuffer!==y||this.boundDynamicVertexBuffer2!==x||this.boundDynamicVertexBuffer3!==C?this.freshBind(n,o,c,d,_,y,x,C):(t.bindVertexArray.set(this.vao),y&&y.bind(),d&&d.dynamicDraw&&d.bind(),x&&x.bind(),C&&C.bind())}freshBind(t,n,o,c,d,_,y,x){const C=t.numAttributes,E=this.context,P=E.gl;this.vao&&this.destroy(),this.vao=E.createVertexArray(),E.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=o,this.boundIndexBuffer=c,this.boundVertexOffset=d,this.boundDynamicVertexBuffer=_,this.boundDynamicVertexBuffer2=y,this.boundDynamicVertexBuffer3=x,n.enableAttributes(P,t);for(const L of o)L.enableAttributes(P,t);_&&_.enableAttributes(P,t),y&&y.enableAttributes(P,t),x&&x.enableAttributes(P,t),n.bind(),n.setVertexAttribPointers(P,t,d);for(const L of o)L.bind(),L.setVertexAttribPointers(P,t,d);_&&(_.bind(),_.setVertexAttribPointers(P,t,d)),c&&c.bind(),y&&(y.bind(),y.setVertexAttribPointers(P,t,d)),x&&(x.bind(),x.setVertexAttribPointers(P,t,d)),E.currentNumAttributes=C}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function pi(u){const t=[];for(let n=0;n<u.length;n++){if(u[n]===null)continue;const o=u[n].split(" ");t.push(o.pop())}return t}class ia{constructor(t,n,o,c,d,_){const y=t.gl;this.program=y.createProgram();const x=pi(n.staticAttributes),C=o?o.getBinderAttributes():[],E=x.concat(C),P=ci.prelude.staticUniforms?pi(ci.prelude.staticUniforms):[],L=n.staticUniforms?pi(n.staticUniforms):[],U=o?o.getBinderUniforms():[],V=P.concat(L).concat(U),G=[];for(const fe of V)G.indexOf(fe)<0&&G.push(fe);const N=o?o.defines():[];d&&N.push("#define OVERDRAW_INSPECTOR;"),_&&N.push("#define TERRAIN3D;");const re=N.concat(ci.prelude.fragmentSource,n.fragmentSource).join(`
`),he=N.concat(ci.prelude.vertexSource,n.vertexSource).join(`
`),J=y.createShader(y.FRAGMENT_SHADER);if(y.isContextLost())return void(this.failedToCreate=!0);if(y.shaderSource(J,re),y.compileShader(J),!y.getShaderParameter(J,y.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${y.getShaderInfoLog(J)}`);y.attachShader(this.program,J);const se=y.createShader(y.VERTEX_SHADER);if(y.isContextLost())return void(this.failedToCreate=!0);if(y.shaderSource(se,he),y.compileShader(se),!y.getShaderParameter(se,y.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${y.getShaderInfoLog(se)}`);y.attachShader(this.program,se),this.attributes={};const pe={};this.numAttributes=E.length;for(let fe=0;fe<this.numAttributes;fe++)E[fe]&&(y.bindAttribLocation(this.program,fe,E[fe]),this.attributes[E[fe]]=fe);if(y.linkProgram(this.program),!y.getProgramParameter(this.program,y.LINK_STATUS))throw new Error(`Program failed to link: ${y.getProgramInfoLog(this.program)}`);y.deleteShader(se),y.deleteShader(J);for(let fe=0;fe<G.length;fe++){const be=G[fe];if(be&&!pe[be]){const Pe=y.getUniformLocation(this.program,be);Pe&&(pe[be]=Pe)}}this.fixedUniforms=c(t,pe),this.terrainUniforms=((fe,be)=>({u_depth:new a.aL(fe,be.u_depth),u_terrain:new a.aL(fe,be.u_terrain),u_terrain_dim:new a.aM(fe,be.u_terrain_dim),u_terrain_matrix:new a.aN(fe,be.u_terrain_matrix),u_terrain_unpack:new a.aO(fe,be.u_terrain_unpack),u_terrain_exaggeration:new a.aM(fe,be.u_terrain_exaggeration)}))(t,pe),this.binderUniforms=o?o.getUniforms(t,pe):[]}draw(t,n,o,c,d,_,y,x,C,E,P,L,U,V,G,N,re,he){const J=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(o),t.setStencilMode(c),t.setColorMode(d),t.setCullFace(_),x){t.activeTexture.set(J.TEXTURE2),J.bindTexture(J.TEXTURE_2D,x.depthTexture),t.activeTexture.set(J.TEXTURE3),J.bindTexture(J.TEXTURE_2D,x.texture);for(const pe in this.terrainUniforms)this.terrainUniforms[pe].set(x[pe])}for(const pe in this.fixedUniforms)this.fixedUniforms[pe].set(y[pe]);G&&G.setUniforms(t,this.binderUniforms,U,{zoom:V});let se=0;switch(n){case J.LINES:se=2;break;case J.TRIANGLES:se=3;break;case J.LINE_STRIP:se=1}for(const pe of L.get()){const fe=pe.vaos||(pe.vaos={});(fe[C]||(fe[C]=new Nn)).bind(t,this,E,G?G.getPaintVertexBuffers():[],P,pe.vertexOffset,N,re,he),J.drawElements(n,pe.primitiveLength*se,J.UNSIGNED_SHORT,pe.primitiveOffset*se*2)}}}function Or(u,t,n){const o=1/te(n,1,t.transform.tileZoom),c=Math.pow(2,n.tileID.overscaledZ),d=n.tileSize*Math.pow(2,t.transform.tileZoom)/c,_=d*(n.tileID.canonical.x+n.tileID.wrap*c),y=d*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[o,u.fromScale,u.toScale],u_fade:u.t,u_pixel_coord_upper:[_>>16,y>>16],u_pixel_coord_lower:[65535&_,65535&y]}}const Za=(u,t,n,o)=>{const c=t.style.light,d=c.properties.get("position"),_=[d.x,d.y,d.z],y=function(){var C=new a.A(9);return a.A!=Float32Array&&(C[1]=0,C[2]=0,C[3]=0,C[5]=0,C[6]=0,C[7]=0),C[0]=1,C[4]=1,C[8]=1,C}();c.properties.get("anchor")==="viewport"&&function(C,E){var P=Math.sin(E),L=Math.cos(E);C[0]=L,C[1]=P,C[2]=0,C[3]=-P,C[4]=L,C[5]=0,C[6]=0,C[7]=0,C[8]=1}(y,-t.transform.angle),function(C,E,P){var L=E[0],U=E[1],V=E[2];C[0]=L*P[0]+U*P[3]+V*P[6],C[1]=L*P[1]+U*P[4]+V*P[7],C[2]=L*P[2]+U*P[5]+V*P[8]}(_,_,y);const x=c.properties.get("color");return{u_matrix:u,u_lightpos:_,u_lightintensity:c.properties.get("intensity"),u_lightcolor:[x.r,x.g,x.b],u_vertical_gradient:+n,u_opacity:o}},Pn=(u,t,n,o,c,d,_)=>a.e(Za(u,t,n,o),Or(d,t,_),{u_height_factor:-Math.pow(2,c.overscaledZ)/_.tileSize/8}),al=u=>({u_matrix:u}),Ga=(u,t,n,o)=>a.e(al(u),Or(n,t,o)),ra=(u,t)=>({u_matrix:u,u_world:t}),na=(u,t,n,o,c)=>a.e(Ga(u,t,n,o),{u_world:c}),An=(u,t,n,o)=>{const c=u.transform;let d,_;if(o.paint.get("circle-pitch-alignment")==="map"){const y=te(n,1,c.zoom);d=!0,_=[y,y]}else d=!1,_=c.pixelsToGLUnits;return{u_camera_to_center_distance:c.cameraToCenterDistance,u_scale_with_map:+(o.paint.get("circle-pitch-scale")==="map"),u_matrix:u.translatePosMatrix(t.posMatrix,n,o.paint.get("circle-translate"),o.paint.get("circle-translate-anchor")),u_pitch_with_map:+d,u_device_pixel_ratio:u.pixelRatio,u_extrude_scale:_}},Ha=(u,t,n)=>{const o=te(n,1,t.zoom),c=Math.pow(2,t.zoom-n.tileID.overscaledZ),d=n.tileID.overscaleFactor();return{u_matrix:u,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:o,u_extrude_scale:[t.pixelsToGLUnits[0]/(o*c),t.pixelsToGLUnits[1]/(o*c)],u_overscale_factor:d}},As=(u,t,n=1)=>({u_matrix:u,u_color:t,u_overlay:0,u_overlay_scale:n}),ol=u=>({u_matrix:u}),$c=(u,t,n,o)=>({u_matrix:u,u_extrude_scale:te(t,1,n),u_intensity:o});function Wa(u,t){const n=Math.pow(2,t.canonical.z),o=t.canonical.y;return[new a.U(0,o/n).toLngLat().lat,new a.U(0,(o+1)/n).toLngLat().lat]}const Xa=(u,t,n,o)=>{const c=u.transform;return{u_matrix:sa(u,t,n,o),u_ratio:1/te(t,1,c.zoom),u_device_pixel_ratio:u.pixelRatio,u_units_to_pixels:[1/c.pixelsToGLUnits[0],1/c.pixelsToGLUnits[1]]}},ll=(u,t,n,o,c)=>a.e(Xa(u,t,n,c),{u_image:0,u_image_height:o}),Nc=(u,t,n,o,c)=>{const d=u.transform,_=ul(t,d);return{u_matrix:sa(u,t,n,c),u_texsize:t.imageAtlasTexture.size,u_ratio:1/te(t,1,d.zoom),u_device_pixel_ratio:u.pixelRatio,u_image:0,u_scale:[_,o.fromScale,o.toScale],u_fade:o.t,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},cl=(u,t,n,o,c,d)=>{const _=u.lineAtlas,y=ul(t,u.transform),x=n.layout.get("line-cap")==="round",C=_.getDash(o.from,x),E=_.getDash(o.to,x),P=C.width*c.fromScale,L=E.width*c.toScale;return a.e(Xa(u,t,n,d),{u_patternscale_a:[y/P,-C.height/2],u_patternscale_b:[y/L,-E.height/2],u_sdfgamma:_.width/(256*Math.min(P,L)*u.pixelRatio)/2,u_image:0,u_tex_y_a:C.y,u_tex_y_b:E.y,u_mix:c.t})};function ul(u,t){return 1/te(u,1,t.tileZoom)}function sa(u,t,n,o){return u.translatePosMatrix(o?o.posMatrix:t.tileID.posMatrix,t,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const hl=(u,t,n,o,c)=>{return{u_matrix:u,u_tl_parent:t,u_scale_parent:n,u_buffer_scale:1,u_fade_t:o.mix,u_opacity:o.opacity*c.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:c.paint.get("raster-brightness-min"),u_brightness_high:c.paint.get("raster-brightness-max"),u_saturation_factor:(_=c.paint.get("raster-saturation"),_>0?1-1/(1.001-_):-_),u_contrast_factor:(d=c.paint.get("raster-contrast"),d>0?1/(1-d):1+d),u_spin_weights:dl(c.paint.get("raster-hue-rotate"))};var d,_};function dl(u){u*=Math.PI/180;const t=Math.sin(u),n=Math.cos(u);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}const Ka=(u,t,n,o,c,d,_,y,x,C)=>{const E=c.transform;return{u_is_size_zoom_constant:+(u==="constant"||u==="source"),u_is_size_feature_constant:+(u==="constant"||u==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:E.cameraToCenterDistance,u_pitch:E.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:E.width/E.height,u_fade_change:c.options.fadeDuration?c.symbolFadeChange:1,u_matrix:d,u_label_plane_matrix:_,u_coord_matrix:y,u_is_text:+x,u_pitch_with_map:+o,u_texsize:C,u_texture:0}},Ja=(u,t,n,o,c,d,_,y,x,C,E)=>{const P=c.transform;return a.e(Ka(u,t,n,o,c,d,_,y,x,C),{u_gamma_scale:o?Math.cos(P._pitch)*P.cameraToCenterDistance:1,u_device_pixel_ratio:c.pixelRatio,u_is_halo:+E})},jn=(u,t,n,o,c,d,_,y,x,C)=>a.e(Ja(u,t,n,o,c,d,_,y,!0,x,!0),{u_texsize_icon:C,u_texture_icon:1}),aa=(u,t,n)=>({u_matrix:u,u_opacity:t,u_color:n}),$r=(u,t,n,o,c,d)=>a.e(function(_,y,x,C){const E=x.imageManager.getPattern(_.from.toString()),P=x.imageManager.getPattern(_.to.toString()),{width:L,height:U}=x.imageManager.getPixelSize(),V=Math.pow(2,C.tileID.overscaledZ),G=C.tileSize*Math.pow(2,x.transform.tileZoom)/V,N=G*(C.tileID.canonical.x+C.tileID.wrap*V),re=G*C.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:E.tl,u_pattern_br_a:E.br,u_pattern_tl_b:P.tl,u_pattern_br_b:P.br,u_texsize:[L,U],u_mix:y.t,u_pattern_size_a:E.displaySize,u_pattern_size_b:P.displaySize,u_scale_a:y.fromScale,u_scale_b:y.toScale,u_tile_units_to_pixels:1/te(C,1,x.transform.tileZoom),u_pixel_coord_upper:[N>>16,re>>16],u_pixel_coord_lower:[65535&N,65535&re]}}(o,d,n,c),{u_matrix:u,u_opacity:t}),oa={fillExtrusion:(u,t)=>({u_matrix:new a.aN(u,t.u_matrix),u_lightpos:new a.aP(u,t.u_lightpos),u_lightintensity:new a.aM(u,t.u_lightintensity),u_lightcolor:new a.aP(u,t.u_lightcolor),u_vertical_gradient:new a.aM(u,t.u_vertical_gradient),u_opacity:new a.aM(u,t.u_opacity)}),fillExtrusionPattern:(u,t)=>({u_matrix:new a.aN(u,t.u_matrix),u_lightpos:new a.aP(u,t.u_lightpos),u_lightintensity:new a.aM(u,t.u_lightintensity),u_lightcolor:new a.aP(u,t.u_lightcolor),u_vertical_gradient:new a.aM(u,t.u_vertical_gradient),u_height_factor:new a.aM(u,t.u_height_factor),u_image:new a.aL(u,t.u_image),u_texsize:new a.aQ(u,t.u_texsize),u_pixel_coord_upper:new a.aQ(u,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.aQ(u,t.u_pixel_coord_lower),u_scale:new a.aP(u,t.u_scale),u_fade:new a.aM(u,t.u_fade),u_opacity:new a.aM(u,t.u_opacity)}),fill:(u,t)=>({u_matrix:new a.aN(u,t.u_matrix)}),fillPattern:(u,t)=>({u_matrix:new a.aN(u,t.u_matrix),u_image:new a.aL(u,t.u_image),u_texsize:new a.aQ(u,t.u_texsize),u_pixel_coord_upper:new a.aQ(u,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.aQ(u,t.u_pixel_coord_lower),u_scale:new a.aP(u,t.u_scale),u_fade:new a.aM(u,t.u_fade)}),fillOutline:(u,t)=>({u_matrix:new a.aN(u,t.u_matrix),u_world:new a.aQ(u,t.u_world)}),fillOutlinePattern:(u,t)=>({u_matrix:new a.aN(u,t.u_matrix),u_world:new a.aQ(u,t.u_world),u_image:new a.aL(u,t.u_image),u_texsize:new a.aQ(u,t.u_texsize),u_pixel_coord_upper:new a.aQ(u,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.aQ(u,t.u_pixel_coord_lower),u_scale:new a.aP(u,t.u_scale),u_fade:new a.aM(u,t.u_fade)}),circle:(u,t)=>({u_camera_to_center_distance:new a.aM(u,t.u_camera_to_center_distance),u_scale_with_map:new a.aL(u,t.u_scale_with_map),u_pitch_with_map:new a.aL(u,t.u_pitch_with_map),u_extrude_scale:new a.aQ(u,t.u_extrude_scale),u_device_pixel_ratio:new a.aM(u,t.u_device_pixel_ratio),u_matrix:new a.aN(u,t.u_matrix)}),collisionBox:(u,t)=>({u_matrix:new a.aN(u,t.u_matrix),u_camera_to_center_distance:new a.aM(u,t.u_camera_to_center_distance),u_pixels_to_tile_units:new a.aM(u,t.u_pixels_to_tile_units),u_extrude_scale:new a.aQ(u,t.u_extrude_scale),u_overscale_factor:new a.aM(u,t.u_overscale_factor)}),collisionCircle:(u,t)=>({u_matrix:new a.aN(u,t.u_matrix),u_inv_matrix:new a.aN(u,t.u_inv_matrix),u_camera_to_center_distance:new a.aM(u,t.u_camera_to_center_distance),u_viewport_size:new a.aQ(u,t.u_viewport_size)}),debug:(u,t)=>({u_color:new a.aR(u,t.u_color),u_matrix:new a.aN(u,t.u_matrix),u_overlay:new a.aL(u,t.u_overlay),u_overlay_scale:new a.aM(u,t.u_overlay_scale)}),clippingMask:(u,t)=>({u_matrix:new a.aN(u,t.u_matrix)}),heatmap:(u,t)=>({u_extrude_scale:new a.aM(u,t.u_extrude_scale),u_intensity:new a.aM(u,t.u_intensity),u_matrix:new a.aN(u,t.u_matrix)}),heatmapTexture:(u,t)=>({u_matrix:new a.aN(u,t.u_matrix),u_world:new a.aQ(u,t.u_world),u_image:new a.aL(u,t.u_image),u_color_ramp:new a.aL(u,t.u_color_ramp),u_opacity:new a.aM(u,t.u_opacity)}),hillshade:(u,t)=>({u_matrix:new a.aN(u,t.u_matrix),u_image:new a.aL(u,t.u_image),u_latrange:new a.aQ(u,t.u_latrange),u_light:new a.aQ(u,t.u_light),u_shadow:new a.aR(u,t.u_shadow),u_highlight:new a.aR(u,t.u_highlight),u_accent:new a.aR(u,t.u_accent)}),hillshadePrepare:(u,t)=>({u_matrix:new a.aN(u,t.u_matrix),u_image:new a.aL(u,t.u_image),u_dimension:new a.aQ(u,t.u_dimension),u_zoom:new a.aM(u,t.u_zoom),u_unpack:new a.aO(u,t.u_unpack)}),line:(u,t)=>({u_matrix:new a.aN(u,t.u_matrix),u_ratio:new a.aM(u,t.u_ratio),u_device_pixel_ratio:new a.aM(u,t.u_device_pixel_ratio),u_units_to_pixels:new a.aQ(u,t.u_units_to_pixels)}),lineGradient:(u,t)=>({u_matrix:new a.aN(u,t.u_matrix),u_ratio:new a.aM(u,t.u_ratio),u_device_pixel_ratio:new a.aM(u,t.u_device_pixel_ratio),u_units_to_pixels:new a.aQ(u,t.u_units_to_pixels),u_image:new a.aL(u,t.u_image),u_image_height:new a.aM(u,t.u_image_height)}),linePattern:(u,t)=>({u_matrix:new a.aN(u,t.u_matrix),u_texsize:new a.aQ(u,t.u_texsize),u_ratio:new a.aM(u,t.u_ratio),u_device_pixel_ratio:new a.aM(u,t.u_device_pixel_ratio),u_image:new a.aL(u,t.u_image),u_units_to_pixels:new a.aQ(u,t.u_units_to_pixels),u_scale:new a.aP(u,t.u_scale),u_fade:new a.aM(u,t.u_fade)}),lineSDF:(u,t)=>({u_matrix:new a.aN(u,t.u_matrix),u_ratio:new a.aM(u,t.u_ratio),u_device_pixel_ratio:new a.aM(u,t.u_device_pixel_ratio),u_units_to_pixels:new a.aQ(u,t.u_units_to_pixels),u_patternscale_a:new a.aQ(u,t.u_patternscale_a),u_patternscale_b:new a.aQ(u,t.u_patternscale_b),u_sdfgamma:new a.aM(u,t.u_sdfgamma),u_image:new a.aL(u,t.u_image),u_tex_y_a:new a.aM(u,t.u_tex_y_a),u_tex_y_b:new a.aM(u,t.u_tex_y_b),u_mix:new a.aM(u,t.u_mix)}),raster:(u,t)=>({u_matrix:new a.aN(u,t.u_matrix),u_tl_parent:new a.aQ(u,t.u_tl_parent),u_scale_parent:new a.aM(u,t.u_scale_parent),u_buffer_scale:new a.aM(u,t.u_buffer_scale),u_fade_t:new a.aM(u,t.u_fade_t),u_opacity:new a.aM(u,t.u_opacity),u_image0:new a.aL(u,t.u_image0),u_image1:new a.aL(u,t.u_image1),u_brightness_low:new a.aM(u,t.u_brightness_low),u_brightness_high:new a.aM(u,t.u_brightness_high),u_saturation_factor:new a.aM(u,t.u_saturation_factor),u_contrast_factor:new a.aM(u,t.u_contrast_factor),u_spin_weights:new a.aP(u,t.u_spin_weights)}),symbolIcon:(u,t)=>({u_is_size_zoom_constant:new a.aL(u,t.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aL(u,t.u_is_size_feature_constant),u_size_t:new a.aM(u,t.u_size_t),u_size:new a.aM(u,t.u_size),u_camera_to_center_distance:new a.aM(u,t.u_camera_to_center_distance),u_pitch:new a.aM(u,t.u_pitch),u_rotate_symbol:new a.aL(u,t.u_rotate_symbol),u_aspect_ratio:new a.aM(u,t.u_aspect_ratio),u_fade_change:new a.aM(u,t.u_fade_change),u_matrix:new a.aN(u,t.u_matrix),u_label_plane_matrix:new a.aN(u,t.u_label_plane_matrix),u_coord_matrix:new a.aN(u,t.u_coord_matrix),u_is_text:new a.aL(u,t.u_is_text),u_pitch_with_map:new a.aL(u,t.u_pitch_with_map),u_texsize:new a.aQ(u,t.u_texsize),u_texture:new a.aL(u,t.u_texture)}),symbolSDF:(u,t)=>({u_is_size_zoom_constant:new a.aL(u,t.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aL(u,t.u_is_size_feature_constant),u_size_t:new a.aM(u,t.u_size_t),u_size:new a.aM(u,t.u_size),u_camera_to_center_distance:new a.aM(u,t.u_camera_to_center_distance),u_pitch:new a.aM(u,t.u_pitch),u_rotate_symbol:new a.aL(u,t.u_rotate_symbol),u_aspect_ratio:new a.aM(u,t.u_aspect_ratio),u_fade_change:new a.aM(u,t.u_fade_change),u_matrix:new a.aN(u,t.u_matrix),u_label_plane_matrix:new a.aN(u,t.u_label_plane_matrix),u_coord_matrix:new a.aN(u,t.u_coord_matrix),u_is_text:new a.aL(u,t.u_is_text),u_pitch_with_map:new a.aL(u,t.u_pitch_with_map),u_texsize:new a.aQ(u,t.u_texsize),u_texture:new a.aL(u,t.u_texture),u_gamma_scale:new a.aM(u,t.u_gamma_scale),u_device_pixel_ratio:new a.aM(u,t.u_device_pixel_ratio),u_is_halo:new a.aL(u,t.u_is_halo)}),symbolTextAndIcon:(u,t)=>({u_is_size_zoom_constant:new a.aL(u,t.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aL(u,t.u_is_size_feature_constant),u_size_t:new a.aM(u,t.u_size_t),u_size:new a.aM(u,t.u_size),u_camera_to_center_distance:new a.aM(u,t.u_camera_to_center_distance),u_pitch:new a.aM(u,t.u_pitch),u_rotate_symbol:new a.aL(u,t.u_rotate_symbol),u_aspect_ratio:new a.aM(u,t.u_aspect_ratio),u_fade_change:new a.aM(u,t.u_fade_change),u_matrix:new a.aN(u,t.u_matrix),u_label_plane_matrix:new a.aN(u,t.u_label_plane_matrix),u_coord_matrix:new a.aN(u,t.u_coord_matrix),u_is_text:new a.aL(u,t.u_is_text),u_pitch_with_map:new a.aL(u,t.u_pitch_with_map),u_texsize:new a.aQ(u,t.u_texsize),u_texsize_icon:new a.aQ(u,t.u_texsize_icon),u_texture:new a.aL(u,t.u_texture),u_texture_icon:new a.aL(u,t.u_texture_icon),u_gamma_scale:new a.aM(u,t.u_gamma_scale),u_device_pixel_ratio:new a.aM(u,t.u_device_pixel_ratio),u_is_halo:new a.aL(u,t.u_is_halo)}),background:(u,t)=>({u_matrix:new a.aN(u,t.u_matrix),u_opacity:new a.aM(u,t.u_opacity),u_color:new a.aR(u,t.u_color)}),backgroundPattern:(u,t)=>({u_matrix:new a.aN(u,t.u_matrix),u_opacity:new a.aM(u,t.u_opacity),u_image:new a.aL(u,t.u_image),u_pattern_tl_a:new a.aQ(u,t.u_pattern_tl_a),u_pattern_br_a:new a.aQ(u,t.u_pattern_br_a),u_pattern_tl_b:new a.aQ(u,t.u_pattern_tl_b),u_pattern_br_b:new a.aQ(u,t.u_pattern_br_b),u_texsize:new a.aQ(u,t.u_texsize),u_mix:new a.aM(u,t.u_mix),u_pattern_size_a:new a.aQ(u,t.u_pattern_size_a),u_pattern_size_b:new a.aQ(u,t.u_pattern_size_b),u_scale_a:new a.aM(u,t.u_scale_a),u_scale_b:new a.aM(u,t.u_scale_b),u_pixel_coord_upper:new a.aQ(u,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.aQ(u,t.u_pixel_coord_lower),u_tile_units_to_pixels:new a.aM(u,t.u_tile_units_to_pixels)}),terrain:(u,t)=>({u_matrix:new a.aN(u,t.u_matrix),u_texture:new a.aL(u,t.u_texture),u_ele_delta:new a.aM(u,t.u_ele_delta)}),terrainDepth:(u,t)=>({u_matrix:new a.aN(u,t.u_matrix),u_ele_delta:new a.aM(u,t.u_ele_delta)}),terrainCoords:(u,t)=>({u_matrix:new a.aN(u,t.u_matrix),u_texture:new a.aL(u,t.u_texture),u_terrain_coords_id:new a.aM(u,t.u_terrain_coords_id),u_ele_delta:new a.aM(u,t.u_ele_delta)})};class la{constructor(t,n,o){this.context=t;const c=t.gl;this.buffer=c.createBuffer(),this.dynamicDraw=!!o,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),c.bufferData(c.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?c.DYNAMIC_DRAW:c.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const n=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ms={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ca{constructor(t,n,o,c){this.length=n.length,this.attributes=o,this.itemSize=n.bytesPerElement,this.dynamicDraw=c,this.context=t;const d=t.gl;this.buffer=d.createBuffer(),t.bindVertexBuffer.set(this.buffer),d.bufferData(d.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,n){for(let o=0;o<this.attributes.length;o++){const c=n.attributes[this.attributes[o].name];c!==void 0&&t.enableVertexAttribArray(c)}}setVertexAttribPointers(t,n,o){for(let c=0;c<this.attributes.length;c++){const d=this.attributes[c],_=n.attributes[d.name];_!==void 0&&t.vertexAttribPointer(_,d.components,t[Ms[d.type]],!1,this.itemSize,d.offset+this.itemSize*(o||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const as=new WeakMap;function Mn(u){var t;if(as.has(u))return as.get(u);{const n=(t=u.getParameter(u.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return as.set(u,n),n}}class zt{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ua extends zt{getDefault(){return a.aT.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Ir extends zt{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Er extends zt{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Ya extends zt{getDefault(){return[!0,!0,!0,!0]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class ha extends zt{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class da extends zt{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Qa extends zt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const n=this.current;(t.func!==n.func||t.ref!==n.ref||t.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class eo extends zt{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class pa extends zt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=t,this.dirty=!1}}class to extends zt{getDefault(){return[0,1]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class io extends zt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=t,this.dirty=!1}}class fa extends zt{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class pl extends zt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.BLEND):n.disable(n.BLEND),this.current=t,this.dirty=!1}}class fl extends zt{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class os extends zt{getDefault(){return a.aT.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class jc extends zt{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Vc extends zt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=t,this.dirty=!1}}class Uc extends zt{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class qc extends zt{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class Zc extends zt{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class Gc extends zt{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class ro extends zt{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class ma extends zt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class no extends zt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class so extends zt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class ls extends zt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ml extends zt{getDefault(){return null}set(t){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class gl extends zt{getDefault(){return null}set(t){var n;if(t===this.current&&!this.dirty)return;const o=this.gl;Mn(o)?o.bindVertexArray(t):(n=o.getExtension("OES_vertex_array_object"))===null||n===void 0||n.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class ao extends zt{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Vn extends zt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class _l extends zt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class kn extends zt{constructor(t,n){super(t),this.context=t,this.parent=n}getDefault(){return null}}class cs extends kn{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class yl extends kn{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class oo extends kn{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class $t{constructor(t,n,o,c,d){this.context=t,this.width=n,this.height=o;const _=t.gl,y=this.framebuffer=_.createFramebuffer();if(this.colorAttachment=new cs(t,y),c)this.depthAttachment=d?new oo(t,y):new yl(t,y);else if(d)throw new Error("Stencil cannot be setted without depth");if(_.checkFramebufferStatus(_.FRAMEBUFFER)!==_.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,n=this.colorAttachment.get();if(n&&t.deleteTexture(n),this.depthAttachment){const o=this.depthAttachment.get();o&&t.deleteRenderbuffer(o)}t.deleteFramebuffer(this.framebuffer)}}class ui{constructor(t,n,o){this.blendFunction=t,this.blendColor=n,this.mask=o}}ui.Replace=[1,0],ui.disabled=new ui(ui.Replace,a.aT.transparent,[!1,!1,!1,!1]),ui.unblended=new ui(ui.Replace,a.aT.transparent,[!0,!0,!0,!0]),ui.alphaBlended=new ui([1,771],a.aT.transparent,[!0,!0,!0,!0]);class Hc{constructor(t){var n,o;if(this.gl=t,this.clearColor=new ua(this),this.clearDepth=new Ir(this),this.clearStencil=new Er(this),this.colorMask=new Ya(this),this.depthMask=new ha(this),this.stencilMask=new da(this),this.stencilFunc=new Qa(this),this.stencilOp=new eo(this),this.stencilTest=new pa(this),this.depthRange=new to(this),this.depthTest=new io(this),this.depthFunc=new fa(this),this.blend=new pl(this),this.blendFunc=new fl(this),this.blendColor=new os(this),this.blendEquation=new jc(this),this.cullFace=new Vc(this),this.cullFaceSide=new Uc(this),this.frontFace=new qc(this),this.program=new Zc(this),this.activeTexture=new Gc(this),this.viewport=new ro(this),this.bindFramebuffer=new ma(this),this.bindRenderbuffer=new no(this),this.bindTexture=new so(this),this.bindVertexBuffer=new ls(this),this.bindElementBuffer=new ml(this),this.bindVertexArray=new gl(this),this.pixelStoreUnpack=new ao(this),this.pixelStoreUnpackPremultiplyAlpha=new Vn(this),this.pixelStoreUnpackFlipY=new _l(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),Mn(t)){this.HALF_FLOAT=t.HALF_FLOAT;const c=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(n=t.RGBA16F)!==null&&n!==void 0?n:c?.RGBA16F_EXT,this.RGB16F=(o=t.RGB16F)!==null&&o!==void 0?o:c?.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const c=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=c?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,n){return new la(this,t,n)}createVertexBuffer(t,n,o){return new ca(this,t,n,o)}createRenderbuffer(t,n,o){const c=this.gl,d=c.createRenderbuffer();return this.bindRenderbuffer.set(d),c.renderbufferStorage(c.RENDERBUFFER,t,n,o),this.bindRenderbuffer.set(null),d}createFramebuffer(t,n,o,c){return new $t(this,t,n,o,c)}clear({color:t,depth:n,stencil:o}){const c=this.gl;let d=0;t&&(d|=c.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),n!==void 0&&(d|=c.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),o!==void 0&&(d|=c.STENCIL_BUFFER_BIT,this.clearStencil.set(o),this.stencilMask.set(255)),c.clear(d)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){a.aG(t.blendFunction,ui.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return Mn(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var n;return Mn(this.gl)?this.gl.deleteVertexArray(t):(n=this.gl.getExtension("OES_vertex_array_object"))===null||n===void 0?void 0:n.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}class Dt{constructor(t,n,o){this.func=t,this.mask=n,this.range=o}}Dt.ReadOnly=!1,Dt.ReadWrite=!0,Dt.disabled=new Dt(519,Dt.ReadOnly,[0,1]);const Un=7680;class hi{constructor(t,n,o,c,d,_){this.test=t,this.ref=n,this.mask=o,this.fail=c,this.depthFail=d,this.pass=_}}hi.disabled=new hi({func:519,mask:0},0,0,Un,Un,Un);class oi{constructor(t,n,o){this.enable=t,this.mode=n,this.frontFace=o}}let ks;function vl(u,t,n,o,c,d,_){const y=u.context,x=y.gl,C=u.useProgram("collisionBox"),E=[];let P=0,L=0;for(let J=0;J<o.length;J++){const se=o[J],pe=t.getTile(se),fe=pe.getBucket(n);if(!fe)continue;let be=se.posMatrix;c[0]===0&&c[1]===0||(be=u.translatePosMatrix(se.posMatrix,pe,c,d));const Pe=_?fe.textCollisionBox:fe.iconCollisionBox,Ce=fe.collisionCircleArray;if(Ce.length>0){const Le=a.Z(),Ke=be;a.aU(Le,fe.placementInvProjMatrix,u.transform.glCoordMatrix),a.aU(Le,Le,fe.placementViewportMatrix),E.push({circleArray:Ce,circleOffset:L,transform:Ke,invTransform:Le,coord:se}),P+=Ce.length/4,L=P}Pe&&C.draw(y,x.LINES,Dt.disabled,hi.disabled,u.colorModeForRenderPass(),oi.disabled,Ha(be,u.transform,pe),u.style.map.terrain&&u.style.map.terrain.getTerrainData(se),n.id,Pe.layoutVertexBuffer,Pe.indexBuffer,Pe.segments,null,u.transform.zoom,null,null,Pe.collisionVertexBuffer)}if(!_||!E.length)return;const U=u.useProgram("collisionCircle"),V=new a.aV;V.resize(4*P),V._trim();let G=0;for(const J of E)for(let se=0;se<J.circleArray.length/4;se++){const pe=4*se,fe=J.circleArray[pe+0],be=J.circleArray[pe+1],Pe=J.circleArray[pe+2],Ce=J.circleArray[pe+3];V.emplace(G++,fe,be,Pe,Ce,0),V.emplace(G++,fe,be,Pe,Ce,1),V.emplace(G++,fe,be,Pe,Ce,2),V.emplace(G++,fe,be,Pe,Ce,3)}(!ks||ks.length<2*P)&&(ks=function(J){const se=2*J,pe=new a.aX;pe.resize(se),pe._trim();for(let fe=0;fe<se;fe++){const be=6*fe;pe.uint16[be+0]=4*fe+0,pe.uint16[be+1]=4*fe+1,pe.uint16[be+2]=4*fe+2,pe.uint16[be+3]=4*fe+2,pe.uint16[be+4]=4*fe+3,pe.uint16[be+5]=4*fe+0}return pe}(P));const N=y.createIndexBuffer(ks,!0),re=y.createVertexBuffer(V,a.aW.members,!0);for(const J of E){const se={u_matrix:J.transform,u_inv_matrix:J.invTransform,u_camera_to_center_distance:(he=u.transform).cameraToCenterDistance,u_viewport_size:[he.width,he.height]};U.draw(y,x.TRIANGLES,Dt.disabled,hi.disabled,u.colorModeForRenderPass(),oi.disabled,se,u.style.map.terrain&&u.style.map.terrain.getTerrainData(J.coord),n.id,re,N,a.S.simpleSegment(0,2*J.circleOffset,J.circleArray.length,J.circleArray.length/2),null,u.transform.zoom,null,null,null)}var he;re.destroy(),N.destroy()}oi.disabled=new oi(!1,1029,2305),oi.backCCW=new oi(!0,1029,2305);const lo=a.ao(new Float32Array(16));function ga(u,t,n,o,c,d){const{horizontalAlign:_,verticalAlign:y}=a.au(u);return new a.P((-(_-.5)*t/c+o[0])*d,(-(y-.5)*n/c+o[1])*d)}function _a(u,t,n,o,c,d,_,y,x,C,E){const P=u.text.placedSymbolArray,L=u.text.dynamicLayoutVertexArray,U=u.icon.dynamicLayoutVertexArray,V={};L.clear();for(let G=0;G<P.length;G++){const N=P.get(G),re=N.hidden||!N.crossTileID||u.allowVerticalPlacement&&!N.placedOrientation?null:o[N.crossTileID];if(re){const he=new a.P(N.anchorX,N.anchorY),J=dt(he,n?_:d,E),se=qt(c.cameraToCenterDistance,J.signedDistanceFromCamera);let pe=a.aj(u.textSizeData,x,N)*se/a.ap;n&&(pe*=u.tilePixelRatio/y);const{width:fe,height:be,anchor:Pe,textOffset:Ce,textBoxScale:Le}=re,Ke=ga(Pe,fe,be,Ce,Le,pe),Tt=n?dt(he.add(Ke),d,E).point:J.point.add(t?Ke.rotate(-c.angle):Ke),Oe=u.allowVerticalPlacement&&N.placedOrientation===a.ai.vertical?Math.PI/2:0;for(let ht=0;ht<N.numGlyphs;ht++)a.ak(L,Tt,Oe);C&&N.associatedIconIndex>=0&&(V[N.associatedIconIndex]={shiftedAnchor:Tt,angle:Oe})}else $(N.numGlyphs,L)}if(C){U.clear();const G=u.icon.placedSymbolArray;for(let N=0;N<G.length;N++){const re=G.get(N);if(re.hidden)$(re.numGlyphs,U);else{const he=V[N];if(he)for(let J=0;J<re.numGlyphs;J++)a.ak(U,he.shiftedAnchor,he.angle);else $(re.numGlyphs,U)}}u.icon.dynamicLayoutVertexBuffer.updateData(U)}u.text.dynamicLayoutVertexBuffer.updateData(L)}function co(u,t,n){return n.iconsInText&&t?"symbolTextAndIcon":u?"symbolSDF":"symbolIcon"}function ya(u,t,n,o,c,d,_,y,x,C,E,P){const L=u.context,U=L.gl,V=u.transform,G=y==="map",N=x==="map",re=y!=="viewport"&&n.layout.get("symbol-placement")!=="point",he=G&&!N&&!re,J=!n.layout.get("symbol-sort-key").isConstant();let se=!1;const pe=u.depthModeForSublayer(0,Dt.ReadOnly),fe=n._unevaluatedLayout.hasValue("text-variable-anchor")||n._unevaluatedLayout.hasValue("text-variable-anchor-offset"),be=[];for(const Pe of o){const Ce=t.getTile(Pe),Le=Ce.getBucket(n);if(!Le)continue;const Ke=c?Le.text:Le.icon;if(!Ke||!Ke.segments.get().length||!Ke.hasVisibleVertices)continue;const Tt=Ke.programConfigurations.get(n.id),Oe=c||Le.sdfIcons,ht=c?Le.textSizeData:Le.iconSizeData,Qe=N||V.pitch!==0,Gt=u.useProgram(co(Oe,c,Le),Tt),Ct=a.ah(ht,V.zoom),bt=u.style.map.terrain&&u.style.map.terrain.getTerrainData(Pe);let It,yi,ti,Hi,zi=[0,0],Si=null;if(c)yi=Ce.glyphAtlasTexture,ti=U.LINEAR,It=Ce.glyphAtlasTexture.size,Le.iconsInText&&(zi=Ce.imageAtlasTexture.size,Si=Ce.imageAtlasTexture,Hi=Qe||u.options.rotating||u.options.zooming||ht.kind==="composite"||ht.kind==="camera"?U.LINEAR:U.NEAREST);else{const vi=n.layout.get("icon-size").constantOr(0)!==1||Le.iconsNeedLinear;yi=Ce.imageAtlasTexture,ti=Oe||u.options.rotating||u.options.zooming||vi||Qe?U.LINEAR:U.NEAREST,It=Ce.imageAtlasTexture.size}const Mr=te(Ce,1,u.transform.zoom),ri=Re(Pe.posMatrix,N,G,u.transform,Mr),rn=mt(Pe.posMatrix,N,G,u.transform,Mr),nn=fe&&Le.hasTextData(),Ln=n.layout.get("icon-text-fit")!=="none"&&nn&&Le.hasIconData();if(re){const vi=u.style.map.terrain?(yr,xi)=>u.style.map.terrain.getElevation(Pe,yr,xi):null,Di=n.layout.get("text-rotation-alignment")==="map";Te(Le,Pe.posMatrix,u,c,ri,rn,N,C,Di,vi)}const Wn=u.translatePosMatrix(Pe.posMatrix,Ce,d,_),gs=re||c&&fe||Ln?lo:ri,er=u.translatePosMatrix(rn,Ce,d,_,!0),Wi=Oe&&n.paint.get(c?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let lr;lr=Oe?Le.iconsInText?jn(ht.kind,Ct,he,N,u,Wn,gs,er,It,zi):Ja(ht.kind,Ct,he,N,u,Wn,gs,er,c,It,!0):Ka(ht.kind,Ct,he,N,u,Wn,gs,er,c,It);const Xn={program:Gt,buffers:Ke,uniformValues:lr,atlasTexture:yi,atlasTextureIcon:Si,atlasInterpolation:ti,atlasInterpolationIcon:Hi,isSDF:Oe,hasHalo:Wi};if(J&&Le.canOverlap){se=!0;const vi=Ke.segments.get();for(const Di of vi)be.push({segments:new a.S([Di]),sortKey:Di.sortKey,state:Xn,terrainData:bt})}else be.push({segments:Ke.segments,sortKey:0,state:Xn,terrainData:bt})}se&&be.sort((Pe,Ce)=>Pe.sortKey-Ce.sortKey);for(const Pe of be){const Ce=Pe.state;if(L.activeTexture.set(U.TEXTURE0),Ce.atlasTexture.bind(Ce.atlasInterpolation,U.CLAMP_TO_EDGE),Ce.atlasTextureIcon&&(L.activeTexture.set(U.TEXTURE1),Ce.atlasTextureIcon&&Ce.atlasTextureIcon.bind(Ce.atlasInterpolationIcon,U.CLAMP_TO_EDGE)),Ce.isSDF){const Le=Ce.uniformValues;Ce.hasHalo&&(Le.u_is_halo=1,uo(Ce.buffers,Pe.segments,n,u,Ce.program,pe,E,P,Le,Pe.terrainData)),Le.u_is_halo=0}uo(Ce.buffers,Pe.segments,n,u,Ce.program,pe,E,P,Ce.uniformValues,Pe.terrainData)}}function uo(u,t,n,o,c,d,_,y,x,C){const E=o.context;c.draw(E,E.gl.TRIANGLES,d,_,y,oi.disabled,x,C,n.id,u.layoutVertexBuffer,u.indexBuffer,t,n.paint,o.transform.zoom,u.programConfigurations.get(n.id),u.dynamicLayoutVertexBuffer,u.opacityVertexBuffer)}function zs(u,t,n,o,c){if(!n||!o||!o.imageAtlas)return;const d=o.imageAtlas.patternPositions;let _=d[n.to.toString()],y=d[n.from.toString()];if(!_&&y&&(_=y),!y&&_&&(y=_),!_||!y){const x=c.getPaintProperty(t);_=d[x],y=d[x]}_&&y&&u.setConstantPatternPositions(_,y)}function Ds(u,t,n,o,c,d,_){const y=u.context.gl,x="fill-pattern",C=n.paint.get(x),E=C&&C.constantOr(1),P=n.getCrossfadeParameters();let L,U,V,G,N;_?(U=E&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=y.LINES):(U=E?"fillPattern":"fill",L=y.TRIANGLES);const re=C.constantOr(null);for(const he of o){const J=t.getTile(he);if(E&&!J.patternsLoaded())continue;const se=J.getBucket(n);if(!se)continue;const pe=se.programConfigurations.get(n.id),fe=u.useProgram(U,pe),be=u.style.map.terrain&&u.style.map.terrain.getTerrainData(he);E&&(u.context.activeTexture.set(y.TEXTURE0),J.imageAtlasTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),pe.updatePaintBuffers(P)),zs(pe,x,re,J,n);const Pe=be?he:null,Ce=u.translatePosMatrix(Pe?Pe.posMatrix:he.posMatrix,J,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));if(_){G=se.indexBuffer2,N=se.segments2;const Le=[y.drawingBufferWidth,y.drawingBufferHeight];V=U==="fillOutlinePattern"&&E?na(Ce,u,P,J,Le):ra(Ce,Le)}else G=se.indexBuffer,N=se.segments,V=E?Ga(Ce,u,P,J):al(Ce);fe.draw(u.context,L,c,u.stencilModeForClipping(he),d,oi.disabled,V,be,n.id,se.layoutVertexBuffer,G,N,n.paint,u.transform.zoom,pe)}}function Ls(u,t,n,o,c,d,_){const y=u.context,x=y.gl,C="fill-extrusion-pattern",E=n.paint.get(C),P=E.constantOr(1),L=n.getCrossfadeParameters(),U=n.paint.get("fill-extrusion-opacity"),V=E.constantOr(null);for(const G of o){const N=t.getTile(G),re=N.getBucket(n);if(!re)continue;const he=u.style.map.terrain&&u.style.map.terrain.getTerrainData(G),J=re.programConfigurations.get(n.id),se=u.useProgram(P?"fillExtrusionPattern":"fillExtrusion",J);P&&(u.context.activeTexture.set(x.TEXTURE0),N.imageAtlasTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE),J.updatePaintBuffers(L)),zs(J,C,V,N,n);const pe=u.translatePosMatrix(G.posMatrix,N,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),fe=n.paint.get("fill-extrusion-vertical-gradient"),be=P?Pn(pe,u,fe,U,G,L,N):Za(pe,u,fe,U);se.draw(y,y.gl.TRIANGLES,c,d,_,oi.backCCW,be,he,n.id,re.layoutVertexBuffer,re.indexBuffer,re.segments,n.paint,u.transform.zoom,J,u.style.map.terrain&&re.centroidVertexBuffer)}}function Wc(u,t,n,o,c,d,_){const y=u.context,x=y.gl,C=n.fbo;if(!C)return;const E=u.useProgram("hillshade"),P=u.style.map.terrain&&u.style.map.terrain.getTerrainData(t);y.activeTexture.set(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,C.colorAttachment.get()),E.draw(y,x.TRIANGLES,c,d,_,oi.disabled,((L,U,V,G)=>{const N=V.paint.get("hillshade-shadow-color"),re=V.paint.get("hillshade-highlight-color"),he=V.paint.get("hillshade-accent-color");let J=V.paint.get("hillshade-illumination-direction")*(Math.PI/180);V.paint.get("hillshade-illumination-anchor")==="viewport"&&(J-=L.transform.angle);const se=!L.options.moving;return{u_matrix:G?G.posMatrix:L.transform.calculatePosMatrix(U.tileID.toUnwrapped(),se),u_image:0,u_latrange:Wa(0,U.tileID),u_light:[V.paint.get("hillshade-exaggeration"),J],u_shadow:N,u_highlight:re,u_accent:he}})(u,n,o,P?t:null),P,o.id,u.rasterBoundsBuffer,u.quadTriangleIndexBuffer,u.rasterBoundsSegments)}function ho(u,t,n,o,c,d){const _=u.context,y=_.gl,x=t.dem;if(x&&x.data){const C=x.dim,E=x.stride,P=x.getPixels();if(_.activeTexture.set(y.TEXTURE1),_.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||u.getTileTexture(E),t.demTexture){const U=t.demTexture;U.update(P,{premultiply:!1}),U.bind(y.NEAREST,y.CLAMP_TO_EDGE)}else t.demTexture=new De(_,P,y.RGBA,{premultiply:!1}),t.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE);_.activeTexture.set(y.TEXTURE0);let L=t.fbo;if(!L){const U=new De(_,{width:C,height:C,data:null},y.RGBA);U.bind(y.LINEAR,y.CLAMP_TO_EDGE),L=t.fbo=_.createFramebuffer(C,C,!0,!1),L.colorAttachment.set(U.texture)}_.bindFramebuffer.set(L.framebuffer),_.viewport.set([0,0,C,C]),u.useProgram("hillshadePrepare").draw(_,y.TRIANGLES,o,c,d,oi.disabled,((U,V)=>{const G=V.stride,N=a.Z();return a.aS(N,0,a.N,-a.N,0,0,1),a.$(N,N,[0,-a.N,0]),{u_matrix:N,u_image:1,u_dimension:[G,G],u_zoom:U.overscaledZ,u_unpack:V.getUnpackVector()}})(t.tileID,x),null,n.id,u.rasterBoundsBuffer,u.quadTriangleIndexBuffer,u.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function Xc(u,t,n,o,c,d){const _=o.paint.get("raster-fade-duration");if(!d&&_>0){const y=a.h.now(),x=(y-u.timeAdded)/_,C=t?(y-t.timeAdded)/_:-1,E=n.getSource(),P=c.coveringZoomLevel({tileSize:E.tileSize,roundZoom:E.roundZoom}),L=!t||Math.abs(t.tileID.overscaledZ-P)>Math.abs(u.tileID.overscaledZ-P),U=L&&u.refreshedUponExpiration?1:a.ad(L?x:1-C,0,1);return u.refreshedUponExpiration&&x>=1&&(u.refreshedUponExpiration=!1),t?{opacity:1,mix:1-U}:{opacity:U,mix:0}}return{opacity:1,mix:0}}const xl=new a.aT(1,0,0,1),va=new a.aT(0,1,0,1),po=new a.aT(0,0,1,1),bl=new a.aT(1,0,1,1),wl=new a.aT(0,1,1,1);function Rs(u,t,n,o){ba(u,0,t+n/2,u.transform.width,n,o)}function xa(u,t,n,o){ba(u,t-n/2,0,n,u.transform.height,o)}function ba(u,t,n,o,c,d){const _=u.context,y=_.gl;y.enable(y.SCISSOR_TEST),y.scissor(t*u.pixelRatio,n*u.pixelRatio,o*u.pixelRatio,c*u.pixelRatio),_.clear({color:d}),y.disable(y.SCISSOR_TEST)}function Sl(u,t,n){const o=u.context,c=o.gl,d=n.posMatrix,_=u.useProgram("debug"),y=Dt.disabled,x=hi.disabled,C=u.colorModeForRenderPass(),E="$debug",P=u.style.map.terrain&&u.style.map.terrain.getTerrainData(n);o.activeTexture.set(c.TEXTURE0);const L=t.getTileByID(n.key).latestRawTileData,U=Math.floor((L&&L.byteLength||0)/1024),V=t.getTile(n).tileSize,G=512/Math.min(V,512)*(n.overscaledZ/u.transform.zoom)*.5;let N=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(N+=` => ${n.overscaledZ}`),function(re,he){re.initDebugOverlayCanvas();const J=re.debugOverlayCanvas,se=re.context.gl,pe=re.debugOverlayCanvas.getContext("2d");pe.clearRect(0,0,J.width,J.height),pe.shadowColor="white",pe.shadowBlur=2,pe.lineWidth=1.5,pe.strokeStyle="white",pe.textBaseline="top",pe.font="bold 36px Open Sans, sans-serif",pe.fillText(he,5,5),pe.strokeText(he,5,5),re.debugOverlayTexture.update(J),re.debugOverlayTexture.bind(se.LINEAR,se.CLAMP_TO_EDGE)}(u,`${N} ${U}kB`),_.draw(o,c.TRIANGLES,y,x,ui.alphaBlended,oi.disabled,As(d,a.aT.transparent,G),null,E,u.debugBuffer,u.quadTriangleIndexBuffer,u.debugSegments),_.draw(o,c.LINE_STRIP,y,x,C,oi.disabled,As(d,a.aT.red),P,E,u.debugBuffer,u.tileBorderIndexBuffer,u.debugSegments)}function fi(u,t,n){const o=u.context,c=o.gl,d=u.colorModeForRenderPass(),_=new Dt(c.LEQUAL,Dt.ReadWrite,u.depthRangeFor3D),y=u.useProgram("terrain"),x=t.getTerrainMesh();o.bindFramebuffer.set(null),o.viewport.set([0,0,u.width,u.height]);for(const C of n){const E=u.renderToTexture.getTexture(C),P=t.getTerrainData(C.tileID);o.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,E.texture);const L={u_matrix:u.transform.calculatePosMatrix(C.tileID.toUnwrapped()),u_texture:0,u_ele_delta:t.getMeshFrameDelta(u.transform.zoom)};y.draw(o,c.TRIANGLES,_,hi.disabled,d,oi.backCCW,L,P,"terrain",x.vertexBuffer,x.indexBuffer,x.segments)}}class qn{constructor(t,n){this.context=new Hc(t),this.transform=n,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.Z(),renderTime:0},this.setup(),this.numSublayers=Ii.maxUnderzooming+Ii.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ea}resize(t,n,o){if(this.width=Math.floor(t*o),this.height=Math.floor(n*o),this.pixelRatio=o,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const c of this.style._order)this.style._layers[c].resize()}setup(){const t=this.context,n=new a.a_;n.emplaceBack(0,0),n.emplaceBack(a.N,0),n.emplaceBack(0,a.N),n.emplaceBack(a.N,a.N),this.tileExtentBuffer=t.createVertexBuffer(n,ta.members),this.tileExtentSegments=a.S.simpleSegment(0,0,4,2);const o=new a.a_;o.emplaceBack(0,0),o.emplaceBack(a.N,0),o.emplaceBack(0,a.N),o.emplaceBack(a.N,a.N),this.debugBuffer=t.createVertexBuffer(o,ta.members),this.debugSegments=a.S.simpleSegment(0,0,4,5);const c=new a.V;c.emplaceBack(0,0,0,0),c.emplaceBack(a.N,0,a.N,0),c.emplaceBack(0,a.N,0,a.N),c.emplaceBack(a.N,a.N,a.N,a.N),this.rasterBoundsBuffer=t.createVertexBuffer(c,Qt.members),this.rasterBoundsSegments=a.S.simpleSegment(0,0,4,2);const d=new a.a_;d.emplaceBack(0,0),d.emplaceBack(1,0),d.emplaceBack(0,1),d.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(d,ta.members),this.viewportSegments=a.S.simpleSegment(0,0,4,2);const _=new a.a$;_.emplaceBack(0),_.emplaceBack(1),_.emplaceBack(3),_.emplaceBack(2),_.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(_);const y=new a.b0;y.emplaceBack(0,1,2),y.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(y);const x=this.context.gl;this.stencilClearMode=new hi({func:x.ALWAYS,mask:0},0,255,x.ZERO,x.ZERO,x.ZERO)}clearStencil(){const t=this.context,n=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const o=a.Z();a.aS(o,0,this.width,this.height,0,0,1),a.a0(o,o,[n.drawingBufferWidth,n.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,n.TRIANGLES,Dt.disabled,this.stencilClearMode,ui.disabled,oi.disabled,ol(o),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,n){if(this.currentStencilSource===t.source||!t.isTileClipped()||!n||!n.length)return;this.currentStencilSource=t.source;const o=this.context,c=o.gl;this.nextStencilID+n.length>256&&this.clearStencil(),o.setColorMode(ui.disabled),o.setDepthMode(Dt.disabled);const d=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const _ of n){const y=this._tileClippingMaskIDs[_.key]=this.nextStencilID++,x=this.style.map.terrain&&this.style.map.terrain.getTerrainData(_);d.draw(o,c.TRIANGLES,Dt.disabled,new hi({func:c.ALWAYS,mask:0},y,255,c.KEEP,c.KEEP,c.REPLACE),ui.disabled,oi.disabled,ol(_.posMatrix),x,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,n=this.context.gl;return new hi({func:n.NOTEQUAL,mask:255},t,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(t){const n=this.context.gl;return new hi({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(t){const n=this.context.gl,o=t.sort((_,y)=>y.overscaledZ-_.overscaledZ),c=o[o.length-1].overscaledZ,d=o[0].overscaledZ-c+1;if(d>1){this.currentStencilSource=void 0,this.nextStencilID+d>256&&this.clearStencil();const _={};for(let y=0;y<d;y++)_[y+c]=new hi({func:n.GEQUAL,mask:255},y+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=d,[_,o]}return[{[c]:hi.disabled},o]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new ui([t.CONSTANT_COLOR,t.ONE],new a.aT(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ui.unblended:ui.alphaBlended}depthModeForSublayer(t,n,o){if(!this.opaquePassEnabledForLayer())return Dt.disabled;const c=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Dt(o||this.context.gl.LEQUAL,n,[c,c])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,n){this.style=t,this.options=n,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(a.h.now()),this.imageManager.beginFrame();const o=this.style._order,c=this.style.sourceCaches,d={},_={},y={};for(const x in c){const C=c[x];C.used&&C.prepare(this.context),d[x]=C.getVisibleCoordinates(),_[x]=d[x].slice().reverse(),y[x]=C.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let x=0;x<o.length;x++)if(this.style._layers[o[x]].is3D()){this.opaquePassCutoff=x;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const x=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!a.b1(this.terrainFacilitator.matrix,this.transform.projMatrix)||x.length)&&(a.b2(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(C,E){const P=C.context,L=P.gl,U=ui.unblended,V=new Dt(L.LEQUAL,Dt.ReadWrite,[0,1]),G=E.getTerrainMesh(),N=E.sourceCache.getRenderableTiles(),re=C.useProgram("terrainDepth");P.bindFramebuffer.set(E.getFramebuffer("depth").framebuffer),P.viewport.set([0,0,C.width/devicePixelRatio,C.height/devicePixelRatio]),P.clear({color:a.aT.transparent,depth:1});for(const he of N){const J=E.getTerrainData(he.tileID),se={u_matrix:C.transform.calculatePosMatrix(he.tileID.toUnwrapped()),u_ele_delta:E.getMeshFrameDelta(C.transform.zoom)};re.draw(P,L.TRIANGLES,V,hi.disabled,U,oi.backCCW,se,J,"terrain",G.vertexBuffer,G.indexBuffer,G.segments)}P.bindFramebuffer.set(null),P.viewport.set([0,0,C.width,C.height])}(this,this.style.map.terrain),function(C,E){const P=C.context,L=P.gl,U=ui.unblended,V=new Dt(L.LEQUAL,Dt.ReadWrite,[0,1]),G=E.getTerrainMesh(),N=E.getCoordsTexture(),re=E.sourceCache.getRenderableTiles(),he=C.useProgram("terrainCoords");P.bindFramebuffer.set(E.getFramebuffer("coords").framebuffer),P.viewport.set([0,0,C.width/devicePixelRatio,C.height/devicePixelRatio]),P.clear({color:a.aT.transparent,depth:1}),E.coordsIndex=[];for(const J of re){const se=E.getTerrainData(J.tileID);P.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,N.texture);const pe={u_matrix:C.transform.calculatePosMatrix(J.tileID.toUnwrapped()),u_terrain_coords_id:(255-E.coordsIndex.length)/255,u_texture:0,u_ele_delta:E.getMeshFrameDelta(C.transform.zoom)};he.draw(P,L.TRIANGLES,V,hi.disabled,U,oi.backCCW,pe,se,"terrain",G.vertexBuffer,G.indexBuffer,G.segments),E.coordsIndex.push(J.tileID.key)}P.bindFramebuffer.set(null),P.viewport.set([0,0,C.width,C.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const x of o){const C=this.style._layers[x];if(!C.hasOffscreenPass()||C.isHidden(this.transform.zoom))continue;const E=_[C.source];(C.type==="custom"||E.length)&&this.renderLayer(this,c[C.source],C,E)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?a.aT.black:a.aT.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=o.length-1;this.currentLayer>=0;this.currentLayer--){const x=this.style._layers[o[this.currentLayer]],C=c[x.source],E=d[x.source];this._renderTileClippingMasks(x,E),this.renderLayer(this,C,x,E)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<o.length;this.currentLayer++){const x=this.style._layers[o[this.currentLayer]],C=c[x.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(x))continue;const E=(x.type==="symbol"?y:_)[x.source];this._renderTileClippingMasks(x,d[x.source]),this.renderLayer(this,C,x,E)}if(this.options.showTileBoundaries){const x=function(C,E){let P=null;const L=Object.values(C._layers).flatMap(N=>N.source&&!N.isHidden(E)?[C.sourceCaches[N.source]]:[]),U=L.filter(N=>N.getSource().type==="vector"),V=L.filter(N=>N.getSource().type!=="vector"),G=N=>{(!P||P.getSource().maxzoom<N.getSource().maxzoom)&&(P=N)};return U.forEach(N=>G(N)),P||V.forEach(N=>G(N)),P}(this.style,this.transform.zoom);x&&function(C,E,P){for(let L=0;L<P.length;L++)Sl(C,E,P[L])}(this,x,x.getVisibleCoordinates())}this.options.showPadding&&function(x){const C=x.transform.padding;Rs(x,x.transform.height-(C.top||0),3,xl),Rs(x,C.bottom||0,3,va),xa(x,C.left||0,3,po),xa(x,x.transform.width-(C.right||0),3,bl);const E=x.transform.centerPoint;(function(P,L,U,V){ba(P,L-1,U-10,2,20,V),ba(P,L-10,U-1,20,2,V)})(x,E.x,x.transform.height-E.y,wl)}(this),this.context.setDefault()}renderLayer(t,n,o,c){if(!o.isHidden(this.transform.zoom)&&(o.type==="background"||o.type==="custom"||(c||[]).length))switch(this.id=o.id,o.type){case"symbol":(function(d,_,y,x,C){if(d.renderPass!=="translucent")return;const E=hi.disabled,P=d.colorModeForRenderPass();(y._unevaluatedLayout.hasValue("text-variable-anchor")||y._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(L,U,V,G,N,re,he){const J=U.transform,se=N==="map",pe=re==="map";for(const fe of L){const be=G.getTile(fe),Pe=be.getBucket(V);if(!Pe||!Pe.text||!Pe.text.segments.get().length)continue;const Ce=a.ah(Pe.textSizeData,J.zoom),Le=te(be,1,U.transform.zoom),Ke=Re(fe.posMatrix,pe,se,U.transform,Le),Tt=V.layout.get("icon-text-fit")!=="none"&&Pe.hasIconData();if(Ce){const Oe=Math.pow(2,J.zoom-be.tileID.overscaledZ);_a(Pe,se,pe,he,J,Ke,fe.posMatrix,Oe,Ce,Tt,U.style.map.terrain?(ht,Qe)=>U.style.map.terrain.getElevation(fe,ht,Qe):null)}}}(x,d,y,_,y.layout.get("text-rotation-alignment"),y.layout.get("text-pitch-alignment"),C),y.paint.get("icon-opacity").constantOr(1)!==0&&ya(d,_,y,x,!1,y.paint.get("icon-translate"),y.paint.get("icon-translate-anchor"),y.layout.get("icon-rotation-alignment"),y.layout.get("icon-pitch-alignment"),y.layout.get("icon-keep-upright"),E,P),y.paint.get("text-opacity").constantOr(1)!==0&&ya(d,_,y,x,!0,y.paint.get("text-translate"),y.paint.get("text-translate-anchor"),y.layout.get("text-rotation-alignment"),y.layout.get("text-pitch-alignment"),y.layout.get("text-keep-upright"),E,P),_.map.showCollisionBoxes&&(vl(d,_,y,x,y.paint.get("text-translate"),y.paint.get("text-translate-anchor"),!0),vl(d,_,y,x,y.paint.get("icon-translate"),y.paint.get("icon-translate-anchor"),!1))})(t,n,o,c,this.style.placement.variableOffsets);break;case"circle":(function(d,_,y,x){if(d.renderPass!=="translucent")return;const C=y.paint.get("circle-opacity"),E=y.paint.get("circle-stroke-width"),P=y.paint.get("circle-stroke-opacity"),L=!y.layout.get("circle-sort-key").isConstant();if(C.constantOr(1)===0&&(E.constantOr(1)===0||P.constantOr(1)===0))return;const U=d.context,V=U.gl,G=d.depthModeForSublayer(0,Dt.ReadOnly),N=hi.disabled,re=d.colorModeForRenderPass(),he=[];for(let J=0;J<x.length;J++){const se=x[J],pe=_.getTile(se),fe=pe.getBucket(y);if(!fe)continue;const be=fe.programConfigurations.get(y.id),Pe=d.useProgram("circle",be),Ce=fe.layoutVertexBuffer,Le=fe.indexBuffer,Ke=d.style.map.terrain&&d.style.map.terrain.getTerrainData(se),Tt={programConfiguration:be,program:Pe,layoutVertexBuffer:Ce,indexBuffer:Le,uniformValues:An(d,se,pe,y),terrainData:Ke};if(L){const Oe=fe.segments.get();for(const ht of Oe)he.push({segments:new a.S([ht]),sortKey:ht.sortKey,state:Tt})}else he.push({segments:fe.segments,sortKey:0,state:Tt})}L&&he.sort((J,se)=>J.sortKey-se.sortKey);for(const J of he){const{programConfiguration:se,program:pe,layoutVertexBuffer:fe,indexBuffer:be,uniformValues:Pe,terrainData:Ce}=J.state;pe.draw(U,V.TRIANGLES,G,N,re,oi.disabled,Pe,Ce,y.id,fe,be,J.segments,y.paint,d.transform.zoom,se)}})(t,n,o,c);break;case"heatmap":(function(d,_,y,x){if(y.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){const C=d.context,E=C.gl,P=hi.disabled,L=new ui([E.ONE,E.ONE],a.aT.transparent,[!0,!0,!0,!0]);(function(U,V,G){const N=U.gl;U.activeTexture.set(N.TEXTURE1),U.viewport.set([0,0,V.width/4,V.height/4]);let re=G.heatmapFbo;if(re)N.bindTexture(N.TEXTURE_2D,re.colorAttachment.get()),U.bindFramebuffer.set(re.framebuffer);else{const he=N.createTexture();N.bindTexture(N.TEXTURE_2D,he),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_S,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_T,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MIN_FILTER,N.LINEAR),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MAG_FILTER,N.LINEAR),re=G.heatmapFbo=U.createFramebuffer(V.width/4,V.height/4,!1,!1),function(J,se,pe,fe){var be,Pe;const Ce=J.gl,Le=(be=J.HALF_FLOAT)!==null&&be!==void 0?be:Ce.UNSIGNED_BYTE,Ke=(Pe=J.RGBA16F)!==null&&Pe!==void 0?Pe:Ce.RGBA;Ce.texImage2D(Ce.TEXTURE_2D,0,Ke,se.width/4,se.height/4,0,Ce.RGBA,Le,null),fe.colorAttachment.set(pe)}(U,V,he,re)}})(C,d,y),C.clear({color:a.aT.transparent});for(let U=0;U<x.length;U++){const V=x[U];if(_.hasRenderableParent(V))continue;const G=_.getTile(V),N=G.getBucket(y);if(!N)continue;const re=N.programConfigurations.get(y.id),he=d.useProgram("heatmap",re),{zoom:J}=d.transform;he.draw(C,E.TRIANGLES,Dt.disabled,P,L,oi.disabled,$c(V.posMatrix,G,J,y.paint.get("heatmap-intensity")),null,y.id,N.layoutVertexBuffer,N.indexBuffer,N.segments,y.paint,d.transform.zoom,re)}C.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),function(C,E){const P=C.context,L=P.gl,U=E.heatmapFbo;if(!U)return;P.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,U.colorAttachment.get()),P.activeTexture.set(L.TEXTURE1);let V=E.colorRampTexture;V||(V=E.colorRampTexture=new De(P,E.colorRamp,L.RGBA)),V.bind(L.LINEAR,L.CLAMP_TO_EDGE),C.useProgram("heatmapTexture").draw(P,L.TRIANGLES,Dt.disabled,hi.disabled,C.colorModeForRenderPass(),oi.disabled,((G,N,re,he)=>{const J=a.Z();a.aS(J,0,G.width,G.height,0,0,1);const se=G.context.gl;return{u_matrix:J,u_world:[se.drawingBufferWidth,se.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:N.paint.get("heatmap-opacity")}})(C,E),null,E.id,C.viewportBuffer,C.quadTriangleIndexBuffer,C.viewportSegments,E.paint,C.transform.zoom)}(d,y))})(t,n,o,c);break;case"line":(function(d,_,y,x){if(d.renderPass!=="translucent")return;const C=y.paint.get("line-opacity"),E=y.paint.get("line-width");if(C.constantOr(1)===0||E.constantOr(1)===0)return;const P=d.depthModeForSublayer(0,Dt.ReadOnly),L=d.colorModeForRenderPass(),U=y.paint.get("line-dasharray"),V=y.paint.get("line-pattern"),G=V.constantOr(1),N=y.paint.get("line-gradient"),re=y.getCrossfadeParameters(),he=G?"linePattern":U?"lineSDF":N?"lineGradient":"line",J=d.context,se=J.gl;let pe=!0;for(const fe of x){const be=_.getTile(fe);if(G&&!be.patternsLoaded())continue;const Pe=be.getBucket(y);if(!Pe)continue;const Ce=Pe.programConfigurations.get(y.id),Le=d.context.program.get(),Ke=d.useProgram(he,Ce),Tt=pe||Ke.program!==Le,Oe=d.style.map.terrain&&d.style.map.terrain.getTerrainData(fe),ht=V.constantOr(null);if(ht&&be.imageAtlas){const Ct=be.imageAtlas,bt=Ct.patternPositions[ht.to.toString()],It=Ct.patternPositions[ht.from.toString()];bt&&It&&Ce.setConstantPatternPositions(bt,It)}const Qe=Oe?fe:null,Gt=G?Nc(d,be,y,re,Qe):U?cl(d,be,y,U,re,Qe):N?ll(d,be,y,Pe.lineClipsArray.length,Qe):Xa(d,be,y,Qe);if(G)J.activeTexture.set(se.TEXTURE0),be.imageAtlasTexture.bind(se.LINEAR,se.CLAMP_TO_EDGE),Ce.updatePaintBuffers(re);else if(U&&(Tt||d.lineAtlas.dirty))J.activeTexture.set(se.TEXTURE0),d.lineAtlas.bind(J);else if(N){const Ct=Pe.gradients[y.id];let bt=Ct.texture;if(y.gradientVersion!==Ct.version){let It=256;if(y.stepInterpolant){const yi=_.getSource().maxzoom,ti=fe.canonical.z===yi?Math.ceil(1<<d.transform.maxZoom-fe.canonical.z):1;It=a.ad(a.aY(Pe.maxLineLength/a.N*1024*ti),256,J.maxTextureSize)}Ct.gradient=a.aZ({expression:y.gradientExpression(),evaluationKey:"lineProgress",resolution:It,image:Ct.gradient||void 0,clips:Pe.lineClipsArray}),Ct.texture?Ct.texture.update(Ct.gradient):Ct.texture=new De(J,Ct.gradient,se.RGBA),Ct.version=y.gradientVersion,bt=Ct.texture}J.activeTexture.set(se.TEXTURE0),bt.bind(y.stepInterpolant?se.NEAREST:se.LINEAR,se.CLAMP_TO_EDGE)}Ke.draw(J,se.TRIANGLES,P,d.stencilModeForClipping(fe),L,oi.disabled,Gt,Oe,y.id,Pe.layoutVertexBuffer,Pe.indexBuffer,Pe.segments,y.paint,d.transform.zoom,Ce,Pe.layoutVertexBuffer2),pe=!1}})(t,n,o,c);break;case"fill":(function(d,_,y,x){const C=y.paint.get("fill-color"),E=y.paint.get("fill-opacity");if(E.constantOr(1)===0)return;const P=d.colorModeForRenderPass(),L=y.paint.get("fill-pattern"),U=d.opaquePassEnabledForLayer()&&!L.constantOr(1)&&C.constantOr(a.aT.transparent).a===1&&E.constantOr(0)===1?"opaque":"translucent";if(d.renderPass===U){const V=d.depthModeForSublayer(1,d.renderPass==="opaque"?Dt.ReadWrite:Dt.ReadOnly);Ds(d,_,y,x,V,P,!1)}if(d.renderPass==="translucent"&&y.paint.get("fill-antialias")){const V=d.depthModeForSublayer(y.getPaintProperty("fill-outline-color")?2:0,Dt.ReadOnly);Ds(d,_,y,x,V,P,!0)}})(t,n,o,c);break;case"fill-extrusion":(function(d,_,y,x){const C=y.paint.get("fill-extrusion-opacity");if(C!==0&&d.renderPass==="translucent"){const E=new Dt(d.context.gl.LEQUAL,Dt.ReadWrite,d.depthRangeFor3D);if(C!==1||y.paint.get("fill-extrusion-pattern").constantOr(1))Ls(d,_,y,x,E,hi.disabled,ui.disabled),Ls(d,_,y,x,E,d.stencilModeFor3D(),d.colorModeForRenderPass());else{const P=d.colorModeForRenderPass();Ls(d,_,y,x,E,hi.disabled,P)}}})(t,n,o,c);break;case"hillshade":(function(d,_,y,x){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent")return;const C=d.context,E=d.depthModeForSublayer(0,Dt.ReadOnly),P=d.colorModeForRenderPass(),[L,U]=d.renderPass==="translucent"?d.stencilConfigForOverlap(x):[{},x];for(const V of U){const G=_.getTile(V);G.needsHillshadePrepare!==void 0&&G.needsHillshadePrepare&&d.renderPass==="offscreen"?ho(d,G,y,E,hi.disabled,P):d.renderPass==="translucent"&&Wc(d,V,G,y,E,L[V.overscaledZ],P)}C.viewport.set([0,0,d.width,d.height])})(t,n,o,c);break;case"raster":(function(d,_,y,x){if(d.renderPass!=="translucent"||y.paint.get("raster-opacity")===0||!x.length)return;const C=d.context,E=C.gl,P=_.getSource(),L=d.useProgram("raster"),U=d.colorModeForRenderPass(),[V,G]=P instanceof Rt?[{},x]:d.stencilConfigForOverlap(x),N=G[G.length-1].overscaledZ,re=!d.options.moving;for(const he of G){const J=d.depthModeForSublayer(he.overscaledZ-N,y.paint.get("raster-opacity")===1?Dt.ReadWrite:Dt.ReadOnly,E.LESS),se=_.getTile(he);se.registerFadeDuration(y.paint.get("raster-fade-duration"));const pe=_.findLoadedParent(he,0),fe=Xc(se,pe,_,y,d.transform,d.style.map.terrain);let be,Pe;const Ce=y.paint.get("raster-resampling")==="nearest"?E.NEAREST:E.LINEAR;C.activeTexture.set(E.TEXTURE0),se.texture.bind(Ce,E.CLAMP_TO_EDGE,E.LINEAR_MIPMAP_NEAREST),C.activeTexture.set(E.TEXTURE1),pe?(pe.texture.bind(Ce,E.CLAMP_TO_EDGE,E.LINEAR_MIPMAP_NEAREST),be=Math.pow(2,pe.tileID.overscaledZ-se.tileID.overscaledZ),Pe=[se.tileID.canonical.x*be%1,se.tileID.canonical.y*be%1]):se.texture.bind(Ce,E.CLAMP_TO_EDGE,E.LINEAR_MIPMAP_NEAREST);const Le=d.style.map.terrain&&d.style.map.terrain.getTerrainData(he),Ke=Le?he:null,Tt=Ke?Ke.posMatrix:d.transform.calculatePosMatrix(he.toUnwrapped(),re),Oe=hl(Tt,Pe||[0,0],be||1,fe,y);P instanceof Rt?L.draw(C,E.TRIANGLES,J,hi.disabled,U,oi.disabled,Oe,Le,y.id,P.boundsBuffer,d.quadTriangleIndexBuffer,P.boundsSegments):L.draw(C,E.TRIANGLES,J,V[he.overscaledZ],U,oi.disabled,Oe,Le,y.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments)}})(t,n,o,c);break;case"background":(function(d,_,y,x){const C=y.paint.get("background-color"),E=y.paint.get("background-opacity");if(E===0)return;const P=d.context,L=P.gl,U=d.transform,V=U.tileSize,G=y.paint.get("background-pattern");if(d.isPatternMissing(G))return;const N=!G&&C.a===1&&E===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==N)return;const re=hi.disabled,he=d.depthModeForSublayer(0,N==="opaque"?Dt.ReadWrite:Dt.ReadOnly),J=d.colorModeForRenderPass(),se=d.useProgram(G?"backgroundPattern":"background"),pe=x||U.coveringTiles({tileSize:V,terrain:d.style.map.terrain});G&&(P.activeTexture.set(L.TEXTURE0),d.imageManager.bind(d.context));const fe=y.getCrossfadeParameters();for(const be of pe){const Pe=x?be.posMatrix:d.transform.calculatePosMatrix(be.toUnwrapped()),Ce=G?$r(Pe,E,d,G,{tileID:be,tileSize:V},fe):aa(Pe,E,C),Le=d.style.map.terrain&&d.style.map.terrain.getTerrainData(be);se.draw(P,L.TRIANGLES,he,re,J,oi.disabled,Ce,Le,y.id,d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}})(t,0,o,c);break;case"custom":(function(d,_,y){const x=d.context,C=y.implementation;if(d.renderPass==="offscreen"){const E=C.prerender;E&&(d.setCustomLayerDefaults(),x.setColorMode(d.colorModeForRenderPass()),E.call(C,x.gl,d.transform.customLayerMatrix()),x.setDirty(),d.setBaseState())}else if(d.renderPass==="translucent"){d.setCustomLayerDefaults(),x.setColorMode(d.colorModeForRenderPass()),x.setStencilMode(hi.disabled);const E=C.renderingMode==="3d"?new Dt(d.context.gl.LEQUAL,Dt.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,Dt.ReadOnly);x.setDepthMode(E),C.render(x.gl,d.transform.customLayerMatrix()),x.setDirty(),d.setBaseState(),x.bindFramebuffer.set(null)}})(t,0,o)}}translatePosMatrix(t,n,o,c,d){if(!o[0]&&!o[1])return t;const _=d?c==="map"?this.transform.angle:0:c==="viewport"?-this.transform.angle:0;if(_){const C=Math.sin(_),E=Math.cos(_);o=[o[0]*E-o[1]*C,o[0]*C+o[1]*E]}const y=[d?o[0]:te(n,o[0],this.transform.zoom),d?o[1]:te(n,o[1],this.transform.zoom),0],x=new Float32Array(16);return a.$(x,t,y),x}saveTileTexture(t){const n=this._tileTextures[t.size[0]];n?n.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const n=this._tileTextures[t];return n&&n.length>0?n.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const n=this.imageManager.getPattern(t.from.toString()),o=this.imageManager.getPattern(t.to.toString());return!n||!o}useProgram(t,n){this.cache=this.cache||{};const o=t+(n?n.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[o]||(this.cache[o]=new ia(this.context,ci[t],n,oa[t],this._showOverdrawInspector,this.style.map.terrain)),this.cache[o]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new De(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:n}=this.context.gl;return this.width!==t||this.height!==n}}class gr{constructor(t,n){this.points=t,this.planes=n}static fromInvProjectionMatrix(t,n,o){const c=Math.pow(2,o),d=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(y=>{const x=1/(y=a.ag([],y,t))[3]/n*c;return a.b3(y,y,[x,x,1/y[3],x])}),_=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(y=>{const x=function(L,U){var V=U[0],G=U[1],N=U[2],re=V*V+G*G+N*N;return re>0&&(re=1/Math.sqrt(re)),L[0]=U[0]*re,L[1]=U[1]*re,L[2]=U[2]*re,L}([],function(L,U,V){var G=U[0],N=U[1],re=U[2],he=V[0],J=V[1],se=V[2];return L[0]=N*se-re*J,L[1]=re*he-G*se,L[2]=G*J-N*he,L}([],it([],d[y[0]],d[y[1]]),it([],d[y[2]],d[y[1]]))),C=-((E=x)[0]*(P=d[y[1]])[0]+E[1]*P[1]+E[2]*P[2]);var E,P;return x.concat(C)});return new gr(d,_)}}class us{constructor(t,n){this.min=t,this.max=n,this.center=function(o,c,d){return o[0]=.5*c[0],o[1]=.5*c[1],o[2]=.5*c[2],o}([],function(o,c,d){return o[0]=c[0]+d[0],o[1]=c[1]+d[1],o[2]=c[2]+d[2],o}([],this.min,this.max))}quadrant(t){const n=[t%2==0,t<2],o=me(this.min),c=me(this.max);for(let d=0;d<n.length;d++)o[d]=n[d]?this.min[d]:this.center[d],c[d]=n[d]?this.center[d]:this.max[d];return c[2]=this.max[2],new us(o,c)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const n=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let o=!0;for(let c=0;c<t.planes.length;c++){const d=t.planes[c];let _=0;for(let y=0;y<n.length;y++)a.b4(d,n[y])>=0&&_++;if(_===0)return 0;_!==n.length&&(o=!1)}if(o)return 2;for(let c=0;c<3;c++){let d=Number.MAX_VALUE,_=-Number.MAX_VALUE;for(let y=0;y<t.points.length;y++){const x=t.points[y][c]-this.min[c];d=Math.min(d,x),_=Math.max(_,x)}if(_<0||d>this.max[c]-this.min[c])return 0}return 1}}class Fs{constructor(t=0,n=0,o=0,c=0){if(isNaN(t)||t<0||isNaN(n)||n<0||isNaN(o)||o<0||isNaN(c)||c<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=n,this.left=o,this.right=c}interpolate(t,n,o){return n.top!=null&&t.top!=null&&(this.top=a.B.number(t.top,n.top,o)),n.bottom!=null&&t.bottom!=null&&(this.bottom=a.B.number(t.bottom,n.bottom,o)),n.left!=null&&t.left!=null&&(this.left=a.B.number(t.left,n.left,o)),n.right!=null&&t.right!=null&&(this.right=a.B.number(t.right,n.right,o)),this}getCenter(t,n){const o=a.ad((this.left+t-this.right)/2,0,t),c=a.ad((this.top+n-this.bottom)/2,0,n);return new a.P(o,c)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Fs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class wa{constructor(t,n,o,c,d){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=d===void 0||!!d,this._minZoom=t||0,this._maxZoom=n||22,this._minPitch=o??0,this._maxPitch=c??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new a.L(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Fs,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const t=new wa(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this._minEleveationForCurrentTile=t._minEleveationForCurrentTile,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const n=-a.b5(t,-180,180)*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=function(){var o=new a.A(4);return a.A!=Float32Array&&(o[1]=0,o[2]=0),o[0]=1,o[3]=1,o}(),function(o,c,d){var _=c[0],y=c[1],x=c[2],C=c[3],E=Math.sin(d),P=Math.cos(d);o[0]=_*P+x*E,o[1]=y*P+C*E,o[2]=_*-E+x*P,o[3]=y*-E+C*P}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const n=a.ad(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const n=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==n&&(this._unmodified=!1,this._zoom=n,this.tileZoom=Math.max(0,Math.floor(n)),this.scale=this.zoomScale(n),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,n,o){this._unmodified=!1,this._edgeInsets.interpolate(t,n,o),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const n=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,n)}getVisibleUnwrappedCoordinates(t){const n=[new a.b6(0,t)];if(this._renderWorldCopies){const o=this.pointCoordinate(new a.P(0,0)),c=this.pointCoordinate(new a.P(this.width,0)),d=this.pointCoordinate(new a.P(this.width,this.height)),_=this.pointCoordinate(new a.P(0,this.height)),y=Math.floor(Math.min(o.x,c.x,d.x,_.x)),x=Math.floor(Math.max(o.x,c.x,d.x,_.x)),C=1;for(let E=y-C;E<=x+C;E++)E!==0&&n.push(new a.b6(E,t))}return n}coveringTiles(t){var n,o;let c=this.coveringZoomLevel(t);const d=c;if(t.minzoom!==void 0&&c<t.minzoom)return[];t.maxzoom!==void 0&&c>t.maxzoom&&(c=t.maxzoom);const _=this.pointCoordinate(this.getCameraPoint()),y=a.U.fromLngLat(this.center),x=Math.pow(2,c),C=[x*_.x,x*_.y,0],E=[x*y.x,x*y.y,0],P=gr.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c);let L=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(L=c);const U=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,V=J=>({aabb:new us([J*x,0,0],[(J+1)*x,x,0]),zoom:0,x:0,y:0,wrap:J,fullyVisible:!1}),G=[],N=[],re=c,he=t.reparseOverscaled?d:c;if(this._renderWorldCopies)for(let J=1;J<=3;J++)G.push(V(-J)),G.push(V(J));for(G.push(V(0));G.length>0;){const J=G.pop(),se=J.x,pe=J.y;let fe=J.fullyVisible;if(!fe){const Ke=J.aabb.intersects(P);if(Ke===0)continue;fe=Ke===2}const be=t.terrain?C:E,Pe=J.aabb.distanceX(be),Ce=J.aabb.distanceY(be),Le=Math.max(Math.abs(Pe),Math.abs(Ce));if(J.zoom===re||Le>U+(1<<re-J.zoom)-2&&J.zoom>=L){const Ke=re-J.zoom,Tt=C[0]-.5-(se<<Ke),Oe=C[1]-.5-(pe<<Ke);N.push({tileID:new a.O(J.zoom===re?he:J.zoom,J.wrap,J.zoom,se,pe),distanceSq:Ye([E[0]-.5-se,E[1]-.5-pe]),tileDistanceToCamera:Math.sqrt(Tt*Tt+Oe*Oe)})}else for(let Ke=0;Ke<4;Ke++){const Tt=(se<<1)+Ke%2,Oe=(pe<<1)+(Ke>>1),ht=J.zoom+1;let Qe=J.aabb.quadrant(Ke);if(t.terrain){const Gt=new a.O(ht,J.wrap,ht,Tt,Oe),Ct=t.terrain.getMinMaxElevation(Gt),bt=(n=Ct.minElevation)!==null&&n!==void 0?n:this.elevation,It=(o=Ct.maxElevation)!==null&&o!==void 0?o:this.elevation;Qe=new us([Qe.min[0],Qe.min[1],bt],[Qe.max[0],Qe.max[1],It])}G.push({aabb:Qe,zoom:ht,x:Tt,y:Oe,wrap:J.wrap,fullyVisible:fe})}}return N.sort((J,se)=>J.distanceSq-se.distanceSq).map(J=>J.tileID)}resize(t,n){this.width=t,this.height=n,this.pixelsToGLUnits=[2/t,-2/n],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const n=a.ad(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new a.P(a.G(t.lng)*this.worldSize,a.H(n)*this.worldSize)}unproject(t){return new a.U(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const n=this.pointLocation(this.centerPoint,t),o=t.getElevationForLngLatZoom(n,this.tileZoom);if(!(this.elevation-o))return;const c=this.getCameraPosition(),d=a.U.fromLngLat(c.lngLat,c.altitude),_=a.U.fromLngLat(n,o),y=d.x-_.x,x=d.y-_.y,C=d.z-_.z,E=Math.sqrt(y*y+x*x+C*C),P=this.scaleZoom(this.cameraToCenterDistance/E/this.tileSize);this._elevation=o,this._center=n,this.zoom=P}setLocationAtPoint(t,n){const o=this.pointCoordinate(n),c=this.pointCoordinate(this.centerPoint),d=this.locationCoordinate(t),_=new a.U(d.x-(o.x-c.x),d.y-(o.y-c.y));this.center=this.coordinateLocation(_),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,n){return n?this.coordinatePoint(this.locationCoordinate(t),n.getElevationForLngLatZoom(t,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,n){return this.coordinateLocation(this.pointCoordinate(t,n))}locationCoordinate(t){return a.U.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,n){if(n){const L=n.pointCoordinate(t);if(L!=null)return L}const o=[t.x,t.y,0,1],c=[t.x,t.y,1,1];a.ag(o,o,this.pixelMatrixInverse),a.ag(c,c,this.pixelMatrixInverse);const d=o[3],_=c[3],y=o[1]/d,x=c[1]/_,C=o[2]/d,E=c[2]/_,P=C===E?0:(0-C)/(E-C);return new a.U(a.B.number(o[0]/d,c[0]/_,P)/this.worldSize,a.B.number(y,x,P)/this.worldSize)}coordinatePoint(t,n=0,o=this.pixelMatrix){const c=[t.x*this.worldSize,t.y*this.worldSize,n,1];return a.ag(c,c,o),new a.P(c[0]/c[3],c[1]/c[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new Ze().extend(this.pointLocation(new a.P(0,t))).extend(this.pointLocation(new a.P(this.width,t))).extend(this.pointLocation(new a.P(this.width,this.height))).extend(this.pointLocation(new a.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Ze([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(t,n=!1){const o=t.key,c=n?this._alignedPosMatrixCache:this._posMatrixCache;if(c[o])return c[o];const d=t.canonical,_=this.worldSize/this.zoomScale(d.z),y=d.x+Math.pow(2,d.z)*t.wrap,x=a.ao(new Float64Array(16));return a.$(x,x,[y*_,d.y*_,0]),a.a0(x,x,[_/a.N,_/a.N,1]),a.a1(x,n?this.alignedProjMatrix:this.projMatrix,x),c[o]=new Float32Array(x),c[o]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t,n,o,c,d=-90,_=90,y=-180,x=180;const C=this.size,E=this._unmodified;if(this.latRange){const U=this.latRange;d=a.H(U[1])*this.worldSize,_=a.H(U[0])*this.worldSize,t=_-d<C.y?C.y/(_-d):0}if(this.lngRange){const U=this.lngRange;y=a.b5(a.G(U[0])*this.worldSize,0,this.worldSize),x=a.b5(a.G(U[1])*this.worldSize,0,this.worldSize),x<y&&(x+=this.worldSize),n=x-y<C.x?C.x/(x-y):0}const P=this.point,L=Math.max(n||0,t||0);if(L)return this.center=this.unproject(new a.P(n?(x+y)/2:P.x,t?(_+d)/2:P.y)),this.zoom+=this.scaleZoom(L),this._unmodified=E,void(this._constraining=!1);if(this.latRange){const U=P.y,V=C.y/2;U-V<d&&(c=d+V),U+V>_&&(c=_-V)}if(this.lngRange){const U=(y+x)/2,V=a.b5(P.x,U-this.worldSize/2,U+this.worldSize/2),G=C.x/2;V-G<y&&(o=y+G),V+G>x&&(o=x-G)}o===void 0&&c===void 0||(this.center=this.unproject(new a.P(o!==void 0?o:P.x,c!==void 0?c:P.y)).wrap()),this._unmodified=E,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,n=this.point.x,o=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=a.b7(1,this.center.lat)*this.worldSize;let c=a.ao(new Float64Array(16));a.a0(c,c,[this.width/2,-this.height/2,1]),a.$(c,c,[1,-1,0]),this.labelPlaneMatrix=c,c=a.ao(new Float64Array(16)),a.a0(c,c,[1,-1,1]),a.$(c,c,[-1,-1,0]),a.a0(c,c,[2/this.width,2/this.height,1]),this.glCoordMatrix=c;const d=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),_=Math.min(this.elevation,this._minEleveationForCurrentTile),y=d-_*this._pixelPerMeter/Math.cos(this._pitch),x=_<0?y:d,C=Math.PI/2+this._pitch,E=this._fov*(.5+t.y/this.height),P=Math.sin(E)*x/Math.sin(a.ad(Math.PI-C-E,.01,Math.PI-.01)),L=this.getHorizon(),U=2*Math.atan(L/this.cameraToCenterDistance)*(.5+t.y/(2*L)),V=Math.sin(U)*x/Math.sin(a.ad(Math.PI-C-U,.01,Math.PI-.01)),G=Math.min(P,V),N=1.01*(Math.cos(Math.PI/2-this._pitch)*G+x),re=this.height/50;c=new Float64Array(16),a.b8(c,this._fov,this.width/this.height,re,N),c[8]=2*-t.x/this.width,c[9]=2*t.y/this.height,a.a0(c,c,[1,-1,1]),a.$(c,c,[0,0,-this.cameraToCenterDistance]),a.b9(c,c,this._pitch),a.ae(c,c,this.angle),a.$(c,c,[-n,-o,0]),this.mercatorMatrix=a.a0([],c,[this.worldSize,this.worldSize,this.worldSize]),a.a0(c,c,[1,1,this._pixelPerMeter]),this.pixelMatrix=a.a1(new Float64Array(16),this.labelPlaneMatrix,c),a.$(c,c,[0,0,-this.elevation]),this.projMatrix=c,this.invProjMatrix=a.as([],c),this.pixelMatrix3D=a.a1(new Float64Array(16),this.labelPlaneMatrix,c);const he=this.width%2/2,J=this.height%2/2,se=Math.cos(this.angle),pe=Math.sin(this.angle),fe=n-Math.round(n)+se*he+pe*J,be=o-Math.round(o)+se*J+pe*he,Pe=new Float64Array(c);if(a.$(Pe,Pe,[fe>.5?fe-1:fe,be>.5?be-1:be,0]),this.alignedProjMatrix=Pe,c=a.as(new Float64Array(16),this.pixelMatrix),!c)throw new Error("failed to invert matrix");this.pixelMatrixInverse=c,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new a.P(0,0)),n=[t.x*this.worldSize,t.y*this.worldSize,0,1];return a.ag(n,n,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(0,t))}getCameraQueryGeometry(t){const n=this.getCameraPoint();if(t.length===1)return[t[0],n];{let o=n.x,c=n.y,d=n.x,_=n.y;for(const y of t)o=Math.min(o,y.x),c=Math.min(c,y.y),d=Math.max(d,y.x),_=Math.max(_,y.y);return[new a.P(o,c),new a.P(d,c),new a.P(d,_),new a.P(o,_),new a.P(o,c)]}}}function Zn(u,t){let n,o=!1,c=null,d=null;const _=()=>{c=null,o&&(u.apply(d,n),c=setTimeout(_,t),o=!1)};return(...y)=>(o=!0,d=this,n=y,c||_(),c)}class Bs{constructor(t){this._getCurrentHash=()=>{const n=window.location.hash.replace("#","");if(this._hashName){let o;return n.split("&").map(c=>c.split("=")).forEach(c=>{c[0]===this._hashName&&(o=c)}),(o&&o[1]||"").split("/")}return n.split("/")},this._onHashChange=()=>{const n=this._getCurrentHash();if(n.length>=3&&!n.some(o=>isNaN(o))){const o=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:o,pitch:+(n[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const n=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,n)}catch{}},this._updateHash=Zn(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const n=this._map.getCenter(),o=Math.round(100*this._map.getZoom())/100,c=Math.ceil((o*Math.LN2+Math.log(512/360/.5))/Math.LN10),d=Math.pow(10,c),_=Math.round(n.lng*d)/d,y=Math.round(n.lat*d)/d,x=this._map.getBearing(),C=this._map.getPitch();let E="";if(E+=t?`/${_}/${y}/${o}`:`${o}/${y}/${_}`,(x||C)&&(E+="/"+Math.round(10*x)/10),C&&(E+=`/${Math.round(C)}`),this._hashName){const P=this._hashName;let L=!1;const U=window.location.hash.slice(1).split("&").map(V=>{const G=V.split("=")[0];return G===P?(L=!0,`${G}=${E}`):V}).filter(V=>V);return L||U.push(`${P}=${E}`),`#${U.join("&")}`}return`#${E}`}}const hs={linearity:.3,easing:a.ba(0,0,.3,1)},Cl=a.e({deceleration:2500,maxSpeed:1400},hs),Tl=a.e({deceleration:20,maxSpeed:1400},hs),Il=a.e({deceleration:1e3,maxSpeed:360},hs),El=a.e({deceleration:1e3,maxSpeed:90},hs);class Pl{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.h.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,n=a.h.now();for(;t.length>0&&n-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:d}of this._inertiaBuffer)n.zoom+=d.zoomDelta||0,n.bearing+=d.bearingDelta||0,n.pitch+=d.pitchDelta||0,d.panDelta&&n.pan._add(d.panDelta),d.around&&(n.around=d.around),d.pinchAround&&(n.pinchAround=d.pinchAround);const o=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,c={};if(n.pan.mag()){const d=Os(n.pan.mag(),o,a.e({},Cl,t||{}));c.offset=n.pan.mult(d.amount/n.pan.mag()),c.center=this._map.transform.center,tn(c,d)}if(n.zoom){const d=Os(n.zoom,o,Tl);c.zoom=this._map.transform.zoom+d.amount,tn(c,d)}if(n.bearing){const d=Os(n.bearing,o,Il);c.bearing=this._map.transform.bearing+a.ad(d.amount,-179,179),tn(c,d)}if(n.pitch){const d=Os(n.pitch,o,El);c.pitch=this._map.transform.pitch+d.amount,tn(c,d)}if(c.zoom||c.bearing){const d=n.pinchAround===void 0?n.around:n.pinchAround;c.around=d?this._map.unproject(d):this._map.getCenter()}return this.clear(),a.e(c,{noMoveStart:!0})}}function tn(u,t){(!u.duration||u.duration<t.duration)&&(u.duration=t.duration,u.easing=t.easing)}function Os(u,t,n){const{maxSpeed:o,linearity:c,deceleration:d}=n,_=a.ad(u*c/(t/1e3),-o,o),y=Math.abs(_)/(d*c);return{easing:n.easing,duration:1e3*y,amount:_*(y/2)}}class Pr extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,o,c={}){const d=F.mousePos(n.getCanvasContainer(),o),_=n.unproject(d);super(t,a.e({point:d,lngLat:_,originalEvent:o},c)),this._defaultPrevented=!1,this.target=n}}class $s extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,o){const c=t==="touchend"?o.changedTouches:o.touches,d=F.touchPos(n.getCanvasContainer(),c),_=d.map(x=>n.unproject(x)),y=d.reduce((x,C,E,P)=>x.add(C.div(P.length)),new a.P(0,0));super(t,{points:d,point:y,lngLats:_,lngLat:n.unproject(y),originalEvent:o}),this._defaultPrevented=!1}}class Al extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,o){super(t,{originalEvent:o}),this._defaultPrevented=!1}}class Ml{constructor(t,n){this._map=t,this._clickTolerance=n.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new Al(t.type,this._map,t))}mousedown(t,n){return this._mousedownPos=n,this._firePreventable(new Pr(t.type,this._map,t))}mouseup(t){this._map.fire(new Pr(t.type,this._map,t))}click(t,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||this._map.fire(new Pr(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Pr(t.type,this._map,t))}mouseover(t){this._map.fire(new Pr(t.type,this._map,t))}mouseout(t){this._map.fire(new Pr(t.type,this._map,t))}touchstart(t){return this._firePreventable(new $s(t.type,this._map,t))}touchmove(t){this._map.fire(new $s(t.type,this._map,t))}touchend(t){this._map.fire(new $s(t.type,this._map,t))}touchcancel(t){this._map.fire(new $s(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class kl{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Pr(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Pr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Pr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class dn{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(a.P.convert(t),this._map.terrain)}}class zl{constructor(t,n){this._map=t,this._tr=new dn(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,n){this.isEnabled()&&t.shiftKey&&t.button===0&&(F.disableDrag(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(t,n){if(!this._active)return;const o=n;if(this._lastPos.equals(o)||!this._box&&o.dist(this._startPos)<this._clickTolerance)return;const c=this._startPos;this._lastPos=o,this._box||(this._box=F.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const d=Math.min(c.x,o.x),_=Math.max(c.x,o.x),y=Math.min(c.y,o.y),x=Math.max(c.y,o.y);F.setTransform(this._box,`translate(${d}px,${y}px)`),this._box.style.width=_-d+"px",this._box.style.height=x-y+"px"}mouseupWindow(t,n){if(!this._active||t.button!==0)return;const o=this._startPos,c=n;if(this.reset(),F.suppressClick(),o.x!==c.x||o.y!==c.y)return this._map.fire(new a.k("boxzoomend",{originalEvent:t})),{cameraAnimation:d=>d.fitScreenCoordinates(o,c,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(F.remove(this._box),this._box=null),F.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,n){return this._map.fire(new a.k(t,{originalEvent:n}))}}function Nr(u,t){if(u.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${u.length}, points ${t.length}`);const n={};for(let o=0;o<u.length;o++)n[u[o].identifier]=t[o];return n}class pn{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,n,o){(this.centroid||o.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),o.length===this.numTouches&&(this.centroid=function(c){const d=new a.P(0,0);for(const _ of c)d._add(_);return d.div(c.length)}(n),this.touches=Nr(o,n)))}touchmove(t,n,o){if(this.aborted||!this.centroid)return;const c=Nr(o,n);for(const d in this.touches){const _=c[d];(!_||_.dist(this.touches[d])>30)&&(this.aborted=!0)}}touchend(t,n,o){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),o.length===0){const c=!this.aborted&&this.centroid;if(this.reset(),c)return c}}}class Sa{constructor(t){this.singleTap=new pn(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,n,o){this.singleTap.touchstart(t,n,o)}touchmove(t,n,o){this.singleTap.touchmove(t,n,o)}touchend(t,n,o){const c=this.singleTap.touchend(t,n,o);if(c){const d=t.timeStamp-this.lastTime<500,_=!this.lastTap||this.lastTap.dist(c)<30;if(d&&_||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=c,this.count===this.numTaps)return this.reset(),c}}}class fn{constructor(t){this._tr=new dn(t),this._zoomIn=new Sa({numTouches:1,numTaps:2}),this._zoomOut=new Sa({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,n,o){this._zoomIn.touchstart(t,n,o),this._zoomOut.touchstart(t,n,o)}touchmove(t,n,o){this._zoomIn.touchmove(t,n,o),this._zoomOut.touchmove(t,n,o)}touchend(t,n,o){const c=this._zoomIn.touchend(t,n,o),d=this._zoomOut.touchend(t,n,o),_=this._tr;return c?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:y=>y.easeTo({duration:300,zoom:_.zoom+1,around:_.unproject(c)},{originalEvent:t})}):d?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:y=>y.easeTo({duration:300,zoom:_.zoom-1,around:_.unproject(d)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class mn{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const n=this._moveFunction(...t);if(n.bearingDelta||n.pitchDelta||n.around||n.panDelta)return this._active=!0,n}dragStart(t,n){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=n.length?n[0]:n,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,n){if(!this.isEnabled())return;const o=this._lastPoint;if(!o)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const c=n.length?n[0]:n;return!this._moved&&c.dist(o)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=c,this._move(o,c))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&F.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Kc={0:1,2:2};class fo{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const n=F.mouseButton(t);this._eventButton=n}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(n,o){const c=Kc[o];return n.buttons===void 0||(n.buttons&c)!==c}(t,this._eventButton)}isValidEndEvent(t){return F.mouseButton(t)===this._eventButton}}class Dl{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}const Ca=u=>{u.mousedown=u.dragStart,u.mousemoveWindow=u.dragMove,u.mouseup=u.dragEnd,u.contextmenu=function(t){t.preventDefault()}},ds=({enable:u,clickTolerance:t,bearingDegreesPerPixelMoved:n=.8})=>{const o=new fo({checkCorrectEvent:c=>F.mouseButton(c)===0&&c.ctrlKey||F.mouseButton(c)===2});return new mn({clickTolerance:t,move:(c,d)=>({bearingDelta:(d.x-c.x)*n}),moveStateManager:o,enable:u,assignEvents:Ca})},gn=({enable:u,clickTolerance:t,pitchDegreesPerPixelMoved:n=-.5})=>{const o=new fo({checkCorrectEvent:c=>F.mouseButton(c)===0&&c.ctrlKey||F.mouseButton(c)===2});return new mn({clickTolerance:t,move:(c,d)=>({pitchDelta:(d.y-c.y)*n}),moveStateManager:o,enable:u,assignEvents:Ca})};class He{constructor(t,n){this._minTouches=t.cooperativeGestures?2:1,this._clickTolerance=t.clickTolerance||1,this._map=n,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(t,n,o){return this._calculateTransform(t,n,o)}touchmove(t,n,o){if(this._map._cooperativeGestures&&(this._minTouches===2&&o.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(t,!1,o.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(o.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,n,o)}touchend(t,n,o){this._calculateTransform(t,n,o),this._active&&o.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,n,o){o.length>0&&(this._active=!0);const c=Nr(o,n),d=new a.P(0,0),_=new a.P(0,0);let y=0;for(const C in c){const E=c[C],P=this._touches[C];P&&(d._add(E),_._add(E.sub(P)),y++,c[C]=E)}if(this._touches=c,y<this._minTouches||!_.mag())return;const x=_.div(y);return this._sum._add(x),this._sum.mag()<this._clickTolerance?void 0:{around:d.div(y),panDelta:x}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ta{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,n,o){this._firstTwoTouches||o.length<2||(this._firstTwoTouches=[o[0].identifier,o[1].identifier],this._start([n[0],n[1]]))}touchmove(t,n,o){if(!this._firstTwoTouches)return;t.preventDefault();const[c,d]=this._firstTwoTouches,_=zn(o,n,c),y=zn(o,n,d);if(!_||!y)return;const x=this._aroundCenter?null:_.add(y).div(2);return this._move([_,y],x,t)}touchend(t,n,o){if(!this._firstTwoTouches)return;const[c,d]=this._firstTwoTouches,_=zn(o,n,c),y=zn(o,n,d);_&&y||(this._active&&F.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function zn(u,t,n){for(let o=0;o<u.length;o++)if(u[o].identifier===n)return t[o]}function ps(u,t){return Math.log(u/t)/Math.LN2}class Ll extends Ta{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,n){const o=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(ps(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ps(this._distance,o),pinchAround:n}}}function Ue(u,t){return 180*u.angleWith(t)/Math.PI}class mo extends Ta{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,n){const o=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Ue(this._vector,o),pinchAround:n}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const n=25/(Math.PI*this._minDiameter)*360,o=Ue(t,this._startVector);return Math.abs(o)<n}}function go(u){return Math.abs(u.y)>Math.abs(u.x)}class Jc extends Ta{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,n,o){super.touchstart(t,n,o),this._currentTouchCount=o.length}_start(t){this._lastPoints=t,go(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,n,o){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const c=t[0].sub(this._lastPoints[0]),d=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(c,d,o.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(c.y+d.y)/2*-.5}):void 0}gestureBeginsVertically(t,n,o){if(this._valid!==void 0)return this._valid;const c=t.mag()>=2,d=n.mag()>=2;if(!c&&!d)return;if(!c||!d)return this._firstMove===void 0&&(this._firstMove=o),o-this._firstMove<100&&void 0;const _=t.y>0==n.y>0;return go(t)&&go(n)&&_}}const _o={panStep:100,bearingStep:15,pitchStep:10};class Rl{constructor(t){this._tr=new dn(t);const n=_o;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let n=0,o=0,c=0,d=0,_=0;switch(t.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:t.shiftKey?o=-1:(t.preventDefault(),d=-1);break;case 39:t.shiftKey?o=1:(t.preventDefault(),d=1);break;case 38:t.shiftKey?c=1:(t.preventDefault(),_=-1);break;case 40:t.shiftKey?c=-1:(t.preventDefault(),_=1);break;default:return}return this._rotationDisabled&&(o=0,c=0),{cameraAnimation:y=>{const x=this._tr;y.easeTo({duration:300,easeId:"keyboardHandler",easing:Fl,zoom:n?Math.round(x.zoom)+n*(t.shiftKey?2:1):x.zoom,bearing:x.bearing+o*this._bearingStep,pitch:x.pitch+c*this._pitchStep,offset:[-d*this._panStep,-_*this._panStep],center:x.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Fl(u){return u*(2-u)}const Bl=4.000244140625;class Yc{constructor(t,n){this._onTimeout=o=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)},this._map=t,this._tr=new dn(t),this._el=t.getCanvasContainer(),this._triggerRenderFrame=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!t[this._map._metaKey])return;t.preventDefault()}let n=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const o=a.h.now(),c=o-(this._lastWheelEventTime||0);this._lastWheelEventTime=o,n!==0&&n%Bl==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":c>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(c*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),t.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=t,this._delta-=n,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=F.mousePos(this._el,t),o=this._tr;this._around=a.L.convert(this._aroundCenter?o.center:o.unproject(n)),this._aroundPoint=o.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(this._delta!==0){const y=this._type==="wheel"&&Math.abs(this._delta)>Bl?this._wheelZoomRate:this._defaultZoomRate;let x=2/(1+Math.exp(-Math.abs(this._delta*y)));this._delta<0&&x!==0&&(x=1/x);const C=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(C*x))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const n=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,o=this._startZoom,c=this._easing;let d,_=!1;if(this._type==="wheel"&&o&&c){const y=Math.min((a.h.now()-this._lastWheelEventTime)/200,1),x=c(y);d=a.B.number(o,n,x),y<1?this._frameId||(this._frameId=!0):_=!0}else d=n,_=!0;return this._active=!0,_&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!_,zoomDelta:d-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let n=a.bb;if(this._prevEase){const o=this._prevEase,c=(a.h.now()-o.start)/o.duration,d=o.easing(c+.01)-o.easing(c),_=.27/Math.sqrt(d*d+1e-4)*.01,y=Math.sqrt(.0729-_*_);n=a.ba(_,y,.25,1)}return this._prevEase={start:a.h.now(),duration:t,easing:n},n}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class yo{constructor(t,n){this._clickZoom=t,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class vo{constructor(t){this._tr=new dn(t),this.reset()}reset(){this._active=!1}dblclick(t,n){return t.preventDefault(),{cameraAnimation:o=>{o.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(n)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xo{constructor(){this._tap=new Sa({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,n,o){if(!this._swipePoint)if(this._tapTime){const c=n[0],d=t.timeStamp-this._tapTime<500,_=this._tapPoint.dist(c)<30;d&&_?o.length>0&&(this._swipePoint=c,this._swipeTouch=o[0].identifier):this.reset()}else this._tap.touchstart(t,n,o)}touchmove(t,n,o){if(this._tapTime){if(this._swipePoint){if(o[0].identifier!==this._swipeTouch)return;const c=n[0],d=c.y-this._swipePoint.y;return this._swipePoint=c,t.preventDefault(),this._active=!0,{zoomDelta:d/128}}}else this._tap.touchmove(t,n,o)}touchend(t,n,o){if(this._tapTime)this._swipePoint&&o.length===0&&this.reset();else{const c=this._tap.touchend(t,n,o);c&&(this._tapTime=t.timeStamp,this._tapPoint=c)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class bo{constructor(t,n,o){this._el=t,this._mousePan=n,this._touchPan=o}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class _r{constructor(t,n,o){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=n,this._mousePitch=o}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Dn{constructor(t,n,o,c){this._el=t,this._touchZoom=n,this._touchRotate=o,this._tapDragZoom=c,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ns=u=>u.zoom||u.drag||u.pitch||u.rotate;class wo extends a.k{}function js(u){return u.panDelta&&u.panDelta.mag()||u.zoomDelta||u.bearingDelta||u.pitchDelta}class So{constructor(t,n){this.handleWindowEvent=c=>{this.handleEvent(c,`${c.type}Window`)},this.handleEvent=(c,d)=>{if(c.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const _=c.type==="renderFrame"?void 0:c,y={needsRenderFrame:!1},x={},C={},E=c.touches,P=E?this._getMapTouches(E):void 0,L=P?F.touchPos(this._el,P):F.mousePos(this._el,c);for(const{handlerName:G,handler:N,allowed:re}of this._handlers){if(!N.isEnabled())continue;let he;this._blockedByActive(C,re,G)?N.reset():N[d||c.type]&&(he=N[d||c.type](c,L,P),this.mergeHandlerResult(y,x,he,G,_),he&&he.needsRenderFrame&&this._triggerRenderFrame()),(he||N.isActive())&&(C[G]=N)}const U={};for(const G in this._previousActiveHandlers)C[G]||(U[G]=_);this._previousActiveHandlers=C,(Object.keys(U).length||js(y))&&(this._changes.push([y,x,U]),this._triggerRenderFrame()),(Object.keys(C).length||js(y))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:V}=y;V&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],V(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Pl(t),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(n);const o=this._el;this._listeners=[[o,"touchstart",{passive:!0}],[o,"touchmove",{passive:!1}],[o,"touchend",void 0],[o,"touchcancel",void 0],[o,"mousedown",void 0],[o,"mousemove",void 0],[o,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[o,"mouseover",void 0],[o,"mouseout",void 0],[o,"dblclick",void 0],[o,"click",void 0],[o,"keydown",{capture:!1}],[o,"keyup",void 0],[o,"wheel",{passive:!1}],[o,"contextmenu",void 0],[window,"blur",void 0]];for(const[c,d,_]of this._listeners)F.addEventListener(c,d,c===document?this.handleWindowEvent:this.handleEvent,_)}destroy(){for(const[t,n,o]of this._listeners)F.removeEventListener(t,n,t===document?this.handleWindowEvent:this.handleEvent,o)}_addDefaultHandlers(t){const n=this._map,o=n.getCanvasContainer();this._add("mapEvent",new Ml(n,t));const c=n.boxZoom=new zl(n,t);this._add("boxZoom",c),t.interactive&&t.boxZoom&&c.enable();const d=new fn(n),_=new vo(n);n.doubleClickZoom=new yo(_,d),this._add("tapZoom",d),this._add("clickZoom",_),t.interactive&&t.doubleClickZoom&&n.doubleClickZoom.enable();const y=new xo;this._add("tapDragZoom",y);const x=n.touchPitch=new Jc(n);this._add("touchPitch",x),t.interactive&&t.touchPitch&&n.touchPitch.enable(t.touchPitch);const C=ds(t),E=gn(t);n.dragRotate=new _r(t,C,E),this._add("mouseRotate",C,["mousePitch"]),this._add("mousePitch",E,["mouseRotate"]),t.interactive&&t.dragRotate&&n.dragRotate.enable();const P=(({enable:re,clickTolerance:he})=>{const J=new fo({checkCorrectEvent:se=>F.mouseButton(se)===0&&!se.ctrlKey});return new mn({clickTolerance:he,move:(se,pe)=>({around:pe,panDelta:pe.sub(se)}),activateOnStart:!0,moveStateManager:J,enable:re,assignEvents:Ca})})(t),L=new He(t,n);n.dragPan=new bo(o,P,L),this._add("mousePan",P),this._add("touchPan",L,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&n.dragPan.enable(t.dragPan);const U=new mo,V=new Ll;n.touchZoomRotate=new Dn(o,V,U,y),this._add("touchRotate",U,["touchPan","touchZoom"]),this._add("touchZoom",V,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&n.touchZoomRotate.enable(t.touchZoomRotate);const G=n.scrollZoom=new Yc(n,()=>this._triggerRenderFrame());this._add("scrollZoom",G,["mousePan"]),t.interactive&&t.scrollZoom&&n.scrollZoom.enable(t.scrollZoom);const N=n.keyboard=new Rl(n);this._add("keyboard",N),t.interactive&&t.keyboard&&n.keyboard.enable(),this._add("blockableMapEvent",new kl(n))}_add(t,n,o){this._handlers.push({handlerName:t,handler:n,allowed:o}),this._handlersById[t]=n}stop(t){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ns(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,n,o){for(const c in t)if(c!==o&&(!n||n.indexOf(c)<0))return!0;return!1}_getMapTouches(t){const n=[];for(const o of t)this._el.contains(o.target)&&n.push(o);return n}mergeHandlerResult(t,n,o,c,d){if(!o)return;a.e(t,o);const _={handlerName:c,originalEvent:o.originalEvent||d};o.zoomDelta!==void 0&&(n.zoom=_),o.panDelta!==void 0&&(n.drag=_),o.pitchDelta!==void 0&&(n.pitch=_),o.bearingDelta!==void 0&&(n.rotate=_)}_applyChanges(){const t={},n={},o={};for(const[c,d,_]of this._changes)c.panDelta&&(t.panDelta=(t.panDelta||new a.P(0,0))._add(c.panDelta)),c.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+c.zoomDelta),c.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+c.bearingDelta),c.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+c.pitchDelta),c.around!==void 0&&(t.around=c.around),c.pinchAround!==void 0&&(t.pinchAround=c.pinchAround),c.noInertia&&(t.noInertia=c.noInertia),a.e(n,d),a.e(o,_);this._updateMapTransform(t,n,o),this._changes=[]}_updateMapTransform(t,n,o){const c=this._map,d=c._getTransformForUpdate(),_=c.terrain;if(!(js(t)||_&&this._terrainMovement))return this._fireEvents(n,o,!0);let{panDelta:y,zoomDelta:x,bearingDelta:C,pitchDelta:E,around:P,pinchAround:L}=t;L!==void 0&&(P=L),c._stop(!0),P=P||c.transform.centerPoint;const U=d.pointLocation(y?P.sub(y):P);C&&(d.bearing+=C),E&&(d.pitch+=E),x&&(d.zoom+=x),_?this._terrainMovement||!n.drag&&!n.zoom?n.drag&&this._terrainMovement?d.center=d.pointLocation(d.centerPoint.sub(y)):d.setLocationAtPoint(U,P):(this._terrainMovement=!0,this._map._elevationFreeze=!0,d.setLocationAtPoint(U,P),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,d.recalculateZoom(c.terrain)})):d.setLocationAtPoint(U,P),c._applyUpdatedTransform(d),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(n,o,!0)}_fireEvents(t,n,o){const c=Ns(this._eventsInProgress),d=Ns(t),_={};for(const E in t){const{originalEvent:P}=t[E];this._eventsInProgress[E]||(_[`${E}start`]=P),this._eventsInProgress[E]=t[E]}!c&&d&&this._fireEvent("movestart",d.originalEvent);for(const E in _)this._fireEvent(E,_[E]);d&&this._fireEvent("move",d.originalEvent);for(const E in t){const{originalEvent:P}=t[E];this._fireEvent(E,P)}const y={};let x;for(const E in this._eventsInProgress){const{handlerName:P,originalEvent:L}=this._eventsInProgress[E];this._handlersById[P].isActive()||(delete this._eventsInProgress[E],x=n[P]||L,y[`${E}end`]=x)}for(const E in y)this._fireEvent(E,y[E]);const C=Ns(this._eventsInProgress);if(o&&(c||d)&&!C){this._updatingCamera=!0;const E=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),P=L=>L!==0&&-this._bearingSnap<L&&L<this._bearingSnap;!E||!E.essential&&a.h.prefersReducedMotion?(this._map.fire(new a.k("moveend",{originalEvent:x})),P(this._map.getBearing())&&this._map.resetNorth()):(P(E.bearing||this._map.getBearing())&&(E.bearing=0),E.freezeElevation=!0,this._map.easeTo(E,{originalEvent:x})),this._updatingCamera=!1}}_fireEvent(t,n){this._map.fire(new a.k(t,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new wo("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Ol extends a.E{constructor(t,n){super(),this._renderFrameCallback=()=>{const o=Math.min((a.h.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(o)),o<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=n.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new a.L(this.transform.center.lng,this.transform.center.lat)}setCenter(t,n){return this.jumpTo({center:t},n)}panBy(t,n,o){return t=a.P.convert(t).mult(-1),this.panTo(this.transform.center,a.e({offset:t},n),o)}panTo(t,n,o){return this.easeTo(a.e({center:t},n),o)}getZoom(){return this.transform.zoom}setZoom(t,n){return this.jumpTo({zoom:t},n),this}zoomTo(t,n,o){return this.easeTo(a.e({zoom:t},n),o)}zoomIn(t,n){return this.zoomTo(this.getZoom()+1,t,n),this}zoomOut(t,n){return this.zoomTo(this.getZoom()-1,t,n),this}getBearing(){return this.transform.bearing}setBearing(t,n){return this.jumpTo({bearing:t},n),this}getPadding(){return this.transform.padding}setPadding(t,n){return this.jumpTo({padding:t},n),this}rotateTo(t,n,o){return this.easeTo(a.e({bearing:t},n),o)}resetNorth(t,n){return this.rotateTo(0,a.e({duration:1e3},t),n),this}resetNorthPitch(t,n){return this.easeTo(a.e({bearing:0,pitch:0,duration:1e3},t),n),this}snapToNorth(t,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,n):this}getPitch(){return this.transform.pitch}setPitch(t,n){return this.jumpTo({pitch:t},n),this}cameraForBounds(t,n){t=Ze.convert(t);const o=n&&n.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),o,n)}_cameraForBoxAndBearing(t,n,o,c){const d={top:0,bottom:0,right:0,left:0};if(typeof(c=a.e({padding:d,offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding=="number"){const pe=c.padding;c.padding={top:pe,bottom:pe,right:pe,left:pe}}c.padding=a.e(d,c.padding);const _=this.transform,y=_.padding,x=_.project(a.L.convert(t)),C=_.project(a.L.convert(n)),E=x.rotate(-o*Math.PI/180),P=C.rotate(-o*Math.PI/180),L=new a.P(Math.max(E.x,P.x),Math.max(E.y,P.y)),U=new a.P(Math.min(E.x,P.x),Math.min(E.y,P.y)),V=L.sub(U),G=(_.width-(y.left+y.right+c.padding.left+c.padding.right))/V.x,N=(_.height-(y.top+y.bottom+c.padding.top+c.padding.bottom))/V.y;if(N<0||G<0)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const re=Math.min(_.scaleZoom(_.scale*Math.min(G,N)),c.maxZoom),he=a.P.convert(c.offset),J=new a.P((c.padding.left-c.padding.right)/2,(c.padding.top-c.padding.bottom)/2).rotate(o*Math.PI/180),se=he.add(J).mult(_.scale/_.zoomScale(re));return{center:_.unproject(x.add(C).div(2).sub(se)),zoom:re,bearing:o}}fitBounds(t,n,o){return this._fitInternal(this.cameraForBounds(t,n),n,o)}fitScreenCoordinates(t,n,o,c,d){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(a.P.convert(t)),this.transform.pointLocation(a.P.convert(n)),o,c),c,d)}_fitInternal(t,n,o){return t?(delete(n=a.e(t,n)).padding,n.linear?this.easeTo(n,o):this.flyTo(n,o)):this}jumpTo(t,n){this.stop();const o=this._getTransformForUpdate();let c=!1,d=!1,_=!1;return"zoom"in t&&o.zoom!==+t.zoom&&(c=!0,o.zoom=+t.zoom),t.center!==void 0&&(o.center=a.L.convert(t.center)),"bearing"in t&&o.bearing!==+t.bearing&&(d=!0,o.bearing=+t.bearing),"pitch"in t&&o.pitch!==+t.pitch&&(_=!0,o.pitch=+t.pitch),t.padding==null||o.isPaddingEqual(t.padding)||(o.padding=t.padding),this._applyUpdatedTransform(o),this.fire(new a.k("movestart",n)).fire(new a.k("move",n)),c&&this.fire(new a.k("zoomstart",n)).fire(new a.k("zoom",n)).fire(new a.k("zoomend",n)),d&&this.fire(new a.k("rotatestart",n)).fire(new a.k("rotate",n)).fire(new a.k("rotateend",n)),_&&this.fire(new a.k("pitchstart",n)).fire(new a.k("pitch",n)).fire(new a.k("pitchend",n)),this.fire(new a.k("moveend",n))}calculateCameraOptionsFromTo(t,n,o,c=0){const d=a.U.fromLngLat(t,n),_=a.U.fromLngLat(o,c),y=_.x-d.x,x=_.y-d.y,C=_.z-d.z,E=Math.hypot(y,x,C);if(E===0)throw new Error("Can't calculate camera options with same From and To");const P=Math.hypot(y,x),L=this.transform.scaleZoom(this.transform.cameraToCenterDistance/E/this.transform.tileSize),U=180*Math.atan2(y,-x)/Math.PI;let V=180*Math.acos(P/E)/Math.PI;return V=C<0?90-V:90+V,{center:_.toLngLat(),zoom:L,pitch:V,bearing:U}}easeTo(t,n){this._stop(!1,t.easeId),((t=a.e({offset:[0,0],duration:500,easing:a.bb},t)).animate===!1||!t.essential&&a.h.prefersReducedMotion)&&(t.duration=0);const o=this._getTransformForUpdate(),c=this.getZoom(),d=this.getBearing(),_=this.getPitch(),y=this.getPadding(),x="zoom"in t?+t.zoom:c,C="bearing"in t?this._normalizeBearing(t.bearing,d):d,E="pitch"in t?+t.pitch:_,P="padding"in t?t.padding:o.padding,L=a.P.convert(t.offset);let U=o.centerPoint.add(L);const V=o.pointLocation(U),G=a.L.convert(t.center||V);this._normalizeCenter(G);const N=o.project(V),re=o.project(G).sub(N),he=o.zoomScale(x-c);let J,se;t.around&&(J=a.L.convert(t.around),se=o.locationPoint(J));const pe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||x!==c,this._rotating=this._rotating||d!==C,this._pitching=this._pitching||E!==_,this._padding=!o.isPaddingEqual(P),this._easeId=t.easeId,this._prepareEase(n,t.noMoveStart,pe),this.terrain&&this._prepareElevation(G),this._ease(fe=>{if(this._zooming&&(o.zoom=a.B.number(c,x,fe)),this._rotating&&(o.bearing=a.B.number(d,C,fe)),this._pitching&&(o.pitch=a.B.number(_,E,fe)),this._padding&&(o.interpolatePadding(y,P,fe),U=o.centerPoint.add(L)),this.terrain&&!t.freezeElevation&&this._updateElevation(fe),J)o.setLocationAtPoint(J,se);else{const be=o.zoomScale(o.zoom-c),Pe=x>c?Math.min(2,he):Math.max(.5,he),Ce=Math.pow(Pe,1-fe),Le=o.unproject(N.add(re.mult(fe*Ce)).mult(be));o.setLocationAtPoint(o.renderWorldCopies?Le.wrap():Le,U)}this._applyUpdatedTransform(o),this._fireMoveEvents(n)},fe=>{this.terrain&&this._finalizeElevation(),this._afterEase(n,fe)},t),this}_prepareEase(t,n,o={}){this._moving=!0,n||o.moving||this.fire(new a.k("movestart",t)),this._zooming&&!o.zooming&&this.fire(new a.k("zoomstart",t)),this._rotating&&!o.rotating&&this.fire(new a.k("rotatestart",t)),this._pitching&&!o.pitching&&this.fire(new a.k("pitchstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const n=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&n!==this._elevationTarget){const o=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(o-(n-(o*t+this._elevationStart))/(1-t)),this._elevationTarget=n}this.transform.elevation=a.B.number(this._elevationStart,this._elevationTarget,t)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(t){if(!this.transformCameraUpdate)return;const n=t.clone(),{center:o,zoom:c,pitch:d,bearing:_,elevation:y}=this.transformCameraUpdate(n);o&&(n.center=o),c!==void 0&&(n.zoom=c),d!==void 0&&(n.pitch=d),_!==void 0&&(n.bearing=_),y!==void 0&&(n.elevation=y),this.transform.apply(n)}_fireMoveEvents(t){this.fire(new a.k("move",t)),this._zooming&&this.fire(new a.k("zoom",t)),this._rotating&&this.fire(new a.k("rotate",t)),this._pitching&&this.fire(new a.k("pitch",t))}_afterEase(t,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId;const o=this._zooming,c=this._rotating,d=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,o&&this.fire(new a.k("zoomend",t)),c&&this.fire(new a.k("rotateend",t)),d&&this.fire(new a.k("pitchend",t)),this.fire(new a.k("moveend",t))}flyTo(t,n){if(!t.essential&&a.h.prefersReducedMotion){const Qe=a.F(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Qe,n)}this.stop(),t=a.e({offset:[0,0],speed:1.2,curve:1.42,easing:a.bb},t);const o=this._getTransformForUpdate(),c=this.getZoom(),d=this.getBearing(),_=this.getPitch(),y=this.getPadding(),x="zoom"in t?a.ad(+t.zoom,o.minZoom,o.maxZoom):c,C="bearing"in t?this._normalizeBearing(t.bearing,d):d,E="pitch"in t?+t.pitch:_,P="padding"in t?t.padding:o.padding,L=o.zoomScale(x-c),U=a.P.convert(t.offset);let V=o.centerPoint.add(U);const G=o.pointLocation(V),N=a.L.convert(t.center||G);this._normalizeCenter(N);const re=o.project(G),he=o.project(N).sub(re);let J=t.curve;const se=Math.max(o.width,o.height),pe=se/L,fe=he.mag();if("minZoom"in t){const Qe=a.ad(Math.min(t.minZoom,c,x),o.minZoom,o.maxZoom),Gt=se/o.zoomScale(Qe-c);J=Math.sqrt(Gt/fe*2)}const be=J*J;function Pe(Qe){const Gt=(pe*pe-se*se+(Qe?-1:1)*be*be*fe*fe)/(2*(Qe?pe:se)*be*fe);return Math.log(Math.sqrt(Gt*Gt+1)-Gt)}function Ce(Qe){return(Math.exp(Qe)-Math.exp(-Qe))/2}function Le(Qe){return(Math.exp(Qe)+Math.exp(-Qe))/2}const Ke=Pe(!1);let Tt=function(Qe){return Le(Ke)/Le(Ke+J*Qe)},Oe=function(Qe){return se*((Le(Ke)*(Ce(Gt=Ke+J*Qe)/Le(Gt))-Ce(Ke))/be)/fe;var Gt},ht=(Pe(!0)-Ke)/J;if(Math.abs(fe)<1e-6||!isFinite(ht)){if(Math.abs(se-pe)<1e-6)return this.easeTo(t,n);const Qe=pe<se?-1:1;ht=Math.abs(Math.log(pe/se))/J,Oe=function(){return 0},Tt=function(Gt){return Math.exp(Qe*J*Gt)}}return t.duration="duration"in t?+t.duration:1e3*ht/("screenSpeed"in t?+t.screenSpeed/J:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=d!==C,this._pitching=E!==_,this._padding=!o.isPaddingEqual(P),this._prepareEase(n,!1),this.terrain&&this._prepareElevation(N),this._ease(Qe=>{const Gt=Qe*ht,Ct=1/Tt(Gt);o.zoom=Qe===1?x:c+o.scaleZoom(Ct),this._rotating&&(o.bearing=a.B.number(d,C,Qe)),this._pitching&&(o.pitch=a.B.number(_,E,Qe)),this._padding&&(o.interpolatePadding(y,P,Qe),V=o.centerPoint.add(U)),this.terrain&&!t.freezeElevation&&this._updateElevation(Qe);const bt=Qe===1?N:o.unproject(re.add(he.mult(Oe(Gt))).mult(Ct));o.setLocationAtPoint(o.renderWorldCopies?bt.wrap():bt,V),this._applyUpdatedTransform(o),this._fireMoveEvents(n)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(n)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,n){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const o=this._onEaseEnd;delete this._onEaseEnd,o.call(this,n)}if(!t){const o=this.handlers;o&&o.stop(!1)}return this}_ease(t,n,o){o.animate===!1||o.duration===0?(t(1),n()):(this._easeStart=a.h.now(),this._easeOptions=o,this._onEaseFrame=t,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,n){t=a.b5(t,-180,180);const o=Math.abs(t-n);return Math.abs(t-360-n)<o&&(t-=360),Math.abs(t+360-n)<o&&(t+=360),t}_normalizeCenter(t){const n=this.transform;if(!n.renderWorldCopies||n.lngRange)return;const o=t.lng-n.center.lng;t.lng+=o>180?-360:o<-180?360:0}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(a.L.convert(t),this.transform.tileZoom)-this.transform.elevation:null}}class Ar{constructor(t={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=n=>{!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"&&n.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options&&this.options.compact,this._container=F.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=F.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=F.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){F.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,n){const o=this._map._getUIString(`AttributionControl.${n}`);t.title=o,t.setAttribute("aria-label",o)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(c=>typeof c!="string"?"":c)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const c=this._map.style.stylesheet;this.styleOwner=c.owner,this.styleId=c.id}const n=this._map.style.sourceCaches;for(const c in n){const d=n[c];if(d.used||d.usedForTerrain){const _=d.getSource();_.attribution&&t.indexOf(_.attribution)<0&&t.push(_.attribution)}}t=t.filter(c=>String(c).trim()),t.sort((c,d)=>c.length-d.length),t=t.filter((c,d)=>{for(let _=d+1;_<t.length;_++)if(t[_].indexOf(c)>=0)return!1;return!0});const o=t.join(" | ");o!==this._attribHTML&&(this._attribHTML=o,t.length?(this._innerContainer.innerHTML=o,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class ii{constructor(t={}){this._updateCompact=()=>{const n=this._container.children;if(n.length){const o=n[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&o.classList.add("maplibregl-compact"):o.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=F.create("div","maplibregl-ctrl");const n=F.create("a","maplibregl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://maplibre.org/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){F.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Ia{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const n=++this._id;return this._queue.push({callback:t,id:n,cancelled:!1}),n}remove(t){const n=this._currentlyRunning,o=n?this._queue.concat(n):this._queue;for(const c of o)if(c.id===t)return void(c.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const n=this._currentlyRunning=this._queue;this._queue=[];for(const o of n)if(!o.cancelled&&(o.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const Co={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var $l=a.Q([{name:"a_pos3d",type:"Int16",components:3}]);class Nl extends a.E{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,n){this.sourceCache.update(t,n),this._renderableTilesKeys=[];const o={};for(const c of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:n}))o[c.key]=!0,this._renderableTilesKeys.push(c.key),this._tiles[c.key]||(c.posMatrix=new Float64Array(16),a.aS(c.posMatrix,0,a.N,0,a.N,0,1),this._tiles[c.key]=new mr(c,this.tileSize));for(const c in this._tiles)o[c]||delete this._tiles[c]}freeRtt(t){for(const n in this._tiles){const o=this._tiles[n];(!t||o.tileID.equals(t)||o.tileID.isChildOf(t)||t.isChildOf(o.tileID))&&(o.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const n={};for(const o of this._renderableTilesKeys){const c=this._tiles[o].tileID;if(c.canonical.equals(t.canonical)){const d=t.clone();d.posMatrix=new Float64Array(16),a.aS(d.posMatrix,0,a.N,0,a.N,0,1),n[o]=d}else if(c.canonical.isChildOf(t.canonical)){const d=t.clone();d.posMatrix=new Float64Array(16);const _=c.canonical.z-t.canonical.z,y=c.canonical.x-(c.canonical.x>>_<<_),x=c.canonical.y-(c.canonical.y>>_<<_),C=a.N>>_;a.aS(d.posMatrix,0,C,0,C,0,1),a.$(d.posMatrix,d.posMatrix,[-y*C,-x*C,0]),n[o]=d}else if(t.canonical.isChildOf(c.canonical)){const d=t.clone();d.posMatrix=new Float64Array(16);const _=t.canonical.z-c.canonical.z,y=t.canonical.x-(t.canonical.x>>_<<_),x=t.canonical.y-(t.canonical.y>>_<<_),C=a.N>>_;a.aS(d.posMatrix,0,a.N,0,a.N,0,1),a.$(d.posMatrix,d.posMatrix,[y*C,x*C,0]),a.a0(d.posMatrix,d.posMatrix,[1/2**_,1/2**_,0]),n[o]=d}}return n}getSourceTile(t,n){const o=this.sourceCache._source;let c=t.overscaledZ-this.deltaZoom;if(c>o.maxzoom&&(c=o.maxzoom),c<o.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(c).key);let d=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!d||!d.dem)&&n)for(;c>=o.minzoom&&(!d||!d.dem);)d=this.sourceCache.getTileByID(t.scaledTo(c--).key);return d}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(n=>n.timeAdded>=t)}}class jl{constructor(t,n,o){this.painter=t,this.sourceCache=new Nl(n),this.options=o,this.exaggeration=typeof o.exaggeration=="number"?o.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,n,o,c=a.N){var d;if(!(n>=0&&n<c&&o>=0&&o<c))return 0;const _=this.getTerrainData(t),y=(d=_.tile)===null||d===void 0?void 0:d.dem;if(!y)return 0;const x=function(V,G,N){var re=G[0],he=G[1];return V[0]=N[0]*re+N[4]*he+N[12],V[1]=N[1]*re+N[5]*he+N[13],V}([],[n/c*a.N,o/c*a.N],_.u_terrain_matrix),C=[x[0]*y.dim,x[1]*y.dim],E=Math.floor(C[0]),P=Math.floor(C[1]),L=C[0]-E,U=C[1]-P;return y.get(E,P)*(1-L)*(1-U)+y.get(E+1,P)*L*(1-U)+y.get(E,P+1)*(1-L)*U+y.get(E+1,P+1)*L*U}getElevationForLngLatZoom(t,n){const{tileID:o,mercatorX:c,mercatorY:d}=this._getOverscaledTileIDFromLngLatZoom(t,n);return this.getElevation(o,c%a.N,d%a.N,a.N)}getElevation(t,n,o,c=a.N){return this.getDEMElevation(t,n,o,c)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const c=this.painter.context,d=new a.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new De(c,d,c.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new De(c,new a.R({width:1,height:1}),c.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.ao([])}const n=this.sourceCache.getSourceTile(t,!0);if(n&&n.dem&&(!n.demTexture||n.needsTerrainPrepare)){const c=this.painter.context;n.demTexture=this.painter.getTileTexture(n.dem.stride),n.demTexture?n.demTexture.update(n.dem.getPixels(),{premultiply:!1}):n.demTexture=new De(c,n.dem.getPixels(),c.gl.RGBA,{premultiply:!1}),n.demTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),n.needsTerrainPrepare=!1}const o=n&&n+n.tileID.key+t.key;if(o&&!this._demMatrixCache[o]){const c=this.sourceCache.sourceCache._source.maxzoom;let d=t.canonical.z-n.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=c?d=t.canonical.z-c:a.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const _=t.canonical.x-(t.canonical.x>>d<<d),y=t.canonical.y-(t.canonical.y>>d<<d),x=a.bc(new Float64Array(16),[1/(a.N<<d),1/(a.N<<d),0]);a.$(x,x,[_*a.N,y*a.N,0]),this._demMatrixCache[t.key]={matrix:x,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:n&&n.dem&&n.dem.dim||1,u_terrain_matrix:o?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:n&&n.dem&&n.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(n&&n.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:n}}getFramebuffer(t){const n=this.painter,o=n.width/devicePixelRatio,c=n.height/devicePixelRatio;return!this._fbo||this._fbo.width===o&&this._fbo.height===c||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new De(n.context,{width:o,height:c,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new De(n.context,{width:o,height:c,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=n.context.createFramebuffer(o,c,!0,!1),this._fbo.depthAttachment.set(n.context.createRenderbuffer(n.context.gl.DEPTH_COMPONENT16,o,c))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const n=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let d=0,_=0;d<this._coordsTextureSize;d++)for(let y=0;y<this._coordsTextureSize;y++,_+=4)n[_+0]=255&y,n[_+1]=255&d,n[_+2]=y>>8<<4|d>>8,n[_+3]=0;const o=new a.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(n.buffer)),c=new De(t,o,t.gl.RGBA,{premultiply:!1});return c.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=c,c}pointCoordinate(t){const n=new Uint8Array(4),o=this.painter.context,c=o.gl;o.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),c.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,c.RGBA,c.UNSIGNED_BYTE,n),o.bindFramebuffer.set(null);const d=n[0]+(n[2]>>4<<8),_=n[1]+((15&n[2])<<8),y=this.coordsIndex[255-n[3]],x=y&&this.sourceCache.getTileByID(y);if(!x)return null;const C=this._coordsTextureSize,E=(1<<x.tileID.canonical.z)*C;return new a.U(this._allowMercatorOverflow(t,(x.tileID.canonical.x*C+d)/E),(x.tileID.canonical.y*C+_)/E,this.getElevation(x.tileID,d,_,C))}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.painter.context,n=new a.bd,o=new a.b0,c=this.meshSize,d=a.N/c,_=c*c;for(let P=0;P<=c;P++)for(let L=0;L<=c;L++)n.emplaceBack(L*d,P*d,0);for(let P=0;P<_;P+=c+1)for(let L=0;L<c;L++)o.emplaceBack(L+P,c+L+P+1,c+L+P+2),o.emplaceBack(L+P,c+L+P+2,L+P+1);const y=n.length,x=y+2*(c+1);for(const P of[0,1])for(let L=0;L<=c;L++)for(const U of[0,1])n.emplaceBack(L*d,P*a.N,U);for(let P=0;P<2*c;P+=2)o.emplaceBack(x+P,x+P+1,x+P+3),o.emplaceBack(x+P,x+P+3,x+P+2),o.emplaceBack(y+P,y+P+3,y+P+1),o.emplaceBack(y+P,y+P+2,y+P+3);const C=n.length,E=C+2*(c+1);for(const P of[0,1])for(let L=0;L<=c;L++)for(const U of[0,1])n.emplaceBack(P*a.N,L*d,U);for(let P=0;P<2*c;P+=2)o.emplaceBack(C+P,C+P+1,C+P+3),o.emplaceBack(C+P,C+P+3,C+P+2),o.emplaceBack(E+P,E+P+3,E+P+1),o.emplaceBack(E+P,E+P+2,E+P+3);return this._mesh={indexBuffer:t.createIndexBuffer(o),vertexBuffer:t.createVertexBuffer(n,$l.members),segments:a.S.simpleSegment(0,0,n.length,o.length)},this._mesh}getMeshFrameDelta(t){return 2*Math.PI*a.be/Math.pow(2,t)/5}getMinTileElevationForLngLatZoom(t,n){var o;const{tileID:c}=this._getOverscaledTileIDFromLngLatZoom(t,n);return(o=this.getMinMaxElevation(c).minElevation)!==null&&o!==void 0?o:0}getMinMaxElevation(t){const n=this.getTerrainData(t).tile,o={minElevation:null,maxElevation:null};return n&&n.dem&&(o.minElevation=n.dem.min*this.exaggeration,o.maxElevation=n.dem.max*this.exaggeration),o}_getOverscaledTileIDFromLngLatZoom(t,n){const o=a.U.fromLngLat(t.wrap()),c=(1<<n)*a.N,d=o.x*c,_=o.y*c,y=Math.floor(d/a.N),x=Math.floor(_/a.N);return{tileID:new a.O(n,0,n,y,x),mercatorX:d,mercatorY:_}}_allowMercatorOverflow(t,n){const o=t.x<this.painter.width/2;let c=a.bf(n);const d=this.painter.transform.center.lng;return o&&Math.sign(c)>0&&Math.sign(d)<0||!o&&Math.sign(c)<0&&Math.sign(d)>0?(c=360*Math.sign(d)+c,a.G(c)):n}}class Qc{constructor(t,n,o){this._context=t,this._size=n,this._tileSize=o,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const n=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),o=new De(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return o.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),n.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),n.colorAttachment.set(o.texture),{id:t,fbo:n,texture:o,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(n=>t.id!==n),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const n of this._recentlyUsed)if(!this._objects[n].inUse)return this._objects[n];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const or={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Ea{constructor(t,n){this.painter=t,this.terrain=n,this.pool=new Qc(t.context,30,n.sourceCache.tileSize*n.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,n){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(o=>!t._layers[o].isHidden(n)),this._coordsDescendingInv={};for(const o in t.sourceCaches){this._coordsDescendingInv[o]={};const c=t.sourceCaches[o].getVisibleCoordinates();for(const d of c){const _=this.terrain.sourceCache.getTerrainCoords(d);for(const y in _)this._coordsDescendingInv[o][y]||(this._coordsDescendingInv[o][y]=[]),this._coordsDescendingInv[o][y].push(_[y])}}this._coordsDescendingInvStr={};for(const o of t._order){const c=t._layers[o],d=c.source;if(or[c.type]&&!this._coordsDescendingInvStr[d]){this._coordsDescendingInvStr[d]={};for(const _ in this._coordsDescendingInv[d])this._coordsDescendingInvStr[d][_]=this._coordsDescendingInv[d][_].map(y=>y.key).sort().join()}}for(const o of this._renderableTiles)for(const c in this._coordsDescendingInvStr){const d=this._coordsDescendingInvStr[c][o.tileID.key];d&&d!==o.rttCoords[c]&&(o.rtt=[])}}renderLayer(t){if(t.isHidden(this.painter.transform.zoom))return!1;const n=t.type,o=this.painter,c=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(or[n]&&(this._prevType&&or[this._prevType]||this._stacks.push([]),this._prevType=n,this._stacks[this._stacks.length-1].push(t.id),!c))return!0;if(or[this._prevType]||or[n]&&c){this._prevType=n;const d=this._stacks.length-1,_=this._stacks[d]||[];for(const y of this._renderableTiles){if(this.pool.isFull()&&(fi(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(y),y.rtt[d]){const C=this.pool.getObjectForId(y.rtt[d].id);if(C.stamp===y.rtt[d].stamp){this.pool.useObject(C);continue}}const x=this.pool.getOrCreateFreeObject();this.pool.useObject(x),this.pool.stampObject(x),y.rtt[d]={id:x.id,stamp:x.stamp},o.context.bindFramebuffer.set(x.fbo.framebuffer),o.context.clear({color:a.aT.transparent,stencil:0}),o.currentStencilSource=void 0;for(let C=0;C<_.length;C++){const E=o.style._layers[_[C]],P=E.source?this._coordsDescendingInv[E.source][y.tileID.key]:[y.tileID];o.context.viewport.set([0,0,x.fbo.width,x.fbo.height]),o._renderTileClippingMasks(E,P),o.renderLayer(o,o.style.sourceCaches[E.source],E,P),E.source&&(y.rttCoords[E.source]=this._coordsDescendingInvStr[E.source][y.tileID.key])}}return fi(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),or[n]}return!1}}const tt=W,ut={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:a.c.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},Vs=u=>{u.touchstart=u.dragStart,u.touchmoveWindow=u.dragMove,u.touchend=u.dragEnd},To={showCompass:!0,showZoom:!0,visualizePitch:!1};class Io{constructor(t,n,o=!1){this.mousedown=_=>{this.startMouse(a.e({},_,{ctrlKey:!0,preventDefault:()=>_.preventDefault()}),F.mousePos(this.element,_)),F.addEventListener(window,"mousemove",this.mousemove),F.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=_=>{this.moveMouse(_,F.mousePos(this.element,_))},this.mouseup=_=>{this.mouseRotate.dragEnd(_),this.mousePitch&&this.mousePitch.dragEnd(_),this.offTemp()},this.touchstart=_=>{_.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=F.touchPos(this.element,_.targetTouches)[0],this.startTouch(_,this._startPos),F.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),F.addEventListener(window,"touchend",this.touchend))},this.touchmove=_=>{_.targetTouches.length!==1?this.reset():(this._lastPos=F.touchPos(this.element,_.targetTouches)[0],this.moveTouch(_,this._lastPos))},this.touchend=_=>{_.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const c=t.dragRotate._mouseRotate.getClickTolerance(),d=t.dragRotate._mousePitch.getClickTolerance();this.element=n,this.mouseRotate=ds({clickTolerance:c,enable:!0}),this.touchRotate=(({enable:_,clickTolerance:y,bearingDegreesPerPixelMoved:x=.8})=>{const C=new Dl;return new mn({clickTolerance:y,move:(E,P)=>({bearingDelta:(P.x-E.x)*x}),moveStateManager:C,enable:_,assignEvents:Vs})})({clickTolerance:c,enable:!0}),this.map=t,o&&(this.mousePitch=gn({clickTolerance:d,enable:!0}),this.touchPitch=(({enable:_,clickTolerance:y,pitchDegreesPerPixelMoved:x=-.5})=>{const C=new Dl;return new mn({clickTolerance:y,move:(E,P)=>({pitchDelta:(P.y-E.y)*x}),moveStateManager:C,enable:_,assignEvents:Vs})})({clickTolerance:d,enable:!0})),F.addEventListener(n,"mousedown",this.mousedown),F.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),F.addEventListener(n,"touchcancel",this.reset)}startMouse(t,n){this.mouseRotate.dragStart(t,n),this.mousePitch&&this.mousePitch.dragStart(t,n),F.disableDrag()}startTouch(t,n){this.touchRotate.dragStart(t,n),this.touchPitch&&this.touchPitch.dragStart(t,n),F.disableDrag()}moveMouse(t,n){const o=this.map,{bearingDelta:c}=this.mouseRotate.dragMove(t,n)||{};if(c&&o.setBearing(o.getBearing()+c),this.mousePitch){const{pitchDelta:d}=this.mousePitch.dragMove(t,n)||{};d&&o.setPitch(o.getPitch()+d)}}moveTouch(t,n){const o=this.map,{bearingDelta:c}=this.touchRotate.dragMove(t,n)||{};if(c&&o.setBearing(o.getBearing()+c),this.touchPitch){const{pitchDelta:d}=this.touchPitch.dragMove(t,n)||{};d&&o.setPitch(o.getPitch()+d)}}off(){const t=this.element;F.removeEventListener(t,"mousedown",this.mousedown),F.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),F.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),F.removeEventListener(window,"touchend",this.touchend),F.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){F.enableDrag(),F.removeEventListener(window,"mousemove",this.mousemove),F.removeEventListener(window,"mouseup",this.mouseup),F.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),F.removeEventListener(window,"touchend",this.touchend)}}let wi;function Eo(u,t,n){if(u=new a.L(u.lng,u.lat),t){const o=new a.L(u.lng-360,u.lat),c=new a.L(u.lng+360,u.lat),d=n.locationPoint(u).distSqr(t);n.locationPoint(o).distSqr(t)<d?u=o:n.locationPoint(c).distSqr(t)<d&&(u=c)}for(;Math.abs(u.lng-n.center.lng)>180;){const o=n.locationPoint(u);if(o.x>=0&&o.y>=0&&o.x<=n.width&&o.y<=n.height)break;u.lng>n.center.lng?u.lng-=360:u.lng+=360}return u}const jr={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Vl(u,t,n){const o=u.classList;for(const c in jr)o.remove(`maplibregl-${n}-anchor-${c}`);o.add(`maplibregl-${n}-anchor-${t}`)}class Gn extends a.E{constructor(t){if(super(),this._onKeyPress=n=>{const o=n.code,c=n.charCode||n.keyCode;o!=="Space"&&o!=="Enter"&&c!==32&&c!==13||this.togglePopup()},this._onMapClick=n=>{const o=n.originalEvent.target,c=this._element;this._popup&&(o===c||c.contains(o))&&this.togglePopup()},this._update=n=>{if(!this._map)return;const o=this._map.loaded()&&!this._map.isMoving();(n?.type==="terrain"||n?.type==="render"&&!o)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=Eo(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let c="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?c=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(c=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let d="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?d="rotateX(0deg)":this._pitchAlignment==="map"&&(d=`rotateX(${this._map.getPitch()}deg)`),n&&n.type!=="moveend"||(this._pos=this._pos.round()),F.setTransform(this._element,`${jr[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${d} ${c}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const _=this._map.unproject(this._pos),y=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=_.distanceTo(this._lngLat)>20*y?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=n=>{if(!this._isDragging){const o=this._clickTolerance||this._map._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=o}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.k("dragstart"))),this.fire(new a.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.k("dragend")),this._state="inactive"},this._addDragHandler=n=>{this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos).add(this._offset),this._pointerdownPos=n.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=a.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=F.create("div"),this._element.setAttribute("aria-label","Map marker");const n=F.createNS("http://www.w3.org/2000/svg","svg"),o=41,c=27;n.setAttributeNS(null,"display","block"),n.setAttributeNS(null,"height",`${o}px`),n.setAttributeNS(null,"width",`${c}px`),n.setAttributeNS(null,"viewBox",`0 0 ${c} ${o}`);const d=F.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"stroke","none"),d.setAttributeNS(null,"stroke-width","1"),d.setAttributeNS(null,"fill","none"),d.setAttributeNS(null,"fill-rule","evenodd");const _=F.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"fill-rule","nonzero");const y=F.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"transform","translate(3.0, 29.0)"),y.setAttributeNS(null,"fill","#000000");const x=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const re of x){const he=F.createNS("http://www.w3.org/2000/svg","ellipse");he.setAttributeNS(null,"opacity","0.04"),he.setAttributeNS(null,"cx","10.5"),he.setAttributeNS(null,"cy","5.80029008"),he.setAttributeNS(null,"rx",re.rx),he.setAttributeNS(null,"ry",re.ry),y.appendChild(he)}const C=F.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill",this._color);const E=F.createNS("http://www.w3.org/2000/svg","path");E.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),C.appendChild(E);const P=F.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"opacity","0.25"),P.setAttributeNS(null,"fill","#000000");const L=F.createNS("http://www.w3.org/2000/svg","path");L.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),P.appendChild(L);const U=F.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"transform","translate(6.0, 7.0)"),U.setAttributeNS(null,"fill","#FFFFFF");const V=F.createNS("http://www.w3.org/2000/svg","g");V.setAttributeNS(null,"transform","translate(8.0, 8.0)");const G=F.createNS("http://www.w3.org/2000/svg","circle");G.setAttributeNS(null,"fill","#000000"),G.setAttributeNS(null,"opacity","0.25"),G.setAttributeNS(null,"cx","5.5"),G.setAttributeNS(null,"cy","5.5"),G.setAttributeNS(null,"r","5.4999962");const N=F.createNS("http://www.w3.org/2000/svg","circle");N.setAttributeNS(null,"fill","#FFFFFF"),N.setAttributeNS(null,"cx","5.5"),N.setAttributeNS(null,"cy","5.5"),N.setAttributeNS(null,"r","5.4999962"),V.appendChild(G),V.appendChild(N),_.appendChild(y),_.appendChild(C),_.appendChild(P),_.appendChild(U),_.appendChild(V),n.appendChild(_),n.setAttributeNS(null,"height",o*this._scale+"px"),n.setAttributeNS(null,"width",c*this._scale+"px"),this._element.appendChild(n),this._offset=a.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",n=>{n.preventDefault()}),this._element.addEventListener("mousedown",n=>{n.preventDefault()}),Vl(this._element,this._anchor,"marker"),t&&t.className)for(const n of t.className.split(" "))this._element.classList.add(n);this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),F.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=a.L.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const c=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[c,-1*(38.1-13.5+c)],"bottom-right":[-c,-1*(38.1-13.5+c)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(t){return this._offset=a.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const mi={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let di=0,fs=!1;const Us={maxWidth:100,unit:"metric"};function qs(u,t,n){const o=n&&n.maxWidth||100,c=u._container.clientHeight/2,d=u.unproject([0,c]),_=u.unproject([o,c]),y=d.distanceTo(_);if(n&&n.unit==="imperial"){const x=3.2808*y;x>5280?Hn(t,o,x/5280,u._getUIString("ScaleControl.Miles")):Hn(t,o,x,u._getUIString("ScaleControl.Feet"))}else n&&n.unit==="nautical"?Hn(t,o,y/1852,u._getUIString("ScaleControl.NauticalMiles")):y>=1e3?Hn(t,o,y/1e3,u._getUIString("ScaleControl.Kilometers")):Hn(t,o,y,u._getUIString("ScaleControl.Meters"))}function Hn(u,t,n,o){const c=function(d){const _=Math.pow(10,`${Math.floor(d)}`.length-1);let y=d/_;return y=y>=10?10:y>=5?5:y>=3?3:y>=2?2:y>=1?1:function(x){const C=Math.pow(10,Math.ceil(-Math.log(x)/Math.LN10));return Math.round(x*C)/C}(y),_*y}(n);u.style.width=t*(c/n)+"px",u.innerHTML=`${c}&nbsp;${o}`}const Po={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Ao=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ms(u){if(u){if(typeof u=="number"){const t=Math.round(Math.abs(u)/Math.SQRT2);return{center:new a.P(0,0),top:new a.P(0,u),"top-left":new a.P(t,t),"top-right":new a.P(-t,t),bottom:new a.P(0,-u),"bottom-left":new a.P(t,-t),"bottom-right":new a.P(-t,-t),left:new a.P(u,0),right:new a.P(-u,0)}}if(u instanceof a.P||Array.isArray(u)){const t=a.P.convert(u);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:a.P.convert(u.center||[0,0]),top:a.P.convert(u.top||[0,0]),"top-left":a.P.convert(u["top-left"]||[0,0]),"top-right":a.P.convert(u["top-right"]||[0,0]),bottom:a.P.convert(u.bottom||[0,0]),"bottom-left":a.P.convert(u["bottom-left"]||[0,0]),"bottom-right":a.P.convert(u["bottom-right"]||[0,0]),left:a.P.convert(u.left||[0,0]),right:a.P.convert(u.right||[0,0])}}return ms(new a.P(0,0))}const Mo={extend:(u,...t)=>a.e(u,...t),run(u){u()},logToElement(u,t=!1,n="log"){const o=window.document.getElementById(n);o&&(t&&(o.innerHTML=""),o.innerHTML+=`<br>${u}`)}},ko=W;class Nt{static get version(){return ko}static get workerCount(){return qi.workerCount}static set workerCount(t){qi.workerCount=t}static get maxParallelImageRequests(){return a.c.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(t){a.c.MAX_PARALLEL_IMAGE_REQUESTS=t}static get workerUrl(){return a.c.WORKER_URL}static set workerUrl(t){a.c.WORKER_URL=t}static addProtocol(t,n){a.c.REGISTERED_PROTOCOLS[t]=n}static removeProtocol(t){delete a.c.REGISTERED_PROTOCOLS[t]}}return Nt.Map=class extends Ol{constructor(u){if(a.bg.mark(a.bh.create),(u=a.e({},ut,u)).minZoom!=null&&u.maxZoom!=null&&u.minZoom>u.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(u.minPitch!=null&&u.maxPitch!=null&&u.minPitch>u.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(u.minPitch!=null&&u.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(u.maxPitch!=null&&u.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new wa(u.minZoom,u.maxZoom,u.minPitch,u.maxPitch,u.renderWorldCopies),{bearingSnap:u.bearingSnap}),this._cooperativeGesturesOnWheel=t=>{this._onCooperativeGesture(t,t[this._metaKey],1)},this._contextLost=t=>{t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.k("webglcontextlost",{originalEvent:t}))},this._contextRestored=t=>{this._setupPainter(),this.resize(),this._update(),this.fire(new a.k("webglcontextrestored",{originalEvent:t}))},this._onMapScroll=t=>{if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=u.interactive,this._cooperativeGestures=u.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=u.maxTileCacheSize,this._maxTileCacheZoomLevels=u.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=u.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=u.preserveDrawingBuffer,this._antialias=u.antialias,this._trackResize=u.trackResize,this._bearingSnap=u.bearingSnap,this._refreshExpiredTiles=u.refreshExpiredTiles,this._fadeDuration=u.fadeDuration,this._crossSourceCollisions=u.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=u.collectResourceTiming,this._renderTaskQueue=new Ia,this._controls=[],this._mapId=a.a2(),this._locale=a.e({},Co,u.locale),this._clickTolerance=u.clickTolerance,this._overridePixelRatio=u.pixelRatio,this._maxCanvasSize=u.maxCanvasSize,this.transformCameraUpdate=u.transformCameraUpdate,this._imageQueueHandle=Me.addThrottleControl(()=>this.isMoving()),this._requestManager=new je(u.transformRequest),typeof u.container=="string"){if(this._container=document.getElementById(u.container),!this._container)throw new Error(`Container '${u.container}' not found.`)}else{if(!(u.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=u.container}if(u.maxBounds&&this.setMaxBounds(u.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let t=!1;const n=Zn(o=>{this._trackResize&&!this._removed&&this.resize(o)._update()},50);this._resizeObserver=new ResizeObserver(o=>{t?n(o):t=!0}),this._resizeObserver.observe(this._container)}this.handlers=new So(this,u),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=u.hash&&new Bs(typeof u.hash=="string"&&u.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch}),u.bounds&&(this.resize(),this.fitBounds(u.bounds,a.e({},u.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=u.localIdeographFontFamily,this._validateStyle=u.validateStyle,u.style&&this.setStyle(u.style,{localIdeographFontFamily:u.localIdeographFontFamily}),u.attributionControl&&this.addControl(new Ar({customAttribution:u.customAttribution})),u.maplibreLogo&&this.addControl(new ii,u.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update(t.dataType==="style"),this.fire(new a.k(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new a.k(`${t.dataType}dataloading`,t))}),this.on("dataabort",t=>{this.fire(new a.k("sourcedataabort",t))})}_getMapId(){return this._mapId}addControl(u,t){if(t===void 0&&(t=u.getDefaultPosition?u.getDefaultPosition():"top-right"),!u||!u.onAdd)return this.fire(new a.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=u.onAdd(this);this._controls.push(u);const o=this._controlPositions[t];return t.indexOf("bottom")!==-1?o.insertBefore(n,o.firstChild):o.appendChild(n),this}removeControl(u){if(!u||!u.onRemove)return this.fire(new a.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(u);return t>-1&&this._controls.splice(t,1),u.onRemove(this),this}hasControl(u){return this._controls.indexOf(u)>-1}calculateCameraOptionsFromTo(u,t,n,o){return o==null&&this.terrain&&(o=this.terrain.getElevationForLngLatZoom(n,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(u,t,n,o)}resize(u){var t;const n=this._containerDimensions(),o=n[0],c=n[1],d=this._getClampedPixelRatio(o,c);if(this._resizeCanvas(o,c,d),this.painter.resize(o,c,d),this.painter.overLimit()){const y=this.painter.context.gl;this._maxCanvasSize=[y.drawingBufferWidth,y.drawingBufferHeight];const x=this._getClampedPixelRatio(o,c);this._resizeCanvas(o,c,x),this.painter.resize(o,c,x)}this.transform.resize(o,c),(t=this._requestedCameraState)===null||t===void 0||t.resize(o,c);const _=!this._moving;return _&&(this.stop(),this.fire(new a.k("movestart",u)).fire(new a.k("move",u))),this.fire(new a.k("resize",u)),_&&this.fire(new a.k("moveend",u)),this}_getClampedPixelRatio(u,t){const{0:n,1:o}=this._maxCanvasSize,c=this.getPixelRatio(),d=u*c,_=t*c;return Math.min(d>n?n/d:1,_>o?o/_:1)*c}getPixelRatio(){var u;return(u=this._overridePixelRatio)!==null&&u!==void 0?u:devicePixelRatio}setPixelRatio(u){this._overridePixelRatio=u,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(u){return this.transform.setMaxBounds(Ze.convert(u)),this._update()}setMinZoom(u){if((u=u??-2)>=-2&&u<=this.transform.maxZoom)return this.transform.minZoom=u,this._update(),this.getZoom()<u&&this.setZoom(u),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(u){if((u=u??22)>=this.transform.minZoom)return this.transform.maxZoom=u,this._update(),this.getZoom()>u&&this.setZoom(u),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(u){if((u=u??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(u>=0&&u<=this.transform.maxPitch)return this.transform.minPitch=u,this._update(),this.getPitch()<u&&this.setPitch(u),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(u){if((u=u??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(u>=this.transform.minPitch)return this.transform.maxPitch=u,this._update(),this.getPitch()>u&&this.setPitch(u),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(u){return this.transform.renderWorldCopies=u,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(u){return this._cooperativeGestures=u,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(u){return this.transform.locationPoint(a.L.convert(u),this.style&&this.terrain)}unproject(u){return this.transform.pointLocation(a.P.convert(u),this.terrain)}isMoving(){var u;return this._moving||((u=this.handlers)===null||u===void 0?void 0:u.isMoving())}isZooming(){var u;return this._zooming||((u=this.handlers)===null||u===void 0?void 0:u.isZooming())}isRotating(){var u;return this._rotating||((u=this.handlers)===null||u===void 0?void 0:u.isRotating())}_createDelegatedListener(u,t,n){if(u==="mouseenter"||u==="mouseover"){let o=!1;return{layer:t,listener:n,delegates:{mousemove:d=>{const _=this.getLayer(t)?this.queryRenderedFeatures(d.point,{layers:[t]}):[];_.length?o||(o=!0,n.call(this,new Pr(u,this,d.originalEvent,{features:_}))):o=!1},mouseout:()=>{o=!1}}}}if(u==="mouseleave"||u==="mouseout"){let o=!1;return{layer:t,listener:n,delegates:{mousemove:_=>{(this.getLayer(t)?this.queryRenderedFeatures(_.point,{layers:[t]}):[]).length?o=!0:o&&(o=!1,n.call(this,new Pr(u,this,_.originalEvent)))},mouseout:_=>{o&&(o=!1,n.call(this,new Pr(u,this,_.originalEvent)))}}}}{const o=c=>{const d=this.getLayer(t)?this.queryRenderedFeatures(c.point,{layers:[t]}):[];d.length&&(c.features=d,n.call(this,c),delete c.features)};return{layer:t,listener:n,delegates:{[u]:o}}}}on(u,t,n){if(n===void 0)return super.on(u,t);const o=this._createDelegatedListener(u,t,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[u]=this._delegatedListeners[u]||[],this._delegatedListeners[u].push(o);for(const c in o.delegates)this.on(c,o.delegates[c]);return this}once(u,t,n){if(n===void 0)return super.once(u,t);const o=this._createDelegatedListener(u,t,n);for(const c in o.delegates)this.once(c,o.delegates[c]);return this}off(u,t,n){return n===void 0?super.off(u,t):(this._delegatedListeners&&this._delegatedListeners[u]&&(o=>{const c=this._delegatedListeners[u];for(let d=0;d<c.length;d++){const _=c[d];if(_.layer===t&&_.listener===n){for(const y in _.delegates)this.off(y,_.delegates[y]);return c.splice(d,1),this}}})(),this)}queryRenderedFeatures(u,t){if(!this.style)return[];let n;const o=u instanceof a.P||Array.isArray(u),c=o?u:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(o?{}:u)||{},c instanceof a.P||typeof c[0]=="number")n=[a.P.convert(c)];else{const d=a.P.convert(c[0]),_=a.P.convert(c[1]);n=[d,new a.P(_.x,d.y),_,new a.P(d.x,_.y),d]}return this.style.queryRenderedFeatures(n,t,this.transform)}querySourceFeatures(u,t){return this.style.querySourceFeatures(u,t)}setStyle(u,t){return(t=a.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&u?(this._diffStyle(u,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(u,t))}setTransformRequest(u){return this._requestManager.setTransformRequest(u),this}_getUIString(u){const t=this._locale[u];if(t==null)throw new Error(`Missing UI string '${u}'`);return t}_updateStyle(u,t){if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(u,t));const n=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!u)),u?(this.style=new Gi(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof u=="string"?this.style.loadURL(u,t,n):this.style.loadJSON(u,t,n),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Gi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(u,t){if(typeof u=="string"){const n=this._requestManager.transformRequest(u,ze.Style);a.f(n,(o,c)=>{o?this.fire(new a.j(o)):c&&this._updateDiff(c,t)})}else typeof u=="object"&&this._updateDiff(u,t)}_updateDiff(u,t){try{this.style.setState(u,t)&&this._update(!0)}catch(n){a.w(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(u,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.w("There is no style added to the map.")}addSource(u,t){return this._lazyInitEmptyStyle(),this.style.addSource(u,t),this._update(!0)}isSourceLoaded(u){const t=this.style&&this.style.sourceCaches[u];if(t!==void 0)return t.loaded();this.fire(new a.j(new Error(`There is no source with ID '${u}'`)))}setTerrain(u){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),u){const t=this.style.sourceCaches[u.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${u.source}`);for(const n in this.style._layers){const o=this.style._layers[n];o.type==="hillshade"&&o.source===u.source&&a.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new jl(this.painter,t,u),this.painter.renderToTexture=new Ea(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=n=>{n.dataType==="style"?this.terrain.sourceCache.freeRtt():n.dataType==="source"&&n.tile&&(n.sourceId!==u.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(n.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new a.k("terrain",{terrain:u})),this}getTerrain(){var u,t;return(t=(u=this.terrain)===null||u===void 0?void 0:u.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const u=this.style&&this.style.sourceCaches;for(const t in u){const n=u[t]._tiles;for(const o in n){const c=n[o];if(c.state!=="loaded"&&c.state!=="errored")return!1}}return!0}addSourceType(u,t,n){return this._lazyInitEmptyStyle(),this.style.addSourceType(u,t,n)}removeSource(u){return this.style.removeSource(u),this._update(!0)}getSource(u){return this.style.getSource(u)}addImage(u,t,n={}){const{pixelRatio:o=1,sdf:c=!1,stretchX:d,stretchY:_,content:y}=n;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||a.a(t))){if(t.width===void 0||t.height===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:x,height:C,data:E}=t,P=t;return this.style.addImage(u,{data:new a.R({width:x,height:C},new Uint8Array(E)),pixelRatio:o,stretchX:d,stretchY:_,content:y,sdf:c,version:0,userImage:P}),P.onAdd&&P.onAdd(this,u),this}}{const{width:x,height:C,data:E}=a.h.getImageData(t);this.style.addImage(u,{data:new a.R({width:x,height:C},E),pixelRatio:o,stretchX:d,stretchY:_,content:y,sdf:c,version:0})}}updateImage(u,t){const n=this.style.getImage(u);if(!n)return this.fire(new a.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const o=t instanceof HTMLImageElement||a.a(t)?a.h.getImageData(t):t,{width:c,height:d,data:_}=o;if(c===void 0||d===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(c!==n.data.width||d!==n.data.height)return this.fire(new a.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const y=!(t instanceof HTMLImageElement||a.a(t));return n.data.replace(_,y),this.style.updateImage(u,n),this}getImage(u){return this.style.getImage(u)}hasImage(u){return u?!!this.style.getImage(u):(this.fire(new a.j(new Error("Missing required image id"))),!1)}removeImage(u){this.style.removeImage(u)}loadImage(u,t){Me.getImage(this._requestManager.transformRequest(u,ze.Image),t)}listImages(){return this.style.listImages()}addLayer(u,t){return this._lazyInitEmptyStyle(),this.style.addLayer(u,t),this._update(!0)}moveLayer(u,t){return this.style.moveLayer(u,t),this._update(!0)}removeLayer(u){return this.style.removeLayer(u),this._update(!0)}getLayer(u){return this.style.getLayer(u)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(u,t,n){return this.style.setLayerZoomRange(u,t,n),this._update(!0)}setFilter(u,t,n={}){return this.style.setFilter(u,t,n),this._update(!0)}getFilter(u){return this.style.getFilter(u)}setPaintProperty(u,t,n,o={}){return this.style.setPaintProperty(u,t,n,o),this._update(!0)}getPaintProperty(u,t){return this.style.getPaintProperty(u,t)}setLayoutProperty(u,t,n,o={}){return this.style.setLayoutProperty(u,t,n,o),this._update(!0)}getLayoutProperty(u,t){return this.style.getLayoutProperty(u,t)}setGlyphs(u,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(u,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(u,t,n={}){return this._lazyInitEmptyStyle(),this.style.addSprite(u,t,n,o=>{o||this._update(!0)}),this}removeSprite(u){return this._lazyInitEmptyStyle(),this.style.removeSprite(u),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(u,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(u,t,n=>{n||this._update(!0)}),this}setLight(u,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(u,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(u,t){return this.style.setFeatureState(u,t),this._update()}removeFeatureState(u,t){return this.style.removeFeatureState(u,t),this._update()}getFeatureState(u){return this.style.getFeatureState(u)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let u=0,t=0;return this._container&&(u=this._container.clientWidth||400,t=this._container.clientHeight||300),[u,t]}_setupContainer(){const u=this._container;u.classList.add("maplibregl-map");const t=this._canvasContainer=F.create("div","maplibregl-canvas-container",u);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=F.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const n=this._containerDimensions(),o=this._getClampedPixelRatio(n[0],n[1]);this._resizeCanvas(n[0],n[1],o);const c=this._controlContainer=F.create("div","maplibregl-control-container",u),d=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(_=>{d[_]=F.create("div",`maplibregl-ctrl-${_} `,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=F.create("div","maplibregl-cooperative-gesture-screen",this._container);let u=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(u=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use ⌘ + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${u}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){F.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(u,t,n){this._canvas.width=Math.floor(n*u),this._canvas.height=Math.floor(n*t),this._canvas.style.width=`${u}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const u={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let t=null;this._canvas.addEventListener("webglcontextcreationerror",o=>{t={requestedAttributes:u},o&&(t.statusMessage=o.statusMessage,t.type=o.type)},{once:!0});const n=this._canvas.getContext("webgl2",u)||this._canvas.getContext("webgl",u);if(!n){const o="Failed to initialize WebGL";throw t?(t.message=o,new Error(JSON.stringify(t))):new Error(o)}this.painter=new qn(n,this.transform),ne.testSupport(n)}_onCooperativeGesture(u,t,n){return!t&&n<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(u){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||u,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(u){return this._update(),this._renderTaskQueue.add(u)}_cancelRenderFrame(u){this._renderTaskQueue.remove(u)}_render(u){const t=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(u),this._removed)return;let n=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const c=this.transform.zoom,d=a.h.now();this.style.zoomHistory.update(c,d);const _=new a.a8(c,{now:d,fadeDuration:t,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),y=_.crossFadingFactor();y===1&&y===this._crossFadingFactor||(n=!0,this._crossFadingFactor=y),this.style.update(_)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,t,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:t,showPadding:this.showPadding}),this.fire(new a.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.bg.mark(a.bh.load),this.fire(new a.k("load"))),this.style&&(this.style.hasTransitions()||n)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const o=this._sourcesDirty||this._styleDirty||this._placementDirty;return o||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.k("idle")),!this._loaded||this._fullyLoaded||o||(this._fullyLoaded=!0,a.bg.mark(a.bh.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var u;this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Me.removeThrottleControl(this._imageQueueHandle),(u=this._resizeObserver)===null||u===void 0||u.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),F.remove(this._canvasContainer),F.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),a.bg.clearMetrics(),this._removed=!0,this.fire(new a.k("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=a.h.frame(u=>{a.bg.frame(u),this._frame=null,this._render(u)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(u){this._showTileBoundaries!==u&&(this._showTileBoundaries=u,this._update())}get showPadding(){return!!this._showPadding}set showPadding(u){this._showPadding!==u&&(this._showPadding=u,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(u){this._showCollisionBoxes!==u&&(this._showCollisionBoxes=u,u?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(u){this._showOverdrawInspector!==u&&(this._showOverdrawInspector=u,this._update())}get repaint(){return!!this._repaint}set repaint(u){this._repaint!==u&&(this._repaint=u,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(u){this._vertices=u,this._update()}get version(){return tt}getCameraTargetElevation(){return this.transform.elevation}},Nt.NavigationControl=class{constructor(u){this._updateZoomButtons=()=>{const t=this._map.getZoom(),n=t===this._map.getMaxZoom(),o=t===this._map.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=o,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",o.toString())},this._rotateCompassArrow=()=>{const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t},this._setButtonTitle=(t,n)=>{const o=this._map._getUIString(`NavigationControl.${n}`);t.title=o,t.setAttribute("aria-label",o)},this.options=a.e({},To,u),this._container=F.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),F.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),F.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=F.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(u){return this._map=u,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Io(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){F.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(u,t){const n=F.create("button",u,this._container);return n.type="button",n.addEventListener("click",t),n}},Nt.GeolocateControl=class extends a.E{constructor(u){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new a.k("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new a.k("geolocate",t)),this._finish()}},this._updateCamera=t=>{const n=new a.L(t.coords.longitude,t.coords.latitude),o=t.coords.accuracy,c=this._map.getBearing(),d=a.e({bearing:c},this.options.fitBoundsOptions),_=Ze.fromLngLat(n,o);this._map.fitBounds(_,d,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const n=new a.L(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(this.options.trackUserLocation)if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&fs)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new a.k("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=t=>{if(this._map){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=F.create("button","maplibregl-ctrl-geolocate",this._container),F.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",t===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=F.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Gn({element:this._dotElement}),this._circleElement=F.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Gn({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new a.k("trackuserlocationend")))})}},this.options=a.e({},mi,u)}onAdd(u){return this._map=u,this._container=F.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(t,n=!1){wi===void 0||n?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(o=>{wi=o.state!=="denied",t(wi)}).catch(()=>{wi=!!window.navigator.geolocation,t(wi)}):(wi=!!window.navigator.geolocation,t(wi)):t(wi)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),F.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,di=0,fs=!1}_isOutOfMapMaxBounds(u){const t=this._map.getMaxBounds(),n=u.coords;return t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const u=this._map.getBounds(),t=u.getSouthEast(),n=u.getNorthEast(),o=t.distanceTo(n),c=Math.ceil(this._accuracy/(o/this._map._container.clientHeight)*2);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":di--,fs=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new a.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let u;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),di++,di>1?(u={maximumAge:6e5,timeout:0},fs=!0):(u=this.options.positionOptions,fs=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,u)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},Nt.AttributionControl=Ar,Nt.LogoControl=ii,Nt.ScaleControl=class{constructor(u){this._onMove=()=>{qs(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,qs(this._map,this._container,this.options)},this.options=a.e({},Us,u)}getDefaultPosition(){return"bottom-left"}onAdd(u){return this._map=u,this._container=F.create("div","maplibregl-ctrl maplibregl-ctrl-scale",u.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){F.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},Nt.FullscreenControl=class extends a.E{constructor(u={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,u&&u.container&&(u.container instanceof HTMLElement?this._container=u.container:a.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(u){return this._map=u,this._container||(this._container=this._map.getContainer()),this._controlContainer=F.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){F.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const u=this._fullscreenButton=F.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);F.create("span","maplibregl-ctrl-icon",u).setAttribute("aria-hidden","true"),u.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const u=this._getTitle();this._fullscreenButton.setAttribute("aria-label",u),this._fullscreenButton.title=u}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new a.k("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new a.k("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},Nt.TerrainControl=class{constructor(u){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=u}onAdd(u){return this._map=u,this._container=F.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=F.create("button","maplibregl-ctrl-terrain",this._container),F.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){F.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},Nt.Popup=class extends a.E{constructor(u){super(),this.remove=()=>(this._content&&F.remove(this._content),this._container&&(F.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new a.k("close")),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=F.create("div","maplibregl-popup",this._map.getContainer()),this._tip=F.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const _ of this.options.className.split(" "))this._container.classList.add(_);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Eo(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!t)return;const n=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);let o=this.options.anchor;const c=ms(this.options.offset);if(!o){const _=this._container.offsetWidth,y=this._container.offsetHeight;let x;x=n.y+c.bottom.y<y?["top"]:n.y>this._map.transform.height-y?["bottom"]:[],n.x<_/2?x.push("left"):n.x>this._map.transform.width-_/2&&x.push("right"),o=x.length===0?"bottom":x.join("-")}const d=n.add(c[o]).round();F.setTransform(this._container,`${jr[o]} translate(${d.x}px,${d.y}px)`),Vl(this._container,o,"popup")},this._onClose=()=>{this.remove()},this.options=a.e(Object.create(Po),u)}addTo(u){return this._map&&this.remove(),this._map=u,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new a.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(u){return this._lngLat=a.L.convert(u),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(u){return this.setDOMContent(document.createTextNode(u))}setHTML(u){const t=document.createDocumentFragment(),n=document.createElement("body");let o;for(n.innerHTML=u;o=n.firstChild,o;)t.appendChild(o);return this.setDOMContent(t)}getMaxWidth(){var u;return(u=this._container)===null||u===void 0?void 0:u.style.maxWidth}setMaxWidth(u){return this.options.maxWidth=u,this._update(),this}setDOMContent(u){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=F.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(u),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(u){this._container&&this._container.classList.add(u)}removeClassName(u){this._container&&this._container.classList.remove(u)}setOffset(u){return this.options.offset=u,this._update(),this}toggleClassName(u){if(this._container)return this._container.classList.toggle(u)}_createCloseButton(){this.options.closeButton&&(this._closeButton=F.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const u=this._container.querySelector(Ao);u&&u.focus()}},Nt.Marker=Gn,Nt.Style=Gi,Nt.LngLat=a.L,Nt.LngLatBounds=Ze,Nt.Point=a.P,Nt.MercatorCoordinate=a.U,Nt.Evented=a.E,Nt.AJAXError=a.bi,Nt.config=a.c,Nt.CanvasSource=bi,Nt.GeoJSONSource=gi,Nt.ImageSource=Rt,Nt.RasterDEMTileSource=Yt,Nt.RasterTileSource=Mt,Nt.VectorTileSource=Jt,Nt.VideoSource=ki,Nt.setRTLTextPlugin=a.bj,Nt.getRTLTextPluginStatus=a.bk,Nt.prewarm=function(){Tn().acquire(kt)},Nt.clearPrewarmedResources=function(){const u=ar;u&&(u.isPreloaded()&&u.numActive()===1?(u.release(kt),ar=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},Mo.extend(Nt,{isSafari:a.ac,getPerformanceMetrics:a.bg.getPerformanceMetrics}),Nt});var B=T;return B})})(ym);var l1=ym.exports;const c1=Df(l1);function u1(){const[f,m]=q.useState(!1);return ye.jsx("div",{className:f?"fixed top-0 right-0 bottom-0 left-0 z-[9999]":"w-full h-full relative",children:ye.jsx(a1,{mapLib:c1,style:{width:"100%",height:" 100%",position:"relative"},mapStyle:"https://api.ekgis.vn/v2/mapstyles/style/osmplus/standard/style.json?api_key=wtpM0U1ZmE2s87LEZNSHf63Osc1a2sboaozCQNsy",children:ye.jsx(o1,{id:"raster-tiles",type:"raster",tileSize:256,tiles:["https://api.ekgis.vn/v1/maps/roadmap/{z}/{x}/{y}.png?api_key=wtpM0U1ZmE2s87LEZNSHf63Osc1a2sboaozCQNsy"]})})})}function h1({data:f}){return ye.jsxs(Ys,{className:"h-[500px]",children:[ye.jsx(Rr,{span:8,children:ye.jsx(Ch,{columns:[{title:"Stt",dataIndex:"stt",key:"stt",render:(m,b,S)=>S+1},...Mh],dataSource:im,pagination:!1})}),ye.jsx(Rr,{span:16,children:ye.jsx(u1,{})})]})}const{Dragger:d1}=xv,p1={name:"file",multiple:!0,action:"https://run.mocky.io/v3/435e224c-44fb-4773-9faf-380c5e6a2188",onChange(f){const{status:m}=f.file;m!=="uploading"&&console.log(f.file,f.fileList),m==="done"?Ep.success(`${f.file.name} file uploaded successfully.`):m==="error"&&Ep.error(`${f.file.name} file upload failed.`)},onDrop(f){console.log("Dropped files",f.dataTransfer.files)}};function f1(){return ye.jsxs(d1,{...p1,children:[ye.jsx("p",{className:"ant-upload-drag-icon",children:ye.jsx(Cv,{})}),ye.jsx("p",{className:"ant-upload-text",children:"Click or drag file to this area to upload"}),ye.jsx("p",{className:"ant-upload-hint",children:"Support for a single or bulk upload. Strictly prohibited from uploading company data or other banned files."})]})}function m1({form:f,filter:m,setFilter:b}){const[S,T]=q.useState([]),[k,B]=q.useState([]),[a,W]=q.useState([]),[F,ne]=q.useState([]);q.useState(""),q.useState(""),q.useEffect(()=>{f.setFieldsValue(m)},[m]),q.useEffect(()=>{(async()=>{let _e=await Cn.get("/api/method/frappe.desk.search.search_link",{params:{txt:"",doctype:"Customer Group",ignore_user_permissions:0,reference_doctype:"Customer"}}),Ee=await Cn.get("/api/method/mbw_dms.api.location.list_province");B(Ee.result);let{results:ke}=_e;T(ke.map(Me=>({label:Me.value,value:Me.value})))})()},[]);const ie=async _e=>{let Ee=k.find(ke=>ke.ten_tinh==_e)?.ma_tinh;if(Ee){let ke=await Cn.get("/api/method/mbw_dms.api.location.list_district",{params:{ma_tinh_thanh:Number.parseInt(Ee)}});W(ke.result)}},ue=async _e=>{let Ee=a.find(ke=>ke.ten_huyen==_e)?.ma_huyen;if(Ee){let ke=await Cn.get("/api/method/mbw_dms.api.location.list_ward",{params:{ma_quan_huyen:Ee}});ne(ke.result)}};return ye.jsxs(_h,{form:f,layout:"vertical",onFinish:b,children:[ye.jsx(qr,{label:"Loại khách hàng",name:"customer_type",children:ye.jsx(Sn,{options:[{label:"Tất cả",value:!1},{label:"Company",value:"Company"},{label:"Individual",value:"Individual"}]})}),ye.jsx(qr,{label:"Nhóm khách hàng",name:"customer_group",children:ye.jsx(Sn,{options:S})}),ye.jsx("p",{className:"font-medium text-sm",children:"Địa chỉ"}),ye.jsx(qr,{label:"Tỉnh/Thành phố",name:"city",children:ye.jsx(Sn,{options:k.map(_e=>({label:_e.ten_tinh,value:_e.ten_tinh})),onChange:ie})}),ye.jsx(qr,{label:"Quận/huyện",name:"district",children:ye.jsx(Sn,{options:a.map(_e=>({label:_e.ten_huyen,value:_e.ten_huyen})),disabled:a.length==0,onChange:ue})}),ye.jsx(qr,{label:"Phường/xã",name:"ward",children:ye.jsx(Sn,{options:F.map(_e=>({label:_e.ten_xa,value:_e.ten_xa})),disabled:F.length==0})})]})}const g1=[...Mh,{title:"Loại khách hàng",dataIndex:"customer_id",key:"customer_type"},{title:"Nhóm khách hàng",dataIndex:"customer_name",key:"customer_group"},...tm],yf=f=>{let m=[];for(let b in f)f[b]&&(m=[...m,{key:[Pv[b]],value:f[b],key2:b}]);return m};function _1({selected:f,handleAdd:m,closeModal:b}){const[S]=D_(),[T,k]=q.useState([]),[B,a]=q.useState(im),[W,F]=q.useState({}),[ne,ie]=q.useState(!1),ue=20,[_e,Ee]=q.useState(1),[ke,Me]=q.useState(40),ze={selectedRowKeys:T&&T.map(Ie=>Ie.name),onChange:(Ie,it)=>{k(it)}},je=()=>{S.submit(),ie(!1)},Ne=Ie=>{if(Ie){let it={...W};delete it[Ie.key2],S.setFieldsValue(it),F(Ye=>(delete Ye[Ie.key2],{...Ye}))}else S.resetFields(),F({})};q.useEffect(()=>{(async()=>{const Ie=await Cn.get("/api/method/mbw_dms.api.router.get_customer",{params:{...W,page_size:ue,page_number:_e}});a(Ie?.result?.data),Me(Ie.result?.total),console.log("rsCustomer",Ie)})()},[W,_e]);const me=()=>{T.length>0&&m(T),b()};return q.useEffect(()=>{k(f)},[f]),ye.jsxs(ye.Fragment,{children:[ye.jsxs(Ys,{className:"justify-between",children:[ye.jsxs(Rr,{className:"inline-flex ",children:[ye.jsx(qr,{children:ye.jsx(yc,{placeholder:"Tìm kiếm khách hàng",prefix:ye.jsx(Lf,{})})}),ye.jsxs("div",{className:"flex justify-center items-center ml-4",children:[ye.jsx(ja,{className:"flex items-center text-nowrap !text-[13px] !leading-[21px] !font-normal  border-r-[0.1px] rounded-r-none h-[36px]",icon:ye.jsx(N_,{style:{fontSize:"20px"}}),onClick:ie.bind(null,!0),children:"Filter"}),ye.jsx(ja,{className:"border-l-[0.1px] rounded-l-none h-[36px]",onClick:()=>Ne(),children:ye.jsx(j_,{style:{fontSize:"20px"}})})]})]}),ye.jsxs(Rr,{className:"inline-flex items-center",children:[ye.jsxs("span",{className:"mr-4",children:["Đã chọn ",T.length||0," khách hàng"]}),ye.jsx(ja,{type:"primary",onClick:me,children:"Thêm"})]})]}),ye.jsxs("div",{className:"py-5 px-4",children:[ye.jsxs("span",{children:[B.length," kết quả hiển thị"]}),yf(W).length>0&&ye.jsxs(Ys,{className:"items-center",children:[yf(W).map(Ie=>ye.jsxs(L_,{closeIcon:ye.jsx(Ac,{}),onClose:()=>{Ne(Ie)},children:[Ie.key,": ",Ie.value]})),ye.jsx("span",{className:"cursor-pointer",onClick:()=>Ne(),children:"Clear all"})]})]}),ye.jsx(Ch,{rowSelection:{type:"checkbox",...ze},columns:g1,dataSource:B.map(Ie=>({key:Ie.name,...Ie})),pagination:!1}),ye.jsx(Ys,{className:"justify-end mt-2",children:ye.jsx(R_,{defaultCurrent:_e,pageSize:ue,total:ke,onChange:(Ie,it)=>{Ee(Ie)}})}),ye.jsx(yh,{width:451,title:"Bộ lọc",open:ne,okText:"Áp dụng",cancelText:"Đặt lại",onCancel:ie.bind(null,!1),onOk:je,children:ye.jsx(m1,{filter:W,setFilter:F,form:S})})]})}function y1({listCustomer:f,handleCustomer:m}){const[b,S]=q.useState("list"),[T,k]=q.useState(!1),[B,a]=q.useState(!1),W=ne=>{switch(ne){case"Choose":k(!1);break;case"Import":a(!1);break;default:k(!1),a(!1)}},F=ne=>{switch(ne){case"Choose":k(!0);break;case"Import":a(!0);break}};return ye.jsxs(ye.Fragment,{children:[ye.jsxs(Ys,{gutter:16,className:"justify-between p-4 pb-5 pt-10 mt-0",children:[ye.jsx(Rr,{children:ye.jsxs(Ys,{gutter:8,children:[ye.jsx(Rr,{span:9,className:"text-[#1677ff]",children:ye.jsx(qr,{children:ye.jsx(Sn,{defaultValue:"add",options:Iv,onSelect:F})})}),ye.jsx(Rr,{span:7,children:ye.jsx(ja,{className:"w-full flex items-center text-[#1677ff] bg-[#1877f214] h-[36px]",icon:ye.jsx(Ax,{}),children:"Tối ưu tuyến"})}),ye.jsx(Rr,{span:8,children:ye.jsx(qr,{children:ye.jsx(yc,{placeholder:"Tìm kiếm khách hàng",prefix:ye.jsx(Lf,{})})})})]})}),ye.jsxs(Rr,{children:[" ",ye.jsxs(qu.Group,{defaultValue:b,onChange:ne=>S(ne.target.value),size:"middle",children:[ye.jsx(qu.Button,{value:"list",children:ye.jsx(kx,{size:28})}),ye.jsx(qu.Button,{value:"map",children:ye.jsx(Mx,{size:28})})]})]})]}),ye.jsx("div",{children:b=="list"?ye.jsx(zx,{data:f,handleData:m}):ye.jsx(h1,{data:f})}),ye.jsx(yh,{width:1240,open:T,onCancel:W.bind(null,"Choose"),title:ye.jsx("strong",{className:"text-xl",children:"Chọn khách hàng"}),footer:!1,children:ye.jsx(_1,{selected:f,handleAdd:m,closeModal:k.bind(null,!1)})}),ye.jsx(yh,{width:777,open:B,onCancel:W.bind(null,"Import"),okText:"Tiếp tục",cancelText:"Hủy",title:ye.jsx("strong",{className:"text-xl",children:"Nhập dữ liệu khách hàng"}),children:ye.jsx(f1,{})})]})}function v1(){const[f]=_h.useForm(),m=F_(),[b,S]=Kf.useNotification(),[T,k]=q.useState([]),B=(W,F)=>{b.info({message:`Notification ${W}`,description:ye.jsx("p",{children:F}),placement:W})},a=q.useCallback(async W=>{W={...W,customers:T.map(F=>{let ne=["customer_id","customer_name","display_address","phone_number","customer","frequency"];for(let ie in F)ne.includes(ie)||delete F[ie];return F})};try{await Cn.post("/api/method/mbw_dms.api.router.create_router",W),B("topRight","Success"),m("/")}catch(F){B("topRight","Failure!!!"),console.log("error create",F)}},[T]);return ye.jsxs(ye.Fragment,{children:[ye.jsx(V_,{title:"Thêm tuyến",buttons:[{label:"Thêm",action:f.submit,type:"primary"}]}),ye.jsx("div",{className:"bg-white rounded-md",children:ye.jsx(_h,{layout:"vertical",form:f,onFinish:a,children:ye.jsx($_,{defaultActiveKey:"1",items:[{label:ye.jsx("p",{className:"px-4 mb-0",children:" Thông tin chung"}),key:"1",children:ye.jsx(Px,{})},{label:ye.jsx("p",{className:"px-4 mb-0",children:"Khách hàng"}),key:"2",children:ye.jsx(y1,{handleCustomer:k,listCustomer:T})}],indicatorSize:W=>W-18})})})]})}function C1(){return ye.jsxs(ye.Fragment,{children:[ye.jsx(B_,{children:ye.jsx("title",{children:" RouterControll"})}),ye.jsx(v1,{})]})}export{C1 as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/mapbox-gl-bjBPhUos.js","assets/index-xfynDe6l.js","assets/index-dstTe7sK.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
