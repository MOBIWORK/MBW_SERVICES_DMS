import{r as W,_ as es,a as Qr,c as di,b as Vi,K as Ug,R as ws,d as Hs,C as af,e as bc,f as Ss,g as Yr,h as Yo,i as ph,m as fh,k as Qo,l as mh,n as qg,o as $a,u as of,p as lf,q as cf,E as Zg,L as ah,s as gh,t as Gg,v as Hg,w as Wg,x as uf,y as Xg,z as oh,A as hf,D as pr,G as Kg,J as Jg,M as ja,N as Yg,O as df,P as pf,Q as ff,U as Jr,V as mf,W as Qg,X as e_,Y as ap,Z as gf,$ as _f,a0 as op,a1 as t_,a2 as i_,a3 as yf,a4 as r_,a5 as n_,a6 as lp,a7 as cp,B as Oa,a8 as s_,a9 as a_,aa as o_,ab as l_,j as _e,ac as Xs,ad as vf,ae as Rr,F as qr,I as gc,S as wn,T as _h,af as c_,ag as u_,ah as lh,ai as h_,aj as xf,ak as d_,al as p_,am as Ru,an as f_,H as m_}from"./index-7CAw7ufh.js";import{I as g_,i as __,M as ch,T as y_}from"./index-s-FVTDfm.js";import{a as v_,b as x_}from"./index.esm-fOaUpmzB.js";import{H as b_}from"./header-page-1VG7GsWz.js";var bf=W.forwardRef(function(f,v){var w=f.prefixCls,C=f.style,E=f.className,z=f.duration,O=z===void 0?4.5:z,a=f.eventKey,Q=f.content,B=f.closable,ae=f.closeIcon,oe=ae===void 0?"x":ae,he=f.props,we=f.onClick,ke=f.onNoticeClose,Ne=f.times,Re=f.hovering,Fe=W.useState(!1),We=es(Fe,2),Ue=We[0],ye=We[1],Ie=Re||Ue,rt=function(){ke(a)},et=function(Pe){(Pe.key==="Enter"||Pe.code==="Enter"||Pe.keyCode===Ug.ENTER)&&rt()};W.useEffect(function(){if(!Ie&&O>0){var at=setTimeout(function(){rt()},O*1e3);return function(){clearTimeout(at)}}},[O,Ie,Ne]);var Ze="".concat(w,"-notice");return W.createElement("div",Qr({},he,{ref:v,className:di(Ze,E,Vi({},"".concat(Ze,"-closable"),B)),style:C,onMouseEnter:function(Pe){var it;ye(!0),he==null||(it=he.onMouseEnter)===null||it===void 0||it.call(he,Pe)},onMouseLeave:function(Pe){var it;ye(!1),he==null||(it=he.onMouseLeave)===null||it===void 0||it.call(he,Pe)},onClick:we}),W.createElement("div",{className:"".concat(Ze,"-content")},Q),B&&W.createElement("a",{tabIndex:0,className:"".concat(Ze,"-close"),onKeyDown:et,onClick:function(Pe){Pe.preventDefault(),Pe.stopPropagation(),rt()}},oe))}),wf=ws.createContext({}),w_=function(v){var w=v.children,C=v.classNames;return ws.createElement(wf.Provider,{value:{classNames:C}},w)},up=8,hp=3,dp=16,S_=function(v){var w={offset:up,threshold:hp,gap:dp};if(v&&Hs(v)==="object"){var C,E,z;w.offset=(C=v.offset)!==null&&C!==void 0?C:up,w.threshold=(E=v.threshold)!==null&&E!==void 0?E:hp,w.gap=(z=v.gap)!==null&&z!==void 0?z:dp}return[!!v,w]},C_=["className","style","classNames","styles"],T_=function(v){var w,C=v.configList,E=v.placement,z=v.prefixCls,O=v.className,a=v.style,Q=v.motion,B=v.onAllNoticeRemoved,ae=v.onNoticeClose,oe=v.stack,he=W.useContext(wf),we=he.classNames,ke=W.useRef({}),Ne=W.useState(null),Re=es(Ne,2),Fe=Re[0],We=Re[1],Ue=W.useState([]),ye=es(Ue,2),Ie=ye[0],rt=ye[1],et=C.map(function(ft){return{config:ft,key:String(ft.key)}}),Ze=S_(oe),at=es(Ze,2),Pe=at[0],it=at[1],xt=it.offset,At=it.threshold,gt=it.gap,Pt=Pe&&(Ie.length>0||et.length<=At),Bt=typeof Q=="function"?Q(E):Q;return W.useEffect(function(){Pe&&Ie.length>1&&rt(function(ft){return ft.filter(function(ni){return et.some(function(Mi){var Xi=Mi.key;return ni===Xi})})})},[Ie,et,Pe]),W.useEffect(function(){var ft;if(Pe&&ke.current[(ft=et[et.length-1])===null||ft===void 0?void 0:ft.key]){var ni;We(ke.current[(ni=et[et.length-1])===null||ni===void 0?void 0:ni.key])}},[et,Pe]),ws.createElement(af,Qr({key:E,className:di(z,"".concat(z,"-").concat(E),we?.list,O,(w={},Vi(w,"".concat(z,"-stack"),!!Pe),Vi(w,"".concat(z,"-stack-expanded"),Pt),w)),style:a,keys:et,motionAppear:!0},Bt,{onAllRemoved:function(){B(E)}}),function(ft,ni){var Mi=ft.config,Xi=ft.className,si=ft.style,Xt=ft.index,qe=Mi,yt=qe.key,Kt=qe.times,Mt=String(yt),Jt=Mi,gi=Jt.className,Yt=Jt.style,Rt=Jt.classNames,ki=Jt.styles,bi=bc(Jt,C_),Wt=et.findIndex(function(Ui){return Ui.key===Mt}),Ti={};if(Pe){var rr=et.length-1-(Wt>-1?Wt:Xt-1),fr=E==="top"||E==="bottom"?"-50%":"0";if(rr>0){var nr,mr,Cr;Ti.height=Pt?(nr=ke.current[Mt])===null||nr===void 0?void 0:nr.offsetHeight:Fe?.offsetHeight;for(var me=0,Ii=0;Ii<rr;Ii++){var $i;me+=(($i=ke.current[et[et.length-1-Ii].key])===null||$i===void 0?void 0:$i.offsetHeight)+gt}var jt=(Pt?me:rr*xt)*(E.startsWith("top")?1:-1),kt=!Pt&&Fe!==null&&Fe!==void 0&&Fe.offsetWidth&&(mr=ke.current[Mt])!==null&&mr!==void 0&&mr.offsetWidth?(Fe?.offsetWidth-xt*2*(rr<3?rr:3))/((Cr=ke.current[Mt])===null||Cr===void 0?void 0:Cr.offsetWidth):1;Ti.transform="translate3d(".concat(fr,", ").concat(jt,"px, 0) scaleX(").concat(kt,")")}else Ti.transform="translate3d(".concat(fr,", 0, 0)")}return ws.createElement("div",{ref:ni,className:di("".concat(z,"-notice-wrapper"),Xi,Rt?.wrapper),style:Ss(Ss(Ss({},si),Ti),ki?.wrapper),onMouseEnter:function(){return rt(function(Ki){return Ki.includes(Mt)?Ki:[].concat(Yr(Ki),[Mt])})},onMouseLeave:function(){return rt(function(Ki){return Ki.filter(function(sr){return sr!==Mt})})}},ws.createElement(bf,Qr({},bi,{ref:function(Ki){Wt>-1?ke.current[Mt]=Ki:delete ke.current[Mt]},prefixCls:z,classNames:Rt,styles:ki,className:di(gi,we?.notice),style:Yt,times:Kt,key:yt,eventKey:yt,onNoticeClose:ae,hovering:Pe&&Ie.length>0})))})},I_=W.forwardRef(function(f,v){var w=f.prefixCls,C=w===void 0?"rc-notification":w,E=f.container,z=f.motion,O=f.maxCount,a=f.className,Q=f.style,B=f.onAllRemoved,ae=f.stack,oe=f.renderNotifications,he=W.useState([]),we=es(he,2),ke=we[0],Ne=we[1],Re=function(at){var Pe,it=ke.find(function(xt){return xt.key===at});it==null||(Pe=it.onClose)===null||Pe===void 0||Pe.call(it),Ne(function(xt){return xt.filter(function(At){return At.key!==at})})};W.useImperativeHandle(v,function(){return{open:function(at){Ne(function(Pe){var it=Yr(Pe),xt=it.findIndex(function(Pt){return Pt.key===at.key}),At=Ss({},at);if(xt>=0){var gt;At.times=(((gt=Pe[xt])===null||gt===void 0?void 0:gt.times)||0)+1,it[xt]=At}else At.times=0,it.push(At);return O>0&&it.length>O&&(it=it.slice(-O)),it})},close:function(at){Re(at)},destroy:function(){Ne([])}}});var Fe=W.useState({}),We=es(Fe,2),Ue=We[0],ye=We[1];W.useEffect(function(){var Ze={};ke.forEach(function(at){var Pe=at.placement,it=Pe===void 0?"topRight":Pe;it&&(Ze[it]=Ze[it]||[],Ze[it].push(at))}),Object.keys(Ue).forEach(function(at){Ze[at]=Ze[at]||[]}),ye(Ze)},[ke]);var Ie=function(at){ye(function(Pe){var it=Ss({},Pe),xt=it[at]||[];return xt.length||delete it[at],it})},rt=W.useRef(!1);if(W.useEffect(function(){Object.keys(Ue).length>0?rt.current=!0:rt.current&&(B?.(),rt.current=!1)},[Ue]),!E)return null;var et=Object.keys(Ue);return Yo.createPortal(W.createElement(W.Fragment,null,et.map(function(Ze){var at=Ue[Ze],Pe=W.createElement(T_,{key:Ze,configList:at,placement:Ze,prefixCls:C,className:a?.(Ze),style:Q?.(Ze),motion:z,onNoticeClose:Re,onAllNoticeRemoved:Ie,stack:ae});return oe?oe(Pe,{prefixCls:C,key:Ze}):Pe})),E)}),E_=["getContainer","motion","prefixCls","maxCount","className","style","onAllRemoved","stack","renderNotifications"],A_=function(){return document.body},pp=0;function P_(){for(var f={},v=arguments.length,w=new Array(v),C=0;C<v;C++)w[C]=arguments[C];return w.forEach(function(E){E&&Object.keys(E).forEach(function(z){var O=E[z];O!==void 0&&(f[z]=O)})}),f}function M_(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},v=f.getContainer,w=v===void 0?A_:v,C=f.motion,E=f.prefixCls,z=f.maxCount,O=f.className,a=f.style,Q=f.onAllRemoved,B=f.stack,ae=f.renderNotifications,oe=bc(f,E_),he=W.useState(),we=es(he,2),ke=we[0],Ne=we[1],Re=W.useRef(),Fe=W.createElement(I_,{container:ke,ref:Re,prefixCls:E,motion:C,maxCount:z,className:O,style:a,onAllRemoved:Q,stack:B,renderNotifications:ae}),We=W.useState([]),Ue=es(We,2),ye=Ue[0],Ie=Ue[1],rt=W.useMemo(function(){return{open:function(Ze){var at=P_(oe,Ze);(at.key===null||at.key===void 0)&&(at.key="rc-notification-".concat(pp),pp+=1),Ie(function(Pe){return[].concat(Yr(Pe),[{type:"open",config:at}])})},close:function(Ze){Ie(function(at){return[].concat(Yr(at),[{type:"close",key:Ze}])})},destroy:function(){Ie(function(Ze){return[].concat(Yr(Ze),[{type:"destroy"}])})}}},[]);return W.useEffect(function(){Ne(w())}),W.useEffect(function(){Re.current&&ye.length&&(ye.forEach(function(et){switch(et.type){case"open":Re.current.open(et.config);break;case"close":Re.current.close(et.key);break;case"destroy":Re.current.destroy();break}}),Ie(function(et){return et.filter(function(Ze){return!ye.includes(Ze)})}))},[ye]),[rt,Fe]}const k_=f=>{const{componentCls:v,iconCls:w,boxShadow:C,colorText:E,colorSuccess:z,colorError:O,colorWarning:a,colorInfo:Q,fontSizeLG:B,motionEaseInOutCirc:ae,motionDurationSlow:oe,marginXS:he,paddingXS:we,borderRadiusLG:ke,zIndexPopup:Ne,contentPadding:Re,contentBg:Fe}=f,We=`${v}-notice`,Ue=new Qo("MessageMoveIn",{"0%":{padding:0,transform:"translateY(-100%)",opacity:0},"100%":{padding:we,transform:"translateY(0)",opacity:1}}),ye=new Qo("MessageMoveOut",{"0%":{maxHeight:f.height,padding:we,opacity:1},"100%":{maxHeight:0,padding:0,opacity:0}}),Ie={padding:we,textAlign:"center",[`${v}-custom-content > ${w}`]:{verticalAlign:"text-bottom",marginInlineEnd:he,fontSize:B},[`${We}-content`]:{display:"inline-block",padding:Re,background:Fe,borderRadius:ke,boxShadow:C,pointerEvents:"all"},[`${v}-success > ${w}`]:{color:z},[`${v}-error > ${w}`]:{color:O},[`${v}-warning > ${w}`]:{color:a},[`${v}-info > ${w},
      ${v}-loading > ${w}`]:{color:Q}};return[{[v]:Object.assign(Object.assign({},mh(f)),{color:E,position:"fixed",top:he,width:"100%",pointerEvents:"none",zIndex:Ne,[`${v}-move-up`]:{animationFillMode:"forwards"},[`
        ${v}-move-up-appear,
        ${v}-move-up-enter
      `]:{animationName:Ue,animationDuration:oe,animationPlayState:"paused",animationTimingFunction:ae},[`
        ${v}-move-up-appear${v}-move-up-appear-active,
        ${v}-move-up-enter${v}-move-up-enter-active
      `]:{animationPlayState:"running"},[`${v}-move-up-leave`]:{animationName:ye,animationDuration:oe,animationPlayState:"paused",animationTimingFunction:ae},[`${v}-move-up-leave${v}-move-up-leave-active`]:{animationPlayState:"running"},"&-rtl":{direction:"rtl",span:{direction:"rtl"}}})},{[v]:{[`${We}-wrapper`]:Object.assign({},Ie)}},{[`${v}-notice-pure-panel`]:Object.assign(Object.assign({},Ie),{padding:0,textAlign:"start"})}]},z_=f=>({zIndexPopup:f.zIndexPopupBase+qg+10,contentBg:f.colorBgElevated,contentPadding:`${(f.controlHeightLG-f.fontSize*f.lineHeight)/2}px ${f.paddingSM}px`}),Sf=ph("Message",f=>{const v=fh(f,{height:150});return[k_(v)]},z_);var D_=function(f,v){var w={};for(var C in f)Object.prototype.hasOwnProperty.call(f,C)&&v.indexOf(C)<0&&(w[C]=f[C]);if(f!=null&&typeof Object.getOwnPropertySymbols=="function")for(var E=0,C=Object.getOwnPropertySymbols(f);E<C.length;E++)v.indexOf(C[E])<0&&Object.prototype.propertyIsEnumerable.call(f,C[E])&&(w[C[E]]=f[C[E]]);return w};const L_={info:W.createElement(g_,null),success:W.createElement(lf,null),error:W.createElement(cf,null),warning:W.createElement(Zg,null),loading:W.createElement(ah,null)},Cf=f=>{let{prefixCls:v,type:w,icon:C,children:E}=f;return W.createElement("div",{className:di(`${v}-custom-content`,`${v}-${w}`)},C||L_[w],W.createElement("span",null,E))},R_=f=>{const{prefixCls:v,className:w,type:C,icon:E,content:z}=f,O=D_(f,["prefixCls","className","type","icon","content"]),{getPrefixCls:a}=W.useContext($a),Q=v||a("message"),B=of(Q),[ae,oe,he]=Sf(Q,B);return ae(W.createElement(bf,Object.assign({},O,{prefixCls:Q,className:di(w,oe,`${Q}-notice-pure-panel`,he,B),eventKey:"pure",duration:null,content:W.createElement(Cf,{prefixCls:Q,type:C,icon:E},z)})))},F_=R_;function B_(f,v){return{motionName:v??`${f}-move-up`}}function yh(f){let v;const w=new Promise(E=>{v=f(()=>{E(!0)})}),C=()=>{v?.()};return C.then=(E,z)=>w.then(E,z),C.promise=w,C}var O_=function(f,v){var w={};for(var C in f)Object.prototype.hasOwnProperty.call(f,C)&&v.indexOf(C)<0&&(w[C]=f[C]);if(f!=null&&typeof Object.getOwnPropertySymbols=="function")for(var E=0,C=Object.getOwnPropertySymbols(f);E<C.length;E++)v.indexOf(C[E])<0&&Object.prototype.propertyIsEnumerable.call(f,C[E])&&(w[C[E]]=f[C[E]]);return w};const N_=8,$_=3,j_=f=>{let{children:v,prefixCls:w}=f;const C=of(w),[E,z,O]=Sf(w,C);return E(W.createElement(w_,{classNames:{list:di(z,O,C)}},v))},V_=(f,v)=>{let{prefixCls:w,key:C}=v;return W.createElement(j_,{prefixCls:w,key:C},f)},U_=W.forwardRef((f,v)=>{const{top:w,prefixCls:C,getContainer:E,maxCount:z,duration:O=$_,rtl:a,transitionName:Q,onAllRemoved:B}=f,{getPrefixCls:ae,getPopupContainer:oe,message:he}=W.useContext($a),we=C||ae("message"),ke=()=>({left:"50%",transform:"translateX(-50%)",top:w??N_}),Ne=()=>di({[`${we}-rtl`]:a}),Re=()=>B_(we,Q),Fe=W.createElement("span",{className:`${we}-close-x`},W.createElement(gh,{className:`${we}-close-icon`})),[We,Ue]=M_({prefixCls:we,style:ke,className:Ne,motion:Re,closable:!1,closeIcon:Fe,duration:O,getContainer:()=>E?.()||oe?.()||document.body,maxCount:z,onAllRemoved:B,renderNotifications:V_});return W.useImperativeHandle(v,()=>Object.assign(Object.assign({},We),{prefixCls:we,message:he})),Ue});let fp=0;function Tf(f){const v=W.useRef(null);return Gg(),[W.useMemo(()=>{const C=Q=>{var B;(B=v.current)===null||B===void 0||B.close(Q)},E=Q=>{if(!v.current){const rt=()=>{};return rt.then=()=>{},rt}const{open:B,prefixCls:ae,message:oe}=v.current,he=`${ae}-notice`,{content:we,icon:ke,type:Ne,key:Re,className:Fe,style:We,onClose:Ue}=Q,ye=O_(Q,["content","icon","type","key","className","style","onClose"]);let Ie=Re;return Ie==null&&(fp+=1,Ie=`antd-message-${fp}`),yh(rt=>(B(Object.assign(Object.assign({},ye),{key:Ie,content:W.createElement(Cf,{prefixCls:ae,type:Ne,icon:ke},we),placement:"top",className:di(Ne&&`${he}-${Ne}`,Fe,oe?.className),style:Object.assign(Object.assign({},oe?.style),We),onClose:()=>{Ue?.(),rt()}})),()=>{C(Ie)}))},O={open:E,destroy:Q=>{var B;Q!==void 0?C(Q):(B=v.current)===null||B===void 0||B.destroy()}};return["info","success","warning","error","loading"].forEach(Q=>{const B=(ae,oe,he)=>{let we;ae&&typeof ae=="object"&&"content"in ae?we=ae:we={content:ae};let ke,Ne;typeof oe=="function"?Ne=oe:(ke=oe,Ne=he);const Re=Object.assign(Object.assign({onClose:Ne,duration:ke},we),{type:Q});return E(Re)};O[Q]=B}),O},[]),W.createElement(U_,Object.assign({key:"message-holder"},f,{ref:v}))]}function q_(f){return Tf(f)}let un=null,Ws=f=>f(),el=[],_c={};function mp(){const{prefixCls:f,getContainer:v,duration:w,rtl:C,maxCount:E,top:z}=_c,O=f??uf().getPrefixCls("message"),a=v?.()||document.body;return{prefixCls:O,getContainer:()=>a,duration:w,rtl:C,maxCount:E,top:z}}const Z_=W.forwardRef((f,v)=>{const[w,C]=W.useState(mp),[E,z]=Tf(w),O=uf(),a=O.getRootPrefixCls(),Q=O.getIconPrefixCls(),B=O.getTheme(),ae=()=>{C(mp)};return W.useEffect(ae,[]),W.useImperativeHandle(v,()=>{const oe=Object.assign({},E);return Object.keys(oe).forEach(he=>{oe[he]=function(){return ae(),E[he].apply(E,arguments)}}),{instance:oe,sync:ae}}),W.createElement(Wg,{prefixCls:a,iconPrefixCls:Q,theme:B},z)});function wc(){if(!un){const f=document.createDocumentFragment(),v={fragment:f};un=v,Ws(()=>{Hg(W.createElement(Z_,{ref:w=>{const{instance:C,sync:E}=w||{};Promise.resolve().then(()=>{!v.instance&&C&&(v.instance=C,v.sync=E,wc())})}}),f)});return}un.instance&&(el.forEach(f=>{const{type:v,skipped:w}=f;if(!w)switch(v){case"open":{Ws(()=>{const C=un.instance.open(Object.assign(Object.assign({},_c),f.config));C?.then(f.resolve),f.setCloseFn(C)});break}case"destroy":Ws(()=>{un?.instance.destroy(f.key)});break;default:Ws(()=>{var C;const E=(C=un.instance)[v].apply(C,Yr(f.args));E?.then(f.resolve),f.setCloseFn(E)})}}),el=[])}function G_(f){_c=Object.assign(Object.assign({},_c),f),Ws(()=>{var v;(v=un?.sync)===null||v===void 0||v.call(un)})}function H_(f){const v=yh(w=>{let C;const E={type:"open",config:f,resolve:w,setCloseFn:z=>{C=z}};return el.push(E),()=>{C?Ws(()=>{C()}):E.skipped=!0}});return wc(),v}function W_(f,v){const w=yh(C=>{let E;const z={type:f,args:v,resolve:C,setCloseFn:O=>{E=O}};return el.push(z),()=>{E?Ws(()=>{E()}):z.skipped=!0}});return wc(),w}function X_(f){el.push({type:"destroy",key:f}),wc()}const K_=["success","info","warning","error","loading"],J_={open:H_,destroy:X_,config:G_,useMessage:q_,_InternalPanelDoNotUseOrYouWillBeFired:F_},yc=J_;K_.forEach(f=>{yc[f]=function(){for(var v=arguments.length,w=new Array(v),C=0;C<v;C++)w[C]=arguments[C];return W_(f,w)}});var Y_={percent:0,prefixCls:"rc-progress",strokeColor:"#2db7f5",strokeLinecap:"round",strokeWidth:1,trailColor:"#D9D9D9",trailWidth:1,gapPosition:"bottom"},Q_=function(){var v=W.useRef([]),w=W.useRef(null);return W.useEffect(function(){var C=Date.now(),E=!1;v.current.forEach(function(z){if(z){E=!0;var O=z.style;O.transitionDuration=".3s, .3s, .3s, .06s",w.current&&C-w.current<100&&(O.transitionDuration="0s, 0s")}}),E&&(w.current=Date.now())}),v.current},gp=0,ey=Xg();function ty(){var f;return ey?(f=gp,gp+=1):f="TEST_OR_SSR",f}const iy=function(f){var v=W.useState(),w=es(v,2),C=w[0],E=w[1];return W.useEffect(function(){E("rc_progress_".concat(ty()))},[]),f||C};var _p=function(v){var w=v.bg,C=v.children;return W.createElement("div",{style:{width:"100%",height:"100%",background:w}},C)};function yp(f,v){return Object.keys(f).map(function(w){var C=parseFloat(w),E="".concat(Math.floor(C*v),"%");return"".concat(f[w]," ").concat(E)})}var ry=W.forwardRef(function(f,v){var w=f.prefixCls,C=f.color,E=f.gradientId,z=f.radius,O=f.style,a=f.ptg,Q=f.strokeLinecap,B=f.strokeWidth,ae=f.size,oe=f.gapDegree,he=C&&Hs(C)==="object",we=he?"#FFF":void 0,ke=ae/2,Ne=W.createElement("circle",{className:"".concat(w,"-circle-path"),r:z,cx:ke,cy:ke,stroke:we,strokeLinecap:Q,strokeWidth:B,opacity:a===0?0:1,style:O,ref:v});if(!he)return Ne;var Re="".concat(E,"-conic"),Fe=oe?"".concat(180+oe/2,"deg"):"0deg",We=yp(C,(360-oe)/360),Ue=yp(C,1),ye="conic-gradient(from ".concat(Fe,", ").concat(We.join(", "),")"),Ie="linear-gradient(to ".concat(oe?"bottom":"top",", ").concat(Ue.join(", "),")");return W.createElement(W.Fragment,null,W.createElement("mask",{id:Re},Ne),W.createElement("foreignObject",{x:0,y:0,width:ae,height:ae,mask:"url(#".concat(Re,")")},W.createElement(_p,{bg:Ie},W.createElement(_p,{bg:ye}))))}),Xo=100,Fu=function(v,w,C,E,z,O,a,Q,B,ae){var oe=arguments.length>10&&arguments[10]!==void 0?arguments[10]:0,he=C/100*360*((360-O)/360),we=O===0?0:{bottom:0,top:180,left:90,right:-90}[a],ke=(100-E)/100*w;B==="round"&&E!==100&&(ke+=ae/2,ke>=w&&(ke=w-.01));var Ne=Xo/2;return{stroke:typeof Q=="string"?Q:void 0,strokeDasharray:"".concat(w,"px ").concat(v),strokeDashoffset:ke+oe,transform:"rotate(".concat(z+he+we,"deg)"),transformOrigin:"".concat(Ne,"px ").concat(Ne,"px"),transition:"stroke-dashoffset .3s ease 0s, stroke-dasharray .3s ease 0s, stroke .3s, stroke-width .06s ease .3s, opacity .3s ease 0s",fillOpacity:0}},ny=["id","prefixCls","steps","strokeWidth","trailWidth","gapDegree","gapPosition","trailColor","strokeLinecap","style","className","strokeColor","percent"];function vp(f){var v=f??[];return Array.isArray(v)?v:[v]}var sy=function(v){var w=Ss(Ss({},Y_),v),C=w.id,E=w.prefixCls,z=w.steps,O=w.strokeWidth,a=w.trailWidth,Q=w.gapDegree,B=Q===void 0?0:Q,ae=w.gapPosition,oe=w.trailColor,he=w.strokeLinecap,we=w.style,ke=w.className,Ne=w.strokeColor,Re=w.percent,Fe=bc(w,ny),We=Xo/2,Ue=iy(C),ye="".concat(Ue,"-gradient"),Ie=We-O/2,rt=Math.PI*2*Ie,et=B>0?90+B/2:-90,Ze=rt*((360-B)/360),at=Hs(z)==="object"?z:{count:z,space:2},Pe=at.count,it=at.space,xt=vp(Re),At=vp(Ne),gt=At.find(function(si){return si&&Hs(si)==="object"}),Pt=gt&&Hs(gt)==="object",Bt=Pt?"butt":he,ft=Fu(rt,Ze,0,100,et,B,ae,oe,Bt,O),ni=Q_(),Mi=function(){var Xt=0;return xt.map(function(qe,yt){var Kt=At[yt]||At[At.length-1],Mt=Fu(rt,Ze,Xt,qe,et,B,ae,Kt,Bt,O);return Xt+=qe,W.createElement(ry,{key:yt,color:Kt,ptg:qe,radius:Ie,prefixCls:E,gradientId:ye,style:Mt,strokeLinecap:Bt,strokeWidth:O,gapDegree:B,ref:function(gi){ni[yt]=gi},size:Xo})}).reverse()},Xi=function(){var Xt=Math.round(Pe*(xt[0]/100)),qe=100/Pe,yt=0;return new Array(Pe).fill(null).map(function(Kt,Mt){var Jt=Mt<=Xt-1?At[0]:oe,gi=Jt&&Hs(Jt)==="object"?"url(#".concat(ye,")"):void 0,Yt=Fu(rt,Ze,yt,qe,et,B,ae,Jt,"butt",O,it);return yt+=(Ze-Yt.strokeDashoffset+it)*100/Ze,W.createElement("circle",{key:Mt,className:"".concat(E,"-circle-path"),r:Ie,cx:We,cy:We,stroke:gi,strokeWidth:O,opacity:1,style:Yt,ref:function(ki){ni[Mt]=ki}})})};return W.createElement("svg",Qr({className:di("".concat(E,"-circle"),ke),viewBox:"0 0 ".concat(Xo," ").concat(Xo),style:we,id:C,role:"presentation"},Fe),!Pe&&W.createElement("circle",{className:"".concat(E,"-circle-trail"),r:Ie,cx:We,cy:We,stroke:oe,strokeLinecap:Bt,strokeWidth:a||O,style:ft}),Pe?Xi():Mi())};function Cs(f){return!f||f<0?0:f>100?100:f}function vc(f){let{success:v,successPercent:w}=f,C=w;return v&&"progress"in v&&(C=v.progress),v&&"percent"in v&&(C=v.percent),C}const ay=f=>{let{percent:v,success:w,successPercent:C}=f;const E=Cs(vc({success:w,successPercent:C}));return[E,Cs(Cs(v)-E)]},oy=f=>{let{success:v={},strokeColor:w}=f;const{strokeColor:C}=v;return[C||oh.green,w||null]},Sc=(f,v,w)=>{var C,E,z,O;let a=-1,Q=-1;if(v==="step"){const B=w.steps,ae=w.strokeWidth;typeof f=="string"||typeof f>"u"?(a=f==="small"?2:14,Q=ae??8):typeof f=="number"?[a,Q]=[f,f]:[a=14,Q=8]=f,a*=B}else if(v==="line"){const B=w?.strokeWidth;typeof f=="string"||typeof f>"u"?Q=B||(f==="small"?6:8):typeof f=="number"?[a,Q]=[f,f]:[a=-1,Q=8]=f}else(v==="circle"||v==="dashboard")&&(typeof f=="string"||typeof f>"u"?[a,Q]=f==="small"?[60,60]:[120,120]:typeof f=="number"?[a,Q]=[f,f]:(a=(E=(C=f[0])!==null&&C!==void 0?C:f[1])!==null&&E!==void 0?E:120,Q=(O=(z=f[0])!==null&&z!==void 0?z:f[1])!==null&&O!==void 0?O:120));return[a,Q]},ly=3,cy=f=>ly/f*100,uy=f=>{const{prefixCls:v,trailColor:w=null,strokeLinecap:C="round",gapPosition:E,gapDegree:z,width:O=120,type:a,children:Q,success:B,size:ae=O}=f,[oe,he]=Sc(ae,"circle");let{strokeWidth:we}=f;we===void 0&&(we=Math.max(cy(oe),6));const ke={width:oe,height:he,fontSize:oe*.15+6},Ne=W.useMemo(()=>{if(z||z===0)return z;if(a==="dashboard")return 75},[z,a]),Re=E||a==="dashboard"&&"bottom"||void 0,Fe=Object.prototype.toString.call(f.strokeColor)==="[object Object]",We=oy({success:B,strokeColor:f.strokeColor}),Ue=di(`${v}-inner`,{[`${v}-circle-gradient`]:Fe}),ye=W.createElement(sy,{percent:ay(f),strokeWidth:we,trailWidth:we,strokeColor:We,strokeLinecap:C,trailColor:w,prefixCls:v,gapDegree:Ne,gapPosition:Re});return W.createElement("div",{className:Ue,style:ke},oe<=20?W.createElement(hf,{title:Q},W.createElement("span",null,ye)):W.createElement(W.Fragment,null,ye,Q))},hy=uy,xc="--progress-line-stroke-color",If="--progress-percent",xp=f=>{const v=f?"100%":"-100%";return new Qo(`antProgress${f?"RTL":"LTR"}Active`,{"0%":{transform:`translateX(${v}) scaleX(0)`,opacity:.1},"20%":{transform:`translateX(${v}) scaleX(0)`,opacity:.5},to:{transform:"translateX(0) scaleX(1)",opacity:0}})},dy=f=>{const{componentCls:v,iconCls:w}=f;return{[v]:Object.assign(Object.assign({},mh(f)),{display:"inline-block","&-rtl":{direction:"rtl"},"&-line":{position:"relative",width:"100%",fontSize:f.fontSize,marginInlineEnd:f.marginXS,marginBottom:f.marginXS},[`${v}-outer`]:{display:"inline-block",width:"100%"},[`&${v}-show-info`]:{[`${v}-outer`]:{marginInlineEnd:`calc(-2em - ${pr(f.marginXS)})`,paddingInlineEnd:`calc(2em + ${pr(f.paddingXS)})`}},[`${v}-inner`]:{position:"relative",display:"inline-block",width:"100%",overflow:"hidden",verticalAlign:"middle",backgroundColor:f.remainingColor,borderRadius:f.lineBorderRadius},[`${v}-inner:not(${v}-circle-gradient)`]:{[`${v}-circle-path`]:{stroke:f.defaultColor}},[`${v}-success-bg, ${v}-bg`]:{position:"relative",background:f.defaultColor,borderRadius:f.lineBorderRadius,transition:`all ${f.motionDurationSlow} ${f.motionEaseInOutCirc}`},[`${v}-bg`]:{overflow:"hidden","&::after":{content:'""',background:{_multi_value_:!0,value:["inherit",`var(${xc})`]},height:"100%",width:`calc(1 / var(${If}) * 100%)`,display:"block"}},[`${v}-success-bg`]:{position:"absolute",insetBlockStart:0,insetInlineStart:0,backgroundColor:f.colorSuccess},[`${v}-text`]:{display:"inline-block",width:"2em",marginInlineStart:f.marginXS,color:f.colorText,lineHeight:1,whiteSpace:"nowrap",textAlign:"start",verticalAlign:"middle",wordBreak:"normal",[w]:{fontSize:f.fontSize}},[`&${v}-status-active`]:{[`${v}-bg::before`]:{position:"absolute",inset:0,backgroundColor:f.colorBgContainer,borderRadius:f.lineBorderRadius,opacity:0,animationName:xp(),animationDuration:f.progressActiveMotionDuration,animationTimingFunction:f.motionEaseOutQuint,animationIterationCount:"infinite",content:'""'}},[`&${v}-rtl${v}-status-active`]:{[`${v}-bg::before`]:{animationName:xp(!0)}},[`&${v}-status-exception`]:{[`${v}-bg`]:{backgroundColor:f.colorError},[`${v}-text`]:{color:f.colorError}},[`&${v}-status-exception ${v}-inner:not(${v}-circle-gradient)`]:{[`${v}-circle-path`]:{stroke:f.colorError}},[`&${v}-status-success`]:{[`${v}-bg`]:{backgroundColor:f.colorSuccess},[`${v}-text`]:{color:f.colorSuccess}},[`&${v}-status-success ${v}-inner:not(${v}-circle-gradient)`]:{[`${v}-circle-path`]:{stroke:f.colorSuccess}}})}},py=f=>{const{componentCls:v,iconCls:w}=f;return{[v]:{[`${v}-circle-trail`]:{stroke:f.remainingColor},[`&${v}-circle ${v}-inner`]:{position:"relative",lineHeight:1,backgroundColor:"transparent"},[`&${v}-circle ${v}-text`]:{position:"absolute",insetBlockStart:"50%",insetInlineStart:0,width:"100%",margin:0,padding:0,color:f.circleTextColor,fontSize:f.circleTextFontSize,lineHeight:1,whiteSpace:"normal",textAlign:"center",transform:"translateY(-50%)",[w]:{fontSize:f.circleIconFontSize}},[`${v}-circle&-status-exception`]:{[`${v}-text`]:{color:f.colorError}},[`${v}-circle&-status-success`]:{[`${v}-text`]:{color:f.colorSuccess}}},[`${v}-inline-circle`]:{lineHeight:1,[`${v}-inner`]:{verticalAlign:"bottom"}}}},fy=f=>{const{componentCls:v}=f;return{[v]:{[`${v}-steps`]:{display:"inline-block","&-outer":{display:"flex",flexDirection:"row",alignItems:"center"},"&-item":{flexShrink:0,minWidth:f.progressStepMinWidth,marginInlineEnd:f.progressStepMarginInlineEnd,backgroundColor:f.remainingColor,transition:`all ${f.motionDurationSlow}`,"&-active":{backgroundColor:f.defaultColor}}}}}},my=f=>{const{componentCls:v,iconCls:w}=f;return{[v]:{[`${v}-small&-line, ${v}-small&-line ${v}-text ${w}`]:{fontSize:f.fontSizeSM}}}},gy=f=>({circleTextColor:f.colorText,defaultColor:f.colorInfo,remainingColor:f.colorFillSecondary,lineBorderRadius:100,circleTextFontSize:"1em",circleIconFontSize:`${f.fontSize/f.fontSizeSM}em`}),_y=ph("Progress",f=>{const v=f.calc(f.marginXXS).div(2).equal(),w=fh(f,{progressStepMarginInlineEnd:v,progressStepMinWidth:v,progressActiveMotionDuration:"2.4s"});return[dy(w),py(w),fy(w),my(w)]},gy);var yy=function(f,v){var w={};for(var C in f)Object.prototype.hasOwnProperty.call(f,C)&&v.indexOf(C)<0&&(w[C]=f[C]);if(f!=null&&typeof Object.getOwnPropertySymbols=="function")for(var E=0,C=Object.getOwnPropertySymbols(f);E<C.length;E++)v.indexOf(C[E])<0&&Object.prototype.propertyIsEnumerable.call(f,C[E])&&(w[C[E]]=f[C[E]]);return w};const vy=f=>{let v=[];return Object.keys(f).forEach(w=>{const C=parseFloat(w.replace(/%/g,""));isNaN(C)||v.push({key:C,value:f[w]})}),v=v.sort((w,C)=>w.key-C.key),v.map(w=>{let{key:C,value:E}=w;return`${E} ${C}%`}).join(", ")},xy=(f,v)=>{const{from:w=oh.blue,to:C=oh.blue,direction:E=v==="rtl"?"to left":"to right"}=f,z=yy(f,["from","to","direction"]);if(Object.keys(z).length!==0){const a=vy(z),Q=`linear-gradient(${E}, ${a})`;return{background:Q,[xc]:Q}}const O=`linear-gradient(${E}, ${w}, ${C})`;return{background:O,[xc]:O}},by=f=>{const{prefixCls:v,direction:w,percent:C,size:E,strokeWidth:z,strokeColor:O,strokeLinecap:a="round",children:Q,trailColor:B=null,success:ae}=f,oe=O&&typeof O!="string"?xy(O,w):{[xc]:O,background:O},he=a==="square"||a==="butt"?0:void 0,we=E??[-1,z||(E==="small"?6:8)],[ke,Ne]=Sc(we,"line",{strokeWidth:z}),Re={backgroundColor:B||void 0,borderRadius:he},Fe=Object.assign(Object.assign({width:`${Cs(C)}%`,height:Ne,borderRadius:he},oe),{[If]:Cs(C)/100}),We=vc(f),Ue={width:`${Cs(We)}%`,height:Ne,borderRadius:he,backgroundColor:ae?.strokeColor},ye={width:ke<0?"100%":ke,height:Ne};return W.createElement(W.Fragment,null,W.createElement("div",{className:`${v}-outer`,style:ye},W.createElement("div",{className:`${v}-inner`,style:Re},W.createElement("div",{className:`${v}-bg`,style:Fe}),We!==void 0?W.createElement("div",{className:`${v}-success-bg`,style:Ue}):null)),Q)},wy=by,Sy=f=>{const{size:v,steps:w,percent:C=0,strokeWidth:E=8,strokeColor:z,trailColor:O=null,prefixCls:a,children:Q}=f,B=Math.round(w*(C/100)),oe=v??[v==="small"?2:14,E],[he,we]=Sc(oe,"step",{steps:w,strokeWidth:E}),ke=he/w,Ne=new Array(w);for(let Re=0;Re<w;Re++){const Fe=Array.isArray(z)?z[Re]:z;Ne[Re]=W.createElement("div",{key:Re,className:di(`${a}-steps-item`,{[`${a}-steps-item-active`]:Re<=B-1}),style:{backgroundColor:Re<=B-1?Fe:O,width:ke,height:we}})}return W.createElement("div",{className:`${a}-steps-outer`},Ne,Q)},Cy=Sy;var Ty=function(f,v){var w={};for(var C in f)Object.prototype.hasOwnProperty.call(f,C)&&v.indexOf(C)<0&&(w[C]=f[C]);if(f!=null&&typeof Object.getOwnPropertySymbols=="function")for(var E=0,C=Object.getOwnPropertySymbols(f);E<C.length;E++)v.indexOf(C[E])<0&&Object.prototype.propertyIsEnumerable.call(f,C[E])&&(w[C[E]]=f[C[E]]);return w};const Iy=["normal","exception","active","success"],Ey=W.forwardRef((f,v)=>{const{prefixCls:w,className:C,rootClassName:E,steps:z,strokeColor:O,percent:a=0,size:Q="default",showInfo:B=!0,type:ae="line",status:oe,format:he,style:we}=f,ke=Ty(f,["prefixCls","className","rootClassName","steps","strokeColor","percent","size","showInfo","type","status","format","style"]),Ne=W.useMemo(()=>{var At,gt;const Pt=vc(f);return parseInt(Pt!==void 0?(At=Pt??0)===null||At===void 0?void 0:At.toString():(gt=a??0)===null||gt===void 0?void 0:gt.toString(),10)},[a,f.success,f.successPercent]),Re=W.useMemo(()=>!Iy.includes(oe)&&Ne>=100?"success":oe||"normal",[oe,Ne]),{getPrefixCls:Fe,direction:We,progress:Ue}=W.useContext($a),ye=Fe("progress",w),[Ie,rt,et]=_y(ye),Ze=W.useMemo(()=>{if(!B)return null;const At=vc(f);let gt;const Pt=he||(ft=>`${ft}%`),Bt=ae==="line";return he||Re!=="exception"&&Re!=="success"?gt=Pt(Cs(a),Cs(At)):Re==="exception"?gt=Bt?W.createElement(cf,null):W.createElement(gh,null):Re==="success"&&(gt=Bt?W.createElement(lf,null):W.createElement(Jg,null)),W.createElement("span",{className:`${ye}-text`,title:typeof gt=="string"?gt:void 0},gt)},[B,a,Ne,Re,ae,ye,he]),at=Array.isArray(O)?O[0]:O,Pe=typeof O=="string"||Array.isArray(O)?O:void 0;let it;ae==="line"?it=z?W.createElement(Cy,Object.assign({},f,{strokeColor:Pe,prefixCls:ye,steps:z}),Ze):W.createElement(wy,Object.assign({},f,{strokeColor:at,prefixCls:ye,direction:We}),Ze):(ae==="circle"||ae==="dashboard")&&(it=W.createElement(hy,Object.assign({},f,{strokeColor:at,prefixCls:ye,progressStatus:Re}),Ze));const xt=di(ye,`${ye}-status-${Re}`,`${ye}-${ae==="dashboard"&&"circle"||z&&"steps"||ae}`,{[`${ye}-inline-circle`]:ae==="circle"&&Sc(Q,"circle")[0]<=20,[`${ye}-show-info`]:B,[`${ye}-${Q}`]:typeof Q=="string",[`${ye}-rtl`]:We==="rtl"},Ue?.className,C,E,rt,et);return Ie(W.createElement("div",Object.assign({ref:v,style:Object.assign(Object.assign({},Ue?.style),we),className:xt,role:"progressbar","aria-valuenow":Ne},Kg(ke,["trailColor","strokeWidth","width","gapDegree","gapPosition","strokeLinecap","success","successPercent"])),it))}),Ay=Ey;var Py={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z"}}]},name:"delete",theme:"outlined"};const My=Py;var ky=function(v,w){return W.createElement(ja,Qr({},v,{ref:w,icon:My}))};const Ef=W.forwardRef(ky),Bu=function(f,v){if(f&&v){var w=Array.isArray(v)?v:v.split(","),C=f.name||"",E=f.type||"",z=E.replace(/\/.*$/,"");return w.some(function(O){var a=O.trim();if(/^\*(\/\*)?$/.test(O))return!0;if(a.charAt(0)==="."){var Q=C.toLowerCase(),B=a.toLowerCase(),ae=[B];return(B===".jpg"||B===".jpeg")&&(ae=[".jpg",".jpeg"]),ae.some(function(oe){return Q.endsWith(oe)})}return/\/\*$/.test(a)?z===a.replace(/\/.*$/,""):E===a?!0:/^\w+$/.test(a)?(Yg(!1,"Upload takes an invalidate 'accept' type '".concat(a,"'.Skip for check.")),!0):!1})}return!0};function zy(f,v){var w="cannot ".concat(f.method," ").concat(f.action," ").concat(v.status,"'"),C=new Error(w);return C.status=v.status,C.method=f.method,C.url=f.action,C}function bp(f){var v=f.responseText||f.response;if(!v)return v;try{return JSON.parse(v)}catch{return v}}function Dy(f){var v=new XMLHttpRequest;f.onProgress&&v.upload&&(v.upload.onprogress=function(z){z.total>0&&(z.percent=z.loaded/z.total*100),f.onProgress(z)});var w=new FormData;f.data&&Object.keys(f.data).forEach(function(E){var z=f.data[E];if(Array.isArray(z)){z.forEach(function(O){w.append("".concat(E,"[]"),O)});return}w.append(E,z)}),f.file instanceof Blob?w.append(f.filename,f.file,f.file.name):w.append(f.filename,f.file),v.onerror=function(z){f.onError(z)},v.onload=function(){return v.status<200||v.status>=300?f.onError(zy(f,v),bp(v)):f.onSuccess(bp(v),v)},v.open(f.method,f.action,!0),f.withCredentials&&"withCredentials"in v&&(v.withCredentials=!0);var C=f.headers||{};return C["X-Requested-With"]!==null&&v.setRequestHeader("X-Requested-With","XMLHttpRequest"),Object.keys(C).forEach(function(E){C[E]!==null&&v.setRequestHeader(E,C[E])}),v.send(w),{abort:function(){v.abort()}}}function Ly(f,v){var w=f.createReader(),C=[];function E(){w.readEntries(function(z){var O=Array.prototype.slice.apply(z);C=C.concat(O);var a=!O.length;a?v(C):E()})}E()}var Ry=function(v,w,C){var E=function z(O,a){O&&(O.path=a||"",O.isFile?O.file(function(Q){C(Q)&&(O.fullPath&&!Q.webkitRelativePath&&(Object.defineProperties(Q,{webkitRelativePath:{writable:!0}}),Q.webkitRelativePath=O.fullPath.replace(/^\//,""),Object.defineProperties(Q,{webkitRelativePath:{writable:!1}})),w([Q]))}):O.isDirectory&&Ly(O,function(Q){Q.forEach(function(B){z(B,"".concat(a).concat(O.name,"/"))})}))};v.forEach(function(z){E(z.webkitGetAsEntry())})},Fy=+new Date,By=0;function Ou(){return"rc-upload-".concat(Fy,"-").concat(++By)}var Oy=["component","prefixCls","className","classNames","disabled","id","style","styles","multiple","accept","capture","children","directory","openFileDialogOnClick","onMouseEnter","onMouseLeave","hasControlInside"],Ny=function(f){df(w,f);var v=pf(w);function w(){var C;ff(this,w);for(var E=arguments.length,z=new Array(E),O=0;O<E;O++)z[O]=arguments[O];return C=v.call.apply(v,[this].concat(z)),Vi(Jr(C),"state",{uid:Ou()}),Vi(Jr(C),"reqs",{}),Vi(Jr(C),"fileInput",void 0),Vi(Jr(C),"_isMounted",void 0),Vi(Jr(C),"onChange",function(a){var Q=C.props,B=Q.accept,ae=Q.directory,oe=a.target.files,he=Yr(oe).filter(function(we){return!ae||Bu(we,B)});C.uploadFiles(he),C.reset()}),Vi(Jr(C),"onClick",function(a){var Q=C.fileInput;if(Q){var B=a.target,ae=C.props.onClick;if(B&&B.tagName==="BUTTON"){var oe=Q.parentNode;oe.focus(),B.blur()}Q.click(),ae&&ae(a)}}),Vi(Jr(C),"onKeyDown",function(a){a.key==="Enter"&&C.onClick(a)}),Vi(Jr(C),"onFileDrop",function(a){var Q=C.props.multiple;if(a.preventDefault(),a.type!=="dragover")if(C.props.directory)Ry(Array.prototype.slice.call(a.dataTransfer.items),C.uploadFiles,function(ae){return Bu(ae,C.props.accept)});else{var B=Yr(a.dataTransfer.files).filter(function(ae){return Bu(ae,C.props.accept)});Q===!1&&(B=B.slice(0,1)),C.uploadFiles(B)}}),Vi(Jr(C),"uploadFiles",function(a){var Q=Yr(a),B=Q.map(function(ae){return ae.uid=Ou(),C.processFile(ae,Q)});Promise.all(B).then(function(ae){var oe=C.props.onBatchStart;oe?.(ae.map(function(he){var we=he.origin,ke=he.parsedFile;return{file:we,parsedFile:ke}})),ae.filter(function(he){return he.parsedFile!==null}).forEach(function(he){C.post(he)})})}),Vi(Jr(C),"processFile",function(){var a=e_(ap().mark(function Q(B,ae){var oe,he,we,ke,Ne,Re,Fe,We,Ue;return ap().wrap(function(Ie){for(;;)switch(Ie.prev=Ie.next){case 0:if(oe=C.props.beforeUpload,he=B,!oe){Ie.next=14;break}return Ie.prev=3,Ie.next=6,oe(B,ae);case 6:he=Ie.sent,Ie.next=12;break;case 9:Ie.prev=9,Ie.t0=Ie.catch(3),he=!1;case 12:if(he!==!1){Ie.next=14;break}return Ie.abrupt("return",{origin:B,parsedFile:null,action:null,data:null});case 14:if(we=C.props.action,typeof we!="function"){Ie.next=21;break}return Ie.next=18,we(B);case 18:ke=Ie.sent,Ie.next=22;break;case 21:ke=we;case 22:if(Ne=C.props.data,typeof Ne!="function"){Ie.next=29;break}return Ie.next=26,Ne(B);case 26:Re=Ie.sent,Ie.next=30;break;case 29:Re=Ne;case 30:return Fe=(Hs(he)==="object"||typeof he=="string")&&he?he:B,Fe instanceof File?We=Fe:We=new File([Fe],B.name,{type:B.type}),Ue=We,Ue.uid=B.uid,Ie.abrupt("return",{origin:B,data:Re,parsedFile:Ue,action:ke});case 35:case"end":return Ie.stop()}},Q,null,[[3,9]])}));return function(Q,B){return a.apply(this,arguments)}}()),Vi(Jr(C),"saveFileInput",function(a){C.fileInput=a}),C}return mf(w,[{key:"componentDidMount",value:function(){this._isMounted=!0}},{key:"componentWillUnmount",value:function(){this._isMounted=!1,this.abort()}},{key:"post",value:function(E){var z=this,O=E.data,a=E.origin,Q=E.action,B=E.parsedFile;if(this._isMounted){var ae=this.props,oe=ae.onStart,he=ae.customRequest,we=ae.name,ke=ae.headers,Ne=ae.withCredentials,Re=ae.method,Fe=a.uid,We=he||Dy,Ue={action:Q,filename:we,data:O,file:B,headers:ke,withCredentials:Ne,method:Re||"post",onProgress:function(Ie){var rt=z.props.onProgress;rt?.(Ie,B)},onSuccess:function(Ie,rt){var et=z.props.onSuccess;et?.(Ie,B,rt),delete z.reqs[Fe]},onError:function(Ie,rt){var et=z.props.onError;et?.(Ie,rt,B),delete z.reqs[Fe]}};oe(a),this.reqs[Fe]=We(Ue)}}},{key:"reset",value:function(){this.setState({uid:Ou()})}},{key:"abort",value:function(E){var z=this.reqs;if(E){var O=E.uid?E.uid:E;z[O]&&z[O].abort&&z[O].abort(),delete z[O]}else Object.keys(z).forEach(function(a){z[a]&&z[a].abort&&z[a].abort(),delete z[a]})}},{key:"render",value:function(){var E,z=this.props,O=z.component,a=z.prefixCls,Q=z.className,B=z.classNames,ae=B===void 0?{}:B,oe=z.disabled,he=z.id,we=z.style,ke=z.styles,Ne=ke===void 0?{}:ke,Re=z.multiple,Fe=z.accept,We=z.capture,Ue=z.children,ye=z.directory,Ie=z.openFileDialogOnClick,rt=z.onMouseEnter,et=z.onMouseLeave,Ze=z.hasControlInside,at=bc(z,Oy),Pe=di((E={},Vi(E,a,!0),Vi(E,"".concat(a,"-disabled"),oe),Vi(E,Q,Q),E)),it=ye?{directory:"directory",webkitdirectory:"webkitdirectory"}:{},xt=oe?{}:{onClick:Ie?this.onClick:function(){},onKeyDown:Ie?this.onKeyDown:function(){},onMouseEnter:rt,onMouseLeave:et,onDrop:this.onFileDrop,onDragOver:this.onFileDrop,tabIndex:Ze?void 0:"0"};return ws.createElement(O,Qr({},xt,{className:Pe,role:Ze?void 0:"button",style:we}),ws.createElement("input",Qr({},Qg(at,{aria:!0,data:!0}),{id:he,disabled:oe,type:"file",ref:this.saveFileInput,onClick:function(gt){return gt.stopPropagation()},key:this.state.uid,style:Ss({display:"none"},Ne.input),className:ae.input,accept:Fe},it,{multiple:Re,onChange:this.onChange},We!=null?{capture:We}:{})),Ue)}}]),w}(W.Component);function Nu(){}var uh=function(f){df(w,f);var v=pf(w);function w(){var C;ff(this,w);for(var E=arguments.length,z=new Array(E),O=0;O<E;O++)z[O]=arguments[O];return C=v.call.apply(v,[this].concat(z)),Vi(Jr(C),"uploader",void 0),Vi(Jr(C),"saveUploader",function(a){C.uploader=a}),C}return mf(w,[{key:"abort",value:function(E){this.uploader.abort(E)}},{key:"render",value:function(){return ws.createElement(Ny,Qr({},this.props,{ref:this.saveUploader}))}}]),w}(W.Component);Vi(uh,"defaultProps",{component:"span",prefixCls:"rc-upload",data:{},headers:{},name:"file",multipart:!1,onStart:Nu,onError:Nu,onSuccess:Nu,multiple:!1,beforeUpload:null,customRequest:null,withCredentials:!1,openFileDialogOnClick:!0,hasControlInside:!1});const $y=f=>{const{componentCls:v,iconCls:w}=f;return{[`${v}-wrapper`]:{[`${v}-drag`]:{position:"relative",width:"100%",height:"100%",textAlign:"center",background:f.colorFillAlter,border:`${pr(f.lineWidth)} dashed ${f.colorBorder}`,borderRadius:f.borderRadiusLG,cursor:"pointer",transition:`border-color ${f.motionDurationSlow}`,[v]:{padding:f.padding},[`${v}-btn`]:{display:"table",width:"100%",height:"100%",outline:"none",borderRadius:f.borderRadiusLG,"&:focus-visible":{outline:`${pr(f.lineWidthFocus)} solid ${f.colorPrimaryBorder}`}},[`${v}-drag-container`]:{display:"table-cell",verticalAlign:"middle"},[`
          &:not(${v}-disabled):hover,
          &-hover:not(${v}-disabled)
        `]:{borderColor:f.colorPrimaryHover},[`p${v}-drag-icon`]:{marginBottom:f.margin,[w]:{color:f.colorPrimary,fontSize:f.uploadThumbnailSize}},[`p${v}-text`]:{margin:`0 0 ${pr(f.marginXXS)}`,color:f.colorTextHeading,fontSize:f.fontSizeLG},[`p${v}-hint`]:{color:f.colorTextDescription,fontSize:f.fontSize},[`&${v}-disabled`]:{[`p${v}-drag-icon ${w},
            p${v}-text,
            p${v}-hint
          `]:{color:f.colorTextDisabled}}}}}},jy=f=>{const{componentCls:v,antCls:w,iconCls:C,fontSize:E,lineHeight:z,calc:O}=f,a=`${v}-list-item`,Q=`${a}-actions`,B=`${a}-action`,ae=f.fontHeightSM;return{[`${v}-wrapper`]:{[`${v}-list`]:Object.assign(Object.assign({},gf()),{lineHeight:f.lineHeight,[a]:{position:"relative",height:O(f.lineHeight).mul(E).equal(),marginTop:f.marginXS,fontSize:E,display:"flex",alignItems:"center",transition:`background-color ${f.motionDurationSlow}`,"&:hover":{backgroundColor:f.controlItemBgHover},[`${a}-name`]:Object.assign(Object.assign({},_f),{padding:`0 ${pr(f.paddingXS)}`,lineHeight:z,flex:"auto",transition:`all ${f.motionDurationSlow}`}),[Q]:{[B]:{opacity:0},[C]:{color:f.actionsColor,transition:`all ${f.motionDurationSlow}`},[`
              ${B}:focus-visible,
              &.picture ${B}
            `]:{opacity:1},[`${B}${w}-btn`]:{height:ae,border:0,lineHeight:1}},[`${v}-icon ${C}`]:{color:f.colorTextDescription,fontSize:E},[`${a}-progress`]:{position:"absolute",bottom:f.calc(f.uploadProgressOffset).mul(-1).equal(),width:"100%",paddingInlineStart:O(E).add(f.paddingXS).equal(),fontSize:E,lineHeight:0,pointerEvents:"none","> div":{margin:0}}},[`${a}:hover ${B}`]:{opacity:1},[`${a}-error`]:{color:f.colorError,[`${a}-name, ${v}-icon ${C}`]:{color:f.colorError},[Q]:{[`${C}, ${C}:hover`]:{color:f.colorError},[B]:{opacity:1}}},[`${v}-list-item-container`]:{transition:`opacity ${f.motionDurationSlow}, height ${f.motionDurationSlow}`,"&::before":{display:"table",width:0,height:0,content:'""'}}})}}},wp=new Qo("uploadAnimateInlineIn",{from:{width:0,height:0,margin:0,padding:0,opacity:0}}),Sp=new Qo("uploadAnimateInlineOut",{to:{width:0,height:0,margin:0,padding:0,opacity:0}}),Vy=f=>{const{componentCls:v}=f,w=`${v}-animate-inline`;return[{[`${v}-wrapper`]:{[`${w}-appear, ${w}-enter, ${w}-leave`]:{animationDuration:f.motionDurationSlow,animationTimingFunction:f.motionEaseInOutCirc,animationFillMode:"forwards"},[`${w}-appear, ${w}-enter`]:{animationName:wp},[`${w}-leave`]:{animationName:Sp}}},{[`${v}-wrapper`]:__(f)},wp,Sp]},Uy=f=>{const{componentCls:v,iconCls:w,uploadThumbnailSize:C,uploadProgressOffset:E,calc:z}=f,O=`${v}-list`,a=`${O}-item`;return{[`${v}-wrapper`]:{[`
        ${O}${O}-picture,
        ${O}${O}-picture-card,
        ${O}${O}-picture-circle
      `]:{[a]:{position:"relative",height:z(C).add(z(f.lineWidth).mul(2)).add(z(f.paddingXS).mul(2)).equal(),padding:f.paddingXS,border:`${pr(f.lineWidth)} ${f.lineType} ${f.colorBorder}`,borderRadius:f.borderRadiusLG,"&:hover":{background:"transparent"},[`${a}-thumbnail`]:Object.assign(Object.assign({},_f),{width:C,height:C,lineHeight:pr(z(C).add(f.paddingSM).equal()),textAlign:"center",flex:"none",[w]:{fontSize:f.fontSizeHeading2,color:f.colorPrimary},img:{display:"block",width:"100%",height:"100%",overflow:"hidden"}}),[`${a}-progress`]:{bottom:E,width:`calc(100% - ${pr(z(f.paddingSM).mul(2).equal())})`,marginTop:0,paddingInlineStart:z(C).add(f.paddingXS).equal()}},[`${a}-error`]:{borderColor:f.colorError,[`${a}-thumbnail ${w}`]:{[`svg path[fill='${op[0]}']`]:{fill:f.colorErrorBg},[`svg path[fill='${op.primary}']`]:{fill:f.colorError}}},[`${a}-uploading`]:{borderStyle:"dashed",[`${a}-name`]:{marginBottom:E}}},[`${O}${O}-picture-circle ${a}`]:{[`&, &::before, ${a}-thumbnail`]:{borderRadius:"50%"}}}}},qy=f=>{const{componentCls:v,iconCls:w,fontSizeLG:C,colorTextLightSolid:E,calc:z}=f,O=`${v}-list`,a=`${O}-item`,Q=f.uploadPicCardSize;return{[`
      ${v}-wrapper${v}-picture-card-wrapper,
      ${v}-wrapper${v}-picture-circle-wrapper
    `]:Object.assign(Object.assign({},gf()),{display:"inline-block",width:"100%",[`${v}${v}-select`]:{width:Q,height:Q,marginInlineEnd:f.marginXS,marginBottom:f.marginXS,textAlign:"center",verticalAlign:"top",backgroundColor:f.colorFillAlter,border:`${pr(f.lineWidth)} dashed ${f.colorBorder}`,borderRadius:f.borderRadiusLG,cursor:"pointer",transition:`border-color ${f.motionDurationSlow}`,[`> ${v}`]:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",textAlign:"center"},[`&:not(${v}-disabled):hover`]:{borderColor:f.colorPrimary}},[`${O}${O}-picture-card, ${O}${O}-picture-circle`]:{[`${O}-item-container`]:{display:"inline-block",width:Q,height:Q,marginBlock:`0 ${pr(f.marginXS)}`,marginInline:`0 ${pr(f.marginXS)}`,verticalAlign:"top"},"&::after":{display:"none"},[a]:{height:"100%",margin:0,"&::before":{position:"absolute",zIndex:1,width:`calc(100% - ${pr(z(f.paddingXS).mul(2).equal())})`,height:`calc(100% - ${pr(z(f.paddingXS).mul(2).equal())})`,backgroundColor:f.colorBgMask,opacity:0,transition:`all ${f.motionDurationSlow}`,content:'" "'}},[`${a}:hover`]:{[`&::before, ${a}-actions`]:{opacity:1}},[`${a}-actions`]:{position:"absolute",insetInlineStart:0,zIndex:10,width:"100%",whiteSpace:"nowrap",textAlign:"center",opacity:0,transition:`all ${f.motionDurationSlow}`,[`
            ${w}-eye,
            ${w}-download,
            ${w}-delete
          `]:{zIndex:10,width:C,margin:`0 ${pr(f.marginXXS)}`,fontSize:C,cursor:"pointer",transition:`all ${f.motionDurationSlow}`,color:E,"&:hover":{color:E},svg:{verticalAlign:"baseline"}}},[`${a}-thumbnail, ${a}-thumbnail img`]:{position:"static",display:"block",width:"100%",height:"100%",objectFit:"contain"},[`${a}-name`]:{display:"none",textAlign:"center"},[`${a}-file + ${a}-name`]:{position:"absolute",bottom:f.margin,display:"block",width:`calc(100% - ${pr(z(f.paddingXS).mul(2).equal())})`},[`${a}-uploading`]:{[`&${a}`]:{backgroundColor:f.colorFillAlter},[`&::before, ${w}-eye, ${w}-download, ${w}-delete`]:{display:"none"}},[`${a}-progress`]:{bottom:f.marginXL,width:`calc(100% - ${pr(z(f.paddingXS).mul(2).equal())})`,paddingInlineStart:0}}}),[`${v}-wrapper${v}-picture-circle-wrapper`]:{[`${v}${v}-select`]:{borderRadius:"50%"}}}},Zy=f=>{const{componentCls:v}=f;return{[`${v}-rtl`]:{direction:"rtl"}}},Gy=f=>{const{componentCls:v,colorTextDisabled:w}=f;return{[`${v}-wrapper`]:Object.assign(Object.assign({},mh(f)),{[v]:{outline:0,"input[type='file']":{cursor:"pointer"}},[`${v}-select`]:{display:"inline-block"},[`${v}-disabled`]:{color:w,cursor:"not-allowed"}})}},Hy=f=>({actionsColor:f.colorTextDescription}),Wy=ph("Upload",f=>{const{fontSizeHeading3:v,fontHeight:w,lineWidth:C,controlHeightLG:E,calc:z}=f,O=fh(f,{uploadThumbnailSize:z(v).mul(2).equal(),uploadProgressOffset:z(z(w).div(2)).add(C).equal(),uploadPicCardSize:z(E).mul(2.55).equal()});return[Gy(O),$y(O),Uy(O),qy(O),jy(O),Vy(O),Zy(O),t_(O)]},Hy);var Xy={icon:function(v,w){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M534 352V136H232v752h560V394H576a42 42 0 01-42-42z",fill:w}},{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM602 137.8L790.2 326H602V137.8zM792 888H232V136h302v216a42 42 0 0042 42h216v494z",fill:v}}]}},name:"file",theme:"twotone"};const Ky=Xy;var Jy=function(v,w){return W.createElement(ja,Qr({},v,{ref:w,icon:Ky}))};const Yy=W.forwardRef(Jy);var Qy={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M779.3 196.6c-94.2-94.2-247.6-94.2-341.7 0l-261 260.8c-1.7 1.7-2.6 4-2.6 6.4s.9 4.7 2.6 6.4l36.9 36.9a9 9 0 0012.7 0l261-260.8c32.4-32.4 75.5-50.2 121.3-50.2s88.9 17.8 121.2 50.2c32.4 32.4 50.2 75.5 50.2 121.2 0 45.8-17.8 88.8-50.2 121.2l-266 265.9-43.1 43.1c-40.3 40.3-105.8 40.3-146.1 0-19.5-19.5-30.2-45.4-30.2-73s10.7-53.5 30.2-73l263.9-263.8c6.7-6.6 15.5-10.3 24.9-10.3h.1c9.4 0 18.1 3.7 24.7 10.3 6.7 6.7 10.3 15.5 10.3 24.9 0 9.3-3.7 18.1-10.3 24.7L372.4 653c-1.7 1.7-2.6 4-2.6 6.4s.9 4.7 2.6 6.4l36.9 36.9a9 9 0 0012.7 0l215.6-215.6c19.9-19.9 30.8-46.3 30.8-74.4s-11-54.6-30.8-74.4c-41.1-41.1-107.9-41-149 0L463 364 224.8 602.1A172.22 172.22 0 00174 724.8c0 46.3 18.1 89.8 50.8 122.5 33.9 33.8 78.3 50.7 122.7 50.7 44.4 0 88.8-16.9 122.6-50.7l309.2-309C824.8 492.7 850 432 850 367.5c.1-64.6-25.1-125.3-70.7-170.9z"}}]},name:"paper-clip",theme:"outlined"};const ev=Qy;var tv=function(v,w){return W.createElement(ja,Qr({},v,{ref:w,icon:ev}))};const iv=W.forwardRef(tv);var rv={icon:function(v,w){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 632H136v-39.9l138.5-164.3 150.1 178L658.1 489 888 761.6V792zm0-129.8L664.2 396.8c-3.2-3.8-9-3.8-12.2 0L424.6 666.4l-144-170.7c-3.2-3.8-9-3.8-12.2 0L136 652.7V232h752v430.2z",fill:v}},{tag:"path",attrs:{d:"M424.6 765.8l-150.1-178L136 752.1V792h752v-30.4L658.1 489z",fill:w}},{tag:"path",attrs:{d:"M136 652.7l132.4-157c3.2-3.8 9-3.8 12.2 0l144 170.7L652 396.8c3.2-3.8 9-3.8 12.2 0L888 662.2V232H136v420.7zM304 280a88 88 0 110 176 88 88 0 010-176z",fill:w}},{tag:"path",attrs:{d:"M276 368a28 28 0 1056 0 28 28 0 10-56 0z",fill:w}},{tag:"path",attrs:{d:"M304 456a88 88 0 100-176 88 88 0 000 176zm0-116c15.5 0 28 12.5 28 28s-12.5 28-28 28-28-12.5-28-28 12.5-28 28-28z",fill:v}}]}},name:"picture",theme:"twotone"};const nv=rv;var sv=function(v,w){return W.createElement(ja,Qr({},v,{ref:w,icon:nv}))};const av=W.forwardRef(sv);function hc(f){return Object.assign(Object.assign({},f),{lastModified:f.lastModified,lastModifiedDate:f.lastModifiedDate,name:f.name,size:f.size,type:f.type,uid:f.uid,percent:0,originFileObj:f})}function dc(f,v){const w=Yr(v),C=w.findIndex(E=>{let{uid:z}=E;return z===f.uid});return C===-1?w.push(f):w[C]=f,w}function $u(f,v){const w=f.uid!==void 0?"uid":"name";return v.filter(C=>C[w]===f[w])[0]}function ov(f,v){const w=f.uid!==void 0?"uid":"name",C=v.filter(E=>E[w]!==f[w]);return C.length===v.length?null:C}const lv=function(){const v=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:"").split("/"),C=v[v.length-1].split(/#|\?/)[0];return(/\.[^./\\]*$/.exec(C)||[""])[0]},Af=f=>f.indexOf("image/")===0,cv=f=>{if(f.type&&!f.thumbUrl)return Af(f.type);const v=f.thumbUrl||f.url||"",w=lv(v);return/^data:image\//.test(v)||/(webp|svg|png|gif|jpg|jpeg|jfif|bmp|dpg|ico|heic|heif)$/i.test(w)?!0:!(/^data:/.test(v)||w)},bs=200;function uv(f){return new Promise(v=>{if(!f.type||!Af(f.type)){v("");return}const w=document.createElement("canvas");w.width=bs,w.height=bs,w.style.cssText=`position: fixed; left: 0; top: 0; width: ${bs}px; height: ${bs}px; z-index: 9999; display: none;`,document.body.appendChild(w);const C=w.getContext("2d"),E=new Image;if(E.onload=()=>{const{width:z,height:O}=E;let a=bs,Q=bs,B=0,ae=0;z>O?(Q=O*(bs/z),ae=-(Q-a)/2):(a=z*(bs/O),B=-(a-Q)/2),C.drawImage(E,B,ae,a,Q);const oe=w.toDataURL();document.body.removeChild(w),window.URL.revokeObjectURL(E.src),v(oe)},E.crossOrigin="anonymous",f.type.startsWith("image/svg+xml")){const z=new FileReader;z.onload=()=>{z.result&&(E.src=z.result)},z.readAsDataURL(f)}else if(f.type.startsWith("image/gif")){const z=new FileReader;z.onload=()=>{z.result&&v(z.result)},z.readAsDataURL(f)}else E.src=window.URL.createObjectURL(f)})}var hv={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M505.7 661a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9h-74.1V168c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v338.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.8zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"download",theme:"outlined"};const dv=hv;var pv=function(v,w){return W.createElement(ja,Qr({},v,{ref:w,icon:dv}))};const fv=W.forwardRef(pv),mv=W.forwardRef((f,v)=>{let{prefixCls:w,className:C,style:E,locale:z,listType:O,file:a,items:Q,progress:B,iconRender:ae,actionIconRender:oe,itemRender:he,isImgUrl:we,showPreviewIcon:ke,showRemoveIcon:Ne,showDownloadIcon:Re,previewIcon:Fe,removeIcon:We,downloadIcon:Ue,onPreview:ye,onDownload:Ie,onClose:rt}=f;var et,Ze;const{status:at}=a,[Pe,it]=W.useState(at);W.useEffect(()=>{at!=="removed"&&it(at)},[at]);const[xt,At]=W.useState(!1);W.useEffect(()=>{const Rt=setTimeout(()=>{At(!0)},300);return()=>{clearTimeout(Rt)}},[]);const gt=ae(a);let Pt=W.createElement("div",{className:`${w}-icon`},gt);if(O==="picture"||O==="picture-card"||O==="picture-circle")if(Pe==="uploading"||!a.thumbUrl&&!a.url){const Rt=di(`${w}-list-item-thumbnail`,{[`${w}-list-item-file`]:Pe!=="uploading"});Pt=W.createElement("div",{className:Rt},gt)}else{const Rt=we?.(a)?W.createElement("img",{src:a.thumbUrl||a.url,alt:a.name,className:`${w}-list-item-image`,crossOrigin:a.crossOrigin}):gt,ki=di(`${w}-list-item-thumbnail`,{[`${w}-list-item-file`]:we&&!we(a)});Pt=W.createElement("a",{className:ki,onClick:bi=>ye(a,bi),href:a.url||a.thumbUrl,target:"_blank",rel:"noopener noreferrer"},Rt)}const Bt=di(`${w}-list-item`,`${w}-list-item-${Pe}`),ft=typeof a.linkProps=="string"?JSON.parse(a.linkProps):a.linkProps,ni=Ne?oe((typeof We=="function"?We(a):We)||W.createElement(Ef,null),()=>rt(a),w,z.removeFile,!0):null,Mi=Re&&Pe==="done"?oe((typeof Ue=="function"?Ue(a):Ue)||W.createElement(fv,null),()=>Ie(a),w,z.downloadFile):null,Xi=O!=="picture-card"&&O!=="picture-circle"&&W.createElement("span",{key:"download-delete",className:di(`${w}-list-item-actions`,{picture:O==="picture"})},Mi,ni),si=di(`${w}-list-item-name`),Xt=a.url?[W.createElement("a",Object.assign({key:"view",target:"_blank",rel:"noopener noreferrer",className:si,title:a.name},ft,{href:a.url,onClick:Rt=>ye(a,Rt)}),a.name),Xi]:[W.createElement("span",{key:"view",className:si,onClick:Rt=>ye(a,Rt),title:a.name},a.name),Xi],qe=ke&&(a.url||a.thumbUrl)?W.createElement("a",{href:a.url||a.thumbUrl,target:"_blank",rel:"noopener noreferrer",onClick:Rt=>ye(a,Rt),title:z.previewFile},typeof Fe=="function"?Fe(a):Fe||W.createElement(i_,null)):null,yt=(O==="picture-card"||O==="picture-circle")&&Pe!=="uploading"&&W.createElement("span",{className:`${w}-list-item-actions`},qe,Pe==="done"&&Mi,ni),{getPrefixCls:Kt}=W.useContext($a),Mt=Kt(),Jt=W.createElement("div",{className:Bt},Pt,Xt,yt,xt&&W.createElement(yf,{motionName:`${Mt}-fade`,visible:Pe==="uploading",motionDeadline:2e3},Rt=>{let{className:ki}=Rt;const bi="percent"in a?W.createElement(Ay,Object.assign({},B,{type:"line",percent:a.percent,"aria-label":a["aria-label"],"aria-labelledby":a["aria-labelledby"]})):null;return W.createElement("div",{className:di(`${w}-list-item-progress`,ki)},bi)})),gi=a.response&&typeof a.response=="string"?a.response:((et=a.error)===null||et===void 0?void 0:et.statusText)||((Ze=a.error)===null||Ze===void 0?void 0:Ze.message)||z.uploadError,Yt=Pe==="error"?W.createElement(hf,{title:gi,getPopupContainer:Rt=>Rt.parentNode},Jt):Jt;return W.createElement("div",{className:di(`${w}-list-item-container`,C),style:E,ref:v},he?he(Yt,a,Q,{download:Ie.bind(null,a),preview:ye.bind(null,a),remove:rt.bind(null,a)}):Yt)}),gv=mv,_v=(f,v)=>{const{listType:w="text",previewFile:C=uv,onPreview:E,onDownload:z,onRemove:O,locale:a,iconRender:Q,isImageUrl:B=cv,prefixCls:ae,items:oe=[],showPreviewIcon:he=!0,showRemoveIcon:we=!0,showDownloadIcon:ke=!1,removeIcon:Ne,previewIcon:Re,downloadIcon:Fe,progress:We={size:[-1,2],showInfo:!1},appendAction:Ue,appendActionVisible:ye=!0,itemRender:Ie,disabled:rt}=f,et=r_(),[Ze,at]=W.useState(!1);W.useEffect(()=>{w!=="picture"&&w!=="picture-card"&&w!=="picture-circle"||(oe||[]).forEach(qe=>{typeof document>"u"||typeof window>"u"||!window.FileReader||!window.File||!(qe.originFileObj instanceof File||qe.originFileObj instanceof Blob)||qe.thumbUrl!==void 0||(qe.thumbUrl="",C&&C(qe.originFileObj).then(yt=>{qe.thumbUrl=yt||"",et()}))})},[w,oe,C]),W.useEffect(()=>{at(!0)},[]);const Pe=(qe,yt)=>{if(E)return yt?.preventDefault(),E(qe)},it=qe=>{typeof z=="function"?z(qe):qe.url&&window.open(qe.url)},xt=qe=>{O?.(qe)},At=qe=>{if(Q)return Q(qe,w);const yt=qe.status==="uploading",Kt=B&&B(qe)?W.createElement(av,null):W.createElement(Yy,null);let Mt=yt?W.createElement(ah,null):W.createElement(iv,null);return w==="picture"?Mt=yt?W.createElement(ah,null):Kt:(w==="picture-card"||w==="picture-circle")&&(Mt=yt?a.uploading:Kt),Mt},gt=(qe,yt,Kt,Mt,Jt)=>{const gi={type:"text",size:"small",title:Mt,onClick:Yt=>{yt(),cp(qe)&&qe.props.onClick&&qe.props.onClick(Yt)},className:`${Kt}-list-item-action`};if(Jt&&(gi.disabled=rt),cp(qe)){const Yt=lp(qe,Object.assign(Object.assign({},qe.props),{onClick:()=>{}}));return W.createElement(Oa,Object.assign({},gi,{icon:Yt}))}return W.createElement(Oa,Object.assign({},gi),W.createElement("span",null,qe))};W.useImperativeHandle(v,()=>({handlePreview:Pe,handleDownload:it}));const{getPrefixCls:Pt}=W.useContext($a),Bt=Pt("upload",ae),ft=Pt(),ni=di(`${Bt}-list`,`${Bt}-list-${w}`),Mi=Yr(oe.map(qe=>({key:qe.uid,file:qe})));let si={motionDeadline:2e3,motionName:`${Bt}-${w==="picture-card"||w==="picture-circle"?"animate-inline":"animate"}`,keys:Mi,motionAppear:Ze};const Xt=W.useMemo(()=>{const qe=Object.assign({},n_(ft));return delete qe.onAppearEnd,delete qe.onEnterEnd,delete qe.onLeaveEnd,qe},[ft]);return w!=="picture-card"&&w!=="picture-circle"&&(si=Object.assign(Object.assign({},Xt),si)),W.createElement("div",{className:ni},W.createElement(af,Object.assign({},si,{component:!1}),qe=>{let{key:yt,file:Kt,className:Mt,style:Jt}=qe;return W.createElement(gv,{key:yt,locale:a,prefixCls:Bt,className:Mt,style:Jt,file:Kt,items:oe,progress:We,listType:w,isImgUrl:B,showPreviewIcon:he,showRemoveIcon:we,showDownloadIcon:ke,removeIcon:Ne,previewIcon:Re,downloadIcon:Fe,iconRender:At,actionIconRender:gt,itemRender:Ie,onPreview:Pe,onDownload:it,onClose:xt})}),Ue&&W.createElement(yf,Object.assign({},si,{visible:ye,forceRender:!0}),qe=>{let{className:yt,style:Kt}=qe;return lp(Ue,Mt=>({className:di(Mt.className,yt),style:Object.assign(Object.assign(Object.assign({},Kt),{pointerEvents:yt?"none":void 0}),Mt.style)}))}))},yv=W.forwardRef(_v),vv=yv;var xv=function(f,v,w,C){function E(z){return z instanceof w?z:new w(function(O){O(z)})}return new(w||(w=Promise))(function(z,O){function a(ae){try{B(C.next(ae))}catch(oe){O(oe)}}function Q(ae){try{B(C.throw(ae))}catch(oe){O(oe)}}function B(ae){ae.done?z(ae.value):E(ae.value).then(a,Q)}B((C=C.apply(f,v||[])).next())})};const Ko=`__LIST_IGNORE_${Date.now()}__`,bv=(f,v)=>{const{fileList:w,defaultFileList:C,onRemove:E,showUploadList:z=!0,listType:O="text",onPreview:a,onDownload:Q,onChange:B,onDrop:ae,previewFile:oe,disabled:he,locale:we,iconRender:ke,isImageUrl:Ne,progress:Re,prefixCls:Fe,className:We,type:Ue="select",children:ye,style:Ie,itemRender:rt,maxCount:et,data:Ze={},multiple:at=!1,hasControlInside:Pe=!0,action:it="",accept:xt="",supportServerRender:At=!0,rootClassName:gt}=f,Pt=W.useContext(s_),Bt=he??Pt,[ft,ni]=a_(C||[],{value:w,postState:mt=>mt??[]}),[Mi,Xi]=W.useState("drop"),si=W.useRef(null);W.useMemo(()=>{const mt=Date.now();(w||[]).forEach((dt,Ut)=>{!dt.uid&&!Object.isFrozen(dt)&&(dt.uid=`__AUTO__${mt}_${Ut}__`)})},[w]);const Xt=(mt,dt,Ut)=>{let wt=Yr(dt),Te=!1;et===1?wt=wt.slice(-1):et&&(Te=wt.length>et,wt=wt.slice(0,et)),Yo.flushSync(()=>{ni(wt)});const ot={file:mt,fileList:wt};Ut&&(ot.event=Ut),(!Te||wt.some(ct=>ct.uid===mt.uid))&&Yo.flushSync(()=>{B?.(ot)})},qe=(mt,dt)=>xv(void 0,void 0,void 0,function*(){const{beforeUpload:Ut,transformFile:wt}=f;let Te=mt;if(Ut){const ot=yield Ut(mt,dt);if(ot===!1)return!1;if(delete mt[Ko],ot===Ko)return Object.defineProperty(mt,Ko,{value:!0,configurable:!0}),!1;typeof ot=="object"&&ot&&(Te=ot)}return wt&&(Te=yield wt(Te)),Te}),yt=mt=>{const dt=mt.filter(Te=>!Te.file[Ko]);if(!dt.length)return;const Ut=dt.map(Te=>hc(Te.file));let wt=Yr(ft);Ut.forEach(Te=>{wt=dc(Te,wt)}),Ut.forEach((Te,ot)=>{let ct=Te;if(dt[ot].parsedFile)Te.status="uploading";else{const{originFileObj:_i}=Te;let ji;try{ji=new File([_i],_i.name,{type:_i.type})}catch{ji=new Blob([_i],{type:_i.type}),ji.name=_i.name,ji.lastModifiedDate=new Date,ji.lastModified=new Date().getTime()}ji.uid=Te.uid,ct=ji}Xt(ct,wt)})},Kt=(mt,dt,Ut)=>{try{typeof mt=="string"&&(mt=JSON.parse(mt))}catch{}if(!$u(dt,ft))return;const wt=hc(dt);wt.status="done",wt.percent=100,wt.response=mt,wt.xhr=Ut;const Te=dc(wt,ft);Xt(wt,Te)},Mt=(mt,dt)=>{if(!$u(dt,ft))return;const Ut=hc(dt);Ut.status="uploading",Ut.percent=mt.percent;const wt=dc(Ut,ft);Xt(Ut,wt,mt)},Jt=(mt,dt,Ut)=>{if(!$u(Ut,ft))return;const wt=hc(Ut);wt.error=mt,wt.response=dt,wt.status="error";const Te=dc(wt,ft);Xt(wt,Te)},gi=mt=>{let dt;Promise.resolve(typeof E=="function"?E(mt):E).then(Ut=>{var wt;if(Ut===!1)return;const Te=ov(mt,ft);Te&&(dt=Object.assign(Object.assign({},mt),{status:"removed"}),ft?.forEach(ot=>{const ct=dt.uid!==void 0?"uid":"name";ot[ct]===dt[ct]&&!Object.isFrozen(ot)&&(ot.status="removed")}),(wt=si.current)===null||wt===void 0||wt.abort(dt),Xt(dt,Te))})},Yt=mt=>{Xi(mt.type),mt.type==="drop"&&ae?.(mt)};W.useImperativeHandle(v,()=>({onBatchStart:yt,onSuccess:Kt,onProgress:Mt,onError:Jt,fileList:ft,upload:si.current}));const{getPrefixCls:Rt,direction:ki,upload:bi}=W.useContext($a),Wt=Rt("upload",Fe),Ti=Object.assign(Object.assign({onBatchStart:yt,onError:Jt,onProgress:Mt,onSuccess:Kt},f),{data:Ze,multiple:at,action:it,accept:xt,supportServerRender:At,prefixCls:Wt,disabled:Bt,beforeUpload:qe,onChange:void 0,hasControlInside:Pe});delete Ti.className,delete Ti.style,(!ye||Bt)&&delete Ti.id;const rr=`${Wt}-wrapper`,[fr,nr,mr]=Wy(Wt,rr),[Cr]=o_("Upload",l_.Upload),{showRemoveIcon:me,showPreviewIcon:Ii,showDownloadIcon:$i,removeIcon:jt,previewIcon:kt,downloadIcon:Ui}=typeof z=="boolean"?{}:z,Ki=typeof me>"u"?!Bt:!!me,sr=(mt,dt)=>z?W.createElement(vv,{prefixCls:Wt,listType:O,items:ft,previewFile:oe,onPreview:a,onDownload:Q,onRemove:gi,showRemoveIcon:Ki,showPreviewIcon:Ii,showDownloadIcon:$i,removeIcon:jt,previewIcon:kt,downloadIcon:Ui,iconRender:ke,locale:Object.assign(Object.assign({},Cr),we),isImageUrl:Ne,progress:Re,appendAction:mt,appendActionVisible:dt,itemRender:rt,disabled:Bt}):mt,Cn=di(rr,We,gt,nr,mr,bi?.className,{[`${Wt}-rtl`]:ki==="rtl",[`${Wt}-picture-card-wrapper`]:O==="picture-card",[`${Wt}-picture-circle-wrapper`]:O==="picture-circle"}),Tn=Object.assign(Object.assign({},bi?.style),Ie);if(Ue==="drag"){const mt=di(nr,Wt,`${Wt}-drag`,{[`${Wt}-drag-uploading`]:ft.some(dt=>dt.status==="uploading"),[`${Wt}-drag-hover`]:Mi==="dragover",[`${Wt}-disabled`]:Bt,[`${Wt}-rtl`]:ki==="rtl"});return fr(W.createElement("span",{className:Cn},W.createElement("div",{className:mt,style:Tn,onDrop:Yt,onDragOver:Yt,onDragLeave:Yt},W.createElement(uh,Object.assign({},Ti,{ref:si,className:`${Wt}-btn`}),W.createElement("div",{className:`${Wt}-drag-container`},ye))),sr()))}const en=di(Wt,`${Wt}-select`,{[`${Wt}-disabled`]:Bt}),ze=(mt=>W.createElement("div",{className:en,style:mt},W.createElement(uh,Object.assign({},Ti,{ref:si}))))(ye?void 0:{display:"none"});return fr(O==="picture-card"||O==="picture-circle"?W.createElement("span",{className:Cn},sr(ze,!!ye)):W.createElement("span",{className:Cn},ze,sr()))},wv=W.forwardRef(bv),Pf=wv;var Sv=function(f,v){var w={};for(var C in f)Object.prototype.hasOwnProperty.call(f,C)&&v.indexOf(C)<0&&(w[C]=f[C]);if(f!=null&&typeof Object.getOwnPropertySymbols=="function")for(var E=0,C=Object.getOwnPropertySymbols(f);E<C.length;E++)v.indexOf(C[E])<0&&Object.prototype.propertyIsEnumerable.call(f,C[E])&&(w[C[E]]=f[C[E]]);return w};const Cv=W.forwardRef((f,v)=>{var{style:w,height:C,hasControlInside:E=!1}=f,z=Sv(f,["style","height","hasControlInside"]);return W.createElement(Pf,Object.assign({ref:v,hasControlInside:E},z,{type:"drag",style:Object.assign(Object.assign({},w),{height:C})}))}),Tv=Cv,vh=Pf;vh.Dragger=Tv;vh.LIST_IGNORE=Ko;const Iv=vh;var Ev={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M885.2 446.3l-.2-.8-112.2-285.1c-5-16.1-19.9-27.2-36.8-27.2H281.2c-17 0-32.1 11.3-36.9 27.6L139.4 443l-.3.7-.2.8c-1.3 4.9-1.7 9.9-1 14.8-.1 1.6-.2 3.2-.2 4.8V830a60.9 60.9 0 0060.8 60.8h627.2c33.5 0 60.8-27.3 60.9-60.8V464.1c0-1.3 0-2.6-.1-3.7.4-4.9 0-9.6-1.3-14.1zm-295.8-43l-.3 15.7c-.8 44.9-31.8 75.1-77.1 75.1-22.1 0-41.1-7.1-54.8-20.6S436 441.2 435.6 419l-.3-15.7H229.5L309 210h399.2l81.7 193.3H589.4zm-375 76.8h157.3c24.3 57.1 76 90.8 140.4 90.8 33.7 0 65-9.4 90.3-27.2 22.2-15.6 39.5-37.4 50.7-63.6h156.5V814H214.4V480.1z"}}]},name:"inbox",theme:"outlined"};const Av=Ev;var Pv=function(v,w){return W.createElement(ja,Qr({},v,{ref:w,icon:Av}))};const Mv=W.forwardRef(Pv);function ju({children:f,className:v}){return _e.jsx(Xs,{gutter:38,className:"mt-3 first:mt-0 "+v,children:f})}const kv=[{label:"Hoạt động",value:"Active"},{label:"Khóa",value:"Lock"}],zv=[{label:"Thêm khách hàng",value:"add"},{label:"Chọn khách hàng",value:"Choose"},{label:"Import khách hàng",value:"Import"}],xh=[{title:"Mã khách hàng",dataIndex:"customer_code",key:"customercode"},{title:"Tên khách hàng",dataIndex:"customer_name",key:"customername"}],Mf=[{title:"Địa chỉ",dataIndex:"display_address",key:"display_address"},{title:"Số điện thoại",dataIndex:"phone_number",key:"phone_number"}],kf=[{customer_id:"431456",customer_name:"Chu Văn A",display_address:"CT1 Chung cư bộ công an",phone_number:"0123456789",frequency:"1;2;3;4;5"},{customer_id:"4314s56",customer_name:"Chu Văn A",display_address:"CT1 Chung cư bộ công an",phone_number:"0123456789",frequency:""}],Dv=[{label:"1",value:"1"},{label:"2",value:"2"},{label:"3",value:"3"},{label:"4",value:"4"},{label:"5",value:"5"}],Lv={customer_type:"Loại khách hàng",customer_group:"Nhóm khách hàng",city:"Tỉnh/Thành phố",district:"Quận/huyện",ward:"Phường/xã"},Rv=[{label:"Thứ 2",value:"Thứ 2"},{label:"Thứ 3",value:"Thứ 3"},{label:"Thứ 4",value:"Thứ 4"},{label:"Thứ 5",value:"Thứ 5"},{label:"Thứ 6",value:"Thứ 6"},{label:"Thứ 7",value:"Thứ 7"},{label:"Chủ nhật",value:"Chủ nhật"}];var bh={exports:{}},zf=function(v,w){return function(){for(var E=new Array(arguments.length),z=0;z<E.length;z++)E[z]=arguments[z];return v.apply(w,E)}},Fv=zf,Ts=Object.prototype.toString;function wh(f){return Array.isArray(f)}function hh(f){return typeof f>"u"}function Bv(f){return f!==null&&!hh(f)&&f.constructor!==null&&!hh(f.constructor)&&typeof f.constructor.isBuffer=="function"&&f.constructor.isBuffer(f)}function Df(f){return Ts.call(f)==="[object ArrayBuffer]"}function Ov(f){return Ts.call(f)==="[object FormData]"}function Nv(f){var v;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?v=ArrayBuffer.isView(f):v=f&&f.buffer&&Df(f.buffer),v}function $v(f){return typeof f=="string"}function jv(f){return typeof f=="number"}function Lf(f){return f!==null&&typeof f=="object"}function fc(f){if(Ts.call(f)!=="[object Object]")return!1;var v=Object.getPrototypeOf(f);return v===null||v===Object.prototype}function Vv(f){return Ts.call(f)==="[object Date]"}function Uv(f){return Ts.call(f)==="[object File]"}function qv(f){return Ts.call(f)==="[object Blob]"}function Rf(f){return Ts.call(f)==="[object Function]"}function Zv(f){return Lf(f)&&Rf(f.pipe)}function Gv(f){return Ts.call(f)==="[object URLSearchParams]"}function Hv(f){return f.trim?f.trim():f.replace(/^\s+|\s+$/g,"")}function Wv(){return typeof navigator<"u"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window<"u"&&typeof document<"u"}function Sh(f,v){if(!(f===null||typeof f>"u"))if(typeof f!="object"&&(f=[f]),wh(f))for(var w=0,C=f.length;w<C;w++)v.call(null,f[w],w,f);else for(var E in f)Object.prototype.hasOwnProperty.call(f,E)&&v.call(null,f[E],E,f)}function dh(){var f={};function v(E,z){fc(f[z])&&fc(E)?f[z]=dh(f[z],E):fc(E)?f[z]=dh({},E):wh(E)?f[z]=E.slice():f[z]=E}for(var w=0,C=arguments.length;w<C;w++)Sh(arguments[w],v);return f}function Xv(f,v,w){return Sh(v,function(E,z){w&&typeof E=="function"?f[z]=Fv(E,w):f[z]=E}),f}function Kv(f){return f.charCodeAt(0)===65279&&(f=f.slice(1)),f}var Zr={isArray:wh,isArrayBuffer:Df,isBuffer:Bv,isFormData:Ov,isArrayBufferView:Nv,isString:$v,isNumber:jv,isObject:Lf,isPlainObject:fc,isUndefined:hh,isDate:Vv,isFile:Uv,isBlob:qv,isFunction:Rf,isStream:Zv,isURLSearchParams:Gv,isStandardBrowserEnv:Wv,forEach:Sh,merge:dh,extend:Xv,trim:Hv,stripBOM:Kv},Fa=Zr;function Cp(f){return encodeURIComponent(f).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var Ff=function(v,w,C){if(!w)return v;var E;if(C)E=C(w);else if(Fa.isURLSearchParams(w))E=w.toString();else{var z=[];Fa.forEach(w,function(Q,B){Q===null||typeof Q>"u"||(Fa.isArray(Q)?B=B+"[]":Q=[Q],Fa.forEach(Q,function(oe){Fa.isDate(oe)?oe=oe.toISOString():Fa.isObject(oe)&&(oe=JSON.stringify(oe)),z.push(Cp(B)+"="+Cp(oe))}))}),E=z.join("&")}if(E){var O=v.indexOf("#");O!==-1&&(v=v.slice(0,O)),v+=(v.indexOf("?")===-1?"?":"&")+E}return v},Jv=Zr;function Cc(){this.handlers=[]}Cc.prototype.use=function(v,w,C){return this.handlers.push({fulfilled:v,rejected:w,synchronous:C?C.synchronous:!1,runWhen:C?C.runWhen:null}),this.handlers.length-1};Cc.prototype.eject=function(v){this.handlers[v]&&(this.handlers[v]=null)};Cc.prototype.forEach=function(v){Jv.forEach(this.handlers,function(C){C!==null&&v(C)})};var Yv=Cc,Qv=Zr,e0=function(v,w){Qv.forEach(v,function(E,z){z!==w&&z.toUpperCase()===w.toUpperCase()&&(v[w]=E,delete v[z])})},Bf=function(v,w,C,E,z){return v.config=w,C&&(v.code=C),v.request=E,v.response=z,v.isAxiosError=!0,v.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},v},Of={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Vu,Tp;function Nf(){if(Tp)return Vu;Tp=1;var f=Bf;return Vu=function(w,C,E,z,O){var a=new Error(w);return f(a,C,E,z,O)},Vu}var Uu,Ip;function t0(){if(Ip)return Uu;Ip=1;var f=Nf();return Uu=function(w,C,E){var z=E.config.validateStatus;!E.status||!z||z(E.status)?w(E):C(f("Request failed with status code "+E.status,E.config,null,E.request,E))},Uu}var qu,Ep;function i0(){if(Ep)return qu;Ep=1;var f=Zr;return qu=f.isStandardBrowserEnv()?function(){return{write:function(C,E,z,O,a,Q){var B=[];B.push(C+"="+encodeURIComponent(E)),f.isNumber(z)&&B.push("expires="+new Date(z).toGMTString()),f.isString(O)&&B.push("path="+O),f.isString(a)&&B.push("domain="+a),Q===!0&&B.push("secure"),document.cookie=B.join("; ")},read:function(C){var E=document.cookie.match(new RegExp("(^|;\\s*)("+C+")=([^;]*)"));return E?decodeURIComponent(E[3]):null},remove:function(C){this.write(C,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),qu}var Zu,Ap;function r0(){return Ap||(Ap=1,Zu=function(v){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(v)}),Zu}var Gu,Pp;function n0(){return Pp||(Pp=1,Gu=function(v,w){return w?v.replace(/\/+$/,"")+"/"+w.replace(/^\/+/,""):v}),Gu}var Hu,Mp;function s0(){if(Mp)return Hu;Mp=1;var f=r0(),v=n0();return Hu=function(C,E){return C&&!f(E)?v(C,E):E},Hu}var Wu,kp;function a0(){if(kp)return Wu;kp=1;var f=Zr,v=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return Wu=function(C){var E={},z,O,a;return C&&f.forEach(C.split(`
`),function(B){if(a=B.indexOf(":"),z=f.trim(B.substr(0,a)).toLowerCase(),O=f.trim(B.substr(a+1)),z){if(E[z]&&v.indexOf(z)>=0)return;z==="set-cookie"?E[z]=(E[z]?E[z]:[]).concat([O]):E[z]=E[z]?E[z]+", "+O:O}}),E},Wu}var Xu,zp;function o0(){if(zp)return Xu;zp=1;var f=Zr;return Xu=f.isStandardBrowserEnv()?function(){var w=/(msie|trident)/i.test(navigator.userAgent),C=document.createElement("a"),E;function z(O){var a=O;return w&&(C.setAttribute("href",a),a=C.href),C.setAttribute("href",a),{href:C.href,protocol:C.protocol?C.protocol.replace(/:$/,""):"",host:C.host,search:C.search?C.search.replace(/^\?/,""):"",hash:C.hash?C.hash.replace(/^#/,""):"",hostname:C.hostname,port:C.port,pathname:C.pathname.charAt(0)==="/"?C.pathname:"/"+C.pathname}}return E=z(window.location.href),function(a){var Q=f.isString(a)?z(a):a;return Q.protocol===E.protocol&&Q.host===E.host}}():function(){return function(){return!0}}(),Xu}var Ku,Dp;function Tc(){if(Dp)return Ku;Dp=1;function f(v){this.message=v}return f.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},f.prototype.__CANCEL__=!0,Ku=f,Ku}var Ju,Lp;function Rp(){if(Lp)return Ju;Lp=1;var f=Zr,v=t0(),w=i0(),C=Ff,E=s0(),z=a0(),O=o0(),a=Nf(),Q=Of,B=Tc();return Ju=function(oe){return new Promise(function(we,ke){var Ne=oe.data,Re=oe.headers,Fe=oe.responseType,We;function Ue(){oe.cancelToken&&oe.cancelToken.unsubscribe(We),oe.signal&&oe.signal.removeEventListener("abort",We)}f.isFormData(Ne)&&delete Re["Content-Type"];var ye=new XMLHttpRequest;if(oe.auth){var Ie=oe.auth.username||"",rt=oe.auth.password?unescape(encodeURIComponent(oe.auth.password)):"";Re.Authorization="Basic "+btoa(Ie+":"+rt)}var et=E(oe.baseURL,oe.url);ye.open(oe.method.toUpperCase(),C(et,oe.params,oe.paramsSerializer),!0),ye.timeout=oe.timeout;function Ze(){if(ye){var Pe="getAllResponseHeaders"in ye?z(ye.getAllResponseHeaders()):null,it=!Fe||Fe==="text"||Fe==="json"?ye.responseText:ye.response,xt={data:it,status:ye.status,statusText:ye.statusText,headers:Pe,config:oe,request:ye};v(function(gt){we(gt),Ue()},function(gt){ke(gt),Ue()},xt),ye=null}}if("onloadend"in ye?ye.onloadend=Ze:ye.onreadystatechange=function(){!ye||ye.readyState!==4||ye.status===0&&!(ye.responseURL&&ye.responseURL.indexOf("file:")===0)||setTimeout(Ze)},ye.onabort=function(){ye&&(ke(a("Request aborted",oe,"ECONNABORTED",ye)),ye=null)},ye.onerror=function(){ke(a("Network Error",oe,null,ye)),ye=null},ye.ontimeout=function(){var it=oe.timeout?"timeout of "+oe.timeout+"ms exceeded":"timeout exceeded",xt=oe.transitional||Q;oe.timeoutErrorMessage&&(it=oe.timeoutErrorMessage),ke(a(it,oe,xt.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",ye)),ye=null},f.isStandardBrowserEnv()){var at=(oe.withCredentials||O(et))&&oe.xsrfCookieName?w.read(oe.xsrfCookieName):void 0;at&&(Re[oe.xsrfHeaderName]=at)}"setRequestHeader"in ye&&f.forEach(Re,function(it,xt){typeof Ne>"u"&&xt.toLowerCase()==="content-type"?delete Re[xt]:ye.setRequestHeader(xt,it)}),f.isUndefined(oe.withCredentials)||(ye.withCredentials=!!oe.withCredentials),Fe&&Fe!=="json"&&(ye.responseType=oe.responseType),typeof oe.onDownloadProgress=="function"&&ye.addEventListener("progress",oe.onDownloadProgress),typeof oe.onUploadProgress=="function"&&ye.upload&&ye.upload.addEventListener("progress",oe.onUploadProgress),(oe.cancelToken||oe.signal)&&(We=function(Pe){ye&&(ke(!Pe||Pe&&Pe.type?new B("canceled"):Pe),ye.abort(),ye=null)},oe.cancelToken&&oe.cancelToken.subscribe(We),oe.signal&&(oe.signal.aborted?We():oe.signal.addEventListener("abort",We))),Ne||(Ne=null),ye.send(Ne)})},Ju}var dr=Zr,Fp=e0,l0=Bf,c0=Of,u0={"Content-Type":"application/x-www-form-urlencoded"};function Bp(f,v){!dr.isUndefined(f)&&dr.isUndefined(f["Content-Type"])&&(f["Content-Type"]=v)}function h0(){var f;return(typeof XMLHttpRequest<"u"||typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]")&&(f=Rp()),f}function d0(f,v,w){if(dr.isString(f))try{return(v||JSON.parse)(f),dr.trim(f)}catch(C){if(C.name!=="SyntaxError")throw C}return(w||JSON.stringify)(f)}var Ic={transitional:c0,adapter:h0(),transformRequest:[function(v,w){return Fp(w,"Accept"),Fp(w,"Content-Type"),dr.isFormData(v)||dr.isArrayBuffer(v)||dr.isBuffer(v)||dr.isStream(v)||dr.isFile(v)||dr.isBlob(v)?v:dr.isArrayBufferView(v)?v.buffer:dr.isURLSearchParams(v)?(Bp(w,"application/x-www-form-urlencoded;charset=utf-8"),v.toString()):dr.isObject(v)||w&&w["Content-Type"]==="application/json"?(Bp(w,"application/json"),d0(v)):v}],transformResponse:[function(v){var w=this.transitional||Ic.transitional,C=w&&w.silentJSONParsing,E=w&&w.forcedJSONParsing,z=!C&&this.responseType==="json";if(z||E&&dr.isString(v)&&v.length)try{return JSON.parse(v)}catch(O){if(z)throw O.name==="SyntaxError"?l0(O,this,"E_JSON_PARSE"):O}return v}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(v){return v>=200&&v<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};dr.forEach(["delete","get","head"],function(v){Ic.headers[v]={}});dr.forEach(["post","put","patch"],function(v){Ic.headers[v]=dr.merge(u0)});var Ch=Ic,p0=Zr,f0=Ch,m0=function(v,w,C){var E=this||f0;return p0.forEach(C,function(O){v=O.call(E,v,w)}),v},Yu,Op;function $f(){return Op||(Op=1,Yu=function(v){return!!(v&&v.__CANCEL__)}),Yu}var Np=Zr,Qu=m0,g0=$f(),_0=Ch,y0=Tc();function eh(f){if(f.cancelToken&&f.cancelToken.throwIfRequested(),f.signal&&f.signal.aborted)throw new y0("canceled")}var v0=function(v){eh(v),v.headers=v.headers||{},v.data=Qu.call(v,v.data,v.headers,v.transformRequest),v.headers=Np.merge(v.headers.common||{},v.headers[v.method]||{},v.headers),Np.forEach(["delete","get","head","post","put","patch","common"],function(E){delete v.headers[E]});var w=v.adapter||_0.adapter;return w(v).then(function(E){return eh(v),E.data=Qu.call(v,E.data,E.headers,v.transformResponse),E},function(E){return g0(E)||(eh(v),E&&E.response&&(E.response.data=Qu.call(v,E.response.data,E.response.headers,v.transformResponse))),Promise.reject(E)})},Kr=Zr,jf=function(v,w){w=w||{};var C={};function E(ae,oe){return Kr.isPlainObject(ae)&&Kr.isPlainObject(oe)?Kr.merge(ae,oe):Kr.isPlainObject(oe)?Kr.merge({},oe):Kr.isArray(oe)?oe.slice():oe}function z(ae){if(Kr.isUndefined(w[ae])){if(!Kr.isUndefined(v[ae]))return E(void 0,v[ae])}else return E(v[ae],w[ae])}function O(ae){if(!Kr.isUndefined(w[ae]))return E(void 0,w[ae])}function a(ae){if(Kr.isUndefined(w[ae])){if(!Kr.isUndefined(v[ae]))return E(void 0,v[ae])}else return E(void 0,w[ae])}function Q(ae){if(ae in w)return E(v[ae],w[ae]);if(ae in v)return E(void 0,v[ae])}var B={url:O,method:O,data:O,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:Q};return Kr.forEach(Object.keys(v).concat(Object.keys(w)),function(oe){var he=B[oe]||z,we=he(oe);Kr.isUndefined(we)&&he!==Q||(C[oe]=we)}),C},th,$p;function Vf(){return $p||($p=1,th={version:"0.26.1"}),th}var x0=Vf().version,Th={};["object","boolean","number","function","string","symbol"].forEach(function(f,v){Th[f]=function(C){return typeof C===f||"a"+(v<1?"n ":" ")+f}});var jp={};Th.transitional=function(v,w,C){function E(z,O){return"[Axios v"+x0+"] Transitional option '"+z+"'"+O+(C?". "+C:"")}return function(z,O,a){if(v===!1)throw new Error(E(O," has been removed"+(w?" in "+w:"")));return w&&!jp[O]&&(jp[O]=!0,console.warn(E(O," has been deprecated since v"+w+" and will be removed in the near future"))),v?v(z,O,a):!0}};function b0(f,v,w){if(typeof f!="object")throw new TypeError("options must be an object");for(var C=Object.keys(f),E=C.length;E-- >0;){var z=C[E],O=v[z];if(O){var a=f[z],Q=a===void 0||O(a,z,f);if(Q!==!0)throw new TypeError("option "+z+" must be "+Q);continue}if(w!==!0)throw Error("Unknown option "+z)}}var w0={assertOptions:b0,validators:Th},Uf=Zr,S0=Ff,Vp=Yv,Up=v0,Ec=jf,qf=w0,Ba=qf.validators;function tl(f){this.defaults=f,this.interceptors={request:new Vp,response:new Vp}}tl.prototype.request=function(v,w){typeof v=="string"?(w=w||{},w.url=v):w=v||{},w=Ec(this.defaults,w),w.method?w.method=w.method.toLowerCase():this.defaults.method?w.method=this.defaults.method.toLowerCase():w.method="get";var C=w.transitional;C!==void 0&&qf.assertOptions(C,{silentJSONParsing:Ba.transitional(Ba.boolean),forcedJSONParsing:Ba.transitional(Ba.boolean),clarifyTimeoutError:Ba.transitional(Ba.boolean)},!1);var E=[],z=!0;this.interceptors.request.forEach(function(we){typeof we.runWhen=="function"&&we.runWhen(w)===!1||(z=z&&we.synchronous,E.unshift(we.fulfilled,we.rejected))});var O=[];this.interceptors.response.forEach(function(we){O.push(we.fulfilled,we.rejected)});var a;if(!z){var Q=[Up,void 0];for(Array.prototype.unshift.apply(Q,E),Q=Q.concat(O),a=Promise.resolve(w);Q.length;)a=a.then(Q.shift(),Q.shift());return a}for(var B=w;E.length;){var ae=E.shift(),oe=E.shift();try{B=ae(B)}catch(he){oe(he);break}}try{a=Up(B)}catch(he){return Promise.reject(he)}for(;O.length;)a=a.then(O.shift(),O.shift());return a};tl.prototype.getUri=function(v){return v=Ec(this.defaults,v),S0(v.url,v.params,v.paramsSerializer).replace(/^\?/,"")};Uf.forEach(["delete","get","head","options"],function(v){tl.prototype[v]=function(w,C){return this.request(Ec(C||{},{method:v,url:w,data:(C||{}).data}))}});Uf.forEach(["post","put","patch"],function(v){tl.prototype[v]=function(w,C,E){return this.request(Ec(E||{},{method:v,url:w,data:C}))}});var C0=tl,ih,qp;function T0(){if(qp)return ih;qp=1;var f=Tc();function v(w){if(typeof w!="function")throw new TypeError("executor must be a function.");var C;this.promise=new Promise(function(O){C=O});var E=this;this.promise.then(function(z){if(E._listeners){var O,a=E._listeners.length;for(O=0;O<a;O++)E._listeners[O](z);E._listeners=null}}),this.promise.then=function(z){var O,a=new Promise(function(Q){E.subscribe(Q),O=Q}).then(z);return a.cancel=function(){E.unsubscribe(O)},a},w(function(O){E.reason||(E.reason=new f(O),C(E.reason))})}return v.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},v.prototype.subscribe=function(C){if(this.reason){C(this.reason);return}this._listeners?this._listeners.push(C):this._listeners=[C]},v.prototype.unsubscribe=function(C){if(this._listeners){var E=this._listeners.indexOf(C);E!==-1&&this._listeners.splice(E,1)}},v.source=function(){var C,E=new v(function(O){C=O});return{token:E,cancel:C}},ih=v,ih}var rh,Zp;function I0(){return Zp||(Zp=1,rh=function(v){return function(C){return v.apply(null,C)}}),rh}var nh,Gp;function E0(){if(Gp)return nh;Gp=1;var f=Zr;return nh=function(w){return f.isObject(w)&&w.isAxiosError===!0},nh}var Hp=Zr,A0=zf,mc=C0,P0=jf,M0=Ch;function Zf(f){var v=new mc(f),w=A0(mc.prototype.request,v);return Hp.extend(w,mc.prototype,v),Hp.extend(w,v),w.create=function(E){return Zf(P0(f,E))},w}var Bn=Zf(M0);Bn.Axios=mc;Bn.Cancel=Tc();Bn.CancelToken=T0();Bn.isCancel=$f();Bn.VERSION=Vf().version;Bn.all=function(v){return Promise.all(v)};Bn.spread=I0();Bn.isAxiosError=E0();bh.exports=Bn;bh.exports.default=Bn;var k0=bh.exports,z0=k0;const Gf=vf(z0);var Jo={VITE_BASE_PATH:"/mbw_desk",VITE_KEY_MAP:"wtpM0U1ZmE2s87LEZNSHf63Osc1a2sboaozCQNsy",BASE_URL:"/assets/mbw_dms/mbw_fe/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};let Sn=Gf;console.log(Jo.VITE_BASE_URL);Jo.VITE_BASE_URL&&(console.log("vao day"),Sn=Gf.create({baseURL:Jo.VITE_BASE_URL}),Sn.interceptors.request.use(function(f){const v=`Basic ${btoa(`${Jo.VITE_AUTH_KEY}:${Jo.VITE_AUTH_SECRET}`)}`;return f.headers.Authorization=v,f},function(f){return Promise.reject(f)}));Sn.interceptors.response.use(function(f){return console.log("response",f),f.data},function(f){return Promise.reject(f)});let pc;const D0=(f,v)=>{console.log(f),pc&&(clearTimeout(pc),pc=null),f?pc=setTimeout(()=>{v(f)},300):v("")};function L0(){const[f,v]=W.useState(""),[w,C]=W.useState([]),[E,z]=W.useState([]);W.useEffect(()=>{(async()=>{let a=await Sn.get("/api/method/mbw_dms.api.router.get_team_sale");C(a.result.map(Q=>({label:Q,value:Q})))})()},[]),W.useEffect(()=>{(async()=>{let a=await Sn.get("/api/method/frappe.desk.search.search_link",{params:{txt:f,doctype:"Employee",ignore_user_permissions:0,reference_doctype:"Attendance",query:"erpnext.controllers.queries.employee_query"}}),{results:Q}=a;z(Q.map(B=>({value:B.value,label:B.description})))})()},[f]),console.log("listEmployees",E);const O=a=>{D0(a,v)};return _e.jsxs("div",{className:"p-4 pt-[43px] pb-[58px]",children:[_e.jsxs(ju,{children:[_e.jsx(Rr,{span:12,children:_e.jsx(qr,{label:"Mã tuyến",name:"channel_code",required:!0,children:_e.jsx(gc,{})})}),_e.jsx(Rr,{span:12,children:_e.jsx(qr,{label:"Tên tuyến",name:"channel_name",required:!0,children:_e.jsx(gc,{})})})]}),_e.jsxs(ju,{children:[_e.jsx(Rr,{span:12,children:_e.jsx(qr,{label:"Team sale",name:"team_sale",required:!0,children:_e.jsx(wn,{showSearch:!0,options:w,defaultActiveFirstOption:!1})})}),_e.jsx(Rr,{span:12,children:_e.jsx(qr,{label:"Nhân viên",name:"employee",required:!0,children:_e.jsx(wn,{showSearch:!0,notFoundContent:null,onSearch:O,options:E})})})]}),_e.jsxs(ju,{children:[_e.jsx(Rr,{span:12,children:_e.jsx(qr,{label:"Ngày đi tuyến",name:"travel_date",required:!0,children:_e.jsx(wn,{options:Rv})})}),_e.jsx(Rr,{span:12,children:_e.jsx(qr,{label:"Trạng thái",name:"status",children:_e.jsx(wn,{options:kv,defaultValue:"Active"})})})]})]})}const R0=({size:f=20})=>_e.jsx("svg",{width:f,height:f,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:_e.jsx("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M11.0267 1.13334C11.5534 0.501676 12.5792 0.933342 12.4959 1.75168L11.9076 7.50001H16.6667C16.8251 7.50007 16.9801 7.54524 17.1137 7.63024C17.2473 7.71523 17.3539 7.83653 17.4211 7.97993C17.4882 8.12333 17.5132 8.2829 17.4929 8.43994C17.4726 8.59698 17.4081 8.74501 17.3067 8.86668L8.97339 18.8667C8.44672 19.4983 7.42089 19.0667 7.50422 18.2483L8.09255 12.5H3.33339C3.17504 12.4999 3.01999 12.4548 2.88639 12.3698C2.75279 12.2848 2.64617 12.1635 2.57902 12.0201C2.51187 11.8767 2.48696 11.7171 2.50721 11.5601C2.52747 11.403 2.59205 11.255 2.69339 11.1333L11.0267 1.13334Z",fill:"currentColor"})}),F0=({size:f=20})=>_e.jsxs("svg",{width:f,height:f,viewBox:"0 0 28 28",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[_e.jsx("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M9.83847 8.58794C10.1411 8.46187 10.4827 8.4689 10.7798 8.60732L15.0763 10.6088C15.6604 10.8809 15.9133 11.5749 15.6412 12.159C15.3691 12.7431 14.6751 12.996 14.091 12.7239L11.4888 11.5117L11.653 20.2421L15.7503 22.1045V15.7497C15.7503 15.1053 16.2727 14.583 16.917 14.583C17.5613 14.583 18.0837 15.1053 18.0837 15.7497V22.1663L22.7503 20.2219V13.4163C22.7503 12.772 23.2727 12.2497 23.917 12.2497C24.5613 12.2497 25.0837 12.772 25.0837 13.4163V20.9997C25.0837 21.4707 24.8005 21.8955 24.3657 22.0766L17.3657 24.9933C17.0666 25.1179 16.7292 25.1125 16.4342 24.9784L10.5003 22.2812L4.56643 24.9784C4.20532 25.1426 3.78555 25.112 3.45204 24.8972C3.11854 24.6825 2.91699 24.313 2.91699 23.9163V12.2497C2.91699 11.7787 3.20019 11.3539 3.63494 11.1728L9.83847 8.58794ZM9.31945 20.2549L9.15297 11.4013L5.25033 13.0275V22.1045L9.31945 20.2549Z",fill:"currentColor"}),_e.jsx("path",{d:"M19.8337 8.61425C20.478 8.61425 21.0003 8.09192 21.0003 7.44759C21.0003 6.80326 20.478 6.28092 19.8337 6.28092C19.1893 6.28092 18.667 6.80326 18.667 7.44759C18.667 8.09192 19.1893 8.61425 19.8337 8.61425Z",fill:"currentColor"}),_e.jsx("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M19.8337 2.33301C17.2197 2.33301 15.167 4.52385 15.167 7.1293C15.167 7.85019 15.4274 8.59094 15.7195 9.21916C16.0229 9.8717 16.4198 10.5259 16.8094 11.1056C17.5898 12.2664 18.4067 13.2245 18.579 13.4238L18.5825 13.4278C18.89 13.7803 19.3411 13.9997 19.8337 13.9997C20.3262 13.9997 20.7773 13.7803 21.0848 13.4278L21.0883 13.4238C21.2606 13.2245 22.0776 12.2664 22.8579 11.1056C23.2476 10.5259 23.6444 9.8717 23.9478 9.21916C24.2399 8.59094 24.5003 7.85019 24.5003 7.1293C24.5003 4.52385 22.4476 2.33301 19.8337 2.33301ZM17.5003 7.1293C17.5003 5.7318 18.5876 4.66634 19.8337 4.66634C21.0797 4.66634 22.167 5.7318 22.167 7.1293C22.167 7.33968 22.0764 7.70972 21.832 8.23544C21.5989 8.73683 21.2738 9.2797 20.9214 9.80382C20.5368 10.376 20.1392 10.8972 19.8337 11.2802C19.5281 10.8972 19.1305 10.376 18.7459 9.80382C18.3936 9.2797 18.0684 8.73683 17.8353 8.23544C17.5909 7.70972 17.5003 7.33968 17.5003 7.1293Z",fill:"currentColor"})]}),B0=({size:f=20,fill:v="#1877F2"})=>_e.jsx("svg",{width:f,height:f,viewBox:"0 0 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:_e.jsx("path",{d:"M23.1875 5.25H10.9375C10.6094 5.25 10.3314 5.36393 10.1035 5.5918C9.87565 5.81966 9.76172 6.09766 9.76172 6.42578C9.76172 6.73568 9.87565 7.00456 10.1035 7.23242C10.3314 7.46029 10.6094 7.57422 10.9375 7.57422H23.1875C23.4974 7.57422 23.7663 7.46029 23.9941 7.23242C24.222 7.00456 24.3359 6.73568 24.3359 6.42578C24.3359 6.09766 24.222 5.81966 23.9941 5.5918C23.7663 5.36393 23.4974 5.25 23.1875 5.25ZM23.1875 12.25H10.9375C10.6094 12.25 10.3314 12.3639 10.1035 12.5918C9.87565 12.8197 9.76172 13.0977 9.76172 13.4258C9.76172 13.7357 9.87565 14.0046 10.1035 14.2324C10.3314 14.4603 10.6094 14.5742 10.9375 14.5742H23.1875C23.4974 14.5742 23.7663 14.4603 23.9941 14.2324C24.222 14.0046 24.3359 13.7357 24.3359 13.4258C24.3359 13.0977 24.222 12.8197 23.9941 12.5918C23.7663 12.3639 23.4974 12.25 23.1875 12.25ZM23.1875 19.25H10.9375C10.6094 19.25 10.3314 19.3639 10.1035 19.5918C9.87565 19.8197 9.76172 20.0977 9.76172 20.4258C9.76172 20.7357 9.87565 21.0046 10.1035 21.2324C10.3314 21.4603 10.6094 21.5742 10.9375 21.5742H23.1875C23.4974 21.5742 23.7663 21.4603 23.9941 21.2324C24.222 21.0046 24.3359 20.7357 24.3359 20.4258C24.3359 20.0977 24.222 19.8197 23.9941 19.5918C23.7663 19.3639 23.4974 19.25 23.1875 19.25ZM5.25 18.6758C5.72396 18.6758 6.13411 18.8444 6.48047 19.1816C6.82682 19.5189 7 19.9336 7 20.4258C7 20.8997 6.82682 21.3099 6.48047 21.6562C6.13411 22.0026 5.72396 22.1758 5.25 22.1758C4.75781 22.1758 4.3431 22.0026 4.00586 21.6562C3.66862 21.3099 3.5 20.8997 3.5 20.4258C3.5 19.9336 3.66862 19.5189 4.00586 19.1816C4.3431 18.8444 4.75781 18.6758 5.25 18.6758ZM5.25 15.1758C4.75781 15.1758 4.3431 15.0026 4.00586 14.6562C3.66862 14.3099 3.5 13.8997 3.5 13.4258C3.5 12.9336 3.66862 12.5189 4.00586 12.1816C4.3431 11.8444 4.75781 11.6758 5.25 11.6758C5.72396 11.6758 6.13411 11.8444 6.48047 12.1816C6.82682 12.5189 7 12.9336 7 13.4258C7 13.8997 6.82682 14.3099 6.48047 14.6562C6.13411 15.0026 5.72396 15.1758 5.25 15.1758ZM5.25 8.17578C4.75781 8.17578 4.3431 8.0026 4.00586 7.65625C3.66862 7.3099 3.5 6.89974 3.5 6.42578C3.5 5.93359 3.66862 5.51888 4.00586 5.18164C4.3431 4.8444 4.75781 4.67578 5.25 4.67578C5.72396 4.67578 6.13411 4.8444 6.48047 5.18164C6.82682 5.51888 7 5.93359 7 6.42578C7 6.89974 6.82682 7.3099 6.48047 7.65625C6.13411 8.0026 5.72396 8.17578 5.25 8.17578Z",fill:"currentColor"})});function O0({data:f,handleData:v}){const w=[{title:"Stt",dataIndex:"stt",key:"stt",render:(C,E,z)=>z+1},...xh,...Mf,{title:"Tần suất",dataIndex:"frequency",key:"frequency",render:(C,E)=>_e.jsx(wn,{mode:"multiple",options:Dv,style:{width:"100%"},placeholder:"Chọn tần suất",onChange:z=>{v(O=>O.map(a=>(a.customer_id==E.customer_id&&(a.frequency=z.toString().replaceAll(",",";")),a)))},defaultValue:C?C.split(";"):[]})},{title:"Hành động",dataIndex:"",key:"action",render:(C,E)=>_e.jsx("div",{className:"flex justify-center",onClick:()=>{v(z=>[...z.filter(O=>O.customer_id!=E.customer_id)])},children:_e.jsx(Ef,{})})}];return _e.jsx("div",{className:"p-4",children:_e.jsx(_h,{columns:w,dataSource:f,pagination:!1})})}const N0=W.createContext(null);function $0(f,v){const w=Array.isArray(f)?f[0]:f?f.x:0,C=Array.isArray(f)?f[1]:f?f.y:0,E=Array.isArray(v)?v[0]:v?v.x:0,z=Array.isArray(v)?v[1]:v?v.y:0;return w===E&&C===z}function Fn(f,v){if(f===v)return!0;if(!f||!v)return!1;if(Array.isArray(f)){if(!Array.isArray(v)||f.length!==v.length)return!1;for(let w=0;w<f.length;w++)if(!Fn(f[w],v[w]))return!1;return!0}else if(Array.isArray(v))return!1;if(typeof f=="object"&&typeof v=="object"){const w=Object.keys(f),C=Object.keys(v);if(w.length!==C.length)return!1;for(const E of w)if(!v.hasOwnProperty(E)||!Fn(f[E],v[E]))return!1;return!0}return!1}function j0(f){const v=f.clone();return v.pixelsToGLUnits=f.pixelsToGLUnits,v}function Wp(f,v){if(!f.getProjection)return;const w=f.getProjection(),C=v.getProjection();Fn(w,C)||v.setProjection(w)}function Xp(f){return{longitude:f.center.lng,latitude:f.center.lat,zoom:f.zoom,pitch:f.pitch,bearing:f.bearing,padding:f.padding}}function Kp(f,v){const w=v.viewState||v;let C=!1;if("longitude"in w&&"latitude"in w){const E=f.center;f.center=new E.constructor(w.longitude,w.latitude),C=C||E!==f.center}if("zoom"in w){const E=f.zoom;f.zoom=w.zoom,C=C||E!==f.zoom}if("bearing"in w){const E=f.bearing;f.bearing=w.bearing,C=C||E!==f.bearing}if("pitch"in w){const E=f.pitch;f.pitch=w.pitch,C=C||E!==f.pitch}return w.padding&&!f.isPaddingEqual(w.padding)&&(C=!0,f.padding=w.padding),C}const V0=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Jp(f){if(!f)return null;if(typeof f=="string"||("toJS"in f&&(f=f.toJS()),!f.layers))return f;const v={};for(const C of f.layers)v[C.id]=C;const w=f.layers.map(C=>{let E=null;"interactive"in C&&(E=Object.assign({},C),delete E.interactive);const z=v[C.ref];if(z){E=E||Object.assign({},C),delete E.ref;for(const O of V0)O in z&&(E[O]=z[O])}return E||C});return{...f,layers:w}}var Yp={};const Qp={version:8,sources:{},layers:[]},ef={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},sh={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},tf={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},U0=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],q0=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class Na{constructor(v,w,C){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=E=>{const z=this.props[tf[E.type]];z?z(E):E.type==="error"&&console.error(E.error)},this._onPointerEvent=E=>{(E.type==="mousemove"||E.type==="mouseout")&&this._updateHover(E);const z=this.props[ef[E.type]];z&&(this.props.interactiveLayerIds&&E.type!=="mouseover"&&E.type!=="mouseout"&&(E.features=this._hoveredFeatures||this._queryRenderedFeatures(E.point)),z(E),delete E.features)},this._onCameraEvent=E=>{if(!this._internalUpdate){const z=this.props[sh[E.type]];z&&z(E)}E.type in this._deferredEvents&&(this._deferredEvents[E.type]=!1)},this._MapClass=v,this.props=w,this._initialize(C)}get map(){return this._map}get transform(){return this._renderTransform}setProps(v){const w=this.props;this.props=v;const C=this._updateSettings(v,w);C&&this._createShadowTransform(this._map);const E=this._updateSize(v),z=this._updateViewState(v,!0);this._updateStyle(v,w),this._updateStyleComponents(v,w),this._updateHandlers(v,w),(C||E||z&&!this._map.isMoving())&&this.redraw()}static reuse(v,w){const C=Na.savedMaps.pop();if(!C)return null;const E=C.map,z=E.getContainer();for(w.className=z.className;z.childNodes.length>0;)w.appendChild(z.childNodes[0]);E._container=w;const O=E._resizeObserver;O&&(O.disconnect(),O.observe(w)),C.setProps({...v,styleDiffing:!1}),E.resize();const{initialViewState:a}=v;return a&&(a.bounds?E.fitBounds(a.bounds,{...a.fitBoundsOptions,duration:0}):C._updateViewState(a,!1)),E.isStyleLoaded()?E.fire("load"):E.once("styledata",()=>E.fire("load")),E._update(),C}_initialize(v){const{props:w}=this,{mapStyle:C=Qp}=w,E={...w,...w.initialViewState,accessToken:w.mapboxAccessToken||Z0()||null,container:v,style:Jp(C)},z=E.initialViewState||E.viewState||E;if(Object.assign(E,{center:[z.longitude||0,z.latitude||0],zoom:z.zoom||0,pitch:z.pitch||0,bearing:z.bearing||0}),w.gl){const ae=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=ae,w.gl)}const O=new this._MapClass(E);z.padding&&O.setPadding(z.padding),w.cursor&&(O.getCanvas().style.cursor=w.cursor),this._createShadowTransform(O);const a=O._render;O._render=ae=>{this._inRender=!0,a.call(O,ae),this._inRender=!1};const Q=O._renderTaskQueue.run;O._renderTaskQueue.run=ae=>{Q.call(O._renderTaskQueue,ae),this._onBeforeRepaint()},O.on("render",()=>this._onAfterRepaint());const B=O.fire;O.fire=this._fireEvent.bind(this,B),O.on("resize",()=>{this._renderTransform.resize(O.transform.width,O.transform.height)}),O.on("styledata",()=>{this._updateStyleComponents(this.props,{}),Wp(O.transform,this._renderTransform)}),O.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const ae in ef)O.on(ae,this._onPointerEvent);for(const ae in sh)O.on(ae,this._onCameraEvent);for(const ae in tf)O.on(ae,this._onEvent);this._map=O}recycle(){const w=this.map.getContainer().querySelector("[mapboxgl-children]");w?.remove(),Na.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const v=this._map;!this._inRender&&v.style&&(v._frame&&(v._frame.cancel(),v._frame=null),v._render())}_createShadowTransform(v){const w=j0(v.transform);v.painter.transform=w,this._renderTransform=w}_updateSize(v){const{viewState:w}=v;if(w){const C=this._map;if(w.width!==C.transform.width||w.height!==C.transform.height)return C.resize(),!0}return!1}_updateViewState(v,w){if(this._internalUpdate)return!1;const C=this._map,E=this._renderTransform,{zoom:z,pitch:O,bearing:a}=E,Q=C.isMoving();Q&&(E.cameraElevationReference="sea");const B=Kp(E,{...Xp(C.transform),...v});if(Q&&(E.cameraElevationReference="ground"),B&&w){const ae=this._deferredEvents;ae.move=!0,ae.zoom||(ae.zoom=z!==E.zoom),ae.rotate||(ae.rotate=a!==E.bearing),ae.pitch||(ae.pitch=O!==E.pitch)}return Q||Kp(C.transform,v),B}_updateSettings(v,w){const C=this._map;let E=!1;for(const z of U0)if(z in v&&!Fn(v[z],w[z])){E=!0;const O=C[`set${z[0].toUpperCase()}${z.slice(1)}`];O?.call(C,v[z])}return E}_updateStyle(v,w){if(v.cursor!==w.cursor&&(this._map.getCanvas().style.cursor=v.cursor||""),v.mapStyle!==w.mapStyle){const{mapStyle:C=Qp,styleDiffing:E=!0}=v,z={diff:E};return"localIdeographFontFamily"in v&&(z.localIdeographFontFamily=v.localIdeographFontFamily),this._map.setStyle(Jp(C),z),!0}return!1}_updateStyleComponents(v,w){const C=this._map;let E=!1;return C.isStyleLoaded()&&("light"in v&&C.setLight&&!Fn(v.light,w.light)&&(E=!0,C.setLight(v.light)),"fog"in v&&C.setFog&&!Fn(v.fog,w.fog)&&(E=!0,C.setFog(v.fog)),"terrain"in v&&C.setTerrain&&!Fn(v.terrain,w.terrain)&&(!v.terrain||C.getSource(v.terrain.source))&&(E=!0,C.setTerrain(v.terrain))),E}_updateHandlers(v,w){var C,E;const z=this._map;let O=!1;for(const a of q0){const Q=(C=v[a])!==null&&C!==void 0?C:!0,B=(E=w[a])!==null&&E!==void 0?E:!0;Fn(Q,B)||(O=!0,Q?z[a].enable(Q):z[a].disable())}return O}_queryRenderedFeatures(v){const w=this._map,C=w.transform,{interactiveLayerIds:E=[]}=this.props;try{return w.transform=this._renderTransform,w.queryRenderedFeatures(v,{layers:E.filter(w.getLayer.bind(w))})}catch{return[]}finally{w.transform=C}}_updateHover(v){var w;const{props:C}=this;if(C.interactiveLayerIds&&(C.onMouseMove||C.onMouseEnter||C.onMouseLeave)){const z=v.type,O=((w=this._hoveredFeatures)===null||w===void 0?void 0:w.length)>0,a=this._queryRenderedFeatures(v.point),Q=a.length>0;!Q&&O&&(v.type="mouseleave",this._onPointerEvent(v)),this._hoveredFeatures=a,Q&&!O&&(v.type="mouseenter",this._onPointerEvent(v)),v.type=z}else this._hoveredFeatures=null}_fireEvent(v,w,C){const E=this._map,z=E.transform,O=typeof w=="string"?w:w.type;return O==="move"&&this._updateViewState(this.props,!1),O in sh&&(typeof w=="object"&&(w.viewState=Xp(z)),this._map.isMoving())?(E.transform=this._renderTransform,v.call(E,w,C),E.transform=z,E):(v.call(E,w,C),E)}_onBeforeRepaint(){const v=this._map;this._internalUpdate=!0;for(const C in this._deferredEvents)this._deferredEvents[C]&&v.fire(C);this._internalUpdate=!1;const w=this._map.transform;v.transform=this._renderTransform,this._onAfterRepaint=()=>{Wp(this._renderTransform,w),v.transform=w}}}Na.savedMaps=[];function Z0(){let f=null;if(typeof location<"u"){const v=/access_token=([^&\/]*)/.exec(location.search);f=v&&v[1]}try{f=f||Yp.MapboxAccessToken}catch{}try{f=f||Yp.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return f}const G0=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function H0(f){if(!f)return null;const v=f.map,w={getMap:()=>v,getCenter:()=>f.transform.center,getZoom:()=>f.transform.zoom,getBearing:()=>f.transform.bearing,getPitch:()=>f.transform.pitch,getPadding:()=>f.transform.padding,getBounds:()=>f.transform.getBounds(),project:C=>{const E=v.transform;v.transform=f.transform;const z=v.project(C);return v.transform=E,z},unproject:C=>{const E=v.transform;v.transform=f.transform;const z=v.unproject(C);return v.transform=E,z},queryTerrainElevation:(C,E)=>{const z=v.transform;v.transform=f.transform;const O=v.queryTerrainElevation(C,E);return v.transform=z,O},queryRenderedFeatures:(C,E)=>{const z=v.transform;v.transform=f.transform;const O=v.queryRenderedFeatures(C,E);return v.transform=z,O}};for(const C of W0(v))!(C in w)&&!G0.includes(C)&&(w[C]=v[C].bind(v));return w}function W0(f){const v=new Set;let w=f;for(;w;){for(const C of Object.getOwnPropertyNames(w))C[0]!=="_"&&typeof f[C]=="function"&&C!=="fire"&&C!=="setEventedParent"&&v.add(C);w=Object.getPrototypeOf(w)}return Array.from(v)}const X0=typeof document<"u"?W.useLayoutEffect:W.useEffect,K0=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function J0(f,v){for(const C of K0)C in v&&(f[C]=v[C]);const{RTLTextPlugin:w="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=v;w&&f.getRTLTextPluginStatus&&f.getRTLTextPluginStatus()==="unavailable"&&f.setRTLTextPlugin(w,C=>{C&&console.error(C)},!0)}const il=W.createContext(null);function Y0(f,v,w){const C=W.useContext(N0),[E,z]=W.useState(null),O=W.useRef(),{current:a}=W.useRef({mapLib:null,map:null});W.useEffect(()=>{const ae=f.mapLib;let oe=!0,he;return Promise.resolve(ae||w).then(we=>{if(!oe)return;if(!we)throw new Error("Invalid mapLib");const ke="Map"in we?we:we.default;if(!ke.Map)throw new Error("Invalid mapLib");if(J0(ke,f),!ke.supported||ke.supported(f))f.reuseMaps&&(he=Na.reuse(f,O.current)),he||(he=new Na(ke.Map,f,O.current)),a.map=H0(he),a.mapLib=ke,z(he),C?.onMapMount(a.map,f.id);else throw new Error("Map is not supported by this browser")}).catch(we=>{const{onError:ke}=f;ke?ke({type:"error",target:null,originalEvent:null,error:we}):console.error(we)}),()=>{oe=!1,he&&(C?.onMapUnmount(f.id),f.reuseMaps?he.recycle():he.destroy())}},[]),X0(()=>{E&&E.setProps(f)}),W.useImperativeHandle(v,()=>a.map,[E]);const Q=W.useMemo(()=>({position:"relative",width:"100%",height:"100%",...f.style}),[f.style]),B={height:"100%"};return W.createElement("div",{id:f.id,ref:O,style:Q},E&&W.createElement(il.Provider,{value:a},W.createElement("div",{"mapboxgl-children":"",style:B},f.children)))}const Q0=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function Ks(f,v){if(!f||!v)return;const w=f.style;for(const C in v){const E=v[C];Number.isFinite(E)&&!Q0.test(C)?w[C]=`${E}px`:w[C]=E}}function ex(f,v){const{map:w,mapLib:C}=W.useContext(il),E=W.useRef({props:f});E.current.props=f;const z=W.useMemo(()=>{let Ne=!1;W.Children.forEach(f.children,We=>{We&&(Ne=!0)});const Re={...f,element:Ne?document.createElement("div"):null},Fe=new C.Marker(Re);return Fe.setLngLat([f.longitude,f.latitude]),Fe.getElement().addEventListener("click",We=>{var Ue,ye;(ye=(Ue=E.current.props).onClick)===null||ye===void 0||ye.call(Ue,{type:"click",target:Fe,originalEvent:We})}),Fe.on("dragstart",We=>{var Ue,ye;const Ie=We;Ie.lngLat=z.getLngLat(),(ye=(Ue=E.current.props).onDragStart)===null||ye===void 0||ye.call(Ue,Ie)}),Fe.on("drag",We=>{var Ue,ye;const Ie=We;Ie.lngLat=z.getLngLat(),(ye=(Ue=E.current.props).onDrag)===null||ye===void 0||ye.call(Ue,Ie)}),Fe.on("dragend",We=>{var Ue,ye;const Ie=We;Ie.lngLat=z.getLngLat(),(ye=(Ue=E.current.props).onDragEnd)===null||ye===void 0||ye.call(Ue,Ie)}),Fe},[]);W.useEffect(()=>(z.addTo(w.getMap()),()=>{z.remove()}),[]);const{longitude:O,latitude:a,offset:Q,style:B,draggable:ae=!1,popup:oe=null,rotation:he=0,rotationAlignment:we="auto",pitchAlignment:ke="auto"}=f;return W.useEffect(()=>{Ks(z.getElement(),B)},[B]),W.useImperativeHandle(v,()=>z,[]),(z.getLngLat().lng!==O||z.getLngLat().lat!==a)&&z.setLngLat([O,a]),Q&&!$0(z.getOffset(),Q)&&z.setOffset(Q),z.isDraggable()!==ae&&z.setDraggable(ae),z.getRotation()!==he&&z.setRotation(he),z.getRotationAlignment()!==we&&z.setRotationAlignment(we),z.getPitchAlignment()!==ke&&z.setPitchAlignment(ke),z.getPopup()!==oe&&z.setPopup(oe),Yo.createPortal(f.children,z.getElement())}W.memo(W.forwardRef(ex));function rf(f){return new Set(f?f.trim().split(/\s+/):[])}function tx(f,v){const{map:w,mapLib:C}=W.useContext(il),E=W.useMemo(()=>document.createElement("div"),[]),z=W.useRef({props:f});z.current.props=f;const O=W.useMemo(()=>{const a={...f},Q=new C.Popup(a);return Q.setLngLat([f.longitude,f.latitude]),Q.once("open",B=>{var ae,oe;(oe=(ae=z.current.props).onOpen)===null||oe===void 0||oe.call(ae,B)}),Q},[]);if(W.useEffect(()=>{const a=Q=>{var B,ae;(ae=(B=z.current.props).onClose)===null||ae===void 0||ae.call(B,Q)};return O.on("close",a),O.setDOMContent(E).addTo(w.getMap()),()=>{O.off("close",a),O.isOpen()&&O.remove()}},[]),W.useEffect(()=>{Ks(O.getElement(),f.style)},[f.style]),W.useImperativeHandle(v,()=>O,[]),O.isOpen()&&((O.getLngLat().lng!==f.longitude||O.getLngLat().lat!==f.latitude)&&O.setLngLat([f.longitude,f.latitude]),f.offset&&!Fn(O.options.offset,f.offset)&&O.setOffset(f.offset),(O.options.anchor!==f.anchor||O.options.maxWidth!==f.maxWidth)&&(O.options.anchor=f.anchor,O.setMaxWidth(f.maxWidth)),O.options.className!==f.className)){const a=rf(O.options.className),Q=rf(f.className);for(const B of a)Q.has(B)||O.removeClassName(B);for(const B of Q)a.has(B)||O.addClassName(B);O.options.className=f.className}return Yo.createPortal(f.children,E)}W.memo(W.forwardRef(tx));function rl(f,v,w,C){const E=W.useContext(il),z=W.useMemo(()=>f(E),[]);return W.useEffect(()=>{const O=C||w||v,a=typeof v=="function"&&typeof w=="function"?v:null,Q=typeof w=="function"?w:typeof v=="function"?v:null,{map:B}=E;return B.hasControl(z)||(B.addControl(z,O?.position),a&&a(E)),()=>{Q&&Q(E),B.hasControl(z)&&B.removeControl(z)}},[]),z}function ix(f){const v=rl(({mapLib:w})=>new w.AttributionControl(f),{position:f.position});return W.useEffect(()=>{Ks(v._container,f.style)},[f.style]),null}W.memo(ix);function rx(f){const v=rl(({mapLib:w})=>new w.FullscreenControl({container:f.containerId&&document.getElementById(f.containerId)}),{position:f.position});return W.useEffect(()=>{Ks(v._controlContainer,f.style)},[f.style]),null}W.memo(rx);function nx(f,v){const w=W.useRef({props:f}),C=rl(({mapLib:E})=>{const z=new E.GeolocateControl(f),O=z._setupUI;return z._setupUI=a=>{z._container.hasChildNodes()||O(a)},z.on("geolocate",a=>{var Q,B;(B=(Q=w.current.props).onGeolocate)===null||B===void 0||B.call(Q,a)}),z.on("error",a=>{var Q,B;(B=(Q=w.current.props).onError)===null||B===void 0||B.call(Q,a)}),z.on("outofmaxbounds",a=>{var Q,B;(B=(Q=w.current.props).onOutOfMaxBounds)===null||B===void 0||B.call(Q,a)}),z.on("trackuserlocationstart",a=>{var Q,B;(B=(Q=w.current.props).onTrackUserLocationStart)===null||B===void 0||B.call(Q,a)}),z.on("trackuserlocationend",a=>{var Q,B;(B=(Q=w.current.props).onTrackUserLocationEnd)===null||B===void 0||B.call(Q,a)}),z},{position:f.position});return w.current.props=f,W.useImperativeHandle(v,()=>C,[]),W.useEffect(()=>{Ks(C._container,f.style)},[f.style]),null}W.memo(W.forwardRef(nx));function sx(f){const v=rl(({mapLib:w})=>new w.NavigationControl(f),{position:f.position});return W.useEffect(()=>{Ks(v._container,f.style)},[f.style]),null}W.memo(sx);function ax(f){const v=rl(({mapLib:z})=>new z.ScaleControl(f),{position:f.position}),w=W.useRef(f),C=w.current;w.current=f;const{style:E}=f;return f.maxWidth!==void 0&&f.maxWidth!==C.maxWidth&&(v.options.maxWidth=f.maxWidth),f.unit!==void 0&&f.unit!==C.unit&&v.setUnit(f.unit),W.useEffect(()=>{Ks(v._container,E)},[E]),null}W.memo(ax);function nf(f,v){if(!f)throw new Error(v)}let ox=0;function lx(f,v,w){if(f.style&&f.style._loaded){const C={...w};return delete C.id,delete C.children,f.addSource(v,C),f.getSource(v)}return null}function cx(f,v,w){nf(v.id===w.id,"source id changed"),nf(v.type===w.type,"source type changed");let C="",E=0;for(const O in v)O!=="children"&&O!=="id"&&!Fn(w[O],v[O])&&(C=O,E++);if(!E)return;const z=v.type;if(z==="geojson")f.setData(v.data);else if(z==="image")f.updateImage({url:v.url,coordinates:v.coordinates});else if("setCoordinates"in f&&E===1&&C==="coordinates")f.setCoordinates(v.coordinates);else if("setUrl"in f)switch(C){case"url":f.setUrl(v.url);break;case"tiles":f.setTiles(v.tiles);break}else console.warn(`Unable to update <Source> prop: ${C}`)}function ux(f){const v=W.useContext(il).map.getMap(),w=W.useRef(f),[,C]=W.useState(0),E=W.useMemo(()=>f.id||`jsx-source-${ox++}`,[]);W.useEffect(()=>{if(v){const O=()=>setTimeout(()=>C(a=>a+1),0);return v.on("styledata",O),O(),()=>{var a;if(v.off("styledata",O),v.style&&v.style._loaded&&v.getSource(E)){const Q=(a=v.getStyle())===null||a===void 0?void 0:a.layers;if(Q)for(const B of Q)B.source===E&&v.removeLayer(B.id);v.removeSource(E)}}}},[v]);let z=v&&v.style&&v.getSource(E);return z?cx(z,f,w.current):z=lx(v,E,f),w.current=f,z&&W.Children.map(f.children,O=>O&&W.cloneElement(O,{source:E}))||null}const hx=c_(()=>import("./mapbox-gl-AmDk7qVP.js").then(f=>f.m),__vite__mapDeps([0,1,2])),dx=W.forwardRef(function(v,w){return Y0(v,w,hx)}),px=ux;var Hf={exports:{}};(function(f,v){(function(w,C){f.exports=C()})(u_,function(){var w,C,E;function z(a,Q){if(!w)w=Q;else if(!C)C=Q;else{var B="var sharedChunk = {}; ("+w+")(sharedChunk); ("+C+")(sharedChunk);",ae={};w(ae),E=Q(ae),typeof window<"u"&&(E.workerUrl=window.URL.createObjectURL(new Blob([B],{type:"text/javascript"})))}}z(["exports"],function(a){function Q(i,e,r,s){return new(r||(r=Promise))(function(l,h){function p(b){try{y(s.next(b))}catch(T){h(T)}}function m(b){try{y(s.throw(b))}catch(T){h(T)}}function y(b){var T;b.done?l(b.value):(T=b.value,T instanceof r?T:new r(function(P){P(T)})).then(p,m)}y((s=s.apply(i,e||[])).next())})}function B(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}typeof SuppressedError=="function"&&SuppressedError;var ae=oe;function oe(i,e){this.x=i,this.y=e}oe.prototype={clone:function(){return new oe(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,r=i.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),r=Math.sin(i),s=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=s,this},_rotateAround:function(i,e){var r=Math.cos(i),s=Math.sin(i),l=e.y+s*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-s*(this.y-e.y),this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},oe.convert=function(i){return i instanceof oe?i:Array.isArray(i)?new oe(i[0],i[1]):i};var he=B(ae),we=ke;function ke(i,e,r,s){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=r,this.p2y=s}ke.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,s=0;s<8;s++){var l=this.sampleCurveX(r)-i;if(Math.abs(l)<e)return r;var h=this.sampleCurveDerivativeX(r);if(Math.abs(h)<1e-6)break;r-=l/h}var p=0,m=1;for(r=i,s=0;s<20&&(l=this.sampleCurveX(r),!(Math.abs(l-i)<e));s++)i>l?p=r:m=r,r=.5*(m-p)+p;return r},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};var Ne=B(we);let Re,Fe;function We(){return Re==null&&(Re=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Re}function Ue(){if(Fe==null&&(Fe=!1,We())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let s=0;s<5*5;s++){const l=4*s;e.fillStyle=`rgb(${l},${l+1},${l+2})`,e.fillRect(s%5,Math.floor(s/5),1,1)}const r=e.getImageData(0,0,5,5).data;for(let s=0;s<5*5*4;s++)if(s%4!=3&&r[s]!==s){Fe=!0;break}}}return Fe||!1}function ye(i,e,r,s){const l=new Ne(i,e,r,s);return function(h){return l.solve(h)}}const Ie=ye(.25,.1,.25,1);function rt(i,e,r){return Math.min(r,Math.max(e,i))}function et(i,e,r){const s=r-e,l=((i-e)%s+s)%s+e;return l===e?r:l}function Ze(i,...e){for(const r of e)for(const s in r)i[s]=r[s];return i}let at=1;function Pe(i,e,r){const s={};for(const l in i)s[l]=e.call(r||this,i[l],l,i);return s}function it(i,e,r){const s={};for(const l in i)e.call(r||this,i[l],l,i)&&(s[l]=i[l]);return s}function xt(i){return Array.isArray(i)?i.map(xt):typeof i=="object"&&i?Pe(i,xt):i}const At={};function gt(i){At[i]||(typeof console<"u"&&console.warn(i),At[i]=!0)}function Pt(i,e,r){return(r.y-i.y)*(e.x-i.x)>(e.y-i.y)*(r.x-i.x)}function Bt(i){let e=0;for(let r,s,l=0,h=i.length,p=h-1;l<h;p=l++)r=i[l],s=i[p],e+=(s.x-r.x)*(r.y+s.y);return e}function ft(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let ni=null;function Mi(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const Xi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function si(i,e,r,s,l){return Q(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const h=new VideoFrame(i,{timestamp:0});try{const p=h?.format;if(!p||!p.startsWith("BGR")&&!p.startsWith("RGB"))throw new Error(`Unrecognized format ${p}`);const m=p.startsWith("BGR"),y=new Uint8ClampedArray(s*l*4);if(yield h.copyTo(y,function(b,T,P,k,R){const F=4*Math.max(-T,0),j=(Math.max(0,P)-P)*k*4+F,H=4*k,J=Math.max(0,T),se=Math.max(0,P);return{rect:{x:J,y:se,width:Math.min(b.width,T+k)-J,height:Math.min(b.height,P+R)-se},layout:[{offset:j,stride:H}]}}(i,e,r,s,l)),m)for(let b=0;b<y.length;b+=4){const T=y[b];y[b]=y[b+2],y[b+2]=T}return y}finally{h.close()}})}let Xt,qe,yt,Kt;const Mt={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(i){const e=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(i,e=0){return this.getImageCanvasContext(i).getImageData(-e,-e,i.width+2*e,i.height+2*e)},getImageCanvasContext(i){const e=window.document.createElement("canvas"),r=e.getContext("2d",{willReadFrequently:!0});if(!r)throw new Error("failed to create canvas 2d context");return e.width=i.width,e.height=i.height,r.drawImage(i,0,0,i.width,i.height),r},resolveURL:i=>(yt||(yt=document.createElement("a")),yt.href=i,yt.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Kt==null&&(Kt=matchMedia("(prefers-reduced-motion: reduce)")),Kt.matches)}},Jt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class gi extends Error{constructor(e,r,s,l){super(`AJAXError: ${r} (${e}): ${s}`),this.status=e,this.statusText=r,this.url=s,this.body=l}}const Yt=ft()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,Rt=i=>Jt.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))];function ki(i,e){const r=new AbortController,s=new Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,cache:i.cache,referrer:Yt(),signal:r.signal});let l=!1,h=!1;return i.type==="json"&&s.headers.set("Accept","application/json"),h||fetch(s).then(p=>p.ok?(m=>{(i.type==="arrayBuffer"||i.type==="image"?m.arrayBuffer():i.type==="json"?m.json():m.text()).then(y=>{h||(l=!0,e(null,y,m.headers.get("Cache-Control"),m.headers.get("Expires")))}).catch(y=>{h||e(new Error(y.message))})})(p):p.blob().then(m=>e(new gi(p.status,p.statusText,i.url,m)))).catch(p=>{p.code!==20&&e(new Error(p.message))}),{cancel:()=>{h=!0,l||r.abort()}}}const bi=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){if(ft()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e);if(!ft())return(Rt(i.url)||ki)(i,e)}if(!(/^file:/.test(r=i.url)||/^file:/.test(Yt())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return ki(i,e);if(ft()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var r;return function(s,l){const h=new XMLHttpRequest;h.open(s.method||"GET",s.url,!0),s.type!=="arrayBuffer"&&s.type!=="image"||(h.responseType="arraybuffer");for(const p in s.headers)h.setRequestHeader(p,s.headers[p]);return s.type==="json"&&(h.responseType="text",h.setRequestHeader("Accept","application/json")),h.withCredentials=s.credentials==="include",h.onerror=()=>{l(new Error(h.statusText))},h.onload=()=>{if((h.status>=200&&h.status<300||h.status===0)&&h.response!==null){let p=h.response;if(s.type==="json")try{p=JSON.parse(h.response)}catch(m){return l(m)}l(null,p,h.getResponseHeader("Cache-Control"),h.getResponseHeader("Expires"))}else{const p=new Blob([h.response],{type:h.getResponseHeader("Content-Type")});l(new gi(h.status,h.statusText,s.url,p))}},h.send(s.body),{cancel:()=>h.abort()}}(i,e)},Wt=function(i,e){return bi(Ze(i,{type:"arrayBuffer"}),e)};function Ti(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const e=new URL(i),r=window.location;return e.protocol===r.protocol&&e.host===r.host}function rr(i,e,r){r[i]&&r[i].indexOf(e)!==-1||(r[i]=r[i]||[],r[i].push(e))}function fr(i,e,r){if(r&&r[i]){const s=r[i].indexOf(e);s!==-1&&r[i].splice(s,1)}}class nr{constructor(e,r={}){Ze(this,r),this.type=e}}class mr extends nr{constructor(e,r={}){super("error",Ze({error:e},r))}}class Cr{on(e,r){return this._listeners=this._listeners||{},rr(e,r,this._listeners),this}off(e,r){return fr(e,r,this._listeners),fr(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},rr(e,r,this._oneTimeListeners),this):new Promise(s=>this.once(e,s))}fire(e,r){typeof e=="string"&&(e=new nr(e,r||{}));const s=e.type;if(this.listens(s)){e.target=this;const l=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const m of l)m.call(this,e);const h=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const m of h)fr(s,m,this._oneTimeListeners),m.call(this,e);const p=this._eventedParent;p&&(Ze(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(e))}else e instanceof mr&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var me={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Ii=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function $i(i,e){const r={};for(const s in i)s!=="ref"&&(r[s]=i[s]);return Ii.forEach(s=>{s in e&&(r[s]=e[s])}),r}function jt(i,e){if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let r=0;r<i.length;r++)if(!jt(i[r],e[r]))return!1;return!0}if(typeof i=="object"&&i!==null&&e!==null){if(typeof e!="object"||Object.keys(i).length!==Object.keys(e).length)return!1;for(const r in i)if(!jt(i[r],e[r]))return!1;return!0}return i===e}const kt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Ui(i,e,r){r.push({command:kt.addSource,args:[i,e[i]]})}function Ki(i,e,r){e.push({command:kt.removeSource,args:[i]}),r[i]=!0}function sr(i,e,r,s){Ki(i,r,s),Ui(i,e,r)}function Cn(i,e,r){let s;for(s in i[r])if(Object.prototype.hasOwnProperty.call(i[r],s)&&s!=="data"&&!jt(i[r][s],e[r][s]))return!1;for(s in e[r])if(Object.prototype.hasOwnProperty.call(e[r],s)&&s!=="data"&&!jt(i[r][s],e[r][s]))return!1;return!0}function Tn(i,e,r,s,l,h){let p;for(p in e=e||{},i=i||{})Object.prototype.hasOwnProperty.call(i,p)&&(jt(i[p],e[p])||r.push({command:h,args:[s,p,e[p],l]}));for(p in e)Object.prototype.hasOwnProperty.call(e,p)&&!Object.prototype.hasOwnProperty.call(i,p)&&(jt(i[p],e[p])||r.push({command:h,args:[s,p,e[p],l]}))}function en(i){return i.id}function In(i,e){return i[e.id]=e,i}class ze{constructor(e,r,s,l){this.message=(e?`${e}: `:"")+s,l&&(this.identifier=l),r!=null&&r.__line__&&(this.line=r.__line__)}}function mt(i,...e){for(const r of e)for(const s in r)i[s]=r[s];return i}class dt extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class Ut{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[s,l]of r)this.bindings[s]=l}concat(e){return new Ut(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const wt={kind:"null"},Te={kind:"number"},ot={kind:"string"},ct={kind:"boolean"},_i={kind:"color"},ji={kind:"object"},vt={kind:"value"},hn={kind:"collator"},q={kind:"formatted"},M={kind:"padding"},D={kind:"resolvedImage"},N={kind:"variableAnchorOffsetCollection"};function G(i,e){return{kind:"array",itemType:i,N:e}}function X(i){if(i.kind==="array"){const e=X(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const le=[wt,Te,ot,ct,_i,q,ji,G(vt),M,D,N];function te(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!te(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const r of le)if(!te(r,e))return null}}return`Expected ${X(i)} but found ${X(e)} instead.`}function Y(i,e){return e.some(r=>r.kind===i.kind)}function ne(i,e){return e.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}function ge(i,e){return i.kind==="array"&&e.kind==="array"?i.itemType.kind===e.itemType.kind&&typeof i.N=="number":i.kind===e.kind}const ve=.96422,Se=.82521,nt=4/29,pt=6/29,Xe=3*pt*pt,lt=pt*pt*pt,_t=Math.PI/180,Vt=180/Math.PI;function Gt(i){return(i%=360)<0&&(i+=360),i}function Ft([i,e,r,s]){let l,h;const p=Ji((.2225045*(i=Lt(i))+.7168786*(e=Lt(e))+.0606169*(r=Lt(r)))/1);i===e&&e===r?l=h=p:(l=Ji((.4360747*i+.3850649*e+.1430804*r)/ve),h=Ji((.0139322*i+.0971045*e+.7141733*r)/Se));const m=116*p-16;return[m<0?0:m,500*(l-p),200*(p-h),s]}function Lt(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Ji(i){return i>lt?Math.pow(i,1/3):i/Xe+nt}function Qt([i,e,r,s]){let l=(i+16)/116,h=isNaN(e)?l:l+e/500,p=isNaN(r)?l:l-r/200;return l=1*qi(l),h=ve*qi(h),p=Se*qi(p),[Ei(3.1338561*h-1.6168667*l-.4906146*p),Ei(-.9787684*h+1.9161415*l+.033454*p),Ei(.0719453*h-.2289914*l+1.4052427*p),s]}function Ei(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function qi(i){return i>pt?i*i*i:Xe*(i-nt)}function Fr(i){return parseInt(i.padEnd(2,i),16)/255}function nl(i,e){return ts(e?i/100:i,0,1)}function ts(i,e,r){return Math.min(Math.max(e,i),r)}function is(i){return!i.some(Number.isNaN)}const Ac={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class qt{constructor(e,r,s,l=1,h=!0){this.r=e,this.g=r,this.b=s,this.a=l,h||(this.r*=l,this.g*=l,this.b*=l,l||this.overwriteGetter("rgb",[e,r,s,l]))}static parse(e){if(e instanceof qt)return e;if(typeof e!="string")return;const r=function(s){if((s=s.toLowerCase().trim())==="transparent")return[0,0,0,0];const l=Ac[s];if(l){const[p,m,y]=l;return[p/255,m/255,y/255,1]}if(s.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(s)){const p=s.length<6?1:2;let m=1;return[Fr(s.slice(m,m+=p)),Fr(s.slice(m,m+=p)),Fr(s.slice(m,m+=p)),Fr(s.slice(m,m+p)||"ff")]}if(s.startsWith("rgb")){const p=s.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(p){const[m,y,b,T,P,k,R,F,j,H,J,se]=p,ee=[T||" ",R||" ",H].join("");if(ee==="  "||ee==="  /"||ee===",,"||ee===",,,"){const ce=[b,k,j].join(""),de=ce==="%%%"?100:ce===""?255:0;if(de){const be=[ts(+y/de,0,1),ts(+P/de,0,1),ts(+F/de,0,1),J?nl(+J,se):1];if(is(be))return be}}return}}const h=s.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(h){const[p,m,y,b,T,P,k,R,F]=h,j=[y||" ",T||" ",k].join("");if(j==="  "||j==="  /"||j===",,"||j===",,,"){const H=[+m,ts(+b,0,100),ts(+P,0,100),R?nl(+R,F):1];if(is(H))return function([J,se,ee,ce]){function de(be){const Ve=(be+J/30)%12,Je=se*Math.min(ee,1-ee);return ee-Je*Math.max(-1,Math.min(Ve-3,9-Ve,1))}return J=Gt(J),se/=100,ee/=100,[de(0),de(8),de(4),ce]}(H)}}}(e);return r?new qt(...r,!1):void 0}get rgb(){const{r:e,g:r,b:s,a:l}=this,h=l||1/0;return this.overwriteGetter("rgb",[e/h,r/h,s/h,l])}get hcl(){return this.overwriteGetter("hcl",function(e){const[r,s,l,h]=Ft(e),p=Math.sqrt(s*s+l*l);return[Math.round(1e4*p)?Gt(Math.atan2(l,s)*Vt):NaN,p,r,h]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Ft(this.rgb))}overwriteGetter(e,r){return Object.defineProperty(this,e,{value:r}),r}toString(){const[e,r,s,l]=this.rgb;return`rgba(${[e,r,s].map(h=>Math.round(255*h)).join(",")},${l})`}}qt.black=new qt(0,0,0,1),qt.white=new qt(1,1,1,1),qt.transparent=new qt(0,0,0,0),qt.red=new qt(1,0,0,1);class Va{constructor(e,r,s){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Js{constructor(e,r,s,l,h){this.text=e,this.image=r,this.scale=s,this.fontStack=l,this.textColor=h}}class Yi{constructor(e){this.sections=e}static fromString(e){return new Yi([new Js(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Yi?e:Yi.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class Tr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Tr)return e;if(typeof e=="number")return new Tr([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const r of e)if(typeof r!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new Tr(e)}}toString(){return JSON.stringify(this.values)}}const Pc=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Br{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Br)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let r=0;r<e.length;r+=2){const s=e[r],l=e[r+1];if(typeof s!="string"||!Pc.has(s)||!Array.isArray(l)||l.length!==2||typeof l[0]!="number"||typeof l[1]!="number")return}return new Br(e)}}toString(){return JSON.stringify(this.values)}}class Zi{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Zi({name:e,available:!1}):null}}function Ys(i,e,r,s){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[i,e,r,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[i,e,r,s]:[i,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function rs(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof qt||i instanceof Va||i instanceof Yi||i instanceof Tr||i instanceof Br||i instanceof Zi)return!0;if(Array.isArray(i)){for(const e of i)if(!rs(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!rs(i[e]))return!1;return!0}return!1}function li(i){if(i===null)return wt;if(typeof i=="string")return ot;if(typeof i=="boolean")return ct;if(typeof i=="number")return Te;if(i instanceof qt)return _i;if(i instanceof Va)return hn;if(i instanceof Yi)return q;if(i instanceof Tr)return M;if(i instanceof Br)return N;if(i instanceof Zi)return D;if(Array.isArray(i)){const e=i.length;let r;for(const s of i){const l=li(s);if(r){if(r===l)continue;r=vt;break}r=l}return G(r||vt,e)}return ji}function Ot(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof qt||i instanceof Yi||i instanceof Tr||i instanceof Br||i instanceof Zi?i.toString():JSON.stringify(i)}class On{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!rs(e[1]))return r.error("invalid value");const s=e[1];let l=li(s);const h=r.expectedType;return l.kind!=="array"||l.N!==0||!h||h.kind!=="array"||typeof h.N=="number"&&h.N!==0||(l=h),new On(l,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class pi{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Qs={string:ot,number:Te,boolean:ct,object:ji};class Or{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let s,l=1;const h=e[0];if(h==="array"){let m,y;if(e.length>2){const b=e[1];if(typeof b!="string"||!(b in Qs)||b==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);m=Qs[b],l++}else m=vt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);y=e[2],l++}s=G(m,y)}else{if(!Qs[h])throw new Error(`Types doesn't contain name = ${h}`);s=Qs[h]}const p=[];for(;l<e.length;l++){const m=r.parse(e[l],l,vt);if(!m)return null;p.push(m)}return new Or(s,p)}evaluate(e){for(let r=0;r<this.args.length;r++){const s=this.args[r].evaluate(e);if(!te(this.type,li(s)))return s;if(r===this.args.length-1)throw new pi(`Expected value to be of type ${X(this.type)}, but found ${X(li(s))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Ua={"to-boolean":ct,"to-color":_i,"to-number":Te,"to-string":ot};class En{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const s=e[0];if(!Ua[s])throw new Error(`Can't parse ${s} as it is not part of the known types`);if((s==="to-boolean"||s==="to-string")&&e.length!==2)return r.error("Expected one argument.");const l=Ua[s],h=[];for(let p=1;p<e.length;p++){const m=r.parse(e[p],p,vt);if(!m)return null;h.push(m)}return new En(l,h)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let r,s;for(const l of this.args){if(r=l.evaluate(e),s=null,r instanceof qt)return r;if(typeof r=="string"){const h=e.parseColor(r);if(h)return h}else if(Array.isArray(r)&&(s=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:Ys(r[0],r[1],r[2],r[3]),!s))return new qt(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new pi(s||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const s of this.args){r=s.evaluate(e);const l=Tr.parse(r);if(l)return l}throw new pi(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const s of this.args){r=s.evaluate(e);const l=Br.parse(r);if(l)return l}throw new pi(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const s of this.args){if(r=s.evaluate(e),r===null)return 0;const l=Number(r);if(!isNaN(l))return l}throw new pi(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return Yi.fromString(Ot(this.args[0].evaluate(e)));case"resolvedImage":return Zi.fromString(Ot(this.args[0].evaluate(e)));default:return Ot(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const sl=["Unknown","Point","LineString","Polygon"];class qa{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?sl[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=qt.parse(e)),r}}class ea{constructor(e,r,s=[],l,h=new Ut,p=[]){this.registry=e,this.path=s,this.key=s.map(m=>`[${m}]`).join(""),this.scope=h,this.errors=p,this.expectedType=l,this._isConstant=r}parse(e,r,s,l,h={}){return r?this.concat(r,s,l)._parse(e,h):this._parse(e,h)}_parse(e,r){function s(l,h,p){return p==="assert"?new Or(h,[l]):p==="coerce"?new En(h,[l]):l}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const l=e[0];if(typeof l!="string")return this.error(`Expression name must be a string, but found ${typeof l} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const h=this.registry[l];if(h){let p=h.parse(e,this);if(!p)return null;if(this.expectedType){const m=this.expectedType,y=p.type;if(m.kind!=="string"&&m.kind!=="number"&&m.kind!=="boolean"&&m.kind!=="object"&&m.kind!=="array"||y.kind!=="value")if(m.kind!=="color"&&m.kind!=="formatted"&&m.kind!=="resolvedImage"||y.kind!=="value"&&y.kind!=="string")if(m.kind!=="padding"||y.kind!=="value"&&y.kind!=="number"&&y.kind!=="array")if(m.kind!=="variableAnchorOffsetCollection"||y.kind!=="value"&&y.kind!=="array"){if(this.checkSubtype(m,y))return null}else p=s(p,m,r.typeAnnotation||"coerce");else p=s(p,m,r.typeAnnotation||"coerce");else p=s(p,m,r.typeAnnotation||"coerce");else p=s(p,m,r.typeAnnotation||"assert")}if(!(p instanceof On)&&p.type.kind!=="resolvedImage"&&this._isConstant(p)){const m=new qa;try{p=new On(p.type,p.evaluate(m))}catch(y){return this.error(y.message),null}}return p}return this.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,s){const l=typeof e=="number"?this.path.concat(e):this.path,h=s?this.scope.concat(s):this.scope;return new ea(this.registry,this._isConstant,l,r||null,h,this.errors)}error(e,...r){const s=`${this.key}${r.map(l=>`[${l}]`).join("")}`;this.errors.push(new dt(s,e))}checkSubtype(e,r){const s=te(e,r);return s&&this.error(s),s}}class ta{constructor(e,r,s){this.type=hn,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const s=e[1];if(typeof s!="object"||Array.isArray(s))return r.error("Collator options argument must be an object.");const l=r.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,ct);if(!l)return null;const h=r.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,ct);if(!h)return null;let p=null;return s.locale&&(p=r.parse(s.locale,1,ot),!p)?null:new ta(l,h,p)}evaluate(e){return new Va(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}const An=8192;function Za(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function Is(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function al(i,e){const r=(180+i[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,l=Math.pow(2,e.z);return[Math.round(r*l*An),Math.round(s*l*An)]}function Mc(i,e,r){const s=i[0]-e[0],l=i[1]-e[1],h=i[0]-r[0],p=i[1]-r[1];return s*p-h*l==0&&s*h<=0&&l*p<=0}function Ga(i,e){let r=!1;for(let p=0,m=e.length;p<m;p++){const y=e[p];for(let b=0,T=y.length;b<T-1;b++){if(Mc(i,y[b],y[b+1]))return!1;(l=y[b])[1]>(s=i)[1]!=(h=y[b+1])[1]>s[1]&&s[0]<(h[0]-l[0])*(s[1]-l[1])/(h[1]-l[1])+l[0]&&(r=!r)}}var s,l,h;return r}function Ha(i,e){for(let r=0;r<e.length;r++)if(Ga(i,e[r]))return!0;return!1}function ol(i,e,r,s){const l=s[0]-r[0],h=s[1]-r[1],p=(i[0]-r[0])*h-l*(i[1]-r[1]),m=(e[0]-r[0])*h-l*(e[1]-r[1]);return p>0&&m<0||p<0&&m>0}function kc(i,e,r){for(const b of r)for(let T=0;T<b.length-1;++T)if((m=[(p=b[T+1])[0]-(h=b[T])[0],p[1]-h[1]])[0]*(y=[(l=e)[0]-(s=i)[0],l[1]-s[1]])[1]-m[1]*y[0]!=0&&ol(s,l,h,p)&&ol(h,p,s,l))return!0;var s,l,h,p,m,y;return!1}function ll(i,e){for(let r=0;r<i.length;++r)if(!Ga(i[r],e))return!1;for(let r=0;r<i.length-1;++r)if(kc(i[r],i[r+1],e))return!1;return!0}function cl(i,e){for(let r=0;r<e.length;r++)if(ll(i,e[r]))return!0;return!1}function ia(i,e,r){const s=[];for(let l=0;l<i.length;l++){const h=[];for(let p=0;p<i[l].length;p++){const m=al(i[l][p],r);Za(e,m),h.push(m)}s.push(h)}return s}function ul(i,e,r){const s=[];for(let l=0;l<i.length;l++){const h=ia(i[l],e,r);s.push(h)}return s}function hl(i,e,r,s){if(i[0]<r[0]||i[0]>r[2]){const l=.5*s;let h=i[0]-r[0]>l?-s:r[0]-i[0]>l?s:0;h===0&&(h=i[0]-r[2]>l?-s:r[2]-i[0]>l?s:0),i[0]+=h}Za(e,i)}function Wa(i,e,r,s){const l=Math.pow(2,s.z)*An,h=[s.x*An,s.y*An],p=[];for(const m of i)for(const y of m){const b=[y.x+h[0],y.y+h[1]];hl(b,e,r,l),p.push(b)}return p}function Xa(i,e,r,s){const l=Math.pow(2,s.z)*An,h=[s.x*An,s.y*An],p=[];for(const y of i){const b=[];for(const T of y){const P=[T.x+h[0],T.y+h[1]];Za(e,P),b.push(P)}p.push(b)}if(e[2]-e[0]<=l/2){(m=e)[0]=m[1]=1/0,m[2]=m[3]=-1/0;for(const y of p)for(const b of y)hl(b,e,r,l)}var m;return p}class Nn{constructor(e,r){this.type=ct,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(rs(e[1])){const s=e[1];if(s.type==="FeatureCollection")for(let l=0;l<s.features.length;++l){const h=s.features[l].geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new Nn(s,s.features[l].geometry)}else if(s.type==="Feature"){const l=s.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new Nn(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new Nn(s,s)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,s){const l=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],p=r.canonicalID();if(s.type==="Polygon"){const m=ia(s.coordinates,h,p),y=Wa(r.geometry(),l,h,p);if(!Is(l,h))return!1;for(const b of y)if(!Ga(b,m))return!1}if(s.type==="MultiPolygon"){const m=ul(s.coordinates,h,p),y=Wa(r.geometry(),l,h,p);if(!Is(l,h))return!1;for(const b of y)if(!Ha(b,m))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,s){const l=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],p=r.canonicalID();if(s.type==="Polygon"){const m=ia(s.coordinates,h,p),y=Xa(r.geometry(),l,h,p);if(!Is(l,h))return!1;for(const b of y)if(!ll(b,m))return!1}if(s.type==="MultiPolygon"){const m=ul(s.coordinates,h,p),y=Xa(r.geometry(),l,h,p);if(!Is(l,h))return!1;for(const b of y)if(!cl(b,m))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class ra{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const s=e[1];return r.scope.has(s)?new ra(s,r.scope.get(s)):r.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class Nr{constructor(e,r,s,l){this.name=e,this.type=r,this._evaluate=s,this.args=l}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,r){const s=e[0],l=Nr.definitions[s];if(!l)return r.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const h=Array.isArray(l)?l[0]:l.type,p=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,m=p.filter(([b])=>!Array.isArray(b)||b.length===e.length-1);let y=null;for(const[b,T]of m){y=new ea(r.registry,na,r.path,null,r.scope);const P=[];let k=!1;for(let R=1;R<e.length;R++){const F=e[R],j=Array.isArray(b)?b[R-1]:b.type,H=y.parse(F,1+P.length,j);if(!H){k=!0;break}P.push(H)}if(!k)if(Array.isArray(b)&&b.length!==P.length)y.error(`Expected ${b.length} arguments, but found ${P.length} instead.`);else{for(let R=0;R<P.length;R++){const F=Array.isArray(b)?b[R]:b.type,j=P[R];y.concat(R+1).checkSubtype(F,j.type)}if(y.errors.length===0)return new Nr(s,h,T,P)}}if(m.length===1)r.errors.push(...y.errors);else{const b=(m.length?m:p).map(([P])=>{return k=P,Array.isArray(k)?`(${k.map(X).join(", ")})`:`(${X(k.type)}...)`;var k}).join(" | "),T=[];for(let P=1;P<e.length;P++){const k=r.parse(e[P],1+T.length);if(!k)return null;T.push(X(k.type))}r.error(`Expected arguments of type ${b}, but found (${T.join(", ")}) instead.`)}return null}static register(e,r){Nr.definitions=r;for(const s in r)e[s]=Nr}}function na(i){if(i instanceof ra)return na(i.boundExpression);if(i instanceof Nr&&i.name==="error"||i instanceof ta||i instanceof Nn)return!1;const e=i instanceof En||i instanceof Or;let r=!0;return i.eachChild(s=>{r=e?r&&na(s):r&&s instanceof On}),!!r&&sa(i)&&aa(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function sa(i){if(i instanceof Nr&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Nn)return!1;let e=!0;return i.eachChild(r=>{e&&!sa(r)&&(e=!1)}),e}function Es(i){if(i instanceof Nr&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(r=>{e&&!Es(r)&&(e=!1)}),e}function aa(i,e){if(i instanceof Nr&&e.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(s=>{r&&!aa(s,e)&&(r=!1)}),r}function ns(i,e){const r=i.length-1;let s,l,h=0,p=r,m=0;for(;h<=p;)if(m=Math.floor((h+p)/2),s=i[m],l=i[m+1],s<=e){if(m===r||e<l)return m;h=m+1}else{if(!(s>e))throw new pi("Input is not a number.");p=m-1}return 0}class Pn{constructor(e,r,s){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[l,h]of s)this.labels.push(l),this.outputs.push(h)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const s=r.parse(e[1],1,Te);if(!s)return null;const l=[];let h=null;r.expectedType&&r.expectedType.kind!=="value"&&(h=r.expectedType);for(let p=1;p<e.length;p+=2){const m=p===1?-1/0:e[p],y=e[p+1],b=p,T=p+1;if(typeof m!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',b);if(l.length&&l[l.length-1][0]>=m)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',b);const P=r.parse(y,T,h);if(!P)return null;h=h||P.type,l.push([m,P])}return new Pn(h,s,l)}evaluate(e){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(e);const l=this.input.evaluate(e);if(l<=r[0])return s[0].evaluate(e);const h=r.length;return l>=r[h-1]?s[h-1].evaluate(e):s[ns(r,l)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function zt(i,e,r){return i+r*(e-i)}function oa(i,e,r){return i.map((s,l)=>zt(s,e[l],r))}const Ir={number:zt,color:function(i,e,r,s="rgb"){switch(s){case"rgb":{const[l,h,p,m]=oa(i.rgb,e.rgb,r);return new qt(l,h,p,m,!1)}case"hcl":{const[l,h,p,m]=i.hcl,[y,b,T,P]=e.hcl;let k,R;if(isNaN(l)||isNaN(y))isNaN(l)?isNaN(y)?k=NaN:(k=y,p!==1&&p!==0||(R=b)):(k=l,T!==1&&T!==0||(R=h));else{let se=y-l;y>l&&se>180?se-=360:y<l&&l-y>180&&(se+=360),k=l+r*se}const[F,j,H,J]=function([se,ee,ce,de]){return se=isNaN(se)?0:se*_t,Qt([ce,Math.cos(se)*ee,Math.sin(se)*ee,de])}([k,R??zt(h,b,r),zt(p,T,r),zt(m,P,r)]);return new qt(F,j,H,J,!1)}case"lab":{const[l,h,p,m]=Qt(oa(i.lab,e.lab,r));return new qt(l,h,p,m,!1)}}},array:oa,padding:function(i,e,r){return new Tr(oa(i.values,e.values,r))},variableAnchorOffsetCollection:function(i,e,r){const s=i.values,l=e.values;if(s.length!==l.length)throw new pi(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${e.toString()}`);const h=[];for(let p=0;p<s.length;p+=2){if(s[p]!==l[p])throw new pi(`Cannot interpolate values containing mismatched anchors. from[${p}]: ${s[p]}, to[${p}]: ${l[p]}`);h.push(s[p]);const[m,y]=s[p+1],[b,T]=l[p+1];h.push([zt(m,b,r),zt(y,T,r)])}return new Br(h)}};class Er{constructor(e,r,s,l,h){this.type=e,this.operator=r,this.interpolation=s,this.input=l,this.labels=[],this.outputs=[];for(const[p,m]of h)this.labels.push(p),this.outputs.push(m)}static interpolationFactor(e,r,s,l){let h=0;if(e.name==="exponential")h=Ka(r,e.base,s,l);else if(e.name==="linear")h=Ka(r,1,s,l);else if(e.name==="cubic-bezier"){const p=e.controlPoints;h=new Ne(p[0],p[1],p[2],p[3]).solve(Ka(r,1,s,l))}return h}static parse(e,r){let[s,l,h,...p]=e;if(!Array.isArray(l)||l.length===0)return r.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){const b=l[1];if(typeof b!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:b}}else{if(l[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(l[0])}`,1,0);{const b=l.slice(1);if(b.length!==4||b.some(T=>typeof T!="number"||T<0||T>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:b}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(h=r.parse(h,2,Te),!h)return null;const m=[];let y=null;s==="interpolate-hcl"||s==="interpolate-lab"?y=_i:r.expectedType&&r.expectedType.kind!=="value"&&(y=r.expectedType);for(let b=0;b<p.length;b+=2){const T=p[b],P=p[b+1],k=b+3,R=b+4;if(typeof T!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(m.length&&m[m.length-1][0]>=T)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',k);const F=r.parse(P,R,y);if(!F)return null;y=y||F.type,m.push([T,F])}return ge(y,Te)||ge(y,_i)||ge(y,M)||ge(y,N)||ge(y,G(Te))?new Er(y,s,l,h,m):r.error(`Type ${X(y)} is not interpolatable.`)}evaluate(e){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(e);const l=this.input.evaluate(e);if(l<=r[0])return s[0].evaluate(e);const h=r.length;if(l>=r[h-1])return s[h-1].evaluate(e);const p=ns(r,l),m=Er.interpolationFactor(this.interpolation,l,r[p],r[p+1]),y=s[p].evaluate(e),b=s[p+1].evaluate(e);switch(this.operator){case"interpolate":return Ir[this.type.kind](y,b,m);case"interpolate-hcl":return Ir.color(y,b,m,"hcl");case"interpolate-lab":return Ir.color(y,b,m,"lab")}}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Ka(i,e,r,s){const l=s-r,h=i-r;return l===0?0:e===1?h/l:(Math.pow(e,h)-1)/(Math.pow(e,l)-1)}class la{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let s=null;const l=r.expectedType;l&&l.kind!=="value"&&(s=l);const h=[];for(const m of e.slice(1)){const y=r.parse(m,1+h.length,s,void 0,{typeAnnotation:"omit"});if(!y)return null;s=s||y.type,h.push(y)}if(!s)throw new Error("No output type");const p=l&&h.some(m=>te(l,m.type));return new la(p?vt:s,h)}evaluate(e){let r,s=null,l=0;for(const h of this.args)if(l++,s=h.evaluate(e),s&&s instanceof Zi&&!s.available&&(r||(r=s.name),s=null,l===this.args.length&&(s=r)),s!==null)break;return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class ca{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let h=1;h<e.length-1;h+=2){const p=e[h];if(typeof p!="string")return r.error(`Expected string, but found ${typeof p} instead.`,h);if(/[^a-zA-Z0-9_]/.test(p))return r.error("Variable names must contain only alphanumeric characters or '_'.",h);const m=r.parse(e[h+1],h+1);if(!m)return null;s.push([p,m])}const l=r.parse(e[e.length-1],e.length-1,r.expectedType,s);return l?new ca(s,l):null}outputDefined(){return this.result.outputDefined()}}class Ja{constructor(e,r,s){this.type=e,this.index=r,this.input=s}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,Te),l=r.parse(e[2],2,G(r.expectedType||vt));return s&&l?new Ja(l.type.itemType,s,l):null}evaluate(e){const r=this.index.evaluate(e),s=this.input.evaluate(e);if(r<0)throw new pi(`Array index out of bounds: ${r} < 0.`);if(r>=s.length)throw new pi(`Array index out of bounds: ${r} > ${s.length-1}.`);if(r!==Math.floor(r))throw new pi(`Array index must be an integer, but found ${r} instead.`);return s[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class Ya{constructor(e,r){this.type=ct,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,vt),l=r.parse(e[2],2,vt);return s&&l?Y(s.type,[ct,ot,Te,wt,vt])?new Ya(s,l):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${X(s.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!s)return!1;if(!ne(r,["boolean","string","number","null"]))throw new pi(`Expected first argument to be of type boolean, string, number or null, but found ${X(li(r))} instead.`);if(!ne(s,["string","array"]))throw new pi(`Expected second argument to be of type array or string, but found ${X(li(s))} instead.`);return s.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class ua{constructor(e,r,s){this.type=Te,this.needle=e,this.haystack=r,this.fromIndex=s}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,vt),l=r.parse(e[2],2,vt);if(!s||!l)return null;if(!Y(s.type,[ct,ot,Te,wt,vt]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${X(s.type)} instead`);if(e.length===4){const h=r.parse(e[3],3,Te);return h?new ua(s,l,h):null}return new ua(s,l)}evaluate(e){const r=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!ne(r,["boolean","string","number","null"]))throw new pi(`Expected first argument to be of type boolean, string, number or null, but found ${X(li(r))} instead.`);if(!ne(s,["string","array"]))throw new pi(`Expected second argument to be of type array or string, but found ${X(li(s))} instead.`);if(this.fromIndex){const l=this.fromIndex.evaluate(e);return s.indexOf(r,l)}return s.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class Qa{constructor(e,r,s,l,h,p){this.inputType=e,this.type=r,this.input=s,this.cases=l,this.outputs=h,this.otherwise=p}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let s,l;r.expectedType&&r.expectedType.kind!=="value"&&(l=r.expectedType);const h={},p=[];for(let b=2;b<e.length-1;b+=2){let T=e[b];const P=e[b+1];Array.isArray(T)||(T=[T]);const k=r.concat(b);if(T.length===0)return k.error("Expected at least one branch label.");for(const F of T){if(typeof F!="number"&&typeof F!="string")return k.error("Branch labels must be numbers or strings.");if(typeof F=="number"&&Math.abs(F)>Number.MAX_SAFE_INTEGER)return k.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof F=="number"&&Math.floor(F)!==F)return k.error("Numeric branch labels must be integer values.");if(s){if(k.checkSubtype(s,li(F)))return null}else s=li(F);if(h[String(F)]!==void 0)return k.error("Branch labels must be unique.");h[String(F)]=p.length}const R=r.parse(P,b,l);if(!R)return null;l=l||R.type,p.push(R)}const m=r.parse(e[1],1,vt);if(!m)return null;const y=r.parse(e[e.length-1],e.length-1,l);return y?m.type.kind!=="value"&&r.concat(1).checkSubtype(s,m.type)?null:new Qa(s,l,m,h,p,y):null}evaluate(e){const r=this.input.evaluate(e);return(li(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class eo{constructor(e,r,s){this.type=e,this.branches=r,this.otherwise=s}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let s;r.expectedType&&r.expectedType.kind!=="value"&&(s=r.expectedType);const l=[];for(let p=1;p<e.length-1;p+=2){const m=r.parse(e[p],p,ct);if(!m)return null;const y=r.parse(e[p+1],p+1,s);if(!y)return null;l.push([m,y]),s=s||y.type}const h=r.parse(e[e.length-1],e.length-1,s);if(!h)return null;if(!s)throw new Error("Can't infer output type");return new eo(s,l,h)}evaluate(e){for(const[r,s]of this.branches)if(r.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,s]of this.branches)e(r),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class ha{constructor(e,r,s,l){this.type=e,this.input=r,this.beginIndex=s,this.endIndex=l}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,vt),l=r.parse(e[2],2,Te);if(!s||!l)return null;if(!Y(s.type,[G(vt),ot,vt]))return r.error(`Expected first argument to be of type array or string, but found ${X(s.type)} instead`);if(e.length===4){const h=r.parse(e[3],3,Te);return h?new ha(s.type,s,l,h):null}return new ha(s.type,s,l)}evaluate(e){const r=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!ne(r,["string","array"]))throw new pi(`Expected first argument to be of type array or string, but found ${X(li(r))} instead.`);if(this.endIndex){const l=this.endIndex.evaluate(e);return r.slice(s,l)}return r.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function dl(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function pl(i,e,r,s){return s.compare(e,r)===0}function ss(i,e,r){const s=i!=="=="&&i!=="!=";return class Wf{constructor(h,p,m){this.type=ct,this.lhs=h,this.rhs=p,this.collator=m,this.hasUntypedArgument=h.type.kind==="value"||p.type.kind==="value"}static parse(h,p){if(h.length!==3&&h.length!==4)return p.error("Expected two or three arguments.");const m=h[0];let y=p.parse(h[1],1,vt);if(!y)return null;if(!dl(m,y.type))return p.concat(1).error(`"${m}" comparisons are not supported for type '${X(y.type)}'.`);let b=p.parse(h[2],2,vt);if(!b)return null;if(!dl(m,b.type))return p.concat(2).error(`"${m}" comparisons are not supported for type '${X(b.type)}'.`);if(y.type.kind!==b.type.kind&&y.type.kind!=="value"&&b.type.kind!=="value")return p.error(`Cannot compare types '${X(y.type)}' and '${X(b.type)}'.`);s&&(y.type.kind==="value"&&b.type.kind!=="value"?y=new Or(b.type,[y]):y.type.kind!=="value"&&b.type.kind==="value"&&(b=new Or(y.type,[b])));let T=null;if(h.length===4){if(y.type.kind!=="string"&&b.type.kind!=="string"&&y.type.kind!=="value"&&b.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(T=p.parse(h[3],3,hn),!T)return null}return new Wf(y,b,T)}evaluate(h){const p=this.lhs.evaluate(h),m=this.rhs.evaluate(h);if(s&&this.hasUntypedArgument){const y=li(p),b=li(m);if(y.kind!==b.kind||y.kind!=="string"&&y.kind!=="number")throw new pi(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${y.kind}, ${b.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const y=li(p),b=li(m);if(y.kind!=="string"||b.kind!=="string")return e(h,p,m)}return this.collator?r(h,p,m,this.collator.evaluate(h)):e(h,p,m)}eachChild(h){h(this.lhs),h(this.rhs),this.collator&&h(this.collator)}outputDefined(){return!0}}}const zc=ss("==",function(i,e,r){return e===r},pl),Dc=ss("!=",function(i,e,r){return e!==r},function(i,e,r,s){return!pl(0,e,r,s)}),Lc=ss("<",function(i,e,r){return e<r},function(i,e,r,s){return s.compare(e,r)<0}),Rc=ss(">",function(i,e,r){return e>r},function(i,e,r,s){return s.compare(e,r)>0}),Fc=ss("<=",function(i,e,r){return e<=r},function(i,e,r,s){return s.compare(e,r)<=0}),Bc=ss(">=",function(i,e,r){return e>=r},function(i,e,r,s){return s.compare(e,r)>=0});class to{constructor(e,r,s,l,h){this.type=ot,this.number=e,this.locale=r,this.currency=s,this.minFractionDigits=l,this.maxFractionDigits=h}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const s=r.parse(e[1],1,Te);if(!s)return null;const l=e[2];if(typeof l!="object"||Array.isArray(l))return r.error("NumberFormat options argument must be an object.");let h=null;if(l.locale&&(h=r.parse(l.locale,1,ot),!h))return null;let p=null;if(l.currency&&(p=r.parse(l.currency,1,ot),!p))return null;let m=null;if(l["min-fraction-digits"]&&(m=r.parse(l["min-fraction-digits"],1,Te),!m))return null;let y=null;return l["max-fraction-digits"]&&(y=r.parse(l["max-fraction-digits"],1,Te),!y)?null:new to(s,h,p,m,y)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class da{constructor(e){this.type=q,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&typeof s=="object")return r.error("First argument must be an image or text section.");const l=[];let h=!1;for(let p=1;p<=e.length-1;++p){const m=e[p];if(h&&typeof m=="object"&&!Array.isArray(m)){h=!1;let y=null;if(m["font-scale"]&&(y=r.parse(m["font-scale"],1,Te),!y))return null;let b=null;if(m["text-font"]&&(b=r.parse(m["text-font"],1,G(ot)),!b))return null;let T=null;if(m["text-color"]&&(T=r.parse(m["text-color"],1,_i),!T))return null;const P=l[l.length-1];P.scale=y,P.font=b,P.textColor=T}else{const y=r.parse(e[p],1,vt);if(!y)return null;const b=y.type.kind;if(b!=="string"&&b!=="value"&&b!=="null"&&b!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");h=!0,l.push({content:y,scale:null,font:null,textColor:null})}}return new da(l)}evaluate(e){return new Yi(this.sections.map(r=>{const s=r.content.evaluate(e);return li(s)===D?new Js("",s,null,null,null):new Js(Ot(s),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}}class io{constructor(e){this.type=D,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const s=r.parse(e[1],1,ot);return s?new io(s):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),s=Zi.fromString(r);return s&&e.availableImages&&(s.available=e.availableImages.indexOf(r)>-1),s}eachChild(e){e(this.input)}outputDefined(){return!1}}class ro{constructor(e){this.type=Te,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=r.parse(e[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${X(s.type)} instead.`):new ro(s):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new pi(`Expected value to be of type string or array, but found ${X(li(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const as={"==":zc,"!=":Dc,">":Rc,"<":Lc,">=":Bc,"<=":Fc,array:Or,at:Ja,boolean:Or,case:eo,coalesce:la,collator:ta,format:da,image:io,in:Ya,"index-of":ua,interpolate:Er,"interpolate-hcl":Er,"interpolate-lab":Er,length:ro,let:ca,literal:On,match:Qa,number:Or,"number-format":to,object:Or,slice:ha,step:Pn,string:Or,"to-boolean":En,"to-color":En,"to-number":En,"to-string":En,var:ra,within:Nn};function fl(i,[e,r,s,l]){e=e.evaluate(i),r=r.evaluate(i),s=s.evaluate(i);const h=l?l.evaluate(i):1,p=Ys(e,r,s,h);if(p)throw new pi(p);return new qt(e/255,r/255,s/255,h,!1)}function ml(i,e){return i in e}function no(i,e){const r=e[i];return r===void 0?null:r}function $n(i){return{type:i}}function gl(i){return{result:"success",value:i}}function Mn(i){return{result:"error",value:i}}function os(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function _l(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function so(i){return!!i.expression&&i.expression.interpolated}function Nt(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function ci(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function Oc(i){return i}function Dt(i,e){const r=e.type==="color",s=i.stops&&typeof i.stops[0][0]=="object",l=s||!(s||i.property!==void 0),h=i.type||(so(e)?"exponential":"interval");if(r||e.type==="padding"){const T=r?qt.parse:Tr.parse;(i=mt({},i)).stops&&(i.stops=i.stops.map(P=>[P[0],T(P[1])])),i.default=T(i.default?i.default:e.default)}if(i.colorSpace&&(p=i.colorSpace)!=="rgb"&&p!=="hcl"&&p!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var p;let m,y,b;if(h==="exponential")m=As;else if(h==="interval")m=ai;else if(h==="categorical"){m=ui,y=Object.create(null);for(const T of i.stops)y[T[0]]=T[1];b=typeof i.stops[0][0]}else{if(h!=="identity")throw new Error(`Unknown function type "${h}"`);m=yl}if(s){const T={},P=[];for(let F=0;F<i.stops.length;F++){const j=i.stops[F],H=j[0].zoom;T[H]===void 0&&(T[H]={zoom:H,type:i.type,property:i.property,default:i.default,stops:[]},P.push(H)),T[H].stops.push([j[0].value,j[1]])}const k=[];for(const F of P)k.push([T[F].zoom,Dt(T[F],e)]);const R={name:"linear"};return{kind:"composite",interpolationType:R,interpolationFactor:Er.interpolationFactor.bind(void 0,R),zoomStops:k.map(F=>F[0]),evaluate:({zoom:F},j)=>As({stops:k,base:i.base},e,F).evaluate(F,j)}}if(l){const T=h==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:T,interpolationFactor:Er.interpolationFactor.bind(void 0,T),zoomStops:i.stops.map(P=>P[0]),evaluate:({zoom:P})=>m(i,e,P,y,b)}}return{kind:"source",evaluate(T,P){const k=P&&P.properties?P.properties[i.property]:void 0;return k===void 0?jn(i.default,e.default):m(i,e,k,y,b)}}}function jn(i,e,r){return i!==void 0?i:e!==void 0?e:r!==void 0?r:void 0}function ui(i,e,r,s,l){return jn(typeof r===l?s[r]:void 0,i.default,e.default)}function ai(i,e,r){if(Nt(r)!=="number")return jn(i.default,e.default);const s=i.stops.length;if(s===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[s-1][0])return i.stops[s-1][1];const l=ns(i.stops.map(h=>h[0]),r);return i.stops[l][1]}function As(i,e,r){const s=i.base!==void 0?i.base:1;if(Nt(r)!=="number")return jn(i.default,e.default);const l=i.stops.length;if(l===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[l-1][0])return i.stops[l-1][1];const h=ns(i.stops.map(T=>T[0]),r),p=function(T,P,k,R){const F=R-k,j=T-k;return F===0?0:P===1?j/F:(Math.pow(P,j)-1)/(Math.pow(P,F)-1)}(r,s,i.stops[h][0],i.stops[h+1][0]),m=i.stops[h][1],y=i.stops[h+1][1],b=Ir[e.type]||Oc;return typeof m.evaluate=="function"?{evaluate(...T){const P=m.evaluate.apply(void 0,T),k=y.evaluate.apply(void 0,T);if(P!==void 0&&k!==void 0)return b(P,k,p,i.colorSpace)}}:b(m,y,p,i.colorSpace)}function yl(i,e,r){switch(e.type){case"color":r=qt.parse(r);break;case"formatted":r=Yi.fromString(r.toString());break;case"resolvedImage":r=Zi.fromString(r.toString());break;case"padding":r=Tr.parse(r);break;default:Nt(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0)}return jn(r,i.default,e.default)}Nr.register(as,{error:[{kind:"error"},[ot],(i,[e])=>{throw new pi(e.evaluate(i))}],typeof:[ot,[vt],(i,[e])=>X(li(e.evaluate(i)))],"to-rgba":[G(Te,4),[_i],(i,[e])=>{const[r,s,l,h]=e.evaluate(i).rgb;return[255*r,255*s,255*l,h]}],rgb:[_i,[Te,Te,Te],fl],rgba:[_i,[Te,Te,Te,Te],fl],has:{type:ct,overloads:[[[ot],(i,[e])=>ml(e.evaluate(i),i.properties())],[[ot,ji],(i,[e,r])=>ml(e.evaluate(i),r.evaluate(i))]]},get:{type:vt,overloads:[[[ot],(i,[e])=>no(e.evaluate(i),i.properties())],[[ot,ji],(i,[e,r])=>no(e.evaluate(i),r.evaluate(i))]]},"feature-state":[vt,[ot],(i,[e])=>no(e.evaluate(i),i.featureState||{})],properties:[ji,[],i=>i.properties()],"geometry-type":[ot,[],i=>i.geometryType()],id:[vt,[],i=>i.id()],zoom:[Te,[],i=>i.globals.zoom],"heatmap-density":[Te,[],i=>i.globals.heatmapDensity||0],"line-progress":[Te,[],i=>i.globals.lineProgress||0],accumulated:[vt,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Te,$n(Te),(i,e)=>{let r=0;for(const s of e)r+=s.evaluate(i);return r}],"*":[Te,$n(Te),(i,e)=>{let r=1;for(const s of e)r*=s.evaluate(i);return r}],"-":{type:Te,overloads:[[[Te,Te],(i,[e,r])=>e.evaluate(i)-r.evaluate(i)],[[Te],(i,[e])=>-e.evaluate(i)]]},"/":[Te,[Te,Te],(i,[e,r])=>e.evaluate(i)/r.evaluate(i)],"%":[Te,[Te,Te],(i,[e,r])=>e.evaluate(i)%r.evaluate(i)],ln2:[Te,[],()=>Math.LN2],pi:[Te,[],()=>Math.PI],e:[Te,[],()=>Math.E],"^":[Te,[Te,Te],(i,[e,r])=>Math.pow(e.evaluate(i),r.evaluate(i))],sqrt:[Te,[Te],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[Te,[Te],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[Te,[Te],(i,[e])=>Math.log(e.evaluate(i))],log2:[Te,[Te],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[Te,[Te],(i,[e])=>Math.sin(e.evaluate(i))],cos:[Te,[Te],(i,[e])=>Math.cos(e.evaluate(i))],tan:[Te,[Te],(i,[e])=>Math.tan(e.evaluate(i))],asin:[Te,[Te],(i,[e])=>Math.asin(e.evaluate(i))],acos:[Te,[Te],(i,[e])=>Math.acos(e.evaluate(i))],atan:[Te,[Te],(i,[e])=>Math.atan(e.evaluate(i))],min:[Te,$n(Te),(i,e)=>Math.min(...e.map(r=>r.evaluate(i)))],max:[Te,$n(Te),(i,e)=>Math.max(...e.map(r=>r.evaluate(i)))],abs:[Te,[Te],(i,[e])=>Math.abs(e.evaluate(i))],round:[Te,[Te],(i,[e])=>{const r=e.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[Te,[Te],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[Te,[Te],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[ct,[ot,vt],(i,[e,r])=>i.properties()[e.value]===r.value],"filter-id-==":[ct,[vt],(i,[e])=>i.id()===e.value],"filter-type-==":[ct,[ot],(i,[e])=>i.geometryType()===e.value],"filter-<":[ct,[ot,vt],(i,[e,r])=>{const s=i.properties()[e.value],l=r.value;return typeof s==typeof l&&s<l}],"filter-id-<":[ct,[vt],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r<s}],"filter->":[ct,[ot,vt],(i,[e,r])=>{const s=i.properties()[e.value],l=r.value;return typeof s==typeof l&&s>l}],"filter-id->":[ct,[vt],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r>s}],"filter-<=":[ct,[ot,vt],(i,[e,r])=>{const s=i.properties()[e.value],l=r.value;return typeof s==typeof l&&s<=l}],"filter-id-<=":[ct,[vt],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r<=s}],"filter->=":[ct,[ot,vt],(i,[e,r])=>{const s=i.properties()[e.value],l=r.value;return typeof s==typeof l&&s>=l}],"filter-id->=":[ct,[vt],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r>=s}],"filter-has":[ct,[vt],(i,[e])=>e.value in i.properties()],"filter-has-id":[ct,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[ct,[G(ot)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[ct,[G(vt)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[ct,[ot,G(vt)],(i,[e,r])=>r.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[ct,[ot,G(vt)],(i,[e,r])=>function(s,l,h,p){for(;h<=p;){const m=h+p>>1;if(l[m]===s)return!0;l[m]>s?p=m-1:h=m+1}return!1}(i.properties()[e.value],r.value,0,r.value.length-1)],all:{type:ct,overloads:[[[ct,ct],(i,[e,r])=>e.evaluate(i)&&r.evaluate(i)],[$n(ct),(i,e)=>{for(const r of e)if(!r.evaluate(i))return!1;return!0}]]},any:{type:ct,overloads:[[[ct,ct],(i,[e,r])=>e.evaluate(i)||r.evaluate(i)],[$n(ct),(i,e)=>{for(const r of e)if(r.evaluate(i))return!0;return!1}]]},"!":[ct,[ct],(i,[e])=>!e.evaluate(i)],"is-supported-script":[ct,[ot],(i,[e])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(e.evaluate(i))}],upcase:[ot,[ot],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[ot,[ot],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[ot,$n(vt),(i,e)=>e.map(r=>Ot(r.evaluate(i))).join("")],"resolved-locale":[ot,[hn],(i,[e])=>e.evaluate(i).resolvedLocale()]});class ao{constructor(e,r){var s;this.expression=e,this._warningHistory={},this._evaluator=new qa,this._defaultValue=r?(s=r).type==="color"&&ci(s.default)?new qt(0,0,0,0):s.type==="color"?qt.parse(s.default)||null:s.type==="padding"?Tr.parse(s.default)||null:s.type==="variableAnchorOffsetCollection"?Br.parse(s.default)||null:s.default===void 0?null:s.default:null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,s,l,h,p){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=s,this._evaluator.canonical=l,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=p,this.expression.evaluate(this._evaluator)}evaluate(e,r,s,l,h,p){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=s||null,this._evaluator.canonical=l,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=p||null;try{const m=this.expression.evaluate(this._evaluator);if(m==null||typeof m=="number"&&m!=m)return this._defaultValue;if(this._enumValues&&!(m in this._enumValues))throw new pi(`Expected value to be one of ${Object.keys(this._enumValues).map(y=>JSON.stringify(y)).join(", ")}, but found ${JSON.stringify(m)} instead.`);return m}catch(m){return this._warningHistory[m.message]||(this._warningHistory[m.message]=!0,typeof console<"u"&&console.warn(m.message)),this._defaultValue}}}function pa(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in as}function fa(i,e){const r=new ea(as,na,[],e?function(l){const h={color:_i,string:ot,number:Te,enum:ot,boolean:ct,formatted:q,padding:M,resolvedImage:D,variableAnchorOffsetCollection:N};return l.type==="array"?G(h[l.value]||vt,l.length):h[l.type]}(e):void 0),s=r.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return s?gl(new ao(s,e)):Mn(r.errors)}class oo{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!Es(r.expression)}evaluateWithoutErrorHandling(e,r,s,l,h,p){return this._styleExpression.evaluateWithoutErrorHandling(e,r,s,l,h,p)}evaluate(e,r,s,l,h,p){return this._styleExpression.evaluate(e,r,s,l,h,p)}}class ma{constructor(e,r,s,l){this.kind=e,this.zoomStops=s,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!Es(r.expression),this.interpolationType=l}evaluateWithoutErrorHandling(e,r,s,l,h,p){return this._styleExpression.evaluateWithoutErrorHandling(e,r,s,l,h,p)}evaluate(e,r,s,l,h,p){return this._styleExpression.evaluate(e,r,s,l,h,p)}interpolationFactor(e,r,s){return this.interpolationType?Er.interpolationFactor(this.interpolationType,e,r,s):0}}function lo(i,e){const r=fa(i,e);if(r.result==="error")return r;const s=r.value.expression,l=sa(s);if(!l&&!os(e))return Mn([new dt("","data expressions not supported")]);const h=aa(s,["zoom"]);if(!h&&!_l(e))return Mn([new dt("","zoom expressions not supported")]);const p=Ms(s);return p||h?p instanceof dt?Mn([p]):p instanceof Er&&!so(e)?Mn([new dt("",'"interpolate" expressions cannot be used with this property')]):gl(p?new ma(l?"camera":"composite",r.value,p.labels,p instanceof Er?p.interpolation:void 0):new oo(l?"constant":"source",r.value)):Mn([new dt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ps{constructor(e,r){this._parameters=e,this._specification=r,mt(this,Dt(this._parameters,this._specification))}static deserialize(e){return new Ps(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Ms(i){let e=null;if(i instanceof ca)e=Ms(i.result);else if(i instanceof la){for(const r of i.args)if(e=Ms(r),e)break}else(i instanceof Pn||i instanceof Er)&&i.input instanceof Nr&&i.input.name==="zoom"&&(e=i);return e instanceof dt||i.eachChild(r=>{const s=Ms(r);s instanceof dt?e=s:!e&&s?e=new dt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&s&&e!==s&&(e=new dt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function ks(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!ks(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const Nc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function co(i){if(i==null)return{filter:()=>!0,needGeometry:!1};ks(i)||(i=ga(i));const e=fa(i,Nc);if(e.result==="error")throw new Error(e.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,s,l)=>e.value.evaluate(r,s,{},l),needGeometry:vl(i)}}function $c(i,e){return i<e?-1:i>e?1:0}function vl(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(vl(i[e]))return!0;return!1}function ga(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?uo(i[1],i[2],"=="):e==="!="?zs(uo(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?uo(i[1],i[2],e):e==="any"?(r=i.slice(1),["any"].concat(r.map(ga))):e==="all"?["all"].concat(i.slice(1).map(ga)):e==="none"?["all"].concat(i.slice(1).map(ga).map(zs)):e==="in"?xl(i[1],i.slice(2)):e==="!in"?zs(xl(i[1],i.slice(2))):e==="has"?bl(i[1]):e==="!has"?zs(bl(i[1])):e!=="within"||i;var r}function uo(i,e,r){switch(i){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,i,e]}}function xl(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",i,["literal",e.sort($c)]]:["filter-in-small",i,["literal",e]]}}function bl(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function zs(i){return["!",i]}function _a(i){const e=typeof i;if(e==="number"||e==="boolean"||e==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let l="[";for(const h of i)l+=`${_a(h)},`;return`${l}]`}const r=Object.keys(i).sort();let s="{";for(let l=0;l<r.length;l++)s+=`${JSON.stringify(r[l])}:${_a(i[r[l]])},`;return`${s}}`}function ya(i){let e="";for(const r of Ii)e+=`/${_a(i[r])}`;return e}function wl(i){const e=i.value;return e?[new ze(i.key,e,"constants have been deprecated as of v8")]:[]}function fi(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Vn(i){if(Array.isArray(i))return i.map(Vn);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const r in i)e[r]=Vn(i[r]);return e}return fi(i)}function gr(i){const e=i.key,r=i.value,s=i.valueSpec||{},l=i.objectElementValidators||{},h=i.style,p=i.styleSpec,m=i.validateSpec;let y=[];const b=Nt(r);if(b!=="object")return[new ze(e,r,`object expected, ${b} found`)];for(const T in r){const P=T.split(".")[0],k=s[P]||s["*"];let R;if(l[P])R=l[P];else if(s[P])R=m;else if(l["*"])R=l["*"];else{if(!s["*"]){y.push(new ze(e,r[T],`unknown property "${T}"`));continue}R=m}y=y.concat(R({key:(e&&`${e}.`)+T,value:r[T],valueSpec:k,style:h,styleSpec:p,object:r,objectKey:T,validateSpec:m},r))}for(const T in s)l[T]||s[T].required&&s[T].default===void 0&&r[T]===void 0&&y.push(new ze(e,r,`missing required property "${T}"`));return y}function ls(i){const e=i.value,r=i.valueSpec,s=i.style,l=i.styleSpec,h=i.key,p=i.arrayElementValidator||i.validateSpec;if(Nt(e)!=="array")return[new ze(h,e,`array expected, ${Nt(e)} found`)];if(r.length&&e.length!==r.length)return[new ze(h,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new ze(h,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let m={type:r.value,values:r.values};l.$version<7&&(m.function=r.function),Nt(r.value)==="object"&&(m=r.value);let y=[];for(let b=0;b<e.length;b++)y=y.concat(p({array:e,arrayIndex:b,value:e[b],valueSpec:m,validateSpec:i.validateSpec,style:s,styleSpec:l,key:`${h}[${b}]`}));return y}function Ds(i){const e=i.key,r=i.value,s=i.valueSpec;let l=Nt(r);return l==="number"&&r!=r&&(l="NaN"),l!=="number"?[new ze(e,r,`number expected, ${l} found`)]:"minimum"in s&&r<s.minimum?[new ze(e,r,`${r} is less than the minimum value ${s.minimum}`)]:"maximum"in s&&r>s.maximum?[new ze(e,r,`${r} is greater than the maximum value ${s.maximum}`)]:[]}function va(i){const e=i.valueSpec,r=fi(i.value.type);let s,l,h,p={};const m=r!=="categorical"&&i.value.property===void 0,y=!m,b=Nt(i.value.stops)==="array"&&Nt(i.value.stops[0])==="array"&&Nt(i.value.stops[0][0])==="object",T=gr({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(R){if(r==="identity")return[new ze(R.key,R.value,'identity function may not have a "stops" property')];let F=[];const j=R.value;return F=F.concat(ls({key:R.key,value:j,valueSpec:R.valueSpec,validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec,arrayElementValidator:P})),Nt(j)==="array"&&j.length===0&&F.push(new ze(R.key,j,"array must have at least one stop")),F},default:function(R){return R.validateSpec({key:R.key,value:R.value,valueSpec:e,validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec})}}});return r==="identity"&&m&&T.push(new ze(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||T.push(new ze(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!so(i.valueSpec)&&T.push(new ze(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(y&&!os(i.valueSpec)?T.push(new ze(i.key,i.value,"property functions not supported")):m&&!_l(i.valueSpec)&&T.push(new ze(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!b||i.value.property!==void 0||T.push(new ze(i.key,i.value,'"property" property is required')),T;function P(R){let F=[];const j=R.value,H=R.key;if(Nt(j)!=="array")return[new ze(H,j,`array expected, ${Nt(j)} found`)];if(j.length!==2)return[new ze(H,j,`array length 2 expected, length ${j.length} found`)];if(b){if(Nt(j[0])!=="object")return[new ze(H,j,`object expected, ${Nt(j[0])} found`)];if(j[0].zoom===void 0)return[new ze(H,j,"object stop key must have zoom")];if(j[0].value===void 0)return[new ze(H,j,"object stop key must have value")];if(h&&h>fi(j[0].zoom))return[new ze(H,j[0].zoom,"stop zoom values must appear in ascending order")];fi(j[0].zoom)!==h&&(h=fi(j[0].zoom),l=void 0,p={}),F=F.concat(gr({key:`${H}[0]`,value:j[0],valueSpec:{zoom:{}},validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec,objectElementValidators:{zoom:Ds,value:k}}))}else F=F.concat(k({key:`${H}[0]`,value:j[0],valueSpec:{},validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec},j));return pa(Vn(j[1]))?F.concat([new ze(`${H}[1]`,j[1],"expressions are not allowed in function stops.")]):F.concat(R.validateSpec({key:`${H}[1]`,value:j[1],valueSpec:e,validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec}))}function k(R,F){const j=Nt(R.value),H=fi(R.value),J=R.value!==null?R.value:F;if(s){if(j!==s)return[new ze(R.key,J,`${j} stop domain type must match previous stop domain type ${s}`)]}else s=j;if(j!=="number"&&j!=="string"&&j!=="boolean")return[new ze(R.key,J,"stop domain value must be a number, string, or boolean")];if(j!=="number"&&r!=="categorical"){let se=`number expected, ${j} found`;return os(e)&&r===void 0&&(se+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ze(R.key,J,se)]}return r!=="categorical"||j!=="number"||isFinite(H)&&Math.floor(H)===H?r!=="categorical"&&j==="number"&&l!==void 0&&H<l?[new ze(R.key,J,"stop domain values must appear in ascending order")]:(l=H,r==="categorical"&&H in p?[new ze(R.key,J,"stop domain values must be unique")]:(p[H]=!0,[])):[new ze(R.key,J,`integer expected, found ${H}`)]}}function Un(i){const e=(i.expressionContext==="property"?lo:fa)(Vn(i.value),i.valueSpec);if(e.result==="error")return e.value.map(s=>new ze(`${i.key}${s.key}`,i.value,s.message));const r=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new ze(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!Es(r))return[new ze(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!Es(r))return[new ze(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!aa(r,["zoom","feature-state"]))return[new ze(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!sa(r))return[new ze(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ls(i){const e=i.key,r=i.value,s=i.valueSpec,l=[];return Array.isArray(s.values)?s.values.indexOf(fi(r))===-1&&l.push(new ze(e,r,`expected one of [${s.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(s.values).indexOf(fi(r))===-1&&l.push(new ze(e,r,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(r)} found`)),l}function cs(i){return ks(Vn(i.value))?Un(mt({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Sl(i)}function Sl(i){const e=i.value,r=i.key;if(Nt(e)!=="array")return[new ze(r,e,`array expected, ${Nt(e)} found`)];const s=i.styleSpec;let l,h=[];if(e.length<1)return[new ze(r,e,"filter array must have at least 1 element")];switch(h=h.concat(Ls({key:`${r}[0]`,value:e[0],valueSpec:s.filter_operator,style:i.style,styleSpec:i.styleSpec})),fi(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&fi(e[1])==="$type"&&h.push(new ze(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&h.push(new ze(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(l=Nt(e[1]),l!=="string"&&h.push(new ze(`${r}[1]`,e[1],`string expected, ${l} found`)));for(let p=2;p<e.length;p++)l=Nt(e[p]),fi(e[1])==="$type"?h=h.concat(Ls({key:`${r}[${p}]`,value:e[p],valueSpec:s.geometry_type,style:i.style,styleSpec:i.styleSpec})):l!=="string"&&l!=="number"&&l!=="boolean"&&h.push(new ze(`${r}[${p}]`,e[p],`string, number, or boolean expected, ${l} found`));break;case"any":case"all":case"none":for(let p=1;p<e.length;p++)h=h.concat(Sl({key:`${r}[${p}]`,value:e[p],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":l=Nt(e[1]),e.length!==2?h.push(new ze(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):l!=="string"&&h.push(new ze(`${r}[1]`,e[1],`string expected, ${l} found`));break;case"within":l=Nt(e[1]),e.length!==2?h.push(new ze(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):l!=="object"&&h.push(new ze(`${r}[1]`,e[1],`object expected, ${l} found`))}return h}function Cl(i,e){const r=i.key,s=i.validateSpec,l=i.style,h=i.styleSpec,p=i.value,m=i.objectKey,y=h[`${e}_${i.layerType}`];if(!y)return[];const b=m.match(/^(.*)-transition$/);if(e==="paint"&&b&&y[b[1]]&&y[b[1]].transition)return s({key:r,value:p,valueSpec:h.transition,style:l,styleSpec:h});const T=i.valueSpec||y[m];if(!T)return[new ze(r,p,`unknown property "${m}"`)];let P;if(Nt(p)==="string"&&os(T)&&!T.tokens&&(P=/^{([^}]+)}$/.exec(p)))return[new ze(r,p,`"${m}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(P[1])} }\`.`)];const k=[];return i.layerType==="symbol"&&(m==="text-field"&&l&&!l.glyphs&&k.push(new ze(r,p,'use of "text-field" requires a style "glyphs" property')),m==="text-font"&&ci(Vn(p))&&fi(p.type)==="identity"&&k.push(new ze(r,p,'"text-font" does not support identity functions'))),k.concat(s({key:i.key,value:p,valueSpec:T,style:l,styleSpec:h,expressionContext:"property",propertyType:e,propertyKey:m}))}function Tl(i){return Cl(i,"paint")}function Il(i){return Cl(i,"layout")}function El(i){let e=[];const r=i.value,s=i.key,l=i.style,h=i.styleSpec;r.type||r.ref||e.push(new ze(s,r,'either "type" or "ref" is required'));let p=fi(r.type);const m=fi(r.ref);if(r.id){const y=fi(r.id);for(let b=0;b<i.arrayIndex;b++){const T=l.layers[b];fi(T.id)===y&&e.push(new ze(s,r.id,`duplicate layer id "${r.id}", previously used at line ${T.id.__line__}`))}}if("ref"in r){let y;["type","source","source-layer","filter","layout"].forEach(b=>{b in r&&e.push(new ze(s,r[b],`"${b}" is prohibited for ref layers`))}),l.layers.forEach(b=>{fi(b.id)===m&&(y=b)}),y?y.ref?e.push(new ze(s,r.ref,"ref cannot reference another ref layer")):p=fi(y.type):e.push(new ze(s,r.ref,`ref layer "${m}" not found`))}else if(p!=="background")if(r.source){const y=l.sources&&l.sources[r.source],b=y&&fi(y.type);y?b==="vector"&&p==="raster"?e.push(new ze(s,r.source,`layer "${r.id}" requires a raster source`)):b!=="raster-dem"&&p==="hillshade"?e.push(new ze(s,r.source,`layer "${r.id}" requires a raster-dem source`)):b==="raster"&&p!=="raster"?e.push(new ze(s,r.source,`layer "${r.id}" requires a vector source`)):b!=="vector"||r["source-layer"]?b==="raster-dem"&&p!=="hillshade"?e.push(new ze(s,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):p!=="line"||!r.paint||!r.paint["line-gradient"]||b==="geojson"&&y.lineMetrics||e.push(new ze(s,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new ze(s,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new ze(s,r.source,`source "${r.source}" not found`))}else e.push(new ze(s,r,'missing required property "source"'));return e=e.concat(gr({key:s,value:r,valueSpec:h.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${s}.type`,value:r.type,valueSpec:h.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:r,objectKey:"type"}),filter:cs,layout:y=>gr({layer:r,key:y.key,value:y.value,style:y.style,styleSpec:y.styleSpec,validateSpec:y.validateSpec,objectElementValidators:{"*":b=>Il(mt({layerType:p},b))}}),paint:y=>gr({layer:r,key:y.key,value:y.value,style:y.style,styleSpec:y.styleSpec,validateSpec:y.validateSpec,objectElementValidators:{"*":b=>Tl(mt({layerType:p},b))}})}})),e}function tn(i){const e=i.value,r=i.key,s=Nt(e);return s!=="string"?[new ze(r,e,`string expected, ${s} found`)]:[]}const Rs={promoteId:function({key:i,value:e}){if(Nt(e)==="string")return tn({key:i,value:e});{const r=[];for(const s in e)r.push(...tn({key:`${i}.${s}`,value:e[s]}));return r}}};function Ar(i){const e=i.value,r=i.key,s=i.styleSpec,l=i.style,h=i.validateSpec;if(!e.type)return[new ze(r,e,'"type" is required')];const p=fi(e.type);let m;switch(p){case"vector":case"raster":return m=gr({key:r,value:e,valueSpec:s[`source_${p.replace("-","_")}`],style:i.style,styleSpec:s,objectElementValidators:Rs,validateSpec:h}),m;case"raster-dem":return m=function(y){var b;const T=(b=y.sourceName)!==null&&b!==void 0?b:"",P=y.value,k=y.styleSpec,R=k.source_raster_dem,F=y.style;let j=[];const H=Nt(P);if(P===void 0)return j;if(H!=="object")return j.push(new ze("source_raster_dem",P,`object expected, ${H} found`)),j;const J=fi(P.encoding)==="custom",se=["redFactor","greenFactor","blueFactor","baseShift"],ee=y.value.encoding?`"${y.value.encoding}"`:"Default";for(const ce in P)!J&&se.includes(ce)?j.push(new ze(ce,P[ce],`In "${T}": "${ce}" is only valid when "encoding" is set to "custom". ${ee} encoding found`)):R[ce]?j=j.concat(y.validateSpec({key:ce,value:P[ce],valueSpec:R[ce],validateSpec:y.validateSpec,style:F,styleSpec:k})):j.push(new ze(ce,P[ce],`unknown property "${ce}"`));return j}({sourceName:r,value:e,style:i.style,styleSpec:s,validateSpec:h}),m;case"geojson":if(m=gr({key:r,value:e,valueSpec:s.source_geojson,style:l,styleSpec:s,validateSpec:h,objectElementValidators:Rs}),e.cluster)for(const y in e.clusterProperties){const[b,T]=e.clusterProperties[y],P=typeof b=="string"?[b,["accumulated"],["get",y]]:b;m.push(...Un({key:`${r}.${y}.map`,value:T,validateSpec:h,expressionContext:"cluster-map"})),m.push(...Un({key:`${r}.${y}.reduce`,value:P,validateSpec:h,expressionContext:"cluster-reduce"}))}return m;case"video":return gr({key:r,value:e,valueSpec:s.source_video,style:l,validateSpec:h,styleSpec:s});case"image":return gr({key:r,value:e,valueSpec:s.source_image,style:l,validateSpec:h,styleSpec:s});case"canvas":return[new ze(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ls({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:l,validateSpec:h,styleSpec:s})}}function Fs(i){const e=i.value,r=i.styleSpec,s=r.light,l=i.style;let h=[];const p=Nt(e);if(e===void 0)return h;if(p!=="object")return h=h.concat([new ze("light",e,`object expected, ${p} found`)]),h;for(const m in e){const y=m.match(/^(.*)-transition$/);h=h.concat(y&&s[y[1]]&&s[y[1]].transition?i.validateSpec({key:m,value:e[m],valueSpec:r.transition,validateSpec:i.validateSpec,style:l,styleSpec:r}):s[m]?i.validateSpec({key:m,value:e[m],valueSpec:s[m],validateSpec:i.validateSpec,style:l,styleSpec:r}):[new ze(m,e[m],`unknown property "${m}"`)])}return h}function Al(i){const e=i.value,r=i.styleSpec,s=r.terrain,l=i.style;let h=[];const p=Nt(e);if(e===void 0)return h;if(p!=="object")return h=h.concat([new ze("terrain",e,`object expected, ${p} found`)]),h;for(const m in e)h=h.concat(s[m]?i.validateSpec({key:m,value:e[m],valueSpec:s[m],validateSpec:i.validateSpec,style:l,styleSpec:r}):[new ze(m,e[m],`unknown property "${m}"`)]);return h}function Pl(i){let e=[];const r=i.value,s=i.key;if(Array.isArray(r)){const l=[],h=[];for(const p in r)r[p].id&&l.includes(r[p].id)&&e.push(new ze(s,r,`all the sprites' ids must be unique, but ${r[p].id} is duplicated`)),l.push(r[p].id),r[p].url&&h.includes(r[p].url)&&e.push(new ze(s,r,`all the sprites' URLs must be unique, but ${r[p].url} is duplicated`)),h.push(r[p].url),e=e.concat(gr({key:`${s}[${p}]`,value:r[p],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return e}return tn({key:s,value:r})}const Ml={"*":()=>[],array:ls,boolean:function(i){const e=i.value,r=i.key,s=Nt(e);return s!=="boolean"?[new ze(r,e,`boolean expected, ${s} found`)]:[]},number:Ds,color:function(i){const e=i.key,r=i.value,s=Nt(r);return s!=="string"?[new ze(e,r,`color expected, ${s} found`)]:qt.parse(String(r))?[]:[new ze(e,r,`color expected, "${r}" found`)]},constants:wl,enum:Ls,filter:cs,function:va,layer:El,object:gr,source:Ar,light:Fs,terrain:Al,string:tn,formatted:function(i){return tn(i).length===0?[]:Un(i)},resolvedImage:function(i){return tn(i).length===0?[]:Un(i)},padding:function(i){const e=i.key,r=i.value;if(Nt(r)==="array"){if(r.length<1||r.length>4)return[new ze(e,r,`padding requires 1 to 4 values; ${r.length} values found`)];const s={type:"number"};let l=[];for(let h=0;h<r.length;h++)l=l.concat(i.validateSpec({key:`${e}[${h}]`,value:r[h],validateSpec:i.validateSpec,valueSpec:s}));return l}return Ds({key:e,value:r,valueSpec:{}})},variableAnchorOffsetCollection:function(i){const e=i.key,r=i.value,s=Nt(r),l=i.styleSpec;if(s!=="array"||r.length<1||r.length%2!=0)return[new ze(e,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let h=[];for(let p=0;p<r.length;p+=2)h=h.concat(Ls({key:`${e}[${p}]`,value:r[p],valueSpec:l.layout_symbol["text-anchor"]})),h=h.concat(ls({key:`${e}[${p+1}]`,value:r[p+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:l}));return h},sprite:Pl};function dn(i){const e=i.value,r=i.valueSpec,s=i.styleSpec;return i.validateSpec=dn,r.expression&&ci(fi(e))?va(i):r.expression&&pa(Vn(e))?Un(i):r.type&&Ml[r.type]?Ml[r.type](i):gr(mt({},i,{valueSpec:r.type?s[r.type]:r}))}function kl(i){const e=i.value,r=i.key,s=tn(i);return s.length||(e.indexOf("{fontstack}")===-1&&s.push(new ze(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&s.push(new ze(r,e,'"glyphs" url must include a "{range}" token'))),s}function $r(i,e=me){let r=[];return r=r.concat(dn({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,validateSpec:dn,objectElementValidators:{glyphs:kl,"*":()=>[]}})),i.constants&&(r=r.concat(wl({key:"constants",value:i.constants,style:i,styleSpec:e,validateSpec:dn}))),xa(r)}function pn(i){return function(e){return i({...e,validateSpec:dn})}}function xa(i){return[].concat(i).sort((e,r)=>e.line-r.line)}function fn(i){return function(...e){return xa(i.apply(this,e))}}$r.source=fn(pn(Ar)),$r.sprite=fn(pn(Pl)),$r.glyphs=fn(pn(kl)),$r.light=fn(pn(Fs)),$r.terrain=fn(pn(Al)),$r.layer=fn(pn(El)),$r.filter=fn(pn(cs)),$r.paintProperty=fn(pn(Tl)),$r.layoutProperty=fn(pn(Il));const mn=$r,jc=mn.light,ho=mn.paintProperty,zl=mn.layoutProperty;function ba(i,e){let r=!1;if(e&&e.length)for(const s of e)i.fire(new mr(new Error(s.message))),r=!0;return r}class us{constructor(e,r,s){const l=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const p=new Int32Array(this.arrayBuffer);e=p[0],this.d=(r=p[1])+2*(s=p[2]);for(let y=0;y<this.d*this.d;y++){const b=p[3+y],T=p[3+y+1];l.push(b===T?null:p.subarray(b,T))}const m=p[3+l.length+1];this.keys=p.subarray(p[3+l.length],m),this.bboxes=p.subarray(m),this.insert=this._insertReadonly}else{this.d=r+2*s;for(let p=0;p<this.d*this.d;p++)l.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=e,this.padding=s,this.scale=r/e,this.uid=0;const h=s/r*e;this.min=-h,this.max=e+h}insert(e,r,s,l,h){this._forEachCell(r,s,l,h,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(r),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(h)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,r,s,l,h,p){this.cells[h].push(p)}query(e,r,s,l,h){const p=this.min,m=this.max;if(e<=p&&r<=p&&m<=s&&m<=l&&!h)return Array.prototype.slice.call(this.keys);{const y=[];return this._forEachCell(e,r,s,l,this._queryCell,y,{},h),y}}_queryCell(e,r,s,l,h,p,m,y){const b=this.cells[h];if(b!==null){const T=this.keys,P=this.bboxes;for(let k=0;k<b.length;k++){const R=b[k];if(m[R]===void 0){const F=4*R;(y?y(P[F+0],P[F+1],P[F+2],P[F+3]):e<=P[F+2]&&r<=P[F+3]&&s>=P[F+0]&&l>=P[F+1])?(m[R]=!0,p.push(T[R])):m[R]=!1}}}}_forEachCell(e,r,s,l,h,p,m,y){const b=this._convertToCellCoord(e),T=this._convertToCellCoord(r),P=this._convertToCellCoord(s),k=this._convertToCellCoord(l);for(let R=b;R<=P;R++)for(let F=T;F<=k;F++){const j=this.d*F+R;if((!y||y(this._convertFromCellCoord(R),this._convertFromCellCoord(F),this._convertFromCellCoord(R+1),this._convertFromCellCoord(F+1)))&&h.call(this,e,r,s,l,j,p,m,y))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,r=3+this.cells.length+1+1;let s=0;for(let p=0;p<this.cells.length;p++)s+=this.cells[p].length;const l=new Int32Array(r+s+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;let h=r;for(let p=0;p<e.length;p++){const m=e[p];l[3+p]=h,l.set(m,h),h+=m.length}return l[3+e.length]=h,l.set(this.keys,h),h+=this.keys.length,l[3+e.length+1]=h,l.set(this.bboxes,h),h+=this.bboxes.length,l.buffer}static serialize(e,r){const s=e.toArrayBuffer();return r&&r.push(s),{buffer:s}}static deserialize(e){return new us(e.buffer)}}const gn={};function Ge(i,e,r={}){if(gn[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),gn[i]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}Ge("Object",Object),Ge("TransferableGridIndex",us),Ge("Color",qt),Ge("Error",Error),Ge("AJAXError",gi),Ge("ResolvedImage",Zi),Ge("StylePropertyFunction",Ps),Ge("StyleExpression",ao,{omit:["_evaluator"]}),Ge("ZoomDependentExpression",ma),Ge("ZoomConstantExpression",oo),Ge("CompoundExpression",Nr,{omit:["_evaluate"]});for(const i in as)as[i]._classRegistryKey||Ge(`Expression_${i}`,as[i]);function wa(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function kn(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob)return i;if(wa(i)||Mi(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const r=i;return e&&e.push(r.buffer),r}if(i instanceof ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const r=[];for(const s of i)r.push(kn(s,e));return r}if(typeof i=="object"){const r=i.constructor,s=r._classRegistryKey;if(!s)throw new Error("can't serialize object of unregistered class");if(!gn[s])throw new Error(`${s} is not registered.`);const l=r.serialize?r.serialize(i,e):{};if(r.serialize){if(e&&l===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const h in i){if(!i.hasOwnProperty(h)||gn[s].omit.indexOf(h)>=0)continue;const p=i[h];l[h]=gn[s].shallow.indexOf(h)>=0?p:kn(p,e)}i instanceof Error&&(l.message=i.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(l.$name=s),l}throw new Error("can't serialize object of type "+typeof i)}function hs(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||wa(i)||Mi(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(hs);if(typeof i=="object"){const e=i.$name||"Object";if(!gn[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:r}=gn[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(i);const s=Object.create(r.prototype);for(const l of Object.keys(i)){if(l==="$name")continue;const h=i[l];s[l]=gn[e].shallow.indexOf(l)>=0?h:hs(h)}return s}throw new Error("can't deserialize object of type "+typeof i)}class Dl{constructor(){this.first=!0}update(e,r){const s=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=s,!0))}}const je={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function po(i){for(const e of i)if(mo(e.charCodeAt(0)))return!0;return!1}function fo(i){for(const e of i)if(!Vc(e.charCodeAt(0)))return!1;return!0}function Vc(i){return!(je.Arabic(i)||je["Arabic Supplement"](i)||je["Arabic Extended-A"](i)||je["Arabic Presentation Forms-A"](i)||je["Arabic Presentation Forms-B"](i))}function mo(i){return!(i!==746&&i!==747&&(i<4352||!(je["Bopomofo Extended"](i)||je.Bopomofo(i)||je["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||je["CJK Compatibility Ideographs"](i)||je["CJK Compatibility"](i)||je["CJK Radicals Supplement"](i)||je["CJK Strokes"](i)||!(!je["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||je["CJK Unified Ideographs Extension A"](i)||je["CJK Unified Ideographs"](i)||je["Enclosed CJK Letters and Months"](i)||je["Hangul Compatibility Jamo"](i)||je["Hangul Jamo Extended-A"](i)||je["Hangul Jamo Extended-B"](i)||je["Hangul Jamo"](i)||je["Hangul Syllables"](i)||je.Hiragana(i)||je["Ideographic Description Characters"](i)||je.Kanbun(i)||je["Kangxi Radicals"](i)||je["Katakana Phonetic Extensions"](i)||je.Katakana(i)&&i!==12540||!(!je["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!je["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||je["Unified Canadian Aboriginal Syllabics"](i)||je["Unified Canadian Aboriginal Syllabics Extended"](i)||je["Vertical Forms"](i)||je["Yijing Hexagram Symbols"](i)||je["Yi Syllables"](i)||je["Yi Radicals"](i))))}function Ll(i){return!(mo(i)||function(e){return!!(je["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||je["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||je["Letterlike Symbols"](e)||je["Number Forms"](e)||je["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||je["Control Pictures"](e)&&e!==9251||je["Optical Character Recognition"](e)||je["Enclosed Alphanumerics"](e)||je["Geometric Shapes"](e)||je["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||je["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||je["CJK Symbols and Punctuation"](e)||je.Katakana(e)||je["Private Use Area"](e)||je["CJK Compatibility Forms"](e)||je["Small Form Variants"](e)||je["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function Rl(i){return i>=1424&&i<=2303||je["Arabic Presentation Forms-A"](i)||je["Arabic Presentation Forms-B"](i)}function Fl(i,e){return!(!e&&Rl(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||je.Khmer(i))}function Uc(i){for(const e of i)if(Rl(e.charCodeAt(0)))return!0;return!1}const go="deferred",_o="loading",yo="loaded";let vo=null,_r="unavailable",zn=null;const Bs=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(_r="error"),vo&&vo(i)};function xo(){Os.fire(new nr("pluginStateChange",{pluginStatus:_r,pluginURL:zn}))}const Os=new Cr,bo=function(){return _r},Bl=function(){if(_r!==go||!zn)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");_r=_o,xo(),zn&&Wt({url:zn},i=>{i?Bs(i):(_r=yo,xo())})},Pr={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>_r===yo||Pr.applyArabicShaping!=null,isLoading:()=>_r===_o,setState(i){if(!ft())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");_r=i.pluginStatus,zn=i.pluginURL},isParsed(){if(!ft())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return Pr.applyArabicShaping!=null&&Pr.processBidirectionalText!=null&&Pr.processStyledBidirectionalText!=null},getPluginURL(){if(!ft())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return zn}};class ti{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Dl,this.transition={})}isSupportedScript(e){return function(r,s){for(const l of r)if(!Fl(l.charCodeAt(0),s))return!1;return!0}(e,Pr.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),s=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*r}}}class Sa{constructor(e,r){this.property=e,this.value=r,this.expression=function(s,l){if(ci(s))return new Ps(s,l);if(pa(s)){const h=lo(s,l);if(h.result==="error")throw new Error(h.value.map(p=>`${p.key}: ${p.message}`).join(", "));return h.value}{let h=s;return l.type==="color"&&typeof s=="string"?h=qt.parse(s):l.type!=="padding"||typeof s!="number"&&!Array.isArray(s)?l.type==="variableAnchorOffsetCollection"&&Array.isArray(s)&&(h=Br.parse(s)):h=Tr.parse(s),{kind:"constant",evaluate:()=>h}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,s){return this.property.possiblyEvaluate(this,e,r,s)}}class wo{constructor(e){this.property=e,this.value=new Sa(e,void 0)}transitioned(e,r){return new Nl(this.property,this.value,r,Ze({},e.transition,this.transition),e.now)}untransitioned(){return new Nl(this.property,this.value,null,{},0)}}class Ol{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return xt(this._values[e].value.value)}setValue(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new wo(this._values[e].property)),this._values[e].value=new Sa(this._values[e].property,r===null?void 0:xt(r))}getTransition(e){return xt(this._values[e].transition)}setTransition(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new wo(this._values[e].property)),this._values[e].transition=xt(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(e[r]=s);const l=this.getTransition(r);l!==void 0&&(e[`${r}-transition`]=l)}return e}transitioned(e,r){const s=new $l(this._properties);for(const l of Object.keys(this._values))s._values[l]=this._values[l].transitioned(e,r._values[l]);return s}untransitioned(){const e=new $l(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class Nl{constructor(e,r,s,l,h){this.property=e,this.value=r,this.begin=h+l.delay||0,this.end=this.begin+l.duration||0,e.specification.transition&&(l.delay||l.duration)&&(this.prior=s)}possiblyEvaluate(e,r,s){const l=e.now||0,h=this.value.possiblyEvaluate(e,r,s),p=this.prior;if(p){if(l>this.end)return this.prior=null,h;if(this.value.isDataDriven())return this.prior=null,h;if(l<this.begin)return p.possiblyEvaluate(e,r,s);{const m=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,r,s),h,function(y){if(y<=0)return 0;if(y>=1)return 1;const b=y*y,T=b*y;return 4*(y<.5?T:3*(y-b)+T-.75)}(m))}}return h}}class $l{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,s){const l=new Ca(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].possiblyEvaluate(e,r,s);return l}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class qc{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}hasValue(e){return this._values[e].value!==void 0}getValue(e){return xt(this._values[e].value)}setValue(e,r){this._values[e]=new Sa(this._values[e].property,r===null?void 0:xt(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(e[r]=s)}return e}possiblyEvaluate(e,r,s){const l=new Ca(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].possiblyEvaluate(e,r,s);return l}}class ar{constructor(e,r,s){this.property=e,this.value=r,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,s,l){return this.property.evaluate(this.value,this.parameters,e,r,s,l)}}class Ca{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class tt{constructor(e){this.specification=e}possiblyEvaluate(e,r){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(r)}interpolate(e,r,s){const l=Ir[this.specification.type];return l?l(e,r,s):e}}class ut{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,s,l){return new ar(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},s,l)}:e.expression,r)}interpolate(e,r,s){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new ar(this,{kind:"constant",value:void 0},e.parameters);const l=Ir[this.specification.type];if(l){const h=l(e.value.value,r.value.value,s);return new ar(this,{kind:"constant",value:h},e.parameters)}return e}evaluate(e,r,s,l,h,p){return e.kind==="constant"?e.value:e.evaluate(r,s,l,h,p)}}class Ns extends ut{possiblyEvaluate(e,r,s,l){if(e.value===void 0)return new ar(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const h=e.expression.evaluate(r,null,{},s,l),p=e.property.specification.type==="resolvedImage"&&typeof h!="string"?h.name:h,m=this._calculate(p,p,p,r);return new ar(this,{kind:"constant",value:m},r)}if(e.expression.kind==="camera"){const h=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new ar(this,{kind:"constant",value:h},r)}return new ar(this,e.expression,r)}evaluate(e,r,s,l,h,p){if(e.kind==="source"){const m=e.evaluate(r,s,l,h,p);return this._calculate(m,m,m,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},s,l),e.evaluate({zoom:Math.floor(r.zoom)},s,l),e.evaluate({zoom:Math.floor(r.zoom)+1},s,l),r):e.value}_calculate(e,r,s,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:s,to:r}}interpolate(e){return e}}class So{constructor(e){this.specification=e}possiblyEvaluate(e,r,s,l){if(e.value!==void 0){if(e.expression.kind==="constant"){const h=e.expression.evaluate(r,null,{},s,l);return this._calculate(h,h,h,r)}return this._calculate(e.expression.evaluate(new ti(Math.floor(r.zoom-1),r)),e.expression.evaluate(new ti(Math.floor(r.zoom),r)),e.expression.evaluate(new ti(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,s,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:s,to:r}}interpolate(e){return e}}class Co{constructor(e){this.specification=e}possiblyEvaluate(e,r,s,l){return!!e.expression.evaluate(r,null,{},s,l)}interpolate(){return!1}}class wi{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const s=e[r];s.specification.overridable&&this.overridableProperties.push(r);const l=this.defaultPropertyValues[r]=new Sa(s,void 0),h=this.defaultTransitionablePropertyValues[r]=new wo(s);this.defaultTransitioningPropertyValues[r]=h.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=l.possiblyEvaluate({})}}}Ge("DataDrivenProperty",ut),Ge("DataConstantProperty",tt),Ge("CrossFadedDataDrivenProperty",Ns),Ge("CrossFadedProperty",So),Ge("ColorRampProperty",Co);const To="-transition";class jr extends Cr{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new qc(r.layout)),r.paint)){this._transitionablePaint=new Ol(r.paint);for(const s in e.paint)this.setPaintProperty(s,e.paint[s],{validate:!1});for(const s in e.layout)this.setLayoutProperty(s,e.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ca(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,s={}){r!=null&&this._validate(zl,`layers.${this.id}.layout.${e}`,e,r,s)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return e.endsWith(To)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,s={}){if(r!=null&&this._validate(ho,`layers.${this.id}.paint.${e}`,e,r,s))return!1;if(e.endsWith(To))return this._transitionablePaint.setTransition(e.slice(0,-11),r||void 0),!1;{const l=this._transitionablePaint._values[e],h=l.property.specification["property-type"]==="cross-faded-data-driven",p=l.value.isDataDriven(),m=l.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const y=this._transitionablePaint._values[e].value;return y.isDataDriven()||p||h||this._handleOverridablePaintPropertyUpdate(e,m,y)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,r,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),it(e,(r,s)=>!(r===void 0||s==="layout"&&!Object.keys(r).length||s==="paint"&&!Object.keys(r).length))}_validate(e,r,s,l,h={}){return(!h||h.validate!==!1)&&ba(this,e.call(mn,{key:r,layerType:this.type,objectKey:s,value:l,styleSpec:me,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof ar&&os(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const jl={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class qn{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class mi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function hi(i,e=1){let r=0,s=0;return{members:i.map(l=>{const h=jl[l.type].BYTES_PER_ELEMENT,p=r=ds(r,Math.max(e,h)),m=l.components||1;return s=Math.max(s,h),r+=h*m,{name:l.name,type:l.type,components:m,offset:p}}),size:ds(r,Math.max(s,e)),alignment:e}}function ds(i,e){return Math.ceil(i/e)*e}class $s extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const l=2*e;return this.int16[l+0]=r,this.int16[l+1]=s,e}}$s.prototype.bytesPerElement=4,Ge("StructArrayLayout2i4",$s);class js extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,s)}emplace(e,r,s,l){const h=3*e;return this.int16[h+0]=r,this.int16[h+1]=s,this.int16[h+2]=l,e}}js.prototype.bytesPerElement=6,Ge("StructArrayLayout3i6",js);class Zn extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,s,l)}emplace(e,r,s,l,h){const p=4*e;return this.int16[p+0]=r,this.int16[p+1]=s,this.int16[p+2]=l,this.int16[p+3]=h,e}}Zn.prototype.bytesPerElement=8,Ge("StructArrayLayout4i8",Zn);class Io extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,l,h,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,s,l,h,p)}emplace(e,r,s,l,h,p,m){const y=6*e;return this.int16[y+0]=r,this.int16[y+1]=s,this.int16[y+2]=l,this.int16[y+3]=h,this.int16[y+4]=p,this.int16[y+5]=m,e}}Io.prototype.bytesPerElement=12,Ge("StructArrayLayout2i4i12",Io);class Eo extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,l,h,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,s,l,h,p)}emplace(e,r,s,l,h,p,m){const y=4*e,b=8*e;return this.int16[y+0]=r,this.int16[y+1]=s,this.uint8[b+4]=l,this.uint8[b+5]=h,this.uint8[b+6]=p,this.uint8[b+7]=m,e}}Eo.prototype.bytesPerElement=8,Ge("StructArrayLayout2i4ub8",Eo);class ps extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const l=2*e;return this.float32[l+0]=r,this.float32[l+1]=s,e}}ps.prototype.bytesPerElement=8,Ge("StructArrayLayout2f8",ps);class Ao extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,l,h,p,m,y,b,T){const P=this.length;return this.resize(P+1),this.emplace(P,e,r,s,l,h,p,m,y,b,T)}emplace(e,r,s,l,h,p,m,y,b,T,P){const k=10*e;return this.uint16[k+0]=r,this.uint16[k+1]=s,this.uint16[k+2]=l,this.uint16[k+3]=h,this.uint16[k+4]=p,this.uint16[k+5]=m,this.uint16[k+6]=y,this.uint16[k+7]=b,this.uint16[k+8]=T,this.uint16[k+9]=P,e}}Ao.prototype.bytesPerElement=20,Ge("StructArrayLayout10ui20",Ao);class Po extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,l,h,p,m,y,b,T,P,k){const R=this.length;return this.resize(R+1),this.emplace(R,e,r,s,l,h,p,m,y,b,T,P,k)}emplace(e,r,s,l,h,p,m,y,b,T,P,k,R){const F=12*e;return this.int16[F+0]=r,this.int16[F+1]=s,this.int16[F+2]=l,this.int16[F+3]=h,this.uint16[F+4]=p,this.uint16[F+5]=m,this.uint16[F+6]=y,this.uint16[F+7]=b,this.int16[F+8]=T,this.int16[F+9]=P,this.int16[F+10]=k,this.int16[F+11]=R,e}}Po.prototype.bytesPerElement=24,Ge("StructArrayLayout4i4ui4i24",Po);class $t extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,s)}emplace(e,r,s,l){const h=3*e;return this.float32[h+0]=r,this.float32[h+1]=s,this.float32[h+2]=l,e}}$t.prototype.bytesPerElement=12,Ge("StructArrayLayout3f12",$t);class u extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}u.prototype.bytesPerElement=4,Ge("StructArrayLayout1ul4",u);class t extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,l,h,p,m,y,b){const T=this.length;return this.resize(T+1),this.emplace(T,e,r,s,l,h,p,m,y,b)}emplace(e,r,s,l,h,p,m,y,b,T){const P=10*e,k=5*e;return this.int16[P+0]=r,this.int16[P+1]=s,this.int16[P+2]=l,this.int16[P+3]=h,this.int16[P+4]=p,this.int16[P+5]=m,this.uint32[k+3]=y,this.uint16[P+8]=b,this.uint16[P+9]=T,e}}t.prototype.bytesPerElement=20,Ge("StructArrayLayout6i1ul2ui20",t);class n extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,l,h,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,s,l,h,p)}emplace(e,r,s,l,h,p,m){const y=6*e;return this.int16[y+0]=r,this.int16[y+1]=s,this.int16[y+2]=l,this.int16[y+3]=h,this.int16[y+4]=p,this.int16[y+5]=m,e}}n.prototype.bytesPerElement=12,Ge("StructArrayLayout2i2i2i12",n);class o extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,s,l,h)}emplace(e,r,s,l,h,p){const m=4*e,y=8*e;return this.float32[m+0]=r,this.float32[m+1]=s,this.float32[m+2]=l,this.int16[y+6]=h,this.int16[y+7]=p,e}}o.prototype.bytesPerElement=16,Ge("StructArrayLayout2f1f2i16",o);class c extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,s,l)}emplace(e,r,s,l,h){const p=12*e,m=3*e;return this.uint8[p+0]=r,this.uint8[p+1]=s,this.float32[m+1]=l,this.float32[m+2]=h,e}}c.prototype.bytesPerElement=12,Ge("StructArrayLayout2ub2f12",c);class d extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,s)}emplace(e,r,s,l){const h=3*e;return this.uint16[h+0]=r,this.uint16[h+1]=s,this.uint16[h+2]=l,e}}d.prototype.bytesPerElement=6,Ge("StructArrayLayout3ui6",d);class g extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,l,h,p,m,y,b,T,P,k,R,F,j,H,J){const se=this.length;return this.resize(se+1),this.emplace(se,e,r,s,l,h,p,m,y,b,T,P,k,R,F,j,H,J)}emplace(e,r,s,l,h,p,m,y,b,T,P,k,R,F,j,H,J,se){const ee=24*e,ce=12*e,de=48*e;return this.int16[ee+0]=r,this.int16[ee+1]=s,this.uint16[ee+2]=l,this.uint16[ee+3]=h,this.uint32[ce+2]=p,this.uint32[ce+3]=m,this.uint32[ce+4]=y,this.uint16[ee+10]=b,this.uint16[ee+11]=T,this.uint16[ee+12]=P,this.float32[ce+7]=k,this.float32[ce+8]=R,this.uint8[de+36]=F,this.uint8[de+37]=j,this.uint8[de+38]=H,this.uint32[ce+10]=J,this.int16[ee+22]=se,e}}g.prototype.bytesPerElement=48,Ge("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",g);class _ extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,l,h,p,m,y,b,T,P,k,R,F,j,H,J,se,ee,ce,de,be,Ve,Je,$e,Oe,De,He){const Le=this.length;return this.resize(Le+1),this.emplace(Le,e,r,s,l,h,p,m,y,b,T,P,k,R,F,j,H,J,se,ee,ce,de,be,Ve,Je,$e,Oe,De,He)}emplace(e,r,s,l,h,p,m,y,b,T,P,k,R,F,j,H,J,se,ee,ce,de,be,Ve,Je,$e,Oe,De,He,Le){const Ae=32*e,st=16*e;return this.int16[Ae+0]=r,this.int16[Ae+1]=s,this.int16[Ae+2]=l,this.int16[Ae+3]=h,this.int16[Ae+4]=p,this.int16[Ae+5]=m,this.int16[Ae+6]=y,this.int16[Ae+7]=b,this.uint16[Ae+8]=T,this.uint16[Ae+9]=P,this.uint16[Ae+10]=k,this.uint16[Ae+11]=R,this.uint16[Ae+12]=F,this.uint16[Ae+13]=j,this.uint16[Ae+14]=H,this.uint16[Ae+15]=J,this.uint16[Ae+16]=se,this.uint16[Ae+17]=ee,this.uint16[Ae+18]=ce,this.uint16[Ae+19]=de,this.uint16[Ae+20]=be,this.uint16[Ae+21]=Ve,this.uint16[Ae+22]=Je,this.uint32[st+12]=$e,this.float32[st+13]=Oe,this.float32[st+14]=De,this.uint16[Ae+30]=He,this.uint16[Ae+31]=Le,e}}_.prototype.bytesPerElement=64,Ge("StructArrayLayout8i15ui1ul2f2ui64",_);class x extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}x.prototype.bytesPerElement=4,Ge("StructArrayLayout1f4",x);class S extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,s)}emplace(e,r,s,l){const h=3*e;return this.uint16[6*e+0]=r,this.float32[h+1]=s,this.float32[h+2]=l,e}}S.prototype.bytesPerElement=12,Ge("StructArrayLayout1ui2f12",S);class I extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,s)}emplace(e,r,s,l){const h=4*e;return this.uint32[2*e+0]=r,this.uint16[h+2]=s,this.uint16[h+3]=l,e}}I.prototype.bytesPerElement=8,Ge("StructArrayLayout1ul2ui8",I);class A extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const l=2*e;return this.uint16[l+0]=r,this.uint16[l+1]=s,e}}A.prototype.bytesPerElement=4,Ge("StructArrayLayout2ui4",A);class L extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}L.prototype.bytesPerElement=2,Ge("StructArrayLayout1ui2",L);class U extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,s,l)}emplace(e,r,s,l,h){const p=4*e;return this.float32[p+0]=r,this.float32[p+1]=s,this.float32[p+2]=l,this.float32[p+3]=h,e}}U.prototype.bytesPerElement=16,Ge("StructArrayLayout4f16",U);class V extends qn{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new he(this.anchorPointX,this.anchorPointY)}}V.prototype.size=20;class Z extends t{get(e){return new V(this,e)}}Ge("CollisionBoxArray",Z);class $ extends qn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}$.prototype.size=48;class ie extends g{get(e){return new $(this,e)}}Ge("PlacedSymbolArray",ie);class ue extends qn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}ue.prototype.size=64;class K extends _{get(e){return new ue(this,e)}}Ge("SymbolInstanceArray",K);class re extends x{getoffsetX(e){return this.float32[1*e+0]}}Ge("GlyphOffsetArray",re);class pe extends js{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Ge("SymbolLineVertexArray",pe);class fe extends qn{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}fe.prototype.size=12;class xe extends S{get(e){return new fe(this,e)}}Ge("TextAnchorOffsetArray",xe);class Ee extends qn{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Ee.prototype.size=8;class Ce extends I{get(e){return new Ee(this,e)}}Ge("FeatureIndexArray",Ce);class Me extends $s{}class Ke extends $s{}class Tt extends $s{}class Be extends Io{}class ht extends Eo{}class Ye extends ps{}class Zt extends Ao{}class Ct extends Po{}class bt extends $t{}class It extends u{}class yi extends n{}class ei extends c{}class Gi extends d{}class zi extends A{}const Si=hi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Mr}=Si;class ii{constructor(e=[]){this.segments=e}prepareSegment(e,r,s,l){let h=this.segments[this.segments.length-1];return e>ii.MAX_VERTEX_ARRAY_LENGTH&&gt(`Max vertices per segment is ${ii.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!h||h.vertexLength+e>ii.MAX_VERTEX_ARRAY_LENGTH||h.sortKey!==l)&&(h={vertexOffset:r.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},l!==void 0&&(h.sortKey=l),this.segments.push(h)),h}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,s,l){return new ii([{vertexOffset:e,primitiveOffset:r,vertexLength:s,primitiveLength:l,vaos:{},sortKey:0}])}}function rn(i,e){return 256*(i=rt(Math.floor(i),0,255))+rt(Math.floor(e),0,255)}ii.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ge("SegmentVector",ii);const nn=hi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Dn={exports:{}},Gn={exports:{}};Gn.exports=function(i,e){var r,s,l,h,p,m,y,b;for(s=i.length-(r=3&i.length),l=e,p=3432918353,m=461845907,b=0;b<s;)y=255&i.charCodeAt(b)|(255&i.charCodeAt(++b))<<8|(255&i.charCodeAt(++b))<<16|(255&i.charCodeAt(++b))<<24,++b,l=27492+(65535&(h=5*(65535&(l=(l^=y=(65535&(y=(y=(65535&y)*p+(((y>>>16)*p&65535)<<16)&4294967295)<<15|y>>>17))*m+(((y>>>16)*m&65535)<<16)&4294967295)<<13|l>>>19))+((5*(l>>>16)&65535)<<16)&4294967295))+((58964+(h>>>16)&65535)<<16);switch(y=0,r){case 3:y^=(255&i.charCodeAt(b+2))<<16;case 2:y^=(255&i.charCodeAt(b+1))<<8;case 1:l^=y=(65535&(y=(y=(65535&(y^=255&i.charCodeAt(b)))*p+(((y>>>16)*p&65535)<<16)&4294967295)<<15|y>>>17))*m+(((y>>>16)*m&65535)<<16)&4294967295}return l^=i.length,l=2246822507*(65535&(l^=l>>>16))+((2246822507*(l>>>16)&65535)<<16)&4294967295,l=3266489909*(65535&(l^=l>>>13))+((3266489909*(l>>>16)&65535)<<16)&4294967295,(l^=l>>>16)>>>0};var fs=Gn.exports,Qi={exports:{}};Qi.exports=function(i,e){for(var r,s=i.length,l=e^s,h=0;s>=4;)r=1540483477*(65535&(r=255&i.charCodeAt(h)|(255&i.charCodeAt(++h))<<8|(255&i.charCodeAt(++h))<<16|(255&i.charCodeAt(++h))<<24))+((1540483477*(r>>>16)&65535)<<16),l=1540483477*(65535&l)+((1540483477*(l>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),s-=4,++h;switch(s){case 3:l^=(255&i.charCodeAt(h+2))<<16;case 2:l^=(255&i.charCodeAt(h+1))<<8;case 1:l=1540483477*(65535&(l^=255&i.charCodeAt(h)))+((1540483477*(l>>>16)&65535)<<16)}return l=1540483477*(65535&(l^=l>>>13))+((1540483477*(l>>>16)&65535)<<16),(l^=l>>>15)>>>0};var Hi=fs,or=Qi.exports;Dn.exports=Hi,Dn.exports.murmur3=Hi,Dn.exports.murmur2=or;var Hn=B(Dn.exports);class vi{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,s,l){this.ids.push(Di(e)),this.positions.push(r,s,l)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=Di(e);let s=0,l=this.ids.length-1;for(;s<l;){const p=s+l>>1;this.ids[p]>=r?l=p:s=p+1}const h=[];for(;this.ids[s]===r;)h.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return h}static serialize(e,r){const s=new Float64Array(e.ids),l=new Uint32Array(e.positions);return yr(s,l,0,s.length-1),r&&r.push(s.buffer,l.buffer),{ids:s,positions:l}}static deserialize(e){const r=new vi;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function Di(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:Hn(String(i))}function yr(i,e,r,s){for(;r<s;){const l=i[r+s>>1];let h=r-1,p=s+1;for(;;){do h++;while(i[h]<l);do p--;while(i[p]>l);if(h>=p)break;xi(i,h,p),xi(e,3*h,3*p),xi(e,3*h+1,3*p+1),xi(e,3*h+2,3*p+2)}p-r<s-p?(yr(i,e,r,p),r=p+1):(yr(i,e,p+1,s),s=p)}}function xi(i,e,r){const s=i[e];i[e]=i[r],i[r]=s}Ge("FeaturePositionMap",vi);class Wn{constructor(e,r){this.gl=e.gl,this.location=r}}class Ta extends Wn{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Vl extends Wn{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Ul extends Wn{constructor(e,r){super(e,r),this.current=qt.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Zc=new Float32Array(16);function Mo(i){return[rn(255*i.r,255*i.g),rn(255*i.b,255*i.a)]}class sn{constructor(e,r,s){this.value=e,this.uniformNames=r.map(l=>`u_${l}`),this.type=s}setUniform(e,r,s){e.set(s.constantOr(this.value))}getBinding(e,r,s){return this.type==="color"?new Ul(e,r):new Ta(e,r)}}class Xn{constructor(e,r){this.uniformNames=r.map(s=>`u_${s}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=e.tlbr}setUniform(e,r,s,l){const h=l==="u_pattern_to"?this.patternTo:l==="u_pattern_from"?this.patternFrom:l==="u_pixel_ratio_to"?this.pixelRatioTo:l==="u_pixel_ratio_from"?this.pixelRatioFrom:null;h&&e.set(h)}getBinding(e,r,s){return s.substr(0,9)==="u_pattern"?new Vl(e,r):new Ta(e,r)}}class an{constructor(e,r,s,l){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=r.map(h=>({name:`a_${h}`,type:"Float32",components:s==="color"?2:1,offset:0})),this.paintVertexArray=new l}populatePaintArray(e,r,s,l,h){const p=this.paintVertexArray.length,m=this.expression.evaluate(new ti(0),r,{},l,[],h);this.paintVertexArray.resize(e),this._setPaintValue(p,e,m)}updatePaintArray(e,r,s,l){const h=this.expression.evaluate({zoom:0},s,l);this._setPaintValue(e,r,h)}_setPaintValue(e,r,s){if(this.type==="color"){const l=Mo(s);for(let h=e;h<r;h++)this.paintVertexArray.emplace(h,l[0],l[1])}else{for(let l=e;l<r;l++)this.paintVertexArray.emplace(l,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Vr{constructor(e,r,s,l,h,p){this.expression=e,this.uniformNames=r.map(m=>`u_${m}_t`),this.type=s,this.useIntegerZoom=l,this.zoom=h,this.maxValue=0,this.paintVertexAttributes=r.map(m=>({name:`a_${m}`,type:"Float32",components:s==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,r,s,l,h){const p=this.expression.evaluate(new ti(this.zoom),r,{},l,[],h),m=this.expression.evaluate(new ti(this.zoom+1),r,{},l,[],h),y=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(y,e,p,m)}updatePaintArray(e,r,s,l){const h=this.expression.evaluate({zoom:this.zoom},s,l),p=this.expression.evaluate({zoom:this.zoom+1},s,l);this._setPaintValue(e,r,h,p)}_setPaintValue(e,r,s,l){if(this.type==="color"){const h=Mo(s),p=Mo(l);for(let m=e;m<r;m++)this.paintVertexArray.emplace(m,h[0],h[1],p[0],p[1])}else{for(let h=e;h<r;h++)this.paintVertexArray.emplace(h,s,l);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const s=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,l=rt(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);e.set(l)}getBinding(e,r,s){return new Ta(e,r)}}class on{constructor(e,r,s,l,h,p){this.expression=e,this.type=r,this.useIntegerZoom=s,this.zoom=l,this.layerId=p,this.zoomInPaintVertexArray=new h,this.zoomOutPaintVertexArray=new h}populatePaintArray(e,r,s){const l=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(l,e,r.patterns&&r.patterns[this.layerId],s)}updatePaintArray(e,r,s,l,h){this._setPaintValues(e,r,s.patterns&&s.patterns[this.layerId],h)}_setPaintValues(e,r,s,l){if(!l||!s)return;const{min:h,mid:p,max:m}=s,y=l[h],b=l[p],T=l[m];if(y&&b&&T)for(let P=e;P<r;P++)this.zoomInPaintVertexArray.emplace(P,b.tl[0],b.tl[1],b.br[0],b.br[1],y.tl[0],y.tl[1],y.br[0],y.br[1],b.pixelRatio,y.pixelRatio),this.zoomOutPaintVertexArray.emplace(P,b.tl[0],b.tl[1],b.br[0],b.br[1],T.tl[0],T.tl[1],T.br[0],T.br[1],b.pixelRatio,T.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,nn.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,nn.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ko{constructor(e,r,s){this.binders={},this._buffers=[];const l=[];for(const h in e.paint._values){if(!s(h))continue;const p=e.paint.get(h);if(!(p instanceof ar&&os(p.property.specification)))continue;const m=Xf(h,e.type),y=p.value,b=p.property.specification.type,T=p.property.useIntegerZoom,P=p.property.specification["property-type"],k=P==="cross-faded"||P==="cross-faded-data-driven";if(y.kind==="constant")this.binders[h]=k?new Xn(y.value,m):new sn(y.value,m,b),l.push(`/u_${h}`);else if(y.kind==="source"||k){const R=Ih(h,b,"source");this.binders[h]=k?new on(y,b,T,r,R,e.id):new an(y,m,b,R),l.push(`/a_${h}`)}else{const R=Ih(h,b,"composite");this.binders[h]=new Vr(y,m,b,T,r,R),l.push(`/z_${h}`)}}this.cacheKey=l.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof an||r instanceof Vr?r.maxValue:0}populatePaintArrays(e,r,s,l,h){for(const p in this.binders){const m=this.binders[p];(m instanceof an||m instanceof Vr||m instanceof on)&&m.populatePaintArray(e,r,s,l,h)}}setConstantPatternPositions(e,r){for(const s in this.binders){const l=this.binders[s];l instanceof Xn&&l.setConstantPatternPositions(e,r)}}updatePaintArrays(e,r,s,l,h){let p=!1;for(const m in e){const y=r.getPositions(m);for(const b of y){const T=s.feature(b.index);for(const P in this.binders){const k=this.binders[P];if((k instanceof an||k instanceof Vr||k instanceof on)&&k.expression.isStateDependent===!0){const R=l.paint.get(P);k.expression=R.value,k.updatePaintArray(b.start,b.end,T,e[m],h),p=!0}}}}return p}defines(){const e=[];for(const r in this.binders){const s=this.binders[r];(s instanceof sn||s instanceof Xn)&&e.push(...s.uniformNames.map(l=>`#define HAS_UNIFORM_${l}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof an||s instanceof Vr)for(let l=0;l<s.paintVertexAttributes.length;l++)e.push(s.paintVertexAttributes[l].name);else if(s instanceof on)for(let l=0;l<nn.members.length;l++)e.push(nn.members[l].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof sn||s instanceof Xn||s instanceof Vr)for(const l of s.uniformNames)e.push(l)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const s=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof sn||h instanceof Xn||h instanceof Vr){for(const p of h.uniformNames)if(r[p]){const m=h.getBinding(e,r[p],p);s.push({name:p,property:l,binding:m})}}}return s}setUniforms(e,r,s,l){for(const{name:h,property:p,binding:m}of r)this.binders[p].setUniform(m,l,s.get(p),h)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const s=this.binders[r];if(e&&s instanceof on){const l=e.fromScale===2?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;l&&this._buffers.push(l)}else(s instanceof an||s instanceof Vr)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(e){for(const r in this.binders){const s=this.binders[r];(s instanceof an||s instanceof Vr||s instanceof on)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof an||r instanceof Vr||r instanceof on)&&r.destroy()}}}class _n{constructor(e,r,s=()=>!0){this.programConfigurations={};for(const l of e)this.programConfigurations[l.id]=new ko(l,r,s);this.needsUpload=!1,this._featureMap=new vi,this._bufferOffset=0}populatePaintArrays(e,r,s,l,h,p){for(const m in this.programConfigurations)this.programConfigurations[m].populatePaintArrays(e,r,l,h,p);r.id!==void 0&&this._featureMap.add(r.id,s,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,s,l){for(const h of s)this.needsUpload=this.programConfigurations[h.id].updatePaintArrays(e,this._featureMap,r,h,l)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Xf(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function Ih(i,e,r){const s={color:{source:ps,composite:U},number:{source:x,composite:ps}},l=function(h){return{"line-pattern":{source:Zt,composite:Zt},"fill-pattern":{source:Zt,composite:Zt},"fill-extrusion-pattern":{source:Zt,composite:Zt}}[h]}(i);return l&&l[r]||s[e][r]}Ge("ConstantBinder",sn),Ge("CrossFadedConstantBinder",Xn),Ge("SourceExpressionBinder",an),Ge("CrossFadedCompositeBinder",on),Ge("CompositeExpressionBinder",Vr),Ge("ProgramConfiguration",ko,{omit:["_buffers"]}),Ge("ProgramConfigurationSet",_n);const Ai=8192,Gc=Math.pow(2,14)-1,Eh=-Gc-1;function Vs(i){const e=Ai/i.extent,r=i.loadGeometry();for(let s=0;s<r.length;s++){const l=r[s];for(let h=0;h<l.length;h++){const p=l[h],m=Math.round(p.x*e),y=Math.round(p.y*e);p.x=rt(m,Eh,Gc),p.y=rt(y,Eh,Gc),(m<p.x||m>p.x+1||y<p.y||y>p.y+1)&&gt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function Us(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?Vs(i):[]}}function ql(i,e,r,s,l){i.emplaceBack(2*e+(s+1)/2,2*r+(l+1)/2)}class Hc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Ke,this.indexArray=new Gi,this.segments=new ii,this.programConfigurations=new _n(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){const l=this.layers[0],h=[];let p=null,m=!1;l.type==="circle"&&(p=l.layout.get("circle-sort-key"),m=!p.isConstant());for(const{feature:y,id:b,index:T,sourceLayerIndex:P}of e){const k=this.layers[0]._featureFilter.needGeometry,R=Us(y,k);if(!this.layers[0]._featureFilter.filter(new ti(this.zoom),R,s))continue;const F=m?p.evaluate(R,{},s):void 0,j={id:b,properties:y.properties,type:y.type,sourceLayerIndex:P,index:T,geometry:k?R.geometry:Vs(y),patterns:{},sortKey:F};h.push(j)}m&&h.sort((y,b)=>y.sortKey-b.sortKey);for(const y of h){const{geometry:b,index:T,sourceLayerIndex:P}=y,k=e[T].feature;this.addFeature(y,b,T,s),r.featureIndex.insert(k,b,T,P,this.index)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Mr),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,s,l){for(const h of r)for(const p of h){const m=p.x,y=p.y;if(m<0||m>=Ai||y<0||y>=Ai)continue;const b=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),T=b.vertexLength;ql(this.layoutVertexArray,m,y,-1,-1),ql(this.layoutVertexArray,m,y,1,-1),ql(this.layoutVertexArray,m,y,1,1),ql(this.layoutVertexArray,m,y,-1,1),this.indexArray.emplaceBack(T,T+1,T+2),this.indexArray.emplaceBack(T,T+3,T+2),b.vertexLength+=4,b.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},l)}}function Ah(i,e){for(let r=0;r<i.length;r++)if(Ia(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(Ia(i,e[r]))return!0;return!!Wc(i,e)}function Kf(i,e,r){return!!Ia(i,e)||!!Xc(e,i,r)}function Ph(i,e){if(i.length===1)return kh(e,i[0]);for(let r=0;r<e.length;r++){const s=e[r];for(let l=0;l<s.length;l++)if(Ia(i,s[l]))return!0}for(let r=0;r<i.length;r++)if(kh(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(Wc(i,e[r]))return!0;return!1}function Jf(i,e,r){if(i.length>1){if(Wc(i,e))return!0;for(let s=0;s<e.length;s++)if(Xc(e[s],i,r))return!0}for(let s=0;s<i.length;s++)if(Xc(i[s],e,r))return!0;return!1}function Wc(i,e){if(i.length===0||e.length===0)return!1;for(let r=0;r<i.length-1;r++){const s=i[r],l=i[r+1];for(let h=0;h<e.length-1;h++)if(Yf(s,l,e[h],e[h+1]))return!0}return!1}function Yf(i,e,r,s){return Pt(i,r,s)!==Pt(e,r,s)&&Pt(i,e,r)!==Pt(i,e,s)}function Xc(i,e,r){const s=r*r;if(e.length===1)return i.distSqr(e[0])<s;for(let l=1;l<e.length;l++)if(Mh(i,e[l-1],e[l])<s)return!0;return!1}function Mh(i,e,r){const s=e.distSqr(r);if(s===0)return i.distSqr(e);const l=((i.x-e.x)*(r.x-e.x)+(i.y-e.y)*(r.y-e.y))/s;return i.distSqr(l<0?e:l>1?r:r.sub(e)._mult(l)._add(e))}function kh(i,e){let r,s,l,h=!1;for(let p=0;p<i.length;p++){r=i[p];for(let m=0,y=r.length-1;m<r.length;y=m++)s=r[m],l=r[y],s.y>e.y!=l.y>e.y&&e.x<(l.x-s.x)*(e.y-s.y)/(l.y-s.y)+s.x&&(h=!h)}return h}function Ia(i,e){let r=!1;for(let s=0,l=i.length-1;s<i.length;l=s++){const h=i[s],p=i[l];h.y>e.y!=p.y>e.y&&e.x<(p.x-h.x)*(e.y-h.y)/(p.y-h.y)+h.x&&(r=!r)}return r}function Qf(i,e,r){const s=r[0],l=r[2];if(i.x<s.x&&e.x<s.x||i.x>l.x&&e.x>l.x||i.y<s.y&&e.y<s.y||i.y>l.y&&e.y>l.y)return!1;const h=Pt(i,e,r[0]);return h!==Pt(i,e,r[1])||h!==Pt(i,e,r[2])||h!==Pt(i,e,r[3])}function zo(i,e,r){const s=e.paint.get(i).value;return s.kind==="constant"?s.value:r.programConfigurations.get(e.id).getMaxValue(i)}function Zl(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Gl(i,e,r,s,l){if(!e[0]&&!e[1])return i;const h=he.convert(e)._mult(l);r==="viewport"&&h._rotate(-s);const p=[];for(let m=0;m<i.length;m++)p.push(i[m].sub(h));return p}let zh,Dh;Ge("CircleBucket",Hc,{omit:["layers"]});var em={get paint(){return Dh=Dh||new wi({"circle-radius":new ut(me.paint_circle["circle-radius"]),"circle-color":new ut(me.paint_circle["circle-color"]),"circle-blur":new ut(me.paint_circle["circle-blur"]),"circle-opacity":new ut(me.paint_circle["circle-opacity"]),"circle-translate":new tt(me.paint_circle["circle-translate"]),"circle-translate-anchor":new tt(me.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new tt(me.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new tt(me.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ut(me.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ut(me.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ut(me.paint_circle["circle-stroke-opacity"])})},get layout(){return zh=zh||new wi({"circle-sort-key":new ut(me.layout_circle["circle-sort-key"])})}},vr=1e-6,Ea=typeof Float32Array<"u"?Float32Array:Array;function Kc(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Lh(i,e,r){var s=e[0],l=e[1],h=e[2],p=e[3],m=e[4],y=e[5],b=e[6],T=e[7],P=e[8],k=e[9],R=e[10],F=e[11],j=e[12],H=e[13],J=e[14],se=e[15],ee=r[0],ce=r[1],de=r[2],be=r[3];return i[0]=ee*s+ce*m+de*P+be*j,i[1]=ee*l+ce*y+de*k+be*H,i[2]=ee*h+ce*b+de*R+be*J,i[3]=ee*p+ce*T+de*F+be*se,i[4]=(ee=r[4])*s+(ce=r[5])*m+(de=r[6])*P+(be=r[7])*j,i[5]=ee*l+ce*y+de*k+be*H,i[6]=ee*h+ce*b+de*R+be*J,i[7]=ee*p+ce*T+de*F+be*se,i[8]=(ee=r[8])*s+(ce=r[9])*m+(de=r[10])*P+(be=r[11])*j,i[9]=ee*l+ce*y+de*k+be*H,i[10]=ee*h+ce*b+de*R+be*J,i[11]=ee*p+ce*T+de*F+be*se,i[12]=(ee=r[12])*s+(ce=r[13])*m+(de=r[14])*P+(be=r[15])*j,i[13]=ee*l+ce*y+de*k+be*H,i[14]=ee*h+ce*b+de*R+be*J,i[15]=ee*p+ce*T+de*F+be*se,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var Do,tm=Lh;function Hl(i,e,r){var s=e[0],l=e[1],h=e[2],p=e[3];return i[0]=r[0]*s+r[4]*l+r[8]*h+r[12]*p,i[1]=r[1]*s+r[5]*l+r[9]*h+r[13]*p,i[2]=r[2]*s+r[6]*l+r[10]*h+r[14]*p,i[3]=r[3]*s+r[7]*l+r[11]*h+r[15]*p,i}Do=new Ea(4),Ea!=Float32Array&&(Do[0]=0,Do[1]=0,Do[2]=0,Do[3]=0);class im extends jr{constructor(e){super(e,em)}createBucket(e){return new Hc(e)}queryRadius(e){const r=e;return zo("circle-radius",this,r)+zo("circle-stroke-width",this,r)+Zl(this.paint.get("circle-translate"))}queryIntersectsFeature(e,r,s,l,h,p,m,y){const b=Gl(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,m),T=this.paint.get("circle-radius").evaluate(r,s)+this.paint.get("circle-stroke-width").evaluate(r,s),P=this.paint.get("circle-pitch-alignment")==="map",k=P?b:function(F,j){return F.map(H=>Rh(H,j))}(b,y),R=P?T*m:T;for(const F of l)for(const j of F){const H=P?j:Rh(j,y);let J=R;const se=Hl([],[j.x,j.y,0,1],y);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?J*=se[3]/p.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(J*=p.cameraToCenterDistance/se[3]),Kf(k,H,J))return!0}return!1}}function Rh(i,e){const r=Hl([],[i.x,i.y,0,1],e);return new he(r[0]/r[3],r[1]/r[3])}class Fh extends Hc{}let Bh;Ge("HeatmapBucket",Fh,{omit:["layers"]});var rm={get paint(){return Bh=Bh||new wi({"heatmap-radius":new ut(me.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ut(me.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new tt(me.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Co(me.paint_heatmap["heatmap-color"]),"heatmap-opacity":new tt(me.paint_heatmap["heatmap-opacity"])})}};function Jc(i,{width:e,height:r},s,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==e*r*s)throw new RangeError(`mismatched image size. expected: ${l.length} but got: ${e*r*s}`)}else l=new Uint8Array(e*r*s);return i.width=e,i.height=r,i.data=l,i}function Oh(i,{width:e,height:r},s){if(e===i.width&&r===i.height)return;const l=Jc({},{width:e,height:r},s);Yc(i,l,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,r)},s),i.width=e,i.height=r,i.data=l.data}function Yc(i,e,r,s,l,h){if(l.width===0||l.height===0)return e;if(l.width>i.width||l.height>i.height||r.x>i.width-l.width||r.y>i.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>e.width||l.height>e.height||s.x>e.width-l.width||s.y>e.height-l.height)throw new RangeError("out of range destination coordinates for image copy");const p=i.data,m=e.data;if(p===m)throw new Error("srcData equals dstData, so image is already copied");for(let y=0;y<l.height;y++){const b=((r.y+y)*i.width+r.x)*h,T=((s.y+y)*e.width+s.x)*h;for(let P=0;P<l.width*h;P++)m[T+P]=p[b+P]}return e}class Lo{constructor(e,r){Jc(this,e,1,r)}resize(e){Oh(this,e,1)}clone(){return new Lo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,s,l,h){Yc(e,r,s,l,h,1)}}class Gr{constructor(e,r){Jc(this,e,4,r)}resize(e){Oh(this,e,4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Gr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,s,l,h){Yc(e,r,s,l,h,4)}}function Nh(i){const e={},r=i.resolution||256,s=i.clips?i.clips.length:1,l=i.image||new Gr({width:r,height:s});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const h=(p,m,y)=>{e[i.evaluationKey]=y;const b=i.expression.evaluate(e);l.data[p+m+0]=Math.floor(255*b.r/b.a),l.data[p+m+1]=Math.floor(255*b.g/b.a),l.data[p+m+2]=Math.floor(255*b.b/b.a),l.data[p+m+3]=Math.floor(255*b.a)};if(i.clips)for(let p=0,m=0;p<s;++p,m+=4*r)for(let y=0,b=0;y<r;y++,b+=4){const T=y/(r-1),{start:P,end:k}=i.clips[p];h(m,b,P*(1-T)+k*T)}else for(let p=0,m=0;p<r;p++,m+=4)h(0,m,p/(r-1));return l}Ge("AlphaImage",Lo),Ge("RGBAImage",Gr);class nm extends jr{createBucket(e){return new Fh(e)}constructor(e){super(e,rm),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Nh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let $h;var sm={get paint(){return $h=$h||new wi({"hillshade-illumination-direction":new tt(me.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new tt(me.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new tt(me.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new tt(me.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new tt(me.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new tt(me.paint_hillshade["hillshade-accent-color"])})}};class am extends jr{constructor(e){super(e,sm)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const om=hi([{name:"a_pos",components:2,type:"Int16"}],4),{members:lm}=om;var Qc={exports:{}};function Wl(i,e,r){r=r||2;var s,l,h,p,m,y,b,T=e&&e.length,P=T?e[0]*r:i.length,k=jh(i,0,P,r,!0),R=[];if(!k||k.next===k.prev)return R;if(T&&(k=function(j,H,J,se){var ee,ce,de,be=[];for(ee=0,ce=H.length;ee<ce;ee++)(de=jh(j,H[ee]*se,ee<ce-1?H[ee+1]*se:j.length,se,!1))===de.next&&(de.steiner=!0),be.push(gm(de));for(be.sort(pm),ee=0;ee<be.length;ee++)J=fm(be[ee],J);return J}(i,e,k,r)),i.length>80*r){s=h=i[0],l=p=i[1];for(var F=r;F<P;F+=r)(m=i[F])<s&&(s=m),(y=i[F+1])<l&&(l=y),m>h&&(h=m),y>p&&(p=y);b=(b=Math.max(h-s,p-l))!==0?32767/b:0}return Ro(k,R,r,s,l,b,0),R}function jh(i,e,r,s,l){var h,p;if(l===iu(i,e,r,s)>0)for(h=e;h<r;h+=s)p=qh(h,i[h],i[h+1],p);else for(h=r-s;h>=e;h-=s)p=qh(h,i[h],i[h+1],p);return p&&Xl(p,p.next)&&(Bo(p),p=p.next),p}function qs(i,e){if(!i)return i;e||(e=i);var r,s=i;do if(r=!1,s.steiner||!Xl(s,s.next)&&Ci(s.prev,s,s.next)!==0)s=s.next;else{if(Bo(s),(s=e=s.prev)===s.next)break;r=!0}while(r||s!==e);return e}function Ro(i,e,r,s,l,h,p){if(i){!p&&h&&function(T,P,k,R){var F=T;do F.z===0&&(F.z=eu(F.x,F.y,P,k,R)),F.prevZ=F.prev,F.nextZ=F.next,F=F.next;while(F!==T);F.prevZ.nextZ=null,F.prevZ=null,function(j){var H,J,se,ee,ce,de,be,Ve,Je=1;do{for(J=j,j=null,ce=null,de=0;J;){for(de++,se=J,be=0,H=0;H<Je&&(be++,se=se.nextZ);H++);for(Ve=Je;be>0||Ve>0&&se;)be!==0&&(Ve===0||!se||J.z<=se.z)?(ee=J,J=J.nextZ,be--):(ee=se,se=se.nextZ,Ve--),ce?ce.nextZ=ee:j=ee,ee.prevZ=ce,ce=ee;J=se}ce.nextZ=null,Je*=2}while(de>1)}(F)}(i,s,l,h);for(var m,y,b=i;i.prev!==i.next;)if(m=i.prev,y=i.next,h?um(i,s,l,h):cm(i))e.push(m.i/r|0),e.push(i.i/r|0),e.push(y.i/r|0),Bo(i),i=y.next,b=y.next;else if((i=y)===b){p?p===1?Ro(i=hm(qs(i),e,r),e,r,s,l,h,2):p===2&&dm(i,e,r,s,l,h):Ro(qs(i),e,r,s,l,h,1);break}}}function cm(i){var e=i.prev,r=i,s=i.next;if(Ci(e,r,s)>=0)return!1;for(var l=e.x,h=r.x,p=s.x,m=e.y,y=r.y,b=s.y,T=l<h?l<p?l:p:h<p?h:p,P=m<y?m<b?m:b:y<b?y:b,k=l>h?l>p?l:p:h>p?h:p,R=m>y?m>b?m:b:y>b?y:b,F=s.next;F!==e;){if(F.x>=T&&F.x<=k&&F.y>=P&&F.y<=R&&Aa(l,m,h,y,p,b,F.x,F.y)&&Ci(F.prev,F,F.next)>=0)return!1;F=F.next}return!0}function um(i,e,r,s){var l=i.prev,h=i,p=i.next;if(Ci(l,h,p)>=0)return!1;for(var m=l.x,y=h.x,b=p.x,T=l.y,P=h.y,k=p.y,R=m<y?m<b?m:b:y<b?y:b,F=T<P?T<k?T:k:P<k?P:k,j=m>y?m>b?m:b:y>b?y:b,H=T>P?T>k?T:k:P>k?P:k,J=eu(R,F,e,r,s),se=eu(j,H,e,r,s),ee=i.prevZ,ce=i.nextZ;ee&&ee.z>=J&&ce&&ce.z<=se;){if(ee.x>=R&&ee.x<=j&&ee.y>=F&&ee.y<=H&&ee!==l&&ee!==p&&Aa(m,T,y,P,b,k,ee.x,ee.y)&&Ci(ee.prev,ee,ee.next)>=0||(ee=ee.prevZ,ce.x>=R&&ce.x<=j&&ce.y>=F&&ce.y<=H&&ce!==l&&ce!==p&&Aa(m,T,y,P,b,k,ce.x,ce.y)&&Ci(ce.prev,ce,ce.next)>=0))return!1;ce=ce.nextZ}for(;ee&&ee.z>=J;){if(ee.x>=R&&ee.x<=j&&ee.y>=F&&ee.y<=H&&ee!==l&&ee!==p&&Aa(m,T,y,P,b,k,ee.x,ee.y)&&Ci(ee.prev,ee,ee.next)>=0)return!1;ee=ee.prevZ}for(;ce&&ce.z<=se;){if(ce.x>=R&&ce.x<=j&&ce.y>=F&&ce.y<=H&&ce!==l&&ce!==p&&Aa(m,T,y,P,b,k,ce.x,ce.y)&&Ci(ce.prev,ce,ce.next)>=0)return!1;ce=ce.nextZ}return!0}function hm(i,e,r){var s=i;do{var l=s.prev,h=s.next.next;!Xl(l,h)&&Vh(l,s,s.next,h)&&Fo(l,h)&&Fo(h,l)&&(e.push(l.i/r|0),e.push(s.i/r|0),e.push(h.i/r|0),Bo(s),Bo(s.next),s=i=h),s=s.next}while(s!==i);return qs(s)}function dm(i,e,r,s,l,h){var p=i;do{for(var m=p.next.next;m!==p.prev;){if(p.i!==m.i&&_m(p,m)){var y=Uh(p,m);return p=qs(p,p.next),y=qs(y,y.next),Ro(p,e,r,s,l,h,0),void Ro(y,e,r,s,l,h,0)}m=m.next}p=p.next}while(p!==i)}function pm(i,e){return i.x-e.x}function fm(i,e){var r=function(l,h){var p,m=h,y=l.x,b=l.y,T=-1/0;do{if(b<=m.y&&b>=m.next.y&&m.next.y!==m.y){var P=m.x+(b-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(P<=y&&P>T&&(T=P,p=m.x<m.next.x?m:m.next,P===y))return p}m=m.next}while(m!==h);if(!p)return null;var k,R=p,F=p.x,j=p.y,H=1/0;m=p;do y>=m.x&&m.x>=F&&y!==m.x&&Aa(b<j?y:T,b,F,j,b<j?T:y,b,m.x,m.y)&&(k=Math.abs(b-m.y)/(y-m.x),Fo(m,l)&&(k<H||k===H&&(m.x>p.x||m.x===p.x&&mm(p,m)))&&(p=m,H=k)),m=m.next;while(m!==R);return p}(i,e);if(!r)return e;var s=Uh(r,i);return qs(s,s.next),qs(r,r.next)}function mm(i,e){return Ci(i.prev,i,e.prev)<0&&Ci(e.next,i,i.next)<0}function eu(i,e,r,s,l){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*l|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*l|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function gm(i){var e=i,r=i;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==i);return r}function Aa(i,e,r,s,l,h,p,m){return(l-p)*(e-m)>=(i-p)*(h-m)&&(i-p)*(s-m)>=(r-p)*(e-m)&&(r-p)*(h-m)>=(l-p)*(s-m)}function _m(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(r,s){var l=r;do{if(l.i!==r.i&&l.next.i!==r.i&&l.i!==s.i&&l.next.i!==s.i&&Vh(l,l.next,r,s))return!0;l=l.next}while(l!==r);return!1}(i,e)&&(Fo(i,e)&&Fo(e,i)&&function(r,s){var l=r,h=!1,p=(r.x+s.x)/2,m=(r.y+s.y)/2;do l.y>m!=l.next.y>m&&l.next.y!==l.y&&p<(l.next.x-l.x)*(m-l.y)/(l.next.y-l.y)+l.x&&(h=!h),l=l.next;while(l!==r);return h}(i,e)&&(Ci(i.prev,i,e.prev)||Ci(i,e.prev,e))||Xl(i,e)&&Ci(i.prev,i,i.next)>0&&Ci(e.prev,e,e.next)>0)}function Ci(i,e,r){return(e.y-i.y)*(r.x-e.x)-(e.x-i.x)*(r.y-e.y)}function Xl(i,e){return i.x===e.x&&i.y===e.y}function Vh(i,e,r,s){var l=Jl(Ci(i,e,r)),h=Jl(Ci(i,e,s)),p=Jl(Ci(r,s,i)),m=Jl(Ci(r,s,e));return l!==h&&p!==m||!(l!==0||!Kl(i,r,e))||!(h!==0||!Kl(i,s,e))||!(p!==0||!Kl(r,i,s))||!(m!==0||!Kl(r,e,s))}function Kl(i,e,r){return e.x<=Math.max(i.x,r.x)&&e.x>=Math.min(i.x,r.x)&&e.y<=Math.max(i.y,r.y)&&e.y>=Math.min(i.y,r.y)}function Jl(i){return i>0?1:i<0?-1:0}function Fo(i,e){return Ci(i.prev,i,i.next)<0?Ci(i,e,i.next)>=0&&Ci(i,i.prev,e)>=0:Ci(i,e,i.prev)<0||Ci(i,i.next,e)<0}function Uh(i,e){var r=new tu(i.i,i.x,i.y),s=new tu(e.i,e.x,e.y),l=i.next,h=e.prev;return i.next=e,e.prev=i,r.next=l,l.prev=r,s.next=r,r.prev=s,h.next=s,s.prev=h,s}function qh(i,e,r,s){var l=new tu(i,e,r);return s?(l.next=s.next,l.prev=s,s.next.prev=l,s.next=l):(l.prev=l,l.next=l),l}function Bo(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function tu(i,e,r){this.i=i,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function iu(i,e,r,s){for(var l=0,h=e,p=r-s;h<r;h+=s)l+=(i[p]-i[h])*(i[h+1]+i[p+1]),p=h;return l}Qc.exports=Wl,Qc.exports.default=Wl,Wl.deviation=function(i,e,r,s){var l=e&&e.length,h=Math.abs(iu(i,0,l?e[0]*r:i.length,r));if(l)for(var p=0,m=e.length;p<m;p++)h-=Math.abs(iu(i,e[p]*r,p<m-1?e[p+1]*r:i.length,r));var y=0;for(p=0;p<s.length;p+=3){var b=s[p]*r,T=s[p+1]*r,P=s[p+2]*r;y+=Math.abs((i[b]-i[P])*(i[T+1]-i[b+1])-(i[b]-i[T])*(i[P+1]-i[b+1]))}return h===0&&y===0?0:Math.abs((y-h)/h)},Wl.flatten=function(i){for(var e=i[0][0].length,r={vertices:[],holes:[],dimensions:e},s=0,l=0;l<i.length;l++){for(var h=0;h<i[l].length;h++)for(var p=0;p<e;p++)r.vertices.push(i[l][h][p]);l>0&&r.holes.push(s+=i[l-1].length)}return r};var Zh=B(Qc.exports);function ym(i,e,r,s,l){Gh(i,e,r||0,s||i.length-1,l||vm)}function Gh(i,e,r,s,l){for(;s>r;){if(s-r>600){var h=s-r+1,p=e-r+1,m=Math.log(h),y=.5*Math.exp(2*m/3),b=.5*Math.sqrt(m*y*(h-y)/h)*(p-h/2<0?-1:1);Gh(i,e,Math.max(r,Math.floor(e-p*y/h+b)),Math.min(s,Math.floor(e+(h-p)*y/h+b)),l)}var T=i[e],P=r,k=s;for(Oo(i,r,e),l(i[s],T)>0&&Oo(i,r,s);P<k;){for(Oo(i,P,k),P++,k--;l(i[P],T)<0;)P++;for(;l(i[k],T)>0;)k--}l(i[r],T)===0?Oo(i,r,k):Oo(i,++k,s),k<=e&&(r=k+1),e<=k&&(s=k-1)}}function Oo(i,e,r){var s=i[e];i[e]=i[r],i[r]=s}function vm(i,e){return i<e?-1:i>e?1:0}function ru(i,e){const r=i.length;if(r<=1)return[i];const s=[];let l,h;for(let p=0;p<r;p++){const m=Bt(i[p]);m!==0&&(i[p].area=Math.abs(m),h===void 0&&(h=m<0),h===m<0?(l&&s.push(l),l=[i[p]]):l.push(i[p]))}if(l&&s.push(l),e>1)for(let p=0;p<s.length;p++)s[p].length<=e||(ym(s[p],e,1,s[p].length-1,xm),s[p]=s[p].slice(0,e));return s}function xm(i,e){return e.area-i.area}function nu(i,e,r){const s=r.patternDependencies;let l=!1;for(const h of e){const p=h.paint.get(`${i}-pattern`);p.isConstant()||(l=!0);const m=p.constantOr(null);m&&(l=!0,s[m.to]=!0,s[m.from]=!0)}return l}function su(i,e,r,s,l){const h=l.patternDependencies;for(const p of e){const m=p.paint.get(`${i}-pattern`).value;if(m.kind!=="constant"){let y=m.evaluate({zoom:s-1},r,{},l.availableImages),b=m.evaluate({zoom:s},r,{},l.availableImages),T=m.evaluate({zoom:s+1},r,{},l.availableImages);y=y&&y.name?y.name:y,b=b&&b.name?b.name:b,T=T&&T.name?T.name:T,h[y]=!0,h[b]=!0,h[T]=!0,r.patterns[p.id]={min:y,mid:b,max:T}}}return r}class au{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Tt,this.indexArray=new Gi,this.indexArray2=new zi,this.programConfigurations=new _n(e.layers,e.zoom),this.segments=new ii,this.segments2=new ii,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){this.hasPattern=nu("fill",this.layers,r);const l=this.layers[0].layout.get("fill-sort-key"),h=!l.isConstant(),p=[];for(const{feature:m,id:y,index:b,sourceLayerIndex:T}of e){const P=this.layers[0]._featureFilter.needGeometry,k=Us(m,P);if(!this.layers[0]._featureFilter.filter(new ti(this.zoom),k,s))continue;const R=h?l.evaluate(k,{},s,r.availableImages):void 0,F={id:y,properties:m.properties,type:m.type,sourceLayerIndex:T,index:b,geometry:P?k.geometry:Vs(m),patterns:{},sortKey:R};p.push(F)}h&&p.sort((m,y)=>m.sortKey-y.sortKey);for(const m of p){const{geometry:y,index:b,sourceLayerIndex:T}=m;if(this.hasPattern){const P=su("fill",this.layers,m,this.zoom,r);this.patternFeatures.push(P)}else this.addFeature(m,y,b,s,{});r.featureIndex.insert(e[b].feature,y,b,T,this.index)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s)}addFeatures(e,r,s){for(const l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,r,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,lm),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,s,l,h){for(const p of ru(r,500)){let m=0;for(const R of p)m+=R.length;const y=this.segments.prepareSegment(m,this.layoutVertexArray,this.indexArray),b=y.vertexLength,T=[],P=[];for(const R of p){if(R.length===0)continue;R!==p[0]&&P.push(T.length/2);const F=this.segments2.prepareSegment(R.length,this.layoutVertexArray,this.indexArray2),j=F.vertexLength;this.layoutVertexArray.emplaceBack(R[0].x,R[0].y),this.indexArray2.emplaceBack(j+R.length-1,j),T.push(R[0].x),T.push(R[0].y);for(let H=1;H<R.length;H++)this.layoutVertexArray.emplaceBack(R[H].x,R[H].y),this.indexArray2.emplaceBack(j+H-1,j+H),T.push(R[H].x),T.push(R[H].y);F.vertexLength+=R.length,F.primitiveLength+=R.length}const k=Zh(T,P);for(let R=0;R<k.length;R+=3)this.indexArray.emplaceBack(b+k[R],b+k[R+1],b+k[R+2]);y.vertexLength+=m,y.primitiveLength+=k.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,h,l)}}let Hh,Wh;Ge("FillBucket",au,{omit:["layers","patternFeatures"]});var bm={get paint(){return Wh=Wh||new wi({"fill-antialias":new tt(me.paint_fill["fill-antialias"]),"fill-opacity":new ut(me.paint_fill["fill-opacity"]),"fill-color":new ut(me.paint_fill["fill-color"]),"fill-outline-color":new ut(me.paint_fill["fill-outline-color"]),"fill-translate":new tt(me.paint_fill["fill-translate"]),"fill-translate-anchor":new tt(me.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ns(me.paint_fill["fill-pattern"])})},get layout(){return Hh=Hh||new wi({"fill-sort-key":new ut(me.layout_fill["fill-sort-key"])})}};class wm extends jr{constructor(e){super(e,bm)}recalculate(e,r){super.recalculate(e,r);const s=this.paint._values["fill-outline-color"];s.value.kind==="constant"&&s.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new au(e)}queryRadius(){return Zl(this.paint.get("fill-translate"))}queryIntersectsFeature(e,r,s,l,h,p,m){return Ph(Gl(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,m),l)}isTileClipped(){return!0}}const Sm=hi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Cm=hi([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Tm}=Sm;var ms={},Im=ae,Xh=Pa;function Pa(i,e,r,s,l){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=s,this._values=l,i.readFields(Em,this,e)}function Em(i,e,r){i==1?e.id=r.readVarint():i==2?function(s,l){for(var h=s.readVarint()+s.pos;s.pos<h;){var p=l._keys[s.readVarint()],m=l._values[s.readVarint()];l.properties[p]=m}}(r,e):i==3?e.type=r.readVarint():i==4&&(e._geometry=r.pos)}function Am(i){for(var e,r,s=0,l=0,h=i.length,p=h-1;l<h;p=l++)s+=((r=i[p]).x-(e=i[l]).x)*(e.y+r.y);return s}Pa.types=["Unknown","Point","LineString","Polygon"],Pa.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,r=i.readVarint()+i.pos,s=1,l=0,h=0,p=0,m=[];i.pos<r;){if(l<=0){var y=i.readVarint();s=7&y,l=y>>3}if(l--,s===1||s===2)h+=i.readSVarint(),p+=i.readSVarint(),s===1&&(e&&m.push(e),e=[]),e.push(new Im(h,p));else{if(s!==7)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&m.push(e),m},Pa.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,r=1,s=0,l=0,h=0,p=1/0,m=-1/0,y=1/0,b=-1/0;i.pos<e;){if(s<=0){var T=i.readVarint();r=7&T,s=T>>3}if(s--,r===1||r===2)(l+=i.readSVarint())<p&&(p=l),l>m&&(m=l),(h+=i.readSVarint())<y&&(y=h),h>b&&(b=h);else if(r!==7)throw new Error("unknown command "+r)}return[p,y,m,b]},Pa.prototype.toGeoJSON=function(i,e,r){var s,l,h=this.extent*Math.pow(2,r),p=this.extent*i,m=this.extent*e,y=this.loadGeometry(),b=Pa.types[this.type];function T(R){for(var F=0;F<R.length;F++){var j=R[F];R[F]=[360*(j.x+p)/h-180,360/Math.PI*Math.atan(Math.exp((180-360*(j.y+m)/h)*Math.PI/180))-90]}}switch(this.type){case 1:var P=[];for(s=0;s<y.length;s++)P[s]=y[s][0];T(y=P);break;case 2:for(s=0;s<y.length;s++)T(y[s]);break;case 3:for(y=function(R){var F=R.length;if(F<=1)return[R];for(var j,H,J=[],se=0;se<F;se++){var ee=Am(R[se]);ee!==0&&(H===void 0&&(H=ee<0),H===ee<0?(j&&J.push(j),j=[R[se]]):j.push(R[se]))}return j&&J.push(j),J}(y),s=0;s<y.length;s++)for(l=0;l<y[s].length;l++)T(y[s][l])}y.length===1?y=y[0]:b="Multi"+b;var k={type:"Feature",geometry:{type:b,coordinates:y},properties:this.properties};return"id"in this&&(k.id=this.id),k};var Pm=Xh,Kh=Jh;function Jh(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(Mm,this,e),this.length=this._features.length}function Mm(i,e,r){i===15?e.version=r.readVarint():i===1?e.name=r.readString():i===5?e.extent=r.readVarint():i===2?e._features.push(r.pos):i===3?e._keys.push(r.readString()):i===4&&e._values.push(function(s){for(var l=null,h=s.readVarint()+s.pos;s.pos<h;){var p=s.readVarint()>>3;l=p===1?s.readString():p===2?s.readFloat():p===3?s.readDouble():p===4?s.readVarint64():p===5?s.readVarint():p===6?s.readSVarint():p===7?s.readBoolean():null}return l}(r))}Jh.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new Pm(this._pbf,e,this.extent,this._keys,this._values)};var km=Kh;function zm(i,e,r){if(i===3){var s=new km(r,r.readVarint()+r.pos);s.length&&(e[s.name]=s)}}ms.VectorTile=function(i,e){this.layers=i.readFields(zm,{},e)},ms.VectorTileFeature=Xh,ms.VectorTileLayer=Kh;const Dm=ms.VectorTileFeature.types,ou=Math.pow(2,13);function No(i,e,r,s,l,h,p,m){i.emplaceBack(e,r,2*Math.floor(s*ou)+p,l*ou*2,h*ou*2,Math.round(m))}class lu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Be,this.centroidVertexArray=new Me,this.indexArray=new Gi,this.programConfigurations=new _n(e.layers,e.zoom),this.segments=new ii,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){this.features=[],this.hasPattern=nu("fill-extrusion",this.layers,r);for(const{feature:l,id:h,index:p,sourceLayerIndex:m}of e){const y=this.layers[0]._featureFilter.needGeometry,b=Us(l,y);if(!this.layers[0]._featureFilter.filter(new ti(this.zoom),b,s))continue;const T={id:h,sourceLayerIndex:m,index:p,geometry:y?b.geometry:Vs(l),properties:l.properties,type:l.type,patterns:{}};this.hasPattern?this.features.push(su("fill-extrusion",this.layers,T,this.zoom,r)):this.addFeature(T,T.geometry,p,s,{}),r.featureIndex.insert(l,T.geometry,p,m,this.index,!0)}}addFeatures(e,r,s){for(const l of this.features){const{geometry:h}=l;this.addFeature(l,h,l.index,r,s)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Tm),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Cm.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,r,s,l,h){const p={x:0,y:0,vertexCount:0};for(const m of ru(r,500)){let y=0;for(const F of m)y+=F.length;let b=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const F of m){if(F.length===0||Rm(F))continue;let j=0;for(let H=0;H<F.length;H++){const J=F[H];if(H>=1){const se=F[H-1];if(!Lm(J,se)){b.vertexLength+4>ii.MAX_VERTEX_ARRAY_LENGTH&&(b=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ee=J.sub(se)._perp()._unit(),ce=se.dist(J);j+ce>32768&&(j=0),No(this.layoutVertexArray,J.x,J.y,ee.x,ee.y,0,0,j),No(this.layoutVertexArray,J.x,J.y,ee.x,ee.y,0,1,j),p.x+=2*J.x,p.y+=2*J.y,p.vertexCount+=2,j+=ce,No(this.layoutVertexArray,se.x,se.y,ee.x,ee.y,0,0,j),No(this.layoutVertexArray,se.x,se.y,ee.x,ee.y,0,1,j),p.x+=2*se.x,p.y+=2*se.y,p.vertexCount+=2;const de=b.vertexLength;this.indexArray.emplaceBack(de,de+2,de+1),this.indexArray.emplaceBack(de+1,de+2,de+3),b.vertexLength+=4,b.primitiveLength+=2}}}}if(b.vertexLength+y>ii.MAX_VERTEX_ARRAY_LENGTH&&(b=this.segments.prepareSegment(y,this.layoutVertexArray,this.indexArray)),Dm[e.type]!=="Polygon")continue;const T=[],P=[],k=b.vertexLength;for(const F of m)if(F.length!==0){F!==m[0]&&P.push(T.length/2);for(let j=0;j<F.length;j++){const H=F[j];No(this.layoutVertexArray,H.x,H.y,0,0,1,1,0),p.x+=H.x,p.y+=H.y,p.vertexCount+=1,T.push(H.x),T.push(H.y)}}const R=Zh(T,P);for(let F=0;F<R.length;F+=3)this.indexArray.emplaceBack(k+R[F],k+R[F+2],k+R[F+1]);b.primitiveLength+=R.length/3,b.vertexLength+=y}for(let m=0;m<p.vertexCount;m++)this.centroidVertexArray.emplaceBack(Math.floor(p.x/p.vertexCount),Math.floor(p.y/p.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,h,l)}}function Lm(i,e){return i.x===e.x&&(i.x<0||i.x>Ai)||i.y===e.y&&(i.y<0||i.y>Ai)}function Rm(i){return i.every(e=>e.x<0)||i.every(e=>e.x>Ai)||i.every(e=>e.y<0)||i.every(e=>e.y>Ai)}let Yh;Ge("FillExtrusionBucket",lu,{omit:["layers","features"]});var Fm={get paint(){return Yh=Yh||new wi({"fill-extrusion-opacity":new tt(me["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ut(me["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new tt(me["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new tt(me["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ns(me["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ut(me["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ut(me["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new tt(me["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Bm extends jr{constructor(e){super(e,Fm)}createBucket(e){return new lu(e)}queryRadius(){return Zl(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(e,r,s,l,h,p,m,y){const b=Gl(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,m),T=this.paint.get("fill-extrusion-height").evaluate(r,s),P=this.paint.get("fill-extrusion-base").evaluate(r,s),k=function(F,j,H,J){const se=[];for(const ee of F){const ce=[ee.x,ee.y,0,1];Hl(ce,ce,j),se.push(new he(ce[0]/ce[3],ce[1]/ce[3]))}return se}(b,y),R=function(F,j,H,J){const se=[],ee=[],ce=J[8]*j,de=J[9]*j,be=J[10]*j,Ve=J[11]*j,Je=J[8]*H,$e=J[9]*H,Oe=J[10]*H,De=J[11]*H;for(const He of F){const Le=[],Ae=[];for(const st of He){const Qe=st.x,St=st.y,ri=J[0]*Qe+J[4]*St+J[12],oi=J[1]*Qe+J[5]*St+J[13],Ri=J[2]*Qe+J[6]*St+J[14],Ur=J[3]*Qe+J[7]*St+J[15],xr=Ri+be,Pi=Ur+Ve,Wi=ri+Je,tr=oi+$e,br=Ri+Oe,wr=Ur+De,Fi=new he((ri+ce)/Pi,(oi+de)/Pi);Fi.z=xr/Pi,Le.push(Fi);const Bi=new he(Wi/wr,tr/wr);Bi.z=br/wr,Ae.push(Bi)}se.push(Le),ee.push(Ae)}return[se,ee]}(l,P,T,y);return function(F,j,H){let J=1/0;Ph(H,j)&&(J=Qh(H,j[0]));for(let se=0;se<j.length;se++){const ee=j[se],ce=F[se];for(let de=0;de<ee.length-1;de++){const be=ee[de],Ve=[be,ee[de+1],ce[de+1],ce[de],be];Ah(H,Ve)&&(J=Math.min(J,Qh(H,Ve)))}}return J!==1/0&&J}(R[0],R[1],k)}}function $o(i,e){return i.x*e.x+i.y*e.y}function Qh(i,e){if(i.length===1){let r=0;const s=e[r++];let l;for(;!l||s.equals(l);)if(l=e[r++],!l)return 1/0;for(;r<e.length;r++){const h=e[r],p=i[0],m=l.sub(s),y=h.sub(s),b=p.sub(s),T=$o(m,m),P=$o(m,y),k=$o(y,y),R=$o(b,m),F=$o(b,y),j=T*k-P*P,H=(k*R-P*F)/j,J=(T*F-P*R)/j,se=s.z*(1-H-J)+l.z*H+h.z*J;if(isFinite(se))return se}return 1/0}{let r=1/0;for(const s of e)r=Math.min(r,s.z);return r}}const Om=hi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Nm}=Om,$m=hi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:jm}=$m,Vm=ms.VectorTileFeature.types,Um=Math.cos(Math.PI/180*37.5),ed=Math.pow(2,14)/.5;class cu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new ht,this.layoutVertexArray2=new Ye,this.indexArray=new Gi,this.programConfigurations=new _n(e.layers,e.zoom),this.segments=new ii,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){this.hasPattern=nu("line",this.layers,r);const l=this.layers[0].layout.get("line-sort-key"),h=!l.isConstant(),p=[];for(const{feature:m,id:y,index:b,sourceLayerIndex:T}of e){const P=this.layers[0]._featureFilter.needGeometry,k=Us(m,P);if(!this.layers[0]._featureFilter.filter(new ti(this.zoom),k,s))continue;const R=h?l.evaluate(k,{},s):void 0,F={id:y,properties:m.properties,type:m.type,sourceLayerIndex:T,index:b,geometry:P?k.geometry:Vs(m),patterns:{},sortKey:R};p.push(F)}h&&p.sort((m,y)=>m.sortKey-y.sortKey);for(const m of p){const{geometry:y,index:b,sourceLayerIndex:T}=m;if(this.hasPattern){const P=su("line",this.layers,m,this.zoom,r);this.patternFeatures.push(P)}else this.addFeature(m,y,b,s,{});r.featureIndex.insert(e[b].feature,y,b,T,this.index)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s)}addFeatures(e,r,s){for(const l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,r,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,jm)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Nm),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,s,l,h){const p=this.layers[0].layout,m=p.get("line-join").evaluate(e,{}),y=p.get("line-cap"),b=p.get("line-miter-limit"),T=p.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const P of r)this.addLine(P,e,m,y,b,T);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,h,l)}addLine(e,r,s,l,h,p){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let J=0;J<e.length-1;J++)this.totalDistance+=e[J].dist(e[J+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const m=Vm[r.type]==="Polygon";let y=e.length;for(;y>=2&&e[y-1].equals(e[y-2]);)y--;let b=0;for(;b<y-1&&e[b].equals(e[b+1]);)b++;if(y<(m?3:2))return;s==="bevel"&&(h=1.05);const T=this.overscaling<=16?15*Ai/(512*this.overscaling):0,P=this.segments.prepareSegment(10*y,this.layoutVertexArray,this.indexArray);let k,R,F,j,H;this.e1=this.e2=-1,m&&(k=e[y-2],H=e[b].sub(k)._unit()._perp());for(let J=b;J<y;J++){if(F=J===y-1?m?e[b+1]:void 0:e[J+1],F&&e[J].equals(F))continue;H&&(j=H),k&&(R=k),k=e[J],H=F?F.sub(k)._unit()._perp():j,j=j||H;let se=j.add(H);se.x===0&&se.y===0||se._unit();const ee=j.x*H.x+j.y*H.y,ce=se.x*H.x+se.y*H.y,de=ce!==0?1/ce:1/0,be=2*Math.sqrt(2-2*ce),Ve=ce<Um&&R&&F,Je=j.x*H.y-j.y*H.x>0;if(Ve&&J>b){const De=k.dist(R);if(De>2*T){const He=k.sub(k.sub(R)._mult(T/De)._round());this.updateDistance(R,He),this.addCurrentVertex(He,j,0,0,P),R=He}}const $e=R&&F;let Oe=$e?s:m?"butt":l;if($e&&Oe==="round"&&(de<p?Oe="miter":de<=2&&(Oe="fakeround")),Oe==="miter"&&de>h&&(Oe="bevel"),Oe==="bevel"&&(de>2&&(Oe="flipbevel"),de<h&&(Oe="miter")),R&&this.updateDistance(R,k),Oe==="miter")se._mult(de),this.addCurrentVertex(k,se,0,0,P);else if(Oe==="flipbevel"){if(de>100)se=H.mult(-1);else{const De=de*j.add(H).mag()/j.sub(H).mag();se._perp()._mult(De*(Je?-1:1))}this.addCurrentVertex(k,se,0,0,P),this.addCurrentVertex(k,se.mult(-1),0,0,P)}else if(Oe==="bevel"||Oe==="fakeround"){const De=-Math.sqrt(de*de-1),He=Je?De:0,Le=Je?0:De;if(R&&this.addCurrentVertex(k,j,He,Le,P),Oe==="fakeround"){const Ae=Math.round(180*be/Math.PI/20);for(let st=1;st<Ae;st++){let Qe=st/Ae;if(Qe!==.5){const ri=Qe-.5;Qe+=Qe*ri*(Qe-1)*((1.0904+ee*(ee*(3.55645-1.43519*ee)-3.2452))*ri*ri+(.848013+ee*(.215638*ee-1.06021)))}const St=H.sub(j)._mult(Qe)._add(j)._unit()._mult(Je?-1:1);this.addHalfVertex(k,St.x,St.y,!1,Je,0,P)}}F&&this.addCurrentVertex(k,H,-He,-Le,P)}else if(Oe==="butt")this.addCurrentVertex(k,se,0,0,P);else if(Oe==="square"){const De=R?1:-1;this.addCurrentVertex(k,se,De,De,P)}else Oe==="round"&&(R&&(this.addCurrentVertex(k,j,0,0,P),this.addCurrentVertex(k,j,1,1,P,!0)),F&&(this.addCurrentVertex(k,H,-1,-1,P,!0),this.addCurrentVertex(k,H,0,0,P)));if(Ve&&J<y-1){const De=k.dist(F);if(De>2*T){const He=k.add(F.sub(k)._mult(T/De)._round());this.updateDistance(k,He),this.addCurrentVertex(He,H,0,0,P),k=He}}}}addCurrentVertex(e,r,s,l,h,p=!1){const m=r.y*l-r.x,y=-r.y-r.x*l;this.addHalfVertex(e,r.x+r.y*s,r.y-r.x*s,p,!1,s,h),this.addHalfVertex(e,m,y,p,!0,-l,h),this.distance>ed/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,r,s,l,h,p))}addHalfVertex({x:e,y:r},s,l,h,p,m,y){const b=.5*(this.lineClips?this.scaledDistance*(ed-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(h?1:0),(r<<1)+(p?1:0),Math.round(63*s)+128,Math.round(63*l)+128,1+(m===0?0:m<0?-1:1)|(63&b)<<2,b>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const T=y.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,T),y.primitiveLength++),p?this.e2=T:this.e1=T}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}let td,id;Ge("LineBucket",cu,{omit:["layers","patternFeatures"]});var rd={get paint(){return id=id||new wi({"line-opacity":new ut(me.paint_line["line-opacity"]),"line-color":new ut(me.paint_line["line-color"]),"line-translate":new tt(me.paint_line["line-translate"]),"line-translate-anchor":new tt(me.paint_line["line-translate-anchor"]),"line-width":new ut(me.paint_line["line-width"]),"line-gap-width":new ut(me.paint_line["line-gap-width"]),"line-offset":new ut(me.paint_line["line-offset"]),"line-blur":new ut(me.paint_line["line-blur"]),"line-dasharray":new So(me.paint_line["line-dasharray"]),"line-pattern":new Ns(me.paint_line["line-pattern"]),"line-gradient":new Co(me.paint_line["line-gradient"])})},get layout(){return td=td||new wi({"line-cap":new tt(me.layout_line["line-cap"]),"line-join":new ut(me.layout_line["line-join"]),"line-miter-limit":new tt(me.layout_line["line-miter-limit"]),"line-round-limit":new tt(me.layout_line["line-round-limit"]),"line-sort-key":new ut(me.layout_line["line-sort-key"])})}};class qm extends ut{possiblyEvaluate(e,r){return r=new ti(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(e,r)}evaluate(e,r,s,l){return r=Ze({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(e,r,s,l)}}let Yl;class Zm extends jr{constructor(e){super(e,rd),this.gradientVersion=0,Yl||(Yl=new qm(rd.paint.properties["line-width"].specification),Yl.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!function(s){return s._styleExpression!==void 0}(r)&&r._styleExpression.expression instanceof Pn,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,r){super.recalculate(e,r),this.paint._values["line-floorwidth"]=Yl.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new cu(e)}queryRadius(e){const r=e,s=nd(zo("line-width",this,r),zo("line-gap-width",this,r)),l=zo("line-offset",this,r);return s/2+Math.abs(l)+Zl(this.paint.get("line-translate"))}queryIntersectsFeature(e,r,s,l,h,p,m){const y=Gl(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,m),b=m/2*nd(this.paint.get("line-width").evaluate(r,s),this.paint.get("line-gap-width").evaluate(r,s)),T=this.paint.get("line-offset").evaluate(r,s);return T&&(l=function(P,k){const R=[];for(let F=0;F<P.length;F++){const j=P[F],H=[];for(let J=0;J<j.length;J++){const se=j[J-1],ee=j[J],ce=j[J+1],de=J===0?new he(0,0):ee.sub(se)._unit()._perp(),be=J===j.length-1?new he(0,0):ce.sub(ee)._unit()._perp(),Ve=de._add(be)._unit(),Je=Ve.x*be.x+Ve.y*be.y;Je!==0&&Ve._mult(1/Je),H.push(Ve._mult(k)._add(ee))}R.push(H)}return R}(l,T*m)),function(P,k,R){for(let F=0;F<k.length;F++){const j=k[F];if(P.length>=3){for(let H=0;H<j.length;H++)if(Ia(P,j[H]))return!0}if(Jf(P,j,R))return!0}return!1}(y,l,b)}isTileClipped(){return!0}}function nd(i,e){return e>0?e+2*i:i}const Gm=hi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Hm=hi([{name:"a_projected_pos",components:3,type:"Float32"}],4);hi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Wm=hi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);hi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const sd=hi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Xm=hi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Km(i,e,r){return i.sections.forEach(s=>{s.text=function(l,h,p){const m=h.layout.get("text-transform").evaluate(p,{});return m==="uppercase"?l=l.toLocaleUpperCase():m==="lowercase"&&(l=l.toLocaleLowerCase()),Pr.applyArabicShaping&&(l=Pr.applyArabicShaping(l)),l}(s.text,e,r)}),i}hi([{name:"triangle",components:3,type:"Uint16"}]),hi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),hi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),hi([{type:"Float32",name:"offsetX"}]),hi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),hi([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const jo={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Li=24,ad=Ht,od=function(i,e,r,s,l){var h,p,m=8*l-s-1,y=(1<<m)-1,b=y>>1,T=-7,P=r?l-1:0,k=r?-1:1,R=i[e+P];for(P+=k,h=R&(1<<-T)-1,R>>=-T,T+=m;T>0;h=256*h+i[e+P],P+=k,T-=8);for(p=h&(1<<-T)-1,h>>=-T,T+=s;T>0;p=256*p+i[e+P],P+=k,T-=8);if(h===0)h=1-b;else{if(h===y)return p?NaN:1/0*(R?-1:1);p+=Math.pow(2,s),h-=b}return(R?-1:1)*p*Math.pow(2,h-s)},ld=function(i,e,r,s,l,h){var p,m,y,b=8*h-l-1,T=(1<<b)-1,P=T>>1,k=l===23?Math.pow(2,-24)-Math.pow(2,-77):0,R=s?0:h-1,F=s?1:-1,j=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(m=isNaN(e)?1:0,p=T):(p=Math.floor(Math.log(e)/Math.LN2),e*(y=Math.pow(2,-p))<1&&(p--,y*=2),(e+=p+P>=1?k/y:k*Math.pow(2,1-P))*y>=2&&(p++,y/=2),p+P>=T?(m=0,p=T):p+P>=1?(m=(e*y-1)*Math.pow(2,l),p+=P):(m=e*Math.pow(2,P-1)*Math.pow(2,l),p=0));l>=8;i[r+R]=255&m,R+=F,m/=256,l-=8);for(p=p<<l|m,b+=l;b>0;i[r+R]=255&p,R+=F,p/=256,b-=8);i[r+R-F]|=128*j};function Ht(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Ht.Varint=0,Ht.Fixed64=1,Ht.Bytes=2,Ht.Fixed32=5;var uu=4294967296,cd=1/uu,ud=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Kn(i){return i.type===Ht.Bytes?i.readVarint()+i.pos:i.pos+1}function Ma(i,e,r){return r?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function hd(i,e,r){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(s);for(var l=r.pos-1;l>=i;l--)r.buf[l+s]=r.buf[l]}function Jm(i,e){for(var r=0;r<i.length;r++)e.writeVarint(i[r])}function Ym(i,e){for(var r=0;r<i.length;r++)e.writeSVarint(i[r])}function Qm(i,e){for(var r=0;r<i.length;r++)e.writeFloat(i[r])}function eg(i,e){for(var r=0;r<i.length;r++)e.writeDouble(i[r])}function tg(i,e){for(var r=0;r<i.length;r++)e.writeBoolean(i[r])}function ig(i,e){for(var r=0;r<i.length;r++)e.writeFixed32(i[r])}function rg(i,e){for(var r=0;r<i.length;r++)e.writeSFixed32(i[r])}function ng(i,e){for(var r=0;r<i.length;r++)e.writeFixed64(i[r])}function sg(i,e){for(var r=0;r<i.length;r++)e.writeSFixed64(i[r])}function Ql(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function ka(i,e,r){i[r]=e,i[r+1]=e>>>8,i[r+2]=e>>>16,i[r+3]=e>>>24}function dd(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}Ht.prototype={destroy:function(){this.buf=null},readFields:function(i,e,r){for(r=r||this.length;this.pos<r;){var s=this.readVarint(),l=s>>3,h=this.pos;this.type=7&s,i(l,e,this),this.pos===h&&this.skip(s)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=Ql(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=dd(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Ql(this.buf,this.pos)+Ql(this.buf,this.pos+4)*uu;return this.pos+=8,i},readSFixed64:function(){var i=Ql(this.buf,this.pos)+dd(this.buf,this.pos+4)*uu;return this.pos+=8,i},readFloat:function(){var i=od(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=od(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,r,s=this.buf;return e=127&(r=s[this.pos++]),r<128?e:(e|=(127&(r=s[this.pos++]))<<7,r<128?e:(e|=(127&(r=s[this.pos++]))<<14,r<128?e:(e|=(127&(r=s[this.pos++]))<<21,r<128?e:function(l,h,p){var m,y,b=p.buf;if(m=(112&(y=b[p.pos++]))>>4,y<128||(m|=(127&(y=b[p.pos++]))<<3,y<128)||(m|=(127&(y=b[p.pos++]))<<10,y<128)||(m|=(127&(y=b[p.pos++]))<<17,y<128)||(m|=(127&(y=b[p.pos++]))<<24,y<128)||(m|=(1&(y=b[p.pos++]))<<31,y<128))return Ma(l,m,h);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=s[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&ud?function(r,s,l){return ud.decode(r.subarray(s,l))}(this.buf,e,i):function(r,s,l){for(var h="",p=s;p<l;){var m,y,b,T=r[p],P=null,k=T>239?4:T>223?3:T>191?2:1;if(p+k>l)break;k===1?T<128&&(P=T):k===2?(192&(m=r[p+1]))==128&&(P=(31&T)<<6|63&m)<=127&&(P=null):k===3?(y=r[p+2],(192&(m=r[p+1]))==128&&(192&y)==128&&((P=(15&T)<<12|(63&m)<<6|63&y)<=2047||P>=55296&&P<=57343)&&(P=null)):k===4&&(y=r[p+2],b=r[p+3],(192&(m=r[p+1]))==128&&(192&y)==128&&(192&b)==128&&((P=(15&T)<<18|(63&m)<<12|(63&y)<<6|63&b)<=65535||P>=1114112)&&(P=null)),P===null?(P=65533,k=1):P>65535&&(P-=65536,h+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),h+=String.fromCharCode(P),p+=k}return h}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==Ht.Bytes)return i.push(this.readVarint(e));var r=Kn(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==Ht.Bytes)return i.push(this.readSVarint());var e=Kn(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Ht.Bytes)return i.push(this.readBoolean());var e=Kn(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Ht.Bytes)return i.push(this.readFloat());var e=Kn(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Ht.Bytes)return i.push(this.readDouble());var e=Kn(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Ht.Bytes)return i.push(this.readFixed32());var e=Kn(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Ht.Bytes)return i.push(this.readSFixed32());var e=Kn(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Ht.Bytes)return i.push(this.readFixed64());var e=Kn(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Ht.Bytes)return i.push(this.readSFixed64());var e=Kn(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===Ht.Varint)for(;this.buf[this.pos++]>127;);else if(e===Ht.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Ht.Fixed32)this.pos+=4;else{if(e!==Ht.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),ka(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),ka(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),ka(this.buf,-1&i,this.pos),ka(this.buf,Math.floor(i*cd),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),ka(this.buf,-1&i,this.pos),ka(this.buf,Math.floor(i*cd),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,r){var s,l;if(e>=0?(s=e%4294967296|0,l=e/4294967296|0):(l=~(-e/4294967296),4294967295^(s=~(-e%4294967296))?s=s+1|0:(s=0,l=l+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(h,p,m){m.buf[m.pos++]=127&h|128,h>>>=7,m.buf[m.pos++]=127&h|128,h>>>=7,m.buf[m.pos++]=127&h|128,h>>>=7,m.buf[m.pos++]=127&h|128,m.buf[m.pos]=127&(h>>>=7)}(s,0,r),function(h,p){var m=(7&h)<<4;p.buf[p.pos++]|=m|((h>>>=3)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h)))))}(l,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(s,l,h){for(var p,m,y=0;y<l.length;y++){if((p=l.charCodeAt(y))>55295&&p<57344){if(!m){p>56319||y+1===l.length?(s[h++]=239,s[h++]=191,s[h++]=189):m=p;continue}if(p<56320){s[h++]=239,s[h++]=191,s[h++]=189,m=p;continue}p=m-55296<<10|p-56320|65536,m=null}else m&&(s[h++]=239,s[h++]=191,s[h++]=189,m=null);p<128?s[h++]=p:(p<2048?s[h++]=p>>6|192:(p<65536?s[h++]=p>>12|224:(s[h++]=p>>18|240,s[h++]=p>>12&63|128),s[h++]=p>>6&63|128),s[h++]=63&p|128)}return h}(this.buf,i,this.pos);var r=this.pos-e;r>=128&&hd(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),ld(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),ld(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,e){this.pos++;var r=this.pos;i(e,this);var s=this.pos-r;s>=128&&hd(r,s,this),this.pos=r-1,this.writeVarint(s),this.pos+=s},writeMessage:function(i,e,r){this.writeTag(i,Ht.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,Jm,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,Ym,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,tg,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,Qm,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,eg,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,ig,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,rg,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,ng,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,sg,e)},writeBytesField:function(i,e){this.writeTag(i,Ht.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,Ht.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,Ht.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,Ht.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,Ht.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,Ht.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,Ht.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,Ht.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,Ht.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,Ht.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,!!e)}};var hu=B(ad);const du=3;function ag(i,e,r){i===1&&r.readMessage(og,e)}function og(i,e,r){if(i===3){const{id:s,bitmap:l,width:h,height:p,left:m,top:y,advance:b}=r.readMessage(lg,{});e.push({id:s,bitmap:new Lo({width:h+2*du,height:p+2*du},l),metrics:{width:h,height:p,left:m,top:y,advance:b}})}}function lg(i,e,r){i===1?e.id=r.readVarint():i===2?e.bitmap=r.readBytes():i===3?e.width=r.readVarint():i===4?e.height=r.readVarint():i===5?e.left=r.readSVarint():i===6?e.top=r.readSVarint():i===7&&(e.advance=r.readVarint())}const pd=du;function fd(i){let e=0,r=0;for(const p of i)e+=p.w*p.h,r=Math.max(r,p.w);i.sort((p,m)=>m.h-p.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let l=0,h=0;for(const p of i)for(let m=s.length-1;m>=0;m--){const y=s[m];if(!(p.w>y.w||p.h>y.h)){if(p.x=y.x,p.y=y.y,h=Math.max(h,p.y+p.h),l=Math.max(l,p.x+p.w),p.w===y.w&&p.h===y.h){const b=s.pop();m<s.length&&(s[m]=b)}else p.h===y.h?(y.x+=p.w,y.w-=p.w):p.w===y.w?(y.y+=p.h,y.h-=p.h):(s.push({x:y.x+p.w,y:y.y,w:y.w-p.w,h:p.h}),y.y+=p.h,y.h-=p.h);break}}return{w:l,h,fill:e/(l*h)||0}}const kr=1;class pu{constructor(e,{pixelRatio:r,version:s,stretchX:l,stretchY:h,content:p}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=l,this.stretchY=h,this.content=p,this.version=s}get tl(){return[this.paddedRect.x+kr,this.paddedRect.y+kr]}get br(){return[this.paddedRect.x+this.paddedRect.w-kr,this.paddedRect.y+this.paddedRect.h-kr]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*kr)/this.pixelRatio,(this.paddedRect.h-2*kr)/this.pixelRatio]}}class md{constructor(e,r){const s={},l={};this.haveRenderCallbacks=[];const h=[];this.addImages(e,s,h),this.addImages(r,l,h);const{w:p,h:m}=fd(h),y=new Gr({width:p||1,height:m||1});for(const b in e){const T=e[b],P=s[b].paddedRect;Gr.copy(T.data,y,{x:0,y:0},{x:P.x+kr,y:P.y+kr},T.data)}for(const b in r){const T=r[b],P=l[b].paddedRect,k=P.x+kr,R=P.y+kr,F=T.data.width,j=T.data.height;Gr.copy(T.data,y,{x:0,y:0},{x:k,y:R},T.data),Gr.copy(T.data,y,{x:0,y:j-1},{x:k,y:R-1},{width:F,height:1}),Gr.copy(T.data,y,{x:0,y:0},{x:k,y:R+j},{width:F,height:1}),Gr.copy(T.data,y,{x:F-1,y:0},{x:k-1,y:R},{width:1,height:j}),Gr.copy(T.data,y,{x:0,y:0},{x:k+F,y:R},{width:1,height:j})}this.image=y,this.iconPositions=s,this.patternPositions=l}addImages(e,r,s){for(const l in e){const h=e[l],p={x:0,y:0,w:h.data.width+2*kr,h:h.data.height+2*kr};s.push(p),r[l]=new pu(p,h),h.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(e,r){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in e.updatedImages)this.patchUpdatedImage(this.iconPositions[s],e.getImage(s),r),this.patchUpdatedImage(this.patternPositions[s],e.getImage(s),r)}patchUpdatedImage(e,r,s){if(!e||!r||e.version===r.version)return;e.version=r.version;const[l,h]=e.tl;s.update(r.data,void 0,{x:l,y:h})}}var gs;Ge("ImagePosition",pu),Ge("ImageAtlas",md),a.ai=void 0,(gs=a.ai||(a.ai={}))[gs.none=0]="none",gs[gs.horizontal=1]="horizontal",gs[gs.vertical=2]="vertical",gs[gs.horizontalOnly=3]="horizontalOnly";const Vo=-17;class Uo{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const s=new Uo;return s.scale=e||1,s.fontStack=r,s}static forImage(e){const r=new Uo;return r.imageName=e,r}}class za{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const s=new za;for(let l=0;l<e.sections.length;l++){const h=e.sections[l];h.image?s.addImageSection(h):s.addTextSection(h,r)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let r="";for(let s=0;s<e.length;s++){const l=e.charCodeAt(s+1)||null,h=e.charCodeAt(s-1)||null;r+=l&&Ll(l)&&!jo[e[s+1]]||h&&Ll(h)&&!jo[e[s-1]]||!jo[e[s]]?e[s]:jo[e[s]]}return r}(this.text)}trim(){let e=0;for(let s=0;s<this.text.length&&tc[this.text.charCodeAt(s)];s++)e++;let r=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&tc[this.text.charCodeAt(s)];s--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const s=new za;return s.text=this.text.substring(e,r),s.sectionIndex=this.sectionIndex.slice(e,r),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(Uo.forText(e.scale,e.fontStack||r));const s=this.sections.length-1;for(let l=0;l<e.text.length;++l)this.sectionIndex.push(s)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void gt("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(Uo.forImage(r)),this.sectionIndex.push(this.sections.length-1)):gt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function ec(i,e,r,s,l,h,p,m,y,b,T,P,k,R,F,j){const H=za.fromFeature(i,l);let J;P===a.ai.vertical&&H.verticalizePunctuation();const{processBidirectionalText:se,processStyledBidirectionalText:ee}=Pr;if(se&&H.sections.length===1){J=[];const be=se(H.toString(),fu(H,b,h,e,s,R,F));for(const Ve of be){const Je=new za;Je.text=Ve,Je.sections=H.sections;for(let $e=0;$e<Ve.length;$e++)Je.sectionIndex.push(0);J.push(Je)}}else if(ee){J=[];const be=ee(H.text,H.sectionIndex,fu(H,b,h,e,s,R,F));for(const Ve of be){const Je=new za;Je.text=Ve[0],Je.sectionIndex=Ve[1],Je.sections=H.sections,J.push(Je)}}else J=function(be,Ve){const Je=[],$e=be.text;let Oe=0;for(const De of Ve)Je.push(be.substring(Oe,De)),Oe=De;return Oe<$e.length&&Je.push(be.substring(Oe,$e.length)),Je}(H,fu(H,b,h,e,s,R,F));const ce=[],de={positionedLines:ce,text:H.toString(),top:T[1],bottom:T[1],left:T[0],right:T[0],writingMode:P,iconsInText:!1,verticalizable:!1};return function(be,Ve,Je,$e,Oe,De,He,Le,Ae,st,Qe,St){let ri=0,oi=Vo,Ri=0,Ur=0;const xr=Le==="right"?1:Le==="left"?0:.5;let Pi=0;for(const Fi of Oe){Fi.trim();const Bi=Fi.getMaxScale(),lr=(Bi-1)*Li,Sr={positionedGlyphs:[],lineOffset:0};be.positionedLines[Pi]=Sr;const cr=Sr.positionedGlyphs;let zr=0;if(!Fi.length()){oi+=De,++Pi;continue}for(let Oi=0;Oi<Fi.length();Oi++){const Et=Fi.getSection(Oi),ur=Fi.getSectionIndex(Oi),ir=Fi.getCharCode(Oi);let Ni=0,ln=null,yn=null,vn=null,Jn=Li;const cn=!(Ae===a.ai.horizontal||!Qe&&!mo(ir)||Qe&&(tc[ir]||(Wi=ir,je.Arabic(Wi)||je["Arabic Supplement"](Wi)||je["Arabic Extended-A"](Wi)||je["Arabic Presentation Forms-A"](Wi)||je["Arabic Presentation Forms-B"](Wi))));if(Et.imageName){const Wr=$e[Et.imageName];if(!Wr)continue;vn=Et.imageName,be.iconsInText=be.iconsInText||!0,yn=Wr.paddedRect;const Lr=Wr.displaySize;Et.scale=Et.scale*Li/St,ln={width:Lr[0],height:Lr[1],left:kr,top:-pd,advance:cn?Lr[1]:Lr[0]},Ni=lr+(Li-Lr[1]*Et.scale),Jn=ln.advance;const Yn=cn?Lr[0]*Et.scale-Li*Bi:Lr[1]*Et.scale-Li*Bi;Yn>0&&Yn>zr&&(zr=Yn)}else{const Wr=Je[Et.fontStack],Lr=Wr&&Wr[ir];if(Lr&&Lr.rect)yn=Lr.rect,ln=Lr.metrics;else{const Yn=Ve[Et.fontStack],Wo=Yn&&Yn[ir];if(!Wo)continue;ln=Wo.metrics}Ni=(Bi-Et.scale)*Li}cn?(be.verticalizable=!0,cr.push({glyph:ir,imageName:vn,x:ri,y:oi+Ni,vertical:cn,scale:Et.scale,fontStack:Et.fontStack,sectionIndex:ur,metrics:ln,rect:yn}),ri+=Jn*Et.scale+st):(cr.push({glyph:ir,imageName:vn,x:ri,y:oi+Ni,vertical:cn,scale:Et.scale,fontStack:Et.fontStack,sectionIndex:ur,metrics:ln,rect:yn}),ri+=ln.advance*Et.scale+st)}cr.length!==0&&(Ri=Math.max(ri-st,Ri),hg(cr,0,cr.length-1,xr,zr)),ri=0;const Dr=De*Bi+zr;Sr.lineOffset=Math.max(zr,lr),oi+=Dr,Ur=Math.max(Dr,Ur),++Pi}var Wi;const tr=oi-Vo,{horizontalAlign:br,verticalAlign:wr}=mu(He);(function(Fi,Bi,lr,Sr,cr,zr,Dr,Oi,Et){const ur=(Bi-lr)*cr;let ir=0;ir=zr!==Dr?-Oi*Sr-Vo:(-Sr*Et+.5)*Dr;for(const Ni of Fi)for(const ln of Ni.positionedGlyphs)ln.x+=ur,ln.y+=ir})(be.positionedLines,xr,br,wr,Ri,Ur,De,tr,Oe.length),be.top+=-wr*tr,be.bottom=be.top+tr,be.left+=-br*Ri,be.right=be.left+Ri}(de,e,r,s,J,p,m,y,P,b,k,j),!function(be){for(const Ve of be)if(Ve.positionedGlyphs.length!==0)return!1;return!0}(ce)&&de}const tc={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},cg={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function gd(i,e,r,s,l,h){if(e.imageName){const p=s[e.imageName];return p?p.displaySize[0]*e.scale*Li/h+l:0}{const p=r[e.fontStack],m=p&&p[i];return m?m.metrics.advance*e.scale+l:0}}function _d(i,e,r,s){const l=Math.pow(i-e,2);return s?i<e?l/2:2*l:l+Math.abs(r)*r}function ug(i,e,r){let s=0;return i===10&&(s-=1e4),r&&(s+=150),i!==40&&i!==65288||(s+=50),e!==41&&e!==65289||(s+=50),s}function yd(i,e,r,s,l,h){let p=null,m=_d(e,r,l,h);for(const y of s){const b=_d(e-y.x,r,l,h)+y.badness;b<=m&&(p=y,m=b)}return{index:i,x:e,priorBreak:p,badness:m}}function vd(i){return i?vd(i.priorBreak).concat(i.index):[]}function fu(i,e,r,s,l,h,p){if(h!=="point")return[];if(!i)return[];const m=[],y=function(k,R,F,j,H,J){let se=0;for(let ee=0;ee<k.length();ee++){const ce=k.getSection(ee);se+=gd(k.getCharCode(ee),ce,j,H,R,J)}return se/Math.max(1,Math.ceil(se/F))}(i,e,r,s,l,p),b=i.text.indexOf("​")>=0;let T=0;for(let k=0;k<i.length();k++){const R=i.getSection(k),F=i.getCharCode(k);if(tc[F]||(T+=gd(F,R,s,l,e,p)),k<i.length()-1){const j=!((P=F)<11904||!(je["Bopomofo Extended"](P)||je.Bopomofo(P)||je["CJK Compatibility Forms"](P)||je["CJK Compatibility Ideographs"](P)||je["CJK Compatibility"](P)||je["CJK Radicals Supplement"](P)||je["CJK Strokes"](P)||je["CJK Symbols and Punctuation"](P)||je["CJK Unified Ideographs Extension A"](P)||je["CJK Unified Ideographs"](P)||je["Enclosed CJK Letters and Months"](P)||je["Halfwidth and Fullwidth Forms"](P)||je.Hiragana(P)||je["Ideographic Description Characters"](P)||je["Kangxi Radicals"](P)||je["Katakana Phonetic Extensions"](P)||je.Katakana(P)||je["Vertical Forms"](P)||je["Yi Radicals"](P)||je["Yi Syllables"](P)));(cg[F]||j||R.imageName)&&m.push(yd(k+1,T,y,m,ug(F,i.getCharCode(k+1),j&&b),!1))}}var P;return vd(yd(i.length(),T,y,m,0,!0))}function mu(i){let e=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function hg(i,e,r,s,l){if(!s&&!l)return;const h=i[r],p=(i[r].x+h.metrics.advance*h.scale)*s;for(let m=e;m<=r;m++)i[m].x-=p,i[m].y+=l}function dg(i,e,r){const{horizontalAlign:s,verticalAlign:l}=mu(r),h=e[0]-i.displaySize[0]*s,p=e[1]-i.displaySize[1]*l;return{image:i,top:p,bottom:p+i.displaySize[1],left:h,right:h+i.displaySize[0]}}function xd(i,e,r,s,l,h){const p=i.image;let m;if(p.content){const H=p.content,J=p.pixelRatio||1;m=[H[0]/J,H[1]/J,p.displaySize[0]-H[2]/J,p.displaySize[1]-H[3]/J]}const y=e.left*h,b=e.right*h;let T,P,k,R;r==="width"||r==="both"?(R=l[0]+y-s[3],P=l[0]+b+s[1]):(R=l[0]+(y+b-p.displaySize[0])/2,P=R+p.displaySize[0]);const F=e.top*h,j=e.bottom*h;return r==="height"||r==="both"?(T=l[1]+F-s[0],k=l[1]+j+s[2]):(T=l[1]+(F+j-p.displaySize[1])/2,k=T+p.displaySize[1]),{image:p,top:T,right:P,bottom:k,left:R,collisionPadding:m}}const qo=255,Ln=128,_s=qo*Ln;function bd(i,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new ti(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:s,interpolationType:l}=r;let h=0;for(;h<s.length&&s[h]<=i;)h++;h=Math.max(0,h-1);let p=h;for(;p<s.length&&s[p]<i+1;)p++;p=Math.min(s.length-1,p);const m=s[h],y=s[p];return r.kind==="composite"?{kind:"composite",minZoom:m,maxZoom:y,interpolationType:l}:{kind:"camera",minZoom:m,maxZoom:y,minSize:r.evaluate(new ti(m)),maxSize:r.evaluate(new ti(y)),interpolationType:l}}}function gu(i,e,r){let s="never";const l=i.get(e);return l?s=l:i.get(r)&&(s="always"),s}const pg=ms.VectorTileFeature.types,fg=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ic(i,e,r,s,l,h,p,m,y,b,T,P,k){const R=m?Math.min(_s,Math.round(m[0])):0,F=m?Math.min(_s,Math.round(m[1])):0;i.emplaceBack(e,r,Math.round(32*s),Math.round(32*l),h,p,(R<<1)+(y?1:0),F,16*b,16*T,256*P,256*k)}function _u(i,e,r){i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r)}function mg(i){for(const e of i.sections)if(Uc(e.text))return!0;return!1}class yu{constructor(e){this.layoutVertexArray=new Ct,this.indexArray=new Gi,this.programConfigurations=e,this.segments=new ii,this.dynamicLayoutVertexArray=new bt,this.opacityVertexArray=new It,this.hasVisibleVertices=!1,this.placedSymbolArray=new ie}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,s,l){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Gm.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Hm.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,fg,!0),this.opacityVertexBuffer.itemSize=1),(s||l)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ge("SymbolBuffers",yu);class vu{constructor(e,r,s){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new s,this.segments=new ii,this.collisionVertexArray=new ei}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Wm.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ge("CollisionBuffers",vu);class Da{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Kc([]),this.placementViewportMatrix=Kc([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=bd(this.zoom,r["text-size"]),this.iconSizeData=bd(this.zoom,r["icon-size"]);const s=this.layers[0].layout,l=s.get("symbol-sort-key"),h=s.get("symbol-z-order");this.canOverlap=gu(s,"text-overlap","text-allow-overlap")!=="never"||gu(s,"icon-overlap","icon-allow-overlap")!=="never"||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=h!=="viewport-y"&&!l.isConstant(),this.sortFeaturesByY=(h==="viewport-y"||h==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,s.get("symbol-placement")==="point"&&(this.writingModes=s.get("text-writing-mode").map(p=>a.ai[p])),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID}createArrays(){this.text=new yu(new _n(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new yu(new _n(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new re,this.lineVertexArray=new pe,this.symbolInstances=new K,this.textAnchorOffsets=new xe}calculateGlyphDependencies(e,r,s,l,h){for(let p=0;p<e.length;p++)if(r[e.charCodeAt(p)]=!0,(s||l)&&h){const m=jo[e.charAt(p)];m&&(r[m.charCodeAt(0)]=!0)}}populate(e,r,s){const l=this.layers[0],h=l.layout,p=h.get("text-font"),m=h.get("text-field"),y=h.get("icon-image"),b=(m.value.kind!=="constant"||m.value.value instanceof Yi&&!m.value.value.isEmpty()||m.value.value.toString().length>0)&&(p.value.kind!=="constant"||p.value.value.length>0),T=y.value.kind!=="constant"||!!y.value.value||Object.keys(y.parameters).length>0,P=h.get("symbol-sort-key");if(this.features=[],!b&&!T)return;const k=r.iconDependencies,R=r.glyphDependencies,F=r.availableImages,j=new ti(this.zoom);for(const{feature:H,id:J,index:se,sourceLayerIndex:ee}of e){const ce=l._featureFilter.needGeometry,de=Us(H,ce);if(!l._featureFilter.filter(j,de,s))continue;let be,Ve;if(ce||(de.geometry=Vs(H)),b){const $e=l.getValueAndResolveTokens("text-field",de,s,F),Oe=Yi.factory($e);mg(Oe)&&(this.hasRTLText=!0),(!this.hasRTLText||bo()==="unavailable"||this.hasRTLText&&Pr.isParsed())&&(be=Km(Oe,l,de))}if(T){const $e=l.getValueAndResolveTokens("icon-image",de,s,F);Ve=$e instanceof Zi?$e:Zi.fromString($e)}if(!be&&!Ve)continue;const Je=this.sortFeaturesByKey?P.evaluate(de,{},s):void 0;if(this.features.push({id:J,text:be,icon:Ve,index:se,sourceLayerIndex:ee,geometry:de.geometry,properties:H.properties,type:pg[H.type],sortKey:Je}),Ve&&(k[Ve.name]=!0),be){const $e=p.evaluate(de,{},s).join(","),Oe=h.get("text-rotation-alignment")!=="viewport"&&h.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(a.ai.vertical)>=0;for(const De of be.sections)if(De.image)k[De.image.name]=!0;else{const He=po(be.toString()),Le=De.fontStack||$e,Ae=R[Le]=R[Le]||{};this.calculateGlyphDependencies(De.text,Ae,Oe,this.allowVerticalPlacement,He)}}}h.get("symbol-placement")==="line"&&(this.features=function(H){const J={},se={},ee=[];let ce=0;function de($e){ee.push(H[$e]),ce++}function be($e,Oe,De){const He=se[$e];return delete se[$e],se[Oe]=He,ee[He].geometry[0].pop(),ee[He].geometry[0]=ee[He].geometry[0].concat(De[0]),He}function Ve($e,Oe,De){const He=J[Oe];return delete J[Oe],J[$e]=He,ee[He].geometry[0].shift(),ee[He].geometry[0]=De[0].concat(ee[He].geometry[0]),He}function Je($e,Oe,De){const He=De?Oe[0][Oe[0].length-1]:Oe[0][0];return`${$e}:${He.x}:${He.y}`}for(let $e=0;$e<H.length;$e++){const Oe=H[$e],De=Oe.geometry,He=Oe.text?Oe.text.toString():null;if(!He){de($e);continue}const Le=Je(He,De),Ae=Je(He,De,!0);if(Le in se&&Ae in J&&se[Le]!==J[Ae]){const st=Ve(Le,Ae,De),Qe=be(Le,Ae,ee[st].geometry);delete J[Le],delete se[Ae],se[Je(He,ee[Qe].geometry,!0)]=Qe,ee[st].geometry=null}else Le in se?be(Le,Ae,De):Ae in J?Ve(Le,Ae,De):(de($e),J[Le]=ce-1,se[Ae]=ce-1)}return ee.filter($e=>$e.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((H,J)=>H.sortKey-J.sortKey)}update(e,r,s){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,s),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,s))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const s=this.lineVertexArray.length;if(e.segment!==void 0){let l=e.dist(r[e.segment+1]),h=e.dist(r[e.segment]);const p={};for(let m=e.segment+1;m<r.length;m++)p[m]={x:r[m].x,y:r[m].y,tileUnitDistanceFromAnchor:l},m<r.length-1&&(l+=r[m+1].dist(r[m]));for(let m=e.segment||0;m>=0;m--)p[m]={x:r[m].x,y:r[m].y,tileUnitDistanceFromAnchor:h},m>0&&(h+=r[m-1].dist(r[m]));for(let m=0;m<r.length;m++){const y=p[m];this.lineVertexArray.emplaceBack(y.x,y.y,y.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,r,s,l,h,p,m,y,b,T,P,k){const R=e.indexArray,F=e.layoutVertexArray,j=e.segments.prepareSegment(4*r.length,F,R,this.canOverlap?p.sortKey:void 0),H=this.glyphOffsetArray.length,J=j.vertexLength,se=this.allowVerticalPlacement&&m===a.ai.vertical?Math.PI/2:0,ee=p.text&&p.text.sections;for(let ce=0;ce<r.length;ce++){const{tl:de,tr:be,bl:Ve,br:Je,tex:$e,pixelOffsetTL:Oe,pixelOffsetBR:De,minFontScaleX:He,minFontScaleY:Le,glyphOffset:Ae,isSDF:st,sectionIndex:Qe}=r[ce],St=j.vertexLength,ri=Ae[1];ic(F,y.x,y.y,de.x,ri+de.y,$e.x,$e.y,s,st,Oe.x,Oe.y,He,Le),ic(F,y.x,y.y,be.x,ri+be.y,$e.x+$e.w,$e.y,s,st,De.x,Oe.y,He,Le),ic(F,y.x,y.y,Ve.x,ri+Ve.y,$e.x,$e.y+$e.h,s,st,Oe.x,De.y,He,Le),ic(F,y.x,y.y,Je.x,ri+Je.y,$e.x+$e.w,$e.y+$e.h,s,st,De.x,De.y,He,Le),_u(e.dynamicLayoutVertexArray,y,se),R.emplaceBack(St,St+1,St+2),R.emplaceBack(St+1,St+2,St+3),j.vertexLength+=4,j.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ae[0]),ce!==r.length-1&&Qe===r[ce+1].sectionIndex||e.programConfigurations.populatePaintArrays(F.length,p,p.index,{},k,ee&&ee[Qe])}e.placedSymbolArray.emplaceBack(y.x,y.y,H,this.glyphOffsetArray.length-H,J,b,T,y.segment,s?s[0]:0,s?s[1]:0,l[0],l[1],m,0,!1,0,P)}_addCollisionDebugVertex(e,r,s,l,h,p){return r.emplaceBack(0,0),e.emplaceBack(s.x,s.y,l,h,Math.round(p.x),Math.round(p.y))}addCollisionDebugVertices(e,r,s,l,h,p,m){const y=h.segments.prepareSegment(4,h.layoutVertexArray,h.indexArray),b=y.vertexLength,T=h.layoutVertexArray,P=h.collisionVertexArray,k=m.anchorX,R=m.anchorY;this._addCollisionDebugVertex(T,P,p,k,R,new he(e,r)),this._addCollisionDebugVertex(T,P,p,k,R,new he(s,r)),this._addCollisionDebugVertex(T,P,p,k,R,new he(s,l)),this._addCollisionDebugVertex(T,P,p,k,R,new he(e,l)),y.vertexLength+=4;const F=h.indexArray;F.emplaceBack(b,b+1),F.emplaceBack(b+1,b+2),F.emplaceBack(b+2,b+3),F.emplaceBack(b+3,b),y.primitiveLength+=4}addDebugCollisionBoxes(e,r,s,l){for(let h=e;h<r;h++){const p=this.collisionBoxArray.get(h);this.addCollisionDebugVertices(p.x1,p.y1,p.x2,p.y2,l?this.textCollisionBox:this.iconCollisionBox,p.anchorPoint,s)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new vu(yi,sd.members,zi),this.iconCollisionBox=new vu(yi,sd.members,zi);for(let e=0;e<this.symbolInstances.length;e++){const r=this.symbolInstances.get(e);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(e,r,s,l,h,p,m,y,b){const T={};for(let P=r;P<s;P++){const k=e.get(P);T.textBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,anchorPointX:k.anchorPointX,anchorPointY:k.anchorPointY},T.textFeatureIndex=k.featureIndex;break}for(let P=l;P<h;P++){const k=e.get(P);T.verticalTextBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,anchorPointX:k.anchorPointX,anchorPointY:k.anchorPointY},T.verticalTextFeatureIndex=k.featureIndex;break}for(let P=p;P<m;P++){const k=e.get(P);T.iconBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,anchorPointX:k.anchorPointX,anchorPointY:k.anchorPointY},T.iconFeatureIndex=k.featureIndex;break}for(let P=y;P<b;P++){const k=e.get(P);T.verticalIconBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,anchorPointX:k.anchorPointX,anchorPointY:k.anchorPointY},T.verticalIconFeatureIndex=k.featureIndex;break}return T}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const s=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const s=e.placedSymbolArray.get(r),l=s.vertexStartIndex+4*s.numGlyphs;for(let h=s.vertexStartIndex;h<l;h+=4)e.indexArray.emplaceBack(h,h+1,h+2),e.indexArray.emplaceBack(h+1,h+2,h+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),s=Math.cos(e),l=[],h=[],p=[];for(let m=0;m<this.symbolInstances.length;++m){p.push(m);const y=this.symbolInstances.get(m);l.push(0|Math.round(r*y.anchorX+s*y.anchorY)),h.push(y.featureIndex)}return p.sort((m,y)=>l[m]-l[y]||h[y]-h[m]),p}addToSortKeyRanges(e,r){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===r?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const s=this.symbolInstances.get(r);this.featureSortOrder.push(s.featureIndex),[s.rightJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.leftJustifiedTextSymbolIndex].forEach((l,h,p)=>{l>=0&&p.indexOf(l)===h&&this.addIndicesForPlacedSymbol(this.text,l)}),s.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,s.verticalPlacedTextSymbolIndex),s.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.placedIconSymbolIndex),s.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let wd,Sd;Ge("SymbolBucket",Da,{omit:["layers","collisionBoxArray","features","compareText"]}),Da.MAX_GLYPHS=65535,Da.addDynamicAttributes=_u;var xu={get paint(){return Sd=Sd||new wi({"icon-opacity":new ut(me.paint_symbol["icon-opacity"]),"icon-color":new ut(me.paint_symbol["icon-color"]),"icon-halo-color":new ut(me.paint_symbol["icon-halo-color"]),"icon-halo-width":new ut(me.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ut(me.paint_symbol["icon-halo-blur"]),"icon-translate":new tt(me.paint_symbol["icon-translate"]),"icon-translate-anchor":new tt(me.paint_symbol["icon-translate-anchor"]),"text-opacity":new ut(me.paint_symbol["text-opacity"]),"text-color":new ut(me.paint_symbol["text-color"],{runtimeType:_i,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new ut(me.paint_symbol["text-halo-color"]),"text-halo-width":new ut(me.paint_symbol["text-halo-width"]),"text-halo-blur":new ut(me.paint_symbol["text-halo-blur"]),"text-translate":new tt(me.paint_symbol["text-translate"]),"text-translate-anchor":new tt(me.paint_symbol["text-translate-anchor"])})},get layout(){return wd=wd||new wi({"symbol-placement":new tt(me.layout_symbol["symbol-placement"]),"symbol-spacing":new tt(me.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new tt(me.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ut(me.layout_symbol["symbol-sort-key"]),"symbol-z-order":new tt(me.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new tt(me.layout_symbol["icon-allow-overlap"]),"icon-overlap":new tt(me.layout_symbol["icon-overlap"]),"icon-ignore-placement":new tt(me.layout_symbol["icon-ignore-placement"]),"icon-optional":new tt(me.layout_symbol["icon-optional"]),"icon-rotation-alignment":new tt(me.layout_symbol["icon-rotation-alignment"]),"icon-size":new ut(me.layout_symbol["icon-size"]),"icon-text-fit":new tt(me.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new tt(me.layout_symbol["icon-text-fit-padding"]),"icon-image":new ut(me.layout_symbol["icon-image"]),"icon-rotate":new ut(me.layout_symbol["icon-rotate"]),"icon-padding":new ut(me.layout_symbol["icon-padding"]),"icon-keep-upright":new tt(me.layout_symbol["icon-keep-upright"]),"icon-offset":new ut(me.layout_symbol["icon-offset"]),"icon-anchor":new ut(me.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new tt(me.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new tt(me.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new tt(me.layout_symbol["text-rotation-alignment"]),"text-field":new ut(me.layout_symbol["text-field"]),"text-font":new ut(me.layout_symbol["text-font"]),"text-size":new ut(me.layout_symbol["text-size"]),"text-max-width":new ut(me.layout_symbol["text-max-width"]),"text-line-height":new tt(me.layout_symbol["text-line-height"]),"text-letter-spacing":new ut(me.layout_symbol["text-letter-spacing"]),"text-justify":new ut(me.layout_symbol["text-justify"]),"text-radial-offset":new ut(me.layout_symbol["text-radial-offset"]),"text-variable-anchor":new tt(me.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new ut(me.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new ut(me.layout_symbol["text-anchor"]),"text-max-angle":new tt(me.layout_symbol["text-max-angle"]),"text-writing-mode":new tt(me.layout_symbol["text-writing-mode"]),"text-rotate":new ut(me.layout_symbol["text-rotate"]),"text-padding":new tt(me.layout_symbol["text-padding"]),"text-keep-upright":new tt(me.layout_symbol["text-keep-upright"]),"text-transform":new ut(me.layout_symbol["text-transform"]),"text-offset":new ut(me.layout_symbol["text-offset"]),"text-allow-overlap":new tt(me.layout_symbol["text-allow-overlap"]),"text-overlap":new tt(me.layout_symbol["text-overlap"]),"text-ignore-placement":new tt(me.layout_symbol["text-ignore-placement"]),"text-optional":new tt(me.layout_symbol["text-optional"])})}};class Cd{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:wt,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ge("FormatSectionOverride",Cd,{omit:["defaultValue"]});class rc extends jr{constructor(e){super(e,xu)}recalculate(e,r){if(super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const s=this.layout.get("text-writing-mode");if(s){const l=[];for(const h of s)l.indexOf(h)<0&&l.push(h);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,r,s,l){const h=this.layout.get(e).evaluate(r,{},s,l),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||pa(p.value)||!h?h:function(m,y){return y.replace(/{([^{}]+)}/g,(b,T)=>m&&T in m?String(m[T]):"")}(r.properties,h)}createBucket(e){return new Da(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of xu.paint.overridableProperties){if(!rc.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),s=new Cd(r),l=new ao(s,r.property.specification);let h=null;h=r.value.kind==="constant"||r.value.kind==="source"?new oo("source",l):new ma("composite",l,r.value.zoomStops),this.paint._values[e]=new ar(r.property,h,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,s){return!(!this.layout||r.isDataDriven()||s.isDataDriven())&&rc.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const s=e.get("text-field"),l=xu.paint.properties[r];let h=!1;const p=m=>{for(const y of m)if(l.overrides&&l.overrides.hasOverride(y))return void(h=!0)};if(s.value.kind==="constant"&&s.value.value instanceof Yi)p(s.value.value.sections);else if(s.value.kind==="source"){const m=b=>{h||(b instanceof On&&li(b.value)===q?p(b.value.sections):b instanceof da?p(b.sections):b.eachChild(m))},y=s.value;y._styleExpression&&m(y._styleExpression.expression)}return h}}let Td;var gg={get paint(){return Td=Td||new wi({"background-color":new tt(me.paint_background["background-color"]),"background-pattern":new So(me.paint_background["background-pattern"]),"background-opacity":new tt(me.paint_background["background-opacity"])})}};class _g extends jr{constructor(e){super(e,gg)}}let Id;var yg={get paint(){return Id=Id||new wi({"raster-opacity":new tt(me.paint_raster["raster-opacity"]),"raster-hue-rotate":new tt(me.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new tt(me.paint_raster["raster-brightness-min"]),"raster-brightness-max":new tt(me.paint_raster["raster-brightness-max"]),"raster-saturation":new tt(me.paint_raster["raster-saturation"]),"raster-contrast":new tt(me.paint_raster["raster-contrast"]),"raster-resampling":new tt(me.paint_raster["raster-resampling"]),"raster-fade-duration":new tt(me.paint_raster["raster-fade-duration"])})}};class vg extends jr{constructor(e){super(e,yg)}}class xg extends jr{constructor(e){super(e,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class bg{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const bu=63710088e-1;class ys{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ys(et(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,s=this.lat*r,l=e.lat*r,h=Math.sin(s)*Math.sin(l)+Math.cos(s)*Math.cos(l)*Math.cos((e.lng-this.lng)*r);return bu*Math.acos(Math.min(h,1))}static convert(e){if(e instanceof ys)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new ys(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new ys(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Ed=2*Math.PI*bu;function Ad(i){return Ed*Math.cos(i*Math.PI/180)}function Pd(i){return(180+i)/360}function Md(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function kd(i,e){return i/Ad(e)}function zd(i){return 360*i-180}function wu(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class nc{constructor(e,r,s=0){this.x=+e,this.y=+r,this.z=+s}static fromLngLat(e,r=0){const s=ys.convert(e);return new nc(Pd(s.lng),Md(s.lat),kd(r,s.lat))}toLngLat(){return new ys(zd(this.x),wu(this.y))}toAltitude(){return this.z*Ad(wu(this.y))}meterInMercatorCoordinateUnits(){return 1/Ed*(e=wu(this.y),1/Math.cos(e*Math.PI/180));var e}}function Dd(i,e,r){var s=2*Math.PI*6378137/256/Math.pow(2,r);return[i*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}class Su{constructor(e,r,s){if(e<0||e>25||s<0||s>=Math.pow(2,e)||r<0||r>=Math.pow(2,e))throw new Error(`x=${r}, y=${s}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=r,this.y=s,this.key=Zo(0,e,e,r,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r,s){const l=(p=this.y,m=this.z,y=Dd(256*(h=this.x),256*(p=Math.pow(2,m)-p-1),m),b=Dd(256*(h+1),256*(p+1),m),y[0]+","+y[1]+","+b[0]+","+b[1]);var h,p,m,y,b;const T=function(P,k,R){let F,j="";for(let H=P;H>0;H--)F=1<<H-1,j+=(k&F?1:0)+(R&F?2:0);return j}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,T).replace(/{bbox-epsg-3857}/g,l)}isChildOf(e){const r=this.z-e.z;return r>0&&e.x===this.x>>r&&e.y===this.y>>r}getTilePoint(e){const r=Math.pow(2,this.z);return new he((e.x*r-this.x)*Ai,(e.y*r-this.y)*Ai)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ld{constructor(e,r){this.wrap=e,this.canonical=r,this.key=Zo(e,r.z,r.z,r.x,r.y)}}class Hr{constructor(e,r,s,l,h){if(e<s)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${s}`);this.overscaledZ=e,this.wrap=r,this.canonical=new Su(s,+l,+h),this.key=Zo(r,e,s,l,h)}clone(){return new Hr(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-e;return e>this.canonical.z?new Hr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Hr(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-e;return e>this.canonical.z?Zo(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y):Zo(this.wrap*+r,e,e,this.canonical.x>>s,this.canonical.y>>s)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new Hr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,s=2*this.canonical.x,l=2*this.canonical.y;return[new Hr(r,this.wrap,r,s,l),new Hr(r,this.wrap,r,s+1,l),new Hr(r,this.wrap,r,s,l+1),new Hr(r,this.wrap,r,s+1,l+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Hr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Hr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ld(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new nc(e.x-this.wrap,e.y))}}function Zo(i,e,r,s,l){(i*=2)<0&&(i=-1*i-1);const h=1<<r;return(h*h*i+h*l+s).toString(36)+r.toString(36)+e.toString(36)}Ge("CanonicalTileID",Su),Ge("OverscaledTileID",Hr,{omit:["posMatrix"]});class Rd{constructor(e,r,s,l=1,h=1,p=1,m=0){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(s&&!["mapbox","terrarium","custom"].includes(s))return void gt(`"${s}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const y=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),s){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=l,this.greenFactor=h,this.blueFactor=p,this.baseShift=m;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let b=0;b<y;b++)this.data[this._idx(-1,b)]=this.data[this._idx(0,b)],this.data[this._idx(y,b)]=this.data[this._idx(y-1,b)],this.data[this._idx(b,-1)]=this.data[this._idx(b,0)],this.data[this._idx(b,y)]=this.data[this._idx(b,y-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(y,-1)]=this.data[this._idx(y-1,0)],this.data[this._idx(-1,y)]=this.data[this._idx(0,y-1)],this.data[this._idx(y,y)]=this.data[this._idx(y-1,y-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let b=0;b<y;b++)for(let T=0;T<y;T++){const P=this.get(b,T);P>this.max&&(this.max=P),P<this.min&&(this.min=P)}}get(e,r){const s=new Uint8Array(this.data.buffer),l=4*this._idx(e,r);return this.unpack(s[l],s[l+1],s[l+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}unpack(e,r,s){return e*this.redFactor+r*this.greenFactor+s*this.blueFactor-this.baseShift}getPixels(){return new Gr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,r,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let l=r*this.dim,h=r*this.dim+this.dim,p=s*this.dim,m=s*this.dim+this.dim;switch(r){case-1:l=h-1;break;case 1:h=l+1}switch(s){case-1:p=m-1;break;case 1:m=p+1}const y=-r*this.dim,b=-s*this.dim;for(let T=p;T<m;T++)for(let P=l;P<h;P++)this.data[this._idx(P,T)]=e.data[this._idx(P+y,T+b)]}}Ge("DEMData",Rd);class Fd{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const s=e[r];this._stringToNumber[s]=r,this._numberToString[r]=s}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class Bd{constructor(e,r,s,l,h){this.type="Feature",this._vectorTileFeature=e,e._z=r,e._x=s,e._y=l,this.properties=e.properties,this.id=h}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(e[r]=this[r]);return e}}class Od{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new us(Ai,16,0),this.grid3D=new us(Ai,16,0),this.featureIndexArray=new Ce,this.promoteId=r}insert(e,r,s,l,h,p){const m=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,l,h);const y=p?this.grid3D:this.grid;for(let b=0;b<r.length;b++){const T=r[b],P=[1/0,1/0,-1/0,-1/0];for(let k=0;k<T.length;k++){const R=T[k];P[0]=Math.min(P[0],R.x),P[1]=Math.min(P[1],R.y),P[2]=Math.max(P[2],R.x),P[3]=Math.max(P[3],R.y)}P[0]<Ai&&P[1]<Ai&&P[2]>=0&&P[3]>=0&&y.insert(m,P[0],P[1],P[2],P[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new ms.VectorTile(new hu(this.rawTileData)).layers,this.sourceLayerCoder=new Fd(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,r,s,l){this.loadVTLayers();const h=e.params||{},p=Ai/e.tileSize/e.scale,m=co(h.filter),y=e.queryGeometry,b=e.queryPadding*p,T=$d(y),P=this.grid.query(T.minX-b,T.minY-b,T.maxX+b,T.maxY+b),k=$d(e.cameraQueryGeometry),R=this.grid3D.query(k.minX-b,k.minY-b,k.maxX+b,k.maxY+b,(H,J,se,ee)=>function(ce,de,be,Ve,Je){for(const Oe of ce)if(de<=Oe.x&&be<=Oe.y&&Ve>=Oe.x&&Je>=Oe.y)return!0;const $e=[new he(de,be),new he(de,Je),new he(Ve,Je),new he(Ve,be)];if(ce.length>2){for(const Oe of $e)if(Ia(ce,Oe))return!0}for(let Oe=0;Oe<ce.length-1;Oe++)if(Qf(ce[Oe],ce[Oe+1],$e))return!0;return!1}(e.cameraQueryGeometry,H-b,J-b,se+b,ee+b));for(const H of R)P.push(H);P.sort(wg);const F={};let j;for(let H=0;H<P.length;H++){const J=P[H];if(J===j)continue;j=J;const se=this.featureIndexArray.get(J);let ee=null;this.loadMatchingFeature(F,se.bucketIndex,se.sourceLayerIndex,se.featureIndex,m,h.layers,h.availableImages,r,s,l,(ce,de,be)=>(ee||(ee=Vs(ce)),de.queryIntersectsFeature(y,ce,be,ee,this.z,e.transform,p,e.pixelPosMatrix)))}return F}loadMatchingFeature(e,r,s,l,h,p,m,y,b,T,P){const k=this.bucketLayerIDs[r];if(p&&!function(H,J){for(let se=0;se<H.length;se++)if(J.indexOf(H[se])>=0)return!0;return!1}(p,k))return;const R=this.sourceLayerCoder.decode(s),F=this.vtLayers[R].feature(l);if(h.needGeometry){const H=Us(F,!0);if(!h.filter(new ti(this.tileID.overscaledZ),H,this.tileID.canonical))return}else if(!h.filter(new ti(this.tileID.overscaledZ),F))return;const j=this.getId(F,R);for(let H=0;H<k.length;H++){const J=k[H];if(p&&p.indexOf(J)<0)continue;const se=y[J];if(!se)continue;let ee={};j&&T&&(ee=T.getState(se.sourceLayer||"_geojsonTileLayer",j));const ce=Ze({},b[J]);ce.paint=Nd(ce.paint,se.paint,F,ee,m),ce.layout=Nd(ce.layout,se.layout,F,ee,m);const de=!P||P(F,se,ee);if(!de)continue;const be=new Bd(F,this.z,this.x,this.y,j);be.layer=ce;let Ve=e[J];Ve===void 0&&(Ve=e[J]=[]),Ve.push({featureIndex:l,feature:be,intersectionZ:de})}}lookupSymbolFeatures(e,r,s,l,h,p,m,y){const b={};this.loadVTLayers();const T=co(h);for(const P of e)this.loadMatchingFeature(b,s,l,P,T,p,m,y,r);return b}hasLayer(e){for(const r of this.bucketLayerIDs)for(const s of r)if(e===s)return!0;return!1}getId(e,r){let s=e.id;return this.promoteId&&(s=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof s=="boolean"&&(s=Number(s))),s}}function Nd(i,e,r,s,l){return Pe(i,(h,p)=>{const m=e instanceof Ca?e.get(p):null;return m&&m.evaluate?m.evaluate(r,s,l):m})}function $d(i){let e=1/0,r=1/0,s=-1/0,l=-1/0;for(const h of i)e=Math.min(e,h.x),r=Math.min(r,h.y),s=Math.max(s,h.x),l=Math.max(l,h.y);return{minX:e,minY:r,maxX:s,maxY:l}}function wg(i,e){return e-i}function jd(i,e,r,s,l){const h=[];for(let p=0;p<i.length;p++){const m=i[p];let y;for(let b=0;b<m.length-1;b++){let T=m[b],P=m[b+1];T.x<e&&P.x<e||(T.x<e?T=new he(e,T.y+(e-T.x)/(P.x-T.x)*(P.y-T.y))._round():P.x<e&&(P=new he(e,T.y+(e-T.x)/(P.x-T.x)*(P.y-T.y))._round()),T.y<r&&P.y<r||(T.y<r?T=new he(T.x+(r-T.y)/(P.y-T.y)*(P.x-T.x),r)._round():P.y<r&&(P=new he(T.x+(r-T.y)/(P.y-T.y)*(P.x-T.x),r)._round()),T.x>=s&&P.x>=s||(T.x>=s?T=new he(s,T.y+(s-T.x)/(P.x-T.x)*(P.y-T.y))._round():P.x>=s&&(P=new he(s,T.y+(s-T.x)/(P.x-T.x)*(P.y-T.y))._round()),T.y>=l&&P.y>=l||(T.y>=l?T=new he(T.x+(l-T.y)/(P.y-T.y)*(P.x-T.x),l)._round():P.y>=l&&(P=new he(T.x+(l-T.y)/(P.y-T.y)*(P.x-T.x),l)._round()),y&&T.equals(y[y.length-1])||(y=[T],h.push(y)),y.push(P)))))}}return h}Ge("FeatureIndex",Od,{omit:["rawTileData","sourceLayerCoder"]});class vs extends he{constructor(e,r,s,l){super(e,r),this.angle=s,l!==void 0&&(this.segment=l)}clone(){return new vs(this.x,this.y,this.angle,this.segment)}}function Vd(i,e,r,s,l){if(e.segment===void 0||r===0)return!0;let h=e,p=e.segment+1,m=0;for(;m>-r/2;){if(p--,p<0)return!1;m-=i[p].dist(h),h=i[p]}m+=i[p].dist(i[p+1]),p++;const y=[];let b=0;for(;m<r/2;){const T=i[p],P=i[p+1];if(!P)return!1;let k=i[p-1].angleTo(T)-T.angleTo(P);for(k=Math.abs((k+3*Math.PI)%(2*Math.PI)-Math.PI),y.push({distance:m,angleDelta:k}),b+=k;m-y[0].distance>s;)b-=y.shift().angleDelta;if(b>l)return!1;p++,m+=T.dist(P)}return!0}function Ud(i){let e=0;for(let r=0;r<i.length-1;r++)e+=i[r].dist(i[r+1]);return e}function qd(i,e,r){return i?.6*e*r:0}function Zd(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function Sg(i,e,r,s,l,h){const p=qd(r,l,h),m=Zd(r,s)*h;let y=0;const b=Ud(i)/2;for(let T=0;T<i.length-1;T++){const P=i[T],k=i[T+1],R=P.dist(k);if(y+R>b){const F=(b-y)/R,j=Ir.number(P.x,k.x,F),H=Ir.number(P.y,k.y,F),J=new vs(j,H,k.angleTo(P),T);return J._round(),!p||Vd(i,J,m,p,e)?J:void 0}y+=R}}function Cg(i,e,r,s,l,h,p,m,y){const b=qd(s,h,p),T=Zd(s,l),P=T*p,k=i[0].x===0||i[0].x===y||i[0].y===0||i[0].y===y;return e-P<e/4&&(e=P+e/4),Gd(i,k?e/2*m%e:(T/2+2*h)*p*m%e,e,b,r,P,k,!1,y)}function Gd(i,e,r,s,l,h,p,m,y){const b=h/2,T=Ud(i);let P=0,k=e-r,R=[];for(let F=0;F<i.length-1;F++){const j=i[F],H=i[F+1],J=j.dist(H),se=H.angleTo(j);for(;k+r<P+J;){k+=r;const ee=(k-P)/J,ce=Ir.number(j.x,H.x,ee),de=Ir.number(j.y,H.y,ee);if(ce>=0&&ce<y&&de>=0&&de<y&&k-b>=0&&k+b<=T){const be=new vs(ce,de,se,F);be._round(),s&&!Vd(i,be,h,s,l)||R.push(be)}}P+=J}return m||R.length||p||(R=Gd(i,P/2,r,s,l,h,p,!0,y)),R}Ge("Anchor",vs);const La=kr;function Hd(i,e,r,s){const l=[],h=i.image,p=h.pixelRatio,m=h.paddedRect.w-2*La,y=h.paddedRect.h-2*La,b=i.right-i.left,T=i.bottom-i.top,P=h.stretchX||[[0,m]],k=h.stretchY||[[0,y]],R=(De,He)=>De+He[1]-He[0],F=P.reduce(R,0),j=k.reduce(R,0),H=m-F,J=y-j;let se=0,ee=F,ce=0,de=j,be=0,Ve=H,Je=0,$e=J;if(h.content&&s){const De=h.content;se=sc(P,0,De[0]),ce=sc(k,0,De[1]),ee=sc(P,De[0],De[2]),de=sc(k,De[1],De[3]),be=De[0]-se,Je=De[1]-ce,Ve=De[2]-De[0]-ee,$e=De[3]-De[1]-de}const Oe=(De,He,Le,Ae)=>{const st=ac(De.stretch-se,ee,b,i.left),Qe=oc(De.fixed-be,Ve,De.stretch,F),St=ac(He.stretch-ce,de,T,i.top),ri=oc(He.fixed-Je,$e,He.stretch,j),oi=ac(Le.stretch-se,ee,b,i.left),Ri=oc(Le.fixed-be,Ve,Le.stretch,F),Ur=ac(Ae.stretch-ce,de,T,i.top),xr=oc(Ae.fixed-Je,$e,Ae.stretch,j),Pi=new he(st,St),Wi=new he(oi,St),tr=new he(oi,Ur),br=new he(st,Ur),wr=new he(Qe/p,ri/p),Fi=new he(Ri/p,xr/p),Bi=e*Math.PI/180;if(Bi){const cr=Math.sin(Bi),zr=Math.cos(Bi),Dr=[zr,-cr,cr,zr];Pi._matMult(Dr),Wi._matMult(Dr),br._matMult(Dr),tr._matMult(Dr)}const lr=De.stretch+De.fixed,Sr=He.stretch+He.fixed;return{tl:Pi,tr:Wi,bl:br,br:tr,tex:{x:h.paddedRect.x+La+lr,y:h.paddedRect.y+La+Sr,w:Le.stretch+Le.fixed-lr,h:Ae.stretch+Ae.fixed-Sr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:wr,pixelOffsetBR:Fi,minFontScaleX:Ve/p/b,minFontScaleY:$e/p/T,isSDF:r}};if(s&&(h.stretchX||h.stretchY)){const De=Wd(P,H,F),He=Wd(k,J,j);for(let Le=0;Le<De.length-1;Le++){const Ae=De[Le],st=De[Le+1];for(let Qe=0;Qe<He.length-1;Qe++)l.push(Oe(Ae,He[Qe],st,He[Qe+1]))}}else l.push(Oe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:m+1},{fixed:0,stretch:y+1}));return l}function sc(i,e,r){let s=0;for(const l of i)s+=Math.max(e,Math.min(r,l[1]))-Math.max(e,Math.min(r,l[0]));return s}function Wd(i,e,r){const s=[{fixed:-La,stretch:0}];for(const[l,h]of i){const p=s[s.length-1];s.push({fixed:l-p.stretch,stretch:p.stretch}),s.push({fixed:l-p.stretch,stretch:p.stretch+(h-l)})}return s.push({fixed:e+La,stretch:r}),s}function ac(i,e,r,s){return i/e*r+s}function oc(i,e,r,s){return i-e*r/s}class lc{constructor(e,r,s,l,h,p,m,y,b,T){if(this.boxStartIndex=e.length,b){let P=p.top,k=p.bottom;const R=p.collisionPadding;R&&(P-=R[1],k+=R[3]);let F=k-P;F>0&&(F=Math.max(10,F),this.circleDiameter=F)}else{let P=p.top*m-y[0],k=p.bottom*m+y[2],R=p.left*m-y[3],F=p.right*m+y[1];const j=p.collisionPadding;if(j&&(R-=j[0]*m,P-=j[1]*m,F+=j[2]*m,k+=j[3]*m),T){const H=new he(R,P),J=new he(F,P),se=new he(R,k),ee=new he(F,k),ce=T*Math.PI/180;H._rotate(ce),J._rotate(ce),se._rotate(ce),ee._rotate(ce),R=Math.min(H.x,J.x,se.x,ee.x),F=Math.max(H.x,J.x,se.x,ee.x),P=Math.min(H.y,J.y,se.y,ee.y),k=Math.max(H.y,J.y,se.y,ee.y)}e.emplaceBack(r.x,r.y,R,P,F,k,s,l,h)}this.boxEndIndex=e.length}}class Tg{constructor(e=[],r=Ig){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:s}=this,l=r[e];for(;e>0;){const h=e-1>>1,p=r[h];if(s(l,p)>=0)break;r[e]=p,e=h}r[e]=l}_down(e){const{data:r,compare:s}=this,l=this.length>>1,h=r[e];for(;e<l;){let p=1+(e<<1),m=r[p];const y=p+1;if(y<this.length&&s(r[y],m)<0&&(p=y,m=r[y]),s(m,h)>=0)break;r[e]=m,e=p}r[e]=h}}function Ig(i,e){return i<e?-1:i>e?1:0}function Eg(i,e=1,r=!1){let s=1/0,l=1/0,h=-1/0,p=-1/0;const m=i[0];for(let R=0;R<m.length;R++){const F=m[R];(!R||F.x<s)&&(s=F.x),(!R||F.y<l)&&(l=F.y),(!R||F.x>h)&&(h=F.x),(!R||F.y>p)&&(p=F.y)}const y=Math.min(h-s,p-l);let b=y/2;const T=new Tg([],Ag);if(y===0)return new he(s,l);for(let R=s;R<h;R+=y)for(let F=l;F<p;F+=y)T.push(new Ra(R+b,F+b,b,i));let P=function(R){let F=0,j=0,H=0;const J=R[0];for(let se=0,ee=J.length,ce=ee-1;se<ee;ce=se++){const de=J[se],be=J[ce],Ve=de.x*be.y-be.x*de.y;j+=(de.x+be.x)*Ve,H+=(de.y+be.y)*Ve,F+=3*Ve}return new Ra(j/F,H/F,0,R)}(i),k=T.length;for(;T.length;){const R=T.pop();(R.d>P.d||!P.d)&&(P=R,r&&console.log("found best %d after %d probes",Math.round(1e4*R.d)/1e4,k)),R.max-P.d<=e||(b=R.h/2,T.push(new Ra(R.p.x-b,R.p.y-b,b,i)),T.push(new Ra(R.p.x+b,R.p.y-b,b,i)),T.push(new Ra(R.p.x-b,R.p.y+b,b,i)),T.push(new Ra(R.p.x+b,R.p.y+b,b,i)),k+=4)}return r&&(console.log(`num probes: ${k}`),console.log(`best distance: ${P.d}`)),P.p}function Ag(i,e){return e.max-i.max}function Ra(i,e,r,s){this.p=new he(i,e),this.h=r,this.d=function(l,h){let p=!1,m=1/0;for(let y=0;y<h.length;y++){const b=h[y];for(let T=0,P=b.length,k=P-1;T<P;k=T++){const R=b[T],F=b[k];R.y>l.y!=F.y>l.y&&l.x<(F.x-R.x)*(l.y-R.y)/(F.y-R.y)+R.x&&(p=!p),m=Math.min(m,Mh(l,R,F))}}return(p?1:-1)*Math.sqrt(m)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}var er;a.aq=void 0,(er=a.aq||(a.aq={}))[er.center=1]="center",er[er.left=2]="left",er[er.right=3]="right",er[er.top=4]="top",er[er.bottom=5]="bottom",er[er["top-left"]=6]="top-left",er[er["top-right"]=7]="top-right",er[er["bottom-left"]=8]="bottom-left",er[er["bottom-right"]=9]="bottom-right";const xs=7,Cu=Number.POSITIVE_INFINITY;function Xd(i,e){return e[1]!==Cu?function(r,s,l){let h=0,p=0;switch(s=Math.abs(s),l=Math.abs(l),r){case"top-right":case"top-left":case"top":p=l-xs;break;case"bottom-right":case"bottom-left":case"bottom":p=-l+xs}switch(r){case"top-right":case"bottom-right":case"right":h=-s;break;case"top-left":case"bottom-left":case"left":h=s}return[h,p]}(i,e[0],e[1]):function(r,s){let l=0,h=0;s<0&&(s=0);const p=s/Math.SQRT2;switch(r){case"top-right":case"top-left":h=p-xs;break;case"bottom-right":case"bottom-left":h=-p+xs;break;case"bottom":h=-s+xs;break;case"top":h=s-xs}switch(r){case"top-right":case"bottom-right":l=-p;break;case"top-left":case"bottom-left":l=p;break;case"left":l=s;break;case"right":l=-s}return[l,h]}(i,e[0])}function Kd(i,e,r){var s;const l=i.layout,h=(s=l.get("text-variable-anchor-offset"))===null||s===void 0?void 0:s.evaluate(e,{},r);if(h){const m=h.values,y=[];for(let b=0;b<m.length;b+=2){const T=y[b]=m[b],P=m[b+1].map(k=>k*Li);T.startsWith("top")?P[1]-=xs:T.startsWith("bottom")&&(P[1]+=xs),y[b+1]=P}return new Br(y)}const p=l.get("text-variable-anchor");if(p){let m;m=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[l.get("text-radial-offset").evaluate(e,{},r)*Li,Cu]:l.get("text-offset").evaluate(e,{},r).map(b=>b*Li);const y=[];for(const b of p)y.push(b,Xd(b,m));return new Br(y)}return null}function Tu(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Pg(i,e,r,s,l,h,p,m,y,b,T){let P=h.textMaxSize.evaluate(e,{});P===void 0&&(P=p);const k=i.layers[0].layout,R=k.get("icon-offset").evaluate(e,{},T),F=Yd(r.horizontal),j=p/24,H=i.tilePixelRatio*j,J=i.tilePixelRatio*P/24,se=i.tilePixelRatio*m,ee=i.tilePixelRatio*k.get("symbol-spacing"),ce=k.get("text-padding")*i.tilePixelRatio,de=function(Ae,st,Qe,St=1){const ri=Ae.get("icon-padding").evaluate(st,{},Qe),oi=ri&&ri.values;return[oi[0]*St,oi[1]*St,oi[2]*St,oi[3]*St]}(k,e,T,i.tilePixelRatio),be=k.get("text-max-angle")/180*Math.PI,Ve=k.get("text-rotation-alignment")!=="viewport"&&k.get("symbol-placement")!=="point",Je=k.get("icon-rotation-alignment")==="map"&&k.get("symbol-placement")!=="point",$e=k.get("symbol-placement"),Oe=ee/2,De=k.get("icon-text-fit");let He;s&&De!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(He=xd(s,r.vertical,De,k.get("icon-text-fit-padding"),R,j)),F&&(s=xd(s,F,De,k.get("icon-text-fit-padding"),R,j)));const Le=(Ae,st)=>{st.x<0||st.x>=Ai||st.y<0||st.y>=Ai||function(Qe,St,ri,oi,Ri,Ur,xr,Pi,Wi,tr,br,wr,Fi,Bi,lr,Sr,cr,zr,Dr,Oi,Et,ur,ir,Ni,ln){const yn=Qe.addToLineVertexArray(St,ri);let vn,Jn,cn,Wr,Lr=0,Yn=0,Wo=0,ip=0,Du=-1,Lu=-1;const Qn={};let rp=Hn("");if(Qe.allowVerticalPlacement&&oi.vertical){const hr=Pi.layout.get("text-rotate").evaluate(Et,{},Ni)+90;cn=new lc(Wi,St,tr,br,wr,oi.vertical,Fi,Bi,lr,hr),xr&&(Wr=new lc(Wi,St,tr,br,wr,xr,cr,zr,lr,hr))}if(Ri){const hr=Pi.layout.get("icon-rotate").evaluate(Et,{}),Xr=Pi.layout.get("icon-text-fit")!=="none",Zs=Hd(Ri,hr,ir,Xr),bn=xr?Hd(xr,hr,ir,Xr):void 0;Jn=new lc(Wi,St,tr,br,wr,Ri,cr,zr,!1,hr),Lr=4*Zs.length;const Gs=Qe.iconSizeData;let Rn=null;Gs.kind==="source"?(Rn=[Ln*Pi.layout.get("icon-size").evaluate(Et,{})],Rn[0]>_s&&gt(`${Qe.layerIds[0]}: Value for "icon-size" is >= ${qo}. Reduce your "icon-size".`)):Gs.kind==="composite"&&(Rn=[Ln*ur.compositeIconSizes[0].evaluate(Et,{},Ni),Ln*ur.compositeIconSizes[1].evaluate(Et,{},Ni)],(Rn[0]>_s||Rn[1]>_s)&&gt(`${Qe.layerIds[0]}: Value for "icon-size" is >= ${qo}. Reduce your "icon-size".`)),Qe.addSymbols(Qe.icon,Zs,Rn,Oi,Dr,Et,a.ai.none,St,yn.lineStartIndex,yn.lineLength,-1,Ni),Du=Qe.icon.placedSymbolArray.length-1,bn&&(Yn=4*bn.length,Qe.addSymbols(Qe.icon,bn,Rn,Oi,Dr,Et,a.ai.vertical,St,yn.lineStartIndex,yn.lineLength,-1,Ni),Lu=Qe.icon.placedSymbolArray.length-1)}const np=Object.keys(oi.horizontal);for(const hr of np){const Xr=oi.horizontal[hr];if(!vn){rp=Hn(Xr.text);const bn=Pi.layout.get("text-rotate").evaluate(Et,{},Ni);vn=new lc(Wi,St,tr,br,wr,Xr,Fi,Bi,lr,bn)}const Zs=Xr.positionedLines.length===1;if(Wo+=Jd(Qe,St,Xr,Ur,Pi,lr,Et,Sr,yn,oi.vertical?a.ai.horizontal:a.ai.horizontalOnly,Zs?np:[hr],Qn,Du,ur,Ni),Zs)break}oi.vertical&&(ip+=Jd(Qe,St,oi.vertical,Ur,Pi,lr,Et,Sr,yn,a.ai.vertical,["vertical"],Qn,Lu,ur,Ni));const zg=vn?vn.boxStartIndex:Qe.collisionBoxArray.length,Dg=vn?vn.boxEndIndex:Qe.collisionBoxArray.length,Lg=cn?cn.boxStartIndex:Qe.collisionBoxArray.length,Rg=cn?cn.boxEndIndex:Qe.collisionBoxArray.length,Fg=Jn?Jn.boxStartIndex:Qe.collisionBoxArray.length,Bg=Jn?Jn.boxEndIndex:Qe.collisionBoxArray.length,Og=Wr?Wr.boxStartIndex:Qe.collisionBoxArray.length,Ng=Wr?Wr.boxEndIndex:Qe.collisionBoxArray.length;let xn=-1;const uc=(hr,Xr)=>hr&&hr.circleDiameter?Math.max(hr.circleDiameter,Xr):Xr;xn=uc(vn,xn),xn=uc(cn,xn),xn=uc(Jn,xn),xn=uc(Wr,xn);const sp=xn>-1?1:0;sp&&(xn*=ln/Li),Qe.glyphOffsetArray.length>=Da.MAX_GLYPHS&&gt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Et.sortKey!==void 0&&Qe.addToSortKeyRanges(Qe.symbolInstances.length,Et.sortKey);const $g=Kd(Pi,Et,Ni),[jg,Vg]=function(hr,Xr){const Zs=hr.length,bn=Xr?.values;if(bn?.length>0)for(let Gs=0;Gs<bn.length;Gs+=2){const Rn=bn[Gs+1];hr.emplaceBack(a.aq[bn[Gs]],Rn[0],Rn[1])}return[Zs,hr.length]}(Qe.textAnchorOffsets,$g);Qe.symbolInstances.emplaceBack(St.x,St.y,Qn.right>=0?Qn.right:-1,Qn.center>=0?Qn.center:-1,Qn.left>=0?Qn.left:-1,Qn.vertical||-1,Du,Lu,rp,zg,Dg,Lg,Rg,Fg,Bg,Og,Ng,tr,Wo,ip,Lr,Yn,sp,0,Fi,xn,jg,Vg)}(i,st,Ae,r,s,l,He,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,H,[ce,ce,ce,ce],Ve,y,se,de,Je,R,e,h,b,T,p)};if($e==="line")for(const Ae of jd(e.geometry,0,0,Ai,Ai)){const st=Cg(Ae,ee,be,r.vertical||F,s,24,J,i.overscaling,Ai);for(const Qe of st)F&&Mg(i,F.text,Oe,Qe)||Le(Ae,Qe)}else if($e==="line-center"){for(const Ae of e.geometry)if(Ae.length>1){const st=Sg(Ae,be,r.vertical||F,s,24,J);st&&Le(Ae,st)}}else if(e.type==="Polygon")for(const Ae of ru(e.geometry,0)){const st=Eg(Ae,16);Le(Ae[0],new vs(st.x,st.y,0))}else if(e.type==="LineString")for(const Ae of e.geometry)Le(Ae,new vs(Ae[0].x,Ae[0].y,0));else if(e.type==="Point")for(const Ae of e.geometry)for(const st of Ae)Le([st],new vs(st.x,st.y,0))}function Jd(i,e,r,s,l,h,p,m,y,b,T,P,k,R,F){const j=function(se,ee,ce,de,be,Ve,Je,$e){const Oe=de.layout.get("text-rotate").evaluate(Ve,{})*Math.PI/180,De=[];for(const He of ee.positionedLines)for(const Le of He.positionedGlyphs){if(!Le.rect)continue;const Ae=Le.rect||{};let st=pd+1,Qe=!0,St=1,ri=0;const oi=(be||$e)&&Le.vertical,Ri=Le.metrics.advance*Le.scale/2;if($e&&ee.verticalizable&&(ri=He.lineOffset/2-(Le.imageName?-(Li-Le.metrics.width*Le.scale)/2:(Le.scale-1)*Li)),Le.imageName){const Oi=Je[Le.imageName];Qe=Oi.sdf,St=Oi.pixelRatio,st=kr/St}const Ur=be?[Le.x+Ri,Le.y]:[0,0];let xr=be?[0,0]:[Le.x+Ri+ce[0],Le.y+ce[1]-ri],Pi=[0,0];oi&&(Pi=xr,xr=[0,0]);const Wi=Le.metrics.isDoubleResolution?2:1,tr=(Le.metrics.left-st)*Le.scale-Ri+xr[0],br=(-Le.metrics.top-st)*Le.scale+xr[1],wr=tr+Ae.w/Wi*Le.scale/St,Fi=br+Ae.h/Wi*Le.scale/St,Bi=new he(tr,br),lr=new he(wr,br),Sr=new he(tr,Fi),cr=new he(wr,Fi);if(oi){const Oi=new he(-Ri,Ri-Vo),Et=-Math.PI/2,ur=Li/2-Ri,ir=new he(5-Vo-ur,-(Le.imageName?ur:0)),Ni=new he(...Pi);Bi._rotateAround(Et,Oi)._add(ir)._add(Ni),lr._rotateAround(Et,Oi)._add(ir)._add(Ni),Sr._rotateAround(Et,Oi)._add(ir)._add(Ni),cr._rotateAround(Et,Oi)._add(ir)._add(Ni)}if(Oe){const Oi=Math.sin(Oe),Et=Math.cos(Oe),ur=[Et,-Oi,Oi,Et];Bi._matMult(ur),lr._matMult(ur),Sr._matMult(ur),cr._matMult(ur)}const zr=new he(0,0),Dr=new he(0,0);De.push({tl:Bi,tr:lr,bl:Sr,br:cr,tex:Ae,writingMode:ee.writingMode,glyphOffset:Ur,sectionIndex:Le.sectionIndex,isSDF:Qe,pixelOffsetTL:zr,pixelOffsetBR:Dr,minFontScaleX:0,minFontScaleY:0})}return De}(0,r,m,l,h,p,s,i.allowVerticalPlacement),H=i.textSizeData;let J=null;H.kind==="source"?(J=[Ln*l.layout.get("text-size").evaluate(p,{})],J[0]>_s&&gt(`${i.layerIds[0]}: Value for "text-size" is >= ${qo}. Reduce your "text-size".`)):H.kind==="composite"&&(J=[Ln*R.compositeTextSizes[0].evaluate(p,{},F),Ln*R.compositeTextSizes[1].evaluate(p,{},F)],(J[0]>_s||J[1]>_s)&&gt(`${i.layerIds[0]}: Value for "text-size" is >= ${qo}. Reduce your "text-size".`)),i.addSymbols(i.text,j,J,m,h,p,b,e,y.lineStartIndex,y.lineLength,k,F);for(const se of T)P[se]=i.text.placedSymbolArray.length-1;return 4*j.length}function Yd(i){for(const e in i)return i[e];return null}function Mg(i,e,r,s){const l=i.compareText;if(e in l){const h=l[e];for(let p=h.length-1;p>=0;p--)if(s.dist(h[p])<r)return!0}else l[e]=[];return l[e].push(s),!1}const Qd=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Iu{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,s]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const l=s>>4;if(l!==1)throw new Error(`Got v${l} data when expected v1.`);const h=Qd[15&s];if(!h)throw new Error("Unrecognized array type.");const[p]=new Uint16Array(e,2,1),[m]=new Uint32Array(e,4,1);return new Iu(m,p,h,e)}constructor(e,r=64,s=Float64Array,l){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=s,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const h=Qd.indexOf(this.ArrayType),p=2*e*this.ArrayType.BYTES_PER_ELEMENT,m=e*this.IndexArrayType.BYTES_PER_ELEMENT,y=(8-m%8)%8;if(h<0)throw new Error(`Unexpected typed array class: ${s}.`);l&&l instanceof ArrayBuffer?(this.data=l,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+m+y,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+p+m+y),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+m+y,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+h]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=e,this.coords[this._pos++]=r,s}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Eu(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,s,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:p,nodeSize:m}=this,y=[0,h.length-1,0],b=[];for(;y.length;){const T=y.pop()||0,P=y.pop()||0,k=y.pop()||0;if(P-k<=m){for(let H=k;H<=P;H++){const J=p[2*H],se=p[2*H+1];J>=e&&J<=s&&se>=r&&se<=l&&b.push(h[H])}continue}const R=k+P>>1,F=p[2*R],j=p[2*R+1];F>=e&&F<=s&&j>=r&&j<=l&&b.push(h[R]),(T===0?e<=F:r<=j)&&(y.push(k),y.push(R-1),y.push(1-T)),(T===0?s>=F:l>=j)&&(y.push(R+1),y.push(P),y.push(1-T))}return b}within(e,r,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:l,coords:h,nodeSize:p}=this,m=[0,l.length-1,0],y=[],b=s*s;for(;m.length;){const T=m.pop()||0,P=m.pop()||0,k=m.pop()||0;if(P-k<=p){for(let H=k;H<=P;H++)tp(h[2*H],h[2*H+1],e,r)<=b&&y.push(l[H]);continue}const R=k+P>>1,F=h[2*R],j=h[2*R+1];tp(F,j,e,r)<=b&&y.push(l[R]),(T===0?e-s<=F:r-s<=j)&&(m.push(k),m.push(R-1),m.push(1-T)),(T===0?e+s>=F:r+s>=j)&&(m.push(R+1),m.push(P),m.push(1-T))}return y}}function Eu(i,e,r,s,l,h){if(l-s<=r)return;const p=s+l>>1;ep(i,e,p,s,l,h),Eu(i,e,r,s,p-1,1-h),Eu(i,e,r,p+1,l,1-h)}function ep(i,e,r,s,l,h){for(;l>s;){if(l-s>600){const b=l-s+1,T=r-s+1,P=Math.log(b),k=.5*Math.exp(2*P/3),R=.5*Math.sqrt(P*k*(b-k)/b)*(T-b/2<0?-1:1);ep(i,e,r,Math.max(s,Math.floor(r-T*k/b+R)),Math.min(l,Math.floor(r+(b-T)*k/b+R)),h)}const p=e[2*r+h];let m=s,y=l;for(Go(i,e,s,r),e[2*l+h]>p&&Go(i,e,s,l);m<y;){for(Go(i,e,m,y),m++,y--;e[2*m+h]<p;)m++;for(;e[2*y+h]>p;)y--}e[2*s+h]===p?Go(i,e,s,y):(y++,Go(i,e,y,l)),y<=r&&(s=y+1),r<=y&&(l=y-1)}}function Go(i,e,r,s){Au(i,r,s),Au(e,2*r,2*s),Au(e,2*r+1,2*s+1)}function Au(i,e,r){const s=i[e];i[e]=i[r],i[r]=s}function tp(i,e,r,s){const l=i-r,h=e-s;return l*l+h*h}var Pu;a.bh=void 0,(Pu=a.bh||(a.bh={})).create="create",Pu.load="load",Pu.fullLoad="fullLoad";let cc=null,Ho=[];const Mu=1e3/60,ku="loadTime",zu="fullLoadTime",kg={mark(i){performance.mark(i)},frame(i){const e=i;cc!=null&&Ho.push(e-cc),cc=e},clearMetrics(){cc=null,Ho=[],performance.clearMeasures(ku),performance.clearMeasures(zu);for(const i in a.bh)performance.clearMarks(a.bh[i])},getPerformanceMetrics(){performance.measure(ku,a.bh.create,a.bh.load),performance.measure(zu,a.bh.create,a.bh.fullLoad);const i=performance.getEntriesByName(ku)[0].duration,e=performance.getEntriesByName(zu)[0].duration,r=Ho.length,s=1/(Ho.reduce((h,p)=>h+p,0)/r/1e3),l=Ho.filter(h=>h>Mu).reduce((h,p)=>h+(p-Mu)/Mu,0);return{loadTime:i,fullLoadTime:e,fps:s,percentDroppedFrames:l/(r+l)*100,totalFrames:r}}};a.$=function(i,e,r){var s,l,h,p,m,y,b,T,P,k,R,F,j=r[0],H=r[1],J=r[2];return e===i?(i[12]=e[0]*j+e[4]*H+e[8]*J+e[12],i[13]=e[1]*j+e[5]*H+e[9]*J+e[13],i[14]=e[2]*j+e[6]*H+e[10]*J+e[14],i[15]=e[3]*j+e[7]*H+e[11]*J+e[15]):(l=e[1],h=e[2],p=e[3],m=e[4],y=e[5],b=e[6],T=e[7],P=e[8],k=e[9],R=e[10],F=e[11],i[0]=s=e[0],i[1]=l,i[2]=h,i[3]=p,i[4]=m,i[5]=y,i[6]=b,i[7]=T,i[8]=P,i[9]=k,i[10]=R,i[11]=F,i[12]=s*j+m*H+P*J+e[12],i[13]=l*j+y*H+k*J+e[13],i[14]=h*j+b*H+R*J+e[14],i[15]=p*j+T*H+F*J+e[15]),i},a.A=Ea,a.B=Ir,a.C=class{constructor(i,e,r){this.receive=s=>{const l=s.data,h=l.id;if(h&&(!l.targetMapId||this.mapId===l.targetMapId))if(l.type==="<cancel>"){delete this.tasks[h];const p=this.cancelCallbacks[h];delete this.cancelCallbacks[h],p&&p()}else ft()||l.mustQueue?(this.tasks[h]=l,this.taskQueue.push(h),this.invoker.trigger()):this.processTask(h,l)},this.process=()=>{if(!this.taskQueue.length)return;const s=this.taskQueue.shift(),l=this.tasks[s];delete this.tasks[s],this.taskQueue.length&&this.invoker.trigger(),l&&this.processTask(s,l)},this.target=i,this.parent=e,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new bg(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=ft()?i:window}send(i,e,r,s,l=!1){const h=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[h]=r);const p=[],m={id:h,type:i,hasCallback:!!r,targetMapId:s,mustQueue:l,sourceMapId:this.mapId,data:kn(e,p)};return this.target.postMessage(m,{transfer:p}),{cancel:()=>{r&&delete this.callbacks[h],this.target.postMessage({id:h,type:"<cancel>",targetMapId:s,sourceMapId:this.mapId})}}}processTask(i,e){if(e.type==="<response>"){const r=this.callbacks[i];delete this.callbacks[i],r&&(e.error?r(hs(e.error)):r(null,hs(e.data)))}else{let r=!1;const s=[],l=e.hasCallback?(m,y)=>{r=!0,delete this.cancelCallbacks[i];const b={id:i,type:"<response>",sourceMapId:this.mapId,error:m?kn(m):null,data:kn(y,s)};this.target.postMessage(b,{transfer:s})}:m=>{r=!0};let h=null;const p=hs(e.data);if(this.parent[e.type])h=this.parent[e.type](e.sourceMapId,p,l);else if("getWorkerSource"in this.parent){const m=e.type.split(".");h=this.parent.getWorkerSource(e.sourceMapId,m[0],p.source)[m[1]](p,l)}else l(new Error(`Could not find function ${e.type}`));!r&&h&&h.cancel&&(this.cancelCallbacks[i]=h.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},a.D=tt,a.E=Cr,a.F=function(i,e){const r={};for(let s=0;s<e.length;s++){const l=e[s];l in i&&(r[l]=i[l])}return r},a.G=Pd,a.H=Md,a.I=pu,a.J=We,a.K=Ue,a.L=ys,a.M=si,a.N=Ai,a.O=Hr,a.P=he,a.Q=hi,a.R=Gr,a.S=ii,a.T=Ol,a.U=nc,a.V=class extends Zn{},a.W=Su,a.X=function(i,e){const r=window.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let s=0;s<i.length;s++){const l=window.document.createElement("source");Ti(i[s])||(r.crossOrigin="Anonymous"),l.src=i[s],r.appendChild(l)}return{cancel:()=>{}}},a.Y=ze,a.Z=function(){var i=new Ea(16);return Ea!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},a._=Q,a.a=Mi,a.a$=class extends L{},a.a0=function(i,e,r){var s=r[0],l=r[1],h=r[2];return i[0]=e[0]*s,i[1]=e[1]*s,i[2]=e[2]*s,i[3]=e[3]*s,i[4]=e[4]*l,i[5]=e[5]*l,i[6]=e[6]*l,i[7]=e[7]*l,i[8]=e[8]*h,i[9]=e[9]*h,i[10]=e[10]*h,i[11]=e[11]*h,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},a.a1=Lh,a.a2=function(){return at++},a.a3=Z,a.a4=Da,a.a5=function(){Pr.isLoading()||Pr.isLoaded()||bo()!=="deferred"||Bl()},a.a6=co,a.a7=Us,a.a8=ti,a.a9=Bd,a.aA=Bs,a.aB=function(i){i=i.slice();const e=Object.create(null);for(let r=0;r<i.length;r++)e[i[r].id]=i[r];for(let r=0;r<i.length;r++)"ref"in i[r]&&(i[r]=$i(i[r],e[i[r].ref]));return i},a.aC=function(i){if(i.type==="custom")return new xg(i);switch(i.type){case"background":return new _g(i);case"circle":return new im(i);case"fill":return new wm(i);case"fill-extrusion":return new Bm(i);case"heatmap":return new nm(i);case"hillshade":return new am(i);case"line":return new Zm(i);case"raster":return new vg(i);case"symbol":return new rc(i)}},a.aD=xt,a.aE=function(i,e){if(!i)return[{command:kt.setStyle,args:[e]}];let r=[];try{if(!jt(i.version,e.version))return[{command:kt.setStyle,args:[e]}];jt(i.center,e.center)||r.push({command:kt.setCenter,args:[e.center]}),jt(i.zoom,e.zoom)||r.push({command:kt.setZoom,args:[e.zoom]}),jt(i.bearing,e.bearing)||r.push({command:kt.setBearing,args:[e.bearing]}),jt(i.pitch,e.pitch)||r.push({command:kt.setPitch,args:[e.pitch]}),jt(i.sprite,e.sprite)||r.push({command:kt.setSprite,args:[e.sprite]}),jt(i.glyphs,e.glyphs)||r.push({command:kt.setGlyphs,args:[e.glyphs]}),jt(i.transition,e.transition)||r.push({command:kt.setTransition,args:[e.transition]}),jt(i.light,e.light)||r.push({command:kt.setLight,args:[e.light]});const s={},l=[];(function(p,m,y,b){let T;for(T in m=m||{},p=p||{})Object.prototype.hasOwnProperty.call(p,T)&&(Object.prototype.hasOwnProperty.call(m,T)||Ki(T,y,b));for(T in m)Object.prototype.hasOwnProperty.call(m,T)&&(Object.prototype.hasOwnProperty.call(p,T)?jt(p[T],m[T])||(p[T].type==="geojson"&&m[T].type==="geojson"&&Cn(p,m,T)?y.push({command:kt.setGeoJSONSourceData,args:[T,m[T].data]}):sr(T,m,y,b)):Ui(T,m,y))})(i.sources,e.sources,l,s);const h=[];i.layers&&i.layers.forEach(p=>{s[p.source]?r.push({command:kt.removeLayer,args:[p.id]}):h.push(p)}),r=r.concat(l),function(p,m,y){m=m||[];const b=(p=p||[]).map(en),T=m.map(en),P=p.reduce(In,{}),k=m.reduce(In,{}),R=b.slice(),F=Object.create(null);let j,H,J,se,ee,ce,de;for(j=0,H=0;j<b.length;j++)J=b[j],Object.prototype.hasOwnProperty.call(k,J)?H++:(y.push({command:kt.removeLayer,args:[J]}),R.splice(R.indexOf(J,H),1));for(j=0,H=0;j<T.length;j++)J=T[T.length-1-j],R[R.length-1-j]!==J&&(Object.prototype.hasOwnProperty.call(P,J)?(y.push({command:kt.removeLayer,args:[J]}),R.splice(R.lastIndexOf(J,R.length-H),1)):H++,ce=R[R.length-j],y.push({command:kt.addLayer,args:[k[J],ce]}),R.splice(R.length-j,0,J),F[J]=!0);for(j=0;j<T.length;j++)if(J=T[j],se=P[J],ee=k[J],!F[J]&&!jt(se,ee))if(jt(se.source,ee.source)&&jt(se["source-layer"],ee["source-layer"])&&jt(se.type,ee.type)){for(de in Tn(se.layout,ee.layout,y,J,null,kt.setLayoutProperty),Tn(se.paint,ee.paint,y,J,null,kt.setPaintProperty),jt(se.filter,ee.filter)||y.push({command:kt.setFilter,args:[J,ee.filter]}),jt(se.minzoom,ee.minzoom)&&jt(se.maxzoom,ee.maxzoom)||y.push({command:kt.setLayerZoomRange,args:[J,ee.minzoom,ee.maxzoom]}),se)Object.prototype.hasOwnProperty.call(se,de)&&de!=="layout"&&de!=="paint"&&de!=="filter"&&de!=="metadata"&&de!=="minzoom"&&de!=="maxzoom"&&(de.indexOf("paint.")===0?Tn(se[de],ee[de],y,J,de.slice(6),kt.setPaintProperty):jt(se[de],ee[de])||y.push({command:kt.setLayerProperty,args:[J,de,ee[de]]}));for(de in ee)Object.prototype.hasOwnProperty.call(ee,de)&&!Object.prototype.hasOwnProperty.call(se,de)&&de!=="layout"&&de!=="paint"&&de!=="filter"&&de!=="metadata"&&de!=="minzoom"&&de!=="maxzoom"&&(de.indexOf("paint.")===0?Tn(se[de],ee[de],y,J,de.slice(6),kt.setPaintProperty):jt(se[de],ee[de])||y.push({command:kt.setLayerProperty,args:[J,de,ee[de]]}))}else y.push({command:kt.removeLayer,args:[J]}),ce=R[R.lastIndexOf(J)+1],y.push({command:kt.addLayer,args:[ee,ce]})}(h,e.layers,r)}catch(s){console.warn("Unable to compute style diff:",s),r=[{command:kt.setStyle,args:[e]}]}return r},a.aF=function(i){const e=[],r=i.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},a.aG=function i(e,r){if(Array.isArray(e)){if(!Array.isArray(r)||e.length!==r.length)return!1;for(let s=0;s<e.length;s++)if(!i(e[s],r[s]))return!1;return!0}if(typeof e=="object"&&e!==null&&r!==null){if(typeof r!="object"||Object.keys(e).length!==Object.keys(r).length)return!1;for(const s in e)if(!i(e[s],r[s]))return!1;return!0}return e===r},a.aH=Pe,a.aI=it,a.aJ=Os,a.aK=function(i){return i({pluginStatus:_r,pluginURL:zn}),Os.on("pluginStateChange",i),i},a.aL=class extends Wn{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},a.aM=Ta,a.aN=class extends Wn{constructor(i,e){super(i,e),this.current=Zc}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},a.aO=Vl,a.aP=class extends Wn{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},a.aQ=class extends Wn{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},a.aR=Ul,a.aS=function(i,e,r,s,l,h,p){var m=1/(e-r),y=1/(s-l),b=1/(h-p);return i[0]=-2*m,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*y,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*b,i[11]=0,i[12]=(e+r)*m,i[13]=(l+s)*y,i[14]=(p+h)*b,i[15]=1,i},a.aT=qt,a.aU=tm,a.aV=class extends o{},a.aW=Xm,a.aX=class extends d{},a.aY=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},a.aZ=Nh,a.a_=Me,a.aa=function(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,s,l,h)=>{const p=l||h;return e[s]=!p||p.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e},a.ab=function(i,e){const r=[];for(const s in i)s in e||r.push(s);return r},a.ac=function(i){if(ni==null){const e=i.navigator?i.navigator.userAgent:null;ni=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return ni},a.ad=rt,a.ae=function(i,e,r){var s=Math.sin(r),l=Math.cos(r),h=e[0],p=e[1],m=e[2],y=e[3],b=e[4],T=e[5],P=e[6],k=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=h*l+b*s,i[1]=p*l+T*s,i[2]=m*l+P*s,i[3]=y*l+k*s,i[4]=b*l-h*s,i[5]=T*l-p*s,i[6]=P*l-m*s,i[7]=k*l-y*s,i},a.af=function(i){var e=new Ea(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},a.ag=Hl,a.ah=function(i,e){let r=0,s=0;if(i.kind==="constant")s=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:l,minZoom:h,maxZoom:p}=i,m=l?rt(Er.interpolationFactor(l,e,h,p),0,1):0;i.kind==="camera"?s=Ir.number(i.minSize,i.maxSize,m):r=m}return{uSizeT:r,uSize:s}},a.aj=function(i,{uSize:e,uSizeT:r},{lowerSize:s,upperSize:l}){return i.kind==="source"?s/Ln:i.kind==="composite"?Ir.number(s/Ln,l/Ln,r):e},a.ak=_u,a.al=function(i,e,r,s){const l=e.y-i.y,h=e.x-i.x,p=s.y-r.y,m=s.x-r.x,y=p*h-m*l;if(y===0)return null;const b=(m*(i.y-r.y)-p*(i.x-r.x))/y;return new he(i.x+b*h,i.y+b*l)},a.am=jd,a.an=Ah,a.ao=Kc,a.ap=Li,a.ar=gu,a.as=function(i,e){var r=e[0],s=e[1],l=e[2],h=e[3],p=e[4],m=e[5],y=e[6],b=e[7],T=e[8],P=e[9],k=e[10],R=e[11],F=e[12],j=e[13],H=e[14],J=e[15],se=r*m-s*p,ee=r*y-l*p,ce=r*b-h*p,de=s*y-l*m,be=s*b-h*m,Ve=l*b-h*y,Je=T*j-P*F,$e=T*H-k*F,Oe=T*J-R*F,De=P*H-k*j,He=P*J-R*j,Le=k*J-R*H,Ae=se*Le-ee*He+ce*De+de*Oe-be*$e+Ve*Je;return Ae?(i[0]=(m*Le-y*He+b*De)*(Ae=1/Ae),i[1]=(l*He-s*Le-h*De)*Ae,i[2]=(j*Ve-H*be+J*de)*Ae,i[3]=(k*be-P*Ve-R*de)*Ae,i[4]=(y*Oe-p*Le-b*$e)*Ae,i[5]=(r*Le-l*Oe+h*$e)*Ae,i[6]=(H*ce-F*Ve-J*ee)*Ae,i[7]=(T*Ve-k*ce+R*ee)*Ae,i[8]=(p*He-m*Oe+b*Je)*Ae,i[9]=(s*Oe-r*He-h*Je)*Ae,i[10]=(F*be-j*ce+J*se)*Ae,i[11]=(P*ce-T*be-R*se)*Ae,i[12]=(m*$e-p*De-y*Je)*Ae,i[13]=(r*De-s*$e+l*Je)*Ae,i[14]=(j*ee-F*de-H*se)*Ae,i[15]=(T*de-P*ee+k*se)*Ae,i):null},a.at=Tu,a.au=mu,a.av=Iu,a.aw=function(){const i={},e=me.$version;for(const r in me.$root){const s=me.$root[r];if(s.required){let l=null;l=r==="version"?e:s.type==="array"?[]:{},l!=null&&(i[r]=l)}}return i},a.ax=kt,a.ay=Dl,a.az=Yt,a.b=function(i,e){const r=new Blob([new Uint8Array(i)],{type:"image/png"});createImageBitmap(r).then(s=>{e(null,s)}).catch(s=>{e(new Error(`Could not load image because of ${s.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},a.b0=Gi,a.b1=function(i,e){var r=i[0],s=i[1],l=i[2],h=i[3],p=i[4],m=i[5],y=i[6],b=i[7],T=i[8],P=i[9],k=i[10],R=i[11],F=i[12],j=i[13],H=i[14],J=i[15],se=e[0],ee=e[1],ce=e[2],de=e[3],be=e[4],Ve=e[5],Je=e[6],$e=e[7],Oe=e[8],De=e[9],He=e[10],Le=e[11],Ae=e[12],st=e[13],Qe=e[14],St=e[15];return Math.abs(r-se)<=vr*Math.max(1,Math.abs(r),Math.abs(se))&&Math.abs(s-ee)<=vr*Math.max(1,Math.abs(s),Math.abs(ee))&&Math.abs(l-ce)<=vr*Math.max(1,Math.abs(l),Math.abs(ce))&&Math.abs(h-de)<=vr*Math.max(1,Math.abs(h),Math.abs(de))&&Math.abs(p-be)<=vr*Math.max(1,Math.abs(p),Math.abs(be))&&Math.abs(m-Ve)<=vr*Math.max(1,Math.abs(m),Math.abs(Ve))&&Math.abs(y-Je)<=vr*Math.max(1,Math.abs(y),Math.abs(Je))&&Math.abs(b-$e)<=vr*Math.max(1,Math.abs(b),Math.abs($e))&&Math.abs(T-Oe)<=vr*Math.max(1,Math.abs(T),Math.abs(Oe))&&Math.abs(P-De)<=vr*Math.max(1,Math.abs(P),Math.abs(De))&&Math.abs(k-He)<=vr*Math.max(1,Math.abs(k),Math.abs(He))&&Math.abs(R-Le)<=vr*Math.max(1,Math.abs(R),Math.abs(Le))&&Math.abs(F-Ae)<=vr*Math.max(1,Math.abs(F),Math.abs(Ae))&&Math.abs(j-st)<=vr*Math.max(1,Math.abs(j),Math.abs(st))&&Math.abs(H-Qe)<=vr*Math.max(1,Math.abs(H),Math.abs(Qe))&&Math.abs(J-St)<=vr*Math.max(1,Math.abs(J),Math.abs(St))},a.b2=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},a.b3=function(i,e,r){return i[0]=e[0]*r[0],i[1]=e[1]*r[1],i[2]=e[2]*r[2],i[3]=e[3]*r[3],i},a.b4=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]},a.b5=et,a.b6=Ld,a.b7=kd,a.b8=function(i,e,r,s,l){var h,p=1/Math.tan(e/2);return i[0]=p/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=p,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,l!=null&&l!==1/0?(i[10]=(l+s)*(h=1/(s-l)),i[14]=2*l*s*h):(i[10]=-1,i[14]=-2*s),i},a.b9=function(i,e,r){var s=Math.sin(r),l=Math.cos(r),h=e[4],p=e[5],m=e[6],y=e[7],b=e[8],T=e[9],P=e[10],k=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=h*l+b*s,i[5]=p*l+T*s,i[6]=m*l+P*s,i[7]=y*l+k*s,i[8]=b*l-h*s,i[9]=T*l-p*s,i[10]=P*l-m*s,i[11]=k*l-y*s,i},a.bA=ae,a.bB=ad,a.bC=fa,a.bD=Pr,a.ba=ye,a.bb=Ie,a.bc=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},a.bd=class extends js{},a.be=bu,a.bf=zd,a.bg=kg,a.bi=gi,a.bj=function(i,e,r=!1){if(_r===go||_r===_o||_r===yo)throw new Error("setRTLTextPlugin cannot be called multiple times.");zn=Mt.resolveURL(i),_r=go,vo=e,xo(),r||Bl()},a.bk=bo,a.bl=function(i,e){const r={};for(let l=0;l<i.length;l++){const h=e&&e[i[l].id]||ya(i[l]);e&&(e[i[l].id]=h);let p=r[h];p||(p=r[h]=[]),p.push(i[l])}const s=[];for(const l in r)s.push(r[l]);return s},a.bm=Ge,a.bn=Fd,a.bo=Od,a.bp=md,a.bq=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=Ai/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const e=i.bucket.layers[0],r=e.layout,s=e._unevaluatedLayout._values,l={layoutIconSize:s["icon-size"].possiblyEvaluate(new ti(i.bucket.zoom+1),i.canonical),layoutTextSize:s["text-size"].possiblyEvaluate(new ti(i.bucket.zoom+1),i.canonical),textMaxSize:s["text-size"].possiblyEvaluate(new ti(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:b,maxZoom:T}=i.bucket.textSizeData;l.compositeTextSizes=[s["text-size"].possiblyEvaluate(new ti(b),i.canonical),s["text-size"].possiblyEvaluate(new ti(T),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:b,maxZoom:T}=i.bucket.iconSizeData;l.compositeIconSizes=[s["icon-size"].possiblyEvaluate(new ti(b),i.canonical),s["icon-size"].possiblyEvaluate(new ti(T),i.canonical)]}const h=r.get("text-line-height")*Li,p=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",m=r.get("text-keep-upright"),y=r.get("text-size");for(const b of i.bucket.features){const T=r.get("text-font").evaluate(b,{},i.canonical).join(","),P=y.evaluate(b,{},i.canonical),k=l.layoutTextSize.evaluate(b,{},i.canonical),R=l.layoutIconSize.evaluate(b,{},i.canonical),F={horizontal:{},vertical:void 0},j=b.text;let H,J=[0,0];if(j){const ce=j.toString(),de=r.get("text-letter-spacing").evaluate(b,{},i.canonical)*Li,be=fo(ce)?de:0,Ve=r.get("text-anchor").evaluate(b,{},i.canonical),Je=Kd(e,b,i.canonical);if(!Je){const Le=r.get("text-radial-offset").evaluate(b,{},i.canonical);J=Le?Xd(Ve,[Le*Li,Cu]):r.get("text-offset").evaluate(b,{},i.canonical).map(Ae=>Ae*Li)}let $e=p?"center":r.get("text-justify").evaluate(b,{},i.canonical);const Oe=r.get("symbol-placement"),De=Oe==="point"?r.get("text-max-width").evaluate(b,{},i.canonical)*Li:0,He=()=>{i.bucket.allowVerticalPlacement&&po(ce)&&(F.vertical=ec(j,i.glyphMap,i.glyphPositions,i.imagePositions,T,De,h,Ve,"left",be,J,a.ai.vertical,!0,Oe,k,P))};if(!p&&Je){const Le=new Set;if($e==="auto")for(let st=0;st<Je.values.length;st+=2)Le.add(Tu(Je.values[st]));else Le.add($e);let Ae=!1;for(const st of Le)if(!F.horizontal[st])if(Ae)F.horizontal[st]=F.horizontal[0];else{const Qe=ec(j,i.glyphMap,i.glyphPositions,i.imagePositions,T,De,h,"center",st,be,J,a.ai.horizontal,!1,Oe,k,P);Qe&&(F.horizontal[st]=Qe,Ae=Qe.positionedLines.length===1)}He()}else{$e==="auto"&&($e=Tu(Ve));const Le=ec(j,i.glyphMap,i.glyphPositions,i.imagePositions,T,De,h,Ve,$e,be,J,a.ai.horizontal,!1,Oe,k,P);Le&&(F.horizontal[$e]=Le),He(),po(ce)&&p&&m&&(F.vertical=ec(j,i.glyphMap,i.glyphPositions,i.imagePositions,T,De,h,Ve,$e,be,J,a.ai.vertical,!1,Oe,k,P))}}let se=!1;if(b.icon&&b.icon.name){const ce=i.imageMap[b.icon.name];ce&&(H=dg(i.imagePositions[b.icon.name],r.get("icon-offset").evaluate(b,{},i.canonical),r.get("icon-anchor").evaluate(b,{},i.canonical)),se=!!ce.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=se:i.bucket.sdfIcons!==se&&gt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ce.pixelRatio!==i.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const ee=Yd(F.horizontal)||F.vertical;i.bucket.iconsInText=!!ee&&ee.iconsInText,(ee||H)&&Pg(i.bucket,b,F,H,i.imageMap,l,k,R,J,se,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},a.br=cu,a.bs=au,a.bt=lu,a.bu=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},a.bv=hu,a.bw=ms,a.bx=function(i,e,r,s,l){return Q(this,void 0,void 0,function*(){if(Ue())try{return yield si(i,e,r,s,l)}catch{}return function(h,p,m,y,b){const T=h.width,P=h.height;Xt&&qe||(Xt=new OffscreenCanvas(T,P),qe=Xt.getContext("2d",{willReadFrequently:!0})),Xt.width=T,Xt.height=P,qe.drawImage(h,0,0,T,P);const k=qe.getImageData(p,m,y,b);return qe.clearRect(0,0,T,P),k.data}(i,e,r,s,l)})},a.by=Rd,a.bz=B,a.c=Jt,a.d=function(i,e){const r=new Image;r.onload=()=>{e(null,r),URL.revokeObjectURL(r.src),r.onload=null,window.requestAnimationFrame(()=>{r.src=Xi})},r.onerror=()=>e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const s=new Blob([new Uint8Array(i)],{type:"image/png"});r.src=i.byteLength?URL.createObjectURL(s):Xi},a.e=Ze,a.f=function(i,e){return bi(Ze(i,{type:"json"}),e)},a.g=Rt,a.h=Mt,a.i=ft,a.j=mr,a.k=nr,a.l=Wt,a.m=bi,a.n=function(i){return new hu(i).readFields(ag,[])},a.o=function(i,e,r){if(!i.length)return r(null,[]);let s=i.length;const l=new Array(i.length);let h=null;i.forEach((p,m)=>{e(p,(y,b)=>{y&&(h=y),l[m]=b,--s==0&&r(h,l)})})},a.p=fd,a.q=Lo,a.r=wi,a.s=Ti,a.t=jc,a.u=je,a.v=me,a.w=gt,a.x=ba,a.y=mn,a.z=function([i,e,r]){return e+=90,e*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(r),y:i*Math.sin(e)*Math.sin(r),z:i*Math.cos(r)}}}),z(["./shared"],function(a){class Q{constructor(M){this.keyCache={},M&&this.replace(M)}replace(M){this._layerConfigs={},this._layers={},this.update(M,[])}update(M,D){for(const G of M){this._layerConfigs[G.id]=G;const X=this._layers[G.id]=a.aC(G);X._featureFilter=a.a6(X.filter),this.keyCache[G.id]&&delete this.keyCache[G.id]}for(const G of D)delete this.keyCache[G],delete this._layerConfigs[G],delete this._layers[G];this.familiesBySource={};const N=a.bl(Object.values(this._layerConfigs),this.keyCache);for(const G of N){const X=G.map(ve=>this._layers[ve.id]),le=X[0];if(le.visibility==="none")continue;const te=le.source||"";let Y=this.familiesBySource[te];Y||(Y=this.familiesBySource[te]={});const ne=le.sourceLayer||"_geojsonTileLayer";let ge=Y[ne];ge||(ge=Y[ne]=[]),ge.push(X)}}}class B{constructor(M){const D={},N=[];for(const te in M){const Y=M[te],ne=D[te]={};for(const ge in Y){const ve=Y[+ge];if(!ve||ve.bitmap.width===0||ve.bitmap.height===0)continue;const Se={x:0,y:0,w:ve.bitmap.width+2,h:ve.bitmap.height+2};N.push(Se),ne[ge]={rect:Se,metrics:ve.metrics}}}const{w:G,h:X}=a.p(N),le=new a.q({width:G||1,height:X||1});for(const te in M){const Y=M[te];for(const ne in Y){const ge=Y[+ne];if(!ge||ge.bitmap.width===0||ge.bitmap.height===0)continue;const ve=D[te][ne].rect;a.q.copy(ge.bitmap,le,{x:0,y:0},{x:ve.x+1,y:ve.y+1},ge.bitmap)}}this.image=le,this.positions=D}}a.bm("GlyphAtlas",B);class ae{constructor(M){this.tileID=new a.O(M.tileID.overscaledZ,M.tileID.wrap,M.tileID.canonical.z,M.tileID.canonical.x,M.tileID.canonical.y),this.uid=M.uid,this.zoom=M.zoom,this.pixelRatio=M.pixelRatio,this.tileSize=M.tileSize,this.source=M.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=M.showCollisionBoxes,this.collectResourceTiming=!!M.collectResourceTiming,this.returnDependencies=!!M.returnDependencies,this.promoteId=M.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(M,D,N,G,X){this.status="parsing",this.data=M,this.collisionBoxArray=new a.a3;const le=new a.bn(Object.keys(M.layers).sort()),te=new a.bo(this.tileID,this.promoteId);te.bucketLayerIDs=[];const Y={},ne={featureIndex:te,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:N},ge=D.familiesBySource[this.source];for(const Ft in ge){const Lt=M.layers[Ft];if(!Lt)continue;Lt.version===1&&a.w(`Vector tile source "${this.source}" layer "${Ft}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ji=le.encode(Ft),Qt=[];for(let Ei=0;Ei<Lt.length;Ei++){const qi=Lt.feature(Ei),Fr=te.getId(qi,Ft);Qt.push({feature:qi,id:Fr,index:Ei,sourceLayerIndex:Ji})}for(const Ei of ge[Ft]){const qi=Ei[0];qi.source!==this.source&&a.w(`layer.source = ${qi.source} does not equal this.source = ${this.source}`),qi.minzoom&&this.zoom<Math.floor(qi.minzoom)||qi.maxzoom&&this.zoom>=qi.maxzoom||qi.visibility!=="none"&&(oe(Ei,this.zoom,N),(Y[qi.id]=qi.createBucket({index:te.bucketLayerIDs.length,layers:Ei,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ji,sourceID:this.source})).populate(Qt,ne,this.tileID.canonical),te.bucketLayerIDs.push(Ei.map(Fr=>Fr.id)))}}let ve,Se,nt,pt;const Xe=a.aH(ne.glyphDependencies,Ft=>Object.keys(Ft).map(Number));this.inFlightDependencies.forEach(Ft=>Ft?.cancel()),this.inFlightDependencies=[];const lt=++this.dependencySentinel;Object.keys(Xe).length?this.inFlightDependencies.push(G.send("getGlyphs",{uid:this.uid,stacks:Xe,source:this.source,tileID:this.tileID,type:"glyphs"},(Ft,Lt)=>{lt===this.dependencySentinel&&(ve||(ve=Ft,Se=Lt,Gt.call(this)))})):Se={};const _t=Object.keys(ne.iconDependencies);_t.length?this.inFlightDependencies.push(G.send("getImages",{icons:_t,source:this.source,tileID:this.tileID,type:"icons"},(Ft,Lt)=>{lt===this.dependencySentinel&&(ve||(ve=Ft,nt=Lt,Gt.call(this)))})):nt={};const Vt=Object.keys(ne.patternDependencies);function Gt(){if(ve)return X(ve);if(Se&&nt&&pt){const Ft=new B(Se),Lt=new a.bp(nt,pt);for(const Ji in Y){const Qt=Y[Ji];Qt instanceof a.a4?(oe(Qt.layers,this.zoom,N),a.bq({bucket:Qt,glyphMap:Se,glyphPositions:Ft.positions,imageMap:nt,imagePositions:Lt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Qt.hasPattern&&(Qt instanceof a.br||Qt instanceof a.bs||Qt instanceof a.bt)&&(oe(Qt.layers,this.zoom,N),Qt.addFeatures(ne,this.tileID.canonical,Lt.patternPositions))}this.status="done",X(null,{buckets:Object.values(Y).filter(Ji=>!Ji.isEmpty()),featureIndex:te,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ft.image,imageAtlas:Lt,glyphMap:this.returnDependencies?Se:null,iconMap:this.returnDependencies?nt:null,glyphPositions:this.returnDependencies?Ft.positions:null})}}Vt.length?this.inFlightDependencies.push(G.send("getImages",{icons:Vt,source:this.source,tileID:this.tileID,type:"patterns"},(Ft,Lt)=>{lt===this.dependencySentinel&&(ve||(ve=Ft,pt=Lt,Gt.call(this)))})):pt={},Gt.call(this)}}function oe(q,M,D){const N=new a.a8(M);for(const G of q)G.recalculate(N,D)}function he(q,M){const D=a.l(q.request,(N,G,X,le)=>{if(N)M(N);else if(G)try{const te=new a.bw.VectorTile(new a.bv(G));M(null,{vectorTile:te,rawData:G,cacheControl:X,expires:le})}catch(te){const Y=new Uint8Array(G);let ne=`Unable to parse the tile at ${q.request.url}, `;ne+=Y[0]===31&&Y[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${te.messge}`,M(new Error(ne))}});return()=>{D.cancel(),M()}}class we{constructor(M,D,N,G){this.actor=M,this.layerIndex=D,this.availableImages=N,this.loadVectorData=G||he,this.fetching={},this.loading={},this.loaded={}}loadTile(M,D){const N=M.uid;this.loading||(this.loading={});const G=!!(M&&M.request&&M.request.collectResourceTiming)&&new a.bu(M.request),X=this.loading[N]=new ae(M);X.abort=this.loadVectorData(M,(le,te)=>{if(delete this.loading[N],le||!te)return X.status="done",this.loaded[N]=X,D(le);const Y=te.rawData,ne={};te.expires&&(ne.expires=te.expires),te.cacheControl&&(ne.cacheControl=te.cacheControl);const ge={};if(G){const ve=G.finish();ve&&(ge.resourceTiming=JSON.parse(JSON.stringify(ve)))}X.vectorTile=te.vectorTile,X.parse(te.vectorTile,this.layerIndex,this.availableImages,this.actor,(ve,Se)=>{if(delete this.fetching[N],ve||!Se)return D(ve);D(null,a.e({rawTileData:Y.slice(0)},Se,ne,ge))}),this.loaded=this.loaded||{},this.loaded[N]=X,this.fetching[N]={rawTileData:Y,cacheControl:ne,resourceTiming:ge}})}reloadTile(M,D){const N=this.loaded,G=M.uid;if(N&&N[G]){const X=N[G];X.showCollisionBoxes=M.showCollisionBoxes,X.status==="parsing"?X.parse(X.vectorTile,this.layerIndex,this.availableImages,this.actor,(le,te)=>{if(le||!te)return D(le,te);let Y;if(this.fetching[G]){const{rawTileData:ne,cacheControl:ge,resourceTiming:ve}=this.fetching[G];delete this.fetching[G],Y=a.e({rawTileData:ne.slice(0)},te,ge,ve)}else Y=te;D(null,Y)}):X.status==="done"&&(X.vectorTile?X.parse(X.vectorTile,this.layerIndex,this.availableImages,this.actor,D):D())}}abortTile(M,D){const N=this.loading,G=M.uid;N&&N[G]&&N[G].abort&&(N[G].abort(),delete N[G]),D()}removeTile(M,D){const N=this.loaded,G=M.uid;N&&N[G]&&delete N[G],D()}}class ke{constructor(){this.loaded={}}loadTile(M,D){return a._(this,void 0,void 0,function*(){const{uid:N,encoding:G,rawImageData:X,redFactor:le,greenFactor:te,blueFactor:Y,baseShift:ne}=M,ge=X.width+2,ve=X.height+2,Se=a.a(X)?new a.R({width:ge,height:ve},yield a.bx(X,-1,-1,ge,ve)):X,nt=new a.by(N,Se,G,le,te,Y,ne);this.loaded=this.loaded||{},this.loaded[N]=nt,D(null,nt)})}removeTile(M){const D=this.loaded,N=M.uid;D&&D[N]&&delete D[N]}}function Ne(q,M){if(q.length!==0){Re(q[0],M);for(var D=1;D<q.length;D++)Re(q[D],!M)}}function Re(q,M){for(var D=0,N=0,G=0,X=q.length,le=X-1;G<X;le=G++){var te=(q[G][0]-q[le][0])*(q[le][1]+q[G][1]),Y=D+te;N+=Math.abs(D)>=Math.abs(te)?D-Y+te:te-Y+D,D=Y}D+N>=0!=!!M&&q.reverse()}var Fe=a.bz(function q(M,D){var N,G=M&&M.type;if(G==="FeatureCollection")for(N=0;N<M.features.length;N++)q(M.features[N],D);else if(G==="GeometryCollection")for(N=0;N<M.geometries.length;N++)q(M.geometries[N],D);else if(G==="Feature")q(M.geometry,D);else if(G==="Polygon")Ne(M.coordinates,D);else if(G==="MultiPolygon")for(N=0;N<M.coordinates.length;N++)Ne(M.coordinates[N],D);return M});const We=a.bw.VectorTileFeature.prototype.toGeoJSON;var Ue={exports:{}},ye=a.bA,Ie=a.bw.VectorTileFeature,rt=et;function et(q,M){this.options=M||{},this.features=q,this.length=q.length}function Ze(q,M){this.id=typeof q.id=="number"?q.id:void 0,this.type=q.type,this.rawGeometry=q.type===1?[q.geometry]:q.geometry,this.properties=q.tags,this.extent=M||4096}et.prototype.feature=function(q){return new Ze(this.features[q],this.options.extent)},Ze.prototype.loadGeometry=function(){var q=this.rawGeometry;this.geometry=[];for(var M=0;M<q.length;M++){for(var D=q[M],N=[],G=0;G<D.length;G++)N.push(new ye(D[G][0],D[G][1]));this.geometry.push(N)}return this.geometry},Ze.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var q=this.geometry,M=1/0,D=-1/0,N=1/0,G=-1/0,X=0;X<q.length;X++)for(var le=q[X],te=0;te<le.length;te++){var Y=le[te];M=Math.min(M,Y.x),D=Math.max(D,Y.x),N=Math.min(N,Y.y),G=Math.max(G,Y.y)}return[M,N,D,G]},Ze.prototype.toGeoJSON=Ie.prototype.toGeoJSON;var at=a.bB,Pe=rt;function it(q){var M=new at;return function(D,N){for(var G in D.layers)N.writeMessage(3,xt,D.layers[G])}(q,M),M.finish()}function xt(q,M){var D;M.writeVarintField(15,q.version||1),M.writeStringField(1,q.name||""),M.writeVarintField(5,q.extent||4096);var N={keys:[],values:[],keycache:{},valuecache:{}};for(D=0;D<q.length;D++)N.feature=q.feature(D),M.writeMessage(2,At,N);var G=N.keys;for(D=0;D<G.length;D++)M.writeStringField(3,G[D]);var X=N.values;for(D=0;D<X.length;D++)M.writeMessage(4,ni,X[D])}function At(q,M){var D=q.feature;D.id!==void 0&&M.writeVarintField(1,D.id),M.writeMessage(2,gt,q),M.writeVarintField(3,D.type),M.writeMessage(4,ft,D)}function gt(q,M){var D=q.feature,N=q.keys,G=q.values,X=q.keycache,le=q.valuecache;for(var te in D.properties){var Y=D.properties[te],ne=X[te];if(Y!==null){ne===void 0&&(N.push(te),X[te]=ne=N.length-1),M.writeVarint(ne);var ge=typeof Y;ge!=="string"&&ge!=="boolean"&&ge!=="number"&&(Y=JSON.stringify(Y));var ve=ge+":"+Y,Se=le[ve];Se===void 0&&(G.push(Y),le[ve]=Se=G.length-1),M.writeVarint(Se)}}}function Pt(q,M){return(M<<3)+(7&q)}function Bt(q){return q<<1^q>>31}function ft(q,M){for(var D=q.loadGeometry(),N=q.type,G=0,X=0,le=D.length,te=0;te<le;te++){var Y=D[te],ne=1;N===1&&(ne=Y.length),M.writeVarint(Pt(1,ne));for(var ge=N===3?Y.length-1:Y.length,ve=0;ve<ge;ve++){ve===1&&N!==1&&M.writeVarint(Pt(2,ge-1));var Se=Y[ve].x-G,nt=Y[ve].y-X;M.writeVarint(Bt(Se)),M.writeVarint(Bt(nt)),G+=Se,X+=nt}N===3&&M.writeVarint(Pt(7,1))}}function ni(q,M){var D=typeof q;D==="string"?M.writeStringField(1,q):D==="boolean"?M.writeBooleanField(7,q):D==="number"&&(q%1!=0?M.writeDoubleField(3,q):q<0?M.writeSVarintField(6,q):M.writeVarintField(5,q))}Ue.exports=it,Ue.exports.fromVectorTileJs=it,Ue.exports.fromGeojsonVt=function(q,M){M=M||{};var D={};for(var N in q)D[N]=new Pe(q[N].features,M),D[N].name=N,D[N].version=M.version,D[N].extent=M.extent;return it({layers:D})},Ue.exports.GeoJSONWrapper=Pe;var Mi=a.bz(Ue.exports);const Xi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:q=>q},si=Math.fround||(Xt=new Float32Array(1),q=>(Xt[0]=+q,Xt[0]));var Xt;const qe=3,yt=5,Kt=6;class Mt{constructor(M){this.options=Object.assign(Object.create(Xi),M),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(M){const{log:D,minZoom:N,maxZoom:G}=this.options;D&&console.time("total time");const X=`prepare ${M.length} points`;D&&console.time(X),this.points=M;const le=[];for(let Y=0;Y<M.length;Y++){const ne=M[Y];if(!ne.geometry)continue;const[ge,ve]=ne.geometry.coordinates,Se=si(Yt(ge)),nt=si(Rt(ve));le.push(Se,nt,1/0,Y,-1,1),this.options.reduce&&le.push(0)}let te=this.trees[G+1]=this._createTree(le);D&&console.timeEnd(X);for(let Y=G;Y>=N;Y--){const ne=+Date.now();te=this.trees[Y]=this._createTree(this._cluster(te,Y)),D&&console.log("z%d: %d clusters in %dms",Y,te.numItems,+Date.now()-ne)}return D&&console.timeEnd("total time"),this}getClusters(M,D){let N=((M[0]+180)%360+360)%360-180;const G=Math.max(-90,Math.min(90,M[1]));let X=M[2]===180?180:((M[2]+180)%360+360)%360-180;const le=Math.max(-90,Math.min(90,M[3]));if(M[2]-M[0]>=360)N=-180,X=180;else if(N>X){const ve=this.getClusters([N,G,180,le],D),Se=this.getClusters([-180,G,X,le],D);return ve.concat(Se)}const te=this.trees[this._limitZoom(D)],Y=te.range(Yt(N),Rt(le),Yt(X),Rt(G)),ne=te.data,ge=[];for(const ve of Y){const Se=this.stride*ve;ge.push(ne[Se+yt]>1?Jt(ne,Se,this.clusterProps):this.points[ne[Se+qe]])}return ge}getChildren(M){const D=this._getOriginId(M),N=this._getOriginZoom(M),G="No cluster with the specified id.",X=this.trees[N];if(!X)throw new Error(G);const le=X.data;if(D*this.stride>=le.length)throw new Error(G);const te=this.options.radius/(this.options.extent*Math.pow(2,N-1)),Y=X.within(le[D*this.stride],le[D*this.stride+1],te),ne=[];for(const ge of Y){const ve=ge*this.stride;le[ve+4]===M&&ne.push(le[ve+yt]>1?Jt(le,ve,this.clusterProps):this.points[le[ve+qe]])}if(ne.length===0)throw new Error(G);return ne}getLeaves(M,D,N){const G=[];return this._appendLeaves(G,M,D=D||10,N=N||0,0),G}getTile(M,D,N){const G=this.trees[this._limitZoom(M)],X=Math.pow(2,M),{extent:le,radius:te}=this.options,Y=te/le,ne=(N-Y)/X,ge=(N+1+Y)/X,ve={features:[]};return this._addTileFeatures(G.range((D-Y)/X,ne,(D+1+Y)/X,ge),G.data,D,N,X,ve),D===0&&this._addTileFeatures(G.range(1-Y/X,ne,1,ge),G.data,X,N,X,ve),D===X-1&&this._addTileFeatures(G.range(0,ne,Y/X,ge),G.data,-1,N,X,ve),ve.features.length?ve:null}getClusterExpansionZoom(M){let D=this._getOriginZoom(M)-1;for(;D<=this.options.maxZoom;){const N=this.getChildren(M);if(D++,N.length!==1)break;M=N[0].properties.cluster_id}return D}_appendLeaves(M,D,N,G,X){const le=this.getChildren(D);for(const te of le){const Y=te.properties;if(Y&&Y.cluster?X+Y.point_count<=G?X+=Y.point_count:X=this._appendLeaves(M,Y.cluster_id,N,G,X):X<G?X++:M.push(te),M.length===N)break}return X}_createTree(M){const D=new a.av(M.length/this.stride|0,this.options.nodeSize,Float32Array);for(let N=0;N<M.length;N+=this.stride)D.add(M[N],M[N+1]);return D.finish(),D.data=M,D}_addTileFeatures(M,D,N,G,X,le){for(const te of M){const Y=te*this.stride,ne=D[Y+yt]>1;let ge,ve,Se;if(ne)ge=gi(D,Y,this.clusterProps),ve=D[Y],Se=D[Y+1];else{const Xe=this.points[D[Y+qe]];ge=Xe.properties;const[lt,_t]=Xe.geometry.coordinates;ve=Yt(lt),Se=Rt(_t)}const nt={type:1,geometry:[[Math.round(this.options.extent*(ve*X-N)),Math.round(this.options.extent*(Se*X-G))]],tags:ge};let pt;pt=ne||this.options.generateId?D[Y+qe]:this.points[D[Y+qe]].id,pt!==void 0&&(nt.id=pt),le.features.push(nt)}}_limitZoom(M){return Math.max(this.options.minZoom,Math.min(Math.floor(+M),this.options.maxZoom+1))}_cluster(M,D){const{radius:N,extent:G,reduce:X,minPoints:le}=this.options,te=N/(G*Math.pow(2,D)),Y=M.data,ne=[],ge=this.stride;for(let ve=0;ve<Y.length;ve+=ge){if(Y[ve+2]<=D)continue;Y[ve+2]=D;const Se=Y[ve],nt=Y[ve+1],pt=M.within(Y[ve],Y[ve+1],te),Xe=Y[ve+yt];let lt=Xe;for(const _t of pt){const Vt=_t*ge;Y[Vt+2]>D&&(lt+=Y[Vt+yt])}if(lt>Xe&&lt>=le){let _t,Vt=Se*Xe,Gt=nt*Xe,Ft=-1;const Lt=((ve/ge|0)<<5)+(D+1)+this.points.length;for(const Ji of pt){const Qt=Ji*ge;if(Y[Qt+2]<=D)continue;Y[Qt+2]=D;const Ei=Y[Qt+yt];Vt+=Y[Qt]*Ei,Gt+=Y[Qt+1]*Ei,Y[Qt+4]=Lt,X&&(_t||(_t=this._map(Y,ve,!0),Ft=this.clusterProps.length,this.clusterProps.push(_t)),X(_t,this._map(Y,Qt)))}Y[ve+4]=Lt,ne.push(Vt/lt,Gt/lt,1/0,Lt,-1,lt),X&&ne.push(Ft)}else{for(let _t=0;_t<ge;_t++)ne.push(Y[ve+_t]);if(lt>1)for(const _t of pt){const Vt=_t*ge;if(!(Y[Vt+2]<=D)){Y[Vt+2]=D;for(let Gt=0;Gt<ge;Gt++)ne.push(Y[Vt+Gt])}}}}return ne}_getOriginId(M){return M-this.points.length>>5}_getOriginZoom(M){return(M-this.points.length)%32}_map(M,D,N){if(M[D+yt]>1){const le=this.clusterProps[M[D+Kt]];return N?Object.assign({},le):le}const G=this.points[M[D+qe]].properties,X=this.options.map(G);return N&&X===G?Object.assign({},X):X}}function Jt(q,M,D){return{type:"Feature",id:q[M+qe],properties:gi(q,M,D),geometry:{type:"Point",coordinates:[(N=q[M],360*(N-.5)),ki(q[M+1])]}};var N}function gi(q,M,D){const N=q[M+yt],G=N>=1e4?`${Math.round(N/1e3)}k`:N>=1e3?Math.round(N/100)/10+"k":N,X=q[M+Kt],le=X===-1?{}:Object.assign({},D[X]);return Object.assign(le,{cluster:!0,cluster_id:q[M+qe],point_count:N,point_count_abbreviated:G})}function Yt(q){return q/360+.5}function Rt(q){const M=Math.sin(q*Math.PI/180),D=.5-.25*Math.log((1+M)/(1-M))/Math.PI;return D<0?0:D>1?1:D}function ki(q){const M=(180-360*q)*Math.PI/180;return 360*Math.atan(Math.exp(M))/Math.PI-90}function bi(q,M,D,N){for(var G,X=N,le=D-M>>1,te=D-M,Y=q[M],ne=q[M+1],ge=q[D],ve=q[D+1],Se=M+3;Se<D;Se+=3){var nt=Wt(q[Se],q[Se+1],Y,ne,ge,ve);if(nt>X)G=Se,X=nt;else if(nt===X){var pt=Math.abs(Se-le);pt<te&&(G=Se,te=pt)}}X>N&&(G-M>3&&bi(q,M,G,N),q[G+2]=X,D-G>3&&bi(q,G,D,N))}function Wt(q,M,D,N,G,X){var le=G-D,te=X-N;if(le!==0||te!==0){var Y=((q-D)*le+(M-N)*te)/(le*le+te*te);Y>1?(D=G,N=X):Y>0&&(D+=le*Y,N+=te*Y)}return(le=q-D)*le+(te=M-N)*te}function Ti(q,M,D,N){var G={id:q===void 0?null:q,type:M,geometry:D,tags:N,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(X){var le=X.geometry,te=X.type;if(te==="Point"||te==="MultiPoint"||te==="LineString")rr(X,le);else if(te==="Polygon"||te==="MultiLineString")for(var Y=0;Y<le.length;Y++)rr(X,le[Y]);else if(te==="MultiPolygon")for(Y=0;Y<le.length;Y++)for(var ne=0;ne<le[Y].length;ne++)rr(X,le[Y][ne])}(G),G}function rr(q,M){for(var D=0;D<M.length;D+=3)q.minX=Math.min(q.minX,M[D]),q.minY=Math.min(q.minY,M[D+1]),q.maxX=Math.max(q.maxX,M[D]),q.maxY=Math.max(q.maxY,M[D+1])}function fr(q,M,D,N){if(M.geometry){var G=M.geometry.coordinates,X=M.geometry.type,le=Math.pow(D.tolerance/((1<<D.maxZoom)*D.extent),2),te=[],Y=M.id;if(D.promoteId?Y=M.properties[D.promoteId]:D.generateId&&(Y=N||0),X==="Point")nr(G,te);else if(X==="MultiPoint")for(var ne=0;ne<G.length;ne++)nr(G[ne],te);else if(X==="LineString")mr(G,te,le,!1);else if(X==="MultiLineString"){if(D.lineMetrics){for(ne=0;ne<G.length;ne++)mr(G[ne],te=[],le,!1),q.push(Ti(Y,"LineString",te,M.properties));return}Cr(G,te,le,!1)}else if(X==="Polygon")Cr(G,te,le,!0);else{if(X!=="MultiPolygon"){if(X==="GeometryCollection"){for(ne=0;ne<M.geometry.geometries.length;ne++)fr(q,{id:Y,geometry:M.geometry.geometries[ne],properties:M.properties},D,N);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ne=0;ne<G.length;ne++){var ge=[];Cr(G[ne],ge,le,!0),te.push(ge)}}q.push(Ti(Y,X,te,M.properties))}}function nr(q,M){M.push(me(q[0])),M.push(Ii(q[1])),M.push(0)}function mr(q,M,D,N){for(var G,X,le=0,te=0;te<q.length;te++){var Y=me(q[te][0]),ne=Ii(q[te][1]);M.push(Y),M.push(ne),M.push(0),te>0&&(le+=N?(G*ne-Y*X)/2:Math.sqrt(Math.pow(Y-G,2)+Math.pow(ne-X,2))),G=Y,X=ne}var ge=M.length-3;M[2]=1,bi(M,0,ge,D),M[ge+2]=1,M.size=Math.abs(le),M.start=0,M.end=M.size}function Cr(q,M,D,N){for(var G=0;G<q.length;G++){var X=[];mr(q[G],X,D,N),M.push(X)}}function me(q){return q/360+.5}function Ii(q){var M=Math.sin(q*Math.PI/180),D=.5-.25*Math.log((1+M)/(1-M))/Math.PI;return D<0?0:D>1?1:D}function $i(q,M,D,N,G,X,le,te){if(N/=M,X>=(D/=M)&&le<N)return q;if(le<D||X>=N)return null;for(var Y=[],ne=0;ne<q.length;ne++){var ge=q[ne],ve=ge.geometry,Se=ge.type,nt=G===0?ge.minX:ge.minY,pt=G===0?ge.maxX:ge.maxY;if(nt>=D&&pt<N)Y.push(ge);else if(!(pt<D||nt>=N)){var Xe=[];if(Se==="Point"||Se==="MultiPoint")jt(ve,Xe,D,N,G);else if(Se==="LineString")kt(ve,Xe,D,N,G,!1,te.lineMetrics);else if(Se==="MultiLineString")Ki(ve,Xe,D,N,G,!1);else if(Se==="Polygon")Ki(ve,Xe,D,N,G,!0);else if(Se==="MultiPolygon")for(var lt=0;lt<ve.length;lt++){var _t=[];Ki(ve[lt],_t,D,N,G,!0),_t.length&&Xe.push(_t)}if(Xe.length){if(te.lineMetrics&&Se==="LineString"){for(lt=0;lt<Xe.length;lt++)Y.push(Ti(ge.id,Se,Xe[lt],ge.tags));continue}Se!=="LineString"&&Se!=="MultiLineString"||(Xe.length===1?(Se="LineString",Xe=Xe[0]):Se="MultiLineString"),Se!=="Point"&&Se!=="MultiPoint"||(Se=Xe.length===3?"Point":"MultiPoint"),Y.push(Ti(ge.id,Se,Xe,ge.tags))}}}return Y.length?Y:null}function jt(q,M,D,N,G){for(var X=0;X<q.length;X+=3){var le=q[X+G];le>=D&&le<=N&&(M.push(q[X]),M.push(q[X+1]),M.push(q[X+2]))}}function kt(q,M,D,N,G,X,le){for(var te,Y,ne=Ui(q),ge=G===0?Cn:Tn,ve=q.start,Se=0;Se<q.length-3;Se+=3){var nt=q[Se],pt=q[Se+1],Xe=q[Se+2],lt=q[Se+3],_t=q[Se+4],Vt=G===0?nt:pt,Gt=G===0?lt:_t,Ft=!1;le&&(te=Math.sqrt(Math.pow(nt-lt,2)+Math.pow(pt-_t,2))),Vt<D?Gt>D&&(Y=ge(ne,nt,pt,lt,_t,D),le&&(ne.start=ve+te*Y)):Vt>N?Gt<N&&(Y=ge(ne,nt,pt,lt,_t,N),le&&(ne.start=ve+te*Y)):sr(ne,nt,pt,Xe),Gt<D&&Vt>=D&&(Y=ge(ne,nt,pt,lt,_t,D),Ft=!0),Gt>N&&Vt<=N&&(Y=ge(ne,nt,pt,lt,_t,N),Ft=!0),!X&&Ft&&(le&&(ne.end=ve+te*Y),M.push(ne),ne=Ui(q)),le&&(ve+=te)}var Lt=q.length-3;nt=q[Lt],pt=q[Lt+1],Xe=q[Lt+2],(Vt=G===0?nt:pt)>=D&&Vt<=N&&sr(ne,nt,pt,Xe),Lt=ne.length-3,X&&Lt>=3&&(ne[Lt]!==ne[0]||ne[Lt+1]!==ne[1])&&sr(ne,ne[0],ne[1],ne[2]),ne.length&&M.push(ne)}function Ui(q){var M=[];return M.size=q.size,M.start=q.start,M.end=q.end,M}function Ki(q,M,D,N,G,X){for(var le=0;le<q.length;le++)kt(q[le],M,D,N,G,X,!1)}function sr(q,M,D,N){q.push(M),q.push(D),q.push(N)}function Cn(q,M,D,N,G,X){var le=(X-M)/(N-M);return q.push(X),q.push(D+(G-D)*le),q.push(1),le}function Tn(q,M,D,N,G,X){var le=(X-D)/(G-D);return q.push(M+(N-M)*le),q.push(X),q.push(1),le}function en(q,M){for(var D=[],N=0;N<q.length;N++){var G,X=q[N],le=X.type;if(le==="Point"||le==="MultiPoint"||le==="LineString")G=In(X.geometry,M);else if(le==="MultiLineString"||le==="Polygon"){G=[];for(var te=0;te<X.geometry.length;te++)G.push(In(X.geometry[te],M))}else if(le==="MultiPolygon")for(G=[],te=0;te<X.geometry.length;te++){for(var Y=[],ne=0;ne<X.geometry[te].length;ne++)Y.push(In(X.geometry[te][ne],M));G.push(Y)}D.push(Ti(X.id,le,G,X.tags))}return D}function In(q,M){var D=[];D.size=q.size,q.start!==void 0&&(D.start=q.start,D.end=q.end);for(var N=0;N<q.length;N+=3)D.push(q[N]+M,q[N+1],q[N+2]);return D}function ze(q,M){if(q.transformed)return q;var D,N,G,X=1<<q.z,le=q.x,te=q.y;for(D=0;D<q.features.length;D++){var Y=q.features[D],ne=Y.geometry,ge=Y.type;if(Y.geometry=[],ge===1)for(N=0;N<ne.length;N+=2)Y.geometry.push(mt(ne[N],ne[N+1],M,X,le,te));else for(N=0;N<ne.length;N++){var ve=[];for(G=0;G<ne[N].length;G+=2)ve.push(mt(ne[N][G],ne[N][G+1],M,X,le,te));Y.geometry.push(ve)}}return q.transformed=!0,q}function mt(q,M,D,N,G,X){return[Math.round(D*(q*N-G)),Math.round(D*(M*N-X))]}function dt(q,M,D,N,G){for(var X=M===G.maxZoom?0:G.tolerance/((1<<M)*G.extent),le={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:D,y:N,z:M,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},te=0;te<q.length;te++){le.numFeatures++,Ut(le,q[te],X,G);var Y=q[te].minX,ne=q[te].minY,ge=q[te].maxX,ve=q[te].maxY;Y<le.minX&&(le.minX=Y),ne<le.minY&&(le.minY=ne),ge>le.maxX&&(le.maxX=ge),ve>le.maxY&&(le.maxY=ve)}return le}function Ut(q,M,D,N){var G=M.geometry,X=M.type,le=[];if(X==="Point"||X==="MultiPoint")for(var te=0;te<G.length;te+=3)le.push(G[te]),le.push(G[te+1]),q.numPoints++,q.numSimplified++;else if(X==="LineString")wt(le,G,q,D,!1,!1);else if(X==="MultiLineString"||X==="Polygon")for(te=0;te<G.length;te++)wt(le,G[te],q,D,X==="Polygon",te===0);else if(X==="MultiPolygon")for(var Y=0;Y<G.length;Y++){var ne=G[Y];for(te=0;te<ne.length;te++)wt(le,ne[te],q,D,!0,te===0)}if(le.length){var ge=M.tags||null;if(X==="LineString"&&N.lineMetrics){for(var ve in ge={},M.tags)ge[ve]=M.tags[ve];ge.mapbox_clip_start=G.start/G.size,ge.mapbox_clip_end=G.end/G.size}var Se={geometry:le,type:X==="Polygon"||X==="MultiPolygon"?3:X==="LineString"||X==="MultiLineString"?2:1,tags:ge};M.id!==null&&(Se.id=M.id),q.features.push(Se)}}function wt(q,M,D,N,G,X){var le=N*N;if(N>0&&M.size<(G?le:N))D.numPoints+=M.length/3;else{for(var te=[],Y=0;Y<M.length;Y+=3)(N===0||M[Y+2]>le)&&(D.numSimplified++,te.push(M[Y]),te.push(M[Y+1])),D.numPoints++;G&&function(ne,ge){for(var ve=0,Se=0,nt=ne.length,pt=nt-2;Se<nt;pt=Se,Se+=2)ve+=(ne[Se]-ne[pt])*(ne[Se+1]+ne[pt+1]);if(ve>0===ge)for(Se=0,nt=ne.length;Se<nt/2;Se+=2){var Xe=ne[Se],lt=ne[Se+1];ne[Se]=ne[nt-2-Se],ne[Se+1]=ne[nt-1-Se],ne[nt-2-Se]=Xe,ne[nt-1-Se]=lt}}(te,X),q.push(te)}}function Te(q,M){var D=(M=this.options=function(G,X){for(var le in X)G[le]=X[le];return G}(Object.create(this.options),M)).debug;if(D&&console.time("preprocess data"),M.maxZoom<0||M.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(M.promoteId&&M.generateId)throw new Error("promoteId and generateId cannot be used together.");var N=function(G,X){var le=[];if(G.type==="FeatureCollection")for(var te=0;te<G.features.length;te++)fr(le,G.features[te],X,te);else fr(le,G.type==="Feature"?G:{geometry:G},X);return le}(q,M);this.tiles={},this.tileCoords=[],D&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",M.indexMaxZoom,M.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),N=function(G,X){var le=X.buffer/X.extent,te=G,Y=$i(G,1,-1-le,le,0,-1,2,X),ne=$i(G,1,1-le,2+le,0,-1,2,X);return(Y||ne)&&(te=$i(G,1,-le,1+le,0,-1,2,X)||[],Y&&(te=en(Y,1).concat(te)),ne&&(te=te.concat(en(ne,-1)))),te}(N,M),N.length&&this.splitTile(N,0,0,0),D&&(N.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ot(q,M,D){return 32*((1<<q)*D+M)+q}function ct(q,M){return M?q.properties[M]:q.id}function _i(q,M){if(q==null)return!0;if(q.type==="Feature")return ct(q,M)!=null;if(q.type==="FeatureCollection"){const D=new Set;for(const N of q.features){const G=ct(N,M);if(G==null||D.has(G))return!1;D.add(G)}return!0}return!1}function ji(q,M){const D=new Map;if(q!=null)if(q.type==="Feature")D.set(ct(q,M),q);else for(const N of q.features)D.set(ct(N,M),N);return D}Te.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Te.prototype.splitTile=function(q,M,D,N,G,X,le){for(var te=[q,M,D,N],Y=this.options,ne=Y.debug;te.length;){N=te.pop(),D=te.pop(),M=te.pop(),q=te.pop();var ge=1<<M,ve=ot(M,D,N),Se=this.tiles[ve];if(!Se&&(ne>1&&console.time("creation"),Se=this.tiles[ve]=dt(q,M,D,N,Y),this.tileCoords.push({z:M,x:D,y:N}),ne)){ne>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",M,D,N,Se.numFeatures,Se.numPoints,Se.numSimplified),console.timeEnd("creation"));var nt="z"+M;this.stats[nt]=(this.stats[nt]||0)+1,this.total++}if(Se.source=q,G){if(M===Y.maxZoom||M===G)continue;var pt=1<<G-M;if(D!==Math.floor(X/pt)||N!==Math.floor(le/pt))continue}else if(M===Y.indexMaxZoom||Se.numPoints<=Y.indexMaxPoints)continue;if(Se.source=null,q.length!==0){ne>1&&console.time("clipping");var Xe,lt,_t,Vt,Gt,Ft,Lt=.5*Y.buffer/Y.extent,Ji=.5-Lt,Qt=.5+Lt,Ei=1+Lt;Xe=lt=_t=Vt=null,Gt=$i(q,ge,D-Lt,D+Qt,0,Se.minX,Se.maxX,Y),Ft=$i(q,ge,D+Ji,D+Ei,0,Se.minX,Se.maxX,Y),q=null,Gt&&(Xe=$i(Gt,ge,N-Lt,N+Qt,1,Se.minY,Se.maxY,Y),lt=$i(Gt,ge,N+Ji,N+Ei,1,Se.minY,Se.maxY,Y),Gt=null),Ft&&(_t=$i(Ft,ge,N-Lt,N+Qt,1,Se.minY,Se.maxY,Y),Vt=$i(Ft,ge,N+Ji,N+Ei,1,Se.minY,Se.maxY,Y),Ft=null),ne>1&&console.timeEnd("clipping"),te.push(Xe||[],M+1,2*D,2*N),te.push(lt||[],M+1,2*D,2*N+1),te.push(_t||[],M+1,2*D+1,2*N),te.push(Vt||[],M+1,2*D+1,2*N+1)}}},Te.prototype.getTile=function(q,M,D){var N=this.options,G=N.extent,X=N.debug;if(q<0||q>24)return null;var le=1<<q,te=ot(q,M=(M%le+le)%le,D);if(this.tiles[te])return ze(this.tiles[te],G);X>1&&console.log("drilling down to z%d-%d-%d",q,M,D);for(var Y,ne=q,ge=M,ve=D;!Y&&ne>0;)ne--,ge=Math.floor(ge/2),ve=Math.floor(ve/2),Y=this.tiles[ot(ne,ge,ve)];return Y&&Y.source?(X>1&&console.log("found parent tile z%d-%d-%d",ne,ge,ve),X>1&&console.time("drilling down"),this.splitTile(Y.source,ne,ge,ve,q,M,D),X>1&&console.timeEnd("drilling down"),this.tiles[te]?ze(this.tiles[te],G):null):null};class vt extends we{constructor(M,D,N,G){super(M,D,N),this._dataUpdateable=new Map,this.loadGeoJSON=(X,le)=>{const{promoteId:te}=X;if(X.request)return a.f(X.request,(Y,ne,ge,ve)=>{this._dataUpdateable=_i(ne,te)?ji(ne,te):void 0,le(Y,ne,ge,ve)});if(typeof X.data=="string")try{const Y=JSON.parse(X.data);this._dataUpdateable=_i(Y,te)?ji(Y,te):void 0,le(null,Y)}catch{le(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`))}else X.dataDiff?this._dataUpdateable?(function(Y,ne,ge){var ve,Se,nt,pt;if(ne.removeAll&&Y.clear(),ne.remove)for(const Xe of ne.remove)Y.delete(Xe);if(ne.add)for(const Xe of ne.add){const lt=ct(Xe,ge);lt!=null&&Y.set(lt,Xe)}if(ne.update)for(const Xe of ne.update){let lt=Y.get(Xe.id);if(lt==null)continue;const _t=!Xe.removeAllProperties&&(((ve=Xe.removeProperties)===null||ve===void 0?void 0:ve.length)>0||((Se=Xe.addOrUpdateProperties)===null||Se===void 0?void 0:Se.length)>0);if((Xe.newGeometry||Xe.removeAllProperties||_t)&&(lt=Object.assign({},lt),Y.set(Xe.id,lt),_t&&(lt.properties=Object.assign({},lt.properties))),Xe.newGeometry&&(lt.geometry=Xe.newGeometry),Xe.removeAllProperties)lt.properties={};else if(((nt=Xe.removeProperties)===null||nt===void 0?void 0:nt.length)>0)for(const Vt of Xe.removeProperties)Object.prototype.hasOwnProperty.call(lt.properties,Vt)&&delete lt.properties[Vt];if(((pt=Xe.addOrUpdateProperties)===null||pt===void 0?void 0:pt.length)>0)for(const{key:Vt,value:Gt}of Xe.addOrUpdateProperties)lt.properties[Vt]=Gt}}(this._dataUpdateable,X.dataDiff,te),le(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):le(new Error(`Cannot update existing geojson data in ${X.source}`)):le(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},this.loadVectorData=this.loadGeoJSONTile,G&&(this.loadGeoJSON=G)}loadGeoJSONTile(M,D){const N=M.tileID.canonical;if(!this._geoJSONIndex)return D(null,null);const G=this._geoJSONIndex.getTile(N.z,N.x,N.y);if(!G)return D(null,null);const X=new class{constructor(te){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.N,this.length=te.length,this._features=te}feature(te){return new class{constructor(Y){this._feature=Y,this.extent=a.N,this.type=Y.type,this.properties=Y.tags,"id"in Y&&!isNaN(Y.id)&&(this.id=parseInt(Y.id,10))}loadGeometry(){if(this._feature.type===1){const Y=[];for(const ne of this._feature.geometry)Y.push([new a.P(ne[0],ne[1])]);return Y}{const Y=[];for(const ne of this._feature.geometry){const ge=[];for(const ve of ne)ge.push(new a.P(ve[0],ve[1]));Y.push(ge)}return Y}}toGeoJSON(Y,ne,ge){return We.call(this,Y,ne,ge)}}(this._features[te])}}(G.features);let le=Mi(X);le.byteOffset===0&&le.byteLength===le.buffer.byteLength||(le=new Uint8Array(le)),D(null,{vectorTile:X,rawData:le.buffer})}loadData(M,D){var N;(N=this._pendingRequest)===null||N===void 0||N.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const G=!!(M&&M.request&&M.request.collectResourceTiming)&&new a.bu(M.request);this._pendingCallback=D,this._pendingRequest=this.loadGeoJSON(M,(X,le)=>{if(delete this._pendingCallback,delete this._pendingRequest,X||!le)return D(X);if(typeof le!="object")return D(new Error(`Input data given to '${M.source}' is not a valid GeoJSON object.`));{Fe(le,!0);try{if(M.filter){const Y=a.bC(M.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Y.result==="error")throw new Error(Y.value.map(ge=>`${ge.key}: ${ge.message}`).join(", "));le={type:"FeatureCollection",features:le.features.filter(ge=>Y.value.evaluate({zoom:0},ge))}}this._geoJSONIndex=M.cluster?new Mt(function({superclusterOptions:Y,clusterProperties:ne}){if(!ne||!Y)return Y;const ge={},ve={},Se={accumulated:null,zoom:0},nt={properties:null},pt=Object.keys(ne);for(const Xe of pt){const[lt,_t]=ne[Xe],Vt=a.bC(_t),Gt=a.bC(typeof lt=="string"?[lt,["accumulated"],["get",Xe]]:lt);ge[Xe]=Vt.value,ve[Xe]=Gt.value}return Y.map=Xe=>{nt.properties=Xe;const lt={};for(const _t of pt)lt[_t]=ge[_t].evaluate(Se,nt);return lt},Y.reduce=(Xe,lt)=>{nt.properties=lt;for(const _t of pt)Se.accumulated=Xe[_t],Xe[_t]=ve[_t].evaluate(Se,nt)},Y}(M)).load(le.features):function(Y,ne){return new Te(Y,ne)}(le,M.geojsonVtOptions)}catch(Y){return D(Y)}this.loaded={};const te={};if(G){const Y=G.finish();Y&&(te.resourceTiming={},te.resourceTiming[M.source]=JSON.parse(JSON.stringify(Y)))}D(null,te)}})}reloadTile(M,D){const N=this.loaded;return N&&N[M.uid]?super.reloadTile(M,D):this.loadTile(M,D)}removeSource(M,D){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),D()}getClusterExpansionZoom(M,D){try{D(null,this._geoJSONIndex.getClusterExpansionZoom(M.clusterId))}catch(N){D(N)}}getClusterChildren(M,D){try{D(null,this._geoJSONIndex.getChildren(M.clusterId))}catch(N){D(N)}}getClusterLeaves(M,D){try{D(null,this._geoJSONIndex.getLeaves(M.clusterId,M.limit,M.offset))}catch(N){D(N)}}}class hn{constructor(M){this.self=M,this.actor=new a.C(M,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:we,geojson:vt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(D,N)=>{if(this.workerSourceTypes[D])throw new Error(`Worker source with name "${D}" already registered.`);this.workerSourceTypes[D]=N},this.self.registerRTLTextPlugin=D=>{if(a.bD.isParsed())throw new Error("RTL text plugin already registered.");a.bD.applyArabicShaping=D.applyArabicShaping,a.bD.processBidirectionalText=D.processBidirectionalText,a.bD.processStyledBidirectionalText=D.processStyledBidirectionalText}}setReferrer(M,D){this.referrer=D}setImages(M,D,N){this.availableImages[M]=D;for(const G in this.workerSources[M]){const X=this.workerSources[M][G];for(const le in X)X[le].availableImages=D}N()}setLayers(M,D,N){this.getLayerIndex(M).replace(D),N()}updateLayers(M,D,N){this.getLayerIndex(M).update(D.layers,D.removedIds),N()}loadTile(M,D,N){this.getWorkerSource(M,D.type,D.source).loadTile(D,N)}loadDEMTile(M,D,N){this.getDEMWorkerSource(M,D.source).loadTile(D,N)}reloadTile(M,D,N){this.getWorkerSource(M,D.type,D.source).reloadTile(D,N)}abortTile(M,D,N){this.getWorkerSource(M,D.type,D.source).abortTile(D,N)}removeTile(M,D,N){this.getWorkerSource(M,D.type,D.source).removeTile(D,N)}removeDEMTile(M,D){this.getDEMWorkerSource(M,D.source).removeTile(D)}removeSource(M,D,N){if(!this.workerSources[M]||!this.workerSources[M][D.type]||!this.workerSources[M][D.type][D.source])return;const G=this.workerSources[M][D.type][D.source];delete this.workerSources[M][D.type][D.source],G.removeSource!==void 0?G.removeSource(D,N):N()}loadWorkerSource(M,D,N){try{this.self.importScripts(D.url),N()}catch(G){N(G.toString())}}syncRTLPluginState(M,D,N){try{a.bD.setState(D);const G=a.bD.getPluginURL();if(a.bD.isLoaded()&&!a.bD.isParsed()&&G!=null){this.self.importScripts(G);const X=a.bD.isParsed();N(X?void 0:new Error(`RTL Text Plugin failed to import scripts from ${G}`),X)}}catch(G){N(G.toString())}}getAvailableImages(M){let D=this.availableImages[M];return D||(D=[]),D}getLayerIndex(M){let D=this.layerIndexes[M];return D||(D=this.layerIndexes[M]=new Q),D}getWorkerSource(M,D,N){return this.workerSources[M]||(this.workerSources[M]={}),this.workerSources[M][D]||(this.workerSources[M][D]={}),this.workerSources[M][D][N]||(this.workerSources[M][D][N]=new this.workerSourceTypes[D]({send:(G,X,le)=>{this.actor.send(G,X,le,M)}},this.getLayerIndex(M),this.getAvailableImages(M))),this.workerSources[M][D][N]}getDEMWorkerSource(M,D){return this.demWorkerSources[M]||(this.demWorkerSources[M]={}),this.demWorkerSources[M][D]||(this.demWorkerSources[M][D]=new ke),this.demWorkerSources[M][D]}}return a.i()&&(self.worker=new hn(self)),hn}),z(["./shared"],function(a){var Q="3.6.2";class B{static testProp(t){if(!B.docStyle)return t[0];for(let n=0;n<t.length;n++)if(t[n]in B.docStyle)return t[n];return t[0]}static create(t,n,o){const c=window.document.createElement(t);return n!==void 0&&(c.className=n),o&&o.appendChild(c),c}static createNS(t,n){return window.document.createElementNS(t,n)}static disableDrag(){B.docStyle&&B.selectProp&&(B.userSelect=B.docStyle[B.selectProp],B.docStyle[B.selectProp]="none")}static enableDrag(){B.docStyle&&B.selectProp&&(B.docStyle[B.selectProp]=B.userSelect)}static setTransform(t,n){t.style[B.transformProp]=n}static addEventListener(t,n,o,c={}){t.addEventListener(n,o,"passive"in c?c:c.capture)}static removeEventListener(t,n,o,c={}){t.removeEventListener(n,o,"passive"in c?c:c.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",B.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",B.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",B.suppressClickInternal,!0)},0)}static mousePos(t,n){const o=t.getBoundingClientRect();return new a.P(n.clientX-o.left-t.clientLeft,n.clientY-o.top-t.clientTop)}static touchPos(t,n){const o=t.getBoundingClientRect(),c=[];for(let d=0;d<n.length;d++)c.push(new a.P(n[d].clientX-o.left-t.clientLeft,n[d].clientY-o.top-t.clientTop));return c}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}B.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,B.selectProp=B.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),B.transformProp=B.testProp(["transform","WebkitTransform"]);const ae={supported:!1,testSupport:function(u){!we&&he&&(ke?Ne(u):oe=u)}};let oe,he,we=!1,ke=!1;function Ne(u){const t=u.createTexture();u.bindTexture(u.TEXTURE_2D,t);try{if(u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,he),u.isContextLost())return;ae.supported=!0}catch{}u.deleteTexture(t),we=!0}var Re,Fe;typeof document<"u"&&(he=document.createElement("img"),he.onload=function(){oe&&Ne(oe),oe=null,ke=!0},he.onerror=function(){we=!0,oe=null},he.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(u){let t,n,o,c;u.resetRequestQueue=()=>{t=[],n=0,o=0,c={}},u.addThrottleControl=S=>{const I=o++;return c[I]=S,I},u.removeThrottleControl=S=>{delete c[S],_()},u.getImage=(S,I,A=!0)=>{ae.supported&&(S.headers||(S.headers={}),S.headers.accept="image/webp,*/*");const L={requestParameters:S,supportImageRefresh:A,callback:I,cancelled:!1,completed:!1,cancel:()=>{L.completed||L.cancelled||(L.cancelled=!0,L.innerRequest&&(L.innerRequest.cancel(),n--),_())}};return t.push(L),_(),L};const d=S=>{const{requestParameters:I,supportImageRefresh:A,callback:L}=S;return a.e(I,{type:"image"}),(A!==!1||a.i()||a.g(I.url)||I.headers&&!Object.keys(I.headers).reduce((U,V)=>U&&V==="accept",!0)?a.m:x)(I,(U,V,Z,$)=>{g(S,L,U,V,Z,$)})},g=(S,I,A,L,U,V)=>{A?I(A):L instanceof HTMLImageElement||a.a(L)?I(null,L):L&&((Z,$)=>{typeof createImageBitmap=="function"?a.b(Z,$):a.d(Z,$)})(L,(Z,$)=>{Z!=null?I(Z):$!=null&&I(null,$,{cacheControl:U,expires:V})}),S.cancelled||(S.completed=!0,n--,_())},_=()=>{const S=(()=>{const I=Object.keys(c);let A=!1;if(I.length>0){for(const L of I)if(A=c[L](),A)break}return A})()?a.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:a.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let I=n;I<S&&t.length>0;I++){const A=t.shift();if(A.cancelled){I--;continue}const L=d(A);n++,A.innerRequest=L}},x=(S,I)=>{const A=new Image,L=S.url;let U=!1;const V=S.credentials;return V&&V==="include"?A.crossOrigin="use-credentials":(V&&V==="same-origin"||!a.s(L))&&(A.crossOrigin="anonymous"),A.fetchPriority="high",A.onload=()=>{I(null,A),A.onerror=A.onload=null},A.onerror=()=>{U||I(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),A.onerror=A.onload=null},A.src=L,{cancel:()=>{U=!0,A.src=""}}}}(Re||(Re={})),Re.resetRequestQueue(),function(u){u.Glyphs="Glyphs",u.Image="Image",u.Source="Source",u.SpriteImage="SpriteImage",u.SpriteJSON="SpriteJSON",u.Style="Style",u.Tile="Tile",u.Unknown="Unknown"}(Fe||(Fe={}));class We{constructor(t){this._transformRequestFn=t}transformRequest(t,n){return this._transformRequestFn&&this._transformRequestFn(t,n)||{url:t}}normalizeSpriteURL(t,n,o){const c=function(d){const g=d.match(Ue);if(!g)throw new Error(`Unable to parse URL "${d}"`);return{protocol:g[1],authority:g[2],path:g[3]||"/",params:g[4]?g[4].split("&"):[]}}(t);return c.path+=`${n}${o}`,function(d){const g=d.params.length?`?${d.params.join("&")}`:"";return`${d.protocol}://${d.authority}${d.path}${g}`}(c)}setTransformRequest(t){this._transformRequestFn=t}}const Ue=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ye(u){var t=new a.A(3);return t[0]=u[0],t[1]=u[1],t[2]=u[2],t}var Ie,rt=function(u,t,n){return u[0]=t[0]-n[0],u[1]=t[1]-n[1],u[2]=t[2]-n[2],u};Ie=new a.A(3),a.A!=Float32Array&&(Ie[0]=0,Ie[1]=0,Ie[2]=0);var et=function(u){var t=u[0],n=u[1];return t*t+n*n};function Ze(u){const t=[];if(typeof u=="string")t.push({id:"default",url:u});else if(u&&u.length>0){const n=[];for(const{id:o,url:c}of u){const d=`${o}${c}`;n.indexOf(d)===-1&&(n.push(d),t.push({id:o,url:c}))}}return t}function at(u,t,n,o,c){if(o)return void u(o);if(c!==Object.values(t).length||c!==Object.values(n).length)return;const d={};for(const g in t){d[g]={};const _=a.h.getImageCanvasContext(n[g]),x=t[g];for(const S in x){const{width:I,height:A,x:L,y:U,sdf:V,pixelRatio:Z,stretchX:$,stretchY:ie,content:ue}=x[S];d[g][S]={data:null,pixelRatio:Z,sdf:V,stretchX:$,stretchY:ie,content:ue,spriteData:{width:I,height:A,x:L,y:U,context:_}}}}u(null,d)}(function(){var u=new a.A(2);a.A!=Float32Array&&(u[0]=0,u[1]=0)})();class Pe{constructor(t,n,o,c){this.context=t,this.format=o,this.texture=t.gl.createTexture(),this.update(n,c)}update(t,n,o){const{width:c,height:d}=t,g=!(this.size&&this.size[0]===c&&this.size[1]===d||o),{context:_}=this,{gl:x}=_;if(this.useMipmap=!!(n&&n.useMipmap),x.bindTexture(x.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!n||n.premultiply!==!1)),g)this.size=[c,d],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||a.a(t)?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,t):x.texImage2D(x.TEXTURE_2D,0,this.format,c,d,0,this.format,x.UNSIGNED_BYTE,t.data);else{const{x:S,y:I}=o||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||a.a(t)?x.texSubImage2D(x.TEXTURE_2D,0,S,I,x.RGBA,x.UNSIGNED_BYTE,t):x.texSubImage2D(x.TEXTURE_2D,0,S,I,c,d,x.RGBA,x.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&x.generateMipmap(x.TEXTURE_2D)}bind(t,n,o){const{context:c}=this,{gl:d}=c;d.bindTexture(d.TEXTURE_2D,this.texture),o!==d.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(o=d.LINEAR),t!==this.filter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,t),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,o||t),this.filter=t),n!==this.wrap&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,n),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function it(u){const{userImage:t}=u;return!!(t&&t.render&&t.render())&&(u.data.replace(new Uint8Array(t.data.buffer)),!0)}class xt extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:n,callback:o}of this.requestors)this._notify(n,o);this.requestors=[]}}getImage(t){const n=this.images[t];if(n&&!n.data&&n.spriteData){const o=n.spriteData;n.data=new a.R({width:o.width,height:o.height},o.context.getImageData(o.x,o.y,o.width,o.height).data),n.spriteData=null}return n}addImage(t,n){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,n)&&(this.images[t]=n)}_validate(t,n){let o=!0;const c=n.data||n.spriteData;return this._validateStretch(n.stretchX,c&&c.width)||(this.fire(new a.j(new Error(`Image "${t}" has invalid "stretchX" value`))),o=!1),this._validateStretch(n.stretchY,c&&c.height)||(this.fire(new a.j(new Error(`Image "${t}" has invalid "stretchY" value`))),o=!1),this._validateContent(n.content,n)||(this.fire(new a.j(new Error(`Image "${t}" has invalid "content" value`))),o=!1),o}_validateStretch(t,n){if(!t)return!0;let o=0;for(const c of t){if(c[0]<o||c[1]<c[0]||n<c[1])return!1;o=c[1]}return!0}_validateContent(t,n){if(!t)return!0;if(t.length!==4)return!1;const o=n.spriteData,c=o&&o.width||n.data.width,d=o&&o.height||n.data.height;return!(t[0]<0||c<t[0]||t[1]<0||d<t[1]||t[2]<0||c<t[2]||t[3]<0||d<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,n,o=!0){const c=this.getImage(t);if(o&&(c.data.width!==n.data.width||c.data.height!==n.data.height))throw new Error(`size mismatch between old image (${c.data.width}x${c.data.height}) and new image (${n.data.width}x${n.data.height}).`);n.version=c.version+1,this.images[t]=n,this.updatedImages[t]=!0}removeImage(t){const n=this.images[t];delete this.images[t],delete this.patterns[t],n.userImage&&n.userImage.onRemove&&n.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,n){let o=!0;if(!this.isLoaded())for(const c of t)this.images[c]||(o=!1);this.isLoaded()||o?this._notify(t,n):this.requestors.push({ids:t,callback:n})}_notify(t,n){const o={};for(const c of t){let d=this.getImage(c);d||(this.fire(new a.k("styleimagemissing",{id:c})),d=this.getImage(c)),d?o[c]={data:d.data.clone(),pixelRatio:d.pixelRatio,sdf:d.sdf,version:d.version,stretchX:d.stretchX,stretchY:d.stretchY,content:d.content,hasRenderCallback:!!(d.userImage&&d.userImage.render)}:a.w(`Image "${c}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}n(null,o)}getPixelSize(){const{width:t,height:n}=this.atlasImage;return{width:t,height:n}}getPattern(t){const n=this.patterns[t],o=this.getImage(t);if(!o)return null;if(n&&n.position.version===o.version)return n.position;if(n)n.position.version=o.version;else{const c={w:o.data.width+2,h:o.data.height+2,x:0,y:0},d=new a.I(c,o);this.patterns[t]={bin:c,position:d}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const n=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Pe(t,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const d in this.patterns)t.push(this.patterns[d].bin);const{w:n,h:o}=a.p(t),c=this.atlasImage;c.resize({width:n||1,height:o||1});for(const d in this.patterns){const{bin:g}=this.patterns[d],_=g.x+1,x=g.y+1,S=this.getImage(d).data,I=S.width,A=S.height;a.R.copy(S,c,{x:0,y:0},{x:_,y:x},{width:I,height:A}),a.R.copy(S,c,{x:0,y:A-1},{x:_,y:x-1},{width:I,height:1}),a.R.copy(S,c,{x:0,y:0},{x:_,y:x+A},{width:I,height:1}),a.R.copy(S,c,{x:I-1,y:0},{x:_-1,y:x},{width:1,height:A}),a.R.copy(S,c,{x:0,y:0},{x:_+I,y:x},{width:1,height:A})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const n of t){if(this.callbackDispatchedThisFrame[n])continue;this.callbackDispatchedThisFrame[n]=!0;const o=this.getImage(n);o||a.w(`Image with ID: "${n}" was not found`),it(o)&&this.updateImage(n,o)}}}const At=1e20;function gt(u,t,n,o,c,d,g,_,x){for(let S=t;S<t+o;S++)Pt(u,n*d+S,d,c,g,_,x);for(let S=n;S<n+c;S++)Pt(u,S*d+t,1,o,g,_,x)}function Pt(u,t,n,o,c,d,g){d[0]=0,g[0]=-At,g[1]=At,c[0]=u[t];for(let _=1,x=0,S=0;_<o;_++){c[_]=u[t+_*n];const I=_*_;do{const A=d[x];S=(c[_]-c[A]+I-A*A)/(_-A)/2}while(S<=g[x]&&--x>-1);x++,d[x]=_,g[x]=S,g[x+1]=At}for(let _=0,x=0;_<o;_++){for(;g[x+1]<_;)x++;const S=d[x],I=_-S;u[t+_*n]=c[S]+I*I}}class Bt{constructor(t,n){this.requestManager=t,this.localIdeographFontFamily=n,this.entries={}}setURL(t){this.url=t}getGlyphs(t,n){const o=[];for(const c in t)for(const d of t[c])o.push({stack:c,id:d});a.o(o,({stack:c,id:d},g)=>{let _=this.entries[c];_||(_=this.entries[c]={glyphs:{},requests:{},ranges:{}});let x=_.glyphs[d];if(x!==void 0)return void g(null,{stack:c,id:d,glyph:x});if(x=this._tinySDF(_,c,d),x)return _.glyphs[d]=x,void g(null,{stack:c,id:d,glyph:x});const S=Math.floor(d/256);if(256*S>65535)return void g(new Error("glyphs > 65535 not supported"));if(_.ranges[S])return void g(null,{stack:c,id:d,glyph:x});if(!this.url)return void g(new Error("glyphsUrl is not set"));let I=_.requests[S];I||(I=_.requests[S]=[],Bt.loadGlyphRange(c,S,this.url,this.requestManager,(A,L)=>{if(L){for(const U in L)this._doesCharSupportLocalGlyph(+U)||(_.glyphs[+U]=L[+U]);_.ranges[S]=!0}for(const U of I)U(A,L);delete _.requests[S]})),I.push((A,L)=>{A?g(A):L&&g(null,{stack:c,id:d,glyph:L[d]||null})})},(c,d)=>{if(c)n(c);else if(d){const g={};for(const{stack:_,id:x,glyph:S}of d)(g[_]||(g[_]={}))[x]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics};n(null,g)}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(a.u["CJK Unified Ideographs"](t)||a.u["Hangul Syllables"](t)||a.u.Hiragana(t)||a.u.Katakana(t))}_tinySDF(t,n,o){const c=this.localIdeographFontFamily;if(!c||!this._doesCharSupportLocalGlyph(o))return;let d=t.tinySDF;if(!d){let _="400";/bold/i.test(n)?_="900":/medium/i.test(n)?_="500":/light/i.test(n)&&(_="200"),d=t.tinySDF=new Bt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:c,fontWeight:_})}const g=d.draw(String.fromCharCode(o));return{id:o,bitmap:new a.q({width:g.width||60,height:g.height||60},g.data),metrics:{width:g.glyphWidth/2||24,height:g.glyphHeight/2||24,left:g.glyphLeft/2+.5||0,top:g.glyphTop/2-27.5||-8,advance:g.glyphAdvance/2||24,isDoubleResolution:!0}}}}Bt.loadGlyphRange=function(u,t,n,o,c){const d=256*t,g=d+255,_=o.transformRequest(n.replace("{fontstack}",u).replace("{range}",`${d}-${g}`),Fe.Glyphs);a.l(_,(x,S)=>{if(x)c(x);else if(S){const I={};for(const A of a.n(S))I[A.id]=A;c(null,I)}})},Bt.TinySDF=class{constructor({fontSize:u=24,buffer:t=3,radius:n=8,cutoff:o=.25,fontFamily:c="sans-serif",fontWeight:d="normal",fontStyle:g="normal"}={}){this.buffer=t,this.cutoff=o,this.radius=n;const _=this.size=u+4*t,x=this._createCanvas(_),S=this.ctx=x.getContext("2d",{willReadFrequently:!0});S.font=`${g} ${d} ${u}px ${c}`,S.textBaseline="alphabetic",S.textAlign="left",S.fillStyle="black",this.gridOuter=new Float64Array(_*_),this.gridInner=new Float64Array(_*_),this.f=new Float64Array(_),this.z=new Float64Array(_+1),this.v=new Uint16Array(_)}_createCanvas(u){const t=document.createElement("canvas");return t.width=t.height=u,t}draw(u){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:o,actualBoundingBoxLeft:c,actualBoundingBoxRight:d}=this.ctx.measureText(u),g=Math.ceil(n),_=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(d-c))),x=Math.min(this.size-this.buffer,g+Math.ceil(o)),S=_+2*this.buffer,I=x+2*this.buffer,A=Math.max(S*I,0),L=new Uint8ClampedArray(A),U={data:L,width:S,height:I,glyphWidth:_,glyphHeight:x,glyphTop:g,glyphLeft:0,glyphAdvance:t};if(_===0||x===0)return U;const{ctx:V,buffer:Z,gridInner:$,gridOuter:ie}=this;V.clearRect(Z,Z,_,x),V.fillText(u,Z,Z+g);const ue=V.getImageData(Z,Z,_,x);ie.fill(At,0,A),$.fill(0,0,A);for(let K=0;K<x;K++)for(let re=0;re<_;re++){const pe=ue.data[4*(K*_+re)+3]/255;if(pe===0)continue;const fe=(K+Z)*S+re+Z;if(pe===1)ie[fe]=0,$[fe]=At;else{const xe=.5-pe;ie[fe]=xe>0?xe*xe:0,$[fe]=xe<0?xe*xe:0}}gt(ie,0,0,S,I,S,this.f,this.v,this.z),gt($,Z,Z,_,x,S,this.f,this.v,this.z);for(let K=0;K<A;K++){const re=Math.sqrt(ie[K])-Math.sqrt($[K]);L[K]=Math.round(255-255*(re/this.radius+this.cutoff))}return U}};class ft{constructor(){this.specification=a.v.light.position}possiblyEvaluate(t,n){return a.z(t.expression.evaluate(n))}interpolate(t,n,o){return{x:a.B.number(t.x,n.x,o),y:a.B.number(t.y,n.y,o),z:a.B.number(t.z,n.z,o)}}}let ni;class Mi extends a.E{constructor(t){super(),ni=ni||new a.r({anchor:new a.D(a.v.light.anchor),position:new ft,color:new a.D(a.v.light.color),intensity:new a.D(a.v.light.intensity)}),this._transitionable=new a.T(ni),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,n={}){if(!this._validate(a.t,t,n))for(const o in t){const c=t[o];o.endsWith("-transition")?this._transitionable.setTransition(o.slice(0,-11),c):this._transitionable.setValue(o,c)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,o){return(!o||o.validate!==!1)&&a.x(this,t.call(a.y,a.e({value:n,style:{glyphs:!0,sprite:!0},styleSpec:a.v})))}}class Xi{constructor(t,n){this.width=t,this.height=n,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,n){const o=t.join(",")+String(n);return this.dashEntry[o]||(this.dashEntry[o]=this.addDash(t,n)),this.dashEntry[o]}getDashRanges(t,n,o){const c=[];let d=t.length%2==1?-t[t.length-1]*o:0,g=t[0]*o,_=!0;c.push({left:d,right:g,isDash:_,zeroLength:t[0]===0});let x=t[0];for(let S=1;S<t.length;S++){_=!_;const I=t[S];d=x*o,x+=I,g=x*o,c.push({left:d,right:g,isDash:_,zeroLength:I===0})}return c}addRoundDash(t,n,o){const c=n/2;for(let d=-o;d<=o;d++){const g=this.width*(this.nextRow+o+d);let _=0,x=t[_];for(let S=0;S<this.width;S++){S/x.right>1&&(x=t[++_]);const I=Math.abs(S-x.left),A=Math.abs(S-x.right),L=Math.min(I,A);let U;const V=d/o*(c+1);if(x.isDash){const Z=c-Math.abs(V);U=Math.sqrt(L*L+Z*Z)}else U=c-Math.sqrt(L*L+V*V);this.data[g+S]=Math.max(0,Math.min(255,U+128))}}}addRegularDash(t){for(let _=t.length-1;_>=0;--_){const x=t[_],S=t[_+1];x.zeroLength?t.splice(_,1):S&&S.isDash===x.isDash&&(S.left=x.left,t.splice(_,1))}const n=t[0],o=t[t.length-1];n.isDash===o.isDash&&(n.left=o.left-this.width,o.right=n.right+this.width);const c=this.width*this.nextRow;let d=0,g=t[d];for(let _=0;_<this.width;_++){_/g.right>1&&(g=t[++d]);const x=Math.abs(_-g.left),S=Math.abs(_-g.right),I=Math.min(x,S);this.data[c+_]=Math.max(0,Math.min(255,(g.isDash?I:-I)+128))}}addDash(t,n){const o=n?7:0,c=2*o+1;if(this.nextRow+c>this.height)return a.w("LineAtlas out of space"),null;let d=0;for(let _=0;_<t.length;_++)d+=t[_];if(d!==0){const _=this.width/d,x=this.getDashRanges(t,this.width,_);n?this.addRoundDash(x,_,o):this.addRegularDash(x)}const g={y:(this.nextRow+o+.5)/this.height,height:2*o/this.height,width:d};return this.nextRow+=c,this.dirty=!0,g}bind(t){const n=t.gl;this.texture?(n.bindTexture(n.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,n.texSubImage2D(n.TEXTURE_2D,0,0,0,this.width,this.height,n.ALPHA,n.UNSIGNED_BYTE,this.data))):(this.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texImage2D(n.TEXTURE_2D,0,n.ALPHA,this.width,this.height,0,n.ALPHA,n.UNSIGNED_BYTE,this.data))}}class si{constructor(t,n,o){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=o;const c=this.workerPool.acquire(o);for(let d=0;d<c.length;d++){const g=new a.C(c[d],n,o);g.name=`Worker ${d}`,this.actors.push(g)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,n,o){a.o(this.actors,(c,d)=>{c.send(t,n,d)},o=o||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(n=>{n.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}}function Xt(u,t,n){const o=function(c,d){if(c)return n(c);if(d){const g=a.F(a.e(d,u),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);d.vector_layers&&(g.vectorLayers=d.vector_layers,g.vectorLayerIds=g.vectorLayers.map(_=>_.id)),n(null,g)}};return u.url?a.f(t.transformRequest(u.url,Fe.Source),o):a.h.frame(()=>o(null,u))}class qe{constructor(t,n){t&&(n?this.setSouthWest(t).setNorthEast(n):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof a.L?new a.L(t.lng,t.lat):a.L.convert(t),this}setSouthWest(t){return this._sw=t instanceof a.L?new a.L(t.lng,t.lat):a.L.convert(t),this}extend(t){const n=this._sw,o=this._ne;let c,d;if(t instanceof a.L)c=t,d=t;else{if(!(t instanceof qe))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(qe.convert(t)):this.extend(a.L.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(a.L.convert(t)):this;if(c=t._sw,d=t._ne,!c||!d)return this}return n||o?(n.lng=Math.min(c.lng,n.lng),n.lat=Math.min(c.lat,n.lat),o.lng=Math.max(d.lng,o.lng),o.lat=Math.max(d.lat,o.lat)):(this._sw=new a.L(c.lng,c.lat),this._ne=new a.L(d.lng,d.lat)),this}getCenter(){return new a.L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new a.L(this.getWest(),this.getNorth())}getSouthEast(){return new a.L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:n,lat:o}=a.L.convert(t);let c=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&c}static convert(t){return t instanceof qe?t:t&&new qe(t)}static fromLngLat(t,n=0){const o=360*n/40075017,c=o/Math.cos(Math.PI/180*t.lat);return new qe(new a.L(t.lng-c,t.lat-o),new a.L(t.lng+c,t.lat+o))}}class yt{constructor(t,n,o){this.bounds=qe.convert(this.validateBounds(t)),this.minzoom=n||0,this.maxzoom=o||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const n=Math.pow(2,t.z),o=Math.floor(a.G(this.bounds.getWest())*n),c=Math.floor(a.H(this.bounds.getNorth())*n),d=Math.ceil(a.G(this.bounds.getEast())*n),g=Math.ceil(a.H(this.bounds.getSouth())*n);return t.x>=o&&t.x<d&&t.y>=c&&t.y<g}}class Kt extends a.E{constructor(t,n,o,c){if(super(),this.load=()=>{this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Xt(this._options,this.map._requestManager,(d,g)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),d?this.fire(new a.j(d)):g&&(a.e(this,g),g.bounds&&(this.tileBounds=new yt(g.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>a.e({},this._options),this.id=t,this.dispatcher=o,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.e(this,a.F(n,["url","scheme","tileSize","promoteId"])),this._options=a.e({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(c)}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(t,n){const o=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c={request:this.map._requestManager.transformRequest(o,Fe.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function d(g,_){return delete t.request,t.aborted?n(null):g&&g.status!==404?n(g):(_&&_.resourceTiming&&(t.resourceTiming=_.resourceTiming),this.map._refreshExpiredTiles&&_&&t.setExpiryData(_),t.loadVectorData(_,this.map.painter),n(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}c.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired"?t.state==="loading"?t.reloadCallback=n:t.request=t.actor.send("reloadTile",c,d.bind(this)):(t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",c,d.bind(this)))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Mt extends a.E{constructor(t,n,o,c){super(),this.id=t,this.dispatcher=o,this.setEventedParent(c),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.e({type:"raster"},n),a.e(this,a.F(n,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Xt(this._options,this.map._requestManager,(t,n)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new a.j(t)):n&&(a.e(this,n),n.bounds&&(this.tileBounds=new yt(n.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}serialize(){return a.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,n){const o=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.request=Re.getImage(this.map._requestManager.transformRequest(o,Fe.Tile),(c,d,g)=>{if(delete t.request,t.aborted)t.state="unloaded",n(null);else if(c)t.state="errored",n(c);else if(d){this.map._refreshExpiredTiles&&g&&t.setExpiryData(g);const _=this.map.painter.context,x=_.gl;t.texture=this.map.painter.getTileTexture(d.width),t.texture?t.texture.update(d,{useMipmap:!0}):(t.texture=new Pe(_,d,x.RGBA,{useMipmap:!0}),t.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE,x.LINEAR_MIPMAP_NEAREST),_.extTextureFilterAnisotropic&&x.texParameterf(x.TEXTURE_2D,_.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,_.extTextureFilterAnisotropicMax)),t.state="loaded",n(null)}},this.map._refreshExpiredTiles)}abortTile(t,n){t.request&&(t.request.cancel(),delete t.request),n()}unloadTile(t,n){t.texture&&this.map.painter.saveTileTexture(t.texture),n()}hasTransition(){return!1}}class Jt extends Mt{constructor(t,n,o,c){super(t,n,o,c),this.type="raster-dem",this.maxzoom=22,this._options=a.e({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox",this.redFactor=n.redFactor,this.greenFactor=n.greenFactor,this.blueFactor=n.blueFactor,this.baseShift=n.baseShift}loadTile(t,n){const o=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c=this.map._requestManager.transformRequest(o,Fe.Tile);function d(g,_){g&&(t.state="errored",n(g)),_&&(t.dem=_,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded",n(null))}t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.request=Re.getImage(c,(g,_,x)=>a._(this,void 0,void 0,function*(){if(delete t.request,t.aborted)t.state="unloaded",n(null);else if(g)t.state="errored",n(g);else if(_){this.map._refreshExpiredTiles&&t.setExpiryData(x);const S=a.a(_)&&a.J()?_:yield function(A){return a._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&a.K()){const L=A.width+2,U=A.height+2;try{return new a.R({width:L,height:U},yield a.M(A,-1,-1,L,U))}catch{}}return a.h.getImageData(A,1)})}(_),I={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:S,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};t.actor&&t.state!=="expired"||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",I,d))}}),this.map._refreshExpiredTiles)}_getNeighboringTiles(t){const n=t.canonical,o=Math.pow(2,n.z),c=(n.x-1+o)%o,d=n.x===0?t.wrap-1:t.wrap,g=(n.x+1+o)%o,_=n.x+1===o?t.wrap+1:t.wrap,x={};return x[new a.O(t.overscaledZ,d,n.z,c,n.y).key]={backfilled:!1},x[new a.O(t.overscaledZ,_,n.z,g,n.y).key]={backfilled:!1},n.y>0&&(x[new a.O(t.overscaledZ,d,n.z,c,n.y-1).key]={backfilled:!1},x[new a.O(t.overscaledZ,t.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},x[new a.O(t.overscaledZ,_,n.z,g,n.y-1).key]={backfilled:!1}),n.y+1<o&&(x[new a.O(t.overscaledZ,d,n.z,c,n.y+1).key]={backfilled:!1},x[new a.O(t.overscaledZ,t.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},x[new a.O(t.overscaledZ,_,n.z,g,n.y+1).key]={backfilled:!1}),x}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})}}class gi extends a.E{constructor(t,n,o,c){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>a.e({},this._options,{type:this.type,data:this._data}),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=o.getActor(),this.setEventedParent(c),this._data=n.data,this._options=a.e({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const d=a.N/this.tileSize;this.workerOptions=a.e({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*d,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*d,extent:a.N,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:a.N,radius:(n.clusterRadius||50)*d,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=t.clusterRadius),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=t.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(t,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},n),this}getClusterChildren(t,n){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},n),this}getClusterLeaves(t,n,o,c){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:n,offset:o},c),this}_updateWorkerData(t){const n=a.e({},this.workerOptions);t?n.dataDiff=t:typeof this._data=="string"?(n.request=this.map._requestManager.transformRequest(a.h.resolveURL(this._data),Fe.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new a.k("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,n,(o,c)=>{if(this._pendingLoads--,this._removed||c&&c.abandoned)return void this.fire(new a.k("dataabort",{dataType:"source"}));let d=null;if(c&&c.resourceTiming&&c.resourceTiming[this.id]&&(d=c.resourceTiming[this.id].slice(0)),o)return void this.fire(new a.j(o));const g={dataType:"source"};this._collectResourceTiming&&d&&d.length>0&&a.e(g,{resourceTiming:d}),this.fire(new a.k("data",Object.assign(Object.assign({},g),{sourceDataType:"metadata"}))),this.fire(new a.k("data",Object.assign(Object.assign({},g),{sourceDataType:"content"})))})}loaded(){return this._pendingLoads===0}loadTile(t,n){const o=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const c={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.request=this.actor.send(o,c,(d,g)=>(delete t.request,t.unloadVectorData(),t.aborted?n(null):d?n(d):(t.loadVectorData(g,this.map.painter,o==="reloadTile"),n(null))))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var Yt=a.Q([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Rt extends a.E{constructor(t,n,o,c){super(),this.load=(d,g)=>{this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=Re.getImage(this.map._requestManager.transformRequest(this.url,Fe.Image),(_,x)=>{this._request=null,this._loaded=!0,_?this.fire(new a.j(_)):x&&(this.image=x,d&&(this.coordinates=d),g&&g(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;const d=this.map.painter.context,g=d.gl;this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,Yt.members)),this.boundsSegments||(this.boundsSegments=a.S.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Pe(d,this.image,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE));let _=!1;for(const x in this.tiles){const S=this.tiles[x];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,_=!0)}_&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=t,this.dispatcher=o,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(c),this.options=n}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(t){this.coordinates=t;const n=t.map(a.U.fromLngLat);this.tileID=function(c){let d=1/0,g=1/0,_=-1/0,x=-1/0;for(const L of c)d=Math.min(d,L.x),g=Math.min(g,L.y),_=Math.max(_,L.x),x=Math.max(x,L.y);const S=Math.max(_-d,x-g),I=Math.max(0,Math.floor(-Math.log(S)/Math.LN2)),A=Math.pow(2,I);return new a.W(I,Math.floor((d+_)/2*A),Math.floor((g+x)/2*A))}(n),this.minzoom=this.maxzoom=this.tileID.z;const o=n.map(c=>this.tileID.getTilePoint(c)._round());return this._boundsArray=new a.V,this._boundsArray.emplaceBack(o[0].x,o[0].y,0,0),this._boundsArray.emplaceBack(o[1].x,o[1].y,a.N,0),this._boundsArray.emplaceBack(o[3].x,o[3].y,0,a.N),this._boundsArray.emplaceBack(o[2].x,o[2].y,a.N,a.N),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(t,n){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},n(null)):(t.state="errored",n(null))}hasTransition(){return!1}}class ki extends Rt{constructor(t,n,o,c){super(t,n,o,c),this.load=()=>{this._loaded=!1;const d=this.options;this.urls=[];for(const g of d.urls)this.urls.push(this.map._requestManager.transformRequest(g,Fe.Source).url);a.X(this.urls,(g,_)=>{this._loaded=!0,g?this.fire(new a.j(g)):_&&(this.video=_,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const d=this.map.painter.context,g=d.gl;this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,Yt.members)),this.boundsSegments||(this.boundsSegments=a.S.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE),g.texSubImage2D(g.TEXTURE_2D,0,0,0,g.RGBA,g.UNSIGNED_BYTE,this.video)):(this.texture=new Pe(d,this.video,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE));let _=!1;for(const x in this.tiles){const S=this.tiles[x];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,_=!0)}_&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=n}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const n=this.video.seekable;t<n.start(0)||t>n.end(0)?this.fire(new a.j(new a.Y(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class bi extends Rt{constructor(t,n,o,c){super(t,n,o,c),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const g=this.map.painter.context,_=g.gl;this.boundsBuffer||(this.boundsBuffer=g.createVertexBuffer(this._boundsArray,Yt.members)),this.boundsSegments||(this.boundsSegments=a.S.simpleSegment(0,0,4,2)),this.texture?(d||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Pe(g,this.canvas,_.RGBA,{premultiply:!0});let x=!1;for(const S in this.tiles){const I=this.tiles[S];I.state!=="loaded"&&(I.state="loaded",I.texture=this.texture,x=!0)}x&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(d=>!Array.isArray(d)||d.length!==2||d.some(g=>typeof g!="number"))||this.fire(new a.j(new a.Y(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.j(new a.Y(`sources.${t}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new a.j(new a.Y(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new a.j(new a.Y(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.j(new a.Y(`sources.${t}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const Wt={},Ti=u=>{switch(u){case"geojson":return gi;case"image":return Rt;case"raster":return Mt;case"raster-dem":return Jt;case"vector":return Kt;case"video":return ki;case"canvas":return bi}return Wt[u]};function rr(u,t){const n=a.Z();return a.$(n,n,[1,1,0]),a.a0(n,n,[.5*u.width,.5*u.height,1]),a.a1(n,n,u.calculatePosMatrix(t.toUnwrapped()))}function fr(u,t,n,o,c,d){const g=function(A,L,U){if(A)for(const V of A){const Z=L[V];if(Z&&Z.source===U&&Z.type==="fill-extrusion")return!0}else for(const V in L){const Z=L[V];if(Z.source===U&&Z.type==="fill-extrusion")return!0}return!1}(c&&c.layers,t,u.id),_=d.maxPitchScaleFactor(),x=u.tilesIn(o,_,g);x.sort(nr);const S=[];for(const A of x)S.push({wrappedTileID:A.tileID.wrapped().key,queryResults:A.tile.queryRenderedFeatures(t,n,u._state,A.queryGeometry,A.cameraQueryGeometry,A.scale,c,d,_,rr(u.transform,A.tileID))});const I=function(A){const L={},U={};for(const V of A){const Z=V.queryResults,$=V.wrappedTileID,ie=U[$]=U[$]||{};for(const ue in Z){const K=Z[ue],re=ie[ue]=ie[ue]||{},pe=L[ue]=L[ue]||[];for(const fe of K)re[fe.featureIndex]||(re[fe.featureIndex]=!0,pe.push(fe))}}return L}(S);for(const A in I)I[A].forEach(L=>{const U=L.feature,V=u.getFeatureState(U.layer["source-layer"],U.id);U.source=U.layer.source,U.layer["source-layer"]&&(U.sourceLayer=U.layer["source-layer"]),U.state=V});return I}function nr(u,t){const n=u.tileID,o=t.tileID;return n.overscaledZ-o.overscaledZ||n.canonical.y-o.canonical.y||n.wrap-o.wrap||n.canonical.x-o.canonical.x}class mr{constructor(t,n){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=a.a2(),this.uses=0,this.tileSize=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const n=t+this.timeAdded;n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,n,o){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(c,d){const g={};if(!d)return g;for(const _ of c){const x=_.layerIds.map(S=>d.getLayer(S)).filter(Boolean);if(x.length!==0){_.layers=x,_.stateDependentLayerIds&&(_.stateDependentLayers=_.stateDependentLayerIds.map(S=>x.filter(I=>I.id===S)[0]));for(const S of x)g[S.id]=_}}return g}(t.buckets,n.style),this.hasSymbolBuckets=!1;for(const c in this.buckets){const d=this.buckets[c];if(d instanceof a.a4){if(this.hasSymbolBuckets=!0,!o)break;d.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const c in this.buckets){const d=this.buckets[c];if(d instanceof a.a4&&d.hasRTLText){this.hasRTLText=!0,a.a5();break}}this.queryPadding=0;for(const c in this.buckets){const d=this.buckets[c];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(c).queryRadius(d))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new a.a3}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const o in this.buckets){const c=this.buckets[o];c.uploadPending()&&c.upload(t)}const n=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Pe(t,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Pe(t,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,n,o,c,d,g,_,x,S,I){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:c,cameraQueryGeometry:d,scale:g,tileSize:this.tileSize,pixelPosMatrix:I,transform:x,params:_,queryPadding:this.queryPadding*S},t,n,o):{}}querySourceFeatures(t,n){const o=this.latestFeatureIndex;if(!o||!o.rawTileData)return;const c=o.loadVTLayers(),d=n&&n.sourceLayer?n.sourceLayer:"",g=c._geojsonTileLayer||c[d];if(!g)return;const _=a.a6(n&&n.filter),{z:x,x:S,y:I}=this.tileID.canonical,A={z:x,x:S,y:I};for(let L=0;L<g.length;L++){const U=g.feature(L);if(_.needGeometry){const $=a.a7(U,!0);if(!_.filter(new a.a8(this.tileID.overscaledZ),$,this.tileID.canonical))continue}else if(!_.filter(new a.a8(this.tileID.overscaledZ),U))continue;const V=o.getId(U,d),Z=new a.a9(U,x,S,I,V);Z.tile=A,t.push(Z)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const n=this.expirationTime;if(t.cacheControl){const o=a.aa(t.cacheControl);o["max-age"]&&(this.expirationTime=Date.now()+1e3*o["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const o=Date.now();let c=!1;if(this.expirationTime>o)c=!1;else if(n)if(this.expirationTime<n)c=!0;else{const d=this.expirationTime-n;d?this.expirationTime=o+Math.max(d,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const o=this.latestFeatureIndex.loadVTLayers();for(const c in this.buckets){if(!n.style.hasLayer(c))continue;const d=this.buckets[c],g=d.layers[0].sourceLayer||"_geojsonTileLayer",_=o[g],x=t[g];if(!_||!x||Object.keys(x).length===0)continue;d.update(x,_,this.imageAtlas&&this.imageAtlas.patternPositions||{});const S=n&&n.style&&n.style.getLayer(c);S&&(this.queryPadding=Math.max(this.queryPadding,S.queryRadius(d)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<a.h.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=a.h.now()+t}setDependencies(t,n){const o={};for(const c of n)o[c]=!0;this.dependencies[t]=o}hasDependency(t,n){for(const o of t){const c=this.dependencies[o];if(c){for(const d of n)if(c[d])return!0}}return!1}}class Cr{constructor(t,n){this.max=t,this.onRemove=n,this.reset()}reset(){for(const t in this.data)for(const n of this.data[t])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(t,n,o){const c=t.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);const d={value:n,timeout:void 0};if(o!==void 0&&(d.timeout=setTimeout(()=>{this.remove(t,d)},o)),this.data[c].push(d),this.order.push(c),this.order.length>this.max){const g=this._getAndRemoveByKey(this.order[0]);g&&this.onRemove(g)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const n=this.data[t].shift();return n.timeout&&clearTimeout(n.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),n.value}getByKey(t){const n=this.data[t];return n?n[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,n){if(!this.has(t))return this;const o=t.wrapped().key,c=n===void 0?0:this.data[o].indexOf(n),d=this.data[o][c];return this.data[o].splice(c,1),d.timeout&&clearTimeout(d.timeout),this.data[o].length===0&&delete this.data[o],this.onRemove(d.value),this.order.splice(this.order.indexOf(o),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(t){const n=[];for(const o in this.data)for(const c of this.data[o])t(c.value)||n.push(c);for(const o of n)this.remove(o.value.tileID,o)}}class me{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,n,o){const c=String(n);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][c]=this.stateChanges[t][c]||{},a.e(this.stateChanges[t][c],o),this.deletedStates[t]===null){this.deletedStates[t]={};for(const d in this.state[t])d!==c&&(this.deletedStates[t][d]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][c]===null){this.deletedStates[t][c]={};for(const d in this.state[t][c])o[d]||(this.deletedStates[t][c][d]=null)}else for(const d in o)this.deletedStates[t]&&this.deletedStates[t][c]&&this.deletedStates[t][c][d]===null&&delete this.deletedStates[t][c][d]}removeFeatureState(t,n,o){if(this.deletedStates[t]===null)return;const c=String(n);if(this.deletedStates[t]=this.deletedStates[t]||{},o&&n!==void 0)this.deletedStates[t][c]!==null&&(this.deletedStates[t][c]=this.deletedStates[t][c]||{},this.deletedStates[t][c][o]=null);else if(n!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][c])for(o in this.deletedStates[t][c]={},this.stateChanges[t][c])this.deletedStates[t][c][o]=null;else this.deletedStates[t][c]=null;else this.deletedStates[t]=null}getState(t,n){const o=String(n),c=a.e({},(this.state[t]||{})[o],(this.stateChanges[t]||{})[o]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const d=this.deletedStates[t][n];if(d===null)return{};for(const g in d)delete c[g]}return c}initializeTileState(t,n){t.setFeatureState(this.state,n)}coalesceChanges(t,n){const o={};for(const c in this.stateChanges){this.state[c]=this.state[c]||{};const d={};for(const g in this.stateChanges[c])this.state[c][g]||(this.state[c][g]={}),a.e(this.state[c][g],this.stateChanges[c][g]),d[g]=this.state[c][g];o[c]=d}for(const c in this.deletedStates){this.state[c]=this.state[c]||{};const d={};if(this.deletedStates[c]===null)for(const g in this.state[c])d[g]={},this.state[c][g]={};else for(const g in this.deletedStates[c]){if(this.deletedStates[c][g]===null)this.state[c][g]={};else for(const _ of Object.keys(this.deletedStates[c][g]))delete this.state[c][g][_];d[g]=this.state[c][g]}o[c]=o[c]||{},a.e(o[c],d)}if(this.stateChanges={},this.deletedStates={},Object.keys(o).length!==0)for(const c in t)t[c].setFeatureState(o,n)}}class Ii extends a.E{constructor(t,n,o){super(),this.id=t,this.dispatcher=o,this.on("data",c=>{c.dataType==="source"&&c.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&c.dataType==="source"&&c.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((c,d,g,_)=>{const x=new(Ti(d.type))(c,d,g,_);if(x.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${x.id}`);return x})(t,n,o,this),this._tiles={},this._cache=new Cr(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new me,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const n=this._tiles[t];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,n){return this._source.loadTile(t,n)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){this._source.abortTile&&this._source.abortTile(t,()=>{}),this._source.fire(new a.k("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const o=this._tiles[n];o.upload(t),o.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort($i).map(t=>t.key)}getRenderableIds(t){const n=[];for(const o in this._tiles)this._isIdRenderable(o,t)&&n.push(this._tiles[o]);return t?n.sort((o,c)=>{const d=o.tileID,g=c.tileID,_=new a.P(d.canonical.x,d.canonical.y)._rotate(this.transform.angle),x=new a.P(g.canonical.x,g.canonical.y)._rotate(this.transform.angle);return d.overscaledZ-g.overscaledZ||x.y-_.y||x.x-_.x}).map(o=>o.tileID.key):n.map(o=>o.tileID).sort($i).map(o=>o.key)}hasRenderableParent(t){const n=this.findLoadedParent(t,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(t,n){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(n||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,n){const o=this._tiles[t];o&&(o.state!=="loading"&&(o.state=n),this._loadTile(o,this._tileLoaded.bind(this,o,t,n)))}_tileLoaded(t,n,o,c){if(c)return t.state="errored",void(c.status!==404?this._source.fire(new a.j(c,{tile:t})):this.update(this.transform,this.terrain));t.timeAdded=a.h.now(),o==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(n,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new a.k("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const n=this.getRenderableIds();for(let c=0;c<n.length;c++){const d=n[c];if(t.neighboringTiles&&t.neighboringTiles[d]){const g=this.getTileByID(d);o(t,g),o(g,t)}}function o(c,d){c.needsHillshadePrepare=!0,c.needsTerrainPrepare=!0;let g=d.tileID.canonical.x-c.tileID.canonical.x;const _=d.tileID.canonical.y-c.tileID.canonical.y,x=Math.pow(2,c.tileID.canonical.z),S=d.tileID.key;g===0&&_===0||Math.abs(_)>1||(Math.abs(g)>1&&(Math.abs(g+x)===1?g+=x:Math.abs(g-x)===1&&(g-=x)),d.dem&&c.dem&&(c.dem.backfillBorder(d.dem,g,_),c.neighboringTiles&&c.neighboringTiles[S]&&(c.neighboringTiles[S].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,n,o,c){for(const d in this._tiles){let g=this._tiles[d];if(c[d]||!g.hasData()||g.tileID.overscaledZ<=n||g.tileID.overscaledZ>o)continue;let _=g.tileID;for(;g&&g.tileID.overscaledZ>n+1;){const S=g.tileID.scaledTo(g.tileID.overscaledZ-1);g=this._tiles[S.key],g&&g.hasData()&&(_=S)}let x=_;for(;x.overscaledZ>n;)if(x=x.scaledTo(x.overscaledZ-1),t[x.key]){c[_.key]=_;break}}}findLoadedParent(t,n){if(t.key in this._loadedParentTiles){const o=this._loadedParentTiles[t.key];return o&&o.tileID.overscaledZ>=n?o:null}for(let o=t.overscaledZ-1;o>=n;o--){const c=t.scaledTo(o),d=this._getLoadedTile(c);if(d)return d}}_getLoadedTile(t){const n=this._tiles[t.key];return n&&n.hasData()?n:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const n=Math.ceil(t.width/this._source.tileSize)+1,o=Math.ceil(t.height/this._source.tileSize)+1,c=Math.floor(n*o*(this._maxTileCacheZoomLevels===null?a.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),d=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,c):c;this._cache.setMaxSize(d)}handleWrapJump(t){const n=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,n){const o={};for(const c in this._tiles){const d=this._tiles[c];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+n),o[d.tileID.key]=d}this._tiles=o;for(const c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(const c in this._tiles)this._setTileReloadTimer(c,this._tiles[c])}}update(t,n){if(this.transform=t,this.terrain=n,!this._sourceLoaded||this._paused)return;let o;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?o=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(I=>new a.O(I.canonical.z,I.wrap,I.canonical.z,I.canonical.x,I.canonical.y)):(o=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:n}),this._source.hasTile&&(o=o.filter(I=>this._source.hasTile(I)))):o=[];const c=t.coveringZoomLevel(this._source),d=Math.max(c-Ii.maxOverzooming,this._source.minzoom),g=Math.max(c+Ii.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const I={};for(const A of o)if(A.canonical.z>this._source.minzoom){const L=A.scaledTo(A.canonical.z-1);I[L.key]=L;const U=A.scaledTo(Math.max(this._source.minzoom,Math.min(A.canonical.z,5)));I[U.key]=U}o=o.concat(Object.values(I))}const _=o.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,_&&this.fire(new a.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const x=this._updateRetainedTiles(o,c);if(jt(this._source.type)){const I={},A={},L=Object.keys(x),U=a.h.now();for(const V of L){const Z=x[V],$=this._tiles[V];if(!$||$.fadeEndTime!==0&&$.fadeEndTime<=U)continue;const ie=this.findLoadedParent(Z,d);ie&&(this._addTile(ie.tileID),I[ie.tileID.key]=ie.tileID),A[V]=Z}this._retainLoadedChildren(A,c,g,x);for(const V in I)x[V]||(this._coveredTiles[V]=!0,x[V]=I[V]);if(n){const V={},Z={};for(const $ of o)this._tiles[$.key].hasData()?V[$.key]=$:Z[$.key]=$;for(const $ in Z){const ie=Z[$].children(this._source.maxzoom);this._tiles[ie[0].key]&&this._tiles[ie[1].key]&&this._tiles[ie[2].key]&&this._tiles[ie[3].key]&&(V[ie[0].key]=x[ie[0].key]=ie[0],V[ie[1].key]=x[ie[1].key]=ie[1],V[ie[2].key]=x[ie[2].key]=ie[2],V[ie[3].key]=x[ie[3].key]=ie[3],delete Z[$])}for(const $ in Z){const ie=this.findLoadedParent(Z[$],this._source.minzoom);if(ie){V[ie.tileID.key]=x[ie.tileID.key]=ie.tileID;for(const ue in V)V[ue].isChildOf(ie.tileID)&&delete V[ue]}}for(const $ in this._tiles)V[$]||(this._coveredTiles[$]=!0)}}for(const I in x)this._tiles[I].clearFadeHold();const S=a.ab(this._tiles,x);for(const I of S){const A=this._tiles[I];A.hasSymbolBuckets&&!A.holdingForFade()?A.setHoldDuration(this.map._fadeDuration):A.hasSymbolBuckets&&!A.symbolFadeFinished()||this._removeTile(I)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,n){const o={},c={},d=Math.max(n-Ii.maxOverzooming,this._source.minzoom),g=Math.max(n+Ii.maxUnderzooming,this._source.minzoom),_={};for(const x of t){const S=this._addTile(x);o[x.key]=x,S.hasData()||n<this._source.maxzoom&&(_[x.key]=x)}this._retainLoadedChildren(_,n,g,o);for(const x of t){let S=this._tiles[x.key];if(S.hasData())continue;if(n+1>this._source.maxzoom){const A=x.children(this._source.maxzoom)[0],L=this.getTile(A);if(L&&L.hasData()){o[A.key]=A;continue}}else{const A=x.children(this._source.maxzoom);if(o[A[0].key]&&o[A[1].key]&&o[A[2].key]&&o[A[3].key])continue}let I=S.wasRequested();for(let A=x.overscaledZ-1;A>=d;--A){const L=x.scaledTo(A);if(c[L.key])break;if(c[L.key]=!0,S=this.getTile(L),!S&&I&&(S=this._addTile(L)),S){const U=S.hasData();if((I||U)&&(o[L.key]=L),I=S.wasRequested(),U)break}}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const n=[];let o,c=this._tiles[t].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){o=this._loadedParentTiles[c.key];break}n.push(c.key);const d=c.scaledTo(c.overscaledZ-1);if(o=this._getLoadedTile(d),o)break;c=d}for(const d of n)this._loadedParentTiles[d]=o}}_addTile(t){let n=this._tiles[t.key];if(n)return n;n=this._cache.getAndRemove(t),n&&(this._setTileReloadTimer(t.key,n),n.tileID=t,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,n)));const o=n;return n||(n=new mr(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(n,this._tileLoaded.bind(this,n,t.key,n.state))),n.uses++,this._tiles[t.key]=n,o||this._source.fire(new a.k("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(t,n){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const o=n.getExpiryTimeout();o&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},o))}_removeTile(t){const n=this._tiles[t];n&&(n.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,n,o){const c=[],d=this.transform;if(!d)return c;const g=o?d.getCameraQueryGeometry(t):t,_=t.map(V=>d.pointCoordinate(V,this.terrain)),x=g.map(V=>d.pointCoordinate(V,this.terrain)),S=this.getIds();let I=1/0,A=1/0,L=-1/0,U=-1/0;for(const V of x)I=Math.min(I,V.x),A=Math.min(A,V.y),L=Math.max(L,V.x),U=Math.max(U,V.y);for(let V=0;V<S.length;V++){const Z=this._tiles[S[V]];if(Z.holdingForFade())continue;const $=Z.tileID,ie=Math.pow(2,d.zoom-Z.tileID.overscaledZ),ue=n*Z.queryPadding*a.N/Z.tileSize/ie,K=[$.getTilePoint(new a.U(I,A)),$.getTilePoint(new a.U(L,U))];if(K[0].x-ue<a.N&&K[0].y-ue<a.N&&K[1].x+ue>=0&&K[1].y+ue>=0){const re=_.map(fe=>$.getTilePoint(fe)),pe=x.map(fe=>$.getTilePoint(fe));c.push({tile:Z,tileID:$,queryGeometry:re,cameraQueryGeometry:pe,scale:ie})}}return c}getVisibleCoordinates(t){const n=this.getRenderableIds(t).map(o=>this._tiles[o].tileID);for(const o of n)o.posMatrix=this.transform.calculatePosMatrix(o.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(jt(this._source.type)){const t=a.h.now();for(const n in this._tiles)if(this._tiles[n].fadeEndTime>=t)return!0}return!1}setFeatureState(t,n,o){this._state.updateState(t=t||"_geojsonTileLayer",n,o)}removeFeatureState(t,n,o){this._state.removeFeatureState(t=t||"_geojsonTileLayer",n,o)}getFeatureState(t,n){return this._state.getState(t=t||"_geojsonTileLayer",n)}setDependencies(t,n,o){const c=this._tiles[t];c&&c.setDependencies(n,o)}reloadTilesForDependencies(t,n){for(const o in this._tiles)this._tiles[o].hasDependency(t,n)&&this._reloadTile(o,"reloading");this._cache.filter(o=>!o.hasDependency(t,n))}}function $i(u,t){const n=Math.abs(2*u.wrap)-+(u.wrap<0),o=Math.abs(2*t.wrap)-+(t.wrap<0);return u.overscaledZ-t.overscaledZ||o-n||t.canonical.y-u.canonical.y||t.canonical.x-u.canonical.x}function jt(u){return u==="raster"||u==="image"||u==="video"}Ii.maxOverzooming=10,Ii.maxUnderzooming=3;const kt="mapboxgl_preloaded_worker_pool";class Ui{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Ui.workerCount;)this.workers.push(new Worker(a.c.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[kt]}numActive(){return Object.keys(this.active).length}}const Ki=Math.floor(a.h.hardwareConcurrency/2);let sr;function Cn(){return sr||(sr=new Ui),sr}Ui.workerCount=a.ac(globalThis)?Math.max(Math.min(Ki,3),1):1;class Tn{constructor(t,n){this.reset(t,n)}reset(t,n){this.points=t||[],this._distances=[0];for(let o=1;o<this.points.length;o++)this._distances[o]=this._distances[o-1]+this.points[o].dist(this.points[o-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=a.ad(t,0,1);let n=1,o=this._distances[n];const c=t*this.paddedLength+this.padding;for(;o<c&&n<this._distances.length;)o=this._distances[++n];const d=n-1,g=this._distances[d],_=o-g,x=_>0?(c-g)/_:0;return this.points[d].mult(1-x).add(this.points[n].mult(x))}}function en(u,t){let n=!0;return u==="always"||u!=="never"&&t!=="never"||(n=!1),n}class In{constructor(t,n,o){const c=this.boxCells=[],d=this.circleCells=[];this.xCellCount=Math.ceil(t/o),this.yCellCount=Math.ceil(n/o);for(let g=0;g<this.xCellCount*this.yCellCount;g++)c.push([]),d.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=n,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,n,o,c,d){this._forEachCell(n,o,c,d,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(c),this.bboxes.push(d)}insertCircle(t,n,o,c){this._forEachCell(n-c,o-c,n+c,o+c,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(n),this.circles.push(o),this.circles.push(c)}_insertBoxCell(t,n,o,c,d,g){this.boxCells[d].push(g)}_insertCircleCell(t,n,o,c,d,g){this.circleCells[d].push(g)}_query(t,n,o,c,d,g,_){if(o<0||t>this.width||c<0||n>this.height)return[];const x=[];if(t<=0&&n<=0&&this.width<=o&&this.height<=c){if(d)return[{key:null,x1:t,y1:n,x2:o,y2:c}];for(let S=0;S<this.boxKeys.length;S++)x.push({key:this.boxKeys[S],x1:this.bboxes[4*S],y1:this.bboxes[4*S+1],x2:this.bboxes[4*S+2],y2:this.bboxes[4*S+3]});for(let S=0;S<this.circleKeys.length;S++){const I=this.circles[3*S],A=this.circles[3*S+1],L=this.circles[3*S+2];x.push({key:this.circleKeys[S],x1:I-L,y1:A-L,x2:I+L,y2:A+L})}}else this._forEachCell(t,n,o,c,this._queryCell,x,{hitTest:d,overlapMode:g,seenUids:{box:{},circle:{}}},_);return x}query(t,n,o,c){return this._query(t,n,o,c,!1,null)}hitTest(t,n,o,c,d,g){return this._query(t,n,o,c,!0,d,g).length>0}hitTestCircle(t,n,o,c,d){const g=t-o,_=t+o,x=n-o,S=n+o;if(_<0||g>this.width||S<0||x>this.height)return!1;const I=[];return this._forEachCell(g,x,_,S,this._queryCellCircle,I,{hitTest:!0,overlapMode:c,circle:{x:t,y:n,radius:o},seenUids:{box:{},circle:{}}},d),I.length>0}_queryCell(t,n,o,c,d,g,_,x){const{seenUids:S,hitTest:I,overlapMode:A}=_,L=this.boxCells[d];if(L!==null){const V=this.bboxes;for(const Z of L)if(!S.box[Z]){S.box[Z]=!0;const $=4*Z,ie=this.boxKeys[Z];if(t<=V[$+2]&&n<=V[$+3]&&o>=V[$+0]&&c>=V[$+1]&&(!x||x(ie))&&(!I||!en(A,ie.overlapMode))&&(g.push({key:ie,x1:V[$],y1:V[$+1],x2:V[$+2],y2:V[$+3]}),I))return!0}}const U=this.circleCells[d];if(U!==null){const V=this.circles;for(const Z of U)if(!S.circle[Z]){S.circle[Z]=!0;const $=3*Z,ie=this.circleKeys[Z];if(this._circleAndRectCollide(V[$],V[$+1],V[$+2],t,n,o,c)&&(!x||x(ie))&&(!I||!en(A,ie.overlapMode))){const ue=V[$],K=V[$+1],re=V[$+2];if(g.push({key:ie,x1:ue-re,y1:K-re,x2:ue+re,y2:K+re}),I)return!0}}}return!1}_queryCellCircle(t,n,o,c,d,g,_,x){const{circle:S,seenUids:I,overlapMode:A}=_,L=this.boxCells[d];if(L!==null){const V=this.bboxes;for(const Z of L)if(!I.box[Z]){I.box[Z]=!0;const $=4*Z,ie=this.boxKeys[Z];if(this._circleAndRectCollide(S.x,S.y,S.radius,V[$+0],V[$+1],V[$+2],V[$+3])&&(!x||x(ie))&&!en(A,ie.overlapMode))return g.push(!0),!0}}const U=this.circleCells[d];if(U!==null){const V=this.circles;for(const Z of U)if(!I.circle[Z]){I.circle[Z]=!0;const $=3*Z,ie=this.circleKeys[Z];if(this._circlesCollide(V[$],V[$+1],V[$+2],S.x,S.y,S.radius)&&(!x||x(ie))&&!en(A,ie.overlapMode))return g.push(!0),!0}}}_forEachCell(t,n,o,c,d,g,_,x){const S=this._convertToXCellCoord(t),I=this._convertToYCellCoord(n),A=this._convertToXCellCoord(o),L=this._convertToYCellCoord(c);for(let U=S;U<=A;U++)for(let V=I;V<=L;V++)if(d.call(this,t,n,o,c,this.xCellCount*V+U,g,_,x))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,n,o,c,d,g){const _=c-t,x=d-n,S=o+g;return S*S>_*_+x*x}_circleAndRectCollide(t,n,o,c,d,g,_){const x=(g-c)/2,S=Math.abs(t-(c+x));if(S>x+o)return!1;const I=(_-d)/2,A=Math.abs(n-(d+I));if(A>I+o)return!1;if(S<=x||A<=I)return!0;const L=S-x,U=A-I;return L*L+U*U<=o*o}}function ze(u,t,n,o,c){const d=a.Z();return t?(a.a0(d,d,[1/c,1/c,1]),n||a.ae(d,d,o.angle)):a.a1(d,o.labelPlaneMatrix,u),d}function mt(u,t,n,o,c){if(t){const d=a.af(u);return a.a0(d,d,[c,c,1]),n||a.ae(d,d,-o.angle),d}return o.glCoordMatrix}function dt(u,t,n){let o;n?(o=[u.x,u.y,n(u.x,u.y),1],a.ag(o,o,t)):(o=[u.x,u.y,0,1],G(o,o,t));const c=o[3];return{point:new a.P(o[0]/c,o[1]/c),signedDistanceFromCamera:c}}function Ut(u,t){return .5+u/t*.5}function wt(u,t){const n=u[0]/u[3],o=u[1]/u[3];return n>=-t[0]&&n<=t[0]&&o>=-t[1]&&o<=t[1]}function Te(u,t,n,o,c,d,g,_,x,S){const I=o?u.textSizeData:u.iconSizeData,A=a.ah(I,n.transform.zoom),L=[256/n.width*2+1,256/n.height*2+1],U=o?u.text.dynamicLayoutVertexArray:u.icon.dynamicLayoutVertexArray;U.clear();const V=u.lineVertexArray,Z=o?u.text.placedSymbolArray:u.icon.placedSymbolArray,$=n.transform.width/n.transform.height;let ie=!1;for(let ue=0;ue<Z.length;ue++){const K=Z.get(ue);if(K.hidden||K.writingMode===a.ai.vertical&&!ie){N(K.numGlyphs,U);continue}let re;if(ie=!1,S?(re=[K.anchorX,K.anchorY,S(K.anchorX,K.anchorY),1],a.ag(re,re,t)):(re=[K.anchorX,K.anchorY,0,1],G(re,re,t)),!wt(re,L)){N(K.numGlyphs,U);continue}const pe=Ut(n.transform.cameraToCenterDistance,re[3]),fe=a.aj(I,A,K),xe=g?fe/pe:fe*pe,Ee=new a.P(K.anchorX,K.anchorY),Ce=dt(Ee,c,S).point,Me={projections:{},offsets:{}},Ke=_i(K,xe,!1,_,t,c,d,u.glyphOffsetArray,V,U,Ce,Ee,Me,$,x,S);ie=Ke.useVertical,(Ke.notEnoughRoom||ie||Ke.needsFlipping&&_i(K,xe,!0,_,t,c,d,u.glyphOffsetArray,V,U,Ce,Ee,Me,$,x,S).notEnoughRoom)&&N(K.numGlyphs,U)}o?u.text.dynamicLayoutVertexBuffer.updateData(U):u.icon.dynamicLayoutVertexBuffer.updateData(U)}function ot(u,t,n,o,c,d,g,_,x,S,I,A,L){const U=_.glyphStartIndex+_.numGlyphs,V=_.lineStartIndex,Z=_.lineStartIndex+_.lineLength,$=t.getoffsetX(_.glyphStartIndex),ie=t.getoffsetX(U-1),ue=M(u*$,n,o,c,d,g,_.segment,V,Z,x,S,I,A,L);if(!ue)return null;const K=M(u*ie,n,o,c,d,g,_.segment,V,Z,x,S,I,A,L);return K?{first:ue,last:K}:null}function ct(u,t,n,o){return u===a.ai.horizontal&&Math.abs(n.y-t.y)>Math.abs(n.x-t.x)*o?{useVertical:!0}:(u===a.ai.vertical?t.y<n.y:t.x>n.x)?{needsFlipping:!0}:null}function _i(u,t,n,o,c,d,g,_,x,S,I,A,L,U,V,Z){const $=t/24,ie=u.lineOffsetX*$,ue=u.lineOffsetY*$;let K;if(u.numGlyphs>1){const re=u.glyphStartIndex+u.numGlyphs,pe=u.lineStartIndex,fe=u.lineStartIndex+u.lineLength,xe=ot($,_,ie,ue,n,I,A,u,x,d,L,V,Z);if(!xe)return{notEnoughRoom:!0};const Ee=dt(xe.first.point,g,Z).point,Ce=dt(xe.last.point,g,Z).point;if(o&&!n){const Me=ct(u.writingMode,Ee,Ce,U);if(Me)return Me}K=[xe.first];for(let Me=u.glyphStartIndex+1;Me<re-1;Me++)K.push(M($*_.getoffsetX(Me),ie,ue,n,I,A,u.segment,pe,fe,x,d,L,V,Z));K.push(xe.last)}else{if(o&&!n){const pe=dt(A,c,Z).point,fe=u.lineStartIndex+u.segment+1,xe=new a.P(x.getx(fe),x.gety(fe)),Ee=dt(xe,c,Z),Ce=Ee.signedDistanceFromCamera>0?Ee.point:ji(A,xe,pe,1,c,Z),Me=ct(u.writingMode,pe,Ce,U);if(Me)return Me}const re=M($*_.getoffsetX(u.glyphStartIndex),ie,ue,n,I,A,u.segment,u.lineStartIndex,u.lineStartIndex+u.lineLength,x,d,L,V,Z);if(!re)return{notEnoughRoom:!0};K=[re]}for(const re of K)a.ak(S,re.point,re.angle);return{}}function ji(u,t,n,o,c,d){const g=dt(u.add(u.sub(t)._unit()),c,d).point,_=n.sub(g);return n.add(_._mult(o/_.mag()))}function vt(u,t){const{projectionCache:n,lineVertexArray:o,labelPlaneMatrix:c,tileAnchorPoint:d,distanceFromAnchor:g,getElevation:_,previousVertex:x,direction:S,absOffsetX:I}=t;if(n.projections[u])return n.projections[u];const A=new a.P(o.getx(u),o.gety(u)),L=dt(A,c,_);if(L.signedDistanceFromCamera>0)return n.projections[u]=L.point,L.point;const U=u-S;return ji(g===0?d:new a.P(o.getx(U),o.gety(U)),A,x,I-g+1,c,_)}function hn(u,t,n){return u._unit()._perp()._mult(t*n)}function q(u,t,n,o,c,d,g,_){const{projectionCache:x,direction:S}=_;if(x.offsets[u])return x.offsets[u];const I=n.add(t);if(u+S<o||u+S>=c)return x.offsets[u]=I,I;const A=vt(u+S,_),L=hn(A.sub(n),g,S),U=n.add(L),V=A.add(L);return x.offsets[u]=a.al(d,I,U,V)||I,x.offsets[u]}function M(u,t,n,o,c,d,g,_,x,S,I,A,L,U){const V=o?u-t:u+t;let Z=V>0?1:-1,$=0;o&&(Z*=-1,$=Math.PI),Z<0&&($+=Math.PI);let ie,ue,K=Z>0?_+g:_+g+1,re=c,pe=c,fe=0,xe=0;const Ee=Math.abs(V),Ce=[];let Me;for(;fe+xe<=Ee;){if(K+=Z,K<_||K>=x)return null;fe+=xe,pe=re,ue=ie;const Be={projectionCache:A,lineVertexArray:S,labelPlaneMatrix:I,tileAnchorPoint:d,distanceFromAnchor:fe,getElevation:U,previousVertex:pe,direction:Z,absOffsetX:Ee};if(re=vt(K,Be),n===0)Ce.push(pe),Me=re.sub(pe);else{let ht;const Ye=re.sub(pe);ht=Ye.mag()===0?hn(vt(K+Z,Be).sub(re),n,Z):hn(Ye,n,Z),ue||(ue=pe.add(ht)),ie=q(K,ht,re,_,x,ue,n,Be),Ce.push(ue),Me=ie.sub(ue)}xe=Me.mag()}const Ke=Me._mult((Ee-fe)/xe)._add(ue||pe),Tt=$+Math.atan2(re.y-pe.y,re.x-pe.x);return Ce.push(Ke),{point:Ke,angle:L?Tt:0,path:Ce}}const D=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function N(u,t){for(let n=0;n<u;n++){const o=t.length;t.resize(o+4),t.float32.set(D,3*o)}}function G(u,t,n){const o=t[0],c=t[1];return u[0]=n[0]*o+n[4]*c+n[12],u[1]=n[1]*o+n[5]*c+n[13],u[3]=n[3]*o+n[7]*c+n[15],u}const X=100;class le{constructor(t,n=new In(t.width+200,t.height+200,25),o=new In(t.width+200,t.height+200,25)){this.transform=t,this.grid=n,this.ignoredGrid=o,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+X,this.screenBottomBoundary=t.height+X,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,n,o,c,d,g){const _=this.projectAndGetPerspectiveRatio(c,t.anchorPointX,t.anchorPointY,g),x=o*_.perspectiveRatio,S=t.x1*x+_.point.x,I=t.y1*x+_.point.y,A=t.x2*x+_.point.x,L=t.y2*x+_.point.y;return!this.isInsideGrid(S,I,A,L)||n!=="always"&&this.grid.hitTest(S,I,A,L,n,d)||_.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[S,I,A,L],offscreen:this.isOffscreen(S,I,A,L)}}placeCollisionCircles(t,n,o,c,d,g,_,x,S,I,A,L,U,V){const Z=[],$=new a.P(n.anchorX,n.anchorY),ie=dt($,g,V),ue=Ut(this.transform.cameraToCenterDistance,ie.signedDistanceFromCamera),K=(I?d/ue:d*ue)/a.ap,re=dt($,_,V).point,pe=ot(K,c,n.lineOffsetX*K,n.lineOffsetY*K,!1,re,$,n,o,_,{projections:{},offsets:{}},!1,V);let fe=!1,xe=!1,Ee=!0;if(pe){const Ce=.5*L*ue+U,Me=new a.P(-100,-100),Ke=new a.P(this.screenRightBoundary,this.screenBottomBoundary),Tt=new Tn,Be=pe.first,ht=pe.last;let Ye=[];for(let bt=Be.path.length-1;bt>=1;bt--)Ye.push(Be.path[bt]);for(let bt=1;bt<ht.path.length;bt++)Ye.push(ht.path[bt]);const Zt=2.5*Ce;if(x){const bt=Ye.map(It=>dt(It,x,V));Ye=bt.some(It=>It.signedDistanceFromCamera<=0)?[]:bt.map(It=>It.point)}let Ct=[];if(Ye.length>0){const bt=Ye[0].clone(),It=Ye[0].clone();for(let yi=1;yi<Ye.length;yi++)bt.x=Math.min(bt.x,Ye[yi].x),bt.y=Math.min(bt.y,Ye[yi].y),It.x=Math.max(It.x,Ye[yi].x),It.y=Math.max(It.y,Ye[yi].y);Ct=bt.x>=Me.x&&It.x<=Ke.x&&bt.y>=Me.y&&It.y<=Ke.y?[Ye]:It.x<Me.x||bt.x>Ke.x||It.y<Me.y||bt.y>Ke.y?[]:a.am([Ye],Me.x,Me.y,Ke.x,Ke.y)}for(const bt of Ct){Tt.reset(bt,.25*Ce);let It=0;It=Tt.length<=.5*Ce?1:Math.ceil(Tt.paddedLength/Zt)+1;for(let yi=0;yi<It;yi++){const ei=yi/Math.max(It-1,1),Gi=Tt.lerp(ei),zi=Gi.x+X,Si=Gi.y+X;Z.push(zi,Si,Ce,0);const Mr=zi-Ce,ii=Si-Ce,rn=zi+Ce,nn=Si+Ce;if(Ee=Ee&&this.isOffscreen(Mr,ii,rn,nn),xe=xe||this.isInsideGrid(Mr,ii,rn,nn),t!=="always"&&this.grid.hitTestCircle(zi,Si,Ce,t,A)&&(fe=!0,!S))return{circles:[],offscreen:!1,collisionDetected:fe}}}}return{circles:!S&&fe||!xe||ue<this.perspectiveRatioCutoff?[]:Z,offscreen:Ee,collisionDetected:fe}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const n=[];let o=1/0,c=1/0,d=-1/0,g=-1/0;for(const I of t){const A=new a.P(I.x+X,I.y+X);o=Math.min(o,A.x),c=Math.min(c,A.y),d=Math.max(d,A.x),g=Math.max(g,A.y),n.push(A)}const _=this.grid.query(o,c,d,g).concat(this.ignoredGrid.query(o,c,d,g)),x={},S={};for(const I of _){const A=I.key;if(x[A.bucketInstanceId]===void 0&&(x[A.bucketInstanceId]={}),x[A.bucketInstanceId][A.featureIndex])continue;const L=[new a.P(I.x1,I.y1),new a.P(I.x2,I.y1),new a.P(I.x2,I.y2),new a.P(I.x1,I.y2)];a.an(n,L)&&(x[A.bucketInstanceId][A.featureIndex]=!0,S[A.bucketInstanceId]===void 0&&(S[A.bucketInstanceId]=[]),S[A.bucketInstanceId].push(A.featureIndex))}return S}insertCollisionBox(t,n,o,c,d,g){(o?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:d,collisionGroupID:g,overlapMode:n},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,n,o,c,d,g){const _=o?this.ignoredGrid:this.grid,x={bucketInstanceId:c,featureIndex:d,collisionGroupID:g,overlapMode:n};for(let S=0;S<t.length;S+=4)_.insertCircle(x,t[S],t[S+1],t[S+2])}projectAndGetPerspectiveRatio(t,n,o,c){let d;return c?(d=[n,o,c(n,o),1],a.ag(d,d,t)):(d=[n,o,0,1],G(d,d,t)),{point:new a.P((d[0]/d[3]+1)/2*this.transform.width+X,(-d[1]/d[3]+1)/2*this.transform.height+X),perspectiveRatio:.5+this.transform.cameraToCenterDistance/d[3]*.5}}isOffscreen(t,n,o,c){return o<X||t>=this.screenRightBoundary||c<X||n>this.screenBottomBoundary}isInsideGrid(t,n,o,c){return o>=0&&t<this.gridRightBoundary&&c>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const t=a.ao([]);return a.$(t,t,[-100,-100,0]),t}}function te(u,t,n){return t*(a.N/(u.tileSize*Math.pow(2,n-u.tileID.overscaledZ)))}class Y{constructor(t,n,o,c){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?n:-n))):c&&o?1:0,this.placed=o}isHidden(){return this.opacity===0&&!this.placed}}class ne{constructor(t,n,o,c,d){this.text=new Y(t?t.text:null,n,o,d),this.icon=new Y(t?t.icon:null,n,c,d)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ge{constructor(t,n,o){this.text=t,this.icon=n,this.skipFade=o}}class ve{constructor(){this.invProjMatrix=a.Z(),this.viewportMatrix=a.Z(),this.circles=[]}}class Se{constructor(t,n,o,c,d){this.bucketInstanceId=t,this.featureIndex=n,this.sourceLayerIndex=o,this.bucketIndex=c,this.tileID=d}}class nt{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const n=++this.maxGroupID;this.collisionGroups[t]={ID:n,predicate:o=>o.collisionGroupID===n}}return this.collisionGroups[t]}}function pt(u,t,n,o,c){const{horizontalAlign:d,verticalAlign:g}=a.au(u);return new a.P(-(d-.5)*t+o[0]*c,-(g-.5)*n+o[1]*c)}function Xe(u,t,n,o,c,d){const{x1:g,x2:_,y1:x,y2:S,anchorPointX:I,anchorPointY:A}=u,L=new a.P(t,n);return o&&L._rotate(c?d:-d),{x1:g+L.x,y1:x+L.y,x2:_+L.x,y2:S+L.y,anchorPointX:I,anchorPointY:A}}class lt{constructor(t,n,o,c,d){this.transform=t.clone(),this.terrain=n,this.collisionIndex=new le(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=o,this.retainedQueryData={},this.collisionGroups=new nt(c),this.collisionCircleArrays={},this.prevPlacement=d,d&&(d.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,n,o,c){const d=o.getBucket(n),g=o.latestFeatureIndex;if(!d||!g||n.id!==d.layerIds[0])return;const _=o.collisionBoxArray,x=d.layers[0].layout,S=Math.pow(2,this.transform.zoom-o.tileID.overscaledZ),I=o.tileSize/a.N,A=this.transform.calculatePosMatrix(o.tileID.toUnwrapped()),L=x.get("text-pitch-alignment")==="map",U=x.get("text-rotation-alignment")==="map",V=te(o,1,this.transform.zoom),Z=ze(A,L,U,this.transform,V);let $=null;if(L){const ue=mt(A,L,U,this.transform,V);$=a.a1([],this.transform.labelPlaneMatrix,ue)}this.retainedQueryData[d.bucketInstanceId]=new Se(d.bucketInstanceId,g,d.sourceLayerIndex,d.index,o.tileID);const ie={bucket:d,layout:x,posMatrix:A,textLabelPlaneMatrix:Z,labelToScreenMatrix:$,scale:S,textPixelRatio:I,holdingForFade:o.holdingForFade(),collisionBoxArray:_,partiallyEvaluatedTextSize:a.ah(d.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(d.sourceID)};if(c)for(const ue of d.sortKeyRanges){const{sortKey:K,symbolInstanceStart:re,symbolInstanceEnd:pe}=ue;t.push({sortKey:K,symbolInstanceStart:re,symbolInstanceEnd:pe,parameters:ie})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:d.symbolInstances.length,parameters:ie})}attemptAnchorPlacement(t,n,o,c,d,g,_,x,S,I,A,L,U,V,Z,$){const ie=a.aq[t.textAnchor],ue=[t.textOffset0,t.textOffset1],K=pt(ie,o,c,ue,d),re=this.collisionIndex.placeCollisionBox(Xe(n,K.x,K.y,g,_,this.transform.angle),A,x,S,I.predicate,$);if((!Z||this.collisionIndex.placeCollisionBox(Xe(Z,K.x,K.y,g,_,this.transform.angle),A,x,S,I.predicate,$).box.length!==0)&&re.box.length>0){let pe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[L.crossTileID]&&this.prevPlacement.placements[L.crossTileID]&&this.prevPlacement.placements[L.crossTileID].text&&(pe=this.prevPlacement.variableOffsets[L.crossTileID].anchor),L.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[L.crossTileID]={textOffset:ue,width:o,height:c,anchor:ie,textBoxScale:d,prevAnchor:pe},this.markUsedJustification(U,ie,L,V),U.allowVerticalPlacement&&(this.markUsedOrientation(U,V,L),this.placedOrientations[L.crossTileID]=V),{shift:K,placedGlyphBoxes:re}}}placeLayerBucketPart(t,n,o){const{bucket:c,layout:d,posMatrix:g,textLabelPlaneMatrix:_,labelToScreenMatrix:x,textPixelRatio:S,holdingForFade:I,collisionBoxArray:A,partiallyEvaluatedTextSize:L,collisionGroup:U}=t.parameters,V=d.get("text-optional"),Z=d.get("icon-optional"),$=a.ar(d,"text-overlap","text-allow-overlap"),ie=$==="always",ue=a.ar(d,"icon-overlap","icon-allow-overlap"),K=ue==="always",re=d.get("text-rotation-alignment")==="map",pe=d.get("text-pitch-alignment")==="map",fe=d.get("icon-text-fit")!=="none",xe=d.get("symbol-z-order")==="viewport-y",Ee=ie&&(K||!c.hasIconData()||Z),Ce=K&&(ie||!c.hasTextData()||V);!c.collisionArrays&&A&&c.deserializeCollisionBoxes(A);const Me=this.retainedQueryData[c.bucketInstanceId].tileID,Ke=this.terrain?(Be,ht)=>this.terrain.getElevation(Me,Be,ht):null,Tt=(Be,ht)=>{var Ye,Zt;if(n[Be.crossTileID])return;if(I)return void(this.placements[Be.crossTileID]=new ge(!1,!1,!1));let Ct=!1,bt=!1,It=!0,yi=null,ei={box:null,offscreen:null},Gi={box:null,offscreen:null},zi=null,Si=null,Mr=null,ii=0,rn=0,nn=0;ht.textFeatureIndex?ii=ht.textFeatureIndex:Be.useRuntimeCollisionCircles&&(ii=Be.featureIndex),ht.verticalTextFeatureIndex&&(rn=ht.verticalTextFeatureIndex);const Dn=ht.textBox;if(Dn){const Qi=vi=>{let Di=a.ai.horizontal;if(c.allowVerticalPlacement&&!vi&&this.prevPlacement){const yr=this.prevPlacement.placedOrientations[Be.crossTileID];yr&&(this.placedOrientations[Be.crossTileID]=yr,Di=yr,this.markUsedOrientation(c,Di,Be))}return Di},Hi=(vi,Di)=>{if(c.allowVerticalPlacement&&Be.numVerticalGlyphVertices>0&&ht.verticalTextBox){for(const yr of c.writingModes)if(yr===a.ai.vertical?(ei=Di(),Gi=ei):ei=vi(),ei&&ei.box&&ei.box.length)break}else ei=vi()},or=Be.textAnchorOffsetStartIndex,Hn=Be.textAnchorOffsetEndIndex;if(Hn===or){const vi=(Di,yr)=>{const xi=this.collisionIndex.placeCollisionBox(Di,$,S,g,U.predicate,Ke);return xi&&xi.box&&xi.box.length&&(this.markUsedOrientation(c,yr,Be),this.placedOrientations[Be.crossTileID]=yr),xi};Hi(()=>vi(Dn,a.ai.horizontal),()=>{const Di=ht.verticalTextBox;return c.allowVerticalPlacement&&Be.numVerticalGlyphVertices>0&&Di?vi(Di,a.ai.vertical):{box:null,offscreen:null}}),Qi(ei&&ei.box&&ei.box.length)}else{let vi=a.aq[(Zt=(Ye=this.prevPlacement)===null||Ye===void 0?void 0:Ye.variableOffsets[Be.crossTileID])===null||Zt===void 0?void 0:Zt.anchor];const Di=(xi,Wn,Ta)=>{const Vl=xi.x2-xi.x1,Ul=xi.y2-xi.y1,Zc=Be.textBoxScale,Mo=fe&&ue==="never"?Wn:null;let sn={box:[],offscreen:!1},Xn=$==="never"?1:2,an="never";vi&&Xn++;for(let Vr=0;Vr<Xn;Vr++){for(let on=or;on<Hn;on++){const ko=c.textAnchorOffsets.get(on);if(vi&&ko.textAnchor!==vi)continue;const _n=this.attemptAnchorPlacement(ko,xi,Vl,Ul,Zc,re,pe,S,g,U,an,Be,c,Ta,Mo,Ke);if(_n&&(sn=_n.placedGlyphBoxes,sn&&sn.box&&sn.box.length))return Ct=!0,yi=_n.shift,sn}vi?vi=null:an=$}return sn};Hi(()=>Di(Dn,ht.iconBox,a.ai.horizontal),()=>{const xi=ht.verticalTextBox;return c.allowVerticalPlacement&&!(ei&&ei.box&&ei.box.length)&&Be.numVerticalGlyphVertices>0&&xi?Di(xi,ht.verticalIconBox,a.ai.vertical):{box:null,offscreen:null}}),ei&&(Ct=ei.box,It=ei.offscreen);const yr=Qi(ei&&ei.box);if(!Ct&&this.prevPlacement){const xi=this.prevPlacement.variableOffsets[Be.crossTileID];xi&&(this.variableOffsets[Be.crossTileID]=xi,this.markUsedJustification(c,xi.anchor,Be,yr))}}}if(zi=ei,Ct=zi&&zi.box&&zi.box.length>0,It=zi&&zi.offscreen,Be.useRuntimeCollisionCircles){const Qi=c.text.placedSymbolArray.get(Be.centerJustifiedTextSymbolIndex),Hi=a.aj(c.textSizeData,L,Qi),or=d.get("text-padding");Si=this.collisionIndex.placeCollisionCircles($,Qi,c.lineVertexArray,c.glyphOffsetArray,Hi,g,_,x,o,pe,U.predicate,Be.collisionCircleDiameter,or,Ke),Si.circles.length&&Si.collisionDetected&&!o&&a.w("Collisions detected, but collision boxes are not shown"),Ct=ie||Si.circles.length>0&&!Si.collisionDetected,It=It&&Si.offscreen}if(ht.iconFeatureIndex&&(nn=ht.iconFeatureIndex),ht.iconBox){const Qi=Hi=>{const or=fe&&yi?Xe(Hi,yi.x,yi.y,re,pe,this.transform.angle):Hi;return this.collisionIndex.placeCollisionBox(or,ue,S,g,U.predicate,Ke)};Gi&&Gi.box&&Gi.box.length&&ht.verticalIconBox?(Mr=Qi(ht.verticalIconBox),bt=Mr.box.length>0):(Mr=Qi(ht.iconBox),bt=Mr.box.length>0),It=It&&Mr.offscreen}const Gn=V||Be.numHorizontalGlyphVertices===0&&Be.numVerticalGlyphVertices===0,fs=Z||Be.numIconVertices===0;if(Gn||fs?fs?Gn||(bt=bt&&Ct):Ct=bt&&Ct:bt=Ct=bt&&Ct,Ct&&zi&&zi.box&&this.collisionIndex.insertCollisionBox(zi.box,$,d.get("text-ignore-placement"),c.bucketInstanceId,Gi&&Gi.box&&rn?rn:ii,U.ID),bt&&Mr&&this.collisionIndex.insertCollisionBox(Mr.box,ue,d.get("icon-ignore-placement"),c.bucketInstanceId,nn,U.ID),Si&&(Ct&&this.collisionIndex.insertCollisionCircles(Si.circles,$,d.get("text-ignore-placement"),c.bucketInstanceId,ii,U.ID),o)){const Qi=c.bucketInstanceId;let Hi=this.collisionCircleArrays[Qi];Hi===void 0&&(Hi=this.collisionCircleArrays[Qi]=new ve);for(let or=0;or<Si.circles.length;or+=4)Hi.circles.push(Si.circles[or+0]),Hi.circles.push(Si.circles[or+1]),Hi.circles.push(Si.circles[or+2]),Hi.circles.push(Si.collisionDetected?1:0)}if(Be.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(c.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Be.crossTileID]=new ge(Ct||Ee,bt||Ce,It||c.justReloaded),n[Be.crossTileID]=!0};if(xe){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Be=c.getSortedSymbolIndexes(this.transform.angle);for(let ht=Be.length-1;ht>=0;--ht){const Ye=Be[ht];Tt(c.symbolInstances.get(Ye),c.collisionArrays[Ye])}}else for(let Be=t.symbolInstanceStart;Be<t.symbolInstanceEnd;Be++)Tt(c.symbolInstances.get(Be),c.collisionArrays[Be]);if(o&&c.bucketInstanceId in this.collisionCircleArrays){const Be=this.collisionCircleArrays[c.bucketInstanceId];a.as(Be.invProjMatrix,g),Be.viewportMatrix=this.collisionIndex.getViewportMatrix()}c.justReloaded=!1}markUsedJustification(t,n,o,c){let d;d=c===a.ai.vertical?o.verticalPlacedTextSymbolIndex:{left:o.leftJustifiedTextSymbolIndex,center:o.centerJustifiedTextSymbolIndex,right:o.rightJustifiedTextSymbolIndex}[a.at(n)];const g=[o.leftJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.rightJustifiedTextSymbolIndex,o.verticalPlacedTextSymbolIndex];for(const _ of g)_>=0&&(t.text.placedSymbolArray.get(_).crossTileID=d>=0&&_!==d?0:o.crossTileID)}markUsedOrientation(t,n,o){const c=n===a.ai.horizontal||n===a.ai.horizontalOnly?n:0,d=n===a.ai.vertical?n:0,g=[o.leftJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.rightJustifiedTextSymbolIndex];for(const _ of g)t.text.placedSymbolArray.get(_).placedOrientation=c;o.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(o.verticalPlacedTextSymbolIndex).placedOrientation=d)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let o=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const c=n?n.symbolFadeChange(t):1,d=n?n.opacities:{},g=n?n.variableOffsets:{},_=n?n.placedOrientations:{};for(const x in this.placements){const S=this.placements[x],I=d[x];I?(this.opacities[x]=new ne(I,c,S.text,S.icon),o=o||S.text!==I.text.placed||S.icon!==I.icon.placed):(this.opacities[x]=new ne(null,c,S.text,S.icon,S.skipFade),o=o||S.text||S.icon)}for(const x in d){const S=d[x];if(!this.opacities[x]){const I=new ne(S,c,!1,!1);I.isHidden()||(this.opacities[x]=I,o=o||S.text.placed||S.icon.placed)}}for(const x in g)this.variableOffsets[x]||!this.opacities[x]||this.opacities[x].isHidden()||(this.variableOffsets[x]=g[x]);for(const x in _)this.placedOrientations[x]||!this.opacities[x]||this.opacities[x].isHidden()||(this.placedOrientations[x]=_[x]);if(n&&n.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");o?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:t)}updateLayerOpacities(t,n){const o={};for(const c of n){const d=c.getBucket(t);d&&c.latestFeatureIndex&&t.id===d.layerIds[0]&&this.updateBucketOpacities(d,o,c.collisionBoxArray)}}updateBucketOpacities(t,n,o){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const c=t.layers[0],d=c.layout,g=new ne(null,0,!1,!1,!0),_=d.get("text-allow-overlap"),x=d.get("icon-allow-overlap"),S=c._unevaluatedLayout.hasValue("text-variable-anchor")||c._unevaluatedLayout.hasValue("text-variable-anchor-offset"),I=d.get("text-rotation-alignment")==="map",A=d.get("text-pitch-alignment")==="map",L=d.get("icon-text-fit")!=="none",U=new ne(null,0,_&&(x||!t.hasIconData()||d.get("icon-optional")),x&&(_||!t.hasTextData()||d.get("text-optional")),!0);!t.collisionArrays&&o&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(o);const V=(Z,$,ie)=>{for(let ue=0;ue<$/4;ue++)Z.opacityVertexArray.emplaceBack(ie);Z.hasVisibleVertices=Z.hasVisibleVertices||ie!==Fr};for(let Z=0;Z<t.symbolInstances.length;Z++){const $=t.symbolInstances.get(Z),{numHorizontalGlyphVertices:ie,numVerticalGlyphVertices:ue,crossTileID:K}=$;let re=this.opacities[K];n[K]?re=g:re||(re=U,this.opacities[K]=re),n[K]=!0;const pe=$.numIconVertices>0,fe=this.placedOrientations[$.crossTileID],xe=fe===a.ai.vertical,Ee=fe===a.ai.horizontal||fe===a.ai.horizontalOnly;if(ie>0||ue>0){const Ce=qi(re.text);V(t.text,ie,xe?Fr:Ce),V(t.text,ue,Ee?Fr:Ce);const Me=re.text.isHidden();[$.rightJustifiedTextSymbolIndex,$.centerJustifiedTextSymbolIndex,$.leftJustifiedTextSymbolIndex].forEach(Be=>{Be>=0&&(t.text.placedSymbolArray.get(Be).hidden=Me||xe?1:0)}),$.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get($.verticalPlacedTextSymbolIndex).hidden=Me||Ee?1:0);const Ke=this.variableOffsets[$.crossTileID];Ke&&this.markUsedJustification(t,Ke.anchor,$,fe);const Tt=this.placedOrientations[$.crossTileID];Tt&&(this.markUsedJustification(t,"left",$,Tt),this.markUsedOrientation(t,Tt,$))}if(pe){const Ce=qi(re.icon),Me=!(L&&$.verticalPlacedIconSymbolIndex&&xe);$.placedIconSymbolIndex>=0&&(V(t.icon,$.numIconVertices,Me?Ce:Fr),t.icon.placedSymbolArray.get($.placedIconSymbolIndex).hidden=re.icon.isHidden()),$.verticalPlacedIconSymbolIndex>=0&&(V(t.icon,$.numVerticalIconVertices,Me?Fr:Ce),t.icon.placedSymbolArray.get($.verticalPlacedIconSymbolIndex).hidden=re.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Ce=t.collisionArrays[Z];if(Ce){let Me=new a.P(0,0);if(Ce.textBox||Ce.verticalTextBox){let Tt=!0;if(S){const Be=this.variableOffsets[K];Be?(Me=pt(Be.anchor,Be.width,Be.height,Be.textOffset,Be.textBoxScale),I&&Me._rotate(A?this.transform.angle:-this.transform.angle)):Tt=!1}Ce.textBox&&_t(t.textCollisionBox.collisionVertexArray,re.text.placed,!Tt||xe,Me.x,Me.y),Ce.verticalTextBox&&_t(t.textCollisionBox.collisionVertexArray,re.text.placed,!Tt||Ee,Me.x,Me.y)}const Ke=!!(!Ee&&Ce.verticalIconBox);Ce.iconBox&&_t(t.iconCollisionBox.collisionVertexArray,re.icon.placed,Ke,L?Me.x:0,L?Me.y:0),Ce.verticalIconBox&&_t(t.iconCollisionBox.collisionVertexArray,re.icon.placed,!Ke,L?Me.x:0,L?Me.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const Z=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=Z.invProjMatrix,t.placementViewportMatrix=Z.viewportMatrix,t.collisionCircleArray=Z.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,n){const o=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*o>t}setStale(){this.stale=!0}}function _t(u,t,n,o,c){u.emplaceBack(t?1:0,n?1:0,o||0,c||0),u.emplaceBack(t?1:0,n?1:0,o||0,c||0),u.emplaceBack(t?1:0,n?1:0,o||0,c||0),u.emplaceBack(t?1:0,n?1:0,o||0,c||0)}const Vt=Math.pow(2,25),Gt=Math.pow(2,24),Ft=Math.pow(2,17),Lt=Math.pow(2,16),Ji=Math.pow(2,9),Qt=Math.pow(2,8),Ei=Math.pow(2,1);function qi(u){if(u.opacity===0&&!u.placed)return 0;if(u.opacity===1&&u.placed)return 4294967295;const t=u.placed?1:0,n=Math.floor(127*u.opacity);return n*Vt+t*Gt+n*Ft+t*Lt+n*Ji+t*Qt+n*Ei+t}const Fr=0;class nl{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,n,o,c,d){const g=this._bucketParts;for(;this._currentTileIndex<t.length;)if(n.getBucketParts(g,c,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,d())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,g.sort((_,x)=>_.sortKey-x.sortKey));this._currentPartIndex<g.length;)if(n.placeLayerBucketPart(g[this._currentPartIndex],this._seenCrossTileIDs,o),this._currentPartIndex++,d())return!0;return!1}}class ts{constructor(t,n,o,c,d,g,_,x){this.placement=new lt(t,n,g,_,x),this._currentPlacementIndex=o.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=d,this._done=!1}isDone(){return this._done}continuePlacement(t,n,o){const c=a.h.now(),d=()=>!this._forceFullPlacement&&a.h.now()-c>2;for(;this._currentPlacementIndex>=0;){const g=n[t[this._currentPlacementIndex]],_=this.placement.collisionIndex.transform.zoom;if(g.type==="symbol"&&(!g.minzoom||g.minzoom<=_)&&(!g.maxzoom||g.maxzoom>_)){if(this._inProgressLayer||(this._inProgressLayer=new nl(g)),this._inProgressLayer.continuePlacement(o[g.source],this.placement,this._showCollisionBoxes,g,d))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const is=512/a.N/2;class Ac{constructor(t,n,o){this.tileID=t,this.bucketInstanceId=o,this._symbolsByKey={};const c=new Map;for(let d=0;d<n.length;d++){const g=n.get(d),_=g.key,x=c.get(_);x?x.push(g):c.set(_,[g])}for(const[d,g]of c){const _={positions:g.map(x=>({x:Math.floor(x.anchorX*is),y:Math.floor(x.anchorY*is)})),crossTileIDs:g.map(x=>x.crossTileID)};if(_.positions.length>128){const x=new a.av(_.positions.length,16,Uint16Array);for(const{x:S,y:I}of _.positions)x.add(S,I);x.finish(),delete _.positions,_.index=x}this._symbolsByKey[d]=_}}getScaledCoordinates(t,n){const{x:o,y:c,z:d}=this.tileID.canonical,{x:g,y:_,z:x}=n.canonical,S=is/Math.pow(2,x-d),I=(_*a.N+t.anchorY)*S,A=c*a.N*is;return{x:Math.floor((g*a.N+t.anchorX)*S-o*a.N*is),y:Math.floor(I-A)}}findMatches(t,n,o){const c=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z);for(let d=0;d<t.length;d++){const g=t.get(d);if(g.crossTileID)continue;const _=this._symbolsByKey[g.key];if(!_)continue;const x=this.getScaledCoordinates(g,n);if(_.index){const S=_.index.range(x.x-c,x.y-c,x.x+c,x.y+c).sort();for(const I of S){const A=_.crossTileIDs[I];if(!o[A]){o[A]=!0,g.crossTileID=A;break}}}else if(_.positions)for(let S=0;S<_.positions.length;S++){const I=_.positions[S],A=_.crossTileIDs[S];if(Math.abs(I.x-x.x)<=c&&Math.abs(I.y-x.y)<=c&&!o[A]){o[A]=!0,g.crossTileID=A;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class qt{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Va{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const n=Math.round((t-this.lng)/360);if(n!==0)for(const o in this.indexes){const c=this.indexes[o],d={};for(const g in c){const _=c[g];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+n),d[_.tileID.key]=_}this.indexes[o]=d}this.lng=t}addBucket(t,n,o){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let d=0;d<n.symbolInstances.length;d++)n.symbolInstances.get(d).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const c=this.usedCrossTileIDs[t.overscaledZ];for(const d in this.indexes){const g=this.indexes[d];if(Number(d)>t.overscaledZ)for(const _ in g){const x=g[_];x.tileID.isChildOf(t)&&x.findMatches(n.symbolInstances,t,c)}else{const _=g[t.scaledTo(Number(d)).key];_&&_.findMatches(n.symbolInstances,t,c)}}for(let d=0;d<n.symbolInstances.length;d++){const g=n.symbolInstances.get(d);g.crossTileID||(g.crossTileID=o.generate(),c[g.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Ac(t,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(t,n){for(const o of n.getCrossTileIDsLists())for(const c of o)delete this.usedCrossTileIDs[t][c]}removeStaleBuckets(t){let n=!1;for(const o in this.indexes){const c=this.indexes[o];for(const d in c)t[c[d].bucketInstanceId]||(this.removeBucketCrossTileIDs(o,c[d]),delete c[d],n=!0)}return n}}class Js{constructor(){this.layerIndexes={},this.crossTileIDs=new qt,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,n,o){let c=this.layerIndexes[t.id];c===void 0&&(c=this.layerIndexes[t.id]=new Va);let d=!1;const g={};c.handleWrapJump(o);for(const _ of n){const x=_.getBucket(t);x&&t.id===x.layerIds[0]&&(x.bucketInstanceId||(x.bucketInstanceId=++this.maxBucketInstanceId),c.addBucket(_.tileID,x,this.crossTileIDs)&&(d=!0),g[x.bucketInstanceId]=!0)}return c.removeStaleBuckets(g)&&(d=!0),d}pruneUnusedLayers(t){const n={};t.forEach(o=>{n[o]=!0});for(const o in this.layerIndexes)n[o]||delete this.layerIndexes[o]}}const Yi=(u,t)=>a.x(u,t&&t.filter(n=>n.identifier!=="source.canvas")),Tr=a.F(a.ax,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),Pc=a.F(a.ax,["setCenter","setZoom","setBearing","setPitch"]),Br=a.aw();class Zi extends a.E{constructor(t,n={}){super(),this.map=t,this.dispatcher=new si(Cn(),this,t._getMapId()),this.imageManager=new xt,this.imageManager.setEventedParent(this),this.glyphManager=new Bt(t._requestManager,n.localIdeographFontFamily),this.lineAtlas=new Xi(256,512),this.crossTileSymbolIndex=new Js,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",a.az());const o=this;this._rtlTextPluginCallback=Zi.registerForPluginStateChange(c=>{o.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:c.pluginStatus,pluginURL:c.pluginURL},(d,g)=>{if(a.aA(d),g&&g.every(_=>_))for(const _ in o.sourceCaches){const x=o.sourceCaches[_].getSource().type;x!=="vector"&&x!=="geojson"||o.sourceCaches[_].reload()}})}),this.on("data",c=>{if(c.dataType!=="source"||c.sourceDataType!=="metadata")return;const d=this.sourceCaches[c.sourceId];if(!d)return;const g=d.getSource();if(g&&g.vectorLayerIds)for(const _ in this._layers){const x=this._layers[_];x.source===g.id&&this._validateLayer(x)}})}loadURL(t,n={},o){this.fire(new a.k("dataloading",{dataType:"style"})),n.validate=typeof n.validate!="boolean"||n.validate;const c=this.map._requestManager.transformRequest(t,Fe.Style);this._request=a.f(c,(d,g)=>{this._request=null,d?this.fire(new a.j(d)):g&&this._load(g,n,o)})}loadJSON(t,n={},o){this.fire(new a.k("dataloading",{dataType:"style"})),this._request=a.h.frame(()=>{this._request=null,n.validate=n.validate!==!1,this._load(t,n,o)})}loadEmpty(){this.fire(new a.k("dataloading",{dataType:"style"})),this._load(Br,{validate:!1})}_load(t,n,o){var c;const d=n.transformStyle?n.transformStyle(o,t):t;if(!n.validate||!Yi(this,a.y(d))){this._loaded=!0,this.stylesheet=d;for(const g in d.sources)this.addSource(g,d.sources[g],{validate:!1});d.sprite?this._loadSprite(d.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(d.glyphs),this._createLayers(),this.light=new Mi(this.stylesheet.light),this.map.setTerrain((c=this.stylesheet.terrain)!==null&&c!==void 0?c:null),this.fire(new a.k("data",{dataType:"style"})),this.fire(new a.k("style.load"))}}_createLayers(){const t=a.aB(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",t),this._order=t.map(n=>n.id),this._layers={},this._serializedLayers=null;for(const n of t){const o=a.aC(n);o.setEventedParent(this,{layer:{id:n.id}}),this._layers[n.id]=o}}_loadSprite(t,n=!1,o=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(c,d,g,_){const x=Ze(c),S=x.length,I=g>1?"@2x":"",A={},L={},U={};for(const{id:V,url:Z}of x){const $=d.transformRequest(d.normalizeSpriteURL(Z,I,".json"),Fe.SpriteJSON),ie=`${V}_${$.url}`;A[ie]=a.f($,(re,pe)=>{delete A[ie],L[V]=pe,at(_,L,U,re,S)});const ue=d.transformRequest(d.normalizeSpriteURL(Z,I,".png"),Fe.SpriteImage),K=`${V}_${ue.url}`;A[K]=Re.getImage(ue,(re,pe)=>{delete A[K],U[V]=pe,at(_,L,U,re,S)})}return{cancel(){for(const V of Object.values(A))V.cancel()}}}(t,this.map._requestManager,this.map.getPixelRatio(),(c,d)=>{if(this._spriteRequest=null,c)this.fire(new a.j(c));else if(d)for(const g in d){this._spritesImagesIds[g]=[];const _=this._spritesImagesIds[g]?this._spritesImagesIds[g].filter(x=>!(x in d)):[];for(const x of _)this.imageManager.removeImage(x),this._changedImages[x]=!0;for(const x in d[g]){const S=g==="default"?x:`${g}:${x}`;this._spritesImagesIds[g].push(S),S in this.imageManager.images?this.imageManager.updateImage(S,d[g][x],!1):this.imageManager.addImage(S,d[g][x]),n&&(this._changedImages[S]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),n&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.k("data",{dataType:"style"})),o&&o(c)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}_validateLayer(t){const n=this.sourceCaches[t.source];if(!n)return;const o=t.sourceLayer;if(!o)return;const c=n.getSource();(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(o)===-1)&&this.fire(new a.j(new Error(`Source layer "${o}" does not exist on source "${c.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t){const n=this._serializedAllLayers();if(!t||t.length===0)return Object.values(n);const o=[];for(const c of t)n[c]&&o.push(n[c]);return o}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const n=Object.keys(this._layers);for(const o of n){const c=this._layers[o];c.type!=="custom"&&(t[o]=c.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const n=this._changed;if(this._changed){const c=Object.keys(this._updatedLayers),d=Object.keys(this._removedLayers);(c.length||d.length)&&this._updateWorkerLayers(c,d);for(const g in this._updatedSources){const _=this._updatedSources[g];if(_==="reload")this._reloadSource(g);else{if(_!=="clear")throw new Error(`Invalid action ${_}`);this._clearSource(g)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const g in this._updatedPaintProps)this._layers[g].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const o={};for(const c in this.sourceCaches){const d=this.sourceCaches[c];o[c]=d.used,d.used=!1}for(const c of this._order){const d=this._layers[c];d.recalculate(t,this._availableImages),!d.isHidden(t.zoom)&&d.source&&(this.sourceCaches[d.source].used=!0)}for(const c in o){const d=this.sourceCaches[c];o[c]!==d.used&&d.fire(new a.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:c}))}this.light.recalculate(t),this.z=t.zoom,n&&this.fire(new a.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const n in this.sourceCaches)this.sourceCaches[n].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,n){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(t),removedIds:n})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,n={}){this._checkLoaded();const o=this.serialize();if(t=n.transformStyle?n.transformStyle(o,t):t,Yi(this,a.y(t)))return!1;(t=a.aD(t)).layers=a.aB(t.layers);const c=a.aE(o,t).filter(g=>!(g.command in Pc));if(c.length===0)return!1;const d=c.filter(g=>!(g.command in Tr));if(d.length>0)throw new Error(`Unimplemented: ${d.map(g=>g.command).join(", ")}.`);for(const g of c)g.command!=="setTransition"&&this[g.command].apply(this,g.args);return this.stylesheet=t,this._serializedLayers=null,!0}addImage(t,n){if(this.getImage(t))return this.fire(new a.j(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,n),this._afterImageUpdated(t)}updateImage(t,n){this.imageManager.updateImage(t,n)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new a.j(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,n,o={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(a.y.source,`sources.${t}`,n,null,o))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const c=this.sourceCaches[t]=new Ii(t,n,this.dispatcher);c.style=this,c.setEventedParent(this,()=>({isSourceLoaded:c.loaded(),source:c.serialize(),sourceId:t})),c.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const o in this._layers)if(this._layers[o].source===t)return this.fire(new a.j(new Error(`Source "${t}" cannot be removed while layer "${o}" is using it.`)));const n=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],n.fire(new a.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),n.setEventedParent(null),n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,n){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const o=this.sourceCaches[t].getSource();if(o.type!=="geojson")throw new Error(`geojsonSource.type is ${o.type}, which is !== 'geojson`);o.setData(n),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,n,o={}){this._checkLoaded();const c=t.id;if(this.getLayer(c))return void this.fire(new a.j(new Error(`Layer "${c}" already exists on this map.`)));let d;if(t.type==="custom"){if(Yi(this,a.aF(t)))return;d=a.aC(t)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(c,t.source),t=a.aD(t),t=a.e(t,{source:c})),this._validate(a.y.layer,`layers.${c}`,t,{arrayIndex:-1},o))return;d=a.aC(t),this._validateLayer(d),d.setEventedParent(this,{layer:{id:c}})}const g=n?this._order.indexOf(n):this._order.length;if(n&&g===-1)this.fire(new a.j(new Error(`Cannot add layer "${c}" before non-existing layer "${n}".`)));else{if(this._order.splice(g,0,c),this._layerOrderChanged=!0,this._layers[c]=d,this._removedLayers[c]&&d.source&&d.type!=="custom"){const _=this._removedLayers[c];delete this._removedLayers[c],_.type!==d.type?this._updatedSources[d.source]="clear":(this._updatedSources[d.source]="reload",this.sourceCaches[d.source].pause())}this._updateLayer(d),d.onAdd&&d.onAdd(this.map)}}moveLayer(t,n){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new a.j(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===n)return;const o=this._order.indexOf(t);this._order.splice(o,1);const c=n?this._order.indexOf(n):this._order.length;n&&c===-1?this.fire(new a.j(new Error(`Cannot move layer "${t}" before non-existing layer "${n}".`))):(this._order.splice(c,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const n=this._layers[t];if(!n)return void this.fire(new a.j(new Error(`Cannot remove non-existing layer "${t}".`)));n.setEventedParent(null);const o=this._order.indexOf(t);this._order.splice(o,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=n,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],n.onRemove&&n.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,n,o){this._checkLoaded();const c=this.getLayer(t);c?c.minzoom===n&&c.maxzoom===o||(n!=null&&(c.minzoom=n),o!=null&&(c.maxzoom=o),this._updateLayer(c)):this.fire(new a.j(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,n,o={}){this._checkLoaded();const c=this.getLayer(t);if(c){if(!a.aG(c.filter,n))return n==null?(c.filter=void 0,void this._updateLayer(c)):void(this._validate(a.y.filter,`layers.${c.id}.filter`,n,null,o)||(c.filter=a.aD(n),this._updateLayer(c)))}else this.fire(new a.j(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return a.aD(this.getLayer(t).filter)}setLayoutProperty(t,n,o,c={}){this._checkLoaded();const d=this.getLayer(t);d?a.aG(d.getLayoutProperty(n),o)||(d.setLayoutProperty(n,o,c),this._updateLayer(d)):this.fire(new a.j(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,n){const o=this.getLayer(t);if(o)return o.getLayoutProperty(n);this.fire(new a.j(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,n,o,c={}){this._checkLoaded();const d=this.getLayer(t);d?a.aG(d.getPaintProperty(n),o)||(d.setPaintProperty(n,o,c)&&this._updateLayer(d),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new a.j(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,n){return this.getLayer(t).getPaintProperty(n)}setFeatureState(t,n){this._checkLoaded();const o=t.source,c=t.sourceLayer,d=this.sourceCaches[o];if(d===void 0)return void this.fire(new a.j(new Error(`The source '${o}' does not exist in the map's style.`)));const g=d.getSource().type;g==="geojson"&&c?this.fire(new a.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):g!=="vector"||c?(t.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),d.setFeatureState(c,t.id,n)):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,n){this._checkLoaded();const o=t.source,c=this.sourceCaches[o];if(c===void 0)return void this.fire(new a.j(new Error(`The source '${o}' does not exist in the map's style.`)));const d=c.getSource().type,g=d==="vector"?t.sourceLayer:void 0;d!=="vector"||g?n&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new a.j(new Error("A feature id is required to remove its specific state property."))):c.removeFeatureState(g,t.id,n):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const n=t.source,o=t.sourceLayer,c=this.sourceCaches[n];if(c!==void 0)return c.getSource().type!=="vector"||o?(t.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),c.getFeatureState(o,t.id)):void this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.j(new Error(`The source '${n}' does not exist in the map's style.`)))}getTransition(){return a.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=a.aH(this.sourceCaches,d=>d.serialize()),n=this._serializeByIds(this._order),o=this.map.getTerrain()||void 0,c=this.stylesheet;return a.aI({version:c.version,name:c.name,metadata:c.metadata,light:c.light,center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch,sprite:c.sprite,glyphs:c.glyphs,transition:c.transition,sources:t,layers:n,terrain:o},d=>d!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const n=g=>this._layers[g].type==="fill-extrusion",o={},c=[];for(let g=this._order.length-1;g>=0;g--){const _=this._order[g];if(n(_)){o[_]=g;for(const x of t){const S=x[_];if(S)for(const I of S)c.push(I)}}}c.sort((g,_)=>_.intersectionZ-g.intersectionZ);const d=[];for(let g=this._order.length-1;g>=0;g--){const _=this._order[g];if(n(_))for(let x=c.length-1;x>=0;x--){const S=c[x].feature;if(o[S.layer.id]<g)break;d.push(S),c.pop()}else for(const x of t){const S=x[_];if(S)for(const I of S)d.push(I.feature)}}return d}queryRenderedFeatures(t,n,o){n&&n.filter&&this._validate(a.y.filter,"queryRenderedFeatures.filter",n.filter,null,n);const c={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new a.j(new Error("parameters.layers must be an Array."))),[];for(const _ of n.layers){const x=this._layers[_];if(!x)return this.fire(new a.j(new Error(`The layer '${_}' does not exist in the map's style and cannot be queried for features.`))),[];c[x.source]=!0}}const d=[];n.availableImages=this._availableImages;const g=this._serializedAllLayers();for(const _ in this.sourceCaches)n.layers&&!c[_]||d.push(fr(this.sourceCaches[_],this._layers,g,t,n,o));return this.placement&&d.push(function(_,x,S,I,A,L,U){const V={},Z=L.queryRenderedSymbols(I),$=[];for(const ie of Object.keys(Z).map(Number))$.push(U[ie]);$.sort(nr);for(const ie of $){const ue=ie.featureIndex.lookupSymbolFeatures(Z[ie.bucketInstanceId],x,ie.bucketIndex,ie.sourceLayerIndex,A.filter,A.layers,A.availableImages,_);for(const K in ue){const re=V[K]=V[K]||[],pe=ue[K];pe.sort((fe,xe)=>{const Ee=ie.featureSortOrder;if(Ee){const Ce=Ee.indexOf(fe.featureIndex);return Ee.indexOf(xe.featureIndex)-Ce}return xe.featureIndex-fe.featureIndex});for(const fe of pe)re.push(fe)}}for(const ie in V)V[ie].forEach(ue=>{const K=ue.feature,re=S[_[ie].source].getFeatureState(K.layer["source-layer"],K.id);K.source=K.layer.source,K.layer["source-layer"]&&(K.sourceLayer=K.layer["source-layer"]),K.state=re});return V}(this._layers,g,this.sourceCaches,t,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(d)}querySourceFeatures(t,n){n&&n.filter&&this._validate(a.y.filter,"querySourceFeatures.filter",n.filter,null,n);const o=this.sourceCaches[t];return o?function(c,d){const g=c.getRenderableIds().map(S=>c.getTileByID(S)),_=[],x={};for(let S=0;S<g.length;S++){const I=g[S],A=I.tileID.canonical.key;x[A]||(x[A]=!0,I.querySourceFeatures(_,d))}return _}(o,n):[]}addSourceType(t,n,o){return Ti(t)?o(new Error(`A source type called "${t}" already exists.`)):(((c,d)=>{Wt[c]=d})(t,n),n.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:n.workerSourceURL},o):o(null,null))}getLight(){return this.light.getLight()}setLight(t,n={}){this._checkLoaded();const o=this.light.getLight();let c=!1;for(const g in t)if(!a.aG(t[g],o[g])){c=!0;break}if(!c)return;const d={now:a.h.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,n),this.light.updateTransitions(d)}_validate(t,n,o,c,d={}){return(!d||d.validate!==!1)&&Yi(this,t.call(a.y,a.e({key:n,style:this.serialize(),value:o,styleSpec:a.v},c)))}_remove(t=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.aJ.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this.sourceCaches){const o=this.sourceCaches[n];o.setEventedParent(null),o.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const n in this.sourceCaches)this.sourceCaches[n].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,n,o,c,d=!1){let g=!1,_=!1;const x={};for(const S of this._order){const I=this._layers[S];if(I.type!=="symbol")continue;if(!x[I.source]){const L=this.sourceCaches[I.source];x[I.source]=L.getRenderableIds(!0).map(U=>L.getTileByID(U)).sort((U,V)=>V.tileID.overscaledZ-U.tileID.overscaledZ||(U.tileID.isLessThan(V.tileID)?-1:1))}const A=this.crossTileSymbolIndex.addLayer(I,x[I.source],t.center.lng);g=g||A}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((d=d||this._layerOrderChanged||o===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.h.now(),t.zoom))&&(this.pauseablePlacement=new ts(t,this.map.terrain,this._order,d,n,o,c,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,x),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.h.now()),_=!0),g&&this.pauseablePlacement.placement.setStale()),_||g)for(const S of this._order){const I=this._layers[S];I.type==="symbol"&&this.placement.updateLayerOpacities(I,x[I.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.h.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,n,o){this.imageManager.getImages(n.icons,o),this._updateTilesForChangedImages();const c=this.sourceCaches[n.source];c&&c.setDependencies(n.tileID.key,n.type,n.icons)}getGlyphs(t,n,o){this.glyphManager.getGlyphs(n.stacks,o);const c=this.sourceCaches[n.source];c&&c.setDependencies(n.tileID.key,n.type,[""])}getResource(t,n,o){return a.m(n,o)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,n={}){this._checkLoaded(),t&&this._validate(a.y.glyphs,"glyphs",t,null,n)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,n,o={},c){this._checkLoaded();const d=[{id:t,url:n}],g=[...Ze(this.stylesheet.sprite),...d];this._validate(a.y.sprite,"sprite",g,null,o)||(this.stylesheet.sprite=g,this._loadSprite(d,!0,c))}removeSprite(t){this._checkLoaded();const n=Ze(this.stylesheet.sprite);if(n.find(o=>o.id===t)){if(this._spritesImagesIds[t])for(const o of this._spritesImagesIds[t])this.imageManager.removeImage(o),this._changedImages[o]=!0;n.splice(n.findIndex(o=>o.id===t),1),this.stylesheet.sprite=n.length>0?n:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}else this.fire(new a.j(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return Ze(this.stylesheet.sprite)}setSprite(t,n={},o){this._checkLoaded(),t&&this._validate(a.y.sprite,"sprite",t,null,n)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,o):(this._unloadSprite(),o&&o(null)))}}Zi.registerForPluginStateChange=a.aK;var Ys=a.Q([{name:"a_pos",type:"Int16",components:2}]),rs="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const li={prelude:Ot(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Ot(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Ot(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Ot(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Ot("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ot(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Ot(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Ot("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ot("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Ot("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Ot(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Ot(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Ot(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Ot(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Ot(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Ot(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Ot(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ot(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Ot(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Ot(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Ot(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Ot(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Ot(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Ot(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Ot(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Ot(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Ot("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",rs),terrainDepth:Ot("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",rs),terrainCoords:Ot("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",rs)};function Ot(u,t){const n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,o=t.match(/attribute ([\w]+) ([\w]+)/g),c=u.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),d=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),g=d?d.concat(c):c,_={};return{fragmentSource:u=u.replace(n,(x,S,I,A,L)=>(_[L]=!0,S==="define"?`
#ifndef HAS_UNIFORM_u_${L}
varying ${I} ${A} ${L};
#else
uniform ${I} ${A} u_${L};
#endif
`:`
#ifdef HAS_UNIFORM_u_${L}
    ${I} ${A} ${L} = u_${L};
#endif
`)),vertexSource:t=t.replace(n,(x,S,I,A,L)=>{const U=A==="float"?"vec2":"vec4",V=L.match(/color/)?"color":U;return _[L]?S==="define"?`
#ifndef HAS_UNIFORM_u_${L}
uniform lowp float u_${L}_t;
attribute ${I} ${U} a_${L};
varying ${I} ${A} ${L};
#else
uniform ${I} ${A} u_${L};
#endif
`:V==="vec4"?`
#ifndef HAS_UNIFORM_u_${L}
    ${L} = a_${L};
#else
    ${I} ${A} ${L} = u_${L};
#endif
`:`
#ifndef HAS_UNIFORM_u_${L}
    ${L} = unpack_mix_${V}(a_${L}, u_${L}_t);
#else
    ${I} ${A} ${L} = u_${L};
#endif
`:S==="define"?`
#ifndef HAS_UNIFORM_u_${L}
uniform lowp float u_${L}_t;
attribute ${I} ${U} a_${L};
#else
uniform ${I} ${A} u_${L};
#endif
`:V==="vec4"?`
#ifndef HAS_UNIFORM_u_${L}
    ${I} ${A} ${L} = a_${L};
#else
    ${I} ${A} ${L} = u_${L};
#endif
`:`
#ifndef HAS_UNIFORM_u_${L}
    ${I} ${A} ${L} = unpack_mix_${V}(a_${L}, u_${L}_t);
#else
    ${I} ${A} ${L} = u_${L};
#endif
`}),staticAttributes:o,staticUniforms:g}}class On{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,n,o,c,d,g,_,x,S){this.context=t;let I=this.boundPaintVertexBuffers.length!==c.length;for(let A=0;!I&&A<c.length;A++)this.boundPaintVertexBuffers[A]!==c[A]&&(I=!0);!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==o||I||this.boundIndexBuffer!==d||this.boundVertexOffset!==g||this.boundDynamicVertexBuffer!==_||this.boundDynamicVertexBuffer2!==x||this.boundDynamicVertexBuffer3!==S?this.freshBind(n,o,c,d,g,_,x,S):(t.bindVertexArray.set(this.vao),_&&_.bind(),d&&d.dynamicDraw&&d.bind(),x&&x.bind(),S&&S.bind())}freshBind(t,n,o,c,d,g,_,x){const S=t.numAttributes,I=this.context,A=I.gl;this.vao&&this.destroy(),this.vao=I.createVertexArray(),I.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=o,this.boundIndexBuffer=c,this.boundVertexOffset=d,this.boundDynamicVertexBuffer=g,this.boundDynamicVertexBuffer2=_,this.boundDynamicVertexBuffer3=x,n.enableAttributes(A,t);for(const L of o)L.enableAttributes(A,t);g&&g.enableAttributes(A,t),_&&_.enableAttributes(A,t),x&&x.enableAttributes(A,t),n.bind(),n.setVertexAttribPointers(A,t,d);for(const L of o)L.bind(),L.setVertexAttribPointers(A,t,d);g&&(g.bind(),g.setVertexAttribPointers(A,t,d)),c&&c.bind(),_&&(_.bind(),_.setVertexAttribPointers(A,t,d)),x&&(x.bind(),x.setVertexAttribPointers(A,t,d)),I.currentNumAttributes=S}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function pi(u){const t=[];for(let n=0;n<u.length;n++){if(u[n]===null)continue;const o=u[n].split(" ");t.push(o.pop())}return t}class Qs{constructor(t,n,o,c,d,g){const _=t.gl;this.program=_.createProgram();const x=pi(n.staticAttributes),S=o?o.getBinderAttributes():[],I=x.concat(S),A=li.prelude.staticUniforms?pi(li.prelude.staticUniforms):[],L=n.staticUniforms?pi(n.staticUniforms):[],U=o?o.getBinderUniforms():[],V=A.concat(L).concat(U),Z=[];for(const fe of V)Z.indexOf(fe)<0&&Z.push(fe);const $=o?o.defines():[];d&&$.push("#define OVERDRAW_INSPECTOR;"),g&&$.push("#define TERRAIN3D;");const ie=$.concat(li.prelude.fragmentSource,n.fragmentSource).join(`
`),ue=$.concat(li.prelude.vertexSource,n.vertexSource).join(`
`),K=_.createShader(_.FRAGMENT_SHADER);if(_.isContextLost())return void(this.failedToCreate=!0);if(_.shaderSource(K,ie),_.compileShader(K),!_.getShaderParameter(K,_.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${_.getShaderInfoLog(K)}`);_.attachShader(this.program,K);const re=_.createShader(_.VERTEX_SHADER);if(_.isContextLost())return void(this.failedToCreate=!0);if(_.shaderSource(re,ue),_.compileShader(re),!_.getShaderParameter(re,_.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${_.getShaderInfoLog(re)}`);_.attachShader(this.program,re),this.attributes={};const pe={};this.numAttributes=I.length;for(let fe=0;fe<this.numAttributes;fe++)I[fe]&&(_.bindAttribLocation(this.program,fe,I[fe]),this.attributes[I[fe]]=fe);if(_.linkProgram(this.program),!_.getProgramParameter(this.program,_.LINK_STATUS))throw new Error(`Program failed to link: ${_.getProgramInfoLog(this.program)}`);_.deleteShader(re),_.deleteShader(K);for(let fe=0;fe<Z.length;fe++){const xe=Z[fe];if(xe&&!pe[xe]){const Ee=_.getUniformLocation(this.program,xe);Ee&&(pe[xe]=Ee)}}this.fixedUniforms=c(t,pe),this.terrainUniforms=((fe,xe)=>({u_depth:new a.aL(fe,xe.u_depth),u_terrain:new a.aL(fe,xe.u_terrain),u_terrain_dim:new a.aM(fe,xe.u_terrain_dim),u_terrain_matrix:new a.aN(fe,xe.u_terrain_matrix),u_terrain_unpack:new a.aO(fe,xe.u_terrain_unpack),u_terrain_exaggeration:new a.aM(fe,xe.u_terrain_exaggeration)}))(t,pe),this.binderUniforms=o?o.getUniforms(t,pe):[]}draw(t,n,o,c,d,g,_,x,S,I,A,L,U,V,Z,$,ie,ue){const K=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(o),t.setStencilMode(c),t.setColorMode(d),t.setCullFace(g),x){t.activeTexture.set(K.TEXTURE2),K.bindTexture(K.TEXTURE_2D,x.depthTexture),t.activeTexture.set(K.TEXTURE3),K.bindTexture(K.TEXTURE_2D,x.texture);for(const pe in this.terrainUniforms)this.terrainUniforms[pe].set(x[pe])}for(const pe in this.fixedUniforms)this.fixedUniforms[pe].set(_[pe]);Z&&Z.setUniforms(t,this.binderUniforms,U,{zoom:V});let re=0;switch(n){case K.LINES:re=2;break;case K.TRIANGLES:re=3;break;case K.LINE_STRIP:re=1}for(const pe of L.get()){const fe=pe.vaos||(pe.vaos={});(fe[S]||(fe[S]=new On)).bind(t,this,I,Z?Z.getPaintVertexBuffers():[],A,pe.vertexOffset,$,ie,ue),K.drawElements(n,pe.primitiveLength*re,K.UNSIGNED_SHORT,pe.primitiveOffset*re*2)}}}function Or(u,t,n){const o=1/te(n,1,t.transform.tileZoom),c=Math.pow(2,n.tileID.overscaledZ),d=n.tileSize*Math.pow(2,t.transform.tileZoom)/c,g=d*(n.tileID.canonical.x+n.tileID.wrap*c),_=d*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[o,u.fromScale,u.toScale],u_fade:u.t,u_pixel_coord_upper:[g>>16,_>>16],u_pixel_coord_lower:[65535&g,65535&_]}}const Ua=(u,t,n,o)=>{const c=t.style.light,d=c.properties.get("position"),g=[d.x,d.y,d.z],_=function(){var S=new a.A(9);return a.A!=Float32Array&&(S[1]=0,S[2]=0,S[3]=0,S[5]=0,S[6]=0,S[7]=0),S[0]=1,S[4]=1,S[8]=1,S}();c.properties.get("anchor")==="viewport"&&function(S,I){var A=Math.sin(I),L=Math.cos(I);S[0]=L,S[1]=A,S[2]=0,S[3]=-A,S[4]=L,S[5]=0,S[6]=0,S[7]=0,S[8]=1}(_,-t.transform.angle),function(S,I,A){var L=I[0],U=I[1],V=I[2];S[0]=L*A[0]+U*A[3]+V*A[6],S[1]=L*A[1]+U*A[4]+V*A[7],S[2]=L*A[2]+U*A[5]+V*A[8]}(g,g,_);const x=c.properties.get("color");return{u_matrix:u,u_lightpos:g,u_lightintensity:c.properties.get("intensity"),u_lightcolor:[x.r,x.g,x.b],u_vertical_gradient:+n,u_opacity:o}},En=(u,t,n,o,c,d,g)=>a.e(Ua(u,t,n,o),Or(d,t,g),{u_height_factor:-Math.pow(2,c.overscaledZ)/g.tileSize/8}),sl=u=>({u_matrix:u}),qa=(u,t,n,o)=>a.e(sl(u),Or(n,t,o)),ea=(u,t)=>({u_matrix:u,u_world:t}),ta=(u,t,n,o,c)=>a.e(qa(u,t,n,o),{u_world:c}),An=(u,t,n,o)=>{const c=u.transform;let d,g;if(o.paint.get("circle-pitch-alignment")==="map"){const _=te(n,1,c.zoom);d=!0,g=[_,_]}else d=!1,g=c.pixelsToGLUnits;return{u_camera_to_center_distance:c.cameraToCenterDistance,u_scale_with_map:+(o.paint.get("circle-pitch-scale")==="map"),u_matrix:u.translatePosMatrix(t.posMatrix,n,o.paint.get("circle-translate"),o.paint.get("circle-translate-anchor")),u_pitch_with_map:+d,u_device_pixel_ratio:u.pixelRatio,u_extrude_scale:g}},Za=(u,t,n)=>{const o=te(n,1,t.zoom),c=Math.pow(2,t.zoom-n.tileID.overscaledZ),d=n.tileID.overscaleFactor();return{u_matrix:u,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:o,u_extrude_scale:[t.pixelsToGLUnits[0]/(o*c),t.pixelsToGLUnits[1]/(o*c)],u_overscale_factor:d}},Is=(u,t,n=1)=>({u_matrix:u,u_color:t,u_overlay:0,u_overlay_scale:n}),al=u=>({u_matrix:u}),Mc=(u,t,n,o)=>({u_matrix:u,u_extrude_scale:te(t,1,n),u_intensity:o});function Ga(u,t){const n=Math.pow(2,t.canonical.z),o=t.canonical.y;return[new a.U(0,o/n).toLngLat().lat,new a.U(0,(o+1)/n).toLngLat().lat]}const Ha=(u,t,n,o)=>{const c=u.transform;return{u_matrix:ia(u,t,n,o),u_ratio:1/te(t,1,c.zoom),u_device_pixel_ratio:u.pixelRatio,u_units_to_pixels:[1/c.pixelsToGLUnits[0],1/c.pixelsToGLUnits[1]]}},ol=(u,t,n,o,c)=>a.e(Ha(u,t,n,c),{u_image:0,u_image_height:o}),kc=(u,t,n,o,c)=>{const d=u.transform,g=cl(t,d);return{u_matrix:ia(u,t,n,c),u_texsize:t.imageAtlasTexture.size,u_ratio:1/te(t,1,d.zoom),u_device_pixel_ratio:u.pixelRatio,u_image:0,u_scale:[g,o.fromScale,o.toScale],u_fade:o.t,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},ll=(u,t,n,o,c,d)=>{const g=u.lineAtlas,_=cl(t,u.transform),x=n.layout.get("line-cap")==="round",S=g.getDash(o.from,x),I=g.getDash(o.to,x),A=S.width*c.fromScale,L=I.width*c.toScale;return a.e(Ha(u,t,n,d),{u_patternscale_a:[_/A,-S.height/2],u_patternscale_b:[_/L,-I.height/2],u_sdfgamma:g.width/(256*Math.min(A,L)*u.pixelRatio)/2,u_image:0,u_tex_y_a:S.y,u_tex_y_b:I.y,u_mix:c.t})};function cl(u,t){return 1/te(u,1,t.tileZoom)}function ia(u,t,n,o){return u.translatePosMatrix(o?o.posMatrix:t.tileID.posMatrix,t,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const ul=(u,t,n,o,c)=>{return{u_matrix:u,u_tl_parent:t,u_scale_parent:n,u_buffer_scale:1,u_fade_t:o.mix,u_opacity:o.opacity*c.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:c.paint.get("raster-brightness-min"),u_brightness_high:c.paint.get("raster-brightness-max"),u_saturation_factor:(g=c.paint.get("raster-saturation"),g>0?1-1/(1.001-g):-g),u_contrast_factor:(d=c.paint.get("raster-contrast"),d>0?1/(1-d):1+d),u_spin_weights:hl(c.paint.get("raster-hue-rotate"))};var d,g};function hl(u){u*=Math.PI/180;const t=Math.sin(u),n=Math.cos(u);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}const Wa=(u,t,n,o,c,d,g,_,x,S)=>{const I=c.transform;return{u_is_size_zoom_constant:+(u==="constant"||u==="source"),u_is_size_feature_constant:+(u==="constant"||u==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:I.cameraToCenterDistance,u_pitch:I.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:I.width/I.height,u_fade_change:c.options.fadeDuration?c.symbolFadeChange:1,u_matrix:d,u_label_plane_matrix:g,u_coord_matrix:_,u_is_text:+x,u_pitch_with_map:+o,u_texsize:S,u_texture:0}},Xa=(u,t,n,o,c,d,g,_,x,S,I)=>{const A=c.transform;return a.e(Wa(u,t,n,o,c,d,g,_,x,S),{u_gamma_scale:o?Math.cos(A._pitch)*A.cameraToCenterDistance:1,u_device_pixel_ratio:c.pixelRatio,u_is_halo:+I})},Nn=(u,t,n,o,c,d,g,_,x,S)=>a.e(Xa(u,t,n,o,c,d,g,_,!0,x,!0),{u_texsize_icon:S,u_texture_icon:1}),ra=(u,t,n)=>({u_matrix:u,u_opacity:t,u_color:n}),Nr=(u,t,n,o,c,d)=>a.e(function(g,_,x,S){const I=x.imageManager.getPattern(g.from.toString()),A=x.imageManager.getPattern(g.to.toString()),{width:L,height:U}=x.imageManager.getPixelSize(),V=Math.pow(2,S.tileID.overscaledZ),Z=S.tileSize*Math.pow(2,x.transform.tileZoom)/V,$=Z*(S.tileID.canonical.x+S.tileID.wrap*V),ie=Z*S.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:I.tl,u_pattern_br_a:I.br,u_pattern_tl_b:A.tl,u_pattern_br_b:A.br,u_texsize:[L,U],u_mix:_.t,u_pattern_size_a:I.displaySize,u_pattern_size_b:A.displaySize,u_scale_a:_.fromScale,u_scale_b:_.toScale,u_tile_units_to_pixels:1/te(S,1,x.transform.tileZoom),u_pixel_coord_upper:[$>>16,ie>>16],u_pixel_coord_lower:[65535&$,65535&ie]}}(o,d,n,c),{u_matrix:u,u_opacity:t}),na={fillExtrusion:(u,t)=>({u_matrix:new a.aN(u,t.u_matrix),u_lightpos:new a.aP(u,t.u_lightpos),u_lightintensity:new a.aM(u,t.u_lightintensity),u_lightcolor:new a.aP(u,t.u_lightcolor),u_vertical_gradient:new a.aM(u,t.u_vertical_gradient),u_opacity:new a.aM(u,t.u_opacity)}),fillExtrusionPattern:(u,t)=>({u_matrix:new a.aN(u,t.u_matrix),u_lightpos:new a.aP(u,t.u_lightpos),u_lightintensity:new a.aM(u,t.u_lightintensity),u_lightcolor:new a.aP(u,t.u_lightcolor),u_vertical_gradient:new a.aM(u,t.u_vertical_gradient),u_height_factor:new a.aM(u,t.u_height_factor),u_image:new a.aL(u,t.u_image),u_texsize:new a.aQ(u,t.u_texsize),u_pixel_coord_upper:new a.aQ(u,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.aQ(u,t.u_pixel_coord_lower),u_scale:new a.aP(u,t.u_scale),u_fade:new a.aM(u,t.u_fade),u_opacity:new a.aM(u,t.u_opacity)}),fill:(u,t)=>({u_matrix:new a.aN(u,t.u_matrix)}),fillPattern:(u,t)=>({u_matrix:new a.aN(u,t.u_matrix),u_image:new a.aL(u,t.u_image),u_texsize:new a.aQ(u,t.u_texsize),u_pixel_coord_upper:new a.aQ(u,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.aQ(u,t.u_pixel_coord_lower),u_scale:new a.aP(u,t.u_scale),u_fade:new a.aM(u,t.u_fade)}),fillOutline:(u,t)=>({u_matrix:new a.aN(u,t.u_matrix),u_world:new a.aQ(u,t.u_world)}),fillOutlinePattern:(u,t)=>({u_matrix:new a.aN(u,t.u_matrix),u_world:new a.aQ(u,t.u_world),u_image:new a.aL(u,t.u_image),u_texsize:new a.aQ(u,t.u_texsize),u_pixel_coord_upper:new a.aQ(u,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.aQ(u,t.u_pixel_coord_lower),u_scale:new a.aP(u,t.u_scale),u_fade:new a.aM(u,t.u_fade)}),circle:(u,t)=>({u_camera_to_center_distance:new a.aM(u,t.u_camera_to_center_distance),u_scale_with_map:new a.aL(u,t.u_scale_with_map),u_pitch_with_map:new a.aL(u,t.u_pitch_with_map),u_extrude_scale:new a.aQ(u,t.u_extrude_scale),u_device_pixel_ratio:new a.aM(u,t.u_device_pixel_ratio),u_matrix:new a.aN(u,t.u_matrix)}),collisionBox:(u,t)=>({u_matrix:new a.aN(u,t.u_matrix),u_camera_to_center_distance:new a.aM(u,t.u_camera_to_center_distance),u_pixels_to_tile_units:new a.aM(u,t.u_pixels_to_tile_units),u_extrude_scale:new a.aQ(u,t.u_extrude_scale),u_overscale_factor:new a.aM(u,t.u_overscale_factor)}),collisionCircle:(u,t)=>({u_matrix:new a.aN(u,t.u_matrix),u_inv_matrix:new a.aN(u,t.u_inv_matrix),u_camera_to_center_distance:new a.aM(u,t.u_camera_to_center_distance),u_viewport_size:new a.aQ(u,t.u_viewport_size)}),debug:(u,t)=>({u_color:new a.aR(u,t.u_color),u_matrix:new a.aN(u,t.u_matrix),u_overlay:new a.aL(u,t.u_overlay),u_overlay_scale:new a.aM(u,t.u_overlay_scale)}),clippingMask:(u,t)=>({u_matrix:new a.aN(u,t.u_matrix)}),heatmap:(u,t)=>({u_extrude_scale:new a.aM(u,t.u_extrude_scale),u_intensity:new a.aM(u,t.u_intensity),u_matrix:new a.aN(u,t.u_matrix)}),heatmapTexture:(u,t)=>({u_matrix:new a.aN(u,t.u_matrix),u_world:new a.aQ(u,t.u_world),u_image:new a.aL(u,t.u_image),u_color_ramp:new a.aL(u,t.u_color_ramp),u_opacity:new a.aM(u,t.u_opacity)}),hillshade:(u,t)=>({u_matrix:new a.aN(u,t.u_matrix),u_image:new a.aL(u,t.u_image),u_latrange:new a.aQ(u,t.u_latrange),u_light:new a.aQ(u,t.u_light),u_shadow:new a.aR(u,t.u_shadow),u_highlight:new a.aR(u,t.u_highlight),u_accent:new a.aR(u,t.u_accent)}),hillshadePrepare:(u,t)=>({u_matrix:new a.aN(u,t.u_matrix),u_image:new a.aL(u,t.u_image),u_dimension:new a.aQ(u,t.u_dimension),u_zoom:new a.aM(u,t.u_zoom),u_unpack:new a.aO(u,t.u_unpack)}),line:(u,t)=>({u_matrix:new a.aN(u,t.u_matrix),u_ratio:new a.aM(u,t.u_ratio),u_device_pixel_ratio:new a.aM(u,t.u_device_pixel_ratio),u_units_to_pixels:new a.aQ(u,t.u_units_to_pixels)}),lineGradient:(u,t)=>({u_matrix:new a.aN(u,t.u_matrix),u_ratio:new a.aM(u,t.u_ratio),u_device_pixel_ratio:new a.aM(u,t.u_device_pixel_ratio),u_units_to_pixels:new a.aQ(u,t.u_units_to_pixels),u_image:new a.aL(u,t.u_image),u_image_height:new a.aM(u,t.u_image_height)}),linePattern:(u,t)=>({u_matrix:new a.aN(u,t.u_matrix),u_texsize:new a.aQ(u,t.u_texsize),u_ratio:new a.aM(u,t.u_ratio),u_device_pixel_ratio:new a.aM(u,t.u_device_pixel_ratio),u_image:new a.aL(u,t.u_image),u_units_to_pixels:new a.aQ(u,t.u_units_to_pixels),u_scale:new a.aP(u,t.u_scale),u_fade:new a.aM(u,t.u_fade)}),lineSDF:(u,t)=>({u_matrix:new a.aN(u,t.u_matrix),u_ratio:new a.aM(u,t.u_ratio),u_device_pixel_ratio:new a.aM(u,t.u_device_pixel_ratio),u_units_to_pixels:new a.aQ(u,t.u_units_to_pixels),u_patternscale_a:new a.aQ(u,t.u_patternscale_a),u_patternscale_b:new a.aQ(u,t.u_patternscale_b),u_sdfgamma:new a.aM(u,t.u_sdfgamma),u_image:new a.aL(u,t.u_image),u_tex_y_a:new a.aM(u,t.u_tex_y_a),u_tex_y_b:new a.aM(u,t.u_tex_y_b),u_mix:new a.aM(u,t.u_mix)}),raster:(u,t)=>({u_matrix:new a.aN(u,t.u_matrix),u_tl_parent:new a.aQ(u,t.u_tl_parent),u_scale_parent:new a.aM(u,t.u_scale_parent),u_buffer_scale:new a.aM(u,t.u_buffer_scale),u_fade_t:new a.aM(u,t.u_fade_t),u_opacity:new a.aM(u,t.u_opacity),u_image0:new a.aL(u,t.u_image0),u_image1:new a.aL(u,t.u_image1),u_brightness_low:new a.aM(u,t.u_brightness_low),u_brightness_high:new a.aM(u,t.u_brightness_high),u_saturation_factor:new a.aM(u,t.u_saturation_factor),u_contrast_factor:new a.aM(u,t.u_contrast_factor),u_spin_weights:new a.aP(u,t.u_spin_weights)}),symbolIcon:(u,t)=>({u_is_size_zoom_constant:new a.aL(u,t.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aL(u,t.u_is_size_feature_constant),u_size_t:new a.aM(u,t.u_size_t),u_size:new a.aM(u,t.u_size),u_camera_to_center_distance:new a.aM(u,t.u_camera_to_center_distance),u_pitch:new a.aM(u,t.u_pitch),u_rotate_symbol:new a.aL(u,t.u_rotate_symbol),u_aspect_ratio:new a.aM(u,t.u_aspect_ratio),u_fade_change:new a.aM(u,t.u_fade_change),u_matrix:new a.aN(u,t.u_matrix),u_label_plane_matrix:new a.aN(u,t.u_label_plane_matrix),u_coord_matrix:new a.aN(u,t.u_coord_matrix),u_is_text:new a.aL(u,t.u_is_text),u_pitch_with_map:new a.aL(u,t.u_pitch_with_map),u_texsize:new a.aQ(u,t.u_texsize),u_texture:new a.aL(u,t.u_texture)}),symbolSDF:(u,t)=>({u_is_size_zoom_constant:new a.aL(u,t.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aL(u,t.u_is_size_feature_constant),u_size_t:new a.aM(u,t.u_size_t),u_size:new a.aM(u,t.u_size),u_camera_to_center_distance:new a.aM(u,t.u_camera_to_center_distance),u_pitch:new a.aM(u,t.u_pitch),u_rotate_symbol:new a.aL(u,t.u_rotate_symbol),u_aspect_ratio:new a.aM(u,t.u_aspect_ratio),u_fade_change:new a.aM(u,t.u_fade_change),u_matrix:new a.aN(u,t.u_matrix),u_label_plane_matrix:new a.aN(u,t.u_label_plane_matrix),u_coord_matrix:new a.aN(u,t.u_coord_matrix),u_is_text:new a.aL(u,t.u_is_text),u_pitch_with_map:new a.aL(u,t.u_pitch_with_map),u_texsize:new a.aQ(u,t.u_texsize),u_texture:new a.aL(u,t.u_texture),u_gamma_scale:new a.aM(u,t.u_gamma_scale),u_device_pixel_ratio:new a.aM(u,t.u_device_pixel_ratio),u_is_halo:new a.aL(u,t.u_is_halo)}),symbolTextAndIcon:(u,t)=>({u_is_size_zoom_constant:new a.aL(u,t.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aL(u,t.u_is_size_feature_constant),u_size_t:new a.aM(u,t.u_size_t),u_size:new a.aM(u,t.u_size),u_camera_to_center_distance:new a.aM(u,t.u_camera_to_center_distance),u_pitch:new a.aM(u,t.u_pitch),u_rotate_symbol:new a.aL(u,t.u_rotate_symbol),u_aspect_ratio:new a.aM(u,t.u_aspect_ratio),u_fade_change:new a.aM(u,t.u_fade_change),u_matrix:new a.aN(u,t.u_matrix),u_label_plane_matrix:new a.aN(u,t.u_label_plane_matrix),u_coord_matrix:new a.aN(u,t.u_coord_matrix),u_is_text:new a.aL(u,t.u_is_text),u_pitch_with_map:new a.aL(u,t.u_pitch_with_map),u_texsize:new a.aQ(u,t.u_texsize),u_texsize_icon:new a.aQ(u,t.u_texsize_icon),u_texture:new a.aL(u,t.u_texture),u_texture_icon:new a.aL(u,t.u_texture_icon),u_gamma_scale:new a.aM(u,t.u_gamma_scale),u_device_pixel_ratio:new a.aM(u,t.u_device_pixel_ratio),u_is_halo:new a.aL(u,t.u_is_halo)}),background:(u,t)=>({u_matrix:new a.aN(u,t.u_matrix),u_opacity:new a.aM(u,t.u_opacity),u_color:new a.aR(u,t.u_color)}),backgroundPattern:(u,t)=>({u_matrix:new a.aN(u,t.u_matrix),u_opacity:new a.aM(u,t.u_opacity),u_image:new a.aL(u,t.u_image),u_pattern_tl_a:new a.aQ(u,t.u_pattern_tl_a),u_pattern_br_a:new a.aQ(u,t.u_pattern_br_a),u_pattern_tl_b:new a.aQ(u,t.u_pattern_tl_b),u_pattern_br_b:new a.aQ(u,t.u_pattern_br_b),u_texsize:new a.aQ(u,t.u_texsize),u_mix:new a.aM(u,t.u_mix),u_pattern_size_a:new a.aQ(u,t.u_pattern_size_a),u_pattern_size_b:new a.aQ(u,t.u_pattern_size_b),u_scale_a:new a.aM(u,t.u_scale_a),u_scale_b:new a.aM(u,t.u_scale_b),u_pixel_coord_upper:new a.aQ(u,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.aQ(u,t.u_pixel_coord_lower),u_tile_units_to_pixels:new a.aM(u,t.u_tile_units_to_pixels)}),terrain:(u,t)=>({u_matrix:new a.aN(u,t.u_matrix),u_texture:new a.aL(u,t.u_texture),u_ele_delta:new a.aM(u,t.u_ele_delta)}),terrainDepth:(u,t)=>({u_matrix:new a.aN(u,t.u_matrix),u_ele_delta:new a.aM(u,t.u_ele_delta)}),terrainCoords:(u,t)=>({u_matrix:new a.aN(u,t.u_matrix),u_texture:new a.aL(u,t.u_texture),u_terrain_coords_id:new a.aM(u,t.u_terrain_coords_id),u_ele_delta:new a.aM(u,t.u_ele_delta)})};class sa{constructor(t,n,o){this.context=t;const c=t.gl;this.buffer=c.createBuffer(),this.dynamicDraw=!!o,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),c.bufferData(c.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?c.DYNAMIC_DRAW:c.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const n=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Es={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class aa{constructor(t,n,o,c){this.length=n.length,this.attributes=o,this.itemSize=n.bytesPerElement,this.dynamicDraw=c,this.context=t;const d=t.gl;this.buffer=d.createBuffer(),t.bindVertexBuffer.set(this.buffer),d.bufferData(d.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,n){for(let o=0;o<this.attributes.length;o++){const c=n.attributes[this.attributes[o].name];c!==void 0&&t.enableVertexAttribArray(c)}}setVertexAttribPointers(t,n,o){for(let c=0;c<this.attributes.length;c++){const d=this.attributes[c],g=n.attributes[d.name];g!==void 0&&t.vertexAttribPointer(g,d.components,t[Es[d.type]],!1,this.itemSize,d.offset+this.itemSize*(o||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ns=new WeakMap;function Pn(u){var t;if(ns.has(u))return ns.get(u);{const n=(t=u.getParameter(u.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return ns.set(u,n),n}}class zt{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class oa extends zt{getDefault(){return a.aT.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Ir extends zt{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Er extends zt{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Ka extends zt{getDefault(){return[!0,!0,!0,!0]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class la extends zt{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class ca extends zt{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Ja extends zt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const n=this.current;(t.func!==n.func||t.ref!==n.ref||t.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Ya extends zt{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class ua extends zt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=t,this.dirty=!1}}class Qa extends zt{getDefault(){return[0,1]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class eo extends zt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=t,this.dirty=!1}}class ha extends zt{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class dl extends zt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.BLEND):n.disable(n.BLEND),this.current=t,this.dirty=!1}}class pl extends zt{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class ss extends zt{getDefault(){return a.aT.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class zc extends zt{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Dc extends zt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=t,this.dirty=!1}}class Lc extends zt{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Rc extends zt{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class Fc extends zt{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class Bc extends zt{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class to extends zt{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class da extends zt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class io extends zt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class ro extends zt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class as extends zt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class fl extends zt{getDefault(){return null}set(t){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ml extends zt{getDefault(){return null}set(t){var n;if(t===this.current&&!this.dirty)return;const o=this.gl;Pn(o)?o.bindVertexArray(t):(n=o.getExtension("OES_vertex_array_object"))===null||n===void 0||n.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class no extends zt{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class $n extends zt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class gl extends zt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Mn extends zt{constructor(t,n){super(t),this.context=t,this.parent=n}getDefault(){return null}}class os extends Mn{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class _l extends Mn{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class so extends Mn{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Nt{constructor(t,n,o,c,d){this.context=t,this.width=n,this.height=o;const g=t.gl,_=this.framebuffer=g.createFramebuffer();if(this.colorAttachment=new os(t,_),c)this.depthAttachment=d?new so(t,_):new _l(t,_);else if(d)throw new Error("Stencil cannot be setted without depth");if(g.checkFramebufferStatus(g.FRAMEBUFFER)!==g.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,n=this.colorAttachment.get();if(n&&t.deleteTexture(n),this.depthAttachment){const o=this.depthAttachment.get();o&&t.deleteRenderbuffer(o)}t.deleteFramebuffer(this.framebuffer)}}class ci{constructor(t,n,o){this.blendFunction=t,this.blendColor=n,this.mask=o}}ci.Replace=[1,0],ci.disabled=new ci(ci.Replace,a.aT.transparent,[!1,!1,!1,!1]),ci.unblended=new ci(ci.Replace,a.aT.transparent,[!0,!0,!0,!0]),ci.alphaBlended=new ci([1,771],a.aT.transparent,[!0,!0,!0,!0]);class Oc{constructor(t){var n,o;if(this.gl=t,this.clearColor=new oa(this),this.clearDepth=new Ir(this),this.clearStencil=new Er(this),this.colorMask=new Ka(this),this.depthMask=new la(this),this.stencilMask=new ca(this),this.stencilFunc=new Ja(this),this.stencilOp=new Ya(this),this.stencilTest=new ua(this),this.depthRange=new Qa(this),this.depthTest=new eo(this),this.depthFunc=new ha(this),this.blend=new dl(this),this.blendFunc=new pl(this),this.blendColor=new ss(this),this.blendEquation=new zc(this),this.cullFace=new Dc(this),this.cullFaceSide=new Lc(this),this.frontFace=new Rc(this),this.program=new Fc(this),this.activeTexture=new Bc(this),this.viewport=new to(this),this.bindFramebuffer=new da(this),this.bindRenderbuffer=new io(this),this.bindTexture=new ro(this),this.bindVertexBuffer=new as(this),this.bindElementBuffer=new fl(this),this.bindVertexArray=new ml(this),this.pixelStoreUnpack=new no(this),this.pixelStoreUnpackPremultiplyAlpha=new $n(this),this.pixelStoreUnpackFlipY=new gl(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),Pn(t)){this.HALF_FLOAT=t.HALF_FLOAT;const c=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(n=t.RGBA16F)!==null&&n!==void 0?n:c?.RGBA16F_EXT,this.RGB16F=(o=t.RGB16F)!==null&&o!==void 0?o:c?.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const c=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=c?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,n){return new sa(this,t,n)}createVertexBuffer(t,n,o){return new aa(this,t,n,o)}createRenderbuffer(t,n,o){const c=this.gl,d=c.createRenderbuffer();return this.bindRenderbuffer.set(d),c.renderbufferStorage(c.RENDERBUFFER,t,n,o),this.bindRenderbuffer.set(null),d}createFramebuffer(t,n,o,c){return new Nt(this,t,n,o,c)}clear({color:t,depth:n,stencil:o}){const c=this.gl;let d=0;t&&(d|=c.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),n!==void 0&&(d|=c.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),o!==void 0&&(d|=c.STENCIL_BUFFER_BIT,this.clearStencil.set(o),this.stencilMask.set(255)),c.clear(d)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){a.aG(t.blendFunction,ci.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return Pn(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var n;return Pn(this.gl)?this.gl.deleteVertexArray(t):(n=this.gl.getExtension("OES_vertex_array_object"))===null||n===void 0?void 0:n.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}class Dt{constructor(t,n,o){this.func=t,this.mask=n,this.range=o}}Dt.ReadOnly=!1,Dt.ReadWrite=!0,Dt.disabled=new Dt(519,Dt.ReadOnly,[0,1]);const jn=7680;class ui{constructor(t,n,o,c,d,g){this.test=t,this.ref=n,this.mask=o,this.fail=c,this.depthFail=d,this.pass=g}}ui.disabled=new ui({func:519,mask:0},0,0,jn,jn,jn);class ai{constructor(t,n,o){this.enable=t,this.mode=n,this.frontFace=o}}let As;function yl(u,t,n,o,c,d,g){const _=u.context,x=_.gl,S=u.useProgram("collisionBox"),I=[];let A=0,L=0;for(let K=0;K<o.length;K++){const re=o[K],pe=t.getTile(re),fe=pe.getBucket(n);if(!fe)continue;let xe=re.posMatrix;c[0]===0&&c[1]===0||(xe=u.translatePosMatrix(re.posMatrix,pe,c,d));const Ee=g?fe.textCollisionBox:fe.iconCollisionBox,Ce=fe.collisionCircleArray;if(Ce.length>0){const Me=a.Z(),Ke=xe;a.aU(Me,fe.placementInvProjMatrix,u.transform.glCoordMatrix),a.aU(Me,Me,fe.placementViewportMatrix),I.push({circleArray:Ce,circleOffset:L,transform:Ke,invTransform:Me,coord:re}),A+=Ce.length/4,L=A}Ee&&S.draw(_,x.LINES,Dt.disabled,ui.disabled,u.colorModeForRenderPass(),ai.disabled,Za(xe,u.transform,pe),u.style.map.terrain&&u.style.map.terrain.getTerrainData(re),n.id,Ee.layoutVertexBuffer,Ee.indexBuffer,Ee.segments,null,u.transform.zoom,null,null,Ee.collisionVertexBuffer)}if(!g||!I.length)return;const U=u.useProgram("collisionCircle"),V=new a.aV;V.resize(4*A),V._trim();let Z=0;for(const K of I)for(let re=0;re<K.circleArray.length/4;re++){const pe=4*re,fe=K.circleArray[pe+0],xe=K.circleArray[pe+1],Ee=K.circleArray[pe+2],Ce=K.circleArray[pe+3];V.emplace(Z++,fe,xe,Ee,Ce,0),V.emplace(Z++,fe,xe,Ee,Ce,1),V.emplace(Z++,fe,xe,Ee,Ce,2),V.emplace(Z++,fe,xe,Ee,Ce,3)}(!As||As.length<2*A)&&(As=function(K){const re=2*K,pe=new a.aX;pe.resize(re),pe._trim();for(let fe=0;fe<re;fe++){const xe=6*fe;pe.uint16[xe+0]=4*fe+0,pe.uint16[xe+1]=4*fe+1,pe.uint16[xe+2]=4*fe+2,pe.uint16[xe+3]=4*fe+2,pe.uint16[xe+4]=4*fe+3,pe.uint16[xe+5]=4*fe+0}return pe}(A));const $=_.createIndexBuffer(As,!0),ie=_.createVertexBuffer(V,a.aW.members,!0);for(const K of I){const re={u_matrix:K.transform,u_inv_matrix:K.invTransform,u_camera_to_center_distance:(ue=u.transform).cameraToCenterDistance,u_viewport_size:[ue.width,ue.height]};U.draw(_,x.TRIANGLES,Dt.disabled,ui.disabled,u.colorModeForRenderPass(),ai.disabled,re,u.style.map.terrain&&u.style.map.terrain.getTerrainData(K.coord),n.id,ie,$,a.S.simpleSegment(0,2*K.circleOffset,K.circleArray.length,K.circleArray.length/2),null,u.transform.zoom,null,null,null)}var ue;ie.destroy(),$.destroy()}ai.disabled=new ai(!1,1029,2305),ai.backCCW=new ai(!0,1029,2305);const ao=a.ao(new Float32Array(16));function pa(u,t,n,o,c,d){const{horizontalAlign:g,verticalAlign:_}=a.au(u);return new a.P((-(g-.5)*t/c+o[0])*d,(-(_-.5)*n/c+o[1])*d)}function fa(u,t,n,o,c,d,g,_,x,S,I){const A=u.text.placedSymbolArray,L=u.text.dynamicLayoutVertexArray,U=u.icon.dynamicLayoutVertexArray,V={};L.clear();for(let Z=0;Z<A.length;Z++){const $=A.get(Z),ie=$.hidden||!$.crossTileID||u.allowVerticalPlacement&&!$.placedOrientation?null:o[$.crossTileID];if(ie){const ue=new a.P($.anchorX,$.anchorY),K=dt(ue,n?g:d,I),re=Ut(c.cameraToCenterDistance,K.signedDistanceFromCamera);let pe=a.aj(u.textSizeData,x,$)*re/a.ap;n&&(pe*=u.tilePixelRatio/_);const{width:fe,height:xe,anchor:Ee,textOffset:Ce,textBoxScale:Me}=ie,Ke=pa(Ee,fe,xe,Ce,Me,pe),Tt=n?dt(ue.add(Ke),d,I).point:K.point.add(t?Ke.rotate(-c.angle):Ke),Be=u.allowVerticalPlacement&&$.placedOrientation===a.ai.vertical?Math.PI/2:0;for(let ht=0;ht<$.numGlyphs;ht++)a.ak(L,Tt,Be);S&&$.associatedIconIndex>=0&&(V[$.associatedIconIndex]={shiftedAnchor:Tt,angle:Be})}else N($.numGlyphs,L)}if(S){U.clear();const Z=u.icon.placedSymbolArray;for(let $=0;$<Z.length;$++){const ie=Z.get($);if(ie.hidden)N(ie.numGlyphs,U);else{const ue=V[$];if(ue)for(let K=0;K<ie.numGlyphs;K++)a.ak(U,ue.shiftedAnchor,ue.angle);else N(ie.numGlyphs,U)}}u.icon.dynamicLayoutVertexBuffer.updateData(U)}u.text.dynamicLayoutVertexBuffer.updateData(L)}function oo(u,t,n){return n.iconsInText&&t?"symbolTextAndIcon":u?"symbolSDF":"symbolIcon"}function ma(u,t,n,o,c,d,g,_,x,S,I,A){const L=u.context,U=L.gl,V=u.transform,Z=_==="map",$=x==="map",ie=_!=="viewport"&&n.layout.get("symbol-placement")!=="point",ue=Z&&!$&&!ie,K=!n.layout.get("symbol-sort-key").isConstant();let re=!1;const pe=u.depthModeForSublayer(0,Dt.ReadOnly),fe=n._unevaluatedLayout.hasValue("text-variable-anchor")||n._unevaluatedLayout.hasValue("text-variable-anchor-offset"),xe=[];for(const Ee of o){const Ce=t.getTile(Ee),Me=Ce.getBucket(n);if(!Me)continue;const Ke=c?Me.text:Me.icon;if(!Ke||!Ke.segments.get().length||!Ke.hasVisibleVertices)continue;const Tt=Ke.programConfigurations.get(n.id),Be=c||Me.sdfIcons,ht=c?Me.textSizeData:Me.iconSizeData,Ye=$||V.pitch!==0,Zt=u.useProgram(oo(Be,c,Me),Tt),Ct=a.ah(ht,V.zoom),bt=u.style.map.terrain&&u.style.map.terrain.getTerrainData(Ee);let It,yi,ei,Gi,zi=[0,0],Si=null;if(c)yi=Ce.glyphAtlasTexture,ei=U.LINEAR,It=Ce.glyphAtlasTexture.size,Me.iconsInText&&(zi=Ce.imageAtlasTexture.size,Si=Ce.imageAtlasTexture,Gi=Ye||u.options.rotating||u.options.zooming||ht.kind==="composite"||ht.kind==="camera"?U.LINEAR:U.NEAREST);else{const vi=n.layout.get("icon-size").constantOr(0)!==1||Me.iconsNeedLinear;yi=Ce.imageAtlasTexture,ei=Be||u.options.rotating||u.options.zooming||vi||Ye?U.LINEAR:U.NEAREST,It=Ce.imageAtlasTexture.size}const Mr=te(Ce,1,u.transform.zoom),ii=ze(Ee.posMatrix,$,Z,u.transform,Mr),rn=mt(Ee.posMatrix,$,Z,u.transform,Mr),nn=fe&&Me.hasTextData(),Dn=n.layout.get("icon-text-fit")!=="none"&&nn&&Me.hasIconData();if(ie){const vi=u.style.map.terrain?(yr,xi)=>u.style.map.terrain.getElevation(Ee,yr,xi):null,Di=n.layout.get("text-rotation-alignment")==="map";Te(Me,Ee.posMatrix,u,c,ii,rn,$,S,Di,vi)}const Gn=u.translatePosMatrix(Ee.posMatrix,Ce,d,g),fs=ie||c&&fe||Dn?ao:ii,Qi=u.translatePosMatrix(rn,Ce,d,g,!0),Hi=Be&&n.paint.get(c?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let or;or=Be?Me.iconsInText?Nn(ht.kind,Ct,ue,$,u,Gn,fs,Qi,It,zi):Xa(ht.kind,Ct,ue,$,u,Gn,fs,Qi,c,It,!0):Wa(ht.kind,Ct,ue,$,u,Gn,fs,Qi,c,It);const Hn={program:Zt,buffers:Ke,uniformValues:or,atlasTexture:yi,atlasTextureIcon:Si,atlasInterpolation:ei,atlasInterpolationIcon:Gi,isSDF:Be,hasHalo:Hi};if(K&&Me.canOverlap){re=!0;const vi=Ke.segments.get();for(const Di of vi)xe.push({segments:new a.S([Di]),sortKey:Di.sortKey,state:Hn,terrainData:bt})}else xe.push({segments:Ke.segments,sortKey:0,state:Hn,terrainData:bt})}re&&xe.sort((Ee,Ce)=>Ee.sortKey-Ce.sortKey);for(const Ee of xe){const Ce=Ee.state;if(L.activeTexture.set(U.TEXTURE0),Ce.atlasTexture.bind(Ce.atlasInterpolation,U.CLAMP_TO_EDGE),Ce.atlasTextureIcon&&(L.activeTexture.set(U.TEXTURE1),Ce.atlasTextureIcon&&Ce.atlasTextureIcon.bind(Ce.atlasInterpolationIcon,U.CLAMP_TO_EDGE)),Ce.isSDF){const Me=Ce.uniformValues;Ce.hasHalo&&(Me.u_is_halo=1,lo(Ce.buffers,Ee.segments,n,u,Ce.program,pe,I,A,Me,Ee.terrainData)),Me.u_is_halo=0}lo(Ce.buffers,Ee.segments,n,u,Ce.program,pe,I,A,Ce.uniformValues,Ee.terrainData)}}function lo(u,t,n,o,c,d,g,_,x,S){const I=o.context;c.draw(I,I.gl.TRIANGLES,d,g,_,ai.disabled,x,S,n.id,u.layoutVertexBuffer,u.indexBuffer,t,n.paint,o.transform.zoom,u.programConfigurations.get(n.id),u.dynamicLayoutVertexBuffer,u.opacityVertexBuffer)}function Ps(u,t,n,o,c){if(!n||!o||!o.imageAtlas)return;const d=o.imageAtlas.patternPositions;let g=d[n.to.toString()],_=d[n.from.toString()];if(!g&&_&&(g=_),!_&&g&&(_=g),!g||!_){const x=c.getPaintProperty(t);g=d[x],_=d[x]}g&&_&&u.setConstantPatternPositions(g,_)}function Ms(u,t,n,o,c,d,g){const _=u.context.gl,x="fill-pattern",S=n.paint.get(x),I=S&&S.constantOr(1),A=n.getCrossfadeParameters();let L,U,V,Z,$;g?(U=I&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=_.LINES):(U=I?"fillPattern":"fill",L=_.TRIANGLES);const ie=S.constantOr(null);for(const ue of o){const K=t.getTile(ue);if(I&&!K.patternsLoaded())continue;const re=K.getBucket(n);if(!re)continue;const pe=re.programConfigurations.get(n.id),fe=u.useProgram(U,pe),xe=u.style.map.terrain&&u.style.map.terrain.getTerrainData(ue);I&&(u.context.activeTexture.set(_.TEXTURE0),K.imageAtlasTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE),pe.updatePaintBuffers(A)),Ps(pe,x,ie,K,n);const Ee=xe?ue:null,Ce=u.translatePosMatrix(Ee?Ee.posMatrix:ue.posMatrix,K,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));if(g){Z=re.indexBuffer2,$=re.segments2;const Me=[_.drawingBufferWidth,_.drawingBufferHeight];V=U==="fillOutlinePattern"&&I?ta(Ce,u,A,K,Me):ea(Ce,Me)}else Z=re.indexBuffer,$=re.segments,V=I?qa(Ce,u,A,K):sl(Ce);fe.draw(u.context,L,c,u.stencilModeForClipping(ue),d,ai.disabled,V,xe,n.id,re.layoutVertexBuffer,Z,$,n.paint,u.transform.zoom,pe)}}function ks(u,t,n,o,c,d,g){const _=u.context,x=_.gl,S="fill-extrusion-pattern",I=n.paint.get(S),A=I.constantOr(1),L=n.getCrossfadeParameters(),U=n.paint.get("fill-extrusion-opacity"),V=I.constantOr(null);for(const Z of o){const $=t.getTile(Z),ie=$.getBucket(n);if(!ie)continue;const ue=u.style.map.terrain&&u.style.map.terrain.getTerrainData(Z),K=ie.programConfigurations.get(n.id),re=u.useProgram(A?"fillExtrusionPattern":"fillExtrusion",K);A&&(u.context.activeTexture.set(x.TEXTURE0),$.imageAtlasTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE),K.updatePaintBuffers(L)),Ps(K,S,V,$,n);const pe=u.translatePosMatrix(Z.posMatrix,$,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),fe=n.paint.get("fill-extrusion-vertical-gradient"),xe=A?En(pe,u,fe,U,Z,L,$):Ua(pe,u,fe,U);re.draw(_,_.gl.TRIANGLES,c,d,g,ai.backCCW,xe,ue,n.id,ie.layoutVertexBuffer,ie.indexBuffer,ie.segments,n.paint,u.transform.zoom,K,u.style.map.terrain&&ie.centroidVertexBuffer)}}function Nc(u,t,n,o,c,d,g){const _=u.context,x=_.gl,S=n.fbo;if(!S)return;const I=u.useProgram("hillshade"),A=u.style.map.terrain&&u.style.map.terrain.getTerrainData(t);_.activeTexture.set(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,S.colorAttachment.get()),I.draw(_,x.TRIANGLES,c,d,g,ai.disabled,((L,U,V,Z)=>{const $=V.paint.get("hillshade-shadow-color"),ie=V.paint.get("hillshade-highlight-color"),ue=V.paint.get("hillshade-accent-color");let K=V.paint.get("hillshade-illumination-direction")*(Math.PI/180);V.paint.get("hillshade-illumination-anchor")==="viewport"&&(K-=L.transform.angle);const re=!L.options.moving;return{u_matrix:Z?Z.posMatrix:L.transform.calculatePosMatrix(U.tileID.toUnwrapped(),re),u_image:0,u_latrange:Ga(0,U.tileID),u_light:[V.paint.get("hillshade-exaggeration"),K],u_shadow:$,u_highlight:ie,u_accent:ue}})(u,n,o,A?t:null),A,o.id,u.rasterBoundsBuffer,u.quadTriangleIndexBuffer,u.rasterBoundsSegments)}function co(u,t,n,o,c,d){const g=u.context,_=g.gl,x=t.dem;if(x&&x.data){const S=x.dim,I=x.stride,A=x.getPixels();if(g.activeTexture.set(_.TEXTURE1),g.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||u.getTileTexture(I),t.demTexture){const U=t.demTexture;U.update(A,{premultiply:!1}),U.bind(_.NEAREST,_.CLAMP_TO_EDGE)}else t.demTexture=new Pe(g,A,_.RGBA,{premultiply:!1}),t.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE);g.activeTexture.set(_.TEXTURE0);let L=t.fbo;if(!L){const U=new Pe(g,{width:S,height:S,data:null},_.RGBA);U.bind(_.LINEAR,_.CLAMP_TO_EDGE),L=t.fbo=g.createFramebuffer(S,S,!0,!1),L.colorAttachment.set(U.texture)}g.bindFramebuffer.set(L.framebuffer),g.viewport.set([0,0,S,S]),u.useProgram("hillshadePrepare").draw(g,_.TRIANGLES,o,c,d,ai.disabled,((U,V)=>{const Z=V.stride,$=a.Z();return a.aS($,0,a.N,-a.N,0,0,1),a.$($,$,[0,-a.N,0]),{u_matrix:$,u_image:1,u_dimension:[Z,Z],u_zoom:U.overscaledZ,u_unpack:V.getUnpackVector()}})(t.tileID,x),null,n.id,u.rasterBoundsBuffer,u.quadTriangleIndexBuffer,u.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function $c(u,t,n,o,c,d){const g=o.paint.get("raster-fade-duration");if(!d&&g>0){const _=a.h.now(),x=(_-u.timeAdded)/g,S=t?(_-t.timeAdded)/g:-1,I=n.getSource(),A=c.coveringZoomLevel({tileSize:I.tileSize,roundZoom:I.roundZoom}),L=!t||Math.abs(t.tileID.overscaledZ-A)>Math.abs(u.tileID.overscaledZ-A),U=L&&u.refreshedUponExpiration?1:a.ad(L?x:1-S,0,1);return u.refreshedUponExpiration&&x>=1&&(u.refreshedUponExpiration=!1),t?{opacity:1,mix:1-U}:{opacity:U,mix:0}}return{opacity:1,mix:0}}const vl=new a.aT(1,0,0,1),ga=new a.aT(0,1,0,1),uo=new a.aT(0,0,1,1),xl=new a.aT(1,0,1,1),bl=new a.aT(0,1,1,1);function zs(u,t,n,o){ya(u,0,t+n/2,u.transform.width,n,o)}function _a(u,t,n,o){ya(u,t-n/2,0,n,u.transform.height,o)}function ya(u,t,n,o,c,d){const g=u.context,_=g.gl;_.enable(_.SCISSOR_TEST),_.scissor(t*u.pixelRatio,n*u.pixelRatio,o*u.pixelRatio,c*u.pixelRatio),g.clear({color:d}),_.disable(_.SCISSOR_TEST)}function wl(u,t,n){const o=u.context,c=o.gl,d=n.posMatrix,g=u.useProgram("debug"),_=Dt.disabled,x=ui.disabled,S=u.colorModeForRenderPass(),I="$debug",A=u.style.map.terrain&&u.style.map.terrain.getTerrainData(n);o.activeTexture.set(c.TEXTURE0);const L=t.getTileByID(n.key).latestRawTileData,U=Math.floor((L&&L.byteLength||0)/1024),V=t.getTile(n).tileSize,Z=512/Math.min(V,512)*(n.overscaledZ/u.transform.zoom)*.5;let $=n.canonical.toString();n.overscaledZ!==n.canonical.z&&($+=` => ${n.overscaledZ}`),function(ie,ue){ie.initDebugOverlayCanvas();const K=ie.debugOverlayCanvas,re=ie.context.gl,pe=ie.debugOverlayCanvas.getContext("2d");pe.clearRect(0,0,K.width,K.height),pe.shadowColor="white",pe.shadowBlur=2,pe.lineWidth=1.5,pe.strokeStyle="white",pe.textBaseline="top",pe.font="bold 36px Open Sans, sans-serif",pe.fillText(ue,5,5),pe.strokeText(ue,5,5),ie.debugOverlayTexture.update(K),ie.debugOverlayTexture.bind(re.LINEAR,re.CLAMP_TO_EDGE)}(u,`${$} ${U}kB`),g.draw(o,c.TRIANGLES,_,x,ci.alphaBlended,ai.disabled,Is(d,a.aT.transparent,Z),null,I,u.debugBuffer,u.quadTriangleIndexBuffer,u.debugSegments),g.draw(o,c.LINE_STRIP,_,x,S,ai.disabled,Is(d,a.aT.red),A,I,u.debugBuffer,u.tileBorderIndexBuffer,u.debugSegments)}function fi(u,t,n){const o=u.context,c=o.gl,d=u.colorModeForRenderPass(),g=new Dt(c.LEQUAL,Dt.ReadWrite,u.depthRangeFor3D),_=u.useProgram("terrain"),x=t.getTerrainMesh();o.bindFramebuffer.set(null),o.viewport.set([0,0,u.width,u.height]);for(const S of n){const I=u.renderToTexture.getTexture(S),A=t.getTerrainData(S.tileID);o.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,I.texture);const L={u_matrix:u.transform.calculatePosMatrix(S.tileID.toUnwrapped()),u_texture:0,u_ele_delta:t.getMeshFrameDelta(u.transform.zoom)};_.draw(o,c.TRIANGLES,g,ui.disabled,d,ai.backCCW,L,A,"terrain",x.vertexBuffer,x.indexBuffer,x.segments)}}class Vn{constructor(t,n){this.context=new Oc(t),this.transform=n,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.Z(),renderTime:0},this.setup(),this.numSublayers=Ii.maxUnderzooming+Ii.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Js}resize(t,n,o){if(this.width=Math.floor(t*o),this.height=Math.floor(n*o),this.pixelRatio=o,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const c of this.style._order)this.style._layers[c].resize()}setup(){const t=this.context,n=new a.a_;n.emplaceBack(0,0),n.emplaceBack(a.N,0),n.emplaceBack(0,a.N),n.emplaceBack(a.N,a.N),this.tileExtentBuffer=t.createVertexBuffer(n,Ys.members),this.tileExtentSegments=a.S.simpleSegment(0,0,4,2);const o=new a.a_;o.emplaceBack(0,0),o.emplaceBack(a.N,0),o.emplaceBack(0,a.N),o.emplaceBack(a.N,a.N),this.debugBuffer=t.createVertexBuffer(o,Ys.members),this.debugSegments=a.S.simpleSegment(0,0,4,5);const c=new a.V;c.emplaceBack(0,0,0,0),c.emplaceBack(a.N,0,a.N,0),c.emplaceBack(0,a.N,0,a.N),c.emplaceBack(a.N,a.N,a.N,a.N),this.rasterBoundsBuffer=t.createVertexBuffer(c,Yt.members),this.rasterBoundsSegments=a.S.simpleSegment(0,0,4,2);const d=new a.a_;d.emplaceBack(0,0),d.emplaceBack(1,0),d.emplaceBack(0,1),d.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(d,Ys.members),this.viewportSegments=a.S.simpleSegment(0,0,4,2);const g=new a.a$;g.emplaceBack(0),g.emplaceBack(1),g.emplaceBack(3),g.emplaceBack(2),g.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(g);const _=new a.b0;_.emplaceBack(0,1,2),_.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(_);const x=this.context.gl;this.stencilClearMode=new ui({func:x.ALWAYS,mask:0},0,255,x.ZERO,x.ZERO,x.ZERO)}clearStencil(){const t=this.context,n=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const o=a.Z();a.aS(o,0,this.width,this.height,0,0,1),a.a0(o,o,[n.drawingBufferWidth,n.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,n.TRIANGLES,Dt.disabled,this.stencilClearMode,ci.disabled,ai.disabled,al(o),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,n){if(this.currentStencilSource===t.source||!t.isTileClipped()||!n||!n.length)return;this.currentStencilSource=t.source;const o=this.context,c=o.gl;this.nextStencilID+n.length>256&&this.clearStencil(),o.setColorMode(ci.disabled),o.setDepthMode(Dt.disabled);const d=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const g of n){const _=this._tileClippingMaskIDs[g.key]=this.nextStencilID++,x=this.style.map.terrain&&this.style.map.terrain.getTerrainData(g);d.draw(o,c.TRIANGLES,Dt.disabled,new ui({func:c.ALWAYS,mask:0},_,255,c.KEEP,c.KEEP,c.REPLACE),ci.disabled,ai.disabled,al(g.posMatrix),x,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,n=this.context.gl;return new ui({func:n.NOTEQUAL,mask:255},t,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(t){const n=this.context.gl;return new ui({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(t){const n=this.context.gl,o=t.sort((g,_)=>_.overscaledZ-g.overscaledZ),c=o[o.length-1].overscaledZ,d=o[0].overscaledZ-c+1;if(d>1){this.currentStencilSource=void 0,this.nextStencilID+d>256&&this.clearStencil();const g={};for(let _=0;_<d;_++)g[_+c]=new ui({func:n.GEQUAL,mask:255},_+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=d,[g,o]}return[{[c]:ui.disabled},o]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new ci([t.CONSTANT_COLOR,t.ONE],new a.aT(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ci.unblended:ci.alphaBlended}depthModeForSublayer(t,n,o){if(!this.opaquePassEnabledForLayer())return Dt.disabled;const c=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Dt(o||this.context.gl.LEQUAL,n,[c,c])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,n){this.style=t,this.options=n,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(a.h.now()),this.imageManager.beginFrame();const o=this.style._order,c=this.style.sourceCaches,d={},g={},_={};for(const x in c){const S=c[x];S.used&&S.prepare(this.context),d[x]=S.getVisibleCoordinates(),g[x]=d[x].slice().reverse(),_[x]=S.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let x=0;x<o.length;x++)if(this.style._layers[o[x]].is3D()){this.opaquePassCutoff=x;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const x=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!a.b1(this.terrainFacilitator.matrix,this.transform.projMatrix)||x.length)&&(a.b2(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(S,I){const A=S.context,L=A.gl,U=ci.unblended,V=new Dt(L.LEQUAL,Dt.ReadWrite,[0,1]),Z=I.getTerrainMesh(),$=I.sourceCache.getRenderableTiles(),ie=S.useProgram("terrainDepth");A.bindFramebuffer.set(I.getFramebuffer("depth").framebuffer),A.viewport.set([0,0,S.width/devicePixelRatio,S.height/devicePixelRatio]),A.clear({color:a.aT.transparent,depth:1});for(const ue of $){const K=I.getTerrainData(ue.tileID),re={u_matrix:S.transform.calculatePosMatrix(ue.tileID.toUnwrapped()),u_ele_delta:I.getMeshFrameDelta(S.transform.zoom)};ie.draw(A,L.TRIANGLES,V,ui.disabled,U,ai.backCCW,re,K,"terrain",Z.vertexBuffer,Z.indexBuffer,Z.segments)}A.bindFramebuffer.set(null),A.viewport.set([0,0,S.width,S.height])}(this,this.style.map.terrain),function(S,I){const A=S.context,L=A.gl,U=ci.unblended,V=new Dt(L.LEQUAL,Dt.ReadWrite,[0,1]),Z=I.getTerrainMesh(),$=I.getCoordsTexture(),ie=I.sourceCache.getRenderableTiles(),ue=S.useProgram("terrainCoords");A.bindFramebuffer.set(I.getFramebuffer("coords").framebuffer),A.viewport.set([0,0,S.width/devicePixelRatio,S.height/devicePixelRatio]),A.clear({color:a.aT.transparent,depth:1}),I.coordsIndex=[];for(const K of ie){const re=I.getTerrainData(K.tileID);A.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,$.texture);const pe={u_matrix:S.transform.calculatePosMatrix(K.tileID.toUnwrapped()),u_terrain_coords_id:(255-I.coordsIndex.length)/255,u_texture:0,u_ele_delta:I.getMeshFrameDelta(S.transform.zoom)};ue.draw(A,L.TRIANGLES,V,ui.disabled,U,ai.backCCW,pe,re,"terrain",Z.vertexBuffer,Z.indexBuffer,Z.segments),I.coordsIndex.push(K.tileID.key)}A.bindFramebuffer.set(null),A.viewport.set([0,0,S.width,S.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const x of o){const S=this.style._layers[x];if(!S.hasOffscreenPass()||S.isHidden(this.transform.zoom))continue;const I=g[S.source];(S.type==="custom"||I.length)&&this.renderLayer(this,c[S.source],S,I)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?a.aT.black:a.aT.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=o.length-1;this.currentLayer>=0;this.currentLayer--){const x=this.style._layers[o[this.currentLayer]],S=c[x.source],I=d[x.source];this._renderTileClippingMasks(x,I),this.renderLayer(this,S,x,I)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<o.length;this.currentLayer++){const x=this.style._layers[o[this.currentLayer]],S=c[x.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(x))continue;const I=(x.type==="symbol"?_:g)[x.source];this._renderTileClippingMasks(x,d[x.source]),this.renderLayer(this,S,x,I)}if(this.options.showTileBoundaries){const x=function(S,I){let A=null;const L=Object.values(S._layers).flatMap($=>$.source&&!$.isHidden(I)?[S.sourceCaches[$.source]]:[]),U=L.filter($=>$.getSource().type==="vector"),V=L.filter($=>$.getSource().type!=="vector"),Z=$=>{(!A||A.getSource().maxzoom<$.getSource().maxzoom)&&(A=$)};return U.forEach($=>Z($)),A||V.forEach($=>Z($)),A}(this.style,this.transform.zoom);x&&function(S,I,A){for(let L=0;L<A.length;L++)wl(S,I,A[L])}(this,x,x.getVisibleCoordinates())}this.options.showPadding&&function(x){const S=x.transform.padding;zs(x,x.transform.height-(S.top||0),3,vl),zs(x,S.bottom||0,3,ga),_a(x,S.left||0,3,uo),_a(x,x.transform.width-(S.right||0),3,xl);const I=x.transform.centerPoint;(function(A,L,U,V){ya(A,L-1,U-10,2,20,V),ya(A,L-10,U-1,20,2,V)})(x,I.x,x.transform.height-I.y,bl)}(this),this.context.setDefault()}renderLayer(t,n,o,c){if(!o.isHidden(this.transform.zoom)&&(o.type==="background"||o.type==="custom"||(c||[]).length))switch(this.id=o.id,o.type){case"symbol":(function(d,g,_,x,S){if(d.renderPass!=="translucent")return;const I=ui.disabled,A=d.colorModeForRenderPass();(_._unevaluatedLayout.hasValue("text-variable-anchor")||_._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(L,U,V,Z,$,ie,ue){const K=U.transform,re=$==="map",pe=ie==="map";for(const fe of L){const xe=Z.getTile(fe),Ee=xe.getBucket(V);if(!Ee||!Ee.text||!Ee.text.segments.get().length)continue;const Ce=a.ah(Ee.textSizeData,K.zoom),Me=te(xe,1,U.transform.zoom),Ke=ze(fe.posMatrix,pe,re,U.transform,Me),Tt=V.layout.get("icon-text-fit")!=="none"&&Ee.hasIconData();if(Ce){const Be=Math.pow(2,K.zoom-xe.tileID.overscaledZ);fa(Ee,re,pe,ue,K,Ke,fe.posMatrix,Be,Ce,Tt,U.style.map.terrain?(ht,Ye)=>U.style.map.terrain.getElevation(fe,ht,Ye):null)}}}(x,d,_,g,_.layout.get("text-rotation-alignment"),_.layout.get("text-pitch-alignment"),S),_.paint.get("icon-opacity").constantOr(1)!==0&&ma(d,g,_,x,!1,_.paint.get("icon-translate"),_.paint.get("icon-translate-anchor"),_.layout.get("icon-rotation-alignment"),_.layout.get("icon-pitch-alignment"),_.layout.get("icon-keep-upright"),I,A),_.paint.get("text-opacity").constantOr(1)!==0&&ma(d,g,_,x,!0,_.paint.get("text-translate"),_.paint.get("text-translate-anchor"),_.layout.get("text-rotation-alignment"),_.layout.get("text-pitch-alignment"),_.layout.get("text-keep-upright"),I,A),g.map.showCollisionBoxes&&(yl(d,g,_,x,_.paint.get("text-translate"),_.paint.get("text-translate-anchor"),!0),yl(d,g,_,x,_.paint.get("icon-translate"),_.paint.get("icon-translate-anchor"),!1))})(t,n,o,c,this.style.placement.variableOffsets);break;case"circle":(function(d,g,_,x){if(d.renderPass!=="translucent")return;const S=_.paint.get("circle-opacity"),I=_.paint.get("circle-stroke-width"),A=_.paint.get("circle-stroke-opacity"),L=!_.layout.get("circle-sort-key").isConstant();if(S.constantOr(1)===0&&(I.constantOr(1)===0||A.constantOr(1)===0))return;const U=d.context,V=U.gl,Z=d.depthModeForSublayer(0,Dt.ReadOnly),$=ui.disabled,ie=d.colorModeForRenderPass(),ue=[];for(let K=0;K<x.length;K++){const re=x[K],pe=g.getTile(re),fe=pe.getBucket(_);if(!fe)continue;const xe=fe.programConfigurations.get(_.id),Ee=d.useProgram("circle",xe),Ce=fe.layoutVertexBuffer,Me=fe.indexBuffer,Ke=d.style.map.terrain&&d.style.map.terrain.getTerrainData(re),Tt={programConfiguration:xe,program:Ee,layoutVertexBuffer:Ce,indexBuffer:Me,uniformValues:An(d,re,pe,_),terrainData:Ke};if(L){const Be=fe.segments.get();for(const ht of Be)ue.push({segments:new a.S([ht]),sortKey:ht.sortKey,state:Tt})}else ue.push({segments:fe.segments,sortKey:0,state:Tt})}L&&ue.sort((K,re)=>K.sortKey-re.sortKey);for(const K of ue){const{programConfiguration:re,program:pe,layoutVertexBuffer:fe,indexBuffer:xe,uniformValues:Ee,terrainData:Ce}=K.state;pe.draw(U,V.TRIANGLES,Z,$,ie,ai.disabled,Ee,Ce,_.id,fe,xe,K.segments,_.paint,d.transform.zoom,re)}})(t,n,o,c);break;case"heatmap":(function(d,g,_,x){if(_.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){const S=d.context,I=S.gl,A=ui.disabled,L=new ci([I.ONE,I.ONE],a.aT.transparent,[!0,!0,!0,!0]);(function(U,V,Z){const $=U.gl;U.activeTexture.set($.TEXTURE1),U.viewport.set([0,0,V.width/4,V.height/4]);let ie=Z.heatmapFbo;if(ie)$.bindTexture($.TEXTURE_2D,ie.colorAttachment.get()),U.bindFramebuffer.set(ie.framebuffer);else{const ue=$.createTexture();$.bindTexture($.TEXTURE_2D,ue),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_S,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_T,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MIN_FILTER,$.LINEAR),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MAG_FILTER,$.LINEAR),ie=Z.heatmapFbo=U.createFramebuffer(V.width/4,V.height/4,!1,!1),function(K,re,pe,fe){var xe,Ee;const Ce=K.gl,Me=(xe=K.HALF_FLOAT)!==null&&xe!==void 0?xe:Ce.UNSIGNED_BYTE,Ke=(Ee=K.RGBA16F)!==null&&Ee!==void 0?Ee:Ce.RGBA;Ce.texImage2D(Ce.TEXTURE_2D,0,Ke,re.width/4,re.height/4,0,Ce.RGBA,Me,null),fe.colorAttachment.set(pe)}(U,V,ue,ie)}})(S,d,_),S.clear({color:a.aT.transparent});for(let U=0;U<x.length;U++){const V=x[U];if(g.hasRenderableParent(V))continue;const Z=g.getTile(V),$=Z.getBucket(_);if(!$)continue;const ie=$.programConfigurations.get(_.id),ue=d.useProgram("heatmap",ie),{zoom:K}=d.transform;ue.draw(S,I.TRIANGLES,Dt.disabled,A,L,ai.disabled,Mc(V.posMatrix,Z,K,_.paint.get("heatmap-intensity")),null,_.id,$.layoutVertexBuffer,$.indexBuffer,$.segments,_.paint,d.transform.zoom,ie)}S.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),function(S,I){const A=S.context,L=A.gl,U=I.heatmapFbo;if(!U)return;A.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,U.colorAttachment.get()),A.activeTexture.set(L.TEXTURE1);let V=I.colorRampTexture;V||(V=I.colorRampTexture=new Pe(A,I.colorRamp,L.RGBA)),V.bind(L.LINEAR,L.CLAMP_TO_EDGE),S.useProgram("heatmapTexture").draw(A,L.TRIANGLES,Dt.disabled,ui.disabled,S.colorModeForRenderPass(),ai.disabled,((Z,$,ie,ue)=>{const K=a.Z();a.aS(K,0,Z.width,Z.height,0,0,1);const re=Z.context.gl;return{u_matrix:K,u_world:[re.drawingBufferWidth,re.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:$.paint.get("heatmap-opacity")}})(S,I),null,I.id,S.viewportBuffer,S.quadTriangleIndexBuffer,S.viewportSegments,I.paint,S.transform.zoom)}(d,_))})(t,n,o,c);break;case"line":(function(d,g,_,x){if(d.renderPass!=="translucent")return;const S=_.paint.get("line-opacity"),I=_.paint.get("line-width");if(S.constantOr(1)===0||I.constantOr(1)===0)return;const A=d.depthModeForSublayer(0,Dt.ReadOnly),L=d.colorModeForRenderPass(),U=_.paint.get("line-dasharray"),V=_.paint.get("line-pattern"),Z=V.constantOr(1),$=_.paint.get("line-gradient"),ie=_.getCrossfadeParameters(),ue=Z?"linePattern":U?"lineSDF":$?"lineGradient":"line",K=d.context,re=K.gl;let pe=!0;for(const fe of x){const xe=g.getTile(fe);if(Z&&!xe.patternsLoaded())continue;const Ee=xe.getBucket(_);if(!Ee)continue;const Ce=Ee.programConfigurations.get(_.id),Me=d.context.program.get(),Ke=d.useProgram(ue,Ce),Tt=pe||Ke.program!==Me,Be=d.style.map.terrain&&d.style.map.terrain.getTerrainData(fe),ht=V.constantOr(null);if(ht&&xe.imageAtlas){const Ct=xe.imageAtlas,bt=Ct.patternPositions[ht.to.toString()],It=Ct.patternPositions[ht.from.toString()];bt&&It&&Ce.setConstantPatternPositions(bt,It)}const Ye=Be?fe:null,Zt=Z?kc(d,xe,_,ie,Ye):U?ll(d,xe,_,U,ie,Ye):$?ol(d,xe,_,Ee.lineClipsArray.length,Ye):Ha(d,xe,_,Ye);if(Z)K.activeTexture.set(re.TEXTURE0),xe.imageAtlasTexture.bind(re.LINEAR,re.CLAMP_TO_EDGE),Ce.updatePaintBuffers(ie);else if(U&&(Tt||d.lineAtlas.dirty))K.activeTexture.set(re.TEXTURE0),d.lineAtlas.bind(K);else if($){const Ct=Ee.gradients[_.id];let bt=Ct.texture;if(_.gradientVersion!==Ct.version){let It=256;if(_.stepInterpolant){const yi=g.getSource().maxzoom,ei=fe.canonical.z===yi?Math.ceil(1<<d.transform.maxZoom-fe.canonical.z):1;It=a.ad(a.aY(Ee.maxLineLength/a.N*1024*ei),256,K.maxTextureSize)}Ct.gradient=a.aZ({expression:_.gradientExpression(),evaluationKey:"lineProgress",resolution:It,image:Ct.gradient||void 0,clips:Ee.lineClipsArray}),Ct.texture?Ct.texture.update(Ct.gradient):Ct.texture=new Pe(K,Ct.gradient,re.RGBA),Ct.version=_.gradientVersion,bt=Ct.texture}K.activeTexture.set(re.TEXTURE0),bt.bind(_.stepInterpolant?re.NEAREST:re.LINEAR,re.CLAMP_TO_EDGE)}Ke.draw(K,re.TRIANGLES,A,d.stencilModeForClipping(fe),L,ai.disabled,Zt,Be,_.id,Ee.layoutVertexBuffer,Ee.indexBuffer,Ee.segments,_.paint,d.transform.zoom,Ce,Ee.layoutVertexBuffer2),pe=!1}})(t,n,o,c);break;case"fill":(function(d,g,_,x){const S=_.paint.get("fill-color"),I=_.paint.get("fill-opacity");if(I.constantOr(1)===0)return;const A=d.colorModeForRenderPass(),L=_.paint.get("fill-pattern"),U=d.opaquePassEnabledForLayer()&&!L.constantOr(1)&&S.constantOr(a.aT.transparent).a===1&&I.constantOr(0)===1?"opaque":"translucent";if(d.renderPass===U){const V=d.depthModeForSublayer(1,d.renderPass==="opaque"?Dt.ReadWrite:Dt.ReadOnly);Ms(d,g,_,x,V,A,!1)}if(d.renderPass==="translucent"&&_.paint.get("fill-antialias")){const V=d.depthModeForSublayer(_.getPaintProperty("fill-outline-color")?2:0,Dt.ReadOnly);Ms(d,g,_,x,V,A,!0)}})(t,n,o,c);break;case"fill-extrusion":(function(d,g,_,x){const S=_.paint.get("fill-extrusion-opacity");if(S!==0&&d.renderPass==="translucent"){const I=new Dt(d.context.gl.LEQUAL,Dt.ReadWrite,d.depthRangeFor3D);if(S!==1||_.paint.get("fill-extrusion-pattern").constantOr(1))ks(d,g,_,x,I,ui.disabled,ci.disabled),ks(d,g,_,x,I,d.stencilModeFor3D(),d.colorModeForRenderPass());else{const A=d.colorModeForRenderPass();ks(d,g,_,x,I,ui.disabled,A)}}})(t,n,o,c);break;case"hillshade":(function(d,g,_,x){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent")return;const S=d.context,I=d.depthModeForSublayer(0,Dt.ReadOnly),A=d.colorModeForRenderPass(),[L,U]=d.renderPass==="translucent"?d.stencilConfigForOverlap(x):[{},x];for(const V of U){const Z=g.getTile(V);Z.needsHillshadePrepare!==void 0&&Z.needsHillshadePrepare&&d.renderPass==="offscreen"?co(d,Z,_,I,ui.disabled,A):d.renderPass==="translucent"&&Nc(d,V,Z,_,I,L[V.overscaledZ],A)}S.viewport.set([0,0,d.width,d.height])})(t,n,o,c);break;case"raster":(function(d,g,_,x){if(d.renderPass!=="translucent"||_.paint.get("raster-opacity")===0||!x.length)return;const S=d.context,I=S.gl,A=g.getSource(),L=d.useProgram("raster"),U=d.colorModeForRenderPass(),[V,Z]=A instanceof Rt?[{},x]:d.stencilConfigForOverlap(x),$=Z[Z.length-1].overscaledZ,ie=!d.options.moving;for(const ue of Z){const K=d.depthModeForSublayer(ue.overscaledZ-$,_.paint.get("raster-opacity")===1?Dt.ReadWrite:Dt.ReadOnly,I.LESS),re=g.getTile(ue);re.registerFadeDuration(_.paint.get("raster-fade-duration"));const pe=g.findLoadedParent(ue,0),fe=$c(re,pe,g,_,d.transform,d.style.map.terrain);let xe,Ee;const Ce=_.paint.get("raster-resampling")==="nearest"?I.NEAREST:I.LINEAR;S.activeTexture.set(I.TEXTURE0),re.texture.bind(Ce,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),S.activeTexture.set(I.TEXTURE1),pe?(pe.texture.bind(Ce,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),xe=Math.pow(2,pe.tileID.overscaledZ-re.tileID.overscaledZ),Ee=[re.tileID.canonical.x*xe%1,re.tileID.canonical.y*xe%1]):re.texture.bind(Ce,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST);const Me=d.style.map.terrain&&d.style.map.terrain.getTerrainData(ue),Ke=Me?ue:null,Tt=Ke?Ke.posMatrix:d.transform.calculatePosMatrix(ue.toUnwrapped(),ie),Be=ul(Tt,Ee||[0,0],xe||1,fe,_);A instanceof Rt?L.draw(S,I.TRIANGLES,K,ui.disabled,U,ai.disabled,Be,Me,_.id,A.boundsBuffer,d.quadTriangleIndexBuffer,A.boundsSegments):L.draw(S,I.TRIANGLES,K,V[ue.overscaledZ],U,ai.disabled,Be,Me,_.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments)}})(t,n,o,c);break;case"background":(function(d,g,_,x){const S=_.paint.get("background-color"),I=_.paint.get("background-opacity");if(I===0)return;const A=d.context,L=A.gl,U=d.transform,V=U.tileSize,Z=_.paint.get("background-pattern");if(d.isPatternMissing(Z))return;const $=!Z&&S.a===1&&I===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==$)return;const ie=ui.disabled,ue=d.depthModeForSublayer(0,$==="opaque"?Dt.ReadWrite:Dt.ReadOnly),K=d.colorModeForRenderPass(),re=d.useProgram(Z?"backgroundPattern":"background"),pe=x||U.coveringTiles({tileSize:V,terrain:d.style.map.terrain});Z&&(A.activeTexture.set(L.TEXTURE0),d.imageManager.bind(d.context));const fe=_.getCrossfadeParameters();for(const xe of pe){const Ee=x?xe.posMatrix:d.transform.calculatePosMatrix(xe.toUnwrapped()),Ce=Z?Nr(Ee,I,d,Z,{tileID:xe,tileSize:V},fe):ra(Ee,I,S),Me=d.style.map.terrain&&d.style.map.terrain.getTerrainData(xe);re.draw(A,L.TRIANGLES,ue,ie,K,ai.disabled,Ce,Me,_.id,d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}})(t,0,o,c);break;case"custom":(function(d,g,_){const x=d.context,S=_.implementation;if(d.renderPass==="offscreen"){const I=S.prerender;I&&(d.setCustomLayerDefaults(),x.setColorMode(d.colorModeForRenderPass()),I.call(S,x.gl,d.transform.customLayerMatrix()),x.setDirty(),d.setBaseState())}else if(d.renderPass==="translucent"){d.setCustomLayerDefaults(),x.setColorMode(d.colorModeForRenderPass()),x.setStencilMode(ui.disabled);const I=S.renderingMode==="3d"?new Dt(d.context.gl.LEQUAL,Dt.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,Dt.ReadOnly);x.setDepthMode(I),S.render(x.gl,d.transform.customLayerMatrix()),x.setDirty(),d.setBaseState(),x.bindFramebuffer.set(null)}})(t,0,o)}}translatePosMatrix(t,n,o,c,d){if(!o[0]&&!o[1])return t;const g=d?c==="map"?this.transform.angle:0:c==="viewport"?-this.transform.angle:0;if(g){const S=Math.sin(g),I=Math.cos(g);o=[o[0]*I-o[1]*S,o[0]*S+o[1]*I]}const _=[d?o[0]:te(n,o[0],this.transform.zoom),d?o[1]:te(n,o[1],this.transform.zoom),0],x=new Float32Array(16);return a.$(x,t,_),x}saveTileTexture(t){const n=this._tileTextures[t.size[0]];n?n.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const n=this._tileTextures[t];return n&&n.length>0?n.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const n=this.imageManager.getPattern(t.from.toString()),o=this.imageManager.getPattern(t.to.toString());return!n||!o}useProgram(t,n){this.cache=this.cache||{};const o=t+(n?n.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[o]||(this.cache[o]=new Qs(this.context,li[t],n,na[t],this._showOverdrawInspector,this.style.map.terrain)),this.cache[o]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Pe(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:n}=this.context.gl;return this.width!==t||this.height!==n}}class gr{constructor(t,n){this.points=t,this.planes=n}static fromInvProjectionMatrix(t,n,o){const c=Math.pow(2,o),d=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(_=>{const x=1/(_=a.ag([],_,t))[3]/n*c;return a.b3(_,_,[x,x,1/_[3],x])}),g=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(_=>{const x=function(L,U){var V=U[0],Z=U[1],$=U[2],ie=V*V+Z*Z+$*$;return ie>0&&(ie=1/Math.sqrt(ie)),L[0]=U[0]*ie,L[1]=U[1]*ie,L[2]=U[2]*ie,L}([],function(L,U,V){var Z=U[0],$=U[1],ie=U[2],ue=V[0],K=V[1],re=V[2];return L[0]=$*re-ie*K,L[1]=ie*ue-Z*re,L[2]=Z*K-$*ue,L}([],rt([],d[_[0]],d[_[1]]),rt([],d[_[2]],d[_[1]]))),S=-((I=x)[0]*(A=d[_[1]])[0]+I[1]*A[1]+I[2]*A[2]);var I,A;return x.concat(S)});return new gr(d,g)}}class ls{constructor(t,n){this.min=t,this.max=n,this.center=function(o,c,d){return o[0]=.5*c[0],o[1]=.5*c[1],o[2]=.5*c[2],o}([],function(o,c,d){return o[0]=c[0]+d[0],o[1]=c[1]+d[1],o[2]=c[2]+d[2],o}([],this.min,this.max))}quadrant(t){const n=[t%2==0,t<2],o=ye(this.min),c=ye(this.max);for(let d=0;d<n.length;d++)o[d]=n[d]?this.min[d]:this.center[d],c[d]=n[d]?this.center[d]:this.max[d];return c[2]=this.max[2],new ls(o,c)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const n=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let o=!0;for(let c=0;c<t.planes.length;c++){const d=t.planes[c];let g=0;for(let _=0;_<n.length;_++)a.b4(d,n[_])>=0&&g++;if(g===0)return 0;g!==n.length&&(o=!1)}if(o)return 2;for(let c=0;c<3;c++){let d=Number.MAX_VALUE,g=-Number.MAX_VALUE;for(let _=0;_<t.points.length;_++){const x=t.points[_][c]-this.min[c];d=Math.min(d,x),g=Math.max(g,x)}if(g<0||d>this.max[c]-this.min[c])return 0}return 1}}class Ds{constructor(t=0,n=0,o=0,c=0){if(isNaN(t)||t<0||isNaN(n)||n<0||isNaN(o)||o<0||isNaN(c)||c<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=n,this.left=o,this.right=c}interpolate(t,n,o){return n.top!=null&&t.top!=null&&(this.top=a.B.number(t.top,n.top,o)),n.bottom!=null&&t.bottom!=null&&(this.bottom=a.B.number(t.bottom,n.bottom,o)),n.left!=null&&t.left!=null&&(this.left=a.B.number(t.left,n.left,o)),n.right!=null&&t.right!=null&&(this.right=a.B.number(t.right,n.right,o)),this}getCenter(t,n){const o=a.ad((this.left+t-this.right)/2,0,t),c=a.ad((this.top+n-this.bottom)/2,0,n);return new a.P(o,c)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Ds(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class va{constructor(t,n,o,c,d){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=d===void 0||!!d,this._minZoom=t||0,this._maxZoom=n||22,this._minPitch=o??0,this._maxPitch=c??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new a.L(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Ds,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const t=new va(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this._minEleveationForCurrentTile=t._minEleveationForCurrentTile,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const n=-a.b5(t,-180,180)*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=function(){var o=new a.A(4);return a.A!=Float32Array&&(o[1]=0,o[2]=0),o[0]=1,o[3]=1,o}(),function(o,c,d){var g=c[0],_=c[1],x=c[2],S=c[3],I=Math.sin(d),A=Math.cos(d);o[0]=g*A+x*I,o[1]=_*A+S*I,o[2]=g*-I+x*A,o[3]=_*-I+S*A}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const n=a.ad(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const n=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==n&&(this._unmodified=!1,this._zoom=n,this.tileZoom=Math.max(0,Math.floor(n)),this.scale=this.zoomScale(n),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,n,o){this._unmodified=!1,this._edgeInsets.interpolate(t,n,o),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const n=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,n)}getVisibleUnwrappedCoordinates(t){const n=[new a.b6(0,t)];if(this._renderWorldCopies){const o=this.pointCoordinate(new a.P(0,0)),c=this.pointCoordinate(new a.P(this.width,0)),d=this.pointCoordinate(new a.P(this.width,this.height)),g=this.pointCoordinate(new a.P(0,this.height)),_=Math.floor(Math.min(o.x,c.x,d.x,g.x)),x=Math.floor(Math.max(o.x,c.x,d.x,g.x)),S=1;for(let I=_-S;I<=x+S;I++)I!==0&&n.push(new a.b6(I,t))}return n}coveringTiles(t){var n,o;let c=this.coveringZoomLevel(t);const d=c;if(t.minzoom!==void 0&&c<t.minzoom)return[];t.maxzoom!==void 0&&c>t.maxzoom&&(c=t.maxzoom);const g=this.pointCoordinate(this.getCameraPoint()),_=a.U.fromLngLat(this.center),x=Math.pow(2,c),S=[x*g.x,x*g.y,0],I=[x*_.x,x*_.y,0],A=gr.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c);let L=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(L=c);const U=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,V=K=>({aabb:new ls([K*x,0,0],[(K+1)*x,x,0]),zoom:0,x:0,y:0,wrap:K,fullyVisible:!1}),Z=[],$=[],ie=c,ue=t.reparseOverscaled?d:c;if(this._renderWorldCopies)for(let K=1;K<=3;K++)Z.push(V(-K)),Z.push(V(K));for(Z.push(V(0));Z.length>0;){const K=Z.pop(),re=K.x,pe=K.y;let fe=K.fullyVisible;if(!fe){const Ke=K.aabb.intersects(A);if(Ke===0)continue;fe=Ke===2}const xe=t.terrain?S:I,Ee=K.aabb.distanceX(xe),Ce=K.aabb.distanceY(xe),Me=Math.max(Math.abs(Ee),Math.abs(Ce));if(K.zoom===ie||Me>U+(1<<ie-K.zoom)-2&&K.zoom>=L){const Ke=ie-K.zoom,Tt=S[0]-.5-(re<<Ke),Be=S[1]-.5-(pe<<Ke);$.push({tileID:new a.O(K.zoom===ie?ue:K.zoom,K.wrap,K.zoom,re,pe),distanceSq:et([I[0]-.5-re,I[1]-.5-pe]),tileDistanceToCamera:Math.sqrt(Tt*Tt+Be*Be)})}else for(let Ke=0;Ke<4;Ke++){const Tt=(re<<1)+Ke%2,Be=(pe<<1)+(Ke>>1),ht=K.zoom+1;let Ye=K.aabb.quadrant(Ke);if(t.terrain){const Zt=new a.O(ht,K.wrap,ht,Tt,Be),Ct=t.terrain.getMinMaxElevation(Zt),bt=(n=Ct.minElevation)!==null&&n!==void 0?n:this.elevation,It=(o=Ct.maxElevation)!==null&&o!==void 0?o:this.elevation;Ye=new ls([Ye.min[0],Ye.min[1],bt],[Ye.max[0],Ye.max[1],It])}Z.push({aabb:Ye,zoom:ht,x:Tt,y:Be,wrap:K.wrap,fullyVisible:fe})}}return $.sort((K,re)=>K.distanceSq-re.distanceSq).map(K=>K.tileID)}resize(t,n){this.width=t,this.height=n,this.pixelsToGLUnits=[2/t,-2/n],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const n=a.ad(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new a.P(a.G(t.lng)*this.worldSize,a.H(n)*this.worldSize)}unproject(t){return new a.U(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const n=this.pointLocation(this.centerPoint,t),o=t.getElevationForLngLatZoom(n,this.tileZoom);if(!(this.elevation-o))return;const c=this.getCameraPosition(),d=a.U.fromLngLat(c.lngLat,c.altitude),g=a.U.fromLngLat(n,o),_=d.x-g.x,x=d.y-g.y,S=d.z-g.z,I=Math.sqrt(_*_+x*x+S*S),A=this.scaleZoom(this.cameraToCenterDistance/I/this.tileSize);this._elevation=o,this._center=n,this.zoom=A}setLocationAtPoint(t,n){const o=this.pointCoordinate(n),c=this.pointCoordinate(this.centerPoint),d=this.locationCoordinate(t),g=new a.U(d.x-(o.x-c.x),d.y-(o.y-c.y));this.center=this.coordinateLocation(g),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,n){return n?this.coordinatePoint(this.locationCoordinate(t),n.getElevationForLngLatZoom(t,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,n){return this.coordinateLocation(this.pointCoordinate(t,n))}locationCoordinate(t){return a.U.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,n){if(n){const L=n.pointCoordinate(t);if(L!=null)return L}const o=[t.x,t.y,0,1],c=[t.x,t.y,1,1];a.ag(o,o,this.pixelMatrixInverse),a.ag(c,c,this.pixelMatrixInverse);const d=o[3],g=c[3],_=o[1]/d,x=c[1]/g,S=o[2]/d,I=c[2]/g,A=S===I?0:(0-S)/(I-S);return new a.U(a.B.number(o[0]/d,c[0]/g,A)/this.worldSize,a.B.number(_,x,A)/this.worldSize)}coordinatePoint(t,n=0,o=this.pixelMatrix){const c=[t.x*this.worldSize,t.y*this.worldSize,n,1];return a.ag(c,c,o),new a.P(c[0]/c[3],c[1]/c[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new qe().extend(this.pointLocation(new a.P(0,t))).extend(this.pointLocation(new a.P(this.width,t))).extend(this.pointLocation(new a.P(this.width,this.height))).extend(this.pointLocation(new a.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new qe([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(t,n=!1){const o=t.key,c=n?this._alignedPosMatrixCache:this._posMatrixCache;if(c[o])return c[o];const d=t.canonical,g=this.worldSize/this.zoomScale(d.z),_=d.x+Math.pow(2,d.z)*t.wrap,x=a.ao(new Float64Array(16));return a.$(x,x,[_*g,d.y*g,0]),a.a0(x,x,[g/a.N,g/a.N,1]),a.a1(x,n?this.alignedProjMatrix:this.projMatrix,x),c[o]=new Float32Array(x),c[o]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t,n,o,c,d=-90,g=90,_=-180,x=180;const S=this.size,I=this._unmodified;if(this.latRange){const U=this.latRange;d=a.H(U[1])*this.worldSize,g=a.H(U[0])*this.worldSize,t=g-d<S.y?S.y/(g-d):0}if(this.lngRange){const U=this.lngRange;_=a.b5(a.G(U[0])*this.worldSize,0,this.worldSize),x=a.b5(a.G(U[1])*this.worldSize,0,this.worldSize),x<_&&(x+=this.worldSize),n=x-_<S.x?S.x/(x-_):0}const A=this.point,L=Math.max(n||0,t||0);if(L)return this.center=this.unproject(new a.P(n?(x+_)/2:A.x,t?(g+d)/2:A.y)),this.zoom+=this.scaleZoom(L),this._unmodified=I,void(this._constraining=!1);if(this.latRange){const U=A.y,V=S.y/2;U-V<d&&(c=d+V),U+V>g&&(c=g-V)}if(this.lngRange){const U=(_+x)/2,V=a.b5(A.x,U-this.worldSize/2,U+this.worldSize/2),Z=S.x/2;V-Z<_&&(o=_+Z),V+Z>x&&(o=x-Z)}o===void 0&&c===void 0||(this.center=this.unproject(new a.P(o!==void 0?o:A.x,c!==void 0?c:A.y)).wrap()),this._unmodified=I,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,n=this.point.x,o=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=a.b7(1,this.center.lat)*this.worldSize;let c=a.ao(new Float64Array(16));a.a0(c,c,[this.width/2,-this.height/2,1]),a.$(c,c,[1,-1,0]),this.labelPlaneMatrix=c,c=a.ao(new Float64Array(16)),a.a0(c,c,[1,-1,1]),a.$(c,c,[-1,-1,0]),a.a0(c,c,[2/this.width,2/this.height,1]),this.glCoordMatrix=c;const d=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),g=Math.min(this.elevation,this._minEleveationForCurrentTile),_=d-g*this._pixelPerMeter/Math.cos(this._pitch),x=g<0?_:d,S=Math.PI/2+this._pitch,I=this._fov*(.5+t.y/this.height),A=Math.sin(I)*x/Math.sin(a.ad(Math.PI-S-I,.01,Math.PI-.01)),L=this.getHorizon(),U=2*Math.atan(L/this.cameraToCenterDistance)*(.5+t.y/(2*L)),V=Math.sin(U)*x/Math.sin(a.ad(Math.PI-S-U,.01,Math.PI-.01)),Z=Math.min(A,V),$=1.01*(Math.cos(Math.PI/2-this._pitch)*Z+x),ie=this.height/50;c=new Float64Array(16),a.b8(c,this._fov,this.width/this.height,ie,$),c[8]=2*-t.x/this.width,c[9]=2*t.y/this.height,a.a0(c,c,[1,-1,1]),a.$(c,c,[0,0,-this.cameraToCenterDistance]),a.b9(c,c,this._pitch),a.ae(c,c,this.angle),a.$(c,c,[-n,-o,0]),this.mercatorMatrix=a.a0([],c,[this.worldSize,this.worldSize,this.worldSize]),a.a0(c,c,[1,1,this._pixelPerMeter]),this.pixelMatrix=a.a1(new Float64Array(16),this.labelPlaneMatrix,c),a.$(c,c,[0,0,-this.elevation]),this.projMatrix=c,this.invProjMatrix=a.as([],c),this.pixelMatrix3D=a.a1(new Float64Array(16),this.labelPlaneMatrix,c);const ue=this.width%2/2,K=this.height%2/2,re=Math.cos(this.angle),pe=Math.sin(this.angle),fe=n-Math.round(n)+re*ue+pe*K,xe=o-Math.round(o)+re*K+pe*ue,Ee=new Float64Array(c);if(a.$(Ee,Ee,[fe>.5?fe-1:fe,xe>.5?xe-1:xe,0]),this.alignedProjMatrix=Ee,c=a.as(new Float64Array(16),this.pixelMatrix),!c)throw new Error("failed to invert matrix");this.pixelMatrixInverse=c,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new a.P(0,0)),n=[t.x*this.worldSize,t.y*this.worldSize,0,1];return a.ag(n,n,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(0,t))}getCameraQueryGeometry(t){const n=this.getCameraPoint();if(t.length===1)return[t[0],n];{let o=n.x,c=n.y,d=n.x,g=n.y;for(const _ of t)o=Math.min(o,_.x),c=Math.min(c,_.y),d=Math.max(d,_.x),g=Math.max(g,_.y);return[new a.P(o,c),new a.P(d,c),new a.P(d,g),new a.P(o,g),new a.P(o,c)]}}}function Un(u,t){let n,o=!1,c=null,d=null;const g=()=>{c=null,o&&(u.apply(d,n),c=setTimeout(g,t),o=!1)};return(..._)=>(o=!0,d=this,n=_,c||g(),c)}class Ls{constructor(t){this._getCurrentHash=()=>{const n=window.location.hash.replace("#","");if(this._hashName){let o;return n.split("&").map(c=>c.split("=")).forEach(c=>{c[0]===this._hashName&&(o=c)}),(o&&o[1]||"").split("/")}return n.split("/")},this._onHashChange=()=>{const n=this._getCurrentHash();if(n.length>=3&&!n.some(o=>isNaN(o))){const o=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:o,pitch:+(n[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const n=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,n)}catch{}},this._updateHash=Un(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const n=this._map.getCenter(),o=Math.round(100*this._map.getZoom())/100,c=Math.ceil((o*Math.LN2+Math.log(512/360/.5))/Math.LN10),d=Math.pow(10,c),g=Math.round(n.lng*d)/d,_=Math.round(n.lat*d)/d,x=this._map.getBearing(),S=this._map.getPitch();let I="";if(I+=t?`/${g}/${_}/${o}`:`${o}/${_}/${g}`,(x||S)&&(I+="/"+Math.round(10*x)/10),S&&(I+=`/${Math.round(S)}`),this._hashName){const A=this._hashName;let L=!1;const U=window.location.hash.slice(1).split("&").map(V=>{const Z=V.split("=")[0];return Z===A?(L=!0,`${Z}=${I}`):V}).filter(V=>V);return L||U.push(`${A}=${I}`),`#${U.join("&")}`}return`#${I}`}}const cs={linearity:.3,easing:a.ba(0,0,.3,1)},Sl=a.e({deceleration:2500,maxSpeed:1400},cs),Cl=a.e({deceleration:20,maxSpeed:1400},cs),Tl=a.e({deceleration:1e3,maxSpeed:360},cs),Il=a.e({deceleration:1e3,maxSpeed:90},cs);class El{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.h.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,n=a.h.now();for(;t.length>0&&n-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:d}of this._inertiaBuffer)n.zoom+=d.zoomDelta||0,n.bearing+=d.bearingDelta||0,n.pitch+=d.pitchDelta||0,d.panDelta&&n.pan._add(d.panDelta),d.around&&(n.around=d.around),d.pinchAround&&(n.pinchAround=d.pinchAround);const o=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,c={};if(n.pan.mag()){const d=Rs(n.pan.mag(),o,a.e({},Sl,t||{}));c.offset=n.pan.mult(d.amount/n.pan.mag()),c.center=this._map.transform.center,tn(c,d)}if(n.zoom){const d=Rs(n.zoom,o,Cl);c.zoom=this._map.transform.zoom+d.amount,tn(c,d)}if(n.bearing){const d=Rs(n.bearing,o,Tl);c.bearing=this._map.transform.bearing+a.ad(d.amount,-179,179),tn(c,d)}if(n.pitch){const d=Rs(n.pitch,o,Il);c.pitch=this._map.transform.pitch+d.amount,tn(c,d)}if(c.zoom||c.bearing){const d=n.pinchAround===void 0?n.around:n.pinchAround;c.around=d?this._map.unproject(d):this._map.getCenter()}return this.clear(),a.e(c,{noMoveStart:!0})}}function tn(u,t){(!u.duration||u.duration<t.duration)&&(u.duration=t.duration,u.easing=t.easing)}function Rs(u,t,n){const{maxSpeed:o,linearity:c,deceleration:d}=n,g=a.ad(u*c/(t/1e3),-o,o),_=Math.abs(g)/(d*c);return{easing:n.easing,duration:1e3*_,amount:g*(_/2)}}class Ar extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,o,c={}){const d=B.mousePos(n.getCanvasContainer(),o),g=n.unproject(d);super(t,a.e({point:d,lngLat:g,originalEvent:o},c)),this._defaultPrevented=!1,this.target=n}}class Fs extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,o){const c=t==="touchend"?o.changedTouches:o.touches,d=B.touchPos(n.getCanvasContainer(),c),g=d.map(x=>n.unproject(x)),_=d.reduce((x,S,I,A)=>x.add(S.div(A.length)),new a.P(0,0));super(t,{points:d,point:_,lngLats:g,lngLat:n.unproject(_),originalEvent:o}),this._defaultPrevented=!1}}class Al extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,o){super(t,{originalEvent:o}),this._defaultPrevented=!1}}class Pl{constructor(t,n){this._map=t,this._clickTolerance=n.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new Al(t.type,this._map,t))}mousedown(t,n){return this._mousedownPos=n,this._firePreventable(new Ar(t.type,this._map,t))}mouseup(t){this._map.fire(new Ar(t.type,this._map,t))}click(t,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||this._map.fire(new Ar(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Ar(t.type,this._map,t))}mouseover(t){this._map.fire(new Ar(t.type,this._map,t))}mouseout(t){this._map.fire(new Ar(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Fs(t.type,this._map,t))}touchmove(t){this._map.fire(new Fs(t.type,this._map,t))}touchend(t){this._map.fire(new Fs(t.type,this._map,t))}touchcancel(t){this._map.fire(new Fs(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ml{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Ar(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ar("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Ar(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class dn{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(a.P.convert(t),this._map.terrain)}}class kl{constructor(t,n){this._map=t,this._tr=new dn(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,n){this.isEnabled()&&t.shiftKey&&t.button===0&&(B.disableDrag(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(t,n){if(!this._active)return;const o=n;if(this._lastPos.equals(o)||!this._box&&o.dist(this._startPos)<this._clickTolerance)return;const c=this._startPos;this._lastPos=o,this._box||(this._box=B.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const d=Math.min(c.x,o.x),g=Math.max(c.x,o.x),_=Math.min(c.y,o.y),x=Math.max(c.y,o.y);B.setTransform(this._box,`translate(${d}px,${_}px)`),this._box.style.width=g-d+"px",this._box.style.height=x-_+"px"}mouseupWindow(t,n){if(!this._active||t.button!==0)return;const o=this._startPos,c=n;if(this.reset(),B.suppressClick(),o.x!==c.x||o.y!==c.y)return this._map.fire(new a.k("boxzoomend",{originalEvent:t})),{cameraAnimation:d=>d.fitScreenCoordinates(o,c,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(B.remove(this._box),this._box=null),B.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,n){return this._map.fire(new a.k(t,{originalEvent:n}))}}function $r(u,t){if(u.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${u.length}, points ${t.length}`);const n={};for(let o=0;o<u.length;o++)n[u[o].identifier]=t[o];return n}class pn{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,n,o){(this.centroid||o.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),o.length===this.numTouches&&(this.centroid=function(c){const d=new a.P(0,0);for(const g of c)d._add(g);return d.div(c.length)}(n),this.touches=$r(o,n)))}touchmove(t,n,o){if(this.aborted||!this.centroid)return;const c=$r(o,n);for(const d in this.touches){const g=c[d];(!g||g.dist(this.touches[d])>30)&&(this.aborted=!0)}}touchend(t,n,o){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),o.length===0){const c=!this.aborted&&this.centroid;if(this.reset(),c)return c}}}class xa{constructor(t){this.singleTap=new pn(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,n,o){this.singleTap.touchstart(t,n,o)}touchmove(t,n,o){this.singleTap.touchmove(t,n,o)}touchend(t,n,o){const c=this.singleTap.touchend(t,n,o);if(c){const d=t.timeStamp-this.lastTime<500,g=!this.lastTap||this.lastTap.dist(c)<30;if(d&&g||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=c,this.count===this.numTaps)return this.reset(),c}}}class fn{constructor(t){this._tr=new dn(t),this._zoomIn=new xa({numTouches:1,numTaps:2}),this._zoomOut=new xa({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,n,o){this._zoomIn.touchstart(t,n,o),this._zoomOut.touchstart(t,n,o)}touchmove(t,n,o){this._zoomIn.touchmove(t,n,o),this._zoomOut.touchmove(t,n,o)}touchend(t,n,o){const c=this._zoomIn.touchend(t,n,o),d=this._zoomOut.touchend(t,n,o),g=this._tr;return c?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:_=>_.easeTo({duration:300,zoom:g.zoom+1,around:g.unproject(c)},{originalEvent:t})}):d?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:_=>_.easeTo({duration:300,zoom:g.zoom-1,around:g.unproject(d)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class mn{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const n=this._moveFunction(...t);if(n.bearingDelta||n.pitchDelta||n.around||n.panDelta)return this._active=!0,n}dragStart(t,n){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=n.length?n[0]:n,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,n){if(!this.isEnabled())return;const o=this._lastPoint;if(!o)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const c=n.length?n[0]:n;return!this._moved&&c.dist(o)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=c,this._move(o,c))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&B.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const jc={0:1,2:2};class ho{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const n=B.mouseButton(t);this._eventButton=n}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(n,o){const c=jc[o];return n.buttons===void 0||(n.buttons&c)!==c}(t,this._eventButton)}isValidEndEvent(t){return B.mouseButton(t)===this._eventButton}}class zl{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}const ba=u=>{u.mousedown=u.dragStart,u.mousemoveWindow=u.dragMove,u.mouseup=u.dragEnd,u.contextmenu=function(t){t.preventDefault()}},us=({enable:u,clickTolerance:t,bearingDegreesPerPixelMoved:n=.8})=>{const o=new ho({checkCorrectEvent:c=>B.mouseButton(c)===0&&c.ctrlKey||B.mouseButton(c)===2});return new mn({clickTolerance:t,move:(c,d)=>({bearingDelta:(d.x-c.x)*n}),moveStateManager:o,enable:u,assignEvents:ba})},gn=({enable:u,clickTolerance:t,pitchDegreesPerPixelMoved:n=-.5})=>{const o=new ho({checkCorrectEvent:c=>B.mouseButton(c)===0&&c.ctrlKey||B.mouseButton(c)===2});return new mn({clickTolerance:t,move:(c,d)=>({pitchDelta:(d.y-c.y)*n}),moveStateManager:o,enable:u,assignEvents:ba})};class Ge{constructor(t,n){this._minTouches=t.cooperativeGestures?2:1,this._clickTolerance=t.clickTolerance||1,this._map=n,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(t,n,o){return this._calculateTransform(t,n,o)}touchmove(t,n,o){if(this._map._cooperativeGestures&&(this._minTouches===2&&o.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(t,!1,o.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(o.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,n,o)}touchend(t,n,o){this._calculateTransform(t,n,o),this._active&&o.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,n,o){o.length>0&&(this._active=!0);const c=$r(o,n),d=new a.P(0,0),g=new a.P(0,0);let _=0;for(const S in c){const I=c[S],A=this._touches[S];A&&(d._add(I),g._add(I.sub(A)),_++,c[S]=I)}if(this._touches=c,_<this._minTouches||!g.mag())return;const x=g.div(_);return this._sum._add(x),this._sum.mag()<this._clickTolerance?void 0:{around:d.div(_),panDelta:x}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wa{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,n,o){this._firstTwoTouches||o.length<2||(this._firstTwoTouches=[o[0].identifier,o[1].identifier],this._start([n[0],n[1]]))}touchmove(t,n,o){if(!this._firstTwoTouches)return;t.preventDefault();const[c,d]=this._firstTwoTouches,g=kn(o,n,c),_=kn(o,n,d);if(!g||!_)return;const x=this._aroundCenter?null:g.add(_).div(2);return this._move([g,_],x,t)}touchend(t,n,o){if(!this._firstTwoTouches)return;const[c,d]=this._firstTwoTouches,g=kn(o,n,c),_=kn(o,n,d);g&&_||(this._active&&B.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function kn(u,t,n){for(let o=0;o<u.length;o++)if(u[o].identifier===n)return t[o]}function hs(u,t){return Math.log(u/t)/Math.LN2}class Dl extends wa{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,n){const o=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(hs(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:hs(this._distance,o),pinchAround:n}}}function je(u,t){return 180*u.angleWith(t)/Math.PI}class po extends wa{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,n){const o=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:je(this._vector,o),pinchAround:n}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const n=25/(Math.PI*this._minDiameter)*360,o=je(t,this._startVector);return Math.abs(o)<n}}function fo(u){return Math.abs(u.y)>Math.abs(u.x)}class Vc extends wa{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,n,o){super.touchstart(t,n,o),this._currentTouchCount=o.length}_start(t){this._lastPoints=t,fo(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,n,o){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const c=t[0].sub(this._lastPoints[0]),d=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(c,d,o.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(c.y+d.y)/2*-.5}):void 0}gestureBeginsVertically(t,n,o){if(this._valid!==void 0)return this._valid;const c=t.mag()>=2,d=n.mag()>=2;if(!c&&!d)return;if(!c||!d)return this._firstMove===void 0&&(this._firstMove=o),o-this._firstMove<100&&void 0;const g=t.y>0==n.y>0;return fo(t)&&fo(n)&&g}}const mo={panStep:100,bearingStep:15,pitchStep:10};class Ll{constructor(t){this._tr=new dn(t);const n=mo;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let n=0,o=0,c=0,d=0,g=0;switch(t.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:t.shiftKey?o=-1:(t.preventDefault(),d=-1);break;case 39:t.shiftKey?o=1:(t.preventDefault(),d=1);break;case 38:t.shiftKey?c=1:(t.preventDefault(),g=-1);break;case 40:t.shiftKey?c=-1:(t.preventDefault(),g=1);break;default:return}return this._rotationDisabled&&(o=0,c=0),{cameraAnimation:_=>{const x=this._tr;_.easeTo({duration:300,easeId:"keyboardHandler",easing:Rl,zoom:n?Math.round(x.zoom)+n*(t.shiftKey?2:1):x.zoom,bearing:x.bearing+o*this._bearingStep,pitch:x.pitch+c*this._pitchStep,offset:[-d*this._panStep,-g*this._panStep],center:x.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Rl(u){return u*(2-u)}const Fl=4.000244140625;class Uc{constructor(t,n){this._onTimeout=o=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)},this._map=t,this._tr=new dn(t),this._el=t.getCanvasContainer(),this._triggerRenderFrame=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!t[this._map._metaKey])return;t.preventDefault()}let n=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const o=a.h.now(),c=o-(this._lastWheelEventTime||0);this._lastWheelEventTime=o,n!==0&&n%Fl==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":c>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(c*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),t.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=t,this._delta-=n,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=B.mousePos(this._el,t),o=this._tr;this._around=a.L.convert(this._aroundCenter?o.center:o.unproject(n)),this._aroundPoint=o.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(this._delta!==0){const _=this._type==="wheel"&&Math.abs(this._delta)>Fl?this._wheelZoomRate:this._defaultZoomRate;let x=2/(1+Math.exp(-Math.abs(this._delta*_)));this._delta<0&&x!==0&&(x=1/x);const S=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(S*x))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const n=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,o=this._startZoom,c=this._easing;let d,g=!1;if(this._type==="wheel"&&o&&c){const _=Math.min((a.h.now()-this._lastWheelEventTime)/200,1),x=c(_);d=a.B.number(o,n,x),_<1?this._frameId||(this._frameId=!0):g=!0}else d=n,g=!0;return this._active=!0,g&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!g,zoomDelta:d-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let n=a.bb;if(this._prevEase){const o=this._prevEase,c=(a.h.now()-o.start)/o.duration,d=o.easing(c+.01)-o.easing(c),g=.27/Math.sqrt(d*d+1e-4)*.01,_=Math.sqrt(.0729-g*g);n=a.ba(g,_,.25,1)}return this._prevEase={start:a.h.now(),duration:t,easing:n},n}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class go{constructor(t,n){this._clickZoom=t,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class _o{constructor(t){this._tr=new dn(t),this.reset()}reset(){this._active=!1}dblclick(t,n){return t.preventDefault(),{cameraAnimation:o=>{o.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(n)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class yo{constructor(){this._tap=new xa({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,n,o){if(!this._swipePoint)if(this._tapTime){const c=n[0],d=t.timeStamp-this._tapTime<500,g=this._tapPoint.dist(c)<30;d&&g?o.length>0&&(this._swipePoint=c,this._swipeTouch=o[0].identifier):this.reset()}else this._tap.touchstart(t,n,o)}touchmove(t,n,o){if(this._tapTime){if(this._swipePoint){if(o[0].identifier!==this._swipeTouch)return;const c=n[0],d=c.y-this._swipePoint.y;return this._swipePoint=c,t.preventDefault(),this._active=!0,{zoomDelta:d/128}}}else this._tap.touchmove(t,n,o)}touchend(t,n,o){if(this._tapTime)this._swipePoint&&o.length===0&&this.reset();else{const c=this._tap.touchend(t,n,o);c&&(this._tapTime=t.timeStamp,this._tapPoint=c)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vo{constructor(t,n,o){this._el=t,this._mousePan=n,this._touchPan=o}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class _r{constructor(t,n,o){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=n,this._mousePitch=o}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class zn{constructor(t,n,o,c){this._el=t,this._touchZoom=n,this._touchRotate=o,this._tapDragZoom=c,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Bs=u=>u.zoom||u.drag||u.pitch||u.rotate;class xo extends a.k{}function Os(u){return u.panDelta&&u.panDelta.mag()||u.zoomDelta||u.bearingDelta||u.pitchDelta}class bo{constructor(t,n){this.handleWindowEvent=c=>{this.handleEvent(c,`${c.type}Window`)},this.handleEvent=(c,d)=>{if(c.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const g=c.type==="renderFrame"?void 0:c,_={needsRenderFrame:!1},x={},S={},I=c.touches,A=I?this._getMapTouches(I):void 0,L=A?B.touchPos(this._el,A):B.mousePos(this._el,c);for(const{handlerName:Z,handler:$,allowed:ie}of this._handlers){if(!$.isEnabled())continue;let ue;this._blockedByActive(S,ie,Z)?$.reset():$[d||c.type]&&(ue=$[d||c.type](c,L,A),this.mergeHandlerResult(_,x,ue,Z,g),ue&&ue.needsRenderFrame&&this._triggerRenderFrame()),(ue||$.isActive())&&(S[Z]=$)}const U={};for(const Z in this._previousActiveHandlers)S[Z]||(U[Z]=g);this._previousActiveHandlers=S,(Object.keys(U).length||Os(_))&&(this._changes.push([_,x,U]),this._triggerRenderFrame()),(Object.keys(S).length||Os(_))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:V}=_;V&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],V(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new El(t),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(n);const o=this._el;this._listeners=[[o,"touchstart",{passive:!0}],[o,"touchmove",{passive:!1}],[o,"touchend",void 0],[o,"touchcancel",void 0],[o,"mousedown",void 0],[o,"mousemove",void 0],[o,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[o,"mouseover",void 0],[o,"mouseout",void 0],[o,"dblclick",void 0],[o,"click",void 0],[o,"keydown",{capture:!1}],[o,"keyup",void 0],[o,"wheel",{passive:!1}],[o,"contextmenu",void 0],[window,"blur",void 0]];for(const[c,d,g]of this._listeners)B.addEventListener(c,d,c===document?this.handleWindowEvent:this.handleEvent,g)}destroy(){for(const[t,n,o]of this._listeners)B.removeEventListener(t,n,t===document?this.handleWindowEvent:this.handleEvent,o)}_addDefaultHandlers(t){const n=this._map,o=n.getCanvasContainer();this._add("mapEvent",new Pl(n,t));const c=n.boxZoom=new kl(n,t);this._add("boxZoom",c),t.interactive&&t.boxZoom&&c.enable();const d=new fn(n),g=new _o(n);n.doubleClickZoom=new go(g,d),this._add("tapZoom",d),this._add("clickZoom",g),t.interactive&&t.doubleClickZoom&&n.doubleClickZoom.enable();const _=new yo;this._add("tapDragZoom",_);const x=n.touchPitch=new Vc(n);this._add("touchPitch",x),t.interactive&&t.touchPitch&&n.touchPitch.enable(t.touchPitch);const S=us(t),I=gn(t);n.dragRotate=new _r(t,S,I),this._add("mouseRotate",S,["mousePitch"]),this._add("mousePitch",I,["mouseRotate"]),t.interactive&&t.dragRotate&&n.dragRotate.enable();const A=(({enable:ie,clickTolerance:ue})=>{const K=new ho({checkCorrectEvent:re=>B.mouseButton(re)===0&&!re.ctrlKey});return new mn({clickTolerance:ue,move:(re,pe)=>({around:pe,panDelta:pe.sub(re)}),activateOnStart:!0,moveStateManager:K,enable:ie,assignEvents:ba})})(t),L=new Ge(t,n);n.dragPan=new vo(o,A,L),this._add("mousePan",A),this._add("touchPan",L,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&n.dragPan.enable(t.dragPan);const U=new po,V=new Dl;n.touchZoomRotate=new zn(o,V,U,_),this._add("touchRotate",U,["touchPan","touchZoom"]),this._add("touchZoom",V,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&n.touchZoomRotate.enable(t.touchZoomRotate);const Z=n.scrollZoom=new Uc(n,()=>this._triggerRenderFrame());this._add("scrollZoom",Z,["mousePan"]),t.interactive&&t.scrollZoom&&n.scrollZoom.enable(t.scrollZoom);const $=n.keyboard=new Ll(n);this._add("keyboard",$),t.interactive&&t.keyboard&&n.keyboard.enable(),this._add("blockableMapEvent",new Ml(n))}_add(t,n,o){this._handlers.push({handlerName:t,handler:n,allowed:o}),this._handlersById[t]=n}stop(t){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Bs(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,n,o){for(const c in t)if(c!==o&&(!n||n.indexOf(c)<0))return!0;return!1}_getMapTouches(t){const n=[];for(const o of t)this._el.contains(o.target)&&n.push(o);return n}mergeHandlerResult(t,n,o,c,d){if(!o)return;a.e(t,o);const g={handlerName:c,originalEvent:o.originalEvent||d};o.zoomDelta!==void 0&&(n.zoom=g),o.panDelta!==void 0&&(n.drag=g),o.pitchDelta!==void 0&&(n.pitch=g),o.bearingDelta!==void 0&&(n.rotate=g)}_applyChanges(){const t={},n={},o={};for(const[c,d,g]of this._changes)c.panDelta&&(t.panDelta=(t.panDelta||new a.P(0,0))._add(c.panDelta)),c.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+c.zoomDelta),c.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+c.bearingDelta),c.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+c.pitchDelta),c.around!==void 0&&(t.around=c.around),c.pinchAround!==void 0&&(t.pinchAround=c.pinchAround),c.noInertia&&(t.noInertia=c.noInertia),a.e(n,d),a.e(o,g);this._updateMapTransform(t,n,o),this._changes=[]}_updateMapTransform(t,n,o){const c=this._map,d=c._getTransformForUpdate(),g=c.terrain;if(!(Os(t)||g&&this._terrainMovement))return this._fireEvents(n,o,!0);let{panDelta:_,zoomDelta:x,bearingDelta:S,pitchDelta:I,around:A,pinchAround:L}=t;L!==void 0&&(A=L),c._stop(!0),A=A||c.transform.centerPoint;const U=d.pointLocation(_?A.sub(_):A);S&&(d.bearing+=S),I&&(d.pitch+=I),x&&(d.zoom+=x),g?this._terrainMovement||!n.drag&&!n.zoom?n.drag&&this._terrainMovement?d.center=d.pointLocation(d.centerPoint.sub(_)):d.setLocationAtPoint(U,A):(this._terrainMovement=!0,this._map._elevationFreeze=!0,d.setLocationAtPoint(U,A),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,d.recalculateZoom(c.terrain)})):d.setLocationAtPoint(U,A),c._applyUpdatedTransform(d),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(n,o,!0)}_fireEvents(t,n,o){const c=Bs(this._eventsInProgress),d=Bs(t),g={};for(const I in t){const{originalEvent:A}=t[I];this._eventsInProgress[I]||(g[`${I}start`]=A),this._eventsInProgress[I]=t[I]}!c&&d&&this._fireEvent("movestart",d.originalEvent);for(const I in g)this._fireEvent(I,g[I]);d&&this._fireEvent("move",d.originalEvent);for(const I in t){const{originalEvent:A}=t[I];this._fireEvent(I,A)}const _={};let x;for(const I in this._eventsInProgress){const{handlerName:A,originalEvent:L}=this._eventsInProgress[I];this._handlersById[A].isActive()||(delete this._eventsInProgress[I],x=n[A]||L,_[`${I}end`]=x)}for(const I in _)this._fireEvent(I,_[I]);const S=Bs(this._eventsInProgress);if(o&&(c||d)&&!S){this._updatingCamera=!0;const I=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),A=L=>L!==0&&-this._bearingSnap<L&&L<this._bearingSnap;!I||!I.essential&&a.h.prefersReducedMotion?(this._map.fire(new a.k("moveend",{originalEvent:x})),A(this._map.getBearing())&&this._map.resetNorth()):(A(I.bearing||this._map.getBearing())&&(I.bearing=0),I.freezeElevation=!0,this._map.easeTo(I,{originalEvent:x})),this._updatingCamera=!1}}_fireEvent(t,n){this._map.fire(new a.k(t,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new xo("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Bl extends a.E{constructor(t,n){super(),this._renderFrameCallback=()=>{const o=Math.min((a.h.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(o)),o<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=n.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new a.L(this.transform.center.lng,this.transform.center.lat)}setCenter(t,n){return this.jumpTo({center:t},n)}panBy(t,n,o){return t=a.P.convert(t).mult(-1),this.panTo(this.transform.center,a.e({offset:t},n),o)}panTo(t,n,o){return this.easeTo(a.e({center:t},n),o)}getZoom(){return this.transform.zoom}setZoom(t,n){return this.jumpTo({zoom:t},n),this}zoomTo(t,n,o){return this.easeTo(a.e({zoom:t},n),o)}zoomIn(t,n){return this.zoomTo(this.getZoom()+1,t,n),this}zoomOut(t,n){return this.zoomTo(this.getZoom()-1,t,n),this}getBearing(){return this.transform.bearing}setBearing(t,n){return this.jumpTo({bearing:t},n),this}getPadding(){return this.transform.padding}setPadding(t,n){return this.jumpTo({padding:t},n),this}rotateTo(t,n,o){return this.easeTo(a.e({bearing:t},n),o)}resetNorth(t,n){return this.rotateTo(0,a.e({duration:1e3},t),n),this}resetNorthPitch(t,n){return this.easeTo(a.e({bearing:0,pitch:0,duration:1e3},t),n),this}snapToNorth(t,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,n):this}getPitch(){return this.transform.pitch}setPitch(t,n){return this.jumpTo({pitch:t},n),this}cameraForBounds(t,n){t=qe.convert(t);const o=n&&n.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),o,n)}_cameraForBoxAndBearing(t,n,o,c){const d={top:0,bottom:0,right:0,left:0};if(typeof(c=a.e({padding:d,offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding=="number"){const pe=c.padding;c.padding={top:pe,bottom:pe,right:pe,left:pe}}c.padding=a.e(d,c.padding);const g=this.transform,_=g.padding,x=g.project(a.L.convert(t)),S=g.project(a.L.convert(n)),I=x.rotate(-o*Math.PI/180),A=S.rotate(-o*Math.PI/180),L=new a.P(Math.max(I.x,A.x),Math.max(I.y,A.y)),U=new a.P(Math.min(I.x,A.x),Math.min(I.y,A.y)),V=L.sub(U),Z=(g.width-(_.left+_.right+c.padding.left+c.padding.right))/V.x,$=(g.height-(_.top+_.bottom+c.padding.top+c.padding.bottom))/V.y;if($<0||Z<0)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ie=Math.min(g.scaleZoom(g.scale*Math.min(Z,$)),c.maxZoom),ue=a.P.convert(c.offset),K=new a.P((c.padding.left-c.padding.right)/2,(c.padding.top-c.padding.bottom)/2).rotate(o*Math.PI/180),re=ue.add(K).mult(g.scale/g.zoomScale(ie));return{center:g.unproject(x.add(S).div(2).sub(re)),zoom:ie,bearing:o}}fitBounds(t,n,o){return this._fitInternal(this.cameraForBounds(t,n),n,o)}fitScreenCoordinates(t,n,o,c,d){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(a.P.convert(t)),this.transform.pointLocation(a.P.convert(n)),o,c),c,d)}_fitInternal(t,n,o){return t?(delete(n=a.e(t,n)).padding,n.linear?this.easeTo(n,o):this.flyTo(n,o)):this}jumpTo(t,n){this.stop();const o=this._getTransformForUpdate();let c=!1,d=!1,g=!1;return"zoom"in t&&o.zoom!==+t.zoom&&(c=!0,o.zoom=+t.zoom),t.center!==void 0&&(o.center=a.L.convert(t.center)),"bearing"in t&&o.bearing!==+t.bearing&&(d=!0,o.bearing=+t.bearing),"pitch"in t&&o.pitch!==+t.pitch&&(g=!0,o.pitch=+t.pitch),t.padding==null||o.isPaddingEqual(t.padding)||(o.padding=t.padding),this._applyUpdatedTransform(o),this.fire(new a.k("movestart",n)).fire(new a.k("move",n)),c&&this.fire(new a.k("zoomstart",n)).fire(new a.k("zoom",n)).fire(new a.k("zoomend",n)),d&&this.fire(new a.k("rotatestart",n)).fire(new a.k("rotate",n)).fire(new a.k("rotateend",n)),g&&this.fire(new a.k("pitchstart",n)).fire(new a.k("pitch",n)).fire(new a.k("pitchend",n)),this.fire(new a.k("moveend",n))}calculateCameraOptionsFromTo(t,n,o,c=0){const d=a.U.fromLngLat(t,n),g=a.U.fromLngLat(o,c),_=g.x-d.x,x=g.y-d.y,S=g.z-d.z,I=Math.hypot(_,x,S);if(I===0)throw new Error("Can't calculate camera options with same From and To");const A=Math.hypot(_,x),L=this.transform.scaleZoom(this.transform.cameraToCenterDistance/I/this.transform.tileSize),U=180*Math.atan2(_,-x)/Math.PI;let V=180*Math.acos(A/I)/Math.PI;return V=S<0?90-V:90+V,{center:g.toLngLat(),zoom:L,pitch:V,bearing:U}}easeTo(t,n){this._stop(!1,t.easeId),((t=a.e({offset:[0,0],duration:500,easing:a.bb},t)).animate===!1||!t.essential&&a.h.prefersReducedMotion)&&(t.duration=0);const o=this._getTransformForUpdate(),c=this.getZoom(),d=this.getBearing(),g=this.getPitch(),_=this.getPadding(),x="zoom"in t?+t.zoom:c,S="bearing"in t?this._normalizeBearing(t.bearing,d):d,I="pitch"in t?+t.pitch:g,A="padding"in t?t.padding:o.padding,L=a.P.convert(t.offset);let U=o.centerPoint.add(L);const V=o.pointLocation(U),Z=a.L.convert(t.center||V);this._normalizeCenter(Z);const $=o.project(V),ie=o.project(Z).sub($),ue=o.zoomScale(x-c);let K,re;t.around&&(K=a.L.convert(t.around),re=o.locationPoint(K));const pe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||x!==c,this._rotating=this._rotating||d!==S,this._pitching=this._pitching||I!==g,this._padding=!o.isPaddingEqual(A),this._easeId=t.easeId,this._prepareEase(n,t.noMoveStart,pe),this.terrain&&this._prepareElevation(Z),this._ease(fe=>{if(this._zooming&&(o.zoom=a.B.number(c,x,fe)),this._rotating&&(o.bearing=a.B.number(d,S,fe)),this._pitching&&(o.pitch=a.B.number(g,I,fe)),this._padding&&(o.interpolatePadding(_,A,fe),U=o.centerPoint.add(L)),this.terrain&&!t.freezeElevation&&this._updateElevation(fe),K)o.setLocationAtPoint(K,re);else{const xe=o.zoomScale(o.zoom-c),Ee=x>c?Math.min(2,ue):Math.max(.5,ue),Ce=Math.pow(Ee,1-fe),Me=o.unproject($.add(ie.mult(fe*Ce)).mult(xe));o.setLocationAtPoint(o.renderWorldCopies?Me.wrap():Me,U)}this._applyUpdatedTransform(o),this._fireMoveEvents(n)},fe=>{this.terrain&&this._finalizeElevation(),this._afterEase(n,fe)},t),this}_prepareEase(t,n,o={}){this._moving=!0,n||o.moving||this.fire(new a.k("movestart",t)),this._zooming&&!o.zooming&&this.fire(new a.k("zoomstart",t)),this._rotating&&!o.rotating&&this.fire(new a.k("rotatestart",t)),this._pitching&&!o.pitching&&this.fire(new a.k("pitchstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const n=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&n!==this._elevationTarget){const o=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(o-(n-(o*t+this._elevationStart))/(1-t)),this._elevationTarget=n}this.transform.elevation=a.B.number(this._elevationStart,this._elevationTarget,t)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(t){if(!this.transformCameraUpdate)return;const n=t.clone(),{center:o,zoom:c,pitch:d,bearing:g,elevation:_}=this.transformCameraUpdate(n);o&&(n.center=o),c!==void 0&&(n.zoom=c),d!==void 0&&(n.pitch=d),g!==void 0&&(n.bearing=g),_!==void 0&&(n.elevation=_),this.transform.apply(n)}_fireMoveEvents(t){this.fire(new a.k("move",t)),this._zooming&&this.fire(new a.k("zoom",t)),this._rotating&&this.fire(new a.k("rotate",t)),this._pitching&&this.fire(new a.k("pitch",t))}_afterEase(t,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId;const o=this._zooming,c=this._rotating,d=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,o&&this.fire(new a.k("zoomend",t)),c&&this.fire(new a.k("rotateend",t)),d&&this.fire(new a.k("pitchend",t)),this.fire(new a.k("moveend",t))}flyTo(t,n){if(!t.essential&&a.h.prefersReducedMotion){const Ye=a.F(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ye,n)}this.stop(),t=a.e({offset:[0,0],speed:1.2,curve:1.42,easing:a.bb},t);const o=this._getTransformForUpdate(),c=this.getZoom(),d=this.getBearing(),g=this.getPitch(),_=this.getPadding(),x="zoom"in t?a.ad(+t.zoom,o.minZoom,o.maxZoom):c,S="bearing"in t?this._normalizeBearing(t.bearing,d):d,I="pitch"in t?+t.pitch:g,A="padding"in t?t.padding:o.padding,L=o.zoomScale(x-c),U=a.P.convert(t.offset);let V=o.centerPoint.add(U);const Z=o.pointLocation(V),$=a.L.convert(t.center||Z);this._normalizeCenter($);const ie=o.project(Z),ue=o.project($).sub(ie);let K=t.curve;const re=Math.max(o.width,o.height),pe=re/L,fe=ue.mag();if("minZoom"in t){const Ye=a.ad(Math.min(t.minZoom,c,x),o.minZoom,o.maxZoom),Zt=re/o.zoomScale(Ye-c);K=Math.sqrt(Zt/fe*2)}const xe=K*K;function Ee(Ye){const Zt=(pe*pe-re*re+(Ye?-1:1)*xe*xe*fe*fe)/(2*(Ye?pe:re)*xe*fe);return Math.log(Math.sqrt(Zt*Zt+1)-Zt)}function Ce(Ye){return(Math.exp(Ye)-Math.exp(-Ye))/2}function Me(Ye){return(Math.exp(Ye)+Math.exp(-Ye))/2}const Ke=Ee(!1);let Tt=function(Ye){return Me(Ke)/Me(Ke+K*Ye)},Be=function(Ye){return re*((Me(Ke)*(Ce(Zt=Ke+K*Ye)/Me(Zt))-Ce(Ke))/xe)/fe;var Zt},ht=(Ee(!0)-Ke)/K;if(Math.abs(fe)<1e-6||!isFinite(ht)){if(Math.abs(re-pe)<1e-6)return this.easeTo(t,n);const Ye=pe<re?-1:1;ht=Math.abs(Math.log(pe/re))/K,Be=function(){return 0},Tt=function(Zt){return Math.exp(Ye*K*Zt)}}return t.duration="duration"in t?+t.duration:1e3*ht/("screenSpeed"in t?+t.screenSpeed/K:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=d!==S,this._pitching=I!==g,this._padding=!o.isPaddingEqual(A),this._prepareEase(n,!1),this.terrain&&this._prepareElevation($),this._ease(Ye=>{const Zt=Ye*ht,Ct=1/Tt(Zt);o.zoom=Ye===1?x:c+o.scaleZoom(Ct),this._rotating&&(o.bearing=a.B.number(d,S,Ye)),this._pitching&&(o.pitch=a.B.number(g,I,Ye)),this._padding&&(o.interpolatePadding(_,A,Ye),V=o.centerPoint.add(U)),this.terrain&&!t.freezeElevation&&this._updateElevation(Ye);const bt=Ye===1?$:o.unproject(ie.add(ue.mult(Be(Zt))).mult(Ct));o.setLocationAtPoint(o.renderWorldCopies?bt.wrap():bt,V),this._applyUpdatedTransform(o),this._fireMoveEvents(n)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(n)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,n){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const o=this._onEaseEnd;delete this._onEaseEnd,o.call(this,n)}if(!t){const o=this.handlers;o&&o.stop(!1)}return this}_ease(t,n,o){o.animate===!1||o.duration===0?(t(1),n()):(this._easeStart=a.h.now(),this._easeOptions=o,this._onEaseFrame=t,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,n){t=a.b5(t,-180,180);const o=Math.abs(t-n);return Math.abs(t-360-n)<o&&(t-=360),Math.abs(t+360-n)<o&&(t+=360),t}_normalizeCenter(t){const n=this.transform;if(!n.renderWorldCopies||n.lngRange)return;const o=t.lng-n.center.lng;t.lng+=o>180?-360:o<-180?360:0}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(a.L.convert(t),this.transform.tileZoom)-this.transform.elevation:null}}class Pr{constructor(t={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=n=>{!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"&&n.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options&&this.options.compact,this._container=B.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=B.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=B.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){B.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,n){const o=this._map._getUIString(`AttributionControl.${n}`);t.title=o,t.setAttribute("aria-label",o)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(c=>typeof c!="string"?"":c)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const c=this._map.style.stylesheet;this.styleOwner=c.owner,this.styleId=c.id}const n=this._map.style.sourceCaches;for(const c in n){const d=n[c];if(d.used||d.usedForTerrain){const g=d.getSource();g.attribution&&t.indexOf(g.attribution)<0&&t.push(g.attribution)}}t=t.filter(c=>String(c).trim()),t.sort((c,d)=>c.length-d.length),t=t.filter((c,d)=>{for(let g=d+1;g<t.length;g++)if(t[g].indexOf(c)>=0)return!1;return!0});const o=t.join(" | ");o!==this._attribHTML&&(this._attribHTML=o,t.length?(this._innerContainer.innerHTML=o,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class ti{constructor(t={}){this._updateCompact=()=>{const n=this._container.children;if(n.length){const o=n[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&o.classList.add("maplibregl-compact"):o.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=B.create("div","maplibregl-ctrl");const n=B.create("a","maplibregl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://maplibre.org/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){B.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Sa{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const n=++this._id;return this._queue.push({callback:t,id:n,cancelled:!1}),n}remove(t){const n=this._currentlyRunning,o=n?this._queue.concat(n):this._queue;for(const c of o)if(c.id===t)return void(c.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const n=this._currentlyRunning=this._queue;this._queue=[];for(const o of n)if(!o.cancelled&&(o.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const wo={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var Ol=a.Q([{name:"a_pos3d",type:"Int16",components:3}]);class Nl extends a.E{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,n){this.sourceCache.update(t,n),this._renderableTilesKeys=[];const o={};for(const c of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:n}))o[c.key]=!0,this._renderableTilesKeys.push(c.key),this._tiles[c.key]||(c.posMatrix=new Float64Array(16),a.aS(c.posMatrix,0,a.N,0,a.N,0,1),this._tiles[c.key]=new mr(c,this.tileSize));for(const c in this._tiles)o[c]||delete this._tiles[c]}freeRtt(t){for(const n in this._tiles){const o=this._tiles[n];(!t||o.tileID.equals(t)||o.tileID.isChildOf(t)||t.isChildOf(o.tileID))&&(o.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const n={};for(const o of this._renderableTilesKeys){const c=this._tiles[o].tileID;if(c.canonical.equals(t.canonical)){const d=t.clone();d.posMatrix=new Float64Array(16),a.aS(d.posMatrix,0,a.N,0,a.N,0,1),n[o]=d}else if(c.canonical.isChildOf(t.canonical)){const d=t.clone();d.posMatrix=new Float64Array(16);const g=c.canonical.z-t.canonical.z,_=c.canonical.x-(c.canonical.x>>g<<g),x=c.canonical.y-(c.canonical.y>>g<<g),S=a.N>>g;a.aS(d.posMatrix,0,S,0,S,0,1),a.$(d.posMatrix,d.posMatrix,[-_*S,-x*S,0]),n[o]=d}else if(t.canonical.isChildOf(c.canonical)){const d=t.clone();d.posMatrix=new Float64Array(16);const g=t.canonical.z-c.canonical.z,_=t.canonical.x-(t.canonical.x>>g<<g),x=t.canonical.y-(t.canonical.y>>g<<g),S=a.N>>g;a.aS(d.posMatrix,0,a.N,0,a.N,0,1),a.$(d.posMatrix,d.posMatrix,[_*S,x*S,0]),a.a0(d.posMatrix,d.posMatrix,[1/2**g,1/2**g,0]),n[o]=d}}return n}getSourceTile(t,n){const o=this.sourceCache._source;let c=t.overscaledZ-this.deltaZoom;if(c>o.maxzoom&&(c=o.maxzoom),c<o.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(c).key);let d=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!d||!d.dem)&&n)for(;c>=o.minzoom&&(!d||!d.dem);)d=this.sourceCache.getTileByID(t.scaledTo(c--).key);return d}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(n=>n.timeAdded>=t)}}class $l{constructor(t,n,o){this.painter=t,this.sourceCache=new Nl(n),this.options=o,this.exaggeration=typeof o.exaggeration=="number"?o.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,n,o,c=a.N){var d;if(!(n>=0&&n<c&&o>=0&&o<c))return 0;const g=this.getTerrainData(t),_=(d=g.tile)===null||d===void 0?void 0:d.dem;if(!_)return 0;const x=function(V,Z,$){var ie=Z[0],ue=Z[1];return V[0]=$[0]*ie+$[4]*ue+$[12],V[1]=$[1]*ie+$[5]*ue+$[13],V}([],[n/c*a.N,o/c*a.N],g.u_terrain_matrix),S=[x[0]*_.dim,x[1]*_.dim],I=Math.floor(S[0]),A=Math.floor(S[1]),L=S[0]-I,U=S[1]-A;return _.get(I,A)*(1-L)*(1-U)+_.get(I+1,A)*L*(1-U)+_.get(I,A+1)*(1-L)*U+_.get(I+1,A+1)*L*U}getElevationForLngLatZoom(t,n){const{tileID:o,mercatorX:c,mercatorY:d}=this._getOverscaledTileIDFromLngLatZoom(t,n);return this.getElevation(o,c%a.N,d%a.N,a.N)}getElevation(t,n,o,c=a.N){return this.getDEMElevation(t,n,o,c)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const c=this.painter.context,d=new a.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Pe(c,d,c.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Pe(c,new a.R({width:1,height:1}),c.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.ao([])}const n=this.sourceCache.getSourceTile(t,!0);if(n&&n.dem&&(!n.demTexture||n.needsTerrainPrepare)){const c=this.painter.context;n.demTexture=this.painter.getTileTexture(n.dem.stride),n.demTexture?n.demTexture.update(n.dem.getPixels(),{premultiply:!1}):n.demTexture=new Pe(c,n.dem.getPixels(),c.gl.RGBA,{premultiply:!1}),n.demTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),n.needsTerrainPrepare=!1}const o=n&&n+n.tileID.key+t.key;if(o&&!this._demMatrixCache[o]){const c=this.sourceCache.sourceCache._source.maxzoom;let d=t.canonical.z-n.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=c?d=t.canonical.z-c:a.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const g=t.canonical.x-(t.canonical.x>>d<<d),_=t.canonical.y-(t.canonical.y>>d<<d),x=a.bc(new Float64Array(16),[1/(a.N<<d),1/(a.N<<d),0]);a.$(x,x,[g*a.N,_*a.N,0]),this._demMatrixCache[t.key]={matrix:x,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:n&&n.dem&&n.dem.dim||1,u_terrain_matrix:o?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:n&&n.dem&&n.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(n&&n.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:n}}getFramebuffer(t){const n=this.painter,o=n.width/devicePixelRatio,c=n.height/devicePixelRatio;return!this._fbo||this._fbo.width===o&&this._fbo.height===c||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Pe(n.context,{width:o,height:c,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Pe(n.context,{width:o,height:c,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=n.context.createFramebuffer(o,c,!0,!1),this._fbo.depthAttachment.set(n.context.createRenderbuffer(n.context.gl.DEPTH_COMPONENT16,o,c))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const n=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let d=0,g=0;d<this._coordsTextureSize;d++)for(let _=0;_<this._coordsTextureSize;_++,g+=4)n[g+0]=255&_,n[g+1]=255&d,n[g+2]=_>>8<<4|d>>8,n[g+3]=0;const o=new a.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(n.buffer)),c=new Pe(t,o,t.gl.RGBA,{premultiply:!1});return c.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=c,c}pointCoordinate(t){const n=new Uint8Array(4),o=this.painter.context,c=o.gl;o.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),c.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,c.RGBA,c.UNSIGNED_BYTE,n),o.bindFramebuffer.set(null);const d=n[0]+(n[2]>>4<<8),g=n[1]+((15&n[2])<<8),_=this.coordsIndex[255-n[3]],x=_&&this.sourceCache.getTileByID(_);if(!x)return null;const S=this._coordsTextureSize,I=(1<<x.tileID.canonical.z)*S;return new a.U(this._allowMercatorOverflow(t,(x.tileID.canonical.x*S+d)/I),(x.tileID.canonical.y*S+g)/I,this.getElevation(x.tileID,d,g,S))}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.painter.context,n=new a.bd,o=new a.b0,c=this.meshSize,d=a.N/c,g=c*c;for(let A=0;A<=c;A++)for(let L=0;L<=c;L++)n.emplaceBack(L*d,A*d,0);for(let A=0;A<g;A+=c+1)for(let L=0;L<c;L++)o.emplaceBack(L+A,c+L+A+1,c+L+A+2),o.emplaceBack(L+A,c+L+A+2,L+A+1);const _=n.length,x=_+2*(c+1);for(const A of[0,1])for(let L=0;L<=c;L++)for(const U of[0,1])n.emplaceBack(L*d,A*a.N,U);for(let A=0;A<2*c;A+=2)o.emplaceBack(x+A,x+A+1,x+A+3),o.emplaceBack(x+A,x+A+3,x+A+2),o.emplaceBack(_+A,_+A+3,_+A+1),o.emplaceBack(_+A,_+A+2,_+A+3);const S=n.length,I=S+2*(c+1);for(const A of[0,1])for(let L=0;L<=c;L++)for(const U of[0,1])n.emplaceBack(A*a.N,L*d,U);for(let A=0;A<2*c;A+=2)o.emplaceBack(S+A,S+A+1,S+A+3),o.emplaceBack(S+A,S+A+3,S+A+2),o.emplaceBack(I+A,I+A+3,I+A+1),o.emplaceBack(I+A,I+A+2,I+A+3);return this._mesh={indexBuffer:t.createIndexBuffer(o),vertexBuffer:t.createVertexBuffer(n,Ol.members),segments:a.S.simpleSegment(0,0,n.length,o.length)},this._mesh}getMeshFrameDelta(t){return 2*Math.PI*a.be/Math.pow(2,t)/5}getMinTileElevationForLngLatZoom(t,n){var o;const{tileID:c}=this._getOverscaledTileIDFromLngLatZoom(t,n);return(o=this.getMinMaxElevation(c).minElevation)!==null&&o!==void 0?o:0}getMinMaxElevation(t){const n=this.getTerrainData(t).tile,o={minElevation:null,maxElevation:null};return n&&n.dem&&(o.minElevation=n.dem.min*this.exaggeration,o.maxElevation=n.dem.max*this.exaggeration),o}_getOverscaledTileIDFromLngLatZoom(t,n){const o=a.U.fromLngLat(t.wrap()),c=(1<<n)*a.N,d=o.x*c,g=o.y*c,_=Math.floor(d/a.N),x=Math.floor(g/a.N);return{tileID:new a.O(n,0,n,_,x),mercatorX:d,mercatorY:g}}_allowMercatorOverflow(t,n){const o=t.x<this.painter.width/2;let c=a.bf(n);const d=this.painter.transform.center.lng;return o&&Math.sign(c)>0&&Math.sign(d)<0||!o&&Math.sign(c)<0&&Math.sign(d)>0?(c=360*Math.sign(d)+c,a.G(c)):n}}class qc{constructor(t,n,o){this._context=t,this._size=n,this._tileSize=o,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const n=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),o=new Pe(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return o.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),n.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),n.colorAttachment.set(o.texture),{id:t,fbo:n,texture:o,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(n=>t.id!==n),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const n of this._recentlyUsed)if(!this._objects[n].inUse)return this._objects[n];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const ar={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Ca{constructor(t,n){this.painter=t,this.terrain=n,this.pool=new qc(t.context,30,n.sourceCache.tileSize*n.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,n){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(o=>!t._layers[o].isHidden(n)),this._coordsDescendingInv={};for(const o in t.sourceCaches){this._coordsDescendingInv[o]={};const c=t.sourceCaches[o].getVisibleCoordinates();for(const d of c){const g=this.terrain.sourceCache.getTerrainCoords(d);for(const _ in g)this._coordsDescendingInv[o][_]||(this._coordsDescendingInv[o][_]=[]),this._coordsDescendingInv[o][_].push(g[_])}}this._coordsDescendingInvStr={};for(const o of t._order){const c=t._layers[o],d=c.source;if(ar[c.type]&&!this._coordsDescendingInvStr[d]){this._coordsDescendingInvStr[d]={};for(const g in this._coordsDescendingInv[d])this._coordsDescendingInvStr[d][g]=this._coordsDescendingInv[d][g].map(_=>_.key).sort().join()}}for(const o of this._renderableTiles)for(const c in this._coordsDescendingInvStr){const d=this._coordsDescendingInvStr[c][o.tileID.key];d&&d!==o.rttCoords[c]&&(o.rtt=[])}}renderLayer(t){if(t.isHidden(this.painter.transform.zoom))return!1;const n=t.type,o=this.painter,c=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(ar[n]&&(this._prevType&&ar[this._prevType]||this._stacks.push([]),this._prevType=n,this._stacks[this._stacks.length-1].push(t.id),!c))return!0;if(ar[this._prevType]||ar[n]&&c){this._prevType=n;const d=this._stacks.length-1,g=this._stacks[d]||[];for(const _ of this._renderableTiles){if(this.pool.isFull()&&(fi(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(_),_.rtt[d]){const S=this.pool.getObjectForId(_.rtt[d].id);if(S.stamp===_.rtt[d].stamp){this.pool.useObject(S);continue}}const x=this.pool.getOrCreateFreeObject();this.pool.useObject(x),this.pool.stampObject(x),_.rtt[d]={id:x.id,stamp:x.stamp},o.context.bindFramebuffer.set(x.fbo.framebuffer),o.context.clear({color:a.aT.transparent,stencil:0}),o.currentStencilSource=void 0;for(let S=0;S<g.length;S++){const I=o.style._layers[g[S]],A=I.source?this._coordsDescendingInv[I.source][_.tileID.key]:[_.tileID];o.context.viewport.set([0,0,x.fbo.width,x.fbo.height]),o._renderTileClippingMasks(I,A),o.renderLayer(o,o.style.sourceCaches[I.source],I,A),I.source&&(_.rttCoords[I.source]=this._coordsDescendingInvStr[I.source][_.tileID.key])}}return fi(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),ar[n]}return!1}}const tt=Q,ut={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:a.c.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},Ns=u=>{u.touchstart=u.dragStart,u.touchmoveWindow=u.dragMove,u.touchend=u.dragEnd},So={showCompass:!0,showZoom:!0,visualizePitch:!1};class Co{constructor(t,n,o=!1){this.mousedown=g=>{this.startMouse(a.e({},g,{ctrlKey:!0,preventDefault:()=>g.preventDefault()}),B.mousePos(this.element,g)),B.addEventListener(window,"mousemove",this.mousemove),B.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=g=>{this.moveMouse(g,B.mousePos(this.element,g))},this.mouseup=g=>{this.mouseRotate.dragEnd(g),this.mousePitch&&this.mousePitch.dragEnd(g),this.offTemp()},this.touchstart=g=>{g.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=B.touchPos(this.element,g.targetTouches)[0],this.startTouch(g,this._startPos),B.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),B.addEventListener(window,"touchend",this.touchend))},this.touchmove=g=>{g.targetTouches.length!==1?this.reset():(this._lastPos=B.touchPos(this.element,g.targetTouches)[0],this.moveTouch(g,this._lastPos))},this.touchend=g=>{g.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const c=t.dragRotate._mouseRotate.getClickTolerance(),d=t.dragRotate._mousePitch.getClickTolerance();this.element=n,this.mouseRotate=us({clickTolerance:c,enable:!0}),this.touchRotate=(({enable:g,clickTolerance:_,bearingDegreesPerPixelMoved:x=.8})=>{const S=new zl;return new mn({clickTolerance:_,move:(I,A)=>({bearingDelta:(A.x-I.x)*x}),moveStateManager:S,enable:g,assignEvents:Ns})})({clickTolerance:c,enable:!0}),this.map=t,o&&(this.mousePitch=gn({clickTolerance:d,enable:!0}),this.touchPitch=(({enable:g,clickTolerance:_,pitchDegreesPerPixelMoved:x=-.5})=>{const S=new zl;return new mn({clickTolerance:_,move:(I,A)=>({pitchDelta:(A.y-I.y)*x}),moveStateManager:S,enable:g,assignEvents:Ns})})({clickTolerance:d,enable:!0})),B.addEventListener(n,"mousedown",this.mousedown),B.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),B.addEventListener(n,"touchcancel",this.reset)}startMouse(t,n){this.mouseRotate.dragStart(t,n),this.mousePitch&&this.mousePitch.dragStart(t,n),B.disableDrag()}startTouch(t,n){this.touchRotate.dragStart(t,n),this.touchPitch&&this.touchPitch.dragStart(t,n),B.disableDrag()}moveMouse(t,n){const o=this.map,{bearingDelta:c}=this.mouseRotate.dragMove(t,n)||{};if(c&&o.setBearing(o.getBearing()+c),this.mousePitch){const{pitchDelta:d}=this.mousePitch.dragMove(t,n)||{};d&&o.setPitch(o.getPitch()+d)}}moveTouch(t,n){const o=this.map,{bearingDelta:c}=this.touchRotate.dragMove(t,n)||{};if(c&&o.setBearing(o.getBearing()+c),this.touchPitch){const{pitchDelta:d}=this.touchPitch.dragMove(t,n)||{};d&&o.setPitch(o.getPitch()+d)}}off(){const t=this.element;B.removeEventListener(t,"mousedown",this.mousedown),B.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),B.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),B.removeEventListener(window,"touchend",this.touchend),B.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){B.enableDrag(),B.removeEventListener(window,"mousemove",this.mousemove),B.removeEventListener(window,"mouseup",this.mouseup),B.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),B.removeEventListener(window,"touchend",this.touchend)}}let wi;function To(u,t,n){if(u=new a.L(u.lng,u.lat),t){const o=new a.L(u.lng-360,u.lat),c=new a.L(u.lng+360,u.lat),d=n.locationPoint(u).distSqr(t);n.locationPoint(o).distSqr(t)<d?u=o:n.locationPoint(c).distSqr(t)<d&&(u=c)}for(;Math.abs(u.lng-n.center.lng)>180;){const o=n.locationPoint(u);if(o.x>=0&&o.y>=0&&o.x<=n.width&&o.y<=n.height)break;u.lng>n.center.lng?u.lng-=360:u.lng+=360}return u}const jr={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function jl(u,t,n){const o=u.classList;for(const c in jr)o.remove(`maplibregl-${n}-anchor-${c}`);o.add(`maplibregl-${n}-anchor-${t}`)}class qn extends a.E{constructor(t){if(super(),this._onKeyPress=n=>{const o=n.code,c=n.charCode||n.keyCode;o!=="Space"&&o!=="Enter"&&c!==32&&c!==13||this.togglePopup()},this._onMapClick=n=>{const o=n.originalEvent.target,c=this._element;this._popup&&(o===c||c.contains(o))&&this.togglePopup()},this._update=n=>{if(!this._map)return;const o=this._map.loaded()&&!this._map.isMoving();(n?.type==="terrain"||n?.type==="render"&&!o)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=To(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let c="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?c=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(c=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let d="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?d="rotateX(0deg)":this._pitchAlignment==="map"&&(d=`rotateX(${this._map.getPitch()}deg)`),n&&n.type!=="moveend"||(this._pos=this._pos.round()),B.setTransform(this._element,`${jr[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${d} ${c}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const g=this._map.unproject(this._pos),_=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=g.distanceTo(this._lngLat)>20*_?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=n=>{if(!this._isDragging){const o=this._clickTolerance||this._map._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=o}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.k("dragstart"))),this.fire(new a.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.k("dragend")),this._state="inactive"},this._addDragHandler=n=>{this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos).add(this._offset),this._pointerdownPos=n.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=a.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=B.create("div"),this._element.setAttribute("aria-label","Map marker");const n=B.createNS("http://www.w3.org/2000/svg","svg"),o=41,c=27;n.setAttributeNS(null,"display","block"),n.setAttributeNS(null,"height",`${o}px`),n.setAttributeNS(null,"width",`${c}px`),n.setAttributeNS(null,"viewBox",`0 0 ${c} ${o}`);const d=B.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"stroke","none"),d.setAttributeNS(null,"stroke-width","1"),d.setAttributeNS(null,"fill","none"),d.setAttributeNS(null,"fill-rule","evenodd");const g=B.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"fill-rule","nonzero");const _=B.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"transform","translate(3.0, 29.0)"),_.setAttributeNS(null,"fill","#000000");const x=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ie of x){const ue=B.createNS("http://www.w3.org/2000/svg","ellipse");ue.setAttributeNS(null,"opacity","0.04"),ue.setAttributeNS(null,"cx","10.5"),ue.setAttributeNS(null,"cy","5.80029008"),ue.setAttributeNS(null,"rx",ie.rx),ue.setAttributeNS(null,"ry",ie.ry),_.appendChild(ue)}const S=B.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"fill",this._color);const I=B.createNS("http://www.w3.org/2000/svg","path");I.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),S.appendChild(I);const A=B.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"opacity","0.25"),A.setAttributeNS(null,"fill","#000000");const L=B.createNS("http://www.w3.org/2000/svg","path");L.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),A.appendChild(L);const U=B.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"transform","translate(6.0, 7.0)"),U.setAttributeNS(null,"fill","#FFFFFF");const V=B.createNS("http://www.w3.org/2000/svg","g");V.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Z=B.createNS("http://www.w3.org/2000/svg","circle");Z.setAttributeNS(null,"fill","#000000"),Z.setAttributeNS(null,"opacity","0.25"),Z.setAttributeNS(null,"cx","5.5"),Z.setAttributeNS(null,"cy","5.5"),Z.setAttributeNS(null,"r","5.4999962");const $=B.createNS("http://www.w3.org/2000/svg","circle");$.setAttributeNS(null,"fill","#FFFFFF"),$.setAttributeNS(null,"cx","5.5"),$.setAttributeNS(null,"cy","5.5"),$.setAttributeNS(null,"r","5.4999962"),V.appendChild(Z),V.appendChild($),g.appendChild(_),g.appendChild(S),g.appendChild(A),g.appendChild(U),g.appendChild(V),n.appendChild(g),n.setAttributeNS(null,"height",o*this._scale+"px"),n.setAttributeNS(null,"width",c*this._scale+"px"),this._element.appendChild(n),this._offset=a.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",n=>{n.preventDefault()}),this._element.addEventListener("mousedown",n=>{n.preventDefault()}),jl(this._element,this._anchor,"marker"),t&&t.className)for(const n of t.className.split(" "))this._element.classList.add(n);this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),B.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=a.L.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const c=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[c,-1*(38.1-13.5+c)],"bottom-right":[-c,-1*(38.1-13.5+c)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(t){return this._offset=a.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const mi={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let hi=0,ds=!1;const $s={maxWidth:100,unit:"metric"};function js(u,t,n){const o=n&&n.maxWidth||100,c=u._container.clientHeight/2,d=u.unproject([0,c]),g=u.unproject([o,c]),_=d.distanceTo(g);if(n&&n.unit==="imperial"){const x=3.2808*_;x>5280?Zn(t,o,x/5280,u._getUIString("ScaleControl.Miles")):Zn(t,o,x,u._getUIString("ScaleControl.Feet"))}else n&&n.unit==="nautical"?Zn(t,o,_/1852,u._getUIString("ScaleControl.NauticalMiles")):_>=1e3?Zn(t,o,_/1e3,u._getUIString("ScaleControl.Kilometers")):Zn(t,o,_,u._getUIString("ScaleControl.Meters"))}function Zn(u,t,n,o){const c=function(d){const g=Math.pow(10,`${Math.floor(d)}`.length-1);let _=d/g;return _=_>=10?10:_>=5?5:_>=3?3:_>=2?2:_>=1?1:function(x){const S=Math.pow(10,Math.ceil(-Math.log(x)/Math.LN10));return Math.round(x*S)/S}(_),g*_}(n);u.style.width=t*(c/n)+"px",u.innerHTML=`${c}&nbsp;${o}`}const Io={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Eo=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ps(u){if(u){if(typeof u=="number"){const t=Math.round(Math.abs(u)/Math.SQRT2);return{center:new a.P(0,0),top:new a.P(0,u),"top-left":new a.P(t,t),"top-right":new a.P(-t,t),bottom:new a.P(0,-u),"bottom-left":new a.P(t,-t),"bottom-right":new a.P(-t,-t),left:new a.P(u,0),right:new a.P(-u,0)}}if(u instanceof a.P||Array.isArray(u)){const t=a.P.convert(u);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:a.P.convert(u.center||[0,0]),top:a.P.convert(u.top||[0,0]),"top-left":a.P.convert(u["top-left"]||[0,0]),"top-right":a.P.convert(u["top-right"]||[0,0]),bottom:a.P.convert(u.bottom||[0,0]),"bottom-left":a.P.convert(u["bottom-left"]||[0,0]),"bottom-right":a.P.convert(u["bottom-right"]||[0,0]),left:a.P.convert(u.left||[0,0]),right:a.P.convert(u.right||[0,0])}}return ps(new a.P(0,0))}const Ao={extend:(u,...t)=>a.e(u,...t),run(u){u()},logToElement(u,t=!1,n="log"){const o=window.document.getElementById(n);o&&(t&&(o.innerHTML=""),o.innerHTML+=`<br>${u}`)}},Po=Q;class $t{static get version(){return Po}static get workerCount(){return Ui.workerCount}static set workerCount(t){Ui.workerCount=t}static get maxParallelImageRequests(){return a.c.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(t){a.c.MAX_PARALLEL_IMAGE_REQUESTS=t}static get workerUrl(){return a.c.WORKER_URL}static set workerUrl(t){a.c.WORKER_URL=t}static addProtocol(t,n){a.c.REGISTERED_PROTOCOLS[t]=n}static removeProtocol(t){delete a.c.REGISTERED_PROTOCOLS[t]}}return $t.Map=class extends Bl{constructor(u){if(a.bg.mark(a.bh.create),(u=a.e({},ut,u)).minZoom!=null&&u.maxZoom!=null&&u.minZoom>u.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(u.minPitch!=null&&u.maxPitch!=null&&u.minPitch>u.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(u.minPitch!=null&&u.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(u.maxPitch!=null&&u.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new va(u.minZoom,u.maxZoom,u.minPitch,u.maxPitch,u.renderWorldCopies),{bearingSnap:u.bearingSnap}),this._cooperativeGesturesOnWheel=t=>{this._onCooperativeGesture(t,t[this._metaKey],1)},this._contextLost=t=>{t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.k("webglcontextlost",{originalEvent:t}))},this._contextRestored=t=>{this._setupPainter(),this.resize(),this._update(),this.fire(new a.k("webglcontextrestored",{originalEvent:t}))},this._onMapScroll=t=>{if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=u.interactive,this._cooperativeGestures=u.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=u.maxTileCacheSize,this._maxTileCacheZoomLevels=u.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=u.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=u.preserveDrawingBuffer,this._antialias=u.antialias,this._trackResize=u.trackResize,this._bearingSnap=u.bearingSnap,this._refreshExpiredTiles=u.refreshExpiredTiles,this._fadeDuration=u.fadeDuration,this._crossSourceCollisions=u.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=u.collectResourceTiming,this._renderTaskQueue=new Sa,this._controls=[],this._mapId=a.a2(),this._locale=a.e({},wo,u.locale),this._clickTolerance=u.clickTolerance,this._overridePixelRatio=u.pixelRatio,this._maxCanvasSize=u.maxCanvasSize,this.transformCameraUpdate=u.transformCameraUpdate,this._imageQueueHandle=Re.addThrottleControl(()=>this.isMoving()),this._requestManager=new We(u.transformRequest),typeof u.container=="string"){if(this._container=document.getElementById(u.container),!this._container)throw new Error(`Container '${u.container}' not found.`)}else{if(!(u.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=u.container}if(u.maxBounds&&this.setMaxBounds(u.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let t=!1;const n=Un(o=>{this._trackResize&&!this._removed&&this.resize(o)._update()},50);this._resizeObserver=new ResizeObserver(o=>{t?n(o):t=!0}),this._resizeObserver.observe(this._container)}this.handlers=new bo(this,u),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=u.hash&&new Ls(typeof u.hash=="string"&&u.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch}),u.bounds&&(this.resize(),this.fitBounds(u.bounds,a.e({},u.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=u.localIdeographFontFamily,this._validateStyle=u.validateStyle,u.style&&this.setStyle(u.style,{localIdeographFontFamily:u.localIdeographFontFamily}),u.attributionControl&&this.addControl(new Pr({customAttribution:u.customAttribution})),u.maplibreLogo&&this.addControl(new ti,u.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update(t.dataType==="style"),this.fire(new a.k(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new a.k(`${t.dataType}dataloading`,t))}),this.on("dataabort",t=>{this.fire(new a.k("sourcedataabort",t))})}_getMapId(){return this._mapId}addControl(u,t){if(t===void 0&&(t=u.getDefaultPosition?u.getDefaultPosition():"top-right"),!u||!u.onAdd)return this.fire(new a.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=u.onAdd(this);this._controls.push(u);const o=this._controlPositions[t];return t.indexOf("bottom")!==-1?o.insertBefore(n,o.firstChild):o.appendChild(n),this}removeControl(u){if(!u||!u.onRemove)return this.fire(new a.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(u);return t>-1&&this._controls.splice(t,1),u.onRemove(this),this}hasControl(u){return this._controls.indexOf(u)>-1}calculateCameraOptionsFromTo(u,t,n,o){return o==null&&this.terrain&&(o=this.terrain.getElevationForLngLatZoom(n,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(u,t,n,o)}resize(u){var t;const n=this._containerDimensions(),o=n[0],c=n[1],d=this._getClampedPixelRatio(o,c);if(this._resizeCanvas(o,c,d),this.painter.resize(o,c,d),this.painter.overLimit()){const _=this.painter.context.gl;this._maxCanvasSize=[_.drawingBufferWidth,_.drawingBufferHeight];const x=this._getClampedPixelRatio(o,c);this._resizeCanvas(o,c,x),this.painter.resize(o,c,x)}this.transform.resize(o,c),(t=this._requestedCameraState)===null||t===void 0||t.resize(o,c);const g=!this._moving;return g&&(this.stop(),this.fire(new a.k("movestart",u)).fire(new a.k("move",u))),this.fire(new a.k("resize",u)),g&&this.fire(new a.k("moveend",u)),this}_getClampedPixelRatio(u,t){const{0:n,1:o}=this._maxCanvasSize,c=this.getPixelRatio(),d=u*c,g=t*c;return Math.min(d>n?n/d:1,g>o?o/g:1)*c}getPixelRatio(){var u;return(u=this._overridePixelRatio)!==null&&u!==void 0?u:devicePixelRatio}setPixelRatio(u){this._overridePixelRatio=u,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(u){return this.transform.setMaxBounds(qe.convert(u)),this._update()}setMinZoom(u){if((u=u??-2)>=-2&&u<=this.transform.maxZoom)return this.transform.minZoom=u,this._update(),this.getZoom()<u&&this.setZoom(u),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(u){if((u=u??22)>=this.transform.minZoom)return this.transform.maxZoom=u,this._update(),this.getZoom()>u&&this.setZoom(u),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(u){if((u=u??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(u>=0&&u<=this.transform.maxPitch)return this.transform.minPitch=u,this._update(),this.getPitch()<u&&this.setPitch(u),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(u){if((u=u??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(u>=this.transform.minPitch)return this.transform.maxPitch=u,this._update(),this.getPitch()>u&&this.setPitch(u),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(u){return this.transform.renderWorldCopies=u,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(u){return this._cooperativeGestures=u,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(u){return this.transform.locationPoint(a.L.convert(u),this.style&&this.terrain)}unproject(u){return this.transform.pointLocation(a.P.convert(u),this.terrain)}isMoving(){var u;return this._moving||((u=this.handlers)===null||u===void 0?void 0:u.isMoving())}isZooming(){var u;return this._zooming||((u=this.handlers)===null||u===void 0?void 0:u.isZooming())}isRotating(){var u;return this._rotating||((u=this.handlers)===null||u===void 0?void 0:u.isRotating())}_createDelegatedListener(u,t,n){if(u==="mouseenter"||u==="mouseover"){let o=!1;return{layer:t,listener:n,delegates:{mousemove:d=>{const g=this.getLayer(t)?this.queryRenderedFeatures(d.point,{layers:[t]}):[];g.length?o||(o=!0,n.call(this,new Ar(u,this,d.originalEvent,{features:g}))):o=!1},mouseout:()=>{o=!1}}}}if(u==="mouseleave"||u==="mouseout"){let o=!1;return{layer:t,listener:n,delegates:{mousemove:g=>{(this.getLayer(t)?this.queryRenderedFeatures(g.point,{layers:[t]}):[]).length?o=!0:o&&(o=!1,n.call(this,new Ar(u,this,g.originalEvent)))},mouseout:g=>{o&&(o=!1,n.call(this,new Ar(u,this,g.originalEvent)))}}}}{const o=c=>{const d=this.getLayer(t)?this.queryRenderedFeatures(c.point,{layers:[t]}):[];d.length&&(c.features=d,n.call(this,c),delete c.features)};return{layer:t,listener:n,delegates:{[u]:o}}}}on(u,t,n){if(n===void 0)return super.on(u,t);const o=this._createDelegatedListener(u,t,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[u]=this._delegatedListeners[u]||[],this._delegatedListeners[u].push(o);for(const c in o.delegates)this.on(c,o.delegates[c]);return this}once(u,t,n){if(n===void 0)return super.once(u,t);const o=this._createDelegatedListener(u,t,n);for(const c in o.delegates)this.once(c,o.delegates[c]);return this}off(u,t,n){return n===void 0?super.off(u,t):(this._delegatedListeners&&this._delegatedListeners[u]&&(o=>{const c=this._delegatedListeners[u];for(let d=0;d<c.length;d++){const g=c[d];if(g.layer===t&&g.listener===n){for(const _ in g.delegates)this.off(_,g.delegates[_]);return c.splice(d,1),this}}})(),this)}queryRenderedFeatures(u,t){if(!this.style)return[];let n;const o=u instanceof a.P||Array.isArray(u),c=o?u:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(o?{}:u)||{},c instanceof a.P||typeof c[0]=="number")n=[a.P.convert(c)];else{const d=a.P.convert(c[0]),g=a.P.convert(c[1]);n=[d,new a.P(g.x,d.y),g,new a.P(d.x,g.y),d]}return this.style.queryRenderedFeatures(n,t,this.transform)}querySourceFeatures(u,t){return this.style.querySourceFeatures(u,t)}setStyle(u,t){return(t=a.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&u?(this._diffStyle(u,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(u,t))}setTransformRequest(u){return this._requestManager.setTransformRequest(u),this}_getUIString(u){const t=this._locale[u];if(t==null)throw new Error(`Missing UI string '${u}'`);return t}_updateStyle(u,t){if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(u,t));const n=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!u)),u?(this.style=new Zi(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof u=="string"?this.style.loadURL(u,t,n):this.style.loadJSON(u,t,n),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Zi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(u,t){if(typeof u=="string"){const n=this._requestManager.transformRequest(u,Fe.Style);a.f(n,(o,c)=>{o?this.fire(new a.j(o)):c&&this._updateDiff(c,t)})}else typeof u=="object"&&this._updateDiff(u,t)}_updateDiff(u,t){try{this.style.setState(u,t)&&this._update(!0)}catch(n){a.w(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(u,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.w("There is no style added to the map.")}addSource(u,t){return this._lazyInitEmptyStyle(),this.style.addSource(u,t),this._update(!0)}isSourceLoaded(u){const t=this.style&&this.style.sourceCaches[u];if(t!==void 0)return t.loaded();this.fire(new a.j(new Error(`There is no source with ID '${u}'`)))}setTerrain(u){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),u){const t=this.style.sourceCaches[u.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${u.source}`);for(const n in this.style._layers){const o=this.style._layers[n];o.type==="hillshade"&&o.source===u.source&&a.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new $l(this.painter,t,u),this.painter.renderToTexture=new Ca(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=n=>{n.dataType==="style"?this.terrain.sourceCache.freeRtt():n.dataType==="source"&&n.tile&&(n.sourceId!==u.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(n.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new a.k("terrain",{terrain:u})),this}getTerrain(){var u,t;return(t=(u=this.terrain)===null||u===void 0?void 0:u.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const u=this.style&&this.style.sourceCaches;for(const t in u){const n=u[t]._tiles;for(const o in n){const c=n[o];if(c.state!=="loaded"&&c.state!=="errored")return!1}}return!0}addSourceType(u,t,n){return this._lazyInitEmptyStyle(),this.style.addSourceType(u,t,n)}removeSource(u){return this.style.removeSource(u),this._update(!0)}getSource(u){return this.style.getSource(u)}addImage(u,t,n={}){const{pixelRatio:o=1,sdf:c=!1,stretchX:d,stretchY:g,content:_}=n;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||a.a(t))){if(t.width===void 0||t.height===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:x,height:S,data:I}=t,A=t;return this.style.addImage(u,{data:new a.R({width:x,height:S},new Uint8Array(I)),pixelRatio:o,stretchX:d,stretchY:g,content:_,sdf:c,version:0,userImage:A}),A.onAdd&&A.onAdd(this,u),this}}{const{width:x,height:S,data:I}=a.h.getImageData(t);this.style.addImage(u,{data:new a.R({width:x,height:S},I),pixelRatio:o,stretchX:d,stretchY:g,content:_,sdf:c,version:0})}}updateImage(u,t){const n=this.style.getImage(u);if(!n)return this.fire(new a.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const o=t instanceof HTMLImageElement||a.a(t)?a.h.getImageData(t):t,{width:c,height:d,data:g}=o;if(c===void 0||d===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(c!==n.data.width||d!==n.data.height)return this.fire(new a.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const _=!(t instanceof HTMLImageElement||a.a(t));return n.data.replace(g,_),this.style.updateImage(u,n),this}getImage(u){return this.style.getImage(u)}hasImage(u){return u?!!this.style.getImage(u):(this.fire(new a.j(new Error("Missing required image id"))),!1)}removeImage(u){this.style.removeImage(u)}loadImage(u,t){Re.getImage(this._requestManager.transformRequest(u,Fe.Image),t)}listImages(){return this.style.listImages()}addLayer(u,t){return this._lazyInitEmptyStyle(),this.style.addLayer(u,t),this._update(!0)}moveLayer(u,t){return this.style.moveLayer(u,t),this._update(!0)}removeLayer(u){return this.style.removeLayer(u),this._update(!0)}getLayer(u){return this.style.getLayer(u)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(u,t,n){return this.style.setLayerZoomRange(u,t,n),this._update(!0)}setFilter(u,t,n={}){return this.style.setFilter(u,t,n),this._update(!0)}getFilter(u){return this.style.getFilter(u)}setPaintProperty(u,t,n,o={}){return this.style.setPaintProperty(u,t,n,o),this._update(!0)}getPaintProperty(u,t){return this.style.getPaintProperty(u,t)}setLayoutProperty(u,t,n,o={}){return this.style.setLayoutProperty(u,t,n,o),this._update(!0)}getLayoutProperty(u,t){return this.style.getLayoutProperty(u,t)}setGlyphs(u,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(u,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(u,t,n={}){return this._lazyInitEmptyStyle(),this.style.addSprite(u,t,n,o=>{o||this._update(!0)}),this}removeSprite(u){return this._lazyInitEmptyStyle(),this.style.removeSprite(u),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(u,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(u,t,n=>{n||this._update(!0)}),this}setLight(u,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(u,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(u,t){return this.style.setFeatureState(u,t),this._update()}removeFeatureState(u,t){return this.style.removeFeatureState(u,t),this._update()}getFeatureState(u){return this.style.getFeatureState(u)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let u=0,t=0;return this._container&&(u=this._container.clientWidth||400,t=this._container.clientHeight||300),[u,t]}_setupContainer(){const u=this._container;u.classList.add("maplibregl-map");const t=this._canvasContainer=B.create("div","maplibregl-canvas-container",u);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=B.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const n=this._containerDimensions(),o=this._getClampedPixelRatio(n[0],n[1]);this._resizeCanvas(n[0],n[1],o);const c=this._controlContainer=B.create("div","maplibregl-control-container",u),d=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(g=>{d[g]=B.create("div",`maplibregl-ctrl-${g} `,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=B.create("div","maplibregl-cooperative-gesture-screen",this._container);let u=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(u=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use ⌘ + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${u}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){B.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(u,t,n){this._canvas.width=Math.floor(n*u),this._canvas.height=Math.floor(n*t),this._canvas.style.width=`${u}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const u={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let t=null;this._canvas.addEventListener("webglcontextcreationerror",o=>{t={requestedAttributes:u},o&&(t.statusMessage=o.statusMessage,t.type=o.type)},{once:!0});const n=this._canvas.getContext("webgl2",u)||this._canvas.getContext("webgl",u);if(!n){const o="Failed to initialize WebGL";throw t?(t.message=o,new Error(JSON.stringify(t))):new Error(o)}this.painter=new Vn(n,this.transform),ae.testSupport(n)}_onCooperativeGesture(u,t,n){return!t&&n<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(u){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||u,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(u){return this._update(),this._renderTaskQueue.add(u)}_cancelRenderFrame(u){this._renderTaskQueue.remove(u)}_render(u){const t=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(u),this._removed)return;let n=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const c=this.transform.zoom,d=a.h.now();this.style.zoomHistory.update(c,d);const g=new a.a8(c,{now:d,fadeDuration:t,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),_=g.crossFadingFactor();_===1&&_===this._crossFadingFactor||(n=!0,this._crossFadingFactor=_),this.style.update(g)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,t,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:t,showPadding:this.showPadding}),this.fire(new a.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.bg.mark(a.bh.load),this.fire(new a.k("load"))),this.style&&(this.style.hasTransitions()||n)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const o=this._sourcesDirty||this._styleDirty||this._placementDirty;return o||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.k("idle")),!this._loaded||this._fullyLoaded||o||(this._fullyLoaded=!0,a.bg.mark(a.bh.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var u;this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Re.removeThrottleControl(this._imageQueueHandle),(u=this._resizeObserver)===null||u===void 0||u.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),B.remove(this._canvasContainer),B.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),a.bg.clearMetrics(),this._removed=!0,this.fire(new a.k("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=a.h.frame(u=>{a.bg.frame(u),this._frame=null,this._render(u)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(u){this._showTileBoundaries!==u&&(this._showTileBoundaries=u,this._update())}get showPadding(){return!!this._showPadding}set showPadding(u){this._showPadding!==u&&(this._showPadding=u,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(u){this._showCollisionBoxes!==u&&(this._showCollisionBoxes=u,u?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(u){this._showOverdrawInspector!==u&&(this._showOverdrawInspector=u,this._update())}get repaint(){return!!this._repaint}set repaint(u){this._repaint!==u&&(this._repaint=u,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(u){this._vertices=u,this._update()}get version(){return tt}getCameraTargetElevation(){return this.transform.elevation}},$t.NavigationControl=class{constructor(u){this._updateZoomButtons=()=>{const t=this._map.getZoom(),n=t===this._map.getMaxZoom(),o=t===this._map.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=o,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",o.toString())},this._rotateCompassArrow=()=>{const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t},this._setButtonTitle=(t,n)=>{const o=this._map._getUIString(`NavigationControl.${n}`);t.title=o,t.setAttribute("aria-label",o)},this.options=a.e({},So,u),this._container=B.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),B.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),B.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=B.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(u){return this._map=u,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Co(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){B.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(u,t){const n=B.create("button",u,this._container);return n.type="button",n.addEventListener("click",t),n}},$t.GeolocateControl=class extends a.E{constructor(u){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new a.k("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new a.k("geolocate",t)),this._finish()}},this._updateCamera=t=>{const n=new a.L(t.coords.longitude,t.coords.latitude),o=t.coords.accuracy,c=this._map.getBearing(),d=a.e({bearing:c},this.options.fitBoundsOptions),g=qe.fromLngLat(n,o);this._map.fitBounds(g,d,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const n=new a.L(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(this.options.trackUserLocation)if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&ds)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new a.k("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=t=>{if(this._map){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=B.create("button","maplibregl-ctrl-geolocate",this._container),B.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",t===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=B.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new qn({element:this._dotElement}),this._circleElement=B.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new qn({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new a.k("trackuserlocationend")))})}},this.options=a.e({},mi,u)}onAdd(u){return this._map=u,this._container=B.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(t,n=!1){wi===void 0||n?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(o=>{wi=o.state!=="denied",t(wi)}).catch(()=>{wi=!!window.navigator.geolocation,t(wi)}):(wi=!!window.navigator.geolocation,t(wi)):t(wi)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),B.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,hi=0,ds=!1}_isOutOfMapMaxBounds(u){const t=this._map.getMaxBounds(),n=u.coords;return t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const u=this._map.getBounds(),t=u.getSouthEast(),n=u.getNorthEast(),o=t.distanceTo(n),c=Math.ceil(this._accuracy/(o/this._map._container.clientHeight)*2);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":hi--,ds=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new a.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let u;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),hi++,hi>1?(u={maximumAge:6e5,timeout:0},ds=!0):(u=this.options.positionOptions,ds=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,u)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},$t.AttributionControl=Pr,$t.LogoControl=ti,$t.ScaleControl=class{constructor(u){this._onMove=()=>{js(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,js(this._map,this._container,this.options)},this.options=a.e({},$s,u)}getDefaultPosition(){return"bottom-left"}onAdd(u){return this._map=u,this._container=B.create("div","maplibregl-ctrl maplibregl-ctrl-scale",u.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){B.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},$t.FullscreenControl=class extends a.E{constructor(u={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,u&&u.container&&(u.container instanceof HTMLElement?this._container=u.container:a.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(u){return this._map=u,this._container||(this._container=this._map.getContainer()),this._controlContainer=B.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){B.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const u=this._fullscreenButton=B.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);B.create("span","maplibregl-ctrl-icon",u).setAttribute("aria-hidden","true"),u.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const u=this._getTitle();this._fullscreenButton.setAttribute("aria-label",u),this._fullscreenButton.title=u}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new a.k("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new a.k("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},$t.TerrainControl=class{constructor(u){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=u}onAdd(u){return this._map=u,this._container=B.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=B.create("button","maplibregl-ctrl-terrain",this._container),B.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){B.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},$t.Popup=class extends a.E{constructor(u){super(),this.remove=()=>(this._content&&B.remove(this._content),this._container&&(B.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new a.k("close")),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=B.create("div","maplibregl-popup",this._map.getContainer()),this._tip=B.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const g of this.options.className.split(" "))this._container.classList.add(g);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=To(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!t)return;const n=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);let o=this.options.anchor;const c=ps(this.options.offset);if(!o){const g=this._container.offsetWidth,_=this._container.offsetHeight;let x;x=n.y+c.bottom.y<_?["top"]:n.y>this._map.transform.height-_?["bottom"]:[],n.x<g/2?x.push("left"):n.x>this._map.transform.width-g/2&&x.push("right"),o=x.length===0?"bottom":x.join("-")}const d=n.add(c[o]).round();B.setTransform(this._container,`${jr[o]} translate(${d.x}px,${d.y}px)`),jl(this._container,o,"popup")},this._onClose=()=>{this.remove()},this.options=a.e(Object.create(Io),u)}addTo(u){return this._map&&this.remove(),this._map=u,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new a.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(u){return this._lngLat=a.L.convert(u),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(u){return this.setDOMContent(document.createTextNode(u))}setHTML(u){const t=document.createDocumentFragment(),n=document.createElement("body");let o;for(n.innerHTML=u;o=n.firstChild,o;)t.appendChild(o);return this.setDOMContent(t)}getMaxWidth(){var u;return(u=this._container)===null||u===void 0?void 0:u.style.maxWidth}setMaxWidth(u){return this.options.maxWidth=u,this._update(),this}setDOMContent(u){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=B.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(u),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(u){this._container&&this._container.classList.add(u)}removeClassName(u){this._container&&this._container.classList.remove(u)}setOffset(u){return this.options.offset=u,this._update(),this}toggleClassName(u){if(this._container)return this._container.classList.toggle(u)}_createCloseButton(){this.options.closeButton&&(this._closeButton=B.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const u=this._container.querySelector(Eo);u&&u.focus()}},$t.Marker=qn,$t.Style=Zi,$t.LngLat=a.L,$t.LngLatBounds=qe,$t.Point=a.P,$t.MercatorCoordinate=a.U,$t.Evented=a.E,$t.AJAXError=a.bi,$t.config=a.c,$t.CanvasSource=bi,$t.GeoJSONSource=gi,$t.ImageSource=Rt,$t.RasterDEMTileSource=Jt,$t.RasterTileSource=Mt,$t.VectorTileSource=Kt,$t.VideoSource=ki,$t.setRTLTextPlugin=a.bj,$t.getRTLTextPluginStatus=a.bk,$t.prewarm=function(){Cn().acquire(kt)},$t.clearPrewarmedResources=function(){const u=sr;u&&(u.isPreloaded()&&u.numActive()===1?(u.release(kt),sr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},Ao.extend($t,{isSafari:a.ac,getPerformanceMetrics:a.bg.getPerformanceMetrics}),$t});var O=E;return O})})(Hf);var fx=Hf.exports;const mx=vf(fx);function gx(){const[f,v]=W.useState(!1);return _e.jsx("div",{className:f?"fixed top-0 right-0 bottom-0 left-0 z-[9999]":"w-full h-full relative",children:_e.jsx(dx,{mapLib:mx,style:{width:"100%",height:" 100%",position:"relative"},mapStyle:"https://api.ekgis.vn/v2/mapstyles/style/osmplus/standard/style.json?api_key=wtpM0U1ZmE2s87LEZNSHf63Osc1a2sboaozCQNsy",children:_e.jsx(px,{id:"raster-tiles",type:"raster",tileSize:256,tiles:["https://api.ekgis.vn/v1/maps/roadmap/{z}/{x}/{y}.png?api_key=wtpM0U1ZmE2s87LEZNSHf63Osc1a2sboaozCQNsy"]})})})}function _x({data:f}){return _e.jsxs(Xs,{className:"h-[500px]",children:[_e.jsx(Rr,{span:8,children:_e.jsx(_h,{columns:[{title:"Stt",dataIndex:"stt",key:"stt",render:(v,w,C)=>C+1},...xh],dataSource:kf,pagination:!1})}),_e.jsx(Rr,{span:16,children:_e.jsx(gx,{})})]})}const{Dragger:yx}=Iv,vx={name:"file",multiple:!0,action:"https://run.mocky.io/v3/435e224c-44fb-4773-9faf-380c5e6a2188",onChange(f){const{status:v}=f.file;v!=="uploading"&&console.log(f.file,f.fileList),v==="done"?yc.success(`${f.file.name} file uploaded successfully.`):v==="error"&&yc.error(`${f.file.name} file upload failed.`)},onDrop(f){console.log("Dropped files",f.dataTransfer.files)}};function xx(){return _e.jsxs(yx,{...vx,children:[_e.jsx("p",{className:"ant-upload-drag-icon",children:_e.jsx(Mv,{})}),_e.jsx("p",{className:"ant-upload-text",children:"Click or drag file to this area to upload"}),_e.jsx("p",{className:"ant-upload-hint",children:"Support for a single or bulk upload. Strictly prohibited from uploading company data or other banned files."})]})}function bx({form:f,filter:v,setFilter:w}){const[C,E]=W.useState([]),[z,O]=W.useState([]),[a,Q]=W.useState([]),[B,ae]=W.useState([]);W.useState(""),W.useState(""),W.useEffect(()=>{f.setFieldsValue(v)},[v]),W.useEffect(()=>{(async()=>{let we=await Sn.get("/api/method/frappe.desk.search.search_link",{params:{txt:"",doctype:"Customer Group",ignore_user_permissions:0,reference_doctype:"Customer"}}),ke=await Sn.get("/api/method/mbw_dms.api.location.list_province");O(ke.result);let{results:Ne}=we;E(Ne.map(Re=>({label:Re.value,value:Re.value})))})()},[]);const oe=async we=>{let ke=z.find(Ne=>Ne.ten_tinh==we)?.ma_tinh;if(ke){let Ne=await Sn.get("/api/method/mbw_dms.api.location.list_district",{params:{ma_tinh_thanh:Number.parseInt(ke)}});Q(Ne.result)}},he=async we=>{let ke=a.find(Ne=>Ne.ten_huyen==we)?.ma_huyen;if(ke){let Ne=await Sn.get("/api/method/mbw_dms.api.location.list_ward",{params:{ma_quan_huyen:ke}});ae(Ne.result)}};return _e.jsxs(lh,{form:f,layout:"vertical",onFinish:w,children:[_e.jsx(qr,{label:"Loại khách hàng",name:"customer_type",children:_e.jsx(wn,{options:[{label:"Tất cả",value:!1},{label:"Company",value:"Company"},{label:"Individual",value:"Individual"}]})}),_e.jsx(qr,{label:"Nhóm khách hàng",name:"customer_group",children:_e.jsx(wn,{options:C})}),_e.jsx("p",{className:"font-medium text-sm",children:"Địa chỉ"}),_e.jsx(qr,{label:"Tỉnh/Thành phố",name:"city",children:_e.jsx(wn,{options:z.map(we=>({label:we.ten_tinh,value:we.ten_tinh})),onChange:oe})}),_e.jsx(qr,{label:"Quận/huyện",name:"district",children:_e.jsx(wn,{options:a.map(we=>({label:we.ten_huyen,value:we.ten_huyen})),disabled:a.length==0,onChange:he})}),_e.jsx(qr,{label:"Phường/xã",name:"ward",children:_e.jsx(wn,{options:B.map(we=>({label:we.ten_xa,value:we.ten_xa})),disabled:B.length==0})})]})}const wx=[...xh,{title:"Loại khách hàng",dataIndex:"customer_id",key:"customer_type"},{title:"Nhóm khách hàng",dataIndex:"customer_name",key:"customer_group"},...Mf],sf=f=>{let v=[];for(let w in f)f[w]&&(v=[...v,{key:[Lv[w]],value:f[w],key2:w}]);return v};function Sx({selected:f,handleAdd:v,closeModal:w}){const[C]=h_(),[E,z]=W.useState([]),[O,a]=W.useState(kf),[Q,B]=W.useState({}),[ae,oe]=W.useState(!1),he=20,[we,ke]=W.useState(1),[Ne,Re]=W.useState(40),Fe={selectedRowKeys:E&&E.map(Ie=>Ie.name),onChange:(Ie,rt)=>{z(rt)}},We=()=>{C.submit(),oe(!1)},Ue=Ie=>{if(Ie){let rt={...Q};delete rt[Ie.key2],C.setFieldsValue(rt),B(et=>(delete et[Ie.key2],{...et}))}else C.resetFields(),B({})};W.useEffect(()=>{(async()=>{const Ie=await Sn.get("/api/method/mbw_dms.api.router.get_customer",{params:{...Q,page_size:he,page_number:we}});a(Ie?.result?.data),Re(Ie.result?.total),console.log("rsCustomer",Ie)})()},[Q,we]);const ye=()=>{E.length>0&&v(E),w()};return W.useEffect(()=>{z(f)},[f]),_e.jsxs(_e.Fragment,{children:[_e.jsxs(Xs,{className:"justify-between",children:[_e.jsxs(Rr,{className:"inline-flex ",children:[_e.jsx(qr,{children:_e.jsx(gc,{placeholder:"Tìm kiếm khách hàng",prefix:_e.jsx(xf,{})})}),_e.jsxs("div",{className:"flex justify-center items-center ml-4",children:[_e.jsx(Oa,{className:"flex items-center text-nowrap !text-[13px] !leading-[21px] !font-normal  border-r-[0.1px] rounded-r-none h-[36px]",icon:_e.jsx(v_,{style:{fontSize:"20px"}}),onClick:oe.bind(null,!0),children:"Filter"}),_e.jsx(Oa,{className:"border-l-[0.1px] rounded-l-none h-[36px]",onClick:()=>Ue(),children:_e.jsx(x_,{style:{fontSize:"20px"}})})]})]}),_e.jsxs(Rr,{className:"inline-flex items-center",children:[_e.jsxs("span",{className:"mr-4",children:["Đã chọn ",E.length||0," khách hàng"]}),_e.jsx(Oa,{type:"primary",onClick:ye,children:"Thêm"})]})]}),_e.jsxs("div",{className:"py-5 px-4",children:[_e.jsxs("span",{children:[O.length," kết quả hiển thị"]}),sf(Q).length>0&&_e.jsxs(Xs,{className:"items-center",children:[sf(Q).map(Ie=>_e.jsxs(d_,{closeIcon:_e.jsx(gh,{}),onClose:()=>{Ue(Ie)},children:[Ie.key,": ",Ie.value]})),_e.jsx("span",{className:"cursor-pointer",onClick:()=>Ue(),children:"Clear all"})]})]}),_e.jsx(_h,{rowSelection:{type:"checkbox",...Fe},columns:wx,dataSource:O.map(Ie=>({key:Ie.name,...Ie})),pagination:!1}),_e.jsx(Xs,{className:"justify-end mt-2",children:_e.jsx(p_,{defaultCurrent:we,pageSize:he,total:Ne,onChange:(Ie,rt)=>{ke(Ie)}})}),_e.jsx(ch,{width:451,title:"Bộ lọc",open:ae,okText:"Áp dụng",cancelText:"Đặt lại",onCancel:oe.bind(null,!1),onOk:We,children:_e.jsx(bx,{filter:Q,setFilter:B,form:C})})]})}function Cx({listCustomer:f,handleCustomer:v}){const[w,C]=W.useState("list"),[E,z]=W.useState(!1),[O,a]=W.useState(!1),Q=ae=>{switch(ae){case"Choose":z(!1);break;case"Import":a(!1);break;default:z(!1),a(!1)}},B=ae=>{switch(ae){case"Choose":z(!0);break;case"Import":a(!0);break}};return _e.jsxs(_e.Fragment,{children:[_e.jsxs(Xs,{gutter:16,className:"justify-between p-4 pb-5 pt-10 mt-0",children:[_e.jsx(Rr,{children:_e.jsxs(Xs,{gutter:8,children:[_e.jsx(Rr,{span:9,className:"text-[#1677ff]",children:_e.jsx(qr,{children:_e.jsx(wn,{defaultValue:"add",options:zv,onSelect:B})})}),_e.jsx(Rr,{span:7,children:_e.jsx(Oa,{className:"w-full flex items-center text-[#1677ff] bg-[#1877f214] h-[36px]",icon:_e.jsx(R0,{}),children:"Tối ưu tuyến"})}),_e.jsx(Rr,{span:8,children:_e.jsx(qr,{children:_e.jsx(gc,{placeholder:"Tìm kiếm khách hàng",prefix:_e.jsx(xf,{})})})})]})}),_e.jsxs(Rr,{children:[" ",_e.jsxs(Ru.Group,{defaultValue:w,onChange:ae=>C(ae.target.value),size:"middle",children:[_e.jsx(Ru.Button,{value:"list",children:_e.jsx(B0,{size:28})}),_e.jsx(Ru.Button,{value:"map",children:_e.jsx(F0,{size:28})})]})]})]}),_e.jsx("div",{children:w=="list"?_e.jsx(O0,{data:f,handleData:v}):_e.jsx(_x,{data:f})}),_e.jsx(ch,{width:1240,open:E,onCancel:Q.bind(null,"Choose"),title:_e.jsx("strong",{className:"text-xl",children:"Chọn khách hàng"}),footer:!1,children:_e.jsx(Sx,{selected:f,handleAdd:v,closeModal:z.bind(null,!1)})}),_e.jsx(ch,{width:777,open:O,onCancel:Q.bind(null,"Import"),okText:"Tiếp tục",cancelText:"Hủy",title:_e.jsx("strong",{className:"text-xl",children:"Nhập dữ liệu khách hàng"}),children:_e.jsx(xx,{})})]})}function Tx(){const[f]=lh.useForm(),v=f_(),[w,C]=W.useState([]),[E,z]=yc.useMessage(),O=()=>{E.open({type:"success",content:"Success!!"})},a=()=>{E.open({type:"error",content:"Something was wrong"})},Q=W.useCallback(async B=>{B={...B,customers:w.map(ae=>{let oe=["customer_id","customer_name","display_address","phone_number","customer","frequency"];for(let he in ae)oe.includes(he)||delete ae[he];return ae})};try{await Sn.post("/api/method/mbw_dms.api.router.create_router",B),O(),v("/")}catch(ae){a(),console.log("error create",ae)}},[w]);return _e.jsxs(_e.Fragment,{children:[z,_e.jsx(b_,{title:"Thêm tuyến",buttons:[{label:"Thêm",action:f.submit,type:"primary"}]}),_e.jsx("div",{className:"bg-white rounded-md",children:_e.jsx(lh,{layout:"vertical",form:f,onFinish:Q,children:_e.jsx(y_,{defaultActiveKey:"1",items:[{label:_e.jsx("p",{className:"px-4 mb-0",children:" Thông tin chung"}),key:"1",children:_e.jsx(L0,{})},{label:_e.jsx("p",{className:"px-4 mb-0",children:"Khách hàng"}),key:"2",children:_e.jsx(Cx,{handleCustomer:C,listCustomer:w})}],indicatorSize:B=>B-18})})})]})}function Mx(){return _e.jsxs(_e.Fragment,{children:[_e.jsx(m_,{children:_e.jsx("title",{children:" RouterControll"})}),_e.jsx(Tx,{})]})}export{Mx as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/mapbox-gl-AmDk7qVP.js","assets/index-7CAw7ufh.js","assets/index-dstTe7sK.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
