import{Y as a,ct as D,cu as ns,cv as oe,V as f,L as s,P as _,a2 as y,cw as B,a1 as g,a6 as ge,aa as we,cx as Y,cy as K,cz as C,cA as v,aZ as V,cB as N,cC as H,cD as q,cE as A,a_ as os,a9 as cs,N as x,R as is,Q as U,cF as ce,cG as ie,cH as ue,cI as he,cJ as pe,cK as me,cL as de,a7 as us,bD as hs}from"./index-WDMiEzoO.js";import{D as E}from"./index-ytfFMY8T.js";import{D as ps,S as ms}from"./index-TV6yVtKn.js";import{a as ds}from"./index.esm-ew_9zTSa.js";import{e as fs,f as xs}from"./data-u-VkVTNg.js";import{V as ys}from"./VerticalAlignBottomOutlined-x0r4lydk.js";function Se(){var t=a.useContext(D);return t}function be(t){t===void 0&&(t=D);var r=t===D?Se:function(){return a.useContext(t)};return function(){var n=r(),u=n.store;return u}}var gs=be();function ws(t){t===void 0&&(t=D);var r=t===D?gs:be(t);return function(){var n=r();return n.dispatch}}var b=ws(),Ss=function(r,c){return r===c};function bs(t,r,c,n){var u=a.useReducer(function(F){return F+1},0),d=u[1],l=a.useMemo(function(){return ns(c,n)},[c,n]),o=a.useRef(),h=a.useRef(),w=a.useRef(),S=a.useRef(),k=c.getState(),j;try{if(t!==h.current||k!==w.current||o.current){var I=t(k);S.current===void 0||!r(I,S.current)?j=I:j=S.current}else j=S.current}catch(F){throw o.current&&(F.message+=`
The error may be correlated with this previous error:
`+o.current.stack+`

`),F}return oe(function(){h.current=t,w.current=k,S.current=j,o.current=void 0}),oe(function(){function F(){try{var T=c.getState();if(T===w.current)return;var $=h.current(T);if(r($,S.current))return;S.current=$,w.current=T}catch(R){o.current=R}d()}return l.onStateChange=F,l.trySubscribe(),F(),function(){return l.tryUnsubscribe()}},[c,l]),j}function Fs(t){t===void 0&&(t=D);var r=t===D?Se:function(){return a.useContext(t)};return function(n,u){u===void 0&&(u=Ss);var d=r(),l=d.store,o=d.subscription,h=bs(n,u,l,o);return a.useDebugValue(h),h}}var O=Fs();const W="(max-width: 1062px)",As="(min-width: 1200px)",Fe=[{label:"Tháng 1",value:"1"},{label:"Tháng 2",value:"2"},{label:"Tháng 3",value:"3"},{label:"Tháng 4",value:"4"},{label:"Tháng 5",value:"5"},{label:"Tháng 6",value:"6"},{label:"Tháng 7",value:"7"},{label:"Tháng 8",value:"8"},{label:"Tháng 9",value:"9"},{label:"Tháng 10",value:"10"},{label:"Tháng 11",value:"11"},{label:"Tháng 12",value:"12"}],Ws=20,G=t=>{const[r,c]=a.useState(!1);return a.useEffect(()=>{const n=window.matchMedia(t);n.matches!==r&&c(n.matches);const u=()=>c(n.matches);return window.addEventListener("resize",u),()=>window.removeEventListener("resize",u)},[r,t]),r},_s=(f().month()+1).toString(),js=({setPage:t})=>{const r=b(),c=G(`${W}`);return s.jsxs(_,{className:`min-w-[130px] ${c?"w-full":" w-[20%]"}`,children:[s.jsx("label",{className:"text-xs font-normal leading-[21px] pl-1 ",children:"Tháng"}),s.jsx(y,{className:"!bg-[#F4F6F8] ",defaultValue:_s,options:Fe,onChange:n=>{r(B(n)),t&&t(1)}})]})},Cs=()=>{const t=b(),[r,c]=a.useState([]);return a.useEffect(()=>{(async()=>{let n=await g.get("/api/method/mbw_dms.api.router.get_team_sale");c(ge({data:n.result.map(u=>({title:u.name,value:u.name,...u})),keyValue:"value",parentField:"parent_sales_person"}))})()},[]),s.jsxs(_,{className:"min-w-[130px]  w-[20%]",children:[s.jsx("label",{className:"text-xs font-normal leading-[21px] pl-1 ",children:"Nhóm bán hàng"}),s.jsx(we,{placeholder:"Tất cả nhóm bán hàng",allowClear:!0,showSearch:!0,treeData:r,onChange:n=>{t(Y(n))},dropdownStyle:{maxHeight:400,overflow:"auto",minWidth:350}})]})},vs=()=>{const t=b(),r=n=>{t(K(n?.$y.toString()))},c=G(`${W}`);return s.jsxs(_,{className:`min-w-[130px] ${c?"w-full":" w-[20%]"}`,children:[s.jsx("label",{className:"text-xs font-normal leading-[21px] pl-1 ",children:"Năm"}),s.jsx(E,{className:"!bg-[#F4F6F8] w-full rounded-lg h-7",onChange:r,placeholder:"Chọn năm",picker:"year",allowClear:!1,defaultValue:f().startOf("year")})]})},Ns=({setPage:t,matchMedia:r})=>{const[c,n]=a.useState([]),[u,d]=a.useState(""),l=b(),{sales_team:o}=O(h=>h.group);return a.useEffect(()=>{(async()=>{let h=await g.get("/api/method/mbw_dms.api.router.get_sale_person",{params:{team_sale:o,key_search:u}}),{message:w}=h;n(w.map(S=>({value:S.employee_code,label:S.employee_name||S.employee_code})))})()},[u,o]),s.jsxs(_,{className:`min-w-[130px] ${r?"w-full":"w-[20%]"}`,children:[s.jsx("label",{className:"text-xs font-normal leading-[21px] pl-1 ",children:"Nhân viên"}),s.jsx(y,{filterOption:!0,allowClear:!0,showSearch:!0,placeholder:"Tất cả nhân viên",onSearch:h=>{d(h)},options:c,onSelect:h=>{l(C(h)),t(1)},onClear:()=>{l(C(""))}})]})},Ds=f().startOf("month"),ks=()=>{const t=b(),{startDate:r,endDate:c}=O(l=>l.date),n=G(`${W}`),u=l=>{if(l==null)t(v(l));else if(c&&l&&l.isAfter(f.unix(c),"day"))V.error("Từ ngày phải nhỏ hơn hoặc bằng Đến ngày");else{let o=Date.parse(l.$d)/1e3;t(v(o))}},d=f(r*1e3);return s.jsxs(_,{className:`min-w-[130px]  ${n?"w-full":" w-[20%]"}`,children:[s.jsx("label",{className:"text-xs font-normal leading-[21px] pl-1 ",children:"Từ ngày"}),s.jsx(E,{format:"DD-MM-YYYY",className:"!bg-[#F4F6F8] w-full rounded-lg h-7",placeholder:"Từ ngày",onChange:u,value:d,defaultValue:Ds,allowClear:!1})]})},Ts=f().endOf("month"),Es=()=>{const t=b(),{startDate:r,endDate:c}=O(o=>o.date),n=o=>{if(r){const h=f.unix(r).month();return o&&o.month()!==h}},u=o=>{if(o==null)t(N(o));else if(r&&o&&o.isBefore(f.unix(r),"day"))V.error("Đến ngày phải lớn hơn hoặc bằng Từ ngày");else{let h=Date.parse(o.$d)/1e3;t(N(h))}},d=G(`${W}`),l=f(c*1e3);return s.jsxs(_,{className:`min-w-[130px] ${d?"w-full":" w-[20%]"}`,children:[s.jsx("label",{className:"text-xs font-normal leading-[21px] pl-1 ",children:"Đến ngày"}),s.jsx(E,{format:"DD-MM-YYYY",className:"!bg-[#F4F6F8] w-full rounded-lg h-7",onChange:u,placeholder:"Đến ngày",defaultValue:Ts,disabledDate:n,value:l,allowClear:!1})]})},Is=({setPage:t})=>{const[r,c]=a.useState([]),[n,u]=a.useState(""),d=b();return a.useEffect(()=>{(async()=>{let l=await g.get("/api/method/frappe.desk.search.search_link",{params:{txt:n,doctype:"Supplier",ignore_user_permissions:0,query:""}}),{message:o}=l;c(o.map(h=>({value:h?.value,label:h.description.split(",")[0].trim()})))})()},[n]),s.jsxs(_,{className:"min-w-[130px] w-[20%]",children:[s.jsx("label",{className:"text-xs font-normal leading-[21px] pl-1 ",children:"Nhà Cung cấp"}),s.jsx(y,{filterOption:!1,allowClear:!0,showSearch:!0,placeholder:"Tất cả nhà cung cấp",onSearch:l=>{u&&u(l)},options:r,onSelect:l=>{d(H(l)),t(1)},onClear:()=>{d(H(""))}})]})},$s=({setPage:t,matchMedia:r})=>{const[c,n]=a.useState([]),[u,d]=a.useState(""),l=b();return a.useEffect(()=>{(async()=>{let o=await g.get("/api/method/frappe.desk.search.search_link",{params:{txt:u,doctype:"Brand",ignore_user_permissions:0,query:""}}),{message:h}=o;n(h.map(w=>({value:w?.value,description:w?.description})))})()},[u]),s.jsxs(_,{className:`min-w-[130px] ${r?"w-full":"w-[20%]"}`,children:[s.jsx("label",{className:"text-xs font-normal leading-[21px] pl-1 ",children:"Nhãn hiệu"}),s.jsx(y,{filterOption:!1,allowClear:!0,showSearch:!0,placeholder:"Tất cả nhãn hiệu",onSearch:o=>{d(o)},options:c,onSelect:o=>{l(q(o)),t(1)},onClear:()=>{l(q(""))}})]})},Ms=({setPage:t})=>{const[r,c]=a.useState([]),[n,u]=a.useState(""),d=b();return a.useEffect(()=>{(async()=>{let l=await g.get("/api/method/frappe.desk.search.search_link",{params:{txt:n,doctype:"DMS Industry",ignore_user_permissions:0,query:""}}),{message:o}=l;c(o.map(h=>({value:h?.value,description:h?.description})))})()},[n]),s.jsxs(_,{className:"min-w-[130px] w-[20%]",children:[s.jsx("label",{className:"text-xs font-normal leading-[21px] pl-1 ",children:"Ngành hàng"}),s.jsx(y,{filterOption:!1,allowClear:!0,showSearch:!0,placeholder:"Tất cả ngành hàng",onSearch:l=>{u(l)},options:r,onSelect:l=>{d(A(l)),t(1)},onClear:()=>{d(A(""))}})]})},Os=({setPage:t,inputMonth:r,inputYear:c,inputFromDate:n,inputToDate:u,inputSaleGroup:d,inputEmployee:l,inputSupplier:o,inputIndustry:h,inpitBrand:w})=>s.jsxs(s.Fragment,{children:[r&&s.jsx(js,{setPage:t}),c&&s.jsx(vs,{}),n&&s.jsx(ks,{}),u&&s.jsx(Es,{}),d&&s.jsx(Cs,{}),l&&s.jsx(Ns,{setPage:t}),o&&s.jsx(Is,{setPage:t}),h&&s.jsx(Ms,{setPage:t}),w&&s.jsx($s,{setPage:t})]}),Gs=Os,_e=f().startOf("month"),je=f().endOf("month");let fe=Date.parse(_e.$d)/1e3,xe=Date.parse(je.$d)/1e3;const Z=(f().month()+1).toString(),ye=f().startOf("year").$y.toString(),Rs=({setPage:t,matchMedia:r,inputFromDate:c,inputMonth:n,inputToDate:u,inputYear:d,inputSaleGroup:l,inputEmployee:o,inputCompany:h,inputCustomer:w,inputTerritory:S,inputWarehouse:k,inputCustomerType:j,inputCustomerGroup:I,inputOrder:F,inputSupplier:T,inputIndustry:$,inputBrand:R})=>{const[Ce,ve]=a.useState([]),[Ne,De]=a.useState([]),[ke,Te]=a.useState([]),[Ee,Ie]=a.useState([]),[$e,Me]=a.useState([]),[Oe,Re]=a.useState([]),[Le,Be]=a.useState([]),[Ye,Ke]=a.useState([]),[Ve,He]=a.useState([]),[qe,Ae]=a.useState([]),[J,We]=a.useState(""),[X,Ge]=a.useState(""),[P,ze]=a.useState(""),[ee,Qe]=a.useState(""),[se,Ue]=a.useState(""),[te,Ze]=a.useState(""),[ae,Je]=a.useState(""),[re,Xe]=a.useState(""),[le,Pe]=a.useState(""),[z]=os(),i=b(),{sales_team:ne}=O(e=>e.group);$&&a.useEffect(()=>{(async()=>{let e=await g.get("/api/method/frappe.desk.search.search_link",{params:{txt:re,doctype:"DMS Industry",ignore_user_permissions:0,query:""}}),{message:p}=e;Be(p.map(m=>({value:m?.value,description:m?.description})))})()},[re]),R&&a.useEffect(()=>{(async()=>{let e=await g.get("/api/method/frappe.desk.search.search_link",{params:{txt:ae,doctype:"Brand",ignore_user_permissions:0,query:""}}),{message:p}=e;Re(p.map(m=>({value:m?.value,description:m?.description})))})()},[ae]),w&&a.useEffect(()=>{(async()=>{let e=await g.get("/api/method/frappe.desk.search.search_link",{params:{txt:P,doctype:"Customer",ignore_user_permissions:0,query:""}}),{message:p}=e;ve(p.map(m=>({value:m.value,label:m.value})))})()},[P]),S&&a.useEffect(()=>{(async()=>{let e=await g.get("/api/method/frappe.desk.search.search_link",{params:{txt:ee,doctype:"Territory",ignore_user_permissions:0,query:""}}),{message:p}=e;Te(p.map(m=>({value:m.value,label:m.value})))})()},[ee]),I&&a.useEffect(()=>{(async()=>{let e=await g.get("/api/method/frappe.desk.search.search_link",{params:{txt:le,doctype:"Customer Group",ignore_user_permissions:0,query:""}}),{message:p}=e;Ie(p.map(m=>({value:m.value.trim(),label:m.value.trim()})))})()},[le]),a.useEffect(()=>{(async()=>{let e=await g.get("/api/method/mbw_dms.api.router.get_team_sale");Ke(ge({data:e.result.map(p=>({title:p.name,value:p.name,...p})),keyValue:"value",parentField:"parent_sales_person"}))})()},[]),o&&a.useEffect(()=>{(async()=>{let e=await g.get("/api/method/mbw_dms.api.router.get_sale_person",{params:{team_sale:ne,key_search:X}}),{message:p}=e;He(p.map(m=>({value:m.employee_code,label:m.employee_name||m.employee_code})))})()},[ne,X]),h&&a.useEffect(()=>{(async()=>{let e=await g.get("/api/method/frappe.desk.search.search_link",{params:{txt:se,doctype:"Company",ignore_user_permissions:0,query:""}}),{message:p}=e;Me(p.map(m=>({value:m.value,label:m.value})))})()},[se]),k&&a.useEffect(()=>{(async()=>{let e=await g.get("/api/method/frappe.desk.search.search_link",{params:{txt:te,doctype:"Warehouse",ignore_user_permissions:0,query:""}}),{message:p}=e;De(p.map(m=>({value:m.value,label:m.value})))})()},[te]),T&&a.useEffect(()=>{(async()=>{let e=await g.get("/api/method/frappe.desk.search.search_link",{params:{txt:J,doctype:"Supplier",ignore_user_permissions:0,query:""}}),{message:p}=e;Ae(p.map(m=>({value:m?.value,label:m.description.split(",")[0].trim()})))})()},[J]);const L=b(),{startDate:M,endDate:Q}=O(e=>e.date),es=f(M*1e3),ss=f(Q*1e3),ts=e=>{if(e==null)L(v(e));else if(Q&&e&&e.isAfter(f.unix(Q),"day"))V.error("Từ ngày phải nhỏ hơn hoặc bằng Đến ngày");else{let p=Date.parse(e.$d)/1e3;L(v(p))}},as=e=>{if(e==null)L(N(e));else if(M&&e&&e.isBefore(f.unix(M),"day"))V.error("Đến ngày phải lớn hơn hoặc bằng Từ ngày");else{let p=Date.parse(e.$d)/1e3;L(N(p))}},rs=e=>{if(M){const p=f.unix(M).month();return e&&e.month()!==p}},ls=e=>{e.customergroup?i(ce(e.customergroup)):i(ce("")),e.customertype?i(ie(e.customertype)):i(ie("")),e.territory?i(ue(e.territory)):i(ue("")),e.filter_fromDate?i(v(e.filter_fromDate.$d/1e3)):i(v(fe)),e.filter_toDate?i(N((e.filter_toDate.$d-999)/1e3)):i(N(xe)),e.has_sales_order?i(he(e.has_sales_order)):i(he("")),e.filter_month?i(B(e.filter_month)):i(B(Z)),e.filter_year?i(K(Date.parse(e.filter_year.$y).toString())):i(K(ye)),e.company?i(pe(e.company)):i(pe("")),e.customer?i(me(e.customer)):i(me("")),e.warehouse?i(de(e.warehouse)):i(de("")),e.filter_group_sales?i(Y(e.filter_group_sales)):i(Y("")),e.filter_employee?i(C(e.filter_employee)):i(C("")),t&&t(1)};return s.jsx(cs,{className:"!h-8",placement:"bottomRight",trigger:["click"],dropdownRender:()=>s.jsxs(ps,{title:"Bộ lọc",children:[s.jsxs(x,{layout:"vertical",form:z,onFinish:ls,children:[!r&&s.jsxs(s.Fragment,{children:[c&&s.jsx(x.Item,{className:"w-[468px] border-none",name:"filter_fromDate",children:s.jsx(E,{format:"DD-MM-YYYY",className:"!bg-[#F4F6F8] w-full rounded-lg h-7",placeholder:"Từ ngày",onChange:ts,value:es,defaultValue:_e,allowClear:!1})}),n&&s.jsx(x.Item,{className:"w-[468px] border-none",name:"filter_month",children:s.jsx(y,{className:"!bg-[#F4F6F8] ",defaultValue:Z,options:Fe})}),u&&s.jsx(x.Item,{className:"w-[468px] border-none",name:"filter_toDate",children:s.jsx(E,{format:"DD-MM-YYYY",className:"!bg-[#F4F6F8] w-full rounded-lg h-7",onChange:as,placeholder:"Đến ngày",defaultValue:je,disabledDate:rs,value:ss,allowClear:!1})}),d&&s.jsx(x.Item,{className:"w-[468px] border-none",name:"filter_year",children:s.jsx(E,{className:"!bg-[#F4F6F8] w-full rounded-lg h-7",placeholder:"Chọn năm",picker:"year",allowClear:!1,defaultValue:f().startOf("year")})}),l&&s.jsx(x.Item,{className:"w-[468px] border-none",name:"filter_group_sales",label:"Nhóm bán hàng",children:s.jsx(we,{placeholder:"Tất cả nhóm bán hàng",allowClear:!0,showSearch:!0,treeData:Ye,dropdownStyle:{maxHeight:400,overflow:"auto",minWidth:350}})}),o&&s.jsx(x.Item,{className:"w-[468px] border-none",label:"Nhân viên",name:"filter_employee",children:s.jsx(y,{filterOption:!0,allowClear:!0,showSearch:!0,placeholder:"Tất cả nhân viên",onSearch:e=>{Ge(e)},options:Ve,onClear:()=>{C&&C("")}})})]}),h&&s.jsx(x.Item,{name:"company",label:"Công ty",className:"w-[468px] border-none",children:s.jsx(y,{showSearch:!0,className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:$e,allowClear:!0,onSearch:e=>{Ue(e)},placeholder:"Tất cả công ty"})}),w&&s.jsx(x.Item,{name:"customer",label:"Khách hàng",className:"w-[468px] border-none",children:s.jsx(y,{showSearch:!0,className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:Ce,filterOption:!1,allowClear:!0,onSearch:e=>{ze(e)},placeholder:"Tất cả khách hàng"})}),k&&s.jsx(x.Item,{name:"warehouse",label:"Kho",className:"w-[468px] border-none",children:s.jsx(y,{showSearch:!0,className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:Ne,allowClear:!0,onSearch:e=>{Ze(e)},placeholder:"Tất cả kho"})}),j&&s.jsx(x.Item,{name:"customertype",label:"Loại hình khách hàng",className:"w-[468px] border-none",children:s.jsx(y,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:fs,allowClear:!0,showSearch:!0,placeholder:"Tất cả loại hình khách hàng"})}),I&&s.jsx(x.Item,{name:"customergroup",label:"Nhóm khách hàng",className:"w-[468px] border-none",children:s.jsx(y,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:Ee,allowClear:!0,onSearch:e=>{Pe(e)},showSearch:!0,placeholder:"Tất cả nhóm khách hàng"})}),F&&s.jsx(x.Item,{label:"Phát sinh đơn hàng",name:"hasorder",className:"w-[468px] border-none",children:s.jsx(y,{placeholder:"Tất cả",className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:xs,allowClear:!0,showSearch:!0})}),S&&s.jsx(x.Item,{name:"territory",label:"Khu vực",className:"w-[468px] border-none",children:s.jsx(y,{showSearch:!0,className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:ke,allowClear:!0,onSearch:e=>{Qe(e)},placeholder:"Tất cả khu vực"})}),R&&s.jsx(x.Item,{name:"territory",label:"Nhãn hiệu",className:"w-[468px] border-none",children:s.jsx(y,{filterOption:!1,allowClear:!0,showSearch:!0,placeholder:"Tất cả nhãn hiệu",onSearch:e=>{Je(e)},options:Oe,onSelect:e=>{i(q(e)),t&&t(1)},onClear:()=>{i(q(""))}})}),T&&s.jsx(x.Item,{name:"supplier",label:"Nhà cung cấp",className:"w-[468px] border-none",children:s.jsx(y,{filterOption:!1,notFoundContent:null,allowClear:!0,showSearch:!0,placeholder:"Tất cả nhà cung cấp",onSearch:e=>{We(e)},options:qe,onSelect:e=>{i(H(e)),t&&t(1)},onClear:()=>{i(H(""))}})}),$&&s.jsx(x.Item,{name:"industry",label:"Ngành hàng",className:"w-[468px] border-none",children:s.jsx(y,{filterOption:!1,allowClear:!0,showSearch:!0,placeholder:"Tất cả ngành hàng",onSearch:e=>{Xe(e)},options:Le,onSelect:e=>{i(A(e)),t&&t(1)},onClear:()=>{i(A(""))}})})]}),s.jsx(is,{className:"justify-between pt-6 pb-4",children:s.jsxs(s.Fragment,{children:[s.jsx(U,{className:"mr-3",onClick:e=>{e.preventDefault(),i(B(Z)),i(K(ye)),!r&&i(Y("")),!r&&i(C("")),i(v(fe)),i(N(xe)),z.resetFields()},children:"Đặt lại"}),s.jsx(U,{type:"primary",onClick:()=>{z.submit()},children:"Áp dụng"})]})})]}),children:s.jsx(U,{onClick:e=>e.preventDefault(),className:"flex items-center text-nowrap !text-[13px] !leading-[21px] !font-normal  border-r-[0.1px]  h-8 mt-4",icon:s.jsx(ds,{style:{fontSize:"20px"}}),children:"Bộ lọc"})})},zs=Rs,Ls=({setRefresh:t,title:r,params:c,file_name:n})=>{const[u,d]=a.useState(!1);return s.jsx(us,{title:r,buttons:[{icon:s.jsx(ms,{className:"text-xl size-4 mb-1 mr-[2px]"}),className:"flex mr-2 h-7 mt-6",action:()=>{t(l=>!l)}},{disabled:u,label:"Xuất dữ liệu",type:"primary",icon:s.jsx(ys,{className:"text-xl"}),size:"18px",className:"flex items-center h-7 mt-6",action:hs.bind(null,{url:"/api/method/mbw_dms.api.exports.export_excel.export_excel",params:c,file_name:n},d)}]})},Qs=Ls;export{zs as D,Gs as F,Ws as P,Qs as R,G as a,As as b,W as m,O as u};
