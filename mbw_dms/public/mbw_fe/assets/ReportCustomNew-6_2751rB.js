import{Y as r,a3 as c,L as e,O as o,a5 as m,bv as a,V as E,a8 as J}from"./index-pVymrpwA.js";import{H as Q}from"./header-page-58W9c4sj.js";import{T as W}from"./tableCustom-WM5GyWDJ.js";import{e as $,f as ee}from"./data-u-VkVTNg.js";import{u as d}from"./useDebount-AN0aWWHJ.js";import{a as te}from"./index-DkZZcBjD.js";import{V as se}from"./VerticalAlignBottomOutlined-reyJfqy6.js";const re=[{title:"STT",dataIndex:"stt",key:"stt",render:(l,s,p)=>p+1},{title:"Phòng ban",dataIndex:"department",key:"department",render:(l,s)=>e.jsx("div",{className:"!w-[175px]",children:s.department})},{title:"Mã nhân viên",dataIndex:"employee_id",key:"employee_id",render:(l,s)=>e.jsx("div",{className:"!w-[175px]",children:s.employee_id})},{title:"Tên nhân viên",dataIndex:"employee_name",key:"employee_name",render:(l,s)=>e.jsx("div",{className:"!w-[175px]",children:s.employee_name})},{title:"Mã khách hàng",dataIndex:"customer_code",key:"customer_code",render:(l,s)=>e.jsx("div",{className:"!w-[175px]",children:s.customer_code})},{title:"Tên khách hàng",dataIndex:"customer_name",key:"customer_name",render:(l,s)=>e.jsx("div",{className:"!w-[175px]",children:s.customer_name})},{title:"Loại khách hàng",dataIndex:"customer_type",key:"customer_type",render:(l,s)=>e.jsx("div",{className:"!w-[175px]",children:s.customer_type})},{title:"Nhóm khách hàng",dataIndex:"customer_group",key:"customer_group",render:(l,s)=>e.jsx("div",{className:"!w-[175px]",children:s.customer_group})},{title:"Người liên hệ",dataIndex:"contact",key:"contact",render:(l,s)=>e.jsx("div",{className:"!w-[175px]",children:s.contact})},{title:"SDT",dataIndex:"phone",key:"phone",render:(l,s)=>e.jsx("div",{className:"!w-[175px]",children:s.phone})},{title:"Mã số thuế",dataIndex:"tax_id",key:"tax_id",render:(l,s)=>e.jsx("div",{className:"!w-[175px]",children:s.tax_id})},{title:"Khu vưc",dataIndex:"territory",key:"territory",render:(l,s)=>e.jsx("div",{className:"!w-[175px]",children:s.territory})},{title:"Địa chỉ",dataIndex:"address",key:"address",render:(l,s)=>e.jsx("div",{className:"!w-[175px]",children:s.contribution})},{title:"Ngày thu thập",dataIndex:"creation",key:"creation",render:(l,s)=>e.jsx("div",{className:"!w-[175px]",children:E(s.creation*1e3).format("DD/MM/YYYY")})},{title:"Nguồn",dataIndex:"f1",key:"f1"},{title:"Số lần VT",dataIndex:"totals_checkin",key:"totals_checkin"},{title:"VT đầu",dataIndex:"first_checkin",key:"first_checkin"},{title:"VT cuối",dataIndex:"last_checkin",key:"last_checkin"},{title:"Số đơn hàng",dataIndex:"totals_so",key:"totals_so"},{title:"Đơn hàng cuối",dataIndex:"last_sale_order",key:"last_sale_order",render:(l,s)=>e.jsx("div",{className:"!w-[175px]",children:E(s.last_sale_order*1e3).format("DD/MM/YYYY")})}];function ae(){const[l,s]=r.useState([]),[p,D]=r.useState(0),u=20,[x,O]=r.useState(1),[h,y]=r.useState(""),[Y,G]=r.useState([]),[P,L]=r.useState("");let _=d(P,500);const[M,K]=r.useState([]),[j,S]=r.useState(""),[V,R]=r.useState(""),[g,f]=r.useState("");let k=d(V,500);const[b,N]=r.useState(""),[q,z]=r.useState([]),[H,A]=r.useState("");let w=d(H,500);const[C,v]=r.useState(""),[B,U]=r.useState([]),[X,Z]=r.useState("");let F=d(X,500);const[T,I]=r.useState();return r.useEffect(()=>{(async()=>{let t=await c.get("/api/method/frappe.desk.search.search_link",{params:{txt:_,doctype:"Employee",ignore_user_permissions:0,query:""}}),{message:n}=t;console.log("rsEmployee",n),G(n.map(i=>({value:i.description.trim(),label:i.description.trim()})))})()},[_]),r.useEffect(()=>{(async()=>{let t=await c.get("/api/method/frappe.desk.search.search_link",{params:{txt:k,doctype:"Department",ignore_user_permissions:0,query:""}}),{message:n}=t;K(n.map(i=>({value:i.value.trim(),label:i.value.trim()})))})()},[k]),r.useEffect(()=>{(async()=>{let t=await c.get("/api/method/frappe.desk.search.search_link",{params:{txt:w,doctype:"Customer Group",ignore_user_permissions:0,query:""}}),{message:n}=t;z(n.map(i=>({value:i.value.trim(),label:i.value.trim()})))})()},[w]),r.useEffect(()=>{(async()=>{let t=await c.get("/api/method/frappe.desk.search.search_link",{params:{txt:F,doctype:"Territory",ignore_user_permissions:0,query:""}}),{message:n}=t;U(n.map(i=>({value:i.value,label:i.value})))})()},[F]),r.useEffect(()=>{(async()=>{const t=await c.get("/api/method/mbw_dms.api.report.customer_report.customer_report",{params:{page_size:u,page_number:x,customer_type:g,customer_group:b,territory:C,employee:h,has_sales_order:T,department:j}});let{result:n}=t;console.log("result",n),s(n),D(n?.totals_cus)})()},[x,g,b,C,h,T,j]),e.jsxs(e.Fragment,{children:[e.jsx(Q,{title:"Báo cáo khách hàng mới",buttons:[{label:"Xuất dữ liệu",type:"primary",icon:e.jsx(se,{className:"text-xl"}),size:"20px",className:"flex items-center",action:()=>{te("/app/data-export/Data%20Export")}}]}),e.jsxs("div",{className:"bg-white rounded-md py-7 px-4 border-[#DFE3E8] border-[0.2px] border-solid",children:[e.jsxs("div",{className:"flex justify-start items-center pt-2",children:[e.jsx(o,{className:"w-[200px] border-none mr-2",label:"Phòng ban"}),e.jsx(o,{className:"w-[200px] border-none mr-2",label:"Nhân viên"}),e.jsx(o,{className:"w-[200px] border-none mr-2",label:"Loại khách hàng"}),e.jsx(o,{className:"w-[200px] border-none mr-2",label:"Nhóm khách hàng"}),e.jsx(o,{className:"w-[200px] border-none mr-2",label:"Khu vực"})]}),e.jsxs("div",{className:"flex justify-start items-center",children:[e.jsx(o,{className:"w-[200px] border-none mr-2",children:e.jsx(m,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:M,onSelect:t=>{S(t)},onSearch:t=>{R(t)},onClear:()=>S(""),filterOption:!1,allowClear:!0,placeholder:"Tất cả phòng ban"})}),e.jsx(o,{className:"w-[200px] border-none mr-2",children:e.jsx(m,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:Y,onSelect:t=>{y(t)},onSearch:t=>{L(t)},onClear:()=>y(""),filterOption:!1,allowClear:!0,placeholder:"Tất cả nhân viên"})}),e.jsx(o,{className:"w-[200px] border-none mr-2",children:e.jsx(m,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:$,filterOption:!1,allowClear:!0,placeholder:"Tất cả loại khách hàng",onSelect:t=>{f(t)},onClear:()=>f("")})}),e.jsx(o,{className:"w-[200px] border-none mr-2",children:e.jsx(m,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:q,onSelect:t=>{N(t)},onSearch:t=>{A(t)},onClear:()=>N(""),filterOption:!1,allowClear:!0,placeholder:"Tất cả nhóm khách hàng"})}),e.jsx(o,{className:"w-[200px] border-none mr-2",children:e.jsx(m,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:B,onSelect:t=>{v(t)},onSearch:t=>{Z(t)},onClear:()=>v(""),filterOption:!1,allowClear:!0,placeholder:"Tất cả khu vực"})})]}),e.jsx("div",{className:"flex justify-start items-center pt-4",children:e.jsx(o,{className:"w-[200px] border-none mr-2",label:"Phát sinh đơn hàng"})}),e.jsx("div",{className:"flex justify-start items-center",children:e.jsx(o,{className:"w-[200px] border-none mr-2",children:e.jsx(m,{className:"!bg-[#F4F6F8] options:bg-[#F4F6F8]",options:ee,filterOption:!1,allowClear:!0,showSearch:!0,onSelect:t=>{I(t)},onClear:()=>I(void 0)})})}),e.jsx("div",{className:"pt-5",children:e.jsx(W,{dataSource:l?.data?.map(t=>({...t,key:t.name})),bordered:!0,columns:re,pagination:{defaultPageSize:u,total:p,showSizeChanger:!1,onChange(t){O(t)}},scroll:{x:!0},summary:()=>e.jsxs(a.Summary.Row,{children:[e.jsx(a.Summary.Cell,{index:0}),e.jsx(a.Summary.Cell,{index:1,children:"Tổng"}),e.jsx(a.Summary.Cell,{index:2}),e.jsx(a.Summary.Cell,{index:3}),e.jsx(a.Summary.Cell,{index:4}),e.jsx(a.Summary.Cell,{index:5}),e.jsx(a.Summary.Cell,{index:6}),e.jsx(a.Summary.Cell,{index:7}),e.jsx(a.Summary.Cell,{index:8}),e.jsx(a.Summary.Cell,{index:9}),e.jsx(a.Summary.Cell,{index:10}),e.jsx(a.Summary.Cell,{index:11}),e.jsx(a.Summary.Cell,{index:12}),e.jsx(a.Summary.Cell,{index:13}),e.jsx(a.Summary.Cell,{index:14}),e.jsx(a.Summary.Cell,{index:15,children:l?.sum?.sum_checkin}),e.jsx(a.Summary.Cell,{index:16}),e.jsx(a.Summary.Cell,{index:17}),e.jsx(a.Summary.Cell,{index:18,children:l?.sum?.sum_so})]})})})]})]})}function pe(){return e.jsxs(e.Fragment,{children:[e.jsx(J,{children:e.jsx("title",{children:" ReportCustomNew"})}),e.jsx(ae,{})]})}export{pe as default};
